var RC=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports);import"./_virtual_wxt-html-plugins-DPbbfBKe.js";import{b as gi}from"./browser-C4Hj5S8A.js";var b4=RC((R4,ou)=>{var tp={exports:{}},cc={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q0;function NC(){if(q0)return cc;q0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,a,l){var u=null;if(l!==void 0&&(u=""+l),a.key!==void 0&&(u=""+a.key),"key"in a){l={};for(var f in a)f!=="key"&&(l[f]=a[f])}else l=a;return a=l.ref,{$$typeof:n,type:r,key:u,ref:a!==void 0?a:null,props:l}}return cc.Fragment=e,cc.jsx=t,cc.jsxs=t,cc}var H0;function PC(){return H0||(H0=1,tp.exports=NC()),tp.exports}var w=PC(),np={exports:{}},Ve={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var G0;function kC(){if(G0)return Ve;G0=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),u=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.iterator;function E(C){return C===null||typeof C!="object"?null:(C=v&&C[v]||C["@@iterator"],typeof C=="function"?C:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D=Object.assign,j={};function k(C,R,ee){this.props=C,this.context=R,this.refs=j,this.updater=ee||S}k.prototype.isReactComponent={},k.prototype.setState=function(C,R){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,R,"setState")},k.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function P(){}P.prototype=k.prototype;function z(C,R,ee){this.props=C,this.context=R,this.refs=j,this.updater=ee||S}var U=z.prototype=new P;U.constructor=z,D(U,k.prototype),U.isPureReactComponent=!0;var W=Array.isArray,ne={H:null,A:null,T:null,S:null,V:null},re=Object.prototype.hasOwnProperty;function M(C,R,ee,Z,ue,me){return ee=me.ref,{$$typeof:n,type:C,key:R,ref:ee!==void 0?ee:null,props:me}}function N(C,R){return M(C.type,R,void 0,void 0,void 0,C.props)}function I(C){return typeof C=="object"&&C!==null&&C.$$typeof===n}function O(C){var R={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(ee){return R[ee]})}var B=/\/+/g;function q(C,R){return typeof C=="object"&&C!==null&&C.key!=null?O(""+C.key):R.toString(36)}function L(){}function je(C){switch(C.status){case"fulfilled":return C.value;case"rejected":throw C.reason;default:switch(typeof C.status=="string"?C.then(L,L):(C.status="pending",C.then(function(R){C.status==="pending"&&(C.status="fulfilled",C.value=R)},function(R){C.status==="pending"&&(C.status="rejected",C.reason=R)})),C.status){case"fulfilled":return C.value;case"rejected":throw C.reason}}throw C}function Ce(C,R,ee,Z,ue){var me=typeof C;(me==="undefined"||me==="boolean")&&(C=null);var de=!1;if(C===null)de=!0;else switch(me){case"bigint":case"string":case"number":de=!0;break;case"object":switch(C.$$typeof){case n:case e:de=!0;break;case y:return de=C._init,Ce(de(C._payload),R,ee,Z,ue)}}if(de)return ue=ue(C),de=Z===""?"."+q(C,0):Z,W(ue)?(ee="",de!=null&&(ee=de.replace(B,"$&/")+"/"),Ce(ue,R,ee,"",function(Ue){return Ue})):ue!=null&&(I(ue)&&(ue=N(ue,ee+(ue.key==null||C&&C.key===ue.key?"":(""+ue.key).replace(B,"$&/")+"/")+de)),R.push(ue)),1;de=0;var ve=Z===""?".":Z+":";if(W(C))for(var Te=0;Te<C.length;Te++)Z=C[Te],me=ve+q(Z,Te),de+=Ce(Z,R,ee,me,ue);else if(Te=E(C),typeof Te=="function")for(C=Te.call(C),Te=0;!(Z=C.next()).done;)Z=Z.value,me=ve+q(Z,Te++),de+=Ce(Z,R,ee,me,ue);else if(me==="object"){if(typeof C.then=="function")return Ce(je(C),R,ee,Z,ue);throw R=String(C),Error("Objects are not valid as a React child (found: "+(R==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":R)+"). If you meant to render a collection of children, use an array instead.")}return de}function te(C,R,ee){if(C==null)return C;var Z=[],ue=0;return Ce(C,Z,"","",function(me){return R.call(ee,me,ue++)}),Z}function he(C){if(C._status===-1){var R=C._result;R=R(),R.then(function(ee){(C._status===0||C._status===-1)&&(C._status=1,C._result=ee)},function(ee){(C._status===0||C._status===-1)&&(C._status=2,C._result=ee)}),C._status===-1&&(C._status=0,C._result=R)}if(C._status===1)return C._result.default;throw C._result}var ge=typeof reportError=="function"?reportError:function(C){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var R=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof C=="object"&&C!==null&&typeof C.message=="string"?String(C.message):String(C),error:C});if(!window.dispatchEvent(R))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",C);return}console.error(C)};function Qe(){}return Ve.Children={map:te,forEach:function(C,R,ee){te(C,function(){R.apply(this,arguments)},ee)},count:function(C){var R=0;return te(C,function(){R++}),R},toArray:function(C){return te(C,function(R){return R})||[]},only:function(C){if(!I(C))throw Error("React.Children.only expected to receive a single React element child.");return C}},Ve.Component=k,Ve.Fragment=t,Ve.Profiler=a,Ve.PureComponent=z,Ve.StrictMode=r,Ve.Suspense=g,Ve.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=ne,Ve.__COMPILER_RUNTIME={__proto__:null,c:function(C){return ne.H.useMemoCache(C)}},Ve.cache=function(C){return function(){return C.apply(null,arguments)}},Ve.cloneElement=function(C,R,ee){if(C==null)throw Error("The argument must be a React element, but you passed "+C+".");var Z=D({},C.props),ue=C.key,me=void 0;if(R!=null)for(de in R.ref!==void 0&&(me=void 0),R.key!==void 0&&(ue=""+R.key),R)!re.call(R,de)||de==="key"||de==="__self"||de==="__source"||de==="ref"&&R.ref===void 0||(Z[de]=R[de]);var de=arguments.length-2;if(de===1)Z.children=ee;else if(1<de){for(var ve=Array(de),Te=0;Te<de;Te++)ve[Te]=arguments[Te+2];Z.children=ve}return M(C.type,ue,void 0,void 0,me,Z)},Ve.createContext=function(C){return C={$$typeof:u,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null},C.Provider=C,C.Consumer={$$typeof:l,_context:C},C},Ve.createElement=function(C,R,ee){var Z,ue={},me=null;if(R!=null)for(Z in R.key!==void 0&&(me=""+R.key),R)re.call(R,Z)&&Z!=="key"&&Z!=="__self"&&Z!=="__source"&&(ue[Z]=R[Z]);var de=arguments.length-2;if(de===1)ue.children=ee;else if(1<de){for(var ve=Array(de),Te=0;Te<de;Te++)ve[Te]=arguments[Te+2];ue.children=ve}if(C&&C.defaultProps)for(Z in de=C.defaultProps,de)ue[Z]===void 0&&(ue[Z]=de[Z]);return M(C,me,void 0,void 0,null,ue)},Ve.createRef=function(){return{current:null}},Ve.forwardRef=function(C){return{$$typeof:f,render:C}},Ve.isValidElement=I,Ve.lazy=function(C){return{$$typeof:y,_payload:{_status:-1,_result:C},_init:he}},Ve.memo=function(C,R){return{$$typeof:p,type:C,compare:R===void 0?null:R}},Ve.startTransition=function(C){var R=ne.T,ee={};ne.T=ee;try{var Z=C(),ue=ne.S;ue!==null&&ue(ee,Z),typeof Z=="object"&&Z!==null&&typeof Z.then=="function"&&Z.then(Qe,ge)}catch(me){ge(me)}finally{ne.T=R}},Ve.unstable_useCacheRefresh=function(){return ne.H.useCacheRefresh()},Ve.use=function(C){return ne.H.use(C)},Ve.useActionState=function(C,R,ee){return ne.H.useActionState(C,R,ee)},Ve.useCallback=function(C,R){return ne.H.useCallback(C,R)},Ve.useContext=function(C){return ne.H.useContext(C)},Ve.useDebugValue=function(){},Ve.useDeferredValue=function(C,R){return ne.H.useDeferredValue(C,R)},Ve.useEffect=function(C,R,ee){var Z=ne.H;if(typeof ee=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Z.useEffect(C,R)},Ve.useId=function(){return ne.H.useId()},Ve.useImperativeHandle=function(C,R,ee){return ne.H.useImperativeHandle(C,R,ee)},Ve.useInsertionEffect=function(C,R){return ne.H.useInsertionEffect(C,R)},Ve.useLayoutEffect=function(C,R){return ne.H.useLayoutEffect(C,R)},Ve.useMemo=function(C,R){return ne.H.useMemo(C,R)},Ve.useOptimistic=function(C,R){return ne.H.useOptimistic(C,R)},Ve.useReducer=function(C,R,ee){return ne.H.useReducer(C,R,ee)},Ve.useRef=function(C){return ne.H.useRef(C)},Ve.useState=function(C){return ne.H.useState(C)},Ve.useSyncExternalStore=function(C,R,ee){return ne.H.useSyncExternalStore(C,R,ee)},Ve.useTransition=function(){return ne.H.useTransition()},Ve.version="19.1.0",Ve}var $0;function dm(){return $0||($0=1,np.exports=kC()),np.exports}var Ee=dm(),sp={exports:{}},uc={},rp={exports:{}},ip={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var K0;function DC(){return K0||(K0=1,function(n){function e(te,he){var ge=te.length;te.push(he);e:for(;0<ge;){var Qe=ge-1>>>1,C=te[Qe];if(0<a(C,he))te[Qe]=he,te[ge]=C,ge=Qe;else break e}}function t(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var he=te[0],ge=te.pop();if(ge!==he){te[0]=ge;e:for(var Qe=0,C=te.length,R=C>>>1;Qe<R;){var ee=2*(Qe+1)-1,Z=te[ee],ue=ee+1,me=te[ue];if(0>a(Z,ge))ue<C&&0>a(me,Z)?(te[Qe]=me,te[ue]=ge,Qe=ue):(te[Qe]=Z,te[ee]=ge,Qe=ee);else if(ue<C&&0>a(me,ge))te[Qe]=me,te[ue]=ge,Qe=ue;else break e}}return he}function a(te,he){var ge=te.sortIndex-he.sortIndex;return ge!==0?ge:te.id-he.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var u=Date,f=u.now();n.unstable_now=function(){return u.now()-f}}var g=[],p=[],y=1,v=null,E=3,S=!1,D=!1,j=!1,k=!1,P=typeof setTimeout=="function"?setTimeout:null,z=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;function W(te){for(var he=t(p);he!==null;){if(he.callback===null)r(p);else if(he.startTime<=te)r(p),he.sortIndex=he.expirationTime,e(g,he);else break;he=t(p)}}function ne(te){if(j=!1,W(te),!D)if(t(g)!==null)D=!0,re||(re=!0,q());else{var he=t(p);he!==null&&Ce(ne,he.startTime-te)}}var re=!1,M=-1,N=5,I=-1;function O(){return k?!0:!(n.unstable_now()-I<N)}function B(){if(k=!1,re){var te=n.unstable_now();I=te;var he=!0;try{e:{D=!1,j&&(j=!1,z(M),M=-1),S=!0;var ge=E;try{t:{for(W(te),v=t(g);v!==null&&!(v.expirationTime>te&&O());){var Qe=v.callback;if(typeof Qe=="function"){v.callback=null,E=v.priorityLevel;var C=Qe(v.expirationTime<=te);if(te=n.unstable_now(),typeof C=="function"){v.callback=C,W(te),he=!0;break t}v===t(g)&&r(g),W(te)}else r(g);v=t(g)}if(v!==null)he=!0;else{var R=t(p);R!==null&&Ce(ne,R.startTime-te),he=!1}}break e}finally{v=null,E=ge,S=!1}he=void 0}}finally{he?q():re=!1}}}var q;if(typeof U=="function")q=function(){U(B)};else if(typeof MessageChannel<"u"){var L=new MessageChannel,je=L.port2;L.port1.onmessage=B,q=function(){je.postMessage(null)}}else q=function(){P(B,0)};function Ce(te,he){M=P(function(){te(n.unstable_now())},he)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(te){te.callback=null},n.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<te?Math.floor(1e3/te):5},n.unstable_getCurrentPriorityLevel=function(){return E},n.unstable_next=function(te){switch(E){case 1:case 2:case 3:var he=3;break;default:he=E}var ge=E;E=he;try{return te()}finally{E=ge}},n.unstable_requestPaint=function(){k=!0},n.unstable_runWithPriority=function(te,he){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var ge=E;E=te;try{return he()}finally{E=ge}},n.unstable_scheduleCallback=function(te,he,ge){var Qe=n.unstable_now();switch(typeof ge=="object"&&ge!==null?(ge=ge.delay,ge=typeof ge=="number"&&0<ge?Qe+ge:Qe):ge=Qe,te){case 1:var C=-1;break;case 2:C=250;break;case 5:C=1073741823;break;case 4:C=1e4;break;default:C=5e3}return C=ge+C,te={id:y++,callback:he,priorityLevel:te,startTime:ge,expirationTime:C,sortIndex:-1},ge>Qe?(te.sortIndex=ge,e(p,te),t(g)===null&&te===t(p)&&(j?(z(M),M=-1):j=!0,Ce(ne,ge-Qe))):(te.sortIndex=C,e(g,te),D||S||(D=!0,re||(re=!0,q()))),te},n.unstable_shouldYield=O,n.unstable_wrapCallback=function(te){var he=E;return function(){var ge=E;E=he;try{return te.apply(this,arguments)}finally{E=ge}}}}(ip)),ip}var Q0;function MC(){return Q0||(Q0=1,rp.exports=DC()),rp.exports}var ap={exports:{}},En={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y0;function OC(){if(Y0)return En;Y0=1;var n=dm();function e(g){var p="https://react.dev/errors/"+g;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var y=2;y<arguments.length;y++)p+="&args[]="+encodeURIComponent(arguments[y])}return"Minified React error #"+g+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(g,p,y){var v=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:v==null?null:""+v,children:g,containerInfo:p,implementation:y}}var u=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function f(g,p){if(g==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return En.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,En.createPortal=function(g,p){var y=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(g,p,null,y)},En.flushSync=function(g){var p=u.T,y=r.p;try{if(u.T=null,r.p=2,g)return g()}finally{u.T=p,r.p=y,r.d.f()}},En.preconnect=function(g,p){typeof g=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,r.d.C(g,p))},En.prefetchDNS=function(g){typeof g=="string"&&r.d.D(g)},En.preinit=function(g,p){if(typeof g=="string"&&p&&typeof p.as=="string"){var y=p.as,v=f(y,p.crossOrigin),E=typeof p.integrity=="string"?p.integrity:void 0,S=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;y==="style"?r.d.S(g,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:v,integrity:E,fetchPriority:S}):y==="script"&&r.d.X(g,{crossOrigin:v,integrity:E,fetchPriority:S,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},En.preinitModule=function(g,p){if(typeof g=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var y=f(p.as,p.crossOrigin);r.d.M(g,{crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&r.d.M(g)},En.preload=function(g,p){if(typeof g=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var y=p.as,v=f(y,p.crossOrigin);r.d.L(g,y,{crossOrigin:v,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},En.preloadModule=function(g,p){if(typeof g=="string")if(p){var y=f(p.as,p.crossOrigin);r.d.m(g,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:y,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else r.d.m(g)},En.requestFormReset=function(g){r.d.r(g)},En.unstable_batchedUpdates=function(g,p){return g(p)},En.useFormState=function(g,p,y){return u.H.useFormState(g,p,y)},En.useFormStatus=function(){return u.H.useHostTransitionStatus()},En.version="19.1.0",En}var W0;function LC(){if(W0)return ap.exports;W0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ap.exports=OC(),ap.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X0;function VC(){if(X0)return uc;X0=1;var n=MC(),e=dm(),t=LC();function r(s){var i="https://react.dev/errors/"+s;if(1<arguments.length){i+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)i+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+s+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function l(s){var i=s,o=s;if(s.alternate)for(;i.return;)i=i.return;else{s=i;do i=s,(i.flags&4098)!==0&&(o=i.return),s=i.return;while(s)}return i.tag===3?o:null}function u(s){if(s.tag===13){var i=s.memoizedState;if(i===null&&(s=s.alternate,s!==null&&(i=s.memoizedState)),i!==null)return i.dehydrated}return null}function f(s){if(l(s)!==s)throw Error(r(188))}function g(s){var i=s.alternate;if(!i){if(i=l(s),i===null)throw Error(r(188));return i!==s?null:s}for(var o=s,c=i;;){var d=o.return;if(d===null)break;var m=d.alternate;if(m===null){if(c=d.return,c!==null){o=c;continue}break}if(d.child===m.child){for(m=d.child;m;){if(m===o)return f(d),s;if(m===c)return f(d),i;m=m.sibling}throw Error(r(188))}if(o.return!==c.return)o=d,c=m;else{for(var b=!1,x=d.child;x;){if(x===o){b=!0,o=d,c=m;break}if(x===c){b=!0,c=d,o=m;break}x=x.sibling}if(!b){for(x=m.child;x;){if(x===o){b=!0,o=m,c=d;break}if(x===c){b=!0,c=m,o=d;break}x=x.sibling}if(!b)throw Error(r(189))}}if(o.alternate!==c)throw Error(r(190))}if(o.tag!==3)throw Error(r(188));return o.stateNode.current===o?s:i}function p(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s;for(s=s.child;s!==null;){if(i=p(s),i!==null)return i;s=s.sibling}return null}var y=Object.assign,v=Symbol.for("react.element"),E=Symbol.for("react.transitional.element"),S=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),j=Symbol.for("react.strict_mode"),k=Symbol.for("react.profiler"),P=Symbol.for("react.provider"),z=Symbol.for("react.consumer"),U=Symbol.for("react.context"),W=Symbol.for("react.forward_ref"),ne=Symbol.for("react.suspense"),re=Symbol.for("react.suspense_list"),M=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),O=Symbol.for("react.memo_cache_sentinel"),B=Symbol.iterator;function q(s){return s===null||typeof s!="object"?null:(s=B&&s[B]||s["@@iterator"],typeof s=="function"?s:null)}var L=Symbol.for("react.client.reference");function je(s){if(s==null)return null;if(typeof s=="function")return s.$$typeof===L?null:s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case D:return"Fragment";case k:return"Profiler";case j:return"StrictMode";case ne:return"Suspense";case re:return"SuspenseList";case I:return"Activity"}if(typeof s=="object")switch(s.$$typeof){case S:return"Portal";case U:return(s.displayName||"Context")+".Provider";case z:return(s._context.displayName||"Context")+".Consumer";case W:var i=s.render;return s=s.displayName,s||(s=i.displayName||i.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case M:return i=s.displayName||null,i!==null?i:je(s.type)||"Memo";case N:i=s._payload,s=s._init;try{return je(s(i))}catch{}}return null}var Ce=Array.isArray,te=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,he=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ge={pending:!1,data:null,method:null,action:null},Qe=[],C=-1;function R(s){return{current:s}}function ee(s){0>C||(s.current=Qe[C],Qe[C]=null,C--)}function Z(s,i){C++,Qe[C]=s.current,s.current=i}var ue=R(null),me=R(null),de=R(null),ve=R(null);function Te(s,i){switch(Z(de,i),Z(me,s),Z(ue,null),i.nodeType){case 9:case 11:s=(s=i.documentElement)&&(s=s.namespaceURI)?y0(s):0;break;default:if(s=i.tagName,i=i.namespaceURI)i=y0(i),s=_0(i,s);else switch(s){case"svg":s=1;break;case"math":s=2;break;default:s=0}}ee(ue),Z(ue,s)}function Ue(){ee(ue),ee(me),ee(de)}function rt(s){s.memoizedState!==null&&Z(ve,s);var i=ue.current,o=_0(i,s.type);i!==o&&(Z(me,s),Z(ue,o))}function $e(s){me.current===s&&(ee(ue),ee(me)),ve.current===s&&(ee(ve),rc._currentValue=ge)}var at=Object.prototype.hasOwnProperty,Tt=n.unstable_scheduleCallback,Pe=n.unstable_cancelCallback,pt=n.unstable_shouldYield,Gt=n.unstable_requestPaint,ye=n.unstable_now,Ae=n.unstable_getCurrentPriorityLevel,Le=n.unstable_ImmediatePriority,Et=n.unstable_UserBlockingPriority,Nn=n.unstable_NormalPriority,Pn=n.unstable_LowPriority,ns=n.unstable_IdlePriority,Vr=n.log,Na=n.unstable_setDisableYieldValue,xt=null,lt=null;function kn(s){if(typeof Vr=="function"&&Na(s),lt&&typeof lt.setStrictMode=="function")try{lt.setStrictMode(xt,s)}catch{}}var $t=Math.clz32?Math.clz32:Js,ki=Math.log,Di=Math.LN2;function Js(s){return s>>>=0,s===0?32:31-(ki(s)/Di|0)|0}var er=256,Mi=4194304;function _s(s){var i=s&42;if(i!==0)return i;switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return s&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return s}}function Pa(s,i,o){var c=s.pendingLanes;if(c===0)return 0;var d=0,m=s.suspendedLanes,b=s.pingedLanes;s=s.warmLanes;var x=c&134217727;return x!==0?(c=x&~m,c!==0?d=_s(c):(b&=x,b!==0?d=_s(b):o||(o=x&~s,o!==0&&(d=_s(o))))):(x=c&~m,x!==0?d=_s(x):b!==0?d=_s(b):o||(o=c&~s,o!==0&&(d=_s(o)))),d===0?0:i!==0&&i!==d&&(i&m)===0&&(m=d&-d,o=i&-i,m>=o||m===32&&(o&4194048)!==0)?i:d}function Oi(s,i){return(s.pendingLanes&~(s.suspendedLanes&~s.pingedLanes)&i)===0}function rl(s,i){switch(s){case 1:case 2:case 4:case 8:case 64:return i+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function il(){var s=er;return er<<=1,(er&4194048)===0&&(er=256),s}function al(){var s=Mi;return Mi<<=1,(Mi&62914560)===0&&(Mi=4194304),s}function tr(s){for(var i=[],o=0;31>o;o++)i.push(s);return i}function nr(s,i){s.pendingLanes|=i,i!==268435456&&(s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0)}function ol(s,i,o,c,d,m){var b=s.pendingLanes;s.pendingLanes=o,s.suspendedLanes=0,s.pingedLanes=0,s.warmLanes=0,s.expiredLanes&=o,s.entangledLanes&=o,s.errorRecoveryDisabledLanes&=o,s.shellSuspendCounter=0;var x=s.entanglements,V=s.expirationTimes,K=s.hiddenUpdates;for(o=b&~o;0<o;){var se=31-$t(o),ae=1<<se;x[se]=0,V[se]=-1;var Q=K[se];if(Q!==null)for(K[se]=null,se=0;se<Q.length;se++){var Y=Q[se];Y!==null&&(Y.lane&=-536870913)}o&=~ae}c!==0&&Ns(s,c,0),m!==0&&d===0&&s.tag!==0&&(s.suspendedLanes|=m&~(b&~i))}function Ns(s,i,o){s.pendingLanes|=i,s.suspendedLanes&=~i;var c=31-$t(i);s.entangledLanes|=i,s.entanglements[c]=s.entanglements[c]|1073741824|o&4194090}function ll(s,i){var o=s.entangledLanes|=i;for(s=s.entanglements;o;){var c=31-$t(o),d=1<<c;d&i|s[c]&i&&(s[c]|=i),o&=~d}}function jr(s){switch(s){case 2:s=1;break;case 8:s=4;break;case 32:s=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:s=128;break;case 268435456:s=134217728;break;default:s=0}return s}function ka(s){return s&=-s,2<s?8<s?(s&134217727)!==0?32:268435456:8:2}function Ur(){var s=he.p;return s!==0?s:(s=window.event,s===void 0?32:V0(s.type))}function lu(s,i){var o=he.p;try{return he.p=s,i()}finally{he.p=o}}var Rt=Math.random().toString(36).slice(2),Kt="__reactFiber$"+Rt,Ut="__reactProps$"+Rt,ss="__reactContainer$"+Rt,cl="__reactEvents$"+Rt,sf="__reactListeners$"+Rt,zr="__reactHandles$"+Rt,cu="__reactResources$"+Rt,Li="__reactMarker$"+Rt;function Br(s){delete s[Kt],delete s[Ut],delete s[cl],delete s[sf],delete s[zr]}function sr(s){var i=s[Kt];if(i)return i;for(var o=s.parentNode;o;){if(i=o[ss]||o[Kt]){if(o=i.alternate,i.child!==null||o!==null&&o.child!==null)for(s=b0(s);s!==null;){if(o=s[Kt])return o;s=b0(s)}return i}s=o,o=s.parentNode}return null}function Ps(s){if(s=s[Kt]||s[ss]){var i=s.tag;if(i===5||i===6||i===13||i===26||i===27||i===3)return s}return null}function ks(s){var i=s.tag;if(i===5||i===26||i===27||i===6)return s.stateNode;throw Error(r(33))}function Dn(s){var i=s[cu];return i||(i=s[cu]={hoistableStyles:new Map,hoistableScripts:new Map}),i}function Ot(s){s[Li]=!0}var ul=new Set,Da={};function vs(s,i){rr(s,i),rr(s+"Capture",i)}function rr(s,i){for(Da[s]=i,s=0;s<i.length;s++)ul.add(i[s])}var uu=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),hu={},Vi={};function du(s){return at.call(Vi,s)?!0:at.call(hu,s)?!1:uu.test(s)?Vi[s]=!0:(hu[s]=!0,!1)}function Fr(s,i,o){if(du(i))if(o===null)s.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":s.removeAttribute(i);return;case"boolean":var c=i.toLowerCase().slice(0,5);if(c!=="data-"&&c!=="aria-"){s.removeAttribute(i);return}}s.setAttribute(i,""+o)}}function Ds(s,i,o){if(o===null)s.removeAttribute(i);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(i);return}s.setAttribute(i,""+o)}}function fn(s,i,o,c){if(c===null)s.removeAttribute(o);else{switch(typeof c){case"undefined":case"function":case"symbol":case"boolean":s.removeAttribute(o);return}s.setAttributeNS(i,o,""+c)}}var ji,fu;function ir(s){if(ji===void 0)try{throw Error()}catch(o){var i=o.stack.trim().match(/\n( *(at )?)/);ji=i&&i[1]||"",fu=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ji+s+fu}var Ma=!1;function Oa(s,i){if(!s||Ma)return"";Ma=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var c={DetermineComponentFrameRoot:function(){try{if(i){var ae=function(){throw Error()};if(Object.defineProperty(ae.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ae,[])}catch(Y){var Q=Y}Reflect.construct(s,[],ae)}else{try{ae.call()}catch(Y){Q=Y}s.call(ae.prototype)}}else{try{throw Error()}catch(Y){Q=Y}(ae=s())&&typeof ae.catch=="function"&&ae.catch(function(){})}}catch(Y){if(Y&&Q&&typeof Y.stack=="string")return[Y.stack,Q.stack]}return[null,null]}};c.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var d=Object.getOwnPropertyDescriptor(c.DetermineComponentFrameRoot,"name");d&&d.configurable&&Object.defineProperty(c.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var m=c.DetermineComponentFrameRoot(),b=m[0],x=m[1];if(b&&x){var V=b.split(`
`),K=x.split(`
`);for(d=c=0;c<V.length&&!V[c].includes("DetermineComponentFrameRoot");)c++;for(;d<K.length&&!K[d].includes("DetermineComponentFrameRoot");)d++;if(c===V.length||d===K.length)for(c=V.length-1,d=K.length-1;1<=c&&0<=d&&V[c]!==K[d];)d--;for(;1<=c&&0<=d;c--,d--)if(V[c]!==K[d]){if(c!==1||d!==1)do if(c--,d--,0>d||V[c]!==K[d]){var se=`
`+V[c].replace(" at new "," at ");return s.displayName&&se.includes("<anonymous>")&&(se=se.replace("<anonymous>",s.displayName)),se}while(1<=c&&0<=d);break}}}finally{Ma=!1,Error.prepareStackTrace=o}return(o=s?s.displayName||s.name:"")?ir(o):""}function hl(s){switch(s.tag){case 26:case 27:case 5:return ir(s.type);case 16:return ir("Lazy");case 13:return ir("Suspense");case 19:return ir("SuspenseList");case 0:case 15:return Oa(s.type,!1);case 11:return Oa(s.type.render,!1);case 1:return Oa(s.type,!0);case 31:return ir("Activity");default:return""}}function La(s){try{var i="";do i+=hl(s),s=s.return;while(s);return i}catch(o){return`
Error generating stack: `+o.message+`
`+o.stack}}function Mn(s){switch(typeof s){case"bigint":case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function dl(s){var i=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function rf(s){var i=dl(s)?"checked":"value",o=Object.getOwnPropertyDescriptor(s.constructor.prototype,i),c=""+s[i];if(!s.hasOwnProperty(i)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var d=o.get,m=o.set;return Object.defineProperty(s,i,{configurable:!0,get:function(){return d.call(this)},set:function(b){c=""+b,m.call(this,b)}}),Object.defineProperty(s,i,{enumerable:o.enumerable}),{getValue:function(){return c},setValue:function(b){c=""+b},stopTracking:function(){s._valueTracker=null,delete s[i]}}}}function Va(s){s._valueTracker||(s._valueTracker=rf(s))}function fl(s){if(!s)return!1;var i=s._valueTracker;if(!i)return!0;var o=i.getValue(),c="";return s&&(c=dl(s)?s.checked?"true":"false":s.value),s=c,s!==o?(i.setValue(s),!0):!1}function Ui(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}var af=/[\n"\\]/g;function zt(s){return s.replace(af,function(i){return"\\"+i.charCodeAt(0).toString(16)+" "})}function Gn(s,i,o,c,d,m,b,x){s.name="",b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"?s.type=b:s.removeAttribute("type"),i!=null?b==="number"?(i===0&&s.value===""||s.value!=i)&&(s.value=""+Mn(i)):s.value!==""+Mn(i)&&(s.value=""+Mn(i)):b!=="submit"&&b!=="reset"||s.removeAttribute("value"),i!=null?qr(s,b,Mn(i)):o!=null?qr(s,b,Mn(o)):c!=null&&s.removeAttribute("value"),d==null&&m!=null&&(s.defaultChecked=!!m),d!=null&&(s.checked=d&&typeof d!="function"&&typeof d!="symbol"),x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"?s.name=""+Mn(x):s.removeAttribute("name")}function zi(s,i,o,c,d,m,b,x){if(m!=null&&typeof m!="function"&&typeof m!="symbol"&&typeof m!="boolean"&&(s.type=m),i!=null||o!=null){if(!(m!=="submit"&&m!=="reset"||i!=null))return;o=o!=null?""+Mn(o):"",i=i!=null?""+Mn(i):o,x||i===s.value||(s.value=i),s.defaultValue=i}c=c??d,c=typeof c!="function"&&typeof c!="symbol"&&!!c,s.checked=x?s.checked:!!c,s.defaultChecked=!!c,b!=null&&typeof b!="function"&&typeof b!="symbol"&&typeof b!="boolean"&&(s.name=b)}function qr(s,i,o){i==="number"&&Ui(s.ownerDocument)===s||s.defaultValue===""+o||(s.defaultValue=""+o)}function ar(s,i,o,c){if(s=s.options,i){i={};for(var d=0;d<o.length;d++)i["$"+o[d]]=!0;for(o=0;o<s.length;o++)d=i.hasOwnProperty("$"+s[o].value),s[o].selected!==d&&(s[o].selected=d),d&&c&&(s[o].defaultSelected=!0)}else{for(o=""+Mn(o),i=null,d=0;d<s.length;d++){if(s[d].value===o){s[d].selected=!0,c&&(s[d].defaultSelected=!0);return}i!==null||s[d].disabled||(i=s[d])}i!==null&&(i.selected=!0)}}function mt(s,i,o){if(i!=null&&(i=""+Mn(i),i!==s.value&&(s.value=i),o==null)){s.defaultValue!==i&&(s.defaultValue=i);return}s.defaultValue=o!=null?""+Mn(o):""}function Bi(s,i,o,c){if(i==null){if(c!=null){if(o!=null)throw Error(r(92));if(Ce(c)){if(1<c.length)throw Error(r(93));c=c[0]}o=c}o==null&&(o=""),i=o}o=Mn(i),s.defaultValue=o,c=s.textContent,c===o&&c!==""&&c!==null&&(s.value=c)}function rs(s,i){if(i){var o=s.firstChild;if(o&&o===s.lastChild&&o.nodeType===3){o.nodeValue=i;return}}s.textContent=i}var Fi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function gu(s,i,o){var c=i.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?c?s.setProperty(i,""):i==="float"?s.cssFloat="":s[i]="":c?s.setProperty(i,o):typeof o!="number"||o===0||Fi.has(i)?i==="float"?s.cssFloat=o:s[i]=(""+o).trim():s[i]=o+"px"}function gl(s,i,o){if(i!=null&&typeof i!="object")throw Error(r(62));if(s=s.style,o!=null){for(var c in o)!o.hasOwnProperty(c)||i!=null&&i.hasOwnProperty(c)||(c.indexOf("--")===0?s.setProperty(c,""):c==="float"?s.cssFloat="":s[c]="");for(var d in i)c=i[d],i.hasOwnProperty(d)&&o[d]!==c&&gu(s,d,c)}else for(var m in i)i.hasOwnProperty(m)&&gu(s,m,i[m])}function pl(s){if(s.indexOf("-")===-1)return!1;switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var of=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),lf=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function ja(s){return lf.test(""+s)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":s}var or=null;function is(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var lr=null,cr=null;function ml(s){var i=Ps(s);if(i&&(s=i.stateNode)){var o=s[Ut]||null;e:switch(s=i.stateNode,i.type){case"input":if(Gn(s,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),i=o.name,o.type==="radio"&&i!=null){for(o=s;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+zt(""+i)+'"][type="radio"]'),i=0;i<o.length;i++){var c=o[i];if(c!==s&&c.form===s.form){var d=c[Ut]||null;if(!d)throw Error(r(90));Gn(c,d.value,d.defaultValue,d.defaultValue,d.checked,d.defaultChecked,d.type,d.name)}}for(i=0;i<o.length;i++)c=o[i],c.form===s.form&&fl(c)}break e;case"textarea":mt(s,o.value,o.defaultValue);break e;case"select":i=o.value,i!=null&&ar(s,!!o.multiple,i,!1)}}}var Ms=!1;function pu(s,i,o){if(Ms)return s(i,o);Ms=!0;try{var c=s(i);return c}finally{if(Ms=!1,(lr!==null||cr!==null)&&(lh(),lr&&(i=lr,s=cr,cr=lr=null,ml(i),s)))for(i=0;i<s.length;i++)ml(s[i])}}function qi(s,i){var o=s.stateNode;if(o===null)return null;var c=o[Ut]||null;if(c===null)return null;o=c[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(c=!c.disabled)||(s=s.type,c=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!c;break e;default:s=!1}if(s)return null;if(o&&typeof o!="function")throw Error(r(231,i,typeof o));return o}var ws=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),as=!1;if(ws)try{var Hi={};Object.defineProperty(Hi,"passive",{get:function(){as=!0}}),window.addEventListener("test",Hi,Hi),window.removeEventListener("test",Hi,Hi)}catch{as=!1}var Os=null,Hr=null,ur=null;function yl(){if(ur)return ur;var s,i=Hr,o=i.length,c,d="value"in Os?Os.value:Os.textContent,m=d.length;for(s=0;s<o&&i[s]===d[s];s++);var b=o-s;for(c=1;c<=b&&i[o-c]===d[m-c];c++);return ur=d.slice(s,1<c?1-c:void 0)}function Ls(s){var i=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&i===13&&(s=13)):s=i,s===10&&(s=13),32<=s||s===13?s:0}function Vs(){return!0}function _l(){return!1}function tn(s){function i(o,c,d,m,b){this._reactName=o,this._targetInst=d,this.type=c,this.nativeEvent=m,this.target=b,this.currentTarget=null;for(var x in s)s.hasOwnProperty(x)&&(o=s[x],this[x]=o?o(m):m[x]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Vs:_l,this.isPropagationStopped=_l,this}return y(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Vs)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Vs)},persist:function(){},isPersistent:Vs}),i}var ut={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ua=tn(ut),Gi=y({},ut,{view:0,detail:0}),mu=tn(Gi),za,Ba,js,$i=y({},Gi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Yi,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==js&&(js&&s.type==="mousemove"?(za=s.screenX-js.screenX,Ba=s.screenY-js.screenY):Ba=za=0,js=s),za)},movementY:function(s){return"movementY"in s?s.movementY:Ba}}),os=tn($i),yu=y({},$i,{dataTransfer:0}),cf=tn(yu),Ki=y({},Gi,{relatedTarget:0}),Fa=tn(Ki),vl=y({},ut,{animationName:0,elapsedTime:0,pseudoElement:0}),qa=tn(vl),_u=y({},ut,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),Ha=tn(_u),uf=y({},ut,{data:0}),wl=tn(uf),Qi={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},vu={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wu={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Tl(s){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(s):(s=wu[s])?!!i[s]:!1}function Yi(){return Tl}var Tu=y({},Gi,{key:function(s){if(s.key){var i=Qi[s.key]||s.key;if(i!=="Unidentified")return i}return s.type==="keypress"?(s=Ls(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?vu[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Yi,charCode:function(s){return s.type==="keypress"?Ls(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Ls(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),Ga=tn(Tu),bu=y({},$i,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bl=tn(bu),hr=y({},Gi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Yi}),Eu=tn(hr),Su=y({},ut,{propertyName:0,elapsedTime:0,pseudoElement:0}),xu=tn(Su),Cu=y({},$i,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),$a=tn(Cu),On=y({},ut,{newState:0,oldState:0}),Au=tn(On),Iu=[9,13,27,32],Us=ws&&"CompositionEvent"in window,h=null;ws&&"documentMode"in document&&(h=document.documentMode);var _=ws&&"TextEvent"in window&&!h,T=ws&&(!Us||h&&8<h&&11>=h),A=" ",G=!1;function X(s,i){switch(s){case"keyup":return Iu.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function fe(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var We=!1;function Qt(s,i){switch(s){case"compositionend":return fe(i);case"keypress":return i.which!==32?null:(G=!0,A);case"textInput":return s=i.data,s===A&&G?null:s;default:return null}}function Xe(s,i){if(We)return s==="compositionend"||!Us&&X(s,i)?(s=yl(),ur=Hr=Os=null,We=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return T&&i.locale!=="ko"?null:i.data;default:return null}}var nn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Yt(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i==="input"?!!nn[s.type]:i==="textarea"}function dr(s,i,o,c){lr?cr?cr.push(c):cr=[c]:lr=c,i=gh(i,"onChange"),0<i.length&&(o=new Ua("onChange","change",null,o,c),s.push({event:o,listeners:i}))}var gn=null,zs=null;function El(s){d0(s,0)}function Ru(s){var i=ks(s);if(fl(i))return s}function Dy(s,i){if(s==="change")return i}var My=!1;if(ws){var hf;if(ws){var df="oninput"in document;if(!df){var Oy=document.createElement("div");Oy.setAttribute("oninput","return;"),df=typeof Oy.oninput=="function"}hf=df}else hf=!1;My=hf&&(!document.documentMode||9<document.documentMode)}function Ly(){gn&&(gn.detachEvent("onpropertychange",Vy),zs=gn=null)}function Vy(s){if(s.propertyName==="value"&&Ru(zs)){var i=[];dr(i,zs,s,is(s)),pu(El,i)}}function ix(s,i,o){s==="focusin"?(Ly(),gn=i,zs=o,gn.attachEvent("onpropertychange",Vy)):s==="focusout"&&Ly()}function ax(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Ru(zs)}function ox(s,i){if(s==="click")return Ru(i)}function lx(s,i){if(s==="input"||s==="change")return Ru(i)}function cx(s,i){return s===i&&(s!==0||1/s===1/i)||s!==s&&i!==i}var $n=typeof Object.is=="function"?Object.is:cx;function Sl(s,i){if($n(s,i))return!0;if(typeof s!="object"||s===null||typeof i!="object"||i===null)return!1;var o=Object.keys(s),c=Object.keys(i);if(o.length!==c.length)return!1;for(c=0;c<o.length;c++){var d=o[c];if(!at.call(i,d)||!$n(s[d],i[d]))return!1}return!0}function jy(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Uy(s,i){var o=jy(s);s=0;for(var c;o;){if(o.nodeType===3){if(c=s+o.textContent.length,s<=i&&c>=i)return{node:o,offset:i-s};s=c}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=jy(o)}}function zy(s,i){return s&&i?s===i?!0:s&&s.nodeType===3?!1:i&&i.nodeType===3?zy(s,i.parentNode):"contains"in s?s.contains(i):s.compareDocumentPosition?!!(s.compareDocumentPosition(i)&16):!1:!1}function By(s){s=s!=null&&s.ownerDocument!=null&&s.ownerDocument.defaultView!=null?s.ownerDocument.defaultView:window;for(var i=Ui(s.document);i instanceof s.HTMLIFrameElement;){try{var o=typeof i.contentWindow.location.href=="string"}catch{o=!1}if(o)s=i.contentWindow;else break;i=Ui(s.document)}return i}function ff(s){var i=s&&s.nodeName&&s.nodeName.toLowerCase();return i&&(i==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||i==="textarea"||s.contentEditable==="true")}var ux=ws&&"documentMode"in document&&11>=document.documentMode,Ka=null,gf=null,xl=null,pf=!1;function Fy(s,i,o){var c=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;pf||Ka==null||Ka!==Ui(c)||(c=Ka,"selectionStart"in c&&ff(c)?c={start:c.selectionStart,end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset}),xl&&Sl(xl,c)||(xl=c,c=gh(gf,"onSelect"),0<c.length&&(i=new Ua("onSelect","select",null,i,o),s.push({event:i,listeners:c}),i.target=Ka)))}function Wi(s,i){var o={};return o[s.toLowerCase()]=i.toLowerCase(),o["Webkit"+s]="webkit"+i,o["Moz"+s]="moz"+i,o}var Qa={animationend:Wi("Animation","AnimationEnd"),animationiteration:Wi("Animation","AnimationIteration"),animationstart:Wi("Animation","AnimationStart"),transitionrun:Wi("Transition","TransitionRun"),transitionstart:Wi("Transition","TransitionStart"),transitioncancel:Wi("Transition","TransitionCancel"),transitionend:Wi("Transition","TransitionEnd")},mf={},qy={};ws&&(qy=document.createElement("div").style,"AnimationEvent"in window||(delete Qa.animationend.animation,delete Qa.animationiteration.animation,delete Qa.animationstart.animation),"TransitionEvent"in window||delete Qa.transitionend.transition);function Xi(s){if(mf[s])return mf[s];if(!Qa[s])return s;var i=Qa[s],o;for(o in i)if(i.hasOwnProperty(o)&&o in qy)return mf[s]=i[o];return s}var Hy=Xi("animationend"),Gy=Xi("animationiteration"),$y=Xi("animationstart"),hx=Xi("transitionrun"),dx=Xi("transitionstart"),fx=Xi("transitioncancel"),Ky=Xi("transitionend"),Qy=new Map,yf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");yf.push("scrollEnd");function Ts(s,i){Qy.set(s,i),vs(i,[s])}var Yy=new WeakMap;function ls(s,i){if(typeof s=="object"&&s!==null){var o=Yy.get(s);return o!==void 0?o:(i={value:s,source:i,stack:La(i)},Yy.set(s,i),i)}return{value:s,source:i,stack:La(i)}}var cs=[],Ya=0,_f=0;function Nu(){for(var s=Ya,i=_f=Ya=0;i<s;){var o=cs[i];cs[i++]=null;var c=cs[i];cs[i++]=null;var d=cs[i];cs[i++]=null;var m=cs[i];if(cs[i++]=null,c!==null&&d!==null){var b=c.pending;b===null?d.next=d:(d.next=b.next,b.next=d),c.pending=d}m!==0&&Wy(o,d,m)}}function Pu(s,i,o,c){cs[Ya++]=s,cs[Ya++]=i,cs[Ya++]=o,cs[Ya++]=c,_f|=c,s.lanes|=c,s=s.alternate,s!==null&&(s.lanes|=c)}function vf(s,i,o,c){return Pu(s,i,o,c),ku(s)}function Wa(s,i){return Pu(s,null,null,i),ku(s)}function Wy(s,i,o){s.lanes|=o;var c=s.alternate;c!==null&&(c.lanes|=o);for(var d=!1,m=s.return;m!==null;)m.childLanes|=o,c=m.alternate,c!==null&&(c.childLanes|=o),m.tag===22&&(s=m.stateNode,s===null||s._visibility&1||(d=!0)),s=m,m=m.return;return s.tag===3?(m=s.stateNode,d&&i!==null&&(d=31-$t(o),s=m.hiddenUpdates,c=s[d],c===null?s[d]=[i]:c.push(i),i.lane=o|536870912),m):null}function ku(s){if(50<Wl)throw Wl=0,xg=null,Error(r(185));for(var i=s.return;i!==null;)s=i,i=s.return;return s.tag===3?s.stateNode:null}var Xa={};function gx(s,i,o,c){this.tag=s,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=c,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(s,i,o,c){return new gx(s,i,o,c)}function wf(s){return s=s.prototype,!(!s||!s.isReactComponent)}function fr(s,i){var o=s.alternate;return o===null?(o=Kn(s.tag,i,s.key,s.mode),o.elementType=s.elementType,o.type=s.type,o.stateNode=s.stateNode,o.alternate=s,s.alternate=o):(o.pendingProps=i,o.type=s.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=s.flags&65011712,o.childLanes=s.childLanes,o.lanes=s.lanes,o.child=s.child,o.memoizedProps=s.memoizedProps,o.memoizedState=s.memoizedState,o.updateQueue=s.updateQueue,i=s.dependencies,o.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},o.sibling=s.sibling,o.index=s.index,o.ref=s.ref,o.refCleanup=s.refCleanup,o}function Xy(s,i){s.flags&=65011714;var o=s.alternate;return o===null?(s.childLanes=0,s.lanes=i,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=o.childLanes,s.lanes=o.lanes,s.child=o.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=o.memoizedProps,s.memoizedState=o.memoizedState,s.updateQueue=o.updateQueue,s.type=o.type,i=o.dependencies,s.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),s}function Du(s,i,o,c,d,m){var b=0;if(c=s,typeof s=="function")wf(s)&&(b=1);else if(typeof s=="string")b=mC(s,o,ue.current)?26:s==="html"||s==="head"||s==="body"?27:5;else e:switch(s){case I:return s=Kn(31,o,i,d),s.elementType=I,s.lanes=m,s;case D:return Zi(o.children,d,m,i);case j:b=8,d|=24;break;case k:return s=Kn(12,o,i,d|2),s.elementType=k,s.lanes=m,s;case ne:return s=Kn(13,o,i,d),s.elementType=ne,s.lanes=m,s;case re:return s=Kn(19,o,i,d),s.elementType=re,s.lanes=m,s;default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case P:case U:b=10;break e;case z:b=9;break e;case W:b=11;break e;case M:b=14;break e;case N:b=16,c=null;break e}b=29,o=Error(r(130,s===null?"null":typeof s,"")),c=null}return i=Kn(b,o,i,d),i.elementType=s,i.type=c,i.lanes=m,i}function Zi(s,i,o,c){return s=Kn(7,s,c,i),s.lanes=o,s}function Tf(s,i,o){return s=Kn(6,s,null,i),s.lanes=o,s}function bf(s,i,o){return i=Kn(4,s.children!==null?s.children:[],s.key,i),i.lanes=o,i.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},i}var Za=[],Ja=0,Mu=null,Ou=0,us=[],hs=0,Ji=null,gr=1,pr="";function ea(s,i){Za[Ja++]=Ou,Za[Ja++]=Mu,Mu=s,Ou=i}function Zy(s,i,o){us[hs++]=gr,us[hs++]=pr,us[hs++]=Ji,Ji=s;var c=gr;s=pr;var d=32-$t(c)-1;c&=~(1<<d),o+=1;var m=32-$t(i)+d;if(30<m){var b=d-d%5;m=(c&(1<<b)-1).toString(32),c>>=b,d-=b,gr=1<<32-$t(i)+d|o<<d|c,pr=m+s}else gr=1<<m|o<<d|c,pr=s}function Ef(s){s.return!==null&&(ea(s,1),Zy(s,1,0))}function Sf(s){for(;s===Mu;)Mu=Za[--Ja],Za[Ja]=null,Ou=Za[--Ja],Za[Ja]=null;for(;s===Ji;)Ji=us[--hs],us[hs]=null,pr=us[--hs],us[hs]=null,gr=us[--hs],us[hs]=null}var Ln=null,Dt=null,ct=!1,ta=null,Bs=!1,xf=Error(r(519));function na(s){var i=Error(r(418,""));throw Il(ls(i,s)),xf}function Jy(s){var i=s.stateNode,o=s.type,c=s.memoizedProps;switch(i[Kt]=s,i[Ut]=c,o){case"dialog":He("cancel",i),He("close",i);break;case"iframe":case"object":case"embed":He("load",i);break;case"video":case"audio":for(o=0;o<Zl.length;o++)He(Zl[o],i);break;case"source":He("error",i);break;case"img":case"image":case"link":He("error",i),He("load",i);break;case"details":He("toggle",i);break;case"input":He("invalid",i),zi(i,c.value,c.defaultValue,c.checked,c.defaultChecked,c.type,c.name,!0),Va(i);break;case"select":He("invalid",i);break;case"textarea":He("invalid",i),Bi(i,c.value,c.defaultValue,c.children),Va(i)}o=c.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||i.textContent===""+o||c.suppressHydrationWarning===!0||m0(i.textContent,o)?(c.popover!=null&&(He("beforetoggle",i),He("toggle",i)),c.onScroll!=null&&He("scroll",i),c.onScrollEnd!=null&&He("scrollend",i),c.onClick!=null&&(i.onclick=ph),i=!0):i=!1,i||na(s)}function e_(s){for(Ln=s.return;Ln;)switch(Ln.tag){case 5:case 13:Bs=!1;return;case 27:case 3:Bs=!0;return;default:Ln=Ln.return}}function Cl(s){if(s!==Ln)return!1;if(!ct)return e_(s),ct=!0,!1;var i=s.tag,o;if((o=i!==3&&i!==27)&&((o=i===5)&&(o=s.type,o=!(o!=="form"&&o!=="button")||Bg(s.type,s.memoizedProps)),o=!o),o&&Dt&&na(s),e_(s),i===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(r(317));e:{for(s=s.nextSibling,i=0;s;){if(s.nodeType===8)if(o=s.data,o==="/$"){if(i===0){Dt=Es(s.nextSibling);break e}i--}else o!=="$"&&o!=="$!"&&o!=="$?"||i++;s=s.nextSibling}Dt=null}}else i===27?(i=Dt,ai(s.type)?(s=Gg,Gg=null,Dt=s):Dt=i):Dt=Ln?Es(s.stateNode.nextSibling):null;return!0}function Al(){Dt=Ln=null,ct=!1}function t_(){var s=ta;return s!==null&&(Fn===null?Fn=s:Fn.push.apply(Fn,s),ta=null),s}function Il(s){ta===null?ta=[s]:ta.push(s)}var Cf=R(null),sa=null,mr=null;function Gr(s,i,o){Z(Cf,i._currentValue),i._currentValue=o}function yr(s){s._currentValue=Cf.current,ee(Cf)}function Af(s,i,o){for(;s!==null;){var c=s.alternate;if((s.childLanes&i)!==i?(s.childLanes|=i,c!==null&&(c.childLanes|=i)):c!==null&&(c.childLanes&i)!==i&&(c.childLanes|=i),s===o)break;s=s.return}}function If(s,i,o,c){var d=s.child;for(d!==null&&(d.return=s);d!==null;){var m=d.dependencies;if(m!==null){var b=d.child;m=m.firstContext;e:for(;m!==null;){var x=m;m=d;for(var V=0;V<i.length;V++)if(x.context===i[V]){m.lanes|=o,x=m.alternate,x!==null&&(x.lanes|=o),Af(m.return,o,s),c||(b=null);break e}m=x.next}}else if(d.tag===18){if(b=d.return,b===null)throw Error(r(341));b.lanes|=o,m=b.alternate,m!==null&&(m.lanes|=o),Af(b,o,s),b=null}else b=d.child;if(b!==null)b.return=d;else for(b=d;b!==null;){if(b===s){b=null;break}if(d=b.sibling,d!==null){d.return=b.return,b=d;break}b=b.return}d=b}}function Rl(s,i,o,c){s=null;for(var d=i,m=!1;d!==null;){if(!m){if((d.flags&524288)!==0)m=!0;else if((d.flags&262144)!==0)break}if(d.tag===10){var b=d.alternate;if(b===null)throw Error(r(387));if(b=b.memoizedProps,b!==null){var x=d.type;$n(d.pendingProps.value,b.value)||(s!==null?s.push(x):s=[x])}}else if(d===ve.current){if(b=d.alternate,b===null)throw Error(r(387));b.memoizedState.memoizedState!==d.memoizedState.memoizedState&&(s!==null?s.push(rc):s=[rc])}d=d.return}s!==null&&If(i,s,o,c),i.flags|=262144}function Lu(s){for(s=s.firstContext;s!==null;){if(!$n(s.context._currentValue,s.memoizedValue))return!0;s=s.next}return!1}function ra(s){sa=s,mr=null,s=s.dependencies,s!==null&&(s.firstContext=null)}function bn(s){return n_(sa,s)}function Vu(s,i){return sa===null&&ra(s),n_(s,i)}function n_(s,i){var o=i._currentValue;if(i={context:i,memoizedValue:o,next:null},mr===null){if(s===null)throw Error(r(308));mr=i,s.dependencies={lanes:0,firstContext:i},s.flags|=524288}else mr=mr.next=i;return o}var px=typeof AbortController<"u"?AbortController:function(){var s=[],i=this.signal={aborted:!1,addEventListener:function(o,c){s.push(c)}};this.abort=function(){i.aborted=!0,s.forEach(function(o){return o()})}},mx=n.unstable_scheduleCallback,yx=n.unstable_NormalPriority,Wt={$$typeof:U,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Rf(){return{controller:new px,data:new Map,refCount:0}}function Nl(s){s.refCount--,s.refCount===0&&mx(yx,function(){s.controller.abort()})}var Pl=null,Nf=0,eo=0,to=null;function _x(s,i){if(Pl===null){var o=Pl=[];Nf=0,eo=kg(),to={status:"pending",value:void 0,then:function(c){o.push(c)}}}return Nf++,i.then(s_,s_),i}function s_(){if(--Nf===0&&Pl!==null){to!==null&&(to.status="fulfilled");var s=Pl;Pl=null,eo=0,to=null;for(var i=0;i<s.length;i++)(0,s[i])()}}function vx(s,i){var o=[],c={status:"pending",value:null,reason:null,then:function(d){o.push(d)}};return s.then(function(){c.status="fulfilled",c.value=i;for(var d=0;d<o.length;d++)(0,o[d])(i)},function(d){for(c.status="rejected",c.reason=d,d=0;d<o.length;d++)(0,o[d])(void 0)}),c}var r_=te.S;te.S=function(s,i){typeof i=="object"&&i!==null&&typeof i.then=="function"&&_x(s,i),r_!==null&&r_(s,i)};var ia=R(null);function Pf(){var s=ia.current;return s!==null?s:St.pooledCache}function ju(s,i){i===null?Z(ia,ia.current):Z(ia,i.pool)}function i_(){var s=Pf();return s===null?null:{parent:Wt._currentValue,pool:s}}var kl=Error(r(460)),a_=Error(r(474)),Uu=Error(r(542)),kf={then:function(){}};function o_(s){return s=s.status,s==="fulfilled"||s==="rejected"}function zu(){}function l_(s,i,o){switch(o=s[o],o===void 0?s.push(i):o!==i&&(i.then(zu,zu),i=o),i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,u_(s),s;default:if(typeof i.status=="string")i.then(zu,zu);else{if(s=St,s!==null&&100<s.shellSuspendCounter)throw Error(r(482));s=i,s.status="pending",s.then(function(c){if(i.status==="pending"){var d=i;d.status="fulfilled",d.value=c}},function(c){if(i.status==="pending"){var d=i;d.status="rejected",d.reason=c}})}switch(i.status){case"fulfilled":return i.value;case"rejected":throw s=i.reason,u_(s),s}throw Dl=i,kl}}var Dl=null;function c_(){if(Dl===null)throw Error(r(459));var s=Dl;return Dl=null,s}function u_(s){if(s===kl||s===Uu)throw Error(r(483))}var $r=!1;function Df(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function Mf(s,i){s=s.updateQueue,i.updateQueue===s&&(i.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,callbacks:null})}function Kr(s){return{lane:s,tag:0,payload:null,callback:null,next:null}}function Qr(s,i,o){var c=s.updateQueue;if(c===null)return null;if(c=c.shared,(dt&2)!==0){var d=c.pending;return d===null?i.next=i:(i.next=d.next,d.next=i),c.pending=i,i=ku(s),Wy(s,null,o),i}return Pu(s,c,i,o),ku(s)}function Ml(s,i,o){if(i=i.updateQueue,i!==null&&(i=i.shared,(o&4194048)!==0)){var c=i.lanes;c&=s.pendingLanes,o|=c,i.lanes=o,ll(s,o)}}function Of(s,i){var o=s.updateQueue,c=s.alternate;if(c!==null&&(c=c.updateQueue,o===c)){var d=null,m=null;if(o=o.firstBaseUpdate,o!==null){do{var b={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};m===null?d=m=b:m=m.next=b,o=o.next}while(o!==null);m===null?d=m=i:m=m.next=i}else d=m=i;o={baseState:c.baseState,firstBaseUpdate:d,lastBaseUpdate:m,shared:c.shared,callbacks:c.callbacks},s.updateQueue=o;return}s=o.lastBaseUpdate,s===null?o.firstBaseUpdate=i:s.next=i,o.lastBaseUpdate=i}var Lf=!1;function Ol(){if(Lf){var s=to;if(s!==null)throw s}}function Ll(s,i,o,c){Lf=!1;var d=s.updateQueue;$r=!1;var m=d.firstBaseUpdate,b=d.lastBaseUpdate,x=d.shared.pending;if(x!==null){d.shared.pending=null;var V=x,K=V.next;V.next=null,b===null?m=K:b.next=K,b=V;var se=s.alternate;se!==null&&(se=se.updateQueue,x=se.lastBaseUpdate,x!==b&&(x===null?se.firstBaseUpdate=K:x.next=K,se.lastBaseUpdate=V))}if(m!==null){var ae=d.baseState;b=0,se=K=V=null,x=m;do{var Q=x.lane&-536870913,Y=Q!==x.lane;if(Y?(Ze&Q)===Q:(c&Q)===Q){Q!==0&&Q===eo&&(Lf=!0),se!==null&&(se=se.next={lane:0,tag:x.tag,payload:x.payload,callback:null,next:null});e:{var Me=s,Ne=x;Q=i;var vt=o;switch(Ne.tag){case 1:if(Me=Ne.payload,typeof Me=="function"){ae=Me.call(vt,ae,Q);break e}ae=Me;break e;case 3:Me.flags=Me.flags&-65537|128;case 0:if(Me=Ne.payload,Q=typeof Me=="function"?Me.call(vt,ae,Q):Me,Q==null)break e;ae=y({},ae,Q);break e;case 2:$r=!0}}Q=x.callback,Q!==null&&(s.flags|=64,Y&&(s.flags|=8192),Y=d.callbacks,Y===null?d.callbacks=[Q]:Y.push(Q))}else Y={lane:Q,tag:x.tag,payload:x.payload,callback:x.callback,next:null},se===null?(K=se=Y,V=ae):se=se.next=Y,b|=Q;if(x=x.next,x===null){if(x=d.shared.pending,x===null)break;Y=x,x=Y.next,Y.next=null,d.lastBaseUpdate=Y,d.shared.pending=null}}while(!0);se===null&&(V=ae),d.baseState=V,d.firstBaseUpdate=K,d.lastBaseUpdate=se,m===null&&(d.shared.lanes=0),ni|=b,s.lanes=b,s.memoizedState=ae}}function h_(s,i){if(typeof s!="function")throw Error(r(191,s));s.call(i)}function d_(s,i){var o=s.callbacks;if(o!==null)for(s.callbacks=null,s=0;s<o.length;s++)h_(o[s],i)}var no=R(null),Bu=R(0);function f_(s,i){s=Sr,Z(Bu,s),Z(no,i),Sr=s|i.baseLanes}function Vf(){Z(Bu,Sr),Z(no,no.current)}function jf(){Sr=Bu.current,ee(no),ee(Bu)}var Yr=0,ze=null,yt=null,Bt=null,Fu=!1,so=!1,aa=!1,qu=0,Vl=0,ro=null,wx=0;function Lt(){throw Error(r(321))}function Uf(s,i){if(i===null)return!1;for(var o=0;o<i.length&&o<s.length;o++)if(!$n(s[o],i[o]))return!1;return!0}function zf(s,i,o,c,d,m){return Yr=m,ze=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,te.H=s===null||s.memoizedState===null?W_:X_,aa=!1,m=o(c,d),aa=!1,so&&(m=p_(i,o,c,d)),g_(s),m}function g_(s){te.H=Yu;var i=yt!==null&&yt.next!==null;if(Yr=0,Bt=yt=ze=null,Fu=!1,Vl=0,ro=null,i)throw Error(r(300));s===null||sn||(s=s.dependencies,s!==null&&Lu(s)&&(sn=!0))}function p_(s,i,o,c){ze=s;var d=0;do{if(so&&(ro=null),Vl=0,so=!1,25<=d)throw Error(r(301));if(d+=1,Bt=yt=null,s.updateQueue!=null){var m=s.updateQueue;m.lastEffect=null,m.events=null,m.stores=null,m.memoCache!=null&&(m.memoCache.index=0)}te.H=Ax,m=i(o,c)}while(so);return m}function Tx(){var s=te.H,i=s.useState()[0];return i=typeof i.then=="function"?jl(i):i,s=s.useState()[0],(yt!==null?yt.memoizedState:null)!==s&&(ze.flags|=1024),i}function Bf(){var s=qu!==0;return qu=0,s}function Ff(s,i,o){i.updateQueue=s.updateQueue,i.flags&=-2053,s.lanes&=~o}function qf(s){if(Fu){for(s=s.memoizedState;s!==null;){var i=s.queue;i!==null&&(i.pending=null),s=s.next}Fu=!1}Yr=0,Bt=yt=ze=null,so=!1,Vl=qu=0,ro=null}function zn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Bt===null?ze.memoizedState=Bt=s:Bt=Bt.next=s,Bt}function Ft(){if(yt===null){var s=ze.alternate;s=s!==null?s.memoizedState:null}else s=yt.next;var i=Bt===null?ze.memoizedState:Bt.next;if(i!==null)Bt=i,yt=s;else{if(s===null)throw ze.alternate===null?Error(r(467)):Error(r(310));yt=s,s={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},Bt===null?ze.memoizedState=Bt=s:Bt=Bt.next=s}return Bt}function Hf(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function jl(s){var i=Vl;return Vl+=1,ro===null&&(ro=[]),s=l_(ro,s,i),i=ze,(Bt===null?i.memoizedState:Bt.next)===null&&(i=i.alternate,te.H=i===null||i.memoizedState===null?W_:X_),s}function Hu(s){if(s!==null&&typeof s=="object"){if(typeof s.then=="function")return jl(s);if(s.$$typeof===U)return bn(s)}throw Error(r(438,String(s)))}function Gf(s){var i=null,o=ze.updateQueue;if(o!==null&&(i=o.memoCache),i==null){var c=ze.alternate;c!==null&&(c=c.updateQueue,c!==null&&(c=c.memoCache,c!=null&&(i={data:c.data.map(function(d){return d.slice()}),index:0})))}if(i==null&&(i={data:[],index:0}),o===null&&(o=Hf(),ze.updateQueue=o),o.memoCache=i,o=i.data[i.index],o===void 0)for(o=i.data[i.index]=Array(s),c=0;c<s;c++)o[c]=O;return i.index++,o}function _r(s,i){return typeof i=="function"?i(s):i}function Gu(s){var i=Ft();return $f(i,yt,s)}function $f(s,i,o){var c=s.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=o;var d=s.baseQueue,m=c.pending;if(m!==null){if(d!==null){var b=d.next;d.next=m.next,m.next=b}i.baseQueue=d=m,c.pending=null}if(m=s.baseState,d===null)s.memoizedState=m;else{i=d.next;var x=b=null,V=null,K=i,se=!1;do{var ae=K.lane&-536870913;if(ae!==K.lane?(Ze&ae)===ae:(Yr&ae)===ae){var Q=K.revertLane;if(Q===0)V!==null&&(V=V.next={lane:0,revertLane:0,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null}),ae===eo&&(se=!0);else if((Yr&Q)===Q){K=K.next,Q===eo&&(se=!0);continue}else ae={lane:0,revertLane:K.revertLane,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},V===null?(x=V=ae,b=m):V=V.next=ae,ze.lanes|=Q,ni|=Q;ae=K.action,aa&&o(m,ae),m=K.hasEagerState?K.eagerState:o(m,ae)}else Q={lane:ae,revertLane:K.revertLane,action:K.action,hasEagerState:K.hasEagerState,eagerState:K.eagerState,next:null},V===null?(x=V=Q,b=m):V=V.next=Q,ze.lanes|=ae,ni|=ae;K=K.next}while(K!==null&&K!==i);if(V===null?b=m:V.next=x,!$n(m,s.memoizedState)&&(sn=!0,se&&(o=to,o!==null)))throw o;s.memoizedState=m,s.baseState=b,s.baseQueue=V,c.lastRenderedState=m}return d===null&&(c.lanes=0),[s.memoizedState,c.dispatch]}function Kf(s){var i=Ft(),o=i.queue;if(o===null)throw Error(r(311));o.lastRenderedReducer=s;var c=o.dispatch,d=o.pending,m=i.memoizedState;if(d!==null){o.pending=null;var b=d=d.next;do m=s(m,b.action),b=b.next;while(b!==d);$n(m,i.memoizedState)||(sn=!0),i.memoizedState=m,i.baseQueue===null&&(i.baseState=m),o.lastRenderedState=m}return[m,c]}function m_(s,i,o){var c=ze,d=Ft(),m=ct;if(m){if(o===void 0)throw Error(r(407));o=o()}else o=i();var b=!$n((yt||d).memoizedState,o);b&&(d.memoizedState=o,sn=!0),d=d.queue;var x=v_.bind(null,c,d,s);if(Ul(2048,8,x,[s]),d.getSnapshot!==i||b||Bt!==null&&Bt.memoizedState.tag&1){if(c.flags|=2048,io(9,$u(),__.bind(null,c,d,o,i),null),St===null)throw Error(r(349));m||(Yr&124)!==0||y_(c,i,o)}return o}function y_(s,i,o){s.flags|=16384,s={getSnapshot:i,value:o},i=ze.updateQueue,i===null?(i=Hf(),ze.updateQueue=i,i.stores=[s]):(o=i.stores,o===null?i.stores=[s]:o.push(s))}function __(s,i,o,c){i.value=o,i.getSnapshot=c,w_(i)&&T_(s)}function v_(s,i,o){return o(function(){w_(i)&&T_(s)})}function w_(s){var i=s.getSnapshot;s=s.value;try{var o=i();return!$n(s,o)}catch{return!0}}function T_(s){var i=Wa(s,2);i!==null&&Zn(i,s,2)}function Qf(s){var i=zn();if(typeof s=="function"){var o=s;if(s=o(),aa){kn(!0);try{o()}finally{kn(!1)}}}return i.memoizedState=i.baseState=s,i.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:_r,lastRenderedState:s},i}function b_(s,i,o,c){return s.baseState=o,$f(s,yt,typeof c=="function"?c:_r)}function bx(s,i,o,c,d){if(Qu(s))throw Error(r(485));if(s=i.action,s!==null){var m={payload:d,action:s,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(b){m.listeners.push(b)}};te.T!==null?o(!0):m.isTransition=!1,c(m),o=i.pending,o===null?(m.next=i.pending=m,E_(i,m)):(m.next=o.next,i.pending=o.next=m)}}function E_(s,i){var o=i.action,c=i.payload,d=s.state;if(i.isTransition){var m=te.T,b={};te.T=b;try{var x=o(d,c),V=te.S;V!==null&&V(b,x),S_(s,i,x)}catch(K){Yf(s,i,K)}finally{te.T=m}}else try{m=o(d,c),S_(s,i,m)}catch(K){Yf(s,i,K)}}function S_(s,i,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(c){x_(s,i,c)},function(c){return Yf(s,i,c)}):x_(s,i,o)}function x_(s,i,o){i.status="fulfilled",i.value=o,C_(i),s.state=o,i=s.pending,i!==null&&(o=i.next,o===i?s.pending=null:(o=o.next,i.next=o,E_(s,o)))}function Yf(s,i,o){var c=s.pending;if(s.pending=null,c!==null){c=c.next;do i.status="rejected",i.reason=o,C_(i),i=i.next;while(i!==c)}s.action=null}function C_(s){s=s.listeners;for(var i=0;i<s.length;i++)(0,s[i])()}function A_(s,i){return i}function I_(s,i){if(ct){var o=St.formState;if(o!==null){e:{var c=ze;if(ct){if(Dt){t:{for(var d=Dt,m=Bs;d.nodeType!==8;){if(!m){d=null;break t}if(d=Es(d.nextSibling),d===null){d=null;break t}}m=d.data,d=m==="F!"||m==="F"?d:null}if(d){Dt=Es(d.nextSibling),c=d.data==="F!";break e}}na(c)}c=!1}c&&(i=o[0])}}return o=zn(),o.memoizedState=o.baseState=i,c={pending:null,lanes:0,dispatch:null,lastRenderedReducer:A_,lastRenderedState:i},o.queue=c,o=K_.bind(null,ze,c),c.dispatch=o,c=Qf(!1),m=eg.bind(null,ze,!1,c.queue),c=zn(),d={state:i,dispatch:null,action:s,pending:null},c.queue=d,o=bx.bind(null,ze,d,m,o),d.dispatch=o,c.memoizedState=s,[i,o,!1]}function R_(s){var i=Ft();return N_(i,yt,s)}function N_(s,i,o){if(i=$f(s,i,A_)[0],s=Gu(_r)[0],typeof i=="object"&&i!==null&&typeof i.then=="function")try{var c=jl(i)}catch(b){throw b===kl?Uu:b}else c=i;i=Ft();var d=i.queue,m=d.dispatch;return o!==i.memoizedState&&(ze.flags|=2048,io(9,$u(),Ex.bind(null,d,o),null)),[c,m,s]}function Ex(s,i){s.action=i}function P_(s){var i=Ft(),o=yt;if(o!==null)return N_(i,o,s);Ft(),i=i.memoizedState,o=Ft();var c=o.queue.dispatch;return o.memoizedState=s,[i,c,!1]}function io(s,i,o,c){return s={tag:s,create:o,deps:c,inst:i,next:null},i=ze.updateQueue,i===null&&(i=Hf(),ze.updateQueue=i),o=i.lastEffect,o===null?i.lastEffect=s.next=s:(c=o.next,o.next=s,s.next=c,i.lastEffect=s),s}function $u(){return{destroy:void 0,resource:void 0}}function k_(){return Ft().memoizedState}function Ku(s,i,o,c){var d=zn();c=c===void 0?null:c,ze.flags|=s,d.memoizedState=io(1|i,$u(),o,c)}function Ul(s,i,o,c){var d=Ft();c=c===void 0?null:c;var m=d.memoizedState.inst;yt!==null&&c!==null&&Uf(c,yt.memoizedState.deps)?d.memoizedState=io(i,m,o,c):(ze.flags|=s,d.memoizedState=io(1|i,m,o,c))}function D_(s,i){Ku(8390656,8,s,i)}function M_(s,i){Ul(2048,8,s,i)}function O_(s,i){return Ul(4,2,s,i)}function L_(s,i){return Ul(4,4,s,i)}function V_(s,i){if(typeof i=="function"){s=s();var o=i(s);return function(){typeof o=="function"?o():i(null)}}if(i!=null)return s=s(),i.current=s,function(){i.current=null}}function j_(s,i,o){o=o!=null?o.concat([s]):null,Ul(4,4,V_.bind(null,i,s),o)}function Wf(){}function U_(s,i){var o=Ft();i=i===void 0?null:i;var c=o.memoizedState;return i!==null&&Uf(i,c[1])?c[0]:(o.memoizedState=[s,i],s)}function z_(s,i){var o=Ft();i=i===void 0?null:i;var c=o.memoizedState;if(i!==null&&Uf(i,c[1]))return c[0];if(c=s(),aa){kn(!0);try{s()}finally{kn(!1)}}return o.memoizedState=[c,i],c}function Xf(s,i,o){return o===void 0||(Yr&1073741824)!==0?s.memoizedState=i:(s.memoizedState=o,s=qv(),ze.lanes|=s,ni|=s,o)}function B_(s,i,o,c){return $n(o,i)?o:no.current!==null?(s=Xf(s,o,c),$n(s,i)||(sn=!0),s):(Yr&42)===0?(sn=!0,s.memoizedState=o):(s=qv(),ze.lanes|=s,ni|=s,i)}function F_(s,i,o,c,d){var m=he.p;he.p=m!==0&&8>m?m:8;var b=te.T,x={};te.T=x,eg(s,!1,i,o);try{var V=d(),K=te.S;if(K!==null&&K(x,V),V!==null&&typeof V=="object"&&typeof V.then=="function"){var se=vx(V,c);zl(s,i,se,Xn(s))}else zl(s,i,c,Xn(s))}catch(ae){zl(s,i,{then:function(){},status:"rejected",reason:ae},Xn())}finally{he.p=m,te.T=b}}function Sx(){}function Zf(s,i,o,c){if(s.tag!==5)throw Error(r(476));var d=q_(s).queue;F_(s,d,i,ge,o===null?Sx:function(){return H_(s),o(c)})}function q_(s){var i=s.memoizedState;if(i!==null)return i;i={memoizedState:ge,baseState:ge,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_r,lastRenderedState:ge},next:null};var o={};return i.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:_r,lastRenderedState:o},next:null},s.memoizedState=i,s=s.alternate,s!==null&&(s.memoizedState=i),i}function H_(s){var i=q_(s).next.queue;zl(s,i,{},Xn())}function Jf(){return bn(rc)}function G_(){return Ft().memoizedState}function $_(){return Ft().memoizedState}function xx(s){for(var i=s.return;i!==null;){switch(i.tag){case 24:case 3:var o=Xn();s=Kr(o);var c=Qr(i,s,o);c!==null&&(Zn(c,i,o),Ml(c,i,o)),i={cache:Rf()},s.payload=i;return}i=i.return}}function Cx(s,i,o){var c=Xn();o={lane:c,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null},Qu(s)?Q_(i,o):(o=vf(s,i,o,c),o!==null&&(Zn(o,s,c),Y_(o,i,c)))}function K_(s,i,o){var c=Xn();zl(s,i,o,c)}function zl(s,i,o,c){var d={lane:c,revertLane:0,action:o,hasEagerState:!1,eagerState:null,next:null};if(Qu(s))Q_(i,d);else{var m=s.alternate;if(s.lanes===0&&(m===null||m.lanes===0)&&(m=i.lastRenderedReducer,m!==null))try{var b=i.lastRenderedState,x=m(b,o);if(d.hasEagerState=!0,d.eagerState=x,$n(x,b))return Pu(s,i,d,0),St===null&&Nu(),!1}catch{}finally{}if(o=vf(s,i,d,c),o!==null)return Zn(o,s,c),Y_(o,i,c),!0}return!1}function eg(s,i,o,c){if(c={lane:2,revertLane:kg(),action:c,hasEagerState:!1,eagerState:null,next:null},Qu(s)){if(i)throw Error(r(479))}else i=vf(s,o,c,2),i!==null&&Zn(i,s,2)}function Qu(s){var i=s.alternate;return s===ze||i!==null&&i===ze}function Q_(s,i){so=Fu=!0;var o=s.pending;o===null?i.next=i:(i.next=o.next,o.next=i),s.pending=i}function Y_(s,i,o){if((o&4194048)!==0){var c=i.lanes;c&=s.pendingLanes,o|=c,i.lanes=o,ll(s,o)}}var Yu={readContext:bn,use:Hu,useCallback:Lt,useContext:Lt,useEffect:Lt,useImperativeHandle:Lt,useLayoutEffect:Lt,useInsertionEffect:Lt,useMemo:Lt,useReducer:Lt,useRef:Lt,useState:Lt,useDebugValue:Lt,useDeferredValue:Lt,useTransition:Lt,useSyncExternalStore:Lt,useId:Lt,useHostTransitionStatus:Lt,useFormState:Lt,useActionState:Lt,useOptimistic:Lt,useMemoCache:Lt,useCacheRefresh:Lt},W_={readContext:bn,use:Hu,useCallback:function(s,i){return zn().memoizedState=[s,i===void 0?null:i],s},useContext:bn,useEffect:D_,useImperativeHandle:function(s,i,o){o=o!=null?o.concat([s]):null,Ku(4194308,4,V_.bind(null,i,s),o)},useLayoutEffect:function(s,i){return Ku(4194308,4,s,i)},useInsertionEffect:function(s,i){Ku(4,2,s,i)},useMemo:function(s,i){var o=zn();i=i===void 0?null:i;var c=s();if(aa){kn(!0);try{s()}finally{kn(!1)}}return o.memoizedState=[c,i],c},useReducer:function(s,i,o){var c=zn();if(o!==void 0){var d=o(i);if(aa){kn(!0);try{o(i)}finally{kn(!1)}}}else d=i;return c.memoizedState=c.baseState=d,s={pending:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:d},c.queue=s,s=s.dispatch=Cx.bind(null,ze,s),[c.memoizedState,s]},useRef:function(s){var i=zn();return s={current:s},i.memoizedState=s},useState:function(s){s=Qf(s);var i=s.queue,o=K_.bind(null,ze,i);return i.dispatch=o,[s.memoizedState,o]},useDebugValue:Wf,useDeferredValue:function(s,i){var o=zn();return Xf(o,s,i)},useTransition:function(){var s=Qf(!1);return s=F_.bind(null,ze,s.queue,!0,!1),zn().memoizedState=s,[!1,s]},useSyncExternalStore:function(s,i,o){var c=ze,d=zn();if(ct){if(o===void 0)throw Error(r(407));o=o()}else{if(o=i(),St===null)throw Error(r(349));(Ze&124)!==0||y_(c,i,o)}d.memoizedState=o;var m={value:o,getSnapshot:i};return d.queue=m,D_(v_.bind(null,c,m,s),[s]),c.flags|=2048,io(9,$u(),__.bind(null,c,m,o,i),null),o},useId:function(){var s=zn(),i=St.identifierPrefix;if(ct){var o=pr,c=gr;o=(c&~(1<<32-$t(c)-1)).toString(32)+o,i=""+i+"R"+o,o=qu++,0<o&&(i+="H"+o.toString(32)),i+=""}else o=wx++,i=""+i+"r"+o.toString(32)+"";return s.memoizedState=i},useHostTransitionStatus:Jf,useFormState:I_,useActionState:I_,useOptimistic:function(s){var i=zn();i.memoizedState=i.baseState=s;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return i.queue=o,i=eg.bind(null,ze,!0,o),o.dispatch=i,[s,i]},useMemoCache:Gf,useCacheRefresh:function(){return zn().memoizedState=xx.bind(null,ze)}},X_={readContext:bn,use:Hu,useCallback:U_,useContext:bn,useEffect:M_,useImperativeHandle:j_,useInsertionEffect:O_,useLayoutEffect:L_,useMemo:z_,useReducer:Gu,useRef:k_,useState:function(){return Gu(_r)},useDebugValue:Wf,useDeferredValue:function(s,i){var o=Ft();return B_(o,yt.memoizedState,s,i)},useTransition:function(){var s=Gu(_r)[0],i=Ft().memoizedState;return[typeof s=="boolean"?s:jl(s),i]},useSyncExternalStore:m_,useId:G_,useHostTransitionStatus:Jf,useFormState:R_,useActionState:R_,useOptimistic:function(s,i){var o=Ft();return b_(o,yt,s,i)},useMemoCache:Gf,useCacheRefresh:$_},Ax={readContext:bn,use:Hu,useCallback:U_,useContext:bn,useEffect:M_,useImperativeHandle:j_,useInsertionEffect:O_,useLayoutEffect:L_,useMemo:z_,useReducer:Kf,useRef:k_,useState:function(){return Kf(_r)},useDebugValue:Wf,useDeferredValue:function(s,i){var o=Ft();return yt===null?Xf(o,s,i):B_(o,yt.memoizedState,s,i)},useTransition:function(){var s=Kf(_r)[0],i=Ft().memoizedState;return[typeof s=="boolean"?s:jl(s),i]},useSyncExternalStore:m_,useId:G_,useHostTransitionStatus:Jf,useFormState:P_,useActionState:P_,useOptimistic:function(s,i){var o=Ft();return yt!==null?b_(o,yt,s,i):(o.baseState=s,[s,o.queue.dispatch])},useMemoCache:Gf,useCacheRefresh:$_},ao=null,Bl=0;function Wu(s){var i=Bl;return Bl+=1,ao===null&&(ao=[]),l_(ao,s,i)}function Fl(s,i){i=i.props.ref,s.ref=i!==void 0?i:null}function Xu(s,i){throw i.$$typeof===v?Error(r(525)):(s=Object.prototype.toString.call(i),Error(r(31,s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)))}function Z_(s){var i=s._init;return i(s._payload)}function J_(s){function i(H,F){if(s){var $=H.deletions;$===null?(H.deletions=[F],H.flags|=16):$.push(F)}}function o(H,F){if(!s)return null;for(;F!==null;)i(H,F),F=F.sibling;return null}function c(H){for(var F=new Map;H!==null;)H.key!==null?F.set(H.key,H):F.set(H.index,H),H=H.sibling;return F}function d(H,F){return H=fr(H,F),H.index=0,H.sibling=null,H}function m(H,F,$){return H.index=$,s?($=H.alternate,$!==null?($=$.index,$<F?(H.flags|=67108866,F):$):(H.flags|=67108866,F)):(H.flags|=1048576,F)}function b(H){return s&&H.alternate===null&&(H.flags|=67108866),H}function x(H,F,$,ie){return F===null||F.tag!==6?(F=Tf($,H.mode,ie),F.return=H,F):(F=d(F,$),F.return=H,F)}function V(H,F,$,ie){var be=$.type;return be===D?se(H,F,$.props.children,ie,$.key):F!==null&&(F.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===N&&Z_(be)===F.type)?(F=d(F,$.props),Fl(F,$),F.return=H,F):(F=Du($.type,$.key,$.props,null,H.mode,ie),Fl(F,$),F.return=H,F)}function K(H,F,$,ie){return F===null||F.tag!==4||F.stateNode.containerInfo!==$.containerInfo||F.stateNode.implementation!==$.implementation?(F=bf($,H.mode,ie),F.return=H,F):(F=d(F,$.children||[]),F.return=H,F)}function se(H,F,$,ie,be){return F===null||F.tag!==7?(F=Zi($,H.mode,ie,be),F.return=H,F):(F=d(F,$),F.return=H,F)}function ae(H,F,$){if(typeof F=="string"&&F!==""||typeof F=="number"||typeof F=="bigint")return F=Tf(""+F,H.mode,$),F.return=H,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case E:return $=Du(F.type,F.key,F.props,null,H.mode,$),Fl($,F),$.return=H,$;case S:return F=bf(F,H.mode,$),F.return=H,F;case N:var ie=F._init;return F=ie(F._payload),ae(H,F,$)}if(Ce(F)||q(F))return F=Zi(F,H.mode,$,null),F.return=H,F;if(typeof F.then=="function")return ae(H,Wu(F),$);if(F.$$typeof===U)return ae(H,Vu(H,F),$);Xu(H,F)}return null}function Q(H,F,$,ie){var be=F!==null?F.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return be!==null?null:x(H,F,""+$,ie);if(typeof $=="object"&&$!==null){switch($.$$typeof){case E:return $.key===be?V(H,F,$,ie):null;case S:return $.key===be?K(H,F,$,ie):null;case N:return be=$._init,$=be($._payload),Q(H,F,$,ie)}if(Ce($)||q($))return be!==null?null:se(H,F,$,ie,null);if(typeof $.then=="function")return Q(H,F,Wu($),ie);if($.$$typeof===U)return Q(H,F,Vu(H,$),ie);Xu(H,$)}return null}function Y(H,F,$,ie,be){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return H=H.get($)||null,x(F,H,""+ie,be);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case E:return H=H.get(ie.key===null?$:ie.key)||null,V(F,H,ie,be);case S:return H=H.get(ie.key===null?$:ie.key)||null,K(F,H,ie,be);case N:var Fe=ie._init;return ie=Fe(ie._payload),Y(H,F,$,ie,be)}if(Ce(ie)||q(ie))return H=H.get($)||null,se(F,H,ie,be,null);if(typeof ie.then=="function")return Y(H,F,$,Wu(ie),be);if(ie.$$typeof===U)return Y(H,F,$,Vu(F,ie),be);Xu(F,ie)}return null}function Me(H,F,$,ie){for(var be=null,Fe=null,xe=F,ke=F=0,an=null;xe!==null&&ke<$.length;ke++){xe.index>ke?(an=xe,xe=null):an=xe.sibling;var ot=Q(H,xe,$[ke],ie);if(ot===null){xe===null&&(xe=an);break}s&&xe&&ot.alternate===null&&i(H,xe),F=m(ot,F,ke),Fe===null?be=ot:Fe.sibling=ot,Fe=ot,xe=an}if(ke===$.length)return o(H,xe),ct&&ea(H,ke),be;if(xe===null){for(;ke<$.length;ke++)xe=ae(H,$[ke],ie),xe!==null&&(F=m(xe,F,ke),Fe===null?be=xe:Fe.sibling=xe,Fe=xe);return ct&&ea(H,ke),be}for(xe=c(xe);ke<$.length;ke++)an=Y(xe,H,ke,$[ke],ie),an!==null&&(s&&an.alternate!==null&&xe.delete(an.key===null?ke:an.key),F=m(an,F,ke),Fe===null?be=an:Fe.sibling=an,Fe=an);return s&&xe.forEach(function(hi){return i(H,hi)}),ct&&ea(H,ke),be}function Ne(H,F,$,ie){if($==null)throw Error(r(151));for(var be=null,Fe=null,xe=F,ke=F=0,an=null,ot=$.next();xe!==null&&!ot.done;ke++,ot=$.next()){xe.index>ke?(an=xe,xe=null):an=xe.sibling;var hi=Q(H,xe,ot.value,ie);if(hi===null){xe===null&&(xe=an);break}s&&xe&&hi.alternate===null&&i(H,xe),F=m(hi,F,ke),Fe===null?be=hi:Fe.sibling=hi,Fe=hi,xe=an}if(ot.done)return o(H,xe),ct&&ea(H,ke),be;if(xe===null){for(;!ot.done;ke++,ot=$.next())ot=ae(H,ot.value,ie),ot!==null&&(F=m(ot,F,ke),Fe===null?be=ot:Fe.sibling=ot,Fe=ot);return ct&&ea(H,ke),be}for(xe=c(xe);!ot.done;ke++,ot=$.next())ot=Y(xe,H,ke,ot.value,ie),ot!==null&&(s&&ot.alternate!==null&&xe.delete(ot.key===null?ke:ot.key),F=m(ot,F,ke),Fe===null?be=ot:Fe.sibling=ot,Fe=ot);return s&&xe.forEach(function(IC){return i(H,IC)}),ct&&ea(H,ke),be}function vt(H,F,$,ie){if(typeof $=="object"&&$!==null&&$.type===D&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case E:e:{for(var be=$.key;F!==null;){if(F.key===be){if(be=$.type,be===D){if(F.tag===7){o(H,F.sibling),ie=d(F,$.props.children),ie.return=H,H=ie;break e}}else if(F.elementType===be||typeof be=="object"&&be!==null&&be.$$typeof===N&&Z_(be)===F.type){o(H,F.sibling),ie=d(F,$.props),Fl(ie,$),ie.return=H,H=ie;break e}o(H,F);break}else i(H,F);F=F.sibling}$.type===D?(ie=Zi($.props.children,H.mode,ie,$.key),ie.return=H,H=ie):(ie=Du($.type,$.key,$.props,null,H.mode,ie),Fl(ie,$),ie.return=H,H=ie)}return b(H);case S:e:{for(be=$.key;F!==null;){if(F.key===be)if(F.tag===4&&F.stateNode.containerInfo===$.containerInfo&&F.stateNode.implementation===$.implementation){o(H,F.sibling),ie=d(F,$.children||[]),ie.return=H,H=ie;break e}else{o(H,F);break}else i(H,F);F=F.sibling}ie=bf($,H.mode,ie),ie.return=H,H=ie}return b(H);case N:return be=$._init,$=be($._payload),vt(H,F,$,ie)}if(Ce($))return Me(H,F,$,ie);if(q($)){if(be=q($),typeof be!="function")throw Error(r(150));return $=be.call($),Ne(H,F,$,ie)}if(typeof $.then=="function")return vt(H,F,Wu($),ie);if($.$$typeof===U)return vt(H,F,Vu(H,$),ie);Xu(H,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,F!==null&&F.tag===6?(o(H,F.sibling),ie=d(F,$),ie.return=H,H=ie):(o(H,F),ie=Tf($,H.mode,ie),ie.return=H,H=ie),b(H)):o(H,F)}return function(H,F,$,ie){try{Bl=0;var be=vt(H,F,$,ie);return ao=null,be}catch(xe){if(xe===kl||xe===Uu)throw xe;var Fe=Kn(29,xe,null,H.mode);return Fe.lanes=ie,Fe.return=H,Fe}finally{}}}var oo=J_(!0),ev=J_(!1),ds=R(null),Fs=null;function Wr(s){var i=s.alternate;Z(Xt,Xt.current&1),Z(ds,s),Fs===null&&(i===null||no.current!==null||i.memoizedState!==null)&&(Fs=s)}function tv(s){if(s.tag===22){if(Z(Xt,Xt.current),Z(ds,s),Fs===null){var i=s.alternate;i!==null&&i.memoizedState!==null&&(Fs=s)}}else Xr()}function Xr(){Z(Xt,Xt.current),Z(ds,ds.current)}function vr(s){ee(ds),Fs===s&&(Fs=null),ee(Xt)}var Xt=R(0);function Zu(s){for(var i=s;i!==null;){if(i.tag===13){var o=i.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||Hg(o)))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}function tg(s,i,o,c){i=s.memoizedState,o=o(c,i),o=o==null?i:y({},i,o),s.memoizedState=o,s.lanes===0&&(s.updateQueue.baseState=o)}var ng={enqueueSetState:function(s,i,o){s=s._reactInternals;var c=Xn(),d=Kr(c);d.payload=i,o!=null&&(d.callback=o),i=Qr(s,d,c),i!==null&&(Zn(i,s,c),Ml(i,s,c))},enqueueReplaceState:function(s,i,o){s=s._reactInternals;var c=Xn(),d=Kr(c);d.tag=1,d.payload=i,o!=null&&(d.callback=o),i=Qr(s,d,c),i!==null&&(Zn(i,s,c),Ml(i,s,c))},enqueueForceUpdate:function(s,i){s=s._reactInternals;var o=Xn(),c=Kr(o);c.tag=2,i!=null&&(c.callback=i),i=Qr(s,c,o),i!==null&&(Zn(i,s,o),Ml(i,s,o))}};function nv(s,i,o,c,d,m,b){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(c,m,b):i.prototype&&i.prototype.isPureReactComponent?!Sl(o,c)||!Sl(d,m):!0}function sv(s,i,o,c){s=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(o,c),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(o,c),i.state!==s&&ng.enqueueReplaceState(i,i.state,null)}function oa(s,i){var o=i;if("ref"in i){o={};for(var c in i)c!=="ref"&&(o[c]=i[c])}if(s=s.defaultProps){o===i&&(o=y({},o));for(var d in s)o[d]===void 0&&(o[d]=s[d])}return o}var Ju=typeof reportError=="function"?reportError:function(s){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var i=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof s=="object"&&s!==null&&typeof s.message=="string"?String(s.message):String(s),error:s});if(!window.dispatchEvent(i))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",s);return}console.error(s)};function rv(s){Ju(s)}function iv(s){console.error(s)}function av(s){Ju(s)}function eh(s,i){try{var o=s.onUncaughtError;o(i.value,{componentStack:i.stack})}catch(c){setTimeout(function(){throw c})}}function ov(s,i,o){try{var c=s.onCaughtError;c(o.value,{componentStack:o.stack,errorBoundary:i.tag===1?i.stateNode:null})}catch(d){setTimeout(function(){throw d})}}function sg(s,i,o){return o=Kr(o),o.tag=3,o.payload={element:null},o.callback=function(){eh(s,i)},o}function lv(s){return s=Kr(s),s.tag=3,s}function cv(s,i,o,c){var d=o.type.getDerivedStateFromError;if(typeof d=="function"){var m=c.value;s.payload=function(){return d(m)},s.callback=function(){ov(i,o,c)}}var b=o.stateNode;b!==null&&typeof b.componentDidCatch=="function"&&(s.callback=function(){ov(i,o,c),typeof d!="function"&&(si===null?si=new Set([this]):si.add(this));var x=c.stack;this.componentDidCatch(c.value,{componentStack:x!==null?x:""})})}function Ix(s,i,o,c,d){if(o.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){if(i=o.alternate,i!==null&&Rl(i,o,d,!0),o=ds.current,o!==null){switch(o.tag){case 13:return Fs===null?Ag():o.alternate===null&&Mt===0&&(Mt=3),o.flags&=-257,o.flags|=65536,o.lanes=d,c===kf?o.flags|=16384:(i=o.updateQueue,i===null?o.updateQueue=new Set([c]):i.add(c),Rg(s,c,d)),!1;case 22:return o.flags|=65536,c===kf?o.flags|=16384:(i=o.updateQueue,i===null?(i={transitions:null,markerInstances:null,retryQueue:new Set([c])},o.updateQueue=i):(o=i.retryQueue,o===null?i.retryQueue=new Set([c]):o.add(c)),Rg(s,c,d)),!1}throw Error(r(435,o.tag))}return Rg(s,c,d),Ag(),!1}if(ct)return i=ds.current,i!==null?((i.flags&65536)===0&&(i.flags|=256),i.flags|=65536,i.lanes=d,c!==xf&&(s=Error(r(422),{cause:c}),Il(ls(s,o)))):(c!==xf&&(i=Error(r(423),{cause:c}),Il(ls(i,o))),s=s.current.alternate,s.flags|=65536,d&=-d,s.lanes|=d,c=ls(c,o),d=sg(s.stateNode,c,d),Of(s,d),Mt!==4&&(Mt=2)),!1;var m=Error(r(520),{cause:c});if(m=ls(m,o),Yl===null?Yl=[m]:Yl.push(m),Mt!==4&&(Mt=2),i===null)return!0;c=ls(c,o),o=i;do{switch(o.tag){case 3:return o.flags|=65536,s=d&-d,o.lanes|=s,s=sg(o.stateNode,c,s),Of(o,s),!1;case 1:if(i=o.type,m=o.stateNode,(o.flags&128)===0&&(typeof i.getDerivedStateFromError=="function"||m!==null&&typeof m.componentDidCatch=="function"&&(si===null||!si.has(m))))return o.flags|=65536,d&=-d,o.lanes|=d,d=lv(d),cv(d,s,o,c),Of(o,d),!1}o=o.return}while(o!==null);return!1}var uv=Error(r(461)),sn=!1;function pn(s,i,o,c){i.child=s===null?ev(i,null,o,c):oo(i,s.child,o,c)}function hv(s,i,o,c,d){o=o.render;var m=i.ref;if("ref"in c){var b={};for(var x in c)x!=="ref"&&(b[x]=c[x])}else b=c;return ra(i),c=zf(s,i,o,b,m,d),x=Bf(),s!==null&&!sn?(Ff(s,i,d),wr(s,i,d)):(ct&&x&&Ef(i),i.flags|=1,pn(s,i,c,d),i.child)}function dv(s,i,o,c,d){if(s===null){var m=o.type;return typeof m=="function"&&!wf(m)&&m.defaultProps===void 0&&o.compare===null?(i.tag=15,i.type=m,fv(s,i,m,c,d)):(s=Du(o.type,null,c,i,i.mode,d),s.ref=i.ref,s.return=i,i.child=s)}if(m=s.child,!hg(s,d)){var b=m.memoizedProps;if(o=o.compare,o=o!==null?o:Sl,o(b,c)&&s.ref===i.ref)return wr(s,i,d)}return i.flags|=1,s=fr(m,c),s.ref=i.ref,s.return=i,i.child=s}function fv(s,i,o,c,d){if(s!==null){var m=s.memoizedProps;if(Sl(m,c)&&s.ref===i.ref)if(sn=!1,i.pendingProps=c=m,hg(s,d))(s.flags&131072)!==0&&(sn=!0);else return i.lanes=s.lanes,wr(s,i,d)}return rg(s,i,o,c,d)}function gv(s,i,o){var c=i.pendingProps,d=c.children,m=s!==null?s.memoizedState:null;if(c.mode==="hidden"){if((i.flags&128)!==0){if(c=m!==null?m.baseLanes|o:o,s!==null){for(d=i.child=s.child,m=0;d!==null;)m=m|d.lanes|d.childLanes,d=d.sibling;i.childLanes=m&~c}else i.childLanes=0,i.child=null;return pv(s,i,c,o)}if((o&536870912)!==0)i.memoizedState={baseLanes:0,cachePool:null},s!==null&&ju(i,m!==null?m.cachePool:null),m!==null?f_(i,m):Vf(),tv(i);else return i.lanes=i.childLanes=536870912,pv(s,i,m!==null?m.baseLanes|o:o,o)}else m!==null?(ju(i,m.cachePool),f_(i,m),Xr(),i.memoizedState=null):(s!==null&&ju(i,null),Vf(),Xr());return pn(s,i,d,o),i.child}function pv(s,i,o,c){var d=Pf();return d=d===null?null:{parent:Wt._currentValue,pool:d},i.memoizedState={baseLanes:o,cachePool:d},s!==null&&ju(i,null),Vf(),tv(i),s!==null&&Rl(s,i,c,!0),null}function th(s,i){var o=i.ref;if(o===null)s!==null&&s.ref!==null&&(i.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(r(284));(s===null||s.ref!==o)&&(i.flags|=4194816)}}function rg(s,i,o,c,d){return ra(i),o=zf(s,i,o,c,void 0,d),c=Bf(),s!==null&&!sn?(Ff(s,i,d),wr(s,i,d)):(ct&&c&&Ef(i),i.flags|=1,pn(s,i,o,d),i.child)}function mv(s,i,o,c,d,m){return ra(i),i.updateQueue=null,o=p_(i,c,o,d),g_(s),c=Bf(),s!==null&&!sn?(Ff(s,i,m),wr(s,i,m)):(ct&&c&&Ef(i),i.flags|=1,pn(s,i,o,m),i.child)}function yv(s,i,o,c,d){if(ra(i),i.stateNode===null){var m=Xa,b=o.contextType;typeof b=="object"&&b!==null&&(m=bn(b)),m=new o(c,m),i.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,m.updater=ng,i.stateNode=m,m._reactInternals=i,m=i.stateNode,m.props=c,m.state=i.memoizedState,m.refs={},Df(i),b=o.contextType,m.context=typeof b=="object"&&b!==null?bn(b):Xa,m.state=i.memoizedState,b=o.getDerivedStateFromProps,typeof b=="function"&&(tg(i,o,b,c),m.state=i.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(b=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),b!==m.state&&ng.enqueueReplaceState(m,m.state,null),Ll(i,c,m,d),Ol(),m.state=i.memoizedState),typeof m.componentDidMount=="function"&&(i.flags|=4194308),c=!0}else if(s===null){m=i.stateNode;var x=i.memoizedProps,V=oa(o,x);m.props=V;var K=m.context,se=o.contextType;b=Xa,typeof se=="object"&&se!==null&&(b=bn(se));var ae=o.getDerivedStateFromProps;se=typeof ae=="function"||typeof m.getSnapshotBeforeUpdate=="function",x=i.pendingProps!==x,se||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(x||K!==b)&&sv(i,m,c,b),$r=!1;var Q=i.memoizedState;m.state=Q,Ll(i,c,m,d),Ol(),K=i.memoizedState,x||Q!==K||$r?(typeof ae=="function"&&(tg(i,o,ae,c),K=i.memoizedState),(V=$r||nv(i,o,V,c,Q,K,b))?(se||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount()),typeof m.componentDidMount=="function"&&(i.flags|=4194308)):(typeof m.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=c,i.memoizedState=K),m.props=c,m.state=K,m.context=b,c=V):(typeof m.componentDidMount=="function"&&(i.flags|=4194308),c=!1)}else{m=i.stateNode,Mf(s,i),b=i.memoizedProps,se=oa(o,b),m.props=se,ae=i.pendingProps,Q=m.context,K=o.contextType,V=Xa,typeof K=="object"&&K!==null&&(V=bn(K)),x=o.getDerivedStateFromProps,(K=typeof x=="function"||typeof m.getSnapshotBeforeUpdate=="function")||typeof m.UNSAFE_componentWillReceiveProps!="function"&&typeof m.componentWillReceiveProps!="function"||(b!==ae||Q!==V)&&sv(i,m,c,V),$r=!1,Q=i.memoizedState,m.state=Q,Ll(i,c,m,d),Ol();var Y=i.memoizedState;b!==ae||Q!==Y||$r||s!==null&&s.dependencies!==null&&Lu(s.dependencies)?(typeof x=="function"&&(tg(i,o,x,c),Y=i.memoizedState),(se=$r||nv(i,o,se,c,Q,Y,V)||s!==null&&s.dependencies!==null&&Lu(s.dependencies))?(K||typeof m.UNSAFE_componentWillUpdate!="function"&&typeof m.componentWillUpdate!="function"||(typeof m.componentWillUpdate=="function"&&m.componentWillUpdate(c,Y,V),typeof m.UNSAFE_componentWillUpdate=="function"&&m.UNSAFE_componentWillUpdate(c,Y,V)),typeof m.componentDidUpdate=="function"&&(i.flags|=4),typeof m.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof m.componentDidUpdate!="function"||b===s.memoizedProps&&Q===s.memoizedState||(i.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===s.memoizedProps&&Q===s.memoizedState||(i.flags|=1024),i.memoizedProps=c,i.memoizedState=Y),m.props=c,m.state=Y,m.context=V,c=se):(typeof m.componentDidUpdate!="function"||b===s.memoizedProps&&Q===s.memoizedState||(i.flags|=4),typeof m.getSnapshotBeforeUpdate!="function"||b===s.memoizedProps&&Q===s.memoizedState||(i.flags|=1024),c=!1)}return m=c,th(s,i),c=(i.flags&128)!==0,m||c?(m=i.stateNode,o=c&&typeof o.getDerivedStateFromError!="function"?null:m.render(),i.flags|=1,s!==null&&c?(i.child=oo(i,s.child,null,d),i.child=oo(i,null,o,d)):pn(s,i,o,d),i.memoizedState=m.state,s=i.child):s=wr(s,i,d),s}function _v(s,i,o,c){return Al(),i.flags|=256,pn(s,i,o,c),i.child}var ig={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function ag(s){return{baseLanes:s,cachePool:i_()}}function og(s,i,o){return s=s!==null?s.childLanes&~o:0,i&&(s|=fs),s}function vv(s,i,o){var c=i.pendingProps,d=!1,m=(i.flags&128)!==0,b;if((b=m)||(b=s!==null&&s.memoizedState===null?!1:(Xt.current&2)!==0),b&&(d=!0,i.flags&=-129),b=(i.flags&32)!==0,i.flags&=-33,s===null){if(ct){if(d?Wr(i):Xr(),ct){var x=Dt,V;if(V=x){e:{for(V=x,x=Bs;V.nodeType!==8;){if(!x){x=null;break e}if(V=Es(V.nextSibling),V===null){x=null;break e}}x=V}x!==null?(i.memoizedState={dehydrated:x,treeContext:Ji!==null?{id:gr,overflow:pr}:null,retryLane:536870912,hydrationErrors:null},V=Kn(18,null,null,0),V.stateNode=x,V.return=i,i.child=V,Ln=i,Dt=null,V=!0):V=!1}V||na(i)}if(x=i.memoizedState,x!==null&&(x=x.dehydrated,x!==null))return Hg(x)?i.lanes=32:i.lanes=536870912,null;vr(i)}return x=c.children,c=c.fallback,d?(Xr(),d=i.mode,x=nh({mode:"hidden",children:x},d),c=Zi(c,d,o,null),x.return=i,c.return=i,x.sibling=c,i.child=x,d=i.child,d.memoizedState=ag(o),d.childLanes=og(s,b,o),i.memoizedState=ig,c):(Wr(i),lg(i,x))}if(V=s.memoizedState,V!==null&&(x=V.dehydrated,x!==null)){if(m)i.flags&256?(Wr(i),i.flags&=-257,i=cg(s,i,o)):i.memoizedState!==null?(Xr(),i.child=s.child,i.flags|=128,i=null):(Xr(),d=c.fallback,x=i.mode,c=nh({mode:"visible",children:c.children},x),d=Zi(d,x,o,null),d.flags|=2,c.return=i,d.return=i,c.sibling=d,i.child=c,oo(i,s.child,null,o),c=i.child,c.memoizedState=ag(o),c.childLanes=og(s,b,o),i.memoizedState=ig,i=d);else if(Wr(i),Hg(x)){if(b=x.nextSibling&&x.nextSibling.dataset,b)var K=b.dgst;b=K,c=Error(r(419)),c.stack="",c.digest=b,Il({value:c,source:null,stack:null}),i=cg(s,i,o)}else if(sn||Rl(s,i,o,!1),b=(o&s.childLanes)!==0,sn||b){if(b=St,b!==null&&(c=o&-o,c=(c&42)!==0?1:jr(c),c=(c&(b.suspendedLanes|o))!==0?0:c,c!==0&&c!==V.retryLane))throw V.retryLane=c,Wa(s,c),Zn(b,s,c),uv;x.data==="$?"||Ag(),i=cg(s,i,o)}else x.data==="$?"?(i.flags|=192,i.child=s.child,i=null):(s=V.treeContext,Dt=Es(x.nextSibling),Ln=i,ct=!0,ta=null,Bs=!1,s!==null&&(us[hs++]=gr,us[hs++]=pr,us[hs++]=Ji,gr=s.id,pr=s.overflow,Ji=i),i=lg(i,c.children),i.flags|=4096);return i}return d?(Xr(),d=c.fallback,x=i.mode,V=s.child,K=V.sibling,c=fr(V,{mode:"hidden",children:c.children}),c.subtreeFlags=V.subtreeFlags&65011712,K!==null?d=fr(K,d):(d=Zi(d,x,o,null),d.flags|=2),d.return=i,c.return=i,c.sibling=d,i.child=c,c=d,d=i.child,x=s.child.memoizedState,x===null?x=ag(o):(V=x.cachePool,V!==null?(K=Wt._currentValue,V=V.parent!==K?{parent:K,pool:K}:V):V=i_(),x={baseLanes:x.baseLanes|o,cachePool:V}),d.memoizedState=x,d.childLanes=og(s,b,o),i.memoizedState=ig,c):(Wr(i),o=s.child,s=o.sibling,o=fr(o,{mode:"visible",children:c.children}),o.return=i,o.sibling=null,s!==null&&(b=i.deletions,b===null?(i.deletions=[s],i.flags|=16):b.push(s)),i.child=o,i.memoizedState=null,o)}function lg(s,i){return i=nh({mode:"visible",children:i},s.mode),i.return=s,s.child=i}function nh(s,i){return s=Kn(22,s,null,i),s.lanes=0,s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},s}function cg(s,i,o){return oo(i,s.child,null,o),s=lg(i,i.pendingProps.children),s.flags|=2,i.memoizedState=null,s}function wv(s,i,o){s.lanes|=i;var c=s.alternate;c!==null&&(c.lanes|=i),Af(s.return,i,o)}function ug(s,i,o,c,d){var m=s.memoizedState;m===null?s.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:c,tail:o,tailMode:d}:(m.isBackwards=i,m.rendering=null,m.renderingStartTime=0,m.last=c,m.tail=o,m.tailMode=d)}function Tv(s,i,o){var c=i.pendingProps,d=c.revealOrder,m=c.tail;if(pn(s,i,c.children,o),c=Xt.current,(c&2)!==0)c=c&1|2,i.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=i.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&wv(s,o,i);else if(s.tag===19)wv(s,o,i);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break e;for(;s.sibling===null;){if(s.return===null||s.return===i)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}c&=1}switch(Z(Xt,c),d){case"forwards":for(o=i.child,d=null;o!==null;)s=o.alternate,s!==null&&Zu(s)===null&&(d=o),o=o.sibling;o=d,o===null?(d=i.child,i.child=null):(d=o.sibling,o.sibling=null),ug(i,!1,d,o,m);break;case"backwards":for(o=null,d=i.child,i.child=null;d!==null;){if(s=d.alternate,s!==null&&Zu(s)===null){i.child=d;break}s=d.sibling,d.sibling=o,o=d,d=s}ug(i,!0,o,null,m);break;case"together":ug(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function wr(s,i,o){if(s!==null&&(i.dependencies=s.dependencies),ni|=i.lanes,(o&i.childLanes)===0)if(s!==null){if(Rl(s,i,o,!1),(o&i.childLanes)===0)return null}else return null;if(s!==null&&i.child!==s.child)throw Error(r(153));if(i.child!==null){for(s=i.child,o=fr(s,s.pendingProps),i.child=o,o.return=i;s.sibling!==null;)s=s.sibling,o=o.sibling=fr(s,s.pendingProps),o.return=i;o.sibling=null}return i.child}function hg(s,i){return(s.lanes&i)!==0?!0:(s=s.dependencies,!!(s!==null&&Lu(s)))}function Rx(s,i,o){switch(i.tag){case 3:Te(i,i.stateNode.containerInfo),Gr(i,Wt,s.memoizedState.cache),Al();break;case 27:case 5:rt(i);break;case 4:Te(i,i.stateNode.containerInfo);break;case 10:Gr(i,i.type,i.memoizedProps.value);break;case 13:var c=i.memoizedState;if(c!==null)return c.dehydrated!==null?(Wr(i),i.flags|=128,null):(o&i.child.childLanes)!==0?vv(s,i,o):(Wr(i),s=wr(s,i,o),s!==null?s.sibling:null);Wr(i);break;case 19:var d=(s.flags&128)!==0;if(c=(o&i.childLanes)!==0,c||(Rl(s,i,o,!1),c=(o&i.childLanes)!==0),d){if(c)return Tv(s,i,o);i.flags|=128}if(d=i.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),Z(Xt,Xt.current),c)break;return null;case 22:case 23:return i.lanes=0,gv(s,i,o);case 24:Gr(i,Wt,s.memoizedState.cache)}return wr(s,i,o)}function bv(s,i,o){if(s!==null)if(s.memoizedProps!==i.pendingProps)sn=!0;else{if(!hg(s,o)&&(i.flags&128)===0)return sn=!1,Rx(s,i,o);sn=(s.flags&131072)!==0}else sn=!1,ct&&(i.flags&1048576)!==0&&Zy(i,Ou,i.index);switch(i.lanes=0,i.tag){case 16:e:{s=i.pendingProps;var c=i.elementType,d=c._init;if(c=d(c._payload),i.type=c,typeof c=="function")wf(c)?(s=oa(c,s),i.tag=1,i=yv(null,i,c,s,o)):(i.tag=0,i=rg(null,i,c,s,o));else{if(c!=null){if(d=c.$$typeof,d===W){i.tag=11,i=hv(null,i,c,s,o);break e}else if(d===M){i.tag=14,i=dv(null,i,c,s,o);break e}}throw i=je(c)||c,Error(r(306,i,""))}}return i;case 0:return rg(s,i,i.type,i.pendingProps,o);case 1:return c=i.type,d=oa(c,i.pendingProps),yv(s,i,c,d,o);case 3:e:{if(Te(i,i.stateNode.containerInfo),s===null)throw Error(r(387));c=i.pendingProps;var m=i.memoizedState;d=m.element,Mf(s,i),Ll(i,c,null,o);var b=i.memoizedState;if(c=b.cache,Gr(i,Wt,c),c!==m.cache&&If(i,[Wt],o,!0),Ol(),c=b.element,m.isDehydrated)if(m={element:c,isDehydrated:!1,cache:b.cache},i.updateQueue.baseState=m,i.memoizedState=m,i.flags&256){i=_v(s,i,c,o);break e}else if(c!==d){d=ls(Error(r(424)),i),Il(d),i=_v(s,i,c,o);break e}else{switch(s=i.stateNode.containerInfo,s.nodeType){case 9:s=s.body;break;default:s=s.nodeName==="HTML"?s.ownerDocument.body:s}for(Dt=Es(s.firstChild),Ln=i,ct=!0,ta=null,Bs=!0,o=ev(i,null,c,o),i.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling}else{if(Al(),c===d){i=wr(s,i,o);break e}pn(s,i,c,o)}i=i.child}return i;case 26:return th(s,i),s===null?(o=C0(i.type,null,i.pendingProps,null))?i.memoizedState=o:ct||(o=i.type,s=i.pendingProps,c=mh(de.current).createElement(o),c[Kt]=i,c[Ut]=s,yn(c,o,s),Ot(c),i.stateNode=c):i.memoizedState=C0(i.type,s.memoizedProps,i.pendingProps,s.memoizedState),null;case 27:return rt(i),s===null&&ct&&(c=i.stateNode=E0(i.type,i.pendingProps,de.current),Ln=i,Bs=!0,d=Dt,ai(i.type)?(Gg=d,Dt=Es(c.firstChild)):Dt=d),pn(s,i,i.pendingProps.children,o),th(s,i),s===null&&(i.flags|=4194304),i.child;case 5:return s===null&&ct&&((d=c=Dt)&&(c=sC(c,i.type,i.pendingProps,Bs),c!==null?(i.stateNode=c,Ln=i,Dt=Es(c.firstChild),Bs=!1,d=!0):d=!1),d||na(i)),rt(i),d=i.type,m=i.pendingProps,b=s!==null?s.memoizedProps:null,c=m.children,Bg(d,m)?c=null:b!==null&&Bg(d,b)&&(i.flags|=32),i.memoizedState!==null&&(d=zf(s,i,Tx,null,null,o),rc._currentValue=d),th(s,i),pn(s,i,c,o),i.child;case 6:return s===null&&ct&&((s=o=Dt)&&(o=rC(o,i.pendingProps,Bs),o!==null?(i.stateNode=o,Ln=i,Dt=null,s=!0):s=!1),s||na(i)),null;case 13:return vv(s,i,o);case 4:return Te(i,i.stateNode.containerInfo),c=i.pendingProps,s===null?i.child=oo(i,null,c,o):pn(s,i,c,o),i.child;case 11:return hv(s,i,i.type,i.pendingProps,o);case 7:return pn(s,i,i.pendingProps,o),i.child;case 8:return pn(s,i,i.pendingProps.children,o),i.child;case 12:return pn(s,i,i.pendingProps.children,o),i.child;case 10:return c=i.pendingProps,Gr(i,i.type,c.value),pn(s,i,c.children,o),i.child;case 9:return d=i.type._context,c=i.pendingProps.children,ra(i),d=bn(d),c=c(d),i.flags|=1,pn(s,i,c,o),i.child;case 14:return dv(s,i,i.type,i.pendingProps,o);case 15:return fv(s,i,i.type,i.pendingProps,o);case 19:return Tv(s,i,o);case 31:return c=i.pendingProps,o=i.mode,c={mode:c.mode,children:c.children},s===null?(o=nh(c,o),o.ref=i.ref,i.child=o,o.return=i,i=o):(o=fr(s.child,c),o.ref=i.ref,i.child=o,o.return=i,i=o),i;case 22:return gv(s,i,o);case 24:return ra(i),c=bn(Wt),s===null?(d=Pf(),d===null&&(d=St,m=Rf(),d.pooledCache=m,m.refCount++,m!==null&&(d.pooledCacheLanes|=o),d=m),i.memoizedState={parent:c,cache:d},Df(i),Gr(i,Wt,d)):((s.lanes&o)!==0&&(Mf(s,i),Ll(i,null,null,o),Ol()),d=s.memoizedState,m=i.memoizedState,d.parent!==c?(d={parent:c,cache:c},i.memoizedState=d,i.lanes===0&&(i.memoizedState=i.updateQueue.baseState=d),Gr(i,Wt,c)):(c=m.cache,Gr(i,Wt,c),c!==d.cache&&If(i,[Wt],o,!0))),pn(s,i,i.pendingProps.children,o),i.child;case 29:throw i.pendingProps}throw Error(r(156,i.tag))}function Tr(s){s.flags|=4}function Ev(s,i){if(i.type!=="stylesheet"||(i.state.loading&4)!==0)s.flags&=-16777217;else if(s.flags|=16777216,!P0(i)){if(i=ds.current,i!==null&&((Ze&4194048)===Ze?Fs!==null:(Ze&62914560)!==Ze&&(Ze&536870912)===0||i!==Fs))throw Dl=kf,a_;s.flags|=8192}}function sh(s,i){i!==null&&(s.flags|=4),s.flags&16384&&(i=s.tag!==22?al():536870912,s.lanes|=i,ho|=i)}function ql(s,i){if(!ct)switch(s.tailMode){case"hidden":i=s.tail;for(var o=null;i!==null;)i.alternate!==null&&(o=i),i=i.sibling;o===null?s.tail=null:o.sibling=null;break;case"collapsed":o=s.tail;for(var c=null;o!==null;)o.alternate!==null&&(c=o),o=o.sibling;c===null?i||s.tail===null?s.tail=null:s.tail.sibling=null:c.sibling=null}}function kt(s){var i=s.alternate!==null&&s.alternate.child===s.child,o=0,c=0;if(i)for(var d=s.child;d!==null;)o|=d.lanes|d.childLanes,c|=d.subtreeFlags&65011712,c|=d.flags&65011712,d.return=s,d=d.sibling;else for(d=s.child;d!==null;)o|=d.lanes|d.childLanes,c|=d.subtreeFlags,c|=d.flags,d.return=s,d=d.sibling;return s.subtreeFlags|=c,s.childLanes=o,i}function Nx(s,i,o){var c=i.pendingProps;switch(Sf(i),i.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kt(i),null;case 1:return kt(i),null;case 3:return o=i.stateNode,c=null,s!==null&&(c=s.memoizedState.cache),i.memoizedState.cache!==c&&(i.flags|=2048),yr(Wt),Ue(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(s===null||s.child===null)&&(Cl(i)?Tr(i):s===null||s.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,t_())),kt(i),null;case 26:return o=i.memoizedState,s===null?(Tr(i),o!==null?(kt(i),Ev(i,o)):(kt(i),i.flags&=-16777217)):o?o!==s.memoizedState?(Tr(i),kt(i),Ev(i,o)):(kt(i),i.flags&=-16777217):(s.memoizedProps!==c&&Tr(i),kt(i),i.flags&=-16777217),null;case 27:$e(i),o=de.current;var d=i.type;if(s!==null&&i.stateNode!=null)s.memoizedProps!==c&&Tr(i);else{if(!c){if(i.stateNode===null)throw Error(r(166));return kt(i),null}s=ue.current,Cl(i)?Jy(i):(s=E0(d,c,o),i.stateNode=s,Tr(i))}return kt(i),null;case 5:if($e(i),o=i.type,s!==null&&i.stateNode!=null)s.memoizedProps!==c&&Tr(i);else{if(!c){if(i.stateNode===null)throw Error(r(166));return kt(i),null}if(s=ue.current,Cl(i))Jy(i);else{switch(d=mh(de.current),s){case 1:s=d.createElementNS("http://www.w3.org/2000/svg",o);break;case 2:s=d.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;default:switch(o){case"svg":s=d.createElementNS("http://www.w3.org/2000/svg",o);break;case"math":s=d.createElementNS("http://www.w3.org/1998/Math/MathML",o);break;case"script":s=d.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s=typeof c.is=="string"?d.createElement("select",{is:c.is}):d.createElement("select"),c.multiple?s.multiple=!0:c.size&&(s.size=c.size);break;default:s=typeof c.is=="string"?d.createElement(o,{is:c.is}):d.createElement(o)}}s[Kt]=i,s[Ut]=c;e:for(d=i.child;d!==null;){if(d.tag===5||d.tag===6)s.appendChild(d.stateNode);else if(d.tag!==4&&d.tag!==27&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===i)break e;for(;d.sibling===null;){if(d.return===null||d.return===i)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}i.stateNode=s;e:switch(yn(s,o,c),o){case"button":case"input":case"select":case"textarea":s=!!c.autoFocus;break e;case"img":s=!0;break e;default:s=!1}s&&Tr(i)}}return kt(i),i.flags&=-16777217,null;case 6:if(s&&i.stateNode!=null)s.memoizedProps!==c&&Tr(i);else{if(typeof c!="string"&&i.stateNode===null)throw Error(r(166));if(s=de.current,Cl(i)){if(s=i.stateNode,o=i.memoizedProps,c=null,d=Ln,d!==null)switch(d.tag){case 27:case 5:c=d.memoizedProps}s[Kt]=i,s=!!(s.nodeValue===o||c!==null&&c.suppressHydrationWarning===!0||m0(s.nodeValue,o)),s||na(i)}else s=mh(s).createTextNode(c),s[Kt]=i,i.stateNode=s}return kt(i),null;case 13:if(c=i.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(d=Cl(i),c!==null&&c.dehydrated!==null){if(s===null){if(!d)throw Error(r(318));if(d=i.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(r(317));d[Kt]=i}else Al(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;kt(i),d=!1}else d=t_(),s!==null&&s.memoizedState!==null&&(s.memoizedState.hydrationErrors=d),d=!0;if(!d)return i.flags&256?(vr(i),i):(vr(i),null)}if(vr(i),(i.flags&128)!==0)return i.lanes=o,i;if(o=c!==null,s=s!==null&&s.memoizedState!==null,o){c=i.child,d=null,c.alternate!==null&&c.alternate.memoizedState!==null&&c.alternate.memoizedState.cachePool!==null&&(d=c.alternate.memoizedState.cachePool.pool);var m=null;c.memoizedState!==null&&c.memoizedState.cachePool!==null&&(m=c.memoizedState.cachePool.pool),m!==d&&(c.flags|=2048)}return o!==s&&o&&(i.child.flags|=8192),sh(i,i.updateQueue),kt(i),null;case 4:return Ue(),s===null&&Lg(i.stateNode.containerInfo),kt(i),null;case 10:return yr(i.type),kt(i),null;case 19:if(ee(Xt),d=i.memoizedState,d===null)return kt(i),null;if(c=(i.flags&128)!==0,m=d.rendering,m===null)if(c)ql(d,!1);else{if(Mt!==0||s!==null&&(s.flags&128)!==0)for(s=i.child;s!==null;){if(m=Zu(s),m!==null){for(i.flags|=128,ql(d,!1),s=m.updateQueue,i.updateQueue=s,sh(i,s),i.subtreeFlags=0,s=o,o=i.child;o!==null;)Xy(o,s),o=o.sibling;return Z(Xt,Xt.current&1|2),i.child}s=s.sibling}d.tail!==null&&ye()>ah&&(i.flags|=128,c=!0,ql(d,!1),i.lanes=4194304)}else{if(!c)if(s=Zu(m),s!==null){if(i.flags|=128,c=!0,s=s.updateQueue,i.updateQueue=s,sh(i,s),ql(d,!0),d.tail===null&&d.tailMode==="hidden"&&!m.alternate&&!ct)return kt(i),null}else 2*ye()-d.renderingStartTime>ah&&o!==536870912&&(i.flags|=128,c=!0,ql(d,!1),i.lanes=4194304);d.isBackwards?(m.sibling=i.child,i.child=m):(s=d.last,s!==null?s.sibling=m:i.child=m,d.last=m)}return d.tail!==null?(i=d.tail,d.rendering=i,d.tail=i.sibling,d.renderingStartTime=ye(),i.sibling=null,s=Xt.current,Z(Xt,c?s&1|2:s&1),i):(kt(i),null);case 22:case 23:return vr(i),jf(),c=i.memoizedState!==null,s!==null?s.memoizedState!==null!==c&&(i.flags|=8192):c&&(i.flags|=8192),c?(o&536870912)!==0&&(i.flags&128)===0&&(kt(i),i.subtreeFlags&6&&(i.flags|=8192)):kt(i),o=i.updateQueue,o!==null&&sh(i,o.retryQueue),o=null,s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(o=s.memoizedState.cachePool.pool),c=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(c=i.memoizedState.cachePool.pool),c!==o&&(i.flags|=2048),s!==null&&ee(ia),null;case 24:return o=null,s!==null&&(o=s.memoizedState.cache),i.memoizedState.cache!==o&&(i.flags|=2048),yr(Wt),kt(i),null;case 25:return null;case 30:return null}throw Error(r(156,i.tag))}function Px(s,i){switch(Sf(i),i.tag){case 1:return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 3:return yr(Wt),Ue(),s=i.flags,(s&65536)!==0&&(s&128)===0?(i.flags=s&-65537|128,i):null;case 26:case 27:case 5:return $e(i),null;case 13:if(vr(i),s=i.memoizedState,s!==null&&s.dehydrated!==null){if(i.alternate===null)throw Error(r(340));Al()}return s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 19:return ee(Xt),null;case 4:return Ue(),null;case 10:return yr(i.type),null;case 22:case 23:return vr(i),jf(),s!==null&&ee(ia),s=i.flags,s&65536?(i.flags=s&-65537|128,i):null;case 24:return yr(Wt),null;case 25:return null;default:return null}}function Sv(s,i){switch(Sf(i),i.tag){case 3:yr(Wt),Ue();break;case 26:case 27:case 5:$e(i);break;case 4:Ue();break;case 13:vr(i);break;case 19:ee(Xt);break;case 10:yr(i.type);break;case 22:case 23:vr(i),jf(),s!==null&&ee(ia);break;case 24:yr(Wt)}}function Hl(s,i){try{var o=i.updateQueue,c=o!==null?o.lastEffect:null;if(c!==null){var d=c.next;o=d;do{if((o.tag&s)===s){c=void 0;var m=o.create,b=o.inst;c=m(),b.destroy=c}o=o.next}while(o!==d)}}catch(x){bt(i,i.return,x)}}function Zr(s,i,o){try{var c=i.updateQueue,d=c!==null?c.lastEffect:null;if(d!==null){var m=d.next;c=m;do{if((c.tag&s)===s){var b=c.inst,x=b.destroy;if(x!==void 0){b.destroy=void 0,d=i;var V=o,K=x;try{K()}catch(se){bt(d,V,se)}}}c=c.next}while(c!==m)}}catch(se){bt(i,i.return,se)}}function xv(s){var i=s.updateQueue;if(i!==null){var o=s.stateNode;try{d_(i,o)}catch(c){bt(s,s.return,c)}}}function Cv(s,i,o){o.props=oa(s.type,s.memoizedProps),o.state=s.memoizedState;try{o.componentWillUnmount()}catch(c){bt(s,i,c)}}function Gl(s,i){try{var o=s.ref;if(o!==null){switch(s.tag){case 26:case 27:case 5:var c=s.stateNode;break;case 30:c=s.stateNode;break;default:c=s.stateNode}typeof o=="function"?s.refCleanup=o(c):o.current=c}}catch(d){bt(s,i,d)}}function qs(s,i){var o=s.ref,c=s.refCleanup;if(o!==null)if(typeof c=="function")try{c()}catch(d){bt(s,i,d)}finally{s.refCleanup=null,s=s.alternate,s!=null&&(s.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(d){bt(s,i,d)}else o.current=null}function Av(s){var i=s.type,o=s.memoizedProps,c=s.stateNode;try{e:switch(i){case"button":case"input":case"select":case"textarea":o.autoFocus&&c.focus();break e;case"img":o.src?c.src=o.src:o.srcSet&&(c.srcset=o.srcSet)}}catch(d){bt(s,s.return,d)}}function dg(s,i,o){try{var c=s.stateNode;Zx(c,s.type,o,i),c[Ut]=i}catch(d){bt(s,s.return,d)}}function Iv(s){return s.tag===5||s.tag===3||s.tag===26||s.tag===27&&ai(s.type)||s.tag===4}function fg(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||Iv(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.tag===27&&ai(s.type)||s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function gg(s,i,o){var c=s.tag;if(c===5||c===6)s=s.stateNode,i?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(s,i):(i=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,i.appendChild(s),o=o._reactRootContainer,o!=null||i.onclick!==null||(i.onclick=ph));else if(c!==4&&(c===27&&ai(s.type)&&(o=s.stateNode,i=null),s=s.child,s!==null))for(gg(s,i,o),s=s.sibling;s!==null;)gg(s,i,o),s=s.sibling}function rh(s,i,o){var c=s.tag;if(c===5||c===6)s=s.stateNode,i?o.insertBefore(s,i):o.appendChild(s);else if(c!==4&&(c===27&&ai(s.type)&&(o=s.stateNode),s=s.child,s!==null))for(rh(s,i,o),s=s.sibling;s!==null;)rh(s,i,o),s=s.sibling}function Rv(s){var i=s.stateNode,o=s.memoizedProps;try{for(var c=s.type,d=i.attributes;d.length;)i.removeAttributeNode(d[0]);yn(i,c,o),i[Kt]=s,i[Ut]=o}catch(m){bt(s,s.return,m)}}var br=!1,Vt=!1,pg=!1,Nv=typeof WeakSet=="function"?WeakSet:Set,rn=null;function kx(s,i){if(s=s.containerInfo,Ug=bh,s=By(s),ff(s)){if("selectionStart"in s)var o={start:s.selectionStart,end:s.selectionEnd};else e:{o=(o=s.ownerDocument)&&o.defaultView||window;var c=o.getSelection&&o.getSelection();if(c&&c.rangeCount!==0){o=c.anchorNode;var d=c.anchorOffset,m=c.focusNode;c=c.focusOffset;try{o.nodeType,m.nodeType}catch{o=null;break e}var b=0,x=-1,V=-1,K=0,se=0,ae=s,Q=null;t:for(;;){for(var Y;ae!==o||d!==0&&ae.nodeType!==3||(x=b+d),ae!==m||c!==0&&ae.nodeType!==3||(V=b+c),ae.nodeType===3&&(b+=ae.nodeValue.length),(Y=ae.firstChild)!==null;)Q=ae,ae=Y;for(;;){if(ae===s)break t;if(Q===o&&++K===d&&(x=b),Q===m&&++se===c&&(V=b),(Y=ae.nextSibling)!==null)break;ae=Q,Q=ae.parentNode}ae=Y}o=x===-1||V===-1?null:{start:x,end:V}}else o=null}o=o||{start:0,end:0}}else o=null;for(zg={focusedElem:s,selectionRange:o},bh=!1,rn=i;rn!==null;)if(i=rn,s=i.child,(i.subtreeFlags&1024)!==0&&s!==null)s.return=i,rn=s;else for(;rn!==null;){switch(i=rn,m=i.alternate,s=i.flags,i.tag){case 0:break;case 11:case 15:break;case 1:if((s&1024)!==0&&m!==null){s=void 0,o=i,d=m.memoizedProps,m=m.memoizedState,c=o.stateNode;try{var Me=oa(o.type,d,o.elementType===o.type);s=c.getSnapshotBeforeUpdate(Me,m),c.__reactInternalSnapshotBeforeUpdate=s}catch(Ne){bt(o,o.return,Ne)}}break;case 3:if((s&1024)!==0){if(s=i.stateNode.containerInfo,o=s.nodeType,o===9)qg(s);else if(o===1)switch(s.nodeName){case"HEAD":case"HTML":case"BODY":qg(s);break;default:s.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((s&1024)!==0)throw Error(r(163))}if(s=i.sibling,s!==null){s.return=i.return,rn=s;break}rn=i.return}}function Pv(s,i,o){var c=o.flags;switch(o.tag){case 0:case 11:case 15:Jr(s,o),c&4&&Hl(5,o);break;case 1:if(Jr(s,o),c&4)if(s=o.stateNode,i===null)try{s.componentDidMount()}catch(b){bt(o,o.return,b)}else{var d=oa(o.type,i.memoizedProps);i=i.memoizedState;try{s.componentDidUpdate(d,i,s.__reactInternalSnapshotBeforeUpdate)}catch(b){bt(o,o.return,b)}}c&64&&xv(o),c&512&&Gl(o,o.return);break;case 3:if(Jr(s,o),c&64&&(s=o.updateQueue,s!==null)){if(i=null,o.child!==null)switch(o.child.tag){case 27:case 5:i=o.child.stateNode;break;case 1:i=o.child.stateNode}try{d_(s,i)}catch(b){bt(o,o.return,b)}}break;case 27:i===null&&c&4&&Rv(o);case 26:case 5:Jr(s,o),i===null&&c&4&&Av(o),c&512&&Gl(o,o.return);break;case 12:Jr(s,o);break;case 13:Jr(s,o),c&4&&Mv(s,o),c&64&&(s=o.memoizedState,s!==null&&(s=s.dehydrated,s!==null&&(o=Bx.bind(null,o),iC(s,o))));break;case 22:if(c=o.memoizedState!==null||br,!c){i=i!==null&&i.memoizedState!==null||Vt,d=br;var m=Vt;br=c,(Vt=i)&&!m?ei(s,o,(o.subtreeFlags&8772)!==0):Jr(s,o),br=d,Vt=m}break;case 30:break;default:Jr(s,o)}}function kv(s){var i=s.alternate;i!==null&&(s.alternate=null,kv(i)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(i=s.stateNode,i!==null&&Br(i)),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}var Nt=null,Bn=!1;function Er(s,i,o){for(o=o.child;o!==null;)Dv(s,i,o),o=o.sibling}function Dv(s,i,o){if(lt&&typeof lt.onCommitFiberUnmount=="function")try{lt.onCommitFiberUnmount(xt,o)}catch{}switch(o.tag){case 26:Vt||qs(o,i),Er(s,i,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Vt||qs(o,i);var c=Nt,d=Bn;ai(o.type)&&(Nt=o.stateNode,Bn=!1),Er(s,i,o),ec(o.stateNode),Nt=c,Bn=d;break;case 5:Vt||qs(o,i);case 6:if(c=Nt,d=Bn,Nt=null,Er(s,i,o),Nt=c,Bn=d,Nt!==null)if(Bn)try{(Nt.nodeType===9?Nt.body:Nt.nodeName==="HTML"?Nt.ownerDocument.body:Nt).removeChild(o.stateNode)}catch(m){bt(o,i,m)}else try{Nt.removeChild(o.stateNode)}catch(m){bt(o,i,m)}break;case 18:Nt!==null&&(Bn?(s=Nt,T0(s.nodeType===9?s.body:s.nodeName==="HTML"?s.ownerDocument.body:s,o.stateNode),lc(s)):T0(Nt,o.stateNode));break;case 4:c=Nt,d=Bn,Nt=o.stateNode.containerInfo,Bn=!0,Er(s,i,o),Nt=c,Bn=d;break;case 0:case 11:case 14:case 15:Vt||Zr(2,o,i),Vt||Zr(4,o,i),Er(s,i,o);break;case 1:Vt||(qs(o,i),c=o.stateNode,typeof c.componentWillUnmount=="function"&&Cv(o,i,c)),Er(s,i,o);break;case 21:Er(s,i,o);break;case 22:Vt=(c=Vt)||o.memoizedState!==null,Er(s,i,o),Vt=c;break;default:Er(s,i,o)}}function Mv(s,i){if(i.memoizedState===null&&(s=i.alternate,s!==null&&(s=s.memoizedState,s!==null&&(s=s.dehydrated,s!==null))))try{lc(s)}catch(o){bt(i,i.return,o)}}function Dx(s){switch(s.tag){case 13:case 19:var i=s.stateNode;return i===null&&(i=s.stateNode=new Nv),i;case 22:return s=s.stateNode,i=s._retryCache,i===null&&(i=s._retryCache=new Nv),i;default:throw Error(r(435,s.tag))}}function mg(s,i){var o=Dx(s);i.forEach(function(c){var d=Fx.bind(null,s,c);o.has(c)||(o.add(c),c.then(d,d))})}function Qn(s,i){var o=i.deletions;if(o!==null)for(var c=0;c<o.length;c++){var d=o[c],m=s,b=i,x=b;e:for(;x!==null;){switch(x.tag){case 27:if(ai(x.type)){Nt=x.stateNode,Bn=!1;break e}break;case 5:Nt=x.stateNode,Bn=!1;break e;case 3:case 4:Nt=x.stateNode.containerInfo,Bn=!0;break e}x=x.return}if(Nt===null)throw Error(r(160));Dv(m,b,d),Nt=null,Bn=!1,m=d.alternate,m!==null&&(m.return=null),d.return=null}if(i.subtreeFlags&13878)for(i=i.child;i!==null;)Ov(i,s),i=i.sibling}var bs=null;function Ov(s,i){var o=s.alternate,c=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:Qn(i,s),Yn(s),c&4&&(Zr(3,s,s.return),Hl(3,s),Zr(5,s,s.return));break;case 1:Qn(i,s),Yn(s),c&512&&(Vt||o===null||qs(o,o.return)),c&64&&br&&(s=s.updateQueue,s!==null&&(c=s.callbacks,c!==null&&(o=s.shared.hiddenCallbacks,s.shared.hiddenCallbacks=o===null?c:o.concat(c))));break;case 26:var d=bs;if(Qn(i,s),Yn(s),c&512&&(Vt||o===null||qs(o,o.return)),c&4){var m=o!==null?o.memoizedState:null;if(c=s.memoizedState,o===null)if(c===null)if(s.stateNode===null){e:{c=s.type,o=s.memoizedProps,d=d.ownerDocument||d;t:switch(c){case"title":m=d.getElementsByTagName("title")[0],(!m||m[Li]||m[Kt]||m.namespaceURI==="http://www.w3.org/2000/svg"||m.hasAttribute("itemprop"))&&(m=d.createElement(c),d.head.insertBefore(m,d.querySelector("head > title"))),yn(m,c,o),m[Kt]=s,Ot(m),c=m;break e;case"link":var b=R0("link","href",d).get(c+(o.href||""));if(b){for(var x=0;x<b.length;x++)if(m=b[x],m.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&m.getAttribute("rel")===(o.rel==null?null:o.rel)&&m.getAttribute("title")===(o.title==null?null:o.title)&&m.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){b.splice(x,1);break t}}m=d.createElement(c),yn(m,c,o),d.head.appendChild(m);break;case"meta":if(b=R0("meta","content",d).get(c+(o.content||""))){for(x=0;x<b.length;x++)if(m=b[x],m.getAttribute("content")===(o.content==null?null:""+o.content)&&m.getAttribute("name")===(o.name==null?null:o.name)&&m.getAttribute("property")===(o.property==null?null:o.property)&&m.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&m.getAttribute("charset")===(o.charSet==null?null:o.charSet)){b.splice(x,1);break t}}m=d.createElement(c),yn(m,c,o),d.head.appendChild(m);break;default:throw Error(r(468,c))}m[Kt]=s,Ot(m),c=m}s.stateNode=c}else N0(d,s.type,s.stateNode);else s.stateNode=I0(d,c,s.memoizedProps);else m!==c?(m===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):m.count--,c===null?N0(d,s.type,s.stateNode):I0(d,c,s.memoizedProps)):c===null&&s.stateNode!==null&&dg(s,s.memoizedProps,o.memoizedProps)}break;case 27:Qn(i,s),Yn(s),c&512&&(Vt||o===null||qs(o,o.return)),o!==null&&c&4&&dg(s,s.memoizedProps,o.memoizedProps);break;case 5:if(Qn(i,s),Yn(s),c&512&&(Vt||o===null||qs(o,o.return)),s.flags&32){d=s.stateNode;try{rs(d,"")}catch(Y){bt(s,s.return,Y)}}c&4&&s.stateNode!=null&&(d=s.memoizedProps,dg(s,d,o!==null?o.memoizedProps:d)),c&1024&&(pg=!0);break;case 6:if(Qn(i,s),Yn(s),c&4){if(s.stateNode===null)throw Error(r(162));c=s.memoizedProps,o=s.stateNode;try{o.nodeValue=c}catch(Y){bt(s,s.return,Y)}}break;case 3:if(vh=null,d=bs,bs=yh(i.containerInfo),Qn(i,s),bs=d,Yn(s),c&4&&o!==null&&o.memoizedState.isDehydrated)try{lc(i.containerInfo)}catch(Y){bt(s,s.return,Y)}pg&&(pg=!1,Lv(s));break;case 4:c=bs,bs=yh(s.stateNode.containerInfo),Qn(i,s),Yn(s),bs=c;break;case 12:Qn(i,s),Yn(s);break;case 13:Qn(i,s),Yn(s),s.child.flags&8192&&s.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(bg=ye()),c&4&&(c=s.updateQueue,c!==null&&(s.updateQueue=null,mg(s,c)));break;case 22:d=s.memoizedState!==null;var V=o!==null&&o.memoizedState!==null,K=br,se=Vt;if(br=K||d,Vt=se||V,Qn(i,s),Vt=se,br=K,Yn(s),c&8192)e:for(i=s.stateNode,i._visibility=d?i._visibility&-2:i._visibility|1,d&&(o===null||V||br||Vt||la(s)),o=null,i=s;;){if(i.tag===5||i.tag===26){if(o===null){V=o=i;try{if(m=V.stateNode,d)b=m.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none";else{x=V.stateNode;var ae=V.memoizedProps.style,Q=ae!=null&&ae.hasOwnProperty("display")?ae.display:null;x.style.display=Q==null||typeof Q=="boolean"?"":(""+Q).trim()}}catch(Y){bt(V,V.return,Y)}}}else if(i.tag===6){if(o===null){V=i;try{V.stateNode.nodeValue=d?"":V.memoizedProps}catch(Y){bt(V,V.return,Y)}}}else if((i.tag!==22&&i.tag!==23||i.memoizedState===null||i===s)&&i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;o===i&&(o=null),i=i.return}o===i&&(o=null),i.sibling.return=i.return,i=i.sibling}c&4&&(c=s.updateQueue,c!==null&&(o=c.retryQueue,o!==null&&(c.retryQueue=null,mg(s,o))));break;case 19:Qn(i,s),Yn(s),c&4&&(c=s.updateQueue,c!==null&&(s.updateQueue=null,mg(s,c)));break;case 30:break;case 21:break;default:Qn(i,s),Yn(s)}}function Yn(s){var i=s.flags;if(i&2){try{for(var o,c=s.return;c!==null;){if(Iv(c)){o=c;break}c=c.return}if(o==null)throw Error(r(160));switch(o.tag){case 27:var d=o.stateNode,m=fg(s);rh(s,m,d);break;case 5:var b=o.stateNode;o.flags&32&&(rs(b,""),o.flags&=-33);var x=fg(s);rh(s,x,b);break;case 3:case 4:var V=o.stateNode.containerInfo,K=fg(s);gg(s,K,V);break;default:throw Error(r(161))}}catch(se){bt(s,s.return,se)}s.flags&=-3}i&4096&&(s.flags&=-4097)}function Lv(s){if(s.subtreeFlags&1024)for(s=s.child;s!==null;){var i=s;Lv(i),i.tag===5&&i.flags&1024&&i.stateNode.reset(),s=s.sibling}}function Jr(s,i){if(i.subtreeFlags&8772)for(i=i.child;i!==null;)Pv(s,i.alternate,i),i=i.sibling}function la(s){for(s=s.child;s!==null;){var i=s;switch(i.tag){case 0:case 11:case 14:case 15:Zr(4,i,i.return),la(i);break;case 1:qs(i,i.return);var o=i.stateNode;typeof o.componentWillUnmount=="function"&&Cv(i,i.return,o),la(i);break;case 27:ec(i.stateNode);case 26:case 5:qs(i,i.return),la(i);break;case 22:i.memoizedState===null&&la(i);break;case 30:la(i);break;default:la(i)}s=s.sibling}}function ei(s,i,o){for(o=o&&(i.subtreeFlags&8772)!==0,i=i.child;i!==null;){var c=i.alternate,d=s,m=i,b=m.flags;switch(m.tag){case 0:case 11:case 15:ei(d,m,o),Hl(4,m);break;case 1:if(ei(d,m,o),c=m,d=c.stateNode,typeof d.componentDidMount=="function")try{d.componentDidMount()}catch(K){bt(c,c.return,K)}if(c=m,d=c.updateQueue,d!==null){var x=c.stateNode;try{var V=d.shared.hiddenCallbacks;if(V!==null)for(d.shared.hiddenCallbacks=null,d=0;d<V.length;d++)h_(V[d],x)}catch(K){bt(c,c.return,K)}}o&&b&64&&xv(m),Gl(m,m.return);break;case 27:Rv(m);case 26:case 5:ei(d,m,o),o&&c===null&&b&4&&Av(m),Gl(m,m.return);break;case 12:ei(d,m,o);break;case 13:ei(d,m,o),o&&b&4&&Mv(d,m);break;case 22:m.memoizedState===null&&ei(d,m,o),Gl(m,m.return);break;case 30:break;default:ei(d,m,o)}i=i.sibling}}function yg(s,i){var o=null;s!==null&&s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(o=s.memoizedState.cachePool.pool),s=null,i.memoizedState!==null&&i.memoizedState.cachePool!==null&&(s=i.memoizedState.cachePool.pool),s!==o&&(s!=null&&s.refCount++,o!=null&&Nl(o))}function _g(s,i){s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Nl(s))}function Hs(s,i,o,c){if(i.subtreeFlags&10256)for(i=i.child;i!==null;)Vv(s,i,o,c),i=i.sibling}function Vv(s,i,o,c){var d=i.flags;switch(i.tag){case 0:case 11:case 15:Hs(s,i,o,c),d&2048&&Hl(9,i);break;case 1:Hs(s,i,o,c);break;case 3:Hs(s,i,o,c),d&2048&&(s=null,i.alternate!==null&&(s=i.alternate.memoizedState.cache),i=i.memoizedState.cache,i!==s&&(i.refCount++,s!=null&&Nl(s)));break;case 12:if(d&2048){Hs(s,i,o,c),s=i.stateNode;try{var m=i.memoizedProps,b=m.id,x=m.onPostCommit;typeof x=="function"&&x(b,i.alternate===null?"mount":"update",s.passiveEffectDuration,-0)}catch(V){bt(i,i.return,V)}}else Hs(s,i,o,c);break;case 13:Hs(s,i,o,c);break;case 23:break;case 22:m=i.stateNode,b=i.alternate,i.memoizedState!==null?m._visibility&2?Hs(s,i,o,c):$l(s,i):m._visibility&2?Hs(s,i,o,c):(m._visibility|=2,lo(s,i,o,c,(i.subtreeFlags&10256)!==0)),d&2048&&yg(b,i);break;case 24:Hs(s,i,o,c),d&2048&&_g(i.alternate,i);break;default:Hs(s,i,o,c)}}function lo(s,i,o,c,d){for(d=d&&(i.subtreeFlags&10256)!==0,i=i.child;i!==null;){var m=s,b=i,x=o,V=c,K=b.flags;switch(b.tag){case 0:case 11:case 15:lo(m,b,x,V,d),Hl(8,b);break;case 23:break;case 22:var se=b.stateNode;b.memoizedState!==null?se._visibility&2?lo(m,b,x,V,d):$l(m,b):(se._visibility|=2,lo(m,b,x,V,d)),d&&K&2048&&yg(b.alternate,b);break;case 24:lo(m,b,x,V,d),d&&K&2048&&_g(b.alternate,b);break;default:lo(m,b,x,V,d)}i=i.sibling}}function $l(s,i){if(i.subtreeFlags&10256)for(i=i.child;i!==null;){var o=s,c=i,d=c.flags;switch(c.tag){case 22:$l(o,c),d&2048&&yg(c.alternate,c);break;case 24:$l(o,c),d&2048&&_g(c.alternate,c);break;default:$l(o,c)}i=i.sibling}}var Kl=8192;function co(s){if(s.subtreeFlags&Kl)for(s=s.child;s!==null;)jv(s),s=s.sibling}function jv(s){switch(s.tag){case 26:co(s),s.flags&Kl&&s.memoizedState!==null&&_C(bs,s.memoizedState,s.memoizedProps);break;case 5:co(s);break;case 3:case 4:var i=bs;bs=yh(s.stateNode.containerInfo),co(s),bs=i;break;case 22:s.memoizedState===null&&(i=s.alternate,i!==null&&i.memoizedState!==null?(i=Kl,Kl=16777216,co(s),Kl=i):co(s));break;default:co(s)}}function Uv(s){var i=s.alternate;if(i!==null&&(s=i.child,s!==null)){i.child=null;do i=s.sibling,s.sibling=null,s=i;while(s!==null)}}function Ql(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var c=i[o];rn=c,Bv(c,s)}Uv(s)}if(s.subtreeFlags&10256)for(s=s.child;s!==null;)zv(s),s=s.sibling}function zv(s){switch(s.tag){case 0:case 11:case 15:Ql(s),s.flags&2048&&Zr(9,s,s.return);break;case 3:Ql(s);break;case 12:Ql(s);break;case 22:var i=s.stateNode;s.memoizedState!==null&&i._visibility&2&&(s.return===null||s.return.tag!==13)?(i._visibility&=-3,ih(s)):Ql(s);break;default:Ql(s)}}function ih(s){var i=s.deletions;if((s.flags&16)!==0){if(i!==null)for(var o=0;o<i.length;o++){var c=i[o];rn=c,Bv(c,s)}Uv(s)}for(s=s.child;s!==null;){switch(i=s,i.tag){case 0:case 11:case 15:Zr(8,i,i.return),ih(i);break;case 22:o=i.stateNode,o._visibility&2&&(o._visibility&=-3,ih(i));break;default:ih(i)}s=s.sibling}}function Bv(s,i){for(;rn!==null;){var o=rn;switch(o.tag){case 0:case 11:case 15:Zr(8,o,i);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var c=o.memoizedState.cachePool.pool;c!=null&&c.refCount++}break;case 24:Nl(o.memoizedState.cache)}if(c=o.child,c!==null)c.return=o,rn=c;else e:for(o=s;rn!==null;){c=rn;var d=c.sibling,m=c.return;if(kv(c),c===o){rn=null;break e}if(d!==null){d.return=m,rn=d;break e}rn=m}}}var Mx={getCacheForType:function(s){var i=bn(Wt),o=i.data.get(s);return o===void 0&&(o=s(),i.data.set(s,o)),o}},Ox=typeof WeakMap=="function"?WeakMap:Map,dt=0,St=null,qe=null,Ze=0,ft=0,Wn=null,ti=!1,uo=!1,vg=!1,Sr=0,Mt=0,ni=0,ca=0,wg=0,fs=0,ho=0,Yl=null,Fn=null,Tg=!1,bg=0,ah=1/0,oh=null,si=null,mn=0,ri=null,fo=null,go=0,Eg=0,Sg=null,Fv=null,Wl=0,xg=null;function Xn(){if((dt&2)!==0&&Ze!==0)return Ze&-Ze;if(te.T!==null){var s=eo;return s!==0?s:kg()}return Ur()}function qv(){fs===0&&(fs=(Ze&536870912)===0||ct?il():536870912);var s=ds.current;return s!==null&&(s.flags|=32),fs}function Zn(s,i,o){(s===St&&(ft===2||ft===9)||s.cancelPendingCommit!==null)&&(po(s,0),ii(s,Ze,fs,!1)),nr(s,o),((dt&2)===0||s!==St)&&(s===St&&((dt&2)===0&&(ca|=o),Mt===4&&ii(s,Ze,fs,!1)),Gs(s))}function Hv(s,i,o){if((dt&6)!==0)throw Error(r(327));var c=!o&&(i&124)===0&&(i&s.expiredLanes)===0||Oi(s,i),d=c?jx(s,i):Ig(s,i,!0),m=c;do{if(d===0){uo&&!c&&ii(s,i,0,!1);break}else{if(o=s.current.alternate,m&&!Lx(o)){d=Ig(s,i,!1),m=!1;continue}if(d===2){if(m=i,s.errorRecoveryDisabledLanes&m)var b=0;else b=s.pendingLanes&-536870913,b=b!==0?b:b&536870912?536870912:0;if(b!==0){i=b;e:{var x=s;d=Yl;var V=x.current.memoizedState.isDehydrated;if(V&&(po(x,b).flags|=256),b=Ig(x,b,!1),b!==2){if(vg&&!V){x.errorRecoveryDisabledLanes|=m,ca|=m,d=4;break e}m=Fn,Fn=d,m!==null&&(Fn===null?Fn=m:Fn.push.apply(Fn,m))}d=b}if(m=!1,d!==2)continue}}if(d===1){po(s,0),ii(s,i,0,!0);break}e:{switch(c=s,m=d,m){case 0:case 1:throw Error(r(345));case 4:if((i&4194048)!==i)break;case 6:ii(c,i,fs,!ti);break e;case 2:Fn=null;break;case 3:case 5:break;default:throw Error(r(329))}if((i&62914560)===i&&(d=bg+300-ye(),10<d)){if(ii(c,i,fs,!ti),Pa(c,0,!0)!==0)break e;c.timeoutHandle=v0(Gv.bind(null,c,o,Fn,oh,Tg,i,fs,ca,ho,ti,m,2,-0,0),d);break e}Gv(c,o,Fn,oh,Tg,i,fs,ca,ho,ti,m,0,-0,0)}}break}while(!0);Gs(s)}function Gv(s,i,o,c,d,m,b,x,V,K,se,ae,Q,Y){if(s.timeoutHandle=-1,ae=i.subtreeFlags,(ae&8192||(ae&16785408)===16785408)&&(sc={stylesheets:null,count:0,unsuspend:yC},jv(i),ae=vC(),ae!==null)){s.cancelPendingCommit=ae(Zv.bind(null,s,i,m,o,c,d,b,x,V,se,1,Q,Y)),ii(s,m,b,!K);return}Zv(s,i,m,o,c,d,b,x,V)}function Lx(s){for(var i=s;;){var o=i.tag;if((o===0||o===11||o===15)&&i.flags&16384&&(o=i.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var c=0;c<o.length;c++){var d=o[c],m=d.getSnapshot;d=d.value;try{if(!$n(m(),d))return!1}catch{return!1}}if(o=i.child,i.subtreeFlags&16384&&o!==null)o.return=i,i=o;else{if(i===s)break;for(;i.sibling===null;){if(i.return===null||i.return===s)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ii(s,i,o,c){i&=~wg,i&=~ca,s.suspendedLanes|=i,s.pingedLanes&=~i,c&&(s.warmLanes|=i),c=s.expirationTimes;for(var d=i;0<d;){var m=31-$t(d),b=1<<m;c[m]=-1,d&=~b}o!==0&&Ns(s,o,i)}function lh(){return(dt&6)===0?(Xl(0),!1):!0}function Cg(){if(qe!==null){if(ft===0)var s=qe.return;else s=qe,mr=sa=null,qf(s),ao=null,Bl=0,s=qe;for(;s!==null;)Sv(s.alternate,s),s=s.return;qe=null}}function po(s,i){var o=s.timeoutHandle;o!==-1&&(s.timeoutHandle=-1,eC(o)),o=s.cancelPendingCommit,o!==null&&(s.cancelPendingCommit=null,o()),Cg(),St=s,qe=o=fr(s.current,null),Ze=i,ft=0,Wn=null,ti=!1,uo=Oi(s,i),vg=!1,ho=fs=wg=ca=ni=Mt=0,Fn=Yl=null,Tg=!1,(i&8)!==0&&(i|=i&32);var c=s.entangledLanes;if(c!==0)for(s=s.entanglements,c&=i;0<c;){var d=31-$t(c),m=1<<d;i|=s[d],c&=~m}return Sr=i,Nu(),o}function $v(s,i){ze=null,te.H=Yu,i===kl||i===Uu?(i=c_(),ft=3):i===a_?(i=c_(),ft=4):ft=i===uv?8:i!==null&&typeof i=="object"&&typeof i.then=="function"?6:1,Wn=i,qe===null&&(Mt=1,eh(s,ls(i,s.current)))}function Kv(){var s=te.H;return te.H=Yu,s===null?Yu:s}function Qv(){var s=te.A;return te.A=Mx,s}function Ag(){Mt=4,ti||(Ze&4194048)!==Ze&&ds.current!==null||(uo=!0),(ni&134217727)===0&&(ca&134217727)===0||St===null||ii(St,Ze,fs,!1)}function Ig(s,i,o){var c=dt;dt|=2;var d=Kv(),m=Qv();(St!==s||Ze!==i)&&(oh=null,po(s,i)),i=!1;var b=Mt;e:do try{if(ft!==0&&qe!==null){var x=qe,V=Wn;switch(ft){case 8:Cg(),b=6;break e;case 3:case 2:case 9:case 6:ds.current===null&&(i=!0);var K=ft;if(ft=0,Wn=null,mo(s,x,V,K),o&&uo){b=0;break e}break;default:K=ft,ft=0,Wn=null,mo(s,x,V,K)}}Vx(),b=Mt;break}catch(se){$v(s,se)}while(!0);return i&&s.shellSuspendCounter++,mr=sa=null,dt=c,te.H=d,te.A=m,qe===null&&(St=null,Ze=0,Nu()),b}function Vx(){for(;qe!==null;)Yv(qe)}function jx(s,i){var o=dt;dt|=2;var c=Kv(),d=Qv();St!==s||Ze!==i?(oh=null,ah=ye()+500,po(s,i)):uo=Oi(s,i);e:do try{if(ft!==0&&qe!==null){i=qe;var m=Wn;t:switch(ft){case 1:ft=0,Wn=null,mo(s,i,m,1);break;case 2:case 9:if(o_(m)){ft=0,Wn=null,Wv(i);break}i=function(){ft!==2&&ft!==9||St!==s||(ft=7),Gs(s)},m.then(i,i);break e;case 3:ft=7;break e;case 4:ft=5;break e;case 7:o_(m)?(ft=0,Wn=null,Wv(i)):(ft=0,Wn=null,mo(s,i,m,7));break;case 5:var b=null;switch(qe.tag){case 26:b=qe.memoizedState;case 5:case 27:var x=qe;if(!b||P0(b)){ft=0,Wn=null;var V=x.sibling;if(V!==null)qe=V;else{var K=x.return;K!==null?(qe=K,ch(K)):qe=null}break t}}ft=0,Wn=null,mo(s,i,m,5);break;case 6:ft=0,Wn=null,mo(s,i,m,6);break;case 8:Cg(),Mt=6;break e;default:throw Error(r(462))}}Ux();break}catch(se){$v(s,se)}while(!0);return mr=sa=null,te.H=c,te.A=d,dt=o,qe!==null?0:(St=null,Ze=0,Nu(),Mt)}function Ux(){for(;qe!==null&&!pt();)Yv(qe)}function Yv(s){var i=bv(s.alternate,s,Sr);s.memoizedProps=s.pendingProps,i===null?ch(s):qe=i}function Wv(s){var i=s,o=i.alternate;switch(i.tag){case 15:case 0:i=mv(o,i,i.pendingProps,i.type,void 0,Ze);break;case 11:i=mv(o,i,i.pendingProps,i.type.render,i.ref,Ze);break;case 5:qf(i);default:Sv(o,i),i=qe=Xy(i,Sr),i=bv(o,i,Sr)}s.memoizedProps=s.pendingProps,i===null?ch(s):qe=i}function mo(s,i,o,c){mr=sa=null,qf(i),ao=null,Bl=0;var d=i.return;try{if(Ix(s,d,i,o,Ze)){Mt=1,eh(s,ls(o,s.current)),qe=null;return}}catch(m){if(d!==null)throw qe=d,m;Mt=1,eh(s,ls(o,s.current)),qe=null;return}i.flags&32768?(ct||c===1?s=!0:uo||(Ze&536870912)!==0?s=!1:(ti=s=!0,(c===2||c===9||c===3||c===6)&&(c=ds.current,c!==null&&c.tag===13&&(c.flags|=16384))),Xv(i,s)):ch(i)}function ch(s){var i=s;do{if((i.flags&32768)!==0){Xv(i,ti);return}s=i.return;var o=Nx(i.alternate,i,Sr);if(o!==null){qe=o;return}if(i=i.sibling,i!==null){qe=i;return}qe=i=s}while(i!==null);Mt===0&&(Mt=5)}function Xv(s,i){do{var o=Px(s.alternate,s);if(o!==null){o.flags&=32767,qe=o;return}if(o=s.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!i&&(s=s.sibling,s!==null)){qe=s;return}qe=s=o}while(s!==null);Mt=6,qe=null}function Zv(s,i,o,c,d,m,b,x,V){s.cancelPendingCommit=null;do uh();while(mn!==0);if((dt&6)!==0)throw Error(r(327));if(i!==null){if(i===s.current)throw Error(r(177));if(m=i.lanes|i.childLanes,m|=_f,ol(s,o,m,b,x,V),s===St&&(qe=St=null,Ze=0),fo=i,ri=s,go=o,Eg=m,Sg=d,Fv=c,(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?(s.callbackNode=null,s.callbackPriority=0,qx(Nn,function(){return s0(),null})):(s.callbackNode=null,s.callbackPriority=0),c=(i.flags&13878)!==0,(i.subtreeFlags&13878)!==0||c){c=te.T,te.T=null,d=he.p,he.p=2,b=dt,dt|=4;try{kx(s,i,o)}finally{dt=b,he.p=d,te.T=c}}mn=1,Jv(),e0(),t0()}}function Jv(){if(mn===1){mn=0;var s=ri,i=fo,o=(i.flags&13878)!==0;if((i.subtreeFlags&13878)!==0||o){o=te.T,te.T=null;var c=he.p;he.p=2;var d=dt;dt|=4;try{Ov(i,s);var m=zg,b=By(s.containerInfo),x=m.focusedElem,V=m.selectionRange;if(b!==x&&x&&x.ownerDocument&&zy(x.ownerDocument.documentElement,x)){if(V!==null&&ff(x)){var K=V.start,se=V.end;if(se===void 0&&(se=K),"selectionStart"in x)x.selectionStart=K,x.selectionEnd=Math.min(se,x.value.length);else{var ae=x.ownerDocument||document,Q=ae&&ae.defaultView||window;if(Q.getSelection){var Y=Q.getSelection(),Me=x.textContent.length,Ne=Math.min(V.start,Me),vt=V.end===void 0?Ne:Math.min(V.end,Me);!Y.extend&&Ne>vt&&(b=vt,vt=Ne,Ne=b);var H=Uy(x,Ne),F=Uy(x,vt);if(H&&F&&(Y.rangeCount!==1||Y.anchorNode!==H.node||Y.anchorOffset!==H.offset||Y.focusNode!==F.node||Y.focusOffset!==F.offset)){var $=ae.createRange();$.setStart(H.node,H.offset),Y.removeAllRanges(),Ne>vt?(Y.addRange($),Y.extend(F.node,F.offset)):($.setEnd(F.node,F.offset),Y.addRange($))}}}}for(ae=[],Y=x;Y=Y.parentNode;)Y.nodeType===1&&ae.push({element:Y,left:Y.scrollLeft,top:Y.scrollTop});for(typeof x.focus=="function"&&x.focus(),x=0;x<ae.length;x++){var ie=ae[x];ie.element.scrollLeft=ie.left,ie.element.scrollTop=ie.top}}bh=!!Ug,zg=Ug=null}finally{dt=d,he.p=c,te.T=o}}s.current=i,mn=2}}function e0(){if(mn===2){mn=0;var s=ri,i=fo,o=(i.flags&8772)!==0;if((i.subtreeFlags&8772)!==0||o){o=te.T,te.T=null;var c=he.p;he.p=2;var d=dt;dt|=4;try{Pv(s,i.alternate,i)}finally{dt=d,he.p=c,te.T=o}}mn=3}}function t0(){if(mn===4||mn===3){mn=0,Gt();var s=ri,i=fo,o=go,c=Fv;(i.subtreeFlags&10256)!==0||(i.flags&10256)!==0?mn=5:(mn=0,fo=ri=null,n0(s,s.pendingLanes));var d=s.pendingLanes;if(d===0&&(si=null),ka(o),i=i.stateNode,lt&&typeof lt.onCommitFiberRoot=="function")try{lt.onCommitFiberRoot(xt,i,void 0,(i.current.flags&128)===128)}catch{}if(c!==null){i=te.T,d=he.p,he.p=2,te.T=null;try{for(var m=s.onRecoverableError,b=0;b<c.length;b++){var x=c[b];m(x.value,{componentStack:x.stack})}}finally{te.T=i,he.p=d}}(go&3)!==0&&uh(),Gs(s),d=s.pendingLanes,(o&4194090)!==0&&(d&42)!==0?s===xg?Wl++:(Wl=0,xg=s):Wl=0,Xl(0)}}function n0(s,i){(s.pooledCacheLanes&=i)===0&&(i=s.pooledCache,i!=null&&(s.pooledCache=null,Nl(i)))}function uh(s){return Jv(),e0(),t0(),s0()}function s0(){if(mn!==5)return!1;var s=ri,i=Eg;Eg=0;var o=ka(go),c=te.T,d=he.p;try{he.p=32>o?32:o,te.T=null,o=Sg,Sg=null;var m=ri,b=go;if(mn=0,fo=ri=null,go=0,(dt&6)!==0)throw Error(r(331));var x=dt;if(dt|=4,zv(m.current),Vv(m,m.current,b,o),dt=x,Xl(0,!1),lt&&typeof lt.onPostCommitFiberRoot=="function")try{lt.onPostCommitFiberRoot(xt,m)}catch{}return!0}finally{he.p=d,te.T=c,n0(s,i)}}function r0(s,i,o){i=ls(o,i),i=sg(s.stateNode,i,2),s=Qr(s,i,2),s!==null&&(nr(s,2),Gs(s))}function bt(s,i,o){if(s.tag===3)r0(s,s,o);else for(;i!==null;){if(i.tag===3){r0(i,s,o);break}else if(i.tag===1){var c=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof c.componentDidCatch=="function"&&(si===null||!si.has(c))){s=ls(o,s),o=lv(2),c=Qr(i,o,2),c!==null&&(cv(o,c,i,s),nr(c,2),Gs(c));break}}i=i.return}}function Rg(s,i,o){var c=s.pingCache;if(c===null){c=s.pingCache=new Ox;var d=new Set;c.set(i,d)}else d=c.get(i),d===void 0&&(d=new Set,c.set(i,d));d.has(o)||(vg=!0,d.add(o),s=zx.bind(null,s,i,o),i.then(s,s))}function zx(s,i,o){var c=s.pingCache;c!==null&&c.delete(i),s.pingedLanes|=s.suspendedLanes&o,s.warmLanes&=~o,St===s&&(Ze&o)===o&&(Mt===4||Mt===3&&(Ze&62914560)===Ze&&300>ye()-bg?(dt&2)===0&&po(s,0):wg|=o,ho===Ze&&(ho=0)),Gs(s)}function i0(s,i){i===0&&(i=al()),s=Wa(s,i),s!==null&&(nr(s,i),Gs(s))}function Bx(s){var i=s.memoizedState,o=0;i!==null&&(o=i.retryLane),i0(s,o)}function Fx(s,i){var o=0;switch(s.tag){case 13:var c=s.stateNode,d=s.memoizedState;d!==null&&(o=d.retryLane);break;case 19:c=s.stateNode;break;case 22:c=s.stateNode._retryCache;break;default:throw Error(r(314))}c!==null&&c.delete(i),i0(s,o)}function qx(s,i){return Tt(s,i)}var hh=null,yo=null,Ng=!1,dh=!1,Pg=!1,ua=0;function Gs(s){s!==yo&&s.next===null&&(yo===null?hh=yo=s:yo=yo.next=s),dh=!0,Ng||(Ng=!0,Gx())}function Xl(s,i){if(!Pg&&dh){Pg=!0;do for(var o=!1,c=hh;c!==null;){if(s!==0){var d=c.pendingLanes;if(d===0)var m=0;else{var b=c.suspendedLanes,x=c.pingedLanes;m=(1<<31-$t(42|s)+1)-1,m&=d&~(b&~x),m=m&201326741?m&201326741|1:m?m|2:0}m!==0&&(o=!0,c0(c,m))}else m=Ze,m=Pa(c,c===St?m:0,c.cancelPendingCommit!==null||c.timeoutHandle!==-1),(m&3)===0||Oi(c,m)||(o=!0,c0(c,m));c=c.next}while(o);Pg=!1}}function Hx(){a0()}function a0(){dh=Ng=!1;var s=0;ua!==0&&(Jx()&&(s=ua),ua=0);for(var i=ye(),o=null,c=hh;c!==null;){var d=c.next,m=o0(c,i);m===0?(c.next=null,o===null?hh=d:o.next=d,d===null&&(yo=o)):(o=c,(s!==0||(m&3)!==0)&&(dh=!0)),c=d}Xl(s)}function o0(s,i){for(var o=s.suspendedLanes,c=s.pingedLanes,d=s.expirationTimes,m=s.pendingLanes&-62914561;0<m;){var b=31-$t(m),x=1<<b,V=d[b];V===-1?((x&o)===0||(x&c)!==0)&&(d[b]=rl(x,i)):V<=i&&(s.expiredLanes|=x),m&=~x}if(i=St,o=Ze,o=Pa(s,s===i?o:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),c=s.callbackNode,o===0||s===i&&(ft===2||ft===9)||s.cancelPendingCommit!==null)return c!==null&&c!==null&&Pe(c),s.callbackNode=null,s.callbackPriority=0;if((o&3)===0||Oi(s,o)){if(i=o&-o,i===s.callbackPriority)return i;switch(c!==null&&Pe(c),ka(o)){case 2:case 8:o=Et;break;case 32:o=Nn;break;case 268435456:o=ns;break;default:o=Nn}return c=l0.bind(null,s),o=Tt(o,c),s.callbackPriority=i,s.callbackNode=o,i}return c!==null&&c!==null&&Pe(c),s.callbackPriority=2,s.callbackNode=null,2}function l0(s,i){if(mn!==0&&mn!==5)return s.callbackNode=null,s.callbackPriority=0,null;var o=s.callbackNode;if(uh()&&s.callbackNode!==o)return null;var c=Ze;return c=Pa(s,s===St?c:0,s.cancelPendingCommit!==null||s.timeoutHandle!==-1),c===0?null:(Hv(s,c,i),o0(s,ye()),s.callbackNode!=null&&s.callbackNode===o?l0.bind(null,s):null)}function c0(s,i){if(uh())return null;Hv(s,i,!0)}function Gx(){tC(function(){(dt&6)!==0?Tt(Le,Hx):a0()})}function kg(){return ua===0&&(ua=il()),ua}function u0(s){return s==null||typeof s=="symbol"||typeof s=="boolean"?null:typeof s=="function"?s:ja(""+s)}function h0(s,i){var o=i.ownerDocument.createElement("input");return o.name=i.name,o.value=i.value,s.id&&o.setAttribute("form",s.id),i.parentNode.insertBefore(o,i),s=new FormData(s),o.parentNode.removeChild(o),s}function $x(s,i,o,c,d){if(i==="submit"&&o&&o.stateNode===d){var m=u0((d[Ut]||null).action),b=c.submitter;b&&(i=(i=b[Ut]||null)?u0(i.formAction):b.getAttribute("formAction"),i!==null&&(m=i,b=null));var x=new Ua("action","action",null,c,d);s.push({event:x,listeners:[{instance:null,listener:function(){if(c.defaultPrevented){if(ua!==0){var V=b?h0(d,b):new FormData(d);Zf(o,{pending:!0,data:V,method:d.method,action:m},null,V)}}else typeof m=="function"&&(x.preventDefault(),V=b?h0(d,b):new FormData(d),Zf(o,{pending:!0,data:V,method:d.method,action:m},m,V))},currentTarget:d}]})}}for(var Dg=0;Dg<yf.length;Dg++){var Mg=yf[Dg],Kx=Mg.toLowerCase(),Qx=Mg[0].toUpperCase()+Mg.slice(1);Ts(Kx,"on"+Qx)}Ts(Hy,"onAnimationEnd"),Ts(Gy,"onAnimationIteration"),Ts($y,"onAnimationStart"),Ts("dblclick","onDoubleClick"),Ts("focusin","onFocus"),Ts("focusout","onBlur"),Ts(hx,"onTransitionRun"),Ts(dx,"onTransitionStart"),Ts(fx,"onTransitionCancel"),Ts(Ky,"onTransitionEnd"),rr("onMouseEnter",["mouseout","mouseover"]),rr("onMouseLeave",["mouseout","mouseover"]),rr("onPointerEnter",["pointerout","pointerover"]),rr("onPointerLeave",["pointerout","pointerover"]),vs("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vs("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vs("onBeforeInput",["compositionend","keypress","textInput","paste"]),vs("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vs("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Yx=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zl));function d0(s,i){i=(i&4)!==0;for(var o=0;o<s.length;o++){var c=s[o],d=c.event;c=c.listeners;e:{var m=void 0;if(i)for(var b=c.length-1;0<=b;b--){var x=c[b],V=x.instance,K=x.currentTarget;if(x=x.listener,V!==m&&d.isPropagationStopped())break e;m=x,d.currentTarget=K;try{m(d)}catch(se){Ju(se)}d.currentTarget=null,m=V}else for(b=0;b<c.length;b++){if(x=c[b],V=x.instance,K=x.currentTarget,x=x.listener,V!==m&&d.isPropagationStopped())break e;m=x,d.currentTarget=K;try{m(d)}catch(se){Ju(se)}d.currentTarget=null,m=V}}}}function He(s,i){var o=i[cl];o===void 0&&(o=i[cl]=new Set);var c=s+"__bubble";o.has(c)||(f0(i,s,2,!1),o.add(c))}function Og(s,i,o){var c=0;i&&(c|=4),f0(o,s,c,i)}var fh="_reactListening"+Math.random().toString(36).slice(2);function Lg(s){if(!s[fh]){s[fh]=!0,ul.forEach(function(o){o!=="selectionchange"&&(Yx.has(o)||Og(o,!1,s),Og(o,!0,s))});var i=s.nodeType===9?s:s.ownerDocument;i===null||i[fh]||(i[fh]=!0,Og("selectionchange",!1,i))}}function f0(s,i,o,c){switch(V0(i)){case 2:var d=bC;break;case 8:d=EC;break;default:d=Wg}o=d.bind(null,i,o,s),d=void 0,!as||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(d=!0),c?d!==void 0?s.addEventListener(i,o,{capture:!0,passive:d}):s.addEventListener(i,o,!0):d!==void 0?s.addEventListener(i,o,{passive:d}):s.addEventListener(i,o,!1)}function Vg(s,i,o,c,d){var m=c;if((i&1)===0&&(i&2)===0&&c!==null)e:for(;;){if(c===null)return;var b=c.tag;if(b===3||b===4){var x=c.stateNode.containerInfo;if(x===d)break;if(b===4)for(b=c.return;b!==null;){var V=b.tag;if((V===3||V===4)&&b.stateNode.containerInfo===d)return;b=b.return}for(;x!==null;){if(b=sr(x),b===null)return;if(V=b.tag,V===5||V===6||V===26||V===27){c=m=b;continue e}x=x.parentNode}}c=c.return}pu(function(){var K=m,se=is(o),ae=[];e:{var Q=Qy.get(s);if(Q!==void 0){var Y=Ua,Me=s;switch(s){case"keypress":if(Ls(o)===0)break e;case"keydown":case"keyup":Y=Ga;break;case"focusin":Me="focus",Y=Fa;break;case"focusout":Me="blur",Y=Fa;break;case"beforeblur":case"afterblur":Y=Fa;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Y=os;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Y=cf;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Y=Eu;break;case Hy:case Gy:case $y:Y=qa;break;case Ky:Y=xu;break;case"scroll":case"scrollend":Y=mu;break;case"wheel":Y=$a;break;case"copy":case"cut":case"paste":Y=Ha;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Y=bl;break;case"toggle":case"beforetoggle":Y=Au}var Ne=(i&4)!==0,vt=!Ne&&(s==="scroll"||s==="scrollend"),H=Ne?Q!==null?Q+"Capture":null:Q;Ne=[];for(var F=K,$;F!==null;){var ie=F;if($=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||$===null||H===null||(ie=qi(F,H),ie!=null&&Ne.push(Jl(F,ie,$))),vt)break;F=F.return}0<Ne.length&&(Q=new Y(Q,Me,null,o,se),ae.push({event:Q,listeners:Ne}))}}if((i&7)===0){e:{if(Q=s==="mouseover"||s==="pointerover",Y=s==="mouseout"||s==="pointerout",Q&&o!==or&&(Me=o.relatedTarget||o.fromElement)&&(sr(Me)||Me[ss]))break e;if((Y||Q)&&(Q=se.window===se?se:(Q=se.ownerDocument)?Q.defaultView||Q.parentWindow:window,Y?(Me=o.relatedTarget||o.toElement,Y=K,Me=Me?sr(Me):null,Me!==null&&(vt=l(Me),Ne=Me.tag,Me!==vt||Ne!==5&&Ne!==27&&Ne!==6)&&(Me=null)):(Y=null,Me=K),Y!==Me)){if(Ne=os,ie="onMouseLeave",H="onMouseEnter",F="mouse",(s==="pointerout"||s==="pointerover")&&(Ne=bl,ie="onPointerLeave",H="onPointerEnter",F="pointer"),vt=Y==null?Q:ks(Y),$=Me==null?Q:ks(Me),Q=new Ne(ie,F+"leave",Y,o,se),Q.target=vt,Q.relatedTarget=$,ie=null,sr(se)===K&&(Ne=new Ne(H,F+"enter",Me,o,se),Ne.target=$,Ne.relatedTarget=vt,ie=Ne),vt=ie,Y&&Me)t:{for(Ne=Y,H=Me,F=0,$=Ne;$;$=_o($))F++;for($=0,ie=H;ie;ie=_o(ie))$++;for(;0<F-$;)Ne=_o(Ne),F--;for(;0<$-F;)H=_o(H),$--;for(;F--;){if(Ne===H||H!==null&&Ne===H.alternate)break t;Ne=_o(Ne),H=_o(H)}Ne=null}else Ne=null;Y!==null&&g0(ae,Q,Y,Ne,!1),Me!==null&&vt!==null&&g0(ae,vt,Me,Ne,!0)}}e:{if(Q=K?ks(K):window,Y=Q.nodeName&&Q.nodeName.toLowerCase(),Y==="select"||Y==="input"&&Q.type==="file")var be=Dy;else if(Yt(Q))if(My)be=lx;else{be=ax;var Fe=ix}else Y=Q.nodeName,!Y||Y.toLowerCase()!=="input"||Q.type!=="checkbox"&&Q.type!=="radio"?K&&pl(K.elementType)&&(be=Dy):be=ox;if(be&&(be=be(s,K))){dr(ae,be,o,se);break e}Fe&&Fe(s,Q,K),s==="focusout"&&K&&Q.type==="number"&&K.memoizedProps.value!=null&&qr(Q,"number",Q.value)}switch(Fe=K?ks(K):window,s){case"focusin":(Yt(Fe)||Fe.contentEditable==="true")&&(Ka=Fe,gf=K,xl=null);break;case"focusout":xl=gf=Ka=null;break;case"mousedown":pf=!0;break;case"contextmenu":case"mouseup":case"dragend":pf=!1,Fy(ae,o,se);break;case"selectionchange":if(ux)break;case"keydown":case"keyup":Fy(ae,o,se)}var xe;if(Us)e:{switch(s){case"compositionstart":var ke="onCompositionStart";break e;case"compositionend":ke="onCompositionEnd";break e;case"compositionupdate":ke="onCompositionUpdate";break e}ke=void 0}else We?X(s,o)&&(ke="onCompositionEnd"):s==="keydown"&&o.keyCode===229&&(ke="onCompositionStart");ke&&(T&&o.locale!=="ko"&&(We||ke!=="onCompositionStart"?ke==="onCompositionEnd"&&We&&(xe=yl()):(Os=se,Hr="value"in Os?Os.value:Os.textContent,We=!0)),Fe=gh(K,ke),0<Fe.length&&(ke=new wl(ke,s,null,o,se),ae.push({event:ke,listeners:Fe}),xe?ke.data=xe:(xe=fe(o),xe!==null&&(ke.data=xe)))),(xe=_?Qt(s,o):Xe(s,o))&&(ke=gh(K,"onBeforeInput"),0<ke.length&&(Fe=new wl("onBeforeInput","beforeinput",null,o,se),ae.push({event:Fe,listeners:ke}),Fe.data=xe)),$x(ae,s,K,o,se)}d0(ae,i)})}function Jl(s,i,o){return{instance:s,listener:i,currentTarget:o}}function gh(s,i){for(var o=i+"Capture",c=[];s!==null;){var d=s,m=d.stateNode;if(d=d.tag,d!==5&&d!==26&&d!==27||m===null||(d=qi(s,o),d!=null&&c.unshift(Jl(s,d,m)),d=qi(s,i),d!=null&&c.push(Jl(s,d,m))),s.tag===3)return c;s=s.return}return[]}function _o(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5&&s.tag!==27);return s||null}function g0(s,i,o,c,d){for(var m=i._reactName,b=[];o!==null&&o!==c;){var x=o,V=x.alternate,K=x.stateNode;if(x=x.tag,V!==null&&V===c)break;x!==5&&x!==26&&x!==27||K===null||(V=K,d?(K=qi(o,m),K!=null&&b.unshift(Jl(o,K,V))):d||(K=qi(o,m),K!=null&&b.push(Jl(o,K,V)))),o=o.return}b.length!==0&&s.push({event:i,listeners:b})}var Wx=/\r\n?/g,Xx=/\u0000|\uFFFD/g;function p0(s){return(typeof s=="string"?s:""+s).replace(Wx,`
`).replace(Xx,"")}function m0(s,i){return i=p0(i),p0(s)===i}function ph(){}function _t(s,i,o,c,d,m){switch(o){case"children":typeof c=="string"?i==="body"||i==="textarea"&&c===""||rs(s,c):(typeof c=="number"||typeof c=="bigint")&&i!=="body"&&rs(s,""+c);break;case"className":Ds(s,"class",c);break;case"tabIndex":Ds(s,"tabindex",c);break;case"dir":case"role":case"viewBox":case"width":case"height":Ds(s,o,c);break;case"style":gl(s,c,m);break;case"data":if(i!=="object"){Ds(s,"data",c);break}case"src":case"href":if(c===""&&(i!=="a"||o!=="href")){s.removeAttribute(o);break}if(c==null||typeof c=="function"||typeof c=="symbol"||typeof c=="boolean"){s.removeAttribute(o);break}c=ja(""+c),s.setAttribute(o,c);break;case"action":case"formAction":if(typeof c=="function"){s.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof m=="function"&&(o==="formAction"?(i!=="input"&&_t(s,i,"name",d.name,d,null),_t(s,i,"formEncType",d.formEncType,d,null),_t(s,i,"formMethod",d.formMethod,d,null),_t(s,i,"formTarget",d.formTarget,d,null)):(_t(s,i,"encType",d.encType,d,null),_t(s,i,"method",d.method,d,null),_t(s,i,"target",d.target,d,null)));if(c==null||typeof c=="symbol"||typeof c=="boolean"){s.removeAttribute(o);break}c=ja(""+c),s.setAttribute(o,c);break;case"onClick":c!=null&&(s.onclick=ph);break;case"onScroll":c!=null&&He("scroll",s);break;case"onScrollEnd":c!=null&&He("scrollend",s);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(r(61));if(o=c.__html,o!=null){if(d.children!=null)throw Error(r(60));s.innerHTML=o}}break;case"multiple":s.multiple=c&&typeof c!="function"&&typeof c!="symbol";break;case"muted":s.muted=c&&typeof c!="function"&&typeof c!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(c==null||typeof c=="function"||typeof c=="boolean"||typeof c=="symbol"){s.removeAttribute("xlink:href");break}o=ja(""+c),s.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":c!=null&&typeof c!="function"&&typeof c!="symbol"?s.setAttribute(o,""+c):s.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":c&&typeof c!="function"&&typeof c!="symbol"?s.setAttribute(o,""):s.removeAttribute(o);break;case"capture":case"download":c===!0?s.setAttribute(o,""):c!==!1&&c!=null&&typeof c!="function"&&typeof c!="symbol"?s.setAttribute(o,c):s.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":c!=null&&typeof c!="function"&&typeof c!="symbol"&&!isNaN(c)&&1<=c?s.setAttribute(o,c):s.removeAttribute(o);break;case"rowSpan":case"start":c==null||typeof c=="function"||typeof c=="symbol"||isNaN(c)?s.removeAttribute(o):s.setAttribute(o,c);break;case"popover":He("beforetoggle",s),He("toggle",s),Fr(s,"popover",c);break;case"xlinkActuate":fn(s,"http://www.w3.org/1999/xlink","xlink:actuate",c);break;case"xlinkArcrole":fn(s,"http://www.w3.org/1999/xlink","xlink:arcrole",c);break;case"xlinkRole":fn(s,"http://www.w3.org/1999/xlink","xlink:role",c);break;case"xlinkShow":fn(s,"http://www.w3.org/1999/xlink","xlink:show",c);break;case"xlinkTitle":fn(s,"http://www.w3.org/1999/xlink","xlink:title",c);break;case"xlinkType":fn(s,"http://www.w3.org/1999/xlink","xlink:type",c);break;case"xmlBase":fn(s,"http://www.w3.org/XML/1998/namespace","xml:base",c);break;case"xmlLang":fn(s,"http://www.w3.org/XML/1998/namespace","xml:lang",c);break;case"xmlSpace":fn(s,"http://www.w3.org/XML/1998/namespace","xml:space",c);break;case"is":Fr(s,"is",c);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=of.get(o)||o,Fr(s,o,c))}}function jg(s,i,o,c,d,m){switch(o){case"style":gl(s,c,m);break;case"dangerouslySetInnerHTML":if(c!=null){if(typeof c!="object"||!("__html"in c))throw Error(r(61));if(o=c.__html,o!=null){if(d.children!=null)throw Error(r(60));s.innerHTML=o}}break;case"children":typeof c=="string"?rs(s,c):(typeof c=="number"||typeof c=="bigint")&&rs(s,""+c);break;case"onScroll":c!=null&&He("scroll",s);break;case"onScrollEnd":c!=null&&He("scrollend",s);break;case"onClick":c!=null&&(s.onclick=ph);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Da.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(d=o.endsWith("Capture"),i=o.slice(2,d?o.length-7:void 0),m=s[Ut]||null,m=m!=null?m[o]:null,typeof m=="function"&&s.removeEventListener(i,m,d),typeof c=="function")){typeof m!="function"&&m!==null&&(o in s?s[o]=null:s.hasAttribute(o)&&s.removeAttribute(o)),s.addEventListener(i,c,d);break e}o in s?s[o]=c:c===!0?s.setAttribute(o,""):Fr(s,o,c)}}}function yn(s,i,o){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":He("error",s),He("load",s);var c=!1,d=!1,m;for(m in o)if(o.hasOwnProperty(m)){var b=o[m];if(b!=null)switch(m){case"src":c=!0;break;case"srcSet":d=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:_t(s,i,m,b,o,null)}}d&&_t(s,i,"srcSet",o.srcSet,o,null),c&&_t(s,i,"src",o.src,o,null);return;case"input":He("invalid",s);var x=m=b=d=null,V=null,K=null;for(c in o)if(o.hasOwnProperty(c)){var se=o[c];if(se!=null)switch(c){case"name":d=se;break;case"type":b=se;break;case"checked":V=se;break;case"defaultChecked":K=se;break;case"value":m=se;break;case"defaultValue":x=se;break;case"children":case"dangerouslySetInnerHTML":if(se!=null)throw Error(r(137,i));break;default:_t(s,i,c,se,o,null)}}zi(s,m,x,V,K,b,d,!1),Va(s);return;case"select":He("invalid",s),c=b=m=null;for(d in o)if(o.hasOwnProperty(d)&&(x=o[d],x!=null))switch(d){case"value":m=x;break;case"defaultValue":b=x;break;case"multiple":c=x;default:_t(s,i,d,x,o,null)}i=m,o=b,s.multiple=!!c,i!=null?ar(s,!!c,i,!1):o!=null&&ar(s,!!c,o,!0);return;case"textarea":He("invalid",s),m=d=c=null;for(b in o)if(o.hasOwnProperty(b)&&(x=o[b],x!=null))switch(b){case"value":c=x;break;case"defaultValue":d=x;break;case"children":m=x;break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(r(91));break;default:_t(s,i,b,x,o,null)}Bi(s,c,d,m),Va(s);return;case"option":for(V in o)if(o.hasOwnProperty(V)&&(c=o[V],c!=null))switch(V){case"selected":s.selected=c&&typeof c!="function"&&typeof c!="symbol";break;default:_t(s,i,V,c,o,null)}return;case"dialog":He("beforetoggle",s),He("toggle",s),He("cancel",s),He("close",s);break;case"iframe":case"object":He("load",s);break;case"video":case"audio":for(c=0;c<Zl.length;c++)He(Zl[c],s);break;case"image":He("error",s),He("load",s);break;case"details":He("toggle",s);break;case"embed":case"source":case"link":He("error",s),He("load",s);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(K in o)if(o.hasOwnProperty(K)&&(c=o[K],c!=null))switch(K){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,i));default:_t(s,i,K,c,o,null)}return;default:if(pl(i)){for(se in o)o.hasOwnProperty(se)&&(c=o[se],c!==void 0&&jg(s,i,se,c,o,void 0));return}}for(x in o)o.hasOwnProperty(x)&&(c=o[x],c!=null&&_t(s,i,x,c,o,null))}function Zx(s,i,o,c){switch(i){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var d=null,m=null,b=null,x=null,V=null,K=null,se=null;for(Y in o){var ae=o[Y];if(o.hasOwnProperty(Y)&&ae!=null)switch(Y){case"checked":break;case"value":break;case"defaultValue":V=ae;default:c.hasOwnProperty(Y)||_t(s,i,Y,null,c,ae)}}for(var Q in c){var Y=c[Q];if(ae=o[Q],c.hasOwnProperty(Q)&&(Y!=null||ae!=null))switch(Q){case"type":m=Y;break;case"name":d=Y;break;case"checked":K=Y;break;case"defaultChecked":se=Y;break;case"value":b=Y;break;case"defaultValue":x=Y;break;case"children":case"dangerouslySetInnerHTML":if(Y!=null)throw Error(r(137,i));break;default:Y!==ae&&_t(s,i,Q,Y,c,ae)}}Gn(s,b,x,V,K,se,m,d);return;case"select":Y=b=x=Q=null;for(m in o)if(V=o[m],o.hasOwnProperty(m)&&V!=null)switch(m){case"value":break;case"multiple":Y=V;default:c.hasOwnProperty(m)||_t(s,i,m,null,c,V)}for(d in c)if(m=c[d],V=o[d],c.hasOwnProperty(d)&&(m!=null||V!=null))switch(d){case"value":Q=m;break;case"defaultValue":x=m;break;case"multiple":b=m;default:m!==V&&_t(s,i,d,m,c,V)}i=x,o=b,c=Y,Q!=null?ar(s,!!o,Q,!1):!!c!=!!o&&(i!=null?ar(s,!!o,i,!0):ar(s,!!o,o?[]:"",!1));return;case"textarea":Y=Q=null;for(x in o)if(d=o[x],o.hasOwnProperty(x)&&d!=null&&!c.hasOwnProperty(x))switch(x){case"value":break;case"children":break;default:_t(s,i,x,null,c,d)}for(b in c)if(d=c[b],m=o[b],c.hasOwnProperty(b)&&(d!=null||m!=null))switch(b){case"value":Q=d;break;case"defaultValue":Y=d;break;case"children":break;case"dangerouslySetInnerHTML":if(d!=null)throw Error(r(91));break;default:d!==m&&_t(s,i,b,d,c,m)}mt(s,Q,Y);return;case"option":for(var Me in o)if(Q=o[Me],o.hasOwnProperty(Me)&&Q!=null&&!c.hasOwnProperty(Me))switch(Me){case"selected":s.selected=!1;break;default:_t(s,i,Me,null,c,Q)}for(V in c)if(Q=c[V],Y=o[V],c.hasOwnProperty(V)&&Q!==Y&&(Q!=null||Y!=null))switch(V){case"selected":s.selected=Q&&typeof Q!="function"&&typeof Q!="symbol";break;default:_t(s,i,V,Q,c,Y)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Ne in o)Q=o[Ne],o.hasOwnProperty(Ne)&&Q!=null&&!c.hasOwnProperty(Ne)&&_t(s,i,Ne,null,c,Q);for(K in c)if(Q=c[K],Y=o[K],c.hasOwnProperty(K)&&Q!==Y&&(Q!=null||Y!=null))switch(K){case"children":case"dangerouslySetInnerHTML":if(Q!=null)throw Error(r(137,i));break;default:_t(s,i,K,Q,c,Y)}return;default:if(pl(i)){for(var vt in o)Q=o[vt],o.hasOwnProperty(vt)&&Q!==void 0&&!c.hasOwnProperty(vt)&&jg(s,i,vt,void 0,c,Q);for(se in c)Q=c[se],Y=o[se],!c.hasOwnProperty(se)||Q===Y||Q===void 0&&Y===void 0||jg(s,i,se,Q,c,Y);return}}for(var H in o)Q=o[H],o.hasOwnProperty(H)&&Q!=null&&!c.hasOwnProperty(H)&&_t(s,i,H,null,c,Q);for(ae in c)Q=c[ae],Y=o[ae],!c.hasOwnProperty(ae)||Q===Y||Q==null&&Y==null||_t(s,i,ae,Q,c,Y)}var Ug=null,zg=null;function mh(s){return s.nodeType===9?s:s.ownerDocument}function y0(s){switch(s){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _0(s,i){if(s===0)switch(i){case"svg":return 1;case"math":return 2;default:return 0}return s===1&&i==="foreignObject"?0:s}function Bg(s,i){return s==="textarea"||s==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.children=="bigint"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Fg=null;function Jx(){var s=window.event;return s&&s.type==="popstate"?s===Fg?!1:(Fg=s,!0):(Fg=null,!1)}var v0=typeof setTimeout=="function"?setTimeout:void 0,eC=typeof clearTimeout=="function"?clearTimeout:void 0,w0=typeof Promise=="function"?Promise:void 0,tC=typeof queueMicrotask=="function"?queueMicrotask:typeof w0<"u"?function(s){return w0.resolve(null).then(s).catch(nC)}:v0;function nC(s){setTimeout(function(){throw s})}function ai(s){return s==="head"}function T0(s,i){var o=i,c=0,d=0;do{var m=o.nextSibling;if(s.removeChild(o),m&&m.nodeType===8)if(o=m.data,o==="/$"){if(0<c&&8>c){o=c;var b=s.ownerDocument;if(o&1&&ec(b.documentElement),o&2&&ec(b.body),o&4)for(o=b.head,ec(o),b=o.firstChild;b;){var x=b.nextSibling,V=b.nodeName;b[Li]||V==="SCRIPT"||V==="STYLE"||V==="LINK"&&b.rel.toLowerCase()==="stylesheet"||o.removeChild(b),b=x}}if(d===0){s.removeChild(m),lc(i);return}d--}else o==="$"||o==="$?"||o==="$!"?d++:c=o.charCodeAt(0)-48;else c=0;o=m}while(o);lc(i)}function qg(s){var i=s.firstChild;for(i&&i.nodeType===10&&(i=i.nextSibling);i;){var o=i;switch(i=i.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":qg(o),Br(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}s.removeChild(o)}}function sC(s,i,o,c){for(;s.nodeType===1;){var d=o;if(s.nodeName.toLowerCase()!==i.toLowerCase()){if(!c&&(s.nodeName!=="INPUT"||s.type!=="hidden"))break}else if(c){if(!s[Li])switch(i){case"meta":if(!s.hasAttribute("itemprop"))break;return s;case"link":if(m=s.getAttribute("rel"),m==="stylesheet"&&s.hasAttribute("data-precedence"))break;if(m!==d.rel||s.getAttribute("href")!==(d.href==null||d.href===""?null:d.href)||s.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin)||s.getAttribute("title")!==(d.title==null?null:d.title))break;return s;case"style":if(s.hasAttribute("data-precedence"))break;return s;case"script":if(m=s.getAttribute("src"),(m!==(d.src==null?null:d.src)||s.getAttribute("type")!==(d.type==null?null:d.type)||s.getAttribute("crossorigin")!==(d.crossOrigin==null?null:d.crossOrigin))&&m&&s.hasAttribute("async")&&!s.hasAttribute("itemprop"))break;return s;default:return s}}else if(i==="input"&&s.type==="hidden"){var m=d.name==null?null:""+d.name;if(d.type==="hidden"&&s.getAttribute("name")===m)return s}else return s;if(s=Es(s.nextSibling),s===null)break}return null}function rC(s,i,o){if(i==="")return null;for(;s.nodeType!==3;)if((s.nodeType!==1||s.nodeName!=="INPUT"||s.type!=="hidden")&&!o||(s=Es(s.nextSibling),s===null))return null;return s}function Hg(s){return s.data==="$!"||s.data==="$?"&&s.ownerDocument.readyState==="complete"}function iC(s,i){var o=s.ownerDocument;if(s.data!=="$?"||o.readyState==="complete")i();else{var c=function(){i(),o.removeEventListener("DOMContentLoaded",c)};o.addEventListener("DOMContentLoaded",c),s._reactRetry=c}}function Es(s){for(;s!=null;s=s.nextSibling){var i=s.nodeType;if(i===1||i===3)break;if(i===8){if(i=s.data,i==="$"||i==="$!"||i==="$?"||i==="F!"||i==="F")break;if(i==="/$")return null}}return s}var Gg=null;function b0(s){s=s.previousSibling;for(var i=0;s;){if(s.nodeType===8){var o=s.data;if(o==="$"||o==="$!"||o==="$?"){if(i===0)return s;i--}else o==="/$"&&i++}s=s.previousSibling}return null}function E0(s,i,o){switch(i=mh(o),s){case"html":if(s=i.documentElement,!s)throw Error(r(452));return s;case"head":if(s=i.head,!s)throw Error(r(453));return s;case"body":if(s=i.body,!s)throw Error(r(454));return s;default:throw Error(r(451))}}function ec(s){for(var i=s.attributes;i.length;)s.removeAttributeNode(i[0]);Br(s)}var gs=new Map,S0=new Set;function yh(s){return typeof s.getRootNode=="function"?s.getRootNode():s.nodeType===9?s:s.ownerDocument}var xr=he.d;he.d={f:aC,r:oC,D:lC,C:cC,L:uC,m:hC,X:fC,S:dC,M:gC};function aC(){var s=xr.f(),i=lh();return s||i}function oC(s){var i=Ps(s);i!==null&&i.tag===5&&i.type==="form"?H_(i):xr.r(s)}var vo=typeof document>"u"?null:document;function x0(s,i,o){var c=vo;if(c&&typeof i=="string"&&i){var d=zt(i);d='link[rel="'+s+'"][href="'+d+'"]',typeof o=="string"&&(d+='[crossorigin="'+o+'"]'),S0.has(d)||(S0.add(d),s={rel:s,crossOrigin:o,href:i},c.querySelector(d)===null&&(i=c.createElement("link"),yn(i,"link",s),Ot(i),c.head.appendChild(i)))}}function lC(s){xr.D(s),x0("dns-prefetch",s,null)}function cC(s,i){xr.C(s,i),x0("preconnect",s,i)}function uC(s,i,o){xr.L(s,i,o);var c=vo;if(c&&s&&i){var d='link[rel="preload"][as="'+zt(i)+'"]';i==="image"&&o&&o.imageSrcSet?(d+='[imagesrcset="'+zt(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(d+='[imagesizes="'+zt(o.imageSizes)+'"]')):d+='[href="'+zt(s)+'"]';var m=d;switch(i){case"style":m=wo(s);break;case"script":m=To(s)}gs.has(m)||(s=y({rel:"preload",href:i==="image"&&o&&o.imageSrcSet?void 0:s,as:i},o),gs.set(m,s),c.querySelector(d)!==null||i==="style"&&c.querySelector(tc(m))||i==="script"&&c.querySelector(nc(m))||(i=c.createElement("link"),yn(i,"link",s),Ot(i),c.head.appendChild(i)))}}function hC(s,i){xr.m(s,i);var o=vo;if(o&&s){var c=i&&typeof i.as=="string"?i.as:"script",d='link[rel="modulepreload"][as="'+zt(c)+'"][href="'+zt(s)+'"]',m=d;switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":m=To(s)}if(!gs.has(m)&&(s=y({rel:"modulepreload",href:s},i),gs.set(m,s),o.querySelector(d)===null)){switch(c){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(nc(m)))return}c=o.createElement("link"),yn(c,"link",s),Ot(c),o.head.appendChild(c)}}}function dC(s,i,o){xr.S(s,i,o);var c=vo;if(c&&s){var d=Dn(c).hoistableStyles,m=wo(s);i=i||"default";var b=d.get(m);if(!b){var x={loading:0,preload:null};if(b=c.querySelector(tc(m)))x.loading=5;else{s=y({rel:"stylesheet",href:s,"data-precedence":i},o),(o=gs.get(m))&&$g(s,o);var V=b=c.createElement("link");Ot(V),yn(V,"link",s),V._p=new Promise(function(K,se){V.onload=K,V.onerror=se}),V.addEventListener("load",function(){x.loading|=1}),V.addEventListener("error",function(){x.loading|=2}),x.loading|=4,_h(b,i,c)}b={type:"stylesheet",instance:b,count:1,state:x},d.set(m,b)}}}function fC(s,i){xr.X(s,i);var o=vo;if(o&&s){var c=Dn(o).hoistableScripts,d=To(s),m=c.get(d);m||(m=o.querySelector(nc(d)),m||(s=y({src:s,async:!0},i),(i=gs.get(d))&&Kg(s,i),m=o.createElement("script"),Ot(m),yn(m,"link",s),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function gC(s,i){xr.M(s,i);var o=vo;if(o&&s){var c=Dn(o).hoistableScripts,d=To(s),m=c.get(d);m||(m=o.querySelector(nc(d)),m||(s=y({src:s,async:!0,type:"module"},i),(i=gs.get(d))&&Kg(s,i),m=o.createElement("script"),Ot(m),yn(m,"link",s),o.head.appendChild(m)),m={type:"script",instance:m,count:1,state:null},c.set(d,m))}}function C0(s,i,o,c){var d=(d=de.current)?yh(d):null;if(!d)throw Error(r(446));switch(s){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(i=wo(o.href),o=Dn(d).hoistableStyles,c=o.get(i),c||(c={type:"style",instance:null,count:0,state:null},o.set(i,c)),c):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){s=wo(o.href);var m=Dn(d).hoistableStyles,b=m.get(s);if(b||(d=d.ownerDocument||d,b={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},m.set(s,b),(m=d.querySelector(tc(s)))&&!m._p&&(b.instance=m,b.state.loading=5),gs.has(s)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},gs.set(s,o),m||pC(d,s,o,b.state))),i&&c===null)throw Error(r(528,""));return b}if(i&&c!==null)throw Error(r(529,""));return null;case"script":return i=o.async,o=o.src,typeof o=="string"&&i&&typeof i!="function"&&typeof i!="symbol"?(i=To(o),o=Dn(d).hoistableScripts,c=o.get(i),c||(c={type:"script",instance:null,count:0,state:null},o.set(i,c)),c):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,s))}}function wo(s){return'href="'+zt(s)+'"'}function tc(s){return'link[rel="stylesheet"]['+s+"]"}function A0(s){return y({},s,{"data-precedence":s.precedence,precedence:null})}function pC(s,i,o,c){s.querySelector('link[rel="preload"][as="style"]['+i+"]")?c.loading=1:(i=s.createElement("link"),c.preload=i,i.addEventListener("load",function(){return c.loading|=1}),i.addEventListener("error",function(){return c.loading|=2}),yn(i,"link",o),Ot(i),s.head.appendChild(i))}function To(s){return'[src="'+zt(s)+'"]'}function nc(s){return"script[async]"+s}function I0(s,i,o){if(i.count++,i.instance===null)switch(i.type){case"style":var c=s.querySelector('style[data-href~="'+zt(o.href)+'"]');if(c)return i.instance=c,Ot(c),c;var d=y({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return c=(s.ownerDocument||s).createElement("style"),Ot(c),yn(c,"style",d),_h(c,o.precedence,s),i.instance=c;case"stylesheet":d=wo(o.href);var m=s.querySelector(tc(d));if(m)return i.state.loading|=4,i.instance=m,Ot(m),m;c=A0(o),(d=gs.get(d))&&$g(c,d),m=(s.ownerDocument||s).createElement("link"),Ot(m);var b=m;return b._p=new Promise(function(x,V){b.onload=x,b.onerror=V}),yn(m,"link",c),i.state.loading|=4,_h(m,o.precedence,s),i.instance=m;case"script":return m=To(o.src),(d=s.querySelector(nc(m)))?(i.instance=d,Ot(d),d):(c=o,(d=gs.get(m))&&(c=y({},o),Kg(c,d)),s=s.ownerDocument||s,d=s.createElement("script"),Ot(d),yn(d,"link",c),s.head.appendChild(d),i.instance=d);case"void":return null;default:throw Error(r(443,i.type))}else i.type==="stylesheet"&&(i.state.loading&4)===0&&(c=i.instance,i.state.loading|=4,_h(c,o.precedence,s));return i.instance}function _h(s,i,o){for(var c=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),d=c.length?c[c.length-1]:null,m=d,b=0;b<c.length;b++){var x=c[b];if(x.dataset.precedence===i)m=x;else if(m!==d)break}m?m.parentNode.insertBefore(s,m.nextSibling):(i=o.nodeType===9?o.head:o,i.insertBefore(s,i.firstChild))}function $g(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.title==null&&(s.title=i.title)}function Kg(s,i){s.crossOrigin==null&&(s.crossOrigin=i.crossOrigin),s.referrerPolicy==null&&(s.referrerPolicy=i.referrerPolicy),s.integrity==null&&(s.integrity=i.integrity)}var vh=null;function R0(s,i,o){if(vh===null){var c=new Map,d=vh=new Map;d.set(o,c)}else d=vh,c=d.get(o),c||(c=new Map,d.set(o,c));if(c.has(s))return c;for(c.set(s,null),o=o.getElementsByTagName(s),d=0;d<o.length;d++){var m=o[d];if(!(m[Li]||m[Kt]||s==="link"&&m.getAttribute("rel")==="stylesheet")&&m.namespaceURI!=="http://www.w3.org/2000/svg"){var b=m.getAttribute(i)||"";b=s+b;var x=c.get(b);x?x.push(m):c.set(b,[m])}}return c}function N0(s,i,o){s=s.ownerDocument||s,s.head.insertBefore(o,i==="title"?s.querySelector("head > title"):null)}function mC(s,i,o){if(o===1||i.itemProp!=null)return!1;switch(s){case"meta":case"title":return!0;case"style":if(typeof i.precedence!="string"||typeof i.href!="string"||i.href==="")break;return!0;case"link":if(typeof i.rel!="string"||typeof i.href!="string"||i.href===""||i.onLoad||i.onError)break;switch(i.rel){case"stylesheet":return s=i.disabled,typeof i.precedence=="string"&&s==null;default:return!0}case"script":if(i.async&&typeof i.async!="function"&&typeof i.async!="symbol"&&!i.onLoad&&!i.onError&&i.src&&typeof i.src=="string")return!0}return!1}function P0(s){return!(s.type==="stylesheet"&&(s.state.loading&3)===0)}var sc=null;function yC(){}function _C(s,i,o){if(sc===null)throw Error(r(475));var c=sc;if(i.type==="stylesheet"&&(typeof o.media!="string"||matchMedia(o.media).matches!==!1)&&(i.state.loading&4)===0){if(i.instance===null){var d=wo(o.href),m=s.querySelector(tc(d));if(m){s=m._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(c.count++,c=wh.bind(c),s.then(c,c)),i.state.loading|=4,i.instance=m,Ot(m);return}m=s.ownerDocument||s,o=A0(o),(d=gs.get(d))&&$g(o,d),m=m.createElement("link"),Ot(m);var b=m;b._p=new Promise(function(x,V){b.onload=x,b.onerror=V}),yn(m,"link",o),i.instance=m}c.stylesheets===null&&(c.stylesheets=new Map),c.stylesheets.set(i,s),(s=i.state.preload)&&(i.state.loading&3)===0&&(c.count++,i=wh.bind(c),s.addEventListener("load",i),s.addEventListener("error",i))}}function vC(){if(sc===null)throw Error(r(475));var s=sc;return s.stylesheets&&s.count===0&&Qg(s,s.stylesheets),0<s.count?function(i){var o=setTimeout(function(){if(s.stylesheets&&Qg(s,s.stylesheets),s.unsuspend){var c=s.unsuspend;s.unsuspend=null,c()}},6e4);return s.unsuspend=i,function(){s.unsuspend=null,clearTimeout(o)}}:null}function wh(){if(this.count--,this.count===0){if(this.stylesheets)Qg(this,this.stylesheets);else if(this.unsuspend){var s=this.unsuspend;this.unsuspend=null,s()}}}var Th=null;function Qg(s,i){s.stylesheets=null,s.unsuspend!==null&&(s.count++,Th=new Map,i.forEach(wC,s),Th=null,wh.call(s))}function wC(s,i){if(!(i.state.loading&4)){var o=Th.get(s);if(o)var c=o.get(null);else{o=new Map,Th.set(s,o);for(var d=s.querySelectorAll("link[data-precedence],style[data-precedence]"),m=0;m<d.length;m++){var b=d[m];(b.nodeName==="LINK"||b.getAttribute("media")!=="not all")&&(o.set(b.dataset.precedence,b),c=b)}c&&o.set(null,c)}d=i.instance,b=d.getAttribute("data-precedence"),m=o.get(b)||c,m===c&&o.set(null,d),o.set(b,d),this.count++,c=wh.bind(this),d.addEventListener("load",c),d.addEventListener("error",c),m?m.parentNode.insertBefore(d,m.nextSibling):(s=s.nodeType===9?s.head:s,s.insertBefore(d,s.firstChild)),i.state.loading|=4}}var rc={$$typeof:U,Provider:null,Consumer:null,_currentValue:ge,_currentValue2:ge,_threadCount:0};function TC(s,i,o,c,d,m,b,x){this.tag=1,this.containerInfo=s,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=tr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tr(0),this.hiddenUpdates=tr(null),this.identifierPrefix=c,this.onUncaughtError=d,this.onCaughtError=m,this.onRecoverableError=b,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=x,this.incompleteTransitions=new Map}function k0(s,i,o,c,d,m,b,x,V,K,se,ae){return s=new TC(s,i,o,b,x,V,K,ae),i=1,m===!0&&(i|=24),m=Kn(3,null,null,i),s.current=m,m.stateNode=s,i=Rf(),i.refCount++,s.pooledCache=i,i.refCount++,m.memoizedState={element:c,isDehydrated:o,cache:i},Df(m),s}function D0(s){return s?(s=Xa,s):Xa}function M0(s,i,o,c,d,m){d=D0(d),c.context===null?c.context=d:c.pendingContext=d,c=Kr(i),c.payload={element:o},m=m===void 0?null:m,m!==null&&(c.callback=m),o=Qr(s,c,i),o!==null&&(Zn(o,s,i),Ml(o,s,i))}function O0(s,i){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var o=s.retryLane;s.retryLane=o!==0&&o<i?o:i}}function Yg(s,i){O0(s,i),(s=s.alternate)&&O0(s,i)}function L0(s){if(s.tag===13){var i=Wa(s,67108864);i!==null&&Zn(i,s,67108864),Yg(s,67108864)}}var bh=!0;function bC(s,i,o,c){var d=te.T;te.T=null;var m=he.p;try{he.p=2,Wg(s,i,o,c)}finally{he.p=m,te.T=d}}function EC(s,i,o,c){var d=te.T;te.T=null;var m=he.p;try{he.p=8,Wg(s,i,o,c)}finally{he.p=m,te.T=d}}function Wg(s,i,o,c){if(bh){var d=Xg(c);if(d===null)Vg(s,i,c,Eh,o),j0(s,c);else if(xC(d,s,i,o,c))c.stopPropagation();else if(j0(s,c),i&4&&-1<SC.indexOf(s)){for(;d!==null;){var m=Ps(d);if(m!==null)switch(m.tag){case 3:if(m=m.stateNode,m.current.memoizedState.isDehydrated){var b=_s(m.pendingLanes);if(b!==0){var x=m;for(x.pendingLanes|=2,x.entangledLanes|=2;b;){var V=1<<31-$t(b);x.entanglements[1]|=V,b&=~V}Gs(m),(dt&6)===0&&(ah=ye()+500,Xl(0))}}break;case 13:x=Wa(m,2),x!==null&&Zn(x,m,2),lh(),Yg(m,2)}if(m=Xg(c),m===null&&Vg(s,i,c,Eh,o),m===d)break;d=m}d!==null&&c.stopPropagation()}else Vg(s,i,c,null,o)}}function Xg(s){return s=is(s),Zg(s)}var Eh=null;function Zg(s){if(Eh=null,s=sr(s),s!==null){var i=l(s);if(i===null)s=null;else{var o=i.tag;if(o===13){if(s=u(i),s!==null)return s;s=null}else if(o===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;s=null}else i!==s&&(s=null)}}return Eh=s,null}function V0(s){switch(s){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ae()){case Le:return 2;case Et:return 8;case Nn:case Pn:return 32;case ns:return 268435456;default:return 32}default:return 32}}var Jg=!1,oi=null,li=null,ci=null,ic=new Map,ac=new Map,ui=[],SC="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function j0(s,i){switch(s){case"focusin":case"focusout":oi=null;break;case"dragenter":case"dragleave":li=null;break;case"mouseover":case"mouseout":ci=null;break;case"pointerover":case"pointerout":ic.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":ac.delete(i.pointerId)}}function oc(s,i,o,c,d,m){return s===null||s.nativeEvent!==m?(s={blockedOn:i,domEventName:o,eventSystemFlags:c,nativeEvent:m,targetContainers:[d]},i!==null&&(i=Ps(i),i!==null&&L0(i)),s):(s.eventSystemFlags|=c,i=s.targetContainers,d!==null&&i.indexOf(d)===-1&&i.push(d),s)}function xC(s,i,o,c,d){switch(i){case"focusin":return oi=oc(oi,s,i,o,c,d),!0;case"dragenter":return li=oc(li,s,i,o,c,d),!0;case"mouseover":return ci=oc(ci,s,i,o,c,d),!0;case"pointerover":var m=d.pointerId;return ic.set(m,oc(ic.get(m)||null,s,i,o,c,d)),!0;case"gotpointercapture":return m=d.pointerId,ac.set(m,oc(ac.get(m)||null,s,i,o,c,d)),!0}return!1}function U0(s){var i=sr(s.target);if(i!==null){var o=l(i);if(o!==null){if(i=o.tag,i===13){if(i=u(o),i!==null){s.blockedOn=i,lu(s.priority,function(){if(o.tag===13){var c=Xn();c=jr(c);var d=Wa(o,c);d!==null&&Zn(d,o,c),Yg(o,c)}});return}}else if(i===3&&o.stateNode.current.memoizedState.isDehydrated){s.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Sh(s){if(s.blockedOn!==null)return!1;for(var i=s.targetContainers;0<i.length;){var o=Xg(s.nativeEvent);if(o===null){o=s.nativeEvent;var c=new o.constructor(o.type,o);or=c,o.target.dispatchEvent(c),or=null}else return i=Ps(o),i!==null&&L0(i),s.blockedOn=o,!1;i.shift()}return!0}function z0(s,i,o){Sh(s)&&o.delete(i)}function CC(){Jg=!1,oi!==null&&Sh(oi)&&(oi=null),li!==null&&Sh(li)&&(li=null),ci!==null&&Sh(ci)&&(ci=null),ic.forEach(z0),ac.forEach(z0)}function xh(s,i){s.blockedOn===i&&(s.blockedOn=null,Jg||(Jg=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,CC)))}var Ch=null;function B0(s){Ch!==s&&(Ch=s,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Ch===s&&(Ch=null);for(var i=0;i<s.length;i+=3){var o=s[i],c=s[i+1],d=s[i+2];if(typeof c!="function"){if(Zg(c||o)===null)continue;break}var m=Ps(o);m!==null&&(s.splice(i,3),i-=3,Zf(m,{pending:!0,data:d,method:o.method,action:c},c,d))}}))}function lc(s){function i(V){return xh(V,s)}oi!==null&&xh(oi,s),li!==null&&xh(li,s),ci!==null&&xh(ci,s),ic.forEach(i),ac.forEach(i);for(var o=0;o<ui.length;o++){var c=ui[o];c.blockedOn===s&&(c.blockedOn=null)}for(;0<ui.length&&(o=ui[0],o.blockedOn===null);)U0(o),o.blockedOn===null&&ui.shift();if(o=(s.ownerDocument||s).$$reactFormReplay,o!=null)for(c=0;c<o.length;c+=3){var d=o[c],m=o[c+1],b=d[Ut]||null;if(typeof m=="function")b||B0(o);else if(b){var x=null;if(m&&m.hasAttribute("formAction")){if(d=m,b=m[Ut]||null)x=b.formAction;else if(Zg(d)!==null)continue}else x=b.action;typeof x=="function"?o[c+1]=x:(o.splice(c,3),c-=3),B0(o)}}}function ep(s){this._internalRoot=s}Ah.prototype.render=ep.prototype.render=function(s){var i=this._internalRoot;if(i===null)throw Error(r(409));var o=i.current,c=Xn();M0(o,c,s,i,null,null)},Ah.prototype.unmount=ep.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var i=s.containerInfo;M0(s.current,2,null,s,null,null),lh(),i[ss]=null}};function Ah(s){this._internalRoot=s}Ah.prototype.unstable_scheduleHydration=function(s){if(s){var i=Ur();s={blockedOn:null,target:s,priority:i};for(var o=0;o<ui.length&&i!==0&&i<ui[o].priority;o++);ui.splice(o,0,s),o===0&&U0(s)}};var F0=e.version;if(F0!=="19.1.0")throw Error(r(527,F0,"19.1.0"));he.findDOMNode=function(s){var i=s._reactInternals;if(i===void 0)throw typeof s.render=="function"?Error(r(188)):(s=Object.keys(s).join(","),Error(r(268,s)));return s=g(i),s=s!==null?p(s):null,s=s===null?null:s.stateNode,s};var AC={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:te,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ih=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ih.isDisabled&&Ih.supportsFiber)try{xt=Ih.inject(AC),lt=Ih}catch{}}return uc.createRoot=function(s,i){if(!a(s))throw Error(r(299));var o=!1,c="",d=rv,m=iv,b=av,x=null;return i!=null&&(i.unstable_strictMode===!0&&(o=!0),i.identifierPrefix!==void 0&&(c=i.identifierPrefix),i.onUncaughtError!==void 0&&(d=i.onUncaughtError),i.onCaughtError!==void 0&&(m=i.onCaughtError),i.onRecoverableError!==void 0&&(b=i.onRecoverableError),i.unstable_transitionCallbacks!==void 0&&(x=i.unstable_transitionCallbacks)),i=k0(s,1,!1,null,null,o,c,d,m,b,x,null),s[ss]=i.current,Lg(s),new ep(i)},uc.hydrateRoot=function(s,i,o){if(!a(s))throw Error(r(299));var c=!1,d="",m=rv,b=iv,x=av,V=null,K=null;return o!=null&&(o.unstable_strictMode===!0&&(c=!0),o.identifierPrefix!==void 0&&(d=o.identifierPrefix),o.onUncaughtError!==void 0&&(m=o.onUncaughtError),o.onCaughtError!==void 0&&(b=o.onCaughtError),o.onRecoverableError!==void 0&&(x=o.onRecoverableError),o.unstable_transitionCallbacks!==void 0&&(V=o.unstable_transitionCallbacks),o.formState!==void 0&&(K=o.formState)),i=k0(s,1,!0,i,o??null,c,d,m,b,x,V,K),i.context=D0(null),o=i.current,c=Xn(),c=jr(c),d=Kr(c),d.callback=null,Qr(o,d,c),o=c,i.current.lanes=o,nr(i,o),Gs(i),s[ss]=i.current,Lg(s),new Ah(i)},uc.version="19.1.0",uc}var Z0;function jC(){if(Z0)return sp.exports;Z0=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),sp.exports=VC(),sp.exports}var UC=jC();const zC=()=>{};var J0={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vb={NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _e=function(n,e){if(!n)throw Go(e)},Go=function(n){return new Error("Firebase Database ("+vb.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wb=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let a=n.charCodeAt(r);a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):(a&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(a=65536+((a&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},BC=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const a=n[t++];if(a<128)e[r++]=String.fromCharCode(a);else if(a>191&&a<224){const l=n[t++];e[r++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=n[t++],u=n[t++],f=n[t++],g=((a&7)<<18|(l&63)<<12|(u&63)<<6|f&63)-65536;e[r++]=String.fromCharCode(55296+(g>>10)),e[r++]=String.fromCharCode(56320+(g&1023))}else{const l=n[t++],u=n[t++];e[r++]=String.fromCharCode((a&15)<<12|(l&63)<<6|u&63)}}return e.join("")},fm={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let a=0;a<n.length;a+=3){const l=n[a],u=a+1<n.length,f=u?n[a+1]:0,g=a+2<n.length,p=g?n[a+2]:0,y=l>>2,v=(l&3)<<4|f>>4;let E=(f&15)<<2|p>>6,S=p&63;g||(S=64,u||(E=64)),r.push(t[y],t[v],t[E],t[S])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(wb(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):BC(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let a=0;a<n.length;){const l=t[n.charAt(a++)],f=a<n.length?t[n.charAt(a)]:0;++a;const p=a<n.length?t[n.charAt(a)]:64;++a;const v=a<n.length?t[n.charAt(a)]:64;if(++a,l==null||f==null||p==null||v==null)throw new FC;const E=l<<2|f>>4;if(r.push(E),p!==64){const S=f<<4&240|p>>2;if(r.push(S),v!==64){const D=p<<6&192|v;r.push(D)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class FC extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Tb=function(n){const e=wb(n);return fm.encodeByteArray(e,!0)},Yh=function(n){return Tb(n).replace(/\./g,"")},Wh=function(n){try{return fm.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qC(n){return bb(void 0,n)}function bb(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!HC(t)||(n[t]=bb(n[t],e[t]));return n}function HC(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function GC(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $C=()=>GC().__FIREBASE_DEFAULTS__,KC=()=>{if(typeof process>"u"||typeof J0>"u")return;const n=J0.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},QC=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Wh(n[1]);return e&&JSON.parse(e)},gm=()=>{try{return zC()||$C()||KC()||QC()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Eb=n=>{var e,t;return(t=(e=gm())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Sb=n=>{const e=Eb(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),r]:[e.substring(0,t),r]},xb=()=>{var n;return(n=gm())===null||n===void 0?void 0:n.config};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pm{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const t={alg:"none",type:"JWT"},r=e||"demo-project",a=n.iat||0,l=n.sub||n.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const u=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Yh(JSON.stringify(t)),Yh(JSON.stringify(u)),""].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rs(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function mm(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Rs())}function YC(){var n;const e=(n=gm())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function WC(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function XC(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Ab(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ZC(){return vb.NODE_ADMIN===!0}function JC(){return!YC()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function eA(){try{return typeof indexedDB=="object"}catch{return!1}}function tA(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=()=>{a.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},a.onupgradeneeded=()=>{t=!1},a.onerror=()=>{var l;e(((l=a.error)===null||l===void 0?void 0:l.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nA="FirebaseError";class Ri extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=nA,Object.setPrototypeOf(this,Ri.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Hc.prototype.create)}}class Hc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},a=`${this.service}/${e}`,l=this.errors[e],u=l?sA(l,r):"Error",f=`${this.serviceName}: ${u} (${a}).`;return new Ri(a,f,r)}}function sA(n,e){return n.replace(rA,(t,r)=>{const a=e[r];return a!=null?String(a):`<${r}?>`})}const rA=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kc(n){return JSON.parse(n)}function vn(n){return JSON.stringify(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ib=function(n){let e={},t={},r={},a="";try{const l=n.split(".");e=kc(Wh(l[0])||""),t=kc(Wh(l[1])||""),a=l[2],r=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:r,signature:a}},iA=function(n){const e=Ib(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},aA=function(n){const e=Ib(n).claims;return typeof e=="object"&&e.admin===!0};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Lr(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Oo(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ew(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Xh(n,e,t){const r={};for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=e.call(t,n[a],a,n));return r}function Pr(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const a of t){if(!r.includes(a))return!1;const l=n[a],u=e[a];if(tw(l)&&tw(u)){if(!Pr(l,u))return!1}else if(l!==u)return!1}for(const a of r)if(!t.includes(a))return!1;return!0}function tw(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ym(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(a=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oA{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const r=this.W_;if(typeof e=="string")for(let v=0;v<16;v++)r[v]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let v=0;v<16;v++)r[v]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let v=16;v<80;v++){const E=r[v-3]^r[v-8]^r[v-14]^r[v-16];r[v]=(E<<1|E>>>31)&4294967295}let a=this.chain_[0],l=this.chain_[1],u=this.chain_[2],f=this.chain_[3],g=this.chain_[4],p,y;for(let v=0;v<80;v++){v<40?v<20?(p=f^l&(u^f),y=1518500249):(p=l^u^f,y=1859775393):v<60?(p=l&u|f&(l|u),y=2400959708):(p=l^u^f,y=3395469782);const E=(a<<5|a>>>27)+p+g+y+r[v]&4294967295;g=f,f=u,u=(l<<30|l>>>2)&4294967295,l=a,a=E}this.chain_[0]=this.chain_[0]+a&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+f&4294967295,this.chain_[4]=this.chain_[4]+g&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);const r=t-this.blockSize;let a=0;const l=this.buf_;let u=this.inbuf_;for(;a<t;){if(u===0)for(;a<=r;)this.compress_(e,a),a+=this.blockSize;if(typeof e=="string"){for(;a<t;)if(l[u]=e.charCodeAt(a),++u,++a,u===this.blockSize){this.compress_(l),u=0;break}}else for(;a<t;)if(l[u]=e[a],++u,++a,u===this.blockSize){this.compress_(l),u=0;break}}this.inbuf_=u,this.total_+=t}digest(){const e=[];let t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let a=this.blockSize-1;a>=56;a--)this.buf_[a]=t&255,t/=256;this.compress_(this.buf_);let r=0;for(let a=0;a<5;a++)for(let l=24;l>=0;l-=8)e[r]=this.chain_[a]>>l&255,++r;return e}}function lA(n,e){const t=new cA(n,e);return t.subscribe.bind(t)}class cA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let a;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");uA(e,["next","error","complete"])?a=e:a={next:e,error:t,complete:r},a.next===void 0&&(a.next=op),a.error===void 0&&(a.error=op),a.complete===void 0&&(a.complete=op);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function uA(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function op(){}function hA(n,e){return`${n} failed: ${e} argument `}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dA=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let a=n.charCodeAt(r);if(a>=55296&&a<=56319){const l=a-55296;r++,_e(r<n.length,"Surrogate pair missing trail surrogate.");const u=n.charCodeAt(r)-56320;a=65536+(l<<10)+u}a<128?e[t++]=a:a<2048?(e[t++]=a>>6|192,e[t++]=a&63|128):a<65536?(e[t++]=a>>12|224,e[t++]=a>>6&63|128,e[t++]=a&63|128):(e[t++]=a>>18|240,e[t++]=a>>12&63|128,e[t++]=a>>6&63|128,e[t++]=a&63|128)}return e},Id=function(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,t++):e+=3}return e};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(n){return n&&n._delegate?n._delegate:n}class Ti{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ha="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fA{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new pm;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:t});a&&r.resolve(a)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),a=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(l){if(a)return null;throw l}else{if(a)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(pA(e))try{this.getOrInitializeService({instanceIdentifier:ha})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(t);try{const l=this.getOrInitializeService({instanceIdentifier:a});r.resolve(l)}catch{}}}}clearInstance(e=ha){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=ha){return this.instances.has(e)}getOptions(e=ha){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[l,u]of this.instancesDeferred.entries()){const f=this.normalizeInstanceIdentifier(l);r===f&&u.resolve(a)}return a}onInit(e,t){var r;const a=this.normalizeInstanceIdentifier(t),l=(r=this.onInitCallbacks.get(a))!==null&&r!==void 0?r:new Set;l.add(e),this.onInitCallbacks.set(a,l);const u=this.instances.get(a);return u&&e(u,a),()=>{l.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const a of r)try{a(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:gA(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=ha){return this.component?this.component.multipleInstances?e:ha:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function gA(n){return n===ha?void 0:n}function pA(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mA{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new fA(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ge;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Ge||(Ge={}));const yA={debug:Ge.DEBUG,verbose:Ge.VERBOSE,info:Ge.INFO,warn:Ge.WARN,error:Ge.ERROR,silent:Ge.SILENT},_A=Ge.INFO,vA={[Ge.DEBUG]:"log",[Ge.VERBOSE]:"log",[Ge.INFO]:"info",[Ge.WARN]:"warn",[Ge.ERROR]:"error"},wA=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),a=vA[e];if(a)console[a](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class Rd{constructor(e){this.name=e,this._logLevel=_A,this._logHandler=wA,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Ge))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?yA[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Ge.DEBUG,...e),this._logHandler(this,Ge.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Ge.VERBOSE,...e),this._logHandler(this,Ge.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Ge.INFO,...e),this._logHandler(this,Ge.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Ge.WARN,...e),this._logHandler(this,Ge.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Ge.ERROR,...e),this._logHandler(this,Ge.ERROR,...e)}}const TA=(n,e)=>e.some(t=>n instanceof t);let nw,sw;function bA(){return nw||(nw=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function EA(){return sw||(sw=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rb=new WeakMap,Sp=new WeakMap,Nb=new WeakMap,lp=new WeakMap,_m=new WeakMap;function SA(n){const e=new Promise((t,r)=>{const a=()=>{n.removeEventListener("success",l),n.removeEventListener("error",u)},l=()=>{t(mi(n.result)),a()},u=()=>{r(n.error),a()};n.addEventListener("success",l),n.addEventListener("error",u)});return e.then(t=>{t instanceof IDBCursor&&Rb.set(t,n)}).catch(()=>{}),_m.set(e,n),e}function xA(n){if(Sp.has(n))return;const e=new Promise((t,r)=>{const a=()=>{n.removeEventListener("complete",l),n.removeEventListener("error",u),n.removeEventListener("abort",u)},l=()=>{t(),a()},u=()=>{r(n.error||new DOMException("AbortError","AbortError")),a()};n.addEventListener("complete",l),n.addEventListener("error",u),n.addEventListener("abort",u)});Sp.set(n,e)}let xp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Sp.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Nb.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return mi(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function CA(n){xp=n(xp)}function AA(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(cp(this),e,...t);return Nb.set(r,e.sort?e.sort():[e]),mi(r)}:EA().includes(n)?function(...e){return n.apply(cp(this),e),mi(Rb.get(this))}:function(...e){return mi(n.apply(cp(this),e))}}function IA(n){return typeof n=="function"?AA(n):(n instanceof IDBTransaction&&xA(n),TA(n,bA())?new Proxy(n,xp):n)}function mi(n){if(n instanceof IDBRequest)return SA(n);if(lp.has(n))return lp.get(n);const e=IA(n);return e!==n&&(lp.set(n,e),_m.set(e,n)),e}const cp=n=>_m.get(n);function RA(n,e,{blocked:t,upgrade:r,blocking:a,terminated:l}={}){const u=indexedDB.open(n,e),f=mi(u);return r&&u.addEventListener("upgradeneeded",g=>{r(mi(u.result),g.oldVersion,g.newVersion,mi(u.transaction),g)}),t&&u.addEventListener("blocked",g=>t(g.oldVersion,g.newVersion,g)),f.then(g=>{l&&g.addEventListener("close",()=>l()),a&&g.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),f}const NA=["get","getKey","getAll","getAllKeys","count"],PA=["put","add","delete","clear"],up=new Map;function rw(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(up.get(e))return up.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,a=PA.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(a||NA.includes(t)))return;const l=async function(u,...f){const g=this.transaction(u,a?"readwrite":"readonly");let p=g.store;return r&&(p=p.index(f.shift())),(await Promise.all([p[t](...f),a&&g.done]))[0]};return up.set(e,l),l}CA(n=>({...n,get:(e,t,r)=>rw(e,t)||n.get(e,t,r),has:(e,t)=>!!rw(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kA{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(DA(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function DA(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Cp="@firebase/app",iw="0.11.4";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kr=new Rd("@firebase/app"),MA="@firebase/app-compat",OA="@firebase/analytics-compat",LA="@firebase/analytics",VA="@firebase/app-check-compat",jA="@firebase/app-check",UA="@firebase/auth",zA="@firebase/auth-compat",BA="@firebase/database",FA="@firebase/data-connect",qA="@firebase/database-compat",HA="@firebase/functions",GA="@firebase/functions-compat",$A="@firebase/installations",KA="@firebase/installations-compat",QA="@firebase/messaging",YA="@firebase/messaging-compat",WA="@firebase/performance",XA="@firebase/performance-compat",ZA="@firebase/remote-config",JA="@firebase/remote-config-compat",eI="@firebase/storage",tI="@firebase/storage-compat",nI="@firebase/firestore",sI="@firebase/vertexai",rI="@firebase/firestore-compat",iI="firebase",aI="11.6.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ap="[DEFAULT]",oI={[Cp]:"fire-core",[MA]:"fire-core-compat",[LA]:"fire-analytics",[OA]:"fire-analytics-compat",[jA]:"fire-app-check",[VA]:"fire-app-check-compat",[UA]:"fire-auth",[zA]:"fire-auth-compat",[BA]:"fire-rtdb",[FA]:"fire-data-connect",[qA]:"fire-rtdb-compat",[HA]:"fire-fn",[GA]:"fire-fn-compat",[$A]:"fire-iid",[KA]:"fire-iid-compat",[QA]:"fire-fcm",[YA]:"fire-fcm-compat",[WA]:"fire-perf",[XA]:"fire-perf-compat",[ZA]:"fire-rc",[JA]:"fire-rc-compat",[eI]:"fire-gcs",[tI]:"fire-gcs-compat",[nI]:"fire-fst",[rI]:"fire-fst-compat",[sI]:"fire-vertex","fire-js":"fire-js",[iI]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dc=new Map,lI=new Map,Ip=new Map;function aw(n,e){try{n.container.addComponent(e)}catch(t){kr.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ma(n){const e=n.name;if(Ip.has(e))return kr.debug(`There were multiple attempts to register component ${e}.`),!1;Ip.set(e,n);for(const t of Dc.values())aw(t,n);for(const t of lI.values())aw(t,n);return!0}function Nd(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function Ar(n){return n==null?!1:n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cI={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},yi=new Hc("app","Firebase",cI);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uI{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ti("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw yi.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gc=aI;function Pb(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Ap,automaticDataCollectionEnabled:!1},e),a=r.name;if(typeof a!="string"||!a)throw yi.create("bad-app-name",{appName:String(a)});if(t||(t=xb()),!t)throw yi.create("no-options");const l=Dc.get(a);if(l){if(Pr(t,l.options)&&Pr(r,l.config))return l;throw yi.create("duplicate-app",{appName:a})}const u=new mA(a);for(const g of Ip.values())u.addComponent(g);const f=new uI(t,r,u);return Dc.set(a,f),f}function vm(n=Ap){const e=Dc.get(n);if(!e&&n===Ap&&xb())return Pb();if(!e)throw yi.create("no-app",{appName:n});return e}function ow(){return Array.from(Dc.values())}function Ys(n,e,t){var r;let a=(r=oI[n])!==null&&r!==void 0?r:n;t&&(a+=`-${t}`);const l=a.match(/\s|\//),u=e.match(/\s|\//);if(l||u){const f=[`Unable to register library "${a}" with version "${e}":`];l&&f.push(`library name "${a}" contains illegal characters (whitespace or "/")`),l&&u&&f.push("and"),u&&f.push(`version name "${e}" contains illegal characters (whitespace or "/")`),kr.warn(f.join(" "));return}ma(new Ti(`${a}-version`,()=>({library:a,version:e}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hI="firebase-heartbeat-database",dI=1,Mc="firebase-heartbeat-store";let hp=null;function kb(){return hp||(hp=RA(hI,dI,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Mc)}catch(t){console.warn(t)}}}}).catch(n=>{throw yi.create("idb-open",{originalErrorMessage:n.message})})),hp}async function fI(n){try{const t=(await kb()).transaction(Mc),r=await t.objectStore(Mc).get(Db(n));return await t.done,r}catch(e){if(e instanceof Ri)kr.warn(e.message);else{const t=yi.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});kr.warn(t.message)}}}async function lw(n,e){try{const r=(await kb()).transaction(Mc,"readwrite");await r.objectStore(Mc).put(e,Db(n)),await r.done}catch(t){if(t instanceof Ri)kr.warn(t.message);else{const r=yi.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});kr.warn(r.message)}}}function Db(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gI=1024,pI=30;class mI{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new _I(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const a=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),l=cw();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===l||this._heartbeatsCache.heartbeats.some(u=>u.date===l))return;if(this._heartbeatsCache.heartbeats.push({date:l,agent:a}),this._heartbeatsCache.heartbeats.length>pI){const u=vI(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(u,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){kr.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=cw(),{heartbeatsToSend:r,unsentEntries:a}=yI(this._heartbeatsCache.heartbeats),l=Yh(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),l}catch(t){return kr.warn(t),""}}}function cw(){return new Date().toISOString().substring(0,10)}function yI(n,e=gI){const t=[];let r=n.slice();for(const a of n){const l=t.find(u=>u.agent===a.agent);if(l){if(l.dates.push(a.date),uw(t)>e){l.dates.pop();break}}else if(t.push({agent:a.agent,dates:[a.date]}),uw(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class _I{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return eA()?tA().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await fI(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return lw(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const a=await this.read();return lw(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:a.lastSentHeartbeatDate,heartbeats:[...a.heartbeats,...e.heartbeats]})}else return}}function uw(n){return Yh(JSON.stringify({version:2,heartbeats:n})).length}function vI(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wI(n){ma(new Ti("platform-logger",e=>new kA(e),"PRIVATE")),ma(new Ti("heartbeat",e=>new mI(e),"PRIVATE")),Ys(Cp,iw,n),Ys(Cp,iw,"esm2017"),Ys("fire-js","")}wI("");var TI="firebase",bI="11.6.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ys(TI,bI,"app");function Mb(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,r=Object.getOwnPropertySymbols(n);a<r.length;a++)e.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(n,r[a])&&(t[r[a]]=n[r[a]]);return t}function Ob(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Lb=Ob,Vb=new Hc("auth","Firebase",Ob());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zh=new Rd("@firebase/auth");function EI(n,...e){Zh.logLevel<=Ge.WARN&&Zh.warn(`Auth (${Gc}): ${n}`,...e)}function zh(n,...e){Zh.logLevel<=Ge.ERROR&&Zh.error(`Auth (${Gc}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jh(n,...e){throw wm(n,...e)}function jb(n,...e){return wm(n,...e)}function Ub(n,e,t){const r=Object.assign(Object.assign({},Lb()),{[e]:t});return new Hc("auth","Firebase",r).create(e,{appName:n.name})}function wc(n){return Ub(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function wm(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return Vb.create(n,...e)}function et(n,e,...t){if(!n)throw wm(e,...t)}function Tc(n){const e="INTERNAL ASSERTION FAILED: "+n;throw zh(e),new Error(e)}function ed(n,e){n||Tc(e)}function SI(){return hw()==="http:"||hw()==="https:"}function hw(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xI(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(SI()||XC()||"connection"in navigator)?navigator.onLine:!0}function CI(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AI{constructor(e,t){this.shortDelay=e,this.longDelay=t,ed(t>e,"Short delay should be less than long delay!"),this.isMobile=mm()||Ab()}get(){return xI()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function II(n,e){ed(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zb{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Tc("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Tc("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Tc("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RI={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NI=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],PI=new AI(3e4,6e4);function Tm(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function $c(n,e,t,r,a={}){return Bb(n,a,async()=>{let l={},u={};r&&(e==="GET"?u=r:l={body:JSON.stringify(r)});const f=ym(Object.assign({key:n.config.apiKey},u)).slice(1),g=await n._getAdditionalHeaders();g["Content-Type"]="application/json",n.languageCode&&(g["X-Firebase-Locale"]=n.languageCode);const p=Object.assign({method:e,headers:g},l);return WC()||(p.referrerPolicy="no-referrer"),zb.fetch()(await Fb(n,n.config.apiHost,t,f),p)})}async function Bb(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},RI),e);try{const a=new DI(n),l=await Promise.race([t(),a.promise]);a.clearNetworkTimeout();const u=await l.json();if("needConfirmation"in u)throw Rh(n,"account-exists-with-different-credential",u);if(l.ok&&!("errorMessage"in u))return u;{const f=l.ok?u.errorMessage:u.error.message,[g,p]=f.split(" : ");if(g==="FEDERATED_USER_ID_ALREADY_LINKED")throw Rh(n,"credential-already-in-use",u);if(g==="EMAIL_EXISTS")throw Rh(n,"email-already-in-use",u);if(g==="USER_DISABLED")throw Rh(n,"user-disabled",u);const y=r[g]||g.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw Ub(n,y,p);Jh(n,y)}}catch(a){if(a instanceof Ri)throw a;Jh(n,"network-request-failed",{message:String(a)})}}async function kI(n,e,t,r,a={}){const l=await $c(n,e,t,r,a);return"mfaPendingCredential"in l&&Jh(n,"multi-factor-auth-required",{_serverResponse:l}),l}async function Fb(n,e,t,r){const a=`${e}${t}?${r}`,l=n,u=l.config.emulator?II(n.config,a):`${n.config.apiScheme}://${a}`;return NI.includes(t)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(u).toString():u}class DI{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(jb(this.auth,"network-request-failed")),PI.get())})}}function Rh(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const a=jb(n,e,r);return a.customData._tokenResponse=t,a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MI(n,e){return $c(n,"POST","/v1/accounts:delete",e)}async function td(n,e){return $c(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bc(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function qb(n,e=!1){const t=dn(n),r=await t.getIdToken(e),a=Hb(r);et(a&&a.exp&&a.auth_time&&a.iat,t.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,u=l==null?void 0:l.sign_in_provider;return{claims:a,token:r,authTime:bc(dp(a.auth_time)),issuedAtTime:bc(dp(a.iat)),expirationTime:bc(dp(a.exp)),signInProvider:u||null,signInSecondFactor:(l==null?void 0:l.sign_in_second_factor)||null}}function dp(n){return Number(n)*1e3}function Hb(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return zh("JWT malformed, contained fewer than 3 sections"),null;try{const a=Wh(t);return a?JSON.parse(a):(zh("Failed to decode base64 JWT payload"),null)}catch(a){return zh("Caught error parsing JWT payload as JSON",a==null?void 0:a.toString()),null}}function dw(n){const e=Hb(n);return et(e,"internal-error"),et(typeof e.exp<"u","internal-error"),et(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rp(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Ri&&OI(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function OI({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const a=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,a)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Np{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=bc(this.lastLoginAt),this.creationTime=bc(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nd(n){var e;const t=n.auth,r=await n.getIdToken(),a=await Rp(n,td(t,{idToken:r}));et(a==null?void 0:a.users.length,t,"internal-error");const l=a.users[0];n._notifyReloadListener(l);const u=!((e=l.providerUserInfo)===null||e===void 0)&&e.length?$b(l.providerUserInfo):[],f=VI(n.providerData,u),g=n.isAnonymous,p=!(n.email&&l.passwordHash)&&!(f!=null&&f.length),y=g?p:!1,v={uid:l.localId,displayName:l.displayName||null,photoURL:l.photoUrl||null,email:l.email||null,emailVerified:l.emailVerified||!1,phoneNumber:l.phoneNumber||null,tenantId:l.tenantId||null,providerData:f,metadata:new Np(l.createdAt,l.lastLoginAt),isAnonymous:y};Object.assign(n,v)}async function Gb(n){const e=dn(n);await nd(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function VI(n,e){return[...n.filter(r=>!e.some(a=>a.providerId===r.providerId)),...e]}function $b(n){return n.map(e=>{var{providerId:t}=e,r=Mb(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jI(n,e){const t=await Bb(n,{},async()=>{const r=ym({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=n.config,u=await Fb(n,a,"/v1/token",`key=${l}`),f=await n._getAdditionalHeaders();return f["Content-Type"]="application/x-www-form-urlencoded",zb.fetch()(u,{method:"POST",headers:f,body:r})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function UI(n,e){return $c(n,"POST","/v2/accounts:revokeToken",Tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class No{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){et(e.idToken,"internal-error"),et(typeof e.idToken<"u","internal-error"),et(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):dw(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){et(e.length!==0,"internal-error");const t=dw(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(et(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:a,expiresIn:l}=await jI(e,t);this.updateTokensAndExpiration(r,a,Number(l))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:a,expirationTime:l}=t,u=new No;return r&&(et(typeof r=="string","internal-error",{appName:e}),u.refreshToken=r),a&&(et(typeof a=="string","internal-error",{appName:e}),u.accessToken=a),l&&(et(typeof l=="number","internal-error",{appName:e}),u.expirationTime=l),u}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new No,this.toJSON())}_performRefresh(){return Tc("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function di(n,e){et(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class xs{constructor(e){var{uid:t,auth:r,stsTokenManager:a}=e,l=Mb(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new LI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=a,this.accessToken=a.accessToken,this.displayName=l.displayName||null,this.email=l.email||null,this.emailVerified=l.emailVerified||!1,this.phoneNumber=l.phoneNumber||null,this.photoURL=l.photoURL||null,this.isAnonymous=l.isAnonymous||!1,this.tenantId=l.tenantId||null,this.providerData=l.providerData?[...l.providerData]:[],this.metadata=new Np(l.createdAt||void 0,l.lastLoginAt||void 0)}async getIdToken(e){const t=await Rp(this,this.stsTokenManager.getToken(this.auth,e));return et(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return qb(this,e)}reload(){return Gb(this)}_assign(e){this!==e&&(et(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new xs(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){et(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await nd(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ar(this.auth.app))return Promise.reject(wc(this.auth));const e=await this.getIdToken();return await Rp(this,MI(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,a,l,u,f,g,p,y;const v=(r=t.displayName)!==null&&r!==void 0?r:void 0,E=(a=t.email)!==null&&a!==void 0?a:void 0,S=(l=t.phoneNumber)!==null&&l!==void 0?l:void 0,D=(u=t.photoURL)!==null&&u!==void 0?u:void 0,j=(f=t.tenantId)!==null&&f!==void 0?f:void 0,k=(g=t._redirectEventId)!==null&&g!==void 0?g:void 0,P=(p=t.createdAt)!==null&&p!==void 0?p:void 0,z=(y=t.lastLoginAt)!==null&&y!==void 0?y:void 0,{uid:U,emailVerified:W,isAnonymous:ne,providerData:re,stsTokenManager:M}=t;et(U&&M,e,"internal-error");const N=No.fromJSON(this.name,M);et(typeof U=="string",e,"internal-error"),di(v,e.name),di(E,e.name),et(typeof W=="boolean",e,"internal-error"),et(typeof ne=="boolean",e,"internal-error"),di(S,e.name),di(D,e.name),di(j,e.name),di(k,e.name),di(P,e.name),di(z,e.name);const I=new xs({uid:U,auth:e,email:E,emailVerified:W,displayName:v,isAnonymous:ne,photoURL:D,phoneNumber:S,tenantId:j,stsTokenManager:N,createdAt:P,lastLoginAt:z});return re&&Array.isArray(re)&&(I.providerData=re.map(O=>Object.assign({},O))),k&&(I._redirectEventId=k),I}static async _fromIdTokenResponse(e,t,r=!1){const a=new No;a.updateFromServerResponse(t);const l=new xs({uid:t.localId,auth:e,stsTokenManager:a,isAnonymous:r});return await nd(l),l}static async _fromGetAccountInfoResponse(e,t,r){const a=t.users[0];et(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?$b(a.providerUserInfo):[],u=!(a.email&&a.passwordHash)&&!(l!=null&&l.length),f=new No;f.updateFromIdToken(r);const g=new xs({uid:a.localId,auth:e,stsTokenManager:f,isAnonymous:u}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new Np(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!(l!=null&&l.length)};return Object.assign(g,p),g}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fw=new Map;function fa(n){ed(n instanceof Function,"Expected a class definition");let e=fw.get(n);return e?(ed(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,fw.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kb{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Kb.type="NONE";const Pp=Kb;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fp(n,e,t){return`firebase:${n}:${e}:${t}`}class Po{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:a,name:l}=this.auth;this.fullUserKey=fp(this.userKey,a.apiKey,l),this.fullPersistenceKey=fp("persistence",a.apiKey,l),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await td(this.auth,{idToken:e}).catch(()=>{});return t?xs._fromGetAccountInfoResponse(this.auth,t,e):null}return xs._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Po(fa(Pp),e,r);const a=(await Promise.all(t.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||fa(Pp);const u=fp(r,e.config.apiKey,e.name);let f=null;for(const p of t)try{const y=await p._get(u);if(y){let v;if(typeof y=="string"){const E=await td(e,{idToken:y}).catch(()=>{});if(!E)break;v=await xs._fromGetAccountInfoResponse(e,E,y)}else v=xs._fromJSON(e,y);p!==l&&(f=v),l=p;break}}catch{}const g=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!g.length?new Po(l,e,r):(l=g[0],f&&await l._set(u,f.toJSON()),await Promise.all(t.map(async p=>{if(p!==l)try{await p._remove(u)}catch{}})),new Po(l,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(qI(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(zI(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(GI(e))return"Blackberry";if($I(e))return"Webos";if(BI(e))return"Safari";if((e.includes("chrome/")||FI(e))&&!e.includes("edge/"))return"Chrome";if(HI(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function zI(n=Rs()){return/firefox\//i.test(n)}function BI(n=Rs()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function FI(n=Rs()){return/crios\//i.test(n)}function qI(n=Rs()){return/iemobile/i.test(n)}function HI(n=Rs()){return/android/i.test(n)}function GI(n=Rs()){return/blackberry/i.test(n)}function $I(n=Rs()){return/webos/i.test(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qb(n,e=[]){let t;switch(n){case"Browser":t=gw(Rs());break;case"Worker":t=`${gw(Rs())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Gc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KI{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=l=>new Promise((u,f)=>{try{const g=e(l);u(g)}catch(g){f(g)}});r.onAbort=t,this.queue.push(r);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const a of t)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function QI(n,e={}){return $c(n,"GET","/v2/passwordPolicy",Tm(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YI=6;class WI{constructor(e){var t,r,a,l;const u=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=u.minPasswordLength)!==null&&t!==void 0?t:YI,u.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=u.maxPasswordLength),u.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=u.containsLowercaseCharacter),u.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=u.containsUppercaseCharacter),u.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=u.containsNumericCharacter),u.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=u.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(a=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&a!==void 0?a:"",this.forceUpgradeOnSignin=(l=e.forceUpgradeOnSignin)!==null&&l!==void 0?l:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,a,l,u,f;const g={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,g),this.validatePasswordCharacterOptions(e,g),g.isValid&&(g.isValid=(t=g.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),g.isValid&&(g.isValid=(r=g.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),g.isValid&&(g.isValid=(a=g.containsLowercaseLetter)!==null&&a!==void 0?a:!0),g.isValid&&(g.isValid=(l=g.containsUppercaseLetter)!==null&&l!==void 0?l:!0),g.isValid&&(g.isValid=(u=g.containsNumericCharacter)!==null&&u!==void 0?u:!0),g.isValid&&(g.isValid=(f=g.containsNonAlphanumericCharacter)!==null&&f!==void 0?f:!0),g}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),a&&(t.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let a=0;a<e.length;a++)r=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XI{constructor(e,t,r,a){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new pw(this),this.idTokenSubscription=new pw(this),this.beforeStateQueue=new KI(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Vb,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=fa(t)),this._initializationPromise=this.queue(async()=>{var r,a,l;if(!this._deleted&&(this.persistenceManager=await Po.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((a=this._popupRedirectResolver)===null||a===void 0)&&a._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((l=this.currentUser)===null||l===void 0?void 0:l.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await td(this,{idToken:e}),r=await xs._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Ar(this.app)){const u=this.app.settings.authIdToken;return u?new Promise(f=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(u).then(f,f))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let a=r,l=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const u=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,f=a==null?void 0:a._redirectEventId,g=await this.tryRedirectSignIn(e);(!u||u===f)&&(g!=null&&g.user)&&(a=g.user,l=!0)}if(!a)return this.directlySetCurrentUser(null);if(!a._redirectEventId){if(l)try{await this.beforeStateQueue.runMiddleware(a)}catch(u){a=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(u))}return a?this.reloadAndSetCurrentUserOrClear(a):this.directlySetCurrentUser(null)}return et(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===a._redirectEventId?this.directlySetCurrentUser(a):this.reloadAndSetCurrentUserOrClear(a)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nd(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=CI()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Ar(this.app))return Promise.reject(wc(this));const t=e?dn(e):null;return t&&et(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&et(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Ar(this.app)?Promise.reject(wc(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Ar(this.app)?Promise.reject(wc(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(fa(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await QI(this),t=new WI(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Hc("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await UI(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&fa(e)||this._popupRedirectResolver;et(t,this,"argument-error"),this.redirectPersistenceManager=await Po.create(this,[fa(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,a){if(this._deleted)return()=>{};const l=typeof t=="function"?t:t.next.bind(t);let u=!1;const f=this._isInitialized?Promise.resolve():this._initializationPromise;if(et(f,this,"internal-error"),f.then(()=>{u||l(this.currentUser)}),typeof t=="function"){const g=e.addObserver(t,r,a);return()=>{u=!0,g()}}else{const g=e.addObserver(t);return()=>{u=!0,g()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return et(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Qb(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const a=await this._getAppCheckToken();return a&&(t["X-Firebase-AppCheck"]=a),t}async _getAppCheckToken(){var e;if(Ar(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&EI(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function bm(n){return dn(n)}class pw{constructor(e){this.auth=e,this.observer=null,this.addObserver=lA(t=>this.observer=t)}get next(){return et(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yb(n,e){const t=Nd(n,"auth");if(t.isInitialized()){const a=t.getImmediate(),l=t.getOptions();if(Pr(l,e??{}))return a;Jh(a,"already-initialized")}return t.initialize({options:e})}function ZI(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(fa);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Wb(n,e,t){const r=bm(n);et(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const a=!1,l=Xb(e),{host:u,port:f}=JI(e),g=f===null?"":`:${f}`,p={url:`${l}//${u}${g}/`},y=Object.freeze({host:u,port:f,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!r._canInitEmulator){et(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),et(Pr(p,r.config.emulator)&&Pr(y,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=p,r.emulatorConfig=y,r.settings.appVerificationDisabledForTesting=!0,eR()}function Xb(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function JI(n){const e=Xb(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(r);if(a){const l=a[1];return{host:l,port:mw(r.substr(l.length+1))}}else{const[l,u]=r.split(":");return{host:l,port:mw(u)}}}function mw(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function eR(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,a=!1){const l=await xs._fromIdTokenResponse(e,r,a),u=yw(r);return new sd({user:l,providerId:u,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const a=yw(r);return new sd({user:e,providerId:a,_tokenResponse:r,operationType:t})}}function yw(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tR(n,e){return kI(n,"POST","/v1/accounts:signInWithCustomToken",Tm(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zb(n,e){if(Ar(n.app))return Promise.reject(wc(n));const t=bm(n),r=await tR(t,{token:e,returnSecureToken:!0}),a=await sd._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(a.user),a}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jb(n,e){return dn(n).setPersistence(e)}function nR(n){return dn(n).signOut()}const _w="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sR(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(a=>a.isListeningto(e));if(t)return t;const r=new Pd(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:a,data:l}=t.data,u=this.handlersMap[a];if(!(u!=null&&u.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:a});const f=Array.from(u).map(async p=>p(t.origin,l)),g=await sR(f);t.ports[0].postMessage({status:"done",eventId:r,eventType:a,response:g})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Pd.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rR(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iR{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,u;return new Promise((f,g)=>{const p=rR("",20);a.port1.start();const y=setTimeout(()=>{g(new Error("unsupported_event"))},r);u={messageChannel:a,onMessage(v){const E=v;if(E.data.eventId===p)switch(E.data.status){case"ack":clearTimeout(y),l=setTimeout(()=>{g(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),f(E.data.response);break;default:clearTimeout(y),clearTimeout(l),g(new Error("invalid_response"));break}}},this.handlers.add(u),a.port1.addEventListener("message",u.onMessage),this.target.postMessage({eventType:e,eventId:p,data:t},[a.port2])}).finally(()=>{u&&this.removeMessageHandler(u)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vw(){return window}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eE(){return typeof vw().WorkerGlobalScope<"u"&&typeof vw().importScripts=="function"}async function aR(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function oR(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function lR(){return eE()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tE="firebaseLocalStorageDb",cR=1,rd="firebaseLocalStorage",nE="fbase_key";class Kc{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function kd(n,e){return n.transaction([rd],e?"readwrite":"readonly").objectStore(rd)}function uR(){const n=indexedDB.deleteDatabase(tE);return new Kc(n).toPromise()}function kp(){const n=indexedDB.open(tE,cR);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(rd,{keyPath:nE})}catch(a){t(a)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(rd)?e(r):(r.close(),await uR(),e(await kp()))})})}async function ww(n,e,t){const r=kd(n,!0).put({[nE]:e,value:t});return new Kc(r).toPromise()}async function hR(n,e){const t=kd(n,!1).get(e),r=await new Kc(t).toPromise();return r===void 0?null:r.value}function Tw(n,e){const t=kd(n,!0).delete(e);return new Kc(t).toPromise()}const dR=800,fR=3;class sE{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await kp(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>fR)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return eE()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Pd._getInstance(lR()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await aR(),!this.activeServiceWorker)return;this.sender=new iR(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||oR()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await kp();return await ww(e,_w,"1"),await Tw(e,_w),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>ww(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>hR(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>Tw(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=kd(a,!1).getAll();return new Kc(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)r.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),t.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!r.has(a)&&(this.notifyListeners(a,null),t.push(a));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const a of Array.from(r))a(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),dR)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}sE.type="LOCAL";const Em=sE;var bw="@firebase/auth",Ew="1.10.0";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){et(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pR(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function mR(n){ma(new Ti("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:u,authDomain:f}=r.options;et(u&&!u.includes(":"),"invalid-api-key",{appName:r.name});const g={apiKey:u,authDomain:f,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Qb(n)},p=new XI(r,a,l,g);return ZI(p,t),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),ma(new Ti("auth-internal",e=>{const t=bm(e.getProvider("auth").getImmediate());return(r=>new gR(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ys(bw,Ew,pR(n)),Ys(bw,Ew,"esm2017")}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rE(n=vm()){const e=Nd(n,"auth");if(e.isInitialized())return e.getImmediate();const t=Yb(n,{persistence:[Em]}),r=Eb("auth");return r&&Wb(t,`http://${r}`),t}mR("WebExtension");const Sw=Object.freeze(Object.defineProperty({__proto__:null,connectAuthEmulator:Wb,getAuth:rE,getIdTokenResult:qb,inMemoryPersistence:Pp,indexedDBLocalPersistence:Em,initializeAuth:Yb,prodErrorMap:Lb,reload:Gb,setPersistence:Jb,signInWithCustomToken:Zb,signOut:nR},Symbol.toStringTag,{value:"Module"}));var xw=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var _i,iE;(function(){var n;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(M,N){function I(){}I.prototype=N.prototype,M.D=N.prototype,M.prototype=new I,M.prototype.constructor=M,M.C=function(O,B,q){for(var L=Array(arguments.length-2),je=2;je<arguments.length;je++)L[je-2]=arguments[je];return N.prototype[B].apply(O,L)}}function t(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,t),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(M,N,I){I||(I=0);var O=Array(16);if(typeof N=="string")for(var B=0;16>B;++B)O[B]=N.charCodeAt(I++)|N.charCodeAt(I++)<<8|N.charCodeAt(I++)<<16|N.charCodeAt(I++)<<24;else for(B=0;16>B;++B)O[B]=N[I++]|N[I++]<<8|N[I++]<<16|N[I++]<<24;N=M.g[0],I=M.g[1],B=M.g[2];var q=M.g[3],L=N+(q^I&(B^q))+O[0]+3614090360&4294967295;N=I+(L<<7&4294967295|L>>>25),L=q+(B^N&(I^B))+O[1]+3905402710&4294967295,q=N+(L<<12&4294967295|L>>>20),L=B+(I^q&(N^I))+O[2]+606105819&4294967295,B=q+(L<<17&4294967295|L>>>15),L=I+(N^B&(q^N))+O[3]+3250441966&4294967295,I=B+(L<<22&4294967295|L>>>10),L=N+(q^I&(B^q))+O[4]+4118548399&4294967295,N=I+(L<<7&4294967295|L>>>25),L=q+(B^N&(I^B))+O[5]+1200080426&4294967295,q=N+(L<<12&4294967295|L>>>20),L=B+(I^q&(N^I))+O[6]+2821735955&4294967295,B=q+(L<<17&4294967295|L>>>15),L=I+(N^B&(q^N))+O[7]+4249261313&4294967295,I=B+(L<<22&4294967295|L>>>10),L=N+(q^I&(B^q))+O[8]+1770035416&4294967295,N=I+(L<<7&4294967295|L>>>25),L=q+(B^N&(I^B))+O[9]+2336552879&4294967295,q=N+(L<<12&4294967295|L>>>20),L=B+(I^q&(N^I))+O[10]+4294925233&4294967295,B=q+(L<<17&4294967295|L>>>15),L=I+(N^B&(q^N))+O[11]+2304563134&4294967295,I=B+(L<<22&4294967295|L>>>10),L=N+(q^I&(B^q))+O[12]+1804603682&4294967295,N=I+(L<<7&4294967295|L>>>25),L=q+(B^N&(I^B))+O[13]+4254626195&4294967295,q=N+(L<<12&4294967295|L>>>20),L=B+(I^q&(N^I))+O[14]+2792965006&4294967295,B=q+(L<<17&4294967295|L>>>15),L=I+(N^B&(q^N))+O[15]+1236535329&4294967295,I=B+(L<<22&4294967295|L>>>10),L=N+(B^q&(I^B))+O[1]+4129170786&4294967295,N=I+(L<<5&4294967295|L>>>27),L=q+(I^B&(N^I))+O[6]+3225465664&4294967295,q=N+(L<<9&4294967295|L>>>23),L=B+(N^I&(q^N))+O[11]+643717713&4294967295,B=q+(L<<14&4294967295|L>>>18),L=I+(q^N&(B^q))+O[0]+3921069994&4294967295,I=B+(L<<20&4294967295|L>>>12),L=N+(B^q&(I^B))+O[5]+3593408605&4294967295,N=I+(L<<5&4294967295|L>>>27),L=q+(I^B&(N^I))+O[10]+38016083&4294967295,q=N+(L<<9&4294967295|L>>>23),L=B+(N^I&(q^N))+O[15]+3634488961&4294967295,B=q+(L<<14&4294967295|L>>>18),L=I+(q^N&(B^q))+O[4]+3889429448&4294967295,I=B+(L<<20&4294967295|L>>>12),L=N+(B^q&(I^B))+O[9]+568446438&4294967295,N=I+(L<<5&4294967295|L>>>27),L=q+(I^B&(N^I))+O[14]+3275163606&4294967295,q=N+(L<<9&4294967295|L>>>23),L=B+(N^I&(q^N))+O[3]+4107603335&4294967295,B=q+(L<<14&4294967295|L>>>18),L=I+(q^N&(B^q))+O[8]+1163531501&4294967295,I=B+(L<<20&4294967295|L>>>12),L=N+(B^q&(I^B))+O[13]+2850285829&4294967295,N=I+(L<<5&4294967295|L>>>27),L=q+(I^B&(N^I))+O[2]+4243563512&4294967295,q=N+(L<<9&4294967295|L>>>23),L=B+(N^I&(q^N))+O[7]+1735328473&4294967295,B=q+(L<<14&4294967295|L>>>18),L=I+(q^N&(B^q))+O[12]+2368359562&4294967295,I=B+(L<<20&4294967295|L>>>12),L=N+(I^B^q)+O[5]+4294588738&4294967295,N=I+(L<<4&4294967295|L>>>28),L=q+(N^I^B)+O[8]+2272392833&4294967295,q=N+(L<<11&4294967295|L>>>21),L=B+(q^N^I)+O[11]+1839030562&4294967295,B=q+(L<<16&4294967295|L>>>16),L=I+(B^q^N)+O[14]+4259657740&4294967295,I=B+(L<<23&4294967295|L>>>9),L=N+(I^B^q)+O[1]+2763975236&4294967295,N=I+(L<<4&4294967295|L>>>28),L=q+(N^I^B)+O[4]+1272893353&4294967295,q=N+(L<<11&4294967295|L>>>21),L=B+(q^N^I)+O[7]+4139469664&4294967295,B=q+(L<<16&4294967295|L>>>16),L=I+(B^q^N)+O[10]+3200236656&4294967295,I=B+(L<<23&4294967295|L>>>9),L=N+(I^B^q)+O[13]+681279174&4294967295,N=I+(L<<4&4294967295|L>>>28),L=q+(N^I^B)+O[0]+3936430074&4294967295,q=N+(L<<11&4294967295|L>>>21),L=B+(q^N^I)+O[3]+3572445317&4294967295,B=q+(L<<16&4294967295|L>>>16),L=I+(B^q^N)+O[6]+76029189&4294967295,I=B+(L<<23&4294967295|L>>>9),L=N+(I^B^q)+O[9]+3654602809&4294967295,N=I+(L<<4&4294967295|L>>>28),L=q+(N^I^B)+O[12]+3873151461&4294967295,q=N+(L<<11&4294967295|L>>>21),L=B+(q^N^I)+O[15]+530742520&4294967295,B=q+(L<<16&4294967295|L>>>16),L=I+(B^q^N)+O[2]+3299628645&4294967295,I=B+(L<<23&4294967295|L>>>9),L=N+(B^(I|~q))+O[0]+4096336452&4294967295,N=I+(L<<6&4294967295|L>>>26),L=q+(I^(N|~B))+O[7]+1126891415&4294967295,q=N+(L<<10&4294967295|L>>>22),L=B+(N^(q|~I))+O[14]+2878612391&4294967295,B=q+(L<<15&4294967295|L>>>17),L=I+(q^(B|~N))+O[5]+4237533241&4294967295,I=B+(L<<21&4294967295|L>>>11),L=N+(B^(I|~q))+O[12]+1700485571&4294967295,N=I+(L<<6&4294967295|L>>>26),L=q+(I^(N|~B))+O[3]+2399980690&4294967295,q=N+(L<<10&4294967295|L>>>22),L=B+(N^(q|~I))+O[10]+4293915773&4294967295,B=q+(L<<15&4294967295|L>>>17),L=I+(q^(B|~N))+O[1]+2240044497&4294967295,I=B+(L<<21&4294967295|L>>>11),L=N+(B^(I|~q))+O[8]+1873313359&4294967295,N=I+(L<<6&4294967295|L>>>26),L=q+(I^(N|~B))+O[15]+4264355552&4294967295,q=N+(L<<10&4294967295|L>>>22),L=B+(N^(q|~I))+O[6]+2734768916&4294967295,B=q+(L<<15&4294967295|L>>>17),L=I+(q^(B|~N))+O[13]+1309151649&4294967295,I=B+(L<<21&4294967295|L>>>11),L=N+(B^(I|~q))+O[4]+4149444226&4294967295,N=I+(L<<6&4294967295|L>>>26),L=q+(I^(N|~B))+O[11]+3174756917&4294967295,q=N+(L<<10&4294967295|L>>>22),L=B+(N^(q|~I))+O[2]+718787259&4294967295,B=q+(L<<15&4294967295|L>>>17),L=I+(q^(B|~N))+O[9]+3951481745&4294967295,M.g[0]=M.g[0]+N&4294967295,M.g[1]=M.g[1]+(B+(L<<21&4294967295|L>>>11))&4294967295,M.g[2]=M.g[2]+B&4294967295,M.g[3]=M.g[3]+q&4294967295}r.prototype.u=function(M,N){N===void 0&&(N=M.length);for(var I=N-this.blockSize,O=this.B,B=this.h,q=0;q<N;){if(B==0)for(;q<=I;)a(this,M,q),q+=this.blockSize;if(typeof M=="string"){for(;q<N;)if(O[B++]=M.charCodeAt(q++),B==this.blockSize){a(this,O),B=0;break}}else for(;q<N;)if(O[B++]=M[q++],B==this.blockSize){a(this,O),B=0;break}}this.h=B,this.o+=N},r.prototype.v=function(){var M=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);M[0]=128;for(var N=1;N<M.length-8;++N)M[N]=0;var I=8*this.o;for(N=M.length-8;N<M.length;++N)M[N]=I&255,I/=256;for(this.u(M),M=Array(16),N=I=0;4>N;++N)for(var O=0;32>O;O+=8)M[I++]=this.g[N]>>>O&255;return M};function l(M,N){var I=f;return Object.prototype.hasOwnProperty.call(I,M)?I[M]:I[M]=N(M)}function u(M,N){this.h=N;for(var I=[],O=!0,B=M.length-1;0<=B;B--){var q=M[B]|0;O&&q==N||(I[B]=q,O=!1)}this.g=I}var f={};function g(M){return-128<=M&&128>M?l(M,function(N){return new u([N|0],0>N?-1:0)}):new u([M|0],0>M?-1:0)}function p(M){if(isNaN(M)||!isFinite(M))return v;if(0>M)return k(p(-M));for(var N=[],I=1,O=0;M>=I;O++)N[O]=M/I|0,I*=4294967296;return new u(N,0)}function y(M,N){if(M.length==0)throw Error("number format error: empty string");if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(M.charAt(0)=="-")return k(y(M.substring(1),N));if(0<=M.indexOf("-"))throw Error('number format error: interior "-" character');for(var I=p(Math.pow(N,8)),O=v,B=0;B<M.length;B+=8){var q=Math.min(8,M.length-B),L=parseInt(M.substring(B,B+q),N);8>q?(q=p(Math.pow(N,q)),O=O.j(q).add(p(L))):(O=O.j(I),O=O.add(p(L)))}return O}var v=g(0),E=g(1),S=g(16777216);n=u.prototype,n.m=function(){if(j(this))return-k(this).m();for(var M=0,N=1,I=0;I<this.g.length;I++){var O=this.i(I);M+=(0<=O?O:4294967296+O)*N,N*=4294967296}return M},n.toString=function(M){if(M=M||10,2>M||36<M)throw Error("radix out of range: "+M);if(D(this))return"0";if(j(this))return"-"+k(this).toString(M);for(var N=p(Math.pow(M,6)),I=this,O="";;){var B=W(I,N).g;I=P(I,B.j(N));var q=((0<I.g.length?I.g[0]:I.h)>>>0).toString(M);if(I=B,D(I))return q+O;for(;6>q.length;)q="0"+q;O=q+O}},n.i=function(M){return 0>M?0:M<this.g.length?this.g[M]:this.h};function D(M){if(M.h!=0)return!1;for(var N=0;N<M.g.length;N++)if(M.g[N]!=0)return!1;return!0}function j(M){return M.h==-1}n.l=function(M){return M=P(this,M),j(M)?-1:D(M)?0:1};function k(M){for(var N=M.g.length,I=[],O=0;O<N;O++)I[O]=~M.g[O];return new u(I,~M.h).add(E)}n.abs=function(){return j(this)?k(this):this},n.add=function(M){for(var N=Math.max(this.g.length,M.g.length),I=[],O=0,B=0;B<=N;B++){var q=O+(this.i(B)&65535)+(M.i(B)&65535),L=(q>>>16)+(this.i(B)>>>16)+(M.i(B)>>>16);O=L>>>16,q&=65535,L&=65535,I[B]=L<<16|q}return new u(I,I[I.length-1]&-2147483648?-1:0)};function P(M,N){return M.add(k(N))}n.j=function(M){if(D(this)||D(M))return v;if(j(this))return j(M)?k(this).j(k(M)):k(k(this).j(M));if(j(M))return k(this.j(k(M)));if(0>this.l(S)&&0>M.l(S))return p(this.m()*M.m());for(var N=this.g.length+M.g.length,I=[],O=0;O<2*N;O++)I[O]=0;for(O=0;O<this.g.length;O++)for(var B=0;B<M.g.length;B++){var q=this.i(O)>>>16,L=this.i(O)&65535,je=M.i(B)>>>16,Ce=M.i(B)&65535;I[2*O+2*B]+=L*Ce,z(I,2*O+2*B),I[2*O+2*B+1]+=q*Ce,z(I,2*O+2*B+1),I[2*O+2*B+1]+=L*je,z(I,2*O+2*B+1),I[2*O+2*B+2]+=q*je,z(I,2*O+2*B+2)}for(O=0;O<N;O++)I[O]=I[2*O+1]<<16|I[2*O];for(O=N;O<2*N;O++)I[O]=0;return new u(I,0)};function z(M,N){for(;(M[N]&65535)!=M[N];)M[N+1]+=M[N]>>>16,M[N]&=65535,N++}function U(M,N){this.g=M,this.h=N}function W(M,N){if(D(N))throw Error("division by zero");if(D(M))return new U(v,v);if(j(M))return N=W(k(M),N),new U(k(N.g),k(N.h));if(j(N))return N=W(M,k(N)),new U(k(N.g),N.h);if(30<M.g.length){if(j(M)||j(N))throw Error("slowDivide_ only works with positive integers.");for(var I=E,O=N;0>=O.l(M);)I=ne(I),O=ne(O);var B=re(I,1),q=re(O,1);for(O=re(O,2),I=re(I,2);!D(O);){var L=q.add(O);0>=L.l(M)&&(B=B.add(I),q=L),O=re(O,1),I=re(I,1)}return N=P(M,B.j(N)),new U(B,N)}for(B=v;0<=M.l(N);){for(I=Math.max(1,Math.floor(M.m()/N.m())),O=Math.ceil(Math.log(I)/Math.LN2),O=48>=O?1:Math.pow(2,O-48),q=p(I),L=q.j(N);j(L)||0<L.l(M);)I-=O,q=p(I),L=q.j(N);D(q)&&(q=E),B=B.add(q),M=P(M,L)}return new U(B,M)}n.A=function(M){return W(this,M).h},n.and=function(M){for(var N=Math.max(this.g.length,M.g.length),I=[],O=0;O<N;O++)I[O]=this.i(O)&M.i(O);return new u(I,this.h&M.h)},n.or=function(M){for(var N=Math.max(this.g.length,M.g.length),I=[],O=0;O<N;O++)I[O]=this.i(O)|M.i(O);return new u(I,this.h|M.h)},n.xor=function(M){for(var N=Math.max(this.g.length,M.g.length),I=[],O=0;O<N;O++)I[O]=this.i(O)^M.i(O);return new u(I,this.h^M.h)};function ne(M){for(var N=M.g.length+1,I=[],O=0;O<N;O++)I[O]=M.i(O)<<1|M.i(O-1)>>>31;return new u(I,M.h)}function re(M,N){var I=N>>5;N%=32;for(var O=M.g.length-I,B=[],q=0;q<O;q++)B[q]=0<N?M.i(q+I)>>>N|M.i(q+I+1)<<32-N:M.i(q+I);return new u(B,M.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,iE=r,u.prototype.add=u.prototype.add,u.prototype.multiply=u.prototype.j,u.prototype.modulo=u.prototype.A,u.prototype.compare=u.prototype.l,u.prototype.toNumber=u.prototype.m,u.prototype.toString=u.prototype.toString,u.prototype.getBits=u.prototype.i,u.fromNumber=p,u.fromString=y,_i=u}).apply(typeof xw<"u"?xw:typeof self<"u"?self:typeof window<"u"?window:{});var Nh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var aE,pc,oE,Bh,Dp,lE,cE,uE;(function(){var n,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(h,_,T){return h==Array.prototype||h==Object.prototype||(h[_]=T.value),h};function t(h){h=[typeof globalThis=="object"&&globalThis,h,typeof window=="object"&&window,typeof self=="object"&&self,typeof Nh=="object"&&Nh];for(var _=0;_<h.length;++_){var T=h[_];if(T&&T.Math==Math)return T}throw Error("Cannot find global object")}var r=t(this);function a(h,_){if(_)e:{var T=r;h=h.split(".");for(var A=0;A<h.length-1;A++){var G=h[A];if(!(G in T))break e;T=T[G]}h=h[h.length-1],A=T[h],_=_(A),_!=A&&_!=null&&e(T,h,{configurable:!0,writable:!0,value:_})}}function l(h,_){h instanceof String&&(h+="");var T=0,A=!1,G={next:function(){if(!A&&T<h.length){var X=T++;return{value:_(X,h[X]),done:!1}}return A=!0,{done:!0,value:void 0}}};return G[Symbol.iterator]=function(){return G},G}a("Array.prototype.values",function(h){return h||function(){return l(this,function(_,T){return T})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var u=u||{},f=this||self;function g(h){var _=typeof h;return _=_!="object"?_:h?Array.isArray(h)?"array":_:"null",_=="array"||_=="object"&&typeof h.length=="number"}function p(h){var _=typeof h;return _=="object"&&h!=null||_=="function"}function y(h,_,T){return h.call.apply(h.bind,arguments)}function v(h,_,T){if(!h)throw Error();if(2<arguments.length){var A=Array.prototype.slice.call(arguments,2);return function(){var G=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(G,A),h.apply(_,G)}}return function(){return h.apply(_,arguments)}}function E(h,_,T){return E=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?y:v,E.apply(null,arguments)}function S(h,_){var T=Array.prototype.slice.call(arguments,1);return function(){var A=T.slice();return A.push.apply(A,arguments),h.apply(this,A)}}function D(h,_){function T(){}T.prototype=_.prototype,h.aa=_.prototype,h.prototype=new T,h.prototype.constructor=h,h.Qb=function(A,G,X){for(var fe=Array(arguments.length-2),We=2;We<arguments.length;We++)fe[We-2]=arguments[We];return _.prototype[G].apply(A,fe)}}function j(h){const _=h.length;if(0<_){const T=Array(_);for(let A=0;A<_;A++)T[A]=h[A];return T}return[]}function k(h,_){for(let T=1;T<arguments.length;T++){const A=arguments[T];if(g(A)){const G=h.length||0,X=A.length||0;h.length=G+X;for(let fe=0;fe<X;fe++)h[G+fe]=A[fe]}else h.push(A)}}class P{constructor(_,T){this.i=_,this.j=T,this.h=0,this.g=null}get(){let _;return 0<this.h?(this.h--,_=this.g,this.g=_.next,_.next=null):_=this.i(),_}}function z(h){return/^[\s\xa0]*$/.test(h)}function U(){var h=f.navigator;return h&&(h=h.userAgent)?h:""}function W(h){return W[" "](h),h}W[" "]=function(){};var ne=U().indexOf("Gecko")!=-1&&!(U().toLowerCase().indexOf("webkit")!=-1&&U().indexOf("Edge")==-1)&&!(U().indexOf("Trident")!=-1||U().indexOf("MSIE")!=-1)&&U().indexOf("Edge")==-1;function re(h,_,T){for(const A in h)_.call(T,h[A],A,h)}function M(h,_){for(const T in h)_.call(void 0,h[T],T,h)}function N(h){const _={};for(const T in h)_[T]=h[T];return _}const I="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function O(h,_){let T,A;for(let G=1;G<arguments.length;G++){A=arguments[G];for(T in A)h[T]=A[T];for(let X=0;X<I.length;X++)T=I[X],Object.prototype.hasOwnProperty.call(A,T)&&(h[T]=A[T])}}function B(h){var _=1;h=h.split(":");const T=[];for(;0<_&&h.length;)T.push(h.shift()),_--;return h.length&&T.push(h.join(":")),T}function q(h){f.setTimeout(()=>{throw h},0)}function L(){var h=Qe;let _=null;return h.g&&(_=h.g,h.g=h.g.next,h.g||(h.h=null),_.next=null),_}class je{constructor(){this.h=this.g=null}add(_,T){const A=Ce.get();A.set(_,T),this.h?this.h.next=A:this.g=A,this.h=A}}var Ce=new P(()=>new te,h=>h.reset());class te{constructor(){this.next=this.g=this.h=null}set(_,T){this.h=_,this.g=T,this.next=null}reset(){this.next=this.g=this.h=null}}let he,ge=!1,Qe=new je,C=()=>{const h=f.Promise.resolve(void 0);he=()=>{h.then(R)}};var R=()=>{for(var h;h=L();){try{h.h.call(h.g)}catch(T){q(T)}var _=Ce;_.j(h),100>_.h&&(_.h++,h.next=_.g,_.g=h)}ge=!1};function ee(){this.s=this.s,this.C=this.C}ee.prototype.s=!1,ee.prototype.ma=function(){this.s||(this.s=!0,this.N())},ee.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Z(h,_){this.type=h,this.g=this.target=_,this.defaultPrevented=!1}Z.prototype.h=function(){this.defaultPrevented=!0};var ue=function(){if(!f.addEventListener||!Object.defineProperty)return!1;var h=!1,_=Object.defineProperty({},"passive",{get:function(){h=!0}});try{const T=()=>{};f.addEventListener("test",T,_),f.removeEventListener("test",T,_)}catch{}return h}();function me(h,_){if(Z.call(this,h?h.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,h){var T=this.type=h.type,A=h.changedTouches&&h.changedTouches.length?h.changedTouches[0]:null;if(this.target=h.target||h.srcElement,this.g=_,_=h.relatedTarget){if(ne){e:{try{W(_.nodeName);var G=!0;break e}catch{}G=!1}G||(_=null)}}else T=="mouseover"?_=h.fromElement:T=="mouseout"&&(_=h.toElement);this.relatedTarget=_,A?(this.clientX=A.clientX!==void 0?A.clientX:A.pageX,this.clientY=A.clientY!==void 0?A.clientY:A.pageY,this.screenX=A.screenX||0,this.screenY=A.screenY||0):(this.clientX=h.clientX!==void 0?h.clientX:h.pageX,this.clientY=h.clientY!==void 0?h.clientY:h.pageY,this.screenX=h.screenX||0,this.screenY=h.screenY||0),this.button=h.button,this.key=h.key||"",this.ctrlKey=h.ctrlKey,this.altKey=h.altKey,this.shiftKey=h.shiftKey,this.metaKey=h.metaKey,this.pointerId=h.pointerId||0,this.pointerType=typeof h.pointerType=="string"?h.pointerType:de[h.pointerType]||"",this.state=h.state,this.i=h,h.defaultPrevented&&me.aa.h.call(this)}}D(me,Z);var de={2:"touch",3:"pen",4:"mouse"};me.prototype.h=function(){me.aa.h.call(this);var h=this.i;h.preventDefault?h.preventDefault():h.returnValue=!1};var ve="closure_listenable_"+(1e6*Math.random()|0),Te=0;function Ue(h,_,T,A,G){this.listener=h,this.proxy=null,this.src=_,this.type=T,this.capture=!!A,this.ha=G,this.key=++Te,this.da=this.fa=!1}function rt(h){h.da=!0,h.listener=null,h.proxy=null,h.src=null,h.ha=null}function $e(h){this.src=h,this.g={},this.h=0}$e.prototype.add=function(h,_,T,A,G){var X=h.toString();h=this.g[X],h||(h=this.g[X]=[],this.h++);var fe=Tt(h,_,A,G);return-1<fe?(_=h[fe],T||(_.fa=!1)):(_=new Ue(_,this.src,X,!!A,G),_.fa=T,h.push(_)),_};function at(h,_){var T=_.type;if(T in h.g){var A=h.g[T],G=Array.prototype.indexOf.call(A,_,void 0),X;(X=0<=G)&&Array.prototype.splice.call(A,G,1),X&&(rt(_),h.g[T].length==0&&(delete h.g[T],h.h--))}}function Tt(h,_,T,A){for(var G=0;G<h.length;++G){var X=h[G];if(!X.da&&X.listener==_&&X.capture==!!T&&X.ha==A)return G}return-1}var Pe="closure_lm_"+(1e6*Math.random()|0),pt={};function Gt(h,_,T,A,G){if(Array.isArray(_)){for(var X=0;X<_.length;X++)Gt(h,_[X],T,A,G);return null}return T=Na(T),h&&h[ve]?h.K(_,T,p(A)?!!A.capture:!1,G):ye(h,_,T,!1,A,G)}function ye(h,_,T,A,G,X){if(!_)throw Error("Invalid event type");var fe=p(G)?!!G.capture:!!G,We=ns(h);if(We||(h[Pe]=We=new $e(h)),T=We.add(_,T,A,fe,X),T.proxy)return T;if(A=Ae(),T.proxy=A,A.src=h,A.listener=T,h.addEventListener)ue||(G=fe),G===void 0&&(G=!1),h.addEventListener(_.toString(),A,G);else if(h.attachEvent)h.attachEvent(Nn(_.toString()),A);else if(h.addListener&&h.removeListener)h.addListener(A);else throw Error("addEventListener and attachEvent are unavailable.");return T}function Ae(){function h(T){return _.call(h.src,h.listener,T)}const _=Pn;return h}function Le(h,_,T,A,G){if(Array.isArray(_))for(var X=0;X<_.length;X++)Le(h,_[X],T,A,G);else A=p(A)?!!A.capture:!!A,T=Na(T),h&&h[ve]?(h=h.i,_=String(_).toString(),_ in h.g&&(X=h.g[_],T=Tt(X,T,A,G),-1<T&&(rt(X[T]),Array.prototype.splice.call(X,T,1),X.length==0&&(delete h.g[_],h.h--)))):h&&(h=ns(h))&&(_=h.g[_.toString()],h=-1,_&&(h=Tt(_,T,A,G)),(T=-1<h?_[h]:null)&&Et(T))}function Et(h){if(typeof h!="number"&&h&&!h.da){var _=h.src;if(_&&_[ve])at(_.i,h);else{var T=h.type,A=h.proxy;_.removeEventListener?_.removeEventListener(T,A,h.capture):_.detachEvent?_.detachEvent(Nn(T),A):_.addListener&&_.removeListener&&_.removeListener(A),(T=ns(_))?(at(T,h),T.h==0&&(T.src=null,_[Pe]=null)):rt(h)}}}function Nn(h){return h in pt?pt[h]:pt[h]="on"+h}function Pn(h,_){if(h.da)h=!0;else{_=new me(_,this);var T=h.listener,A=h.ha||h.src;h.fa&&Et(h),h=T.call(A,_)}return h}function ns(h){return h=h[Pe],h instanceof $e?h:null}var Vr="__closure_events_fn_"+(1e9*Math.random()>>>0);function Na(h){return typeof h=="function"?h:(h[Vr]||(h[Vr]=function(_){return h.handleEvent(_)}),h[Vr])}function xt(){ee.call(this),this.i=new $e(this),this.M=this,this.F=null}D(xt,ee),xt.prototype[ve]=!0,xt.prototype.removeEventListener=function(h,_,T,A){Le(this,h,_,T,A)};function lt(h,_){var T,A=h.F;if(A)for(T=[];A;A=A.F)T.push(A);if(h=h.M,A=_.type||_,typeof _=="string")_=new Z(_,h);else if(_ instanceof Z)_.target=_.target||h;else{var G=_;_=new Z(A,h),O(_,G)}if(G=!0,T)for(var X=T.length-1;0<=X;X--){var fe=_.g=T[X];G=kn(fe,A,!0,_)&&G}if(fe=_.g=h,G=kn(fe,A,!0,_)&&G,G=kn(fe,A,!1,_)&&G,T)for(X=0;X<T.length;X++)fe=_.g=T[X],G=kn(fe,A,!1,_)&&G}xt.prototype.N=function(){if(xt.aa.N.call(this),this.i){var h=this.i,_;for(_ in h.g){for(var T=h.g[_],A=0;A<T.length;A++)rt(T[A]);delete h.g[_],h.h--}}this.F=null},xt.prototype.K=function(h,_,T,A){return this.i.add(String(h),_,!1,T,A)},xt.prototype.L=function(h,_,T,A){return this.i.add(String(h),_,!0,T,A)};function kn(h,_,T,A){if(_=h.i.g[String(_)],!_)return!0;_=_.concat();for(var G=!0,X=0;X<_.length;++X){var fe=_[X];if(fe&&!fe.da&&fe.capture==T){var We=fe.listener,Qt=fe.ha||fe.src;fe.fa&&at(h.i,fe),G=We.call(Qt,A)!==!1&&G}}return G&&!A.defaultPrevented}function $t(h,_,T){if(typeof h=="function")T&&(h=E(h,T));else if(h&&typeof h.handleEvent=="function")h=E(h.handleEvent,h);else throw Error("Invalid listener argument");return 2147483647<Number(_)?-1:f.setTimeout(h,_||0)}function ki(h){h.g=$t(()=>{h.g=null,h.i&&(h.i=!1,ki(h))},h.l);const _=h.h;h.h=null,h.m.apply(null,_)}class Di extends ee{constructor(_,T){super(),this.m=_,this.l=T,this.h=null,this.i=!1,this.g=null}j(_){this.h=arguments,this.g?this.i=!0:ki(this)}N(){super.N(),this.g&&(f.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Js(h){ee.call(this),this.h=h,this.g={}}D(Js,ee);var er=[];function Mi(h){re(h.g,function(_,T){this.g.hasOwnProperty(T)&&Et(_)},h),h.g={}}Js.prototype.N=function(){Js.aa.N.call(this),Mi(this)},Js.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var _s=f.JSON.stringify,Pa=f.JSON.parse,Oi=class{stringify(h){return f.JSON.stringify(h,void 0)}parse(h){return f.JSON.parse(h,void 0)}};function rl(){}rl.prototype.h=null;function il(h){return h.h||(h.h=h.i())}function al(){}var tr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function nr(){Z.call(this,"d")}D(nr,Z);function ol(){Z.call(this,"c")}D(ol,Z);var Ns={},ll=null;function jr(){return ll=ll||new xt}Ns.La="serverreachability";function ka(h){Z.call(this,Ns.La,h)}D(ka,Z);function Ur(h){const _=jr();lt(_,new ka(_))}Ns.STAT_EVENT="statevent";function lu(h,_){Z.call(this,Ns.STAT_EVENT,h),this.stat=_}D(lu,Z);function Rt(h){const _=jr();lt(_,new lu(_,h))}Ns.Ma="timingevent";function Kt(h,_){Z.call(this,Ns.Ma,h),this.size=_}D(Kt,Z);function Ut(h,_){if(typeof h!="function")throw Error("Fn must not be null and must be a function");return f.setTimeout(function(){h()},_)}function ss(){this.g=!0}ss.prototype.xa=function(){this.g=!1};function cl(h,_,T,A,G,X){h.info(function(){if(h.g)if(X)for(var fe="",We=X.split("&"),Qt=0;Qt<We.length;Qt++){var Xe=We[Qt].split("=");if(1<Xe.length){var nn=Xe[0];Xe=Xe[1];var Yt=nn.split("_");fe=2<=Yt.length&&Yt[1]=="type"?fe+(nn+"="+Xe+"&"):fe+(nn+"=redacted&")}}else fe=null;else fe=X;return"XMLHTTP REQ ("+A+") [attempt "+G+"]: "+_+`
`+T+`
`+fe})}function sf(h,_,T,A,G,X,fe){h.info(function(){return"XMLHTTP RESP ("+A+") [ attempt "+G+"]: "+_+`
`+T+`
`+X+" "+fe})}function zr(h,_,T,A){h.info(function(){return"XMLHTTP TEXT ("+_+"): "+Li(h,T)+(A?" "+A:"")})}function cu(h,_){h.info(function(){return"TIMEOUT: "+_})}ss.prototype.info=function(){};function Li(h,_){if(!h.g)return _;if(!_)return null;try{var T=JSON.parse(_);if(T){for(h=0;h<T.length;h++)if(Array.isArray(T[h])){var A=T[h];if(!(2>A.length)){var G=A[1];if(Array.isArray(G)&&!(1>G.length)){var X=G[0];if(X!="noop"&&X!="stop"&&X!="close")for(var fe=1;fe<G.length;fe++)G[fe]=""}}}}return _s(T)}catch{return _}}var Br={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},sr={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},Ps;function ks(){}D(ks,rl),ks.prototype.g=function(){return new XMLHttpRequest},ks.prototype.i=function(){return{}},Ps=new ks;function Dn(h,_,T,A){this.j=h,this.i=_,this.l=T,this.R=A||1,this.U=new Js(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ot}function Ot(){this.i=null,this.g="",this.h=!1}var ul={},Da={};function vs(h,_,T){h.L=1,h.v=Bi(Gn(_)),h.m=T,h.P=!0,rr(h,null)}function rr(h,_){h.F=Date.now(),Vi(h),h.A=Gn(h.v);var T=h.A,A=h.R;Array.isArray(A)||(A=[String(A)]),ml(T.i,"t",A),h.C=0,T=h.j.J,h.h=new Ot,h.g=xu(h.j,T?_:null,!h.m),0<h.O&&(h.M=new Di(E(h.Y,h,h.g),h.O)),_=h.U,T=h.g,A=h.ca;var G="readystatechange";Array.isArray(G)||(G&&(er[0]=G.toString()),G=er);for(var X=0;X<G.length;X++){var fe=Gt(T,G[X],A||_.handleEvent,!1,_.h||_);if(!fe)break;_.g[fe.key]=fe}_=h.H?N(h.H):{},h.m?(h.u||(h.u="POST"),_["Content-Type"]="application/x-www-form-urlencoded",h.g.ea(h.A,h.u,h.m,_)):(h.u="GET",h.g.ea(h.A,h.u,null,_)),Ur(),cl(h.i,h.u,h.A,h.l,h.R,h.m)}Dn.prototype.ca=function(h){h=h.target;const _=this.M;_&&os(h)==3?_.j():this.Y(h)},Dn.prototype.Y=function(h){try{if(h==this.g)e:{const Yt=os(this.g);var _=this.g.Ba();const dr=this.g.Z();if(!(3>Yt)&&(Yt!=3||this.g&&(this.h.h||this.g.oa()||yu(this.g)))){this.J||Yt!=4||_==7||(_==8||0>=dr?Ur(3):Ur(2)),Fr(this);var T=this.g.Z();this.X=T;t:if(uu(this)){var A=yu(this.g);h="";var G=A.length,X=os(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){fn(this),Ds(this);var fe="";break t}this.h.i=new f.TextDecoder}for(_=0;_<G;_++)this.h.h=!0,h+=this.h.i.decode(A[_],{stream:!(X&&_==G-1)});A.length=0,this.h.g+=h,this.C=0,fe=this.h.g}else fe=this.g.oa();if(this.o=T==200,sf(this.i,this.u,this.A,this.l,this.R,Yt,T),this.o){if(this.T&&!this.K){t:{if(this.g){var We,Qt=this.g;if((We=Qt.g?Qt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(We)){var Xe=We;break t}}Xe=null}if(T=Xe)zr(this.i,this.l,T,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ji(this,T);else{this.o=!1,this.s=3,Rt(12),fn(this),Ds(this);break e}}if(this.P){T=!0;let gn;for(;!this.J&&this.C<fe.length;)if(gn=hu(this,fe),gn==Da){Yt==4&&(this.s=4,Rt(14),T=!1),zr(this.i,this.l,null,"[Incomplete Response]");break}else if(gn==ul){this.s=4,Rt(15),zr(this.i,this.l,fe,"[Invalid Chunk]"),T=!1;break}else zr(this.i,this.l,gn,null),ji(this,gn);if(uu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Yt!=4||fe.length!=0||this.h.h||(this.s=1,Rt(16),T=!1),this.o=this.o&&T,!T)zr(this.i,this.l,fe,"[Invalid Chunked Response]"),fn(this),Ds(this);else if(0<fe.length&&!this.W){this.W=!0;var nn=this.j;nn.g==this&&nn.ba&&!nn.M&&(nn.j.info("Great, no buffering proxy detected. Bytes received: "+fe.length),Yi(nn),nn.M=!0,Rt(11))}}else zr(this.i,this.l,fe,null),ji(this,fe);Yt==4&&fn(this),this.o&&!this.J&&(Yt==4?bu(this.j,this):(this.o=!1,Vi(this)))}else cf(this.g),T==400&&0<fe.indexOf("Unknown SID")?(this.s=3,Rt(12)):(this.s=0,Rt(13)),fn(this),Ds(this)}}}catch{}finally{}};function uu(h){return h.g?h.u=="GET"&&h.L!=2&&h.j.Ca:!1}function hu(h,_){var T=h.C,A=_.indexOf(`
`,T);return A==-1?Da:(T=Number(_.substring(T,A)),isNaN(T)?ul:(A+=1,A+T>_.length?Da:(_=_.slice(A,A+T),h.C=A+T,_)))}Dn.prototype.cancel=function(){this.J=!0,fn(this)};function Vi(h){h.S=Date.now()+h.I,du(h,h.I)}function du(h,_){if(h.B!=null)throw Error("WatchDog timer not null");h.B=Ut(E(h.ba,h),_)}function Fr(h){h.B&&(f.clearTimeout(h.B),h.B=null)}Dn.prototype.ba=function(){this.B=null;const h=Date.now();0<=h-this.S?(cu(this.i,this.A),this.L!=2&&(Ur(),Rt(17)),fn(this),this.s=2,Ds(this)):du(this,this.S-h)};function Ds(h){h.j.G==0||h.J||bu(h.j,h)}function fn(h){Fr(h);var _=h.M;_&&typeof _.ma=="function"&&_.ma(),h.M=null,Mi(h.U),h.g&&(_=h.g,h.g=null,_.abort(),_.ma())}function ji(h,_){try{var T=h.j;if(T.G!=0&&(T.g==h||hl(T.h,h))){if(!h.K&&hl(T.h,h)&&T.G==3){try{var A=T.Da.g.parse(_)}catch{A=null}if(Array.isArray(A)&&A.length==3){var G=A;if(G[0]==0){e:if(!T.u){if(T.g)if(T.g.F+3e3<h.F)Ga(T),qa(T);else break e;Tl(T),Rt(18)}}else T.za=G[1],0<T.za-T.T&&37500>G[2]&&T.F&&T.v==0&&!T.C&&(T.C=Ut(E(T.Za,T),6e3));if(1>=Oa(T.h)&&T.ca){try{T.ca()}catch{}T.ca=void 0}}else hr(T,11)}else if((h.K||T.g==h)&&Ga(T),!z(_))for(G=T.Da.g.parse(_),_=0;_<G.length;_++){let Xe=G[_];if(T.T=Xe[0],Xe=Xe[1],T.G==2)if(Xe[0]=="c"){T.K=Xe[1],T.ia=Xe[2];const nn=Xe[3];nn!=null&&(T.la=nn,T.j.info("VER="+T.la));const Yt=Xe[4];Yt!=null&&(T.Aa=Yt,T.j.info("SVER="+T.Aa));const dr=Xe[5];dr!=null&&typeof dr=="number"&&0<dr&&(A=1.5*dr,T.L=A,T.j.info("backChannelRequestTimeoutMs_="+A)),A=T;const gn=h.g;if(gn){const zs=gn.g?gn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(zs){var X=A.h;X.g||zs.indexOf("spdy")==-1&&zs.indexOf("quic")==-1&&zs.indexOf("h2")==-1||(X.j=X.l,X.g=new Set,X.h&&(La(X,X.h),X.h=null))}if(A.D){const El=gn.g?gn.g.getResponseHeader("X-HTTP-Session-Id"):null;El&&(A.ya=El,mt(A.I,A.D,El))}}T.G=3,T.l&&T.l.ua(),T.ba&&(T.R=Date.now()-h.F,T.j.info("Handshake RTT: "+T.R+"ms")),A=T;var fe=h;if(A.qa=Su(A,A.J?A.ia:null,A.W),fe.K){Mn(A.h,fe);var We=fe,Qt=A.L;Qt&&(We.I=Qt),We.B&&(Fr(We),Vi(We)),A.g=fe}else wu(A);0<T.i.length&&Ha(T)}else Xe[0]!="stop"&&Xe[0]!="close"||hr(T,7);else T.G==3&&(Xe[0]=="stop"||Xe[0]=="close"?Xe[0]=="stop"?hr(T,7):vl(T):Xe[0]!="noop"&&T.l&&T.l.ta(Xe),T.v=0)}}Ur(4)}catch{}}var fu=class{constructor(h,_){this.g=h,this.map=_}};function ir(h){this.l=h||10,f.PerformanceNavigationTiming?(h=f.performance.getEntriesByType("navigation"),h=0<h.length&&(h[0].nextHopProtocol=="hq"||h[0].nextHopProtocol=="h2")):h=!!(f.chrome&&f.chrome.loadTimes&&f.chrome.loadTimes()&&f.chrome.loadTimes().wasFetchedViaSpdy),this.j=h?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function Ma(h){return h.h?!0:h.g?h.g.size>=h.j:!1}function Oa(h){return h.h?1:h.g?h.g.size:0}function hl(h,_){return h.h?h.h==_:h.g?h.g.has(_):!1}function La(h,_){h.g?h.g.add(_):h.h=_}function Mn(h,_){h.h&&h.h==_?h.h=null:h.g&&h.g.has(_)&&h.g.delete(_)}ir.prototype.cancel=function(){if(this.i=dl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const h of this.g.values())h.cancel();this.g.clear()}};function dl(h){if(h.h!=null)return h.i.concat(h.h.D);if(h.g!=null&&h.g.size!==0){let _=h.i;for(const T of h.g.values())_=_.concat(T.D);return _}return j(h.i)}function rf(h){if(h.V&&typeof h.V=="function")return h.V();if(typeof Map<"u"&&h instanceof Map||typeof Set<"u"&&h instanceof Set)return Array.from(h.values());if(typeof h=="string")return h.split("");if(g(h)){for(var _=[],T=h.length,A=0;A<T;A++)_.push(h[A]);return _}_=[],T=0;for(A in h)_[T++]=h[A];return _}function Va(h){if(h.na&&typeof h.na=="function")return h.na();if(!h.V||typeof h.V!="function"){if(typeof Map<"u"&&h instanceof Map)return Array.from(h.keys());if(!(typeof Set<"u"&&h instanceof Set)){if(g(h)||typeof h=="string"){var _=[];h=h.length;for(var T=0;T<h;T++)_.push(T);return _}_=[],T=0;for(const A in h)_[T++]=A;return _}}}function fl(h,_){if(h.forEach&&typeof h.forEach=="function")h.forEach(_,void 0);else if(g(h)||typeof h=="string")Array.prototype.forEach.call(h,_,void 0);else for(var T=Va(h),A=rf(h),G=A.length,X=0;X<G;X++)_.call(void 0,A[X],T&&T[X],h)}var Ui=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function af(h,_){if(h){h=h.split("&");for(var T=0;T<h.length;T++){var A=h[T].indexOf("="),G=null;if(0<=A){var X=h[T].substring(0,A);G=h[T].substring(A+1)}else X=h[T];_(X,G?decodeURIComponent(G.replace(/\+/g," ")):"")}}}function zt(h){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,h instanceof zt){this.h=h.h,zi(this,h.j),this.o=h.o,this.g=h.g,qr(this,h.s),this.l=h.l;var _=h.i,T=new or;T.i=_.i,_.g&&(T.g=new Map(_.g),T.h=_.h),ar(this,T),this.m=h.m}else h&&(_=String(h).match(Ui))?(this.h=!1,zi(this,_[1]||"",!0),this.o=rs(_[2]||""),this.g=rs(_[3]||"",!0),qr(this,_[4]),this.l=rs(_[5]||"",!0),ar(this,_[6]||"",!0),this.m=rs(_[7]||"")):(this.h=!1,this.i=new or(null,this.h))}zt.prototype.toString=function(){var h=[],_=this.j;_&&h.push(Fi(_,gl,!0),":");var T=this.g;return(T||_=="file")&&(h.push("//"),(_=this.o)&&h.push(Fi(_,gl,!0),"@"),h.push(encodeURIComponent(String(T)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),T=this.s,T!=null&&h.push(":",String(T))),(T=this.l)&&(this.g&&T.charAt(0)!="/"&&h.push("/"),h.push(Fi(T,T.charAt(0)=="/"?of:pl,!0))),(T=this.i.toString())&&h.push("?",T),(T=this.m)&&h.push("#",Fi(T,ja)),h.join("")};function Gn(h){return new zt(h)}function zi(h,_,T){h.j=T?rs(_,!0):_,h.j&&(h.j=h.j.replace(/:$/,""))}function qr(h,_){if(_){if(_=Number(_),isNaN(_)||0>_)throw Error("Bad port number "+_);h.s=_}else h.s=null}function ar(h,_,T){_ instanceof or?(h.i=_,pu(h.i,h.h)):(T||(_=Fi(_,lf)),h.i=new or(_,h.h))}function mt(h,_,T){h.i.set(_,T)}function Bi(h){return mt(h,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),h}function rs(h,_){return h?_?decodeURI(h.replace(/%25/g,"%2525")):decodeURIComponent(h):""}function Fi(h,_,T){return typeof h=="string"?(h=encodeURI(h).replace(_,gu),T&&(h=h.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),h):null}function gu(h){return h=h.charCodeAt(0),"%"+(h>>4&15).toString(16)+(h&15).toString(16)}var gl=/[#\/\?@]/g,pl=/[#\?:]/g,of=/[#\?]/g,lf=/[#\?@]/g,ja=/#/g;function or(h,_){this.h=this.g=null,this.i=h||null,this.j=!!_}function is(h){h.g||(h.g=new Map,h.h=0,h.i&&af(h.i,function(_,T){h.add(decodeURIComponent(_.replace(/\+/g," ")),T)}))}n=or.prototype,n.add=function(h,_){is(this),this.i=null,h=Ms(this,h);var T=this.g.get(h);return T||this.g.set(h,T=[]),T.push(_),this.h+=1,this};function lr(h,_){is(h),_=Ms(h,_),h.g.has(_)&&(h.i=null,h.h-=h.g.get(_).length,h.g.delete(_))}function cr(h,_){return is(h),_=Ms(h,_),h.g.has(_)}n.forEach=function(h,_){is(this),this.g.forEach(function(T,A){T.forEach(function(G){h.call(_,G,A,this)},this)},this)},n.na=function(){is(this);const h=Array.from(this.g.values()),_=Array.from(this.g.keys()),T=[];for(let A=0;A<_.length;A++){const G=h[A];for(let X=0;X<G.length;X++)T.push(_[A])}return T},n.V=function(h){is(this);let _=[];if(typeof h=="string")cr(this,h)&&(_=_.concat(this.g.get(Ms(this,h))));else{h=Array.from(this.g.values());for(let T=0;T<h.length;T++)_=_.concat(h[T])}return _},n.set=function(h,_){return is(this),this.i=null,h=Ms(this,h),cr(this,h)&&(this.h-=this.g.get(h).length),this.g.set(h,[_]),this.h+=1,this},n.get=function(h,_){return h?(h=this.V(h),0<h.length?String(h[0]):_):_};function ml(h,_,T){lr(h,_),0<T.length&&(h.i=null,h.g.set(Ms(h,_),j(T)),h.h+=T.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const h=[],_=Array.from(this.g.keys());for(var T=0;T<_.length;T++){var A=_[T];const X=encodeURIComponent(String(A)),fe=this.V(A);for(A=0;A<fe.length;A++){var G=X;fe[A]!==""&&(G+="="+encodeURIComponent(String(fe[A]))),h.push(G)}}return this.i=h.join("&")};function Ms(h,_){return _=String(_),h.j&&(_=_.toLowerCase()),_}function pu(h,_){_&&!h.j&&(is(h),h.i=null,h.g.forEach(function(T,A){var G=A.toLowerCase();A!=G&&(lr(this,A),ml(this,G,T))},h)),h.j=_}function qi(h,_){const T=new ss;if(f.Image){const A=new Image;A.onload=S(as,T,"TestLoadImage: loaded",!0,_,A),A.onerror=S(as,T,"TestLoadImage: error",!1,_,A),A.onabort=S(as,T,"TestLoadImage: abort",!1,_,A),A.ontimeout=S(as,T,"TestLoadImage: timeout",!1,_,A),f.setTimeout(function(){A.ontimeout&&A.ontimeout()},1e4),A.src=h}else _(!1)}function ws(h,_){const T=new ss,A=new AbortController,G=setTimeout(()=>{A.abort(),as(T,"TestPingServer: timeout",!1,_)},1e4);fetch(h,{signal:A.signal}).then(X=>{clearTimeout(G),X.ok?as(T,"TestPingServer: ok",!0,_):as(T,"TestPingServer: server error",!1,_)}).catch(()=>{clearTimeout(G),as(T,"TestPingServer: error",!1,_)})}function as(h,_,T,A,G){try{G&&(G.onload=null,G.onerror=null,G.onabort=null,G.ontimeout=null),A(T)}catch{}}function Hi(){this.g=new Oi}function Os(h,_,T){const A=T||"";try{fl(h,function(G,X){let fe=G;p(G)&&(fe=_s(G)),_.push(A+X+"="+encodeURIComponent(fe))})}catch(G){throw _.push(A+"type="+encodeURIComponent("_badmap")),G}}function Hr(h){this.l=h.Ub||null,this.j=h.eb||!1}D(Hr,rl),Hr.prototype.g=function(){return new ur(this.l,this.j)},Hr.prototype.i=function(h){return function(){return h}}({});function ur(h,_){xt.call(this),this.D=h,this.o=_,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}D(ur,xt),n=ur.prototype,n.open=function(h,_){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=h,this.A=_,this.readyState=1,Vs(this)},n.send=function(h){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const _={headers:this.u,method:this.B,credentials:this.m,cache:void 0};h&&(_.body=h),(this.D||f).fetch(new Request(this.A,_)).then(this.Sa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Ls(this)),this.readyState=0},n.Sa=function(h){if(this.g&&(this.l=h,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=h.headers,this.readyState=2,Vs(this)),this.g&&(this.readyState=3,Vs(this),this.g)))if(this.responseType==="arraybuffer")h.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof f.ReadableStream<"u"&&"body"in h){if(this.j=h.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;yl(this)}else h.text().then(this.Ra.bind(this),this.ga.bind(this))};function yl(h){h.j.read().then(h.Pa.bind(h)).catch(h.ga.bind(h))}n.Pa=function(h){if(this.g){if(this.o&&h.value)this.response.push(h.value);else if(!this.o){var _=h.value?h.value:new Uint8Array(0);(_=this.v.decode(_,{stream:!h.done}))&&(this.response=this.responseText+=_)}h.done?Ls(this):Vs(this),this.readyState==3&&yl(this)}},n.Ra=function(h){this.g&&(this.response=this.responseText=h,Ls(this))},n.Qa=function(h){this.g&&(this.response=h,Ls(this))},n.ga=function(){this.g&&Ls(this)};function Ls(h){h.readyState=4,h.l=null,h.j=null,h.v=null,Vs(h)}n.setRequestHeader=function(h,_){this.u.append(h,_)},n.getResponseHeader=function(h){return this.h&&this.h.get(h.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const h=[],_=this.h.entries();for(var T=_.next();!T.done;)T=T.value,h.push(T[0]+": "+T[1]),T=_.next();return h.join(`\r
`)};function Vs(h){h.onreadystatechange&&h.onreadystatechange.call(h)}Object.defineProperty(ur.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(h){this.m=h?"include":"same-origin"}});function _l(h){let _="";return re(h,function(T,A){_+=A,_+=":",_+=T,_+=`\r
`}),_}function tn(h,_,T){e:{for(A in T){var A=!1;break e}A=!0}A||(T=_l(T),typeof h=="string"?T!=null&&encodeURIComponent(String(T)):mt(h,_,T))}function ut(h){xt.call(this),this.headers=new Map,this.o=h||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}D(ut,xt);var Ua=/^https?$/i,Gi=["POST","PUT"];n=ut.prototype,n.Ha=function(h){this.J=h},n.ea=function(h,_,T,A){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+h);_=_?_.toUpperCase():"GET",this.D=h,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():Ps.g(),this.v=this.o?il(this.o):il(Ps),this.g.onreadystatechange=E(this.Ea,this);try{this.B=!0,this.g.open(_,String(h),!0),this.B=!1}catch(X){mu(this,X);return}if(h=T||"",T=new Map(this.headers),A)if(Object.getPrototypeOf(A)===Object.prototype)for(var G in A)T.set(G,A[G]);else if(typeof A.keys=="function"&&typeof A.get=="function")for(const X of A.keys())T.set(X,A.get(X));else throw Error("Unknown input type for opt_headers: "+String(A));A=Array.from(T.keys()).find(X=>X.toLowerCase()=="content-type"),G=f.FormData&&h instanceof f.FormData,!(0<=Array.prototype.indexOf.call(Gi,_,void 0))||A||G||T.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[X,fe]of T)this.g.setRequestHeader(X,fe);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{$i(this),this.u=!0,this.g.send(h),this.u=!1}catch(X){mu(this,X)}};function mu(h,_){h.h=!1,h.g&&(h.j=!0,h.g.abort(),h.j=!1),h.l=_,h.m=5,za(h),js(h)}function za(h){h.A||(h.A=!0,lt(h,"complete"),lt(h,"error"))}n.abort=function(h){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=h||7,lt(this,"complete"),lt(this,"abort"),js(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),js(this,!0)),ut.aa.N.call(this)},n.Ea=function(){this.s||(this.B||this.u||this.j?Ba(this):this.bb())},n.bb=function(){Ba(this)};function Ba(h){if(h.h&&typeof u<"u"&&(!h.v[1]||os(h)!=4||h.Z()!=2)){if(h.u&&os(h)==4)$t(h.Ea,0,h);else if(lt(h,"readystatechange"),os(h)==4){h.h=!1;try{const fe=h.Z();e:switch(fe){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var _=!0;break e;default:_=!1}var T;if(!(T=_)){var A;if(A=fe===0){var G=String(h.D).match(Ui)[1]||null;!G&&f.self&&f.self.location&&(G=f.self.location.protocol.slice(0,-1)),A=!Ua.test(G?G.toLowerCase():"")}T=A}if(T)lt(h,"complete"),lt(h,"success");else{h.m=6;try{var X=2<os(h)?h.g.statusText:""}catch{X=""}h.l=X+" ["+h.Z()+"]",za(h)}}finally{js(h)}}}}function js(h,_){if(h.g){$i(h);const T=h.g,A=h.v[0]?()=>{}:null;h.g=null,h.v=null,_||lt(h,"ready");try{T.onreadystatechange=A}catch{}}}function $i(h){h.I&&(f.clearTimeout(h.I),h.I=null)}n.isActive=function(){return!!this.g};function os(h){return h.g?h.g.readyState:0}n.Z=function(){try{return 2<os(this)?this.g.status:-1}catch{return-1}},n.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.Oa=function(h){if(this.g){var _=this.g.responseText;return h&&_.indexOf(h)==0&&(_=_.substring(h.length)),Pa(_)}};function yu(h){try{if(!h.g)return null;if("response"in h.g)return h.g.response;switch(h.H){case"":case"text":return h.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in h.g)return h.g.mozResponseArrayBuffer}return null}catch{return null}}function cf(h){const _={};h=(h.g&&2<=os(h)&&h.g.getAllResponseHeaders()||"").split(`\r
`);for(let A=0;A<h.length;A++){if(z(h[A]))continue;var T=B(h[A]);const G=T[0];if(T=T[1],typeof T!="string")continue;T=T.trim();const X=_[G]||[];_[G]=X,X.push(T)}M(_,function(A){return A.join(", ")})}n.Ba=function(){return this.m},n.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Ki(h,_,T){return T&&T.internalChannelParams&&T.internalChannelParams[h]||_}function Fa(h){this.Aa=0,this.i=[],this.j=new ss,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Ki("failFast",!1,h),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Ki("baseRetryDelayMs",5e3,h),this.cb=Ki("retryDelaySeedMs",1e4,h),this.Wa=Ki("forwardChannelMaxRetries",2,h),this.wa=Ki("forwardChannelRequestTimeoutMs",2e4,h),this.pa=h&&h.xmlHttpFactory||void 0,this.Xa=h&&h.Tb||void 0,this.Ca=h&&h.useFetchStreams||!1,this.L=void 0,this.J=h&&h.supportsCrossDomainXhr||!1,this.K="",this.h=new ir(h&&h.concurrentRequestLimit),this.Da=new Hi,this.P=h&&h.fastHandshake||!1,this.O=h&&h.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=h&&h.Rb||!1,h&&h.xa&&this.j.xa(),h&&h.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&h&&h.detectBufferingProxy||!1,this.ja=void 0,h&&h.longPollingTimeout&&0<h.longPollingTimeout&&(this.ja=h.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}n=Fa.prototype,n.la=8,n.G=1,n.connect=function(h,_,T,A){Rt(0),this.W=h,this.H=_||{},T&&A!==void 0&&(this.H.OSID=T,this.H.OAID=A),this.F=this.X,this.I=Su(this,null,this.W),Ha(this)};function vl(h){if(_u(h),h.G==3){var _=h.U++,T=Gn(h.I);if(mt(T,"SID",h.K),mt(T,"RID",_),mt(T,"TYPE","terminate"),Qi(h,T),_=new Dn(h,h.j,_),_.L=2,_.v=Bi(Gn(T)),T=!1,f.navigator&&f.navigator.sendBeacon)try{T=f.navigator.sendBeacon(_.v.toString(),"")}catch{}!T&&f.Image&&(new Image().src=_.v,T=!0),T||(_.g=xu(_.j,null),_.g.ea(_.v)),_.F=Date.now(),Vi(_)}Eu(h)}function qa(h){h.g&&(Yi(h),h.g.cancel(),h.g=null)}function _u(h){qa(h),h.u&&(f.clearTimeout(h.u),h.u=null),Ga(h),h.h.cancel(),h.s&&(typeof h.s=="number"&&f.clearTimeout(h.s),h.s=null)}function Ha(h){if(!Ma(h.h)&&!h.s){h.s=!0;var _=h.Ga;he||C(),ge||(he(),ge=!0),Qe.add(_,h),h.B=0}}function uf(h,_){return Oa(h.h)>=h.h.j-(h.s?1:0)?!1:h.s?(h.i=_.D.concat(h.i),!0):h.G==1||h.G==2||h.B>=(h.Va?0:h.Wa)?!1:(h.s=Ut(E(h.Ga,h,_),bl(h,h.B)),h.B++,!0)}n.Ga=function(h){if(this.s)if(this.s=null,this.G==1){if(!h){this.U=Math.floor(1e5*Math.random()),h=this.U++;const G=new Dn(this,this.j,h);let X=this.o;if(this.S&&(X?(X=N(X),O(X,this.S)):X=this.S),this.m!==null||this.O||(G.H=X,X=null),this.P)e:{for(var _=0,T=0;T<this.i.length;T++){t:{var A=this.i[T];if("__data__"in A.map&&(A=A.map.__data__,typeof A=="string")){A=A.length;break t}A=void 0}if(A===void 0)break;if(_+=A,4096<_){_=T;break e}if(_===4096||T===this.i.length-1){_=T+1;break e}}_=1e3}else _=1e3;_=vu(this,G,_),T=Gn(this.I),mt(T,"RID",h),mt(T,"CVER",22),this.D&&mt(T,"X-HTTP-Session-Id",this.D),Qi(this,T),X&&(this.O?_="headers="+encodeURIComponent(String(_l(X)))+"&"+_:this.m&&tn(T,this.m,X)),La(this.h,G),this.Ua&&mt(T,"TYPE","init"),this.P?(mt(T,"$req",_),mt(T,"SID","null"),G.T=!0,vs(G,T,null)):vs(G,T,_),this.G=2}}else this.G==3&&(h?wl(this,h):this.i.length==0||Ma(this.h)||wl(this))};function wl(h,_){var T;_?T=_.l:T=h.U++;const A=Gn(h.I);mt(A,"SID",h.K),mt(A,"RID",T),mt(A,"AID",h.T),Qi(h,A),h.m&&h.o&&tn(A,h.m,h.o),T=new Dn(h,h.j,T,h.B+1),h.m===null&&(T.H=h.o),_&&(h.i=_.D.concat(h.i)),_=vu(h,T,1e3),T.I=Math.round(.5*h.wa)+Math.round(.5*h.wa*Math.random()),La(h.h,T),vs(T,A,_)}function Qi(h,_){h.H&&re(h.H,function(T,A){mt(_,A,T)}),h.l&&fl({},function(T,A){mt(_,A,T)})}function vu(h,_,T){T=Math.min(h.i.length,T);var A=h.l?E(h.l.Na,h.l,h):null;e:{var G=h.i;let X=-1;for(;;){const fe=["count="+T];X==-1?0<T?(X=G[0].g,fe.push("ofs="+X)):X=0:fe.push("ofs="+X);let We=!0;for(let Qt=0;Qt<T;Qt++){let Xe=G[Qt].g;const nn=G[Qt].map;if(Xe-=X,0>Xe)X=Math.max(0,G[Qt].g-100),We=!1;else try{Os(nn,fe,"req"+Xe+"_")}catch{A&&A(nn)}}if(We){A=fe.join("&");break e}}}return h=h.i.splice(0,T),_.D=h,A}function wu(h){if(!h.g&&!h.u){h.Y=1;var _=h.Fa;he||C(),ge||(he(),ge=!0),Qe.add(_,h),h.v=0}}function Tl(h){return h.g||h.u||3<=h.v?!1:(h.Y++,h.u=Ut(E(h.Fa,h),bl(h,h.v)),h.v++,!0)}n.Fa=function(){if(this.u=null,Tu(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var h=2*this.R;this.j.info("BP detection timer enabled: "+h),this.A=Ut(E(this.ab,this),h)}},n.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Rt(10),qa(this),Tu(this))};function Yi(h){h.A!=null&&(f.clearTimeout(h.A),h.A=null)}function Tu(h){h.g=new Dn(h,h.j,"rpc",h.Y),h.m===null&&(h.g.H=h.o),h.g.O=0;var _=Gn(h.qa);mt(_,"RID","rpc"),mt(_,"SID",h.K),mt(_,"AID",h.T),mt(_,"CI",h.F?"0":"1"),!h.F&&h.ja&&mt(_,"TO",h.ja),mt(_,"TYPE","xmlhttp"),Qi(h,_),h.m&&h.o&&tn(_,h.m,h.o),h.L&&(h.g.I=h.L);var T=h.g;h=h.ia,T.L=1,T.v=Bi(Gn(_)),T.m=null,T.P=!0,rr(T,h)}n.Za=function(){this.C!=null&&(this.C=null,qa(this),Tl(this),Rt(19))};function Ga(h){h.C!=null&&(f.clearTimeout(h.C),h.C=null)}function bu(h,_){var T=null;if(h.g==_){Ga(h),Yi(h),h.g=null;var A=2}else if(hl(h.h,_))T=_.D,Mn(h.h,_),A=1;else return;if(h.G!=0){if(_.o)if(A==1){T=_.m?_.m.length:0,_=Date.now()-_.F;var G=h.B;A=jr(),lt(A,new Kt(A,T)),Ha(h)}else wu(h);else if(G=_.s,G==3||G==0&&0<_.X||!(A==1&&uf(h,_)||A==2&&Tl(h)))switch(T&&0<T.length&&(_=h.h,_.i=_.i.concat(T)),G){case 1:hr(h,5);break;case 4:hr(h,10);break;case 3:hr(h,6);break;default:hr(h,2)}}}function bl(h,_){let T=h.Ta+Math.floor(Math.random()*h.cb);return h.isActive()||(T*=2),T*_}function hr(h,_){if(h.j.info("Error code "+_),_==2){var T=E(h.fb,h),A=h.Xa;const G=!A;A=new zt(A||"//www.google.com/images/cleardot.gif"),f.location&&f.location.protocol=="http"||zi(A,"https"),Bi(A),G?qi(A.toString(),T):ws(A.toString(),T)}else Rt(2);h.G=0,h.l&&h.l.sa(_),Eu(h),_u(h)}n.fb=function(h){h?(this.j.info("Successfully pinged google.com"),Rt(2)):(this.j.info("Failed to ping google.com"),Rt(1))};function Eu(h){if(h.G=0,h.ka=[],h.l){const _=dl(h.h);(_.length!=0||h.i.length!=0)&&(k(h.ka,_),k(h.ka,h.i),h.h.i.length=0,j(h.i),h.i.length=0),h.l.ra()}}function Su(h,_,T){var A=T instanceof zt?Gn(T):new zt(T);if(A.g!="")_&&(A.g=_+"."+A.g),qr(A,A.s);else{var G=f.location;A=G.protocol,_=_?_+"."+G.hostname:G.hostname,G=+G.port;var X=new zt(null);A&&zi(X,A),_&&(X.g=_),G&&qr(X,G),T&&(X.l=T),A=X}return T=h.D,_=h.ya,T&&_&&mt(A,T,_),mt(A,"VER",h.la),Qi(h,A),A}function xu(h,_,T){if(_&&!h.J)throw Error("Can't create secondary domain capable XhrIo object.");return _=h.Ca&&!h.pa?new ut(new Hr({eb:T})):new ut(h.pa),_.Ha(h.J),_}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Cu(){}n=Cu.prototype,n.ua=function(){},n.ta=function(){},n.sa=function(){},n.ra=function(){},n.isActive=function(){return!0},n.Na=function(){};function $a(){}$a.prototype.g=function(h,_){return new On(h,_)};function On(h,_){xt.call(this),this.g=new Fa(_),this.l=h,this.h=_&&_.messageUrlParams||null,h=_&&_.messageHeaders||null,_&&_.clientProtocolHeaderRequired&&(h?h["X-Client-Protocol"]="webchannel":h={"X-Client-Protocol":"webchannel"}),this.g.o=h,h=_&&_.initMessageHeaders||null,_&&_.messageContentType&&(h?h["X-WebChannel-Content-Type"]=_.messageContentType:h={"X-WebChannel-Content-Type":_.messageContentType}),_&&_.va&&(h?h["X-WebChannel-Client-Profile"]=_.va:h={"X-WebChannel-Client-Profile":_.va}),this.g.S=h,(h=_&&_.Sb)&&!z(h)&&(this.g.m=h),this.v=_&&_.supportsCrossDomainXhr||!1,this.u=_&&_.sendRawJson||!1,(_=_&&_.httpSessionIdParam)&&!z(_)&&(this.g.D=_,h=this.h,h!==null&&_ in h&&(h=this.h,_ in h&&delete h[_])),this.j=new Us(this)}D(On,xt),On.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},On.prototype.close=function(){vl(this.g)},On.prototype.o=function(h){var _=this.g;if(typeof h=="string"){var T={};T.__data__=h,h=T}else this.u&&(T={},T.__data__=_s(h),h=T);_.i.push(new fu(_.Ya++,h)),_.G==3&&Ha(_)},On.prototype.N=function(){this.g.l=null,delete this.j,vl(this.g),delete this.g,On.aa.N.call(this)};function Au(h){nr.call(this),h.__headers__&&(this.headers=h.__headers__,this.statusCode=h.__status__,delete h.__headers__,delete h.__status__);var _=h.__sm__;if(_){e:{for(const T in _){h=T;break e}h=void 0}(this.i=h)&&(h=this.i,_=_!==null&&h in _?_[h]:void 0),this.data=_}else this.data=h}D(Au,nr);function Iu(){ol.call(this),this.status=1}D(Iu,ol);function Us(h){this.g=h}D(Us,Cu),Us.prototype.ua=function(){lt(this.g,"a")},Us.prototype.ta=function(h){lt(this.g,new Au(h))},Us.prototype.sa=function(h){lt(this.g,new Iu)},Us.prototype.ra=function(){lt(this.g,"b")},$a.prototype.createWebChannel=$a.prototype.g,On.prototype.send=On.prototype.o,On.prototype.open=On.prototype.m,On.prototype.close=On.prototype.close,uE=function(){return new $a},cE=function(){return jr()},lE=Ns,Dp={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Br.NO_ERROR=0,Br.TIMEOUT=8,Br.HTTP_ERROR=6,Bh=Br,sr.COMPLETE="complete",oE=sr,al.EventType=tr,tr.OPEN="a",tr.CLOSE="b",tr.ERROR="c",tr.MESSAGE="d",xt.prototype.listen=xt.prototype.K,pc=al,ut.prototype.listenOnce=ut.prototype.L,ut.prototype.getLastError=ut.prototype.Ka,ut.prototype.getLastErrorCode=ut.prototype.Ba,ut.prototype.getStatus=ut.prototype.Z,ut.prototype.getResponseJson=ut.prototype.Oa,ut.prototype.getResponseText=ut.prototype.oa,ut.prototype.send=ut.prototype.ea,ut.prototype.setWithCredentials=ut.prototype.Ha,aE=ut}).apply(typeof Nh<"u"?Nh:typeof self<"u"?self:typeof window<"u"?window:{});const Cw="@firebase/firestore",Aw="4.7.10";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xn=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};xn.UNAUTHENTICATED=new xn(null),xn.GOOGLE_CREDENTIALS=new xn("google-credentials-uid"),xn.FIRST_PARTY=new xn("first-party-uid"),xn.MOCK_USER=new xn("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $o="11.5.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ya=new Rd("@firebase/firestore");function Eo(){return ya.logLevel}function we(n,...e){if(ya.logLevel<=Ge.DEBUG){const t=e.map(Sm);ya.debug(`Firestore (${$o}): ${n}`,...t)}}function Dr(n,...e){if(ya.logLevel<=Ge.ERROR){const t=e.map(Sm);ya.error(`Firestore (${$o}): ${n}`,...t)}}function Lo(n,...e){if(ya.logLevel<=Ge.WARN){const t=e.map(Sm);ya.warn(`Firestore (${$o}): ${n}`,...t)}}function Sm(n){if(typeof n=="string")return n;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(t){return JSON.stringify(t)}(n)}catch{return n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ie(n="Unexpected state"){const e=`FIRESTORE (${$o}) INTERNAL ASSERTION FAILED: `+n;throw Dr(e),new Error(e)}function st(n,e){n||Ie()}function Oe(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const le={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Se extends Ri{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rr{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class yR{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(xn.UNAUTHENTICATED))}shutdown(){}}class _R{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class vR{constructor(e){this.t=e,this.currentUser=xn.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){st(this.o===void 0);let r=this.i;const a=g=>this.i!==r?(r=this.i,t(g)):Promise.resolve();let l=new Rr;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Rr,e.enqueueRetryable(()=>a(this.currentUser))};const u=()=>{const g=l;e.enqueueRetryable(async()=>{await g.promise,await a(this.currentUser)})},f=g=>{we("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=g,this.o&&(this.auth.addAuthTokenListener(this.o),u())};this.t.onInit(g=>f(g)),setTimeout(()=>{if(!this.auth){const g=this.t.getImmediate({optional:!0});g?f(g):(we("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Rr)}},0),u()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(we("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(st(typeof r.accessToken=="string"),new hE(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return st(e===null||typeof e=="string"),new xn(e)}}class wR{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=xn.FIRST_PARTY,this.T=new Map}I(){return this.P?this.P():null}get headers(){this.T.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.T.set("Authorization",e),this.h&&this.T.set("X-Goog-Iam-Authorization-Token",this.h),this.T}}class TR{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new wR(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(xn.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Iw{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class bR{constructor(e,t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null,this.V=null,Ar(e)&&e.settings.appCheckToken&&(this.V=e.settings.appCheckToken)}start(e,t){st(this.o===void 0);const r=l=>{l.error!=null&&we("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const u=l.token!==this.R;return this.R=l.token,we("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable(()=>r(l))};const a=l=>{we("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(l=>a(l)),setTimeout(()=>{if(!this.appCheck){const l=this.A.getImmediate({optional:!0});l?a(l):we("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.V)return Promise.resolve(new Iw(this.V));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(st(typeof t.token=="string"),this.R=t.token,new Iw(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ER(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dE(){return new TextEncoder}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fE{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const a=ER(40);for(let l=0;l<a.length;++l)r.length<20&&a[l]<t&&(r+=e.charAt(a[l]%62))}return r}}function Be(n,e){return n<e?-1:n>e?1:0}function Mp(n,e){let t=0;for(;t<n.length&&t<e.length;){const r=n.codePointAt(t),a=e.codePointAt(t);if(r!==a){if(r<128&&a<128)return Be(r,a);{const l=dE(),u=SR(l.encode(Rw(n,t)),l.encode(Rw(e,t)));return u!==0?u:Be(r,a)}}t+=r>65535?2:1}return Be(n.length,e.length)}function Rw(n,e){return n.codePointAt(e)>65535?n.substring(e,e+2):n.substring(e,e+1)}function SR(n,e){for(let t=0;t<n.length&&t<e.length;++t)if(n[t]!==e[t])return Be(n[t],e[t]);return Be(n.length,e.length)}function Vo(n,e,t){return n.length===e.length&&n.every((r,a)=>t(r,e[a]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nw=-62135596800,Pw=1e6;class Jt{static now(){return Jt.fromMillis(Date.now())}static fromDate(e){return Jt.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*Pw);return new Jt(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Se(le.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Se(le.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<Nw)throw new Se(le.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Se(le.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Pw}_compareTo(e){return this.seconds===e.seconds?Be(this.nanoseconds,e.nanoseconds):Be(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds-Nw;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class De{static fromTimestamp(e){return new De(e)}static min(){return new De(new Jt(0,0))}static max(){return new De(new Jt(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kw="__name__";class $s{constructor(e,t,r){t===void 0?t=0:t>e.length&&Ie(),r===void 0?r=e.length-t:r>e.length-t&&Ie(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return $s.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof $s?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let a=0;a<r;a++){const l=$s.compareSegments(e.get(a),t.get(a));if(l!==0)return l}return Be(e.length,t.length)}static compareSegments(e,t){const r=$s.isNumericId(e),a=$s.isNumericId(t);return r&&!a?-1:!r&&a?1:r&&a?$s.extractNumericId(e).compare($s.extractNumericId(t)):Mp(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return _i.fromString(e.substring(4,e.length-2))}}class Pt extends $s{construct(e,t,r){return new Pt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new Se(le.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(a=>a.length>0))}return new Pt(t)}static emptyPath(){return new Pt([])}}const xR=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class wn extends $s{construct(e,t,r){return new wn(e,t,r)}static isValidIdentifier(e){return xR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),wn.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===kw}static keyField(){return new wn([kw])}static fromServerFormat(e){const t=[];let r="",a=0;const l=()=>{if(r.length===0)throw new Se(le.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;a<e.length;){const f=e[a];if(f==="\\"){if(a+1===e.length)throw new Se(le.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const g=e[a+1];if(g!=="\\"&&g!=="."&&g!=="`")throw new Se(le.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=g,a+=2}else f==="`"?(u=!u,a++):f!=="."||u?(r+=f,a++):(l(),a++)}if(l(),u)throw new Se(le.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new wn(t)}static emptyPath(){return new wn([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Re{constructor(e){this.path=e}static fromPath(e){return new Re(Pt.fromString(e))}static fromName(e){return new Re(Pt.fromString(e).popFirst(5))}static empty(){return new Re(Pt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&Pt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return Pt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Re(new Pt(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc=-1;function CR(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,a=De.fromTimestamp(r===1e9?new Jt(t+1,0):new Jt(t,r));return new bi(a,Re.empty(),e)}function AR(n){return new bi(n.readTime,n.key,Oc)}class bi{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new bi(De.min(),Re.empty(),Oc)}static max(){return new bi(De.max(),Re.empty(),Oc)}}function IR(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=Re.comparator(n.documentKey,e.documentKey),t!==0?t:Be(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class NR{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ko(n){if(n.code!==le.FAILED_PRECONDITION||n.message!==RR)throw n;we("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oe{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ie(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new oe((r,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(r,a)},this.catchCallback=l=>{this.wrapFailure(t,l).next(r,a)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof oe?t:oe.resolve(t)}catch(t){return oe.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):oe.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):oe.reject(t)}static resolve(e){return new oe((t,r)=>{t(e)})}static reject(e){return new oe((t,r)=>{r(e)})}static waitFor(e){return new oe((t,r)=>{let a=0,l=0,u=!1;e.forEach(f=>{++a,f.next(()=>{++l,u&&l===a&&t()},g=>r(g))}),u=!0,l===a&&t()})}static or(e){let t=oe.resolve(!1);for(const r of e)t=t.next(a=>a?oe.resolve(a):r());return t}static forEach(e,t){const r=[];return e.forEach((a,l)=>{r.push(t.call(this,a,l))}),this.waitFor(r)}static mapArray(e,t){return new oe((r,a)=>{const l=e.length,u=new Array(l);let f=0;for(let g=0;g<l;g++){const p=g;t(e[p]).next(y=>{u[p]=y,++f,f===l&&r(u)},y=>a(y))}})}static doWhile(e,t){return new oe((r,a)=>{const l=()=>{e()===!0?t().next(()=>{l()},a):r()};l()})}}function PR(n){const e=n.match(/Android ([\d.]+)/i),t=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(t)}function Qo(n){return n.name==="IndexedDbTransactionError"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dd{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=r=>this.oe(r),this._e=r=>t.writeSequenceNumber(r))}oe(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this._e&&this._e(e),e}}Dd.ae=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xm=-1;function Qc(n){return n==null}function id(n){return n===0&&1/n==-1/0}function kR(n){return typeof n=="number"&&Number.isInteger(n)&&!id(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gE="";function DR(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Dw(e)),e=MR(n.get(t),e);return Dw(e)}function MR(n,e){let t=e;const r=n.length;for(let a=0;a<r;a++){const l=n.charAt(a);switch(l){case"\0":t+="";break;case gE:t+="";break;default:t+=l}}return t}function Dw(n){return n+gE+""}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mw(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ni(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function pE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ht=class Op{constructor(e,t){this.comparator=e,this.root=t||vi.EMPTY}insert(e,t){return new Op(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,vi.BLACK,null,null))}remove(e){return new Op(this.comparator,this.root.remove(e,this.comparator).copy(null,null,vi.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const a=this.comparator(e,r.key);if(a===0)return t+r.left.size;a<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ph(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ph(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ph(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ph(this.root,e,this.comparator,!0)}},Ph=class{constructor(e,t,r,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=t?r(e.key,t):1,t&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},vi=class Cr{constructor(e,t,r,a,l){this.key=e,this.value=t,this.color=r??Cr.RED,this.left=a??Cr.EMPTY,this.right=l??Cr.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,a,l){return new Cr(e??this.key,t??this.value,r??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let a=this;const l=r(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,t,r),null):l===0?a.copy(null,t,null,null,null):a.copy(null,null,null,null,a.right.insert(e,t,r)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Cr.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,a=this;if(t(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,t),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),t(e,a.key)===0){if(a.right.isEmpty())return Cr.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,t))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Cr.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Cr.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw Ie();const e=this.left.check();if(e!==this.right.check())throw Ie();return e+(this.isRed()?0:1)}};vi.EMPTY=null,vi.RED=!0,vi.BLACK=!1;vi.EMPTY=new class{constructor(){this.size=0}get key(){throw Ie()}get value(){throw Ie()}get color(){throw Ie()}get left(){throw Ie()}get right(){throw Ie()}copy(e,t,r,a,l){return this}insert(e,t,r){return new vi(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en{constructor(e){this.comparator=e,this.data=new Ht(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const a=r.getNext();if(this.comparator(a.key,e[1])>=0)return;t(a.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Ow(this.data.getIterator())}getIteratorFrom(e){return new Ow(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof en)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=r.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new en(this.comparator);return t.data=e,t}}class Ow{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jn{constructor(e){this.fields=e,e.sort(wn.comparator)}static empty(){return new Jn([])}unionWith(e){let t=new en(wn.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new Jn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Vo(this.fields,e.fields,(t,r)=>t.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new mE("Invalid base64 string: "+l):l}}(e);return new Tn(t)}static fromUint8Array(e){const t=function(a){let l="";for(let u=0;u<a.length;++u)l+=String.fromCharCode(a[u]);return l}(e);return new Tn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){const r=new Uint8Array(t.length);for(let a=0;a<t.length;a++)r[a]=t.charCodeAt(a);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Be(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Tn.EMPTY_BYTE_STRING=new Tn("");const OR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ei(n){if(st(!!n),typeof n=="string"){let e=0;const t=OR.exec(n);if(st(!!t),t[1]){let a=t[1];a=(a+"000000000").substr(0,9),e=Number(a)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:jt(n.seconds),nanos:jt(n.nanos)}}function jt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Si(n){return typeof n=="string"?Tn.fromBase64String(n):Tn.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yE="server_timestamp",_E="__type__",vE="__previous_value__",wE="__local_write_time__";function Cm(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[_E])===null||t===void 0?void 0:t.stringValue)===yE}function Md(n){const e=n.mapValue.fields[vE];return Cm(e)?Md(e):e}function Lc(n){const e=Ei(n.mapValue.fields[wE].timestampValue);return new Jt(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LR{constructor(e,t,r,a,l,u,f,g,p){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=a,this.ssl=l,this.forceLongPolling=u,this.autoDetectLongPolling=f,this.longPollingOptions=g,this.useFetchStreams=p}}const ad="(default)";class Vc{constructor(e,t){this.projectId=e,this.database=t||ad}static empty(){return new Vc("","")}get isDefaultDatabase(){return this.database===ad}isEqual(e){return e instanceof Vc&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TE="__type__",VR="__max__",kh={mapValue:{}},bE="__vector__",od="value";function xi(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Cm(n)?4:UR(n)?9007199254740991:jR(n)?10:11:Ie()}function Xs(n,e){if(n===e)return!0;const t=xi(n);if(t!==xi(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lc(n).isEqual(Lc(e));case 3:return function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const u=Ei(a.timestampValue),f=Ei(l.timestampValue);return u.seconds===f.seconds&&u.nanos===f.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(a,l){return Si(a.bytesValue).isEqual(Si(l.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(a,l){return jt(a.geoPointValue.latitude)===jt(l.geoPointValue.latitude)&&jt(a.geoPointValue.longitude)===jt(l.geoPointValue.longitude)}(n,e);case 2:return function(a,l){if("integerValue"in a&&"integerValue"in l)return jt(a.integerValue)===jt(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const u=jt(a.doubleValue),f=jt(l.doubleValue);return u===f?id(u)===id(f):isNaN(u)&&isNaN(f)}return!1}(n,e);case 9:return Vo(n.arrayValue.values||[],e.arrayValue.values||[],Xs);case 10:case 11:return function(a,l){const u=a.mapValue.fields||{},f=l.mapValue.fields||{};if(Mw(u)!==Mw(f))return!1;for(const g in u)if(u.hasOwnProperty(g)&&(f[g]===void 0||!Xs(u[g],f[g])))return!1;return!0}(n,e);default:return Ie()}}function jc(n,e){return(n.values||[]).find(t=>Xs(t,e))!==void 0}function jo(n,e){if(n===e)return 0;const t=xi(n),r=xi(e);if(t!==r)return Be(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return Be(n.booleanValue,e.booleanValue);case 2:return function(l,u){const f=jt(l.integerValue||l.doubleValue),g=jt(u.integerValue||u.doubleValue);return f<g?-1:f>g?1:f===g?0:isNaN(f)?isNaN(g)?0:-1:1}(n,e);case 3:return Lw(n.timestampValue,e.timestampValue);case 4:return Lw(Lc(n),Lc(e));case 5:return Mp(n.stringValue,e.stringValue);case 6:return function(l,u){const f=Si(l),g=Si(u);return f.compareTo(g)}(n.bytesValue,e.bytesValue);case 7:return function(l,u){const f=l.split("/"),g=u.split("/");for(let p=0;p<f.length&&p<g.length;p++){const y=Be(f[p],g[p]);if(y!==0)return y}return Be(f.length,g.length)}(n.referenceValue,e.referenceValue);case 8:return function(l,u){const f=Be(jt(l.latitude),jt(u.latitude));return f!==0?f:Be(jt(l.longitude),jt(u.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return Vw(n.arrayValue,e.arrayValue);case 10:return function(l,u){var f,g,p,y;const v=l.fields||{},E=u.fields||{},S=(f=v[od])===null||f===void 0?void 0:f.arrayValue,D=(g=E[od])===null||g===void 0?void 0:g.arrayValue,j=Be(((p=S==null?void 0:S.values)===null||p===void 0?void 0:p.length)||0,((y=D==null?void 0:D.values)===null||y===void 0?void 0:y.length)||0);return j!==0?j:Vw(S,D)}(n.mapValue,e.mapValue);case 11:return function(l,u){if(l===kh.mapValue&&u===kh.mapValue)return 0;if(l===kh.mapValue)return 1;if(u===kh.mapValue)return-1;const f=l.fields||{},g=Object.keys(f),p=u.fields||{},y=Object.keys(p);g.sort(),y.sort();for(let v=0;v<g.length&&v<y.length;++v){const E=Mp(g[v],y[v]);if(E!==0)return E;const S=jo(f[g[v]],p[y[v]]);if(S!==0)return S}return Be(g.length,y.length)}(n.mapValue,e.mapValue);default:throw Ie()}}function Lw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return Be(n,e);const t=Ei(n),r=Ei(e),a=Be(t.seconds,r.seconds);return a!==0?a:Be(t.nanos,r.nanos)}function Vw(n,e){const t=n.values||[],r=e.values||[];for(let a=0;a<t.length&&a<r.length;++a){const l=jo(t[a],r[a]);if(l)return l}return Be(t.length,r.length)}function Uo(n){return Lp(n)}function Lp(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){const r=Ei(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Si(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return Re.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",a=!0;for(const l of t.values||[])a?a=!1:r+=",",r+=Lp(l);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){const r=Object.keys(t.fields||{}).sort();let a="{",l=!0;for(const u of r)l?l=!1:a+=",",a+=`${u}:${Lp(t.fields[u])}`;return a+"}"}(n.mapValue):Ie()}function Fh(n){switch(xi(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Md(n);return e?16+Fh(e):16;case 5:return 2*n.stringValue.length;case 6:return Si(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((a,l)=>a+Fh(l),0)}(n.arrayValue);case 10:case 11:return function(r){let a=0;return Ni(r.fields,(l,u)=>{a+=l.length+Fh(u)}),a}(n.mapValue);default:throw Ie()}}function Vp(n){return!!n&&"integerValue"in n}function Am(n){return!!n&&"arrayValue"in n}function jw(n){return!!n&&"nullValue"in n}function Uw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qh(n){return!!n&&"mapValue"in n}function jR(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{})[TE])===null||t===void 0?void 0:t.stringValue)===bE}function Ec(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Ni(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Ec(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ec(n.arrayValue.values[t]);return e}return Object.assign({},n)}function UR(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===VR}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vn{constructor(e){this.value=e}static empty(){return new Vn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!qh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ec(t)}setAll(e){let t=wn.emptyPath(),r={},a=[];e.forEach((u,f)=>{if(!t.isImmediateParentOf(f)){const g=this.getFieldsMap(t);this.applyChanges(g,r,a),r={},a=[],t=f.popLast()}u?r[f.lastSegment()]=Ec(u):a.push(f.lastSegment())});const l=this.getFieldsMap(t);this.applyChanges(l,r,a)}delete(e){const t=this.field(e.popLast());qh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Xs(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let a=t.mapValue.fields[e.get(r)];qh(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=a),t=a}return t.mapValue.fields}applyChanges(e,t,r){Ni(t,(a,l)=>e[a]=l);for(const a of r)delete e[a]}clone(){return new Vn(Ec(this.value))}}function EE(n){const e=[];return Ni(n.fields,(t,r)=>{const a=new wn([t]);if(qh(r)){const l=EE(r.mapValue).fields;if(l.length===0)e.push(a);else for(const u of l)e.push(a.child(u))}else e.push(a)}),new Jn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(e,t,r,a,l,u,f){this.key=e,this.documentType=t,this.version=r,this.readTime=a,this.createTime=l,this.data=u,this.documentState=f}static newInvalidDocument(e){return new un(e,0,De.min(),De.min(),De.min(),Vn.empty(),0)}static newFoundDocument(e,t,r,a){return new un(e,1,t,De.min(),r,a,0)}static newNoDocument(e,t){return new un(e,2,t,De.min(),De.min(),Vn.empty(),0)}static newUnknownDocument(e,t){return new un(e,3,t,De.min(),De.min(),Vn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(De.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Vn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Vn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=De.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof un&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new un(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(e,t){this.position=e,this.inclusive=t}}function zw(n,e,t){let r=0;for(let a=0;a<n.position.length;a++){const l=e[a],u=n.position[a];if(l.field.isKeyField()?r=Re.comparator(Re.fromName(u.referenceValue),t.key):r=jo(u,t.data.field(l.field)),l.dir==="desc"&&(r*=-1),r!==0)break}return r}function Bw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Xs(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(e,t="asc"){this.field=e,this.dir=t}}function zR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SE{}class Zt extends SE{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new FR(e,t,r):t==="array-contains"?new GR(e,r):t==="in"?new $R(e,r):t==="not-in"?new KR(e,r):t==="array-contains-any"?new QR(e,r):new Zt(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new qR(e,r):new HR(e,r)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(jo(t,this.value)):t!==null&&xi(this.value)===xi(t)&&this.matchesComparison(jo(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Ie()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Zs extends SE{constructor(e,t){super(),this.filters=e,this.op=t,this.ce=null}static create(e,t){return new Zs(e,t)}matches(e){return xE(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ce!==null||(this.ce=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ce}getFilters(){return Object.assign([],this.filters)}}function xE(n){return n.op==="and"}function CE(n){return BR(n)&&xE(n)}function BR(n){for(const e of n.filters)if(e instanceof Zs)return!1;return!0}function jp(n){if(n instanceof Zt)return n.field.canonicalString()+n.op.toString()+Uo(n.value);if(CE(n))return n.filters.map(e=>jp(e)).join(",");{const e=n.filters.map(t=>jp(t)).join(",");return`${n.op}(${e})`}}function AE(n,e){return n instanceof Zt?function(r,a){return a instanceof Zt&&r.op===a.op&&r.field.isEqual(a.field)&&Xs(r.value,a.value)}(n,e):n instanceof Zs?function(r,a){return a instanceof Zs&&r.op===a.op&&r.filters.length===a.filters.length?r.filters.reduce((l,u,f)=>l&&AE(u,a.filters[f]),!0):!1}(n,e):void Ie()}function IE(n){return n instanceof Zt?function(t){return`${t.field.canonicalString()} ${t.op} ${Uo(t.value)}`}(n):n instanceof Zs?function(t){return t.op.toString()+" {"+t.getFilters().map(IE).join(" ,")+"}"}(n):"Filter"}class FR extends Zt{constructor(e,t,r){super(e,t,r),this.key=Re.fromName(r.referenceValue)}matches(e){const t=Re.comparator(e.key,this.key);return this.matchesComparison(t)}}class qR extends Zt{constructor(e,t){super(e,"in",t),this.keys=RE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class HR extends Zt{constructor(e,t){super(e,"not-in",t),this.keys=RE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function RE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>Re.fromName(r.referenceValue))}class GR extends Zt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Am(t)&&jc(t.arrayValue,this.value)}}class $R extends Zt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&jc(this.value.arrayValue,t)}}class KR extends Zt{constructor(e,t){super(e,"not-in",t)}matches(e){if(jc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!jc(this.value.arrayValue,t)}}class QR extends Zt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Am(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>jc(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(e,t=null,r=[],a=[],l=null,u=null,f=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=a,this.limit=l,this.startAt=u,this.endAt=f,this.le=null}}function Fw(n,e=null,t=[],r=[],a=null,l=null,u=null){return new YR(n,e,t,r,a,l,u)}function Im(n){const e=Oe(n);if(e.le===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>jp(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(l){return l.field.canonicalString()+l.dir}(r)).join(","),Qc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Uo(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Uo(r)).join(",")),e.le=t}return e.le}function Rm(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!zR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!AE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Bw(n.startAt,e.startAt)&&Bw(n.endAt,e.endAt)}function Up(n){return Re.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e,t=null,r=[],a=[],l=null,u="F",f=null,g=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=a,this.limit=l,this.limitType=u,this.startAt=f,this.endAt=g,this.he=null,this.Pe=null,this.Te=null,this.startAt,this.endAt}}function WR(n,e,t,r,a,l,u,f){return new Od(n,e,t,r,a,l,u,f)}function Ld(n){return new Od(n)}function qw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function XR(n){return n.collectionGroup!==null}function Sc(n){const e=Oe(n);if(e.he===null){e.he=[];const t=new Set;for(const l of e.explicitOrderBy)e.he.push(l),t.add(l.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(u){let f=new en(wn.comparator);return u.filters.forEach(g=>{g.getFlattenedFilters().forEach(p=>{p.isInequality()&&(f=f.add(p.field))})}),f})(e).forEach(l=>{t.has(l.canonicalString())||l.isKeyField()||e.he.push(new cd(l,r))}),t.has(wn.keyField().canonicalString())||e.he.push(new cd(wn.keyField(),r))}return e.he}function Ws(n){const e=Oe(n);return e.Pe||(e.Pe=ZR(e,Sc(n))),e.Pe}function ZR(n,e){if(n.limitType==="F")return Fw(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(a=>{const l=a.dir==="desc"?"asc":"desc";return new cd(a.field,l)});const t=n.endAt?new ld(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new ld(n.startAt.position,n.startAt.inclusive):null;return Fw(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function zp(n,e,t){return new Od(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Vd(n,e){return Rm(Ws(n),Ws(e))&&n.limitType===e.limitType}function NE(n){return`${Im(Ws(n))}|lt:${n.limitType}`}function So(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(a=>IE(a)).join(", ")}]`),Qc(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(a=>function(u){return`${u.field.canonicalString()} (${u.dir})`}(a)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(a=>Uo(a)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(a=>Uo(a)).join(",")),`Target(${r})`}(Ws(n))}; limitType=${n.limitType})`}function jd(n,e){return e.isFoundDocument()&&function(r,a){const l=a.key.path;return r.collectionGroup!==null?a.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(l):Re.isDocumentKey(r.path)?r.path.isEqual(l):r.path.isImmediateParentOf(l)}(n,e)&&function(r,a){for(const l of Sc(r))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0}(n,e)&&function(r,a){for(const l of r.filters)if(!l.matches(a))return!1;return!0}(n,e)&&function(r,a){return!(r.startAt&&!function(u,f,g){const p=zw(u,f,g);return u.inclusive?p<=0:p<0}(r.startAt,Sc(r),a)||r.endAt&&!function(u,f,g){const p=zw(u,f,g);return u.inclusive?p>=0:p>0}(r.endAt,Sc(r),a))}(n,e)}function JR(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function PE(n){return(e,t)=>{let r=!1;for(const a of Sc(n)){const l=e2(a,e,t);if(l!==0)return l;r=r||a.field.isKeyField()}return 0}}function e2(n,e,t){const r=n.field.isKeyField()?Re.comparator(e.key,t.key):function(l,u,f){const g=u.data.field(l),p=f.data.field(l);return g!==null&&p!==null?jo(g,p):Ie()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return Ie()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(const[a,l]of r)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,t){const r=this.mapKeyFn(e),a=this.inner[r];if(a===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,t]);a.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return r.length===1?delete this.inner[t]:r.splice(a,1),this.innerSize--,!0;return!1}forEach(e){Ni(this.inner,(t,r)=>{for(const[a,l]of r)e(a,l)})}isEmpty(){return pE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const t2=new Ht(Re.comparator);function Mr(){return t2}const kE=new Ht(Re.comparator);function mc(...n){let e=kE;for(const t of n)e=e.insert(t.key,t);return e}function DE(n){let e=kE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function ga(){return xc()}function ME(){return xc()}function xc(){return new xa(n=>n.toString(),(n,e)=>n.isEqual(e))}const n2=new Ht(Re.comparator),s2=new en(Re.comparator);function Ke(...n){let e=s2;for(const t of n)e=e.add(t);return e}const r2=new en(Be);function i2(){return r2}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nm(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:id(e)?"-0":e}}function OE(n){return{integerValue:""+n}}function a2(n,e){return kR(e)?OE(e):Nm(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ud{constructor(){this._=void 0}}function o2(n,e,t){return n instanceof ud?function(a,l){const u={fields:{[_E]:{stringValue:yE},[wE]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&Cm(l)&&(l=Md(l)),l&&(u.fields[vE]=l),{mapValue:u}}(t,e):n instanceof zo?VE(n,e):n instanceof Uc?jE(n,e):function(a,l){const u=LE(a,l),f=Hw(u)+Hw(a.Ie);return Vp(u)&&Vp(a.Ie)?OE(f):Nm(a.serializer,f)}(n,e)}function l2(n,e,t){return n instanceof zo?VE(n,e):n instanceof Uc?jE(n,e):t}function LE(n,e){return n instanceof hd?function(r){return Vp(r)||function(l){return!!l&&"doubleValue"in l}(r)}(e)?e:{integerValue:0}:null}class ud extends Ud{}class zo extends Ud{constructor(e){super(),this.elements=e}}function VE(n,e){const t=UE(e);for(const r of n.elements)t.some(a=>Xs(a,r))||t.push(r);return{arrayValue:{values:t}}}class Uc extends Ud{constructor(e){super(),this.elements=e}}function jE(n,e){let t=UE(e);for(const r of n.elements)t=t.filter(a=>!Xs(a,r));return{arrayValue:{values:t}}}class hd extends Ud{constructor(e,t){super(),this.serializer=e,this.Ie=t}}function Hw(n){return jt(n.integerValue||n.doubleValue)}function UE(n){return Am(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c2{constructor(e,t){this.field=e,this.transform=t}}function u2(n,e){return n.field.isEqual(e.field)&&function(r,a){return r instanceof zo&&a instanceof zo||r instanceof Uc&&a instanceof Uc?Vo(r.elements,a.elements,Xs):r instanceof hd&&a instanceof hd?Xs(r.Ie,a.Ie):r instanceof ud&&a instanceof ud}(n.transform,e.transform)}class h2{constructor(e,t){this.version=e,this.transformResults=t}}class jn{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new jn}static exists(e){return new jn(void 0,e)}static updateTime(e){return new jn(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Hh(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class zd{}function zE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Pm(n.key,jn.none()):new Yc(n.key,n.data,jn.none());{const t=n.data,r=Vn.empty();let a=new en(wn.comparator);for(let l of e.fields)if(!a.has(l)){let u=t.field(l);u===null&&l.length>1&&(l=l.popLast(),u=t.field(l)),u===null?r.delete(l):r.set(l,u),a=a.add(l)}return new Pi(n.key,r,new Jn(a.toArray()),jn.none())}}function d2(n,e,t){n instanceof Yc?function(a,l,u){const f=a.value.clone(),g=$w(a.fieldTransforms,l,u.transformResults);f.setAll(g),l.convertToFoundDocument(u.version,f).setHasCommittedMutations()}(n,e,t):n instanceof Pi?function(a,l,u){if(!Hh(a.precondition,l))return void l.convertToUnknownDocument(u.version);const f=$w(a.fieldTransforms,l,u.transformResults),g=l.data;g.setAll(BE(a)),g.setAll(f),l.convertToFoundDocument(u.version,g).setHasCommittedMutations()}(n,e,t):function(a,l,u){l.convertToNoDocument(u.version).setHasCommittedMutations()}(0,e,t)}function Cc(n,e,t,r){return n instanceof Yc?function(l,u,f,g){if(!Hh(l.precondition,u))return f;const p=l.value.clone(),y=Kw(l.fieldTransforms,g,u);return p.setAll(y),u.convertToFoundDocument(u.version,p).setHasLocalMutations(),null}(n,e,t,r):n instanceof Pi?function(l,u,f,g){if(!Hh(l.precondition,u))return f;const p=Kw(l.fieldTransforms,g,u),y=u.data;return y.setAll(BE(l)),y.setAll(p),u.convertToFoundDocument(u.version,y).setHasLocalMutations(),f===null?null:f.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map(v=>v.field))}(n,e,t,r):function(l,u,f){return Hh(l.precondition,u)?(u.convertToNoDocument(u.version).setHasLocalMutations(),null):f}(n,e,t)}function f2(n,e){let t=null;for(const r of n.fieldTransforms){const a=e.data.field(r.field),l=LE(r.transform,a||null);l!=null&&(t===null&&(t=Vn.empty()),t.set(r.field,l))}return t||null}function Gw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,a){return r===void 0&&a===void 0||!(!r||!a)&&Vo(r,a,(l,u)=>u2(l,u))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Yc extends zd{constructor(e,t,r,a=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class Pi extends zd{constructor(e,t,r,a,l=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function BE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function $w(n,e,t){const r=new Map;st(n.length===t.length);for(let a=0;a<t.length;a++){const l=n[a],u=l.transform,f=e.data.field(l.field);r.set(l.field,l2(u,f,t[a]))}return r}function Kw(n,e,t){const r=new Map;for(const a of n){const l=a.transform,u=t.data.field(a.field);r.set(a.field,o2(l,u,e))}return r}class Pm extends zd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class FE extends zd{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g2{constructor(e,t,r,a){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=a}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&d2(l,e,r[a])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=Cc(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=Cc(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=ME();return this.mutations.forEach(a=>{const l=e.get(a.key),u=l.overlayedDocument;let f=this.applyToLocalView(u,l.mutatedFields);f=t.has(a.key)?null:f;const g=zE(u,f);g!==null&&r.set(a.key,g),u.isValidDocument()||u.convertToNoDocument(De.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Ke())}isEqual(e){return this.batchId===e.batchId&&Vo(this.mutations,e.mutations,(t,r)=>Gw(t,r))&&Vo(this.baseMutations,e.baseMutations,(t,r)=>Gw(t,r))}}class km{constructor(e,t,r,a){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=a}static from(e,t,r){st(e.mutations.length===r.length);let a=function(){return n2}();const l=e.mutations;for(let u=0;u<l.length;u++)a=a.insert(l[u].key,r[u].version);return new km(e,t,r,a)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p2{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(e,t){this.count=e,this.unchangedNames=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var qt,Je;function qE(n){switch(n){case le.OK:return Ie();case le.CANCELLED:case le.UNKNOWN:case le.DEADLINE_EXCEEDED:case le.RESOURCE_EXHAUSTED:case le.INTERNAL:case le.UNAVAILABLE:case le.UNAUTHENTICATED:return!1;case le.INVALID_ARGUMENT:case le.NOT_FOUND:case le.ALREADY_EXISTS:case le.PERMISSION_DENIED:case le.FAILED_PRECONDITION:case le.ABORTED:case le.OUT_OF_RANGE:case le.UNIMPLEMENTED:case le.DATA_LOSS:return!0;default:return Ie()}}function HE(n){if(n===void 0)return Dr("GRPC error has no .code"),le.UNKNOWN;switch(n){case qt.OK:return le.OK;case qt.CANCELLED:return le.CANCELLED;case qt.UNKNOWN:return le.UNKNOWN;case qt.DEADLINE_EXCEEDED:return le.DEADLINE_EXCEEDED;case qt.RESOURCE_EXHAUSTED:return le.RESOURCE_EXHAUSTED;case qt.INTERNAL:return le.INTERNAL;case qt.UNAVAILABLE:return le.UNAVAILABLE;case qt.UNAUTHENTICATED:return le.UNAUTHENTICATED;case qt.INVALID_ARGUMENT:return le.INVALID_ARGUMENT;case qt.NOT_FOUND:return le.NOT_FOUND;case qt.ALREADY_EXISTS:return le.ALREADY_EXISTS;case qt.PERMISSION_DENIED:return le.PERMISSION_DENIED;case qt.FAILED_PRECONDITION:return le.FAILED_PRECONDITION;case qt.ABORTED:return le.ABORTED;case qt.OUT_OF_RANGE:return le.OUT_OF_RANGE;case qt.UNIMPLEMENTED:return le.UNIMPLEMENTED;case qt.DATA_LOSS:return le.DATA_LOSS;default:return Ie()}}(Je=qt||(qt={}))[Je.OK=0]="OK",Je[Je.CANCELLED=1]="CANCELLED",Je[Je.UNKNOWN=2]="UNKNOWN",Je[Je.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Je[Je.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Je[Je.NOT_FOUND=5]="NOT_FOUND",Je[Je.ALREADY_EXISTS=6]="ALREADY_EXISTS",Je[Je.PERMISSION_DENIED=7]="PERMISSION_DENIED",Je[Je.UNAUTHENTICATED=16]="UNAUTHENTICATED",Je[Je.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Je[Je.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Je[Je.ABORTED=10]="ABORTED",Je[Je.OUT_OF_RANGE=11]="OUT_OF_RANGE",Je[Je.UNIMPLEMENTED=12]="UNIMPLEMENTED",Je[Je.INTERNAL=13]="INTERNAL",Je[Je.UNAVAILABLE=14]="UNAVAILABLE",Je[Je.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y2=new _i([4294967295,4294967295],0);function Qw(n){const e=dE().encode(n),t=new iE;return t.update(e),new Uint8Array(t.digest())}function Yw(n){const e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new _i([t,r],0),new _i([a,l],0)]}class Dm{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new yc(`Invalid padding: ${t}`);if(r<0)throw new yc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new yc(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new yc(`Invalid padding when bitmap length is 0: ${t}`);this.Ee=8*e.length-t,this.de=_i.fromNumber(this.Ee)}Ae(e,t,r){let a=e.add(t.multiply(_i.fromNumber(r)));return a.compare(y2)===1&&(a=new _i([a.getBits(0),a.getBits(1)],0)),a.modulo(this.de).toNumber()}Re(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.Ee===0)return!1;const t=Qw(e),[r,a]=Yw(t);for(let l=0;l<this.hashCount;l++){const u=this.Ae(r,a,l);if(!this.Re(u))return!1}return!0}static create(e,t,r){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),u=new Dm(l,a,t);return r.forEach(f=>u.insert(f)),u}insert(e){if(this.Ee===0)return;const t=Qw(e),[r,a]=Yw(t);for(let l=0;l<this.hashCount;l++){const u=this.Ae(r,a,l);this.Ve(u)}}Ve(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class yc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bd{constructor(e,t,r,a,l){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const a=new Map;return a.set(e,Wc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Bd(De.min(),a,new Ht(Be),Mr(),Ke())}}class Wc{constructor(e,t,r,a,l){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new Wc(r,t,Ke(),Ke(),Ke())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gh{constructor(e,t,r,a){this.me=e,this.removedTargetIds=t,this.key=r,this.fe=a}}class GE{constructor(e,t){this.targetId=e,this.ge=t}}class $E{constructor(e,t,r=Tn.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=a}}class Ww{constructor(){this.pe=0,this.ye=Xw(),this.we=Tn.EMPTY_BYTE_STRING,this.Se=!1,this.be=!0}get current(){return this.Se}get resumeToken(){return this.we}get De(){return this.pe!==0}get ve(){return this.be}Ce(e){e.approximateByteSize()>0&&(this.be=!0,this.we=e)}Fe(){let e=Ke(),t=Ke(),r=Ke();return this.ye.forEach((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:t=t.add(a);break;case 1:r=r.add(a);break;default:Ie()}}),new Wc(this.we,this.Se,e,t,r)}Me(){this.be=!1,this.ye=Xw()}xe(e,t){this.be=!0,this.ye=this.ye.insert(e,t)}Oe(e){this.be=!0,this.ye=this.ye.remove(e)}Ne(){this.pe+=1}Be(){this.pe-=1,st(this.pe>=0)}Le(){this.be=!0,this.Se=!0}}class _2{constructor(e){this.ke=e,this.qe=new Map,this.Qe=Mr(),this.$e=Dh(),this.Ue=Dh(),this.Ke=new Ht(Be)}We(e){for(const t of e.me)e.fe&&e.fe.isFoundDocument()?this.Ge(t,e.fe):this.ze(t,e.key,e.fe);for(const t of e.removedTargetIds)this.ze(t,e.key,e.fe)}je(e){this.forEachTarget(e,t=>{const r=this.He(t);switch(e.state){case 0:this.Je(t)&&r.Ce(e.resumeToken);break;case 1:r.Be(),r.De||r.Me(),r.Ce(e.resumeToken);break;case 2:r.Be(),r.De||this.removeTarget(t);break;case 3:this.Je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.Je(t)&&(this.Ye(t),r.Ce(e.resumeToken));break;default:Ie()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.qe.forEach((r,a)=>{this.Je(a)&&t(a)})}Ze(e){const t=e.targetId,r=e.ge.count,a=this.Xe(t);if(a){const l=a.target;if(Up(l))if(r===0){const u=new Re(l.path);this.ze(t,u,un.newNoDocument(u,De.min()))}else st(r===1);else{const u=this.et(t);if(u!==r){const f=this.tt(e),g=f?this.nt(f,e,u):1;if(g!==0){this.Ye(t);const p=g===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,p)}}}}}tt(e){const t=e.ge.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:a=0},hashCount:l=0}=t;let u,f;try{u=Si(r).toUint8Array()}catch(g){if(g instanceof mE)return Lo("Decoding the base64 bloom filter in existence filter failed ("+g.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw g}try{f=new Dm(u,a,l)}catch(g){return Lo(g instanceof yc?"BloomFilter error: ":"Applying bloom filter failed: ",g),null}return f.Ee===0?null:f}nt(e,t,r){return t.ge.count===r-this.st(e,t.targetId)?0:2}st(e,t){const r=this.ke.getRemoteKeysForTarget(t);let a=0;return r.forEach(l=>{const u=this.ke.it(),f=`projects/${u.projectId}/databases/${u.database}/documents/${l.path.canonicalString()}`;e.mightContain(f)||(this.ze(t,l,null),a++)}),a}ot(e){const t=new Map;this.qe.forEach((l,u)=>{const f=this.Xe(u);if(f){if(l.current&&Up(f.target)){const g=new Re(f.target.path);this._t(g).has(u)||this.ut(u,g)||this.ze(u,g,un.newNoDocument(g,e))}l.ve&&(t.set(u,l.Fe()),l.Me())}});let r=Ke();this.Ue.forEach((l,u)=>{let f=!0;u.forEachWhile(g=>{const p=this.Xe(g);return!p||p.purpose==="TargetPurposeLimboResolution"||(f=!1,!1)}),f&&(r=r.add(l))}),this.Qe.forEach((l,u)=>u.setReadTime(e));const a=new Bd(e,t,this.Ke,this.Qe,r);return this.Qe=Mr(),this.$e=Dh(),this.Ue=Dh(),this.Ke=new Ht(Be),a}Ge(e,t){if(!this.Je(e))return;const r=this.ut(e,t.key)?2:0;this.He(e).xe(t.key,r),this.Qe=this.Qe.insert(t.key,t),this.$e=this.$e.insert(t.key,this._t(t.key).add(e)),this.Ue=this.Ue.insert(t.key,this.ct(t.key).add(e))}ze(e,t,r){if(!this.Je(e))return;const a=this.He(e);this.ut(e,t)?a.xe(t,1):a.Oe(t),this.Ue=this.Ue.insert(t,this.ct(t).delete(e)),this.Ue=this.Ue.insert(t,this.ct(t).add(e)),r&&(this.Qe=this.Qe.insert(t,r))}removeTarget(e){this.qe.delete(e)}et(e){const t=this.He(e).Fe();return this.ke.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ne(e){this.He(e).Ne()}He(e){let t=this.qe.get(e);return t||(t=new Ww,this.qe.set(e,t)),t}ct(e){let t=this.Ue.get(e);return t||(t=new en(Be),this.Ue=this.Ue.insert(e,t)),t}_t(e){let t=this.$e.get(e);return t||(t=new en(Be),this.$e=this.$e.insert(e,t)),t}Je(e){const t=this.Xe(e)!==null;return t||we("WatchChangeAggregator","Detected inactive target",e),t}Xe(e){const t=this.qe.get(e);return t&&t.De?null:this.ke.lt(e)}Ye(e){this.qe.set(e,new Ww),this.ke.getRemoteKeysForTarget(e).forEach(t=>{this.ze(e,t,null)})}ut(e,t){return this.ke.getRemoteKeysForTarget(e).has(t)}}function Dh(){return new Ht(Re.comparator)}function Xw(){return new Ht(Re.comparator)}const v2={asc:"ASCENDING",desc:"DESCENDING"},w2={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},T2={and:"AND",or:"OR"};class b2{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Bp(n,e){return n.useProto3Json||Qc(e)?e:{value:e}}function dd(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function KE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function E2(n,e){return dd(n,e.toTimestamp())}function es(n){return st(!!n),De.fromTimestamp(function(t){const r=Ei(t);return new Jt(r.seconds,r.nanos)}(n))}function Mm(n,e){return Fp(n,e).canonicalString()}function Fp(n,e){const t=function(a){return new Pt(["projects",a.projectId,"databases",a.database])}(n).child("documents");return e===void 0?t:t.child(e)}function QE(n){const e=Pt.fromString(n);return st(e1(e)),e}function fd(n,e){return Mm(n.databaseId,e.path)}function Ac(n,e){const t=QE(e);if(t.get(1)!==n.databaseId.projectId)throw new Se(le.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new Se(le.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new Re(WE(t))}function YE(n,e){return Mm(n.databaseId,e)}function S2(n){const e=QE(n);return e.length===4?Pt.emptyPath():WE(e)}function qp(n){return new Pt(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function WE(n){return st(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Zw(n,e,t){return{name:fd(n,e),fields:t.value.mapValue.fields}}function x2(n,e){return"found"in e?function(r,a){st(!!a.found),a.found.name,a.found.updateTime;const l=Ac(r,a.found.name),u=es(a.found.updateTime),f=a.found.createTime?es(a.found.createTime):De.min(),g=new Vn({mapValue:{fields:a.found.fields}});return un.newFoundDocument(l,u,f,g)}(n,e):"missing"in e?function(r,a){st(!!a.missing),st(!!a.readTime);const l=Ac(r,a.missing),u=es(a.readTime);return un.newNoDocument(l,u)}(n,e):Ie()}function C2(n,e){let t;if("targetChange"in e){e.targetChange;const r=function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:Ie()}(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=function(p,y){return p.useProto3Json?(st(y===void 0||typeof y=="string"),Tn.fromBase64String(y||"")):(st(y===void 0||y instanceof Buffer||y instanceof Uint8Array),Tn.fromUint8Array(y||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,f=u&&function(p){const y=p.code===void 0?le.UNKNOWN:HE(p.code);return new Se(y,p.message||"")}(u);t=new $E(r,a,l,f||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const a=Ac(n,r.document.name),l=es(r.document.updateTime),u=r.document.createTime?es(r.document.createTime):De.min(),f=new Vn({mapValue:{fields:r.document.fields}}),g=un.newFoundDocument(a,l,u,f),p=r.targetIds||[],y=r.removedTargetIds||[];t=new Gh(p,y,g.key,g)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const a=Ac(n,r.document),l=r.readTime?es(r.readTime):De.min(),u=un.newNoDocument(a,l),f=r.removedTargetIds||[];t=new Gh([],f,u.key,u)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const a=Ac(n,r.document),l=r.removedTargetIds||[];t=new Gh([],l,a,null)}else{if(!("filter"in e))return Ie();{e.filter;const r=e.filter;r.targetId;const{count:a=0,unchangedNames:l}=r,u=new m2(a,l),f=r.targetId;t=new GE(f,u)}}return t}function XE(n,e){let t;if(e instanceof Yc)t={update:Zw(n,e.key,e.value)};else if(e instanceof Pm)t={delete:fd(n,e.key)};else if(e instanceof Pi)t={update:Zw(n,e.key,e.data),updateMask:O2(e.fieldMask)};else{if(!(e instanceof FE))return Ie();t={verify:fd(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(l,u){const f=u.transform;if(f instanceof ud)return{fieldPath:u.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(f instanceof zo)return{fieldPath:u.field.canonicalString(),appendMissingElements:{values:f.elements}};if(f instanceof Uc)return{fieldPath:u.field.canonicalString(),removeAllFromArray:{values:f.elements}};if(f instanceof hd)return{fieldPath:u.field.canonicalString(),increment:f.Ie};throw Ie()}(0,r))),e.precondition.isNone||(t.currentDocument=function(a,l){return l.updateTime!==void 0?{updateTime:E2(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Ie()}(n,e.precondition)),t}function A2(n,e){return n&&n.length>0?(st(e!==void 0),n.map(t=>function(a,l){let u=a.updateTime?es(a.updateTime):es(l);return u.isEqual(De.min())&&(u=es(l)),new h2(u,a.transformResults||[])}(t,e))):[]}function I2(n,e){return{documents:[YE(n,e.path)]}}function R2(n,e){const t={structuredQuery:{}},r=e.path;let a;e.collectionGroup!==null?(a=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=YE(n,a);const l=function(p){if(p.length!==0)return JE(Zs.create(p,"and"))}(e.filters);l&&(t.structuredQuery.where=l);const u=function(p){if(p.length!==0)return p.map(y=>function(E){return{field:xo(E.field),direction:k2(E.dir)}}(y))}(e.orderBy);u&&(t.structuredQuery.orderBy=u);const f=Bp(n,e.limit);return f!==null&&(t.structuredQuery.limit=f),e.startAt&&(t.structuredQuery.startAt=function(p){return{before:p.inclusive,values:p.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(p){return{before:!p.inclusive,values:p.position}}(e.endAt)),{ht:t,parent:a}}function N2(n){let e=S2(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let a=null;if(r>0){st(r===1);const y=t.from[0];y.allDescendants?a=y.collectionId:e=e.child(y.collectionId)}let l=[];t.where&&(l=function(v){const E=ZE(v);return E instanceof Zs&&CE(E)?E.getFilters():[E]}(t.where));let u=[];t.orderBy&&(u=function(v){return v.map(E=>function(D){return new cd(Co(D.field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(D.direction))}(E))}(t.orderBy));let f=null;t.limit&&(f=function(v){let E;return E=typeof v=="object"?v.value:v,Qc(E)?null:E}(t.limit));let g=null;t.startAt&&(g=function(v){const E=!!v.before,S=v.values||[];return new ld(S,E)}(t.startAt));let p=null;return t.endAt&&(p=function(v){const E=!v.before,S=v.values||[];return new ld(S,E)}(t.endAt)),WR(e,a,u,l,f,"F",g,p)}function P2(n,e){const t=function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ie()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function ZE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":const r=Co(t.unaryFilter.field);return Zt.create(r,"==",{doubleValue:NaN});case"IS_NULL":const a=Co(t.unaryFilter.field);return Zt.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=Co(t.unaryFilter.field);return Zt.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const u=Co(t.unaryFilter.field);return Zt.create(u,"!=",{nullValue:"NULL_VALUE"});default:return Ie()}}(n):n.fieldFilter!==void 0?function(t){return Zt.create(Co(t.fieldFilter.field),function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ie()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return Zs.create(t.compositeFilter.filters.map(r=>ZE(r)),function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Ie()}}(t.compositeFilter.op))}(n):Ie()}function k2(n){return v2[n]}function D2(n){return w2[n]}function M2(n){return T2[n]}function xo(n){return{fieldPath:n.canonicalString()}}function Co(n){return wn.fromServerFormat(n.fieldPath)}function JE(n){return n instanceof Zt?function(t){if(t.op==="=="){if(Uw(t.value))return{unaryFilter:{field:xo(t.field),op:"IS_NAN"}};if(jw(t.value))return{unaryFilter:{field:xo(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(Uw(t.value))return{unaryFilter:{field:xo(t.field),op:"IS_NOT_NAN"}};if(jw(t.value))return{unaryFilter:{field:xo(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xo(t.field),op:D2(t.op),value:t.value}}}(n):n instanceof Zs?function(t){const r=t.getFilters().map(a=>JE(a));return r.length===1?r[0]:{compositeFilter:{op:M2(t.op),filters:r}}}(n):Ie()}function O2(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function e1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pi{constructor(e,t,r,a,l=De.min(),u=De.min(),f=Tn.EMPTY_BYTE_STRING,g=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=f,this.expectedCount=g}withSequenceNumber(e){return new pi(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new pi(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new pi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new pi(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L2{constructor(e){this.Tt=e}}function V2(n){const e=N2({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?zp(e,e.limit,"L"):e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(){this.Tn=new U2}addToCollectionParentIndex(e,t){return this.Tn.add(t),oe.resolve()}getCollectionParents(e,t){return oe.resolve(this.Tn.getEntries(t))}addFieldIndex(e,t){return oe.resolve()}deleteFieldIndex(e,t){return oe.resolve()}deleteAllFieldIndexes(e){return oe.resolve()}createTargetIndexes(e,t){return oe.resolve()}getDocumentsMatchingTarget(e,t){return oe.resolve(null)}getIndexType(e,t){return oe.resolve(0)}getFieldIndexes(e,t){return oe.resolve([])}getNextCollectionGroupToUpdate(e){return oe.resolve(null)}getMinOffset(e,t){return oe.resolve(bi.min())}getMinOffsetFromCollectionGroup(e,t){return oe.resolve(bi.min())}updateCollectionGroup(e,t,r){return oe.resolve()}updateIndexEntries(e,t){return oe.resolve()}}class U2{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),a=this.index[t]||new en(Pt.comparator),l=!a.has(r);return this.index[t]=a.add(r),l}has(e){const t=e.lastSegment(),r=e.popLast(),a=this.index[t];return a&&a.has(r)}getEntries(e){return(this.index[e]||new en(Pt.comparator)).toArray()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},t1=41943040;class qn{static withCacheSize(e){return new qn(e,qn.DEFAULT_COLLECTION_PERCENTILE,qn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qn.DEFAULT_COLLECTION_PERCENTILE=10,qn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,qn.DEFAULT=new qn(t1,qn.DEFAULT_COLLECTION_PERCENTILE,qn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),qn.DISABLED=new qn(-1,0,0);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bo{constructor(e){this.$n=e}next(){return this.$n+=2,this.$n}static Un(){return new Bo(0)}static Kn(){return new Bo(-1)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eT="LruGarbageCollector",z2=1048576;function tT([n,e],[t,r]){const a=Be(n,t);return a===0?Be(e,r):a}class B2{constructor(e){this.Hn=e,this.buffer=new en(tT),this.Jn=0}Yn(){return++this.Jn}Zn(e){const t=[e,this.Yn()];if(this.buffer.size<this.Hn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();tT(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class F2{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Xn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.er(6e4)}stop(){this.Xn&&(this.Xn.cancel(),this.Xn=null)}get started(){return this.Xn!==null}er(e){we(eT,`Garbage collection scheduled in ${e}ms`),this.Xn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Xn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Qo(t)?we(eT,"Ignoring IndexedDB error during garbage collection: ",t):await Ko(t)}await this.er(3e5)})}}class q2{constructor(e,t){this.tr=e,this.params=t}calculateTargetCount(e,t){return this.tr.nr(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return oe.resolve(Dd.ae);const r=new B2(t);return this.tr.forEachTarget(e,a=>r.Zn(a.sequenceNumber)).next(()=>this.tr.rr(e,a=>r.Zn(a))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.tr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.tr.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(we("LruGarbageCollector","Garbage collection skipped; disabled"),oe.resolve(Jw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(we("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Jw):this.ir(e,t))}getCacheSize(e){return this.tr.getCacheSize(e)}ir(e,t){let r,a,l,u,f,g,p;const y=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(v=>(v>this.params.maximumSequenceNumbersToCollect?(we("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),a=this.params.maximumSequenceNumbersToCollect):a=v,u=Date.now(),this.nthSequenceNumber(e,a))).next(v=>(r=v,f=Date.now(),this.removeTargets(e,r,t))).next(v=>(l=v,g=Date.now(),this.removeOrphanedDocuments(e,r))).next(v=>(p=Date.now(),Eo()<=Ge.DEBUG&&we("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${u-y}ms
	Determined least recently used ${a} in `+(f-u)+`ms
	Removed ${l} targets in `+(g-f)+`ms
	Removed ${v} documents in `+(p-g)+`ms
Total Duration: ${p-y}ms`),oe.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:v})))}}function H2(n,e){return new q2(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class G2{constructor(){this.changes=new xa(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,un.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return r!==void 0?oe.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $2{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K2{constructor(e,t,r,a){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=a}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(a=>(r=a,this.remoteDocumentCache.getEntry(e,t))).next(a=>(r!==null&&Cc(r.mutation,a,Jn.empty(),Jt.now()),a))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Ke()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Ke()){const a=ga();return this.populateOverlays(e,a,t).next(()=>this.computeViews(e,t,a,r).next(l=>{let u=mc();return l.forEach((f,g)=>{u=u.insert(f,g.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=ga();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Ke()))}populateOverlays(e,t,r){const a=[];return r.forEach(l=>{t.has(l)||a.push(l)}),this.documentOverlayCache.getOverlays(e,a).next(l=>{l.forEach((u,f)=>{t.set(u,f)})})}computeViews(e,t,r,a){let l=Mr();const u=xc(),f=function(){return xc()}();return t.forEach((g,p)=>{const y=r.get(p.key);a.has(p.key)&&(y===void 0||y.mutation instanceof Pi)?l=l.insert(p.key,p):y!==void 0?(u.set(p.key,y.mutation.getFieldMask()),Cc(y.mutation,p,y.mutation.getFieldMask(),Jt.now())):u.set(p.key,Jn.empty())}),this.recalculateAndSaveOverlays(e,l).next(g=>(g.forEach((p,y)=>u.set(p,y)),t.forEach((p,y)=>{var v;return f.set(p,new $2(y,(v=u.get(p))!==null&&v!==void 0?v:null))}),f))}recalculateAndSaveOverlays(e,t){const r=xc();let a=new Ht((u,f)=>u-f),l=Ke();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const f of u)f.keys().forEach(g=>{const p=t.get(g);if(p===null)return;let y=r.get(g)||Jn.empty();y=f.applyToLocalView(p,y),r.set(g,y);const v=(a.get(f.batchId)||Ke()).add(g);a=a.insert(f.batchId,v)})}).next(()=>{const u=[],f=a.getReverseIterator();for(;f.hasNext();){const g=f.getNext(),p=g.key,y=g.value,v=ME();y.forEach(E=>{if(!l.has(E)){const S=zE(t.get(E),r.get(E));S!==null&&v.set(E,S),l=l.add(E)}}),u.push(this.documentOverlayCache.saveOverlays(e,p,v))}return oe.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,a){return function(u){return Re.isDocumentKey(u.path)&&u.collectionGroup===null&&u.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):XR(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,a):this.getDocumentsMatchingCollectionQuery(e,t,r,a)}getNextDocuments(e,t,r,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,a).next(l=>{const u=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,a-l.size):oe.resolve(ga());let f=Oc,g=l;return u.next(p=>oe.forEach(p,(y,v)=>(f<v.largestBatchId&&(f=v.largestBatchId),l.get(y)?oe.resolve():this.remoteDocumentCache.getEntry(e,y).next(E=>{g=g.insert(y,E)}))).next(()=>this.populateOverlays(e,p,l)).next(()=>this.computeViews(e,g,p,Ke())).next(y=>({batchId:f,changes:DE(y)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new Re(t)).next(r=>{let a=mc();return r.isFoundDocument()&&(a=a.insert(r.key,r)),a})}getDocumentsMatchingCollectionGroupQuery(e,t,r,a){const l=t.collectionGroup;let u=mc();return this.indexManager.getCollectionParents(e,l).next(f=>oe.forEach(f,g=>{const p=function(v,E){return new Od(E,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)}(t,g.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,r,a).next(y=>{y.forEach((v,E)=>{u=u.insert(v,E)})})}).next(()=>u))}getDocumentsMatchingCollectionQuery(e,t,r,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(u=>(l=u,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,l,a))).next(u=>{l.forEach((g,p)=>{const y=p.getKey();u.get(y)===null&&(u=u.insert(y,un.newInvalidDocument(y)))});let f=mc();return u.forEach((g,p)=>{const y=l.get(g);y!==void 0&&Cc(y.mutation,p,Jn.empty(),Jt.now()),jd(t,p)&&(f=f.insert(g,p))}),f})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Q2{constructor(e){this.serializer=e,this.dr=new Map,this.Ar=new Map}getBundleMetadata(e,t){return oe.resolve(this.dr.get(t))}saveBundleMetadata(e,t){return this.dr.set(t.id,function(a){return{id:a.id,version:a.version,createTime:es(a.createTime)}}(t)),oe.resolve()}getNamedQuery(e,t){return oe.resolve(this.Ar.get(t))}saveNamedQuery(e,t){return this.Ar.set(t.name,function(a){return{name:a.name,query:V2(a.bundledQuery),readTime:es(a.readTime)}}(t)),oe.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Y2{constructor(){this.overlays=new Ht(Re.comparator),this.Rr=new Map}getOverlay(e,t){return oe.resolve(this.overlays.get(t))}getOverlays(e,t){const r=ga();return oe.forEach(t,a=>this.getOverlay(e,a).next(l=>{l!==null&&r.set(a,l)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((a,l)=>{this.Et(e,t,l)}),oe.resolve()}removeOverlaysForBatchId(e,t,r){const a=this.Rr.get(r);return a!==void 0&&(a.forEach(l=>this.overlays=this.overlays.remove(l)),this.Rr.delete(r)),oe.resolve()}getOverlaysForCollection(e,t,r){const a=ga(),l=t.length+1,u=new Re(t.child("")),f=this.overlays.getIteratorFrom(u);for(;f.hasNext();){const g=f.getNext().value,p=g.getKey();if(!t.isPrefixOf(p.path))break;p.path.length===l&&g.largestBatchId>r&&a.set(g.getKey(),g)}return oe.resolve(a)}getOverlaysForCollectionGroup(e,t,r,a){let l=new Ht((p,y)=>p-y);const u=this.overlays.getIterator();for(;u.hasNext();){const p=u.getNext().value;if(p.getKey().getCollectionGroup()===t&&p.largestBatchId>r){let y=l.get(p.largestBatchId);y===null&&(y=ga(),l=l.insert(p.largestBatchId,y)),y.set(p.getKey(),p)}}const f=ga(),g=l.getIterator();for(;g.hasNext()&&(g.getNext().value.forEach((p,y)=>f.set(p,y)),!(f.size()>=a)););return oe.resolve(f)}Et(e,t,r){const a=this.overlays.get(r.key);if(a!==null){const u=this.Rr.get(a.largestBatchId).delete(r.key);this.Rr.set(a.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new p2(t,r));let l=this.Rr.get(t);l===void 0&&(l=Ke(),this.Rr.set(t,l)),this.Rr.set(t,l.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class W2{constructor(){this.sessionToken=Tn.EMPTY_BYTE_STRING}getSessionToken(e){return oe.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,oe.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Om{constructor(){this.Vr=new en(ln.mr),this.gr=new en(ln.pr)}isEmpty(){return this.Vr.isEmpty()}addReference(e,t){const r=new ln(e,t);this.Vr=this.Vr.add(r),this.gr=this.gr.add(r)}yr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.wr(new ln(e,t))}Sr(e,t){e.forEach(r=>this.removeReference(r,t))}br(e){const t=new Re(new Pt([])),r=new ln(t,e),a=new ln(t,e+1),l=[];return this.gr.forEachInRange([r,a],u=>{this.wr(u),l.push(u.key)}),l}Dr(){this.Vr.forEach(e=>this.wr(e))}wr(e){this.Vr=this.Vr.delete(e),this.gr=this.gr.delete(e)}vr(e){const t=new Re(new Pt([])),r=new ln(t,e),a=new ln(t,e+1);let l=Ke();return this.gr.forEachInRange([r,a],u=>{l=l.add(u.key)}),l}containsKey(e){const t=new ln(e,0),r=this.Vr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}}class ln{constructor(e,t){this.key=e,this.Cr=t}static mr(e,t){return Re.comparator(e.key,t.key)||Be(e.Cr,t.Cr)}static pr(e,t){return Be(e.Cr,t.Cr)||Re.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X2{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.Fr=1,this.Mr=new en(ln.mr)}checkEmpty(e){return oe.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,a){const l=this.Fr;this.Fr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const u=new g2(l,t,r,a);this.mutationQueue.push(u);for(const f of a)this.Mr=this.Mr.add(new ln(f.key,l)),this.indexManager.addToCollectionParentIndex(e,f.key.path.popLast());return oe.resolve(u)}lookupMutationBatch(e,t){return oe.resolve(this.Or(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,a=this.Nr(r),l=a<0?0:a;return oe.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return oe.resolve(this.mutationQueue.length===0?xm:this.Fr-1)}getAllMutationBatches(e){return oe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ln(t,0),a=new ln(t,Number.POSITIVE_INFINITY),l=[];return this.Mr.forEachInRange([r,a],u=>{const f=this.Or(u.Cr);l.push(f)}),oe.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new en(Be);return t.forEach(a=>{const l=new ln(a,0),u=new ln(a,Number.POSITIVE_INFINITY);this.Mr.forEachInRange([l,u],f=>{r=r.add(f.Cr)})}),oe.resolve(this.Br(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,a=r.length+1;let l=r;Re.isDocumentKey(l)||(l=l.child(""));const u=new ln(new Re(l),0);let f=new en(Be);return this.Mr.forEachWhile(g=>{const p=g.key.path;return!!r.isPrefixOf(p)&&(p.length===a&&(f=f.add(g.Cr)),!0)},u),oe.resolve(this.Br(f))}Br(e){const t=[];return e.forEach(r=>{const a=this.Or(r);a!==null&&t.push(a)}),t}removeMutationBatch(e,t){st(this.Lr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.Mr;return oe.forEach(t.mutations,a=>{const l=new ln(a.key,t.batchId);return r=r.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)}).next(()=>{this.Mr=r})}qn(e){}containsKey(e,t){const r=new ln(t,0),a=this.Mr.firstAfterOrEqual(r);return oe.resolve(t.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,oe.resolve()}Lr(e,t){return this.Nr(e)}Nr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Or(e){const t=this.Nr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Z2{constructor(e){this.kr=e,this.docs=function(){return new Ht(Re.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,a=this.docs.get(r),l=a?a.size:0,u=this.kr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-l,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return oe.resolve(r?r.document.mutableCopy():un.newInvalidDocument(t))}getEntries(e,t){let r=Mr();return t.forEach(a=>{const l=this.docs.get(a);r=r.insert(a,l?l.document.mutableCopy():un.newInvalidDocument(a))}),oe.resolve(r)}getDocumentsMatchingQuery(e,t,r,a){let l=Mr();const u=t.path,f=new Re(u.child("__id-9223372036854775808__")),g=this.docs.getIteratorFrom(f);for(;g.hasNext();){const{key:p,value:{document:y}}=g.getNext();if(!u.isPrefixOf(p.path))break;p.path.length>u.length+1||IR(AR(y),r)<=0||(a.has(y.key)||jd(t,y))&&(l=l.insert(y.key,y.mutableCopy()))}return oe.resolve(l)}getAllFromCollectionGroup(e,t,r,a){Ie()}qr(e,t){return oe.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new J2(this)}getSize(e){return oe.resolve(this.size)}}class J2 extends G2{constructor(e){super(),this.Ir=e}applyChanges(e){const t=[];return this.changes.forEach((r,a)=>{a.isValidDocument()?t.push(this.Ir.addEntry(e,a)):this.Ir.removeEntry(r)}),oe.waitFor(t)}getFromCache(e,t){return this.Ir.getEntry(e,t)}getAllFromCache(e,t){return this.Ir.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eN{constructor(e){this.persistence=e,this.Qr=new xa(t=>Im(t),Rm),this.lastRemoteSnapshotVersion=De.min(),this.highestTargetId=0,this.$r=0,this.Ur=new Om,this.targetCount=0,this.Kr=Bo.Un()}forEachTarget(e,t){return this.Qr.forEach((r,a)=>t(a)),oe.resolve()}getLastRemoteSnapshotVersion(e){return oe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return oe.resolve(this.$r)}allocateTargetId(e){return this.highestTargetId=this.Kr.next(),oe.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.$r&&(this.$r=t),oe.resolve()}zn(e){this.Qr.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.Kr=new Bo(t),this.highestTargetId=t),e.sequenceNumber>this.$r&&(this.$r=e.sequenceNumber)}addTargetData(e,t){return this.zn(t),this.targetCount+=1,oe.resolve()}updateTargetData(e,t){return this.zn(t),oe.resolve()}removeTargetData(e,t){return this.Qr.delete(t.target),this.Ur.br(t.targetId),this.targetCount-=1,oe.resolve()}removeTargets(e,t,r){let a=0;const l=[];return this.Qr.forEach((u,f)=>{f.sequenceNumber<=t&&r.get(f.targetId)===null&&(this.Qr.delete(u),l.push(this.removeMatchingKeysForTargetId(e,f.targetId)),a++)}),oe.waitFor(l).next(()=>a)}getTargetCount(e){return oe.resolve(this.targetCount)}getTargetData(e,t){const r=this.Qr.get(t)||null;return oe.resolve(r)}addMatchingKeys(e,t,r){return this.Ur.yr(t,r),oe.resolve()}removeMatchingKeys(e,t,r){this.Ur.Sr(t,r);const a=this.persistence.referenceDelegate,l=[];return a&&t.forEach(u=>{l.push(a.markPotentiallyOrphaned(e,u))}),oe.waitFor(l)}removeMatchingKeysForTargetId(e,t){return this.Ur.br(t),oe.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ur.vr(t);return oe.resolve(r)}containsKey(e,t){return oe.resolve(this.Ur.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1{constructor(e,t){this.Wr={},this.overlays={},this.Gr=new Dd(0),this.zr=!1,this.zr=!0,this.jr=new W2,this.referenceDelegate=e(this),this.Hr=new eN(this),this.indexManager=new j2,this.remoteDocumentCache=function(a){return new Z2(a)}(r=>this.referenceDelegate.Jr(r)),this.serializer=new L2(t),this.Yr=new Q2(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.zr=!1,Promise.resolve()}get started(){return this.zr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Y2,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Wr[e.toKey()];return r||(r=new X2(t,this.referenceDelegate),this.Wr[e.toKey()]=r),r}getGlobalsCache(){return this.jr}getTargetCache(){return this.Hr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Yr}runTransaction(e,t,r){we("MemoryPersistence","Starting transaction:",e);const a=new tN(this.Gr.next());return this.referenceDelegate.Zr(),r(a).next(l=>this.referenceDelegate.Xr(a).next(()=>l)).toPromise().then(l=>(a.raiseOnCommittedEvent(),l))}ei(e,t){return oe.or(Object.values(this.Wr).map(r=>()=>r.containsKey(e,t)))}}class tN extends NR{constructor(e){super(),this.currentSequenceNumber=e}}class Lm{constructor(e){this.persistence=e,this.ti=new Om,this.ni=null}static ri(e){return new Lm(e)}get ii(){if(this.ni)return this.ni;throw Ie()}addReference(e,t,r){return this.ti.addReference(r,t),this.ii.delete(r.toString()),oe.resolve()}removeReference(e,t,r){return this.ti.removeReference(r,t),this.ii.add(r.toString()),oe.resolve()}markPotentiallyOrphaned(e,t){return this.ii.add(t.toString()),oe.resolve()}removeTarget(e,t){this.ti.br(t.targetId).forEach(a=>this.ii.add(a.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(a=>{a.forEach(l=>this.ii.add(l.toString()))}).next(()=>r.removeTargetData(e,t))}Zr(){this.ni=new Set}Xr(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return oe.forEach(this.ii,r=>{const a=Re.fromPath(r);return this.si(e,a).next(l=>{l||t.removeEntry(a,De.min())})}).next(()=>(this.ni=null,t.apply(e)))}updateLimboDocument(e,t){return this.si(e,t).next(r=>{r?this.ii.delete(t.toString()):this.ii.add(t.toString())})}Jr(e){return 0}si(e,t){return oe.or([()=>oe.resolve(this.ti.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.ei(e,t)])}}class gd{constructor(e,t){this.persistence=e,this.oi=new xa(r=>DR(r.path),(r,a)=>r.isEqual(a)),this.garbageCollector=H2(this,t)}static ri(e,t){return new gd(e,t)}Zr(){}Xr(e){return oe.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}nr(e){const t=this.sr(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>t.next(a=>r+a))}sr(e){let t=0;return this.rr(e,r=>{t++}).next(()=>t)}rr(e,t){return oe.forEach(this.oi,(r,a)=>this.ar(e,r,a).next(l=>l?oe.resolve():t(a)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.qr(e,u=>this.ar(e,u,t).next(f=>{f||(r++,l.removeEntry(u,De.min()))})).next(()=>l.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.oi.set(t,e.currentSequenceNumber),oe.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),oe.resolve()}removeReference(e,t,r){return this.oi.set(r,e.currentSequenceNumber),oe.resolve()}updateLimboDocument(e,t){return this.oi.set(t,e.currentSequenceNumber),oe.resolve()}Jr(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Fh(e.data.value)),t}ar(e,t,r){return oe.or([()=>this.persistence.ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const a=this.oi.get(t);return oe.resolve(a!==void 0&&a>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vm{constructor(e,t,r,a){this.targetId=e,this.fromCache=t,this.Hi=r,this.Ji=a}static Yi(e,t){let r=Ke(),a=Ke();for(const l of t.docChanges)switch(l.type){case 0:r=r.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new Vm(e,t.fromCache,r,a)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nN{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sN{constructor(){this.Zi=!1,this.Xi=!1,this.es=100,this.ts=function(){return JC()?8:PR(Rs())>0?6:4}()}initialize(e,t){this.ns=e,this.indexManager=t,this.Zi=!0}getDocumentsMatchingQuery(e,t,r,a){const l={result:null};return this.rs(e,t).next(u=>{l.result=u}).next(()=>{if(!l.result)return this.ss(e,t,a,r).next(u=>{l.result=u})}).next(()=>{if(l.result)return;const u=new nN;return this._s(e,t,u).next(f=>{if(l.result=f,this.Xi)return this.us(e,t,u,f.size)})}).next(()=>l.result)}us(e,t,r,a){return r.documentReadCount<this.es?(Eo()<=Ge.DEBUG&&we("QueryEngine","SDK will not create cache indexes for query:",So(t),"since it only creates cache indexes for collection contains","more than or equal to",this.es,"documents"),oe.resolve()):(Eo()<=Ge.DEBUG&&we("QueryEngine","Query:",So(t),"scans",r.documentReadCount,"local documents and returns",a,"documents as results."),r.documentReadCount>this.ts*a?(Eo()<=Ge.DEBUG&&we("QueryEngine","The SDK decides to create cache indexes for query:",So(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ws(t))):oe.resolve())}rs(e,t){if(qw(t))return oe.resolve(null);let r=Ws(t);return this.indexManager.getIndexType(e,r).next(a=>a===0?null:(t.limit!==null&&a===1&&(t=zp(t,null,"F"),r=Ws(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(l=>{const u=Ke(...l);return this.ns.getDocuments(e,u).next(f=>this.indexManager.getMinOffset(e,r).next(g=>{const p=this.cs(t,f);return this.ls(t,p,u,g.readTime)?this.rs(e,zp(t,null,"F")):this.hs(e,p,t,g)}))})))}ss(e,t,r,a){return qw(t)||a.isEqual(De.min())?oe.resolve(null):this.ns.getDocuments(e,r).next(l=>{const u=this.cs(t,l);return this.ls(t,u,r,a)?oe.resolve(null):(Eo()<=Ge.DEBUG&&we("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),So(t)),this.hs(e,u,t,CR(a,Oc)).next(f=>f))})}cs(e,t){let r=new en(PE(e));return t.forEach((a,l)=>{jd(e,l)&&(r=r.add(l))}),r}ls(e,t,r,a){if(e.limit===null)return!1;if(r.size!==t.size)return!0;const l=e.limitType==="F"?t.last():t.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}_s(e,t,r){return Eo()<=Ge.DEBUG&&we("QueryEngine","Using full collection scan to execute query:",So(t)),this.ns.getDocumentsMatchingQuery(e,t,bi.min(),r)}hs(e,t,r,a){return this.ns.getDocumentsMatchingQuery(e,r,a).next(l=>(t.forEach(u=>{l=l.insert(u.key,u)}),l))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jm="LocalStore",rN=3e8;class iN{constructor(e,t,r,a){this.persistence=e,this.Ps=t,this.serializer=a,this.Ts=new Ht(Be),this.Is=new xa(l=>Im(l),Rm),this.Es=new Map,this.ds=e.getRemoteDocumentCache(),this.Hr=e.getTargetCache(),this.Yr=e.getBundleCache(),this.As(r)}As(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new K2(this.ds,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.ds.setIndexManager(this.indexManager),this.Ps.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ts))}}function aN(n,e,t,r){return new iN(n,e,t,r)}async function s1(n,e){const t=Oe(n);return await t.persistence.runTransaction("Handle user change","readonly",r=>{let a;return t.mutationQueue.getAllMutationBatches(r).next(l=>(a=l,t.As(e),t.mutationQueue.getAllMutationBatches(r))).next(l=>{const u=[],f=[];let g=Ke();for(const p of a){u.push(p.batchId);for(const y of p.mutations)g=g.add(y.key)}for(const p of l){f.push(p.batchId);for(const y of p.mutations)g=g.add(y.key)}return t.localDocuments.getDocuments(r,g).next(p=>({Rs:p,removedBatchIds:u,addedBatchIds:f}))})})}function oN(n,e){const t=Oe(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const a=e.batch.keys(),l=t.ds.newChangeBuffer({trackRemovals:!0});return function(f,g,p,y){const v=p.batch,E=v.keys();let S=oe.resolve();return E.forEach(D=>{S=S.next(()=>y.getEntry(g,D)).next(j=>{const k=p.docVersions.get(D);st(k!==null),j.version.compareTo(k)<0&&(v.applyToRemoteDocument(j,p),j.isValidDocument()&&(j.setReadTime(p.commitVersion),y.addEntry(j)))})}),S.next(()=>f.mutationQueue.removeMutationBatch(g,v))}(t,r,e,l).next(()=>l.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,a,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(f){let g=Ke();for(let p=0;p<f.mutationResults.length;++p)f.mutationResults[p].transformResults.length>0&&(g=g.add(f.batch.mutations[p].key));return g}(e))).next(()=>t.localDocuments.getDocuments(r,a))})}function r1(n){const e=Oe(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Hr.getLastRemoteSnapshotVersion(t))}function lN(n,e){const t=Oe(n),r=e.snapshotVersion;let a=t.Ts;return t.persistence.runTransaction("Apply remote event","readwrite-primary",l=>{const u=t.ds.newChangeBuffer({trackRemovals:!0});a=t.Ts;const f=[];e.targetChanges.forEach((y,v)=>{const E=a.get(v);if(!E)return;f.push(t.Hr.removeMatchingKeys(l,y.removedDocuments,v).next(()=>t.Hr.addMatchingKeys(l,y.addedDocuments,v)));let S=E.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(v)!==null?S=S.withResumeToken(Tn.EMPTY_BYTE_STRING,De.min()).withLastLimboFreeSnapshotVersion(De.min()):y.resumeToken.approximateByteSize()>0&&(S=S.withResumeToken(y.resumeToken,r)),a=a.insert(v,S),function(j,k,P){return j.resumeToken.approximateByteSize()===0||k.snapshotVersion.toMicroseconds()-j.snapshotVersion.toMicroseconds()>=rN?!0:P.addedDocuments.size+P.modifiedDocuments.size+P.removedDocuments.size>0}(E,S,y)&&f.push(t.Hr.updateTargetData(l,S))});let g=Mr(),p=Ke();if(e.documentUpdates.forEach(y=>{e.resolvedLimboDocuments.has(y)&&f.push(t.persistence.referenceDelegate.updateLimboDocument(l,y))}),f.push(cN(l,u,e.documentUpdates).next(y=>{g=y.Vs,p=y.fs})),!r.isEqual(De.min())){const y=t.Hr.getLastRemoteSnapshotVersion(l).next(v=>t.Hr.setTargetsMetadata(l,l.currentSequenceNumber,r));f.push(y)}return oe.waitFor(f).next(()=>u.apply(l)).next(()=>t.localDocuments.getLocalViewOfDocuments(l,g,p)).next(()=>g)}).then(l=>(t.Ts=a,l))}function cN(n,e,t){let r=Ke(),a=Ke();return t.forEach(l=>r=r.add(l)),e.getEntries(n,r).next(l=>{let u=Mr();return t.forEach((f,g)=>{const p=l.get(f);g.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(f)),g.isNoDocument()&&g.version.isEqual(De.min())?(e.removeEntry(f,g.readTime),u=u.insert(f,g)):!p.isValidDocument()||g.version.compareTo(p.version)>0||g.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(g),u=u.insert(f,g)):we(jm,"Ignoring outdated watch update for ",f,". Current version:",p.version," Watch version:",g.version)}),{Vs:u,fs:a}})}function uN(n,e){const t=Oe(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=xm),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function hN(n,e){const t=Oe(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let a;return t.Hr.getTargetData(r,e).next(l=>l?(a=l,oe.resolve(a)):t.Hr.allocateTargetId(r).next(u=>(a=new pi(e,u,"TargetPurposeListen",r.currentSequenceNumber),t.Hr.addTargetData(r,a).next(()=>a))))}).then(r=>{const a=t.Ts.get(r.targetId);return(a===null||r.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(t.Ts=t.Ts.insert(r.targetId,r),t.Is.set(e,r.targetId)),r})}async function Hp(n,e,t){const r=Oe(n),a=r.Ts.get(e),l=t?"readwrite":"readwrite-primary";try{t||await r.persistence.runTransaction("Release target",l,u=>r.persistence.referenceDelegate.removeTarget(u,a))}catch(u){if(!Qo(u))throw u;we(jm,`Failed to update sequence numbers for target ${e}: ${u}`)}r.Ts=r.Ts.remove(e),r.Is.delete(a.target)}function nT(n,e,t){const r=Oe(n);let a=De.min(),l=Ke();return r.persistence.runTransaction("Execute query","readwrite",u=>function(g,p,y){const v=Oe(g),E=v.Is.get(y);return E!==void 0?oe.resolve(v.Ts.get(E)):v.Hr.getTargetData(p,y)}(r,u,Ws(e)).next(f=>{if(f)return a=f.lastLimboFreeSnapshotVersion,r.Hr.getMatchingKeysForTargetId(u,f.targetId).next(g=>{l=g})}).next(()=>r.Ps.getDocumentsMatchingQuery(u,e,t?a:De.min(),t?l:Ke())).next(f=>(dN(r,JR(e),f),{documents:f,gs:l})))}function dN(n,e,t){let r=n.Es.get(e)||De.min();t.forEach((a,l)=>{l.readTime.compareTo(r)>0&&(r=l.readTime)}),n.Es.set(e,r)}class sT{constructor(){this.activeTargetIds=i2()}Ds(e){this.activeTargetIds=this.activeTargetIds.add(e)}vs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}bs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class fN{constructor(){this.ho=new sT,this.Po={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e,t=!0){return t&&this.ho.Ds(e),this.Po[e]||"not-current"}updateQueryState(e,t,r){this.Po[e]=t}removeLocalQueryTarget(e){this.ho.vs(e)}isLocalQueryTarget(e){return this.ho.activeTargetIds.has(e)}clearQueryState(e){delete this.Po[e]}getAllActiveQueryTargets(){return this.ho.activeTargetIds}isActiveQueryTarget(e){return this.ho.activeTargetIds.has(e)}start(){return this.ho=new sT,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gN{To(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT="ConnectivityMonitor";class iT{constructor(){this.Io=()=>this.Eo(),this.Ao=()=>this.Ro(),this.Vo=[],this.mo()}To(e){this.Vo.push(e)}shutdown(){window.removeEventListener("online",this.Io),window.removeEventListener("offline",this.Ao)}mo(){window.addEventListener("online",this.Io),window.addEventListener("offline",this.Ao)}Eo(){we(rT,"Network connectivity changed: AVAILABLE");for(const e of this.Vo)e(0)}Ro(){we(rT,"Network connectivity changed: UNAVAILABLE");for(const e of this.Vo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Mh=null;function Gp(){return Mh===null?Mh=function(){return 268435456+Math.round(2147483648*Math.random())}():Mh++,"0x"+Mh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp="RestConnection",pN={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class mN{get fo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.po=t+"://"+e.host,this.yo=`projects/${r}/databases/${a}`,this.wo=this.databaseId.database===ad?`project_id=${r}`:`project_id=${r}&database_id=${a}`}So(e,t,r,a,l){const u=Gp(),f=this.bo(e,t.toUriEncodedString());we(gp,`Sending RPC '${e}' ${u}:`,f,r);const g={"google-cloud-resource-prefix":this.yo,"x-goog-request-params":this.wo};return this.Do(g,a,l),this.vo(e,f,g,r).then(p=>(we(gp,`Received RPC '${e}' ${u}: `,p),p),p=>{throw Lo(gp,`RPC '${e}' ${u} failed with error: `,p,"url: ",f,"request:",r),p})}Co(e,t,r,a,l,u){return this.So(e,t,r,a,l)}Do(e,t,r){e["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+$o}(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((a,l)=>e[l]=a),r&&r.headers.forEach((a,l)=>e[l]=a)}bo(e,t){const r=pN[e];return`${this.po}/v1/${t}:${r}`}terminate(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yN{constructor(e){this.Fo=e.Fo,this.Mo=e.Mo}xo(e){this.Oo=e}No(e){this.Bo=e}Lo(e){this.ko=e}onMessage(e){this.qo=e}close(){this.Mo()}send(e){this.Fo(e)}Qo(){this.Oo()}$o(){this.Bo()}Uo(e){this.ko(e)}Ko(e){this.qo(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Sn="WebChannelConnection";class _N extends mN{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}vo(e,t,r,a){const l=Gp();return new Promise((u,f)=>{const g=new aE;g.setWithCredentials(!0),g.listenOnce(oE.COMPLETE,()=>{try{switch(g.getLastErrorCode()){case Bh.NO_ERROR:const y=g.getResponseJson();we(Sn,`XHR for RPC '${e}' ${l} received:`,JSON.stringify(y)),u(y);break;case Bh.TIMEOUT:we(Sn,`RPC '${e}' ${l} timed out`),f(new Se(le.DEADLINE_EXCEEDED,"Request time out"));break;case Bh.HTTP_ERROR:const v=g.getStatus();if(we(Sn,`RPC '${e}' ${l} failed with status:`,v,"response text:",g.getResponseText()),v>0){let E=g.getResponseJson();Array.isArray(E)&&(E=E[0]);const S=E==null?void 0:E.error;if(S&&S.status&&S.message){const D=function(k){const P=k.toLowerCase().replace(/_/g,"-");return Object.values(le).indexOf(P)>=0?P:le.UNKNOWN}(S.status);f(new Se(D,S.message))}else f(new Se(le.UNKNOWN,"Server responded with status "+g.getStatus()))}else f(new Se(le.UNAVAILABLE,"Connection failed."));break;default:Ie()}}finally{we(Sn,`RPC '${e}' ${l} completed.`)}});const p=JSON.stringify(a);we(Sn,`RPC '${e}' ${l} sending request:`,a),g.send(t,"POST",p,r,15)})}Wo(e,t,r){const a=Gp(),l=[this.po,"/","google.firestore.v1.Firestore","/",e,"/channel"],u=uE(),f=cE(),g={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(g.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(g.useFetchStreams=!0),this.Do(g.initMessageHeaders,t,r),g.encodeInitMessageHeaders=!0;const y=l.join("");we(Sn,`Creating RPC '${e}' stream ${a}: ${y}`,g);const v=u.createWebChannel(y,g);let E=!1,S=!1;const D=new yN({Fo:k=>{S?we(Sn,`Not sending because RPC '${e}' stream ${a} is closed:`,k):(E||(we(Sn,`Opening RPC '${e}' stream ${a} transport.`),v.open(),E=!0),we(Sn,`RPC '${e}' stream ${a} sending:`,k),v.send(k))},Mo:()=>v.close()}),j=(k,P,z)=>{k.listen(P,U=>{try{z(U)}catch(W){setTimeout(()=>{throw W},0)}})};return j(v,pc.EventType.OPEN,()=>{S||(we(Sn,`RPC '${e}' stream ${a} transport opened.`),D.Qo())}),j(v,pc.EventType.CLOSE,()=>{S||(S=!0,we(Sn,`RPC '${e}' stream ${a} transport closed`),D.Uo())}),j(v,pc.EventType.ERROR,k=>{S||(S=!0,Lo(Sn,`RPC '${e}' stream ${a} transport errored:`,k),D.Uo(new Se(le.UNAVAILABLE,"The operation could not be completed")))}),j(v,pc.EventType.MESSAGE,k=>{var P;if(!S){const z=k.data[0];st(!!z);const U=z,W=(U==null?void 0:U.error)||((P=U[0])===null||P===void 0?void 0:P.error);if(W){we(Sn,`RPC '${e}' stream ${a} received error:`,W);const ne=W.status;let re=function(I){const O=qt[I];if(O!==void 0)return HE(O)}(ne),M=W.message;re===void 0&&(re=le.INTERNAL,M="Unknown error status: "+ne+" with message "+W.message),S=!0,D.Uo(new Se(re,M)),v.close()}else we(Sn,`RPC '${e}' stream ${a} received:`,z),D.Ko(z)}}),j(f,lE.STAT_EVENT,k=>{k.stat===Dp.PROXY?we(Sn,`RPC '${e}' stream ${a} detected buffering proxy`):k.stat===Dp.NOPROXY&&we(Sn,`RPC '${e}' stream ${a} detected no buffering proxy`)}),setTimeout(()=>{D.$o()},0),D}}function pp(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fd(n){return new b2(n,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Um{constructor(e,t,r=1e3,a=1.5,l=6e4){this.Ti=e,this.timerId=t,this.Go=r,this.zo=a,this.jo=l,this.Ho=0,this.Jo=null,this.Yo=Date.now(),this.reset()}reset(){this.Ho=0}Zo(){this.Ho=this.jo}Xo(e){this.cancel();const t=Math.floor(this.Ho+this.e_()),r=Math.max(0,Date.now()-this.Yo),a=Math.max(0,t-r);a>0&&we("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Jo=this.Ti.enqueueAfterDelay(this.timerId,a,()=>(this.Yo=Date.now(),e())),this.Ho*=this.zo,this.Ho<this.Go&&(this.Ho=this.Go),this.Ho>this.jo&&(this.Ho=this.jo)}t_(){this.Jo!==null&&(this.Jo.skipDelay(),this.Jo=null)}cancel(){this.Jo!==null&&(this.Jo.cancel(),this.Jo=null)}e_(){return(Math.random()-.5)*this.Ho}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aT="PersistentStream";class i1{constructor(e,t,r,a,l,u,f,g){this.Ti=e,this.n_=r,this.r_=a,this.connection=l,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=f,this.listener=g,this.state=0,this.i_=0,this.s_=null,this.o_=null,this.stream=null,this.__=0,this.a_=new Um(e,t)}u_(){return this.state===1||this.state===5||this.c_()}c_(){return this.state===2||this.state===3}start(){this.__=0,this.state!==4?this.auth():this.l_()}async stop(){this.u_()&&await this.close(0)}h_(){this.state=0,this.a_.reset()}P_(){this.c_()&&this.s_===null&&(this.s_=this.Ti.enqueueAfterDelay(this.n_,6e4,()=>this.T_()))}I_(e){this.E_(),this.stream.send(e)}async T_(){if(this.c_())return this.close(0)}E_(){this.s_&&(this.s_.cancel(),this.s_=null)}d_(){this.o_&&(this.o_.cancel(),this.o_=null)}async close(e,t){this.E_(),this.d_(),this.a_.cancel(),this.i_++,e!==4?this.a_.reset():t&&t.code===le.RESOURCE_EXHAUSTED?(Dr(t.toString()),Dr("Using maximum backoff delay to prevent overloading the backend."),this.a_.Zo()):t&&t.code===le.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.A_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Lo(t)}A_(){}auth(){this.state=1;const e=this.R_(this.i_),t=this.i_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,a])=>{this.i_===t&&this.V_(r,a)},r=>{e(()=>{const a=new Se(le.UNKNOWN,"Fetching auth token failed: "+r.message);return this.m_(a)})})}V_(e,t){const r=this.R_(this.i_);this.stream=this.f_(e,t),this.stream.xo(()=>{r(()=>this.listener.xo())}),this.stream.No(()=>{r(()=>(this.state=2,this.o_=this.Ti.enqueueAfterDelay(this.r_,1e4,()=>(this.c_()&&(this.state=3),Promise.resolve())),this.listener.No()))}),this.stream.Lo(a=>{r(()=>this.m_(a))}),this.stream.onMessage(a=>{r(()=>++this.__==1?this.g_(a):this.onNext(a))})}l_(){this.state=5,this.a_.Xo(async()=>{this.state=0,this.start()})}m_(e){return we(aT,`close with error: ${e}`),this.stream=null,this.close(4,e)}R_(e){return t=>{this.Ti.enqueueAndForget(()=>this.i_===e?t():(we(aT,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class vN extends i1{constructor(e,t,r,a,l,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,a,u),this.serializer=l}f_(e,t){return this.connection.Wo("Listen",e,t)}g_(e){return this.onNext(e)}onNext(e){this.a_.reset();const t=C2(this.serializer,e),r=function(l){if(!("targetChange"in l))return De.min();const u=l.targetChange;return u.targetIds&&u.targetIds.length?De.min():u.readTime?es(u.readTime):De.min()}(e);return this.listener.p_(t,r)}y_(e){const t={};t.database=qp(this.serializer),t.addTarget=function(l,u){let f;const g=u.target;if(f=Up(g)?{documents:I2(l,g)}:{query:R2(l,g).ht},f.targetId=u.targetId,u.resumeToken.approximateByteSize()>0){f.resumeToken=KE(l,u.resumeToken);const p=Bp(l,u.expectedCount);p!==null&&(f.expectedCount=p)}else if(u.snapshotVersion.compareTo(De.min())>0){f.readTime=dd(l,u.snapshotVersion.toTimestamp());const p=Bp(l,u.expectedCount);p!==null&&(f.expectedCount=p)}return f}(this.serializer,e);const r=P2(this.serializer,e);r&&(t.labels=r),this.I_(t)}w_(e){const t={};t.database=qp(this.serializer),t.removeTarget=e,this.I_(t)}}class wN extends i1{constructor(e,t,r,a,l,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,a,u),this.serializer=l}get S_(){return this.__>0}start(){this.lastStreamToken=void 0,super.start()}A_(){this.S_&&this.b_([])}f_(e,t){return this.connection.Wo("Write",e,t)}g_(e){return st(!!e.streamToken),this.lastStreamToken=e.streamToken,st(!e.writeResults||e.writeResults.length===0),this.listener.D_()}onNext(e){st(!!e.streamToken),this.lastStreamToken=e.streamToken,this.a_.reset();const t=A2(e.writeResults,e.commitTime),r=es(e.commitTime);return this.listener.v_(r,t)}C_(){const e={};e.database=qp(this.serializer),this.I_(e)}b_(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>XE(this.serializer,r))};this.I_(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TN{}class bN extends TN{constructor(e,t,r,a){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=a,this.F_=!1}M_(){if(this.F_)throw new Se(le.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,a){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([l,u])=>this.connection.So(e,Fp(t,r),a,l,u)).catch(l=>{throw l.name==="FirebaseError"?(l.code===le.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Se(le.UNKNOWN,l.toString())})}Co(e,t,r,a,l){return this.M_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([u,f])=>this.connection.Co(e,Fp(t,r),a,u,f,l)).catch(u=>{throw u.name==="FirebaseError"?(u.code===le.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),u):new Se(le.UNKNOWN,u.toString())})}terminate(){this.F_=!0,this.connection.terminate()}}class EN{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.x_=0,this.O_=null,this.N_=!0}B_(){this.x_===0&&(this.L_("Unknown"),this.O_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.O_=null,this.k_("Backend didn't respond within 10 seconds."),this.L_("Offline"),Promise.resolve())))}q_(e){this.state==="Online"?this.L_("Unknown"):(this.x_++,this.x_>=1&&(this.Q_(),this.k_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.L_("Offline")))}set(e){this.Q_(),this.x_=0,e==="Online"&&(this.N_=!1),this.L_(e)}L_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}k_(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.N_?(Dr(t),this.N_=!1):we("OnlineStateTracker",t)}Q_(){this.O_!==null&&(this.O_.cancel(),this.O_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _a="RemoteStore";class SN{constructor(e,t,r,a,l){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.U_=[],this.K_=new Map,this.W_=new Set,this.G_=[],this.z_=l,this.z_.To(u=>{r.enqueueAndForget(async()=>{Ca(this)&&(we(_a,"Restarting streams for network reachability change."),await async function(g){const p=Oe(g);p.W_.add(4),await Xc(p),p.j_.set("Unknown"),p.W_.delete(4),await qd(p)}(this))})}),this.j_=new EN(r,a)}}async function qd(n){if(Ca(n))for(const e of n.G_)await e(!0)}async function Xc(n){for(const e of n.G_)await e(!1)}function a1(n,e){const t=Oe(n);t.K_.has(e.targetId)||(t.K_.set(e.targetId,e),qm(t)?Fm(t):Yo(t).c_()&&Bm(t,e))}function zm(n,e){const t=Oe(n),r=Yo(t);t.K_.delete(e),r.c_()&&o1(t,e),t.K_.size===0&&(r.c_()?r.P_():Ca(t)&&t.j_.set("Unknown"))}function Bm(n,e){if(n.H_.Ne(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(De.min())>0){const t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Yo(n).y_(e)}function o1(n,e){n.H_.Ne(e),Yo(n).w_(e)}function Fm(n){n.H_=new _2({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),lt:e=>n.K_.get(e)||null,it:()=>n.datastore.serializer.databaseId}),Yo(n).start(),n.j_.B_()}function qm(n){return Ca(n)&&!Yo(n).u_()&&n.K_.size>0}function Ca(n){return Oe(n).W_.size===0}function l1(n){n.H_=void 0}async function xN(n){n.j_.set("Online")}async function CN(n){n.K_.forEach((e,t)=>{Bm(n,e)})}async function AN(n,e){l1(n),qm(n)?(n.j_.q_(e),Fm(n)):n.j_.set("Unknown")}async function IN(n,e,t){if(n.j_.set("Online"),e instanceof $E&&e.state===2&&e.cause)try{await async function(a,l){const u=l.cause;for(const f of l.targetIds)a.K_.has(f)&&(await a.remoteSyncer.rejectListen(f,u),a.K_.delete(f),a.H_.removeTarget(f))}(n,e)}catch(r){we(_a,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),await pd(n,r)}else if(e instanceof Gh?n.H_.We(e):e instanceof GE?n.H_.Ze(e):n.H_.je(e),!t.isEqual(De.min()))try{const r=await r1(n.localStore);t.compareTo(r)>=0&&await function(l,u){const f=l.H_.ot(u);return f.targetChanges.forEach((g,p)=>{if(g.resumeToken.approximateByteSize()>0){const y=l.K_.get(p);y&&l.K_.set(p,y.withResumeToken(g.resumeToken,u))}}),f.targetMismatches.forEach((g,p)=>{const y=l.K_.get(g);if(!y)return;l.K_.set(g,y.withResumeToken(Tn.EMPTY_BYTE_STRING,y.snapshotVersion)),o1(l,g);const v=new pi(y.target,g,p,y.sequenceNumber);Bm(l,v)}),l.remoteSyncer.applyRemoteEvent(f)}(n,t)}catch(r){we(_a,"Failed to raise snapshot:",r),await pd(n,r)}}async function pd(n,e,t){if(!Qo(e))throw e;n.W_.add(1),await Xc(n),n.j_.set("Offline"),t||(t=()=>r1(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{we(_a,"Retrying IndexedDB access"),await t(),n.W_.delete(1),await qd(n)})}function c1(n,e){return e().catch(t=>pd(n,t,e))}async function Hd(n){const e=Oe(n),t=Ci(e);let r=e.U_.length>0?e.U_[e.U_.length-1].batchId:xm;for(;RN(e);)try{const a=await uN(e.localStore,r);if(a===null){e.U_.length===0&&t.P_();break}r=a.batchId,NN(e,a)}catch(a){await pd(e,a)}u1(e)&&h1(e)}function RN(n){return Ca(n)&&n.U_.length<10}function NN(n,e){n.U_.push(e);const t=Ci(n);t.c_()&&t.S_&&t.b_(e.mutations)}function u1(n){return Ca(n)&&!Ci(n).u_()&&n.U_.length>0}function h1(n){Ci(n).start()}async function PN(n){Ci(n).C_()}async function kN(n){const e=Ci(n);for(const t of n.U_)e.b_(t.mutations)}async function DN(n,e,t){const r=n.U_.shift(),a=km.from(r,e,t);await c1(n,()=>n.remoteSyncer.applySuccessfulWrite(a)),await Hd(n)}async function MN(n,e){e&&Ci(n).S_&&await async function(r,a){if(function(u){return qE(u)&&u!==le.ABORTED}(a.code)){const l=r.U_.shift();Ci(r).h_(),await c1(r,()=>r.remoteSyncer.rejectFailedWrite(l.batchId,a)),await Hd(r)}}(n,e),u1(n)&&h1(n)}async function oT(n,e){const t=Oe(n);t.asyncQueue.verifyOperationInProgress(),we(_a,"RemoteStore received new credentials");const r=Ca(t);t.W_.add(3),await Xc(t),r&&t.j_.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t.W_.delete(3),await qd(t)}async function ON(n,e){const t=Oe(n);e?(t.W_.delete(2),await qd(t)):e||(t.W_.add(2),await Xc(t),t.j_.set("Unknown"))}function Yo(n){return n.J_||(n.J_=function(t,r,a){const l=Oe(t);return l.M_(),new vN(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)}(n.datastore,n.asyncQueue,{xo:xN.bind(null,n),No:CN.bind(null,n),Lo:AN.bind(null,n),p_:IN.bind(null,n)}),n.G_.push(async e=>{e?(n.J_.h_(),qm(n)?Fm(n):n.j_.set("Unknown")):(await n.J_.stop(),l1(n))})),n.J_}function Ci(n){return n.Y_||(n.Y_=function(t,r,a){const l=Oe(t);return l.M_(),new wN(r,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)}(n.datastore,n.asyncQueue,{xo:()=>Promise.resolve(),No:PN.bind(null,n),Lo:MN.bind(null,n),D_:kN.bind(null,n),v_:DN.bind(null,n)}),n.G_.push(async e=>{e?(n.Y_.h_(),await Hd(n)):(await n.Y_.stop(),n.U_.length>0&&(we(_a,`Stopping write stream with ${n.U_.length} pending writes`),n.U_=[]))})),n.Y_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hm{constructor(e,t,r,a,l){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=a,this.removalCallback=l,this.deferred=new Rr,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,a,l){const u=Date.now()+r,f=new Hm(e,t,u,a,l);return f.start(r),f}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Se(le.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Gm(n,e){if(Dr("AsyncQueue",`${e}: ${n}`),Qo(n))return new Se(le.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{static emptySet(e){return new ko(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||Re.comparator(t.key,r.key):(t,r)=>Re.comparator(t.key,r.key),this.keyedMap=mc(),this.sortedSet=new Ht(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof ko)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const a=t.getNext().key,l=r.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const r=new ko;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(){this.Z_=new Ht(Re.comparator)}track(e){const t=e.doc.key,r=this.Z_.get(t);r?e.type!==0&&r.type===3?this.Z_=this.Z_.insert(t,e):e.type===3&&r.type!==1?this.Z_=this.Z_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.Z_=this.Z_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.Z_=this.Z_.remove(t):e.type===1&&r.type===2?this.Z_=this.Z_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.Z_=this.Z_.insert(t,{type:2,doc:e.doc}):Ie():this.Z_=this.Z_.insert(t,e)}X_(){const e=[];return this.Z_.inorderTraversal((t,r)=>{e.push(r)}),e}}class Fo{constructor(e,t,r,a,l,u,f,g,p){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=l,this.fromCache=u,this.syncStateChanged=f,this.excludesMetadataChanges=g,this.hasCachedResults=p}static fromInitialDocuments(e,t,r,a,l){const u=[];return t.forEach(f=>{u.push({type:0,doc:f})}),new Fo(e,t,ko.emptySet(t),u,r,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vd(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let a=0;a<t.length;a++)if(t[a].type!==r[a].type||!t[a].doc.isEqual(r[a].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LN{constructor(){this.ea=void 0,this.ta=[]}na(){return this.ta.some(e=>e.ra())}}class VN{constructor(){this.queries=cT(),this.onlineState="Unknown",this.ia=new Set}terminate(){(function(t,r){const a=Oe(t),l=a.queries;a.queries=cT(),l.forEach((u,f)=>{for(const g of f.ta)g.onError(r)})})(this,new Se(le.ABORTED,"Firestore shutting down"))}}function cT(){return new xa(n=>NE(n),Vd)}async function d1(n,e){const t=Oe(n);let r=3;const a=e.query;let l=t.queries.get(a);l?!l.na()&&e.ra()&&(r=2):(l=new LN,r=e.ra()?0:1);try{switch(r){case 0:l.ea=await t.onListen(a,!0);break;case 1:l.ea=await t.onListen(a,!1);break;case 2:await t.onFirstRemoteStoreListen(a)}}catch(u){const f=Gm(u,`Initialization of query '${So(e.query)}' failed`);return void e.onError(f)}t.queries.set(a,l),l.ta.push(e),e.sa(t.onlineState),l.ea&&e.oa(l.ea)&&$m(t)}async function f1(n,e){const t=Oe(n),r=e.query;let a=3;const l=t.queries.get(r);if(l){const u=l.ta.indexOf(e);u>=0&&(l.ta.splice(u,1),l.ta.length===0?a=e.ra()?0:1:!l.na()&&e.ra()&&(a=2))}switch(a){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}}function jN(n,e){const t=Oe(n);let r=!1;for(const a of e){const l=a.query,u=t.queries.get(l);if(u){for(const f of u.ta)f.oa(a)&&(r=!0);u.ea=a}}r&&$m(t)}function UN(n,e,t){const r=Oe(n),a=r.queries.get(e);if(a)for(const l of a.ta)l.onError(t);r.queries.delete(e)}function $m(n){n.ia.forEach(e=>{e.next()})}var $p,uT;(uT=$p||($p={}))._a="default",uT.Cache="cache";class g1{constructor(e,t,r){this.query=e,this.aa=t,this.ua=!1,this.ca=null,this.onlineState="Unknown",this.options=r||{}}oa(e){if(!this.options.includeMetadataChanges){const r=[];for(const a of e.docChanges)a.type!==3&&r.push(a);e=new Fo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.ua?this.la(e)&&(this.aa.next(e),t=!0):this.ha(e,this.onlineState)&&(this.Pa(e),t=!0),this.ca=e,t}onError(e){this.aa.error(e)}sa(e){this.onlineState=e;let t=!1;return this.ca&&!this.ua&&this.ha(this.ca,e)&&(this.Pa(this.ca),t=!0),t}ha(e,t){if(!e.fromCache||!this.ra())return!0;const r=t!=="Offline";return(!this.options.Ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}la(e){if(e.docChanges.length>0)return!0;const t=this.ca&&this.ca.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}Pa(e){e=Fo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.ua=!0,this.aa.next(e)}ra(){return this.options.source!==$p.Cache}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class p1{constructor(e){this.key=e}}class m1{constructor(e){this.key=e}}class zN{constructor(e,t){this.query=e,this.fa=t,this.ga=null,this.hasCachedResults=!1,this.current=!1,this.pa=Ke(),this.mutatedKeys=Ke(),this.ya=PE(e),this.wa=new ko(this.ya)}get Sa(){return this.fa}ba(e,t){const r=t?t.Da:new lT,a=t?t.wa:this.wa;let l=t?t.mutatedKeys:this.mutatedKeys,u=a,f=!1;const g=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((y,v)=>{const E=a.get(y),S=jd(this.query,v)?v:null,D=!!E&&this.mutatedKeys.has(E.key),j=!!S&&(S.hasLocalMutations||this.mutatedKeys.has(S.key)&&S.hasCommittedMutations);let k=!1;E&&S?E.data.isEqual(S.data)?D!==j&&(r.track({type:3,doc:S}),k=!0):this.va(E,S)||(r.track({type:2,doc:S}),k=!0,(g&&this.ya(S,g)>0||p&&this.ya(S,p)<0)&&(f=!0)):!E&&S?(r.track({type:0,doc:S}),k=!0):E&&!S&&(r.track({type:1,doc:E}),k=!0,(g||p)&&(f=!0)),k&&(S?(u=u.add(S),l=j?l.add(y):l.delete(y)):(u=u.delete(y),l=l.delete(y)))}),this.query.limit!==null)for(;u.size>this.query.limit;){const y=this.query.limitType==="F"?u.last():u.first();u=u.delete(y.key),l=l.delete(y.key),r.track({type:1,doc:y})}return{wa:u,Da:r,ls:f,mutatedKeys:l}}va(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,a){const l=this.wa;this.wa=e.wa,this.mutatedKeys=e.mutatedKeys;const u=e.Da.X_();u.sort((y,v)=>function(S,D){const j=k=>{switch(k){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ie()}};return j(S)-j(D)}(y.type,v.type)||this.ya(y.doc,v.doc)),this.Ca(r),a=a!=null&&a;const f=t&&!a?this.Fa():[],g=this.pa.size===0&&this.current&&!a?1:0,p=g!==this.ga;return this.ga=g,u.length!==0||p?{snapshot:new Fo(this.query,e.wa,l,u,e.mutatedKeys,g===0,p,!1,!!r&&r.resumeToken.approximateByteSize()>0),Ma:f}:{Ma:f}}sa(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({wa:this.wa,Da:new lT,mutatedKeys:this.mutatedKeys,ls:!1},!1)):{Ma:[]}}xa(e){return!this.fa.has(e)&&!!this.wa.has(e)&&!this.wa.get(e).hasLocalMutations}Ca(e){e&&(e.addedDocuments.forEach(t=>this.fa=this.fa.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.fa=this.fa.delete(t)),this.current=e.current)}Fa(){if(!this.current)return[];const e=this.pa;this.pa=Ke(),this.wa.forEach(r=>{this.xa(r.key)&&(this.pa=this.pa.add(r.key))});const t=[];return e.forEach(r=>{this.pa.has(r)||t.push(new m1(r))}),this.pa.forEach(r=>{e.has(r)||t.push(new p1(r))}),t}Oa(e){this.fa=e.gs,this.pa=Ke();const t=this.ba(e.documents);return this.applyChanges(t,!0)}Na(){return Fo.fromInitialDocuments(this.query,this.wa,this.mutatedKeys,this.ga===0,this.hasCachedResults)}}const Km="SyncEngine";class BN{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class FN{constructor(e){this.key=e,this.Ba=!1}}class qN{constructor(e,t,r,a,l,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=u,this.La={},this.ka=new xa(f=>NE(f),Vd),this.qa=new Map,this.Qa=new Set,this.$a=new Ht(Re.comparator),this.Ua=new Map,this.Ka=new Om,this.Wa={},this.Ga=new Map,this.za=Bo.Kn(),this.onlineState="Unknown",this.ja=void 0}get isPrimaryClient(){return this.ja===!0}}async function HN(n,e,t=!0){const r=b1(n);let a;const l=r.ka.get(e);return l?(r.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.Na()):a=await y1(r,e,t,!0),a}async function GN(n,e){const t=b1(n);await y1(t,e,!0,!1)}async function y1(n,e,t,r){const a=await hN(n.localStore,Ws(e)),l=a.targetId,u=n.sharedClientState.addLocalQueryTarget(l,t);let f;return r&&(f=await $N(n,e,l,u==="current",a.resumeToken)),n.isPrimaryClient&&t&&a1(n.remoteStore,a),f}async function $N(n,e,t,r,a){n.Ha=(v,E,S)=>async function(j,k,P,z){let U=k.view.ba(P);U.ls&&(U=await nT(j.localStore,k.query,!1).then(({documents:M})=>k.view.ba(M,U)));const W=z&&z.targetChanges.get(k.targetId),ne=z&&z.targetMismatches.get(k.targetId)!=null,re=k.view.applyChanges(U,j.isPrimaryClient,W,ne);return dT(j,k.targetId,re.Ma),re.snapshot}(n,v,E,S);const l=await nT(n.localStore,e,!0),u=new zN(e,l.gs),f=u.ba(l.documents),g=Wc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",a),p=u.applyChanges(f,n.isPrimaryClient,g);dT(n,t,p.Ma);const y=new BN(e,t,u);return n.ka.set(e,y),n.qa.has(t)?n.qa.get(t).push(e):n.qa.set(t,[e]),p.snapshot}async function KN(n,e,t){const r=Oe(n),a=r.ka.get(e),l=r.qa.get(a.targetId);if(l.length>1)return r.qa.set(a.targetId,l.filter(u=>!Vd(u,e))),void r.ka.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(a.targetId),r.sharedClientState.isActiveQueryTarget(a.targetId)||await Hp(r.localStore,a.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(a.targetId),t&&zm(r.remoteStore,a.targetId),Kp(r,a.targetId)}).catch(Ko)):(Kp(r,a.targetId),await Hp(r.localStore,a.targetId,!0))}async function QN(n,e){const t=Oe(n),r=t.ka.get(e),a=t.qa.get(r.targetId);t.isPrimaryClient&&a.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),zm(t.remoteStore,r.targetId))}async function YN(n,e,t){const r=nP(n);try{const a=await function(u,f){const g=Oe(u),p=Jt.now(),y=f.reduce((S,D)=>S.add(D.key),Ke());let v,E;return g.persistence.runTransaction("Locally write mutations","readwrite",S=>{let D=Mr(),j=Ke();return g.ds.getEntries(S,y).next(k=>{D=k,D.forEach((P,z)=>{z.isValidDocument()||(j=j.add(P))})}).next(()=>g.localDocuments.getOverlayedDocuments(S,D)).next(k=>{v=k;const P=[];for(const z of f){const U=f2(z,v.get(z.key).overlayedDocument);U!=null&&P.push(new Pi(z.key,U,EE(U.value.mapValue),jn.exists(!0)))}return g.mutationQueue.addMutationBatch(S,p,P,f)}).next(k=>{E=k;const P=k.applyToLocalDocumentSet(v,j);return g.documentOverlayCache.saveOverlays(S,k.batchId,P)})}).then(()=>({batchId:E.batchId,changes:DE(v)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(a.batchId),function(u,f,g){let p=u.Wa[u.currentUser.toKey()];p||(p=new Ht(Be)),p=p.insert(f,g),u.Wa[u.currentUser.toKey()]=p}(r,a.batchId,t),await Zc(r,a.changes),await Hd(r.remoteStore)}catch(a){const l=Gm(a,"Failed to persist write");t.reject(l)}}async function _1(n,e){const t=Oe(n);try{const r=await lN(t.localStore,e);e.targetChanges.forEach((a,l)=>{const u=t.Ua.get(l);u&&(st(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1),a.addedDocuments.size>0?u.Ba=!0:a.modifiedDocuments.size>0?st(u.Ba):a.removedDocuments.size>0&&(st(u.Ba),u.Ba=!1))}),await Zc(t,r,e)}catch(r){await Ko(r)}}function hT(n,e,t){const r=Oe(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){const a=[];r.ka.forEach((l,u)=>{const f=u.view.sa(e);f.snapshot&&a.push(f.snapshot)}),function(u,f){const g=Oe(u);g.onlineState=f;let p=!1;g.queries.forEach((y,v)=>{for(const E of v.ta)E.sa(f)&&(p=!0)}),p&&$m(g)}(r.eventManager,e),a.length&&r.La.p_(a),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function WN(n,e,t){const r=Oe(n);r.sharedClientState.updateQueryState(e,"rejected",t);const a=r.Ua.get(e),l=a&&a.key;if(l){let u=new Ht(Re.comparator);u=u.insert(l,un.newNoDocument(l,De.min()));const f=Ke().add(l),g=new Bd(De.min(),new Map,new Ht(Be),u,f);await _1(r,g),r.$a=r.$a.remove(l),r.Ua.delete(e),Qm(r)}else await Hp(r.localStore,e,!1).then(()=>Kp(r,e,t)).catch(Ko)}async function XN(n,e){const t=Oe(n),r=e.batch.batchId;try{const a=await oN(t.localStore,e);w1(t,r,null),v1(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),await Zc(t,a)}catch(a){await Ko(a)}}async function ZN(n,e,t){const r=Oe(n);try{const a=await function(u,f){const g=Oe(u);return g.persistence.runTransaction("Reject batch","readwrite-primary",p=>{let y;return g.mutationQueue.lookupMutationBatch(p,f).next(v=>(st(v!==null),y=v.keys(),g.mutationQueue.removeMutationBatch(p,v))).next(()=>g.mutationQueue.performConsistencyCheck(p)).next(()=>g.documentOverlayCache.removeOverlaysForBatchId(p,y,f)).next(()=>g.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,y)).next(()=>g.localDocuments.getDocuments(p,y))})}(r.localStore,e);w1(r,e,t),v1(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),await Zc(r,a)}catch(a){await Ko(a)}}function v1(n,e){(n.Ga.get(e)||[]).forEach(t=>{t.resolve()}),n.Ga.delete(e)}function w1(n,e,t){const r=Oe(n);let a=r.Wa[r.currentUser.toKey()];if(a){const l=a.get(e);l&&(t?l.reject(t):l.resolve(),a=a.remove(e)),r.Wa[r.currentUser.toKey()]=a}}function Kp(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.qa.get(e))n.ka.delete(r),t&&n.La.Ja(r,t);n.qa.delete(e),n.isPrimaryClient&&n.Ka.br(e).forEach(r=>{n.Ka.containsKey(r)||T1(n,r)})}function T1(n,e){n.Qa.delete(e.path.canonicalString());const t=n.$a.get(e);t!==null&&(zm(n.remoteStore,t),n.$a=n.$a.remove(e),n.Ua.delete(t),Qm(n))}function dT(n,e,t){for(const r of t)r instanceof p1?(n.Ka.addReference(r.key,e),JN(n,r)):r instanceof m1?(we(Km,"Document no longer in limbo: "+r.key),n.Ka.removeReference(r.key,e),n.Ka.containsKey(r.key)||T1(n,r.key)):Ie()}function JN(n,e){const t=e.key,r=t.path.canonicalString();n.$a.get(t)||n.Qa.has(r)||(we(Km,"New document in limbo: "+t),n.Qa.add(r),Qm(n))}function Qm(n){for(;n.Qa.size>0&&n.$a.size<n.maxConcurrentLimboResolutions;){const e=n.Qa.values().next().value;n.Qa.delete(e);const t=new Re(Pt.fromString(e)),r=n.za.next();n.Ua.set(r,new FN(t)),n.$a=n.$a.insert(t,r),a1(n.remoteStore,new pi(Ws(Ld(t.path)),r,"TargetPurposeLimboResolution",Dd.ae))}}async function Zc(n,e,t){const r=Oe(n),a=[],l=[],u=[];r.ka.isEmpty()||(r.ka.forEach((f,g)=>{u.push(r.Ha(g,e,t).then(p=>{var y;if((p||t)&&r.isPrimaryClient){const v=p?!p.fromCache:(y=t==null?void 0:t.targetChanges.get(g.targetId))===null||y===void 0?void 0:y.current;r.sharedClientState.updateQueryState(g.targetId,v?"current":"not-current")}if(p){a.push(p);const v=Vm.Yi(g.targetId,p);l.push(v)}}))}),await Promise.all(u),r.La.p_(a),await async function(g,p){const y=Oe(g);try{await y.persistence.runTransaction("notifyLocalViewChanges","readwrite",v=>oe.forEach(p,E=>oe.forEach(E.Hi,S=>y.persistence.referenceDelegate.addReference(v,E.targetId,S)).next(()=>oe.forEach(E.Ji,S=>y.persistence.referenceDelegate.removeReference(v,E.targetId,S)))))}catch(v){if(!Qo(v))throw v;we(jm,"Failed to update sequence numbers: "+v)}for(const v of p){const E=v.targetId;if(!v.fromCache){const S=y.Ts.get(E),D=S.snapshotVersion,j=S.withLastLimboFreeSnapshotVersion(D);y.Ts=y.Ts.insert(E,j)}}}(r.localStore,l))}async function eP(n,e){const t=Oe(n);if(!t.currentUser.isEqual(e)){we(Km,"User change. New user:",e.toKey());const r=await s1(t.localStore,e);t.currentUser=e,function(l,u){l.Ga.forEach(f=>{f.forEach(g=>{g.reject(new Se(le.CANCELLED,u))})}),l.Ga.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Zc(t,r.Rs)}}function tP(n,e){const t=Oe(n),r=t.Ua.get(e);if(r&&r.Ba)return Ke().add(r.key);{let a=Ke();const l=t.qa.get(e);if(!l)return a;for(const u of l){const f=t.ka.get(u);a=a.unionWith(f.view.Sa)}return a}}function b1(n){const e=Oe(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=_1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=tP.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=WN.bind(null,e),e.La.p_=jN.bind(null,e.eventManager),e.La.Ja=UN.bind(null,e.eventManager),e}function nP(n){const e=Oe(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=XN.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ZN.bind(null,e),e}class md{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Fd(e.databaseInfo.databaseId),this.sharedClientState=this.Za(e),this.persistence=this.Xa(e),await this.persistence.start(),this.localStore=this.eu(e),this.gcScheduler=this.tu(e,this.localStore),this.indexBackfillerScheduler=this.nu(e,this.localStore)}tu(e,t){return null}nu(e,t){return null}eu(e){return aN(this.persistence,new sN,e.initialUser,this.serializer)}Xa(e){return new n1(Lm.ri,this.serializer)}Za(e){return new fN}async terminate(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}md.provider={build:()=>new md};class sP extends md{constructor(e){super(),this.cacheSizeBytes=e}tu(e,t){st(this.persistence.referenceDelegate instanceof gd);const r=this.persistence.referenceDelegate.garbageCollector;return new F2(r,e.asyncQueue,t)}Xa(e){const t=this.cacheSizeBytes!==void 0?qn.withCacheSize(this.cacheSizeBytes):qn.DEFAULT;return new n1(r=>gd.ri(r,t),this.serializer)}}class Qp{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>hT(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=eP.bind(null,this.syncEngine),await ON(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new VN}()}createDatastore(e){const t=Fd(e.databaseInfo.databaseId),r=function(l){return new _N(l)}(e.databaseInfo);return function(l,u,f,g){return new bN(l,u,f,g)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,a,l,u,f){return new SN(r,a,l,u,f)}(this.localStore,this.datastore,e.asyncQueue,t=>hT(this.syncEngine,t,0),function(){return iT.D()?new iT:new gN}())}createSyncEngine(e,t){return function(a,l,u,f,g,p,y){const v=new qN(a,l,u,f,g,p);return y&&(v.ja=!0),v}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(a){const l=Oe(a);we(_a,"RemoteStore shutting down."),l.W_.add(5),await Xc(l),l.z_.shutdown(),l.j_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(t=this.eventManager)===null||t===void 0||t.terminate()}}Qp.provider={build:()=>new Qp};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class E1{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.iu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.iu(this.observer.error,e):Dr("Uncaught Error in snapshot listener:",e.toString()))}su(){this.muted=!0}iu(e,t){setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rP{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new Se(le.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(a,l){const u=Oe(a),f={documents:l.map(v=>fd(u.serializer,v))},g=await u.Co("BatchGetDocuments",u.serializer.databaseId,Pt.emptyPath(),f,l.length),p=new Map;g.forEach(v=>{const E=x2(u.serializer,v);p.set(E.key.toString(),E)});const y=[];return l.forEach(v=>{const E=p.get(v.toString());st(!!E),y.push(E)}),y}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Pm(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{const a=Re.fromPath(r);this.mutations.push(new FE(a,this.precondition(a)))}),await async function(r,a){const l=Oe(r),u={writes:a.map(f=>XE(l.serializer,f))};await l.So("Commit",l.serializer.databaseId,Pt.emptyPath(),u)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Ie();t=De.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new Se(le.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(De.min())?jn.exists(!1):jn.updateTime(t):jn.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(De.min()))throw new Se(le.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jn.updateTime(t)}return jn.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iP{constructor(e,t,r,a,l){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=a,this.deferred=l,this.Tu=r.maxAttempts,this.a_=new Um(this.asyncQueue,"transaction_retry")}Iu(){this.Tu-=1,this.Eu()}Eu(){this.a_.Xo(async()=>{const e=new rP(this.datastore),t=this.du(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(a=>{this.Au(a)}))}).catch(r=>{this.Au(r)})})}du(e){try{const t=this.updateFunction(e);return!Qc(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Au(e){this.Tu>0&&this.Ru(e)?(this.Tu-=1,this.asyncQueue.enqueueAndForget(()=>(this.Eu(),Promise.resolve()))):this.deferred.reject(e)}Ru(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!qE(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ai="FirestoreClient";class aP{constructor(e,t,r,a,l){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=a,this.user=xn.UNAUTHENTICATED,this.clientId=fE.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(r,async u=>{we(Ai,"Received user=",u.uid),await this.authCredentialListener(u),this.user=u}),this.appCheckCredentials.start(r,u=>(we(Ai,"Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Rr;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Gm(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function mp(n,e){n.asyncQueue.verifyOperationInProgress(),we(Ai,"Initializing OfflineComponentProvider");const t=n.configuration;await e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(async a=>{r.isEqual(a)||(await s1(e.localStore,a),r=a)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e}async function fT(n,e){n.asyncQueue.verifyOperationInProgress();const t=await oP(n);we(Ai,"Initializing OnlineComponentProvider"),await e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>oT(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,a)=>oT(e.remoteStore,a)),n._onlineComponents=e}async function oP(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){we(Ai,"Using user provided OfflineComponentProvider");try{await mp(n,n._uninitializedComponentsProvider._offline)}catch(e){const t=e;if(!function(a){return a.name==="FirebaseError"?a.code===le.FAILED_PRECONDITION||a.code===le.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11}(t))throw t;Lo("Error using user provided cache. Falling back to memory cache: "+t),await mp(n,new md)}}else we(Ai,"Using default OfflineComponentProvider"),await mp(n,new sP(void 0));return n._offlineComponents}async function Ym(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(we(Ai,"Using user provided OnlineComponentProvider"),await fT(n,n._uninitializedComponentsProvider._online)):(we(Ai,"Using default OnlineComponentProvider"),await fT(n,new Qp))),n._onlineComponents}function lP(n){return Ym(n).then(e=>e.syncEngine)}function cP(n){return Ym(n).then(e=>e.datastore)}async function Yp(n){const e=await Ym(n),t=e.eventManager;return t.onListen=HN.bind(null,e.syncEngine),t.onUnlisten=KN.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=GN.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=QN.bind(null,e.syncEngine),t}function uP(n,e,t={}){const r=new Rr;return n.asyncQueue.enqueueAndForget(async()=>function(l,u,f,g,p){const y=new E1({next:E=>{y.su(),u.enqueueAndForget(()=>f1(l,v));const S=E.docs.has(f);!S&&E.fromCache?p.reject(new Se(le.UNAVAILABLE,"Failed to get document because the client is offline.")):S&&E.fromCache&&g&&g.source==="server"?p.reject(new Se(le.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(E)},error:E=>p.reject(E)}),v=new g1(Ld(f.path),y,{includeMetadataChanges:!0,Ta:!0});return d1(l,v)}(await Yp(n),n.asyncQueue,e,t,r)),r.promise}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S1(n){const e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gT=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hP(n,e,t){if(!t)throw new Se(le.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function dP(n,e,t,r){if(e===!0&&r===!0)throw new Se(le.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function pT(n){if(!Re.isDocumentKey(n))throw new Se(le.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Wm(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":Ie()}function As(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new Se(le.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Wm(n);throw new Se(le.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x1="firestore.googleapis.com",mT=!0;class yT{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new Se(le.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=x1,this.ssl=mT}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:mT;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=t1;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<z2)throw new Se(le.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}dP("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=S1((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(l){if(l.timeoutSeconds!==void 0){if(isNaN(l.timeoutSeconds))throw new Se(le.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (must not be NaN)`);if(l.timeoutSeconds<5)throw new Se(le.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (minimum allowed value is 5)`);if(l.timeoutSeconds>30)throw new Se(le.INVALID_ARGUMENT,`invalid long polling timeout: ${l.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,a){return r.timeoutSeconds===a.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Xm{constructor(e,t,r,a){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new yT({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Se(le.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Se(le.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new yT(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new yR;switch(r.type){case"firstParty":return new TR(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new Se(le.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const r=gT.get(t);r&&(we("ComponentProvider","Removing Datastore"),gT.delete(t),r.terminate())}(this),Promise.resolve()}}function fP(n,e,t,r={}){var a;const l=(n=As(n,Xm))._getSettings(),u=Object.assign(Object.assign({},l),{emulatorOptions:n._getEmulatorOptions()}),f=`${e}:${t}`;l.host!==x1&&l.host!==f&&Lo("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const g=Object.assign(Object.assign({},l),{host:f,ssl:!1,emulatorOptions:r});if(!Pr(g,u)&&(n._setSettings(g),r.mockUserToken)){let p,y;if(typeof r.mockUserToken=="string")p=r.mockUserToken,y=xn.MOCK_USER;else{p=Cb(r.mockUserToken,(a=n._app)===null||a===void 0?void 0:a.options.projectId);const v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new Se(le.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new xn(v)}n._authCredentials=new _R(new hE(p,y))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gd{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Gd(this.firestore,e,this._query)}}class Un{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new zc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Un(this.firestore,e,this._key)}}class zc extends Gd{constructor(e,t,r){super(e,t,Ld(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Un(this.firestore,null,new Re(e))}withConverter(e){return new zc(this.firestore,e,this._path)}}function ps(n,e,...t){if(n=dn(n),arguments.length===1&&(e=fE.newId()),hP("doc","path",e),n instanceof Xm){const r=Pt.fromString(e,...t);return pT(r),new Un(n,null,new Re(r))}{if(!(n instanceof Un||n instanceof zc))throw new Se(le.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Pt.fromString(e,...t));return pT(r),new Un(n.firestore,n instanceof zc?n.converter:null,new Re(r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _T="AsyncQueue";class vT{constructor(e=Promise.resolve()){this.Vu=[],this.mu=!1,this.fu=[],this.gu=null,this.pu=!1,this.yu=!1,this.wu=[],this.a_=new Um(this,"async_queue_retry"),this.Su=()=>{const r=pp();r&&we(_T,"Visibility state changed to "+r.visibilityState),this.a_.t_()},this.bu=e;const t=pp();t&&typeof t.addEventListener=="function"&&t.addEventListener("visibilitychange",this.Su)}get isShuttingDown(){return this.mu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.Du(),this.vu(e)}enterRestrictedMode(e){if(!this.mu){this.mu=!0,this.yu=e||!1;const t=pp();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Su)}}enqueue(e){if(this.Du(),this.mu)return new Promise(()=>{});const t=new Rr;return this.vu(()=>this.mu&&this.yu?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Vu.push(e),this.Cu()))}async Cu(){if(this.Vu.length!==0){try{await this.Vu[0](),this.Vu.shift(),this.a_.reset()}catch(e){if(!Qo(e))throw e;we(_T,"Operation failed with retryable error: "+e)}this.Vu.length>0&&this.a_.Xo(()=>this.Cu())}}vu(e){const t=this.bu.then(()=>(this.pu=!0,e().catch(r=>{this.gu=r,this.pu=!1;const a=function(u){let f=u.message||"";return u.stack&&(f=u.stack.includes(u.message)?u.stack:u.message+`
`+u.stack),f}(r);throw Dr("INTERNAL UNHANDLED ERROR: ",a),r}).then(r=>(this.pu=!1,r))));return this.bu=t,t}enqueueAfterDelay(e,t,r){this.Du(),this.wu.indexOf(e)>-1&&(t=0);const a=Hm.createAndSchedule(this,e,t,r,l=>this.Fu(l));return this.fu.push(a),a}Du(){this.gu&&Ie()}verifyOperationInProgress(){}async Mu(){let e;do e=this.bu,await e;while(e!==this.bu)}xu(e){for(const t of this.fu)if(t.timerId===e)return!0;return!1}Ou(e){return this.Mu().then(()=>{this.fu.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.fu)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Mu()})}Nu(e){this.wu.push(e)}Fu(e){const t=this.fu.indexOf(e);this.fu.splice(t,1)}}function wT(n){return function(t,r){if(typeof t!="object"||t===null)return!1;const a=t;for(const l of r)if(l in a&&typeof a[l]=="function")return!0;return!1}(n,["next","error","complete"])}class va extends Xm{constructor(e,t,r,a){super(e,t,r,a),this.type="firestore",this._queue=new vT,this._persistenceKey=(a==null?void 0:a.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new vT(e),this._firestoreClient=void 0,await e}}}function gP(n,e){const t=typeof n=="object"?n:vm(),r=typeof n=="string"?n:ad,a=Nd(t,"firestore").getImmediate({identifier:r});if(!a._initialized){const l=Sb("firestore");l&&fP(a,...l)}return a}function $d(n){if(n._terminated)throw new Se(le.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||pP(n),n._firestoreClient}function pP(n){var e,t,r;const a=n._freezeSettings(),l=function(f,g,p,y){return new LR(f,g,p,y.host,y.ssl,y.experimentalForceLongPolling,y.experimentalAutoDetectLongPolling,S1(y.experimentalLongPollingOptions),y.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,a);n._componentsProvider||!((t=a.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=a.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._componentsProvider={_offline:a.localCache._offlineComponentProvider,_online:a.localCache._onlineComponentProvider}),n._firestoreClient=new aP(n._authCredentials,n._appCheckCredentials,n._queue,l,n._componentsProvider&&function(f){const g=f==null?void 0:f._online.build();return{_offline:f==null?void 0:f._offline.build(g),_online:g}}(n._componentsProvider))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wa{constructor(e){this._byteString=e}static fromBase64String(e){try{return new wa(Tn.fromBase64String(e))}catch(t){throw new Se(le.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new wa(Tn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jc{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new Se(le.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wn(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kd{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zm{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Se(le.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Se(le.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return Be(this._lat,e._lat)||Be(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jm{constructor(e){this._values=(e||[]).map(t=>t)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,a){if(r.length!==a.length)return!1;for(let l=0;l<r.length;++l)if(r[l]!==a[l])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mP=/^__.*__$/;class yP{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new Pi(e,this.data,this.fieldMask,t,this.fieldTransforms):new Yc(e,this.data,t,this.fieldTransforms)}}class C1{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Pi(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function A1(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ie()}}class Qd{constructor(e,t,r,a,l,u){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=a,l===void 0&&this.Bu(),this.fieldTransforms=l||[],this.fieldMask=u||[]}get path(){return this.settings.path}get Lu(){return this.settings.Lu}ku(e){return new Qd(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}qu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.ku({path:r,Qu:!1});return a.$u(e),a}Uu(e){var t;const r=(t=this.path)===null||t===void 0?void 0:t.child(e),a=this.ku({path:r,Qu:!1});return a.Bu(),a}Ku(e){return this.ku({path:void 0,Qu:!0})}Wu(e){return yd(e,this.settings.methodName,this.settings.Gu||!1,this.path,this.settings.zu)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Bu(){if(this.path)for(let e=0;e<this.path.length;e++)this.$u(this.path.get(e))}$u(e){if(e.length===0)throw this.Wu("Document fields must not be empty");if(A1(this.Lu)&&mP.test(e))throw this.Wu('Document fields cannot begin and end with "__"')}}class _P{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Fd(e)}ju(e,t,r,a=!1){return new Qd({Lu:e,methodName:t,zu:r,path:wn.emptyPath(),Qu:!1,Gu:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function ey(n){const e=n._freezeSettings(),t=Fd(n._databaseId);return new _P(n._databaseId,!!e.ignoreUndefinedProperties,t)}function I1(n,e,t,r,a,l={}){const u=n.ju(l.merge||l.mergeFields?2:0,e,t,a);ny("Data must be an object, but it was:",u,r);const f=P1(r,u);let g,p;if(l.merge)g=new Jn(u.fieldMask),p=u.fieldTransforms;else if(l.mergeFields){const y=[];for(const v of l.mergeFields){const E=Wp(e,v,t);if(!u.contains(E))throw new Se(le.INVALID_ARGUMENT,`Field '${E}' is specified in your field mask but missing from your input data.`);D1(y,E)||y.push(E)}g=new Jn(y),p=u.fieldTransforms.filter(v=>g.covers(v.field))}else g=null,p=u.fieldTransforms;return new yP(new Vn(f),g,p)}class Yd extends Kd{_toFieldTransform(e){if(e.Lu!==2)throw e.Lu===1?e.Wu(`${this._methodName}() can only appear at the top level of your update data`):e.Wu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Yd}}function vP(n,e,t){return new Qd({Lu:3,zu:e.settings.zu,methodName:n._methodName,Qu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class ty extends Kd{constructor(e,t){super(e),this.Hu=t}_toFieldTransform(e){const t=vP(this,e,!0),r=this.Hu.map(l=>eu(l,t)),a=new zo(r);return new c2(e.path,a)}isEqual(e){return e instanceof ty&&Pr(this.Hu,e.Hu)}}function R1(n,e,t,r){const a=n.ju(1,e,t);ny("Data must be an object, but it was:",a,r);const l=[],u=Vn.empty();Ni(r,(g,p)=>{const y=sy(e,g,t);p=dn(p);const v=a.Uu(y);if(p instanceof Yd)l.push(y);else{const E=eu(p,v);E!=null&&(l.push(y),u.set(y,E))}});const f=new Jn(l);return new C1(u,f,a.fieldTransforms)}function N1(n,e,t,r,a,l){const u=n.ju(1,e,t),f=[Wp(e,r,t)],g=[a];if(l.length%2!=0)throw new Se(le.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let E=0;E<l.length;E+=2)f.push(Wp(e,l[E])),g.push(l[E+1]);const p=[],y=Vn.empty();for(let E=f.length-1;E>=0;--E)if(!D1(p,f[E])){const S=f[E];let D=g[E];D=dn(D);const j=u.Uu(S);if(D instanceof Yd)p.push(S);else{const k=eu(D,j);k!=null&&(p.push(S),y.set(S,k))}}const v=new Jn(p);return new C1(y,v,u.fieldTransforms)}function eu(n,e){if(k1(n=dn(n)))return ny("Unsupported field value:",e,n),P1(n,e);if(n instanceof Kd)return function(r,a){if(!A1(a.Lu))throw a.Wu(`${r._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Wu(`${r._methodName}() is not currently supported inside arrays`);const l=r._toFieldTransform(a);l&&a.fieldTransforms.push(l)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.Qu&&e.Lu!==4)throw e.Wu("Nested arrays are not supported");return function(r,a){const l=[];let u=0;for(const f of r){let g=eu(f,a.Ku(u));g==null&&(g={nullValue:"NULL_VALUE"}),l.push(g),u++}return{arrayValue:{values:l}}}(n,e)}return function(r,a){if((r=dn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return a2(a.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const l=Jt.fromDate(r);return{timestampValue:dd(a.serializer,l)}}if(r instanceof Jt){const l=new Jt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:dd(a.serializer,l)}}if(r instanceof Zm)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof wa)return{bytesValue:KE(a.serializer,r._byteString)};if(r instanceof Un){const l=a.databaseId,u=r.firestore._databaseId;if(!u.isEqual(l))throw a.Wu(`Document reference is for database ${u.projectId}/${u.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:Mm(r.firestore._databaseId||a.databaseId,r._key.path)}}if(r instanceof Jm)return function(u,f){return{mapValue:{fields:{[TE]:{stringValue:bE},[od]:{arrayValue:{values:u.toArray().map(p=>{if(typeof p!="number")throw f.Wu("VectorValues must only contain numeric values.");return Nm(f.serializer,p)})}}}}}}(r,a);throw a.Wu(`Unsupported field value: ${Wm(r)}`)}(n,e)}function P1(n,e){const t={};return pE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ni(n,(r,a)=>{const l=eu(a,e.qu(r));l!=null&&(t[r]=l)}),{mapValue:{fields:t}}}function k1(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Jt||n instanceof Zm||n instanceof wa||n instanceof Un||n instanceof Kd||n instanceof Jm)}function ny(n,e,t){if(!k1(t)||!function(a){return typeof a=="object"&&a!==null&&(Object.getPrototypeOf(a)===Object.prototype||Object.getPrototypeOf(a)===null)}(t)){const r=Wm(t);throw r==="an object"?e.Wu(n+" a custom object"):e.Wu(n+" "+r)}}function Wp(n,e,t){if((e=dn(e))instanceof Jc)return e._internalPath;if(typeof e=="string")return sy(n,e);throw yd("Field path arguments must be of type string or ",n,!1,void 0,t)}const wP=new RegExp("[~\\*/\\[\\]]");function sy(n,e,t){if(e.search(wP)>=0)throw yd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Jc(...e.split("."))._internalPath}catch{throw yd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function yd(n,e,t,r,a){const l=r&&!r.isEmpty(),u=a!==void 0;let f=`Function ${e}() called with invalid data`;t&&(f+=" (via `toFirestore()`)"),f+=". ";let g="";return(l||u)&&(g+=" (found",l&&(g+=` in field ${r}`),u&&(g+=` in document ${a}`),g+=")"),new Se(le.INVALID_ARGUMENT,f+n+g)}function D1(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _d{constructor(e,t,r,a,l){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Un(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new TP(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(M1("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class TP extends _d{data(){return super.data()}}function M1(n,e){return typeof e=="string"?sy(n,e):e instanceof Jc?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bP(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new Se(le.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class O1{convertValue(e,t="none"){switch(xi(e)){case 0:return null;case 1:return e.booleanValue;case 2:return jt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Si(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ie()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const r={};return Ni(e,(a,l)=>{r[a]=this.convertValue(l,t)}),r}convertVectorValue(e){var t,r,a;const l=(a=(r=(t=e.fields)===null||t===void 0?void 0:t[od].arrayValue)===null||r===void 0?void 0:r.values)===null||a===void 0?void 0:a.map(u=>jt(u.doubleValue));return new Jm(l)}convertGeoPoint(e){return new Zm(jt(e.latitude),jt(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Md(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Lc(e));default:return null}}convertTimestamp(e){const t=Ei(e);return new Jt(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Pt.fromString(e);st(e1(r));const a=new Vc(r.get(1),r.get(3)),l=new Re(r.popFirst(5));return a.isEqual(t)||Dr(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function L1(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class EP extends O1{constructor(e){super(),this.firestore=e}convertBytes(e){return new wa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Un(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ao{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ry extends _d{constructor(e,t,r,a,l,u){super(e,t,r,a,u),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new $h(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(M1("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class $h extends ry{data(e={}){return super.data(e)}}class SP{constructor(e,t,r,a){this._firestore=e,this._userDataWriter=t,this._snapshot=a,this.metadata=new Ao(a.hasPendingWrites,a.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new $h(this._firestore,this._userDataWriter,r.key,r,new Ao(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Se(le.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(a,l){if(a._snapshot.oldDocs.isEmpty()){let u=0;return a._snapshot.docChanges.map(f=>{const g=new $h(a._firestore,a._userDataWriter,f.doc.key,f.doc,new Ao(a._snapshot.mutatedKeys.has(f.doc.key),a._snapshot.fromCache),a.query.converter);return f.doc,{type:"added",doc:g,oldIndex:-1,newIndex:u++}})}{let u=a._snapshot.oldDocs;return a._snapshot.docChanges.filter(f=>l||f.type!==3).map(f=>{const g=new $h(a._firestore,a._userDataWriter,f.doc.key,f.doc,new Ao(a._snapshot.mutatedKeys.has(f.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,y=-1;return f.type!==0&&(p=u.indexOf(f.doc.key),u=u.delete(f.doc.key)),f.type!==1&&(u=u.add(f.doc),y=u.indexOf(f.doc.key)),{type:xP(f.type),doc:g,oldIndex:p,newIndex:y}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function xP(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ie()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CP(n){n=As(n,Un);const e=As(n.firestore,va);return uP($d(e),n._key).then(t=>j1(e,n,t))}class iy extends O1{constructor(e){super(),this.firestore=e}convertBytes(e){return new wa(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Un(this.firestore,null,t)}}function AP(n,e,t){n=As(n,Un);const r=As(n.firestore,va),a=L1(n.converter,e,t);return V1(r,[I1(ey(r),"setDoc",n._key,a,n.converter!==null,t).toMutation(n._key,jn.none())])}function Ks(n,e,t,...r){n=As(n,Un);const a=As(n.firestore,va),l=ey(a);let u;return u=typeof(e=dn(e))=="string"||e instanceof Jc?N1(l,"updateDoc",n._key,e,t,r):R1(l,"updateDoc",n._key,e),V1(a,[u.toMutation(n._key,jn.exists(!0))])}function IP(n,...e){var t,r,a;n=dn(n);let l={includeMetadataChanges:!1,source:"default"},u=0;typeof e[u]!="object"||wT(e[u])||(l=e[u],u++);const f={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(wT(e[u])){const v=e[u];e[u]=(t=v.next)===null||t===void 0?void 0:t.bind(v),e[u+1]=(r=v.error)===null||r===void 0?void 0:r.bind(v),e[u+2]=(a=v.complete)===null||a===void 0?void 0:a.bind(v)}let g,p,y;if(n instanceof Un)p=As(n.firestore,va),y=Ld(n._key.path),g={next:v=>{e[u]&&e[u](j1(p,n,v))},error:e[u+1],complete:e[u+2]};else{const v=As(n,Gd);p=As(v.firestore,va),y=v._query;const E=new iy(p);g={next:S=>{e[u]&&e[u](new SP(p,E,v,S))},error:e[u+1],complete:e[u+2]},bP(n._query)}return function(E,S,D,j){const k=new E1(j),P=new g1(S,k,D);return E.asyncQueue.enqueueAndForget(async()=>d1(await Yp(E),P)),()=>{k.su(),E.asyncQueue.enqueueAndForget(async()=>f1(await Yp(E),P))}}($d(p),y,f,g)}function V1(n,e){return function(r,a){const l=new Rr;return r.asyncQueue.enqueueAndForget(async()=>YN(await lP(r),a,l)),l.promise}($d(n),e)}function j1(n,e,t){const r=t.docs.get(e._key),a=new iy(n);return new ry(n,a,e._key,r,new Ao(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RP={maxAttempts:5};function _c(n,e){if((n=dn(n)).firestore!==e)throw new Se(le.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NP{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=ey(e)}get(e){const t=_c(e,this._firestore),r=new EP(this._firestore);return this._transaction.lookup([t._key]).then(a=>{if(!a||a.length!==1)return Ie();const l=a[0];if(l.isFoundDocument())return new _d(this._firestore,r,l.key,l,t.converter);if(l.isNoDocument())return new _d(this._firestore,r,t._key,null,t.converter);throw Ie()})}set(e,t,r){const a=_c(e,this._firestore),l=L1(a.converter,t,r),u=I1(this._dataReader,"Transaction.set",a._key,l,a.converter!==null,r);return this._transaction.set(a._key,u),this}update(e,t,r,...a){const l=_c(e,this._firestore);let u;return u=typeof(t=dn(t))=="string"||t instanceof Jc?N1(this._dataReader,"Transaction.update",l._key,t,r,a):R1(this._dataReader,"Transaction.update",l._key,t),this._transaction.update(l._key,u),this}delete(e){const t=_c(e,this._firestore);return this._transaction.delete(t._key),this}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP extends NP{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=_c(e,this._firestore),r=new iy(this._firestore);return super.get(e).then(a=>new ry(this._firestore,r,t._key,a._document,new Ao(!1,!1),t.converter))}}function TT(n,e,t){n=As(n,va);const r=Object.assign(Object.assign({},RP),t);return function(l){if(l.maxAttempts<1)throw new Se(le.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(l,u,f){const g=new Rr;return l.asyncQueue.enqueueAndForget(async()=>{const p=await cP(l);new iP(l.asyncQueue,p,f,u,g).Iu()}),g.promise}($d(n),a=>e(new PP(n,a)),r)}function fi(...n){return new ty("arrayUnion",n)}(function(e,t=!0){(function(a){$o=a})(Gc),ma(new Ti("firestore",(r,{instanceIdentifier:a,options:l})=>{const u=r.getProvider("app").getImmediate(),f=new va(new vR(r.getProvider("auth-internal")),new bR(u,r.getProvider("app-check-internal")),function(p,y){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new Se(le.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Vc(p.options.projectId,y)}(u,a),u);return l=Object.assign({useFetchStreams:t},l),f._setSettings(l),f},"PUBLIC").setMultipleInstances(!0)),Ys(Cw,Aw,e),Ys(Cw,Aw,"esm2017")})();var bT={};const ET="@firebase/database",ST="1.0.14";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let U1="";function kP(n){U1=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DP{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),vn(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:kc(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return Lr(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z1=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new DP(e)}}catch{}return new MP},pa=z1("localStorage"),OP=z1("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Do=new Rd("@firebase/database"),LP=function(){let n=1;return function(){return n++}}(),B1=function(n){const e=dA(n),t=new oA;t.update(e);const r=t.digest();return fm.encodeByteArray(r)},tu=function(...n){let e="";for(let t=0;t<n.length;t++){const r=n[t];Array.isArray(r)||r&&typeof r=="object"&&typeof r.length=="number"?e+=tu.apply(null,r):typeof r=="object"?e+=vn(r):e+=r,e+=" "}return e};let Ic=null,xT=!0;const VP=function(n,e){_e(!0,"Can't turn on custom loggers persistently."),Do.logLevel=Ge.VERBOSE,Ic=Do.log.bind(Do)},Cn=function(...n){if(xT===!0&&(xT=!1,Ic===null&&OP.get("logging_enabled")===!0&&VP()),Ic){const e=tu.apply(null,n);Ic(e)}},nu=function(n){return function(...e){Cn(n,...e)}},Xp=function(...n){const e="FIREBASE INTERNAL ERROR: "+tu(...n);Do.error(e)},Or=function(...n){const e=`FIREBASE FATAL ERROR: ${tu(...n)}`;throw Do.error(e),new Error(e)},ts=function(...n){const e="FIREBASE WARNING: "+tu(...n);Do.warn(e)},jP=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&ts("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},F1=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},UP=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},qo="[MIN_NAME]",Ta="[MAX_NAME]",Wo=function(n,e){if(n===e)return 0;if(n===qo||e===Ta)return-1;if(e===qo||n===Ta)return 1;{const t=CT(n),r=CT(e);return t!==null?r!==null?t-r===0?n.length-e.length:t-r:-1:r!==null?1:n<e?-1:1}},zP=function(n,e){return n===e?0:n<e?-1:1},hc=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+vn(e))},ay=function(n){if(typeof n!="object"||n===null)return vn(n);const e=[];for(const r in n)e.push(r);e.sort();let t="{";for(let r=0;r<e.length;r++)r!==0&&(t+=","),t+=vn(e[r]),t+=":",t+=ay(n[e[r]]);return t+="}",t},q1=function(n,e){const t=n.length;if(t<=e)return[n];const r=[];for(let a=0;a<t;a+=e)a+e>t?r.push(n.substring(a,t)):r.push(n.substring(a,a+e));return r};function ys(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const H1=function(n){_e(!F1(n),"Invalid JSON number");const e=11,t=52,r=(1<<e-1)-1;let a,l,u,f,g;n===0?(l=0,u=0,a=1/n===-1/0?1:0):(a=n<0,n=Math.abs(n),n>=Math.pow(2,1-r)?(f=Math.min(Math.floor(Math.log(n)/Math.LN2),r),l=f+r,u=Math.round(n*Math.pow(2,t-f)-Math.pow(2,t))):(l=0,u=Math.round(n/Math.pow(2,1-r-t))));const p=[];for(g=t;g;g-=1)p.push(u%2?1:0),u=Math.floor(u/2);for(g=e;g;g-=1)p.push(l%2?1:0),l=Math.floor(l/2);p.push(a?1:0),p.reverse();const y=p.join("");let v="";for(g=0;g<64;g+=8){let E=parseInt(y.substr(g,8),2).toString(16);E.length===1&&(E="0"+E),v=v+E}return v.toLowerCase()},BP=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},FP=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"},qP=new RegExp("^-?(0*)\\d{1,10}$"),HP=-2147483648,GP=2147483647,CT=function(n){if(qP.test(n)){const e=Number(n);if(e>=HP&&e<=GP)return e}return null},su=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw ts("Exception was thrown by user callback.",t),e},Math.floor(0))}},$P=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Rc=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,Ar(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(r=>this.appCheck=r)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,r)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(r=>r.addTokenListener(e))}notifyForInvalidToken(){ts(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e,t,r){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=r,this.auth_=null,this.auth_=r.getImmediate({optional:!0}),this.auth_||r.onInit(a=>this.auth_=a)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(Cn("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,r)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,r):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ts(e)}}class Kh{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Kh.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oy="5",G1="v",$1="s",K1="r",Q1="f",Y1=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,W1="ls",X1="p",Zp="ac",Z1="websocket",J1="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class eS{constructor(e,t,r,a,l=!1,u="",f=!1,g=!1,p=null){this.secure=t,this.namespace=r,this.webSocketOnly=a,this.nodeAdmin=l,this.persistenceKey=u,this.includeNamespaceInQueryParams=f,this.isUsingEmulator=g,this.emulatorOptions=p,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=pa.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&pa.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function YP(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function tS(n,e,t){_e(typeof e=="string","typeof type must == string"),_e(typeof t=="object","typeof params must == object");let r;if(e===Z1)r=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===J1)r=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);YP(n)&&(t.ns=n.namespace);const a=[];return ys(t,(l,u)=>{a.push(l+"="+u)}),r+a.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WP{constructor(){this.counters_={}}incrementCounter(e,t=1){Lr(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return qC(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yp={},_p={};function ly(n){const e=n.toString();return yp[e]||(yp[e]=new WP),yp[e]}function XP(n,e){const t=n.toString();return _p[t]||(_p[t]=e()),_p[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ZP{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const r=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let a=0;a<r.length;++a)r[a]&&su(()=>{this.onMessage_(r[a])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AT="start",JP="close",ek="pLPCommand",tk="pRTLPCB",nS="id",sS="pw",rS="ser",nk="cb",sk="seg",rk="ts",ik="d",ak="dframe",iS=1870,aS=30,ok=iS-aS,lk=25e3,ck=3e4;class Io{constructor(e,t,r,a,l,u,f){this.connId=e,this.repoInfo=t,this.applicationId=r,this.appCheckToken=a,this.authToken=l,this.transportSessionId=u,this.lastSessionId=f,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nu(e),this.stats_=ly(t),this.urlFn=g=>(this.appCheckToken&&(g[Zp]=this.appCheckToken),tS(t,J1,g))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new ZP(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ck)),UP(()=>{if(this.isClosed_)return;this.scriptTagHolder=new cy((...l)=>{const[u,f,g,p,y]=l;if(this.incrementIncomingBytes_(l),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,u===AT)this.id=f,this.password=g;else if(u===JP)f?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(f,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+u)},(...l)=>{const[u,f]=l;this.incrementIncomingBytes_(l),this.myPacketOrderer.handleResponse(u,f)},()=>{this.onClosed_()},this.urlFn);const r={};r[AT]="t",r[rS]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(r[nk]=this.scriptTagHolder.uniqueCallbackIdentifier),r[G1]=oy,this.transportSessionId&&(r[$1]=this.transportSessionId),this.lastSessionId&&(r[W1]=this.lastSessionId),this.applicationId&&(r[X1]=this.applicationId),this.appCheckToken&&(r[Zp]=this.appCheckToken),typeof location<"u"&&location.hostname&&Y1.test(location.hostname)&&(r[K1]=Q1);const a=this.urlFn(r);this.log_("Connecting via long-poll to "+a),this.scriptTagHolder.addTag(a,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Io.forceAllow_=!0}static forceDisallow(){Io.forceDisallow_=!0}static isAvailable(){return Io.forceAllow_?!0:!Io.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!BP()&&!FP()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=vn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=Tb(t),a=q1(r,ok);for(let l=0;l<a.length;l++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,a.length,a[l]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const r={};r[ak]="t",r[nS]=e,r[sS]=t,this.myDisconnFrame.src=this.urlFn(r),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=vn(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class cy{constructor(e,t,r,a){this.onDisconnect=r,this.urlFn=a,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=LP(),window[ek+this.uniqueCallbackIdentifier]=e,window[tk+this.uniqueCallbackIdentifier]=t,this.myIFrame=cy.createIFrame_();let l="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(l='<script>document.domain="'+document.domain+'";<\/script>');const u="<html><body>"+l+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(u),this.myIFrame.doc.close()}catch(f){Cn("frame writing exception"),f.stack&&Cn(f.stack),Cn(f)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||Cn("No IE domain setting required")}catch{const r=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+r+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[nS]=this.myID,e[sS]=this.myPW,e[rS]=this.currentSerial;let t=this.urlFn(e),r="",a=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+aS+r.length<=iS;){const u=this.pendingSegs.shift();r=r+"&"+sk+a+"="+u.seg+"&"+rk+a+"="+u.ts+"&"+ik+a+"="+u.d,a++}return t=t+r,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,r){this.pendingSegs.push({seg:e,ts:t,d:r}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const r=()=>{this.outstandingRequests.delete(t),this.newRequest_()},a=setTimeout(r,Math.floor(lk)),l=()=>{clearTimeout(a),r()};this.addTag(e,l)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const r=this.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){const a=r.readyState;(!a||a==="loaded"||a==="complete")&&(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=()=>{Cn("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(r)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const uk=16384,hk=45e3;let vd=null;typeof MozWebSocket<"u"?vd=MozWebSocket:typeof WebSocket<"u"&&(vd=WebSocket);class Ss{constructor(e,t,r,a,l,u,f){this.connId=e,this.applicationId=r,this.appCheckToken=a,this.authToken=l,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nu(this.connId),this.stats_=ly(t),this.connURL=Ss.connectionURL_(t,u,f,a,r),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,r,a,l){const u={};return u[G1]=oy,typeof location<"u"&&location.hostname&&Y1.test(location.hostname)&&(u[K1]=Q1),t&&(u[$1]=t),r&&(u[W1]=r),a&&(u[Zp]=a),l&&(u[X1]=l),tS(e,Z1,u)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,pa.set("previous_websocket_failure",!0);try{let r;ZC(),this.mySock=new vd(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");const a=r.message||r.data;a&&this.log_(a),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");const a=r.message||r.data;a&&this.log_(a),this.onClosed_()}}start(){}static forceDisallow(){Ss.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(t);r&&r.length>1&&parseFloat(r[1])<4.4&&(e=!0)}return!e&&vd!==null&&!Ss.forceDisallow_}static previouslyFailed(){return pa.isInMemoryStorage||pa.get("previous_websocket_failure")===!0}markConnectionHealthy(){pa.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const r=kc(t);this.onMessage(r)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(_e(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const r=this.extractFrameCount_(t);r!==null&&this.appendFrame_(r)}}send(e){this.resetKeepAlive();const t=vn(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const r=q1(t,uk);r.length>1&&this.sendString_(String(r.length));for(let a=0;a<r.length;a++)this.sendString_(r[a])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(hk))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ss.responsesRequiredToBeHealthy=2;Ss.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bc{static get ALL_TRANSPORTS(){return[Io,Ss]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){const t=Ss&&Ss.isAvailable();let r=t&&!Ss.previouslyFailed();if(e.webSocketOnly&&(t||ts("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[Ss];else{const a=this.transports_=[];for(const l of Bc.ALL_TRANSPORTS)l&&l.isAvailable()&&a.push(l);Bc.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Bc.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dk=6e4,fk=5e3,gk=10*1024,pk=100*1024,vp="t",IT="d",mk="s",RT="r",yk="e",NT="o",PT="a",kT="n",DT="p",_k="h";class vk{constructor(e,t,r,a,l,u,f,g,p,y){this.id=e,this.repoInfo_=t,this.applicationId_=r,this.appCheckToken_=a,this.authToken_=l,this.onMessage_=u,this.onReady_=f,this.onDisconnect_=g,this.onKill_=p,this.lastSessionId=y,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nu("c:"+this.id+":"),this.transportManager_=new Bc(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,r)},Math.floor(0));const a=e.healthyTimeout||0;a>0&&(this.healthyTimeout_=Rc(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>pk?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>gk?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(a)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(vp in e){const t=e[vp];t===PT?this.upgradeIfSecondaryHealthy_():t===RT?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===NT&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=hc("t",e),r=hc("d",e);if(t==="c")this.onSecondaryControl_(r);else if(t==="d")this.pendingDataMessages.push(r);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:DT,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:PT,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:kT,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=hc("t",e),r=hc("d",e);t==="c"?this.onControl_(r):t==="d"&&this.onDataMessage_(r)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=hc(vp,e);if(IT in e){const r=e[IT];if(t===_k){const a=Object.assign({},r);this.repoInfo_.isUsingEmulator&&(a.h=this.repoInfo_.host),this.onHandshake_(a)}else if(t===kT){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let a=0;a<this.pendingDataMessages.length;++a)this.onDataMessage_(this.pendingDataMessages[a]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===mk?this.onConnectionShutdown_(r):t===RT?this.onReset_(r):t===yk?Xp("Server Error: "+r):t===NT?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Xp("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,r=e.v,a=e.h;this.sessionId=e.s,this.repoInfo_.host=a,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),oy!==r&&ts("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,r),Rc(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(dk))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Rc(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(fk))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:DT,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(pa.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oS{put(e,t,r,a){}merge(e,t,r,a){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,r){}onDisconnectMerge(e,t,r){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lS{constructor(e){this.allowedEvents_=e,this.listeners_={},_e(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const r=[...this.listeners_[e]];for(let a=0;a<r.length;a++)r[a].callback.apply(r[a].context,t)}}on(e,t,r){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:r});const a=this.getInitialEvent(e);a&&t.apply(r,a)}off(e,t,r){this.validateEventType_(e);const a=this.listeners_[e]||[];for(let l=0;l<a.length;l++)if(a[l].callback===t&&(!r||r===a[l].context)){a.splice(l,1);return}}validateEventType_(e){_e(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wd extends lS{static getInstance(){return new wd}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!mm()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return _e(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const MT=32,OT=768;class It{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let r=0;for(let a=0;a<this.pieces_.length;a++)this.pieces_[a].length>0&&(this.pieces_[r]=this.pieces_[a],r++);this.pieces_.length=r,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function wt(){return new It("")}function tt(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function Ii(n){return n.pieces_.length-n.pieceNum_}function At(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new It(n.pieces_,e)}function cS(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function wk(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function uS(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function hS(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new It(e,0)}function hn(n,e){const t=[];for(let r=n.pieceNum_;r<n.pieces_.length;r++)t.push(n.pieces_[r]);if(e instanceof It)for(let r=e.pieceNum_;r<e.pieces_.length;r++)t.push(e.pieces_[r]);else{const r=e.split("/");for(let a=0;a<r.length;a++)r[a].length>0&&t.push(r[a])}return new It(t,0)}function Ye(n){return n.pieceNum_>=n.pieces_.length}function ms(n,e){const t=tt(n),r=tt(e);if(t===null)return e;if(t===r)return ms(At(n),At(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function dS(n,e){if(Ii(n)!==Ii(e))return!1;for(let t=n.pieceNum_,r=e.pieceNum_;t<=n.pieces_.length;t++,r++)if(n.pieces_[t]!==e.pieces_[r])return!1;return!0}function Cs(n,e){let t=n.pieceNum_,r=e.pieceNum_;if(Ii(n)>Ii(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[r])return!1;++t,++r}return!0}class Tk{constructor(e,t){this.errorPrefix_=t,this.parts_=uS(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let r=0;r<this.parts_.length;r++)this.byteLength_+=Id(this.parts_[r]);fS(this)}}function bk(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Id(e),fS(n)}function Ek(n){const e=n.parts_.pop();n.byteLength_-=Id(e),n.parts_.length>0&&(n.byteLength_-=1)}function fS(n){if(n.byteLength_>OT)throw new Error(n.errorPrefix_+"has a key path longer than "+OT+" bytes ("+n.byteLength_+").");if(n.parts_.length>MT)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+MT+") or object contains a cycle "+da(n))}function da(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uy extends lS{static getInstance(){return new uy}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const r=!document[e];r!==this.visible_&&(this.visible_=r,this.trigger("visible",r))},!1)}getInitialEvent(e){return _e(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dc=1e3,Sk=60*5*1e3,LT=30*1e3,xk=1.3,Ck=3e4,Ak="server_kill",VT=3;class Nr extends oS{constructor(e,t,r,a,l,u,f,g){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=r,this.onConnectStatus_=a,this.onServerInfoUpdate_=l,this.authTokenProvider_=u,this.appCheckTokenProvider_=f,this.authOverride_=g,this.id=Nr.nextPersistentConnectionId_++,this.log_=nu("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=dc,this.maxReconnectDelay_=Sk,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,g)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");uy.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&wd.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const a=++this.requestNumber_,l={r:a,a:e,b:t};this.log_(vn(l)),_e(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(l),r&&(this.requestCBHash_[a]=r)}get(e){this.initConnection_();const t=new pm,a={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:u=>{const f=u.d;u.s==="ok"?t.resolve(f):t.reject(f)}};this.outstandingGets_.push(a),this.outstandingGetCount_++;const l=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(l),t.promise}listen(e,t,r,a){this.initConnection_();const l=e._queryIdentifier,u=e._path.toString();this.log_("Listen called for "+u+" "+l),this.listens.has(u)||this.listens.set(u,new Map),_e(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),_e(!this.listens.get(u).has(l),"listen() called twice for same path/queryId.");const f={onComplete:a,hashFn:t,query:e,tag:r};this.listens.get(u).set(l,f),this.connected_&&this.sendListen_(f)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,r=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(r)})}sendListen_(e){const t=e.query,r=t._path.toString(),a=t._queryIdentifier;this.log_("Listen on "+r+" for "+a);const l={p:r},u="q";e.tag&&(l.q=t._queryObject,l.t=e.tag),l.h=e.hashFn(),this.sendRequest(u,l,f=>{const g=f.d,p=f.s;Nr.warnOnListenWarnings_(g,t),(this.listens.get(r)&&this.listens.get(r).get(a))===e&&(this.log_("listen response",f),p!=="ok"&&this.removeListen_(r,a),e.onComplete&&e.onComplete(p,g))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&Lr(e,"w")){const r=Oo(e,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){const a='".indexOn": "'+t._queryParams.getIndex().toString()+'"',l=t._path.toString();ts(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${a} at ${l} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||aA(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=LT)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=iA(e)?"auth":"gauth",r={cred:e};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(t,r,a=>{const l=a.s,u=a.d||"error";this.authToken_===e&&(l==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(l,u))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,r=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,r)})}unlisten(e,t){const r=e._path.toString(),a=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+a),_e(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,a)&&this.connected_&&this.sendUnlisten_(r,a,e._queryObject,t)}sendUnlisten_(e,t,r,a){this.log_("Unlisten on "+e+" for "+t);const l={p:e},u="n";a&&(l.q=r,l.t=a),this.sendRequest(u,l)}onDisconnectPut(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:r})}onDisconnectMerge(e,t,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,r):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:r})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,r,a){const l={p:t,d:r};this.log_("onDisconnect "+e,l),this.sendRequest(e,l,u=>{a&&setTimeout(()=>{a(u.s,u.d)},Math.floor(0))})}put(e,t,r,a){this.putInternal("p",e,t,r,a)}merge(e,t,r,a){this.putInternal("m",e,t,r,a)}putInternal(e,t,r,a,l){this.initConnection_();const u={p:t,d:r};l!==void 0&&(u.h=l),this.outstandingPuts_.push({action:e,request:u,onComplete:a}),this.outstandingPutCount_++;const f=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(f):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,a=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,r,l=>{this.log_(t+" response",l),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),a&&a(l.s,l.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,r=>{if(r.s!=="ok"){const l=r.d;this.log_("reportStats","Error sending stats: "+l)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+vn(e));const t=e.r,r=this.requestCBHash_[t];r&&(delete this.requestCBHash_[t],r(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Xp("Unrecognized action received from server: "+vn(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){_e(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=dc,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=dc,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Ck&&(this.reconnectDelay_=dc),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_);let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*xk)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),a=this.id+":"+Nr.nextConnectionId_++,l=this.lastSessionId;let u=!1,f=null;const g=function(){f?f.close():(u=!0,r())},p=function(v){_e(f,"sendRequest call when we're not connected not allowed."),f.sendRequest(v)};this.realtime_={close:g,sendRequest:p};const y=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[v,E]=await Promise.all([this.authTokenProvider_.getToken(y),this.appCheckTokenProvider_.getToken(y)]);u?Cn("getToken() completed but was canceled"):(Cn("getToken() completed. Creating connection."),this.authToken_=v&&v.accessToken,this.appCheckToken_=E&&E.token,f=new vk(a,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,S=>{ts(S+" ("+this.repoInfo_.toString()+")"),this.interrupt(Ak)},l))}catch(v){this.log_("Failed to get token: "+v),u||(this.repoInfo_.nodeAdmin&&ts(v),g())}}}interrupt(e){Cn("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Cn("Resuming connection for reason: "+e),delete this.interruptReasons_[e],ew(this.interruptReasons_)&&(this.reconnectDelay_=dc,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let r;t?r=t.map(l=>ay(l)).join("$"):r="default";const a=this.removeListen_(e,r);a&&a.onComplete&&a.onComplete("permission_denied")}removeListen_(e,t){const r=new It(e).toString();let a;if(this.listens.has(r)){const l=this.listens.get(r);a=l.get(t),l.delete(t),l.size===0&&this.listens.delete(r)}else a=void 0;return a}onAuthRevoked_(e,t){Cn("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=VT&&(this.reconnectDelay_=LT,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Cn("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=VT&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+U1.replace(/\./g,"-")]=1,mm()?e["framework.cordova"]=1:Ab()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=wd.getInstance().currentlyOnline();return ew(this.interruptReasons_)&&e}}Nr.nextPersistentConnectionId_=0;Nr.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nt(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wd{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const r=new nt(qo,e),a=new nt(qo,t);return this.compare(r,a)!==0}minPost(){return nt.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Oh;class gS extends Wd{static get __EMPTY_NODE(){return Oh}static set __EMPTY_NODE(e){Oh=e}compare(e,t){return Wo(e.name,t.name)}isDefinedOn(e){throw Go("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nt.MIN}maxPost(){return new nt(Ta,Oh)}makePost(e,t){return _e(typeof e=="string","KeyIndex indexValue must always be a string."),new nt(e,Oh)}toString(){return".key"}}const Mo=new gS;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lh{constructor(e,t,r,a,l=null){this.isReverse_=a,this.resultGenerator_=l,this.nodeStack_=[];let u=1;for(;!e.isEmpty();)if(e=e,u=t?r(e.key,t):1,a&&(u*=-1),u<0)this.isReverse_?e=e.left:e=e.right;else if(u===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class cn{constructor(e,t,r,a,l){this.key=e,this.value=t,this.color=r??cn.RED,this.left=a??Hn.EMPTY_NODE,this.right=l??Hn.EMPTY_NODE}copy(e,t,r,a,l){return new cn(e??this.key,t??this.value,r??this.color,a??this.left,l??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let a=this;const l=r(e,a.key);return l<0?a=a.copy(null,null,null,a.left.insert(e,t,r),null):l===0?a=a.copy(null,t,null,null,null):a=a.copy(null,null,null,null,a.right.insert(e,t,r)),a.fixUp_()}removeMin_(){if(this.left.isEmpty())return Hn.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let r,a;if(r=this,t(e,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),t(e,r.key)===0){if(r.right.isEmpty())return Hn.EMPTY_NODE;a=r.right.min_(),r=r.copy(a.key,a.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}cn.RED=!0;cn.BLACK=!1;class Ik{copy(e,t,r,a,l){return this}insert(e,t,r){return new cn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class Hn{constructor(e,t=Hn.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Hn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,cn.BLACK,null,null))}remove(e){return new Hn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,cn.BLACK,null,null))}get(e){let t,r=this.root_;for(;!r.isEmpty();){if(t=this.comparator_(e,r.key),t===0)return r.value;t<0?r=r.left:t>0&&(r=r.right)}return null}getPredecessorKey(e){let t,r=this.root_,a=null;for(;!r.isEmpty();)if(t=this.comparator_(e,r.key),t===0){if(r.left.isEmpty())return a?a.key:null;for(r=r.left;!r.right.isEmpty();)r=r.right;return r.key}else t<0?r=r.left:t>0&&(a=r,r=r.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Lh(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Lh(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Lh(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Lh(this.root_,null,this.comparator_,!0,e)}}Hn.EMPTY_NODE=new Ik;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(n,e){return Wo(n.name,e.name)}function hy(n,e){return Wo(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Jp;function Nk(n){Jp=n}const pS=function(n){return typeof n=="number"?"number:"+H1(n):"string:"+n},mS=function(n){if(n.isLeafNode()){const e=n.val();_e(typeof e=="string"||typeof e=="number"||typeof e=="object"&&Lr(e,".sv"),"Priority must be a string or number.")}else _e(n===Jp||n.isEmpty(),"priority of unexpected type.");_e(n===Jp||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let jT;class on{static set __childrenNodeConstructor(e){jT=e}static get __childrenNodeConstructor(){return jT}constructor(e,t=on.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,_e(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),mS(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new on(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:on.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Ye(e)?this:tt(e)===".priority"?this.priorityNode_:on.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:on.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=tt(e);return r===null?t:t.isEmpty()&&r!==".priority"?this:(_e(r!==".priority"||Ii(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,on.__childrenNodeConstructor.EMPTY_NODE.updateChild(At(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+pS(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=H1(this.value_):e+=this.value_,this.lazyHash_=B1(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===on.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof on.__childrenNodeConstructor?-1:(_e(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,a=on.VALUE_TYPE_ORDER.indexOf(t),l=on.VALUE_TYPE_ORDER.indexOf(r);return _e(a>=0,"Unknown leaf type: "+t),_e(l>=0,"Unknown leaf type: "+r),a===l?r==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:l-a}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}on.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let yS,_S;function Pk(n){yS=n}function kk(n){_S=n}class Dk extends Wd{compare(e,t){const r=e.node.getPriority(),a=t.node.getPriority(),l=r.compareTo(a);return l===0?Wo(e.name,t.name):l}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nt.MIN}maxPost(){return new nt(Ta,new on("[PRIORITY-POST]",_S))}makePost(e,t){const r=yS(e);return new nt(t,new on("[PRIORITY-POST]",r))}toString(){return".priority"}}const In=new Dk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk=Math.log(2);class Ok{constructor(e){const t=l=>parseInt(Math.log(l)/Mk,10),r=l=>parseInt(Array(l+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const a=r(this.count);this.bits_=e+1&a}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Td=function(n,e,t,r){n.sort(e);const a=function(g,p){const y=p-g;let v,E;if(y===0)return null;if(y===1)return v=n[g],E=t?t(v):v,new cn(E,v.node,cn.BLACK,null,null);{const S=parseInt(y/2,10)+g,D=a(g,S),j=a(S+1,p);return v=n[S],E=t?t(v):v,new cn(E,v.node,cn.BLACK,D,j)}},l=function(g){let p=null,y=null,v=n.length;const E=function(D,j){const k=v-D,P=v;v-=D;const z=a(k+1,P),U=n[k],W=t?t(U):U;S(new cn(W,U.node,j,null,z))},S=function(D){p?(p.left=D,p=D):(y=D,p=D)};for(let D=0;D<g.count;++D){const j=g.nextBitIsOne(),k=Math.pow(2,g.count-(D+1));j?E(k,cn.BLACK):(E(k,cn.BLACK),E(k,cn.RED))}return y},u=new Ok(n.length),f=l(u);return new Hn(r||e,f)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let wp;const bo={};class Ir{static get Default(){return _e(bo&&In,"ChildrenNode.ts has not been loaded"),wp=wp||new Ir({".priority":bo},{".priority":In}),wp}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Oo(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Hn?t:null}hasIndex(e){return Lr(this.indexSet_,e.toString())}addIndex(e,t){_e(e!==Mo,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let a=!1;const l=t.getIterator(nt.Wrap);let u=l.getNext();for(;u;)a=a||e.isDefinedOn(u.node),r.push(u),u=l.getNext();let f;a?f=Td(r,e.getCompare()):f=bo;const g=e.toString(),p=Object.assign({},this.indexSet_);p[g]=e;const y=Object.assign({},this.indexes_);return y[g]=f,new Ir(y,p)}addToIndexes(e,t){const r=Xh(this.indexes_,(a,l)=>{const u=Oo(this.indexSet_,l);if(_e(u,"Missing index implementation for "+l),a===bo)if(u.isDefinedOn(e.node)){const f=[],g=t.getIterator(nt.Wrap);let p=g.getNext();for(;p;)p.name!==e.name&&f.push(p),p=g.getNext();return f.push(e),Td(f,u.getCompare())}else return bo;else{const f=t.get(e.name);let g=a;return f&&(g=g.remove(new nt(e.name,f))),g.insert(e,e.node)}});return new Ir(r,this.indexSet_)}removeFromIndexes(e,t){const r=Xh(this.indexes_,a=>{if(a===bo)return a;{const l=t.get(e.name);return l?a.remove(new nt(e.name,l)):a}});return new Ir(r,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let fc;class ht{static get EMPTY_NODE(){return fc||(fc=new ht(new Hn(hy),null,Ir.Default))}constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&mS(this.priorityNode_),this.children_.isEmpty()&&_e(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||fc}updatePriority(e){return this.children_.isEmpty()?this:new ht(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?fc:t}}getChild(e){const t=tt(e);return t===null?this:this.getImmediateChild(t).getChild(At(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(_e(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const r=new nt(e,t);let a,l;t.isEmpty()?(a=this.children_.remove(e),l=this.indexMap_.removeFromIndexes(r,this.children_)):(a=this.children_.insert(e,t),l=this.indexMap_.addToIndexes(r,this.children_));const u=a.isEmpty()?fc:this.priorityNode_;return new ht(a,u,l)}}updateChild(e,t){const r=tt(e);if(r===null)return t;{_e(tt(e)!==".priority"||Ii(e)===1,".priority must be the last token in a path");const a=this.getImmediateChild(r).updateChild(At(e),t);return this.updateImmediateChild(r,a)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let r=0,a=0,l=!0;if(this.forEachChild(In,(u,f)=>{t[u]=f.val(e),r++,l&&ht.INTEGER_REGEXP_.test(u)?a=Math.max(a,Number(u)):l=!1}),!e&&l&&a<2*r){const u=[];for(const f in t)u[f]=t[f];return u}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+pS(this.getPriority().val())+":"),this.forEachChild(In,(t,r)=>{const a=r.hash();a!==""&&(e+=":"+t+":"+a)}),this.lazyHash_=e===""?"":B1(e)}return this.lazyHash_}getPredecessorChildName(e,t,r){const a=this.resolveIndex_(r);if(a){const l=a.getPredecessorKey(new nt(e,t));return l?l.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new nt(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const r=t.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new nt(t,this.children_.get(t)):null}forEachChild(e,t){const r=this.resolveIndex_(e);return r?r.inorderTraversal(a=>t(a.name,a.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getIteratorFrom(e,a=>a);{const a=this.children_.getIteratorFrom(e.name,nt.Wrap);let l=a.peek();for(;l!=null&&t.compare(l,e)<0;)a.getNext(),l=a.peek();return a}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const r=this.resolveIndex_(t);if(r)return r.getReverseIteratorFrom(e,a=>a);{const a=this.children_.getReverseIteratorFrom(e.name,nt.Wrap);let l=a.peek();for(;l!=null&&t.compare(l,e)>0;)a.getNext(),l=a.peek();return a}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ru?-1:0}withIndex(e){if(e===Mo||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ht(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Mo||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const r=this.getIterator(In),a=t.getIterator(In);let l=r.getNext(),u=a.getNext();for(;l&&u;){if(l.name!==u.name||!l.node.equals(u.node))return!1;l=r.getNext(),u=a.getNext()}return l===null&&u===null}else return!1;else return!1}}resolveIndex_(e){return e===Mo?null:this.indexMap_.get(e.toString())}}ht.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Lk extends ht{constructor(){super(new Hn(hy),ht.EMPTY_NODE,Ir.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ht.EMPTY_NODE}isEmpty(){return!1}}const ru=new Lk;Object.defineProperties(nt,{MIN:{value:new nt(qo,ht.EMPTY_NODE)},MAX:{value:new nt(Ta,ru)}});gS.__EMPTY_NODE=ht.EMPTY_NODE;on.__childrenNodeConstructor=ht;Nk(ru);kk(ru);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vk=!0;function An(n,e=null){if(n===null)return ht.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),_e(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new on(t,An(e))}if(!(n instanceof Array)&&Vk){const t=[];let r=!1;if(ys(n,(u,f)=>{if(u.substring(0,1)!=="."){const g=An(f);g.isEmpty()||(r=r||!g.getPriority().isEmpty(),t.push(new nt(u,g)))}}),t.length===0)return ht.EMPTY_NODE;const l=Td(t,Rk,u=>u.name,hy);if(r){const u=Td(t,In.getCompare());return new ht(l,An(e),new Ir({".priority":u},{".priority":In}))}else return new ht(l,An(e),Ir.Default)}else{let t=ht.EMPTY_NODE;return ys(n,(r,a)=>{if(Lr(n,r)&&r.substring(0,1)!=="."){const l=An(a);(l.isLeafNode()||!l.isEmpty())&&(t=t.updateImmediateChild(r,l))}}),t.updatePriority(An(e))}}Pk(An);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jk extends Wd{constructor(e){super(),this.indexPath_=e,_e(!Ye(e)&&tt(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const r=this.extractChild(e.node),a=this.extractChild(t.node),l=r.compareTo(a);return l===0?Wo(e.name,t.name):l}makePost(e,t){const r=An(e),a=ht.EMPTY_NODE.updateChild(this.indexPath_,r);return new nt(t,a)}maxPost(){const e=ht.EMPTY_NODE.updateChild(this.indexPath_,ru);return new nt(Ta,e)}toString(){return uS(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uk extends Wd{compare(e,t){const r=e.node.compareTo(t.node);return r===0?Wo(e.name,t.name):r}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nt.MIN}maxPost(){return nt.MAX}makePost(e,t){const r=An(e);return new nt(t,r)}toString(){return".value"}}const zk=new Uk;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bk(n){return{type:"value",snapshotNode:n}}function Fk(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function qk(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function UT(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Hk(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=In}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return _e(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return _e(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:qo}hasEnd(){return this.endSet_}getIndexEndValue(){return _e(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return _e(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Ta}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return _e(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===In}copy(){const e=new dy;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function zT(n){const e={};if(n.isDefault())return e;let t;if(n.index_===In?t="$priority":n.index_===zk?t="$value":n.index_===Mo?t="$key":(_e(n.index_ instanceof jk,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=vn(t),n.startSet_){const r=n.startAfterSet_?"startAfter":"startAt";e[r]=vn(n.indexStartValue_),n.startNameSet_&&(e[r]+=","+vn(n.indexStartName_))}if(n.endSet_){const r=n.endBeforeSet_?"endBefore":"endAt";e[r]=vn(n.indexEndValue_),n.endNameSet_&&(e[r]+=","+vn(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function BT(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==In&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bd extends oS{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(_e(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,r,a){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=r,this.appCheckTokenProvider_=a,this.log_=nu("p:rest:"),this.listens_={}}listen(e,t,r,a){const l=e._path.toString();this.log_("Listen called for "+l+" "+e._queryIdentifier);const u=bd.getListenId_(e,r),f={};this.listens_[u]=f;const g=zT(e._queryParams);this.restRequest_(l+".json",g,(p,y)=>{let v=y;if(p===404&&(v=null,p=null),p===null&&this.onDataUpdate_(l,v,!1,r),Oo(this.listens_,u)===f){let E;p?p===401?E="permission_denied":E="rest_error:"+p:E="ok",a(E,null)}})}unlisten(e,t){const r=bd.getListenId_(e,t);delete this.listens_[r]}get(e){const t=zT(e._queryParams),r=e._path.toString(),a=new pm;return this.restRequest_(r+".json",t,(l,u)=>{let f=u;l===404&&(f=null,l=null),l===null?(this.onDataUpdate_(r,f,!1,null),a.resolve(f)):a.reject(new Error(f))}),a.promise}refreshAuthToken(e){}restRequest_(e,t={},r){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([a,l])=>{a&&a.accessToken&&(t.auth=a.accessToken),l&&l.token&&(t.ac=l.token);const u=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+ym(t);this.log_("Sending REST request for "+u);const f=new XMLHttpRequest;f.onreadystatechange=()=>{if(r&&f.readyState===4){this.log_("REST Response for "+u+" received. status:",f.status,"response:",f.responseText);let g=null;if(f.status>=200&&f.status<300){try{g=kc(f.responseText)}catch{ts("Failed to parse JSON response for "+u+": "+f.responseText)}r(null,g)}else f.status!==401&&f.status!==404&&ts("Got unsuccessful REST response for "+u+" Status: "+f.status),r(f.status);r=null}},f.open("GET",u,!0),f.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gk{constructor(){this.rootNode_=ht.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ed(){return{value:null,children:new Map}}function vS(n,e,t){if(Ye(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const r=tt(e);n.children.has(r)||n.children.set(r,Ed());const a=n.children.get(r);e=At(e),vS(a,e,t)}}function em(n,e,t){n.value!==null?t(e,n.value):$k(n,(r,a)=>{const l=new It(e.toString()+"/"+r);em(a,l,t)})}function $k(n,e){n.children.forEach((t,r)=>{e(r,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kk{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&ys(this.last_,(r,a)=>{t[r]=t[r]-a}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FT=10*1e3,Qk=30*1e3,Yk=5*60*1e3;class Wk{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Kk(e);const r=FT+(Qk-FT)*Math.random();Rc(this.reportStats_.bind(this),Math.floor(r))}reportStats_(){const e=this.statsListener_.get(),t={};let r=!1;ys(e,(a,l)=>{l>0&&Lr(this.statsToReport_,a)&&(t[a]=l,r=!0)}),r&&this.server_.reportStats(t),Rc(this.reportStats_.bind(this),Math.floor(Math.random()*2*Yk))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Qs||(Qs={}));function wS(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function TS(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function bS(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd{constructor(e,t,r){this.path=e,this.affectedTree=t,this.revert=r,this.type=Qs.ACK_USER_WRITE,this.source=wS()}operationForChild(e){if(Ye(this.path)){if(this.affectedTree.value!=null)return _e(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new It(e));return new Sd(wt(),t,this.revert)}}else return _e(tt(this.path)===e,"operationForChild called for unrelated child."),new Sd(At(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ba{constructor(e,t,r){this.source=e,this.path=t,this.snap=r,this.type=Qs.OVERWRITE}operationForChild(e){return Ye(this.path)?new ba(this.source,wt(),this.snap.getImmediateChild(e)):new ba(this.source,At(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fc{constructor(e,t,r){this.source=e,this.path=t,this.children=r,this.type=Qs.MERGE}operationForChild(e){if(Ye(this.path)){const t=this.children.subtree(new It(e));return t.isEmpty()?null:t.value?new ba(this.source,wt(),t.value):new Fc(this.source,wt(),t)}else return _e(tt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Fc(this.source,At(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fy{constructor(e,t,r){this.node_=e,this.fullyInitialized_=t,this.filtered_=r}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Ye(e))return this.isFullyInitialized()&&!this.filtered_;const t=tt(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function Xk(n,e,t,r){const a=[],l=[];return e.forEach(u=>{u.type==="child_changed"&&n.index_.indexedValueChanged(u.oldSnap,u.snapshotNode)&&l.push(Hk(u.childName,u.snapshotNode))}),gc(n,a,"child_removed",e,r,t),gc(n,a,"child_added",e,r,t),gc(n,a,"child_moved",l,r,t),gc(n,a,"child_changed",e,r,t),gc(n,a,"value",e,r,t),a}function gc(n,e,t,r,a,l){const u=r.filter(f=>f.type===t);u.sort((f,g)=>Jk(n,f,g)),u.forEach(f=>{const g=Zk(n,f,l);a.forEach(p=>{p.respondsTo(f.type)&&e.push(p.createEvent(g,n.query_))})})}function Zk(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Jk(n,e,t){if(e.childName==null||t.childName==null)throw Go("Should only compare child_ events.");const r=new nt(e.childName,e.snapshotNode),a=new nt(t.childName,t.snapshotNode);return n.index_.compare(r,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ES(n,e){return{eventCache:n,serverCache:e}}function Nc(n,e,t,r){return ES(new fy(e,t,r),n.serverCache)}function SS(n,e,t,r){return ES(n.eventCache,new fy(e,t,r))}function tm(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ea(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Tp;const eD=()=>(Tp||(Tp=new Hn(zP)),Tp);class Ct{static fromObject(e){let t=new Ct(null);return ys(e,(r,a)=>{t=t.set(new It(r),a)}),t}constructor(e,t=eD()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:wt(),value:this.value};if(Ye(e))return null;{const r=tt(e),a=this.children.get(r);if(a!==null){const l=a.findRootMostMatchingPathAndValue(At(e),t);return l!=null?{path:hn(new It(r),l.path),value:l.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(Ye(e))return this;{const t=tt(e),r=this.children.get(t);return r!==null?r.subtree(At(e)):new Ct(null)}}set(e,t){if(Ye(e))return new Ct(t,this.children);{const r=tt(e),l=(this.children.get(r)||new Ct(null)).set(At(e),t),u=this.children.insert(r,l);return new Ct(this.value,u)}}remove(e){if(Ye(e))return this.children.isEmpty()?new Ct(null):new Ct(null,this.children);{const t=tt(e),r=this.children.get(t);if(r){const a=r.remove(At(e));let l;return a.isEmpty()?l=this.children.remove(t):l=this.children.insert(t,a),this.value===null&&l.isEmpty()?new Ct(null):new Ct(this.value,l)}else return this}}get(e){if(Ye(e))return this.value;{const t=tt(e),r=this.children.get(t);return r?r.get(At(e)):null}}setTree(e,t){if(Ye(e))return t;{const r=tt(e),l=(this.children.get(r)||new Ct(null)).setTree(At(e),t);let u;return l.isEmpty()?u=this.children.remove(r):u=this.children.insert(r,l),new Ct(this.value,u)}}fold(e){return this.fold_(wt(),e)}fold_(e,t){const r={};return this.children.inorderTraversal((a,l)=>{r[a]=l.fold_(hn(e,a),t)}),t(e,this.value,r)}findOnPath(e,t){return this.findOnPath_(e,wt(),t)}findOnPath_(e,t,r){const a=this.value?r(t,this.value):!1;if(a)return a;if(Ye(e))return null;{const l=tt(e),u=this.children.get(l);return u?u.findOnPath_(At(e),hn(t,l),r):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,wt(),t)}foreachOnPath_(e,t,r){if(Ye(e))return this;{this.value&&r(t,this.value);const a=tt(e),l=this.children.get(a);return l?l.foreachOnPath_(At(e),hn(t,a),r):new Ct(null)}}foreach(e){this.foreach_(wt(),e)}foreach_(e,t){this.children.inorderTraversal((r,a)=>{a.foreach_(hn(e,r),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,r)=>{r.value&&e(t,r.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e){this.writeTree_=e}static empty(){return new Is(new Ct(null))}}function Pc(n,e,t){if(Ye(e))return new Is(new Ct(t));{const r=n.writeTree_.findRootMostValueAndPath(e);if(r!=null){const a=r.path;let l=r.value;const u=ms(a,e);return l=l.updateChild(u,t),new Is(n.writeTree_.set(a,l))}else{const a=new Ct(t),l=n.writeTree_.setTree(e,a);return new Is(l)}}}function qT(n,e,t){let r=n;return ys(t,(a,l)=>{r=Pc(r,hn(e,a),l)}),r}function HT(n,e){if(Ye(e))return Is.empty();{const t=n.writeTree_.setTree(e,new Ct(null));return new Is(t)}}function nm(n,e){return Aa(n,e)!=null}function Aa(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ms(t.path,e)):null}function GT(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(In,(r,a)=>{e.push(new nt(r,a))}):n.writeTree_.children.inorderTraversal((r,a)=>{a.value!=null&&e.push(new nt(r,a.value))}),e}function wi(n,e){if(Ye(e))return n;{const t=Aa(n,e);return t!=null?new Is(new Ct(t)):new Is(n.writeTree_.subtree(e))}}function sm(n){return n.writeTree_.isEmpty()}function Ho(n,e){return xS(wt(),n.writeTree_,e)}function xS(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let r=null;return e.children.inorderTraversal((a,l)=>{a===".priority"?(_e(l.value!==null,"Priority writes must always be leaf nodes"),r=l.value):t=xS(hn(n,a),l,t)}),!t.getChild(n).isEmpty()&&r!==null&&(t=t.updateChild(hn(n,".priority"),r)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CS(n,e){return PS(e,n)}function tD(n,e,t,r,a){_e(r>n.lastWriteId,"Stacking an older write on top of newer ones"),a===void 0&&(a=!0),n.allWrites.push({path:e,snap:t,writeId:r,visible:a}),a&&(n.visibleWrites=Pc(n.visibleWrites,e,t)),n.lastWriteId=r}function nD(n,e){for(let t=0;t<n.allWrites.length;t++){const r=n.allWrites[t];if(r.writeId===e)return r}return null}function sD(n,e){const t=n.allWrites.findIndex(f=>f.writeId===e);_e(t>=0,"removeWrite called with nonexistent writeId.");const r=n.allWrites[t];n.allWrites.splice(t,1);let a=r.visible,l=!1,u=n.allWrites.length-1;for(;a&&u>=0;){const f=n.allWrites[u];f.visible&&(u>=t&&rD(f,r.path)?a=!1:Cs(r.path,f.path)&&(l=!0)),u--}if(a){if(l)return iD(n),!0;if(r.snap)n.visibleWrites=HT(n.visibleWrites,r.path);else{const f=r.children;ys(f,g=>{n.visibleWrites=HT(n.visibleWrites,hn(r.path,g))})}return!0}else return!1}function rD(n,e){if(n.snap)return Cs(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Cs(hn(n.path,t),e))return!0;return!1}function iD(n){n.visibleWrites=AS(n.allWrites,aD,wt()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function aD(n){return n.visible}function AS(n,e,t){let r=Is.empty();for(let a=0;a<n.length;++a){const l=n[a];if(e(l)){const u=l.path;let f;if(l.snap)Cs(t,u)?(f=ms(t,u),r=Pc(r,f,l.snap)):Cs(u,t)&&(f=ms(u,t),r=Pc(r,wt(),l.snap.getChild(f)));else if(l.children){if(Cs(t,u))f=ms(t,u),r=qT(r,f,l.children);else if(Cs(u,t))if(f=ms(u,t),Ye(f))r=qT(r,wt(),l.children);else{const g=Oo(l.children,tt(f));if(g){const p=g.getChild(At(f));r=Pc(r,wt(),p)}}}else throw Go("WriteRecord should have .snap or .children")}}return r}function IS(n,e,t,r,a){if(!r&&!a){const l=Aa(n.visibleWrites,e);if(l!=null)return l;{const u=wi(n.visibleWrites,e);if(sm(u))return t;if(t==null&&!nm(u,wt()))return null;{const f=t||ht.EMPTY_NODE;return Ho(u,f)}}}else{const l=wi(n.visibleWrites,e);if(!a&&sm(l))return t;if(!a&&t==null&&!nm(l,wt()))return null;{const u=function(p){return(p.visible||a)&&(!r||!~r.indexOf(p.writeId))&&(Cs(p.path,e)||Cs(e,p.path))},f=AS(n.allWrites,u,e),g=t||ht.EMPTY_NODE;return Ho(f,g)}}}function oD(n,e,t){let r=ht.EMPTY_NODE;const a=Aa(n.visibleWrites,e);if(a)return a.isLeafNode()||a.forEachChild(In,(l,u)=>{r=r.updateImmediateChild(l,u)}),r;if(t){const l=wi(n.visibleWrites,e);return t.forEachChild(In,(u,f)=>{const g=Ho(wi(l,new It(u)),f);r=r.updateImmediateChild(u,g)}),GT(l).forEach(u=>{r=r.updateImmediateChild(u.name,u.node)}),r}else{const l=wi(n.visibleWrites,e);return GT(l).forEach(u=>{r=r.updateImmediateChild(u.name,u.node)}),r}}function lD(n,e,t,r,a){_e(r||a,"Either existingEventSnap or existingServerSnap must exist");const l=hn(e,t);if(nm(n.visibleWrites,l))return null;{const u=wi(n.visibleWrites,l);return sm(u)?a.getChild(t):Ho(u,a.getChild(t))}}function cD(n,e,t,r){const a=hn(e,t),l=Aa(n.visibleWrites,a);if(l!=null)return l;if(r.isCompleteForChild(t)){const u=wi(n.visibleWrites,a);return Ho(u,r.getNode().getImmediateChild(t))}else return null}function uD(n,e){return Aa(n.visibleWrites,e)}function hD(n,e,t,r,a,l,u){let f;const g=wi(n.visibleWrites,e),p=Aa(g,wt());if(p!=null)f=p;else if(t!=null)f=Ho(g,t);else return[];if(f=f.withIndex(u),!f.isEmpty()&&!f.isLeafNode()){const y=[],v=u.getCompare(),E=l?f.getReverseIteratorFrom(r,u):f.getIteratorFrom(r,u);let S=E.getNext();for(;S&&y.length<a;)v(S,r)!==0&&y.push(S),S=E.getNext();return y}else return[]}function dD(){return{visibleWrites:Is.empty(),allWrites:[],lastWriteId:-1}}function rm(n,e,t,r){return IS(n.writeTree,n.treePath,e,t,r)}function RS(n,e){return oD(n.writeTree,n.treePath,e)}function $T(n,e,t,r){return lD(n.writeTree,n.treePath,e,t,r)}function xd(n,e){return uD(n.writeTree,hn(n.treePath,e))}function fD(n,e,t,r,a,l){return hD(n.writeTree,n.treePath,e,t,r,a,l)}function gy(n,e,t){return cD(n.writeTree,n.treePath,e,t)}function NS(n,e){return PS(hn(n.treePath,e),n.writeTree)}function PS(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gD{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,r=e.childName;_e(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),_e(r!==".priority","Only non-priority child changes can be tracked.");const a=this.changeMap.get(r);if(a){const l=a.type;if(t==="child_added"&&l==="child_removed")this.changeMap.set(r,UT(r,e.snapshotNode,a.snapshotNode));else if(t==="child_removed"&&l==="child_added")this.changeMap.delete(r);else if(t==="child_removed"&&l==="child_changed")this.changeMap.set(r,qk(r,a.oldSnap));else if(t==="child_changed"&&l==="child_added")this.changeMap.set(r,Fk(r,e.snapshotNode));else if(t==="child_changed"&&l==="child_changed")this.changeMap.set(r,UT(r,e.snapshotNode,a.oldSnap));else throw Go("Illegal combination of changes: "+e+" occurred after "+a)}else this.changeMap.set(r,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pD{getCompleteChild(e){return null}getChildAfterChild(e,t,r){return null}}const kS=new pD;class py{constructor(e,t,r=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=r}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const r=this.optCompleteServerCache_!=null?new fy(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return gy(this.writes_,e,r)}}getChildAfterChild(e,t,r){const a=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ea(this.viewCache_),l=fD(this.writes_,a,t,1,r,e);return l.length===0?null:l[0]}}function mD(n,e){_e(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),_e(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function yD(n,e,t,r,a){const l=new gD;let u,f;if(t.type===Qs.OVERWRITE){const p=t;p.source.fromUser?u=im(n,e,p.path,p.snap,r,a,l):(_e(p.source.fromServer,"Unknown source."),f=p.source.tagged||e.serverCache.isFiltered()&&!Ye(p.path),u=Cd(n,e,p.path,p.snap,r,a,f,l))}else if(t.type===Qs.MERGE){const p=t;p.source.fromUser?u=vD(n,e,p.path,p.children,r,a,l):(_e(p.source.fromServer,"Unknown source."),f=p.source.tagged||e.serverCache.isFiltered(),u=am(n,e,p.path,p.children,r,a,f,l))}else if(t.type===Qs.ACK_USER_WRITE){const p=t;p.revert?u=bD(n,e,p.path,r,a,l):u=wD(n,e,p.path,p.affectedTree,r,a,l)}else if(t.type===Qs.LISTEN_COMPLETE)u=TD(n,e,t.path,r,l);else throw Go("Unknown operation type: "+t.type);const g=l.getChanges();return _D(e,u,g),{viewCache:u,changes:g}}function _D(n,e,t){const r=e.eventCache;if(r.isFullyInitialized()){const a=r.getNode().isLeafNode()||r.getNode().isEmpty(),l=tm(n);(t.length>0||!n.eventCache.isFullyInitialized()||a&&!r.getNode().equals(l)||!r.getNode().getPriority().equals(l.getPriority()))&&t.push(Bk(tm(e)))}}function DS(n,e,t,r,a,l){const u=e.eventCache;if(xd(r,t)!=null)return e;{let f,g;if(Ye(t))if(_e(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const p=Ea(e),y=p instanceof ht?p:ht.EMPTY_NODE,v=RS(r,y);f=n.filter.updateFullNode(e.eventCache.getNode(),v,l)}else{const p=rm(r,Ea(e));f=n.filter.updateFullNode(e.eventCache.getNode(),p,l)}else{const p=tt(t);if(p===".priority"){_e(Ii(t)===1,"Can't have a priority with additional path components");const y=u.getNode();g=e.serverCache.getNode();const v=$T(r,t,y,g);v!=null?f=n.filter.updatePriority(y,v):f=u.getNode()}else{const y=At(t);let v;if(u.isCompleteForChild(p)){g=e.serverCache.getNode();const E=$T(r,t,u.getNode(),g);E!=null?v=u.getNode().getImmediateChild(p).updateChild(y,E):v=u.getNode().getImmediateChild(p)}else v=gy(r,p,e.serverCache);v!=null?f=n.filter.updateChild(u.getNode(),p,v,y,a,l):f=u.getNode()}}return Nc(e,f,u.isFullyInitialized()||Ye(t),n.filter.filtersNodes())}}function Cd(n,e,t,r,a,l,u,f){const g=e.serverCache;let p;const y=u?n.filter:n.filter.getIndexedFilter();if(Ye(t))p=y.updateFullNode(g.getNode(),r,null);else if(y.filtersNodes()&&!g.isFiltered()){const S=g.getNode().updateChild(t,r);p=y.updateFullNode(g.getNode(),S,null)}else{const S=tt(t);if(!g.isCompleteForPath(t)&&Ii(t)>1)return e;const D=At(t),k=g.getNode().getImmediateChild(S).updateChild(D,r);S===".priority"?p=y.updatePriority(g.getNode(),k):p=y.updateChild(g.getNode(),S,k,D,kS,null)}const v=SS(e,p,g.isFullyInitialized()||Ye(t),y.filtersNodes()),E=new py(a,v,l);return DS(n,v,t,a,E,f)}function im(n,e,t,r,a,l,u){const f=e.eventCache;let g,p;const y=new py(a,e,l);if(Ye(t))p=n.filter.updateFullNode(e.eventCache.getNode(),r,u),g=Nc(e,p,!0,n.filter.filtersNodes());else{const v=tt(t);if(v===".priority")p=n.filter.updatePriority(e.eventCache.getNode(),r),g=Nc(e,p,f.isFullyInitialized(),f.isFiltered());else{const E=At(t),S=f.getNode().getImmediateChild(v);let D;if(Ye(E))D=r;else{const j=y.getCompleteChild(v);j!=null?cS(E)===".priority"&&j.getChild(hS(E)).isEmpty()?D=j:D=j.updateChild(E,r):D=ht.EMPTY_NODE}if(S.equals(D))g=e;else{const j=n.filter.updateChild(f.getNode(),v,D,E,y,u);g=Nc(e,j,f.isFullyInitialized(),n.filter.filtersNodes())}}}return g}function KT(n,e){return n.eventCache.isCompleteForChild(e)}function vD(n,e,t,r,a,l,u){let f=e;return r.foreach((g,p)=>{const y=hn(t,g);KT(e,tt(y))&&(f=im(n,f,y,p,a,l,u))}),r.foreach((g,p)=>{const y=hn(t,g);KT(e,tt(y))||(f=im(n,f,y,p,a,l,u))}),f}function QT(n,e,t){return t.foreach((r,a)=>{e=e.updateChild(r,a)}),e}function am(n,e,t,r,a,l,u,f){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let g=e,p;Ye(t)?p=r:p=new Ct(null).setTree(t,r);const y=e.serverCache.getNode();return p.children.inorderTraversal((v,E)=>{if(y.hasChild(v)){const S=e.serverCache.getNode().getImmediateChild(v),D=QT(n,S,E);g=Cd(n,g,new It(v),D,a,l,u,f)}}),p.children.inorderTraversal((v,E)=>{const S=!e.serverCache.isCompleteForChild(v)&&E.value===null;if(!y.hasChild(v)&&!S){const D=e.serverCache.getNode().getImmediateChild(v),j=QT(n,D,E);g=Cd(n,g,new It(v),j,a,l,u,f)}}),g}function wD(n,e,t,r,a,l,u){if(xd(a,t)!=null)return e;const f=e.serverCache.isFiltered(),g=e.serverCache;if(r.value!=null){if(Ye(t)&&g.isFullyInitialized()||g.isCompleteForPath(t))return Cd(n,e,t,g.getNode().getChild(t),a,l,f,u);if(Ye(t)){let p=new Ct(null);return g.getNode().forEachChild(Mo,(y,v)=>{p=p.set(new It(y),v)}),am(n,e,t,p,a,l,f,u)}else return e}else{let p=new Ct(null);return r.foreach((y,v)=>{const E=hn(t,y);g.isCompleteForPath(E)&&(p=p.set(y,g.getNode().getChild(E)))}),am(n,e,t,p,a,l,f,u)}}function TD(n,e,t,r,a){const l=e.serverCache,u=SS(e,l.getNode(),l.isFullyInitialized()||Ye(t),l.isFiltered());return DS(n,u,t,r,kS,a)}function bD(n,e,t,r,a,l){let u;if(xd(r,t)!=null)return e;{const f=new py(r,e,a),g=e.eventCache.getNode();let p;if(Ye(t)||tt(t)===".priority"){let y;if(e.serverCache.isFullyInitialized())y=rm(r,Ea(e));else{const v=e.serverCache.getNode();_e(v instanceof ht,"serverChildren would be complete if leaf node"),y=RS(r,v)}y=y,p=n.filter.updateFullNode(g,y,l)}else{const y=tt(t);let v=gy(r,y,e.serverCache);v==null&&e.serverCache.isCompleteForChild(y)&&(v=g.getImmediateChild(y)),v!=null?p=n.filter.updateChild(g,y,v,At(t),f,l):e.eventCache.getNode().hasChild(y)?p=n.filter.updateChild(g,y,ht.EMPTY_NODE,At(t),f,l):p=g,p.isEmpty()&&e.serverCache.isFullyInitialized()&&(u=rm(r,Ea(e)),u.isLeafNode()&&(p=n.filter.updateFullNode(p,u,l)))}return u=e.serverCache.isFullyInitialized()||xd(r,wt())!=null,Nc(e,p,u,n.filter.filtersNodes())}}function ED(n,e){const t=Ea(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!Ye(e)&&!t.getImmediateChild(tt(e)).isEmpty())?t.getChild(e):null}function YT(n,e,t,r){e.type===Qs.MERGE&&e.source.queryId!==null&&(_e(Ea(n.viewCache_),"We should always have a full cache before handling merges"),_e(tm(n.viewCache_),"Missing event cache, even though we have a server cache"));const a=n.viewCache_,l=yD(n.processor_,a,e,t,r);return mD(n.processor_,l.viewCache),_e(l.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=l.viewCache,SD(n,l.changes,l.viewCache.eventCache.getNode())}function SD(n,e,t,r){const a=n.eventRegistrations_;return Xk(n.eventGenerator_,e,t,a)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let WT;function xD(n){_e(!WT,"__referenceConstructor has already been defined"),WT=n}function my(n,e,t,r){const a=e.source.queryId;if(a!==null){const l=n.views.get(a);return _e(l!=null,"SyncTree gave us an op for an invalid query."),YT(l,e,t,r)}else{let l=[];for(const u of n.views.values())l=l.concat(YT(u,e,t,r));return l}}function yy(n,e){let t=null;for(const r of n.views.values())t=t||ED(r,e);return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let XT;function CD(n){_e(!XT,"__referenceConstructor has already been defined"),XT=n}class ZT{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ct(null),this.pendingWriteTree_=dD(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function AD(n,e,t,r,a){return tD(n.pendingWriteTree_,e,t,r,a),a?Zd(n,new ba(wS(),e,t)):[]}function Ro(n,e,t=!1){const r=nD(n.pendingWriteTree_,e);if(sD(n.pendingWriteTree_,e)){let l=new Ct(null);return r.snap!=null?l=l.set(wt(),!0):ys(r.children,u=>{l=l.set(new It(u),!0)}),Zd(n,new Sd(r.path,l,t))}else return[]}function Xd(n,e,t){return Zd(n,new ba(TS(),e,t))}function ID(n,e,t){const r=Ct.fromObject(t);return Zd(n,new Fc(TS(),e,r))}function RD(n,e,t,r){const a=VS(n,r);if(a!=null){const l=jS(a),u=l.path,f=l.queryId,g=ms(u,e),p=new ba(bS(f),g,t);return US(n,u,p)}else return[]}function ND(n,e,t,r){const a=VS(n,r);if(a){const l=jS(a),u=l.path,f=l.queryId,g=ms(u,e),p=Ct.fromObject(t),y=new Fc(bS(f),g,p);return US(n,u,y)}else return[]}function MS(n,e,t){const a=n.pendingWriteTree_,l=n.syncPointTree_.findOnPath(e,(u,f)=>{const g=ms(u,e),p=yy(f,g);if(p)return p});return IS(a,e,l,t,!0)}function Zd(n,e){return OS(e,n.syncPointTree_,null,CS(n.pendingWriteTree_,wt()))}function OS(n,e,t,r){if(Ye(n.path))return LS(n,e,t,r);{const a=e.get(wt());t==null&&a!=null&&(t=yy(a,wt()));let l=[];const u=tt(n.path),f=n.operationForChild(u),g=e.children.get(u);if(g&&f){const p=t?t.getImmediateChild(u):null,y=NS(r,u);l=l.concat(OS(f,g,p,y))}return a&&(l=l.concat(my(a,n,r,t))),l}}function LS(n,e,t,r){const a=e.get(wt());t==null&&a!=null&&(t=yy(a,wt()));let l=[];return e.children.inorderTraversal((u,f)=>{const g=t?t.getImmediateChild(u):null,p=NS(r,u),y=n.operationForChild(u);y&&(l=l.concat(LS(y,f,g,p)))}),a&&(l=l.concat(my(a,n,r,t))),l}function VS(n,e){return n.tagToQueryMap.get(e)}function jS(n){const e=n.indexOf("$");return _e(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new It(n.substr(0,e))}}function US(n,e,t){const r=n.syncPointTree_.get(e);_e(r,"Missing sync point for query tag that we're tracking");const a=CS(n.pendingWriteTree_,e);return my(r,t,a,null)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _y{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new _y(t)}node(){return this.node_}}class vy{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=hn(this.path_,e);return new vy(this.syncTree_,t)}node(){return MS(this.syncTree_,this.path_)}}const PD=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},JT=function(n,e,t){if(!n||typeof n!="object")return n;if(_e(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return kD(n[".sv"],e,t);if(typeof n[".sv"]=="object")return DD(n[".sv"],e);_e(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},kD=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:_e(!1,"Unexpected server value: "+n)}},DD=function(n,e,t){n.hasOwnProperty("increment")||_e(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const r=n.increment;typeof r!="number"&&_e(!1,"Unexpected increment value: "+r);const a=e.node();if(_e(a!==null&&typeof a<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!a.isLeafNode())return r;const u=a.getValue();return typeof u!="number"?r:u+r},MD=function(n,e,t,r){return wy(e,new vy(t,n),r)},OD=function(n,e,t){return wy(n,new _y(e),t)};function wy(n,e,t){const r=n.getPriority().val(),a=JT(r,e.getImmediateChild(".priority"),t);let l;if(n.isLeafNode()){const u=n,f=JT(u.getValue(),e,t);return f!==u.getValue()||a!==u.getPriority().val()?new on(f,An(a)):n}else{const u=n;return l=u,a!==u.getPriority().val()&&(l=l.updatePriority(new on(a))),u.forEachChild(In,(f,g)=>{const p=wy(g,e.getImmediateChild(f),t);p!==g&&(l=l.updateImmediateChild(f,p))}),l}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ty{constructor(e="",t=null,r={children:{},childCount:0}){this.name=e,this.parent=t,this.node=r}}function by(n,e){let t=e instanceof It?e:new It(e),r=n,a=tt(t);for(;a!==null;){const l=Oo(r.node.children,a)||{children:{},childCount:0};r=new Ty(a,r,l),t=At(t),a=tt(t)}return r}function Xo(n){return n.node.value}function zS(n,e){n.node.value=e,om(n)}function BS(n){return n.node.childCount>0}function LD(n){return Xo(n)===void 0&&!BS(n)}function Jd(n,e){ys(n.node.children,(t,r)=>{e(new Ty(t,n,r))})}function FS(n,e,t,r){t&&e(n),Jd(n,a=>{FS(a,e,!0)})}function VD(n,e,t){let r=n.parent;for(;r!==null;){if(e(r))return!0;r=r.parent}return!1}function iu(n){return new It(n.parent===null?n.name:iu(n.parent)+"/"+n.name)}function om(n){n.parent!==null&&jD(n.parent,n.name,n)}function jD(n,e,t){const r=LD(t),a=Lr(n.node.children,e);r&&a?(delete n.node.children[e],n.node.childCount--,om(n)):!r&&!a&&(n.node.children[e]=t.node,n.node.childCount++,om(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const UD=/[\[\].#$\/\u0000-\u001F\u007F]/,zD=/[\[\].#$\u0000-\u001F\u007F]/,bp=10*1024*1024,qS=function(n){return typeof n=="string"&&n.length!==0&&!UD.test(n)},BD=function(n){return typeof n=="string"&&n.length!==0&&!zD.test(n)},FD=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),BD(n)},HS=function(n,e,t){const r=t instanceof It?new Tk(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+da(r));if(typeof e=="function")throw new Error(n+"contains a function "+da(r)+" with contents = "+e.toString());if(F1(e))throw new Error(n+"contains "+e.toString()+" "+da(r));if(typeof e=="string"&&e.length>bp/3&&Id(e)>bp)throw new Error(n+"contains a string greater than "+bp+" utf8 bytes "+da(r)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let a=!1,l=!1;if(ys(e,(u,f)=>{if(u===".value")a=!0;else if(u!==".priority"&&u!==".sv"&&(l=!0,!qS(u)))throw new Error(n+" contains an invalid key ("+u+") "+da(r)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);bk(r,u),HS(n,f,r),Ek(r)}),a&&l)throw new Error(n+' contains ".value" child '+da(r)+" in addition to actual children.")}},qD=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!qS(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!FD(t))throw new Error(hA(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HD{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function GD(n,e){let t=null;for(let r=0;r<e.length;r++){const a=e[r],l=a.getPath();t!==null&&!dS(l,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:l}),t.events.push(a)}t&&n.eventLists_.push(t)}function Ia(n,e,t){GD(n,t),$D(n,r=>Cs(r,e)||Cs(e,r))}function $D(n,e){n.recursionDepth_++;let t=!0;for(let r=0;r<n.eventLists_.length;r++){const a=n.eventLists_[r];if(a){const l=a.path;e(l)?(KD(n.eventLists_[r]),n.eventLists_[r]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function KD(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const r=t.getEventRunner();Ic&&Cn("event: "+t.toString()),su(r)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QD="repo_interrupt",YD=25;class WD{constructor(e,t,r,a){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=r,this.appCheckProvider_=a,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new HD,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ed(),this.transactionQueueTree_=new Ty,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function XD(n,e,t){if(n.stats_=ly(n.repoInfo_),n.forceRestClient_||$P())n.server_=new bd(n.repoInfo_,(r,a,l,u)=>{eb(n,r,a,l,u)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>tb(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{vn(t)}catch(r){throw new Error("Invalid authOverride provided: "+r)}}n.persistentConnection_=new Nr(n.repoInfo_,e,(r,a,l,u)=>{eb(n,r,a,l,u)},r=>{tb(n,r)},r=>{JD(n,r)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(r=>{n.server_.refreshAuthToken(r)}),n.appCheckProvider_.addTokenChangeListener(r=>{n.server_.refreshAppCheckToken(r.token)}),n.statsReporter_=XP(n.repoInfo_,()=>new Wk(n.stats_,n.server_)),n.infoData_=new Gk,n.infoSyncTree_=new ZT({startListening:(r,a,l,u)=>{let f=[];const g=n.infoData_.getNode(r._path);return g.isEmpty()||(f=Xd(n.infoSyncTree_,r._path,g),setTimeout(()=>{u("ok")},0)),f},stopListening:()=>{}}),Ey(n,"connected",!1),n.serverSyncTree_=new ZT({startListening:(r,a,l,u)=>(n.server_.listen(r,l,a,(f,g)=>{const p=u(f,g);Ia(n.eventQueue_,r._path,p)}),[]),stopListening:(r,a)=>{n.server_.unlisten(r,a)}})}function ZD(n){const t=n.infoData_.getNode(new It(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function GS(n){return PD({timestamp:ZD(n)})}function eb(n,e,t,r,a){n.dataUpdateCount++;const l=new It(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let u=[];if(a)if(r){const g=Xh(t,p=>An(p));u=ND(n.serverSyncTree_,l,g,a)}else{const g=An(t);u=RD(n.serverSyncTree_,l,g,a)}else if(r){const g=Xh(t,p=>An(p));u=ID(n.serverSyncTree_,l,g)}else{const g=An(t);u=Xd(n.serverSyncTree_,l,g)}let f=l;u.length>0&&(f=xy(n,l)),Ia(n.eventQueue_,f,u)}function tb(n,e){Ey(n,"connected",e),e===!1&&tM(n)}function JD(n,e){ys(e,(t,r)=>{Ey(n,t,r)})}function Ey(n,e,t){const r=new It("/.info/"+e),a=An(t);n.infoData_.updateSnapshot(r,a);const l=Xd(n.infoSyncTree_,r,a);Ia(n.eventQueue_,r,l)}function eM(n){return n.nextWriteId_++}function tM(n){$S(n,"onDisconnectEvents");const e=GS(n),t=Ed();em(n.onDisconnect_,wt(),(a,l)=>{const u=MD(a,l,n.serverSyncTree_,e);vS(t,a,u)});let r=[];em(t,wt(),(a,l)=>{r=r.concat(Xd(n.serverSyncTree_,a,l));const u=iM(n,a);xy(n,u)}),n.onDisconnect_=Ed(),Ia(n.eventQueue_,wt(),r)}function nM(n){n.persistentConnection_&&n.persistentConnection_.interrupt(QD)}function $S(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),Cn(t,...e)}function KS(n,e,t){return MS(n.serverSyncTree_,e,t)||ht.EMPTY_NODE}function Sy(n,e=n.transactionQueueTree_){if(e||ef(n,e),Xo(e)){const t=YS(n,e);_e(t.length>0,"Sending zero length transaction queue"),t.every(a=>a.status===0)&&sM(n,iu(e),t)}else BS(e)&&Jd(e,t=>{Sy(n,t)})}function sM(n,e,t){const r=t.map(p=>p.currentWriteId),a=KS(n,e,r);let l=a;const u=a.hash();for(let p=0;p<t.length;p++){const y=t[p];_e(y.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),y.status=1,y.retryCount++;const v=ms(e,y.path);l=l.updateChild(v,y.currentOutputSnapshotRaw)}const f=l.val(!0),g=e;n.server_.put(g.toString(),f,p=>{$S(n,"transaction put response",{path:g.toString(),status:p});let y=[];if(p==="ok"){const v=[];for(let E=0;E<t.length;E++)t[E].status=2,y=y.concat(Ro(n.serverSyncTree_,t[E].currentWriteId)),t[E].onComplete&&v.push(()=>t[E].onComplete(null,!0,t[E].currentOutputSnapshotResolved)),t[E].unwatcher();ef(n,by(n.transactionQueueTree_,e)),Sy(n,n.transactionQueueTree_),Ia(n.eventQueue_,e,y);for(let E=0;E<v.length;E++)su(v[E])}else{if(p==="datastale")for(let v=0;v<t.length;v++)t[v].status===3?t[v].status=4:t[v].status=0;else{ts("transaction at "+g.toString()+" failed: "+p);for(let v=0;v<t.length;v++)t[v].status=4,t[v].abortReason=p}xy(n,e)}},u)}function xy(n,e){const t=QS(n,e),r=iu(t),a=YS(n,t);return rM(n,a,r),r}function rM(n,e,t){if(e.length===0)return;const r=[];let a=[];const u=e.filter(f=>f.status===0).map(f=>f.currentWriteId);for(let f=0;f<e.length;f++){const g=e[f],p=ms(t,g.path);let y=!1,v;if(_e(p!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),g.status===4)y=!0,v=g.abortReason,a=a.concat(Ro(n.serverSyncTree_,g.currentWriteId,!0));else if(g.status===0)if(g.retryCount>=YD)y=!0,v="maxretry",a=a.concat(Ro(n.serverSyncTree_,g.currentWriteId,!0));else{const E=KS(n,g.path,u);g.currentInputSnapshot=E;const S=e[f].update(E.val());if(S!==void 0){HS("transaction failed: Data returned ",S,g.path);let D=An(S);typeof S=="object"&&S!=null&&Lr(S,".priority")||(D=D.updatePriority(E.getPriority()));const k=g.currentWriteId,P=GS(n),z=OD(D,E,P);g.currentOutputSnapshotRaw=D,g.currentOutputSnapshotResolved=z,g.currentWriteId=eM(n),u.splice(u.indexOf(k),1),a=a.concat(AD(n.serverSyncTree_,g.path,z,g.currentWriteId,g.applyLocally)),a=a.concat(Ro(n.serverSyncTree_,k,!0))}else y=!0,v="nodata",a=a.concat(Ro(n.serverSyncTree_,g.currentWriteId,!0))}Ia(n.eventQueue_,t,a),a=[],y&&(e[f].status=2,function(E){setTimeout(E,Math.floor(0))}(e[f].unwatcher),e[f].onComplete&&(v==="nodata"?r.push(()=>e[f].onComplete(null,!1,e[f].currentInputSnapshot)):r.push(()=>e[f].onComplete(new Error(v),!1,null))))}ef(n,n.transactionQueueTree_);for(let f=0;f<r.length;f++)su(r[f]);Sy(n,n.transactionQueueTree_)}function QS(n,e){let t,r=n.transactionQueueTree_;for(t=tt(e);t!==null&&Xo(r)===void 0;)r=by(r,t),e=At(e),t=tt(e);return r}function YS(n,e){const t=[];return WS(n,e,t),t.sort((r,a)=>r.order-a.order),t}function WS(n,e,t){const r=Xo(e);if(r)for(let a=0;a<r.length;a++)t.push(r[a]);Jd(e,a=>{WS(n,a,t)})}function ef(n,e){const t=Xo(e);if(t){let r=0;for(let a=0;a<t.length;a++)t[a].status!==2&&(t[r]=t[a],r++);t.length=r,zS(e,t.length>0?t:void 0)}Jd(e,r=>{ef(n,r)})}function iM(n,e){const t=iu(QS(n,e)),r=by(n.transactionQueueTree_,e);return VD(r,a=>{Ep(n,a)}),Ep(n,r),FS(r,a=>{Ep(n,a)}),t}function Ep(n,e){const t=Xo(e);if(t){const r=[];let a=[],l=-1;for(let u=0;u<t.length;u++)t[u].status===3||(t[u].status===1?(_e(l===u-1,"All SENT items should be at beginning of queue."),l=u,t[u].status=3,t[u].abortReason="set"):(_e(t[u].status===0,"Unexpected transaction status in abort"),t[u].unwatcher(),a=a.concat(Ro(n.serverSyncTree_,t[u].currentWriteId,!0)),t[u].onComplete&&r.push(t[u].onComplete.bind(null,new Error("set"),!1,null))));l===-1?zS(e,void 0):t.length=l+1,Ia(n.eventQueue_,iu(e),a);for(let u=0;u<r.length;u++)su(r[u])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function aM(n){let e="";const t=n.split("/");for(let r=0;r<t.length;r++)if(t[r].length>0){let a=t[r];try{a=decodeURIComponent(a.replace(/\+/g," "))}catch{}e+="/"+a}return e}function oM(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const r=t.split("=");r.length===2?e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):ts(`Invalid query segment '${t}' in query '${n}'`)}return e}const nb=function(n,e){const t=lM(n),r=t.namespace;t.domain==="firebase.com"&&Or(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!r||r==="undefined")&&t.domain!=="localhost"&&Or("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||jP();const a=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new eS(t.host,t.secure,r,a,e,"",r!==t.subdomain),path:new It(t.pathString)}},lM=function(n){let e="",t="",r="",a="",l="",u=!0,f="https",g=443;if(typeof n=="string"){let p=n.indexOf("//");p>=0&&(f=n.substring(0,p-1),n=n.substring(p+2));let y=n.indexOf("/");y===-1&&(y=n.length);let v=n.indexOf("?");v===-1&&(v=n.length),e=n.substring(0,Math.min(y,v)),y<v&&(a=aM(n.substring(y,v)));const E=oM(n.substring(Math.min(n.length,v)));p=e.indexOf(":"),p>=0?(u=f==="https"||f==="wss",g=parseInt(e.substring(p+1),10)):p=e.length;const S=e.slice(0,p);if(S.toLowerCase()==="localhost")t="localhost";else if(S.split(".").length<=2)t=S;else{const D=e.indexOf(".");r=e.substring(0,D).toLowerCase(),t=e.substring(D+1),l=r}"ns"in E&&(l=E.ns)}return{host:e,port:g,domain:t,subdomain:r,secure:u,scheme:f,pathString:a,namespace:l}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cy{constructor(e,t,r,a){this._repo=e,this._path=t,this._queryParams=r,this._orderByCalled=a}get key(){return Ye(this._path)?null:cS(this._path)}get ref(){return new Zo(this._repo,this._path)}get _queryIdentifier(){const e=BT(this._queryParams),t=ay(e);return t==="{}"?"default":t}get _queryObject(){return BT(this._queryParams)}isEqual(e){if(e=dn(e),!(e instanceof Cy))return!1;const t=this._repo===e._repo,r=dS(this._path,e._path),a=this._queryIdentifier===e._queryIdentifier;return t&&r&&a}toJSON(){return this.toString()}toString(){return this._repo.toString()+wk(this._path)}}class Zo extends Cy{constructor(e,t){super(e,t,new dy,!1)}get parent(){const e=hS(this._path);return e===null?null:new Zo(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}xD(Zo);CD(Zo);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cM="FIREBASE_DATABASE_EMULATOR_HOST",lm={};let uM=!1;function hM(n,e,t,r){n.repoInfo_=new eS(e,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),r&&(n.authTokenProvider_=r)}function dM(n,e,t,r,a){let l=r||n.options.databaseURL;l===void 0&&(n.options.projectId||Or("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Cn("Using default host for project ",n.options.projectId),l=`${n.options.projectId}-default-rtdb.firebaseio.com`);let u=nb(l,a),f=u.repoInfo,g;typeof process<"u"&&bT&&(g=bT[cM]),g?(l=`http://${g}?ns=${f.namespace}`,u=nb(l,a),f=u.repoInfo):u.repoInfo.secure;const p=new QP(n.name,n.options,e);qD("Invalid Firebase Database URL",u),Ye(u.path)||Or("Database URL must point to the root of a Firebase Database (not including a child path).");const y=gM(f,n,p,new KP(n,t));return new pM(y,n)}function fM(n,e){const t=lm[e];(!t||t[n.key]!==n)&&Or(`Database ${e}(${n.repoInfo_}) has already been deleted.`),nM(n),delete t[n.key]}function gM(n,e,t,r){let a=lm[e.name];a||(a={},lm[e.name]=a);let l=a[n.toURLString()];return l&&Or("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),l=new WD(n,uM,t,r),a[n.toURLString()]=l,l}class pM{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(XD(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Zo(this._repo,wt())),this._rootInternal}_delete(){return this._rootInternal!==null&&(fM(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&Or("Cannot call "+e+" on a deleted database.")}}function mM(n=vm(),e){const t=Nd(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const r=Sb("database");r&&yM(t,...r)}return t}function yM(n,e,t,r={}){n=dn(n),n._checkNotDeleted("useEmulator");const a=`${e}:${t}`,l=n._repoInternal;if(n._instanceStarted){if(a===n._repoInternal.repoInfo_.host&&Pr(r,l.repoInfo_.emulatorOptions))return;Or("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let u;if(l.repoInfo_.nodeAdmin)r.mockUserToken&&Or('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),u=new Kh(Kh.OWNER);else if(r.mockUserToken){const f=typeof r.mockUserToken=="string"?r.mockUserToken:Cb(r.mockUserToken,n.app.options.projectId);u=new Kh(f)}hM(l,a,r,u)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _M(n){kP(Gc),ma(new Ti("database",(e,{instanceIdentifier:t})=>{const r=e.getProvider("app").getImmediate(),a=e.getProvider("auth-internal"),l=e.getProvider("app-check-internal");return dM(r,a,l,t)},"PUBLIC").setMultipleInstances(!0)),Ys(ET,ST,n),Ys(ET,ST,"esm2017")}Nr.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};Nr.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};_M();const XS={apiKey:"AIzaSyAnHyYS-zdzfiTe97jJDfEaf1HxqmvLzmc",authDomain:"conflictology-conflict.firebaseapp.com",projectId:"conflictology-conflict",storageBucket:"conflictology-conflict.appspot.com",messagingSenderId:"205495071119",appId:"1:205495071119:web:c9077530939d71160c1bfa",databaseURL:"https://conflictology-conflict-default-rtdb.firebaseio.com"};let Ay=ow().length?ow()[0]:Pb(XS);const qc=rE(Ay),_n=gP(Ay);mM(Ay);Jb(qc,Em);gi.storage.local.get("user").then(({user:n})=>{n&&n.uid?(console.log("Found user in local storage, authenticating with Firebase..."),ZS(n.uid).then(()=>console.log("Successfully initialized Firebase auth from storage")).catch(e=>console.error("Failed to initialize Firebase auth from storage:",e))):console.log("No user found in local storage")});const ZS=async n=>{var e;try{console.log("Authenticating with Firebase using UID:",n),console.log("Fetching custom token from API...");const t=await fetch("https://conflictology-web.vercel.app/api/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:n})});if(console.log("API response status:",t.status),!t.ok){const f=await t.json();throw console.error("API error response:",f),new Error(f.error||"Failed to get custom token")}const r=await t.json();console.log("API response data:",r);const{customToken:a}=r;if(console.log("Custom token received:",a?a.substring(0,10)+"...":"None"),!a)throw new Error("No custom token received");console.log("Signing in with custom token...");const l=await Zb(qc,a);console.log("Sign in successful, user:",(e=l.user)==null?void 0:e.uid);const u=qc.currentUser;return console.log("Current Firebase user after authentication:",u==null?void 0:u.uid),l}catch(t){throw console.error("Authentication error:",t),t}},sb=Object.freeze(Object.defineProperty({__proto__:null,auth:qc,authenticateWithFirebase:ZS,clientCredentials:XS,db:_n},Symbol.toStringTag,{value:"Module"})),J={system:{gameCreated:"Game room created",gameStarted:"Game started",playerJoined:n=>`${n} joined the game`,playerEliminated:n=>`${n} has been eliminated!`,stealBlocked:"The Steal was blocked",foreignAidBlocked:"The Foreign Aid was blocked",hackBlocked:"Hacker was blocked by Judge",secondCardRequired:n=>`Waiting for ${n} to select a second card to lose`,swapAllowed:n=>`Waiting for ${n} to select cards to keep`,exchangeSelecting:n=>`Waiting for ${n} to select cards to keep`,loseInfluence:n=>`Waiting for ${n} to select a card to lose`,selectCardToShow:n=>`Waiting for ${n} to select a card to show`,decideInvestigation:n=>`Waiting for ${n} to make a decision about the card`,playersAllowAction:"Players allow action"},actions:{income:"takes Income (+$1M)",tax:"claims Banker to collect Tax",foreignAid:"claims Foreign Aid",steal:"claims Mafia to Steal from",hack:"pays $3M to hack",exchange:"claims Reporter to Exchange",investigate:"claims Police to Investigate",swap:"claims Police to Swap one card",scandal:n=>n>=10?"pays $7M to expose in a Scandal":"must pay $7M to expose in a Scandal"},results:{income:"takes Income (+$1M)",tax:"collected Tax with Banker (+$3M)",foreignAid:"received Foreign Aid (+$2M)",steal:n=>`Steals $${n}M from`,exchange:"completes the 2 cards Exchange",swap:"completes the card Swap",investigateKeep:"lets",investigateKeepSuffix:"keep their card",investigateSwap:"forces",investigateSwapSuffix:"to Swap their card",hack:"completed the Hacker attack on",loseInfluence:"lost 1 influence card",showCard:"shows a card to"},blocks:{banker:"claims Banker to block",judge:"claims Judge to block",mafia:"claims Mafia to block",police:"claims Police to block",reporter:"claims Reporter to block"},challenges:{success:n=>`challenges ${n} claim. Success!`,fail:n=>`challenges ${n} claim. Fails!`,blockSuccess:n=>`challenges ${n} block. Success!`,blockFail:n=>`challenges ${n} block. Fails!`},responses:{allow:"allows",allowForeignAid:"Players allow Foreign Aid",allowTax:"Players allow Tax collection",allowExchange:"Players allow Exchange",allowInvestigation:"allows Investigation",allowSwap:"Players allow to Swap 1 card",allowSteal:"allows Steal",allowHack:"allows Hack",allowBlock:"allows",allowBlockSuffix:"to block"}},vM="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let JS=(n=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=vM[t[n]&63];return e};const wM=n=>n.eliminated===!0,TM=(n,e)=>{let t=(e+1)%n.length;for(;wM(n[t]);)t=(t+1)%n.length;return t},it=(n,e)=>({currentTurn:TM(n,e),actionUsedThisTurn:!1});class bM{createLog(e,t,r){let a=r==null?void 0:r.message;a||(a=this.generateMessage(e,r||{}));const l={type:e,player:t.name,playerColor:t.color,timestamp:Date.now(),playerId:(r==null?void 0:r.playerId)!==void 0?r.playerId:t.id,message:a};switch(l.messageParts=[],(r==null?void 0:r.targetId)!==void 0&&(l.targetId=r.targetId),e){case"allow":(r==null?void 0:r.actionType)==="block"&&(r!=null&&r.target)&&(r==null?void 0:r.targetId)!==void 0?l.messageParts=[{type:"text",content:J.responses.allowBlock+" "},{type:"player",content:r.target,playerId:r.targetId,color:r.targetColor||"#FFFFFF"},{type:"text",content:" "+J.responses.allowBlockSuffix}]:r!=null&&r.target&&(r==null?void 0:r.targetId)!==void 0?l.messageParts=[{type:"text",content:a}]:l.messageParts=[{type:"text",content:a}];break;case"challenge":case"challenge-success":case"challenge-fail":l.messageParts=[{type:"text",content:a}];break;case"block":l.messageParts=[{type:"text",content:a}];break;case"steal":r!=null&&r.coins&&(r!=null&&r.target)&&(r==null?void 0:r.targetId)!==void 0?(l.messageParts=[{type:"text",content:a},{type:"player",content:r.target,playerId:r.targetId,color:r.targetColor||"#FFFFFF"}],l.message=a+r.target):r!=null&&r.target&&(r==null?void 0:r.targetId)!==void 0?(l.messageParts=[{type:"text",content:a},{type:"player",content:r.target,playerId:r.targetId,color:r.targetColor||"#FFFFFF"}],l.message=a+r.target):l.messageParts=[{type:"text",content:a}];break;case"scandal":r!=null&&r.target&&(r==null?void 0:r.targetId)!==void 0?(l.messageParts=[{type:"text",content:a+" "},{type:"player",content:r.target,playerId:r.targetId,color:r.targetColor||"#FFFFFF"}],l.message=a+" "+r.target):l.messageParts=[{type:"text",content:a}];break;case"hack":case"income":case"foreign-aid":case"banker":case"exchange":case"investigate":r!=null&&r.target&&(r==null?void 0:r.targetId)!==void 0?l.messageParts=[{type:"text",content:a+" "},{type:"player",content:r.target,playerId:r.targetId,color:r.targetColor||"#FFFFFF"}]:l.messageParts=[{type:"text",content:a}];break;default:l.messageParts=[{type:"text",content:a}]}return(r==null?void 0:r.coins)!==void 0&&(l.coins=r.coins),(r==null?void 0:r.card)!==void 0&&(l.card=r.card),(r==null?void 0:r.targetCard)!==void 0&&(l.targetCard=r.targetCard),(r==null?void 0:r.actionType)!==void 0&&(l.actionType=r.actionType),(r==null?void 0:r.target)!==void 0&&(l.target=r.target),(r==null?void 0:r.targetColor)!==void 0&&(l.targetColor=r.targetColor),l}createSystemLog(e,t,r){const a={type:"system",player:"",playerColor:"#9CA3AF",timestamp:Date.now(),message:e,messageParts:[{type:"text",content:e}]};return t!==void 0&&(a.playerId=t),r!==void 0&&(a.targetId=r),a}createSpecificSystemLog(e,t){let r="",a=t==null?void 0:t.playerId,l=t==null?void 0:t.targetId,u=t==null?void 0:t.playerName;switch(e){case"loseInfluence":r=J.system.loseInfluence(u),a=t.playerId;break;case"selectCardToShow":r=J.system.selectCardToShow(u),a=t.playerId;break;case"decideInvestigation":r=J.system.decideInvestigation(u),a=t.playerId;break;case"stealBlocked":r=J.system.stealBlocked;break;case"foreignAidBlocked":r=J.system.foreignAidBlocked;break;case"hackBlocked":r=J.system.hackBlocked;break;case"secondCardRequired":r=J.system.secondCardRequired(u),a=t.playerId;break;case"swapAllowed":r=J.system.swapAllowed(u),a=t.playerId;break;case"exchangeSelecting":r=J.system.exchangeSelecting(u),a=t.playerId;break;default:r=(t==null?void 0:t.message)||""}const f={type:"system",player:"System",playerColor:"#9CA3AF",timestamp:Date.now(),message:r,messageParts:[]};return f.messageParts=[{type:"text",content:r}],a!==void 0&&(f.playerId=a),l!==void 0&&(f.targetId=l),f}generateMessage(e,t){switch(e){case"income":return J.results.income;case"foreign-aid":return t.coins?J.results.foreignAid:J.actions.foreignAid;case"banker":return t.coins?J.results.tax:J.actions.tax;case"steal":return t.coins&&t.target?J.results.steal(t.coins):J.actions.steal;case"hack":return t.coins?J.results.hack:(t.target,J.actions.hack);case"exchange":return t.completed?J.results.exchange:J.actions.exchange;case"investigate":return t.result?t.keepCard?J.results.investigateKeep:J.results.investigateSwap:J.actions.investigate;case"scandal":return J.actions.scandal(t.coins||0);case"block":if(t.card)switch(t.card){case"Banker":return J.blocks.banker;case"Judge":return J.blocks.judge;case"Mafia":return J.blocks.mafia;case"Police":return J.blocks.police;case"Reporter":return J.blocks.reporter;default:return`claims ${t.card} to block`}return J.responses.allow;case"challenge":return t.card?J.challenges.success(t.card):"challenges";case"challenge-success":return t.card?J.challenges.success(t.card):"challenge succeeds";case"challenge-fail":return t.card?J.challenges.fail(t.card):"challenge fails";case"lose-influence":return J.results.loseInfluence;case"show-card":return J.results.showCard;case"allow":if(t.actionType)switch(t.actionType){case"foreignAid":return J.responses.allowForeignAid;case"tax":return J.responses.allowTax;case"exchange":return J.responses.allowExchange;case"investigate":return J.responses.allowInvestigation;case"swap":return J.responses.allowSwap;case"steal":return J.responses.allowSteal;case"hack":return J.responses.allowHack;case"block":return J.responses.allowBlock;default:return J.responses.allow}return J.responses.allow;default:return""}}}const ce=new bM,EM={execute:async({game:n,player:e,playerId:t})=>{if(e.eliminated)throw new Error("Eliminated players cannot perform actions");const r=[...n.players];r[t].coins+=1;const a=it(r,n.currentTurn);return{players:r,logs:[ce.createLog("income",e,{coins:1,message:J.actions.income,playerId:t})],...a}},respond:async({})=>({})};class SM{createDeck(){const e=[];return["Banker","Hacker","Mafia","Reporter","Judge","Police"].forEach(r=>{for(let a=0;a<3;a++)e.push({id:`${r}-${JS(6)}`,name:r,playerId:null,location:"deck",revealed:!1,position:null})}),this.shuffleCards(e)}shuffleCards(e){const t=[...e];for(let r=0;r<3;r++)for(let a=t.length-1;a>0;a--){const l=Math.floor(Math.random()*(a+1));[t[a],t[l]]=[t[l],t[a]]}return t}dealCards(e,t){const r=[...e];return t.forEach(a=>{for(let l=0;l<2;l++){const u=r.findIndex(f=>f.location==="deck"&&f.playerId===null);u!==-1&&(r[u]={...r[u],playerId:a,location:"player",position:l})}}),r}getPlayerCards(e,t){return e.filter(r=>r.playerId===t&&r.location==="player"&&!r.revealed)}hasCardType(e,t,r){return e.some(a=>a.playerId===t&&a.location==="player"&&!a.revealed&&a.name===r)}drawCards(e,t,r){const a=[...e];for(let l=0;l<t;l++){const u=a.findIndex(f=>f.location==="deck"&&f.playerId===null);u!==-1&&(a[u]={...a[u],location:r,position:null})}return a}returnCardsToDeck(e,t){const r=[...e];return t.forEach(a=>{const l=r.findIndex(u=>u.id===a);l!==-1&&(r[l]={...r[l],playerId:null,location:"deck",revealed:!1,position:null})}),this.shuffleCards(r)}revealCard(e,t){const r=[...e],a=r.findIndex(l=>l.id===t);return a!==-1&&(r[a]={...r[a],revealed:!0}),r}replaceCard(e,t){const r=[...e],a=r.find(g=>g.id===t);if(!a)return r;const l=r.findIndex(g=>g.location==="deck"&&g.playerId===null);if(l===-1)return r;const u=a.position,f=r.findIndex(g=>g.id===t);return f!==-1&&(r[f]={...r[f],playerId:null,location:"deck",revealed:!1,position:null}),r[l]={...r[l],playerId:a.playerId,location:"player",position:u},r}validateCardCounts(e){if(e.length!==18)return!1;const t=["Banker","Hacker","Mafia","Reporter","Judge","Police"];for(const a of t)if(e.filter(u=>u.name===a).length!==3)return!1;return new Set(e.map(a=>a.id)).size===e.length}}const pe=new SM,xM={execute:async({player:n,playerId:e})=>{if(n.eliminated)throw new Error("Eliminated players cannot perform actions");return{logs:[ce.createLog("foreign-aid",n,{message:J.actions.foreignAid,playerId:e})],actionInProgress:{type:"foreign-aid",player:e,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!n.actionInProgress)return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l={},u=r.card?{type:r.type,card:r.card}:{type:r.type},f={...n.actionInProgress.responses,[t]:u};if(r.type==="lose_influence"){const g=pe.getPlayerCards(n.cards,e.id);if(g.length===0){const S=[...n.players];S[t].eliminated=!0,l.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))],l.players=S,l.actionInProgress=null;const D=it(S,n.currentTurn);return l.currentTurn=D.currentTurn,l.actionUsedThisTurn=D.actionUsedThisTurn,l}let p=r.card?g.find(S=>S.name===r.card):g[0];p||(p=g[0]);const y=pe.revealCard(n.cards,p.id);if(l.cards=y,l.logs=[ce.createLog("lose-influence",e,{playerId:t})],pe.getPlayerCards(y,e.id).length===0){const S=[...n.players];S[t].eliminated=!0,l.players=S,l.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(n.actionInProgress.blockingPlayer!==void 0&&t===n.actionInProgress.losingPlayer&&n.actionInProgress.blockingPlayer!==n.actionInProgress.losingPlayer&&n.actionInProgress.challengeDefense,n.actionInProgress.blockingPlayer===t){const S=[...n.players];S[n.actionInProgress.player].coins+=2,l.logs.push(ce.createLog("foreign-aid",a,{coins:2,message:J.results.foreignAid})),l.players=S}l.actionInProgress=null;const E=it(n.players,n.currentTurn);return l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn,l}if(r.type==="block"&&r.card==="Banker")return l.logs=[ce.createLog("block",e,{target:a.name,targetColor:a.color,targetId:n.actionInProgress.player,card:"Banker",message:J.blocks.banker,playerId:t})],l.actionInProgress={...n.actionInProgress,blockingPlayer:t,blockingCard:"Banker",responses:{[t]:u}},l;if(r.type==="challenge"&&n.actionInProgress.blockingPlayer!==void 0){const g=n.players[n.actionInProgress.blockingPlayer];if(pe.hasCardType(n.cards,g.id,"Banker")){const y=n.cards.find(v=>v.playerId===g.id&&v.location==="player"&&!v.revealed&&v.name==="Banker");if(y){const v=pe.revealCard(n.cards,y.id),E=pe.replaceCard(v,y.id);l.cards=E}l.logs=[ce.createLog("challenge-fail",e,{target:g.name,targetColor:g.color,targetId:n.actionInProgress.blockingPlayer,card:"Banker",message:J.challenges.fail("Banker"),playerId:t})],l.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:f,revealedBankerCardId:y==null?void 0:y.id}}else l.logs=[ce.createLog("challenge-success",e,{target:g.name,targetColor:g.color,targetId:n.actionInProgress.blockingPlayer,card:"Banker",message:J.challenges.success("Banker"),playerId:t})],l.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.blockingPlayer,challengeInProgress:!0,responses:f};return l}if(r.type==="allow"){if(l.actionInProgress={...n.actionInProgress,responses:f},n.actionInProgress.blockingPlayer!==void 0){if(t===n.actionInProgress.player){const E=n.players[n.actionInProgress.blockingPlayer];l.logs=[ce.createLog("allow",e,{target:E.name,targetColor:E.color,targetId:n.actionInProgress.blockingPlayer,actionType:"block",message:J.responses.allowBlock,playerId:t})],l.logs.push(ce.createSpecificSystemLog("foreignAidBlocked",{})),l.actionInProgress=null;const S=it(n.players,n.currentTurn);return l.currentTurn=S.currentTurn,l.actionUsedThisTurn=S.actionUsedThisTurn,l}return n.players.filter((E,S)=>!E.eliminated&&S!==n.actionInProgress.player&&S!==n.actionInProgress.blockingPlayer).every(E=>{const S=n.players.indexOf(E);return f[S]!==void 0}),l}const g=n.players.filter((y,v)=>v!==n.actionInProgress.player&&!y.eliminated);if(g.every(y=>{const v=n.players.indexOf(y);return f[v]!==void 0})&&!g.some(v=>{const E=n.players.indexOf(v),S=f[E];return S&&S.type==="block"})){const v=[...n.players];v[n.actionInProgress.player].coins+=2,l.logs=[ce.createSystemLog(J.responses.allowForeignAid)],l.logs.push(ce.createLog("foreign-aid",a,{coins:2,message:J.results.foreignAid,playerId:n.actionInProgress.player})),l.players=v,l.actionInProgress=null;const E=it(v,n.currentTurn);l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn}return l}return l}},CM={execute:async({player:n,playerId:e})=>{if(n.eliminated)throw new Error("Eliminated players cannot perform actions");if(n.coins<0)throw new Error("Player does not have enough coins");return{logs:[ce.createLog("banker",n,{message:J.actions.tax,playerId:e})],actionInProgress:{type:"banker",player:e,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!n.actionInProgress)return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l={},u=r.card?{type:r.type,card:r.card}:{type:r.type},f={...n.actionInProgress.responses,[t]:u};if(r.type==="lose_influence"){const g=pe.getPlayerCards(n.cards,e.id);if(g.length===0){const E=[...n.players];E[t].eliminated=!0,l.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))],l.players=E,l.actionInProgress=null;const S=it(E,n.currentTurn);return l.currentTurn=S.currentTurn,l.actionUsedThisTurn=S.actionUsedThisTurn,l}let p=r.card?g.find(E=>E.name===r.card):g[0];p||(p=g[0]);const y=pe.revealCard(n.cards,p.id);if(l.cards=y,l.logs=[ce.createLog("lose-influence",e,{playerId:t})],pe.getPlayerCards(y,e.id).length===0){const E=[...n.players];E[t].eliminated=!0,l.players=E,l.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(t===n.actionInProgress.player){l.actionInProgress=null;const E=it(n.players,n.currentTurn);l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn}else if(t!==n.actionInProgress.player&&n.actionInProgress.losingPlayer===t){const E=[...n.players];E[n.actionInProgress.player].coins+=3,l.logs.push(ce.createLog("banker",a,{coins:3,message:J.results.tax,playerId:n.actionInProgress.player})),l.players=E,l.actionInProgress=null;const S=it(E,n.currentTurn);l.currentTurn=S.currentTurn,l.actionUsedThisTurn=S.actionUsedThisTurn}else if(t===n.actionInProgress.player&&n.actionInProgress.challengeInProgress&&n.actionInProgress.challengeDefense){const E=[...n.players];E[n.actionInProgress.player].coins+=3,l.logs.push(ce.createLog("banker",a,{coins:3,message:J.results.tax,playerId:n.actionInProgress.player})),l.players=E,l.actionInProgress=null;const S=it(E,n.currentTurn);l.currentTurn=S.currentTurn,l.actionUsedThisTurn=S.actionUsedThisTurn}return l}if(r.type==="challenge"){const g=n.players[n.actionInProgress.player];if(pe.hasCardType(n.cards,g.id,"Banker")){const y=n.cards.find(v=>v.playerId===g.id&&v.location==="player"&&!v.revealed&&v.name==="Banker");if(y){const v=pe.revealCard(n.cards,y.id),E=pe.replaceCard(v,y.id);l.cards=E}l.logs=[ce.createLog("challenge-fail",e,{target:g.name,targetColor:g.color,targetId:n.actionInProgress.player,card:"Banker",message:J.challenges.fail("Banker"),playerId:t})],l.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:f,revealedBankerCardId:y==null?void 0:y.id}}else l.logs=[ce.createLog("challenge-success",e,{target:g.name,targetColor:g.color,targetId:n.actionInProgress.player,card:"Banker",message:J.challenges.success("Banker"),playerId:t})],l.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.player,challengeInProgress:!0,responses:f};return l}if(r.type==="allow"){l.actionInProgress={...n.actionInProgress,responses:f};const g=n.players.filter((v,E)=>E!==n.actionInProgress.player&&!v.eliminated);if(g.every(v=>{const E=n.players.indexOf(v);return f[E]!==void 0})&&g.every(v=>{const E=n.players.indexOf(v),S=f[E];return S&&S.type==="allow"})){const v=[...n.players];v[n.actionInProgress.player].coins+=3,l.logs=[ce.createSystemLog(J.responses.allowTax)],l.logs.push(ce.createLog("banker",a,{coins:3,message:J.results.tax,playerId:n.actionInProgress.player})),l.players=v,l.actionInProgress=null;const E=it(n.players,n.currentTurn);l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn}return l}return l}},AM={execute:async({game:n,player:e,playerId:t})=>{var u;if(e.eliminated)throw new Error("Eliminated players cannot perform actions");if(((u=n.actionInProgress)==null?void 0:u.target)===void 0)throw new Error("Hack requires a target");const r=n.players[n.actionInProgress.target];if(r.eliminated)throw new Error("Cannot target an eliminated player");if(e.coins<3)throw new Error("Hack requires 3 coins");const a=[...n.players];return a[t].coins-=3,{players:a,logs:[ce.createLog("hack",e,{target:r.name,targetColor:r.color,targetId:n.actionInProgress.target,message:J.actions.hack,playerId:t})],actionInProgress:{type:"hack",player:t,target:n.actionInProgress.target,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!(n!=null&&n.actionInProgress))return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l=n.players[n.actionInProgress.target??0],u={},f=r.card?{type:r.type,card:r.card}:{type:r.type},g={...n.actionInProgress.responses,[t]:f};if(r.type==="lose_influence"){const p=pe.getPlayerCards(n.cards,e.id);if(p.length===0){const D=[...n.players];D[t].eliminated=!0,u.logs=[ce.createSystemLog(J.system.playerEliminated(e.name),t)],u.players=D,u.actionInProgress=null;const j=it(D,n.currentTurn);return u.currentTurn=j.currentTurn,u.actionUsedThisTurn=j.actionUsedThisTurn,u}let y=r.card?p.find(D=>D.name===r.card):p[0];y||(y=p[0]);const v=pe.revealCard(n.cards,y.id);u.cards=v,u.logs=[ce.createLog("lose-influence",e,{playerId:t})];const E=pe.getPlayerCards(v,e.id);if(n.actionInProgress.loseTwo&&E.length>0&&t===n.actionInProgress.losingPlayer){u.actionInProgress={...n.actionInProgress,responses:{}};const D=n.players[n.actionInProgress.player];return u.logs.push(ce.createLog("hack",D,{target:e.name,targetColor:e.color,targetId:t,coins:1,message:J.results.hack,playerId:n.actionInProgress.player})),u.logs.push(ce.createSystemLog(J.system.secondCardRequired(e.name),t)),u}if(E.length===0){const D=[...n.players];D[t].eliminated=!0,u.players=D,u.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(n.actionInProgress.challengeDefense&&n.actionInProgress.blockingPlayer!==void 0&&n.actionInProgress.blockingCard==="Judge"&&t===n.actionInProgress.losingPlayer&&n.actionInProgress.revealedJudgeCardId&&u.logs.push(ce.createSpecificSystemLog("hackBlocked",{})),n.actionInProgress.loseTwo&&t===n.actionInProgress.losingPlayer&&!n.actionInProgress.cardsLostCounter?u.actionInProgress={...n.actionInProgress,cardsLostCounter:1}:n.actionInProgress.loseTwo&&t===n.actionInProgress.losingPlayer&&n.actionInProgress.cardsLostCounter===1&&(u.actionInProgress={...n.actionInProgress,loseTwo:!1,cardsLostCounter:void 0}),n.actionInProgress.blockingPlayer===t){const D=n.actionInProgress.target??0;if(!n.players[D].eliminated)return u.actionInProgress={...n.actionInProgress,challengeInProgress:!1,losingPlayer:D,responses:{}},u.players=n.players,u}else if(n.actionInProgress.losingPlayer===t&&t!==n.actionInProgress.player){if(n.actionInProgress.blockingPlayer!==void 0){u.logs.push(ce.createSystemLog(J.system.hackBlocked)),u.actionInProgress=null;const D=it(n.players,n.currentTurn);return u.currentTurn=D.currentTurn,u.actionUsedThisTurn=D.actionUsedThisTurn,u}if(t!==n.actionInProgress.target){const{losingPlayer:D,challengeDefense:j,challengeInProgress:k,loseTwo:P,...z}=n.actionInProgress;return u.actionInProgress={...z,losingPlayer:n.actionInProgress.target,responses:{}},u.logs.push(ce.createLog("hack",a,{target:l.name,targetColor:l.color,targetId:n.actionInProgress.target,coins:1,message:J.results.hack,playerId:n.actionInProgress.player})),u.players=n.players,u}}u.actionInProgress=null;const S=it(n.players,n.currentTurn);return u.currentTurn=S.currentTurn,u.actionUsedThisTurn=S.actionUsedThisTurn,u}if(r.type==="block"&&r.card==="Judge"){if(t!==n.actionInProgress.target)throw new Error("Only the target can block an hack");return u.logs=[ce.createLog("block",e,{target:a.name,targetColor:a.color,targetId:n.actionInProgress.player,card:"Judge",message:J.blocks.judge,playerId:t})],u.actionInProgress={...n.actionInProgress,blockingPlayer:t,blockingCard:"Judge",responses:{[t]:f}},u}if(r.type==="challenge"&&n.actionInProgress.blockingPlayer===void 0){if(pe.hasCardType(n.cards,a.id,"Hacker")){const y=n.cards.find(v=>v.playerId===a.id&&v.location==="player"&&!v.revealed&&v.name==="Hacker");if(y){const v=pe.revealCard(n.cards,y.id),E=pe.replaceCard(v,y.id);u.cards=E}u.logs=[ce.createLog("challenge-fail",e,{target:a.name,targetColor:a.color,targetId:n.actionInProgress.player,card:"Hacker",message:J.challenges.fail("Hacker"),playerId:t})],u.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:g,revealedHackerCardId:y==null?void 0:y.id,loseTwo:t===n.actionInProgress.target}}else u.logs=[ce.createLog("challenge-success",e,{target:a.name,targetColor:a.color,targetId:n.actionInProgress.player,card:"Hacker",message:J.challenges.success("Hacker"),playerId:t})],u.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.player,challengeInProgress:!0,responses:g};return u}else if(r.type==="challenge"&&n.actionInProgress.blockingPlayer!==void 0){const p=n.players[n.actionInProgress.blockingPlayer];if(pe.hasCardType(n.cards,p.id,"Judge")){const v=n.cards.find(E=>E.playerId===p.id&&E.location==="player"&&!E.revealed&&E.name==="Judge");if(v){const E=pe.revealCard(n.cards,v.id),S=pe.replaceCard(E,v.id);u.cards=S}u.logs=[ce.createLog("challenge-fail",e,{target:l.name,targetColor:l.color,targetId:n.actionInProgress.target,card:"Judge",message:J.challenges.fail("Judge"),playerId:t})],u.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:g,revealedJudgeCardId:v==null?void 0:v.id,loseTwo:!1}}else u.logs=[ce.createLog("challenge-success",e,{target:l.name,targetColor:l.color,targetId:n.actionInProgress.target,card:"Judge",message:J.challenges.success("Judge"),playerId:t})],u.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.blockingPlayer,challengeInProgress:!0,responses:g,loseTwo:!0};return u}if(r.type==="allow"){if(u.actionInProgress={...n.actionInProgress,responses:g},n.actionInProgress.blockingPlayer!==void 0){if(t===n.actionInProgress.player){const y=n.players[n.actionInProgress.blockingPlayer];u.logs=[ce.createLog("allow",e,{target:y.name,targetColor:y.color,targetId:n.actionInProgress.blockingPlayer,actionType:"block",message:J.responses.allowBlock,playerId:t})],u.logs.push(ce.createSpecificSystemLog("hackBlocked",{})),u.actionInProgress=null;const v=it(n.players,n.currentTurn);return u.currentTurn=v.currentTurn,u.actionUsedThisTurn=v.actionUsedThisTurn,u}return u}return g[n.actionInProgress.target]!==void 0&&g[n.actionInProgress.target].type==="allow"&&(u.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.target},u.logs=[ce.createLog("allow",l,{target:a.name,targetColor:a.color,targetId:n.actionInProgress.player,actionType:"hack",message:J.responses.allowHack,playerId:n.actionInProgress.target})],u.logs.push(ce.createLog("hack",a,{target:l.name,targetColor:l.color,targetId:n.actionInProgress.target,coins:1,message:J.results.hack,playerId:n.actionInProgress.player}))),u}return u}},IM={execute:async({game:n,player:e,playerId:t})=>{var l;if(e.eliminated)throw new Error("Eliminated players cannot perform actions");if(((l=n.actionInProgress)==null?void 0:l.target)===void 0)throw new Error("Steal requires a target");const r=n.players[n.actionInProgress.target];if(r.eliminated)throw new Error("Cannot target an eliminated player");return{logs:[ce.createLog("steal",e,{target:r.name,targetColor:r.color,targetId:n.actionInProgress.target,message:J.actions.steal,playerId:t})],actionInProgress:{type:"steal",player:t,target:n.actionInProgress.target,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!(n!=null&&n.actionInProgress))return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l=n.players[n.actionInProgress.target??0],u={},f=r.card?{type:r.type,card:r.card}:{type:r.type},g={...n.actionInProgress.responses,[t]:f};if(r.type==="lose_influence"){const p=pe.getPlayerCards(n.cards,e.id);if(p.length===0){const D=[...n.players];D[t].eliminated=!0,u.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))],u.players=D,u.actionInProgress=null;const j=it(D,n.currentTurn);return u.currentTurn=j.currentTurn,u.actionUsedThisTurn=j.actionUsedThisTurn,u}let y=r.card?p.find(D=>D.name===r.card):p[0];y||(y=p[0]);const v=pe.revealCard(n.cards,y.id);if(u.cards=v,u.logs=[ce.createLog("lose-influence",e,{playerId:t})],pe.getPlayerCards(v,e.id).length===0){const D=[...n.players];D[t].eliminated=!0,u.players=D,u.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(n.actionInProgress.blockingPlayer===t){const D=Math.min(l.coins,2),j=[...n.players];j[n.actionInProgress.target??0].coins-=D,j[n.actionInProgress.player].coins+=D;const k={type:"steal",player:a.name,playerColor:a.color,timestamp:Date.now(),playerId:n.actionInProgress.player,targetId:n.actionInProgress.target??0,target:l.name,targetColor:l.color,coins:D,message:`steals $${D}M from ${l.name}`,messageParts:[{type:"text",content:`steals $${D}M from `},{type:"player",content:l.name,playerId:n.actionInProgress.target??0,color:l.color}]};u.logs.push(k),u.players=j}else if(n.actionInProgress.losingPlayer===t&&t!==n.actionInProgress.player){if(n.actionInProgress.blockingPlayer!==void 0){n.actionInProgress.challengeDefense&&u.logs.push(ce.createSystemLog(J.system.stealBlocked)),u.actionInProgress=null;const P=it(n.players,n.currentTurn);return u.currentTurn=P.currentTurn,u.actionUsedThisTurn=P.actionUsedThisTurn,u}if(t!==n.actionInProgress.target){const P=Math.min(l.coins,2),z=n.actionInProgress.target??0,U=[...n.players];U[z].coins-=P,U[n.actionInProgress.player].coins+=P;const W={type:"steal",player:a.name,playerColor:a.color,timestamp:Date.now(),playerId:n.actionInProgress.player,targetId:z,target:l.name,targetColor:l.color,coins:P,message:`steals $${P}M from ${l.name}`,messageParts:[{type:"text",content:`steals $${P}M from `},{type:"player",content:l.name,playerId:z,color:l.color}]};u.logs.push(W),u.players=U,u.actionInProgress=null;const ne=it(n.players,n.currentTurn);return u.currentTurn=ne.currentTurn,u.actionUsedThisTurn=ne.actionUsedThisTurn,u}const D=Math.min(l.coins,2),j=[...n.players];j[n.actionInProgress.target??0].coins-=D,j[n.actionInProgress.player].coins+=D;const k={type:"steal",player:a.name,playerColor:a.color,timestamp:Date.now(),playerId:n.actionInProgress.player,targetId:n.actionInProgress.target??0,target:l.name,targetColor:l.color,coins:D,message:`steals $${D}M from ${l.name}`,messageParts:[{type:"text",content:`steals $${D}M from `},{type:"player",content:l.name,playerId:n.actionInProgress.target??0,color:l.color}]};u.logs.push(k),u.players=j}u.actionInProgress=null;const S=it(n.players,n.currentTurn);return u.currentTurn=S.currentTurn,u.actionUsedThisTurn=S.actionUsedThisTurn,u}if(r.type==="block"){if(!r.card||!["Mafia","Reporter","Police"].includes(r.card))throw new Error("Must block with Mafia, Reporter, or Police");if(t!==n.actionInProgress.target)throw new Error("Only the target can block a steal");const p=r.card==="Mafia"?J.blocks.mafia:r.card==="Reporter"?J.blocks.reporter:J.blocks.police;return u.logs=[ce.createLog("block",e,{target:a.name,targetColor:a.color,card:r.card,message:p})],u.actionInProgress={...n.actionInProgress,blockingPlayer:t,blockingCard:r.card,responses:{[t]:f}},u}if(r.type==="challenge"&&n.actionInProgress.blockingPlayer===void 0){if(pe.hasCardType(n.cards,a.id,"Mafia")){const y=n.cards.find(v=>v.playerId===a.id&&v.location==="player"&&!v.revealed&&v.name==="Mafia");if(y){const v=pe.revealCard(n.cards,y.id),E=pe.replaceCard(v,y.id);u.cards=E}u.logs=[ce.createLog("challenge-fail",e,{target:a.name,targetColor:a.color,card:"Mafia",message:J.challenges.fail("Mafia")})],u.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:g,revealedMafiaCardId:y==null?void 0:y.id}}else u.logs=[ce.createLog("challenge-success",e,{target:a.name,targetColor:a.color,card:"Mafia",message:J.challenges.success("Mafia")})],u.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.player,challengeInProgress:!0,responses:g};return u}else if(r.type==="challenge"&&n.actionInProgress.blockingPlayer!==void 0){const p=n.players[n.actionInProgress.blockingPlayer],y=n.actionInProgress.blockingCard;if(pe.hasCardType(n.cards,p.id,y)){const E=n.cards.find(S=>S.playerId===p.id&&S.location==="player"&&!S.revealed&&S.name===y);if(E){const S=pe.revealCard(n.cards,E.id),D=pe.replaceCard(S,E.id);u.cards=D}u.logs=[ce.createLog("challenge-fail",e,{target:p.name,targetColor:p.color,card:y,message:J.challenges.fail(y)})],u.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:g,revealedBlockingCardId:E==null?void 0:E.id}}else u.logs=[ce.createLog("challenge-success",e,{target:p.name,targetColor:p.color,card:y,message:J.challenges.success(y)})],u.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.blockingPlayer,challengeInProgress:!0,responses:g};return u}if(r.type==="allow"){if(u.actionInProgress={...n.actionInProgress,responses:g},n.actionInProgress.blockingPlayer!==void 0){if(t===n.actionInProgress.player){const E=n.players[n.actionInProgress.blockingPlayer];u.logs=[ce.createLog("allow",e,{target:E.name,targetColor:E.color,targetId:n.actionInProgress.blockingPlayer,actionType:"block",message:J.responses.allowBlock})],u.logs.push(ce.createSpecificSystemLog("stealBlocked",{})),u.actionInProgress=null;const S=it(n.players,n.currentTurn);return u.currentTurn=S.currentTurn,u.actionUsedThisTurn=S.actionUsedThisTurn,u}return u}if(t===n.actionInProgress.target){const E=[...n.players],S=n.actionInProgress.target??0,D=Math.min(E[S].coins,2);E[S].coins-=D,E[n.actionInProgress.player].coins+=D,u.logs=[ce.createLog("allow",e,{target:a.name,targetColor:a.color,actionType:"steal",message:J.responses.allowSteal})];const j={type:"steal",player:a.name,playerColor:a.color,timestamp:Date.now(),playerId:n.actionInProgress.player,targetId:S,target:l.name,targetColor:l.color,coins:D,message:`steals $${D}M from ${l.name}`,messageParts:[{type:"text",content:`steals $${D}M from `},{type:"player",content:l.name,playerId:S,color:l.color}]};u.logs.push(j),u.players=E,u.actionInProgress=null;const k=it(E,n.currentTurn);return u.currentTurn=k.currentTurn,u.actionUsedThisTurn=k.actionUsedThisTurn,u}const p=n.players.filter(E=>E.id!==n.actionInProgress.player+1&&E.id!==(n.actionInProgress.target??-1)+1&&!E.eliminated);if((n.actionInProgress.target===void 0||g[n.actionInProgress.target]!==void 0)&&p.every(E=>g[E.id-1]!==void 0)&&!Object.values(g).some(S=>S.type==="block")){const S=[...n.players],D=n.actionInProgress.target??0,j=Math.min(S[D].coins,2);S[D].coins-=j,S[n.actionInProgress.player].coins+=j;const k={type:"steal",player:a.name,playerColor:a.color,timestamp:Date.now(),playerId:n.actionInProgress.player,targetId:D,target:l.name,targetColor:l.color,coins:j,message:`steals $${j}M from ${l.name}`,messageParts:[{type:"text",content:`steals $${j}M from `},{type:"player",content:l.name,playerId:D,color:l.color}]};u.logs=[k],u.players=S,u.actionInProgress=null;const P=it(S,n.currentTurn);u.currentTurn=P.currentTurn,u.actionUsedThisTurn=P.actionUsedThisTurn}return u}return u}},RM={execute:async({player:n,playerId:e})=>{if(n.eliminated)throw new Error("Eliminated players cannot perform actions");return{logs:[ce.createLog("exchange",n,{message:J.actions.exchange,playerId:e})],actionInProgress:{type:"exchange",player:e,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!(n!=null&&n.actionInProgress))return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l={};if(r.type==="exchange_selection"&&r.selectedIndices){if(t!==n.actionInProgress.player)throw new Error("Only the player who initiated the exchange can select cards");if(!n.actionInProgress.exchangeCards)throw new Error("No exchange cards available");const g=pe.getPlayerCards(n.cards,a.id),p=n.cards.filter(U=>n.actionInProgress.exchangeCards.includes(U.id)),y=[...g,...p];if(r.selectedIndices.length!==g.length)throw new Error(`Must select ${g.length} cards to keep`);const v=r.selectedIndices.map(U=>y[U].id),E=y.filter(U=>!v.includes(U.id)).map(U=>U.id);let S=[...n.cards];const D=g.map(U=>U.id),j=v.filter(U=>!D.includes(U)),k=v.filter(U=>D.includes(U));k.forEach(U=>{const W=S.findIndex(ne=>ne.id===U);W!==-1&&(S[W]={...S[W],playerId:a.id,location:"player"})});const P=[0,1].filter(U=>!S.some(W=>W.playerId===a.id&&W.location==="player"&&!W.revealed&&k.includes(W.id)&&W.position===U));j.forEach((U,W)=>{if(W<P.length){const ne=S.findIndex(re=>re.id===U);ne!==-1&&(S[ne]={...S[ne],playerId:a.id,location:"player",position:P[W]})}}),S=pe.returnCardsToDeck(S,E),l.logs=[ce.createLog("exchange-complete",e,{message:J.results.exchange,playerId:t})],l.cards=S,l.actionInProgress=null;const z=it(n.players,n.currentTurn);return l.currentTurn=z.currentTurn,l.actionUsedThisTurn=z.actionUsedThisTurn,l}const u=r.card?{type:r.type,card:r.card}:{type:r.type},f={...n.actionInProgress.responses,[t]:u};if(r.type==="lose_influence"){const g=pe.getPlayerCards(n.cards,e.id);if(g.length===0){const S=[...n.players];S[t].eliminated=!0,l.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))],l.players=S,l.actionInProgress=null;const D=it(S,n.currentTurn);return l.currentTurn=D.currentTurn,l.actionUsedThisTurn=D.actionUsedThisTurn,l}let p=r.card?g.find(S=>S.name===r.card):g[0];p||(p=g[0]);const y=pe.revealCard(n.cards,p.id);if(l.cards=y,l.logs=[ce.createLog("lose-influence",e,{playerId:t})],pe.getPlayerCards(y,e.id).length===0){const S=[...n.players];S[t].eliminated=!0,l.players=S,l.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(n.actionInProgress.losingPlayer!==void 0&&n.actionInProgress.losingPlayer!==n.actionInProgress.player&&t===n.actionInProgress.player&&n.actionInProgress.challengeDefense){const S=pe.drawCards(y,2,"exchange"),D=S.filter(U=>U.location==="exchange").map(U=>U.id);l.logs.push(ce.createSpecificSystemLog("exchangeSelecting",{playerName:a.name}));const{losingPlayer:j,challengeInProgress:k,challengeDefense:P,...z}=n.actionInProgress;return l.actionInProgress={...z,exchangeCards:D,responses:{}},l.cards=S,l}if(n.actionInProgress.losingPlayer===t&&t!==n.actionInProgress.player){const S=pe.drawCards(y,2,"exchange"),D=S.filter(j=>j.location==="exchange").map(j=>j.id);return l.logs.push(ce.createSpecificSystemLog("exchangeSelecting",{playerName:a.name})),l.actionInProgress={type:n.actionInProgress.type,player:n.actionInProgress.player,exchangeCards:D,responses:{},resolved:!1},l.cards=S,l}l.actionInProgress=null;const E=it(n.players,n.currentTurn);return l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn,l}if(r.type==="challenge"){if(pe.hasCardType(n.cards,a.id,"Reporter")){const p=n.cards.find(y=>y.playerId===a.id&&y.location==="player"&&!y.revealed&&y.name==="Reporter");if(p){const y=pe.revealCard(n.cards,p.id),v=pe.replaceCard(y,p.id);l.cards=v}l.logs=[ce.createLog("challenge-fail",e,{target:a.name,targetColor:a.color,message:J.challenges.fail("Reporter")})],l.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,responses:f,revealedReporterCardId:p==null?void 0:p.id}}else l.logs=[ce.createLog("challenge-success",e,{target:a.name,targetColor:a.color,message:J.challenges.success("Reporter")})],l.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.player,challengeInProgress:!0,responses:f};return l}if(r.type==="allow"){l.actionInProgress={...n.actionInProgress,responses:f};const g=n.players.filter((v,E)=>E!==n.actionInProgress.player&&!v.eliminated);if(g.every(v=>{const E=n.players.indexOf(v);return f[E]!==void 0})&&g.every(v=>{const E=n.players.indexOf(v),S=f[E];return S&&S.type==="allow"})){const v=pe.drawCards(n.cards,2,"exchange"),E=v.filter(S=>S.location==="exchange").map(S=>S.id);l.logs=[ce.createSystemLog(J.responses.allowExchange)],l.logs.push(ce.createSpecificSystemLog("exchangeSelecting",{playerName:a.name})),l.actionInProgress={...n.actionInProgress,exchangeCards:E,responses:{}},l.cards=v}return l}return l}},NM={execute:async({game:n,player:e,playerId:t})=>{var p;if(e.eliminated)throw new Error("Eliminated players cannot perform actions");if(((p=n.actionInProgress)==null?void 0:p.target)===void 0)throw new Error("Scandal requires a target");if(e.coins<7)throw new Error("Scandal requires $7M");const r=n.actionInProgress.target,a=n.players[r];if(!a)throw new Error("Target player not found");if(a.eliminated)throw new Error("Cannot target an eliminated player");const l=a.id,u=pe.getPlayerCards(n.cards,l);if(!u||u.length===0)throw new Error("Target player has no influence to lose");const f=[...n.players];return f[t].coins-=7,{players:f,logs:[ce.createLog("scandal",e,{target:a.name,targetColor:a.color,targetId:r,coins:e.coins+7,message:J.actions.scandal(e.coins+7),playerId:t})],actionInProgress:{type:"scandal",player:t,target:r,losingPlayer:r,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!(n!=null&&n.actionInProgress))return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a={};if(r.type==="lose_influence"){if(t!==n.actionInProgress.target)throw new Error("Only the target can lose influence from a scandal");const l=pe.getPlayerCards(n.cards,e.id);if(l.length===0){const y=[...n.players];y[t].eliminated=!0,a.players=y,a.actionInProgress=null,a.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))];const v=it(y,n.currentTurn);return a.currentTurn=v.currentTurn,a.actionUsedThisTurn=v.actionUsedThisTurn,a}let u=r.card?l.find(y=>y.name===r.card):l[0];u||(u=l[0]);const f=pe.revealCard(n.cards,u.id);if(a.cards=f,a.logs=[ce.createLog("lose-influence",e,{playerId:t})],pe.getPlayerCards(f,e.id).length===0){const y=[...n.players];y[t].eliminated=!0,a.players=y,a.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name),t))}a.actionInProgress=null;const p=it(n.players,n.currentTurn);a.currentTurn=p.currentTurn,a.actionUsedThisTurn=p.actionUsedThisTurn}else throw new Error("Invalid response type for scandal action");return a}},PM={execute:async({game:n,player:e,playerId:t})=>{var f;if(e.eliminated)throw new Error("Eliminated players cannot perform actions");const r=(f=n.actionInProgress)==null?void 0:f.target;if(r===void 0)throw new Error("Investigate requires a target");if(n.players[r].eliminated)throw new Error("Cannot investigate an eliminated player");const a=n.players[r];if(pe.getPlayerCards(n.cards,a.id).length===0)throw new Error("Target player has no cards to investigate");return{logs:[ce.createLog("investigate",e,{target:a.name,targetColor:a.color,targetId:r,message:J.actions.investigate,playerId:t})],actionInProgress:{type:"investigate",player:t,target:r,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!(n!=null&&n.actionInProgress))return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l={};if(r.type==="select_card_for_investigation"&&r.card){if(t!==n.actionInProgress.target)throw new Error("Only the targeted player can select a card for investigation");const p=pe.getPlayerCards(n.cards,e.id).find(E=>E.name===r.card);if(!p)throw new Error("Selected card not found or already revealed");const y=n.players[n.actionInProgress.player],v={type:"show-card",player:e.name,playerColor:e.color,timestamp:Date.now(),playerId:t,targetId:n.actionInProgress.player,target:y.name,targetColor:y.color,message:`${J.results.showCard} ${y.name}`,messageParts:[{type:"text",content:`${J.results.showCard} `},{type:"player",content:y.name,playerId:n.actionInProgress.player,color:y.color}]};return l.logs=[v],l.logs.push(ce.createSpecificSystemLog("decideInvestigation",{playerName:y.name})),l.actionInProgress={...n.actionInProgress,investigateCard:{cardId:p.id,cardIndex:n.cards.indexOf(p)}},l}if(r.type==="investigate_decision"&&t===n.actionInProgress.player){if(!n.actionInProgress.investigateCard)throw new Error("No card has been selected for investigation");const g=n.actionInProgress.target,p=n.players[g],y=n.actionInProgress.investigateCard;if(r.keepCard===!0){const S={type:"investigate-result",player:e.name,playerColor:e.color,timestamp:Date.now(),playerId:t,targetId:g,target:p.name,targetColor:p.color,message:`${J.results.investigateKeep} ${p.name} ${J.results.investigateKeepSuffix}`,messageParts:[{type:"text",content:`${J.results.investigateKeep} `},{type:"player",content:p.name,playerId:g,color:p.color},{type:"text",content:` ${J.results.investigateKeepSuffix}`}]};l.logs=[S]}else{const S=pe.drawCards(n.cards,1,"investigate"),D=S.find(U=>U.location==="investigate"),j=pe.returnCardsToDeck(S,[y.cardId]),k=n.cards[y.cardIndex].position,P=j.map(U=>D&&U.id===D.id?{...U,playerId:p.id,location:"player",revealed:!1,position:k}:U);l.cards=P;const z={type:"investigate-result",player:e.name,playerColor:e.color,timestamp:Date.now(),playerId:t,targetId:g,target:p.name,targetColor:p.color,message:`${J.results.investigateSwap} ${p.name} ${J.results.investigateSwapSuffix}`,messageParts:[{type:"text",content:`${J.results.investigateSwap} `},{type:"player",content:p.name,playerId:g,color:p.color},{type:"text",content:` ${J.results.investigateSwapSuffix}`}]};l.logs=[z]}l.actionInProgress=null;const E=it(n.players,n.currentTurn);return l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn,l}const u=r.card?{type:r.type,card:r.card}:{type:r.type},f={...n.actionInProgress.responses,[t]:u};if(r.type==="lose_influence"){const g=pe.getPlayerCards(n.cards,e.id);if(g.length===0){const S=[...n.players];S[t].eliminated=!0,l.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))],l.players=S,l.actionInProgress=null;const D=it(S,n.currentTurn);return l.currentTurn=D.currentTurn,l.actionUsedThisTurn=D.actionUsedThisTurn,l}let p=r.card?g.find(S=>S.name===r.card):g[0];p||(p=g[0]);const y=pe.revealCard(n.cards,p.id);if(l.cards=y,l.logs=[ce.createLog("lose-influence",e)],pe.getPlayerCards(y,e.id).length===0){const S=[...n.players];S[t].eliminated=!0,l.players=S,l.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(n.actionInProgress.losingPlayer!==void 0&&n.actionInProgress.losingPlayer!==n.actionInProgress.player&&t===n.actionInProgress.player&&n.actionInProgress.challengeDefense)return l.actionInProgress={type:"investigate",player:n.actionInProgress.player,target:n.actionInProgress.target,responses:{[n.actionInProgress.target]:{type:"allow"}},resolved:!1},l;if(n.actionInProgress.losingPlayer===t&&t!==n.actionInProgress.player){const S=n.players[n.actionInProgress.target??0];if(!(pe.getPlayerCards(y,S.id).length>0)){l.logs.push(ce.createSystemLog(J.system.playerEliminated(S.name))),l.actionInProgress=null;const k=it(n.players,n.currentTurn);return l.currentTurn=k.currentTurn,l.actionUsedThisTurn=k.actionUsedThisTurn,l}return l.logs.push(ce.createSpecificSystemLog("selectCardToShow",{playerName:S.name})),l.actionInProgress={type:n.actionInProgress.type,player:n.actionInProgress.player,target:n.actionInProgress.target,responses:{[n.actionInProgress.target]:{type:"allow"}},resolved:!1},l}l.actionInProgress=null;const E=it(n.players,n.currentTurn);return l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn,l}if(r.type==="challenge"){if(pe.hasCardType(n.cards,a.id,"Police")){const p=n.cards.find(y=>y.playerId===a.id&&y.location==="player"&&!y.revealed&&y.name==="Police");if(p){const y=pe.revealCard(n.cards,p.id),v=pe.replaceCard(y,p.id);l.cards=v}l.logs=[ce.createLog("challenge-fail",e,{target:a.name,targetColor:a.color,message:J.challenges.fail("Police")})],l.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,revealedPoliceCardId:p==null?void 0:p.id,responses:f}}else l.logs=[ce.createLog("challenge-success",e,{target:a.name,targetColor:a.color,message:J.challenges.success("Police")})],l.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.player,challengeInProgress:!0,responses:f};return l}return r.type==="allow"?(l.actionInProgress={...n.actionInProgress,responses:f},t===n.actionInProgress.target&&(l.logs=[ce.createLog("allow",e,{target:a.name,targetColor:a.color,targetId:n.actionInProgress.player,actionType:"investigate",message:J.responses.allowInvestigation,playerId:t})],l.logs.push(ce.createSpecificSystemLog("selectCardToShow",{playerName:e.name,playerId:t})),l.actionInProgress={...n.actionInProgress,responses:{[t]:{type:"allow"}}}),l):l}},kM={execute:async({player:n,playerId:e})=>{if(n.eliminated)throw new Error("Eliminated players cannot perform actions");return{logs:[ce.createLog("swap",n,{message:J.actions.swap,playerId:e})],actionInProgress:{type:"swap",player:e,responses:{},resolved:!1}}},respond:async({game:n,player:e,playerId:t},r)=>{if(!(n!=null&&n.actionInProgress))return{};if(e.eliminated)throw new Error("Eliminated players cannot respond to actions");const a=n.players[n.actionInProgress.player],l={};if(r.type==="exchange_selection"&&r.selectedIndices){if(t!==n.actionInProgress.player)throw new Error("Only the player who initiated the swap can select cards");if(!n.actionInProgress.exchangeCards)throw new Error("No swap cards available");const g=pe.getPlayerCards(n.cards,a.id),p=n.cards.filter(U=>n.actionInProgress.exchangeCards.includes(U.id)),y=[...g,...p];if(r.selectedIndices.length!==g.length)throw new Error(`Must select ${g.length} cards to keep`);const v=r.selectedIndices.map(U=>y[U].id),E=y.filter(U=>!v.includes(U.id)).map(U=>U.id);let S=[...n.cards];const D=g.map(U=>U.id),j=v.filter(U=>!D.includes(U)),k=v.filter(U=>D.includes(U));k.forEach(U=>{const W=S.findIndex(ne=>ne.id===U);W!==-1&&(S[W]={...S[W],playerId:a.id,location:"player"})});const P=[0,1].filter(U=>!S.some(W=>W.playerId===a.id&&W.location==="player"&&!W.revealed&&k.includes(W.id)&&W.position===U));j.forEach((U,W)=>{if(W<P.length){const ne=S.findIndex(re=>re.id===U);ne!==-1&&(S[ne]={...S[ne],playerId:a.id,location:"player",position:P[W]})}}),S=pe.returnCardsToDeck(S,E),l.logs=[ce.createLog("swap-complete",e,{message:J.results.swap,playerId:t})],l.cards=S,l.actionInProgress=null;const z=it(n.players,n.currentTurn);return l.currentTurn=z.currentTurn,l.actionUsedThisTurn=z.actionUsedThisTurn,l}const u=r.card?{type:r.type,card:r.card}:{type:r.type},f={...n.actionInProgress.responses,[t]:u};if(r.type==="lose_influence"){const g=pe.getPlayerCards(n.cards,e.id);if(g.length===0){const S=[...n.players];S[t].eliminated=!0,l.logs=[ce.createSystemLog(J.system.playerEliminated(e.name))],l.players=S,l.actionInProgress=null;const D=it(S,n.currentTurn);return l.currentTurn=D.currentTurn,l.actionUsedThisTurn=D.actionUsedThisTurn,l}let p=r.card?g.find(S=>S.name===r.card):g[0];p||(p=g[0]);const y=pe.revealCard(n.cards,p.id);if(l.cards=y,l.logs=[ce.createLog("lose-influence",e)],pe.getPlayerCards(y,e.id).length===0){const S=[...n.players];S[t].eliminated=!0,l.players=S,l.logs.push(ce.createSystemLog(J.system.playerEliminated(e.name)))}if(n.actionInProgress.losingPlayer!==void 0&&n.actionInProgress.losingPlayer!==n.actionInProgress.player&&t===n.actionInProgress.player&&n.actionInProgress.challengeDefense){const S=pe.drawCards(y,1,"exchange"),D=S.filter(U=>U.location==="exchange").map(U=>U.id);l.logs.push(ce.createSpecificSystemLog("swapAllowed",{playerName:e.name}));const{losingPlayer:j,challengeInProgress:k,challengeDefense:P,...z}=n.actionInProgress;return l.actionInProgress={...z,exchangeCards:D,responses:{}},l.cards=S,l}if(n.actionInProgress.losingPlayer===t&&t!==n.actionInProgress.player){const S=pe.drawCards(y,1,"exchange"),D=S.filter(j=>j.location==="exchange").map(j=>j.id);return l.logs.push(ce.createSpecificSystemLog("swapAllowed",{playerName:n.players[n.actionInProgress.player].name})),l.actionInProgress={type:n.actionInProgress.type,player:n.actionInProgress.player,exchangeCards:D,responses:{},resolved:!1},l.cards=S,l}l.actionInProgress=null;const E=it(n.players,n.currentTurn);return l.currentTurn=E.currentTurn,l.actionUsedThisTurn=E.actionUsedThisTurn,l}if(r.type==="challenge"){if(pe.hasCardType(n.cards,a.id,"Police")){const p=n.cards.find(y=>y.playerId===a.id&&y.location==="player"&&!y.revealed&&y.name==="Police");if(p){const y=pe.revealCard(n.cards,p.id),v=pe.replaceCard(y,p.id);l.cards=v}l.logs=[ce.createLog("challenge-fail",e,{target:a.name,targetColor:a.color,message:J.challenges.fail("Police")})],l.actionInProgress={...n.actionInProgress,losingPlayer:t,challengeInProgress:!0,challengeDefense:!0,revealedPoliceCardId:p==null?void 0:p.id,responses:f}}else l.logs=[ce.createLog("challenge-success",e,{target:a.name,targetColor:a.color,message:J.challenges.success("Police")})],l.actionInProgress={...n.actionInProgress,losingPlayer:n.actionInProgress.player,challengeInProgress:!0,responses:f};return l}if(r.type==="allow"){l.actionInProgress={...n.actionInProgress,responses:f};const g=n.players.filter((v,E)=>E!==n.actionInProgress.player&&!v.eliminated);if(g.every(v=>{const E=n.players.indexOf(v);return f[E]!==void 0})&&g.every(v=>{const E=n.players.indexOf(v),S=f[E];return S&&S.type==="allow"})){const v=pe.drawCards(n.cards,1,"exchange"),E=v.filter(S=>S.location==="exchange").map(S=>S.id);l.logs=[ce.createSystemLog(J.responses.allowSwap)],l.logs.push(ce.createSpecificSystemLog("swapAllowed",{playerName:a.name})),l.actionInProgress={...n.actionInProgress,exchangeCards:E,responses:{}},l.cards=v}return l}return l}},rb={income:EM,"foreign-aid":xM,banker:CM,hack:AM,steal:IM,exchange:RM,scandal:NM,investigate:PM,swap:kM},ib=["#E74C3C","#2ECC71","#3498DB","#F1C40F","#9B59B6","#E67E22"],DM=n=>{const e=new Set(n.map(t=>t.color));for(const t of ib)if(!e.has(t))return t;return ib[0]};function Vh(n){if(n==null)return null;const e={};for(const[t,r]of Object.entries(n))r!==void 0&&(e[t]=r);return e}function tf(n,e){const[t,r]=Ee.useState(null),[a,l]=Ee.useState(null),[u,f]=Ee.useState(!1),g=Ee.useRef(null);Ee.useEffect(()=>{if(!n)return;const P=IP(ps(_n,"games",n),z=>{if(z.exists()){const U=z.data();r(U),e!==void 0&&g.current&&g.current.some(W=>W.id===e)&&!U.players.some(W=>W.id===e)&&(console.log(`Player ${e} was removed from the game!`),f(!0)),g.current=U.players}else l("Game not found")});return()=>P()},[n,e]);const p=async()=>{var P;try{const z=JS(6),U=pe.createDeck();console.log("Creating game with ID:",z);const W=qc.currentUser;let ne=W==null?void 0:W.uid;if(!ne)try{ne=(P=(await gi.storage.local.get("user")).user)==null?void 0:P.uid,console.log("Using UID from local storage:",ne)}catch(M){console.error("Failed to get user from local storage:",M)}if(!ne)throw new Error("User not authenticated. Please sign in first.");const re={id:z,players:[],currentTurn:0,firstPlayerOfMatch:0,cards:U,logs:[ce.createSystemLog(J.system.gameCreated)],status:"waiting",actionInProgress:null,responses:{},actionUsedThisTurn:!1,createdAt:Date.now(),createdBy:ne};try{return await AP(ps(_n,"games",z),re),console.log("Game created successfully!"),z}catch(M){throw console.error("Firestore error details:",M),M}}catch(z){throw console.error("Create game error:",z),l("Failed to create game"),z}},y=async(P,z)=>{if(!P||!z)throw new Error("Invalid game ID or player data");try{const U=ps(_n,"games",P),W=await CP(U);if(!W.exists())throw new Error("Game not found");const ne=W.data();if(ne.players.length>=6)throw new Error("Game is full");if(ne.status!=="waiting")throw new Error("Game has already started");if(ne.players.some(O=>O.id===z.id))throw new Error("Player already in game");const re=ne.cards.filter(O=>O.playerId===z.id&&O.location==="player");pe.validateCardCounts(ne.cards)||(ne.cards=pe.createDeck());let M=[...ne.cards];re.length>=2?console.log(`Player ${z.id} already has ${re.length} cards, using existing cards`):re.length===0?(M=pe.dealCards(ne.cards,[z.id]),console.log(`Dealt new cards to player ${z.id}`)):(M=pe.returnCardsToDeck(ne.cards,re.map(O=>O.id)),M=pe.dealCards(M,[z.id]),console.log(`Player ${z.id} had ${re.length} card, redealt 2 new cards`));const N=DM(ne.players),I={...z,color:N};await Ks(U,{players:[...ne.players,I],cards:M,logs:fi(ce.createSystemLog(J.system.playerJoined(z.name)))})}catch(U){throw l(U instanceof Error?U.message:"Failed to join game"),U}},v=async()=>{if(n)try{const P=ps(_n,"games",n);await Ks(P,{status:"playing",actionUsedThisTurn:!1,logs:fi(ce.createSystemLog(J.system.gameStarted))})}catch(P){throw l("Failed to start game"),P}},E=async(P,z)=>{if(!t||!z||P<0||P>=t.players.length)throw new Error("Invalid action parameters");if(t.actionUsedThisTurn&&t.currentTurn===P)throw new Error("You have already used your action this turn");if(["steal","hack","scandal"].includes(z.type)&&z.target===void 0)throw new Error(`${z.type} requires a target`);const U=ps(_n,"games",t.id),W=t.players[P];if(!W)throw new Error("Player not found");try{await TT(_n,async ne=>{const re=await ne.get(U);if(!re.exists())throw new Error("Game not found");const M=re.data(),N=rb[z.type];if(!N)throw new Error("Invalid action type");["steal","hack","scandal","investigate"].includes(z.type)&&z.target!==void 0&&(M.actionInProgress={type:z.type,player:P,target:z.target,responses:{},resolved:!1});const I=await N.execute({game:M,player:W,playerId:P,transaction:ne,db:_n});I.logs&&I.logs.forEach(B=>{const q=Vh(B);q&&ne.update(U,{logs:fi(q)})});const O={};I.players&&(O.players=I.players),I.currentTurn!==void 0&&(O.currentTurn=I.currentTurn),I.actionInProgress!==void 0&&(O.actionInProgress=Vh(I.actionInProgress)),I.responses!==void 0&&(O.responses=I.responses),I.cards!==void 0&&(O.cards=I.cards),O.actionUsedThisTurn=I.actionUsedThisTurn!==void 0?I.actionUsedThisTurn:!0,ne.update(U,O)})}catch(ne){throw l("Failed to perform action"),ne}},S=async(P,z)=>{if(!t||!t.actionInProgress||P<0||P>=t.players.length)throw new Error("Invalid response parameters");const U=ps(_n,"games",t.id),W=t.players[P];if(!W)throw new Error("Player not found");try{await TT(_n,async ne=>{const re=await ne.get(U);if(!re.exists())throw new Error("Game not found");const M=re.data();if(!M.actionInProgress)return;const N=rb[M.actionInProgress.type];if(!N)throw new Error("Invalid action type");const I=await N.respond({game:M,player:W,playerId:P,transaction:ne,db:_n},z);I.logs&&I.logs.forEach(B=>{const q=Vh(B);q&&ne.update(U,{logs:fi(q)})});const O={};I.players&&(O.players=I.players),I.currentTurn!==void 0&&(O.currentTurn=I.currentTurn),I.actionInProgress!==void 0&&(O.actionInProgress=Vh(I.actionInProgress)),I.responses!==void 0&&(O.responses=I.responses),I.cards!==void 0&&(O.cards=I.cards),I.actionUsedThisTurn!==void 0&&(O.actionUsedThisTurn=I.actionUsedThisTurn),ne.update(U,O)})}catch(ne){throw l("Failed to respond to action"),ne}},D=t&&t.status==="playing"&&t.players.filter(P=>!P.eliminated).length===1;return Ee.useEffect(()=>{(async()=>{if(D&&t&&!t.winner){const z=t.players.findIndex(U=>!U.eliminated);if(z!==-1)try{const U=ps(_n,"games",t.id);await Ks(U,{winner:z,status:"waiting"})}catch(U){console.error("Failed to set winner:",U)}}})()},[D,t]),{game:t,error:a,wasKicked:u,createGame:p,joinGame:y,performAction:E,respondToAction:S,startGame:v,isGameOver:D,startNewMatch:async()=>{if(t)try{const P=ps(_n,"games",t.id),z=pe.createDeck(),U=pe.dealCards(z,t.players.map(I=>I.id)),W=t.players.map(I=>({...I,coins:2,eliminated:!1})),ne=W.length,re=t.firstPlayerOfMatch!==void 0?(t.firstPlayerOfMatch+1)%ne:1;let N=`New game started! ${W[re].name} will take the first turn.`;await Ks(P,{status:"playing",players:W,cards:U,currentTurn:re,firstPlayerOfMatch:re,actionInProgress:null,responses:{},voteNextMatch:{},winner:null,newMatchCountdownStarted:!1,newMatchStartTime:null,redirectToLobby:!1,actionUsedThisTurn:!1,logs:[ce.createSystemLog(N)]})}catch(P){throw console.error("Failed to start new match",P),l("Failed to start new match"),P}},leaveGame:async P=>{if(!t||P<0||P>=t.players.length)throw new Error("Invalid player ID");try{const z=ps(_n,"games",t.id),U=pe.getPlayerCards(t.cards,P);let W=[...t.cards];t.status==="playing"&&(W=pe.returnCardsToDeck(t.cards,U.map(N=>N.id)));const ne=t.players[P].name,re=t.players.filter((N,I)=>I!==P);let M=t.currentTurn;if(t.status==="playing"){if(P===t.currentTurn){const I=(t.currentTurn+1)%t.players.length;I===P?M=0:I>P?M=I-1:M=I}else P<t.currentTurn&&(M=t.currentTurn-1);const N=re.length;N>0?M=M%N:M=0}await Ks(z,{players:re,cards:W,currentTurn:M,logs:fi(ce.createSystemLog(`${ne} has left the game.`))}),t.status==="playing"&&(re.length===1?await Ks(z,{winner:0,status:"waiting",logs:fi(ce.createSystemLog(`${re[0].name} wins the game!`))}):re.length===0&&await Ks(z,{status:"waiting",logs:fi(ce.createSystemLog("Game ended - all players have left."))}))}catch(z){throw console.error("Failed to leave game:",z),l("Failed to leave game"),z}}}}/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MM=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),OM=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()),ab=n=>{const e=OM(n);return e.charAt(0).toUpperCase()+e.slice(1)},ex=(...n)=>n.filter((e,t,r)=>!!e&&e.trim()!==""&&r.indexOf(e)===t).join(" ").trim();/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var LM={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VM=Ee.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:t=2,absoluteStrokeWidth:r,className:a="",children:l,iconNode:u,...f},g)=>Ee.createElement("svg",{ref:g,...LM,width:e,height:e,stroke:n,strokeWidth:r?Number(t)*24/Number(e):t,className:ex("lucide",a),...f},[...u.map(([p,y])=>Ee.createElement(p,y)),...Array.isArray(l)?l:[l]]));/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gt=(n,e)=>{const t=Ee.forwardRef(({className:r,...a},l)=>Ee.createElement(VM,{ref:l,iconNode:e,className:ex(`lucide-${MM(ab(n))}`,`lucide-${n}`,r),...a}));return t.displayName=ab(n),t};/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jM=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],Iy=gt("arrow-left",jM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UM=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],zM=gt("check",UM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polygon",{points:"10 8 16 12 10 16 10 8",key:"1cimsy"}]],FM=gt("circle-play",BM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qM=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]],HM=gt("clock",qM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GM=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],$M=gt("copy",GM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KM=[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]],ob=gt("crown",KM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QM=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],nf=gt("dollar-sign",QM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YM=[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]],tx=gt("euro",YM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WM=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],XM=gt("external-link",WM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZM=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],Ad=gt("eye",ZM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JM=[["path",{d:"M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4",key:"1nerag"}],["path",{d:"M14 13.12c0 2.38 0 6.38-1 8.88",key:"o46ks0"}],["path",{d:"M17.29 21.02c.12-.6.43-2.3.5-3.02",key:"ptglia"}],["path",{d:"M2 12a10 10 0 0 1 18-6",key:"ydlgp0"}],["path",{d:"M2 16h.01",key:"1gqxmh"}],["path",{d:"M21.8 16c.2-2 .131-5.354 0-6",key:"drycrb"}],["path",{d:"M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2",key:"1tidbn"}],["path",{d:"M8.65 22c.21-.66.45-1.32.57-2",key:"13wd9y"}],["path",{d:"M9 6.8a6 6 0 0 1 9 5.2v2",key:"1fr1j5"}]],eO=gt("fingerprint",JM);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tO=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],nO=gt("info",tO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sO=[["path",{d:"M22 12a1 1 0 0 1-10 0 1 1 0 0 0-10 0",key:"1lzz15"}],["path",{d:"M7 20.7a1 1 0 1 1 5-8.7 1 1 0 1 0 5-8.6",key:"1gnrpi"}],["path",{d:"M7 3.3a1 1 0 1 1 5 8.6 1 1 0 1 0 5 8.6",key:"u9yy5q"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Rn=gt("loader-pinwheel",sO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rO=[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]],iO=gt("log-out",rO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aO=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],oO=gt("plus",aO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lO=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],nx=gt("refresh-cw",lO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cO=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]],lb=gt("shield-alert",cO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uO=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]],cb=gt("shield",uO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hO=[["path",{d:"M12 10.189V14",key:"1p8cqu"}],["path",{d:"M12 2v3",key:"qbqxhf"}],["path",{d:"M19 13V7a2 2 0 0 0-2-2H7a2 2 0 0 0-2 2v6",key:"qpkstq"}],["path",{d:"M19.38 20A11.6 11.6 0 0 0 21 14l-8.188-3.639a2 2 0 0 0-1.624 0L3 14a11.6 11.6 0 0 0 2.81 7.76",key:"7tigtc"}],["path",{d:"M2 21c.6.5 1.2 1 2.5 1 2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1s1.2 1 2.5 1c2.5 0 2.5-2 5-2 1.3 0 1.9.5 2.5 1",key:"1924j5"}]],dO=gt("ship",hO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fO=[["path",{d:"m18 14 4 4-4 4",key:"10pe0f"}],["path",{d:"m18 2 4 4-4 4",key:"pucp1d"}],["path",{d:"M2 18h1.973a4 4 0 0 0 3.3-1.7l5.454-8.6a4 4 0 0 1 3.3-1.7H22",key:"1ailkh"}],["path",{d:"M2 6h1.972a4 4 0 0 1 3.6 2.2",key:"km57vx"}],["path",{d:"M22 18h-6.041a4 4 0 0 1-3.3-1.8l-.359-.45",key:"os18l9"}]],gO=gt("shuffle",fO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pO=[["path",{d:"m12.5 17-.5-1-.5 1h1z",key:"3me087"}],["path",{d:"M15 22a1 1 0 0 0 1-1v-1a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20v1a1 1 0 0 0 1 1z",key:"1o5pge"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}]],au=gt("skull",pO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mO=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]],yO=gt("sword",mO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _O=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}],["polyline",{points:"14.5 6.5 18 3 21 3 21 6 17.5 9.5",key:"hbey2j"}],["line",{x1:"5",x2:"9",y1:"14",y2:"18",key:"1hf58s"}],["line",{x1:"7",x2:"4",y1:"17",y2:"20",key:"pidxm4"}],["line",{x1:"3",x2:"5",y1:"19",y2:"21",key:"1pehsh"}]],cm=gt("swords",_O);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vO=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],wO=gt("target",vO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TO=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],bO=gt("triangle-alert",TO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EO=[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]],SO=gt("trophy",EO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xO=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],CO=gt("user",xO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AO=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]],Ry=gt("users",AO);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const IO=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ny=gt("x",IO),RO="modulepreload",NO=function(n){return"/"+n},ub={},jh=function(e,t,r){let a=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));a=Promise.allSettled(t.map(g=>{if(g=NO(g),g in ub)return;ub[g]=!0;const p=g.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${y}`))return;const v=document.createElement("link");if(v.rel=p?"stylesheet":RO,p||(v.as="script"),v.crossOrigin="",v.href=g,f&&v.setAttribute("nonce",f),document.head.appendChild(v),p)return new Promise((E,S)=>{v.addEventListener("load",E),v.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${g}`)))})}))}function l(u){const f=new Event("vite:preloadError",{cancelable:!0});if(f.payload=u,window.dispatchEvent(f),!f.defaultPrevented)throw u}return a.then(u=>{for(const f of u||[])f.status==="rejected"&&l(f.reason);return e().catch(l)})};var hb=Object.prototype.hasOwnProperty;function um(n,e){var t,r;if(n===e)return!0;if(n&&e&&(t=n.constructor)===e.constructor){if(t===Date)return n.getTime()===e.getTime();if(t===RegExp)return n.toString()===e.toString();if(t===Array){if((r=n.length)===e.length)for(;r--&&um(n[r],e[r]););return r===-1}if(!t||typeof n=="object"){r=0;for(t in n)if(hb.call(n,t)&&++r&&!hb.call(e,t)||!(t in e)||!um(n[t],e[t]))return!1;return Object.keys(e).length===r}}return n!==n&&e!==e}const PO=new Error("request for lock canceled");var kO=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(y){try{p(r.next(y))}catch(v){u(v)}}function g(y){try{p(r.throw(y))}catch(v){u(v)}}function p(y){y.done?l(y.value):a(y.value).then(f,g)}p((r=r.apply(n,e||[])).next())})};class DO{constructor(e,t=PO){this._value=e,this._cancelError=t,this._queue=[],this._weightedWaiters=[]}acquire(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((r,a)=>{const l={resolve:r,reject:a,weight:e,priority:t},u=sx(this._queue,f=>t<=f.priority);u===-1&&e<=this._value?this._dispatchItem(l):this._queue.splice(u+1,0,l)})}runExclusive(e){return kO(this,arguments,void 0,function*(t,r=1,a=0){const[l,u]=yield this.acquire(r,a);try{return yield t(l)}finally{u()}})}waitForUnlock(e=1,t=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,t)?Promise.resolve():new Promise(r=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),MO(this._weightedWaiters[e-1],{resolve:r,priority:t})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const t=this._value;this._value-=e.weight,e.resolve([t,this._newReleaser(e.weight)])}_newReleaser(e){let t=!1;return()=>{t||(t=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const t=this._weightedWaiters[e-1];t&&(t.forEach(r=>r.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let t=this._value;t>0;t--){const r=this._weightedWaiters[t-1];if(!r)continue;const a=r.findIndex(l=>l.priority<=e);(a===-1?r:r.splice(0,a)).forEach(l=>l.resolve())}}}_couldLockImmediately(e,t){return(this._queue.length===0||this._queue[0].priority<t)&&e<=this._value}}function MO(n,e){const t=sx(n,r=>e.priority<=r.priority);n.splice(t+1,0,e)}function sx(n,e){for(let t=n.length-1;t>=0;t--)if(e(n[t]))return t;return-1}var OO=function(n,e,t,r){function a(l){return l instanceof t?l:new t(function(u){u(l)})}return new(t||(t=Promise))(function(l,u){function f(y){try{p(r.next(y))}catch(v){u(v)}}function g(y){try{p(r.throw(y))}catch(v){u(v)}}function p(y){y.done?l(y.value):a(y.value).then(f,g)}p((r=r.apply(n,e||[])).next())})};class LO{constructor(e){this._semaphore=new DO(1,e)}acquire(){return OO(this,arguments,void 0,function*(e=0){const[,t]=yield this._semaphore.acquire(1,e);return t})}runExclusive(e,t=0){return this._semaphore.runExclusive(()=>e(),1,t)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var yb,_b;const Qh=((_b=(yb=globalThis.browser)==null?void 0:yb.runtime)==null?void 0:_b.id)==null?globalThis.chrome:globalThis.browser,Ra=VO();function VO(){const n={local:Uh("local"),session:Uh("session"),sync:Uh("sync"),managed:Uh("managed")},e=j=>{const k=n[j];if(k==null){const P=Object.keys(n).join(", ");throw Error(`Invalid area "${j}". Options: ${P}`)}return k},t=j=>{const k=j.indexOf(":"),P=j.substring(0,k),z=j.substring(k+1);if(z==null)throw Error(`Storage key should be in the form of "area:key", but received "${j}"`);return{driverArea:P,driverKey:z,driver:e(P)}},r=j=>j+"$",a=(j,k)=>{const P={...j};return Object.entries(k).forEach(([z,U])=>{U==null?delete P[z]:P[z]=U}),P},l=(j,k)=>j??k??null,u=j=>typeof j=="object"&&!Array.isArray(j)?j:{},f=async(j,k,P)=>{const z=await j.getItem(k);return l(z,(P==null?void 0:P.fallback)??(P==null?void 0:P.defaultValue))},g=async(j,k)=>{const P=r(k),z=await j.getItem(P);return u(z)},p=async(j,k,P)=>{await j.setItem(k,P??null)},y=async(j,k,P)=>{const z=r(k),U=u(await j.getItem(z));await j.setItem(z,a(U,P))},v=async(j,k,P)=>{if(await j.removeItem(k),P!=null&&P.removeMeta){const z=r(k);await j.removeItem(z)}},E=async(j,k,P)=>{const z=r(k);if(P==null)await j.removeItem(z);else{const U=u(await j.getItem(z));[P].flat().forEach(W=>delete U[W]),await j.setItem(z,U)}},S=(j,k,P)=>j.watch(k,P);return{getItem:async(j,k)=>{const{driver:P,driverKey:z}=t(j);return await f(P,z,k)},getItems:async j=>{const k=new Map,P=new Map,z=[];j.forEach(W=>{let ne,re;typeof W=="string"?ne=W:"getValue"in W?(ne=W.key,re={fallback:W.fallback}):(ne=W.key,re=W.options),z.push(ne);const{driverArea:M,driverKey:N}=t(ne),I=k.get(M)??[];k.set(M,I.concat(N)),P.set(ne,re)});const U=new Map;return await Promise.all(Array.from(k.entries()).map(async([W,ne])=>{(await n[W].getItems(ne)).forEach(M=>{const N=`${W}:${M.key}`,I=P.get(N),O=l(M.value,(I==null?void 0:I.fallback)??(I==null?void 0:I.defaultValue));U.set(N,O)})})),z.map(W=>({key:W,value:U.get(W)}))},getMeta:async j=>{const{driver:k,driverKey:P}=t(j);return await g(k,P)},getMetas:async j=>{const k=j.map(U=>{const W=typeof U=="string"?U:U.key,{driverArea:ne,driverKey:re}=t(W);return{key:W,driverArea:ne,driverKey:re,driverMetaKey:r(re)}}),P=k.reduce((U,W)=>{var ne;return U[ne=W.driverArea]??(U[ne]=[]),U[W.driverArea].push(W),U},{}),z={};return await Promise.all(Object.entries(P).map(async([U,W])=>{const ne=await Qh.storage[U].get(W.map(re=>re.driverMetaKey));W.forEach(re=>{z[re.key]=ne[re.driverMetaKey]??{}})})),k.map(U=>({key:U.key,meta:z[U.key]}))},setItem:async(j,k)=>{const{driver:P,driverKey:z}=t(j);await p(P,z,k)},setItems:async j=>{const k={};j.forEach(P=>{const{driverArea:z,driverKey:U}=t("key"in P?P.key:P.item.key);k[z]??(k[z]=[]),k[z].push({key:U,value:P.value})}),await Promise.all(Object.entries(k).map(async([P,z])=>{await e(P).setItems(z)}))},setMeta:async(j,k)=>{const{driver:P,driverKey:z}=t(j);await y(P,z,k)},setMetas:async j=>{const k={};j.forEach(P=>{const{driverArea:z,driverKey:U}=t("key"in P?P.key:P.item.key);k[z]??(k[z]=[]),k[z].push({key:U,properties:P.meta})}),await Promise.all(Object.entries(k).map(async([P,z])=>{const U=e(P),W=z.map(({key:N})=>r(N));console.log(P,W);const ne=await U.getItems(W),re=Object.fromEntries(ne.map(({key:N,value:I})=>[N,u(I)])),M=z.map(({key:N,properties:I})=>{const O=r(N);return{key:O,value:a(re[O]??{},I)}});await U.setItems(M)}))},removeItem:async(j,k)=>{const{driver:P,driverKey:z}=t(j);await v(P,z,k)},removeItems:async j=>{const k={};j.forEach(P=>{let z,U;typeof P=="string"?z=P:"getValue"in P?z=P.key:"item"in P?(z=P.item.key,U=P.options):(z=P.key,U=P.options);const{driverArea:W,driverKey:ne}=t(z);k[W]??(k[W]=[]),k[W].push(ne),U!=null&&U.removeMeta&&k[W].push(r(ne))}),await Promise.all(Object.entries(k).map(async([P,z])=>{await e(P).removeItems(z)}))},clear:async j=>{await e(j).clear()},removeMeta:async(j,k)=>{const{driver:P,driverKey:z}=t(j);await E(P,z,k)},snapshot:async(j,k)=>{var U;const z=await e(j).snapshot();return(U=k==null?void 0:k.excludeKeys)==null||U.forEach(W=>{delete z[W],delete z[r(W)]}),z},restoreSnapshot:async(j,k)=>{await e(j).restoreSnapshot(k)},watch:(j,k)=>{const{driver:P,driverKey:z}=t(j);return S(P,z,k)},unwatch(){Object.values(n).forEach(j=>{j.unwatch()})},defineItem:(j,k)=>{const{driver:P,driverKey:z}=t(j),{version:U=1,migrations:W={}}=k??{};if(U<1)throw Error("Storage item version cannot be less than 1. Initial versions should be set to 1, not 0.");const ne=async()=>{var te;const O=r(z),[{value:B},{value:q}]=await P.getItems([z,O]);if(B==null)return;const L=(q==null?void 0:q.v)??1;if(L>U)throw Error(`Version downgrade detected (v${L} -> v${U}) for "${j}"`);if(L===U)return;console.debug(`[@wxt-dev/storage] Running storage migration for ${j}: v${L} -> v${U}`);const je=Array.from({length:U-L},(he,ge)=>L+ge+1);let Ce=B;for(const he of je)try{Ce=await((te=W==null?void 0:W[he])==null?void 0:te.call(W,Ce))??Ce}catch(ge){throw new jO(j,he,{cause:ge})}await P.setItems([{key:z,value:Ce},{key:O,value:{...q,v:U}}]),console.debug(`[@wxt-dev/storage] Storage migration completed for ${j} v${U}`,{migratedValue:Ce})},re=(k==null?void 0:k.migrations)==null?Promise.resolve():ne().catch(O=>{console.error(`[@wxt-dev/storage] Migration failed for ${j}`,O)}),M=new LO,N=()=>(k==null?void 0:k.fallback)??(k==null?void 0:k.defaultValue)??null,I=()=>M.runExclusive(async()=>{const O=await P.getItem(z);if(O!=null||(k==null?void 0:k.init)==null)return O;const B=await k.init();return await P.setItem(z,B),B});return re.then(I),{key:j,get defaultValue(){return N()},get fallback(){return N()},getValue:async()=>(await re,k!=null&&k.init?await I():await f(P,z,k)),getMeta:async()=>(await re,await g(P,z)),setValue:async O=>(await re,await p(P,z,O)),setMeta:async O=>(await re,await y(P,z,O)),removeValue:async O=>(await re,await v(P,z,O)),removeMeta:async O=>(await re,await E(P,z,O)),watch:O=>S(P,z,(B,q)=>O(B??N(),q??N())),migrate:ne}}}}function Uh(n){const e=()=>{if(Qh.runtime==null)throw Error(["'wxt/storage' must be loaded in a web extension environment",`
 - If thrown during a build, see https://github.com/wxt-dev/wxt/issues/371`,` - If thrown during tests, mock 'wxt/browser' correctly. See https://wxt.dev/guide/go-further/testing.html
`].join(`
`));if(Qh.storage==null)throw Error("You must add the 'storage' permission to your manifest to use 'wxt/storage'");const r=Qh.storage[n];if(r==null)throw Error(`"browser.storage.${n}" is undefined`);return r},t=new Set;return{getItem:async r=>(await e().get(r))[r],getItems:async r=>{const a=await e().get(r);return r.map(l=>({key:l,value:a[l]??null}))},setItem:async(r,a)=>{a==null?await e().remove(r):await e().set({[r]:a})},setItems:async r=>{const a=r.reduce((l,{key:u,value:f})=>(l[u]=f,l),{});await e().set(a)},removeItem:async r=>{await e().remove(r)},removeItems:async r=>{await e().remove(r)},clear:async()=>{await e().clear()},snapshot:async()=>await e().get(),restoreSnapshot:async r=>{await e().set(r)},watch(r,a){const l=u=>{const f=u[r];f!=null&&(um(f.newValue,f.oldValue)||a(f.newValue??null,f.oldValue??null))};return e().onChanged.addListener(l),t.add(l),()=>{e().onChanged.removeListener(l),t.delete(l)}},unwatch(){t.forEach(r=>{e().onChanged.removeListener(r)}),t.clear()}}}class jO extends Error{constructor(e,t,r){super(`v${t} migration failed for "${e}"`,r),this.key=e,this.version=t}}async function hm(n){await Ra.setItems([{key:"local:playerName",value:n}])}async function vc(){return await Ra.getItem("local:playerName")}async function UO(n){await Ra.setItems([{key:"local:playerId",value:n}])}async function zO(){return await Ra.getItem("local:playerId")}async function BO(){return await Ra.getItem("local:user")}async function FO(){await Ra.removeItems(["local:user"])}async function qO(){await Ra.removeItems(["local:playerName"])}function Py(){const[n,e]=Ee.useState({user:null,isLoading:!1,error:null});Ee.useEffect(()=>{(async()=>{try{const u=await BO();u&&e(f=>({...f,user:u}))}catch(u){console.error("Error loading user data:",u)}})();const l=async u=>{if(u.type==="AUTH_STATE_CHANGED"&&(e(f=>({...f,user:u.user,isLoading:!1,error:null})),u.user&&u.user.displayName&&(await vc()||hm(u.user.displayName)),u.user&&u.user.uid))try{console.log("Received auth state change, authenticating with Firebase...");const f=await fetch("https://conflictology-web.vercel.app/api/auth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uid:u.user.uid})});if(!f.ok)throw new Error("Failed to get custom token");const{customToken:g}=await f.json();if(!g)throw new Error("No custom token received");const{auth:p}=await jh(async()=>{const{auth:v}=await Promise.resolve().then(()=>sb);return{auth:v}},void 0),{signInWithCustomToken:y}=await jh(async()=>{const{signInWithCustomToken:v}=await Promise.resolve().then(()=>Sw);return{signInWithCustomToken:v}},void 0);await y(p,g),console.log("Firebase auth synchronized")}catch(f){console.error("Failed to sync Firebase auth:",f)}};return gi.runtime.onMessage.addListener(l),()=>{gi.runtime.onMessage.removeListener(l)}},[]);const t=async()=>{try{e(a=>({...a,isLoading:!0,error:null})),gi.runtime.sendMessage({action:"signIn"},a=>{gi.runtime.lastError?(console.error("Error signing in:",gi.runtime.lastError),e(l=>({...l,isLoading:!1,error:"Failed to sign in with Google. Please try again."}))):a.error?(console.error("Authentication error:",a.error),e(l=>({...l,isLoading:!1,error:a.error}))):console.log("Sign in successful:",a.user)})}catch(a){const l=a instanceof Error?a.message:"Failed to sign in with Google";e(u=>({...u,isLoading:!1,error:l}))}},r=async()=>{try{e(a=>({...a,isLoading:!0,error:null})),await FO(),await qO(),await gi.runtime.sendMessage({action:"signOut"}),e({user:null,isLoading:!1,error:null});try{const{auth:a}=await jh(async()=>{const{auth:u}=await Promise.resolve().then(()=>sb);return{auth:u}},void 0),{signOut:l}=await jh(async()=>{const{signOut:u}=await Promise.resolve().then(()=>Sw);return{signOut:u}},void 0);await l(a),console.log("Firebase sign out complete")}catch(a){console.error("Error signing out of Firebase:",a)}}catch(a){const l=a instanceof Error?a.message:"Failed to sign out";e(u=>({...u,isLoading:!1,error:l}))}};return{user:n.user,isLoading:n.isLoading,error:n.error,signIn:t,signOut:r}}const db="/assets/capitol-bg-Bwd7OMou.png";function HO(){const{user:n,isLoading:e,signIn:t}=Py(),r=a=>{a.preventDefault(),a.stopPropagation(),t().catch(l=>{console.error("Sign in error:",l)})};return n?null:w.jsxs("button",{onClick:r,disabled:e,className:`
          w-full mt-3 bg-[#111111]/80 
          ${e?"":"hover:bg-[#151515]"} 
          text-white rounded-md p-4 flex items-center justify-between group 
          transition-all duration-200 shadow-lg relative overflow-hidden border border-zinc-800/40
        `,style:{position:"relative",zIndex:50},children:[w.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-blue-600 to-blue-600/20 group-hover:opacity-100 opacity-70"}),w.jsx("div",{className:"absolute inset-y-0 left-0 w-1 bg-blue-600"}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-10 h-10 rounded-md bg-blue-900/10 flex items-center justify-center group-hover:bg-blue-900/20 transition-colors",children:e?w.jsx(Rn,{className:"w-5 h-5 text-blue-500 animate-spin"}):w.jsxs("svg",{width:"20",height:"20",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",children:[w.jsx("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"}),w.jsx("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"}),w.jsx("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"}),w.jsx("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"})]})}),w.jsxs("div",{className:"text-left",children:[w.jsx("div",{className:"font-semibold text-base text-zinc-100",children:e?"Signing in...":"Sign in with Google"}),w.jsx("div",{className:"text-xs text-zinc-400 group-hover:text-zinc-300",children:"Required to create or join games"})]})]}),w.jsx("div",{className:"w-6 h-6 text-zinc-600 mr-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]})}function GO(){const{user:n,signOut:e}=Py();return n?w.jsxs("div",{className:"mt-4 flex items-center justify-between text-zinc-400 text-xs p-3",children:[w.jsx("div",{className:"flex items-center gap-2",children:w.jsxs("span",{children:["Signed in as ",n.email||n.displayName]})}),w.jsx("button",{onClick:e,className:"text-zinc-500 hover:text-zinc-300 p-1 rounded transition-colors",title:"Sign out",children:w.jsx(iO,{size:14})})]}):null}const fb=["#E74C3C","#2ECC71","#3498DB","#F1C40F","#9B59B6","#E67E22"];function $O({onGameStart:n,playerId:e}){const{createGame:t,joinGame:r}=tf(),{user:a,error:l}=Py(),[u,f]=Ee.useState(""),[g,p]=Ee.useState(`Player ${e%1e3}`),[y,v]=Ee.useState("main"),[E,S]=Ee.useState(null),[D,j]=Ee.useState(!1),[k,P]=Ee.useState(!1);Ee.useEffect(()=>{(async()=>{const M=await vc();M&&p(M)})()},[]),Ee.useEffect(()=>{(async()=>{const M=await vc();if(a)a!=null&&a.displayName&&!M?(p(a.displayName),hm(a.displayName)):M&&p(M);else{const N=`Player ${e%1e3}`;p(N)}})()},[a,e]);const z=fb[e%fb.length],U=()=>({id:e,name:g||`Player ${e%1e3}`,coins:2,color:z,avatar:""}),W=async()=>{if(!D)try{S(null),j(!0);const re=await t(),M=await vc();M&&M!==g&&p(M);const N=U();console.log("Creating game with player name:",N.name),await r(re,N),n(re)}catch(re){S(re instanceof Error?re.message:"Failed to create game"),j(!1)}},ne=async()=>{if(!u||k){S("Please enter a game ID");return}if(u.length!==6){S("Game code must be 6 characters");return}try{S(null),P(!0);const re=await vc();re&&re!==g&&p(re);const M=U();console.log("Joining game with player name:",M.name),await r(u,M),n(u)}catch(re){S(re instanceof Error?re.message:"Failed to join game"),P(!1)}};return y==="main"?w.jsxs("div",{className:"flex flex-col h-full",children:[w.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[w.jsx("div",{className:"absolute inset-0 z-10"}),w.jsx("img",{src:db,alt:"Capitol Background",className:"object-cover w-full h-full opacity-60"}),w.jsx("div",{className:"absolute inset-0 z-10"})]}),w.jsxs("div",{className:"flex-none pt-8 pb-6 text-center relative z-20",children:[w.jsx("h1",{className:"text-5xl font-normal text-[#f7e7c2] bg-clip-text text-transparent bg-gradient-to-b from-zinc-200 to-zinc-400",style:{fontFamily:"'Bebas Neue', sans-serif",letterSpacing:"3px"},children:"CONFLICTOLOGY"}),w.jsxs("div",{className:"flex items-center justify-center",children:[w.jsx("div",{className:"h-[3px] w-16 bg-[#850c09] rounded-full shadow-sm shadow-[#850c09]/50"}),w.jsx("h2",{className:"text-md font-bold mx-4 tracking-widest",style:{fontFamily:"'League Spartan', sans-serif",color:"#f7e7c2",textShadow:"0 1px 2px rgba(0,0,0,0.3)",letterSpacing:"5px"},children:"CAPITOL"}),w.jsx("div",{className:"h-[3px] w-16 bg-[#850c09] rounded-full shadow-sm shadow-[#850c09]/50"})]})]}),w.jsxs("div",{className:"flex-1 p-4 pt-0 space-y-5 flex flex-col justify-center relative z-20",children:[(E||l)&&w.jsx("div",{className:"bg-red-500/20 text-red-400 p-3 rounded-lg text-sm mb-4 animate-in fade-in slide-in-from-top-2",children:E||l}),a&&w.jsxs("div",{className:"bg-[#111111]/80 rounded-md p-4 border border-zinc-800/40 shadow-lg relative overflow-hidden",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-black/10 via-transparent to-black/10"}),w.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-[#850c09]/10 to-transparent rounded-full blur-2xl transform translate-x-16 -translate-y-16 opacity-30"}),w.jsxs("div",{className:"flex items-center gap-3 relative",children:[w.jsxs("div",{className:"w-10 h-10 rounded-full flex items-center justify-center font-bold text-lg shadow-md relative overflow-hidden border border-zinc-800/60",style:{backgroundColor:"#232720",color:"white"},children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/10 to-transparent"}),g.substring(0,1).toUpperCase()]}),w.jsx("input",{type:"text",value:g,onChange:re=>{const M=re.target.value;p(M),hm(M)},placeholder:"Your name",maxLength:15,className:"bg-black/60 border border-zinc-800/80 rounded-md px-3 py-2.5 text-zinc-200 flex-1 focus:outline-none focus:ring-1 focus:ring-zinc-700/50 placeholder-zinc-600 text-sm font-medium"})]})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx(HO,{}),w.jsxs("button",{onClick:W,disabled:D||!a,className:`
                w-full bg-[#111111]/80 
                ${!D&&a?"hover:bg-[#151515]":""} 
                text-white rounded-md p-4 flex items-center justify-between group 
                transition-all duration-200 shadow-lg relative overflow-hidden border border-zinc-800/40
                ${a?"":"opacity-50 cursor-not-allowed"}
              `,children:[w.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-[#850c09] to-[#850c09]/20 group-hover:opacity-100 opacity-70"}),w.jsx("div",{className:"absolute inset-y-0 left-0 w-1 bg-[#850c09]"}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-10 h-10 rounded-md bg-[#850c09]/10 flex items-center justify-center group-hover:bg-[#850c09]/20 transition-colors",children:D?w.jsx(Rn,{className:"w-5 h-5 text-[#850c09] animate-spin"}):w.jsx(oO,{className:"w-5 h-5 text-[#850c09]"})}),w.jsxs("div",{className:"text-left",children:[w.jsx("div",{className:"font-semibold text-base text-zinc-100",children:D?"Creating Game...":"Create Game"}),w.jsx("div",{className:"text-xs text-zinc-400 group-hover:text-zinc-300",children:D?"Please wait":"Start a new game room"})]})]}),w.jsx("div",{className:"w-6 h-6 text-zinc-600 mr-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]}),w.jsxs("button",{onClick:()=>v("join"),disabled:!a,className:`
                w-full bg-[#111111]/80 
                ${a?"hover:bg-[#151515]":""} 
                text-white rounded-md p-4 flex items-center justify-between group 
                transition-all duration-200 shadow-lg relative overflow-hidden border border-zinc-800/40
                ${a?"":"opacity-50 cursor-not-allowed"}
              `,children:[w.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-blue-700 to-blue-700/20 group-hover:opacity-100 opacity-70"}),w.jsx("div",{className:"absolute inset-y-0 left-0 w-1 bg-blue-700"}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-10 h-10 rounded-md bg-blue-900/10 flex items-center justify-center group-hover:bg-blue-900/20 transition-colors",children:w.jsx(Ry,{className:"w-5 h-5 text-blue-500"})}),w.jsxs("div",{className:"text-left",children:[w.jsx("div",{className:"font-semibold text-base text-zinc-100",children:"Join Game"}),w.jsx("div",{className:"text-xs text-zinc-400 group-hover:text-zinc-300",children:"Enter an existing room"})]})]}),w.jsx("div",{className:"w-6 h-6 text-zinc-600 mr-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]}),w.jsxs("button",{onClick:()=>window.open("https://conflictologygames.com/rules","_blank"),className:"w-full bg-[#111111]/80 hover:bg-[#151515] text-white rounded-md p-4 flex items-center justify-between group transition-all duration-200 shadow-lg relative overflow-hidden border border-zinc-800/40",children:[w.jsx("div",{className:"absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-amber-700 to-amber-700/20 group-hover:opacity-100 opacity-70"}),w.jsx("div",{className:"absolute inset-y-0 left-0 w-1 bg-amber-700"}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-10 h-10 rounded-md bg-amber-900/10 flex items-center justify-center group-hover:bg-amber-900/20 transition-colors",children:w.jsx("svg",{className:"w-5 h-5 text-amber-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),w.jsxs("div",{className:"text-left",children:[w.jsx("div",{className:"font-semibold text-base text-zinc-100",children:"Game Rules"}),w.jsx("div",{className:"text-xs text-zinc-400 group-hover:text-zinc-300",children:"Learn how to play"})]})]}),w.jsx("div",{className:"w-6 h-6 text-zinc-600 mr-2 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]}),w.jsx(GO,{})]})]}),w.jsx("div",{className:"flex-none pb-6 text-center text-zinc-700 text-xs relative z-20",children:w.jsx("p",{className:"tracking-widest",style:{fontFamily:"'Bebas Neue', sans-serif",letterSpacing:"2px"},children:"CONFLICTOLOGYCAPITOLV1.0"})})]}):y==="join"?w.jsxs("div",{className:"p-4 h-full flex flex-col",children:[w.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[w.jsx("div",{className:"absolute inset-0 bg-black/40 z-10"}),w.jsx("img",{src:db,alt:"Capitol Background",className:"object-cover w-full h-full opacity-60"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-transparent via-transparent to-black/90 z-10"})]}),w.jsx("div",{className:"flex items-center mb-6 relative z-20",children:w.jsx("button",{className:"w-10 h-10 bg-[#2a2a2a]/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-[#333333] transition-colors",onClick:()=>{v("main"),S(null)},children:w.jsx(Iy,{className:"w-5 h-5 text-white/80"})})}),(E||l)&&w.jsx("div",{className:"bg-red-500/20 text-red-400 p-3 rounded-lg text-sm mb-4 animate-in fade-in slide-in-from-top-2 relative z-20",children:E||l}),w.jsxs("div",{className:"flex-1 flex flex-col justify-center relative z-20",children:[w.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur-sm rounded-xl p-5 mb-6 border border-zinc-800/30 shadow-xl",children:[w.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[w.jsx("div",{className:"w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg shadow-lg",style:{backgroundColor:"#232720",color:"white"},children:g.substring(0,1).toUpperCase()}),w.jsxs("div",{className:"text-white",children:[w.jsx("div",{className:"font-medium",children:g}),w.jsx("div",{className:"text-xs text-white/50",children:"Ready to join"})]})]}),w.jsx("h3",{className:"text-zinc-400 font-medium text-sm mb-3 mt-2",children:"SECRET CODE"}),w.jsx("input",{type:"text",value:u,onChange:re=>f(re.target.value),className:"w-full bg-black/50 border border-zinc-800 rounded-lg px-4 py-3 text-white text-lg tracking-wider focus:outline-none focus:ring-1 focus:ring-zinc-700 mb-3 text-center font-mono",maxLength:6}),w.jsx("p",{className:"text-zinc-500 text-xs text-center mb-2",children:"Enter the exact secret code from the host"})]}),w.jsx("button",{onClick:ne,disabled:u.length!==6||k||!a,className:`w-full py-3.5 rounded-lg font-medium text-md flex items-center justify-center gap-2 transition-all ${u.length===6&&!k&&a?"bg-gradient-to-br from-zinc-800 to-zinc-900 hover:from-zinc-700 hover:to-zinc-800 text-white border border-zinc-700/30 shadow-lg":k?"bg-gradient-to-br from-zinc-700 to-zinc-800 text-white border border-zinc-700/30 shadow-lg":"bg-zinc-900/50 text-zinc-600 cursor-not-allowed border border-zinc-800/30"}`,children:k?w.jsxs(w.Fragment,{children:[w.jsx(Rn,{className:"w-5 h-5 animate-spin"}),w.jsx("span",{children:"Joining Game..."})]}):"Join Game"})]})]}):null}const KO="/assets/your-turn-7HG_8aqL.png",rx=Ee.forwardRef(({onClick:n,disabled:e,canTakeAction:t,isCurrentTurn:r,gameActionUsedThisTurn:a,isActionInProgress:l,showActions:u,gameState:f},g)=>w.jsxs("button",{ref:g,onClick:n,className:"relative group",disabled:e,children:[t&&!l&&w.jsx("div",{className:"absolute -inset-4 rounded-full bg-gradient-to-r from-amber-500/20 via-amber-400/30 to-amber-500/20 fire-pulse"}),r&&a&&!l&&w.jsx("div",{className:"absolute -inset-4 rounded-full bg-gradient-to-r from-gray-500/20 via-gray-400/30 to-gray-500/20"}),l&&w.jsx("div",{className:"absolute -inset-4 rounded-full bg-gradient-to-r from-amber-500/20 via-amber-100/30 to-amber-300/20 pulse"}),w.jsx("div",{className:`
          absolute -inset-2
          rounded-full
          bg-gradient-to-r from-slate-700 via-slate-500 to-slate-700
          ${u?"pulse-ring opacity-100":"opacity-0"}
          ${l?"opacity-0":"group-hover:opacity-100"}
          transition-opacity duration-300
        `}),w.jsxs("div",{className:`
          relative
          w-14 h-14
          rounded-full
          bg-gradient-to-br from-[#2a2a2a] to-[#1a1a1a]
          flex items-center justify-center
          shadow-[inset_0_1px_1px_rgba(255,255,255,0.1),0_0_20px_rgba(0,0,0,0.5)]
          border border-slate-700/50
          overflow-hidden
          transition-all duration-300
          ${u?"ring-2 ring-slate-400/30":""}
          ${t&&!l?"ring-2 ring-amber-500/30":""} 
          ${l?"ring-2 ring-amber-300/30":""}
          ${r&&a&&!l?"ring-2 ring-gray-500/30":""}
          ${(!r||f==="waiting_for_influence_loss")&&!l?"opacity-50 cursor-not-allowed":""}
          ${r&&a&&!l?"opacity-70 cursor-not-allowed":""}
          ${l?"opacity-90":""}
        `,children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-amber-300/10 to-transparent transform -rotate-45 gem-shine"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-tl from-amber-700/20 to-transparent"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-amber-600/10 to-transparent"}),w.jsx("div",{className:`
            absolute -inset-1
            blur-lg
            transition-opacity duration-300
            ${t&&!l?"bg-amber-400/20 opacity-100":""}
            ${l?"bg-amber-300/20 opacity-100":""}
            ${r&&a&&!l?"bg-gray-400/20 opacity-100":""}
            ${!r&&!l?"bg-amber-400/20 opacity-0":""}
          `}),l?w.jsx(Rn,{className:"w-6 h-6 text-amber-300 animate-spin"}):w.jsx(eO,{className:`
              relative
              w-6 h-6
              transition-all duration-300
              ${u?"text-amber-300":""}
              ${t?"text-amber-300":""}
              ${r&&a?"text-gray-400":""}
              ${r?"":"text-slate-400"}
              ${t?"group-hover:text-amber-300":""}
              ${t?"transform group-hover:scale-110":""}
            `})]})]}));rx.displayName="ActionButton";const QO=n=>{const e=["Banker","Hacker","Mafia","Reporter","Judge","Police","Income","Foreign Aid","Tax","Steal","Exchange","Hack","Investigate","Scandal","Swap"];return n.split(new RegExp(`(${e.join("|")})`,"g")).map((a,l)=>e.includes(a)?w.jsx("span",{className:"font-bold",children:a},l):a)},YO=(n,e)=>{switch(n){case"waiting_for_action":return"Choose your action";case"waiting_for_target":return`Select target for ${e}`;case"waiting_for_response":return"Waiting for responses";case"waiting_for_exchange":return"Choose cards to exchange";case"waiting_for_influence_loss":return"Select a card to lose";case"waiting_for_others":return"Waiting for other players";case"waiting_for_turn":return"Other player's turn";case"waiting_for_card_selection":return"Select a card to show";case"waiting_for_investigate_decision":return"Decide on investigation";default:return""}};function WO({logs:n,gameState:e,selectedAction:t,game:r}){const a=r.players[r.currentTurn],l=[...n].reverse().slice(0,4),u=g=>g.length>14?`${g.slice(0,12)}`:g,f=g=>{switch(g){case"system":return"text-gray-400 italic";case"challenge":case"challenge-success":case"challenge-fail":return"text-amber-300";case"block":return"text-red-300";default:return"text-gray-300"}};return w.jsxs("div",{className:"backdrop-blur-sm rounded-lg shadow-lg w-full overflow-hidden",children:[w.jsx("div",{className:"bg-[#333333] border-b border-white/5 p-1.5 sticky top-0 z-10",children:w.jsxs("div",{className:"flex flex-col items-center gap-1",children:[w.jsx("div",{className:"flex items-center gap-2",children:w.jsxs("span",{className:"text-xs font-medium animate-pulse",style:{color:a.color},children:[a.name,"'s Turn"]})}),e&&w.jsxs("div",{className:"flex items-center gap-1.5",children:[w.jsx(HM,{className:"w-3 h-3 text-slate-400"}),w.jsx("span",{className:"text-[10px] text-slate-400",children:YO(e,t)})]})]})}),w.jsx("div",{className:"p-1.5 bg-gradient-to-b from-[#2a2a2a]/80 to-transparent max-h-[200px] overflow-y-auto",children:w.jsx("div",{className:"space-y-1",children:l.map((g,p)=>w.jsx("div",{className:"flex flex-wrap items-center px-2 py-1 rounded bg-[#3a3a3a]/50 animate-in fade-in slide-in-from-bottom-2",style:{animationDelay:`${p*50}ms`,opacity:p===0?1:p===1?.95:p===2?.5:.2},children:w.jsxs("div",{className:"flex flex-wrap gap-1 items-center text-[11px] w-full",children:[g.type!=="system"&&w.jsx("span",{className:`font-bold ${f(g.type)}`,style:{color:g.playerColor},children:u(g.player)}),g.messageParts&&g.messageParts.map((y,v)=>{if(y.type==="text")return w.jsx("span",{className:`text-[10px] ${f(g.type)}`,children:QO(y.content)},v);if(y.type==="player"){const E=r.players.find(S=>S.id===y.playerId);return w.jsx("span",{className:`font-bold ${f(g.type)}`,style:{color:(E==null?void 0:E.color)||y.color},children:u(y.content)},v)}return null})]})},p))})})]})}const XO="/assets/back-2-DFCczkRL.png";function ZO({player:n,isActive:e,isTargetable:t=!1,isTargeted:r=!1,onTargetSelect:a,isCurrentPlayer:l=!1,cards:u}){const f=p=>p.length>11?`${p.slice(0,10)}`:p,g=pe.getPlayerCards(u,n.id);return w.jsxs("div",{className:`
        relative
        ${t&&!n.eliminated?"cursor-pointer hover:scale-105 group":""}
        ${n.eliminated?"opacity-50":""}
        transition-transform duration-200
      `,onClick:t&&!n.eliminated?a:void 0,role:t&&!n.eliminated?"button":void 0,"aria-label":t&&!n.eliminated?`Target ${n.name}`:void 0,children:[t&&!n.eliminated&&w.jsxs("div",{className:"absolute inset-0 -m-3 z-0 pointer-events-none",children:[w.jsx("div",{className:"absolute inset-0 rounded-xl bg-red-500/10 animate-pulse-slow"}),w.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xs text-white/80 font-bold bg-red-500/80 px-2 py-0.5 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"TARGET"})]}),r&&!n.eliminated&&w.jsxs("div",{className:"absolute inset-0 -m-3 z-0 pointer-events-none",children:[w.jsx("div",{className:"absolute inset-0 rounded-xl bg-red-500/30 animate-pulse"}),w.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-xs text-white font-bold bg-red-600/90 px-2 py-0.5 rounded-full shadow-lg",children:"TARGETED"})]}),w.jsx("div",{className:`
        relative z-20 
        bg-[#2a2a2a]/90 backdrop-blur-sm rounded-lg
        ${e?"ring-2 ring-yellow-500/50":""}
        ${r&&!n.eliminated?"ring-2 ring-red-500":""}
        ${t&&!n.eliminated?"hover:ring-2 hover:ring-red-500 shadow-lg":""}
        ${n.eliminated?"ring-1 ring-red-900/50":""}
        transition-all duration-200
      `,children:w.jsxs("div",{className:"flex items-center p-1.5 gap-1.5 max-w-[160px]",children:[w.jsxs("div",{className:"relative shrink-0",children:[w.jsx("div",{className:`
              w-6 h-6 rounded-full overflow-hidden
              ${e?"ring-2 ring-yellow-500/50 shadow-[0_0_15px_rgba(255,255,255,0.2)]":""}
              ${r&&!n.eliminated?"ring-2 ring-red-500/50":""}
              ${n.eliminated?"grayscale":""}
            `,children:n.avatar?w.jsx("img",{src:n.avatar,alt:n.name,className:"w-full h-full object-cover",onError:p=>{p.target.style.display="none",p.currentTarget.parentElement.classList.add("fallback-avatar")}}):w.jsx("div",{className:"w-full h-full flex items-center justify-center font-bold text-white",style:{backgroundColor:n.color},children:n.name.charAt(0).toUpperCase()})}),n.eliminated&&w.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full flex items-center justify-center",children:w.jsx(au,{className:"w-2 h-2 text-white"})})]}),w.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-0.5",children:[w.jsxs("div",{className:"w-full flex items-center gap-1",children:[w.jsx("span",{className:`
                  text-xs font-medium leading-none block truncate
                  ${n.eliminated?"text-gray-500":""}
                `,style:{color:n.eliminated?void 0:n.color},title:n.name,children:f(n.name)}),l&&w.jsx("span",{className:"text-[8px] text-yellow-300 bg-zinc-800/80 border border-yellow-500/30 rounded-full px-1 py-0.5 leading-none whitespace-nowrap",children:"You"})]}),w.jsxs("div",{className:"flex items-center gap-1 bg-black/20 rounded-full px-1.5 py-0.5 w-fit",children:[w.jsx(nf,{className:`w-3 h-3 ${n.eliminated?"text-gray-500":"text-yellow-500"}`}),w.jsxs("span",{className:`text-[10px] font-bold ${n.eliminated?"text-gray-500":"text-yellow-500"}`,children:[n.coins,"M"]})]})]})]})}),w.jsx("div",{className:"flex gap-0.5 -mt-2 justify-center",children:g.map((p,y)=>w.jsx("div",{className:`
              w-7 h-10 rounded 
              overflow-hidden
              ${r&&!n.eliminated?"ring-1 ring-red-500/30":""}
              ${n.eliminated?"opacity-50":""}
              transition-colors duration-200
              shadow-sm
            `,style:{transform:`translateY(${y*-3}px) rotate(${y*-6}deg)`},children:w.jsx("img",{src:XO,alt:"Card back",className:"w-full h-full object-cover"})},p.id))})]})}function JO(){return w.jsx("div",{className:"relative",children:w.jsx("div",{className:"relative z-10 bg-[#2a2a2a]/40 backdrop-blur-sm rounded-lg border border-white/5",children:w.jsx("div",{className:"flex items-center p-1.5 gap-1.5 max-w-[160px]",children:w.jsx("div",{className:"relative shrink-0",children:w.jsx("div",{className:"w-6 h-6 rounded-full bg-white/5"})})})})})}const Jo="/assets/banker-DGiVI_kW.png",el="/assets/hacker-VQwuALqU.png",tl="/assets/mafia-CC2Brl9T.png",nl="/assets/reporter-CuEIytjR.png",sl="/assets/judge-tdg1T9f9.png",Sa="/assets/police-BMoFcMtc.png";function e4({onClose:n,onActionSelect:e,playerCoins:t}){const r=[{type:"income",icon:nf,name:"Income",description:"Take $1M"},{type:"foreign-aid",icon:tx,name:"Foreign Aid",description:"Take $2M"},{type:"scandal",icon:au,name:"Scandal",description:"Pay $7M to scandal",cost:7}],a=[{type:"banker",icon:ob,name:"Banker",description:"Take $3M as tax",cardImage:Jo},{type:"hack",icon:yO,name:"Hacker",description:"Pay $3M to hack",cost:3,cardImage:el},{type:"steal",icon:dO,name:"Mafia",description:"Steal $2M",cardImage:tl},{type:"exchange",icon:Ry,name:"Reporter",description:"Exchange 2 cards",cardImage:nl},{type:"investigate",icon:Ad,name:"Police (Investigate)",description:"Investigate a player's card",cardImage:Sa,requiresTarget:!0},{type:"swap",icon:nx,name:"Police (Swap)",description:"Swap one of your cards",cardImage:Sa},{type:"judge",icon:ob,name:"Judge",description:"Blocks Hacker attempts",cardImage:sl}],l=u=>t>=10&&u.type!=="scandal"?!0:u.cost!==void 0&&t<u.cost;return w.jsxs("div",{className:`bg-[#1a1a1a] rounded-lg p-2 w-64 shadow-xl border border-slate-800/50 backdrop-blur-sm
                 animate-in fade-in slide-in-from-bottom-2 duration-200`,children:[w.jsx("div",{className:"space-y-1.5 mb-2",children:r.map((u,f)=>{const g=l(u);return w.jsxs("div",{onClick:()=>{g||(e(u),n())},className:`
                w-full flex items-center gap-2 p-1.5 rounded 
                transition-colors text-left group
                animate-in fade-in slide-in-from-bottom-1
                ${g?"opacity-50 cursor-not-allowed":"hover:bg-slate-800/50 cursor-pointer"}
              `,style:{animationDelay:`${f*50}ms`},children:[w.jsx(u.icon,{className:`
                w-7 h-7 shrink-0
                ${g?"text-slate-500":"text-slate-400 group-hover:text-slate-300 transition-colors"}
              `}),w.jsxs("div",{children:[w.jsx("div",{className:`
                  text-sm 
                  ${g?"text-slate-400":"text-slate-300 group-hover:text-white transition-colors"}
                `,children:u.name}),w.jsxs("div",{className:`
                  text-xs 
                  ${g?"text-slate-600":"text-slate-500 group-hover:text-slate-400 transition-colors"}
                `,children:[u.description,g&&u.cost&&` (need $${u.cost}M)`,u.type==="scandal"&&t>=10&&" (mandatory with $10M+)"]})]})]},u.type)})}),w.jsx("div",{className:"h-px bg-slate-800/70 my-2"}),w.jsx("div",{className:"space-y-1.5",children:a.map((u,f)=>{const g=u.type==="judge",p=g||l(u);return w.jsxs("div",{onClick:()=>{!p&&!g&&(e(u),n())},className:`
                w-full flex items-center gap-3 p-1.5 rounded 
                transition-colors text-left group
                animate-in fade-in slide-in-from-bottom-1
                ${g?"opacity-70 cursor-default":p?"opacity-50 cursor-not-allowed":"hover:bg-slate-800/50 cursor-pointer"}
              `,style:{animationDelay:`${(f+r.length)*50}ms`},children:[w.jsxs("div",{className:`
                  w-7 h-10 rounded overflow-hidden shrink-0 shadow-md 
                  ${g?"":"transition-transform group-hover:scale-105"}
                `,style:{transform:`rotate(${-4+f*3}deg)`},children:[w.jsx("img",{src:u.cardImage,alt:u.name,className:"w-full h-full object-cover"}),!g&&w.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/0 via-white/10 to-white/0 opacity-0 group-hover:opacity-100 transition-opacity"})]}),w.jsxs("div",{children:[w.jsxs("div",{className:`
                  text-sm 
                  ${g?"text-slate-400 italic":p?"text-slate-400":"text-slate-300 group-hover:text-white transition-colors"}
                `,children:[u.name,g&&" (Defensive)"]}),w.jsxs("div",{className:`
                  text-xs 
                  ${g?"text-slate-600 italic":p?"text-slate-600":"text-slate-500 group-hover:text-slate-400 transition-colors"}
                `,children:[u.description,!g&&p&&u.cost&&` (need $${u.cost}M)`]})]})]},u.type)})})]})}function t4({player:n}){return w.jsx("div",{className:"relative",children:w.jsx("div",{className:"relative z-10 bg-[#2a2a2a]/90 backdrop-blur-sm rounded-lg",children:w.jsxs("div",{className:"flex items-center p-1.5 gap-1.5 max-w-[160px]",children:[w.jsx("div",{className:"relative shrink-0",children:w.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden",children:n.avatar?w.jsx("img",{src:n.avatar,alt:n.name,className:"w-full h-full object-cover",onError:e=>{e.target.style.display="none",e.currentTarget.parentElement.classList.add("fallback-avatar")}}):w.jsx("div",{className:"w-full h-full flex items-center justify-center font-bold text-white",style:{backgroundColor:n.color},children:n.name.charAt(0).toUpperCase()})})}),w.jsxs("div",{className:"flex-1 min-w-0 flex flex-col gap-0.5",children:[w.jsx("div",{className:"w-full",children:w.jsx("span",{className:"text-sm font-medium leading-none block truncate",style:{color:n.color},title:n.name,children:n.name})}),w.jsxs("div",{className:"flex items-center gap-1 bg-black/20 rounded-full px-1.5 py-0.5 w-fit",children:[w.jsx(nf,{className:"w-3 h-3 text-yellow-500"}),w.jsxs("span",{className:"text-[10px] font-bold text-yellow-500",children:[n.coins,"M"]})]})]})]})})})}const ky=2e3,gb=ky/2,n4=ky/2;function s4({playerId:n,cards:e}){const r=[...e.filter(g=>g.playerId===n&&g.location==="player"&&!g.revealed)].sort((g,p)=>g.position===null||p.position===null?0:g.position-p.position),a=Ee.useRef([]),l=Ee.useRef(null),[u,f]=Ee.useState({animatingPositions:[],outgoingCards:new Map});return Ee.useEffect(()=>{if(a.current.length===0){a.current=[...r];return}const g=new Map;r.forEach(E=>{E.position!==null&&g.set(E.position,E.id)});const p=new Map;a.current.forEach(E=>{E.position!==null&&p.set(E.position,E)});const y=[],v=new Map;return Array.from(p.entries()).forEach(([E,S])=>{const D=g.get(E);D&&D!==S.id&&(y.push(E),v.set(E,S))}),y.length>0&&(f({animatingPositions:y,outgoingCards:v}),l.current&&clearTimeout(l.current),l.current=setTimeout(()=>{f(E=>({...E,animatingPositions:[]})),l.current=null},ky)),a.current=[...r],()=>{l.current&&clearTimeout(l.current)}},[r]),w.jsx("div",{className:"flex gap-1 transform -rotate-6",children:r.map(g=>{var v;const p=g.position!==null&&u.animatingPositions.includes(g.position),y=new URL(`../images/${g.name.toLowerCase()}.png`,self.location.href).href;return w.jsxs("div",{className:`w-[75px] h-[105px] rounded-md overflow-hidden transform ${g.position===1?"rotate-6":""} relative`,style:{boxShadow:"0 0 20px rgba(0,0,0,0.3)"},children:[w.jsx("div",{className:`w-full h-full transition-opacity ease-in-out absolute inset-0 ${p?"animate-fadeIn opacity-0":"opacity-100"}`,style:{animationDuration:`${n4}ms`,animationDelay:`${gb}ms`,animationFillMode:"forwards"},children:w.jsx("img",{src:y,alt:g.name,className:"w-full h-full object-cover"})}),p&&g.position!==null&&u.outgoingCards.has(g.position)&&w.jsx("div",{className:"w-full h-full absolute inset-0 animate-fadeOut opacity-100",style:{animationDuration:`${gb}ms`,animationFillMode:"forwards"},children:w.jsx("img",{src:new URL(`../images/${((v=u.outgoingCards.get(g.position))==null?void 0:v.name.toLowerCase())||"back"}.png`,self.location.href).href,alt:"Previous card",className:"w-full h-full object-cover"})})]},g.id)})})}function r4({onBlock:n,onChallenge:e,onAllow:t,visible:r=!0,showBlock:a=!0,showChallenge:l=!0,showAllow:u=!0,blockText:f="Block",challengeText:g="Challenge",allowText:p="Allow",blockCards:y=["Banker"]}){const[v,E]=Ee.useState(!1),[S,D]=Ee.useState(null),[j,k]=Ee.useState(null);if(!r)return null;const P=y.length>1&&a,z=y.length===1&&a,U=async re=>{if(!v){E(!0),D("block"),k(re);try{await(n==null?void 0:n(re))}finally{}}},W=async()=>{if(!v){E(!0),D("challenge");try{await(e==null?void 0:e())}finally{}}},ne=async()=>{if(!v){E(!0),D("allow");try{await(t==null?void 0:t())}finally{}}};return w.jsx("div",{className:"rounded-lg w-full overflow-hidden mt-4 animate-in fade-in slide-in-from-bottom-2 mb-6",children:w.jsxs("div",{className:"flex justify-center gap-2 flex-wrap relative",children:[z&&w.jsxs("button",{onClick:()=>U(y[0]),disabled:v,className:`flex items-center gap-1.5 ${v&&S==="block"&&j===y[0]?"bg-red-500/40 cursor-not-allowed":"bg-red-500/20 hover:bg-red-500/30"} text-red-400 px-3 py-2 rounded-lg transition-colors`,children:[v&&S==="block"&&j===y[0]?w.jsx(Rn,{className:"w-4 h-4 animate-spin"}):w.jsx(lb,{className:"w-4 h-4"}),w.jsx("span",{className:"text-sm font-medium",children:f})]}),P&&y.map(re=>w.jsxs("button",{onClick:()=>U(re),disabled:v,className:`flex items-center gap-1 ${v&&S==="block"&&j===re?"bg-red-500/40 cursor-not-allowed":"bg-red-500/20 hover:bg-red-500/30"} text-red-400 px-3 py-2 rounded-lg transition-colors`,children:[v&&S==="block"&&j===re?w.jsx(Rn,{className:"w-3 h-3 animate-spin"}):w.jsx(lb,{className:"w-3 h-3"}),w.jsx("span",{className:"text-sm font-medium",children:re})]},re)),l&&w.jsxs("button",{onClick:W,disabled:v,className:`flex items-center gap-1.5 ${v&&S==="challenge"?"bg-yellow-500/40 cursor-not-allowed":"bg-yellow-500/20 hover:bg-yellow-500/30"} text-yellow-400 px-3 py-2 rounded-lg transition-colors`,children:[v&&S==="challenge"?w.jsx(Rn,{className:"w-4 h-4 animate-spin"}):w.jsx(cm,{className:"w-4 h-4"}),w.jsx("span",{className:"text-sm font-medium",children:g})]}),u&&w.jsxs("button",{onClick:ne,disabled:v,className:`flex items-center gap-1.5 ${v&&S==="allow"?"bg-green-500/40 cursor-not-allowed":"bg-green-500/20 hover:bg-green-500/30"} text-green-400 px-3 py-2 rounded-lg transition-colors`,children:[v&&S==="allow"?w.jsx(Rn,{className:"w-4 h-4 animate-spin"}):w.jsx(zM,{className:"w-4 h-4"}),w.jsx("span",{className:"text-sm font-medium",children:p})]})]})})}const i4={Reporter:nl,Hacker:el,Mafia:tl,Judge:sl,Banker:Jo,Police:Sa};function a4({cards:n,playerId:e,onCardSelect:t}){const[r,a]=Ee.useState(null),[l,u]=Ee.useState(!1),f=n.filter(p=>p.playerId===e&&p.location==="player"&&!p.revealed).sort((p,y)=>p.position===null||y.position===null?0:p.position-y.position);if(f.length===0)return null;const g=async p=>{if(!l){a(p.id),u(!0);try{await t(p.name),u(!1),a(null)}catch(y){console.error("Failed to lose influence:",y),u(!1),a(null)}}};return w.jsx("div",{className:"absolute inset-x-0 bottom-0 z-50 animate-in fade-in slide-in-from-bottom-4",children:w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/80 to-transparent backdrop-blur-md"}),w.jsxs("div",{className:"relative px-6 pt-12 pb-6",children:[w.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-6",children:w.jsx("div",{className:"w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center animate-pulse",children:w.jsx(au,{className:"w-6 h-6 text-red-500"})})}),w.jsxs("div",{className:"text-center mb-6",children:[w.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:"Lose Influence"}),w.jsx("p",{className:"text-red-400/80 text-sm",children:"Select a card to remove from your influence"})]}),w.jsx("div",{className:"flex justify-center gap-4",children:f.map(p=>{const y=p.id===r,v=l&&!y;return w.jsxs("button",{onClick:()=>g(p),disabled:v,className:`group relative ${v?"cursor-not-allowed opacity-50":""}`,children:[w.jsx("div",{className:`
                    absolute -inset-2 rounded-xl 
                    ${y?"bg-red-500/40":"bg-red-500/20 opacity-0 group-hover:opacity-100"}
                    transition-opacity duration-300
                  `}),w.jsxs("div",{className:"relative",children:[w.jsxs("div",{className:`
                      w-20 h-32 rounded-lg overflow-hidden 
                      transform transition-all duration-300
                      ${y?"scale-105 -translate-y-1":"group-hover:scale-105 group-hover:-translate-y-1"}
                    `,children:[w.jsx("img",{src:i4[p.name],alt:p.name,className:"w-full h-full object-cover"}),w.jsx("div",{className:`
                        absolute inset-0 
                        ${y?"bg-red-500/30":"bg-red-500/0 group-hover:bg-red-500/30"} 
                        transition-colors duration-300
                      `}),y&&l&&w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:w.jsx(Rn,{className:"w-8 h-8 text-white animate-spin"})})]}),w.jsx("div",{className:`
                      absolute -bottom-1 inset-x-0 h-1 bg-red-500 transform 
                      ${y?"scale-x-100":"scale-x-0 group-hover:scale-x-100"} 
                      transition-transform duration-300
                    `})]})]},p.id)})})]})]})})}const pb={Reporter:nl,Hacker:el,Mafia:tl,Judge:sl,Banker:Jo,Police:Sa};function o4({cards:n,playerId:e,exchangeCardIds:t,onExchangeComplete:r}){const[a,l]=Ee.useState([]),[u,f]=Ee.useState(!1),g=pe.getPlayerCards(n,e),p=n.filter(D=>t.includes(D.id)),y=[...g,...p],v=g.length,E=D=>{u||(a.includes(D)?l(a.filter(j=>j!==D)):a.length<v&&l([...a,D]))},S=async()=>{if(!(a.length!==v||u)){f(!0);try{await r(a)}catch(D){console.error("Failed to complete exchange:",D),f(!1)}}};return y.length===0?null:w.jsx("div",{className:"absolute inset-x-0 bottom-0 z-50 animate-in fade-in slide-in-from-bottom-4",children:w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/80 to-transparent backdrop-blur-md"}),w.jsxs("div",{className:"relative px-6 pt-12 pb-6",children:[w.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-6",children:w.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-500/20 flex items-center justify-center animate-pulse",children:w.jsx(gO,{className:"w-6 h-6 text-blue-500"})})}),w.jsxs("div",{className:"text-center mb-6",children:[w.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:"Exchange Cards"}),w.jsxs("p",{className:"text-blue-400/80 text-sm",children:["Select ",v," card",v!==1?"s":""," to keep"]})]}),w.jsxs("div",{className:"mb-8 space-y-6",children:[w.jsxs("div",{children:[w.jsx("h4",{className:"text-white/80 text-sm font-semibold mb-3 text-center",children:"Your Current Cards"}),w.jsx("div",{className:"flex justify-center gap-3 flex-wrap",children:g.map(D=>{const j=y.findIndex(z=>z.id===D.id),k=a.includes(j),P=u&&!k;return w.jsxs("button",{onClick:()=>E(j),disabled:P||u,className:`
                        group relative 
                        ${k?"ring-2 ring-blue-500":""} 
                        ${P?"opacity-50 cursor-not-allowed":""}
                        
                      `,children:[w.jsx("div",{className:`
                        absolute -inset-2 rounded-xl 
                        ${k?"bg-blue-500/30":"bg-blue-500/0 group-hover:bg-blue-500/20"} 
                        transition-all duration-300
                      `}),w.jsxs("div",{className:"relative",children:[w.jsxs("div",{className:`
                          w-20 h-32 rounded-lg overflow-hidden 
                          transform transition-all duration-300
                          ${k?"scale-105 -translate-y-1":"group-hover:scale-105 group-hover:-translate-y-1"}
                        `,children:[w.jsx("img",{src:pb[D.name],alt:D.name,className:"w-full h-full object-cover"}),w.jsx("div",{className:`
                            absolute inset-0 
                            ${k?"bg-blue-500/30":"bg-blue-500/0 group-hover:bg-blue-500/20"} 
                            transition-colors duration-300
                          `})]}),w.jsx("div",{className:`
                          absolute -bottom-1 inset-x-0 h-1 bg-blue-500 transform 
                          ${k?"scale-x-100":"scale-x-0 group-hover:scale-x-100"} 
                          transition-transform duration-300
                        `})]})]},D.id)})})]}),w.jsxs("div",{children:[w.jsx("h4",{className:"text-white/80 text-sm font-semibold mb-3 text-center",children:"New Cards From Deck"}),w.jsx("div",{className:"flex justify-center gap-3 flex-wrap",children:p.map(D=>{const j=y.findIndex(z=>z.id===D.id),k=a.includes(j),P=u&&!k;return w.jsxs("button",{onClick:()=>E(j),disabled:P||u,className:`
                        group relative 
                        ${k?"ring-2 ring-blue-500":""} 
                        ${P?"opacity-50 cursor-not-allowed":""}
                      `,children:[w.jsx("div",{className:`
                        absolute -inset-2 rounded-xl 
                        ${k?"bg-blue-500/30":"bg-blue-500/0 group-hover:bg-blue-500/20"} 
                        transition-all duration-300
                      `}),w.jsxs("div",{className:"relative",children:[w.jsxs("div",{className:`
                          w-20 h-32 rounded-lg overflow-hidden 
                          transform transition-all duration-300
                          ${k?"scale-105 -translate-y-1":"group-hover:scale-105 group-hover:-translate-y-1"}
                        `,children:[w.jsx("img",{src:pb[D.name],alt:D.name,className:"w-full h-full object-cover"}),w.jsx("div",{className:`
                            absolute inset-0 
                            ${k?"bg-blue-500/30":"bg-blue-500/0 group-hover:bg-blue-500/20"} 
                            transition-colors duration-300
                          `})]}),w.jsx("div",{className:`
                          absolute -bottom-1 inset-x-0 h-1 bg-blue-500 transform 
                          ${k?"scale-x-100":"scale-x-0 group-hover:scale-x-100"} 
                          transition-transform duration-300
                        `})]})]},D.id)})})]})]}),w.jsx("div",{className:"flex justify-center",children:w.jsxs("button",{onClick:S,disabled:a.length!==v||u,className:`
                px-6 py-2 rounded-full flex items-center gap-2
                ${a.length===v&&!u?"bg-blue-600 hover:bg-blue-700 text-white":"bg-gray-700 text-gray-400 cursor-not-allowed"}
                transition-colors duration-300
              `,children:[u&&w.jsx(Rn,{className:"w-4 h-4 animate-spin"}),u?"Processing...":`Confirm Selection (${a.length}/${v})`]})})]})]})})}const l4={Banker:Jo,Hacker:el,Mafia:tl,Judge:sl,Reporter:nl,Police:Sa};function c4({cards:n,playerId:e,onCardSelect:t}){const[r,a]=Ee.useState(null),[l,u]=Ee.useState(!1),f=n.filter(p=>p.playerId===e&&p.location==="player"&&!p.revealed);if(f.length===0)return null;const g=async p=>{if(!l){a(p.id),u(!0);try{await t(p.name)}catch(y){console.error("Failed to select card for investigation:",y),u(!1),a(null)}}};return w.jsx("div",{className:"absolute inset-x-0 bottom-0 z-50 animate-in fade-in slide-in-from-bottom-4",children:w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/80 to-transparent backdrop-blur-md"}),w.jsxs("div",{className:"relative px-6 pt-12 pb-6",children:[w.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-6",children:w.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center animate-pulse",children:w.jsx(Ad,{className:"w-6 h-6 text-purple-500"})})}),w.jsxs("div",{className:"text-center mb-6",children:[w.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:"Select Card for Investigation"}),w.jsx("p",{className:"text-purple-400/80 text-sm",children:"Choose one of your cards to show the Police"})]}),w.jsx("div",{className:"mb-8",children:w.jsx("div",{className:"flex justify-center gap-3 flex-wrap",children:f.map(p=>{const y=p.id===r,v=l&&!y;return w.jsxs("button",{onClick:()=>g(p),disabled:v,className:`group relative ${v?"cursor-not-allowed opacity-50":""}`,children:[w.jsx("div",{className:`
                      absolute -inset-2 rounded-xl 
                      ${y?"bg-purple-500/40":"bg-purple-500/0 group-hover:bg-purple-500/20"} 
                      transition-all duration-300
                    `}),w.jsxs("div",{className:"relative",children:[w.jsxs("div",{className:`
                        w-20 h-32 rounded-lg overflow-hidden 
                        transform transition-all duration-300
                        ${y?"scale-105 -translate-y-1":"group-hover:scale-105 group-hover:-translate-y-1"}
                      `,children:[w.jsx("img",{src:l4[p.name],alt:p.name,className:"w-full h-full object-cover"}),w.jsx("div",{className:`
                          absolute inset-0 
                          ${y?"bg-purple-500/30":"bg-purple-500/0 group-hover:bg-purple-500/20"} 
                          transition-colors duration-300
                        `}),y&&l&&w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:w.jsx(Rn,{className:"w-8 h-8 text-white animate-spin"})})]}),w.jsx("div",{className:`
                        absolute -bottom-1 inset-x-0 h-1 bg-purple-500 transform 
                        ${y?"scale-x-100":"scale-x-0 group-hover:scale-x-100"} 
                        transition-transform duration-300
                      `})]})]},p.id)})})})]})]})})}const u4={Banker:Jo,Hacker:el,Mafia:tl,Judge:sl,Reporter:nl,Police:Sa};function h4({card:n,targetName:e,onDecision:t}){const[r,a]=Ee.useState(!1),[l,u]=Ee.useState(null),f=async g=>{if(!r){a(!0),u(g?"keep":"swap");try{await t(g)}catch(p){console.error("Failed to make investigation decision:",p),a(!1),u(null)}}};return w.jsx("div",{className:"absolute inset-x-0 bottom-0 z-50 animate-in fade-in slide-in-from-bottom-4",children:w.jsxs("div",{className:"relative",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black via-black/80 to-transparent backdrop-blur-md"}),w.jsxs("div",{className:"relative px-6 pt-12 pb-6",children:[w.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-6",children:w.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center animate-pulse",children:w.jsx(Ad,{className:"w-6 h-6 text-purple-500"})})}),w.jsxs("div",{className:"text-center mb-6",children:[w.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:"Investigation Result"}),w.jsxs("p",{className:"text-purple-400/80 text-sm",children:[e," showed you this card"]})]}),w.jsx("div",{className:"mb-8 flex justify-center",children:w.jsx("div",{className:"relative",children:w.jsxs("div",{className:"w-32 h-48 rounded-lg overflow-hidden mx-auto",children:[w.jsx("img",{src:u4[n],alt:n,className:"w-full h-full object-cover"}),r&&w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/40",children:w.jsx(Rn,{className:"w-10 h-10 text-white/80 animate-spin"})})]})})}),w.jsxs("div",{className:"flex justify-center gap-3 flex-wrap",children:[w.jsxs("button",{onClick:()=>f(!0),disabled:r,className:`
                flex items-center justify-center gap-1.5 px-5 py-2 rounded-full
                ${r?l==="keep"?"bg-green-700":"bg-green-600/50 cursor-not-allowed":"bg-green-600 hover:bg-green-700"} 
                text-white text-sm font-medium transition-colors duration-200 shadow-sm
              `,children:[r&&l==="keep"?w.jsx(Rn,{className:"w-4 h-4 animate-spin"}):w.jsx(Ad,{className:"w-4 h-4"}),w.jsx("span",{children:"Let Them Keep It"})]}),w.jsxs("button",{onClick:()=>f(!1),disabled:r,className:`
                flex items-center justify-center gap-1.5 px-5 py-2 rounded-full
                ${r?l==="swap"?"bg-purple-700":"bg-purple-600/50 cursor-not-allowed":"bg-purple-600 hover:bg-purple-700"} 
                text-white text-sm font-medium transition-colors duration-200 shadow-sm
              `,children:[r&&l==="swap"?w.jsx(Rn,{className:"w-4 h-4 animate-spin"}):w.jsx(nx,{className:"w-4 h-4"}),w.jsx("span",{children:"Force Card Swap"})]})]})]})]})})}const d4="/assets/lobby-bg-9kCyGvk8.png";function f4({game:n,isHost:e,currentPlayerId:t,onStartGame:r,onReturnToMainMenu:a}){const{leaveGame:l,wasKicked:u}=tf(n.id,t),f=()=>{navigator.clipboard.writeText(n.id)};Ee.useEffect(()=>{u&&(console.log("Player was kicked! Returning to main menu from GameLobby"),a())},[u,a]);const g=async()=>{try{const v=n.players.findIndex(E=>E.id===t);v!==-1&&await l(v),a()}catch(v){console.error("Error leaving game:",v),a()}},p=n.winner!==void 0?n.winner:-1,y=p!==-1?n.players[p]:void 0;return w.jsxs("div",{className:"relative h-full",children:[w.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[w.jsx("div",{className:"absolute inset-0 bg-black/40 z-10"}),w.jsx("img",{src:d4,alt:"Lobby Background",className:"object-cover w-full h-full opacity-70"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-b from-black/40 via-transparent to-black/70 z-10"})]}),w.jsx("button",{className:"w-10 h-10 bg-zinc-900/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-zinc-800 transition-colors absolute left-4 top-4 z-30 border border-zinc-800/30",onClick:g,children:w.jsx(Iy,{className:"w-5 h-5 text-white/80"})}),w.jsxs("div",{className:"p-4 space-y-4 h-full",children:[w.jsx("div",{className:"relative z-20 mt-4 mb-4 text-center",children:w.jsx("h2",{className:"text-md font-semibold text-zinc-400",children:"Game Room"})}),w.jsx("div",{className:"bg-zinc-900/80 backdrop-blur-sm rounded-lg p-4 border border-zinc-800/30 relative z-20 shadow-xl",children:w.jsxs("div",{className:"text-center space-y-2",children:[w.jsx("h3",{className:"text-zinc-400 font-medium text-sm uppercase tracking-wide",children:"Secret Code"}),w.jsxs("div",{className:"flex items-center justify-center gap-2",children:[w.jsx("code",{className:"bg-black/50 px-3 py-1.5 rounded text-zinc-200 font-mono border border-zinc-800/50",children:n.id}),w.jsx("button",{onClick:f,className:"w-8 h-8 flex items-center justify-center rounded-full bg-black/50 hover:bg-zinc-800 transition-colors border border-zinc-800/50",children:w.jsx($M,{className:"w-4 h-4 text-white/70"})})]})]})}),y&&w.jsxs("div",{className:"bg-gradient-to-br from-zinc-900/80 to-zinc-800/80 backdrop-blur-sm rounded-lg p-4 border border-yellow-600/30 relative z-20 shadow-xl overflow-hidden",children:[w.jsx("div",{className:"absolute -inset-1 bg-yellow-500/10 blur-xl rounded-lg"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-yellow-600/5 via-yellow-500/10 to-yellow-600/5 animate-pulse-slow"}),w.jsxs("div",{className:"relative flex items-center justify-between",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("h3",{className:"text-yellow-100 font-semibold text-md tracking-wide mb-2",children:"Game Winner"}),w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center font-bold text-md shadow-md",style:{backgroundColor:y.color},children:y.name.substring(0,1).toUpperCase()}),w.jsx("span",{className:"text-lg text-white font-medium",children:y.name})]})]}),w.jsx("div",{className:"opacity-20 absolute right-4 bottom-0 transform translate-y-1/4",children:w.jsx(SO,{className:"w-24 h-24 text-yellow-400"})})]})]}),w.jsxs("div",{className:"bg-zinc-900/80 backdrop-blur-sm rounded-lg p-4 border border-zinc-800/30 relative z-20 shadow-xl",children:[w.jsxs("div",{className:"flex items-center justify-center gap-3",children:[w.jsx(Ry,{className:"w-5 h-5 text-zinc-400"}),w.jsxs("div",{className:"text-sm",children:[w.jsx("span",{className:"text-zinc-200 font-bold",children:n.players.length}),w.jsx("span",{className:"text-zinc-500",children:" / "}),w.jsx("span",{className:"text-zinc-600",children:"6"}),w.jsx("span",{className:"ml-2 text-zinc-500",children:"players"})]})]}),w.jsx("div",{className:"mt-4 space-y-2 max-h-84 overflow-y-auto",children:n.players.map((v,E)=>w.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-lg bg-black/50 border border-zinc-800/30",children:[w.jsx("div",{className:"w-6 h-6 rounded-full flex items-center justify-center font-bold text-sm shadow-md",style:{backgroundColor:v.color},children:v.name.substring(0,1).toUpperCase()}),w.jsx("span",{className:"text-sm text-zinc-200",children:v.name}),w.jsxs("div",{className:"flex gap-1.5 ml-auto",children:[v.id===t&&w.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full border",style:{color:v.color,borderColor:`${v.color}40`},children:"You"}),E===0&&w.jsx("span",{className:"text-xs text-zinc-500 border border-zinc-800 rounded-full px-2 py-0.5",children:"Host"}),e&&v.id!==t&&w.jsx("button",{onClick:async()=>{try{await l(E)}catch(S){console.error("Error removing player:",S)}},className:"w-5 h-5 bg-red-900/30 rounded-full flex items-center justify-center hover:bg-red-800/50 transition-colors ml-1",title:"Remove player",children:w.jsx(Ny,{className:"w-3 h-3 text-red-400"})})]})]},E))})]}),n.status==="playing"&&n.players.some(v=>v.id===t&&v.tempViewState==="lobby")&&w.jsx("button",{onClick:async()=>{const v=ps(_n,"games",n.id),E=n.players.findIndex(S=>S.id===t);if(E!==-1){const S=[...n.players];S[E]={...S[E],tempViewState:"game"},await Ks(v,{players:S})}},className:"w-full bg-gradient-to-br from-zinc-800 to-zinc-900 hover:from-zinc-700 hover:to-zinc-800 text-white rounded-xl p-4 flex items-center justify-between group transition-all duration-200 shadow-xl shadow-black/40 border border-zinc-700/30 relative z-20 mt-2",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-10 h-10 rounded-lg bg-white/5 flex items-center justify-center group-hover:bg-white/10 transition-colors",children:w.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-6 h-6 text-zinc-300 group-hover:text-white",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[w.jsx("path",{d:"M15 17l5-5-5-5"}),w.jsx("path",{d:"M4 12h16"})]})}),w.jsxs("div",{className:"text-left",children:[w.jsx("div",{className:"font-semibold text-lg text-zinc-200 group-hover:text-white",children:"Return to Game"}),w.jsx("div",{className:"text-sm text-zinc-400 group-hover:text-zinc-300",children:"Go back to the current match"})]})]})}),e&&n.players.length>=2&&!(n.status==="playing"&&n.players.some(v=>v.id===t&&v.tempViewState==="lobby"))&&w.jsx("button",{onClick:r,className:"w-full bg-gradient-to-br from-zinc-800 to-zinc-900 hover:from-zinc-700 hover:to-zinc-800 text-white rounded-xl p-4 flex items-center justify-between group transition-all duration-200 shadow-xl shadow-black/40 border border-zinc-700/30 relative z-20 mt-2",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:w.jsx(FM,{className:"w-6 h-6 text-zinc-300 group-hover:text-white"})}),w.jsx("div",{className:"text-left",children:w.jsx("div",{className:"font-semibold text-lg text-zinc-200 group-hover:text-white",children:n.winner!==void 0?"Start New Game":"Start Game"})})]})}),(!e||n.players.length<2)&&!(n.status==="playing"&&n.players.some(v=>v.id===t&&v.tempViewState==="lobby"))&&w.jsx("div",{className:"mt-4 text-center text-zinc-500 text-sm animate-pulse relative z-20 bg-black/20 py-3 rounded-lg border border-zinc-800/20",children:"Waiting..."})]})]})}var ou={};(function n(e,t,r,a){var l=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),u=typeof Path2D=="function"&&typeof DOMMatrix=="function",f=function(){if(!e.OffscreenCanvas)return!1;var C=new OffscreenCanvas(1,1),R=C.getContext("2d");R.fillRect(0,0,1,1);var ee=C.transferToImageBitmap();try{R.createPattern(ee,"no-repeat")}catch{return!1}return!0}();function g(){}function p(C){var R=t.exports.Promise,ee=R!==void 0?R:e.Promise;return typeof ee=="function"?new ee(C):(C(g,g),null)}var y=function(C,R){return{transform:function(ee){if(C)return ee;if(R.has(ee))return R.get(ee);var Z=new OffscreenCanvas(ee.width,ee.height),ue=Z.getContext("2d");return ue.drawImage(ee,0,0),R.set(ee,Z),Z},clear:function(){R.clear()}}}(f,new Map),v=function(){var C=Math.floor(16.666666666666668),R,ee,Z={},ue=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(R=function(me){var de=Math.random();return Z[de]=requestAnimationFrame(function ve(Te){ue===Te||ue+C-1<Te?(ue=Te,delete Z[de],me()):Z[de]=requestAnimationFrame(ve)}),de},ee=function(me){Z[me]&&cancelAnimationFrame(Z[me])}):(R=function(me){return setTimeout(me,C)},ee=function(me){return clearTimeout(me)}),{frame:R,cancel:ee}}(),E=function(){var C,R,ee={};function Z(ue){function me(de,ve){ue.postMessage({options:de||{},callback:ve})}ue.init=function(ve){var Te=ve.transferControlToOffscreen();ue.postMessage({canvas:Te},[Te])},ue.fire=function(ve,Te,Ue){if(R)return me(ve,null),R;var rt=Math.random().toString(36).slice(2);return R=p(function($e){function at(Tt){Tt.data.callback===rt&&(delete ee[rt],ue.removeEventListener("message",at),R=null,y.clear(),Ue(),$e())}ue.addEventListener("message",at),me(ve,rt),ee[rt]=at.bind(null,{data:{callback:rt}})}),R},ue.reset=function(){ue.postMessage({reset:!0});for(var ve in ee)ee[ve](),delete ee[ve]}}return function(){if(C)return C;if(!r&&l){var ue=["var CONFETTI, SIZE = {}, module = {};","("+n.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{C=new Worker(URL.createObjectURL(new Blob([ue])))}catch(me){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn(" Could not load worker",me),null}Z(C)}return C}}(),S={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function D(C,R){return R?R(C):C}function j(C){return C!=null}function k(C,R,ee){return D(C&&j(C[R])?C[R]:S[R],ee)}function P(C){return C<0?0:Math.floor(C)}function z(C,R){return Math.floor(Math.random()*(R-C))+C}function U(C){return parseInt(C,16)}function W(C){return C.map(ne)}function ne(C){var R=String(C).replace(/[^0-9a-f]/gi,"");return R.length<6&&(R=R[0]+R[0]+R[1]+R[1]+R[2]+R[2]),{r:U(R.substring(0,2)),g:U(R.substring(2,4)),b:U(R.substring(4,6))}}function re(C){var R=k(C,"origin",Object);return R.x=k(R,"x",Number),R.y=k(R,"y",Number),R}function M(C){C.width=document.documentElement.clientWidth,C.height=document.documentElement.clientHeight}function N(C){var R=C.getBoundingClientRect();C.width=R.width,C.height=R.height}function I(C){var R=document.createElement("canvas");return R.style.position="fixed",R.style.top="0px",R.style.left="0px",R.style.pointerEvents="none",R.style.zIndex=C,R}function O(C,R,ee,Z,ue,me,de,ve,Te){C.save(),C.translate(R,ee),C.rotate(me),C.scale(Z,ue),C.arc(0,0,1,de,ve,Te),C.restore()}function B(C){var R=C.angle*(Math.PI/180),ee=C.spread*(Math.PI/180);return{x:C.x,y:C.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:C.startVelocity*.5+Math.random()*C.startVelocity,angle2D:-R+(.5*ee-Math.random()*ee),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:C.color,shape:C.shape,tick:0,totalTicks:C.ticks,decay:C.decay,drift:C.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:C.gravity*3,ovalScalar:.6,scalar:C.scalar,flat:C.flat}}function q(C,R){R.x+=Math.cos(R.angle2D)*R.velocity+R.drift,R.y+=Math.sin(R.angle2D)*R.velocity+R.gravity,R.velocity*=R.decay,R.flat?(R.wobble=0,R.wobbleX=R.x+10*R.scalar,R.wobbleY=R.y+10*R.scalar,R.tiltSin=0,R.tiltCos=0,R.random=1):(R.wobble+=R.wobbleSpeed,R.wobbleX=R.x+10*R.scalar*Math.cos(R.wobble),R.wobbleY=R.y+10*R.scalar*Math.sin(R.wobble),R.tiltAngle+=.1,R.tiltSin=Math.sin(R.tiltAngle),R.tiltCos=Math.cos(R.tiltAngle),R.random=Math.random()+2);var ee=R.tick++/R.totalTicks,Z=R.x+R.random*R.tiltCos,ue=R.y+R.random*R.tiltSin,me=R.wobbleX+R.random*R.tiltCos,de=R.wobbleY+R.random*R.tiltSin;if(C.fillStyle="rgba("+R.color.r+", "+R.color.g+", "+R.color.b+", "+(1-ee)+")",C.beginPath(),u&&R.shape.type==="path"&&typeof R.shape.path=="string"&&Array.isArray(R.shape.matrix))C.fill(he(R.shape.path,R.shape.matrix,R.x,R.y,Math.abs(me-Z)*.1,Math.abs(de-ue)*.1,Math.PI/10*R.wobble));else if(R.shape.type==="bitmap"){var ve=Math.PI/10*R.wobble,Te=Math.abs(me-Z)*.1,Ue=Math.abs(de-ue)*.1,rt=R.shape.bitmap.width*R.scalar,$e=R.shape.bitmap.height*R.scalar,at=new DOMMatrix([Math.cos(ve)*Te,Math.sin(ve)*Te,-Math.sin(ve)*Ue,Math.cos(ve)*Ue,R.x,R.y]);at.multiplySelf(new DOMMatrix(R.shape.matrix));var Tt=C.createPattern(y.transform(R.shape.bitmap),"no-repeat");Tt.setTransform(at),C.globalAlpha=1-ee,C.fillStyle=Tt,C.fillRect(R.x-rt/2,R.y-$e/2,rt,$e),C.globalAlpha=1}else if(R.shape==="circle")C.ellipse?C.ellipse(R.x,R.y,Math.abs(me-Z)*R.ovalScalar,Math.abs(de-ue)*R.ovalScalar,Math.PI/10*R.wobble,0,2*Math.PI):O(C,R.x,R.y,Math.abs(me-Z)*R.ovalScalar,Math.abs(de-ue)*R.ovalScalar,Math.PI/10*R.wobble,0,2*Math.PI);else if(R.shape==="star")for(var Pe=Math.PI/2*3,pt=4*R.scalar,Gt=8*R.scalar,ye=R.x,Ae=R.y,Le=5,Et=Math.PI/Le;Le--;)ye=R.x+Math.cos(Pe)*Gt,Ae=R.y+Math.sin(Pe)*Gt,C.lineTo(ye,Ae),Pe+=Et,ye=R.x+Math.cos(Pe)*pt,Ae=R.y+Math.sin(Pe)*pt,C.lineTo(ye,Ae),Pe+=Et;else C.moveTo(Math.floor(R.x),Math.floor(R.y)),C.lineTo(Math.floor(R.wobbleX),Math.floor(ue)),C.lineTo(Math.floor(me),Math.floor(de)),C.lineTo(Math.floor(Z),Math.floor(R.wobbleY));return C.closePath(),C.fill(),R.tick<R.totalTicks}function L(C,R,ee,Z,ue){var me=R.slice(),de=C.getContext("2d"),ve,Te,Ue=p(function(rt){function $e(){ve=Te=null,de.clearRect(0,0,Z.width,Z.height),y.clear(),ue(),rt()}function at(){r&&!(Z.width===a.width&&Z.height===a.height)&&(Z.width=C.width=a.width,Z.height=C.height=a.height),!Z.width&&!Z.height&&(ee(C),Z.width=C.width,Z.height=C.height),de.clearRect(0,0,Z.width,Z.height),me=me.filter(function(Tt){return q(de,Tt)}),me.length?ve=v.frame(at):$e()}ve=v.frame(at),Te=$e});return{addFettis:function(rt){return me=me.concat(rt),Ue},canvas:C,promise:Ue,reset:function(){ve&&v.cancel(ve),Te&&Te()}}}function je(C,R){var ee=!C,Z=!!k(R||{},"resize"),ue=!1,me=k(R,"disableForReducedMotion",Boolean),de=l&&!!k(R||{},"useWorker"),ve=de?E():null,Te=ee?M:N,Ue=C&&ve?!!C.__confetti_initialized:!1,rt=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,$e;function at(Pe,pt,Gt){for(var ye=k(Pe,"particleCount",P),Ae=k(Pe,"angle",Number),Le=k(Pe,"spread",Number),Et=k(Pe,"startVelocity",Number),Nn=k(Pe,"decay",Number),Pn=k(Pe,"gravity",Number),ns=k(Pe,"drift",Number),Vr=k(Pe,"colors",W),Na=k(Pe,"ticks",Number),xt=k(Pe,"shapes"),lt=k(Pe,"scalar"),kn=!!k(Pe,"flat"),$t=re(Pe),ki=ye,Di=[],Js=C.width*$t.x,er=C.height*$t.y;ki--;)Di.push(B({x:Js,y:er,angle:Ae,spread:Le,startVelocity:Et,color:Vr[ki%Vr.length],shape:xt[z(0,xt.length)],ticks:Na,decay:Nn,gravity:Pn,drift:ns,scalar:lt,flat:kn}));return $e?$e.addFettis(Di):($e=L(C,Di,Te,pt,Gt),$e.promise)}function Tt(Pe){var pt=me||k(Pe,"disableForReducedMotion",Boolean),Gt=k(Pe,"zIndex",Number);if(pt&&rt)return p(function(Et){Et()});ee&&$e?C=$e.canvas:ee&&!C&&(C=I(Gt),document.body.appendChild(C)),Z&&!Ue&&Te(C);var ye={width:C.width,height:C.height};ve&&!Ue&&ve.init(C),Ue=!0,ve&&(C.__confetti_initialized=!0);function Ae(){if(ve){var Et={getBoundingClientRect:function(){if(!ee)return C.getBoundingClientRect()}};Te(Et),ve.postMessage({resize:{width:Et.width,height:Et.height}});return}ye.width=ye.height=null}function Le(){$e=null,Z&&(ue=!1,e.removeEventListener("resize",Ae)),ee&&C&&(document.body.contains(C)&&document.body.removeChild(C),C=null,Ue=!1)}return Z&&!ue&&(ue=!0,e.addEventListener("resize",Ae,!1)),ve?ve.fire(Pe,ye,Le):at(Pe,ye,Le)}return Tt.reset=function(){ve&&ve.reset(),$e&&$e.reset()},Tt}var Ce;function te(){return Ce||(Ce=je(null,{useWorker:!0,resize:!0})),Ce}function he(C,R,ee,Z,ue,me,de){var ve=new Path2D(C),Te=new Path2D;Te.addPath(ve,new DOMMatrix(R));var Ue=new Path2D;return Ue.addPath(Te,new DOMMatrix([Math.cos(de)*ue,Math.sin(de)*ue,-Math.sin(de)*me,Math.cos(de)*me,ee,Z])),Ue}function ge(C){if(!u)throw new Error("path confetti are not supported in this browser");var R,ee;typeof C=="string"?R=C:(R=C.path,ee=C.matrix);var Z=new Path2D(R),ue=document.createElement("canvas"),me=ue.getContext("2d");if(!ee){for(var de=1e3,ve=de,Te=de,Ue=0,rt=0,$e,at,Tt=0;Tt<de;Tt+=2)for(var Pe=0;Pe<de;Pe+=2)me.isPointInPath(Z,Tt,Pe,"nonzero")&&(ve=Math.min(ve,Tt),Te=Math.min(Te,Pe),Ue=Math.max(Ue,Tt),rt=Math.max(rt,Pe));$e=Ue-ve,at=rt-Te;var pt=10,Gt=Math.min(pt/$e,pt/at);ee=[Gt,0,0,Gt,-Math.round($e/2+ve)*Gt,-Math.round(at/2+Te)*Gt]}return{type:"path",path:R,matrix:ee}}function Qe(C){var R,ee=1,Z="#000000",ue='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof C=="string"?R=C:(R=C.text,ee="scalar"in C?C.scalar:ee,ue="fontFamily"in C?C.fontFamily:ue,Z="color"in C?C.color:Z);var me=10*ee,de=""+me+"px "+ue,ve=new OffscreenCanvas(me,me),Te=ve.getContext("2d");Te.font=de;var Ue=Te.measureText(R),rt=Math.ceil(Ue.actualBoundingBoxRight+Ue.actualBoundingBoxLeft),$e=Math.ceil(Ue.actualBoundingBoxAscent+Ue.actualBoundingBoxDescent),at=2,Tt=Ue.actualBoundingBoxLeft+at,Pe=Ue.actualBoundingBoxAscent+at;rt+=at+at,$e+=at+at,ve=new OffscreenCanvas(rt,$e),Te=ve.getContext("2d"),Te.font=de,Te.fillStyle=Z,Te.fillText(R,Tt,Pe);var pt=1/ee;return{type:"bitmap",bitmap:ve.transferToImageBitmap(),matrix:[pt,0,0,pt,-rt*pt/2,-$e*pt/2]}}t.exports=function(){return te().apply(this,arguments)},t.exports.reset=function(){te().reset()},t.exports.create=je,t.exports.shapeFromPath=ge,t.exports.shapeFromText=Qe})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),ou,!1);const mb=ou.exports;ou.exports.create;function g4({game:n,currentPlayerId:e}){const t=n.winner!==void 0?n.winner:n.players.findIndex(l=>!l.eliminated),r=t!==-1?n.players[t]:void 0,a=(r==null?void 0:r.id)===e;return Ee.useEffect(()=>{const l=["#bb0000","#ffffff","#0000bb"];setTimeout(()=>{mb({particleCount:a?40:20,angle:60,spread:55,origin:{x:Math.random()*.3,y:Math.random()*.3},colors:l,startVelocity:30+Math.random()*20}),mb({particleCount:a?40:20,angle:120,spread:55,origin:{x:.7+Math.random()*.3,y:Math.random()*.3},colors:l,startVelocity:30+Math.random()*20})},300)},[]),null}function p4({title:n,message:e,confirmText:t="Confirm",cancelText:r="Cancel",onConfirm:a,onCancel:l}){return w.jsxs("div",{className:"absolute inset-0 z-50 flex items-center justify-center animate-in fade-in",children:[w.jsx("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm",onClick:l}),w.jsxs("div",{className:"relative bg-zinc-900 rounded-xl border border-zinc-800/50 w-full max-w-sm mx-4 shadow-2xl animate-in fade-in zoom-in-95",children:[w.jsx("div",{className:"absolute left-1/2 -translate-x-1/2 -top-6",children:w.jsx("div",{className:"w-12 h-12 rounded-full bg-amber-500/20 flex items-center justify-center",children:w.jsx(bO,{className:"w-6 h-6 text-amber-500"})})}),w.jsxs("div",{className:"p-6 pt-8",children:[w.jsx("h3",{className:"text-lg font-bold text-white text-center mb-2",children:n}),w.jsx("p",{className:"text-zinc-400 text-center mb-6",children:e}),w.jsxs("div",{className:"flex gap-3 justify-center",children:[w.jsx("button",{onClick:l,className:"px-4 py-2 rounded-lg bg-zinc-800 text-white hover:bg-zinc-700 transition-colors",children:r}),w.jsx("button",{onClick:a,className:"px-4 py-2 rounded-lg bg-amber-600 text-white hover:bg-amber-500 transition-colors",children:t})]})]})]})]})}function m4(){const n=[{name:"Income",type:"income",description1:"Take $1M from the Treasury",description2:"",canBeBlocked:!1,canBeChallenged:!1,icon:nf},{name:"Foreign Aid",type:"foreign-aid",description1:"Take $2M from the Treasury",description2:"",canBeBlocked:!0,canBeChallenged:!1,blockedBy:["Banker"],icon:tx},{name:"Scandal",type:"scandal",cost:7,description1:"Pay $7M. Choose a player to lose 1 card. Mandatory if your balance is $10M+",description2:"",canBeBlocked:!1,canBeChallenged:!1,icon:au}],e=[{name:"Banker",type:"banker",card:"Banker",description1:"Take $3M from the Treasury",description2:"",canBeBlocked:!1,cardImage:Jo},{name:"Mafia",type:"steal",card:"Mafia",description1:"Steal up to $2M from target player",description2:"",canBeBlocked:!0,blockedBy:["Mafia","Reporter","Police"],cardImage:tl},{name:"Hacker",type:"hack",card:"Hacker",cost:3,description1:"Pay $3M to force a target player to lose 1 card. If blocked, hack fails, but the Hackers fee is not refunded.",description2:"",canBeBlocked:!0,blockedBy:["Judge"],cardImage:el},{name:"Reporter",type:"exchange",card:"Reporter",description1:"Draw 2 cards from the deck. You may exchange one or both with your face-down cards. Then return 2 cards to the deck.",description2:"",canBeBlocked:!1,cardImage:nl},{name:"Police",type:"police",card:"Police",description1:"Investigate: Look at one of a target player's face-down cards. You may either  Let them keep it or  Force them to discard it and draw a new card from the deck",description2:"Swap: Draw 1 card from the deck. You may swap it with one of your face-down cards. Then return 1 card to the deck.",canBeBlocked:!1,cardImage:Sa},{name:"Judge",type:"judge",card:"Judge",description1:"Targeted player may claim the Judge to block Hacker. ",description2:"",isDefensive:!0,canBeChallenged:!0,cardImage:sl}];return w.jsx("div",{className:"mx-auto p-1",children:w.jsxs("div",{className:"flex flex-col gap-1",children:[[...n,...e].map((t,r)=>w.jsxs("div",{className:"flex items-start gap-2 px-2 py-2.5 rounded-md bg-[#2a2a2a]/40",children:[t.cardImage&&w.jsx("div",{className:"w-7 h-10 flex-shrink-0 flex items-center justify-center overflow-hidden",children:w.jsx("img",{src:t.cardImage,alt:t.card||t.name,className:"w-full h-full object-cover rounded-sm"})}),t.icon&&w.jsx("div",{className:"w-7 h-7 flex-shrink-0 flex items-center justify-center overflow-hidden",children:w.jsx(t.icon,{className:"w-5 h-5 text-slate-400"})}),w.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("h3",{className:"text-xs font-semibold text-slate-200 leading-snug",children:t.name}),w.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.blockedBy&&w.jsxs("span",{className:"flex items-center gap-1 text-[9px] px-2 py-0.5 bg-red-500/10 text-red-400 rounded-full border border-red-400",children:[w.jsx(cb,{className:"w-2.5 h-2.5"})," ",t.blockedBy.join(", ")]}),t.isDefensive&&w.jsx("span",{className:"flex items-center gap-1 text-[9px] px-2 py-0.5 bg-purple-400/10 text-purple-400 rounded-full border border-purple-400",children:"Defensive"}),t.canBeChallenged!==!1?w.jsx("span",{className:"flex items-center gap-1 text-[9px] px-2 py-0.5 bg-yellow-500/10 text-yellow-400 rounded-full border border-yellow-400",children:w.jsx(cm,{className:"w-2.5 h-2.5"})}):null]})]}),w.jsxs("div",{children:[w.jsx("p",{className:"text-[10px] text-slate-300 leading-tight",children:t.description1}),t.description2&&w.jsxs(w.Fragment,{children:[w.jsxs("div",{className:"flex items-center my-0.5 w-12",children:[w.jsx("div",{className:"flex-grow border-t border-slate-400"}),w.jsx("span",{className:"px-1 text-[8px] text-slate-400",children:"OR"}),w.jsx("div",{className:"flex-grow border-t border-slate-400"})]}),w.jsx("p",{className:"text-[10px] text-slate-300 leading-tight",children:t.description2})]})]})]})]},r)),w.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-2 text-xs text-slate-400 mt-1",children:[w.jsxs("span",{className:"flex items-center gap-1 text-[9px] px-2 py-0.5 bg-red-500/10 text-red-400 rounded-full border border-red-400",children:[w.jsx(cb,{className:"w-2.5 h-2.5"})," Can be Blocked by"]}),w.jsxs("span",{className:"flex items-center gap-1 text-[9px] px-2 py-0.5 bg-yellow-500/10 text-yellow-400 rounded-full border border-yellow-400",children:[w.jsx(cm,{className:"w-2.5 h-2.5"})," Can be Challenged"]})]}),w.jsx("div",{className:"flex flex-wrap items-center justify-center mt-1",children:w.jsxs("a",{href:"https://conflictologygames.com/rules",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1 text-blue-500 hover:underline text-[10px]",children:["Full Rules ",w.jsx(XM,{className:"w-3 h-3"})]})})]})})}function y4(n,e){const t=Ee.useRef({});return Ee.useMemo(()=>({getGameState:r=>{var u,f,g;if(!n)return"waiting_for_others";const a=n.actionInProgress;if(a){if(a.losingPlayer===r){if(t.current[r]!=="waiting_for_influence_loss"){const p=n.players[r].name,y=ps(_n,"games",n.id);setTimeout(()=>{Ks(y,{logs:fi(ce.createSystemLog(J.system.loseInfluence(p)))}).catch(v=>console.error("Failed to add lose influence message:",v))},0)}return t.current[r]="waiting_for_influence_loss","waiting_for_influence_loss"}return a.type==="exchange"&&a.player===r&&a.exchangeCards||a.type==="swap"&&a.player===r&&a.exchangeCards?(t.current[r]="waiting_for_exchange","waiting_for_exchange"):a.type==="investigate"&&a.target===r&&!a.investigateCard&&!a.challengeInProgress&&((u=a.responses[r])==null?void 0:u.type)==="allow"?(t.current[r]="waiting_for_card_selection","waiting_for_card_selection"):a.type==="investigate"&&a.player===r&&a.investigateCard?(t.current[r]="waiting_for_investigate_decision","waiting_for_investigate_decision"):(a.type==="exchange"||a.type==="swap")&&a.exchangeCards||a.type==="investigate"&&(((f=a.responses[r])==null?void 0:f.type)==="allow"||a.target!==void 0&&((g=a.responses[a.target])==null?void 0:g.type)==="allow"||a.investigateCard)?(t.current[r]="waiting_for_others","waiting_for_others"):a.player===r?a.blockingPlayer!==void 0?(t.current[r]="waiting_for_response","waiting_for_response"):(t.current[r]="waiting_for_others","waiting_for_others"):(t.current[r]="waiting_for_response","waiting_for_response")}if(e)return t.current[r]="waiting_for_target","waiting_for_target";const l=n.currentTurn===r?"waiting_for_action":"waiting_for_turn";return t.current[r]=l,l},getResponseOptions:r=>{if(!(n!=null&&n.actionInProgress))return null;const{actionInProgress:a}=n,l=a.type,u=a.target===r;if(a.blockingPlayer!==void 0&&(a.player===r||a.blockingPlayer!==r))return{showBlock:!1,showChallenge:!0,showAllow:!0,blockText:"",challengeText:"Challenge",allowText:"Allow"};if(a.player!==r){let f=[],g=!0,p=!1;switch(l){case"foreign-aid":f=["Banker"],p=!0,g=!1;break;case"steal":f=["Mafia","Reporter","Police"],p=u;break;case"hack":f=["Judge"],p=u;break;case"banker":case"exchange":case"investigate":case"swap":p=!1;break;case"income":case"scandal":p=!1,g=!1;break;default:p=!1}const y=f.length>0?f:["Banker"],v=y.length===1?y[0]:"";return{showBlock:p,showChallenge:g,showAllow:!0,blockText:v,challengeText:"Challenge",allowText:"Allow",blockCards:y}}return null},shouldShowResponseButtons:r=>{var l,u,f;if(!(n!=null&&n.actionInProgress)||(l=n.players[r])!=null&&l.eliminated)return!1;const{actionInProgress:a}=n;return a.responses[r]||a.losingPlayer===r||a.challengeInProgress||a.losingPlayer!==void 0||a.exchangeCards&&(a.player===r||a.type==="exchange"||a.type==="swap")||a.exchangeCards||a.type==="investigate"&&(((u=a.responses[r])==null?void 0:u.type)==="allow"||a.target!==void 0&&((f=a.responses[a.target])==null?void 0:f.type)==="allow"||a.investigateCard)?!1:a.blockingPlayer!==void 0?a.player===r||a.blockingPlayer!==r:a.player!==r},isPlayerTargetable:(r,a)=>{var u;return!n||!e||(u=n.players[a])!=null&&u.eliminated?!1:e==="investigate"?n.cards.some(g=>g.playerId===a&&g.location==="player"&&!g.revealed)&&a!==r:["steal","hack","scandal","investigate"].includes(e)&&a!==r}}),[n,e])}function _4({actionType:n,onCancel:e}){const t=u=>{switch(u){case"hack":return"Hack";case"steal":return"Steal";case"scandal":return"Scandal";default:return u.charAt(0).toUpperCase()+u.slice(1)}},a=(u=>{switch(u){case"hack":return{icon:"text-red-500",border:"border-red-500/20",shadow:"shadow-red-500/10",bgHint:"bg-red-900/70",iconHint:"text-red-300"};case"steal":return{icon:"text-blue-500",border:"border-blue-500/20",shadow:"shadow-blue-500/10",bgHint:"bg-blue-900/70",iconHint:"text-blue-300"};case"scandal":return{icon:"text-amber-500",border:"border-amber-500/20",shadow:"shadow-amber-500/10",bgHint:"bg-amber-900/70",iconHint:"text-amber-300"};default:return{icon:"text-gray-500",border:"border-gray-500/20",shadow:"shadow-gray-500/10",bgHint:"bg-gray-900/70",iconHint:"text-gray-300"}}})(n),l=t(n);return w.jsx("div",{className:"relative z-40 pointer-events-none",children:w.jsx("div",{className:`absolute bottom-44
       inset-x-0 flex justify-center pointer-events-auto`,children:w.jsxs("div",{className:`
          ${a.bgHint} backdrop-blur-md 
          px-4 py-2 rounded-full
          border ${a.border}
          shadow-lg 
          animate-in fade-in slide-in-from-bottom-4
          flex items-center gap-3
          max-w-[90%]
        `,children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx(wO,{className:`w-4 h-4 ${a.icon}`}),w.jsx("span",{className:"text-white text-sm font-medium",children:l})]}),w.jsx("div",{className:"h-4 w-px bg-white/20"}),w.jsxs("div",{className:"flex items-center gap-1.5",children:[w.jsx(CO,{className:`w-3.5 h-3.5 ${a.iconHint}`}),w.jsx("span",{className:"text-white/90 text-xs whitespace-nowrap",children:"Tap to target"})]}),w.jsx("button",{onClick:e,className:"w-5 h-5 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-colors ml-1","aria-label":"Cancel target selection",children:w.jsx(Ny,{className:"w-3 h-3 text-white/80"})})]})})})}const v4="/assets/desk-bg-2-CYjzVa5T.png";function w4({gameId:n,playerId:e,onReturnToLobby:t}){var Gt;const[r,a]=Ee.useState(!1),[l,u]=Ee.useState(null),[f,g]=Ee.useState(null),[p,y]=Ee.useState(!1),[v,E]=Ee.useState(!1),[S,D]=Ee.useState(!1),j=Ee.useRef(null),k=Ee.useRef(null),{game:P,performAction:z,respondToAction:U,startGame:W,isGameOver:ne,leaveGame:re,startNewMatch:M,wasKicked:N}=tf(n,e),I=y4(P,l==null?void 0:l.type);Ee.useEffect(()=>{N&&t&&(console.log("Player was kicked! Returning to lobby from GameView"),t())},[N,t]),Ee.useEffect(()=>{function ye(Ae){var Le;(Le=j.current)!=null&&Le.contains(Ae.target)||k.current&&!k.current.contains(Ae.target)&&a(!1)}return document.addEventListener("mousedown",ye),()=>document.removeEventListener("mousedown",ye)},[]);const[O,B]=Ee.useState(!1),[q,L]=Ee.useState(!1);if(Ee.useEffect(()=>{var Le;if(!P||!e)return;const ye=P.players.findIndex(Et=>Et.id===e),Ae=P.currentTurn===ye&&!((Le=P.players[ye])!=null&&Le.eliminated);if(!Ae){B(!1),L(!1);return}if(Ae){L(!1),B(!0);const Et=setTimeout(()=>{L(!0),setTimeout(()=>B(!1),500)},1500);return()=>{clearTimeout(Et)}}},[P==null?void 0:P.currentTurn,P==null?void 0:P.id,P==null?void 0:P.status]),!P)return w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80",children:w.jsx(Rn,{className:"w-12 h-12 text-zinc-800 animate-spin"})});const je=P.players.find(ye=>ye.id===e);if(!je)return w.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/80",children:w.jsx(Rn,{className:"w-12 h-12 text-zinc-800 animate-spin"})});if(P.status==="waiting"||je.tempViewState==="lobby")return w.jsx(f4,{game:P,isHost:je.id===((Gt=P.players[0])==null?void 0:Gt.id),currentPlayerId:e,onStartGame:P.winner!==void 0?M:W,onReturnToMainMenu:t||(()=>{})});const Ce=P.players.findIndex(ye=>ye.id===e),te=P.currentTurn===Ce&&!je.eliminated,he=te&&!P.actionUsedThisTurn,ge=P.actionInProgress,Qe=async ye=>{if(!(!he||je.eliminated||S)){if(ye.cost&&je.coins<ye.cost){console.error(`Not enough coins for ${ye.type}. Need ${ye.cost}, have ${je.coins}`);return}if(u(ye),g(null),["steal","hack","scandal","investigate"].includes(ye.type))a(!1);else{D(!0);try{await z(Ce,ye),u(null)}catch(Ae){console.error("Failed to perform action:",Ae)}finally{D(!1)}}}},C=async ye=>{if(l&&["steal","hack","scandal","investigate"].includes(l.type)&&!S){g(ye),D(!0);try{const Ae={...l,target:ye};await z(Ce,Ae),u(null),g(null)}catch(Ae){console.error("Failed to target player:",Ae)}finally{D(!1)}}},R=()=>{u(null),g(null)},ee=async(ye,Ae)=>{if(!(!ge||je.eliminated||S)){D(!0);try{let Le={type:ye,playerId:Ce};Ae&&ye==="block"&&(Le.card=Ae),await U(Ce,Le)}catch(Le){console.error("Failed to respond:",Le)}finally{D(!1)}}},Z=async ye=>{if(!(!ge||S)){D(!0);try{const Ae=ge.loseTwo;await U(Ce,{type:"lose_influence",playerId:Ce,card:ye}),Ae?setTimeout(()=>{D(!1)},100):D(!1)}catch(Ae){console.error("Failed to lose influence:",Ae),D(!1)}}},ue=async ye=>{if(!P||!P.actionInProgress||!P.actionInProgress.exchangeCards||S){console.error("Exchange/Swap attempted without proper game state or action in progress");return}if(P.actionInProgress.type!=="exchange"&&P.actionInProgress.type!=="swap"||P.actionInProgress.player!==Ce){console.error("Exchange/Swap attempted by the wrong player or with wrong action type");return}if(!Array.isArray(P.actionInProgress.exchangeCards)||P.actionInProgress.exchangeCards.length===0){console.error("Exchange/Swap attempted with no cards available");return}const Ae=P.players[P.actionInProgress.player],Le=pe.getPlayerCards(P.cards,Ae.id).length;if(ye.length!==Le){console.error(`Wrong number of cards selected: got ${ye.length}, expected ${Le}`);return}D(!0);try{await U(Ce,{type:"exchange_selection",playerId:Ce,selectedIndices:ye})}catch(Et){console.error("Failed to exchange/swap cards:",Et)}finally{D(!1)}},me=async ye=>{if(!P||!P.actionInProgress||P.actionInProgress.type!=="investigate"||S){console.error("Investigation card selection attempted without proper game state or action in progress");return}if(P.actionInProgress.target!==Ce){console.error("Investigation card selection attempted by the wrong player");return}D(!0);try{await U(Ce,{type:"select_card_for_investigation",playerId:Ce,card:ye})}catch(Ae){console.error("Failed to select card for investigation:",Ae)}finally{D(!1)}},de=async ye=>{if(!P||!P.actionInProgress||P.actionInProgress.type!=="investigate"||!P.actionInProgress.investigateCard||S){console.error("Investigation decision attempted without proper game state or action in progress");return}if(P.actionInProgress.player!==Ce){console.error("Investigation decision attempted by the wrong player");return}D(!0);try{await U(Ce,{type:"investigate_decision",playerId:Ce,keepCard:ye})}catch(Ae){console.error("Failed to complete investigation decision:",Ae)}finally{D(!1)}},ve=ye=>{const Ae=P.players[ye];return!!(l&&["steal","hack","scandal","investigate"].includes(l.type)&&ye!==Ce&&!Ae.eliminated)},Te=()=>I.getGameState(Ce),Ue=()=>I.shouldShowResponseButtons(Ce),rt=()=>I.getResponseOptions(Ce),at=(()=>{const ye=P.players.length;if(ye<=1)return[];const Ae=[],Le=[];for(let Pn=1;Pn<ye;Pn++){const ns=(Ce+Pn)%ye;ns!==Ce&&Le.push({index:ns,player:P.players[ns]||null})}const Et=Le.length;let Nn=[];Et===1?Nn=[0]:Et<=3?Nn=[4,0,1,2]:Nn=[3,4,0,1,2];for(let Pn=0;Pn<Math.min(Le.length,Nn.length);Pn++)Ae.push({index:Le[Pn].index,player:Le[Pn].player,position:Nn[Pn]});return Ae})(),Tt=ye=>{switch(ye){case 0:return"top-0 left-1/2 -translate-x-1/2";case 1:return"top-20 right-8";case 2:return"top-44 right-8";case 3:return"top-44 left-8";case 4:return"top-20 left-8";default:return""}},Pe=rt(),pt=Te();return w.jsxs("div",{className:"h-full flex flex-col relative",children:[w.jsxs("div",{className:"absolute inset-0 z-0 overflow-hidden",children:[w.jsx("img",{src:v4,alt:"Game Table Background",className:"object-cover w-full h-full"}),w.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent z-10"})]}),O&&w.jsx("div",{className:"absolute top-[25%] left-0 right-0 z-30 pointer-events-none flex justify-center items-center",children:w.jsx("img",{src:KO,alt:"Your Turn",className:`max-w-[240px] ${q?"animate-[fadeSlideOut_0.5s_ease-in_forwards]":"animate-[fadeSlideIn_0.7s_ease-out]"}`,style:{filter:"drop-shadow(0 10px 25px rgba(251, 191, 36, 0.5))"}})}),w.jsx("button",{className:"w-10 h-10 bg-zinc-900/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-zinc-800 transition-colors absolute left-4 top-4 z-30 border border-zinc-800/30",onClick:async()=>{if(P.status==="playing"&&!je.eliminated){const ye=ps(_n,"games",P.id),Ae=P.players.findIndex(Le=>Le.id===e);if(Ae!==-1){const Le=[...P.players];Le[Ae]={...Le[Ae],tempViewState:"lobby"},await Ks(ye,{players:Le})}}else t==null||t()},children:w.jsx(Iy,{className:"w-5 h-5 text-white/80"})}),w.jsx("button",{className:"w-10 h-10 bg-zinc-900/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-zinc-800 transition-colors absolute right-4 top-4 z-30 border border-zinc-800/30",onClick:()=>E(!0),children:w.jsx(nO,{className:"w-5 h-5 text-white/80"})}),v&&w.jsxs("div",{className:"absolute inset-0 bg-[#1a1a1a] z-50 animate-in fade-in",children:[w.jsx("button",{onClick:()=>E(!1),className:"w-10 h-10 bg-zinc-900/90 backdrop-blur-sm rounded-full flex items-center justify-center hover:bg-zinc-800 transition-colors absolute right-4 top-4 z-60 border border-zinc-800/30",children:w.jsx(Ny,{className:"w-5 h-5 text-white/80"})}),w.jsx("div",{className:"h-full overflow-auto p-2",children:w.jsx(m4,{})})]}),w.jsxs("div",{className:"flex-1 flex flex-col min-h-0 mt-6 relative z-20",children:[w.jsx("div",{className:"h-72 relative",children:at.map(({player:ye,index:Ae,position:Le})=>w.jsx("div",{className:`absolute ${Tt(Le)}`,children:ye?w.jsx(ZO,{player:ye,cards:P.cards,isActive:P.currentTurn===Ae&&!ye.eliminated,isTargetable:ve(Ae),isTargeted:f===Ae,onTargetSelect:()=>C(Ae),isCurrentPlayer:ye.id===e}):w.jsx(JO,{})},Ae))}),w.jsxs("div",{className:"flex-1 px-4 overflow-y-auto min-h-0 backdrop-blur-sm rounded-t-xl",children:[w.jsx(WO,{logs:P.logs,currentPlayer:je.name,currentPlayerColor:je.color,gameState:pt,selectedAction:l==null?void 0:l.name,game:P}),Pe&&Ue()&&w.jsx(r4,{onBlock:ye=>ee("block",ye),onChallenge:()=>ee("challenge"),onAllow:()=>ee("allow"),visible:!0,showBlock:Pe.showBlock,showChallenge:Pe.showChallenge,showAllow:Pe.showAllow,blockText:Pe.blockText,challengeText:Pe.challengeText,allowText:Pe.allowText,blockCards:Pe.blockCards||[]})]}),w.jsxs("div",{className:"h-32 relative mt-auto mb-2",children:[w.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/20 to-transparent pointer-events-none"}),w.jsx("div",{className:"absolute inset-x-0 bottom-0 px-6 pb-6",children:w.jsxs("div",{className:"flex justify-between items-end",children:[w.jsx("div",{className:"z-20",children:w.jsx(t4,{player:je})}),w.jsx("div",{className:"absolute left-[56%] bottom-6 transform -translate-x-1/2 z-10",children:w.jsx(s4,{playerId:e,cards:P.cards})}),w.jsxs("div",{className:"z-20 relative mr-2",children:[je.eliminated?w.jsx("div",{className:"w-14 h-14 rounded-full bg-red-500/20 flex items-center justify-center",children:w.jsx(au,{className:"w-8 h-8 text-red-500"})}):w.jsx(rx,{ref:j,onClick:()=>{S||(l&&(u(null),g(null)),a(!r))},disabled:!he||pt==="waiting_for_influence_loss"||S,canTakeAction:he,isCurrentTurn:te,gameActionUsedThisTurn:!!P.actionUsedThisTurn,isActionInProgress:S,showActions:r,gameState:pt}),r&&!je.eliminated&&w.jsx("div",{ref:k,className:"absolute bottom-full right-0 mb-2 z-50",style:{filter:"drop-shadow(0 20px 30px rgba(0, 0, 0, 0.3))"},children:w.jsx(e4,{onClose:()=>a(!1),onActionSelect:Qe,playerCoins:je.coins})})]})]})})]})]}),pt==="waiting_for_influence_loss"&&w.jsx(a4,{cards:P.cards,playerId:je.id,onCardSelect:Z}),pt==="waiting_for_exchange"&&(ge==null?void 0:ge.exchangeCards)&&w.jsx(o4,{cards:P.cards,playerId:P.players[ge.player].id,exchangeCardIds:ge.exchangeCards,onExchangeComplete:ue}),pt==="waiting_for_card_selection"&&(ge==null?void 0:ge.type)==="investigate"&&w.jsx(c4,{cards:P.cards,playerId:e,onCardSelect:me}),pt==="waiting_for_investigate_decision"&&(ge==null?void 0:ge.type)==="investigate"&&(ge==null?void 0:ge.investigateCard)&&w.jsx(h4,{card:P.cards[ge.investigateCard.cardIndex].name,targetName:P.players[ge.target].name,onDecision:de}),w.jsx("div",{className:"pointer-events-none relative",children:l&&["steal","hack","scandal","investigate"].includes(l.type)&&w.jsx(_4,{actionType:l.type,onCancel:R})}),ne&&w.jsx("div",{className:"absolute inset-0 z-50",children:w.jsx(g4,{game:P,currentPlayerId:e,onVoteNextMatch:()=>{},onLeaveGame:()=>{}})}),p&&w.jsx(p4,{title:"Leave Game",message:"Are you sure you want to leave the game? You will forfeit the match and be removed from the game.",confirmText:"Leave Game",cancelText:"Stay",onConfirm:async()=>{try{await re(Ce),y(!1),t==null||t()}catch(ye){console.error("Error leaving game:",ye),y(!1),t==null||t()}},onCancel:()=>y(!1)})]})}function T4(){const[n,e]=Ee.useState("lobby"),[t,r]=Ee.useState(null),[a,l]=Ee.useState(Math.floor(Math.random()*1e3)),{game:u,wasKicked:f}=tf(t||void 0,t?a:void 0);Ee.useEffect(()=>{(async()=>{const v=await zO();if(v!==null)l(v);else{const E=Math.floor(Math.random()*1e3);l(E),UO(E)}})()},[]);const g=y=>{r(y),e("game")},p=()=>{r(null),e("lobby")};return Ee.useEffect(()=>{u!=null&&u.redirectToLobby&&p()},[u==null?void 0:u.redirectToLobby]),Ee.useEffect(()=>{f&&(console.log("Player was kicked! Returning to lobby..."),p())},[f]),w.jsx("div",{className:"h-full bg-zinc-900 p-0 overflow-y-auto",children:w.jsx("div",{className:"w-full min-h-[740px] h-full  max-w-[360px] mx-auto bg-zinc-900 relative shadow-lg",children:w.jsx("div",{className:"relative h-full",children:n==="lobby"?w.jsx($O,{onGameStart:g,playerId:a}):w.jsx(w4,{gameId:t,playerId:a,onReturnToLobby:p})})})})}UC.createRoot(document.getElementById("app")).render(w.jsx(Ee.StrictMode,{children:w.jsx(T4,{})}))});export default b4();
