var background = function() {
  "use strict";
  var _a, _b;
  function defineBackground(arg) {
    if (arg == null || typeof arg === "function") return { main: arg };
    return arg;
  }
  const getDefaultsFromPostinstall = () => void 0;
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const CONSTANTS = {
    /**
     * @define {boolean} Whether this is the Admin Node.js SDK.
     */
    NODE_ADMIN: false,
    /**
     * Firebase SDK Version
     */
    SDK_VERSION: "${JSCORE_VERSION}"
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const assert = function(assertion, message) {
    if (!assertion) {
      throw assertionError(message);
    }
  };
  const assertionError = function(message) {
    return new Error("Firebase Database (" + CONSTANTS.SDK_VERSION + ") INTERNAL ASSERT FAILED: " + message);
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const stringToByteArray$1 = function(str) {
    const out = [];
    let p = 0;
    for (let i = 0; i < str.length; i++) {
      let c = str.charCodeAt(i);
      if (c < 128) {
        out[p++] = c;
      } else if (c < 2048) {
        out[p++] = c >> 6 | 192;
        out[p++] = c & 63 | 128;
      } else if ((c & 64512) === 55296 && i + 1 < str.length && (str.charCodeAt(i + 1) & 64512) === 56320) {
        c = 65536 + ((c & 1023) << 10) + (str.charCodeAt(++i) & 1023);
        out[p++] = c >> 18 | 240;
        out[p++] = c >> 12 & 63 | 128;
        out[p++] = c >> 6 & 63 | 128;
        out[p++] = c & 63 | 128;
      } else {
        out[p++] = c >> 12 | 224;
        out[p++] = c >> 6 & 63 | 128;
        out[p++] = c & 63 | 128;
      }
    }
    return out;
  };
  const byteArrayToString = function(bytes) {
    const out = [];
    let pos = 0, c = 0;
    while (pos < bytes.length) {
      const c1 = bytes[pos++];
      if (c1 < 128) {
        out[c++] = String.fromCharCode(c1);
      } else if (c1 > 191 && c1 < 224) {
        const c2 = bytes[pos++];
        out[c++] = String.fromCharCode((c1 & 31) << 6 | c2 & 63);
      } else if (c1 > 239 && c1 < 365) {
        const c2 = bytes[pos++];
        const c3 = bytes[pos++];
        const c4 = bytes[pos++];
        const u = ((c1 & 7) << 18 | (c2 & 63) << 12 | (c3 & 63) << 6 | c4 & 63) - 65536;
        out[c++] = String.fromCharCode(55296 + (u >> 10));
        out[c++] = String.fromCharCode(56320 + (u & 1023));
      } else {
        const c2 = bytes[pos++];
        const c3 = bytes[pos++];
        out[c++] = String.fromCharCode((c1 & 15) << 12 | (c2 & 63) << 6 | c3 & 63);
      }
    }
    return out.join("");
  };
  const base64 = {
    /**
     * Maps bytes to characters.
     */
    byteToCharMap_: null,
    /**
     * Maps characters to bytes.
     */
    charToByteMap_: null,
    /**
     * Maps bytes to websafe characters.
     * @private
     */
    byteToCharMapWebSafe_: null,
    /**
     * Maps websafe characters to bytes.
     * @private
     */
    charToByteMapWebSafe_: null,
    /**
     * Our default alphabet, shared between
     * ENCODED_VALS and ENCODED_VALS_WEBSAFE
     */
    ENCODED_VALS_BASE: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",
    /**
     * Our default alphabet. Value 64 (=) is special; it means "nothing."
     */
    get ENCODED_VALS() {
      return this.ENCODED_VALS_BASE + "+/=";
    },
    /**
     * Our websafe alphabet.
     */
    get ENCODED_VALS_WEBSAFE() {
      return this.ENCODED_VALS_BASE + "-_.";
    },
    /**
     * Whether this browser supports the atob and btoa functions. This extension
     * started at Mozilla but is now implemented by many browsers. We use the
     * ASSUME_* variables to avoid pulling in the full useragent detection library
     * but still allowing the standard per-browser compilations.
     *
     */
    HAS_NATIVE_SUPPORT: typeof atob === "function",
    /**
     * Base64-encode an array of bytes.
     *
     * @param input An array of bytes (numbers with
     *     value in [0, 255]) to encode.
     * @param webSafe Boolean indicating we should use the
     *     alternative alphabet.
     * @return The base64 encoded string.
     */
    encodeByteArray(input, webSafe) {
      if (!Array.isArray(input)) {
        throw Error("encodeByteArray takes an array as a parameter");
      }
      this.init_();
      const byteToCharMap = webSafe ? this.byteToCharMapWebSafe_ : this.byteToCharMap_;
      const output = [];
      for (let i = 0; i < input.length; i += 3) {
        const byte1 = input[i];
        const haveByte2 = i + 1 < input.length;
        const byte2 = haveByte2 ? input[i + 1] : 0;
        const haveByte3 = i + 2 < input.length;
        const byte3 = haveByte3 ? input[i + 2] : 0;
        const outByte1 = byte1 >> 2;
        const outByte2 = (byte1 & 3) << 4 | byte2 >> 4;
        let outByte3 = (byte2 & 15) << 2 | byte3 >> 6;
        let outByte4 = byte3 & 63;
        if (!haveByte3) {
          outByte4 = 64;
          if (!haveByte2) {
            outByte3 = 64;
          }
        }
        output.push(byteToCharMap[outByte1], byteToCharMap[outByte2], byteToCharMap[outByte3], byteToCharMap[outByte4]);
      }
      return output.join("");
    },
    /**
     * Base64-encode a string.
     *
     * @param input A string to encode.
     * @param webSafe If true, we should use the
     *     alternative alphabet.
     * @return The base64 encoded string.
     */
    encodeString(input, webSafe) {
      if (this.HAS_NATIVE_SUPPORT && !webSafe) {
        return btoa(input);
      }
      return this.encodeByteArray(stringToByteArray$1(input), webSafe);
    },
    /**
     * Base64-decode a string.
     *
     * @param input to decode.
     * @param webSafe True if we should use the
     *     alternative alphabet.
     * @return string representing the decoded value.
     */
    decodeString(input, webSafe) {
      if (this.HAS_NATIVE_SUPPORT && !webSafe) {
        return atob(input);
      }
      return byteArrayToString(this.decodeStringToByteArray(input, webSafe));
    },
    /**
     * Base64-decode a string.
     *
     * In base-64 decoding, groups of four characters are converted into three
     * bytes.  If the encoder did not apply padding, the input length may not
     * be a multiple of 4.
     *
     * In this case, the last group will have fewer than 4 characters, and
     * padding will be inferred.  If the group has one or two characters, it decodes
     * to one byte.  If the group has three characters, it decodes to two bytes.
     *
     * @param input Input to decode.
     * @param webSafe True if we should use the web-safe alphabet.
     * @return bytes representing the decoded value.
     */
    decodeStringToByteArray(input, webSafe) {
      this.init_();
      const charToByteMap = webSafe ? this.charToByteMapWebSafe_ : this.charToByteMap_;
      const output = [];
      for (let i = 0; i < input.length; ) {
        const byte1 = charToByteMap[input.charAt(i++)];
        const haveByte2 = i < input.length;
        const byte2 = haveByte2 ? charToByteMap[input.charAt(i)] : 0;
        ++i;
        const haveByte3 = i < input.length;
        const byte3 = haveByte3 ? charToByteMap[input.charAt(i)] : 64;
        ++i;
        const haveByte4 = i < input.length;
        const byte4 = haveByte4 ? charToByteMap[input.charAt(i)] : 64;
        ++i;
        if (byte1 == null || byte2 == null || byte3 == null || byte4 == null) {
          throw new DecodeBase64StringError();
        }
        const outByte1 = byte1 << 2 | byte2 >> 4;
        output.push(outByte1);
        if (byte3 !== 64) {
          const outByte2 = byte2 << 4 & 240 | byte3 >> 2;
          output.push(outByte2);
          if (byte4 !== 64) {
            const outByte3 = byte3 << 6 & 192 | byte4;
            output.push(outByte3);
          }
        }
      }
      return output;
    },
    /**
     * Lazy static initialization function. Called before
     * accessing any of the static map variables.
     * @private
     */
    init_() {
      if (!this.byteToCharMap_) {
        this.byteToCharMap_ = {};
        this.charToByteMap_ = {};
        this.byteToCharMapWebSafe_ = {};
        this.charToByteMapWebSafe_ = {};
        for (let i = 0; i < this.ENCODED_VALS.length; i++) {
          this.byteToCharMap_[i] = this.ENCODED_VALS.charAt(i);
          this.charToByteMap_[this.byteToCharMap_[i]] = i;
          this.byteToCharMapWebSafe_[i] = this.ENCODED_VALS_WEBSAFE.charAt(i);
          this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[i]] = i;
          if (i >= this.ENCODED_VALS_BASE.length) {
            this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(i)] = i;
            this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(i)] = i;
          }
        }
      }
    }
  };
  class DecodeBase64StringError extends Error {
    constructor() {
      super(...arguments);
      this.name = "DecodeBase64StringError";
    }
  }
  const base64Encode = function(str) {
    const utf8Bytes = stringToByteArray$1(str);
    return base64.encodeByteArray(utf8Bytes, true);
  };
  const base64urlEncodeWithoutPadding = function(str) {
    return base64Encode(str).replace(/\./g, "");
  };
  const base64Decode = function(str) {
    try {
      return base64.decodeString(str, true);
    } catch (e) {
      console.error("base64Decode failed: ", e);
    }
    return null;
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function deepCopy(value) {
    return deepExtend(void 0, value);
  }
  function deepExtend(target, source) {
    if (!(source instanceof Object)) {
      return source;
    }
    switch (source.constructor) {
      case Date:
        const dateValue = source;
        return new Date(dateValue.getTime());
      case Object:
        if (target === void 0) {
          target = {};
        }
        break;
      case Array:
        target = [];
        break;
      default:
        return source;
    }
    for (const prop in source) {
      if (!source.hasOwnProperty(prop) || !isValidKey$1(prop)) {
        continue;
      }
      target[prop] = deepExtend(target[prop], source[prop]);
    }
    return target;
  }
  function isValidKey$1(key) {
    return key !== "__proto__";
  }
  /**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function getGlobal() {
    if (typeof self !== "undefined") {
      return self;
    }
    if (typeof window !== "undefined") {
      return window;
    }
    if (typeof global !== "undefined") {
      return global;
    }
    throw new Error("Unable to locate global object.");
  }
  /**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const getDefaultsFromGlobal = () => getGlobal().__FIREBASE_DEFAULTS__;
  const getDefaultsFromEnvVariable = () => {
    if (typeof process === "undefined" || typeof process.env === "undefined") {
      return;
    }
    const defaultsJsonString = process.env.__FIREBASE_DEFAULTS__;
    if (defaultsJsonString) {
      return JSON.parse(defaultsJsonString);
    }
  };
  const getDefaultsFromCookie = () => {
    if (typeof document === "undefined") {
      return;
    }
    let match;
    try {
      match = document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/);
    } catch (e) {
      return;
    }
    const decoded = match && base64Decode(match[1]);
    return decoded && JSON.parse(decoded);
  };
  const getDefaults = () => {
    try {
      return getDefaultsFromPostinstall() || getDefaultsFromGlobal() || getDefaultsFromEnvVariable() || getDefaultsFromCookie();
    } catch (e) {
      console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);
      return;
    }
  };
  const getDefaultEmulatorHost = (productName) => {
    var _a2, _b2;
    return (_b2 = (_a2 = getDefaults()) === null || _a2 === void 0 ? void 0 : _a2.emulatorHosts) === null || _b2 === void 0 ? void 0 : _b2[productName];
  };
  const getDefaultEmulatorHostnameAndPort = (productName) => {
    const host = getDefaultEmulatorHost(productName);
    if (!host) {
      return void 0;
    }
    const separatorIndex = host.lastIndexOf(":");
    if (separatorIndex <= 0 || separatorIndex + 1 === host.length) {
      throw new Error(`Invalid host ${host} with no separate hostname and port!`);
    }
    const port = parseInt(host.substring(separatorIndex + 1), 10);
    if (host[0] === "[") {
      return [host.substring(1, separatorIndex - 1), port];
    } else {
      return [host.substring(0, separatorIndex), port];
    }
  };
  const getDefaultAppConfig = () => {
    var _a2;
    return (_a2 = getDefaults()) === null || _a2 === void 0 ? void 0 : _a2.config;
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Deferred {
    constructor() {
      this.reject = () => {
      };
      this.resolve = () => {
      };
      this.promise = new Promise((resolve, reject) => {
        this.resolve = resolve;
        this.reject = reject;
      });
    }
    /**
     * Our API internals are not promisified and cannot because our callback APIs have subtle expectations around
     * invoking promises inline, which Promises are forbidden to do. This method accepts an optional node-style callback
     * and returns a node-style callback which will resolve or reject the Deferred's promise.
     */
    wrapCallback(callback) {
      return (error2, value) => {
        if (error2) {
          this.reject(error2);
        } else {
          this.resolve(value);
        }
        if (typeof callback === "function") {
          this.promise.catch(() => {
          });
          if (callback.length === 1) {
            callback(error2);
          } else {
            callback(error2, value);
          }
        }
      };
    }
  }
  /**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function createMockUserToken(token, projectId) {
    if (token.uid) {
      throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');
    }
    const header = {
      alg: "none",
      type: "JWT"
    };
    const project = projectId || "demo-project";
    const iat = token.iat || 0;
    const sub = token.sub || token.user_id;
    if (!sub) {
      throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");
    }
    const payload = Object.assign({
      // Set all required fields to decent defaults
      iss: `https://securetoken.google.com/${project}`,
      aud: project,
      iat,
      exp: iat + 3600,
      auth_time: iat,
      sub,
      user_id: sub,
      firebase: {
        sign_in_provider: "custom",
        identities: {}
      }
    }, token);
    const signature = "";
    return [
      base64urlEncodeWithoutPadding(JSON.stringify(header)),
      base64urlEncodeWithoutPadding(JSON.stringify(payload)),
      signature
    ].join(".");
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function getUA() {
    if (typeof navigator !== "undefined" && typeof navigator["userAgent"] === "string") {
      return navigator["userAgent"];
    } else {
      return "";
    }
  }
  function isMobileCordova() {
    return typeof window !== "undefined" && // @ts-ignore Setting up an broadly applicable index signature for Window
    // just to deal with this case would probably be a bad idea.
    !!(window["cordova"] || window["phonegap"] || window["PhoneGap"]) && /ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(getUA());
  }
  function isCloudflareWorker() {
    return typeof navigator !== "undefined" && navigator.userAgent === "Cloudflare-Workers";
  }
  function isBrowserExtension() {
    const runtime = typeof chrome === "object" ? chrome.runtime : typeof browser === "object" ? browser.runtime : void 0;
    return typeof runtime === "object" && runtime.id !== void 0;
  }
  function isReactNative() {
    return typeof navigator === "object" && navigator["product"] === "ReactNative";
  }
  function isNodeSdk() {
    return CONSTANTS.NODE_ADMIN === true;
  }
  function isIndexedDBAvailable() {
    try {
      return typeof indexedDB === "object";
    } catch (e) {
      return false;
    }
  }
  function validateIndexedDBOpenable() {
    return new Promise((resolve, reject) => {
      try {
        let preExist = true;
        const DB_CHECK_NAME = "validate-browser-context-for-indexeddb-analytics-module";
        const request = self.indexedDB.open(DB_CHECK_NAME);
        request.onsuccess = () => {
          request.result.close();
          if (!preExist) {
            self.indexedDB.deleteDatabase(DB_CHECK_NAME);
          }
          resolve(true);
        };
        request.onupgradeneeded = () => {
          preExist = false;
        };
        request.onerror = () => {
          var _a2;
          reject(((_a2 = request.error) === null || _a2 === void 0 ? void 0 : _a2.message) || "");
        };
      } catch (error2) {
        reject(error2);
      }
    });
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const ERROR_NAME = "FirebaseError";
  class FirebaseError extends Error {
    constructor(code, message, customData) {
      super(message);
      this.code = code;
      this.customData = customData;
      this.name = ERROR_NAME;
      Object.setPrototypeOf(this, FirebaseError.prototype);
      if (Error.captureStackTrace) {
        Error.captureStackTrace(this, ErrorFactory.prototype.create);
      }
    }
  }
  class ErrorFactory {
    constructor(service, serviceName, errors) {
      this.service = service;
      this.serviceName = serviceName;
      this.errors = errors;
    }
    create(code, ...data) {
      const customData = data[0] || {};
      const fullCode = `${this.service}/${code}`;
      const template = this.errors[code];
      const message = template ? replaceTemplate(template, customData) : "Error";
      const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;
      const error2 = new FirebaseError(fullCode, fullMessage, customData);
      return error2;
    }
  }
  function replaceTemplate(template, data) {
    return template.replace(PATTERN, (_, key) => {
      const value = data[key];
      return value != null ? String(value) : `<${key}?>`;
    });
  }
  const PATTERN = /\{\$([^}]+)}/g;
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function jsonEval(str) {
    return JSON.parse(str);
  }
  function stringify(data) {
    return JSON.stringify(data);
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const decode = function(token) {
    let header = {}, claims = {}, data = {}, signature = "";
    try {
      const parts = token.split(".");
      header = jsonEval(base64Decode(parts[0]) || "");
      claims = jsonEval(base64Decode(parts[1]) || "");
      signature = parts[2];
      data = claims["d"] || {};
      delete claims["d"];
    } catch (e) {
    }
    return {
      header,
      claims,
      data,
      signature
    };
  };
  const isValidFormat = function(token) {
    const decoded = decode(token), claims = decoded.claims;
    return !!claims && typeof claims === "object" && claims.hasOwnProperty("iat");
  };
  const isAdmin = function(token) {
    const claims = decode(token).claims;
    return typeof claims === "object" && claims["admin"] === true;
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function contains(obj, key) {
    return Object.prototype.hasOwnProperty.call(obj, key);
  }
  function safeGet(obj, key) {
    if (Object.prototype.hasOwnProperty.call(obj, key)) {
      return obj[key];
    } else {
      return void 0;
    }
  }
  function isEmpty(obj) {
    for (const key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        return false;
      }
    }
    return true;
  }
  function map(obj, fn, contextObj) {
    const res = {};
    for (const key in obj) {
      if (Object.prototype.hasOwnProperty.call(obj, key)) {
        res[key] = fn.call(contextObj, obj[key], key, obj);
      }
    }
    return res;
  }
  function deepEqual(a, b2) {
    if (a === b2) {
      return true;
    }
    const aKeys = Object.keys(a);
    const bKeys = Object.keys(b2);
    for (const k of aKeys) {
      if (!bKeys.includes(k)) {
        return false;
      }
      const aProp = a[k];
      const bProp = b2[k];
      if (isObject(aProp) && isObject(bProp)) {
        if (!deepEqual(aProp, bProp)) {
          return false;
        }
      } else if (aProp !== bProp) {
        return false;
      }
    }
    for (const k of bKeys) {
      if (!aKeys.includes(k)) {
        return false;
      }
    }
    return true;
  }
  function isObject(thing) {
    return thing !== null && typeof thing === "object";
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function querystring(querystringParams) {
    const params = [];
    for (const [key, value] of Object.entries(querystringParams)) {
      if (Array.isArray(value)) {
        value.forEach((arrayVal) => {
          params.push(encodeURIComponent(key) + "=" + encodeURIComponent(arrayVal));
        });
      } else {
        params.push(encodeURIComponent(key) + "=" + encodeURIComponent(value));
      }
    }
    return params.length ? "&" + params.join("&") : "";
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Sha1 {
    constructor() {
      this.chain_ = [];
      this.buf_ = [];
      this.W_ = [];
      this.pad_ = [];
      this.inbuf_ = 0;
      this.total_ = 0;
      this.blockSize = 512 / 8;
      this.pad_[0] = 128;
      for (let i = 1; i < this.blockSize; ++i) {
        this.pad_[i] = 0;
      }
      this.reset();
    }
    reset() {
      this.chain_[0] = 1732584193;
      this.chain_[1] = 4023233417;
      this.chain_[2] = 2562383102;
      this.chain_[3] = 271733878;
      this.chain_[4] = 3285377520;
      this.inbuf_ = 0;
      this.total_ = 0;
    }
    /**
     * Internal compress helper function.
     * @param buf Block to compress.
     * @param offset Offset of the block in the buffer.
     * @private
     */
    compress_(buf, offset) {
      if (!offset) {
        offset = 0;
      }
      const W = this.W_;
      if (typeof buf === "string") {
        for (let i = 0; i < 16; i++) {
          W[i] = buf.charCodeAt(offset) << 24 | buf.charCodeAt(offset + 1) << 16 | buf.charCodeAt(offset + 2) << 8 | buf.charCodeAt(offset + 3);
          offset += 4;
        }
      } else {
        for (let i = 0; i < 16; i++) {
          W[i] = buf[offset] << 24 | buf[offset + 1] << 16 | buf[offset + 2] << 8 | buf[offset + 3];
          offset += 4;
        }
      }
      for (let i = 16; i < 80; i++) {
        const t = W[i - 3] ^ W[i - 8] ^ W[i - 14] ^ W[i - 16];
        W[i] = (t << 1 | t >>> 31) & 4294967295;
      }
      let a = this.chain_[0];
      let b2 = this.chain_[1];
      let c = this.chain_[2];
      let d = this.chain_[3];
      let e = this.chain_[4];
      let f, k;
      for (let i = 0; i < 80; i++) {
        if (i < 40) {
          if (i < 20) {
            f = d ^ b2 & (c ^ d);
            k = 1518500249;
          } else {
            f = b2 ^ c ^ d;
            k = 1859775393;
          }
        } else {
          if (i < 60) {
            f = b2 & c | d & (b2 | c);
            k = 2400959708;
          } else {
            f = b2 ^ c ^ d;
            k = 3395469782;
          }
        }
        const t = (a << 5 | a >>> 27) + f + e + k + W[i] & 4294967295;
        e = d;
        d = c;
        c = (b2 << 30 | b2 >>> 2) & 4294967295;
        b2 = a;
        a = t;
      }
      this.chain_[0] = this.chain_[0] + a & 4294967295;
      this.chain_[1] = this.chain_[1] + b2 & 4294967295;
      this.chain_[2] = this.chain_[2] + c & 4294967295;
      this.chain_[3] = this.chain_[3] + d & 4294967295;
      this.chain_[4] = this.chain_[4] + e & 4294967295;
    }
    update(bytes, length) {
      if (bytes == null) {
        return;
      }
      if (length === void 0) {
        length = bytes.length;
      }
      const lengthMinusBlock = length - this.blockSize;
      let n = 0;
      const buf = this.buf_;
      let inbuf = this.inbuf_;
      while (n < length) {
        if (inbuf === 0) {
          while (n <= lengthMinusBlock) {
            this.compress_(bytes, n);
            n += this.blockSize;
          }
        }
        if (typeof bytes === "string") {
          while (n < length) {
            buf[inbuf] = bytes.charCodeAt(n);
            ++inbuf;
            ++n;
            if (inbuf === this.blockSize) {
              this.compress_(buf);
              inbuf = 0;
              break;
            }
          }
        } else {
          while (n < length) {
            buf[inbuf] = bytes[n];
            ++inbuf;
            ++n;
            if (inbuf === this.blockSize) {
              this.compress_(buf);
              inbuf = 0;
              break;
            }
          }
        }
      }
      this.inbuf_ = inbuf;
      this.total_ += length;
    }
    /** @override */
    digest() {
      const digest = [];
      let totalBits = this.total_ * 8;
      if (this.inbuf_ < 56) {
        this.update(this.pad_, 56 - this.inbuf_);
      } else {
        this.update(this.pad_, this.blockSize - (this.inbuf_ - 56));
      }
      for (let i = this.blockSize - 1; i >= 56; i--) {
        this.buf_[i] = totalBits & 255;
        totalBits /= 256;
      }
      this.compress_(this.buf_);
      let n = 0;
      for (let i = 0; i < 5; i++) {
        for (let j = 24; j >= 0; j -= 8) {
          digest[n] = this.chain_[i] >> j & 255;
          ++n;
        }
      }
      return digest;
    }
  }
  function createSubscribe(executor, onNoObservers) {
    const proxy = new ObserverProxy(executor, onNoObservers);
    return proxy.subscribe.bind(proxy);
  }
  class ObserverProxy {
    /**
     * @param executor Function which can make calls to a single Observer
     *     as a proxy.
     * @param onNoObservers Callback when count of Observers goes to zero.
     */
    constructor(executor, onNoObservers) {
      this.observers = [];
      this.unsubscribes = [];
      this.observerCount = 0;
      this.task = Promise.resolve();
      this.finalized = false;
      this.onNoObservers = onNoObservers;
      this.task.then(() => {
        executor(this);
      }).catch((e) => {
        this.error(e);
      });
    }
    next(value) {
      this.forEachObserver((observer) => {
        observer.next(value);
      });
    }
    error(error2) {
      this.forEachObserver((observer) => {
        observer.error(error2);
      });
      this.close(error2);
    }
    complete() {
      this.forEachObserver((observer) => {
        observer.complete();
      });
      this.close();
    }
    /**
     * Subscribe function that can be used to add an Observer to the fan-out list.
     *
     * - We require that no event is sent to a subscriber synchronously to their
     *   call to subscribe().
     */
    subscribe(nextOrObserver, error2, complete) {
      let observer;
      if (nextOrObserver === void 0 && error2 === void 0 && complete === void 0) {
        throw new Error("Missing Observer.");
      }
      if (implementsAnyMethods(nextOrObserver, [
        "next",
        "error",
        "complete"
      ])) {
        observer = nextOrObserver;
      } else {
        observer = {
          next: nextOrObserver,
          error: error2,
          complete
        };
      }
      if (observer.next === void 0) {
        observer.next = noop;
      }
      if (observer.error === void 0) {
        observer.error = noop;
      }
      if (observer.complete === void 0) {
        observer.complete = noop;
      }
      const unsub = this.unsubscribeOne.bind(this, this.observers.length);
      if (this.finalized) {
        this.task.then(() => {
          try {
            if (this.finalError) {
              observer.error(this.finalError);
            } else {
              observer.complete();
            }
          } catch (e) {
          }
          return;
        });
      }
      this.observers.push(observer);
      return unsub;
    }
    // Unsubscribe is synchronous - we guarantee that no events are sent to
    // any unsubscribed Observer.
    unsubscribeOne(i) {
      if (this.observers === void 0 || this.observers[i] === void 0) {
        return;
      }
      delete this.observers[i];
      this.observerCount -= 1;
      if (this.observerCount === 0 && this.onNoObservers !== void 0) {
        this.onNoObservers(this);
      }
    }
    forEachObserver(fn) {
      if (this.finalized) {
        return;
      }
      for (let i = 0; i < this.observers.length; i++) {
        this.sendOne(i, fn);
      }
    }
    // Call the Observer via one of it's callback function. We are careful to
    // confirm that the observe has not been unsubscribed since this asynchronous
    // function had been queued.
    sendOne(i, fn) {
      this.task.then(() => {
        if (this.observers !== void 0 && this.observers[i] !== void 0) {
          try {
            fn(this.observers[i]);
          } catch (e) {
            if (typeof console !== "undefined" && console.error) {
              console.error(e);
            }
          }
        }
      });
    }
    close(err) {
      if (this.finalized) {
        return;
      }
      this.finalized = true;
      if (err !== void 0) {
        this.finalError = err;
      }
      this.task.then(() => {
        this.observers = void 0;
        this.onNoObservers = void 0;
      });
    }
  }
  function implementsAnyMethods(obj, methods) {
    if (typeof obj !== "object" || obj === null) {
      return false;
    }
    for (const method of methods) {
      if (method in obj && typeof obj[method] === "function") {
        return true;
      }
    }
    return false;
  }
  function noop() {
  }
  function errorPrefix(fnName, argName) {
    return `${fnName} failed: ${argName} argument `;
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const stringToByteArray = function(str) {
    const out = [];
    let p = 0;
    for (let i = 0; i < str.length; i++) {
      let c = str.charCodeAt(i);
      if (c >= 55296 && c <= 56319) {
        const high = c - 55296;
        i++;
        assert(i < str.length, "Surrogate pair missing trail surrogate.");
        const low = str.charCodeAt(i) - 56320;
        c = 65536 + (high << 10) + low;
      }
      if (c < 128) {
        out[p++] = c;
      } else if (c < 2048) {
        out[p++] = c >> 6 | 192;
        out[p++] = c & 63 | 128;
      } else if (c < 65536) {
        out[p++] = c >> 12 | 224;
        out[p++] = c >> 6 & 63 | 128;
        out[p++] = c & 63 | 128;
      } else {
        out[p++] = c >> 18 | 240;
        out[p++] = c >> 12 & 63 | 128;
        out[p++] = c >> 6 & 63 | 128;
        out[p++] = c & 63 | 128;
      }
    }
    return out;
  };
  const stringLength = function(str) {
    let p = 0;
    for (let i = 0; i < str.length; i++) {
      const c = str.charCodeAt(i);
      if (c < 128) {
        p++;
      } else if (c < 2048) {
        p += 2;
      } else if (c >= 55296 && c <= 56319) {
        p += 4;
        i++;
      } else {
        p += 3;
      }
    }
    return p;
  };
  /**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function getModularInstance(service) {
    if (service && service._delegate) {
      return service._delegate;
    } else {
      return service;
    }
  }
  class Component {
    /**
     *
     * @param name The public service name, e.g. app, auth, firestore, database
     * @param instanceFactory Service factory responsible for creating the public interface
     * @param type whether the service provided by the component is public or private
     */
    constructor(name2, instanceFactory, type) {
      this.name = name2;
      this.instanceFactory = instanceFactory;
      this.type = type;
      this.multipleInstances = false;
      this.serviceProps = {};
      this.instantiationMode = "LAZY";
      this.onInstanceCreated = null;
    }
    setInstantiationMode(mode) {
      this.instantiationMode = mode;
      return this;
    }
    setMultipleInstances(multipleInstances) {
      this.multipleInstances = multipleInstances;
      return this;
    }
    setServiceProps(props) {
      this.serviceProps = props;
      return this;
    }
    setInstanceCreatedCallback(callback) {
      this.onInstanceCreated = callback;
      return this;
    }
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const DEFAULT_ENTRY_NAME$1 = "[DEFAULT]";
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Provider {
    constructor(name2, container) {
      this.name = name2;
      this.container = container;
      this.component = null;
      this.instances = /* @__PURE__ */ new Map();
      this.instancesDeferred = /* @__PURE__ */ new Map();
      this.instancesOptions = /* @__PURE__ */ new Map();
      this.onInitCallbacks = /* @__PURE__ */ new Map();
    }
    /**
     * @param identifier A provider can provide multiple instances of a service
     * if this.component.multipleInstances is true.
     */
    get(identifier) {
      const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);
      if (!this.instancesDeferred.has(normalizedIdentifier)) {
        const deferred = new Deferred();
        this.instancesDeferred.set(normalizedIdentifier, deferred);
        if (this.isInitialized(normalizedIdentifier) || this.shouldAutoInitialize()) {
          try {
            const instance = this.getOrInitializeService({
              instanceIdentifier: normalizedIdentifier
            });
            if (instance) {
              deferred.resolve(instance);
            }
          } catch (e) {
          }
        }
      }
      return this.instancesDeferred.get(normalizedIdentifier).promise;
    }
    getImmediate(options) {
      var _a2;
      const normalizedIdentifier = this.normalizeInstanceIdentifier(options === null || options === void 0 ? void 0 : options.identifier);
      const optional = (_a2 = options === null || options === void 0 ? void 0 : options.optional) !== null && _a2 !== void 0 ? _a2 : false;
      if (this.isInitialized(normalizedIdentifier) || this.shouldAutoInitialize()) {
        try {
          return this.getOrInitializeService({
            instanceIdentifier: normalizedIdentifier
          });
        } catch (e) {
          if (optional) {
            return null;
          } else {
            throw e;
          }
        }
      } else {
        if (optional) {
          return null;
        } else {
          throw Error(`Service ${this.name} is not available`);
        }
      }
    }
    getComponent() {
      return this.component;
    }
    setComponent(component) {
      if (component.name !== this.name) {
        throw Error(`Mismatching Component ${component.name} for Provider ${this.name}.`);
      }
      if (this.component) {
        throw Error(`Component for ${this.name} has already been provided`);
      }
      this.component = component;
      if (!this.shouldAutoInitialize()) {
        return;
      }
      if (isComponentEager(component)) {
        try {
          this.getOrInitializeService({ instanceIdentifier: DEFAULT_ENTRY_NAME$1 });
        } catch (e) {
        }
      }
      for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {
        const normalizedIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);
        try {
          const instance = this.getOrInitializeService({
            instanceIdentifier: normalizedIdentifier
          });
          instanceDeferred.resolve(instance);
        } catch (e) {
        }
      }
    }
    clearInstance(identifier = DEFAULT_ENTRY_NAME$1) {
      this.instancesDeferred.delete(identifier);
      this.instancesOptions.delete(identifier);
      this.instances.delete(identifier);
    }
    // app.delete() will call this method on every provider to delete the services
    // TODO: should we mark the provider as deleted?
    async delete() {
      const services = Array.from(this.instances.values());
      await Promise.all([
        ...services.filter((service) => "INTERNAL" in service).map((service) => service.INTERNAL.delete()),
        ...services.filter((service) => "_delete" in service).map((service) => service._delete())
      ]);
    }
    isComponentSet() {
      return this.component != null;
    }
    isInitialized(identifier = DEFAULT_ENTRY_NAME$1) {
      return this.instances.has(identifier);
    }
    getOptions(identifier = DEFAULT_ENTRY_NAME$1) {
      return this.instancesOptions.get(identifier) || {};
    }
    initialize(opts = {}) {
      const { options = {} } = opts;
      const normalizedIdentifier = this.normalizeInstanceIdentifier(opts.instanceIdentifier);
      if (this.isInitialized(normalizedIdentifier)) {
        throw Error(`${this.name}(${normalizedIdentifier}) has already been initialized`);
      }
      if (!this.isComponentSet()) {
        throw Error(`Component ${this.name} has not been registered yet`);
      }
      const instance = this.getOrInitializeService({
        instanceIdentifier: normalizedIdentifier,
        options
      });
      for (const [instanceIdentifier, instanceDeferred] of this.instancesDeferred.entries()) {
        const normalizedDeferredIdentifier = this.normalizeInstanceIdentifier(instanceIdentifier);
        if (normalizedIdentifier === normalizedDeferredIdentifier) {
          instanceDeferred.resolve(instance);
        }
      }
      return instance;
    }
    /**
     *
     * @param callback - a function that will be invoked  after the provider has been initialized by calling provider.initialize().
     * The function is invoked SYNCHRONOUSLY, so it should not execute any longrunning tasks in order to not block the program.
     *
     * @param identifier An optional instance identifier
     * @returns a function to unregister the callback
     */
    onInit(callback, identifier) {
      var _a2;
      const normalizedIdentifier = this.normalizeInstanceIdentifier(identifier);
      const existingCallbacks = (_a2 = this.onInitCallbacks.get(normalizedIdentifier)) !== null && _a2 !== void 0 ? _a2 : /* @__PURE__ */ new Set();
      existingCallbacks.add(callback);
      this.onInitCallbacks.set(normalizedIdentifier, existingCallbacks);
      const existingInstance = this.instances.get(normalizedIdentifier);
      if (existingInstance) {
        callback(existingInstance, normalizedIdentifier);
      }
      return () => {
        existingCallbacks.delete(callback);
      };
    }
    /**
     * Invoke onInit callbacks synchronously
     * @param instance the service instance`
     */
    invokeOnInitCallbacks(instance, identifier) {
      const callbacks = this.onInitCallbacks.get(identifier);
      if (!callbacks) {
        return;
      }
      for (const callback of callbacks) {
        try {
          callback(instance, identifier);
        } catch (_a2) {
        }
      }
    }
    getOrInitializeService({ instanceIdentifier, options = {} }) {
      let instance = this.instances.get(instanceIdentifier);
      if (!instance && this.component) {
        instance = this.component.instanceFactory(this.container, {
          instanceIdentifier: normalizeIdentifierForFactory(instanceIdentifier),
          options
        });
        this.instances.set(instanceIdentifier, instance);
        this.instancesOptions.set(instanceIdentifier, options);
        this.invokeOnInitCallbacks(instance, instanceIdentifier);
        if (this.component.onInstanceCreated) {
          try {
            this.component.onInstanceCreated(this.container, instanceIdentifier, instance);
          } catch (_a2) {
          }
        }
      }
      return instance || null;
    }
    normalizeInstanceIdentifier(identifier = DEFAULT_ENTRY_NAME$1) {
      if (this.component) {
        return this.component.multipleInstances ? identifier : DEFAULT_ENTRY_NAME$1;
      } else {
        return identifier;
      }
    }
    shouldAutoInitialize() {
      return !!this.component && this.component.instantiationMode !== "EXPLICIT";
    }
  }
  function normalizeIdentifierForFactory(identifier) {
    return identifier === DEFAULT_ENTRY_NAME$1 ? void 0 : identifier;
  }
  function isComponentEager(component) {
    return component.instantiationMode === "EAGER";
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ComponentContainer {
    constructor(name2) {
      this.name = name2;
      this.providers = /* @__PURE__ */ new Map();
    }
    /**
     *
     * @param component Component being added
     * @param overwrite When a component with the same name has already been registered,
     * if overwrite is true: overwrite the existing component with the new component and create a new
     * provider with the new component. It can be useful in tests where you want to use different mocks
     * for different tests.
     * if overwrite is false: throw an exception
     */
    addComponent(component) {
      const provider = this.getProvider(component.name);
      if (provider.isComponentSet()) {
        throw new Error(`Component ${component.name} has already been registered with ${this.name}`);
      }
      provider.setComponent(component);
    }
    addOrOverwriteComponent(component) {
      const provider = this.getProvider(component.name);
      if (provider.isComponentSet()) {
        this.providers.delete(component.name);
      }
      this.addComponent(component);
    }
    /**
     * getProvider provides a type safe interface where it can only be called with a field name
     * present in NameServiceMapping interface.
     *
     * Firebase SDKs providing services should extend NameServiceMapping interface to register
     * themselves.
     */
    getProvider(name2) {
      if (this.providers.has(name2)) {
        return this.providers.get(name2);
      }
      const provider = new Provider(name2, this);
      this.providers.set(name2, provider);
      return provider;
    }
    getProviders() {
      return Array.from(this.providers.values());
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  var LogLevel;
  (function(LogLevel2) {
    LogLevel2[LogLevel2["DEBUG"] = 0] = "DEBUG";
    LogLevel2[LogLevel2["VERBOSE"] = 1] = "VERBOSE";
    LogLevel2[LogLevel2["INFO"] = 2] = "INFO";
    LogLevel2[LogLevel2["WARN"] = 3] = "WARN";
    LogLevel2[LogLevel2["ERROR"] = 4] = "ERROR";
    LogLevel2[LogLevel2["SILENT"] = 5] = "SILENT";
  })(LogLevel || (LogLevel = {}));
  const levelStringToEnum = {
    "debug": LogLevel.DEBUG,
    "verbose": LogLevel.VERBOSE,
    "info": LogLevel.INFO,
    "warn": LogLevel.WARN,
    "error": LogLevel.ERROR,
    "silent": LogLevel.SILENT
  };
  const defaultLogLevel = LogLevel.INFO;
  const ConsoleMethod = {
    [LogLevel.DEBUG]: "log",
    [LogLevel.VERBOSE]: "log",
    [LogLevel.INFO]: "info",
    [LogLevel.WARN]: "warn",
    [LogLevel.ERROR]: "error"
  };
  const defaultLogHandler = (instance, logType, ...args) => {
    if (logType < instance.logLevel) {
      return;
    }
    const now = (/* @__PURE__ */ new Date()).toISOString();
    const method = ConsoleMethod[logType];
    if (method) {
      console[method](`[${now}]  ${instance.name}:`, ...args);
    } else {
      throw new Error(`Attempted to log a message with an invalid logType (value: ${logType})`);
    }
  };
  class Logger {
    /**
     * Gives you an instance of a Logger to capture messages according to
     * Firebase's logging scheme.
     *
     * @param name The name that the logs will be associated with
     */
    constructor(name2) {
      this.name = name2;
      this._logLevel = defaultLogLevel;
      this._logHandler = defaultLogHandler;
      this._userLogHandler = null;
    }
    get logLevel() {
      return this._logLevel;
    }
    set logLevel(val) {
      if (!(val in LogLevel)) {
        throw new TypeError(`Invalid value "${val}" assigned to \`logLevel\``);
      }
      this._logLevel = val;
    }
    // Workaround for setter/getter having to be the same type.
    setLogLevel(val) {
      this._logLevel = typeof val === "string" ? levelStringToEnum[val] : val;
    }
    get logHandler() {
      return this._logHandler;
    }
    set logHandler(val) {
      if (typeof val !== "function") {
        throw new TypeError("Value assigned to `logHandler` must be a function");
      }
      this._logHandler = val;
    }
    get userLogHandler() {
      return this._userLogHandler;
    }
    set userLogHandler(val) {
      this._userLogHandler = val;
    }
    /**
     * The functions below are all based on the `console` interface
     */
    debug(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);
      this._logHandler(this, LogLevel.DEBUG, ...args);
    }
    log(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.VERBOSE, ...args);
      this._logHandler(this, LogLevel.VERBOSE, ...args);
    }
    info(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);
      this._logHandler(this, LogLevel.INFO, ...args);
    }
    warn(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);
      this._logHandler(this, LogLevel.WARN, ...args);
    }
    error(...args) {
      this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);
      this._logHandler(this, LogLevel.ERROR, ...args);
    }
  }
  const instanceOfAny = (object, constructors) => constructors.some((c) => object instanceof c);
  let idbProxyableTypes;
  let cursorAdvanceMethods;
  function getIdbProxyableTypes() {
    return idbProxyableTypes || (idbProxyableTypes = [
      IDBDatabase,
      IDBObjectStore,
      IDBIndex,
      IDBCursor,
      IDBTransaction
    ]);
  }
  function getCursorAdvanceMethods() {
    return cursorAdvanceMethods || (cursorAdvanceMethods = [
      IDBCursor.prototype.advance,
      IDBCursor.prototype.continue,
      IDBCursor.prototype.continuePrimaryKey
    ]);
  }
  const cursorRequestMap = /* @__PURE__ */ new WeakMap();
  const transactionDoneMap = /* @__PURE__ */ new WeakMap();
  const transactionStoreNamesMap = /* @__PURE__ */ new WeakMap();
  const transformCache = /* @__PURE__ */ new WeakMap();
  const reverseTransformCache = /* @__PURE__ */ new WeakMap();
  function promisifyRequest(request) {
    const promise = new Promise((resolve, reject) => {
      const unlisten = () => {
        request.removeEventListener("success", success);
        request.removeEventListener("error", error2);
      };
      const success = () => {
        resolve(wrap(request.result));
        unlisten();
      };
      const error2 = () => {
        reject(request.error);
        unlisten();
      };
      request.addEventListener("success", success);
      request.addEventListener("error", error2);
    });
    promise.then((value) => {
      if (value instanceof IDBCursor) {
        cursorRequestMap.set(value, request);
      }
    }).catch(() => {
    });
    reverseTransformCache.set(promise, request);
    return promise;
  }
  function cacheDonePromiseForTransaction(tx) {
    if (transactionDoneMap.has(tx))
      return;
    const done = new Promise((resolve, reject) => {
      const unlisten = () => {
        tx.removeEventListener("complete", complete);
        tx.removeEventListener("error", error2);
        tx.removeEventListener("abort", error2);
      };
      const complete = () => {
        resolve();
        unlisten();
      };
      const error2 = () => {
        reject(tx.error || new DOMException("AbortError", "AbortError"));
        unlisten();
      };
      tx.addEventListener("complete", complete);
      tx.addEventListener("error", error2);
      tx.addEventListener("abort", error2);
    });
    transactionDoneMap.set(tx, done);
  }
  let idbProxyTraps = {
    get(target, prop, receiver) {
      if (target instanceof IDBTransaction) {
        if (prop === "done")
          return transactionDoneMap.get(target);
        if (prop === "objectStoreNames") {
          return target.objectStoreNames || transactionStoreNamesMap.get(target);
        }
        if (prop === "store") {
          return receiver.objectStoreNames[1] ? void 0 : receiver.objectStore(receiver.objectStoreNames[0]);
        }
      }
      return wrap(target[prop]);
    },
    set(target, prop, value) {
      target[prop] = value;
      return true;
    },
    has(target, prop) {
      if (target instanceof IDBTransaction && (prop === "done" || prop === "store")) {
        return true;
      }
      return prop in target;
    }
  };
  function replaceTraps(callback) {
    idbProxyTraps = callback(idbProxyTraps);
  }
  function wrapFunction(func) {
    if (func === IDBDatabase.prototype.transaction && !("objectStoreNames" in IDBTransaction.prototype)) {
      return function(storeNames, ...args) {
        const tx = func.call(unwrap(this), storeNames, ...args);
        transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);
        return wrap(tx);
      };
    }
    if (getCursorAdvanceMethods().includes(func)) {
      return function(...args) {
        func.apply(unwrap(this), args);
        return wrap(cursorRequestMap.get(this));
      };
    }
    return function(...args) {
      return wrap(func.apply(unwrap(this), args));
    };
  }
  function transformCachableValue(value) {
    if (typeof value === "function")
      return wrapFunction(value);
    if (value instanceof IDBTransaction)
      cacheDonePromiseForTransaction(value);
    if (instanceOfAny(value, getIdbProxyableTypes()))
      return new Proxy(value, idbProxyTraps);
    return value;
  }
  function wrap(value) {
    if (value instanceof IDBRequest)
      return promisifyRequest(value);
    if (transformCache.has(value))
      return transformCache.get(value);
    const newValue = transformCachableValue(value);
    if (newValue !== value) {
      transformCache.set(value, newValue);
      reverseTransformCache.set(newValue, value);
    }
    return newValue;
  }
  const unwrap = (value) => reverseTransformCache.get(value);
  function openDB(name2, version2, { blocked, upgrade, blocking, terminated } = {}) {
    const request = indexedDB.open(name2, version2);
    const openPromise = wrap(request);
    if (upgrade) {
      request.addEventListener("upgradeneeded", (event) => {
        upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction), event);
      });
    }
    if (blocked) {
      request.addEventListener("blocked", (event) => blocked(
        // Casting due to https://github.com/microsoft/TypeScript-DOM-lib-generator/pull/1405
        event.oldVersion,
        event.newVersion,
        event
      ));
    }
    openPromise.then((db) => {
      if (terminated)
        db.addEventListener("close", () => terminated());
      if (blocking) {
        db.addEventListener("versionchange", (event) => blocking(event.oldVersion, event.newVersion, event));
      }
    }).catch(() => {
    });
    return openPromise;
  }
  const readMethods = ["get", "getKey", "getAll", "getAllKeys", "count"];
  const writeMethods = ["put", "add", "delete", "clear"];
  const cachedMethods = /* @__PURE__ */ new Map();
  function getMethod(target, prop) {
    if (!(target instanceof IDBDatabase && !(prop in target) && typeof prop === "string")) {
      return;
    }
    if (cachedMethods.get(prop))
      return cachedMethods.get(prop);
    const targetFuncName = prop.replace(/FromIndex$/, "");
    const useIndex = prop !== targetFuncName;
    const isWrite = writeMethods.includes(targetFuncName);
    if (
      // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.
      !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) || !(isWrite || readMethods.includes(targetFuncName))
    ) {
      return;
    }
    const method = async function(storeName, ...args) {
      const tx = this.transaction(storeName, isWrite ? "readwrite" : "readonly");
      let target2 = tx.store;
      if (useIndex)
        target2 = target2.index(args.shift());
      return (await Promise.all([
        target2[targetFuncName](...args),
        isWrite && tx.done
      ]))[0];
    };
    cachedMethods.set(prop, method);
    return method;
  }
  replaceTraps((oldTraps) => ({
    ...oldTraps,
    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),
    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop)
  }));
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class PlatformLoggerServiceImpl {
    constructor(container) {
      this.container = container;
    }
    // In initial implementation, this will be called by installations on
    // auth token refresh, and installations will send this string.
    getPlatformInfoString() {
      const providers = this.container.getProviders();
      return providers.map((provider) => {
        if (isVersionServiceProvider(provider)) {
          const service = provider.getImmediate();
          return `${service.library}/${service.version}`;
        } else {
          return null;
        }
      }).filter((logString) => logString).join(" ");
    }
  }
  function isVersionServiceProvider(provider) {
    const component = provider.getComponent();
    return (component === null || component === void 0 ? void 0 : component.type) === "VERSION";
  }
  const name$q = "@firebase/app";
  const version$1$1 = "0.11.4";
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const logger$2 = new Logger("@firebase/app");
  const name$p = "@firebase/app-compat";
  const name$o = "@firebase/analytics-compat";
  const name$n = "@firebase/analytics";
  const name$m = "@firebase/app-check-compat";
  const name$l = "@firebase/app-check";
  const name$k = "@firebase/auth";
  const name$j = "@firebase/auth-compat";
  const name$i = "@firebase/database";
  const name$h = "@firebase/data-connect";
  const name$g = "@firebase/database-compat";
  const name$f = "@firebase/functions";
  const name$e = "@firebase/functions-compat";
  const name$d = "@firebase/installations";
  const name$c = "@firebase/installations-compat";
  const name$b = "@firebase/messaging";
  const name$a = "@firebase/messaging-compat";
  const name$9 = "@firebase/performance";
  const name$8 = "@firebase/performance-compat";
  const name$7 = "@firebase/remote-config";
  const name$6 = "@firebase/remote-config-compat";
  const name$5 = "@firebase/storage";
  const name$4 = "@firebase/storage-compat";
  const name$3 = "@firebase/firestore";
  const name$2$1 = "@firebase/vertexai";
  const name$1$1 = "@firebase/firestore-compat";
  const name$r = "firebase";
  const version$3 = "11.6.0";
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const DEFAULT_ENTRY_NAME = "[DEFAULT]";
  const PLATFORM_LOG_STRING = {
    [name$q]: "fire-core",
    [name$p]: "fire-core-compat",
    [name$n]: "fire-analytics",
    [name$o]: "fire-analytics-compat",
    [name$l]: "fire-app-check",
    [name$m]: "fire-app-check-compat",
    [name$k]: "fire-auth",
    [name$j]: "fire-auth-compat",
    [name$i]: "fire-rtdb",
    [name$h]: "fire-data-connect",
    [name$g]: "fire-rtdb-compat",
    [name$f]: "fire-fn",
    [name$e]: "fire-fn-compat",
    [name$d]: "fire-iid",
    [name$c]: "fire-iid-compat",
    [name$b]: "fire-fcm",
    [name$a]: "fire-fcm-compat",
    [name$9]: "fire-perf",
    [name$8]: "fire-perf-compat",
    [name$7]: "fire-rc",
    [name$6]: "fire-rc-compat",
    [name$5]: "fire-gcs",
    [name$4]: "fire-gcs-compat",
    [name$3]: "fire-fst",
    [name$1$1]: "fire-fst-compat",
    [name$2$1]: "fire-vertex",
    "fire-js": "fire-js",
    // Platform identifier for JS SDK.
    [name$r]: "fire-js-all"
  };
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const _apps = /* @__PURE__ */ new Map();
  const _serverApps = /* @__PURE__ */ new Map();
  const _components = /* @__PURE__ */ new Map();
  function _addComponent(app, component) {
    try {
      app.container.addComponent(component);
    } catch (e) {
      logger$2.debug(`Component ${component.name} failed to register with FirebaseApp ${app.name}`, e);
    }
  }
  function _registerComponent(component) {
    const componentName = component.name;
    if (_components.has(componentName)) {
      logger$2.debug(`There were multiple attempts to register component ${componentName}.`);
      return false;
    }
    _components.set(componentName, component);
    for (const app of _apps.values()) {
      _addComponent(app, component);
    }
    for (const serverApp of _serverApps.values()) {
      _addComponent(serverApp, component);
    }
    return true;
  }
  function _getProvider(app, name2) {
    const heartbeatController = app.container.getProvider("heartbeat").getImmediate({ optional: true });
    if (heartbeatController) {
      void heartbeatController.triggerHeartbeat();
    }
    return app.container.getProvider(name2);
  }
  function _isFirebaseServerApp(obj) {
    if (obj === null || obj === void 0) {
      return false;
    }
    return obj.settings !== void 0;
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const ERRORS = {
    [
      "no-app"
      /* AppError.NO_APP */
    ]: "No Firebase App '{$appName}' has been created - call initializeApp() first",
    [
      "bad-app-name"
      /* AppError.BAD_APP_NAME */
    ]: "Illegal App name: '{$appName}'",
    [
      "duplicate-app"
      /* AppError.DUPLICATE_APP */
    ]: "Firebase App named '{$appName}' already exists with different options or config",
    [
      "app-deleted"
      /* AppError.APP_DELETED */
    ]: "Firebase App named '{$appName}' already deleted",
    [
      "server-app-deleted"
      /* AppError.SERVER_APP_DELETED */
    ]: "Firebase Server App has been deleted",
    [
      "no-options"
      /* AppError.NO_OPTIONS */
    ]: "Need to provide options, when not being deployed to hosting via source.",
    [
      "invalid-app-argument"
      /* AppError.INVALID_APP_ARGUMENT */
    ]: "firebase.{$appName}() takes either no argument or a Firebase App instance.",
    [
      "invalid-log-argument"
      /* AppError.INVALID_LOG_ARGUMENT */
    ]: "First argument to `onLog` must be null or a function.",
    [
      "idb-open"
      /* AppError.IDB_OPEN */
    ]: "Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.",
    [
      "idb-get"
      /* AppError.IDB_GET */
    ]: "Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.",
    [
      "idb-set"
      /* AppError.IDB_WRITE */
    ]: "Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.",
    [
      "idb-delete"
      /* AppError.IDB_DELETE */
    ]: "Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.",
    [
      "finalization-registry-not-supported"
      /* AppError.FINALIZATION_REGISTRY_NOT_SUPPORTED */
    ]: "FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.",
    [
      "invalid-server-app-environment"
      /* AppError.INVALID_SERVER_APP_ENVIRONMENT */
    ]: "FirebaseServerApp is not for use in browser environments."
  };
  const ERROR_FACTORY = new ErrorFactory("app", "Firebase", ERRORS);
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class FirebaseAppImpl {
    constructor(options, config, container) {
      this._isDeleted = false;
      this._options = Object.assign({}, options);
      this._config = Object.assign({}, config);
      this._name = config.name;
      this._automaticDataCollectionEnabled = config.automaticDataCollectionEnabled;
      this._container = container;
      this.container.addComponent(new Component(
        "app",
        () => this,
        "PUBLIC"
        /* ComponentType.PUBLIC */
      ));
    }
    get automaticDataCollectionEnabled() {
      this.checkDestroyed();
      return this._automaticDataCollectionEnabled;
    }
    set automaticDataCollectionEnabled(val) {
      this.checkDestroyed();
      this._automaticDataCollectionEnabled = val;
    }
    get name() {
      this.checkDestroyed();
      return this._name;
    }
    get options() {
      this.checkDestroyed();
      return this._options;
    }
    get config() {
      this.checkDestroyed();
      return this._config;
    }
    get container() {
      return this._container;
    }
    get isDeleted() {
      return this._isDeleted;
    }
    set isDeleted(val) {
      this._isDeleted = val;
    }
    /**
     * This function will throw an Error if the App has already been deleted -
     * use before performing API actions on the App.
     */
    checkDestroyed() {
      if (this.isDeleted) {
        throw ERROR_FACTORY.create("app-deleted", { appName: this._name });
      }
    }
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const SDK_VERSION$1 = version$3;
  function initializeApp(_options, rawConfig = {}) {
    let options = _options;
    if (typeof rawConfig !== "object") {
      const name3 = rawConfig;
      rawConfig = { name: name3 };
    }
    const config = Object.assign({ name: DEFAULT_ENTRY_NAME, automaticDataCollectionEnabled: false }, rawConfig);
    const name2 = config.name;
    if (typeof name2 !== "string" || !name2) {
      throw ERROR_FACTORY.create("bad-app-name", {
        appName: String(name2)
      });
    }
    options || (options = getDefaultAppConfig());
    if (!options) {
      throw ERROR_FACTORY.create(
        "no-options"
        /* AppError.NO_OPTIONS */
      );
    }
    const existingApp = _apps.get(name2);
    if (existingApp) {
      if (deepEqual(options, existingApp.options) && deepEqual(config, existingApp.config)) {
        return existingApp;
      } else {
        throw ERROR_FACTORY.create("duplicate-app", { appName: name2 });
      }
    }
    const container = new ComponentContainer(name2);
    for (const component of _components.values()) {
      container.addComponent(component);
    }
    const newApp = new FirebaseAppImpl(options, config, container);
    _apps.set(name2, newApp);
    return newApp;
  }
  function getApp(name2 = DEFAULT_ENTRY_NAME) {
    const app = _apps.get(name2);
    if (!app && name2 === DEFAULT_ENTRY_NAME && getDefaultAppConfig()) {
      return initializeApp();
    }
    if (!app) {
      throw ERROR_FACTORY.create("no-app", { appName: name2 });
    }
    return app;
  }
  function getApps() {
    return Array.from(_apps.values());
  }
  function registerVersion(libraryKeyOrName, version2, variant) {
    var _a2;
    let library = (_a2 = PLATFORM_LOG_STRING[libraryKeyOrName]) !== null && _a2 !== void 0 ? _a2 : libraryKeyOrName;
    if (variant) {
      library += `-${variant}`;
    }
    const libraryMismatch = library.match(/\s|\//);
    const versionMismatch = version2.match(/\s|\//);
    if (libraryMismatch || versionMismatch) {
      const warning = [
        `Unable to register library "${library}" with version "${version2}":`
      ];
      if (libraryMismatch) {
        warning.push(`library name "${library}" contains illegal characters (whitespace or "/")`);
      }
      if (libraryMismatch && versionMismatch) {
        warning.push("and");
      }
      if (versionMismatch) {
        warning.push(`version name "${version2}" contains illegal characters (whitespace or "/")`);
      }
      logger$2.warn(warning.join(" "));
      return;
    }
    _registerComponent(new Component(
      `${library}-version`,
      () => ({ library, version: version2 }),
      "VERSION"
      /* ComponentType.VERSION */
    ));
  }
  /**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const DB_NAME$1 = "firebase-heartbeat-database";
  const DB_VERSION$1 = 1;
  const STORE_NAME = "firebase-heartbeat-store";
  let dbPromise = null;
  function getDbPromise() {
    if (!dbPromise) {
      dbPromise = openDB(DB_NAME$1, DB_VERSION$1, {
        upgrade: (db, oldVersion) => {
          switch (oldVersion) {
            case 0:
              try {
                db.createObjectStore(STORE_NAME);
              } catch (e) {
                console.warn(e);
              }
          }
        }
      }).catch((e) => {
        throw ERROR_FACTORY.create("idb-open", {
          originalErrorMessage: e.message
        });
      });
    }
    return dbPromise;
  }
  async function readHeartbeatsFromIndexedDB(app) {
    try {
      const db = await getDbPromise();
      const tx = db.transaction(STORE_NAME);
      const result2 = await tx.objectStore(STORE_NAME).get(computeKey(app));
      await tx.done;
      return result2;
    } catch (e) {
      if (e instanceof FirebaseError) {
        logger$2.warn(e.message);
      } else {
        const idbGetError = ERROR_FACTORY.create("idb-get", {
          originalErrorMessage: e === null || e === void 0 ? void 0 : e.message
        });
        logger$2.warn(idbGetError.message);
      }
    }
  }
  async function writeHeartbeatsToIndexedDB(app, heartbeatObject) {
    try {
      const db = await getDbPromise();
      const tx = db.transaction(STORE_NAME, "readwrite");
      const objectStore = tx.objectStore(STORE_NAME);
      await objectStore.put(heartbeatObject, computeKey(app));
      await tx.done;
    } catch (e) {
      if (e instanceof FirebaseError) {
        logger$2.warn(e.message);
      } else {
        const idbGetError = ERROR_FACTORY.create("idb-set", {
          originalErrorMessage: e === null || e === void 0 ? void 0 : e.message
        });
        logger$2.warn(idbGetError.message);
      }
    }
  }
  function computeKey(app) {
    return `${app.name}!${app.options.appId}`;
  }
  /**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const MAX_HEADER_BYTES = 1024;
  const MAX_NUM_STORED_HEARTBEATS = 30;
  class HeartbeatServiceImpl {
    constructor(container) {
      this.container = container;
      this._heartbeatsCache = null;
      const app = this.container.getProvider("app").getImmediate();
      this._storage = new HeartbeatStorageImpl(app);
      this._heartbeatsCachePromise = this._storage.read().then((result2) => {
        this._heartbeatsCache = result2;
        return result2;
      });
    }
    /**
     * Called to report a heartbeat. The function will generate
     * a HeartbeatsByUserAgent object, update heartbeatsCache, and persist it
     * to IndexedDB.
     * Note that we only store one heartbeat per day. So if a heartbeat for today is
     * already logged, subsequent calls to this function in the same day will be ignored.
     */
    async triggerHeartbeat() {
      var _a2, _b2;
      try {
        const platformLogger = this.container.getProvider("platform-logger").getImmediate();
        const agent = platformLogger.getPlatformInfoString();
        const date = getUTCDateString();
        if (((_a2 = this._heartbeatsCache) === null || _a2 === void 0 ? void 0 : _a2.heartbeats) == null) {
          this._heartbeatsCache = await this._heartbeatsCachePromise;
          if (((_b2 = this._heartbeatsCache) === null || _b2 === void 0 ? void 0 : _b2.heartbeats) == null) {
            return;
          }
        }
        if (this._heartbeatsCache.lastSentHeartbeatDate === date || this._heartbeatsCache.heartbeats.some((singleDateHeartbeat) => singleDateHeartbeat.date === date)) {
          return;
        } else {
          this._heartbeatsCache.heartbeats.push({ date, agent });
          if (this._heartbeatsCache.heartbeats.length > MAX_NUM_STORED_HEARTBEATS) {
            const earliestHeartbeatIdx = getEarliestHeartbeatIdx(this._heartbeatsCache.heartbeats);
            this._heartbeatsCache.heartbeats.splice(earliestHeartbeatIdx, 1);
          }
        }
        return this._storage.overwrite(this._heartbeatsCache);
      } catch (e) {
        logger$2.warn(e);
      }
    }
    /**
     * Returns a base64 encoded string which can be attached to the heartbeat-specific header directly.
     * It also clears all heartbeats from memory as well as in IndexedDB.
     *
     * NOTE: Consuming product SDKs should not send the header if this method
     * returns an empty string.
     */
    async getHeartbeatsHeader() {
      var _a2;
      try {
        if (this._heartbeatsCache === null) {
          await this._heartbeatsCachePromise;
        }
        if (((_a2 = this._heartbeatsCache) === null || _a2 === void 0 ? void 0 : _a2.heartbeats) == null || this._heartbeatsCache.heartbeats.length === 0) {
          return "";
        }
        const date = getUTCDateString();
        const { heartbeatsToSend, unsentEntries } = extractHeartbeatsForHeader(this._heartbeatsCache.heartbeats);
        const headerString = base64urlEncodeWithoutPadding(JSON.stringify({ version: 2, heartbeats: heartbeatsToSend }));
        this._heartbeatsCache.lastSentHeartbeatDate = date;
        if (unsentEntries.length > 0) {
          this._heartbeatsCache.heartbeats = unsentEntries;
          await this._storage.overwrite(this._heartbeatsCache);
        } else {
          this._heartbeatsCache.heartbeats = [];
          void this._storage.overwrite(this._heartbeatsCache);
        }
        return headerString;
      } catch (e) {
        logger$2.warn(e);
        return "";
      }
    }
  }
  function getUTCDateString() {
    const today = /* @__PURE__ */ new Date();
    return today.toISOString().substring(0, 10);
  }
  function extractHeartbeatsForHeader(heartbeatsCache, maxSize = MAX_HEADER_BYTES) {
    const heartbeatsToSend = [];
    let unsentEntries = heartbeatsCache.slice();
    for (const singleDateHeartbeat of heartbeatsCache) {
      const heartbeatEntry = heartbeatsToSend.find((hb) => hb.agent === singleDateHeartbeat.agent);
      if (!heartbeatEntry) {
        heartbeatsToSend.push({
          agent: singleDateHeartbeat.agent,
          dates: [singleDateHeartbeat.date]
        });
        if (countBytes(heartbeatsToSend) > maxSize) {
          heartbeatsToSend.pop();
          break;
        }
      } else {
        heartbeatEntry.dates.push(singleDateHeartbeat.date);
        if (countBytes(heartbeatsToSend) > maxSize) {
          heartbeatEntry.dates.pop();
          break;
        }
      }
      unsentEntries = unsentEntries.slice(1);
    }
    return {
      heartbeatsToSend,
      unsentEntries
    };
  }
  class HeartbeatStorageImpl {
    constructor(app) {
      this.app = app;
      this._canUseIndexedDBPromise = this.runIndexedDBEnvironmentCheck();
    }
    async runIndexedDBEnvironmentCheck() {
      if (!isIndexedDBAvailable()) {
        return false;
      } else {
        return validateIndexedDBOpenable().then(() => true).catch(() => false);
      }
    }
    /**
     * Read all heartbeats.
     */
    async read() {
      const canUseIndexedDB = await this._canUseIndexedDBPromise;
      if (!canUseIndexedDB) {
        return { heartbeats: [] };
      } else {
        const idbHeartbeatObject = await readHeartbeatsFromIndexedDB(this.app);
        if (idbHeartbeatObject === null || idbHeartbeatObject === void 0 ? void 0 : idbHeartbeatObject.heartbeats) {
          return idbHeartbeatObject;
        } else {
          return { heartbeats: [] };
        }
      }
    }
    // overwrite the storage with the provided heartbeats
    async overwrite(heartbeatsObject) {
      var _a2;
      const canUseIndexedDB = await this._canUseIndexedDBPromise;
      if (!canUseIndexedDB) {
        return;
      } else {
        const existingHeartbeatsObject = await this.read();
        return writeHeartbeatsToIndexedDB(this.app, {
          lastSentHeartbeatDate: (_a2 = heartbeatsObject.lastSentHeartbeatDate) !== null && _a2 !== void 0 ? _a2 : existingHeartbeatsObject.lastSentHeartbeatDate,
          heartbeats: heartbeatsObject.heartbeats
        });
      }
    }
    // add heartbeats
    async add(heartbeatsObject) {
      var _a2;
      const canUseIndexedDB = await this._canUseIndexedDBPromise;
      if (!canUseIndexedDB) {
        return;
      } else {
        const existingHeartbeatsObject = await this.read();
        return writeHeartbeatsToIndexedDB(this.app, {
          lastSentHeartbeatDate: (_a2 = heartbeatsObject.lastSentHeartbeatDate) !== null && _a2 !== void 0 ? _a2 : existingHeartbeatsObject.lastSentHeartbeatDate,
          heartbeats: [
            ...existingHeartbeatsObject.heartbeats,
            ...heartbeatsObject.heartbeats
          ]
        });
      }
    }
  }
  function countBytes(heartbeatsCache) {
    return base64urlEncodeWithoutPadding(
      // heartbeatsCache wrapper properties
      JSON.stringify({ version: 2, heartbeats: heartbeatsCache })
    ).length;
  }
  function getEarliestHeartbeatIdx(heartbeats) {
    if (heartbeats.length === 0) {
      return -1;
    }
    let earliestHeartbeatIdx = 0;
    let earliestHeartbeatDate = heartbeats[0].date;
    for (let i = 1; i < heartbeats.length; i++) {
      if (heartbeats[i].date < earliestHeartbeatDate) {
        earliestHeartbeatDate = heartbeats[i].date;
        earliestHeartbeatIdx = i;
      }
    }
    return earliestHeartbeatIdx;
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function registerCoreComponents(variant) {
    _registerComponent(new Component(
      "platform-logger",
      (container) => new PlatformLoggerServiceImpl(container),
      "PRIVATE"
      /* ComponentType.PRIVATE */
    ));
    _registerComponent(new Component(
      "heartbeat",
      (container) => new HeartbeatServiceImpl(container),
      "PRIVATE"
      /* ComponentType.PRIVATE */
    ));
    registerVersion(name$q, version$1$1, variant);
    registerVersion(name$q, version$1$1, "esm2017");
    registerVersion("fire-js", "");
  }
  registerCoreComponents("");
  var name$2 = "firebase";
  var version$2 = "11.6.0";
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  registerVersion(name$2, version$2, "app");
  function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
      t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
      for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
        if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
          t[p[i]] = s[p[i]];
      }
    return t;
  }
  typeof SuppressedError === "function" ? SuppressedError : function(error2, suppressed, message) {
    var e = new Error(message);
    return e.name = "SuppressedError", e.error = error2, e.suppressed = suppressed, e;
  };
  function _prodErrorMap() {
    return {
      [
        "dependent-sdk-initialized-before-auth"
        /* AuthErrorCode.DEPENDENT_SDK_INIT_BEFORE_AUTH */
      ]: "Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."
    };
  }
  const prodErrorMap = _prodErrorMap;
  const _DEFAULT_AUTH_ERROR_FACTORY = new ErrorFactory("auth", "Firebase", _prodErrorMap());
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const logClient$1 = new Logger("@firebase/auth");
  function _logWarn(msg, ...args) {
    if (logClient$1.logLevel <= LogLevel.WARN) {
      logClient$1.warn(`Auth (${SDK_VERSION$1}): ${msg}`, ...args);
    }
  }
  function _logError(msg, ...args) {
    if (logClient$1.logLevel <= LogLevel.ERROR) {
      logClient$1.error(`Auth (${SDK_VERSION$1}): ${msg}`, ...args);
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _fail(authOrCode, ...rest) {
    throw createErrorInternal(authOrCode, ...rest);
  }
  function _createError(authOrCode, ...rest) {
    return createErrorInternal(authOrCode, ...rest);
  }
  function _errorWithCustomMessage(auth2, code, message) {
    const errorMap = Object.assign(Object.assign({}, prodErrorMap()), { [code]: message });
    const factory = new ErrorFactory("auth", "Firebase", errorMap);
    return factory.create(code, {
      appName: auth2.name
    });
  }
  function _serverAppCurrentUserOperationNotSupportedError(auth2) {
    return _errorWithCustomMessage(auth2, "operation-not-supported-in-this-environment", "Operations that alter the current user are not supported in conjunction with FirebaseServerApp");
  }
  function createErrorInternal(authOrCode, ...rest) {
    if (typeof authOrCode !== "string") {
      const code = rest[0];
      const fullParams = [...rest.slice(1)];
      if (fullParams[0]) {
        fullParams[0].appName = authOrCode.name;
      }
      return authOrCode._errorFactory.create(code, ...fullParams);
    }
    return _DEFAULT_AUTH_ERROR_FACTORY.create(authOrCode, ...rest);
  }
  function _assert(assertion, authOrCode, ...rest) {
    if (!assertion) {
      throw createErrorInternal(authOrCode, ...rest);
    }
  }
  function debugFail(failure) {
    const message = `INTERNAL ASSERTION FAILED: ` + failure;
    _logError(message);
    throw new Error(message);
  }
  function debugAssert(assertion, message) {
    if (!assertion) {
      debugFail(message);
    }
  }
  function _isHttpOrHttps() {
    return _getCurrentScheme() === "http:" || _getCurrentScheme() === "https:";
  }
  function _getCurrentScheme() {
    var _a2;
    return typeof self !== "undefined" && ((_a2 = self.location) === null || _a2 === void 0 ? void 0 : _a2.protocol) || null;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _isOnline() {
    if (typeof navigator !== "undefined" && navigator && "onLine" in navigator && typeof navigator.onLine === "boolean" && // Apply only for traditional web apps and Chrome extensions.
    // This is especially true for Cordova apps which have unreliable
    // navigator.onLine behavior unless cordova-plugin-network-information is
    // installed which overwrites the native navigator.onLine value and
    // defines navigator.connection.
    (_isHttpOrHttps() || isBrowserExtension() || "connection" in navigator)) {
      return navigator.onLine;
    }
    return true;
  }
  function _getUserLanguage() {
    if (typeof navigator === "undefined") {
      return null;
    }
    const navigatorLanguage = navigator;
    return (
      // Most reliable, but only supported in Chrome/Firefox.
      navigatorLanguage.languages && navigatorLanguage.languages[0] || // Supported in most browsers, but returns the language of the browser
      // UI, not the language set in browser settings.
      navigatorLanguage.language || // Couldn't determine language.
      null
    );
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Delay {
    constructor(shortDelay, longDelay) {
      this.shortDelay = shortDelay;
      this.longDelay = longDelay;
      debugAssert(longDelay > shortDelay, "Short delay should be less than long delay!");
      this.isMobile = isMobileCordova() || isReactNative();
    }
    get() {
      if (!_isOnline()) {
        return Math.min(5e3, this.shortDelay);
      }
      return this.isMobile ? this.longDelay : this.shortDelay;
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _emulatorUrl(config, path) {
    debugAssert(config.emulator, "Emulator should always be set here");
    const { url } = config.emulator;
    if (!path) {
      return url;
    }
    return `${url}${path.startsWith("/") ? path.slice(1) : path}`;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class FetchProvider {
    static initialize(fetchImpl, headersImpl, responseImpl) {
      this.fetchImpl = fetchImpl;
      if (headersImpl) {
        this.headersImpl = headersImpl;
      }
      if (responseImpl) {
        this.responseImpl = responseImpl;
      }
    }
    static fetch() {
      if (this.fetchImpl) {
        return this.fetchImpl;
      }
      if (typeof self !== "undefined" && "fetch" in self) {
        return self.fetch;
      }
      if (typeof globalThis !== "undefined" && globalThis.fetch) {
        return globalThis.fetch;
      }
      if (typeof fetch !== "undefined") {
        return fetch;
      }
      debugFail("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill");
    }
    static headers() {
      if (this.headersImpl) {
        return this.headersImpl;
      }
      if (typeof self !== "undefined" && "Headers" in self) {
        return self.Headers;
      }
      if (typeof globalThis !== "undefined" && globalThis.Headers) {
        return globalThis.Headers;
      }
      if (typeof Headers !== "undefined") {
        return Headers;
      }
      debugFail("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill");
    }
    static response() {
      if (this.responseImpl) {
        return this.responseImpl;
      }
      if (typeof self !== "undefined" && "Response" in self) {
        return self.Response;
      }
      if (typeof globalThis !== "undefined" && globalThis.Response) {
        return globalThis.Response;
      }
      if (typeof Response !== "undefined") {
        return Response;
      }
      debugFail("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill");
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const SERVER_ERROR_MAP = {
    // Custom token errors.
    [
      "CREDENTIAL_MISMATCH"
      /* ServerError.CREDENTIAL_MISMATCH */
    ]: "custom-token-mismatch",
    // This can only happen if the SDK sends a bad request.
    [
      "MISSING_CUSTOM_TOKEN"
      /* ServerError.MISSING_CUSTOM_TOKEN */
    ]: "internal-error",
    // Create Auth URI errors.
    [
      "INVALID_IDENTIFIER"
      /* ServerError.INVALID_IDENTIFIER */
    ]: "invalid-email",
    // This can only happen if the SDK sends a bad request.
    [
      "MISSING_CONTINUE_URI"
      /* ServerError.MISSING_CONTINUE_URI */
    ]: "internal-error",
    // Sign in with email and password errors (some apply to sign up too).
    [
      "INVALID_PASSWORD"
      /* ServerError.INVALID_PASSWORD */
    ]: "wrong-password",
    // This can only happen if the SDK sends a bad request.
    [
      "MISSING_PASSWORD"
      /* ServerError.MISSING_PASSWORD */
    ]: "missing-password",
    // Thrown if Email Enumeration Protection is enabled in the project and the email or password is
    // invalid.
    [
      "INVALID_LOGIN_CREDENTIALS"
      /* ServerError.INVALID_LOGIN_CREDENTIALS */
    ]: "invalid-credential",
    // Sign up with email and password errors.
    [
      "EMAIL_EXISTS"
      /* ServerError.EMAIL_EXISTS */
    ]: "email-already-in-use",
    [
      "PASSWORD_LOGIN_DISABLED"
      /* ServerError.PASSWORD_LOGIN_DISABLED */
    ]: "operation-not-allowed",
    // Verify assertion for sign in with credential errors:
    [
      "INVALID_IDP_RESPONSE"
      /* ServerError.INVALID_IDP_RESPONSE */
    ]: "invalid-credential",
    [
      "INVALID_PENDING_TOKEN"
      /* ServerError.INVALID_PENDING_TOKEN */
    ]: "invalid-credential",
    [
      "FEDERATED_USER_ID_ALREADY_LINKED"
      /* ServerError.FEDERATED_USER_ID_ALREADY_LINKED */
    ]: "credential-already-in-use",
    // This can only happen if the SDK sends a bad request.
    [
      "MISSING_REQ_TYPE"
      /* ServerError.MISSING_REQ_TYPE */
    ]: "internal-error",
    // Send Password reset email errors:
    [
      "EMAIL_NOT_FOUND"
      /* ServerError.EMAIL_NOT_FOUND */
    ]: "user-not-found",
    [
      "RESET_PASSWORD_EXCEED_LIMIT"
      /* ServerError.RESET_PASSWORD_EXCEED_LIMIT */
    ]: "too-many-requests",
    [
      "EXPIRED_OOB_CODE"
      /* ServerError.EXPIRED_OOB_CODE */
    ]: "expired-action-code",
    [
      "INVALID_OOB_CODE"
      /* ServerError.INVALID_OOB_CODE */
    ]: "invalid-action-code",
    // This can only happen if the SDK sends a bad request.
    [
      "MISSING_OOB_CODE"
      /* ServerError.MISSING_OOB_CODE */
    ]: "internal-error",
    // Operations that require ID token in request:
    [
      "CREDENTIAL_TOO_OLD_LOGIN_AGAIN"
      /* ServerError.CREDENTIAL_TOO_OLD_LOGIN_AGAIN */
    ]: "requires-recent-login",
    [
      "INVALID_ID_TOKEN"
      /* ServerError.INVALID_ID_TOKEN */
    ]: "invalid-user-token",
    [
      "TOKEN_EXPIRED"
      /* ServerError.TOKEN_EXPIRED */
    ]: "user-token-expired",
    [
      "USER_NOT_FOUND"
      /* ServerError.USER_NOT_FOUND */
    ]: "user-token-expired",
    // Other errors.
    [
      "TOO_MANY_ATTEMPTS_TRY_LATER"
      /* ServerError.TOO_MANY_ATTEMPTS_TRY_LATER */
    ]: "too-many-requests",
    [
      "PASSWORD_DOES_NOT_MEET_REQUIREMENTS"
      /* ServerError.PASSWORD_DOES_NOT_MEET_REQUIREMENTS */
    ]: "password-does-not-meet-requirements",
    // Phone Auth related errors.
    [
      "INVALID_CODE"
      /* ServerError.INVALID_CODE */
    ]: "invalid-verification-code",
    [
      "INVALID_SESSION_INFO"
      /* ServerError.INVALID_SESSION_INFO */
    ]: "invalid-verification-id",
    [
      "INVALID_TEMPORARY_PROOF"
      /* ServerError.INVALID_TEMPORARY_PROOF */
    ]: "invalid-credential",
    [
      "MISSING_SESSION_INFO"
      /* ServerError.MISSING_SESSION_INFO */
    ]: "missing-verification-id",
    [
      "SESSION_EXPIRED"
      /* ServerError.SESSION_EXPIRED */
    ]: "code-expired",
    // Other action code errors when additional settings passed.
    // MISSING_CONTINUE_URI is getting mapped to INTERNAL_ERROR above.
    // This is OK as this error will be caught by client side validation.
    [
      "MISSING_ANDROID_PACKAGE_NAME"
      /* ServerError.MISSING_ANDROID_PACKAGE_NAME */
    ]: "missing-android-pkg-name",
    [
      "UNAUTHORIZED_DOMAIN"
      /* ServerError.UNAUTHORIZED_DOMAIN */
    ]: "unauthorized-continue-uri",
    // getProjectConfig errors when clientId is passed.
    [
      "INVALID_OAUTH_CLIENT_ID"
      /* ServerError.INVALID_OAUTH_CLIENT_ID */
    ]: "invalid-oauth-client-id",
    // User actions (sign-up or deletion) disabled errors.
    [
      "ADMIN_ONLY_OPERATION"
      /* ServerError.ADMIN_ONLY_OPERATION */
    ]: "admin-restricted-operation",
    // Multi factor related errors.
    [
      "INVALID_MFA_PENDING_CREDENTIAL"
      /* ServerError.INVALID_MFA_PENDING_CREDENTIAL */
    ]: "invalid-multi-factor-session",
    [
      "MFA_ENROLLMENT_NOT_FOUND"
      /* ServerError.MFA_ENROLLMENT_NOT_FOUND */
    ]: "multi-factor-info-not-found",
    [
      "MISSING_MFA_ENROLLMENT_ID"
      /* ServerError.MISSING_MFA_ENROLLMENT_ID */
    ]: "missing-multi-factor-info",
    [
      "MISSING_MFA_PENDING_CREDENTIAL"
      /* ServerError.MISSING_MFA_PENDING_CREDENTIAL */
    ]: "missing-multi-factor-session",
    [
      "SECOND_FACTOR_EXISTS"
      /* ServerError.SECOND_FACTOR_EXISTS */
    ]: "second-factor-already-in-use",
    [
      "SECOND_FACTOR_LIMIT_EXCEEDED"
      /* ServerError.SECOND_FACTOR_LIMIT_EXCEEDED */
    ]: "maximum-second-factor-count-exceeded",
    // Blocking functions related errors.
    [
      "BLOCKING_FUNCTION_ERROR_RESPONSE"
      /* ServerError.BLOCKING_FUNCTION_ERROR_RESPONSE */
    ]: "internal-error",
    // Recaptcha related errors.
    [
      "RECAPTCHA_NOT_ENABLED"
      /* ServerError.RECAPTCHA_NOT_ENABLED */
    ]: "recaptcha-not-enabled",
    [
      "MISSING_RECAPTCHA_TOKEN"
      /* ServerError.MISSING_RECAPTCHA_TOKEN */
    ]: "missing-recaptcha-token",
    [
      "INVALID_RECAPTCHA_TOKEN"
      /* ServerError.INVALID_RECAPTCHA_TOKEN */
    ]: "invalid-recaptcha-token",
    [
      "INVALID_RECAPTCHA_ACTION"
      /* ServerError.INVALID_RECAPTCHA_ACTION */
    ]: "invalid-recaptcha-action",
    [
      "MISSING_CLIENT_TYPE"
      /* ServerError.MISSING_CLIENT_TYPE */
    ]: "missing-client-type",
    [
      "MISSING_RECAPTCHA_VERSION"
      /* ServerError.MISSING_RECAPTCHA_VERSION */
    ]: "missing-recaptcha-version",
    [
      "INVALID_RECAPTCHA_VERSION"
      /* ServerError.INVALID_RECAPTCHA_VERSION */
    ]: "invalid-recaptcha-version",
    [
      "INVALID_REQ_TYPE"
      /* ServerError.INVALID_REQ_TYPE */
    ]: "invalid-req-type"
    /* AuthErrorCode.INVALID_REQ_TYPE */
  };
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const CookieAuthProxiedEndpoints = [
    "/v1/accounts:signInWithCustomToken",
    "/v1/accounts:signInWithEmailLink",
    "/v1/accounts:signInWithIdp",
    "/v1/accounts:signInWithPassword",
    "/v1/accounts:signInWithPhoneNumber",
    "/v1/token"
    /* Endpoint.TOKEN */
  ];
  const DEFAULT_API_TIMEOUT_MS = new Delay(3e4, 6e4);
  function _addTidIfNecessary(auth2, request) {
    if (auth2.tenantId && !request.tenantId) {
      return Object.assign(Object.assign({}, request), { tenantId: auth2.tenantId });
    }
    return request;
  }
  async function _performApiRequest(auth2, method, path, request, customErrorMap = {}) {
    return _performFetchWithErrorHandling(auth2, customErrorMap, async () => {
      let body = {};
      let params = {};
      if (request) {
        if (method === "GET") {
          params = request;
        } else {
          body = {
            body: JSON.stringify(request)
          };
        }
      }
      const query = querystring(Object.assign({ key: auth2.config.apiKey }, params)).slice(1);
      const headers = await auth2._getAdditionalHeaders();
      headers[
        "Content-Type"
        /* HttpHeader.CONTENT_TYPE */
      ] = "application/json";
      if (auth2.languageCode) {
        headers[
          "X-Firebase-Locale"
          /* HttpHeader.X_FIREBASE_LOCALE */
        ] = auth2.languageCode;
      }
      const fetchArgs = Object.assign({
        method,
        headers
      }, body);
      if (!isCloudflareWorker()) {
        fetchArgs.referrerPolicy = "no-referrer";
      }
      return FetchProvider.fetch()(await _getFinalTarget(auth2, auth2.config.apiHost, path, query), fetchArgs);
    });
  }
  async function _performFetchWithErrorHandling(auth2, customErrorMap, fetchFn) {
    auth2._canInitEmulator = false;
    const errorMap = Object.assign(Object.assign({}, SERVER_ERROR_MAP), customErrorMap);
    try {
      const networkTimeout = new NetworkTimeout(auth2);
      const response = await Promise.race([
        fetchFn(),
        networkTimeout.promise
      ]);
      networkTimeout.clearNetworkTimeout();
      const json = await response.json();
      if ("needConfirmation" in json) {
        throw _makeTaggedError(auth2, "account-exists-with-different-credential", json);
      }
      if (response.ok && !("errorMessage" in json)) {
        return json;
      } else {
        const errorMessage = response.ok ? json.errorMessage : json.error.message;
        const [serverErrorCode, serverErrorMessage] = errorMessage.split(" : ");
        if (serverErrorCode === "FEDERATED_USER_ID_ALREADY_LINKED") {
          throw _makeTaggedError(auth2, "credential-already-in-use", json);
        } else if (serverErrorCode === "EMAIL_EXISTS") {
          throw _makeTaggedError(auth2, "email-already-in-use", json);
        } else if (serverErrorCode === "USER_DISABLED") {
          throw _makeTaggedError(auth2, "user-disabled", json);
        }
        const authError = errorMap[serverErrorCode] || serverErrorCode.toLowerCase().replace(/[_\s]+/g, "-");
        if (serverErrorMessage) {
          throw _errorWithCustomMessage(auth2, authError, serverErrorMessage);
        } else {
          _fail(auth2, authError);
        }
      }
    } catch (e) {
      if (e instanceof FirebaseError) {
        throw e;
      }
      _fail(auth2, "network-request-failed", { "message": String(e) });
    }
  }
  async function _performSignInRequest(auth2, method, path, request, customErrorMap = {}) {
    const serverResponse = await _performApiRequest(auth2, method, path, request, customErrorMap);
    if ("mfaPendingCredential" in serverResponse) {
      _fail(auth2, "multi-factor-auth-required", {
        _serverResponse: serverResponse
      });
    }
    return serverResponse;
  }
  async function _getFinalTarget(auth2, host, path, query) {
    const base = `${host}${path}?${query}`;
    const authInternal = auth2;
    const finalTarget = authInternal.config.emulator ? _emulatorUrl(auth2.config, base) : `${auth2.config.apiScheme}://${base}`;
    if (CookieAuthProxiedEndpoints.includes(path)) {
      await authInternal._persistenceManagerAvailable;
      if (authInternal._getPersistenceType() === "COOKIE") {
        const cookiePersistence = authInternal._getPersistence();
        return cookiePersistence._getFinalTarget(finalTarget).toString();
      }
    }
    return finalTarget;
  }
  class NetworkTimeout {
    clearNetworkTimeout() {
      clearTimeout(this.timer);
    }
    constructor(auth2) {
      this.auth = auth2;
      this.timer = null;
      this.promise = new Promise((_, reject) => {
        this.timer = setTimeout(() => {
          return reject(_createError(
            this.auth,
            "network-request-failed"
            /* AuthErrorCode.NETWORK_REQUEST_FAILED */
          ));
        }, DEFAULT_API_TIMEOUT_MS.get());
      });
    }
  }
  function _makeTaggedError(auth2, code, response) {
    const errorParams = {
      appName: auth2.name
    };
    if (response.email) {
      errorParams.email = response.email;
    }
    if (response.phoneNumber) {
      errorParams.phoneNumber = response.phoneNumber;
    }
    const error2 = _createError(auth2, code, errorParams);
    error2.customData._tokenResponse = response;
    return error2;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function deleteAccount(auth2, request) {
    return _performApiRequest(auth2, "POST", "/v1/accounts:delete", request);
  }
  async function getAccountInfo(auth2, request) {
    return _performApiRequest(auth2, "POST", "/v1/accounts:lookup", request);
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function utcTimestampToDateString(utcTimestamp) {
    if (!utcTimestamp) {
      return void 0;
    }
    try {
      const date = new Date(Number(utcTimestamp));
      if (!isNaN(date.getTime())) {
        return date.toUTCString();
      }
    } catch (e) {
    }
    return void 0;
  }
  async function getIdTokenResult(user, forceRefresh = false) {
    const userInternal = getModularInstance(user);
    const token = await userInternal.getIdToken(forceRefresh);
    const claims = _parseToken(token);
    _assert(
      claims && claims.exp && claims.auth_time && claims.iat,
      userInternal.auth,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const firebase = typeof claims.firebase === "object" ? claims.firebase : void 0;
    const signInProvider = firebase === null || firebase === void 0 ? void 0 : firebase["sign_in_provider"];
    return {
      claims,
      token,
      authTime: utcTimestampToDateString(secondsStringToMilliseconds(claims.auth_time)),
      issuedAtTime: utcTimestampToDateString(secondsStringToMilliseconds(claims.iat)),
      expirationTime: utcTimestampToDateString(secondsStringToMilliseconds(claims.exp)),
      signInProvider: signInProvider || null,
      signInSecondFactor: (firebase === null || firebase === void 0 ? void 0 : firebase["sign_in_second_factor"]) || null
    };
  }
  function secondsStringToMilliseconds(seconds) {
    return Number(seconds) * 1e3;
  }
  function _parseToken(token) {
    const [algorithm, payload, signature] = token.split(".");
    if (algorithm === void 0 || payload === void 0 || signature === void 0) {
      _logError("JWT malformed, contained fewer than 3 sections");
      return null;
    }
    try {
      const decoded = base64Decode(payload);
      if (!decoded) {
        _logError("Failed to decode base64 JWT payload");
        return null;
      }
      return JSON.parse(decoded);
    } catch (e) {
      _logError("Caught error parsing JWT payload as JSON", e === null || e === void 0 ? void 0 : e.toString());
      return null;
    }
  }
  function _tokenExpiresIn(token) {
    const parsedToken = _parseToken(token);
    _assert(
      parsedToken,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    _assert(
      typeof parsedToken.exp !== "undefined",
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    _assert(
      typeof parsedToken.iat !== "undefined",
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    return Number(parsedToken.exp) - Number(parsedToken.iat);
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function _logoutIfInvalidated(user, promise, bypassAuthState = false) {
    if (bypassAuthState) {
      return promise;
    }
    try {
      return await promise;
    } catch (e) {
      if (e instanceof FirebaseError && isUserInvalidated(e)) {
        if (user.auth.currentUser === user) {
          await user.auth.signOut();
        }
      }
      throw e;
    }
  }
  function isUserInvalidated({ code }) {
    return code === `auth/${"user-disabled"}` || code === `auth/${"user-token-expired"}`;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ProactiveRefresh {
    constructor(user) {
      this.user = user;
      this.isRunning = false;
      this.timerId = null;
      this.errorBackoff = 3e4;
    }
    _start() {
      if (this.isRunning) {
        return;
      }
      this.isRunning = true;
      this.schedule();
    }
    _stop() {
      if (!this.isRunning) {
        return;
      }
      this.isRunning = false;
      if (this.timerId !== null) {
        clearTimeout(this.timerId);
      }
    }
    getInterval(wasError) {
      var _a2;
      if (wasError) {
        const interval = this.errorBackoff;
        this.errorBackoff = Math.min(
          this.errorBackoff * 2,
          96e4
          /* Duration.RETRY_BACKOFF_MAX */
        );
        return interval;
      } else {
        this.errorBackoff = 3e4;
        const expTime = (_a2 = this.user.stsTokenManager.expirationTime) !== null && _a2 !== void 0 ? _a2 : 0;
        const interval = expTime - Date.now() - 3e5;
        return Math.max(0, interval);
      }
    }
    schedule(wasError = false) {
      if (!this.isRunning) {
        return;
      }
      const interval = this.getInterval(wasError);
      this.timerId = setTimeout(async () => {
        await this.iteration();
      }, interval);
    }
    async iteration() {
      try {
        await this.user.getIdToken(true);
      } catch (e) {
        if ((e === null || e === void 0 ? void 0 : e.code) === `auth/${"network-request-failed"}`) {
          this.schedule(
            /* wasError */
            true
          );
        }
        return;
      }
      this.schedule();
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class UserMetadata {
    constructor(createdAt, lastLoginAt) {
      this.createdAt = createdAt;
      this.lastLoginAt = lastLoginAt;
      this._initializeTime();
    }
    _initializeTime() {
      this.lastSignInTime = utcTimestampToDateString(this.lastLoginAt);
      this.creationTime = utcTimestampToDateString(this.createdAt);
    }
    _copy(metadata) {
      this.createdAt = metadata.createdAt;
      this.lastLoginAt = metadata.lastLoginAt;
      this._initializeTime();
    }
    toJSON() {
      return {
        createdAt: this.createdAt,
        lastLoginAt: this.lastLoginAt
      };
    }
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function _reloadWithoutSaving(user) {
    var _a2;
    const auth2 = user.auth;
    const idToken = await user.getIdToken();
    const response = await _logoutIfInvalidated(user, getAccountInfo(auth2, { idToken }));
    _assert(
      response === null || response === void 0 ? void 0 : response.users.length,
      auth2,
      "internal-error"
      /* AuthErrorCode.INTERNAL_ERROR */
    );
    const coreAccount = response.users[0];
    user._notifyReloadListener(coreAccount);
    const newProviderData = ((_a2 = coreAccount.providerUserInfo) === null || _a2 === void 0 ? void 0 : _a2.length) ? extractProviderData(coreAccount.providerUserInfo) : [];
    const providerData = mergeProviderData(user.providerData, newProviderData);
    const oldIsAnonymous = user.isAnonymous;
    const newIsAnonymous = !(user.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length);
    const isAnonymous = !oldIsAnonymous ? false : newIsAnonymous;
    const updates = {
      uid: coreAccount.localId,
      displayName: coreAccount.displayName || null,
      photoURL: coreAccount.photoUrl || null,
      email: coreAccount.email || null,
      emailVerified: coreAccount.emailVerified || false,
      phoneNumber: coreAccount.phoneNumber || null,
      tenantId: coreAccount.tenantId || null,
      providerData,
      metadata: new UserMetadata(coreAccount.createdAt, coreAccount.lastLoginAt),
      isAnonymous
    };
    Object.assign(user, updates);
  }
  async function reload(user) {
    const userInternal = getModularInstance(user);
    await _reloadWithoutSaving(userInternal);
    await userInternal.auth._persistUserIfCurrent(userInternal);
    userInternal.auth._notifyListenersIfCurrent(userInternal);
  }
  function mergeProviderData(original, newData) {
    const deduped = original.filter((o) => !newData.some((n) => n.providerId === o.providerId));
    return [...deduped, ...newData];
  }
  function extractProviderData(providers) {
    return providers.map((_a2) => {
      var { providerId } = _a2, provider = __rest(_a2, ["providerId"]);
      return {
        providerId,
        uid: provider.rawId || "",
        displayName: provider.displayName || null,
        email: provider.email || null,
        phoneNumber: provider.phoneNumber || null,
        photoURL: provider.photoUrl || null
      };
    });
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function requestStsToken(auth2, refreshToken) {
    const response = await _performFetchWithErrorHandling(auth2, {}, async () => {
      const body = querystring({
        "grant_type": "refresh_token",
        "refresh_token": refreshToken
      }).slice(1);
      const { tokenApiHost, apiKey } = auth2.config;
      const url = await _getFinalTarget(auth2, tokenApiHost, "/v1/token", `key=${apiKey}`);
      const headers = await auth2._getAdditionalHeaders();
      headers[
        "Content-Type"
        /* HttpHeader.CONTENT_TYPE */
      ] = "application/x-www-form-urlencoded";
      return FetchProvider.fetch()(url, {
        method: "POST",
        headers,
        body
      });
    });
    return {
      accessToken: response.access_token,
      expiresIn: response.expires_in,
      refreshToken: response.refresh_token
    };
  }
  async function revokeToken(auth2, request) {
    return _performApiRequest(auth2, "POST", "/v2/accounts:revokeToken", _addTidIfNecessary(auth2, request));
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class StsTokenManager {
    constructor() {
      this.refreshToken = null;
      this.accessToken = null;
      this.expirationTime = null;
    }
    get isExpired() {
      return !this.expirationTime || Date.now() > this.expirationTime - 3e4;
    }
    updateFromServerResponse(response) {
      _assert(
        response.idToken,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      _assert(
        typeof response.idToken !== "undefined",
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      _assert(
        typeof response.refreshToken !== "undefined",
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      const expiresIn = "expiresIn" in response && typeof response.expiresIn !== "undefined" ? Number(response.expiresIn) : _tokenExpiresIn(response.idToken);
      this.updateTokensAndExpiration(response.idToken, response.refreshToken, expiresIn);
    }
    updateFromIdToken(idToken) {
      _assert(
        idToken.length !== 0,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      const expiresIn = _tokenExpiresIn(idToken);
      this.updateTokensAndExpiration(idToken, null, expiresIn);
    }
    async getToken(auth2, forceRefresh = false) {
      if (!forceRefresh && this.accessToken && !this.isExpired) {
        return this.accessToken;
      }
      _assert(
        this.refreshToken,
        auth2,
        "user-token-expired"
        /* AuthErrorCode.TOKEN_EXPIRED */
      );
      if (this.refreshToken) {
        await this.refresh(auth2, this.refreshToken);
        return this.accessToken;
      }
      return null;
    }
    clearRefreshToken() {
      this.refreshToken = null;
    }
    async refresh(auth2, oldToken) {
      const { accessToken, refreshToken, expiresIn } = await requestStsToken(auth2, oldToken);
      this.updateTokensAndExpiration(accessToken, refreshToken, Number(expiresIn));
    }
    updateTokensAndExpiration(accessToken, refreshToken, expiresInSec) {
      this.refreshToken = refreshToken || null;
      this.accessToken = accessToken || null;
      this.expirationTime = Date.now() + expiresInSec * 1e3;
    }
    static fromJSON(appName, object) {
      const { refreshToken, accessToken, expirationTime } = object;
      const manager = new StsTokenManager();
      if (refreshToken) {
        _assert(typeof refreshToken === "string", "internal-error", {
          appName
        });
        manager.refreshToken = refreshToken;
      }
      if (accessToken) {
        _assert(typeof accessToken === "string", "internal-error", {
          appName
        });
        manager.accessToken = accessToken;
      }
      if (expirationTime) {
        _assert(typeof expirationTime === "number", "internal-error", {
          appName
        });
        manager.expirationTime = expirationTime;
      }
      return manager;
    }
    toJSON() {
      return {
        refreshToken: this.refreshToken,
        accessToken: this.accessToken,
        expirationTime: this.expirationTime
      };
    }
    _assign(stsTokenManager) {
      this.accessToken = stsTokenManager.accessToken;
      this.refreshToken = stsTokenManager.refreshToken;
      this.expirationTime = stsTokenManager.expirationTime;
    }
    _clone() {
      return Object.assign(new StsTokenManager(), this.toJSON());
    }
    _performRefresh() {
      return debugFail("not implemented");
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function assertStringOrUndefined(assertion, appName) {
    _assert(typeof assertion === "string" || typeof assertion === "undefined", "internal-error", { appName });
  }
  class UserImpl {
    constructor(_a2) {
      var { uid, auth: auth2, stsTokenManager } = _a2, opt = __rest(_a2, ["uid", "auth", "stsTokenManager"]);
      this.providerId = "firebase";
      this.proactiveRefresh = new ProactiveRefresh(this);
      this.reloadUserInfo = null;
      this.reloadListener = null;
      this.uid = uid;
      this.auth = auth2;
      this.stsTokenManager = stsTokenManager;
      this.accessToken = stsTokenManager.accessToken;
      this.displayName = opt.displayName || null;
      this.email = opt.email || null;
      this.emailVerified = opt.emailVerified || false;
      this.phoneNumber = opt.phoneNumber || null;
      this.photoURL = opt.photoURL || null;
      this.isAnonymous = opt.isAnonymous || false;
      this.tenantId = opt.tenantId || null;
      this.providerData = opt.providerData ? [...opt.providerData] : [];
      this.metadata = new UserMetadata(opt.createdAt || void 0, opt.lastLoginAt || void 0);
    }
    async getIdToken(forceRefresh) {
      const accessToken = await _logoutIfInvalidated(this, this.stsTokenManager.getToken(this.auth, forceRefresh));
      _assert(
        accessToken,
        this.auth,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      if (this.accessToken !== accessToken) {
        this.accessToken = accessToken;
        await this.auth._persistUserIfCurrent(this);
        this.auth._notifyListenersIfCurrent(this);
      }
      return accessToken;
    }
    getIdTokenResult(forceRefresh) {
      return getIdTokenResult(this, forceRefresh);
    }
    reload() {
      return reload(this);
    }
    _assign(user) {
      if (this === user) {
        return;
      }
      _assert(
        this.uid === user.uid,
        this.auth,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      this.displayName = user.displayName;
      this.photoURL = user.photoURL;
      this.email = user.email;
      this.emailVerified = user.emailVerified;
      this.phoneNumber = user.phoneNumber;
      this.isAnonymous = user.isAnonymous;
      this.tenantId = user.tenantId;
      this.providerData = user.providerData.map((userInfo) => Object.assign({}, userInfo));
      this.metadata._copy(user.metadata);
      this.stsTokenManager._assign(user.stsTokenManager);
    }
    _clone(auth2) {
      const newUser = new UserImpl(Object.assign(Object.assign({}, this), { auth: auth2, stsTokenManager: this.stsTokenManager._clone() }));
      newUser.metadata._copy(this.metadata);
      return newUser;
    }
    _onReload(callback) {
      _assert(
        !this.reloadListener,
        this.auth,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      this.reloadListener = callback;
      if (this.reloadUserInfo) {
        this._notifyReloadListener(this.reloadUserInfo);
        this.reloadUserInfo = null;
      }
    }
    _notifyReloadListener(userInfo) {
      if (this.reloadListener) {
        this.reloadListener(userInfo);
      } else {
        this.reloadUserInfo = userInfo;
      }
    }
    _startProactiveRefresh() {
      this.proactiveRefresh._start();
    }
    _stopProactiveRefresh() {
      this.proactiveRefresh._stop();
    }
    async _updateTokensIfNecessary(response, reload2 = false) {
      let tokensRefreshed = false;
      if (response.idToken && response.idToken !== this.stsTokenManager.accessToken) {
        this.stsTokenManager.updateFromServerResponse(response);
        tokensRefreshed = true;
      }
      if (reload2) {
        await _reloadWithoutSaving(this);
      }
      await this.auth._persistUserIfCurrent(this);
      if (tokensRefreshed) {
        this.auth._notifyListenersIfCurrent(this);
      }
    }
    async delete() {
      if (_isFirebaseServerApp(this.auth.app)) {
        return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this.auth));
      }
      const idToken = await this.getIdToken();
      await _logoutIfInvalidated(this, deleteAccount(this.auth, { idToken }));
      this.stsTokenManager.clearRefreshToken();
      return this.auth.signOut();
    }
    toJSON() {
      return Object.assign(Object.assign({
        uid: this.uid,
        email: this.email || void 0,
        emailVerified: this.emailVerified,
        displayName: this.displayName || void 0,
        isAnonymous: this.isAnonymous,
        photoURL: this.photoURL || void 0,
        phoneNumber: this.phoneNumber || void 0,
        tenantId: this.tenantId || void 0,
        providerData: this.providerData.map((userInfo) => Object.assign({}, userInfo)),
        stsTokenManager: this.stsTokenManager.toJSON(),
        // Redirect event ID must be maintained in case there is a pending
        // redirect event.
        _redirectEventId: this._redirectEventId
      }, this.metadata.toJSON()), {
        // Required for compatibility with the legacy SDK (go/firebase-auth-sdk-persistence-parsing):
        apiKey: this.auth.config.apiKey,
        appName: this.auth.name
      });
    }
    get refreshToken() {
      return this.stsTokenManager.refreshToken || "";
    }
    static _fromJSON(auth2, object) {
      var _a2, _b2, _c, _d, _e, _f, _g, _h;
      const displayName = (_a2 = object.displayName) !== null && _a2 !== void 0 ? _a2 : void 0;
      const email = (_b2 = object.email) !== null && _b2 !== void 0 ? _b2 : void 0;
      const phoneNumber = (_c = object.phoneNumber) !== null && _c !== void 0 ? _c : void 0;
      const photoURL = (_d = object.photoURL) !== null && _d !== void 0 ? _d : void 0;
      const tenantId = (_e = object.tenantId) !== null && _e !== void 0 ? _e : void 0;
      const _redirectEventId = (_f = object._redirectEventId) !== null && _f !== void 0 ? _f : void 0;
      const createdAt = (_g = object.createdAt) !== null && _g !== void 0 ? _g : void 0;
      const lastLoginAt = (_h = object.lastLoginAt) !== null && _h !== void 0 ? _h : void 0;
      const { uid, emailVerified, isAnonymous, providerData, stsTokenManager: plainObjectTokenManager } = object;
      _assert(
        uid && plainObjectTokenManager,
        auth2,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      const stsTokenManager = StsTokenManager.fromJSON(this.name, plainObjectTokenManager);
      _assert(
        typeof uid === "string",
        auth2,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      assertStringOrUndefined(displayName, auth2.name);
      assertStringOrUndefined(email, auth2.name);
      _assert(
        typeof emailVerified === "boolean",
        auth2,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      _assert(
        typeof isAnonymous === "boolean",
        auth2,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      assertStringOrUndefined(phoneNumber, auth2.name);
      assertStringOrUndefined(photoURL, auth2.name);
      assertStringOrUndefined(tenantId, auth2.name);
      assertStringOrUndefined(_redirectEventId, auth2.name);
      assertStringOrUndefined(createdAt, auth2.name);
      assertStringOrUndefined(lastLoginAt, auth2.name);
      const user = new UserImpl({
        uid,
        auth: auth2,
        email,
        emailVerified,
        displayName,
        isAnonymous,
        photoURL,
        phoneNumber,
        tenantId,
        stsTokenManager,
        createdAt,
        lastLoginAt
      });
      if (providerData && Array.isArray(providerData)) {
        user.providerData = providerData.map((userInfo) => Object.assign({}, userInfo));
      }
      if (_redirectEventId) {
        user._redirectEventId = _redirectEventId;
      }
      return user;
    }
    /**
     * Initialize a User from an idToken server response
     * @param auth
     * @param idTokenResponse
     */
    static async _fromIdTokenResponse(auth2, idTokenResponse, isAnonymous = false) {
      const stsTokenManager = new StsTokenManager();
      stsTokenManager.updateFromServerResponse(idTokenResponse);
      const user = new UserImpl({
        uid: idTokenResponse.localId,
        auth: auth2,
        stsTokenManager,
        isAnonymous
      });
      await _reloadWithoutSaving(user);
      return user;
    }
    /**
     * Initialize a User from an idToken server response
     * @param auth
     * @param idTokenResponse
     */
    static async _fromGetAccountInfoResponse(auth2, response, idToken) {
      const coreAccount = response.users[0];
      _assert(
        coreAccount.localId !== void 0,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      const providerData = coreAccount.providerUserInfo !== void 0 ? extractProviderData(coreAccount.providerUserInfo) : [];
      const isAnonymous = !(coreAccount.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length);
      const stsTokenManager = new StsTokenManager();
      stsTokenManager.updateFromIdToken(idToken);
      const user = new UserImpl({
        uid: coreAccount.localId,
        auth: auth2,
        stsTokenManager,
        isAnonymous
      });
      const updates = {
        uid: coreAccount.localId,
        displayName: coreAccount.displayName || null,
        photoURL: coreAccount.photoUrl || null,
        email: coreAccount.email || null,
        emailVerified: coreAccount.emailVerified || false,
        phoneNumber: coreAccount.phoneNumber || null,
        tenantId: coreAccount.tenantId || null,
        providerData,
        metadata: new UserMetadata(coreAccount.createdAt, coreAccount.lastLoginAt),
        isAnonymous: !(coreAccount.email && coreAccount.passwordHash) && !(providerData === null || providerData === void 0 ? void 0 : providerData.length)
      };
      Object.assign(user, updates);
      return user;
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const instanceCache = /* @__PURE__ */ new Map();
  function _getInstance(cls) {
    debugAssert(cls instanceof Function, "Expected a class definition");
    let instance = instanceCache.get(cls);
    if (instance) {
      debugAssert(instance instanceof cls, "Instance stored in cache mismatched with class");
      return instance;
    }
    instance = new cls();
    instanceCache.set(cls, instance);
    return instance;
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class InMemoryPersistence {
    constructor() {
      this.type = "NONE";
      this.storage = {};
    }
    async _isAvailable() {
      return true;
    }
    async _set(key, value) {
      this.storage[key] = value;
    }
    async _get(key) {
      const value = this.storage[key];
      return value === void 0 ? null : value;
    }
    async _remove(key) {
      delete this.storage[key];
    }
    _addListener(_key, _listener) {
      return;
    }
    _removeListener(_key, _listener) {
      return;
    }
  }
  InMemoryPersistence.type = "NONE";
  const inMemoryPersistence = InMemoryPersistence;
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _persistenceKeyName(key, apiKey, appName) {
    return `${"firebase"}:${key}:${apiKey}:${appName}`;
  }
  class PersistenceUserManager {
    constructor(persistence, auth2, userKey) {
      this.persistence = persistence;
      this.auth = auth2;
      this.userKey = userKey;
      const { config, name: name2 } = this.auth;
      this.fullUserKey = _persistenceKeyName(this.userKey, config.apiKey, name2);
      this.fullPersistenceKey = _persistenceKeyName("persistence", config.apiKey, name2);
      this.boundEventHandler = auth2._onStorageEvent.bind(auth2);
      this.persistence._addListener(this.fullUserKey, this.boundEventHandler);
    }
    setCurrentUser(user) {
      return this.persistence._set(this.fullUserKey, user.toJSON());
    }
    async getCurrentUser() {
      const blob = await this.persistence._get(this.fullUserKey);
      if (!blob) {
        return null;
      }
      if (typeof blob === "string") {
        const response = await getAccountInfo(this.auth, { idToken: blob }).catch(() => void 0);
        if (!response) {
          return null;
        }
        return UserImpl._fromGetAccountInfoResponse(this.auth, response, blob);
      }
      return UserImpl._fromJSON(this.auth, blob);
    }
    removeCurrentUser() {
      return this.persistence._remove(this.fullUserKey);
    }
    savePersistenceForRedirect() {
      return this.persistence._set(this.fullPersistenceKey, this.persistence.type);
    }
    async setPersistence(newPersistence) {
      if (this.persistence === newPersistence) {
        return;
      }
      const currentUser = await this.getCurrentUser();
      await this.removeCurrentUser();
      this.persistence = newPersistence;
      if (currentUser) {
        return this.setCurrentUser(currentUser);
      }
    }
    delete() {
      this.persistence._removeListener(this.fullUserKey, this.boundEventHandler);
    }
    static async create(auth2, persistenceHierarchy, userKey = "authUser") {
      if (!persistenceHierarchy.length) {
        return new PersistenceUserManager(_getInstance(inMemoryPersistence), auth2, userKey);
      }
      const availablePersistences = (await Promise.all(persistenceHierarchy.map(async (persistence) => {
        if (await persistence._isAvailable()) {
          return persistence;
        }
        return void 0;
      }))).filter((persistence) => persistence);
      let selectedPersistence = availablePersistences[0] || _getInstance(inMemoryPersistence);
      const key = _persistenceKeyName(userKey, auth2.config.apiKey, auth2.name);
      let userToMigrate = null;
      for (const persistence of persistenceHierarchy) {
        try {
          const blob = await persistence._get(key);
          if (blob) {
            let user;
            if (typeof blob === "string") {
              const response = await getAccountInfo(auth2, {
                idToken: blob
              }).catch(() => void 0);
              if (!response) {
                break;
              }
              user = await UserImpl._fromGetAccountInfoResponse(auth2, response, blob);
            } else {
              user = UserImpl._fromJSON(auth2, blob);
            }
            if (persistence !== selectedPersistence) {
              userToMigrate = user;
            }
            selectedPersistence = persistence;
            break;
          }
        } catch (_a2) {
        }
      }
      const migrationHierarchy = availablePersistences.filter((p) => p._shouldAllowMigration);
      if (!selectedPersistence._shouldAllowMigration || !migrationHierarchy.length) {
        return new PersistenceUserManager(selectedPersistence, auth2, userKey);
      }
      selectedPersistence = migrationHierarchy[0];
      if (userToMigrate) {
        await selectedPersistence._set(key, userToMigrate.toJSON());
      }
      await Promise.all(persistenceHierarchy.map(async (persistence) => {
        if (persistence !== selectedPersistence) {
          try {
            await persistence._remove(key);
          } catch (_a2) {
          }
        }
      }));
      return new PersistenceUserManager(selectedPersistence, auth2, userKey);
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _getBrowserName(userAgent) {
    const ua = userAgent.toLowerCase();
    if (ua.includes("opera/") || ua.includes("opr/") || ua.includes("opios/")) {
      return "Opera";
    } else if (_isIEMobile(ua)) {
      return "IEMobile";
    } else if (ua.includes("msie") || ua.includes("trident/")) {
      return "IE";
    } else if (ua.includes("edge/")) {
      return "Edge";
    } else if (_isFirefox(ua)) {
      return "Firefox";
    } else if (ua.includes("silk/")) {
      return "Silk";
    } else if (_isBlackBerry(ua)) {
      return "Blackberry";
    } else if (_isWebOS(ua)) {
      return "Webos";
    } else if (_isSafari(ua)) {
      return "Safari";
    } else if ((ua.includes("chrome/") || _isChromeIOS(ua)) && !ua.includes("edge/")) {
      return "Chrome";
    } else if (_isAndroid(ua)) {
      return "Android";
    } else {
      const re = /([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/;
      const matches = userAgent.match(re);
      if ((matches === null || matches === void 0 ? void 0 : matches.length) === 2) {
        return matches[1];
      }
    }
    return "Other";
  }
  function _isFirefox(ua = getUA()) {
    return /firefox\//i.test(ua);
  }
  function _isSafari(userAgent = getUA()) {
    const ua = userAgent.toLowerCase();
    return ua.includes("safari/") && !ua.includes("chrome/") && !ua.includes("crios/") && !ua.includes("android");
  }
  function _isChromeIOS(ua = getUA()) {
    return /crios\//i.test(ua);
  }
  function _isIEMobile(ua = getUA()) {
    return /iemobile/i.test(ua);
  }
  function _isAndroid(ua = getUA()) {
    return /android/i.test(ua);
  }
  function _isBlackBerry(ua = getUA()) {
    return /blackberry/i.test(ua);
  }
  function _isWebOS(ua = getUA()) {
    return /webos/i.test(ua);
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _getClientVersion(clientPlatform, frameworks = []) {
    let reportedPlatform;
    switch (clientPlatform) {
      case "Browser":
        reportedPlatform = _getBrowserName(getUA());
        break;
      case "Worker":
        reportedPlatform = `${_getBrowserName(getUA())}-${clientPlatform}`;
        break;
      default:
        reportedPlatform = clientPlatform;
    }
    const reportedFrameworks = frameworks.length ? frameworks.join(",") : "FirebaseCore-web";
    return `${reportedPlatform}/${"JsCore"}/${SDK_VERSION$1}/${reportedFrameworks}`;
  }
  /**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class AuthMiddlewareQueue {
    constructor(auth2) {
      this.auth = auth2;
      this.queue = [];
    }
    pushCallback(callback, onAbort) {
      const wrappedCallback = (user) => new Promise((resolve, reject) => {
        try {
          const result2 = callback(user);
          resolve(result2);
        } catch (e) {
          reject(e);
        }
      });
      wrappedCallback.onAbort = onAbort;
      this.queue.push(wrappedCallback);
      const index = this.queue.length - 1;
      return () => {
        this.queue[index] = () => Promise.resolve();
      };
    }
    async runMiddleware(nextUser) {
      if (this.auth.currentUser === nextUser) {
        return;
      }
      const onAbortStack = [];
      try {
        for (const beforeStateCallback of this.queue) {
          await beforeStateCallback(nextUser);
          if (beforeStateCallback.onAbort) {
            onAbortStack.push(beforeStateCallback.onAbort);
          }
        }
      } catch (e) {
        onAbortStack.reverse();
        for (const onAbort of onAbortStack) {
          try {
            onAbort();
          } catch (_) {
          }
        }
        throw this.auth._errorFactory.create("login-blocked", {
          originalMessage: e === null || e === void 0 ? void 0 : e.message
        });
      }
    }
  }
  /**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function _getPasswordPolicy(auth2, request = {}) {
    return _performApiRequest(auth2, "GET", "/v2/passwordPolicy", _addTidIfNecessary(auth2, request));
  }
  /**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const MINIMUM_MIN_PASSWORD_LENGTH = 6;
  class PasswordPolicyImpl {
    constructor(response) {
      var _a2, _b2, _c, _d;
      const responseOptions = response.customStrengthOptions;
      this.customStrengthOptions = {};
      this.customStrengthOptions.minPasswordLength = (_a2 = responseOptions.minPasswordLength) !== null && _a2 !== void 0 ? _a2 : MINIMUM_MIN_PASSWORD_LENGTH;
      if (responseOptions.maxPasswordLength) {
        this.customStrengthOptions.maxPasswordLength = responseOptions.maxPasswordLength;
      }
      if (responseOptions.containsLowercaseCharacter !== void 0) {
        this.customStrengthOptions.containsLowercaseLetter = responseOptions.containsLowercaseCharacter;
      }
      if (responseOptions.containsUppercaseCharacter !== void 0) {
        this.customStrengthOptions.containsUppercaseLetter = responseOptions.containsUppercaseCharacter;
      }
      if (responseOptions.containsNumericCharacter !== void 0) {
        this.customStrengthOptions.containsNumericCharacter = responseOptions.containsNumericCharacter;
      }
      if (responseOptions.containsNonAlphanumericCharacter !== void 0) {
        this.customStrengthOptions.containsNonAlphanumericCharacter = responseOptions.containsNonAlphanumericCharacter;
      }
      this.enforcementState = response.enforcementState;
      if (this.enforcementState === "ENFORCEMENT_STATE_UNSPECIFIED") {
        this.enforcementState = "OFF";
      }
      this.allowedNonAlphanumericCharacters = (_c = (_b2 = response.allowedNonAlphanumericCharacters) === null || _b2 === void 0 ? void 0 : _b2.join("")) !== null && _c !== void 0 ? _c : "";
      this.forceUpgradeOnSignin = (_d = response.forceUpgradeOnSignin) !== null && _d !== void 0 ? _d : false;
      this.schemaVersion = response.schemaVersion;
    }
    validatePassword(password) {
      var _a2, _b2, _c, _d, _e, _f;
      const status = {
        isValid: true,
        passwordPolicy: this
      };
      this.validatePasswordLengthOptions(password, status);
      this.validatePasswordCharacterOptions(password, status);
      status.isValid && (status.isValid = (_a2 = status.meetsMinPasswordLength) !== null && _a2 !== void 0 ? _a2 : true);
      status.isValid && (status.isValid = (_b2 = status.meetsMaxPasswordLength) !== null && _b2 !== void 0 ? _b2 : true);
      status.isValid && (status.isValid = (_c = status.containsLowercaseLetter) !== null && _c !== void 0 ? _c : true);
      status.isValid && (status.isValid = (_d = status.containsUppercaseLetter) !== null && _d !== void 0 ? _d : true);
      status.isValid && (status.isValid = (_e = status.containsNumericCharacter) !== null && _e !== void 0 ? _e : true);
      status.isValid && (status.isValid = (_f = status.containsNonAlphanumericCharacter) !== null && _f !== void 0 ? _f : true);
      return status;
    }
    /**
     * Validates that the password meets the length options for the policy.
     *
     * @param password Password to validate.
     * @param status Validation status.
     */
    validatePasswordLengthOptions(password, status) {
      const minPasswordLength = this.customStrengthOptions.minPasswordLength;
      const maxPasswordLength = this.customStrengthOptions.maxPasswordLength;
      if (minPasswordLength) {
        status.meetsMinPasswordLength = password.length >= minPasswordLength;
      }
      if (maxPasswordLength) {
        status.meetsMaxPasswordLength = password.length <= maxPasswordLength;
      }
    }
    /**
     * Validates that the password meets the character options for the policy.
     *
     * @param password Password to validate.
     * @param status Validation status.
     */
    validatePasswordCharacterOptions(password, status) {
      this.updatePasswordCharacterOptionsStatuses(
        status,
        /* containsLowercaseCharacter= */
        false,
        /* containsUppercaseCharacter= */
        false,
        /* containsNumericCharacter= */
        false,
        /* containsNonAlphanumericCharacter= */
        false
      );
      let passwordChar;
      for (let i = 0; i < password.length; i++) {
        passwordChar = password.charAt(i);
        this.updatePasswordCharacterOptionsStatuses(
          status,
          /* containsLowercaseCharacter= */
          passwordChar >= "a" && passwordChar <= "z",
          /* containsUppercaseCharacter= */
          passwordChar >= "A" && passwordChar <= "Z",
          /* containsNumericCharacter= */
          passwordChar >= "0" && passwordChar <= "9",
          /* containsNonAlphanumericCharacter= */
          this.allowedNonAlphanumericCharacters.includes(passwordChar)
        );
      }
    }
    /**
     * Updates the running validation status with the statuses for the character options.
     * Expected to be called each time a character is processed to update each option status
     * based on the current character.
     *
     * @param status Validation status.
     * @param containsLowercaseCharacter Whether the character is a lowercase letter.
     * @param containsUppercaseCharacter Whether the character is an uppercase letter.
     * @param containsNumericCharacter Whether the character is a numeric character.
     * @param containsNonAlphanumericCharacter Whether the character is a non-alphanumeric character.
     */
    updatePasswordCharacterOptionsStatuses(status, containsLowercaseCharacter, containsUppercaseCharacter, containsNumericCharacter, containsNonAlphanumericCharacter) {
      if (this.customStrengthOptions.containsLowercaseLetter) {
        status.containsLowercaseLetter || (status.containsLowercaseLetter = containsLowercaseCharacter);
      }
      if (this.customStrengthOptions.containsUppercaseLetter) {
        status.containsUppercaseLetter || (status.containsUppercaseLetter = containsUppercaseCharacter);
      }
      if (this.customStrengthOptions.containsNumericCharacter) {
        status.containsNumericCharacter || (status.containsNumericCharacter = containsNumericCharacter);
      }
      if (this.customStrengthOptions.containsNonAlphanumericCharacter) {
        status.containsNonAlphanumericCharacter || (status.containsNonAlphanumericCharacter = containsNonAlphanumericCharacter);
      }
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class AuthImpl {
    constructor(app, heartbeatServiceProvider, appCheckServiceProvider, config) {
      this.app = app;
      this.heartbeatServiceProvider = heartbeatServiceProvider;
      this.appCheckServiceProvider = appCheckServiceProvider;
      this.config = config;
      this.currentUser = null;
      this.emulatorConfig = null;
      this.operations = Promise.resolve();
      this.authStateSubscription = new Subscription(this);
      this.idTokenSubscription = new Subscription(this);
      this.beforeStateQueue = new AuthMiddlewareQueue(this);
      this.redirectUser = null;
      this.isProactiveRefreshEnabled = false;
      this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION = 1;
      this._canInitEmulator = true;
      this._isInitialized = false;
      this._deleted = false;
      this._initializationPromise = null;
      this._popupRedirectResolver = null;
      this._errorFactory = _DEFAULT_AUTH_ERROR_FACTORY;
      this._agentRecaptchaConfig = null;
      this._tenantRecaptchaConfigs = {};
      this._projectPasswordPolicy = null;
      this._tenantPasswordPolicies = {};
      this._resolvePersistenceManagerAvailable = void 0;
      this.lastNotifiedUid = void 0;
      this.languageCode = null;
      this.tenantId = null;
      this.settings = { appVerificationDisabledForTesting: false };
      this.frameworks = [];
      this.name = app.name;
      this.clientVersion = config.sdkClientVersion;
      this._persistenceManagerAvailable = new Promise((resolve) => this._resolvePersistenceManagerAvailable = resolve);
    }
    _initializeWithPersistence(persistenceHierarchy, popupRedirectResolver) {
      if (popupRedirectResolver) {
        this._popupRedirectResolver = _getInstance(popupRedirectResolver);
      }
      this._initializationPromise = this.queue(async () => {
        var _a2, _b2, _c;
        if (this._deleted) {
          return;
        }
        this.persistenceManager = await PersistenceUserManager.create(this, persistenceHierarchy);
        (_a2 = this._resolvePersistenceManagerAvailable) === null || _a2 === void 0 ? void 0 : _a2.call(this);
        if (this._deleted) {
          return;
        }
        if ((_b2 = this._popupRedirectResolver) === null || _b2 === void 0 ? void 0 : _b2._shouldInitProactively) {
          try {
            await this._popupRedirectResolver._initialize(this);
          } catch (e) {
          }
        }
        await this.initializeCurrentUser(popupRedirectResolver);
        this.lastNotifiedUid = ((_c = this.currentUser) === null || _c === void 0 ? void 0 : _c.uid) || null;
        if (this._deleted) {
          return;
        }
        this._isInitialized = true;
      });
      return this._initializationPromise;
    }
    /**
     * If the persistence is changed in another window, the user manager will let us know
     */
    async _onStorageEvent() {
      if (this._deleted) {
        return;
      }
      const user = await this.assertedPersistence.getCurrentUser();
      if (!this.currentUser && !user) {
        return;
      }
      if (this.currentUser && user && this.currentUser.uid === user.uid) {
        this._currentUser._assign(user);
        await this.currentUser.getIdToken();
        return;
      }
      await this._updateCurrentUser(
        user,
        /* skipBeforeStateCallbacks */
        true
      );
    }
    async initializeCurrentUserFromIdToken(idToken) {
      try {
        const response = await getAccountInfo(this, { idToken });
        const user = await UserImpl._fromGetAccountInfoResponse(this, response, idToken);
        await this.directlySetCurrentUser(user);
      } catch (err) {
        console.warn("FirebaseServerApp could not login user with provided authIdToken: ", err);
        await this.directlySetCurrentUser(null);
      }
    }
    async initializeCurrentUser(popupRedirectResolver) {
      var _a2;
      if (_isFirebaseServerApp(this.app)) {
        const idToken = this.app.settings.authIdToken;
        if (idToken) {
          return new Promise((resolve) => {
            setTimeout(() => this.initializeCurrentUserFromIdToken(idToken).then(resolve, resolve));
          });
        } else {
          return this.directlySetCurrentUser(null);
        }
      }
      const previouslyStoredUser = await this.assertedPersistence.getCurrentUser();
      let futureCurrentUser = previouslyStoredUser;
      let needsTocheckMiddleware = false;
      if (popupRedirectResolver && this.config.authDomain) {
        await this.getOrInitRedirectPersistenceManager();
        const redirectUserEventId = (_a2 = this.redirectUser) === null || _a2 === void 0 ? void 0 : _a2._redirectEventId;
        const storedUserEventId = futureCurrentUser === null || futureCurrentUser === void 0 ? void 0 : futureCurrentUser._redirectEventId;
        const result2 = await this.tryRedirectSignIn(popupRedirectResolver);
        if ((!redirectUserEventId || redirectUserEventId === storedUserEventId) && (result2 === null || result2 === void 0 ? void 0 : result2.user)) {
          futureCurrentUser = result2.user;
          needsTocheckMiddleware = true;
        }
      }
      if (!futureCurrentUser) {
        return this.directlySetCurrentUser(null);
      }
      if (!futureCurrentUser._redirectEventId) {
        if (needsTocheckMiddleware) {
          try {
            await this.beforeStateQueue.runMiddleware(futureCurrentUser);
          } catch (e) {
            futureCurrentUser = previouslyStoredUser;
            this._popupRedirectResolver._overrideRedirectResult(this, () => Promise.reject(e));
          }
        }
        if (futureCurrentUser) {
          return this.reloadAndSetCurrentUserOrClear(futureCurrentUser);
        } else {
          return this.directlySetCurrentUser(null);
        }
      }
      _assert(
        this._popupRedirectResolver,
        this,
        "argument-error"
        /* AuthErrorCode.ARGUMENT_ERROR */
      );
      await this.getOrInitRedirectPersistenceManager();
      if (this.redirectUser && this.redirectUser._redirectEventId === futureCurrentUser._redirectEventId) {
        return this.directlySetCurrentUser(futureCurrentUser);
      }
      return this.reloadAndSetCurrentUserOrClear(futureCurrentUser);
    }
    async tryRedirectSignIn(redirectResolver) {
      let result2 = null;
      try {
        result2 = await this._popupRedirectResolver._completeRedirectFn(this, redirectResolver, true);
      } catch (e) {
        await this._setRedirectUser(null);
      }
      return result2;
    }
    async reloadAndSetCurrentUserOrClear(user) {
      try {
        await _reloadWithoutSaving(user);
      } catch (e) {
        if ((e === null || e === void 0 ? void 0 : e.code) !== `auth/${"network-request-failed"}`) {
          return this.directlySetCurrentUser(null);
        }
      }
      return this.directlySetCurrentUser(user);
    }
    useDeviceLanguage() {
      this.languageCode = _getUserLanguage();
    }
    async _delete() {
      this._deleted = true;
    }
    async updateCurrentUser(userExtern) {
      if (_isFirebaseServerApp(this.app)) {
        return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));
      }
      const user = userExtern ? getModularInstance(userExtern) : null;
      if (user) {
        _assert(
          user.auth.config.apiKey === this.config.apiKey,
          this,
          "invalid-user-token"
          /* AuthErrorCode.INVALID_AUTH */
        );
      }
      return this._updateCurrentUser(user && user._clone(this));
    }
    async _updateCurrentUser(user, skipBeforeStateCallbacks = false) {
      if (this._deleted) {
        return;
      }
      if (user) {
        _assert(
          this.tenantId === user.tenantId,
          this,
          "tenant-id-mismatch"
          /* AuthErrorCode.TENANT_ID_MISMATCH */
        );
      }
      if (!skipBeforeStateCallbacks) {
        await this.beforeStateQueue.runMiddleware(user);
      }
      return this.queue(async () => {
        await this.directlySetCurrentUser(user);
        this.notifyAuthListeners();
      });
    }
    async signOut() {
      if (_isFirebaseServerApp(this.app)) {
        return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));
      }
      await this.beforeStateQueue.runMiddleware(null);
      if (this.redirectPersistenceManager || this._popupRedirectResolver) {
        await this._setRedirectUser(null);
      }
      return this._updateCurrentUser(
        null,
        /* skipBeforeStateCallbacks */
        true
      );
    }
    setPersistence(persistence) {
      if (_isFirebaseServerApp(this.app)) {
        return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(this));
      }
      return this.queue(async () => {
        await this.assertedPersistence.setPersistence(_getInstance(persistence));
      });
    }
    _getRecaptchaConfig() {
      if (this.tenantId == null) {
        return this._agentRecaptchaConfig;
      } else {
        return this._tenantRecaptchaConfigs[this.tenantId];
      }
    }
    async validatePassword(password) {
      if (!this._getPasswordPolicyInternal()) {
        await this._updatePasswordPolicy();
      }
      const passwordPolicy = this._getPasswordPolicyInternal();
      if (passwordPolicy.schemaVersion !== this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION) {
        return Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version", {}));
      }
      return passwordPolicy.validatePassword(password);
    }
    _getPasswordPolicyInternal() {
      if (this.tenantId === null) {
        return this._projectPasswordPolicy;
      } else {
        return this._tenantPasswordPolicies[this.tenantId];
      }
    }
    async _updatePasswordPolicy() {
      const response = await _getPasswordPolicy(this);
      const passwordPolicy = new PasswordPolicyImpl(response);
      if (this.tenantId === null) {
        this._projectPasswordPolicy = passwordPolicy;
      } else {
        this._tenantPasswordPolicies[this.tenantId] = passwordPolicy;
      }
    }
    _getPersistenceType() {
      return this.assertedPersistence.persistence.type;
    }
    _getPersistence() {
      return this.assertedPersistence.persistence;
    }
    _updateErrorMap(errorMap) {
      this._errorFactory = new ErrorFactory("auth", "Firebase", errorMap());
    }
    onAuthStateChanged(nextOrObserver, error2, completed) {
      return this.registerStateListener(this.authStateSubscription, nextOrObserver, error2, completed);
    }
    beforeAuthStateChanged(callback, onAbort) {
      return this.beforeStateQueue.pushCallback(callback, onAbort);
    }
    onIdTokenChanged(nextOrObserver, error2, completed) {
      return this.registerStateListener(this.idTokenSubscription, nextOrObserver, error2, completed);
    }
    authStateReady() {
      return new Promise((resolve, reject) => {
        if (this.currentUser) {
          resolve();
        } else {
          const unsubscribe = this.onAuthStateChanged(() => {
            unsubscribe();
            resolve();
          }, reject);
        }
      });
    }
    /**
     * Revokes the given access token. Currently only supports Apple OAuth access tokens.
     */
    async revokeAccessToken(token) {
      if (this.currentUser) {
        const idToken = await this.currentUser.getIdToken();
        const request = {
          providerId: "apple.com",
          tokenType: "ACCESS_TOKEN",
          token,
          idToken
        };
        if (this.tenantId != null) {
          request.tenantId = this.tenantId;
        }
        await revokeToken(this, request);
      }
    }
    toJSON() {
      var _a2;
      return {
        apiKey: this.config.apiKey,
        authDomain: this.config.authDomain,
        appName: this.name,
        currentUser: (_a2 = this._currentUser) === null || _a2 === void 0 ? void 0 : _a2.toJSON()
      };
    }
    async _setRedirectUser(user, popupRedirectResolver) {
      const redirectManager = await this.getOrInitRedirectPersistenceManager(popupRedirectResolver);
      return user === null ? redirectManager.removeCurrentUser() : redirectManager.setCurrentUser(user);
    }
    async getOrInitRedirectPersistenceManager(popupRedirectResolver) {
      if (!this.redirectPersistenceManager) {
        const resolver = popupRedirectResolver && _getInstance(popupRedirectResolver) || this._popupRedirectResolver;
        _assert(
          resolver,
          this,
          "argument-error"
          /* AuthErrorCode.ARGUMENT_ERROR */
        );
        this.redirectPersistenceManager = await PersistenceUserManager.create(
          this,
          [_getInstance(resolver._redirectPersistence)],
          "redirectUser"
          /* KeyName.REDIRECT_USER */
        );
        this.redirectUser = await this.redirectPersistenceManager.getCurrentUser();
      }
      return this.redirectPersistenceManager;
    }
    async _redirectUserForId(id) {
      var _a2, _b2;
      if (this._isInitialized) {
        await this.queue(async () => {
        });
      }
      if (((_a2 = this._currentUser) === null || _a2 === void 0 ? void 0 : _a2._redirectEventId) === id) {
        return this._currentUser;
      }
      if (((_b2 = this.redirectUser) === null || _b2 === void 0 ? void 0 : _b2._redirectEventId) === id) {
        return this.redirectUser;
      }
      return null;
    }
    async _persistUserIfCurrent(user) {
      if (user === this.currentUser) {
        return this.queue(async () => this.directlySetCurrentUser(user));
      }
    }
    /** Notifies listeners only if the user is current */
    _notifyListenersIfCurrent(user) {
      if (user === this.currentUser) {
        this.notifyAuthListeners();
      }
    }
    _key() {
      return `${this.config.authDomain}:${this.config.apiKey}:${this.name}`;
    }
    _startProactiveRefresh() {
      this.isProactiveRefreshEnabled = true;
      if (this.currentUser) {
        this._currentUser._startProactiveRefresh();
      }
    }
    _stopProactiveRefresh() {
      this.isProactiveRefreshEnabled = false;
      if (this.currentUser) {
        this._currentUser._stopProactiveRefresh();
      }
    }
    /** Returns the current user cast as the internal type */
    get _currentUser() {
      return this.currentUser;
    }
    notifyAuthListeners() {
      var _a2, _b2;
      if (!this._isInitialized) {
        return;
      }
      this.idTokenSubscription.next(this.currentUser);
      const currentUid = (_b2 = (_a2 = this.currentUser) === null || _a2 === void 0 ? void 0 : _a2.uid) !== null && _b2 !== void 0 ? _b2 : null;
      if (this.lastNotifiedUid !== currentUid) {
        this.lastNotifiedUid = currentUid;
        this.authStateSubscription.next(this.currentUser);
      }
    }
    registerStateListener(subscription, nextOrObserver, error2, completed) {
      if (this._deleted) {
        return () => {
        };
      }
      const cb = typeof nextOrObserver === "function" ? nextOrObserver : nextOrObserver.next.bind(nextOrObserver);
      let isUnsubscribed = false;
      const promise = this._isInitialized ? Promise.resolve() : this._initializationPromise;
      _assert(
        promise,
        this,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      promise.then(() => {
        if (isUnsubscribed) {
          return;
        }
        cb(this.currentUser);
      });
      if (typeof nextOrObserver === "function") {
        const unsubscribe = subscription.addObserver(nextOrObserver, error2, completed);
        return () => {
          isUnsubscribed = true;
          unsubscribe();
        };
      } else {
        const unsubscribe = subscription.addObserver(nextOrObserver);
        return () => {
          isUnsubscribed = true;
          unsubscribe();
        };
      }
    }
    /**
     * Unprotected (from race conditions) method to set the current user. This
     * should only be called from within a queued callback. This is necessary
     * because the queue shouldn't rely on another queued callback.
     */
    async directlySetCurrentUser(user) {
      if (this.currentUser && this.currentUser !== user) {
        this._currentUser._stopProactiveRefresh();
      }
      if (user && this.isProactiveRefreshEnabled) {
        user._startProactiveRefresh();
      }
      this.currentUser = user;
      if (user) {
        await this.assertedPersistence.setCurrentUser(user);
      } else {
        await this.assertedPersistence.removeCurrentUser();
      }
    }
    queue(action) {
      this.operations = this.operations.then(action, action);
      return this.operations;
    }
    get assertedPersistence() {
      _assert(
        this.persistenceManager,
        this,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      return this.persistenceManager;
    }
    _logFramework(framework) {
      if (!framework || this.frameworks.includes(framework)) {
        return;
      }
      this.frameworks.push(framework);
      this.frameworks.sort();
      this.clientVersion = _getClientVersion(this.config.clientPlatform, this._getFrameworks());
    }
    _getFrameworks() {
      return this.frameworks;
    }
    async _getAdditionalHeaders() {
      var _a2;
      const headers = {
        [
          "X-Client-Version"
          /* HttpHeader.X_CLIENT_VERSION */
        ]: this.clientVersion
      };
      if (this.app.options.appId) {
        headers[
          "X-Firebase-gmpid"
          /* HttpHeader.X_FIREBASE_GMPID */
        ] = this.app.options.appId;
      }
      const heartbeatsHeader = await ((_a2 = this.heartbeatServiceProvider.getImmediate({
        optional: true
      })) === null || _a2 === void 0 ? void 0 : _a2.getHeartbeatsHeader());
      if (heartbeatsHeader) {
        headers[
          "X-Firebase-Client"
          /* HttpHeader.X_FIREBASE_CLIENT */
        ] = heartbeatsHeader;
      }
      const appCheckToken = await this._getAppCheckToken();
      if (appCheckToken) {
        headers[
          "X-Firebase-AppCheck"
          /* HttpHeader.X_FIREBASE_APP_CHECK */
        ] = appCheckToken;
      }
      return headers;
    }
    async _getAppCheckToken() {
      var _a2;
      if (_isFirebaseServerApp(this.app) && this.app.settings.appCheckToken) {
        return this.app.settings.appCheckToken;
      }
      const appCheckTokenResult = await ((_a2 = this.appCheckServiceProvider.getImmediate({ optional: true })) === null || _a2 === void 0 ? void 0 : _a2.getToken());
      if (appCheckTokenResult === null || appCheckTokenResult === void 0 ? void 0 : appCheckTokenResult.error) {
        _logWarn(`Error while retrieving App Check token: ${appCheckTokenResult.error}`);
      }
      return appCheckTokenResult === null || appCheckTokenResult === void 0 ? void 0 : appCheckTokenResult.token;
    }
  }
  function _castAuth(auth2) {
    return getModularInstance(auth2);
  }
  class Subscription {
    constructor(auth2) {
      this.auth = auth2;
      this.observer = null;
      this.addObserver = createSubscribe((observer) => this.observer = observer);
    }
    get next() {
      _assert(
        this.observer,
        this.auth,
        "internal-error"
        /* AuthErrorCode.INTERNAL_ERROR */
      );
      return this.observer.next.bind(this.observer);
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function initializeAuth(app, deps) {
    const provider = _getProvider(app, "auth");
    if (provider.isInitialized()) {
      const auth3 = provider.getImmediate();
      const initialOptions = provider.getOptions();
      if (deepEqual(initialOptions, deps !== null && deps !== void 0 ? deps : {})) {
        return auth3;
      } else {
        _fail(
          auth3,
          "already-initialized"
          /* AuthErrorCode.ALREADY_INITIALIZED */
        );
      }
    }
    const auth2 = provider.initialize({ options: deps });
    return auth2;
  }
  function _initializeAuthInstance(auth2, deps) {
    const persistence = (deps === null || deps === void 0 ? void 0 : deps.persistence) || [];
    const hierarchy = (Array.isArray(persistence) ? persistence : [persistence]).map(_getInstance);
    if (deps === null || deps === void 0 ? void 0 : deps.errorMap) {
      auth2._updateErrorMap(deps.errorMap);
    }
    auth2._initializeWithPersistence(hierarchy, deps === null || deps === void 0 ? void 0 : deps.popupRedirectResolver);
  }
  function connectAuthEmulator(auth2, url, options) {
    const authInternal = _castAuth(auth2);
    _assert(
      /^https?:\/\//.test(url),
      authInternal,
      "invalid-emulator-scheme"
      /* AuthErrorCode.INVALID_EMULATOR_SCHEME */
    );
    const disableWarnings = false;
    const protocol = extractProtocol(url);
    const { host, port } = extractHostAndPort(url);
    const portStr = port === null ? "" : `:${port}`;
    const emulator = { url: `${protocol}//${host}${portStr}/` };
    const emulatorConfig = Object.freeze({
      host,
      port,
      protocol: protocol.replace(":", ""),
      options: Object.freeze({ disableWarnings })
    });
    if (!authInternal._canInitEmulator) {
      _assert(
        authInternal.config.emulator && authInternal.emulatorConfig,
        authInternal,
        "emulator-config-failed"
        /* AuthErrorCode.EMULATOR_CONFIG_FAILED */
      );
      _assert(
        deepEqual(emulator, authInternal.config.emulator) && deepEqual(emulatorConfig, authInternal.emulatorConfig),
        authInternal,
        "emulator-config-failed"
        /* AuthErrorCode.EMULATOR_CONFIG_FAILED */
      );
      return;
    }
    authInternal.config.emulator = emulator;
    authInternal.emulatorConfig = emulatorConfig;
    authInternal.settings.appVerificationDisabledForTesting = true;
    {
      emitEmulatorWarning();
    }
  }
  function extractProtocol(url) {
    const protocolEnd = url.indexOf(":");
    return protocolEnd < 0 ? "" : url.substr(0, protocolEnd + 1);
  }
  function extractHostAndPort(url) {
    const protocol = extractProtocol(url);
    const authority = /(\/\/)?([^?#/]+)/.exec(url.substr(protocol.length));
    if (!authority) {
      return { host: "", port: null };
    }
    const hostAndPort = authority[2].split("@").pop() || "";
    const bracketedIPv6 = /^(\[[^\]]+\])(:|$)/.exec(hostAndPort);
    if (bracketedIPv6) {
      const host = bracketedIPv6[1];
      return { host, port: parsePort(hostAndPort.substr(host.length + 1)) };
    } else {
      const [host, port] = hostAndPort.split(":");
      return { host, port: parsePort(port) };
    }
  }
  function parsePort(portStr) {
    if (!portStr) {
      return null;
    }
    const port = Number(portStr);
    if (isNaN(port)) {
      return null;
    }
    return port;
  }
  function emitEmulatorWarning() {
    function attachBanner() {
      const el = document.createElement("p");
      const sty = el.style;
      el.innerText = "Running in emulator mode. Do not use with production credentials.";
      sty.position = "fixed";
      sty.width = "100%";
      sty.backgroundColor = "#ffffff";
      sty.border = ".1em solid #000000";
      sty.color = "#b50000";
      sty.bottom = "0px";
      sty.left = "0px";
      sty.margin = "0px";
      sty.zIndex = "10000";
      sty.textAlign = "center";
      el.classList.add("firebase-emulator-warning");
      document.body.appendChild(el);
    }
    if (typeof console !== "undefined" && typeof console.info === "function") {
      console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials.");
    }
    if (typeof window !== "undefined" && typeof document !== "undefined") {
      if (document.readyState === "loading") {
        window.addEventListener("DOMContentLoaded", attachBanner);
      } else {
        attachBanner();
      }
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class UserCredentialImpl {
    constructor(params) {
      this.user = params.user;
      this.providerId = params.providerId;
      this._tokenResponse = params._tokenResponse;
      this.operationType = params.operationType;
    }
    static async _fromIdTokenResponse(auth2, operationType, idTokenResponse, isAnonymous = false) {
      const user = await UserImpl._fromIdTokenResponse(auth2, idTokenResponse, isAnonymous);
      const providerId = providerIdForResponse(idTokenResponse);
      const userCred = new UserCredentialImpl({
        user,
        providerId,
        _tokenResponse: idTokenResponse,
        operationType
      });
      return userCred;
    }
    static async _forOperation(user, operationType, response) {
      await user._updateTokensIfNecessary(
        response,
        /* reload */
        true
      );
      const providerId = providerIdForResponse(response);
      return new UserCredentialImpl({
        user,
        providerId,
        _tokenResponse: response,
        operationType
      });
    }
  }
  function providerIdForResponse(response) {
    if (response.providerId) {
      return response.providerId;
    }
    if ("phoneNumber" in response) {
      return "phone";
    }
    return null;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function signInWithCustomToken$1(auth2, request) {
    return _performSignInRequest(auth2, "POST", "/v1/accounts:signInWithCustomToken", _addTidIfNecessary(auth2, request));
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  async function signInWithCustomToken(auth2, customToken) {
    if (_isFirebaseServerApp(auth2.app)) {
      return Promise.reject(_serverAppCurrentUserOperationNotSupportedError(auth2));
    }
    const authInternal = _castAuth(auth2);
    const response = await signInWithCustomToken$1(authInternal, {
      token: customToken,
      returnSecureToken: true
    });
    const cred = await UserCredentialImpl._fromIdTokenResponse(authInternal, "signIn", response);
    await authInternal._updateCurrentUser(cred.user);
    return cred;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function setPersistence(auth2, persistence) {
    return getModularInstance(auth2).setPersistence(persistence);
  }
  const STORAGE_AVAILABLE_KEY = "__sak";
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _allSettled(promises) {
    return Promise.all(promises.map(async (promise) => {
      try {
        const value = await promise;
        return {
          fulfilled: true,
          value
        };
      } catch (reason) {
        return {
          fulfilled: false,
          reason
        };
      }
    }));
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Receiver {
    constructor(eventTarget) {
      this.eventTarget = eventTarget;
      this.handlersMap = {};
      this.boundEventHandler = this.handleEvent.bind(this);
    }
    /**
     * Obtain an instance of a Receiver for a given event target, if none exists it will be created.
     *
     * @param eventTarget - An event target (such as window or self) through which the underlying
     * messages will be received.
     */
    static _getInstance(eventTarget) {
      const existingInstance = this.receivers.find((receiver) => receiver.isListeningto(eventTarget));
      if (existingInstance) {
        return existingInstance;
      }
      const newInstance = new Receiver(eventTarget);
      this.receivers.push(newInstance);
      return newInstance;
    }
    isListeningto(eventTarget) {
      return this.eventTarget === eventTarget;
    }
    /**
     * Fans out a MessageEvent to the appropriate listeners.
     *
     * @remarks
     * Sends an {@link Status.ACK} upon receipt and a {@link Status.DONE} once all handlers have
     * finished processing.
     *
     * @param event - The MessageEvent.
     *
     */
    async handleEvent(event) {
      const messageEvent = event;
      const { eventId, eventType, data } = messageEvent.data;
      const handlers = this.handlersMap[eventType];
      if (!(handlers === null || handlers === void 0 ? void 0 : handlers.size)) {
        return;
      }
      messageEvent.ports[0].postMessage({
        status: "ack",
        eventId,
        eventType
      });
      const promises = Array.from(handlers).map(async (handler) => handler(messageEvent.origin, data));
      const response = await _allSettled(promises);
      messageEvent.ports[0].postMessage({
        status: "done",
        eventId,
        eventType,
        response
      });
    }
    /**
     * Subscribe an event handler for a particular event.
     *
     * @param eventType - Event name to subscribe to.
     * @param eventHandler - The event handler which should receive the events.
     *
     */
    _subscribe(eventType, eventHandler) {
      if (Object.keys(this.handlersMap).length === 0) {
        this.eventTarget.addEventListener("message", this.boundEventHandler);
      }
      if (!this.handlersMap[eventType]) {
        this.handlersMap[eventType] = /* @__PURE__ */ new Set();
      }
      this.handlersMap[eventType].add(eventHandler);
    }
    /**
     * Unsubscribe an event handler from a particular event.
     *
     * @param eventType - Event name to unsubscribe from.
     * @param eventHandler - Optional event handler, if none provided, unsubscribe all handlers on this event.
     *
     */
    _unsubscribe(eventType, eventHandler) {
      if (this.handlersMap[eventType] && eventHandler) {
        this.handlersMap[eventType].delete(eventHandler);
      }
      if (!eventHandler || this.handlersMap[eventType].size === 0) {
        delete this.handlersMap[eventType];
      }
      if (Object.keys(this.handlersMap).length === 0) {
        this.eventTarget.removeEventListener("message", this.boundEventHandler);
      }
    }
  }
  Receiver.receivers = [];
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _generateEventId(prefix = "", digits = 10) {
    let random = "";
    for (let i = 0; i < digits; i++) {
      random += Math.floor(Math.random() * 10);
    }
    return prefix + random;
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Sender {
    constructor(target) {
      this.target = target;
      this.handlers = /* @__PURE__ */ new Set();
    }
    /**
     * Unsubscribe the handler and remove it from our tracking Set.
     *
     * @param handler - The handler to unsubscribe.
     */
    removeMessageHandler(handler) {
      if (handler.messageChannel) {
        handler.messageChannel.port1.removeEventListener("message", handler.onMessage);
        handler.messageChannel.port1.close();
      }
      this.handlers.delete(handler);
    }
    /**
     * Send a message to the Receiver located at {@link target}.
     *
     * @remarks
     * We'll first wait a bit for an ACK , if we get one we will wait significantly longer until the
     * receiver has had a chance to fully process the event.
     *
     * @param eventType - Type of event to send.
     * @param data - The payload of the event.
     * @param timeout - Timeout for waiting on an ACK from the receiver.
     *
     * @returns An array of settled promises from all the handlers that were listening on the receiver.
     */
    async _send(eventType, data, timeout = 50) {
      const messageChannel = typeof MessageChannel !== "undefined" ? new MessageChannel() : null;
      if (!messageChannel) {
        throw new Error(
          "connection_unavailable"
          /* _MessageError.CONNECTION_UNAVAILABLE */
        );
      }
      let completionTimer;
      let handler;
      return new Promise((resolve, reject) => {
        const eventId = _generateEventId("", 20);
        messageChannel.port1.start();
        const ackTimer = setTimeout(() => {
          reject(new Error(
            "unsupported_event"
            /* _MessageError.UNSUPPORTED_EVENT */
          ));
        }, timeout);
        handler = {
          messageChannel,
          onMessage(event) {
            const messageEvent = event;
            if (messageEvent.data.eventId !== eventId) {
              return;
            }
            switch (messageEvent.data.status) {
              case "ack":
                clearTimeout(ackTimer);
                completionTimer = setTimeout(
                  () => {
                    reject(new Error(
                      "timeout"
                      /* _MessageError.TIMEOUT */
                    ));
                  },
                  3e3
                  /* _TimeoutDuration.COMPLETION */
                );
                break;
              case "done":
                clearTimeout(completionTimer);
                resolve(messageEvent.data.response);
                break;
              default:
                clearTimeout(ackTimer);
                clearTimeout(completionTimer);
                reject(new Error(
                  "invalid_response"
                  /* _MessageError.INVALID_RESPONSE */
                ));
                break;
            }
          }
        };
        this.handlers.add(handler);
        messageChannel.port1.addEventListener("message", handler.onMessage);
        this.target.postMessage({
          eventType,
          eventId,
          data
        }, [messageChannel.port2]);
      }).finally(() => {
        if (handler) {
          this.removeMessageHandler(handler);
        }
      });
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _window() {
    return window;
  }
  /**
   * @license
   * Copyright 2020 Google LLC.
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function _isWorker() {
    return typeof _window()["WorkerGlobalScope"] !== "undefined" && typeof _window()["importScripts"] === "function";
  }
  async function _getActiveServiceWorker() {
    if (!(navigator === null || navigator === void 0 ? void 0 : navigator.serviceWorker)) {
      return null;
    }
    try {
      const registration = await navigator.serviceWorker.ready;
      return registration.active;
    } catch (_a2) {
      return null;
    }
  }
  function _getServiceWorkerController() {
    var _a2;
    return ((_a2 = navigator === null || navigator === void 0 ? void 0 : navigator.serviceWorker) === null || _a2 === void 0 ? void 0 : _a2.controller) || null;
  }
  function _getWorkerGlobalScope() {
    return _isWorker() ? self : null;
  }
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const DB_NAME = "firebaseLocalStorageDb";
  const DB_VERSION = 1;
  const DB_OBJECTSTORE_NAME = "firebaseLocalStorage";
  const DB_DATA_KEYPATH = "fbase_key";
  class DBPromise {
    constructor(request) {
      this.request = request;
    }
    toPromise() {
      return new Promise((resolve, reject) => {
        this.request.addEventListener("success", () => {
          resolve(this.request.result);
        });
        this.request.addEventListener("error", () => {
          reject(this.request.error);
        });
      });
    }
  }
  function getObjectStore(db, isReadWrite) {
    return db.transaction([DB_OBJECTSTORE_NAME], isReadWrite ? "readwrite" : "readonly").objectStore(DB_OBJECTSTORE_NAME);
  }
  function _deleteDatabase() {
    const request = indexedDB.deleteDatabase(DB_NAME);
    return new DBPromise(request).toPromise();
  }
  function _openDatabase() {
    const request = indexedDB.open(DB_NAME, DB_VERSION);
    return new Promise((resolve, reject) => {
      request.addEventListener("error", () => {
        reject(request.error);
      });
      request.addEventListener("upgradeneeded", () => {
        const db = request.result;
        try {
          db.createObjectStore(DB_OBJECTSTORE_NAME, { keyPath: DB_DATA_KEYPATH });
        } catch (e) {
          reject(e);
        }
      });
      request.addEventListener("success", async () => {
        const db = request.result;
        if (!db.objectStoreNames.contains(DB_OBJECTSTORE_NAME)) {
          db.close();
          await _deleteDatabase();
          resolve(await _openDatabase());
        } else {
          resolve(db);
        }
      });
    });
  }
  async function _putObject(db, key, value) {
    const request = getObjectStore(db, true).put({
      [DB_DATA_KEYPATH]: key,
      value
    });
    return new DBPromise(request).toPromise();
  }
  async function getObject(db, key) {
    const request = getObjectStore(db, false).get(key);
    const data = await new DBPromise(request).toPromise();
    return data === void 0 ? null : data.value;
  }
  function _deleteObject(db, key) {
    const request = getObjectStore(db, true).delete(key);
    return new DBPromise(request).toPromise();
  }
  const _POLLING_INTERVAL_MS = 800;
  const _TRANSACTION_RETRY_COUNT = 3;
  class IndexedDBLocalPersistence {
    constructor() {
      this.type = "LOCAL";
      this._shouldAllowMigration = true;
      this.listeners = {};
      this.localCache = {};
      this.pollTimer = null;
      this.pendingWrites = 0;
      this.receiver = null;
      this.sender = null;
      this.serviceWorkerReceiverAvailable = false;
      this.activeServiceWorker = null;
      this._workerInitializationPromise = this.initializeServiceWorkerMessaging().then(() => {
      }, () => {
      });
    }
    async _openDb() {
      if (this.db) {
        return this.db;
      }
      this.db = await _openDatabase();
      return this.db;
    }
    async _withRetries(op) {
      let numAttempts = 0;
      while (true) {
        try {
          const db = await this._openDb();
          return await op(db);
        } catch (e) {
          if (numAttempts++ > _TRANSACTION_RETRY_COUNT) {
            throw e;
          }
          if (this.db) {
            this.db.close();
            this.db = void 0;
          }
        }
      }
    }
    /**
     * IndexedDB events do not propagate from the main window to the worker context.  We rely on a
     * postMessage interface to send these events to the worker ourselves.
     */
    async initializeServiceWorkerMessaging() {
      return _isWorker() ? this.initializeReceiver() : this.initializeSender();
    }
    /**
     * As the worker we should listen to events from the main window.
     */
    async initializeReceiver() {
      this.receiver = Receiver._getInstance(_getWorkerGlobalScope());
      this.receiver._subscribe("keyChanged", async (_origin, data) => {
        const keys = await this._poll();
        return {
          keyProcessed: keys.includes(data.key)
        };
      });
      this.receiver._subscribe("ping", async (_origin, _data) => {
        return [
          "keyChanged"
          /* _EventType.KEY_CHANGED */
        ];
      });
    }
    /**
     * As the main window, we should let the worker know when keys change (set and remove).
     *
     * @remarks
     * {@link https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerContainer/ready | ServiceWorkerContainer.ready}
     * may not resolve.
     */
    async initializeSender() {
      var _a2, _b2;
      this.activeServiceWorker = await _getActiveServiceWorker();
      if (!this.activeServiceWorker) {
        return;
      }
      this.sender = new Sender(this.activeServiceWorker);
      const results = await this.sender._send(
        "ping",
        {},
        800
        /* _TimeoutDuration.LONG_ACK */
      );
      if (!results) {
        return;
      }
      if (((_a2 = results[0]) === null || _a2 === void 0 ? void 0 : _a2.fulfilled) && ((_b2 = results[0]) === null || _b2 === void 0 ? void 0 : _b2.value.includes(
        "keyChanged"
        /* _EventType.KEY_CHANGED */
      ))) {
        this.serviceWorkerReceiverAvailable = true;
      }
    }
    /**
     * Let the worker know about a changed key, the exact key doesn't technically matter since the
     * worker will just trigger a full sync anyway.
     *
     * @remarks
     * For now, we only support one service worker per page.
     *
     * @param key - Storage key which changed.
     */
    async notifyServiceWorker(key) {
      if (!this.sender || !this.activeServiceWorker || _getServiceWorkerController() !== this.activeServiceWorker) {
        return;
      }
      try {
        await this.sender._send(
          "keyChanged",
          { key },
          // Use long timeout if receiver has previously responded to a ping from us.
          this.serviceWorkerReceiverAvailable ? 800 : 50
          /* _TimeoutDuration.ACK */
        );
      } catch (_a2) {
      }
    }
    async _isAvailable() {
      try {
        if (!indexedDB) {
          return false;
        }
        const db = await _openDatabase();
        await _putObject(db, STORAGE_AVAILABLE_KEY, "1");
        await _deleteObject(db, STORAGE_AVAILABLE_KEY);
        return true;
      } catch (_a2) {
      }
      return false;
    }
    async _withPendingWrite(write) {
      this.pendingWrites++;
      try {
        await write();
      } finally {
        this.pendingWrites--;
      }
    }
    async _set(key, value) {
      return this._withPendingWrite(async () => {
        await this._withRetries((db) => _putObject(db, key, value));
        this.localCache[key] = value;
        return this.notifyServiceWorker(key);
      });
    }
    async _get(key) {
      const obj = await this._withRetries((db) => getObject(db, key));
      this.localCache[key] = obj;
      return obj;
    }
    async _remove(key) {
      return this._withPendingWrite(async () => {
        await this._withRetries((db) => _deleteObject(db, key));
        delete this.localCache[key];
        return this.notifyServiceWorker(key);
      });
    }
    async _poll() {
      const result2 = await this._withRetries((db) => {
        const getAllRequest = getObjectStore(db, false).getAll();
        return new DBPromise(getAllRequest).toPromise();
      });
      if (!result2) {
        return [];
      }
      if (this.pendingWrites !== 0) {
        return [];
      }
      const keys = [];
      const keysInResult = /* @__PURE__ */ new Set();
      if (result2.length !== 0) {
        for (const { fbase_key: key, value } of result2) {
          keysInResult.add(key);
          if (JSON.stringify(this.localCache[key]) !== JSON.stringify(value)) {
            this.notifyListeners(key, value);
            keys.push(key);
          }
        }
      }
      for (const localKey of Object.keys(this.localCache)) {
        if (this.localCache[localKey] && !keysInResult.has(localKey)) {
          this.notifyListeners(localKey, null);
          keys.push(localKey);
        }
      }
      return keys;
    }
    notifyListeners(key, newValue) {
      this.localCache[key] = newValue;
      const listeners = this.listeners[key];
      if (listeners) {
        for (const listener of Array.from(listeners)) {
          listener(newValue);
        }
      }
    }
    startPolling() {
      this.stopPolling();
      this.pollTimer = setInterval(async () => this._poll(), _POLLING_INTERVAL_MS);
    }
    stopPolling() {
      if (this.pollTimer) {
        clearInterval(this.pollTimer);
        this.pollTimer = null;
      }
    }
    _addListener(key, listener) {
      if (Object.keys(this.listeners).length === 0) {
        this.startPolling();
      }
      if (!this.listeners[key]) {
        this.listeners[key] = /* @__PURE__ */ new Set();
        void this._get(key);
      }
      this.listeners[key].add(listener);
    }
    _removeListener(key, listener) {
      if (this.listeners[key]) {
        this.listeners[key].delete(listener);
        if (this.listeners[key].size === 0) {
          delete this.listeners[key];
        }
      }
      if (Object.keys(this.listeners).length === 0) {
        this.stopPolling();
      }
    }
  }
  IndexedDBLocalPersistence.type = "LOCAL";
  const indexedDBLocalPersistence = IndexedDBLocalPersistence;
  var name$1 = "@firebase/auth";
  var version$1 = "1.10.0";
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class AuthInterop {
    constructor(auth2) {
      this.auth = auth2;
      this.internalListeners = /* @__PURE__ */ new Map();
    }
    getUid() {
      var _a2;
      this.assertAuthConfigured();
      return ((_a2 = this.auth.currentUser) === null || _a2 === void 0 ? void 0 : _a2.uid) || null;
    }
    async getToken(forceRefresh) {
      this.assertAuthConfigured();
      await this.auth._initializationPromise;
      if (!this.auth.currentUser) {
        return null;
      }
      const accessToken = await this.auth.currentUser.getIdToken(forceRefresh);
      return { accessToken };
    }
    addAuthTokenListener(listener) {
      this.assertAuthConfigured();
      if (this.internalListeners.has(listener)) {
        return;
      }
      const unsubscribe = this.auth.onIdTokenChanged((user) => {
        listener((user === null || user === void 0 ? void 0 : user.stsTokenManager.accessToken) || null);
      });
      this.internalListeners.set(listener, unsubscribe);
      this.updateProactiveRefresh();
    }
    removeAuthTokenListener(listener) {
      this.assertAuthConfigured();
      const unsubscribe = this.internalListeners.get(listener);
      if (!unsubscribe) {
        return;
      }
      this.internalListeners.delete(listener);
      unsubscribe();
      this.updateProactiveRefresh();
    }
    assertAuthConfigured() {
      _assert(
        this.auth._initializationPromise,
        "dependent-sdk-initialized-before-auth"
        /* AuthErrorCode.DEPENDENT_SDK_INIT_BEFORE_AUTH */
      );
    }
    updateProactiveRefresh() {
      if (this.internalListeners.size > 0) {
        this.auth._startProactiveRefresh();
      } else {
        this.auth._stopProactiveRefresh();
      }
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function getVersionForPlatform(clientPlatform) {
    switch (clientPlatform) {
      case "Node":
        return "node";
      case "ReactNative":
        return "rn";
      case "Worker":
        return "webworker";
      case "Cordova":
        return "cordova";
      case "WebExtension":
        return "web-extension";
      default:
        return void 0;
    }
  }
  function registerAuth(clientPlatform) {
    _registerComponent(new Component(
      "auth",
      (container, { options: deps }) => {
        const app = container.getProvider("app").getImmediate();
        const heartbeatServiceProvider = container.getProvider("heartbeat");
        const appCheckServiceProvider = container.getProvider("app-check-internal");
        const { apiKey, authDomain } = app.options;
        _assert(apiKey && !apiKey.includes(":"), "invalid-api-key", { appName: app.name });
        const config = {
          apiKey,
          authDomain,
          clientPlatform,
          apiHost: "identitytoolkit.googleapis.com",
          tokenApiHost: "securetoken.googleapis.com",
          apiScheme: "https",
          sdkClientVersion: _getClientVersion(clientPlatform)
        };
        const authInstance = new AuthImpl(app, heartbeatServiceProvider, appCheckServiceProvider, config);
        _initializeAuthInstance(authInstance, deps);
        return authInstance;
      },
      "PUBLIC"
      /* ComponentType.PUBLIC */
    ).setInstantiationMode(
      "EXPLICIT"
      /* InstantiationMode.EXPLICIT */
    ).setInstanceCreatedCallback((container, _instanceIdentifier, _instance) => {
      const authInternalProvider = container.getProvider(
        "auth-internal"
        /* _ComponentName.AUTH_INTERNAL */
      );
      authInternalProvider.initialize();
    }));
    _registerComponent(new Component(
      "auth-internal",
      (container) => {
        const auth2 = _castAuth(container.getProvider(
          "auth"
          /* _ComponentName.AUTH */
        ).getImmediate());
        return ((auth3) => new AuthInterop(auth3))(auth2);
      },
      "PRIVATE"
      /* ComponentType.PRIVATE */
    ).setInstantiationMode(
      "EXPLICIT"
      /* InstantiationMode.EXPLICIT */
    ));
    registerVersion(name$1, version$1, getVersionForPlatform(clientPlatform));
    registerVersion(name$1, version$1, "esm2017");
  }
  /**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function getAuth(app = getApp()) {
    const provider = _getProvider(app, "auth");
    if (provider.isInitialized()) {
      return provider.getImmediate();
    }
    const auth2 = initializeAuth(app, {
      persistence: [indexedDBLocalPersistence]
    });
    const authEmulatorHost = getDefaultEmulatorHost("auth");
    if (authEmulatorHost) {
      connectAuthEmulator(auth2, `http://${authEmulatorHost}`);
    }
    return auth2;
  }
  registerAuth(
    "WebExtension"
    /* ClientPlatform.WEB_EXTENSION */
  );
  var commonjsGlobal$1 = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
  /** @license
  Copyright The Closure Library Authors.
  SPDX-License-Identifier: Apache-2.0
  */
  var Integer;
  (function() {
    var h;
    /** @license
    
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */
    function k(f, a) {
      function c() {
      }
      c.prototype = a.prototype;
      f.D = a.prototype;
      f.prototype = new c();
      f.prototype.constructor = f;
      f.C = function(d, e, g) {
        for (var b2 = Array(arguments.length - 2), r = 2; r < arguments.length; r++) b2[r - 2] = arguments[r];
        return a.prototype[e].apply(d, b2);
      };
    }
    function l() {
      this.blockSize = -1;
    }
    function m() {
      this.blockSize = -1;
      this.blockSize = 64;
      this.g = Array(4);
      this.B = Array(this.blockSize);
      this.o = this.h = 0;
      this.s();
    }
    k(m, l);
    m.prototype.s = function() {
      this.g[0] = 1732584193;
      this.g[1] = 4023233417;
      this.g[2] = 2562383102;
      this.g[3] = 271733878;
      this.o = this.h = 0;
    };
    function n(f, a, c) {
      c || (c = 0);
      var d = Array(16);
      if ("string" === typeof a) for (var e = 0; 16 > e; ++e) d[e] = a.charCodeAt(c++) | a.charCodeAt(c++) << 8 | a.charCodeAt(c++) << 16 | a.charCodeAt(c++) << 24;
      else for (e = 0; 16 > e; ++e) d[e] = a[c++] | a[c++] << 8 | a[c++] << 16 | a[c++] << 24;
      a = f.g[0];
      c = f.g[1];
      e = f.g[2];
      var g = f.g[3];
      var b2 = a + (g ^ c & (e ^ g)) + d[0] + 3614090360 & 4294967295;
      a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
      b2 = g + (e ^ a & (c ^ e)) + d[1] + 3905402710 & 4294967295;
      g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
      b2 = e + (c ^ g & (a ^ c)) + d[2] + 606105819 & 4294967295;
      e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
      b2 = c + (a ^ e & (g ^ a)) + d[3] + 3250441966 & 4294967295;
      c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
      b2 = a + (g ^ c & (e ^ g)) + d[4] + 4118548399 & 4294967295;
      a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
      b2 = g + (e ^ a & (c ^ e)) + d[5] + 1200080426 & 4294967295;
      g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
      b2 = e + (c ^ g & (a ^ c)) + d[6] + 2821735955 & 4294967295;
      e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
      b2 = c + (a ^ e & (g ^ a)) + d[7] + 4249261313 & 4294967295;
      c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
      b2 = a + (g ^ c & (e ^ g)) + d[8] + 1770035416 & 4294967295;
      a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
      b2 = g + (e ^ a & (c ^ e)) + d[9] + 2336552879 & 4294967295;
      g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
      b2 = e + (c ^ g & (a ^ c)) + d[10] + 4294925233 & 4294967295;
      e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
      b2 = c + (a ^ e & (g ^ a)) + d[11] + 2304563134 & 4294967295;
      c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
      b2 = a + (g ^ c & (e ^ g)) + d[12] + 1804603682 & 4294967295;
      a = c + (b2 << 7 & 4294967295 | b2 >>> 25);
      b2 = g + (e ^ a & (c ^ e)) + d[13] + 4254626195 & 4294967295;
      g = a + (b2 << 12 & 4294967295 | b2 >>> 20);
      b2 = e + (c ^ g & (a ^ c)) + d[14] + 2792965006 & 4294967295;
      e = g + (b2 << 17 & 4294967295 | b2 >>> 15);
      b2 = c + (a ^ e & (g ^ a)) + d[15] + 1236535329 & 4294967295;
      c = e + (b2 << 22 & 4294967295 | b2 >>> 10);
      b2 = a + (e ^ g & (c ^ e)) + d[1] + 4129170786 & 4294967295;
      a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
      b2 = g + (c ^ e & (a ^ c)) + d[6] + 3225465664 & 4294967295;
      g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
      b2 = e + (a ^ c & (g ^ a)) + d[11] + 643717713 & 4294967295;
      e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
      b2 = c + (g ^ a & (e ^ g)) + d[0] + 3921069994 & 4294967295;
      c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
      b2 = a + (e ^ g & (c ^ e)) + d[5] + 3593408605 & 4294967295;
      a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
      b2 = g + (c ^ e & (a ^ c)) + d[10] + 38016083 & 4294967295;
      g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
      b2 = e + (a ^ c & (g ^ a)) + d[15] + 3634488961 & 4294967295;
      e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
      b2 = c + (g ^ a & (e ^ g)) + d[4] + 3889429448 & 4294967295;
      c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
      b2 = a + (e ^ g & (c ^ e)) + d[9] + 568446438 & 4294967295;
      a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
      b2 = g + (c ^ e & (a ^ c)) + d[14] + 3275163606 & 4294967295;
      g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
      b2 = e + (a ^ c & (g ^ a)) + d[3] + 4107603335 & 4294967295;
      e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
      b2 = c + (g ^ a & (e ^ g)) + d[8] + 1163531501 & 4294967295;
      c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
      b2 = a + (e ^ g & (c ^ e)) + d[13] + 2850285829 & 4294967295;
      a = c + (b2 << 5 & 4294967295 | b2 >>> 27);
      b2 = g + (c ^ e & (a ^ c)) + d[2] + 4243563512 & 4294967295;
      g = a + (b2 << 9 & 4294967295 | b2 >>> 23);
      b2 = e + (a ^ c & (g ^ a)) + d[7] + 1735328473 & 4294967295;
      e = g + (b2 << 14 & 4294967295 | b2 >>> 18);
      b2 = c + (g ^ a & (e ^ g)) + d[12] + 2368359562 & 4294967295;
      c = e + (b2 << 20 & 4294967295 | b2 >>> 12);
      b2 = a + (c ^ e ^ g) + d[5] + 4294588738 & 4294967295;
      a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
      b2 = g + (a ^ c ^ e) + d[8] + 2272392833 & 4294967295;
      g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
      b2 = e + (g ^ a ^ c) + d[11] + 1839030562 & 4294967295;
      e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
      b2 = c + (e ^ g ^ a) + d[14] + 4259657740 & 4294967295;
      c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
      b2 = a + (c ^ e ^ g) + d[1] + 2763975236 & 4294967295;
      a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
      b2 = g + (a ^ c ^ e) + d[4] + 1272893353 & 4294967295;
      g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
      b2 = e + (g ^ a ^ c) + d[7] + 4139469664 & 4294967295;
      e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
      b2 = c + (e ^ g ^ a) + d[10] + 3200236656 & 4294967295;
      c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
      b2 = a + (c ^ e ^ g) + d[13] + 681279174 & 4294967295;
      a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
      b2 = g + (a ^ c ^ e) + d[0] + 3936430074 & 4294967295;
      g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
      b2 = e + (g ^ a ^ c) + d[3] + 3572445317 & 4294967295;
      e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
      b2 = c + (e ^ g ^ a) + d[6] + 76029189 & 4294967295;
      c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
      b2 = a + (c ^ e ^ g) + d[9] + 3654602809 & 4294967295;
      a = c + (b2 << 4 & 4294967295 | b2 >>> 28);
      b2 = g + (a ^ c ^ e) + d[12] + 3873151461 & 4294967295;
      g = a + (b2 << 11 & 4294967295 | b2 >>> 21);
      b2 = e + (g ^ a ^ c) + d[15] + 530742520 & 4294967295;
      e = g + (b2 << 16 & 4294967295 | b2 >>> 16);
      b2 = c + (e ^ g ^ a) + d[2] + 3299628645 & 4294967295;
      c = e + (b2 << 23 & 4294967295 | b2 >>> 9);
      b2 = a + (e ^ (c | ~g)) + d[0] + 4096336452 & 4294967295;
      a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
      b2 = g + (c ^ (a | ~e)) + d[7] + 1126891415 & 4294967295;
      g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
      b2 = e + (a ^ (g | ~c)) + d[14] + 2878612391 & 4294967295;
      e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
      b2 = c + (g ^ (e | ~a)) + d[5] + 4237533241 & 4294967295;
      c = e + (b2 << 21 & 4294967295 | b2 >>> 11);
      b2 = a + (e ^ (c | ~g)) + d[12] + 1700485571 & 4294967295;
      a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
      b2 = g + (c ^ (a | ~e)) + d[3] + 2399980690 & 4294967295;
      g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
      b2 = e + (a ^ (g | ~c)) + d[10] + 4293915773 & 4294967295;
      e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
      b2 = c + (g ^ (e | ~a)) + d[1] + 2240044497 & 4294967295;
      c = e + (b2 << 21 & 4294967295 | b2 >>> 11);
      b2 = a + (e ^ (c | ~g)) + d[8] + 1873313359 & 4294967295;
      a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
      b2 = g + (c ^ (a | ~e)) + d[15] + 4264355552 & 4294967295;
      g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
      b2 = e + (a ^ (g | ~c)) + d[6] + 2734768916 & 4294967295;
      e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
      b2 = c + (g ^ (e | ~a)) + d[13] + 1309151649 & 4294967295;
      c = e + (b2 << 21 & 4294967295 | b2 >>> 11);
      b2 = a + (e ^ (c | ~g)) + d[4] + 4149444226 & 4294967295;
      a = c + (b2 << 6 & 4294967295 | b2 >>> 26);
      b2 = g + (c ^ (a | ~e)) + d[11] + 3174756917 & 4294967295;
      g = a + (b2 << 10 & 4294967295 | b2 >>> 22);
      b2 = e + (a ^ (g | ~c)) + d[2] + 718787259 & 4294967295;
      e = g + (b2 << 15 & 4294967295 | b2 >>> 17);
      b2 = c + (g ^ (e | ~a)) + d[9] + 3951481745 & 4294967295;
      f.g[0] = f.g[0] + a & 4294967295;
      f.g[1] = f.g[1] + (e + (b2 << 21 & 4294967295 | b2 >>> 11)) & 4294967295;
      f.g[2] = f.g[2] + e & 4294967295;
      f.g[3] = f.g[3] + g & 4294967295;
    }
    m.prototype.u = function(f, a) {
      void 0 === a && (a = f.length);
      for (var c = a - this.blockSize, d = this.B, e = this.h, g = 0; g < a; ) {
        if (0 == e) for (; g <= c; ) n(this, f, g), g += this.blockSize;
        if ("string" === typeof f) for (; g < a; ) {
          if (d[e++] = f.charCodeAt(g++), e == this.blockSize) {
            n(this, d);
            e = 0;
            break;
          }
        }
        else for (; g < a; ) if (d[e++] = f[g++], e == this.blockSize) {
          n(this, d);
          e = 0;
          break;
        }
      }
      this.h = e;
      this.o += a;
    };
    m.prototype.v = function() {
      var f = Array((56 > this.h ? this.blockSize : 2 * this.blockSize) - this.h);
      f[0] = 128;
      for (var a = 1; a < f.length - 8; ++a) f[a] = 0;
      var c = 8 * this.o;
      for (a = f.length - 8; a < f.length; ++a) f[a] = c & 255, c /= 256;
      this.u(f);
      f = Array(16);
      for (a = c = 0; 4 > a; ++a) for (var d = 0; 32 > d; d += 8) f[c++] = this.g[a] >>> d & 255;
      return f;
    };
    function p(f, a) {
      var c = q;
      return Object.prototype.hasOwnProperty.call(c, f) ? c[f] : c[f] = a(f);
    }
    function t(f, a) {
      this.h = a;
      for (var c = [], d = true, e = f.length - 1; 0 <= e; e--) {
        var g = f[e] | 0;
        d && g == a || (c[e] = g, d = false);
      }
      this.g = c;
    }
    var q = {};
    function u(f) {
      return -128 <= f && 128 > f ? p(f, function(a) {
        return new t([a | 0], 0 > a ? -1 : 0);
      }) : new t([f | 0], 0 > f ? -1 : 0);
    }
    function v2(f) {
      if (isNaN(f) || !isFinite(f)) return w;
      if (0 > f) return x(v2(-f));
      for (var a = [], c = 1, d = 0; f >= c; d++) a[d] = f / c | 0, c *= 4294967296;
      return new t(a, 0);
    }
    function y(f, a) {
      if (0 == f.length) throw Error("number format error: empty string");
      a = a || 10;
      if (2 > a || 36 < a) throw Error("radix out of range: " + a);
      if ("-" == f.charAt(0)) return x(y(f.substring(1), a));
      if (0 <= f.indexOf("-")) throw Error('number format error: interior "-" character');
      for (var c = v2(Math.pow(a, 8)), d = w, e = 0; e < f.length; e += 8) {
        var g = Math.min(8, f.length - e), b2 = parseInt(f.substring(e, e + g), a);
        8 > g ? (g = v2(Math.pow(a, g)), d = d.j(g).add(v2(b2))) : (d = d.j(c), d = d.add(v2(b2)));
      }
      return d;
    }
    var w = u(0), z = u(1), A = u(16777216);
    h = t.prototype;
    h.m = function() {
      if (B(this)) return -x(this).m();
      for (var f = 0, a = 1, c = 0; c < this.g.length; c++) {
        var d = this.i(c);
        f += (0 <= d ? d : 4294967296 + d) * a;
        a *= 4294967296;
      }
      return f;
    };
    h.toString = function(f) {
      f = f || 10;
      if (2 > f || 36 < f) throw Error("radix out of range: " + f);
      if (C2(this)) return "0";
      if (B(this)) return "-" + x(this).toString(f);
      for (var a = v2(Math.pow(f, 6)), c = this, d = ""; ; ) {
        var e = D2(c, a).g;
        c = F(c, e.j(a));
        var g = ((0 < c.g.length ? c.g[0] : c.h) >>> 0).toString(f);
        c = e;
        if (C2(c)) return g + d;
        for (; 6 > g.length; ) g = "0" + g;
        d = g + d;
      }
    };
    h.i = function(f) {
      return 0 > f ? 0 : f < this.g.length ? this.g[f] : this.h;
    };
    function C2(f) {
      if (0 != f.h) return false;
      for (var a = 0; a < f.g.length; a++) if (0 != f.g[a]) return false;
      return true;
    }
    function B(f) {
      return -1 == f.h;
    }
    h.l = function(f) {
      f = F(this, f);
      return B(f) ? -1 : C2(f) ? 0 : 1;
    };
    function x(f) {
      for (var a = f.g.length, c = [], d = 0; d < a; d++) c[d] = ~f.g[d];
      return new t(c, ~f.h).add(z);
    }
    h.abs = function() {
      return B(this) ? x(this) : this;
    };
    h.add = function(f) {
      for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0, e = 0; e <= a; e++) {
        var g = d + (this.i(e) & 65535) + (f.i(e) & 65535), b2 = (g >>> 16) + (this.i(e) >>> 16) + (f.i(e) >>> 16);
        d = b2 >>> 16;
        g &= 65535;
        b2 &= 65535;
        c[e] = b2 << 16 | g;
      }
      return new t(c, c[c.length - 1] & -2147483648 ? -1 : 0);
    };
    function F(f, a) {
      return f.add(x(a));
    }
    h.j = function(f) {
      if (C2(this) || C2(f)) return w;
      if (B(this)) return B(f) ? x(this).j(x(f)) : x(x(this).j(f));
      if (B(f)) return x(this.j(x(f)));
      if (0 > this.l(A) && 0 > f.l(A)) return v2(this.m() * f.m());
      for (var a = this.g.length + f.g.length, c = [], d = 0; d < 2 * a; d++) c[d] = 0;
      for (d = 0; d < this.g.length; d++) for (var e = 0; e < f.g.length; e++) {
        var g = this.i(d) >>> 16, b2 = this.i(d) & 65535, r = f.i(e) >>> 16, E = f.i(e) & 65535;
        c[2 * d + 2 * e] += b2 * E;
        G(c, 2 * d + 2 * e);
        c[2 * d + 2 * e + 1] += g * E;
        G(c, 2 * d + 2 * e + 1);
        c[2 * d + 2 * e + 1] += b2 * r;
        G(c, 2 * d + 2 * e + 1);
        c[2 * d + 2 * e + 2] += g * r;
        G(c, 2 * d + 2 * e + 2);
      }
      for (d = 0; d < a; d++) c[d] = c[2 * d + 1] << 16 | c[2 * d];
      for (d = a; d < 2 * a; d++) c[d] = 0;
      return new t(c, 0);
    };
    function G(f, a) {
      for (; (f[a] & 65535) != f[a]; ) f[a + 1] += f[a] >>> 16, f[a] &= 65535, a++;
    }
    function H(f, a) {
      this.g = f;
      this.h = a;
    }
    function D2(f, a) {
      if (C2(a)) throw Error("division by zero");
      if (C2(f)) return new H(w, w);
      if (B(f)) return a = D2(x(f), a), new H(x(a.g), x(a.h));
      if (B(a)) return a = D2(f, x(a)), new H(x(a.g), a.h);
      if (30 < f.g.length) {
        if (B(f) || B(a)) throw Error("slowDivide_ only works with positive integers.");
        for (var c = z, d = a; 0 >= d.l(f); ) c = I(c), d = I(d);
        var e = J(c, 1), g = J(d, 1);
        d = J(d, 2);
        for (c = J(c, 2); !C2(d); ) {
          var b2 = g.add(d);
          0 >= b2.l(f) && (e = e.add(c), g = b2);
          d = J(d, 1);
          c = J(c, 1);
        }
        a = F(f, e.j(a));
        return new H(e, a);
      }
      for (e = w; 0 <= f.l(a); ) {
        c = Math.max(1, Math.floor(f.m() / a.m()));
        d = Math.ceil(Math.log(c) / Math.LN2);
        d = 48 >= d ? 1 : Math.pow(2, d - 48);
        g = v2(c);
        for (b2 = g.j(a); B(b2) || 0 < b2.l(f); ) c -= d, g = v2(c), b2 = g.j(a);
        C2(g) && (g = z);
        e = e.add(g);
        f = F(f, b2);
      }
      return new H(e, f);
    }
    h.A = function(f) {
      return D2(this, f).h;
    };
    h.and = function(f) {
      for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0; d < a; d++) c[d] = this.i(d) & f.i(d);
      return new t(c, this.h & f.h);
    };
    h.or = function(f) {
      for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0; d < a; d++) c[d] = this.i(d) | f.i(d);
      return new t(c, this.h | f.h);
    };
    h.xor = function(f) {
      for (var a = Math.max(this.g.length, f.g.length), c = [], d = 0; d < a; d++) c[d] = this.i(d) ^ f.i(d);
      return new t(c, this.h ^ f.h);
    };
    function I(f) {
      for (var a = f.g.length + 1, c = [], d = 0; d < a; d++) c[d] = f.i(d) << 1 | f.i(d - 1) >>> 31;
      return new t(c, f.h);
    }
    function J(f, a) {
      var c = a >> 5;
      a %= 32;
      for (var d = f.g.length - c, e = [], g = 0; g < d; g++) e[g] = 0 < a ? f.i(g + c) >>> a | f.i(g + c + 1) << 32 - a : f.i(g + c);
      return new t(e, f.h);
    }
    m.prototype.digest = m.prototype.v;
    m.prototype.reset = m.prototype.s;
    m.prototype.update = m.prototype.u;
    t.prototype.add = t.prototype.add;
    t.prototype.multiply = t.prototype.j;
    t.prototype.modulo = t.prototype.A;
    t.prototype.compare = t.prototype.l;
    t.prototype.toNumber = t.prototype.m;
    t.prototype.toString = t.prototype.toString;
    t.prototype.getBits = t.prototype.i;
    t.fromNumber = v2;
    t.fromString = y;
    Integer = t;
  }).apply(typeof commonjsGlobal$1 !== "undefined" ? commonjsGlobal$1 : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
  var commonjsGlobal = typeof globalThis !== "undefined" ? globalThis : typeof window !== "undefined" ? window : typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : {};
  (function() {
    var h, aa = "function" == typeof Object.defineProperties ? Object.defineProperty : function(a, b2, c) {
      if (a == Array.prototype || a == Object.prototype) return a;
      a[b2] = c.value;
      return a;
    };
    function ba(a) {
      a = ["object" == typeof globalThis && globalThis, a, "object" == typeof window && window, "object" == typeof self && self, "object" == typeof commonjsGlobal && commonjsGlobal];
      for (var b2 = 0; b2 < a.length; ++b2) {
        var c = a[b2];
        if (c && c.Math == Math) return c;
      }
      throw Error("Cannot find global object");
    }
    var ca = ba(this);
    function da(a, b2) {
      if (b2) a: {
        var c = ca;
        a = a.split(".");
        for (var d = 0; d < a.length - 1; d++) {
          var e = a[d];
          if (!(e in c)) break a;
          c = c[e];
        }
        a = a[a.length - 1];
        d = c[a];
        b2 = b2(d);
        b2 != d && null != b2 && aa(c, a, { configurable: true, writable: true, value: b2 });
      }
    }
    function ea(a, b2) {
      a instanceof String && (a += "");
      var c = 0, d = false, e = { next: function() {
        if (!d && c < a.length) {
          var f = c++;
          return { value: b2(f, a[f]), done: false };
        }
        d = true;
        return { done: true, value: void 0 };
      } };
      e[Symbol.iterator] = function() {
        return e;
      };
      return e;
    }
    da("Array.prototype.values", function(a) {
      return a ? a : function() {
        return ea(this, function(b2, c) {
          return c;
        });
      };
    });
    /** @license
    
       Copyright The Closure Library Authors.
       SPDX-License-Identifier: Apache-2.0
      */
    var fa = fa || {}, k = this || self;
    function ha(a) {
      var b2 = typeof a;
      b2 = "object" != b2 ? b2 : a ? Array.isArray(a) ? "array" : b2 : "null";
      return "array" == b2 || "object" == b2 && "number" == typeof a.length;
    }
    function n(a) {
      var b2 = typeof a;
      return "object" == b2 && null != a || "function" == b2;
    }
    function ia(a, b2, c) {
      return a.call.apply(a.bind, arguments);
    }
    function ja(a, b2, c) {
      if (!a) throw Error();
      if (2 < arguments.length) {
        var d = Array.prototype.slice.call(arguments, 2);
        return function() {
          var e = Array.prototype.slice.call(arguments);
          Array.prototype.unshift.apply(e, d);
          return a.apply(b2, e);
        };
      }
      return function() {
        return a.apply(b2, arguments);
      };
    }
    function p(a, b2, c) {
      p = Function.prototype.bind && -1 != Function.prototype.bind.toString().indexOf("native code") ? ia : ja;
      return p.apply(null, arguments);
    }
    function ka(a, b2) {
      var c = Array.prototype.slice.call(arguments, 1);
      return function() {
        var d = c.slice();
        d.push.apply(d, arguments);
        return a.apply(this, d);
      };
    }
    function r(a, b2) {
      function c() {
      }
      c.prototype = b2.prototype;
      a.aa = b2.prototype;
      a.prototype = new c();
      a.prototype.constructor = a;
      a.Qb = function(d, e, f) {
        for (var g = Array(arguments.length - 2), m = 2; m < arguments.length; m++) g[m - 2] = arguments[m];
        return b2.prototype[e].apply(d, g);
      };
    }
    function la(a) {
      const b2 = a.length;
      if (0 < b2) {
        const c = Array(b2);
        for (let d = 0; d < b2; d++) c[d] = a[d];
        return c;
      }
      return [];
    }
    function ma(a, b2) {
      for (let c = 1; c < arguments.length; c++) {
        const d = arguments[c];
        if (ha(d)) {
          const e = a.length || 0, f = d.length || 0;
          a.length = e + f;
          for (let g = 0; g < f; g++) a[e + g] = d[g];
        } else a.push(d);
      }
    }
    class na {
      constructor(a, b2) {
        this.i = a;
        this.j = b2;
        this.h = 0;
        this.g = null;
      }
      get() {
        let a;
        0 < this.h ? (this.h--, a = this.g, this.g = a.next, a.next = null) : a = this.i();
        return a;
      }
    }
    function t(a) {
      return /^[\s\xa0]*$/.test(a);
    }
    function u() {
      var a = k.navigator;
      return a && (a = a.userAgent) ? a : "";
    }
    function oa(a) {
      oa[" "](a);
      return a;
    }
    oa[" "] = function() {
    };
    var pa = -1 != u().indexOf("Gecko") && !(-1 != u().toLowerCase().indexOf("webkit") && -1 == u().indexOf("Edge")) && !(-1 != u().indexOf("Trident") || -1 != u().indexOf("MSIE")) && -1 == u().indexOf("Edge");
    function qa(a, b2, c) {
      for (const d in a) b2.call(c, a[d], d, a);
    }
    function ra(a, b2) {
      for (const c in a) b2.call(void 0, a[c], c, a);
    }
    function sa(a) {
      const b2 = {};
      for (const c in a) b2[c] = a[c];
      return b2;
    }
    const ta = "constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
    function ua(a, b2) {
      let c, d;
      for (let e = 1; e < arguments.length; e++) {
        d = arguments[e];
        for (c in d) a[c] = d[c];
        for (let f = 0; f < ta.length; f++) c = ta[f], Object.prototype.hasOwnProperty.call(d, c) && (a[c] = d[c]);
      }
    }
    function va(a) {
      var b2 = 1;
      a = a.split(":");
      const c = [];
      for (; 0 < b2 && a.length; ) c.push(a.shift()), b2--;
      a.length && c.push(a.join(":"));
      return c;
    }
    function wa(a) {
      k.setTimeout(() => {
        throw a;
      }, 0);
    }
    function xa() {
      var a = za;
      let b2 = null;
      a.g && (b2 = a.g, a.g = a.g.next, a.g || (a.h = null), b2.next = null);
      return b2;
    }
    class Aa {
      constructor() {
        this.h = this.g = null;
      }
      add(a, b2) {
        const c = Ba.get();
        c.set(a, b2);
        this.h ? this.h.next = c : this.g = c;
        this.h = c;
      }
    }
    var Ba = new na(() => new Ca(), (a) => a.reset());
    class Ca {
      constructor() {
        this.next = this.g = this.h = null;
      }
      set(a, b2) {
        this.h = a;
        this.g = b2;
        this.next = null;
      }
      reset() {
        this.next = this.g = this.h = null;
      }
    }
    let x, y = false, za = new Aa(), Ea = () => {
      const a = k.Promise.resolve(void 0);
      x = () => {
        a.then(Da);
      };
    };
    var Da = () => {
      for (var a; a = xa(); ) {
        try {
          a.h.call(a.g);
        } catch (c) {
          wa(c);
        }
        var b2 = Ba;
        b2.j(a);
        100 > b2.h && (b2.h++, a.next = b2.g, b2.g = a);
      }
      y = false;
    };
    function z() {
      this.s = this.s;
      this.C = this.C;
    }
    z.prototype.s = false;
    z.prototype.ma = function() {
      this.s || (this.s = true, this.N());
    };
    z.prototype.N = function() {
      if (this.C) for (; this.C.length; ) this.C.shift()();
    };
    function A(a, b2) {
      this.type = a;
      this.g = this.target = b2;
      this.defaultPrevented = false;
    }
    A.prototype.h = function() {
      this.defaultPrevented = true;
    };
    var Fa = function() {
      if (!k.addEventListener || !Object.defineProperty) return false;
      var a = false, b2 = Object.defineProperty({}, "passive", { get: function() {
        a = true;
      } });
      try {
        const c = () => {
        };
        k.addEventListener("test", c, b2);
        k.removeEventListener("test", c, b2);
      } catch (c) {
      }
      return a;
    }();
    function C2(a, b2) {
      A.call(this, a ? a.type : "");
      this.relatedTarget = this.g = this.target = null;
      this.button = this.screenY = this.screenX = this.clientY = this.clientX = 0;
      this.key = "";
      this.metaKey = this.shiftKey = this.altKey = this.ctrlKey = false;
      this.state = null;
      this.pointerId = 0;
      this.pointerType = "";
      this.i = null;
      if (a) {
        var c = this.type = a.type, d = a.changedTouches && a.changedTouches.length ? a.changedTouches[0] : null;
        this.target = a.target || a.srcElement;
        this.g = b2;
        if (b2 = a.relatedTarget) {
          if (pa) {
            a: {
              try {
                oa(b2.nodeName);
                var e = true;
                break a;
              } catch (f) {
              }
              e = false;
            }
            e || (b2 = null);
          }
        } else "mouseover" == c ? b2 = a.fromElement : "mouseout" == c && (b2 = a.toElement);
        this.relatedTarget = b2;
        d ? (this.clientX = void 0 !== d.clientX ? d.clientX : d.pageX, this.clientY = void 0 !== d.clientY ? d.clientY : d.pageY, this.screenX = d.screenX || 0, this.screenY = d.screenY || 0) : (this.clientX = void 0 !== a.clientX ? a.clientX : a.pageX, this.clientY = void 0 !== a.clientY ? a.clientY : a.pageY, this.screenX = a.screenX || 0, this.screenY = a.screenY || 0);
        this.button = a.button;
        this.key = a.key || "";
        this.ctrlKey = a.ctrlKey;
        this.altKey = a.altKey;
        this.shiftKey = a.shiftKey;
        this.metaKey = a.metaKey;
        this.pointerId = a.pointerId || 0;
        this.pointerType = "string" === typeof a.pointerType ? a.pointerType : Ga[a.pointerType] || "";
        this.state = a.state;
        this.i = a;
        a.defaultPrevented && C2.aa.h.call(this);
      }
    }
    r(C2, A);
    var Ga = { 2: "touch", 3: "pen", 4: "mouse" };
    C2.prototype.h = function() {
      C2.aa.h.call(this);
      var a = this.i;
      a.preventDefault ? a.preventDefault() : a.returnValue = false;
    };
    var D2 = "closure_listenable_" + (1e6 * Math.random() | 0);
    var Ha = 0;
    function Ia(a, b2, c, d, e) {
      this.listener = a;
      this.proxy = null;
      this.src = b2;
      this.type = c;
      this.capture = !!d;
      this.ha = e;
      this.key = ++Ha;
      this.da = this.fa = false;
    }
    function Ja(a) {
      a.da = true;
      a.listener = null;
      a.proxy = null;
      a.src = null;
      a.ha = null;
    }
    function Ka(a) {
      this.src = a;
      this.g = {};
      this.h = 0;
    }
    Ka.prototype.add = function(a, b2, c, d, e) {
      var f = a.toString();
      a = this.g[f];
      a || (a = this.g[f] = [], this.h++);
      var g = La(a, b2, d, e);
      -1 < g ? (b2 = a[g], c || (b2.fa = false)) : (b2 = new Ia(b2, this.src, f, !!d, e), b2.fa = c, a.push(b2));
      return b2;
    };
    function Ma(a, b2) {
      var c = b2.type;
      if (c in a.g) {
        var d = a.g[c], e = Array.prototype.indexOf.call(d, b2, void 0), f;
        (f = 0 <= e) && Array.prototype.splice.call(d, e, 1);
        f && (Ja(b2), 0 == a.g[c].length && (delete a.g[c], a.h--));
      }
    }
    function La(a, b2, c, d) {
      for (var e = 0; e < a.length; ++e) {
        var f = a[e];
        if (!f.da && f.listener == b2 && f.capture == !!c && f.ha == d) return e;
      }
      return -1;
    }
    var Na = "closure_lm_" + (1e6 * Math.random() | 0), Oa = {};
    function Qa(a, b2, c, d, e) {
      if (Array.isArray(b2)) {
        for (var f = 0; f < b2.length; f++) Qa(a, b2[f], c, d, e);
        return null;
      }
      c = Sa(c);
      return a && a[D2] ? a.K(b2, c, n(d) ? !!d.capture : false, e) : Ta(a, b2, c, false, d, e);
    }
    function Ta(a, b2, c, d, e, f) {
      if (!b2) throw Error("Invalid event type");
      var g = n(e) ? !!e.capture : !!e, m = Ua(a);
      m || (a[Na] = m = new Ka(a));
      c = m.add(b2, c, d, g, f);
      if (c.proxy) return c;
      d = Va();
      c.proxy = d;
      d.src = a;
      d.listener = c;
      if (a.addEventListener) Fa || (e = g), void 0 === e && (e = false), a.addEventListener(b2.toString(), d, e);
      else if (a.attachEvent) a.attachEvent(Wa(b2.toString()), d);
      else if (a.addListener && a.removeListener) a.addListener(d);
      else throw Error("addEventListener and attachEvent are unavailable.");
      return c;
    }
    function Va() {
      function a(c) {
        return b2.call(a.src, a.listener, c);
      }
      const b2 = Xa;
      return a;
    }
    function Ya(a, b2, c, d, e) {
      if (Array.isArray(b2)) for (var f = 0; f < b2.length; f++) Ya(a, b2[f], c, d, e);
      else (d = n(d) ? !!d.capture : !!d, c = Sa(c), a && a[D2]) ? (a = a.i, b2 = String(b2).toString(), b2 in a.g && (f = a.g[b2], c = La(f, c, d, e), -1 < c && (Ja(f[c]), Array.prototype.splice.call(f, c, 1), 0 == f.length && (delete a.g[b2], a.h--)))) : a && (a = Ua(a)) && (b2 = a.g[b2.toString()], a = -1, b2 && (a = La(b2, c, d, e)), (c = -1 < a ? b2[a] : null) && Za(c));
    }
    function Za(a) {
      if ("number" !== typeof a && a && !a.da) {
        var b2 = a.src;
        if (b2 && b2[D2]) Ma(b2.i, a);
        else {
          var c = a.type, d = a.proxy;
          b2.removeEventListener ? b2.removeEventListener(c, d, a.capture) : b2.detachEvent ? b2.detachEvent(Wa(c), d) : b2.addListener && b2.removeListener && b2.removeListener(d);
          (c = Ua(b2)) ? (Ma(c, a), 0 == c.h && (c.src = null, b2[Na] = null)) : Ja(a);
        }
      }
    }
    function Wa(a) {
      return a in Oa ? Oa[a] : Oa[a] = "on" + a;
    }
    function Xa(a, b2) {
      if (a.da) a = true;
      else {
        b2 = new C2(b2, this);
        var c = a.listener, d = a.ha || a.src;
        a.fa && Za(a);
        a = c.call(d, b2);
      }
      return a;
    }
    function Ua(a) {
      a = a[Na];
      return a instanceof Ka ? a : null;
    }
    var $a = "__closure_events_fn_" + (1e9 * Math.random() >>> 0);
    function Sa(a) {
      if ("function" === typeof a) return a;
      a[$a] || (a[$a] = function(b2) {
        return a.handleEvent(b2);
      });
      return a[$a];
    }
    function E() {
      z.call(this);
      this.i = new Ka(this);
      this.M = this;
      this.F = null;
    }
    r(E, z);
    E.prototype[D2] = true;
    E.prototype.removeEventListener = function(a, b2, c, d) {
      Ya(this, a, b2, c, d);
    };
    function F(a, b2) {
      var c, d = a.F;
      if (d) for (c = []; d; d = d.F) c.push(d);
      a = a.M;
      d = b2.type || b2;
      if ("string" === typeof b2) b2 = new A(b2, a);
      else if (b2 instanceof A) b2.target = b2.target || a;
      else {
        var e = b2;
        b2 = new A(d, a);
        ua(b2, e);
      }
      e = true;
      if (c) for (var f = c.length - 1; 0 <= f; f--) {
        var g = b2.g = c[f];
        e = ab(g, d, true, b2) && e;
      }
      g = b2.g = a;
      e = ab(g, d, true, b2) && e;
      e = ab(g, d, false, b2) && e;
      if (c) for (f = 0; f < c.length; f++) g = b2.g = c[f], e = ab(g, d, false, b2) && e;
    }
    E.prototype.N = function() {
      E.aa.N.call(this);
      if (this.i) {
        var a = this.i, c;
        for (c in a.g) {
          for (var d = a.g[c], e = 0; e < d.length; e++) Ja(d[e]);
          delete a.g[c];
          a.h--;
        }
      }
      this.F = null;
    };
    E.prototype.K = function(a, b2, c, d) {
      return this.i.add(String(a), b2, false, c, d);
    };
    E.prototype.L = function(a, b2, c, d) {
      return this.i.add(String(a), b2, true, c, d);
    };
    function ab(a, b2, c, d) {
      b2 = a.i.g[String(b2)];
      if (!b2) return true;
      b2 = b2.concat();
      for (var e = true, f = 0; f < b2.length; ++f) {
        var g = b2[f];
        if (g && !g.da && g.capture == c) {
          var m = g.listener, q = g.ha || g.src;
          g.fa && Ma(a.i, g);
          e = false !== m.call(q, d) && e;
        }
      }
      return e && !d.defaultPrevented;
    }
    function bb(a, b2, c) {
      if ("function" === typeof a) c && (a = p(a, c));
      else if (a && "function" == typeof a.handleEvent) a = p(a.handleEvent, a);
      else throw Error("Invalid listener argument");
      return 2147483647 < Number(b2) ? -1 : k.setTimeout(a, b2 || 0);
    }
    function cb(a) {
      a.g = bb(() => {
        a.g = null;
        a.i && (a.i = false, cb(a));
      }, a.l);
      const b2 = a.h;
      a.h = null;
      a.m.apply(null, b2);
    }
    class eb extends z {
      constructor(a, b2) {
        super();
        this.m = a;
        this.l = b2;
        this.h = null;
        this.i = false;
        this.g = null;
      }
      j(a) {
        this.h = arguments;
        this.g ? this.i = true : cb(this);
      }
      N() {
        super.N();
        this.g && (k.clearTimeout(this.g), this.g = null, this.i = false, this.h = null);
      }
    }
    function G(a) {
      z.call(this);
      this.h = a;
      this.g = {};
    }
    r(G, z);
    var fb = [];
    function gb(a) {
      qa(a.g, function(b2, c) {
        this.g.hasOwnProperty(c) && Za(b2);
      }, a);
      a.g = {};
    }
    G.prototype.N = function() {
      G.aa.N.call(this);
      gb(this);
    };
    G.prototype.handleEvent = function() {
      throw Error("EventHandler.handleEvent not implemented");
    };
    var hb = k.JSON.stringify;
    var ib = k.JSON.parse;
    var jb = class {
      stringify(a) {
        return k.JSON.stringify(a, void 0);
      }
      parse(a) {
        return k.JSON.parse(a, void 0);
      }
    };
    function kb() {
    }
    kb.prototype.h = null;
    function lb(a) {
      return a.h || (a.h = a.i());
    }
    function mb() {
    }
    var H = { OPEN: "a", kb: "b", Ja: "c", wb: "d" };
    function nb() {
      A.call(this, "d");
    }
    r(nb, A);
    function ob() {
      A.call(this, "c");
    }
    r(ob, A);
    var I = {}, pb = null;
    function qb() {
      return pb = pb || new E();
    }
    I.La = "serverreachability";
    function rb(a) {
      A.call(this, I.La, a);
    }
    r(rb, A);
    function J(a) {
      const b2 = qb();
      F(b2, new rb(b2));
    }
    I.STAT_EVENT = "statevent";
    function sb(a, b2) {
      A.call(this, I.STAT_EVENT, a);
      this.stat = b2;
    }
    r(sb, A);
    function K(a) {
      const b2 = qb();
      F(b2, new sb(b2, a));
    }
    I.Ma = "timingevent";
    function tb(a, b2) {
      A.call(this, I.Ma, a);
      this.size = b2;
    }
    r(tb, A);
    function ub(a, b2) {
      if ("function" !== typeof a) throw Error("Fn must not be null and must be a function");
      return k.setTimeout(function() {
        a();
      }, b2);
    }
    function vb() {
      this.g = true;
    }
    vb.prototype.xa = function() {
      this.g = false;
    };
    function wb(a, b2, c, d, e, f) {
      a.info(function() {
        if (a.g) if (f) {
          var g = "";
          for (var m = f.split("&"), q = 0; q < m.length; q++) {
            var l = m[q].split("=");
            if (1 < l.length) {
              var v2 = l[0];
              l = l[1];
              var w = v2.split("_");
              g = 2 <= w.length && "type" == w[1] ? g + (v2 + "=" + l + "&") : g + (v2 + "=redacted&");
            }
          }
        } else g = null;
        else g = f;
        return "XMLHTTP REQ (" + d + ") [attempt " + e + "]: " + b2 + "\n" + c + "\n" + g;
      });
    }
    function xb(a, b2, c, d, e, f, g) {
      a.info(function() {
        return "XMLHTTP RESP (" + d + ") [ attempt " + e + "]: " + b2 + "\n" + c + "\n" + f + " " + g;
      });
    }
    function L(a, b2, c, d) {
      a.info(function() {
        return "XMLHTTP TEXT (" + b2 + "): " + yb(a, c) + (d ? " " + d : "");
      });
    }
    function zb(a, b2) {
      a.info(function() {
        return "TIMEOUT: " + b2;
      });
    }
    vb.prototype.info = function() {
    };
    function yb(a, b2) {
      if (!a.g) return b2;
      if (!b2) return null;
      try {
        var c = JSON.parse(b2);
        if (c) {
          for (a = 0; a < c.length; a++) if (Array.isArray(c[a])) {
            var d = c[a];
            if (!(2 > d.length)) {
              var e = d[1];
              if (Array.isArray(e) && !(1 > e.length)) {
                var f = e[0];
                if ("noop" != f && "stop" != f && "close" != f) for (var g = 1; g < e.length; g++) e[g] = "";
              }
            }
          }
        }
        return hb(c);
      } catch (m) {
        return b2;
      }
    }
    var Ab = { NO_ERROR: 0, TIMEOUT: 8 };
    var Bb = {};
    var Cb;
    function Db() {
    }
    r(Db, kb);
    Db.prototype.g = function() {
      return new XMLHttpRequest();
    };
    Db.prototype.i = function() {
      return {};
    };
    Cb = new Db();
    function M(a, b2, c, d) {
      this.j = a;
      this.i = b2;
      this.l = c;
      this.R = d || 1;
      this.U = new G(this);
      this.I = 45e3;
      this.H = null;
      this.o = false;
      this.m = this.A = this.v = this.L = this.F = this.S = this.B = null;
      this.D = [];
      this.g = null;
      this.C = 0;
      this.s = this.u = null;
      this.X = -1;
      this.J = false;
      this.O = 0;
      this.M = null;
      this.W = this.K = this.T = this.P = false;
      this.h = new Eb();
    }
    function Eb() {
      this.i = null;
      this.g = "";
      this.h = false;
    }
    var Fb = {}, Gb = {};
    function Hb(a, b2, c) {
      a.L = 1;
      a.v = Ib(N(b2));
      a.m = c;
      a.P = true;
      Jb(a, null);
    }
    function Jb(a, b2) {
      a.F = Date.now();
      Kb(a);
      a.A = N(a.v);
      var c = a.A, d = a.R;
      Array.isArray(d) || (d = [String(d)]);
      Lb(c.i, "t", d);
      a.C = 0;
      c = a.j.J;
      a.h = new Eb();
      a.g = Mb(a.j, c ? b2 : null, !a.m);
      0 < a.O && (a.M = new eb(p(a.Y, a, a.g), a.O));
      b2 = a.U;
      c = a.g;
      d = a.ca;
      var e = "readystatechange";
      Array.isArray(e) || (e && (fb[0] = e.toString()), e = fb);
      for (var f = 0; f < e.length; f++) {
        var g = Qa(c, e[f], d || b2.handleEvent, false, b2.h || b2);
        if (!g) break;
        b2.g[g.key] = g;
      }
      b2 = a.H ? sa(a.H) : {};
      a.m ? (a.u || (a.u = "POST"), b2["Content-Type"] = "application/x-www-form-urlencoded", a.g.ea(
        a.A,
        a.u,
        a.m,
        b2
      )) : (a.u = "GET", a.g.ea(a.A, a.u, null, b2));
      J();
      wb(a.i, a.u, a.A, a.l, a.R, a.m);
    }
    M.prototype.ca = function(a) {
      a = a.target;
      const b2 = this.M;
      b2 && 3 == P(a) ? b2.j() : this.Y(a);
    };
    M.prototype.Y = function(a) {
      try {
        if (a == this.g) a: {
          const w = P(this.g);
          var b2 = this.g.Ba();
          const O = this.g.Z();
          if (!(3 > w) && (3 != w || this.g && (this.h.h || this.g.oa() || Nb(this.g)))) {
            this.J || 4 != w || 7 == b2 || (8 == b2 || 0 >= O ? J(3) : J(2));
            Ob(this);
            var c = this.g.Z();
            this.X = c;
            b: if (Pb(this)) {
              var d = Nb(this.g);
              a = "";
              var e = d.length, f = 4 == P(this.g);
              if (!this.h.i) {
                if ("undefined" === typeof TextDecoder) {
                  Q(this);
                  Qb(this);
                  var g = "";
                  break b;
                }
                this.h.i = new k.TextDecoder();
              }
              for (b2 = 0; b2 < e; b2++) this.h.h = true, a += this.h.i.decode(d[b2], { stream: !(f && b2 == e - 1) });
              d.length = 0;
              this.h.g += a;
              this.C = 0;
              g = this.h.g;
            } else g = this.g.oa();
            this.o = 200 == c;
            xb(this.i, this.u, this.A, this.l, this.R, w, c);
            if (this.o) {
              if (this.T && !this.K) {
                b: {
                  if (this.g) {
                    var m, q = this.g;
                    if ((m = q.g ? q.g.getResponseHeader("X-HTTP-Initial-Response") : null) && !t(m)) {
                      var l = m;
                      break b;
                    }
                  }
                  l = null;
                }
                if (c = l) L(this.i, this.l, c, "Initial handshake response via X-HTTP-Initial-Response"), this.K = true, Rb(this, c);
                else {
                  this.o = false;
                  this.s = 3;
                  K(12);
                  Q(this);
                  Qb(this);
                  break a;
                }
              }
              if (this.P) {
                c = true;
                let B;
                for (; !this.J && this.C < g.length; ) if (B = Sb(this, g), B == Gb) {
                  4 == w && (this.s = 4, K(14), c = false);
                  L(this.i, this.l, null, "[Incomplete Response]");
                  break;
                } else if (B == Fb) {
                  this.s = 4;
                  K(15);
                  L(this.i, this.l, g, "[Invalid Chunk]");
                  c = false;
                  break;
                } else L(this.i, this.l, B, null), Rb(this, B);
                Pb(this) && 0 != this.C && (this.h.g = this.h.g.slice(this.C), this.C = 0);
                4 != w || 0 != g.length || this.h.h || (this.s = 1, K(16), c = false);
                this.o = this.o && c;
                if (!c) L(this.i, this.l, g, "[Invalid Chunked Response]"), Q(this), Qb(this);
                else if (0 < g.length && !this.W) {
                  this.W = true;
                  var v2 = this.j;
                  v2.g == this && v2.ba && !v2.M && (v2.j.info("Great, no buffering proxy detected. Bytes received: " + g.length), Tb(v2), v2.M = true, K(11));
                }
              } else L(this.i, this.l, g, null), Rb(this, g);
              4 == w && Q(this);
              this.o && !this.J && (4 == w ? Ub(this.j, this) : (this.o = false, Kb(this)));
            } else Vb(this.g), 400 == c && 0 < g.indexOf("Unknown SID") ? (this.s = 3, K(12)) : (this.s = 0, K(13)), Q(this), Qb(this);
          }
        }
      } catch (w) {
      } finally {
      }
    };
    function Pb(a) {
      return a.g ? "GET" == a.u && 2 != a.L && a.j.Ca : false;
    }
    function Sb(a, b2) {
      var c = a.C, d = b2.indexOf("\n", c);
      if (-1 == d) return Gb;
      c = Number(b2.substring(c, d));
      if (isNaN(c)) return Fb;
      d += 1;
      if (d + c > b2.length) return Gb;
      b2 = b2.slice(d, d + c);
      a.C = d + c;
      return b2;
    }
    M.prototype.cancel = function() {
      this.J = true;
      Q(this);
    };
    function Kb(a) {
      a.S = Date.now() + a.I;
      Wb(a, a.I);
    }
    function Wb(a, b2) {
      if (null != a.B) throw Error("WatchDog timer not null");
      a.B = ub(p(a.ba, a), b2);
    }
    function Ob(a) {
      a.B && (k.clearTimeout(a.B), a.B = null);
    }
    M.prototype.ba = function() {
      this.B = null;
      const a = Date.now();
      0 <= a - this.S ? (zb(this.i, this.A), 2 != this.L && (J(), K(17)), Q(this), this.s = 2, Qb(this)) : Wb(this, this.S - a);
    };
    function Qb(a) {
      0 == a.j.G || a.J || Ub(a.j, a);
    }
    function Q(a) {
      Ob(a);
      var b2 = a.M;
      b2 && "function" == typeof b2.ma && b2.ma();
      a.M = null;
      gb(a.U);
      a.g && (b2 = a.g, a.g = null, b2.abort(), b2.ma());
    }
    function Rb(a, b2) {
      try {
        var c = a.j;
        if (0 != c.G && (c.g == a || Xb(c.h, a))) {
          if (!a.K && Xb(c.h, a) && 3 == c.G) {
            try {
              var d = c.Da.g.parse(b2);
            } catch (l) {
              d = null;
            }
            if (Array.isArray(d) && 3 == d.length) {
              var e = d;
              if (0 == e[0]) a: {
                if (!c.u) {
                  if (c.g) if (c.g.F + 3e3 < a.F) Yb(c), Zb(c);
                  else break a;
                  $b(c);
                  K(18);
                }
              }
              else c.za = e[1], 0 < c.za - c.T && 37500 > e[2] && c.F && 0 == c.v && !c.C && (c.C = ub(p(c.Za, c), 6e3));
              if (1 >= ac(c.h) && c.ca) {
                try {
                  c.ca();
                } catch (l) {
                }
                c.ca = void 0;
              }
            } else R(c, 11);
          } else if ((a.K || c.g == a) && Yb(c), !t(b2)) for (e = c.Da.g.parse(b2), b2 = 0; b2 < e.length; b2++) {
            let l = e[b2];
            c.T = l[0];
            l = l[1];
            if (2 == c.G) if ("c" == l[0]) {
              c.K = l[1];
              c.ia = l[2];
              const v2 = l[3];
              null != v2 && (c.la = v2, c.j.info("VER=" + c.la));
              const w = l[4];
              null != w && (c.Aa = w, c.j.info("SVER=" + c.Aa));
              const O = l[5];
              null != O && "number" === typeof O && 0 < O && (d = 1.5 * O, c.L = d, c.j.info("backChannelRequestTimeoutMs_=" + d));
              d = c;
              const B = a.g;
              if (B) {
                const ya = B.g ? B.g.getResponseHeader("X-Client-Wire-Protocol") : null;
                if (ya) {
                  var f = d.h;
                  f.g || -1 == ya.indexOf("spdy") && -1 == ya.indexOf("quic") && -1 == ya.indexOf("h2") || (f.j = f.l, f.g = /* @__PURE__ */ new Set(), f.h && (bc(f, f.h), f.h = null));
                }
                if (d.D) {
                  const db = B.g ? B.g.getResponseHeader("X-HTTP-Session-Id") : null;
                  db && (d.ya = db, S2(d.I, d.D, db));
                }
              }
              c.G = 3;
              c.l && c.l.ua();
              c.ba && (c.R = Date.now() - a.F, c.j.info("Handshake RTT: " + c.R + "ms"));
              d = c;
              var g = a;
              d.qa = cc(d, d.J ? d.ia : null, d.W);
              if (g.K) {
                dc(d.h, g);
                var m = g, q = d.L;
                q && (m.I = q);
                m.B && (Ob(m), Kb(m));
                d.g = g;
              } else ec(d);
              0 < c.i.length && fc(c);
            } else "stop" != l[0] && "close" != l[0] || R(c, 7);
            else 3 == c.G && ("stop" == l[0] || "close" == l[0] ? "stop" == l[0] ? R(c, 7) : gc(c) : "noop" != l[0] && c.l && c.l.ta(l), c.v = 0);
          }
        }
        J(4);
      } catch (l) {
      }
    }
    var hc = class {
      constructor(a, b2) {
        this.g = a;
        this.map = b2;
      }
    };
    function ic(a) {
      this.l = a || 10;
      k.PerformanceNavigationTiming ? (a = k.performance.getEntriesByType("navigation"), a = 0 < a.length && ("hq" == a[0].nextHopProtocol || "h2" == a[0].nextHopProtocol)) : a = !!(k.chrome && k.chrome.loadTimes && k.chrome.loadTimes() && k.chrome.loadTimes().wasFetchedViaSpdy);
      this.j = a ? this.l : 1;
      this.g = null;
      1 < this.j && (this.g = /* @__PURE__ */ new Set());
      this.h = null;
      this.i = [];
    }
    function jc(a) {
      return a.h ? true : a.g ? a.g.size >= a.j : false;
    }
    function ac(a) {
      return a.h ? 1 : a.g ? a.g.size : 0;
    }
    function Xb(a, b2) {
      return a.h ? a.h == b2 : a.g ? a.g.has(b2) : false;
    }
    function bc(a, b2) {
      a.g ? a.g.add(b2) : a.h = b2;
    }
    function dc(a, b2) {
      a.h && a.h == b2 ? a.h = null : a.g && a.g.has(b2) && a.g.delete(b2);
    }
    ic.prototype.cancel = function() {
      this.i = kc(this);
      if (this.h) this.h.cancel(), this.h = null;
      else if (this.g && 0 !== this.g.size) {
        for (const a of this.g.values()) a.cancel();
        this.g.clear();
      }
    };
    function kc(a) {
      if (null != a.h) return a.i.concat(a.h.D);
      if (null != a.g && 0 !== a.g.size) {
        let b2 = a.i;
        for (const c of a.g.values()) b2 = b2.concat(c.D);
        return b2;
      }
      return la(a.i);
    }
    function lc(a) {
      if (a.V && "function" == typeof a.V) return a.V();
      if ("undefined" !== typeof Map && a instanceof Map || "undefined" !== typeof Set && a instanceof Set) return Array.from(a.values());
      if ("string" === typeof a) return a.split("");
      if (ha(a)) {
        for (var b2 = [], c = a.length, d = 0; d < c; d++) b2.push(a[d]);
        return b2;
      }
      b2 = [];
      c = 0;
      for (d in a) b2[c++] = a[d];
      return b2;
    }
    function mc(a) {
      if (a.na && "function" == typeof a.na) return a.na();
      if (!a.V || "function" != typeof a.V) {
        if ("undefined" !== typeof Map && a instanceof Map) return Array.from(a.keys());
        if (!("undefined" !== typeof Set && a instanceof Set)) {
          if (ha(a) || "string" === typeof a) {
            var b2 = [];
            a = a.length;
            for (var c = 0; c < a; c++) b2.push(c);
            return b2;
          }
          b2 = [];
          c = 0;
          for (const d in a) b2[c++] = d;
          return b2;
        }
      }
    }
    function nc(a, b2) {
      if (a.forEach && "function" == typeof a.forEach) a.forEach(b2, void 0);
      else if (ha(a) || "string" === typeof a) Array.prototype.forEach.call(a, b2, void 0);
      else for (var c = mc(a), d = lc(a), e = d.length, f = 0; f < e; f++) b2.call(void 0, d[f], c && c[f], a);
    }
    var oc = RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");
    function pc(a, b2) {
      if (a) {
        a = a.split("&");
        for (var c = 0; c < a.length; c++) {
          var d = a[c].indexOf("="), e = null;
          if (0 <= d) {
            var f = a[c].substring(0, d);
            e = a[c].substring(d + 1);
          } else f = a[c];
          b2(f, e ? decodeURIComponent(e.replace(/\+/g, " ")) : "");
        }
      }
    }
    function T(a) {
      this.g = this.o = this.j = "";
      this.s = null;
      this.m = this.l = "";
      this.h = false;
      if (a instanceof T) {
        this.h = a.h;
        qc(this, a.j);
        this.o = a.o;
        this.g = a.g;
        rc(this, a.s);
        this.l = a.l;
        var b2 = a.i;
        var c = new sc();
        c.i = b2.i;
        b2.g && (c.g = new Map(b2.g), c.h = b2.h);
        tc(this, c);
        this.m = a.m;
      } else a && (b2 = String(a).match(oc)) ? (this.h = false, qc(this, b2[1] || "", true), this.o = uc(b2[2] || ""), this.g = uc(b2[3] || "", true), rc(this, b2[4]), this.l = uc(b2[5] || "", true), tc(this, b2[6] || "", true), this.m = uc(b2[7] || "")) : (this.h = false, this.i = new sc(null, this.h));
    }
    T.prototype.toString = function() {
      var a = [], b2 = this.j;
      b2 && a.push(vc(b2, wc, true), ":");
      var c = this.g;
      if (c || "file" == b2) a.push("//"), (b2 = this.o) && a.push(vc(b2, wc, true), "@"), a.push(encodeURIComponent(String(c)).replace(/%25([0-9a-fA-F]{2})/g, "%$1")), c = this.s, null != c && a.push(":", String(c));
      if (c = this.l) this.g && "/" != c.charAt(0) && a.push("/"), a.push(vc(c, "/" == c.charAt(0) ? xc : yc, true));
      (c = this.i.toString()) && a.push("?", c);
      (c = this.m) && a.push("#", vc(c, zc));
      return a.join("");
    };
    function N(a) {
      return new T(a);
    }
    function qc(a, b2, c) {
      a.j = c ? uc(b2, true) : b2;
      a.j && (a.j = a.j.replace(/:$/, ""));
    }
    function rc(a, b2) {
      if (b2) {
        b2 = Number(b2);
        if (isNaN(b2) || 0 > b2) throw Error("Bad port number " + b2);
        a.s = b2;
      } else a.s = null;
    }
    function tc(a, b2, c) {
      b2 instanceof sc ? (a.i = b2, Ac(a.i, a.h)) : (c || (b2 = vc(b2, Bc)), a.i = new sc(b2, a.h));
    }
    function S2(a, b2, c) {
      a.i.set(b2, c);
    }
    function Ib(a) {
      S2(a, "zx", Math.floor(2147483648 * Math.random()).toString(36) + Math.abs(Math.floor(2147483648 * Math.random()) ^ Date.now()).toString(36));
      return a;
    }
    function uc(a, b2) {
      return a ? b2 ? decodeURI(a.replace(/%25/g, "%2525")) : decodeURIComponent(a) : "";
    }
    function vc(a, b2, c) {
      return "string" === typeof a ? (a = encodeURI(a).replace(b2, Cc), c && (a = a.replace(/%25([0-9a-fA-F]{2})/g, "%$1")), a) : null;
    }
    function Cc(a) {
      a = a.charCodeAt(0);
      return "%" + (a >> 4 & 15).toString(16) + (a & 15).toString(16);
    }
    var wc = /[#\/\?@]/g, yc = /[#\?:]/g, xc = /[#\?]/g, Bc = /[#\?@]/g, zc = /#/g;
    function sc(a, b2) {
      this.h = this.g = null;
      this.i = a || null;
      this.j = !!b2;
    }
    function U(a) {
      a.g || (a.g = /* @__PURE__ */ new Map(), a.h = 0, a.i && pc(a.i, function(b2, c) {
        a.add(decodeURIComponent(b2.replace(/\+/g, " ")), c);
      }));
    }
    h = sc.prototype;
    h.add = function(a, b2) {
      U(this);
      this.i = null;
      a = V(this, a);
      var c = this.g.get(a);
      c || this.g.set(a, c = []);
      c.push(b2);
      this.h += 1;
      return this;
    };
    function Dc(a, b2) {
      U(a);
      b2 = V(a, b2);
      a.g.has(b2) && (a.i = null, a.h -= a.g.get(b2).length, a.g.delete(b2));
    }
    function Ec(a, b2) {
      U(a);
      b2 = V(a, b2);
      return a.g.has(b2);
    }
    h.forEach = function(a, b2) {
      U(this);
      this.g.forEach(function(c, d) {
        c.forEach(function(e) {
          a.call(b2, e, d, this);
        }, this);
      }, this);
    };
    h.na = function() {
      U(this);
      const a = Array.from(this.g.values()), b2 = Array.from(this.g.keys()), c = [];
      for (let d = 0; d < b2.length; d++) {
        const e = a[d];
        for (let f = 0; f < e.length; f++) c.push(b2[d]);
      }
      return c;
    };
    h.V = function(a) {
      U(this);
      let b2 = [];
      if ("string" === typeof a) Ec(this, a) && (b2 = b2.concat(this.g.get(V(this, a))));
      else {
        a = Array.from(this.g.values());
        for (let c = 0; c < a.length; c++) b2 = b2.concat(a[c]);
      }
      return b2;
    };
    h.set = function(a, b2) {
      U(this);
      this.i = null;
      a = V(this, a);
      Ec(this, a) && (this.h -= this.g.get(a).length);
      this.g.set(a, [b2]);
      this.h += 1;
      return this;
    };
    h.get = function(a, b2) {
      if (!a) return b2;
      a = this.V(a);
      return 0 < a.length ? String(a[0]) : b2;
    };
    function Lb(a, b2, c) {
      Dc(a, b2);
      0 < c.length && (a.i = null, a.g.set(V(a, b2), la(c)), a.h += c.length);
    }
    h.toString = function() {
      if (this.i) return this.i;
      if (!this.g) return "";
      const a = [], b2 = Array.from(this.g.keys());
      for (var c = 0; c < b2.length; c++) {
        var d = b2[c];
        const f = encodeURIComponent(String(d)), g = this.V(d);
        for (d = 0; d < g.length; d++) {
          var e = f;
          "" !== g[d] && (e += "=" + encodeURIComponent(String(g[d])));
          a.push(e);
        }
      }
      return this.i = a.join("&");
    };
    function V(a, b2) {
      b2 = String(b2);
      a.j && (b2 = b2.toLowerCase());
      return b2;
    }
    function Ac(a, b2) {
      b2 && !a.j && (U(a), a.i = null, a.g.forEach(function(c, d) {
        var e = d.toLowerCase();
        d != e && (Dc(this, d), Lb(this, e, c));
      }, a));
      a.j = b2;
    }
    function Fc(a, b2) {
      const c = new vb();
      if (k.Image) {
        const d = new Image();
        d.onload = ka(W, c, "TestLoadImage: loaded", true, b2, d);
        d.onerror = ka(W, c, "TestLoadImage: error", false, b2, d);
        d.onabort = ka(W, c, "TestLoadImage: abort", false, b2, d);
        d.ontimeout = ka(W, c, "TestLoadImage: timeout", false, b2, d);
        k.setTimeout(function() {
          if (d.ontimeout) d.ontimeout();
        }, 1e4);
        d.src = a;
      } else b2(false);
    }
    function Gc(a, b2) {
      const c = new vb(), d = new AbortController(), e = setTimeout(() => {
        d.abort();
        W(c, "TestPingServer: timeout", false, b2);
      }, 1e4);
      fetch(a, { signal: d.signal }).then((f) => {
        clearTimeout(e);
        f.ok ? W(c, "TestPingServer: ok", true, b2) : W(c, "TestPingServer: server error", false, b2);
      }).catch(() => {
        clearTimeout(e);
        W(c, "TestPingServer: error", false, b2);
      });
    }
    function W(a, b2, c, d, e) {
      try {
        e && (e.onload = null, e.onerror = null, e.onabort = null, e.ontimeout = null), d(c);
      } catch (f) {
      }
    }
    function Hc() {
      this.g = new jb();
    }
    function Ic(a, b2, c) {
      const d = c || "";
      try {
        nc(a, function(e, f) {
          let g = e;
          n(e) && (g = hb(e));
          b2.push(d + f + "=" + encodeURIComponent(g));
        });
      } catch (e) {
        throw b2.push(d + "type=" + encodeURIComponent("_badmap")), e;
      }
    }
    function Jc(a) {
      this.l = a.Ub || null;
      this.j = a.eb || false;
    }
    r(Jc, kb);
    Jc.prototype.g = function() {
      return new Kc(this.l, this.j);
    };
    Jc.prototype.i = /* @__PURE__ */ function(a) {
      return function() {
        return a;
      };
    }({});
    function Kc(a, b2) {
      E.call(this);
      this.D = a;
      this.o = b2;
      this.m = void 0;
      this.status = this.readyState = 0;
      this.responseType = this.responseText = this.response = this.statusText = "";
      this.onreadystatechange = null;
      this.u = new Headers();
      this.h = null;
      this.B = "GET";
      this.A = "";
      this.g = false;
      this.v = this.j = this.l = null;
    }
    r(Kc, E);
    h = Kc.prototype;
    h.open = function(a, b2) {
      if (0 != this.readyState) throw this.abort(), Error("Error reopening a connection");
      this.B = a;
      this.A = b2;
      this.readyState = 1;
      Lc(this);
    };
    h.send = function(a) {
      if (1 != this.readyState) throw this.abort(), Error("need to call open() first. ");
      this.g = true;
      const b2 = { headers: this.u, method: this.B, credentials: this.m, cache: void 0 };
      a && (b2.body = a);
      (this.D || k).fetch(new Request(this.A, b2)).then(this.Sa.bind(this), this.ga.bind(this));
    };
    h.abort = function() {
      this.response = this.responseText = "";
      this.u = new Headers();
      this.status = 0;
      this.j && this.j.cancel("Request was aborted.").catch(() => {
      });
      1 <= this.readyState && this.g && 4 != this.readyState && (this.g = false, Mc(this));
      this.readyState = 0;
    };
    h.Sa = function(a) {
      if (this.g && (this.l = a, this.h || (this.status = this.l.status, this.statusText = this.l.statusText, this.h = a.headers, this.readyState = 2, Lc(this)), this.g && (this.readyState = 3, Lc(this), this.g))) if ("arraybuffer" === this.responseType) a.arrayBuffer().then(this.Qa.bind(this), this.ga.bind(this));
      else if ("undefined" !== typeof k.ReadableStream && "body" in a) {
        this.j = a.body.getReader();
        if (this.o) {
          if (this.responseType) throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');
          this.response = [];
        } else this.response = this.responseText = "", this.v = new TextDecoder();
        Nc(this);
      } else a.text().then(this.Ra.bind(this), this.ga.bind(this));
    };
    function Nc(a) {
      a.j.read().then(a.Pa.bind(a)).catch(a.ga.bind(a));
    }
    h.Pa = function(a) {
      if (this.g) {
        if (this.o && a.value) this.response.push(a.value);
        else if (!this.o) {
          var b2 = a.value ? a.value : new Uint8Array(0);
          if (b2 = this.v.decode(b2, { stream: !a.done })) this.response = this.responseText += b2;
        }
        a.done ? Mc(this) : Lc(this);
        3 == this.readyState && Nc(this);
      }
    };
    h.Ra = function(a) {
      this.g && (this.response = this.responseText = a, Mc(this));
    };
    h.Qa = function(a) {
      this.g && (this.response = a, Mc(this));
    };
    h.ga = function() {
      this.g && Mc(this);
    };
    function Mc(a) {
      a.readyState = 4;
      a.l = null;
      a.j = null;
      a.v = null;
      Lc(a);
    }
    h.setRequestHeader = function(a, b2) {
      this.u.append(a, b2);
    };
    h.getResponseHeader = function(a) {
      return this.h ? this.h.get(a.toLowerCase()) || "" : "";
    };
    h.getAllResponseHeaders = function() {
      if (!this.h) return "";
      const a = [], b2 = this.h.entries();
      for (var c = b2.next(); !c.done; ) c = c.value, a.push(c[0] + ": " + c[1]), c = b2.next();
      return a.join("\r\n");
    };
    function Lc(a) {
      a.onreadystatechange && a.onreadystatechange.call(a);
    }
    Object.defineProperty(Kc.prototype, "withCredentials", { get: function() {
      return "include" === this.m;
    }, set: function(a) {
      this.m = a ? "include" : "same-origin";
    } });
    function Oc(a) {
      let b2 = "";
      qa(a, function(c, d) {
        b2 += d;
        b2 += ":";
        b2 += c;
        b2 += "\r\n";
      });
      return b2;
    }
    function Pc(a, b2, c) {
      a: {
        for (d in c) {
          var d = false;
          break a;
        }
        d = true;
      }
      d || (c = Oc(c), "string" === typeof a ? null != c && encodeURIComponent(String(c)) : S2(a, b2, c));
    }
    function X(a) {
      E.call(this);
      this.headers = /* @__PURE__ */ new Map();
      this.o = a || null;
      this.h = false;
      this.v = this.g = null;
      this.D = "";
      this.m = 0;
      this.l = "";
      this.j = this.B = this.u = this.A = false;
      this.I = null;
      this.H = "";
      this.J = false;
    }
    r(X, E);
    var Qc = /^https?$/i, Rc = ["POST", "PUT"];
    h = X.prototype;
    h.Ha = function(a) {
      this.J = a;
    };
    h.ea = function(a, b2, c, d) {
      if (this.g) throw Error("[goog.net.XhrIo] Object is active with another request=" + this.D + "; newUri=" + a);
      b2 = b2 ? b2.toUpperCase() : "GET";
      this.D = a;
      this.l = "";
      this.m = 0;
      this.A = false;
      this.h = true;
      this.g = this.o ? this.o.g() : Cb.g();
      this.v = this.o ? lb(this.o) : lb(Cb);
      this.g.onreadystatechange = p(this.Ea, this);
      try {
        this.B = true, this.g.open(b2, String(a), true), this.B = false;
      } catch (f) {
        Sc(this, f);
        return;
      }
      a = c || "";
      c = new Map(this.headers);
      if (d) if (Object.getPrototypeOf(d) === Object.prototype) for (var e in d) c.set(e, d[e]);
      else if ("function" === typeof d.keys && "function" === typeof d.get) for (const f of d.keys()) c.set(f, d.get(f));
      else throw Error("Unknown input type for opt_headers: " + String(d));
      d = Array.from(c.keys()).find((f) => "content-type" == f.toLowerCase());
      e = k.FormData && a instanceof k.FormData;
      !(0 <= Array.prototype.indexOf.call(Rc, b2, void 0)) || d || e || c.set("Content-Type", "application/x-www-form-urlencoded;charset=utf-8");
      for (const [f, g] of c) this.g.setRequestHeader(f, g);
      this.H && (this.g.responseType = this.H);
      "withCredentials" in this.g && this.g.withCredentials !== this.J && (this.g.withCredentials = this.J);
      try {
        Tc(this), this.u = true, this.g.send(a), this.u = false;
      } catch (f) {
        Sc(this, f);
      }
    };
    function Sc(a, b2) {
      a.h = false;
      a.g && (a.j = true, a.g.abort(), a.j = false);
      a.l = b2;
      a.m = 5;
      Uc(a);
      Vc(a);
    }
    function Uc(a) {
      a.A || (a.A = true, F(a, "complete"), F(a, "error"));
    }
    h.abort = function(a) {
      this.g && this.h && (this.h = false, this.j = true, this.g.abort(), this.j = false, this.m = a || 7, F(this, "complete"), F(this, "abort"), Vc(this));
    };
    h.N = function() {
      this.g && (this.h && (this.h = false, this.j = true, this.g.abort(), this.j = false), Vc(this, true));
      X.aa.N.call(this);
    };
    h.Ea = function() {
      this.s || (this.B || this.u || this.j ? Wc(this) : this.bb());
    };
    h.bb = function() {
      Wc(this);
    };
    function Wc(a) {
      if (a.h && "undefined" != typeof fa && (!a.v[1] || 4 != P(a) || 2 != a.Z())) {
        if (a.u && 4 == P(a)) bb(a.Ea, 0, a);
        else if (F(a, "readystatechange"), 4 == P(a)) {
          a.h = false;
          try {
            const g = a.Z();
            a: switch (g) {
              case 200:
              case 201:
              case 202:
              case 204:
              case 206:
              case 304:
              case 1223:
                var b2 = true;
                break a;
              default:
                b2 = false;
            }
            var c;
            if (!(c = b2)) {
              var d;
              if (d = 0 === g) {
                var e = String(a.D).match(oc)[1] || null;
                !e && k.self && k.self.location && (e = k.self.location.protocol.slice(0, -1));
                d = !Qc.test(e ? e.toLowerCase() : "");
              }
              c = d;
            }
            if (c) F(a, "complete"), F(a, "success");
            else {
              a.m = 6;
              try {
                var f = 2 < P(a) ? a.g.statusText : "";
              } catch (m) {
                f = "";
              }
              a.l = f + " [" + a.Z() + "]";
              Uc(a);
            }
          } finally {
            Vc(a);
          }
        }
      }
    }
    function Vc(a, b2) {
      if (a.g) {
        Tc(a);
        const c = a.g, d = a.v[0] ? () => {
        } : null;
        a.g = null;
        a.v = null;
        b2 || F(a, "ready");
        try {
          c.onreadystatechange = d;
        } catch (e) {
        }
      }
    }
    function Tc(a) {
      a.I && (k.clearTimeout(a.I), a.I = null);
    }
    h.isActive = function() {
      return !!this.g;
    };
    function P(a) {
      return a.g ? a.g.readyState : 0;
    }
    h.Z = function() {
      try {
        return 2 < P(this) ? this.g.status : -1;
      } catch (a) {
        return -1;
      }
    };
    h.oa = function() {
      try {
        return this.g ? this.g.responseText : "";
      } catch (a) {
        return "";
      }
    };
    h.Oa = function(a) {
      if (this.g) {
        var b2 = this.g.responseText;
        a && 0 == b2.indexOf(a) && (b2 = b2.substring(a.length));
        return ib(b2);
      }
    };
    function Nb(a) {
      try {
        if (!a.g) return null;
        if ("response" in a.g) return a.g.response;
        switch (a.H) {
          case "":
          case "text":
            return a.g.responseText;
          case "arraybuffer":
            if ("mozResponseArrayBuffer" in a.g) return a.g.mozResponseArrayBuffer;
        }
        return null;
      } catch (b2) {
        return null;
      }
    }
    function Vb(a) {
      const b2 = {};
      a = (a.g && 2 <= P(a) ? a.g.getAllResponseHeaders() || "" : "").split("\r\n");
      for (let d = 0; d < a.length; d++) {
        if (t(a[d])) continue;
        var c = va(a[d]);
        const e = c[0];
        c = c[1];
        if ("string" !== typeof c) continue;
        c = c.trim();
        const f = b2[e] || [];
        b2[e] = f;
        f.push(c);
      }
      ra(b2, function(d) {
        return d.join(", ");
      });
    }
    h.Ba = function() {
      return this.m;
    };
    h.Ka = function() {
      return "string" === typeof this.l ? this.l : String(this.l);
    };
    function Xc(a, b2, c) {
      return c && c.internalChannelParams ? c.internalChannelParams[a] || b2 : b2;
    }
    function Yc(a) {
      this.Aa = 0;
      this.i = [];
      this.j = new vb();
      this.ia = this.qa = this.I = this.W = this.g = this.ya = this.D = this.H = this.m = this.S = this.o = null;
      this.Ya = this.U = 0;
      this.Va = Xc("failFast", false, a);
      this.F = this.C = this.u = this.s = this.l = null;
      this.X = true;
      this.za = this.T = -1;
      this.Y = this.v = this.B = 0;
      this.Ta = Xc("baseRetryDelayMs", 5e3, a);
      this.cb = Xc("retryDelaySeedMs", 1e4, a);
      this.Wa = Xc("forwardChannelMaxRetries", 2, a);
      this.wa = Xc("forwardChannelRequestTimeoutMs", 2e4, a);
      this.pa = a && a.xmlHttpFactory || void 0;
      this.Xa = a && a.Tb || void 0;
      this.Ca = a && a.useFetchStreams || false;
      this.L = void 0;
      this.J = a && a.supportsCrossDomainXhr || false;
      this.K = "";
      this.h = new ic(a && a.concurrentRequestLimit);
      this.Da = new Hc();
      this.P = a && a.fastHandshake || false;
      this.O = a && a.encodeInitMessageHeaders || false;
      this.P && this.O && (this.O = false);
      this.Ua = a && a.Rb || false;
      a && a.xa && this.j.xa();
      a && a.forceLongPolling && (this.X = false);
      this.ba = !this.P && this.X && a && a.detectBufferingProxy || false;
      this.ja = void 0;
      a && a.longPollingTimeout && 0 < a.longPollingTimeout && (this.ja = a.longPollingTimeout);
      this.ca = void 0;
      this.R = 0;
      this.M = false;
      this.ka = this.A = null;
    }
    h = Yc.prototype;
    h.la = 8;
    h.G = 1;
    h.connect = function(a, b2, c, d) {
      K(0);
      this.W = a;
      this.H = b2 || {};
      c && void 0 !== d && (this.H.OSID = c, this.H.OAID = d);
      this.F = this.X;
      this.I = cc(this, null, this.W);
      fc(this);
    };
    function gc(a) {
      Zc(a);
      if (3 == a.G) {
        var b2 = a.U++, c = N(a.I);
        S2(c, "SID", a.K);
        S2(c, "RID", b2);
        S2(c, "TYPE", "terminate");
        $c(a, c);
        b2 = new M(a, a.j, b2);
        b2.L = 2;
        b2.v = Ib(N(c));
        c = false;
        if (k.navigator && k.navigator.sendBeacon) try {
          c = k.navigator.sendBeacon(b2.v.toString(), "");
        } catch (d) {
        }
        !c && k.Image && (new Image().src = b2.v, c = true);
        c || (b2.g = Mb(b2.j, null), b2.g.ea(b2.v));
        b2.F = Date.now();
        Kb(b2);
      }
      ad(a);
    }
    function Zb(a) {
      a.g && (Tb(a), a.g.cancel(), a.g = null);
    }
    function Zc(a) {
      Zb(a);
      a.u && (k.clearTimeout(a.u), a.u = null);
      Yb(a);
      a.h.cancel();
      a.s && ("number" === typeof a.s && k.clearTimeout(a.s), a.s = null);
    }
    function fc(a) {
      if (!jc(a.h) && !a.s) {
        a.s = true;
        var b2 = a.Ga;
        x || Ea();
        y || (x(), y = true);
        za.add(b2, a);
        a.B = 0;
      }
    }
    function bd(a, b2) {
      if (ac(a.h) >= a.h.j - (a.s ? 1 : 0)) return false;
      if (a.s) return a.i = b2.D.concat(a.i), true;
      if (1 == a.G || 2 == a.G || a.B >= (a.Va ? 0 : a.Wa)) return false;
      a.s = ub(p(a.Ga, a, b2), cd(a, a.B));
      a.B++;
      return true;
    }
    h.Ga = function(a) {
      if (this.s) if (this.s = null, 1 == this.G) {
        if (!a) {
          this.U = Math.floor(1e5 * Math.random());
          a = this.U++;
          const e = new M(this, this.j, a);
          let f = this.o;
          this.S && (f ? (f = sa(f), ua(f, this.S)) : f = this.S);
          null !== this.m || this.O || (e.H = f, f = null);
          if (this.P) a: {
            var b2 = 0;
            for (var c = 0; c < this.i.length; c++) {
              b: {
                var d = this.i[c];
                if ("__data__" in d.map && (d = d.map.__data__, "string" === typeof d)) {
                  d = d.length;
                  break b;
                }
                d = void 0;
              }
              if (void 0 === d) break;
              b2 += d;
              if (4096 < b2) {
                b2 = c;
                break a;
              }
              if (4096 === b2 || c === this.i.length - 1) {
                b2 = c + 1;
                break a;
              }
            }
            b2 = 1e3;
          }
          else b2 = 1e3;
          b2 = dd(this, e, b2);
          c = N(this.I);
          S2(c, "RID", a);
          S2(c, "CVER", 22);
          this.D && S2(c, "X-HTTP-Session-Id", this.D);
          $c(this, c);
          f && (this.O ? b2 = "headers=" + encodeURIComponent(String(Oc(f))) + "&" + b2 : this.m && Pc(c, this.m, f));
          bc(this.h, e);
          this.Ua && S2(c, "TYPE", "init");
          this.P ? (S2(c, "$req", b2), S2(c, "SID", "null"), e.T = true, Hb(e, c, null)) : Hb(e, c, b2);
          this.G = 2;
        }
      } else 3 == this.G && (a ? ed(this, a) : 0 == this.i.length || jc(this.h) || ed(this));
    };
    function ed(a, b2) {
      var c;
      b2 ? c = b2.l : c = a.U++;
      const d = N(a.I);
      S2(d, "SID", a.K);
      S2(d, "RID", c);
      S2(d, "AID", a.T);
      $c(a, d);
      a.m && a.o && Pc(d, a.m, a.o);
      c = new M(a, a.j, c, a.B + 1);
      null === a.m && (c.H = a.o);
      b2 && (a.i = b2.D.concat(a.i));
      b2 = dd(a, c, 1e3);
      c.I = Math.round(0.5 * a.wa) + Math.round(0.5 * a.wa * Math.random());
      bc(a.h, c);
      Hb(c, d, b2);
    }
    function $c(a, b2) {
      a.H && qa(a.H, function(c, d) {
        S2(b2, d, c);
      });
      a.l && nc({}, function(c, d) {
        S2(b2, d, c);
      });
    }
    function dd(a, b2, c) {
      c = Math.min(a.i.length, c);
      var d = a.l ? p(a.l.Na, a.l, a) : null;
      a: {
        var e = a.i;
        let f = -1;
        for (; ; ) {
          const g = ["count=" + c];
          -1 == f ? 0 < c ? (f = e[0].g, g.push("ofs=" + f)) : f = 0 : g.push("ofs=" + f);
          let m = true;
          for (let q = 0; q < c; q++) {
            let l = e[q].g;
            const v2 = e[q].map;
            l -= f;
            if (0 > l) f = Math.max(0, e[q].g - 100), m = false;
            else try {
              Ic(v2, g, "req" + l + "_");
            } catch (w) {
              d && d(v2);
            }
          }
          if (m) {
            d = g.join("&");
            break a;
          }
        }
      }
      a = a.i.splice(0, c);
      b2.D = a;
      return d;
    }
    function ec(a) {
      if (!a.g && !a.u) {
        a.Y = 1;
        var b2 = a.Fa;
        x || Ea();
        y || (x(), y = true);
        za.add(b2, a);
        a.v = 0;
      }
    }
    function $b(a) {
      if (a.g || a.u || 3 <= a.v) return false;
      a.Y++;
      a.u = ub(p(a.Fa, a), cd(a, a.v));
      a.v++;
      return true;
    }
    h.Fa = function() {
      this.u = null;
      fd(this);
      if (this.ba && !(this.M || null == this.g || 0 >= this.R)) {
        var a = 2 * this.R;
        this.j.info("BP detection timer enabled: " + a);
        this.A = ub(p(this.ab, this), a);
      }
    };
    h.ab = function() {
      this.A && (this.A = null, this.j.info("BP detection timeout reached."), this.j.info("Buffering proxy detected and switch to long-polling!"), this.F = false, this.M = true, K(10), Zb(this), fd(this));
    };
    function Tb(a) {
      null != a.A && (k.clearTimeout(a.A), a.A = null);
    }
    function fd(a) {
      a.g = new M(a, a.j, "rpc", a.Y);
      null === a.m && (a.g.H = a.o);
      a.g.O = 0;
      var b2 = N(a.qa);
      S2(b2, "RID", "rpc");
      S2(b2, "SID", a.K);
      S2(b2, "AID", a.T);
      S2(b2, "CI", a.F ? "0" : "1");
      !a.F && a.ja && S2(b2, "TO", a.ja);
      S2(b2, "TYPE", "xmlhttp");
      $c(a, b2);
      a.m && a.o && Pc(b2, a.m, a.o);
      a.L && (a.g.I = a.L);
      var c = a.g;
      a = a.ia;
      c.L = 1;
      c.v = Ib(N(b2));
      c.m = null;
      c.P = true;
      Jb(c, a);
    }
    h.Za = function() {
      null != this.C && (this.C = null, Zb(this), $b(this), K(19));
    };
    function Yb(a) {
      null != a.C && (k.clearTimeout(a.C), a.C = null);
    }
    function Ub(a, b2) {
      var c = null;
      if (a.g == b2) {
        Yb(a);
        Tb(a);
        a.g = null;
        var d = 2;
      } else if (Xb(a.h, b2)) c = b2.D, dc(a.h, b2), d = 1;
      else return;
      if (0 != a.G) {
        if (b2.o) if (1 == d) {
          c = b2.m ? b2.m.length : 0;
          b2 = Date.now() - b2.F;
          var e = a.B;
          d = qb();
          F(d, new tb(d, c));
          fc(a);
        } else ec(a);
        else if (e = b2.s, 3 == e || 0 == e && 0 < b2.X || !(1 == d && bd(a, b2) || 2 == d && $b(a))) switch (c && 0 < c.length && (b2 = a.h, b2.i = b2.i.concat(c)), e) {
          case 1:
            R(a, 5);
            break;
          case 4:
            R(a, 10);
            break;
          case 3:
            R(a, 6);
            break;
          default:
            R(a, 2);
        }
      }
    }
    function cd(a, b2) {
      let c = a.Ta + Math.floor(Math.random() * a.cb);
      a.isActive() || (c *= 2);
      return c * b2;
    }
    function R(a, b2) {
      a.j.info("Error code " + b2);
      if (2 == b2) {
        var c = p(a.fb, a), d = a.Xa;
        const e = !d;
        d = new T(d || "//www.google.com/images/cleardot.gif");
        k.location && "http" == k.location.protocol || qc(d, "https");
        Ib(d);
        e ? Fc(d.toString(), c) : Gc(d.toString(), c);
      } else K(2);
      a.G = 0;
      a.l && a.l.sa(b2);
      ad(a);
      Zc(a);
    }
    h.fb = function(a) {
      a ? (this.j.info("Successfully pinged google.com"), K(2)) : (this.j.info("Failed to ping google.com"), K(1));
    };
    function ad(a) {
      a.G = 0;
      a.ka = [];
      if (a.l) {
        const b2 = kc(a.h);
        if (0 != b2.length || 0 != a.i.length) ma(a.ka, b2), ma(a.ka, a.i), a.h.i.length = 0, la(a.i), a.i.length = 0;
        a.l.ra();
      }
    }
    function cc(a, b2, c) {
      var d = c instanceof T ? N(c) : new T(c);
      if ("" != d.g) b2 && (d.g = b2 + "." + d.g), rc(d, d.s);
      else {
        var e = k.location;
        d = e.protocol;
        b2 = b2 ? b2 + "." + e.hostname : e.hostname;
        e = +e.port;
        var f = new T(null);
        d && qc(f, d);
        b2 && (f.g = b2);
        e && rc(f, e);
        c && (f.l = c);
        d = f;
      }
      c = a.D;
      b2 = a.ya;
      c && b2 && S2(d, c, b2);
      S2(d, "VER", a.la);
      $c(a, d);
      return d;
    }
    function Mb(a, b2, c) {
      if (b2 && !a.J) throw Error("Can't create secondary domain capable XhrIo object.");
      b2 = a.Ca && !a.pa ? new X(new Jc({ eb: c })) : new X(a.pa);
      b2.Ha(a.J);
      return b2;
    }
    h.isActive = function() {
      return !!this.l && this.l.isActive(this);
    };
    function gd() {
    }
    h = gd.prototype;
    h.ua = function() {
    };
    h.ta = function() {
    };
    h.sa = function() {
    };
    h.ra = function() {
    };
    h.isActive = function() {
      return true;
    };
    h.Na = function() {
    };
    function Y(a, b2) {
      E.call(this);
      this.g = new Yc(b2);
      this.l = a;
      this.h = b2 && b2.messageUrlParams || null;
      a = b2 && b2.messageHeaders || null;
      b2 && b2.clientProtocolHeaderRequired && (a ? a["X-Client-Protocol"] = "webchannel" : a = { "X-Client-Protocol": "webchannel" });
      this.g.o = a;
      a = b2 && b2.initMessageHeaders || null;
      b2 && b2.messageContentType && (a ? a["X-WebChannel-Content-Type"] = b2.messageContentType : a = { "X-WebChannel-Content-Type": b2.messageContentType });
      b2 && b2.va && (a ? a["X-WebChannel-Client-Profile"] = b2.va : a = { "X-WebChannel-Client-Profile": b2.va });
      this.g.S = a;
      (a = b2 && b2.Sb) && !t(a) && (this.g.m = a);
      this.v = b2 && b2.supportsCrossDomainXhr || false;
      this.u = b2 && b2.sendRawJson || false;
      (b2 = b2 && b2.httpSessionIdParam) && !t(b2) && (this.g.D = b2, a = this.h, null !== a && b2 in a && (a = this.h, b2 in a && delete a[b2]));
      this.j = new Z(this);
    }
    r(Y, E);
    Y.prototype.m = function() {
      this.g.l = this.j;
      this.v && (this.g.J = true);
      this.g.connect(this.l, this.h || void 0);
    };
    Y.prototype.close = function() {
      gc(this.g);
    };
    Y.prototype.o = function(a) {
      var b2 = this.g;
      if ("string" === typeof a) {
        var c = {};
        c.__data__ = a;
        a = c;
      } else this.u && (c = {}, c.__data__ = hb(a), a = c);
      b2.i.push(new hc(b2.Ya++, a));
      3 == b2.G && fc(b2);
    };
    Y.prototype.N = function() {
      this.g.l = null;
      delete this.j;
      gc(this.g);
      delete this.g;
      Y.aa.N.call(this);
    };
    function id(a) {
      nb.call(this);
      a.__headers__ && (this.headers = a.__headers__, this.statusCode = a.__status__, delete a.__headers__, delete a.__status__);
      var b2 = a.__sm__;
      if (b2) {
        a: {
          for (const c in b2) {
            a = c;
            break a;
          }
          a = void 0;
        }
        if (this.i = a) a = this.i, b2 = null !== b2 && a in b2 ? b2[a] : void 0;
        this.data = b2;
      } else this.data = a;
    }
    r(id, nb);
    function jd() {
      ob.call(this);
      this.status = 1;
    }
    r(jd, ob);
    function Z(a) {
      this.g = a;
    }
    r(Z, gd);
    Z.prototype.ua = function() {
      F(this.g, "a");
    };
    Z.prototype.ta = function(a) {
      F(this.g, new id(a));
    };
    Z.prototype.sa = function(a) {
      F(this.g, new jd());
    };
    Z.prototype.ra = function() {
      F(this.g, "b");
    };
    Y.prototype.send = Y.prototype.o;
    Y.prototype.open = Y.prototype.m;
    Y.prototype.close = Y.prototype.close;
    Ab.NO_ERROR = 0;
    Ab.TIMEOUT = 8;
    Ab.HTTP_ERROR = 6;
    Bb.COMPLETE = "complete";
    mb.EventType = H;
    H.OPEN = "a";
    H.CLOSE = "b";
    H.ERROR = "c";
    H.MESSAGE = "d";
    E.prototype.listen = E.prototype.K;
    X.prototype.listenOnce = X.prototype.L;
    X.prototype.getLastError = X.prototype.Ka;
    X.prototype.getLastErrorCode = X.prototype.Ba;
    X.prototype.getStatus = X.prototype.Z;
    X.prototype.getResponseJson = X.prototype.Oa;
    X.prototype.getResponseText = X.prototype.oa;
    X.prototype.send = X.prototype.ea;
    X.prototype.setWithCredentials = X.prototype.Ha;
  }).apply(typeof commonjsGlobal !== "undefined" ? commonjsGlobal : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {});
  const S = "@firebase/firestore", b = "4.7.10";
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class User {
    constructor(e) {
      this.uid = e;
    }
    isAuthenticated() {
      return null != this.uid;
    }
    /**
     * Returns a key representing this user, suitable for inclusion in a
     * dictionary.
     */
    toKey() {
      return this.isAuthenticated() ? "uid:" + this.uid : "anonymous-user";
    }
    isEqual(e) {
      return e.uid === this.uid;
    }
  }
  User.UNAUTHENTICATED = new User(null), // TODO(mikelehen): Look into getting a proper uid-equivalent for
  // non-FirebaseAuth providers.
  User.GOOGLE_CREDENTIALS = new User("google-credentials-uid"), User.FIRST_PARTY = new User("first-party-uid"), User.MOCK_USER = new User("mock-user");
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let D = "11.5.0";
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const v = new Logger("@firebase/firestore");
  function __PRIVATE_logDebug(e, ...t) {
    if (v.logLevel <= LogLevel.DEBUG) {
      const n = t.map(__PRIVATE_argToString);
      v.debug(`Firestore (${D}): ${e}`, ...n);
    }
  }
  function __PRIVATE_logError(e, ...t) {
    if (v.logLevel <= LogLevel.ERROR) {
      const n = t.map(__PRIVATE_argToString);
      v.error(`Firestore (${D}): ${e}`, ...n);
    }
  }
  function __PRIVATE_logWarn(e, ...t) {
    if (v.logLevel <= LogLevel.WARN) {
      const n = t.map(__PRIVATE_argToString);
      v.warn(`Firestore (${D}): ${e}`, ...n);
    }
  }
  function __PRIVATE_argToString(e) {
    if ("string" == typeof e) return e;
    try {
      /**
      * @license
      * Copyright 2020 Google LLC
      *
      * Licensed under the Apache License, Version 2.0 (the "License");
      * you may not use this file except in compliance with the License.
      * You may obtain a copy of the License at
      *
      *   http://www.apache.org/licenses/LICENSE-2.0
      *
      * Unless required by applicable law or agreed to in writing, software
      * distributed under the License is distributed on an "AS IS" BASIS,
      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      * See the License for the specific language governing permissions and
      * limitations under the License.
      */
      return function __PRIVATE_formatJSON(e2) {
        return JSON.stringify(e2);
      }(e);
    } catch (t) {
      return e;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function fail(e = "Unexpected state") {
    const t = `FIRESTORE (${D}) INTERNAL ASSERTION FAILED: ` + e;
    throw __PRIVATE_logError(t), new Error(t);
  }
  function __PRIVATE_hardAssert(e, t) {
    e || fail();
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const C = {
    /** The operation was cancelled (typically by the caller). */
    CANCELLED: "cancelled",
    /**
     * Client specified an invalid argument. Note that this differs from
     * FAILED_PRECONDITION. INVALID_ARGUMENT indicates arguments that are
     * problematic regardless of the state of the system (e.g., a malformed file
     * name).
     */
    INVALID_ARGUMENT: "invalid-argument",
    /**
     * Operation was rejected because the system is not in a state required for
     * the operation's execution. For example, directory to be deleted may be
     * non-empty, an rmdir operation is applied to a non-directory, etc.
     *
     * A litmus test that may help a service implementor in deciding
     * between FAILED_PRECONDITION, ABORTED, and UNAVAILABLE:
     *  (a) Use UNAVAILABLE if the client can retry just the failing call.
     *  (b) Use ABORTED if the client should retry at a higher-level
     *      (e.g., restarting a read-modify-write sequence).
     *  (c) Use FAILED_PRECONDITION if the client should not retry until
     *      the system state has been explicitly fixed. E.g., if an "rmdir"
     *      fails because the directory is non-empty, FAILED_PRECONDITION
     *      should be returned since the client should not retry unless
     *      they have first fixed up the directory by deleting files from it.
     *  (d) Use FAILED_PRECONDITION if the client performs conditional
     *      REST Get/Update/Delete on a resource and the resource on the
     *      server does not match the condition. E.g., conflicting
     *      read-modify-write on the same resource.
     */
    FAILED_PRECONDITION: "failed-precondition"
  };
  class FirestoreError extends FirebaseError {
    /** @hideconstructor */
    constructor(e, t) {
      super(e, t), this.code = e, this.message = t, // HACK: We write a toString property directly because Error is not a real
      // class and so inheritance does not work correctly. We could alternatively
      // do the same "back-door inheritance" trick that FirebaseError does.
      this.toString = () => `${this.name}: [code=${this.code}]: ${this.message}`;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class __PRIVATE_Deferred {
    constructor() {
      this.promise = new Promise((e, t) => {
        this.resolve = e, this.reject = t;
      });
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class __PRIVATE_OAuthToken {
    constructor(e, t) {
      this.user = t, this.type = "OAuth", this.headers = /* @__PURE__ */ new Map(), this.headers.set("Authorization", `Bearer ${e}`);
    }
  }
  class __PRIVATE_EmptyAuthCredentialsProvider {
    getToken() {
      return Promise.resolve(null);
    }
    invalidateToken() {
    }
    start(e, t) {
      e.enqueueRetryable(() => t(User.UNAUTHENTICATED));
    }
    shutdown() {
    }
  }
  class __PRIVATE_EmulatorAuthCredentialsProvider {
    constructor(e) {
      this.token = e, /**
       * Stores the listener registered with setChangeListener()
       * This isn't actually necessary since the UID never changes, but we use this
       * to verify the listen contract is adhered to in tests.
       */
      this.changeListener = null;
    }
    getToken() {
      return Promise.resolve(this.token);
    }
    invalidateToken() {
    }
    start(e, t) {
      this.changeListener = t, // Fire with initial user.
      e.enqueueRetryable(() => t(this.token.user));
    }
    shutdown() {
      this.changeListener = null;
    }
  }
  class __PRIVATE_FirebaseAuthCredentialsProvider {
    constructor(e) {
      this.t = e, /** Tracks the current User. */
      this.currentUser = User.UNAUTHENTICATED, /**
       * Counter used to detect if the token changed while a getToken request was
       * outstanding.
       */
      this.i = 0, this.forceRefresh = false, this.auth = null;
    }
    start(e, t) {
      __PRIVATE_hardAssert(void 0 === this.o);
      let n = this.i;
      const __PRIVATE_guardedChangeListener = (e2) => this.i !== n ? (n = this.i, t(e2)) : Promise.resolve();
      let r = new __PRIVATE_Deferred();
      this.o = () => {
        this.i++, this.currentUser = this.u(), r.resolve(), r = new __PRIVATE_Deferred(), e.enqueueRetryable(() => __PRIVATE_guardedChangeListener(this.currentUser));
      };
      const __PRIVATE_awaitNextToken = () => {
        const t2 = r;
        e.enqueueRetryable(async () => {
          await t2.promise, await __PRIVATE_guardedChangeListener(this.currentUser);
        });
      }, __PRIVATE_registerAuth = (e2) => {
        __PRIVATE_logDebug("FirebaseAuthCredentialsProvider", "Auth detected"), this.auth = e2, this.o && (this.auth.addAuthTokenListener(this.o), __PRIVATE_awaitNextToken());
      };
      this.t.onInit((e2) => __PRIVATE_registerAuth(e2)), // Our users can initialize Auth right after Firestore, so we give it
      // a chance to register itself with the component framework before we
      // determine whether to start up in unauthenticated mode.
      setTimeout(() => {
        if (!this.auth) {
          const e2 = this.t.getImmediate({
            optional: true
          });
          e2 ? __PRIVATE_registerAuth(e2) : (
            // If auth is still not available, proceed with `null` user
            (__PRIVATE_logDebug("FirebaseAuthCredentialsProvider", "Auth not yet detected"), r.resolve(), r = new __PRIVATE_Deferred())
          );
        }
      }, 0), __PRIVATE_awaitNextToken();
    }
    getToken() {
      const e = this.i, t = this.forceRefresh;
      return this.forceRefresh = false, this.auth ? this.auth.getToken(t).then((t2) => (
        // Cancel the request since the token changed while the request was
        // outstanding so the response is potentially for a previous user (which
        // user, we can't be sure).
        this.i !== e ? (__PRIVATE_logDebug("FirebaseAuthCredentialsProvider", "getToken aborted due to token change."), this.getToken()) : t2 ? (__PRIVATE_hardAssert("string" == typeof t2.accessToken), new __PRIVATE_OAuthToken(t2.accessToken, this.currentUser)) : null
      )) : Promise.resolve(null);
    }
    invalidateToken() {
      this.forceRefresh = true;
    }
    shutdown() {
      this.auth && this.o && this.auth.removeAuthTokenListener(this.o), this.o = void 0;
    }
    // Auth.getUid() can return null even with a user logged in. It is because
    // getUid() is synchronous, but the auth code populating Uid is asynchronous.
    // This method should only be called in the AuthTokenListener callback
    // to guarantee to get the actual user.
    u() {
      const e = this.auth && this.auth.getUid();
      return __PRIVATE_hardAssert(null === e || "string" == typeof e), new User(e);
    }
  }
  class __PRIVATE_FirstPartyToken {
    constructor(e, t, n) {
      this.l = e, this.h = t, this.P = n, this.type = "FirstParty", this.user = User.FIRST_PARTY, this.T = /* @__PURE__ */ new Map();
    }
    /**
     * Gets an authorization token, using a provided factory function, or return
     * null.
     */
    I() {
      return this.P ? this.P() : null;
    }
    get headers() {
      this.T.set("X-Goog-AuthUser", this.l);
      const e = this.I();
      return e && this.T.set("Authorization", e), this.h && this.T.set("X-Goog-Iam-Authorization-Token", this.h), this.T;
    }
  }
  class __PRIVATE_FirstPartyAuthCredentialsProvider {
    constructor(e, t, n) {
      this.l = e, this.h = t, this.P = n;
    }
    getToken() {
      return Promise.resolve(new __PRIVATE_FirstPartyToken(this.l, this.h, this.P));
    }
    start(e, t) {
      e.enqueueRetryable(() => t(User.FIRST_PARTY));
    }
    shutdown() {
    }
    invalidateToken() {
    }
  }
  class AppCheckToken {
    constructor(e) {
      this.value = e, this.type = "AppCheck", this.headers = /* @__PURE__ */ new Map(), e && e.length > 0 && this.headers.set("x-firebase-appcheck", this.value);
    }
  }
  class __PRIVATE_FirebaseAppCheckTokenProvider {
    constructor(t, n) {
      this.A = n, this.forceRefresh = false, this.appCheck = null, this.R = null, this.V = null, _isFirebaseServerApp(t) && t.settings.appCheckToken && (this.V = t.settings.appCheckToken);
    }
    start(e, t) {
      __PRIVATE_hardAssert(void 0 === this.o);
      const onTokenChanged = (e2) => {
        null != e2.error && __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", `Error getting App Check token; using placeholder token instead. Error: ${e2.error.message}`);
        const n = e2.token !== this.R;
        return this.R = e2.token, __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", `Received ${n ? "new" : "existing"} token.`), n ? t(e2.token) : Promise.resolve();
      };
      this.o = (t2) => {
        e.enqueueRetryable(() => onTokenChanged(t2));
      };
      const __PRIVATE_registerAppCheck = (e2) => {
        __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", "AppCheck detected"), this.appCheck = e2, this.o && this.appCheck.addTokenListener(this.o);
      };
      this.A.onInit((e2) => __PRIVATE_registerAppCheck(e2)), // Our users can initialize AppCheck after Firestore, so we give it
      // a chance to register itself with the component framework.
      setTimeout(() => {
        if (!this.appCheck) {
          const e2 = this.A.getImmediate({
            optional: true
          });
          e2 ? __PRIVATE_registerAppCheck(e2) : (
            // If AppCheck is still not available, proceed without it.
            __PRIVATE_logDebug("FirebaseAppCheckTokenProvider", "AppCheck not yet detected")
          );
        }
      }, 0);
    }
    getToken() {
      if (this.V) return Promise.resolve(new AppCheckToken(this.V));
      const e = this.forceRefresh;
      return this.forceRefresh = false, this.appCheck ? this.appCheck.getToken(e).then((e2) => e2 ? (__PRIVATE_hardAssert("string" == typeof e2.token), this.R = e2.token, new AppCheckToken(e2.token)) : null) : Promise.resolve(null);
    }
    invalidateToken() {
      this.forceRefresh = true;
    }
    shutdown() {
      this.appCheck && this.o && this.appCheck.removeTokenListener(this.o), this.o = void 0;
    }
  }
  function __PRIVATE_isIndexedDbTransactionError(e) {
    return "IndexedDbTransactionError" === e.name;
  }
  const rt = "(default)";
  class DatabaseId {
    constructor(e, t) {
      this.projectId = e, this.database = t || rt;
    }
    static empty() {
      return new DatabaseId("", "");
    }
    get isDefaultDatabase() {
      return this.database === rt;
    }
    isEqual(e) {
      return e instanceof DatabaseId && e.projectId === this.projectId && e.database === this.database;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  var Et, dt;
  (dt = Et || (Et = {}))[dt.OK = 0] = "OK", dt[dt.CANCELLED = 1] = "CANCELLED", dt[dt.UNKNOWN = 2] = "UNKNOWN", dt[dt.INVALID_ARGUMENT = 3] = "INVALID_ARGUMENT", dt[dt.DEADLINE_EXCEEDED = 4] = "DEADLINE_EXCEEDED", dt[dt.NOT_FOUND = 5] = "NOT_FOUND", dt[dt.ALREADY_EXISTS = 6] = "ALREADY_EXISTS", dt[dt.PERMISSION_DENIED = 7] = "PERMISSION_DENIED", dt[dt.UNAUTHENTICATED = 16] = "UNAUTHENTICATED", dt[dt.RESOURCE_EXHAUSTED = 8] = "RESOURCE_EXHAUSTED", dt[dt.FAILED_PRECONDITION = 9] = "FAILED_PRECONDITION", dt[dt.ABORTED = 10] = "ABORTED", dt[dt.OUT_OF_RANGE = 11] = "OUT_OF_RANGE", dt[dt.UNIMPLEMENTED = 12] = "UNIMPLEMENTED", dt[dt.INTERNAL = 13] = "INTERNAL", dt[dt.UNAVAILABLE = 14] = "UNAVAILABLE", dt[dt.DATA_LOSS = 15] = "DATA_LOSS";
  /**
   * @license
   * Copyright 2022 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  new Integer([4294967295, 4294967295], 0);
  /**
   * @license
   * Copyright 2018 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const St = 41943040;
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const Dt = 1048576;
  function getDocument() {
    return "undefined" != typeof document ? document : null;
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class __PRIVATE_ExponentialBackoff {
    constructor(e, t, n = 1e3, r = 1.5, i = 6e4) {
      this.Ti = e, this.timerId = t, this.Go = n, this.zo = r, this.jo = i, this.Ho = 0, this.Jo = null, /** The last backoff attempt, as epoch milliseconds. */
      this.Yo = Date.now(), this.reset();
    }
    /**
     * Resets the backoff delay.
     *
     * The very next backoffAndWait() will have no delay. If it is called again
     * (i.e. due to an error), initialDelayMs (plus jitter) will be used, and
     * subsequent ones will increase according to the backoffFactor.
     */
    reset() {
      this.Ho = 0;
    }
    /**
     * Resets the backoff delay to the maximum delay (e.g. for use after a
     * RESOURCE_EXHAUSTED error).
     */
    Zo() {
      this.Ho = this.jo;
    }
    /**
     * Returns a promise that resolves after currentDelayMs, and increases the
     * delay for any subsequent attempts. If there was a pending backoff operation
     * already, it will be canceled.
     */
    Xo(e) {
      this.cancel();
      const t = Math.floor(this.Ho + this.e_()), n = Math.max(0, Date.now() - this.Yo), r = Math.max(0, t - n);
      r > 0 && __PRIVATE_logDebug("ExponentialBackoff", `Backing off for ${r} ms (base delay: ${this.Ho} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`), this.Jo = this.Ti.enqueueAfterDelay(this.timerId, r, () => (this.Yo = Date.now(), e())), // Apply backoff factor to determine next delay and ensure it is within
      // bounds.
      this.Ho *= this.zo, this.Ho < this.Go && (this.Ho = this.Go), this.Ho > this.jo && (this.Ho = this.jo);
    }
    t_() {
      null !== this.Jo && (this.Jo.skipDelay(), this.Jo = null);
    }
    cancel() {
      null !== this.Jo && (this.Jo.cancel(), this.Jo = null);
    }
    /** Returns a random value in the range [-currentBaseMs/2, currentBaseMs/2] */
    e_() {
      return (Math.random() - 0.5) * this.Ho;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class DelayedOperation {
    constructor(e, t, n, r, i) {
      this.asyncQueue = e, this.timerId = t, this.targetTimeMs = n, this.op = r, this.removalCallback = i, this.deferred = new __PRIVATE_Deferred(), this.then = this.deferred.promise.then.bind(this.deferred.promise), // It's normal for the deferred promise to be canceled (due to cancellation)
      // and so we attach a dummy catch callback to avoid
      // 'UnhandledPromiseRejectionWarning' log spam.
      this.deferred.promise.catch((e2) => {
      });
    }
    get promise() {
      return this.deferred.promise;
    }
    /**
     * Creates and returns a DelayedOperation that has been scheduled to be
     * executed on the provided asyncQueue after the provided delayMs.
     *
     * @param asyncQueue - The queue to schedule the operation on.
     * @param id - A Timer ID identifying the type of operation this is.
     * @param delayMs - The delay (ms) before the operation should be scheduled.
     * @param op - The operation to run.
     * @param removalCallback - A callback to be called synchronously once the
     *   operation is executed or canceled, notifying the AsyncQueue to remove it
     *   from its delayedOperations list.
     *   PORTING NOTE: This exists to prevent making removeDelayedOperation() and
     *   the DelayedOperation class public.
     */
    static createAndSchedule(e, t, n, r, i) {
      const s = Date.now() + n, o = new DelayedOperation(e, t, s, r, i);
      return o.start(n), o;
    }
    /**
     * Starts the timer. This is called immediately after construction by
     * createAndSchedule().
     */
    start(e) {
      this.timerHandle = setTimeout(() => this.handleDelayElapsed(), e);
    }
    /**
     * Queues the operation to run immediately (if it hasn't already been run or
     * canceled).
     */
    skipDelay() {
      return this.handleDelayElapsed();
    }
    /**
     * Cancels the operation if it hasn't already been executed or canceled. The
     * promise will be rejected.
     *
     * As long as the operation has not yet been run, calling cancel() provides a
     * guarantee that the operation will not be run.
     */
    cancel(e) {
      null !== this.timerHandle && (this.clearTimeout(), this.deferred.reject(new FirestoreError(C.CANCELLED, "Operation cancelled" + (e ? ": " + e : ""))));
    }
    handleDelayElapsed() {
      this.asyncQueue.enqueueAndForget(() => null !== this.timerHandle ? (this.clearTimeout(), this.op().then((e) => this.deferred.resolve(e))) : Promise.resolve());
    }
    clearTimeout() {
      null !== this.timerHandle && (this.removalCallback(this), clearTimeout(this.timerHandle), this.timerHandle = null);
    }
  }
  var jt, Ht;
  (Ht = jt || (jt = {}))._a = "default", /** Listen to changes in cache only */
  Ht.Cache = "cache";
  /**
   * @license
   * Copyright 2023 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function __PRIVATE_cloneLongPollingOptions(e) {
    const t = {};
    return void 0 !== e.timeoutSeconds && (t.timeoutSeconds = e.timeoutSeconds), t;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const Zt = /* @__PURE__ */ new Map();
  function __PRIVATE_validateIsNotUsedTogether(e, t, n, r) {
    if (true === t && true === r) throw new FirestoreError(C.INVALID_ARGUMENT, `${e} and ${n} cannot be used together.`);
  }
  function __PRIVATE_valueDescription(e) {
    if (void 0 === e) return "undefined";
    if (null === e) return "null";
    if ("string" == typeof e) return e.length > 20 && (e = `${e.substring(0, 20)}...`), JSON.stringify(e);
    if ("number" == typeof e || "boolean" == typeof e) return "" + e;
    if ("object" == typeof e) {
      if (e instanceof Array) return "an array";
      {
        const t = (
          /** try to get the constructor name for an object. */
          function __PRIVATE_tryGetCustomObjectType(e2) {
            if (e2.constructor) return e2.constructor.name;
            return null;
          }(e)
        );
        return t ? `a custom ${t} object` : "an object";
      }
    }
    return "function" == typeof e ? "a function" : fail();
  }
  function __PRIVATE_cast(e, t) {
    if ("_delegate" in e && // Unwrap Compat types
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    (e = e._delegate), !(e instanceof t)) {
      if (t.name === e.constructor.name) throw new FirestoreError(C.INVALID_ARGUMENT, "Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");
      {
        const n = __PRIVATE_valueDescription(e);
        throw new FirestoreError(C.INVALID_ARGUMENT, `Expected type '${t.name}', but it was: ${n}`);
      }
    }
    return e;
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const Xt = "firestore.googleapis.com", en = true;
  class FirestoreSettingsImpl {
    constructor(e) {
      var t, n;
      if (void 0 === e.host) {
        if (void 0 !== e.ssl) throw new FirestoreError(C.INVALID_ARGUMENT, "Can't provide ssl option if host option is not set");
        this.host = Xt, this.ssl = en;
      } else this.host = e.host, this.ssl = null !== (t = e.ssl) && void 0 !== t ? t : en;
      if (this.credentials = e.credentials, this.ignoreUndefinedProperties = !!e.ignoreUndefinedProperties, this.localCache = e.localCache, void 0 === e.cacheSizeBytes) this.cacheSizeBytes = St;
      else {
        if (-1 !== e.cacheSizeBytes && e.cacheSizeBytes < Dt) throw new FirestoreError(C.INVALID_ARGUMENT, "cacheSizeBytes must be at least 1048576");
        this.cacheSizeBytes = e.cacheSizeBytes;
      }
      __PRIVATE_validateIsNotUsedTogether("experimentalForceLongPolling", e.experimentalForceLongPolling, "experimentalAutoDetectLongPolling", e.experimentalAutoDetectLongPolling), this.experimentalForceLongPolling = !!e.experimentalForceLongPolling, this.experimentalForceLongPolling ? this.experimentalAutoDetectLongPolling = false : void 0 === e.experimentalAutoDetectLongPolling ? this.experimentalAutoDetectLongPolling = true : (
        // For backwards compatibility, coerce the value to boolean even though
        // the TypeScript compiler has narrowed the type to boolean already.
        // noinspection PointlessBooleanExpressionJS
        this.experimentalAutoDetectLongPolling = !!e.experimentalAutoDetectLongPolling
      ), this.experimentalLongPollingOptions = __PRIVATE_cloneLongPollingOptions(null !== (n = e.experimentalLongPollingOptions) && void 0 !== n ? n : {}), function __PRIVATE_validateLongPollingOptions(e2) {
        if (void 0 !== e2.timeoutSeconds) {
          if (isNaN(e2.timeoutSeconds)) throw new FirestoreError(C.INVALID_ARGUMENT, `invalid long polling timeout: ${e2.timeoutSeconds} (must not be NaN)`);
          if (e2.timeoutSeconds < 5) throw new FirestoreError(C.INVALID_ARGUMENT, `invalid long polling timeout: ${e2.timeoutSeconds} (minimum allowed value is 5)`);
          if (e2.timeoutSeconds > 30) throw new FirestoreError(C.INVALID_ARGUMENT, `invalid long polling timeout: ${e2.timeoutSeconds} (maximum allowed value is 30)`);
        }
      }(this.experimentalLongPollingOptions), this.useFetchStreams = !!e.useFetchStreams;
    }
    isEqual(e) {
      return this.host === e.host && this.ssl === e.ssl && this.credentials === e.credentials && this.cacheSizeBytes === e.cacheSizeBytes && this.experimentalForceLongPolling === e.experimentalForceLongPolling && this.experimentalAutoDetectLongPolling === e.experimentalAutoDetectLongPolling && function __PRIVATE_longPollingOptionsEqual(e2, t) {
        return e2.timeoutSeconds === t.timeoutSeconds;
      }(this.experimentalLongPollingOptions, e.experimentalLongPollingOptions) && this.ignoreUndefinedProperties === e.ignoreUndefinedProperties && this.useFetchStreams === e.useFetchStreams;
    }
  }
  class Firestore$1 {
    /** @hideconstructor */
    constructor(e, t, n, r) {
      this._authCredentials = e, this._appCheckCredentials = t, this._databaseId = n, this._app = r, /**
       * Whether it's a Firestore or Firestore Lite instance.
       */
      this.type = "firestore-lite", this._persistenceKey = "(lite)", this._settings = new FirestoreSettingsImpl({}), this._settingsFrozen = false, this._emulatorOptions = {}, // A task that is assigned when the terminate() is invoked and resolved when
      // all components have shut down. Otherwise, Firestore is not terminated,
      // which can mean either the FirestoreClient is in the process of starting,
      // or restarting.
      this._terminateTask = "notTerminated";
    }
    /**
     * The {@link @firebase/app#FirebaseApp} associated with this `Firestore` service
     * instance.
     */
    get app() {
      if (!this._app) throw new FirestoreError(C.FAILED_PRECONDITION, "Firestore was not initialized using the Firebase SDK. 'app' is not available");
      return this._app;
    }
    get _initialized() {
      return this._settingsFrozen;
    }
    get _terminated() {
      return "notTerminated" !== this._terminateTask;
    }
    _setSettings(e) {
      if (this._settingsFrozen) throw new FirestoreError(C.FAILED_PRECONDITION, "Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");
      this._settings = new FirestoreSettingsImpl(e), this._emulatorOptions = e.emulatorOptions || {}, void 0 !== e.credentials && (this._authCredentials = function __PRIVATE_makeAuthCredentialsProvider(e2) {
        if (!e2) return new __PRIVATE_EmptyAuthCredentialsProvider();
        switch (e2.type) {
          case "firstParty":
            return new __PRIVATE_FirstPartyAuthCredentialsProvider(e2.sessionIndex || "0", e2.iamToken || null, e2.authTokenFactory || null);
          case "provider":
            return e2.client;
          default:
            throw new FirestoreError(C.INVALID_ARGUMENT, "makeAuthCredentialsProvider failed due to invalid credential type");
        }
      }(e.credentials));
    }
    _getSettings() {
      return this._settings;
    }
    _getEmulatorOptions() {
      return this._emulatorOptions;
    }
    _freezeSettings() {
      return this._settingsFrozen = true, this._settings;
    }
    _delete() {
      return "notTerminated" === this._terminateTask && (this._terminateTask = this._terminate()), this._terminateTask;
    }
    async _restart() {
      "notTerminated" === this._terminateTask ? await this._terminate() : this._terminateTask = "notTerminated";
    }
    /** Returns a JSON-serializable representation of this `Firestore` instance. */
    toJSON() {
      return {
        app: this._app,
        databaseId: this._databaseId,
        settings: this._settings
      };
    }
    /**
     * Terminates all components used by this client. Subclasses can override
     * this method to clean up their own dependencies, but must also call this
     * method.
     *
     * Only ever called once.
     */
    _terminate() {
      return function __PRIVATE_removeComponents(e) {
        const t = Zt.get(e);
        t && (__PRIVATE_logDebug("ComponentProvider", "Removing Datastore"), Zt.delete(e), t.terminate());
      }(this), Promise.resolve();
    }
  }
  function connectFirestoreEmulator(e, t, n, r = {}) {
    var i;
    const s = (e = __PRIVATE_cast(e, Firestore$1))._getSettings(), o = Object.assign(Object.assign({}, s), {
      emulatorOptions: e._getEmulatorOptions()
    }), _ = `${t}:${n}`;
    s.host !== Xt && s.host !== _ && __PRIVATE_logWarn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");
    const a = Object.assign(Object.assign({}, s), {
      host: _,
      ssl: false,
      emulatorOptions: r
    });
    if (!deepEqual(a, o) && (e._setSettings(a), r.mockUserToken)) {
      let t2, n2;
      if ("string" == typeof r.mockUserToken) t2 = r.mockUserToken, n2 = User.MOCK_USER;
      else {
        t2 = createMockUserToken(r.mockUserToken, null === (i = e._app) || void 0 === i ? void 0 : i.options.projectId);
        const s2 = r.mockUserToken.sub || r.mockUserToken.user_id;
        if (!s2) throw new FirestoreError(C.INVALID_ARGUMENT, "mockUserToken must contain 'sub' or 'user_id' field!");
        n2 = new User(s2);
      }
      e._authCredentials = new __PRIVATE_EmulatorAuthCredentialsProvider(new __PRIVATE_OAuthToken(t2, n2));
    }
  }
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const tn = "AsyncQueue";
  class __PRIVATE_AsyncQueueImpl {
    constructor(e = Promise.resolve()) {
      this.Vu = [], // Is this AsyncQueue being shut down? Once it is set to true, it will not
      // be changed again.
      this.mu = false, // Operations scheduled to be queued in the future. Operations are
      // automatically removed after they are run or canceled.
      this.fu = [], // visible for testing
      this.gu = null, // Flag set while there's an outstanding AsyncQueue operation, used for
      // assertion sanity-checks.
      this.pu = false, // Enabled during shutdown on Safari to prevent future access to IndexedDB.
      this.yu = false, // List of TimerIds to fast-forward delays for.
      this.wu = [], // Backoff timer used to schedule retries for retryable operations
      this.a_ = new __PRIVATE_ExponentialBackoff(
        this,
        "async_queue_retry"
        /* TimerId.AsyncQueueRetry */
      ), // Visibility handler that triggers an immediate retry of all retryable
      // operations. Meant to speed up recovery when we regain file system access
      // after page comes into foreground.
      this.Su = () => {
        const e2 = getDocument();
        e2 && __PRIVATE_logDebug(tn, "Visibility state changed to " + e2.visibilityState), this.a_.t_();
      }, this.bu = e;
      const t = getDocument();
      t && "function" == typeof t.addEventListener && t.addEventListener("visibilitychange", this.Su);
    }
    get isShuttingDown() {
      return this.mu;
    }
    /**
     * Adds a new operation to the queue without waiting for it to complete (i.e.
     * we ignore the Promise result).
     */
    enqueueAndForget(e) {
      this.enqueue(e);
    }
    enqueueAndForgetEvenWhileRestricted(e) {
      this.Du(), // eslint-disable-next-line @typescript-eslint/no-floating-promises
      this.vu(e);
    }
    enterRestrictedMode(e) {
      if (!this.mu) {
        this.mu = true, this.yu = e || false;
        const t = getDocument();
        t && "function" == typeof t.removeEventListener && t.removeEventListener("visibilitychange", this.Su);
      }
    }
    enqueue(e) {
      if (this.Du(), this.mu)
        return new Promise(() => {
        });
      const t = new __PRIVATE_Deferred();
      return this.vu(() => this.mu && this.yu ? Promise.resolve() : (e().then(t.resolve, t.reject), t.promise)).then(() => t.promise);
    }
    enqueueRetryable(e) {
      this.enqueueAndForget(() => (this.Vu.push(e), this.Cu()));
    }
    /**
     * Runs the next operation from the retryable queue. If the operation fails,
     * reschedules with backoff.
     */
    async Cu() {
      if (0 !== this.Vu.length) {
        try {
          await this.Vu[0](), this.Vu.shift(), this.a_.reset();
        } catch (e) {
          if (!__PRIVATE_isIndexedDbTransactionError(e)) throw e;
          __PRIVATE_logDebug(tn, "Operation failed with retryable error: " + e);
        }
        this.Vu.length > 0 && // If there are additional operations, we re-schedule `retryNextOp()`.
        // This is necessary to run retryable operations that failed during
        // their initial attempt since we don't know whether they are already
        // enqueued. If, for example, `op1`, `op2`, `op3` are enqueued and `op1`
        // needs to  be re-run, we will run `op1`, `op1`, `op2` using the
        // already enqueued calls to `retryNextOp()`. `op3()` will then run in the
        // call scheduled here.
        // Since `backoffAndRun()` cancels an existing backoff and schedules a
        // new backoff on every call, there is only ever a single additional
        // operation in the queue.
        this.a_.Xo(() => this.Cu());
      }
    }
    vu(e) {
      const t = this.bu.then(() => (this.pu = true, e().catch((e2) => {
        this.gu = e2, this.pu = false;
        const t2 = (
          /**
          * Chrome includes Error.message in Error.stack. Other browsers do not.
          * This returns expected output of message + stack when available.
          * @param error - Error or FirestoreError
          */
          function __PRIVATE_getMessageOrStack(e3) {
            let t3 = e3.message || "";
            e3.stack && (t3 = e3.stack.includes(e3.message) ? e3.stack : e3.message + "\n" + e3.stack);
            return t3;
          }(e2)
        );
        throw __PRIVATE_logError("INTERNAL UNHANDLED ERROR: ", t2), e2;
      }).then((e2) => (this.pu = false, e2))));
      return this.bu = t, t;
    }
    enqueueAfterDelay(e, t, n) {
      this.Du(), // Fast-forward delays for timerIds that have been overridden.
      this.wu.indexOf(e) > -1 && (t = 0);
      const r = DelayedOperation.createAndSchedule(this, e, t, n, (e2) => this.Fu(e2));
      return this.fu.push(r), r;
    }
    Du() {
      this.gu && fail();
    }
    verifyOperationInProgress() {
    }
    /**
     * Waits until all currently queued tasks are finished executing. Delayed
     * operations are not run.
     */
    async Mu() {
      let e;
      do {
        e = this.bu, await e;
      } while (e !== this.bu);
    }
    /**
     * For Tests: Determine if a delayed operation with a particular TimerId
     * exists.
     */
    xu(e) {
      for (const t of this.fu) if (t.timerId === e) return true;
      return false;
    }
    /**
     * For Tests: Runs some or all delayed operations early.
     *
     * @param lastTimerId - Delayed operations up to and including this TimerId
     * will be drained. Pass TimerId.All to run all delayed operations.
     * @returns a Promise that resolves once all operations have been run.
     */
    Ou(e) {
      return this.Mu().then(() => {
        this.fu.sort((e2, t) => e2.targetTimeMs - t.targetTimeMs);
        for (const t of this.fu) if (t.skipDelay(), "all" !== e && t.timerId === e) break;
        return this.Mu();
      });
    }
    /**
     * For Tests: Skip all subsequent delays for a timer id.
     */
    Nu(e) {
      this.wu.push(e);
    }
    /** Called once a DelayedOperation is run or canceled. */
    Fu(e) {
      const t = this.fu.indexOf(e);
      this.fu.splice(t, 1);
    }
  }
  class Firestore extends Firestore$1 {
    /** @hideconstructor */
    constructor(e, t, n, r) {
      super(e, t, n, r), /**
       * Whether it's a {@link Firestore} or Firestore Lite instance.
       */
      this.type = "firestore", this._queue = new __PRIVATE_AsyncQueueImpl(), this._persistenceKey = (null == r ? void 0 : r.name) || "[DEFAULT]";
    }
    async _terminate() {
      if (this._firestoreClient) {
        const e = this._firestoreClient.terminate();
        this._queue = new __PRIVATE_AsyncQueueImpl(e), this._firestoreClient = void 0, await e;
      }
    }
  }
  function getFirestore(e, n) {
    const r = "object" == typeof e ? e : getApp(), i = "string" == typeof e ? e : rt, s = _getProvider(r, "firestore").getImmediate({
      identifier: i
    });
    if (!s._initialized) {
      const e2 = getDefaultEmulatorHostnameAndPort("firestore");
      e2 && connectFirestoreEmulator(s, ...e2);
    }
    return s;
  }
  !function __PRIVATE_registerFirestore(e, t = true) {
    !function __PRIVATE_setSDKVersion(e2) {
      D = e2;
    }(SDK_VERSION$1), _registerComponent(new Component("firestore", (e2, { instanceIdentifier: n, options: r }) => {
      const i = e2.getProvider("app").getImmediate(), s = new Firestore(new __PRIVATE_FirebaseAuthCredentialsProvider(e2.getProvider("auth-internal")), new __PRIVATE_FirebaseAppCheckTokenProvider(i, e2.getProvider("app-check-internal")), function __PRIVATE_databaseIdFromApp(e3, t2) {
        if (!Object.prototype.hasOwnProperty.apply(e3.options, ["projectId"])) throw new FirestoreError(C.INVALID_ARGUMENT, '"projectId" not provided in firebase.initializeApp.');
        return new DatabaseId(e3.options.projectId, t2);
      }(i, n), i);
      return r = Object.assign({
        useFetchStreams: t
      }, r), s._setSettings(r), s;
    }, "PUBLIC").setMultipleInstances(true)), registerVersion(S, b, e), // BUILD_TARGET will be replaced by values like esm2017, cjs2017, etc during the compilation
    registerVersion(S, b, "esm2017");
  }();
  const name = "@firebase/database";
  const version = "1.0.14";
  /**
   * @license
   * Copyright 2019 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let SDK_VERSION = "";
  function setSDKVersion(version2) {
    SDK_VERSION = version2;
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class DOMStorageWrapper {
    /**
     * @param domStorage_ - The underlying storage object (e.g. localStorage or sessionStorage)
     */
    constructor(domStorage_) {
      this.domStorage_ = domStorage_;
      this.prefix_ = "firebase:";
    }
    /**
     * @param key - The key to save the value under
     * @param value - The value being stored, or null to remove the key.
     */
    set(key, value) {
      if (value == null) {
        this.domStorage_.removeItem(this.prefixedName_(key));
      } else {
        this.domStorage_.setItem(this.prefixedName_(key), stringify(value));
      }
    }
    /**
     * @returns The value that was stored under this key, or null
     */
    get(key) {
      const storedVal = this.domStorage_.getItem(this.prefixedName_(key));
      if (storedVal == null) {
        return null;
      } else {
        return jsonEval(storedVal);
      }
    }
    remove(key) {
      this.domStorage_.removeItem(this.prefixedName_(key));
    }
    prefixedName_(name2) {
      return this.prefix_ + name2;
    }
    toString() {
      return this.domStorage_.toString();
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class MemoryStorage {
    constructor() {
      this.cache_ = {};
      this.isInMemoryStorage = true;
    }
    set(key, value) {
      if (value == null) {
        delete this.cache_[key];
      } else {
        this.cache_[key] = value;
      }
    }
    get(key) {
      if (contains(this.cache_, key)) {
        return this.cache_[key];
      }
      return null;
    }
    remove(key) {
      delete this.cache_[key];
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const createStoragefor = function(domStorageName) {
    try {
      if (typeof window !== "undefined" && typeof window[domStorageName] !== "undefined") {
        const domStorage = window[domStorageName];
        domStorage.setItem("firebase:sentinel", "cache");
        domStorage.removeItem("firebase:sentinel");
        return new DOMStorageWrapper(domStorage);
      }
    } catch (e) {
    }
    return new MemoryStorage();
  };
  const PersistentStorage = createStoragefor("localStorage");
  const SessionStorage = createStoragefor("sessionStorage");
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const logClient = new Logger("@firebase/database");
  const LUIDGenerator = /* @__PURE__ */ function() {
    let id = 1;
    return function() {
      return id++;
    };
  }();
  const sha1 = function(str) {
    const utf8Bytes = stringToByteArray(str);
    const sha12 = new Sha1();
    sha12.update(utf8Bytes);
    const sha1Bytes = sha12.digest();
    return base64.encodeByteArray(sha1Bytes);
  };
  const buildLogMessage_ = function(...varArgs) {
    let message = "";
    for (let i = 0; i < varArgs.length; i++) {
      const arg = varArgs[i];
      if (Array.isArray(arg) || arg && typeof arg === "object" && // eslint-disable-next-line @typescript-eslint/no-explicit-any
      typeof arg.length === "number") {
        message += buildLogMessage_.apply(null, arg);
      } else if (typeof arg === "object") {
        message += stringify(arg);
      } else {
        message += arg;
      }
      message += " ";
    }
    return message;
  };
  let logger$1 = null;
  let firstLog_ = true;
  const enableLogging$1 = function(logger_, persistent) {
    assert(true, "Can't turn on custom loggers persistently.");
    {
      logClient.logLevel = LogLevel.VERBOSE;
      logger$1 = logClient.log.bind(logClient);
    }
  };
  const log = function(...varArgs) {
    if (firstLog_ === true) {
      firstLog_ = false;
      if (logger$1 === null && SessionStorage.get("logging_enabled") === true) {
        enableLogging$1();
      }
    }
    if (logger$1) {
      const message = buildLogMessage_.apply(null, varArgs);
      logger$1(message);
    }
  };
  const logWrapper = function(prefix) {
    return function(...varArgs) {
      log(prefix, ...varArgs);
    };
  };
  const error = function(...varArgs) {
    const message = "FIREBASE INTERNAL ERROR: " + buildLogMessage_(...varArgs);
    logClient.error(message);
  };
  const fatal = function(...varArgs) {
    const message = `FIREBASE FATAL ERROR: ${buildLogMessage_(...varArgs)}`;
    logClient.error(message);
    throw new Error(message);
  };
  const warn = function(...varArgs) {
    const message = "FIREBASE WARNING: " + buildLogMessage_(...varArgs);
    logClient.warn(message);
  };
  const warnIfPageIsSecure = function() {
    if (typeof window !== "undefined" && window.location && window.location.protocol && window.location.protocol.indexOf("https:") !== -1) {
      warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");
    }
  };
  const isInvalidJSONNumber = function(data) {
    return typeof data === "number" && (data !== data || // NaN
    data === Number.POSITIVE_INFINITY || data === Number.NEGATIVE_INFINITY);
  };
  const executeWhenDOMReady = function(fn) {
    if (document.readyState === "complete") {
      fn();
    } else {
      let called = false;
      const wrappedFn = function() {
        if (!document.body) {
          setTimeout(wrappedFn, Math.floor(10));
          return;
        }
        if (!called) {
          called = true;
          fn();
        }
      };
      if (document.addEventListener) {
        document.addEventListener("DOMContentLoaded", wrappedFn, false);
        window.addEventListener("load", wrappedFn, false);
      } else if (document.attachEvent) {
        document.attachEvent("onreadystatechange", () => {
          if (document.readyState === "complete") {
            wrappedFn();
          }
        });
        window.attachEvent("onload", wrappedFn);
      }
    }
  };
  const MIN_NAME = "[MIN_NAME]";
  const MAX_NAME = "[MAX_NAME]";
  const nameCompare = function(a, b2) {
    if (a === b2) {
      return 0;
    } else if (a === MIN_NAME || b2 === MAX_NAME) {
      return -1;
    } else if (b2 === MIN_NAME || a === MAX_NAME) {
      return 1;
    } else {
      const aAsInt = tryParseInt(a), bAsInt = tryParseInt(b2);
      if (aAsInt !== null) {
        if (bAsInt !== null) {
          return aAsInt - bAsInt === 0 ? a.length - b2.length : aAsInt - bAsInt;
        } else {
          return -1;
        }
      } else if (bAsInt !== null) {
        return 1;
      } else {
        return a < b2 ? -1 : 1;
      }
    }
  };
  const stringCompare = function(a, b2) {
    if (a === b2) {
      return 0;
    } else if (a < b2) {
      return -1;
    } else {
      return 1;
    }
  };
  const requireKey = function(key, obj) {
    if (obj && key in obj) {
      return obj[key];
    } else {
      throw new Error("Missing required key (" + key + ") in object: " + stringify(obj));
    }
  };
  const ObjectToUniqueKey = function(obj) {
    if (typeof obj !== "object" || obj === null) {
      return stringify(obj);
    }
    const keys = [];
    for (const k in obj) {
      keys.push(k);
    }
    keys.sort();
    let key = "{";
    for (let i = 0; i < keys.length; i++) {
      if (i !== 0) {
        key += ",";
      }
      key += stringify(keys[i]);
      key += ":";
      key += ObjectToUniqueKey(obj[keys[i]]);
    }
    key += "}";
    return key;
  };
  const splitStringBySize = function(str, segsize) {
    const len = str.length;
    if (len <= segsize) {
      return [str];
    }
    const dataSegs = [];
    for (let c = 0; c < len; c += segsize) {
      if (c + segsize > len) {
        dataSegs.push(str.substring(c, len));
      } else {
        dataSegs.push(str.substring(c, c + segsize));
      }
    }
    return dataSegs;
  };
  function each(obj, fn) {
    for (const key in obj) {
      if (obj.hasOwnProperty(key)) {
        fn(key, obj[key]);
      }
    }
  }
  const doubleToIEEE754String = function(v2) {
    assert(!isInvalidJSONNumber(v2), "Invalid JSON number");
    const ebits = 11, fbits = 52;
    const bias = (1 << ebits - 1) - 1;
    let s, e, f, ln, i;
    if (v2 === 0) {
      e = 0;
      f = 0;
      s = 1 / v2 === -Infinity ? 1 : 0;
    } else {
      s = v2 < 0;
      v2 = Math.abs(v2);
      if (v2 >= Math.pow(2, 1 - bias)) {
        ln = Math.min(Math.floor(Math.log(v2) / Math.LN2), bias);
        e = ln + bias;
        f = Math.round(v2 * Math.pow(2, fbits - ln) - Math.pow(2, fbits));
      } else {
        e = 0;
        f = Math.round(v2 / Math.pow(2, 1 - bias - fbits));
      }
    }
    const bits = [];
    for (i = fbits; i; i -= 1) {
      bits.push(f % 2 ? 1 : 0);
      f = Math.floor(f / 2);
    }
    for (i = ebits; i; i -= 1) {
      bits.push(e % 2 ? 1 : 0);
      e = Math.floor(e / 2);
    }
    bits.push(s ? 1 : 0);
    bits.reverse();
    const str = bits.join("");
    let hexByteString = "";
    for (i = 0; i < 64; i += 8) {
      let hexByte = parseInt(str.substr(i, 8), 2).toString(16);
      if (hexByte.length === 1) {
        hexByte = "0" + hexByte;
      }
      hexByteString = hexByteString + hexByte;
    }
    return hexByteString.toLowerCase();
  };
  const isChromeExtensionContentScript = function() {
    return !!(typeof window === "object" && window["chrome"] && window["chrome"]["extension"] && !/^chrome/.test(window.location.href));
  };
  const isWindowsStoreApp = function() {
    return typeof Windows === "object" && typeof Windows.UI === "object";
  };
  const INTEGER_REGEXP_ = new RegExp("^-?(0*)\\d{1,10}$");
  const INTEGER_32_MIN = -2147483648;
  const INTEGER_32_MAX = 2147483647;
  const tryParseInt = function(str) {
    if (INTEGER_REGEXP_.test(str)) {
      const intVal = Number(str);
      if (intVal >= INTEGER_32_MIN && intVal <= INTEGER_32_MAX) {
        return intVal;
      }
    }
    return null;
  };
  const exceptionGuard = function(fn) {
    try {
      fn();
    } catch (e) {
      setTimeout(() => {
        const stack = e.stack || "";
        warn("Exception was thrown by user callback.", stack);
        throw e;
      }, Math.floor(0));
    }
  };
  const beingCrawled = function() {
    const userAgent = typeof window === "object" && window["navigator"] && window["navigator"]["userAgent"] || "";
    return userAgent.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i) >= 0;
  };
  const setTimeoutNonBlocking = function(fn, time) {
    const timeout = setTimeout(fn, time);
    if (typeof timeout === "number" && // @ts-ignore Is only defined in Deno environments.
    typeof Deno !== "undefined" && // @ts-ignore Deno and unrefTimer are only defined in Deno environments.
    Deno["unrefTimer"]) {
      Deno.unrefTimer(timeout);
    } else if (typeof timeout === "object" && timeout["unref"]) {
      timeout["unref"]();
    }
    return timeout;
  };
  /**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class AppCheckTokenProvider {
    constructor(app, appCheckProvider) {
      this.appCheckProvider = appCheckProvider;
      this.appName = app.name;
      if (_isFirebaseServerApp(app) && app.settings.appCheckToken) {
        this.serverAppAppCheckToken = app.settings.appCheckToken;
      }
      this.appCheck = appCheckProvider === null || appCheckProvider === void 0 ? void 0 : appCheckProvider.getImmediate({ optional: true });
      if (!this.appCheck) {
        appCheckProvider === null || appCheckProvider === void 0 ? void 0 : appCheckProvider.get().then((appCheck) => this.appCheck = appCheck);
      }
    }
    getToken(forceRefresh) {
      if (this.serverAppAppCheckToken) {
        if (forceRefresh) {
          throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");
        }
        return Promise.resolve({ token: this.serverAppAppCheckToken });
      }
      if (!this.appCheck) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            if (this.appCheck) {
              this.getToken(forceRefresh).then(resolve, reject);
            } else {
              resolve(null);
            }
          }, 0);
        });
      }
      return this.appCheck.getToken(forceRefresh);
    }
    addTokenChangeListener(listener) {
      var _a2;
      (_a2 = this.appCheckProvider) === null || _a2 === void 0 ? void 0 : _a2.get().then((appCheck) => appCheck.addTokenListener(listener));
    }
    notifyForInvalidToken() {
      warn(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class FirebaseAuthTokenProvider {
    constructor(appName_, firebaseOptions_, authProvider_) {
      this.appName_ = appName_;
      this.firebaseOptions_ = firebaseOptions_;
      this.authProvider_ = authProvider_;
      this.auth_ = null;
      this.auth_ = authProvider_.getImmediate({ optional: true });
      if (!this.auth_) {
        authProvider_.onInit((auth2) => this.auth_ = auth2);
      }
    }
    getToken(forceRefresh) {
      if (!this.auth_) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            if (this.auth_) {
              this.getToken(forceRefresh).then(resolve, reject);
            } else {
              resolve(null);
            }
          }, 0);
        });
      }
      return this.auth_.getToken(forceRefresh).catch((error2) => {
        if (error2 && error2.code === "auth/token-not-initialized") {
          log("Got auth/token-not-initialized error.  Treating as null token.");
          return null;
        } else {
          return Promise.reject(error2);
        }
      });
    }
    addTokenChangeListener(listener) {
      if (this.auth_) {
        this.auth_.addAuthTokenListener(listener);
      } else {
        this.authProvider_.get().then((auth2) => auth2.addAuthTokenListener(listener));
      }
    }
    removeTokenChangeListener(listener) {
      this.authProvider_.get().then((auth2) => auth2.removeAuthTokenListener(listener));
    }
    notifyForInvalidToken() {
      let errorMessage = 'Provided authentication credentials for the app named "' + this.appName_ + '" are invalid. This usually indicates your app was not initialized correctly. ';
      if ("credential" in this.firebaseOptions_) {
        errorMessage += 'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.';
      } else if ("serviceAccount" in this.firebaseOptions_) {
        errorMessage += 'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.';
      } else {
        errorMessage += 'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.';
      }
      warn(errorMessage);
    }
  }
  class EmulatorTokenProvider {
    constructor(accessToken) {
      this.accessToken = accessToken;
    }
    getToken(forceRefresh) {
      return Promise.resolve({
        accessToken: this.accessToken
      });
    }
    addTokenChangeListener(listener) {
      listener(this.accessToken);
    }
    removeTokenChangeListener(listener) {
    }
    notifyForInvalidToken() {
    }
  }
  EmulatorTokenProvider.OWNER = "owner";
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const PROTOCOL_VERSION = "5";
  const VERSION_PARAM = "v";
  const TRANSPORT_SESSION_PARAM = "s";
  const REFERER_PARAM = "r";
  const FORGE_REF = "f";
  const FORGE_DOMAIN_RE = /(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/;
  const LAST_SESSION_PARAM = "ls";
  const APPLICATION_ID_PARAM = "p";
  const APP_CHECK_TOKEN_PARAM = "ac";
  const WEBSOCKET = "websocket";
  const LONG_POLLING = "long_polling";
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class RepoInfo {
    /**
     * @param host - Hostname portion of the url for the repo
     * @param secure - Whether or not this repo is accessed over ssl
     * @param namespace - The namespace represented by the repo
     * @param webSocketOnly - Whether to prefer websockets over all other transports (used by Nest).
     * @param nodeAdmin - Whether this instance uses Admin SDK credentials
     * @param persistenceKey - Override the default session persistence storage key
     */
    constructor(host, secure, namespace, webSocketOnly, nodeAdmin = false, persistenceKey = "", includeNamespaceInQueryParams = false, isUsingEmulator = false, emulatorOptions = null) {
      this.secure = secure;
      this.namespace = namespace;
      this.webSocketOnly = webSocketOnly;
      this.nodeAdmin = nodeAdmin;
      this.persistenceKey = persistenceKey;
      this.includeNamespaceInQueryParams = includeNamespaceInQueryParams;
      this.isUsingEmulator = isUsingEmulator;
      this.emulatorOptions = emulatorOptions;
      this._host = host.toLowerCase();
      this._domain = this._host.substr(this._host.indexOf(".") + 1);
      this.internalHost = PersistentStorage.get("host:" + host) || this._host;
    }
    isCacheableHost() {
      return this.internalHost.substr(0, 2) === "s-";
    }
    isCustomHost() {
      return this._domain !== "firebaseio.com" && this._domain !== "firebaseio-demo.com";
    }
    get host() {
      return this._host;
    }
    set host(newHost) {
      if (newHost !== this.internalHost) {
        this.internalHost = newHost;
        if (this.isCacheableHost()) {
          PersistentStorage.set("host:" + this._host, this.internalHost);
        }
      }
    }
    toString() {
      let str = this.toURLString();
      if (this.persistenceKey) {
        str += "<" + this.persistenceKey + ">";
      }
      return str;
    }
    toURLString() {
      const protocol = this.secure ? "https://" : "http://";
      const query = this.includeNamespaceInQueryParams ? `?ns=${this.namespace}` : "";
      return `${protocol}${this.host}/${query}`;
    }
  }
  function repoInfoNeedsQueryParam(repoInfo) {
    return repoInfo.host !== repoInfo.internalHost || repoInfo.isCustomHost() || repoInfo.includeNamespaceInQueryParams;
  }
  function repoInfoConnectionURL(repoInfo, type, params) {
    assert(typeof type === "string", "typeof type must == string");
    assert(typeof params === "object", "typeof params must == object");
    let connURL;
    if (type === WEBSOCKET) {
      connURL = (repoInfo.secure ? "wss://" : "ws://") + repoInfo.internalHost + "/.ws?";
    } else if (type === LONG_POLLING) {
      connURL = (repoInfo.secure ? "https://" : "http://") + repoInfo.internalHost + "/.lp?";
    } else {
      throw new Error("Unknown connection type: " + type);
    }
    if (repoInfoNeedsQueryParam(repoInfo)) {
      params["ns"] = repoInfo.namespace;
    }
    const pairs = [];
    each(params, (key, value) => {
      pairs.push(key + "=" + value);
    });
    return connURL + pairs.join("&");
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class StatsCollection {
    constructor() {
      this.counters_ = {};
    }
    incrementCounter(name2, amount = 1) {
      if (!contains(this.counters_, name2)) {
        this.counters_[name2] = 0;
      }
      this.counters_[name2] += amount;
    }
    get() {
      return deepCopy(this.counters_);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const collections = {};
  const reporters = {};
  function statsManagerGetCollection(repoInfo) {
    const hashString = repoInfo.toString();
    if (!collections[hashString]) {
      collections[hashString] = new StatsCollection();
    }
    return collections[hashString];
  }
  function statsManagerGetOrCreateReporter(repoInfo, creatorFunction) {
    const hashString = repoInfo.toString();
    if (!reporters[hashString]) {
      reporters[hashString] = creatorFunction();
    }
    return reporters[hashString];
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class PacketReceiver {
    /**
     * @param onMessage_
     */
    constructor(onMessage_) {
      this.onMessage_ = onMessage_;
      this.pendingResponses = [];
      this.currentResponseNum = 0;
      this.closeAfterResponse = -1;
      this.onClose = null;
    }
    closeAfter(responseNum, callback) {
      this.closeAfterResponse = responseNum;
      this.onClose = callback;
      if (this.closeAfterResponse < this.currentResponseNum) {
        this.onClose();
        this.onClose = null;
      }
    }
    /**
     * Each message from the server comes with a response number, and an array of data. The responseNumber
     * allows us to ensure that we process them in the right order, since we can't be guaranteed that all
     * browsers will respond in the same order as the requests we sent
     */
    handleResponse(requestNum, data) {
      this.pendingResponses[requestNum] = data;
      while (this.pendingResponses[this.currentResponseNum]) {
        const toProcess = this.pendingResponses[this.currentResponseNum];
        delete this.pendingResponses[this.currentResponseNum];
        for (let i = 0; i < toProcess.length; ++i) {
          if (toProcess[i]) {
            exceptionGuard(() => {
              this.onMessage_(toProcess[i]);
            });
          }
        }
        if (this.currentResponseNum === this.closeAfterResponse) {
          if (this.onClose) {
            this.onClose();
            this.onClose = null;
          }
          break;
        }
        this.currentResponseNum++;
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const FIREBASE_LONGPOLL_START_PARAM = "start";
  const FIREBASE_LONGPOLL_CLOSE_COMMAND = "close";
  const FIREBASE_LONGPOLL_COMMAND_CB_NAME = "pLPCommand";
  const FIREBASE_LONGPOLL_DATA_CB_NAME = "pRTLPCB";
  const FIREBASE_LONGPOLL_ID_PARAM = "id";
  const FIREBASE_LONGPOLL_PW_PARAM = "pw";
  const FIREBASE_LONGPOLL_SERIAL_PARAM = "ser";
  const FIREBASE_LONGPOLL_CALLBACK_ID_PARAM = "cb";
  const FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM = "seg";
  const FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET = "ts";
  const FIREBASE_LONGPOLL_DATA_PARAM = "d";
  const FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM = "dframe";
  const MAX_URL_DATA_SIZE = 1870;
  const SEG_HEADER_SIZE = 30;
  const MAX_PAYLOAD_SIZE = MAX_URL_DATA_SIZE - SEG_HEADER_SIZE;
  const KEEPALIVE_REQUEST_INTERVAL = 25e3;
  const LP_CONNECT_TIMEOUT = 3e4;
  class BrowserPollConnection {
    /**
     * @param connId An identifier for this connection, used for logging
     * @param repoInfo The info for the endpoint to send data to.
     * @param applicationId The Firebase App ID for this project.
     * @param appCheckToken The AppCheck token for this client.
     * @param authToken The AuthToken to use for this connection.
     * @param transportSessionId Optional transportSessionid if we are
     * reconnecting for an existing transport session
     * @param lastSessionId Optional lastSessionId if the PersistentConnection has
     * already created a connection previously
     */
    constructor(connId, repoInfo, applicationId, appCheckToken, authToken, transportSessionId, lastSessionId) {
      this.connId = connId;
      this.repoInfo = repoInfo;
      this.applicationId = applicationId;
      this.appCheckToken = appCheckToken;
      this.authToken = authToken;
      this.transportSessionId = transportSessionId;
      this.lastSessionId = lastSessionId;
      this.bytesSent = 0;
      this.bytesReceived = 0;
      this.everConnected_ = false;
      this.log_ = logWrapper(connId);
      this.stats_ = statsManagerGetCollection(repoInfo);
      this.urlFn = (params) => {
        if (this.appCheckToken) {
          params[APP_CHECK_TOKEN_PARAM] = this.appCheckToken;
        }
        return repoInfoConnectionURL(repoInfo, LONG_POLLING, params);
      };
    }
    /**
     * @param onMessage - Callback when messages arrive
     * @param onDisconnect - Callback with connection lost.
     */
    open(onMessage, onDisconnect) {
      this.curSegmentNum = 0;
      this.onDisconnect_ = onDisconnect;
      this.myPacketOrderer = new PacketReceiver(onMessage);
      this.isClosed_ = false;
      this.connectTimeoutTimer_ = setTimeout(() => {
        this.log_("Timed out trying to connect.");
        this.onClosed_();
        this.connectTimeoutTimer_ = null;
      }, Math.floor(LP_CONNECT_TIMEOUT));
      executeWhenDOMReady(() => {
        if (this.isClosed_) {
          return;
        }
        this.scriptTagHolder = new FirebaseIFrameScriptHolder((...args) => {
          const [command, arg1, arg2, arg3, arg4] = args;
          this.incrementIncomingBytes_(args);
          if (!this.scriptTagHolder) {
            return;
          }
          if (this.connectTimeoutTimer_) {
            clearTimeout(this.connectTimeoutTimer_);
            this.connectTimeoutTimer_ = null;
          }
          this.everConnected_ = true;
          if (command === FIREBASE_LONGPOLL_START_PARAM) {
            this.id = arg1;
            this.password = arg2;
          } else if (command === FIREBASE_LONGPOLL_CLOSE_COMMAND) {
            if (arg1) {
              this.scriptTagHolder.sendNewPolls = false;
              this.myPacketOrderer.closeAfter(arg1, () => {
                this.onClosed_();
              });
            } else {
              this.onClosed_();
            }
          } else {
            throw new Error("Unrecognized command received: " + command);
          }
        }, (...args) => {
          const [pN, data] = args;
          this.incrementIncomingBytes_(args);
          this.myPacketOrderer.handleResponse(pN, data);
        }, () => {
          this.onClosed_();
        }, this.urlFn);
        const urlParams = {};
        urlParams[FIREBASE_LONGPOLL_START_PARAM] = "t";
        urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = Math.floor(Math.random() * 1e8);
        if (this.scriptTagHolder.uniqueCallbackIdentifier) {
          urlParams[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM] = this.scriptTagHolder.uniqueCallbackIdentifier;
        }
        urlParams[VERSION_PARAM] = PROTOCOL_VERSION;
        if (this.transportSessionId) {
          urlParams[TRANSPORT_SESSION_PARAM] = this.transportSessionId;
        }
        if (this.lastSessionId) {
          urlParams[LAST_SESSION_PARAM] = this.lastSessionId;
        }
        if (this.applicationId) {
          urlParams[APPLICATION_ID_PARAM] = this.applicationId;
        }
        if (this.appCheckToken) {
          urlParams[APP_CHECK_TOKEN_PARAM] = this.appCheckToken;
        }
        if (typeof location !== "undefined" && location.hostname && FORGE_DOMAIN_RE.test(location.hostname)) {
          urlParams[REFERER_PARAM] = FORGE_REF;
        }
        const connectURL = this.urlFn(urlParams);
        this.log_("Connecting via long-poll to " + connectURL);
        this.scriptTagHolder.addTag(connectURL, () => {
        });
      });
    }
    /**
     * Call this when a handshake has completed successfully and we want to consider the connection established
     */
    start() {
      this.scriptTagHolder.startLongPoll(this.id, this.password);
      this.addDisconnectPingFrame(this.id, this.password);
    }
    /**
     * Forces long polling to be considered as a potential transport
     */
    static forceAllow() {
      BrowserPollConnection.forceAllow_ = true;
    }
    /**
     * Forces longpolling to not be considered as a potential transport
     */
    static forceDisallow() {
      BrowserPollConnection.forceDisallow_ = true;
    }
    // Static method, use string literal so it can be accessed in a generic way
    static isAvailable() {
      if (BrowserPollConnection.forceAllow_) {
        return true;
      } else {
        return !BrowserPollConnection.forceDisallow_ && typeof document !== "undefined" && document.createElement != null && !isChromeExtensionContentScript() && !isWindowsStoreApp();
      }
    }
    /**
     * No-op for polling
     */
    markConnectionHealthy() {
    }
    /**
     * Stops polling and cleans up the iframe
     */
    shutdown_() {
      this.isClosed_ = true;
      if (this.scriptTagHolder) {
        this.scriptTagHolder.close();
        this.scriptTagHolder = null;
      }
      if (this.myDisconnFrame) {
        document.body.removeChild(this.myDisconnFrame);
        this.myDisconnFrame = null;
      }
      if (this.connectTimeoutTimer_) {
        clearTimeout(this.connectTimeoutTimer_);
        this.connectTimeoutTimer_ = null;
      }
    }
    /**
     * Triggered when this transport is closed
     */
    onClosed_() {
      if (!this.isClosed_) {
        this.log_("Longpoll is closing itself");
        this.shutdown_();
        if (this.onDisconnect_) {
          this.onDisconnect_(this.everConnected_);
          this.onDisconnect_ = null;
        }
      }
    }
    /**
     * External-facing close handler. RealTime has requested we shut down. Kill our connection and tell the server
     * that we've left.
     */
    close() {
      if (!this.isClosed_) {
        this.log_("Longpoll is being closed.");
        this.shutdown_();
      }
    }
    /**
     * Send the JSON object down to the server. It will need to be stringified, base64 encoded, and then
     * broken into chunks (since URLs have a small maximum length).
     * @param data - The JSON data to transmit.
     */
    send(data) {
      const dataStr = stringify(data);
      this.bytesSent += dataStr.length;
      this.stats_.incrementCounter("bytes_sent", dataStr.length);
      const base64data = base64Encode(dataStr);
      const dataSegs = splitStringBySize(base64data, MAX_PAYLOAD_SIZE);
      for (let i = 0; i < dataSegs.length; i++) {
        this.scriptTagHolder.enqueueSegment(this.curSegmentNum, dataSegs.length, dataSegs[i]);
        this.curSegmentNum++;
      }
    }
    /**
     * This is how we notify the server that we're leaving.
     * We aren't able to send requests with DHTML on a window close event, but we can
     * trigger XHR requests in some browsers (everything but Opera basically).
     */
    addDisconnectPingFrame(id, pw) {
      this.myDisconnFrame = document.createElement("iframe");
      const urlParams = {};
      urlParams[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM] = "t";
      urlParams[FIREBASE_LONGPOLL_ID_PARAM] = id;
      urlParams[FIREBASE_LONGPOLL_PW_PARAM] = pw;
      this.myDisconnFrame.src = this.urlFn(urlParams);
      this.myDisconnFrame.style.display = "none";
      document.body.appendChild(this.myDisconnFrame);
    }
    /**
     * Used to track the bytes received by this client
     */
    incrementIncomingBytes_(args) {
      const bytesReceived = stringify(args).length;
      this.bytesReceived += bytesReceived;
      this.stats_.incrementCounter("bytes_received", bytesReceived);
    }
  }
  class FirebaseIFrameScriptHolder {
    /**
     * @param commandCB - The callback to be called when control commands are received from the server.
     * @param onMessageCB - The callback to be triggered when responses arrive from the server.
     * @param onDisconnect - The callback to be triggered when this tag holder is closed
     * @param urlFn - A function that provides the URL of the endpoint to send data to.
     */
    constructor(commandCB, onMessageCB, onDisconnect, urlFn) {
      this.onDisconnect = onDisconnect;
      this.urlFn = urlFn;
      this.outstandingRequests = /* @__PURE__ */ new Set();
      this.pendingSegs = [];
      this.currentSerial = Math.floor(Math.random() * 1e8);
      this.sendNewPolls = true;
      {
        this.uniqueCallbackIdentifier = LUIDGenerator();
        window[FIREBASE_LONGPOLL_COMMAND_CB_NAME + this.uniqueCallbackIdentifier] = commandCB;
        window[FIREBASE_LONGPOLL_DATA_CB_NAME + this.uniqueCallbackIdentifier] = onMessageCB;
        this.myIFrame = FirebaseIFrameScriptHolder.createIFrame_();
        let script = "";
        if (this.myIFrame.src && this.myIFrame.src.substr(0, "javascript:".length) === "javascript:") {
          const currentDomain = document.domain;
          script = '<script>document.domain="' + currentDomain + '";<\/script>';
        }
        const iframeContents = "<html><body>" + script + "</body></html>";
        try {
          this.myIFrame.doc.open();
          this.myIFrame.doc.write(iframeContents);
          this.myIFrame.doc.close();
        } catch (e) {
          log("frame writing exception");
          if (e.stack) {
            log(e.stack);
          }
          log(e);
        }
      }
    }
    /**
     * Each browser has its own funny way to handle iframes. Here we mush them all together into one object that I can
     * actually use.
     */
    static createIFrame_() {
      const iframe = document.createElement("iframe");
      iframe.style.display = "none";
      if (document.body) {
        document.body.appendChild(iframe);
        try {
          const a = iframe.contentWindow.document;
          if (!a) {
            log("No IE domain setting required");
          }
        } catch (e) {
          const domain = document.domain;
          iframe.src = "javascript:void((function(){document.open();document.domain='" + domain + "';document.close();})())";
        }
      } else {
        throw "Document body has not initialized. Wait to initialize Firebase until after the document is ready.";
      }
      if (iframe.contentDocument) {
        iframe.doc = iframe.contentDocument;
      } else if (iframe.contentWindow) {
        iframe.doc = iframe.contentWindow.document;
      } else if (iframe.document) {
        iframe.doc = iframe.document;
      }
      return iframe;
    }
    /**
     * Cancel all outstanding queries and remove the frame.
     */
    close() {
      this.alive = false;
      if (this.myIFrame) {
        this.myIFrame.doc.body.textContent = "";
        setTimeout(() => {
          if (this.myIFrame !== null) {
            document.body.removeChild(this.myIFrame);
            this.myIFrame = null;
          }
        }, Math.floor(0));
      }
      const onDisconnect = this.onDisconnect;
      if (onDisconnect) {
        this.onDisconnect = null;
        onDisconnect();
      }
    }
    /**
     * Actually start the long-polling session by adding the first script tag(s) to the iframe.
     * @param id - The ID of this connection
     * @param pw - The password for this connection
     */
    startLongPoll(id, pw) {
      this.myID = id;
      this.myPW = pw;
      this.alive = true;
      while (this.newRequest_()) {
      }
    }
    /**
     * This is called any time someone might want a script tag to be added. It adds a script tag when there aren't
     * too many outstanding requests and we are still alive.
     *
     * If there are outstanding packet segments to send, it sends one. If there aren't, it sends a long-poll anyways if
     * needed.
     */
    newRequest_() {
      if (this.alive && this.sendNewPolls && this.outstandingRequests.size < (this.pendingSegs.length > 0 ? 2 : 1)) {
        this.currentSerial++;
        const urlParams = {};
        urlParams[FIREBASE_LONGPOLL_ID_PARAM] = this.myID;
        urlParams[FIREBASE_LONGPOLL_PW_PARAM] = this.myPW;
        urlParams[FIREBASE_LONGPOLL_SERIAL_PARAM] = this.currentSerial;
        let theURL = this.urlFn(urlParams);
        let curDataString = "";
        let i = 0;
        while (this.pendingSegs.length > 0) {
          const nextSeg = this.pendingSegs[0];
          if (nextSeg.d.length + SEG_HEADER_SIZE + curDataString.length <= MAX_URL_DATA_SIZE) {
            const theSeg = this.pendingSegs.shift();
            curDataString = curDataString + "&" + FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM + i + "=" + theSeg.seg + "&" + FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET + i + "=" + theSeg.ts + "&" + FIREBASE_LONGPOLL_DATA_PARAM + i + "=" + theSeg.d;
            i++;
          } else {
            break;
          }
        }
        theURL = theURL + curDataString;
        this.addLongPollTag_(theURL, this.currentSerial);
        return true;
      } else {
        return false;
      }
    }
    /**
     * Queue a packet for transmission to the server.
     * @param segnum - A sequential id for this packet segment used for reassembly
     * @param totalsegs - The total number of segments in this packet
     * @param data - The data for this segment.
     */
    enqueueSegment(segnum, totalsegs, data) {
      this.pendingSegs.push({ seg: segnum, ts: totalsegs, d: data });
      if (this.alive) {
        this.newRequest_();
      }
    }
    /**
     * Add a script tag for a regular long-poll request.
     * @param url - The URL of the script tag.
     * @param serial - The serial number of the request.
     */
    addLongPollTag_(url, serial) {
      this.outstandingRequests.add(serial);
      const doNewRequest = () => {
        this.outstandingRequests.delete(serial);
        this.newRequest_();
      };
      const keepaliveTimeout = setTimeout(doNewRequest, Math.floor(KEEPALIVE_REQUEST_INTERVAL));
      const readyStateCB = () => {
        clearTimeout(keepaliveTimeout);
        doNewRequest();
      };
      this.addTag(url, readyStateCB);
    }
    /**
     * Add an arbitrary script tag to the iframe.
     * @param url - The URL for the script tag source.
     * @param loadCB - A callback to be triggered once the script has loaded.
     */
    addTag(url, loadCB) {
      {
        setTimeout(() => {
          try {
            if (!this.sendNewPolls) {
              return;
            }
            const newScript = this.myIFrame.doc.createElement("script");
            newScript.type = "text/javascript";
            newScript.async = true;
            newScript.src = url;
            newScript.onload = newScript.onreadystatechange = function() {
              const rstate = newScript.readyState;
              if (!rstate || rstate === "loaded" || rstate === "complete") {
                newScript.onload = newScript.onreadystatechange = null;
                if (newScript.parentNode) {
                  newScript.parentNode.removeChild(newScript);
                }
                loadCB();
              }
            };
            newScript.onerror = () => {
              log("Long-poll script failed to load: " + url);
              this.sendNewPolls = false;
              this.close();
            };
            this.myIFrame.doc.body.appendChild(newScript);
          } catch (e) {
          }
        }, Math.floor(1));
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const WEBSOCKET_MAX_FRAME_SIZE = 16384;
  const WEBSOCKET_KEEPALIVE_INTERVAL = 45e3;
  let WebSocketImpl = null;
  if (typeof MozWebSocket !== "undefined") {
    WebSocketImpl = MozWebSocket;
  } else if (typeof WebSocket !== "undefined") {
    WebSocketImpl = WebSocket;
  }
  class WebSocketConnection {
    /**
     * @param connId identifier for this transport
     * @param repoInfo The info for the websocket endpoint.
     * @param applicationId The Firebase App ID for this project.
     * @param appCheckToken The App Check Token for this client.
     * @param authToken The Auth Token for this client.
     * @param transportSessionId Optional transportSessionId if this is connecting
     * to an existing transport session
     * @param lastSessionId Optional lastSessionId if there was a previous
     * connection
     */
    constructor(connId, repoInfo, applicationId, appCheckToken, authToken, transportSessionId, lastSessionId) {
      this.connId = connId;
      this.applicationId = applicationId;
      this.appCheckToken = appCheckToken;
      this.authToken = authToken;
      this.keepaliveTimer = null;
      this.frames = null;
      this.totalFrames = 0;
      this.bytesSent = 0;
      this.bytesReceived = 0;
      this.log_ = logWrapper(this.connId);
      this.stats_ = statsManagerGetCollection(repoInfo);
      this.connURL = WebSocketConnection.connectionURL_(repoInfo, transportSessionId, lastSessionId, appCheckToken, applicationId);
      this.nodeAdmin = repoInfo.nodeAdmin;
    }
    /**
     * @param repoInfo - The info for the websocket endpoint.
     * @param transportSessionId - Optional transportSessionId if this is connecting to an existing transport
     *                                         session
     * @param lastSessionId - Optional lastSessionId if there was a previous connection
     * @returns connection url
     */
    static connectionURL_(repoInfo, transportSessionId, lastSessionId, appCheckToken, applicationId) {
      const urlParams = {};
      urlParams[VERSION_PARAM] = PROTOCOL_VERSION;
      if (typeof location !== "undefined" && location.hostname && FORGE_DOMAIN_RE.test(location.hostname)) {
        urlParams[REFERER_PARAM] = FORGE_REF;
      }
      if (transportSessionId) {
        urlParams[TRANSPORT_SESSION_PARAM] = transportSessionId;
      }
      if (lastSessionId) {
        urlParams[LAST_SESSION_PARAM] = lastSessionId;
      }
      if (appCheckToken) {
        urlParams[APP_CHECK_TOKEN_PARAM] = appCheckToken;
      }
      if (applicationId) {
        urlParams[APPLICATION_ID_PARAM] = applicationId;
      }
      return repoInfoConnectionURL(repoInfo, WEBSOCKET, urlParams);
    }
    /**
     * @param onMessage - Callback when messages arrive
     * @param onDisconnect - Callback with connection lost.
     */
    open(onMessage, onDisconnect) {
      this.onDisconnect = onDisconnect;
      this.onMessage = onMessage;
      this.log_("Websocket connecting to " + this.connURL);
      this.everConnected_ = false;
      PersistentStorage.set("previous_websocket_failure", true);
      try {
        let options;
        if (isNodeSdk()) ;
        this.mySock = new WebSocketImpl(this.connURL, [], options);
      } catch (e) {
        this.log_("Error instantiating WebSocket.");
        const error2 = e.message || e.data;
        if (error2) {
          this.log_(error2);
        }
        this.onClosed_();
        return;
      }
      this.mySock.onopen = () => {
        this.log_("Websocket connected.");
        this.everConnected_ = true;
      };
      this.mySock.onclose = () => {
        this.log_("Websocket connection was disconnected.");
        this.mySock = null;
        this.onClosed_();
      };
      this.mySock.onmessage = (m) => {
        this.handleIncomingFrame(m);
      };
      this.mySock.onerror = (e) => {
        this.log_("WebSocket error.  Closing connection.");
        const error2 = e.message || e.data;
        if (error2) {
          this.log_(error2);
        }
        this.onClosed_();
      };
    }
    /**
     * No-op for websockets, we don't need to do anything once the connection is confirmed as open
     */
    start() {
    }
    static forceDisallow() {
      WebSocketConnection.forceDisallow_ = true;
    }
    static isAvailable() {
      let isOldAndroid = false;
      if (typeof navigator !== "undefined" && navigator.userAgent) {
        const oldAndroidRegex = /Android ([0-9]{0,}\.[0-9]{0,})/;
        const oldAndroidMatch = navigator.userAgent.match(oldAndroidRegex);
        if (oldAndroidMatch && oldAndroidMatch.length > 1) {
          if (parseFloat(oldAndroidMatch[1]) < 4.4) {
            isOldAndroid = true;
          }
        }
      }
      return !isOldAndroid && WebSocketImpl !== null && !WebSocketConnection.forceDisallow_;
    }
    /**
     * Returns true if we previously failed to connect with this transport.
     */
    static previouslyFailed() {
      return PersistentStorage.isInMemoryStorage || PersistentStorage.get("previous_websocket_failure") === true;
    }
    markConnectionHealthy() {
      PersistentStorage.remove("previous_websocket_failure");
    }
    appendFrame_(data) {
      this.frames.push(data);
      if (this.frames.length === this.totalFrames) {
        const fullMess = this.frames.join("");
        this.frames = null;
        const jsonMess = jsonEval(fullMess);
        this.onMessage(jsonMess);
      }
    }
    /**
     * @param frameCount - The number of frames we are expecting from the server
     */
    handleNewFrameCount_(frameCount) {
      this.totalFrames = frameCount;
      this.frames = [];
    }
    /**
     * Attempts to parse a frame count out of some text. If it can't, assumes a value of 1
     * @returns Any remaining data to be process, or null if there is none
     */
    extractFrameCount_(data) {
      assert(this.frames === null, "We already have a frame buffer");
      if (data.length <= 6) {
        const frameCount = Number(data);
        if (!isNaN(frameCount)) {
          this.handleNewFrameCount_(frameCount);
          return null;
        }
      }
      this.handleNewFrameCount_(1);
      return data;
    }
    /**
     * Process a websocket frame that has arrived from the server.
     * @param mess - The frame data
     */
    handleIncomingFrame(mess) {
      if (this.mySock === null) {
        return;
      }
      const data = mess["data"];
      this.bytesReceived += data.length;
      this.stats_.incrementCounter("bytes_received", data.length);
      this.resetKeepAlive();
      if (this.frames !== null) {
        this.appendFrame_(data);
      } else {
        const remainingData = this.extractFrameCount_(data);
        if (remainingData !== null) {
          this.appendFrame_(remainingData);
        }
      }
    }
    /**
     * Send a message to the server
     * @param data - The JSON object to transmit
     */
    send(data) {
      this.resetKeepAlive();
      const dataStr = stringify(data);
      this.bytesSent += dataStr.length;
      this.stats_.incrementCounter("bytes_sent", dataStr.length);
      const dataSegs = splitStringBySize(dataStr, WEBSOCKET_MAX_FRAME_SIZE);
      if (dataSegs.length > 1) {
        this.sendString_(String(dataSegs.length));
      }
      for (let i = 0; i < dataSegs.length; i++) {
        this.sendString_(dataSegs[i]);
      }
    }
    shutdown_() {
      this.isClosed_ = true;
      if (this.keepaliveTimer) {
        clearInterval(this.keepaliveTimer);
        this.keepaliveTimer = null;
      }
      if (this.mySock) {
        this.mySock.close();
        this.mySock = null;
      }
    }
    onClosed_() {
      if (!this.isClosed_) {
        this.log_("WebSocket is closing itself");
        this.shutdown_();
        if (this.onDisconnect) {
          this.onDisconnect(this.everConnected_);
          this.onDisconnect = null;
        }
      }
    }
    /**
     * External-facing close handler.
     * Close the websocket and kill the connection.
     */
    close() {
      if (!this.isClosed_) {
        this.log_("WebSocket is being closed");
        this.shutdown_();
      }
    }
    /**
     * Kill the current keepalive timer and start a new one, to ensure that it always fires N seconds after
     * the last activity.
     */
    resetKeepAlive() {
      clearInterval(this.keepaliveTimer);
      this.keepaliveTimer = setInterval(() => {
        if (this.mySock) {
          this.sendString_("0");
        }
        this.resetKeepAlive();
      }, Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL));
    }
    /**
     * Send a string over the websocket.
     *
     * @param str - String to send.
     */
    sendString_(str) {
      try {
        this.mySock.send(str);
      } catch (e) {
        this.log_("Exception thrown from WebSocket.send():", e.message || e.data, "Closing connection.");
        setTimeout(this.onClosed_.bind(this), 0);
      }
    }
  }
  WebSocketConnection.responsesRequiredToBeHealthy = 2;
  WebSocketConnection.healthyTimeout = 3e4;
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class TransportManager {
    static get ALL_TRANSPORTS() {
      return [BrowserPollConnection, WebSocketConnection];
    }
    /**
     * Returns whether transport has been selected to ensure WebSocketConnection or BrowserPollConnection are not called after
     * TransportManager has already set up transports_
     */
    static get IS_TRANSPORT_INITIALIZED() {
      return this.globalTransportInitialized_;
    }
    /**
     * @param repoInfo - Metadata around the namespace we're connecting to
     */
    constructor(repoInfo) {
      this.initTransports_(repoInfo);
    }
    initTransports_(repoInfo) {
      const isWebSocketsAvailable = WebSocketConnection && WebSocketConnection["isAvailable"]();
      let isSkipPollConnection = isWebSocketsAvailable && !WebSocketConnection.previouslyFailed();
      if (repoInfo.webSocketOnly) {
        if (!isWebSocketsAvailable) {
          warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway.");
        }
        isSkipPollConnection = true;
      }
      if (isSkipPollConnection) {
        this.transports_ = [WebSocketConnection];
      } else {
        const transports = this.transports_ = [];
        for (const transport of TransportManager.ALL_TRANSPORTS) {
          if (transport && transport["isAvailable"]()) {
            transports.push(transport);
          }
        }
        TransportManager.globalTransportInitialized_ = true;
      }
    }
    /**
     * @returns The constructor for the initial transport to use
     */
    initialTransport() {
      if (this.transports_.length > 0) {
        return this.transports_[0];
      } else {
        throw new Error("No transports available");
      }
    }
    /**
     * @returns The constructor for the next transport, or null
     */
    upgradeTransport() {
      if (this.transports_.length > 1) {
        return this.transports_[1];
      } else {
        return null;
      }
    }
  }
  TransportManager.globalTransportInitialized_ = false;
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const UPGRADE_TIMEOUT = 6e4;
  const DELAY_BEFORE_SENDING_EXTRA_REQUESTS = 5e3;
  const BYTES_SENT_HEALTHY_OVERRIDE = 10 * 1024;
  const BYTES_RECEIVED_HEALTHY_OVERRIDE = 100 * 1024;
  const MESSAGE_TYPE = "t";
  const MESSAGE_DATA = "d";
  const CONTROL_SHUTDOWN = "s";
  const CONTROL_RESET = "r";
  const CONTROL_ERROR = "e";
  const CONTROL_PONG = "o";
  const SWITCH_ACK = "a";
  const END_TRANSMISSION = "n";
  const PING = "p";
  const SERVER_HELLO = "h";
  class Connection {
    /**
     * @param id - an id for this connection
     * @param repoInfo_ - the info for the endpoint to connect to
     * @param applicationId_ - the Firebase App ID for this project
     * @param appCheckToken_ - The App Check Token for this device.
     * @param authToken_ - The auth token for this session.
     * @param onMessage_ - the callback to be triggered when a server-push message arrives
     * @param onReady_ - the callback to be triggered when this connection is ready to send messages.
     * @param onDisconnect_ - the callback to be triggered when a connection was lost
     * @param onKill_ - the callback to be triggered when this connection has permanently shut down.
     * @param lastSessionId - last session id in persistent connection. is used to clean up old session in real-time server
     */
    constructor(id, repoInfo_, applicationId_, appCheckToken_, authToken_, onMessage_, onReady_, onDisconnect_, onKill_, lastSessionId) {
      this.id = id;
      this.repoInfo_ = repoInfo_;
      this.applicationId_ = applicationId_;
      this.appCheckToken_ = appCheckToken_;
      this.authToken_ = authToken_;
      this.onMessage_ = onMessage_;
      this.onReady_ = onReady_;
      this.onDisconnect_ = onDisconnect_;
      this.onKill_ = onKill_;
      this.lastSessionId = lastSessionId;
      this.connectionCount = 0;
      this.pendingDataMessages = [];
      this.state_ = 0;
      this.log_ = logWrapper("c:" + this.id + ":");
      this.transportManager_ = new TransportManager(repoInfo_);
      this.log_("Connection created");
      this.start_();
    }
    /**
     * Starts a connection attempt
     */
    start_() {
      const conn = this.transportManager_.initialTransport();
      this.conn_ = new conn(this.nextTransportId_(), this.repoInfo_, this.applicationId_, this.appCheckToken_, this.authToken_, null, this.lastSessionId);
      this.primaryResponsesRequired_ = conn["responsesRequiredToBeHealthy"] || 0;
      const onMessageReceived = this.connReceiver_(this.conn_);
      const onConnectionLost = this.disconnReceiver_(this.conn_);
      this.tx_ = this.conn_;
      this.rx_ = this.conn_;
      this.secondaryConn_ = null;
      this.isHealthy_ = false;
      setTimeout(() => {
        this.conn_ && this.conn_.open(onMessageReceived, onConnectionLost);
      }, Math.floor(0));
      const healthyTimeoutMS = conn["healthyTimeout"] || 0;
      if (healthyTimeoutMS > 0) {
        this.healthyTimeout_ = setTimeoutNonBlocking(() => {
          this.healthyTimeout_ = null;
          if (!this.isHealthy_) {
            if (this.conn_ && this.conn_.bytesReceived > BYTES_RECEIVED_HEALTHY_OVERRIDE) {
              this.log_("Connection exceeded healthy timeout but has received " + this.conn_.bytesReceived + " bytes.  Marking connection healthy.");
              this.isHealthy_ = true;
              this.conn_.markConnectionHealthy();
            } else if (this.conn_ && this.conn_.bytesSent > BYTES_SENT_HEALTHY_OVERRIDE) {
              this.log_("Connection exceeded healthy timeout but has sent " + this.conn_.bytesSent + " bytes.  Leaving connection alive.");
            } else {
              this.log_("Closing unhealthy connection after timeout.");
              this.close();
            }
          }
        }, Math.floor(healthyTimeoutMS));
      }
    }
    nextTransportId_() {
      return "c:" + this.id + ":" + this.connectionCount++;
    }
    disconnReceiver_(conn) {
      return (everConnected) => {
        if (conn === this.conn_) {
          this.onConnectionLost_(everConnected);
        } else if (conn === this.secondaryConn_) {
          this.log_("Secondary connection lost.");
          this.onSecondaryConnectionLost_();
        } else {
          this.log_("closing an old connection");
        }
      };
    }
    connReceiver_(conn) {
      return (message) => {
        if (this.state_ !== 2) {
          if (conn === this.rx_) {
            this.onPrimaryMessageReceived_(message);
          } else if (conn === this.secondaryConn_) {
            this.onSecondaryMessageReceived_(message);
          } else {
            this.log_("message on old connection");
          }
        }
      };
    }
    /**
     * @param dataMsg - An arbitrary data message to be sent to the server
     */
    sendRequest(dataMsg) {
      const msg = { t: "d", d: dataMsg };
      this.sendData_(msg);
    }
    tryCleanupConnection() {
      if (this.tx_ === this.secondaryConn_ && this.rx_ === this.secondaryConn_) {
        this.log_("cleaning up and promoting a connection: " + this.secondaryConn_.connId);
        this.conn_ = this.secondaryConn_;
        this.secondaryConn_ = null;
      }
    }
    onSecondaryControl_(controlData) {
      if (MESSAGE_TYPE in controlData) {
        const cmd = controlData[MESSAGE_TYPE];
        if (cmd === SWITCH_ACK) {
          this.upgradeIfSecondaryHealthy_();
        } else if (cmd === CONTROL_RESET) {
          this.log_("Got a reset on secondary, closing it");
          this.secondaryConn_.close();
          if (this.tx_ === this.secondaryConn_ || this.rx_ === this.secondaryConn_) {
            this.close();
          }
        } else if (cmd === CONTROL_PONG) {
          this.log_("got pong on secondary.");
          this.secondaryResponsesRequired_--;
          this.upgradeIfSecondaryHealthy_();
        }
      }
    }
    onSecondaryMessageReceived_(parsedData) {
      const layer = requireKey("t", parsedData);
      const data = requireKey("d", parsedData);
      if (layer === "c") {
        this.onSecondaryControl_(data);
      } else if (layer === "d") {
        this.pendingDataMessages.push(data);
      } else {
        throw new Error("Unknown protocol layer: " + layer);
      }
    }
    upgradeIfSecondaryHealthy_() {
      if (this.secondaryResponsesRequired_ <= 0) {
        this.log_("Secondary connection is healthy.");
        this.isHealthy_ = true;
        this.secondaryConn_.markConnectionHealthy();
        this.proceedWithUpgrade_();
      } else {
        this.log_("sending ping on secondary.");
        this.secondaryConn_.send({ t: "c", d: { t: PING, d: {} } });
      }
    }
    proceedWithUpgrade_() {
      this.secondaryConn_.start();
      this.log_("sending client ack on secondary");
      this.secondaryConn_.send({ t: "c", d: { t: SWITCH_ACK, d: {} } });
      this.log_("Ending transmission on primary");
      this.conn_.send({ t: "c", d: { t: END_TRANSMISSION, d: {} } });
      this.tx_ = this.secondaryConn_;
      this.tryCleanupConnection();
    }
    onPrimaryMessageReceived_(parsedData) {
      const layer = requireKey("t", parsedData);
      const data = requireKey("d", parsedData);
      if (layer === "c") {
        this.onControl_(data);
      } else if (layer === "d") {
        this.onDataMessage_(data);
      }
    }
    onDataMessage_(message) {
      this.onPrimaryResponse_();
      this.onMessage_(message);
    }
    onPrimaryResponse_() {
      if (!this.isHealthy_) {
        this.primaryResponsesRequired_--;
        if (this.primaryResponsesRequired_ <= 0) {
          this.log_("Primary connection is healthy.");
          this.isHealthy_ = true;
          this.conn_.markConnectionHealthy();
        }
      }
    }
    onControl_(controlData) {
      const cmd = requireKey(MESSAGE_TYPE, controlData);
      if (MESSAGE_DATA in controlData) {
        const payload = controlData[MESSAGE_DATA];
        if (cmd === SERVER_HELLO) {
          const handshakePayload = Object.assign({}, payload);
          if (this.repoInfo_.isUsingEmulator) {
            handshakePayload.h = this.repoInfo_.host;
          }
          this.onHandshake_(handshakePayload);
        } else if (cmd === END_TRANSMISSION) {
          this.log_("recvd end transmission on primary");
          this.rx_ = this.secondaryConn_;
          for (let i = 0; i < this.pendingDataMessages.length; ++i) {
            this.onDataMessage_(this.pendingDataMessages[i]);
          }
          this.pendingDataMessages = [];
          this.tryCleanupConnection();
        } else if (cmd === CONTROL_SHUTDOWN) {
          this.onConnectionShutdown_(payload);
        } else if (cmd === CONTROL_RESET) {
          this.onReset_(payload);
        } else if (cmd === CONTROL_ERROR) {
          error("Server Error: " + payload);
        } else if (cmd === CONTROL_PONG) {
          this.log_("got pong on primary.");
          this.onPrimaryResponse_();
          this.sendPingOnPrimaryIfNecessary_();
        } else {
          error("Unknown control packet command: " + cmd);
        }
      }
    }
    /**
     * @param handshake - The handshake data returned from the server
     */
    onHandshake_(handshake) {
      const timestamp = handshake.ts;
      const version2 = handshake.v;
      const host = handshake.h;
      this.sessionId = handshake.s;
      this.repoInfo_.host = host;
      if (this.state_ === 0) {
        this.conn_.start();
        this.onConnectionEstablished_(this.conn_, timestamp);
        if (PROTOCOL_VERSION !== version2) {
          warn("Protocol version mismatch detected");
        }
        this.tryStartUpgrade_();
      }
    }
    tryStartUpgrade_() {
      const conn = this.transportManager_.upgradeTransport();
      if (conn) {
        this.startUpgrade_(conn);
      }
    }
    startUpgrade_(conn) {
      this.secondaryConn_ = new conn(this.nextTransportId_(), this.repoInfo_, this.applicationId_, this.appCheckToken_, this.authToken_, this.sessionId);
      this.secondaryResponsesRequired_ = conn["responsesRequiredToBeHealthy"] || 0;
      const onMessage = this.connReceiver_(this.secondaryConn_);
      const onDisconnect = this.disconnReceiver_(this.secondaryConn_);
      this.secondaryConn_.open(onMessage, onDisconnect);
      setTimeoutNonBlocking(() => {
        if (this.secondaryConn_) {
          this.log_("Timed out trying to upgrade.");
          this.secondaryConn_.close();
        }
      }, Math.floor(UPGRADE_TIMEOUT));
    }
    onReset_(host) {
      this.log_("Reset packet received.  New host: " + host);
      this.repoInfo_.host = host;
      if (this.state_ === 1) {
        this.close();
      } else {
        this.closeConnections_();
        this.start_();
      }
    }
    onConnectionEstablished_(conn, timestamp) {
      this.log_("Realtime connection established.");
      this.conn_ = conn;
      this.state_ = 1;
      if (this.onReady_) {
        this.onReady_(timestamp, this.sessionId);
        this.onReady_ = null;
      }
      if (this.primaryResponsesRequired_ === 0) {
        this.log_("Primary connection is healthy.");
        this.isHealthy_ = true;
      } else {
        setTimeoutNonBlocking(() => {
          this.sendPingOnPrimaryIfNecessary_();
        }, Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS));
      }
    }
    sendPingOnPrimaryIfNecessary_() {
      if (!this.isHealthy_ && this.state_ === 1) {
        this.log_("sending ping on primary.");
        this.sendData_({ t: "c", d: { t: PING, d: {} } });
      }
    }
    onSecondaryConnectionLost_() {
      const conn = this.secondaryConn_;
      this.secondaryConn_ = null;
      if (this.tx_ === conn || this.rx_ === conn) {
        this.close();
      }
    }
    /**
     * @param everConnected - Whether or not the connection ever reached a server. Used to determine if
     * we should flush the host cache
     */
    onConnectionLost_(everConnected) {
      this.conn_ = null;
      if (!everConnected && this.state_ === 0) {
        this.log_("Realtime connection failed.");
        if (this.repoInfo_.isCacheableHost()) {
          PersistentStorage.remove("host:" + this.repoInfo_.host);
          this.repoInfo_.internalHost = this.repoInfo_.host;
        }
      } else if (this.state_ === 1) {
        this.log_("Realtime connection lost.");
      }
      this.close();
    }
    onConnectionShutdown_(reason) {
      this.log_("Connection shutdown command received. Shutting down...");
      if (this.onKill_) {
        this.onKill_(reason);
        this.onKill_ = null;
      }
      this.onDisconnect_ = null;
      this.close();
    }
    sendData_(data) {
      if (this.state_ !== 1) {
        throw "Connection is not connected";
      } else {
        this.tx_.send(data);
      }
    }
    /**
     * Cleans up this connection, calling the appropriate callbacks
     */
    close() {
      if (this.state_ !== 2) {
        this.log_("Closing realtime connection.");
        this.state_ = 2;
        this.closeConnections_();
        if (this.onDisconnect_) {
          this.onDisconnect_();
          this.onDisconnect_ = null;
        }
      }
    }
    closeConnections_() {
      this.log_("Shutting down all connections");
      if (this.conn_) {
        this.conn_.close();
        this.conn_ = null;
      }
      if (this.secondaryConn_) {
        this.secondaryConn_.close();
        this.secondaryConn_ = null;
      }
      if (this.healthyTimeout_) {
        clearTimeout(this.healthyTimeout_);
        this.healthyTimeout_ = null;
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ServerActions {
    put(pathString, data, onComplete, hash) {
    }
    merge(pathString, data, onComplete, hash) {
    }
    /**
     * Refreshes the auth token for the current connection.
     * @param token - The authentication token
     */
    refreshAuthToken(token) {
    }
    /**
     * Refreshes the app check token for the current connection.
     * @param token The app check token
     */
    refreshAppCheckToken(token) {
    }
    onDisconnectPut(pathString, data, onComplete) {
    }
    onDisconnectMerge(pathString, data, onComplete) {
    }
    onDisconnectCancel(pathString, onComplete) {
    }
    reportStats(stats) {
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class EventEmitter {
    constructor(allowedEvents_) {
      this.allowedEvents_ = allowedEvents_;
      this.listeners_ = {};
      assert(Array.isArray(allowedEvents_) && allowedEvents_.length > 0, "Requires a non-empty array");
    }
    /**
     * To be called by derived classes to trigger events.
     */
    trigger(eventType, ...varArgs) {
      if (Array.isArray(this.listeners_[eventType])) {
        const listeners = [...this.listeners_[eventType]];
        for (let i = 0; i < listeners.length; i++) {
          listeners[i].callback.apply(listeners[i].context, varArgs);
        }
      }
    }
    on(eventType, callback, context) {
      this.validateEventType_(eventType);
      this.listeners_[eventType] = this.listeners_[eventType] || [];
      this.listeners_[eventType].push({ callback, context });
      const eventData = this.getInitialEvent(eventType);
      if (eventData) {
        callback.apply(context, eventData);
      }
    }
    off(eventType, callback, context) {
      this.validateEventType_(eventType);
      const listeners = this.listeners_[eventType] || [];
      for (let i = 0; i < listeners.length; i++) {
        if (listeners[i].callback === callback && (!context || context === listeners[i].context)) {
          listeners.splice(i, 1);
          return;
        }
      }
    }
    validateEventType_(eventType) {
      assert(this.allowedEvents_.find((et) => {
        return et === eventType;
      }), "Unknown event: " + eventType);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class OnlineMonitor extends EventEmitter {
    static getInstance() {
      return new OnlineMonitor();
    }
    constructor() {
      super(["online"]);
      this.online_ = true;
      if (typeof window !== "undefined" && typeof window.addEventListener !== "undefined" && !isMobileCordova()) {
        window.addEventListener("online", () => {
          if (!this.online_) {
            this.online_ = true;
            this.trigger("online", true);
          }
        }, false);
        window.addEventListener("offline", () => {
          if (this.online_) {
            this.online_ = false;
            this.trigger("online", false);
          }
        }, false);
      }
    }
    getInitialEvent(eventType) {
      assert(eventType === "online", "Unknown event type: " + eventType);
      return [this.online_];
    }
    currentlyOnline() {
      return this.online_;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const MAX_PATH_DEPTH = 32;
  const MAX_PATH_LENGTH_BYTES = 768;
  class Path {
    /**
     * @param pathOrString - Path string to parse, or another path, or the raw
     * tokens array
     */
    constructor(pathOrString, pieceNum) {
      if (pieceNum === void 0) {
        this.pieces_ = pathOrString.split("/");
        let copyTo = 0;
        for (let i = 0; i < this.pieces_.length; i++) {
          if (this.pieces_[i].length > 0) {
            this.pieces_[copyTo] = this.pieces_[i];
            copyTo++;
          }
        }
        this.pieces_.length = copyTo;
        this.pieceNum_ = 0;
      } else {
        this.pieces_ = pathOrString;
        this.pieceNum_ = pieceNum;
      }
    }
    toString() {
      let pathString = "";
      for (let i = this.pieceNum_; i < this.pieces_.length; i++) {
        if (this.pieces_[i] !== "") {
          pathString += "/" + this.pieces_[i];
        }
      }
      return pathString || "/";
    }
  }
  function newEmptyPath() {
    return new Path("");
  }
  function pathGetFront(path) {
    if (path.pieceNum_ >= path.pieces_.length) {
      return null;
    }
    return path.pieces_[path.pieceNum_];
  }
  function pathGetLength(path) {
    return path.pieces_.length - path.pieceNum_;
  }
  function pathPopFront(path) {
    let pieceNum = path.pieceNum_;
    if (pieceNum < path.pieces_.length) {
      pieceNum++;
    }
    return new Path(path.pieces_, pieceNum);
  }
  function pathGetBack(path) {
    if (path.pieceNum_ < path.pieces_.length) {
      return path.pieces_[path.pieces_.length - 1];
    }
    return null;
  }
  function pathToUrlEncodedString(path) {
    let pathString = "";
    for (let i = path.pieceNum_; i < path.pieces_.length; i++) {
      if (path.pieces_[i] !== "") {
        pathString += "/" + encodeURIComponent(String(path.pieces_[i]));
      }
    }
    return pathString || "/";
  }
  function pathSlice(path, begin = 0) {
    return path.pieces_.slice(path.pieceNum_ + begin);
  }
  function pathParent(path) {
    if (path.pieceNum_ >= path.pieces_.length) {
      return null;
    }
    const pieces = [];
    for (let i = path.pieceNum_; i < path.pieces_.length - 1; i++) {
      pieces.push(path.pieces_[i]);
    }
    return new Path(pieces, 0);
  }
  function pathChild(path, childPathObj) {
    const pieces = [];
    for (let i = path.pieceNum_; i < path.pieces_.length; i++) {
      pieces.push(path.pieces_[i]);
    }
    if (childPathObj instanceof Path) {
      for (let i = childPathObj.pieceNum_; i < childPathObj.pieces_.length; i++) {
        pieces.push(childPathObj.pieces_[i]);
      }
    } else {
      const childPieces = childPathObj.split("/");
      for (let i = 0; i < childPieces.length; i++) {
        if (childPieces[i].length > 0) {
          pieces.push(childPieces[i]);
        }
      }
    }
    return new Path(pieces, 0);
  }
  function pathIsEmpty(path) {
    return path.pieceNum_ >= path.pieces_.length;
  }
  function newRelativePath(outerPath, innerPath) {
    const outer = pathGetFront(outerPath), inner = pathGetFront(innerPath);
    if (outer === null) {
      return innerPath;
    } else if (outer === inner) {
      return newRelativePath(pathPopFront(outerPath), pathPopFront(innerPath));
    } else {
      throw new Error("INTERNAL ERROR: innerPath (" + innerPath + ") is not within outerPath (" + outerPath + ")");
    }
  }
  function pathEquals(path, other) {
    if (pathGetLength(path) !== pathGetLength(other)) {
      return false;
    }
    for (let i = path.pieceNum_, j = other.pieceNum_; i <= path.pieces_.length; i++, j++) {
      if (path.pieces_[i] !== other.pieces_[j]) {
        return false;
      }
    }
    return true;
  }
  function pathContains(path, other) {
    let i = path.pieceNum_;
    let j = other.pieceNum_;
    if (pathGetLength(path) > pathGetLength(other)) {
      return false;
    }
    while (i < path.pieces_.length) {
      if (path.pieces_[i] !== other.pieces_[j]) {
        return false;
      }
      ++i;
      ++j;
    }
    return true;
  }
  class ValidationPath {
    /**
     * @param path - Initial Path.
     * @param errorPrefix_ - Prefix for any error messages.
     */
    constructor(path, errorPrefix_) {
      this.errorPrefix_ = errorPrefix_;
      this.parts_ = pathSlice(path, 0);
      this.byteLength_ = Math.max(1, this.parts_.length);
      for (let i = 0; i < this.parts_.length; i++) {
        this.byteLength_ += stringLength(this.parts_[i]);
      }
      validationPathCheckValid(this);
    }
  }
  function validationPathPush(validationPath, child) {
    if (validationPath.parts_.length > 0) {
      validationPath.byteLength_ += 1;
    }
    validationPath.parts_.push(child);
    validationPath.byteLength_ += stringLength(child);
    validationPathCheckValid(validationPath);
  }
  function validationPathPop(validationPath) {
    const last = validationPath.parts_.pop();
    validationPath.byteLength_ -= stringLength(last);
    if (validationPath.parts_.length > 0) {
      validationPath.byteLength_ -= 1;
    }
  }
  function validationPathCheckValid(validationPath) {
    if (validationPath.byteLength_ > MAX_PATH_LENGTH_BYTES) {
      throw new Error(validationPath.errorPrefix_ + "has a key path longer than " + MAX_PATH_LENGTH_BYTES + " bytes (" + validationPath.byteLength_ + ").");
    }
    if (validationPath.parts_.length > MAX_PATH_DEPTH) {
      throw new Error(validationPath.errorPrefix_ + "path specified exceeds the maximum depth that can be written (" + MAX_PATH_DEPTH + ") or object contains a cycle " + validationPathToErrorString(validationPath));
    }
  }
  function validationPathToErrorString(validationPath) {
    if (validationPath.parts_.length === 0) {
      return "";
    }
    return "in property '" + validationPath.parts_.join(".") + "'";
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class VisibilityMonitor extends EventEmitter {
    static getInstance() {
      return new VisibilityMonitor();
    }
    constructor() {
      super(["visible"]);
      let hidden;
      let visibilityChange;
      if (typeof document !== "undefined" && typeof document.addEventListener !== "undefined") {
        if (typeof document["hidden"] !== "undefined") {
          visibilityChange = "visibilitychange";
          hidden = "hidden";
        } else if (typeof document["mozHidden"] !== "undefined") {
          visibilityChange = "mozvisibilitychange";
          hidden = "mozHidden";
        } else if (typeof document["msHidden"] !== "undefined") {
          visibilityChange = "msvisibilitychange";
          hidden = "msHidden";
        } else if (typeof document["webkitHidden"] !== "undefined") {
          visibilityChange = "webkitvisibilitychange";
          hidden = "webkitHidden";
        }
      }
      this.visible_ = true;
      if (visibilityChange) {
        document.addEventListener(visibilityChange, () => {
          const visible = !document[hidden];
          if (visible !== this.visible_) {
            this.visible_ = visible;
            this.trigger("visible", visible);
          }
        }, false);
      }
    }
    getInitialEvent(eventType) {
      assert(eventType === "visible", "Unknown event type: " + eventType);
      return [this.visible_];
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const RECONNECT_MIN_DELAY = 1e3;
  const RECONNECT_MAX_DELAY_DEFAULT = 60 * 5 * 1e3;
  const RECONNECT_MAX_DELAY_FOR_ADMINS = 30 * 1e3;
  const RECONNECT_DELAY_MULTIPLIER = 1.3;
  const RECONNECT_DELAY_RESET_TIMEOUT = 3e4;
  const SERVER_KILL_INTERRUPT_REASON = "server_kill";
  const INVALID_TOKEN_THRESHOLD = 3;
  class PersistentConnection extends ServerActions {
    /**
     * @param repoInfo_ - Data about the namespace we are connecting to
     * @param applicationId_ - The Firebase App ID for this project
     * @param onDataUpdate_ - A callback for new data from the server
     */
    constructor(repoInfo_, applicationId_, onDataUpdate_, onConnectStatus_, onServerInfoUpdate_, authTokenProvider_, appCheckTokenProvider_, authOverride_) {
      super();
      this.repoInfo_ = repoInfo_;
      this.applicationId_ = applicationId_;
      this.onDataUpdate_ = onDataUpdate_;
      this.onConnectStatus_ = onConnectStatus_;
      this.onServerInfoUpdate_ = onServerInfoUpdate_;
      this.authTokenProvider_ = authTokenProvider_;
      this.appCheckTokenProvider_ = appCheckTokenProvider_;
      this.authOverride_ = authOverride_;
      this.id = PersistentConnection.nextPersistentConnectionId_++;
      this.log_ = logWrapper("p:" + this.id + ":");
      this.interruptReasons_ = {};
      this.listens = /* @__PURE__ */ new Map();
      this.outstandingPuts_ = [];
      this.outstandingGets_ = [];
      this.outstandingPutCount_ = 0;
      this.outstandingGetCount_ = 0;
      this.onDisconnectRequestQueue_ = [];
      this.connected_ = false;
      this.reconnectDelay_ = RECONNECT_MIN_DELAY;
      this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_DEFAULT;
      this.securityDebugCallback_ = null;
      this.lastSessionId = null;
      this.establishConnectionTimer_ = null;
      this.visible_ = false;
      this.requestCBHash_ = {};
      this.requestNumber_ = 0;
      this.realtime_ = null;
      this.authToken_ = null;
      this.appCheckToken_ = null;
      this.forceTokenRefresh_ = false;
      this.invalidAuthTokenCount_ = 0;
      this.invalidAppCheckTokenCount_ = 0;
      this.firstConnection_ = true;
      this.lastConnectionAttemptTime_ = null;
      this.lastConnectionEstablishedTime_ = null;
      if (authOverride_ && true) {
        throw new Error("Auth override specified in options, but not supported on non Node.js platforms");
      }
      VisibilityMonitor.getInstance().on("visible", this.onVisible_, this);
      if (repoInfo_.host.indexOf("fblocal") === -1) {
        OnlineMonitor.getInstance().on("online", this.onOnline_, this);
      }
    }
    sendRequest(action, body, onResponse) {
      const curReqNum = ++this.requestNumber_;
      const msg = { r: curReqNum, a: action, b: body };
      this.log_(stringify(msg));
      assert(this.connected_, "sendRequest call when we're not connected not allowed.");
      this.realtime_.sendRequest(msg);
      if (onResponse) {
        this.requestCBHash_[curReqNum] = onResponse;
      }
    }
    get(query) {
      this.initConnection_();
      const deferred = new Deferred();
      const request = {
        p: query._path.toString(),
        q: query._queryObject
      };
      const outstandingGet = {
        action: "g",
        request,
        onComplete: (message) => {
          const payload = message["d"];
          if (message["s"] === "ok") {
            deferred.resolve(payload);
          } else {
            deferred.reject(payload);
          }
        }
      };
      this.outstandingGets_.push(outstandingGet);
      this.outstandingGetCount_++;
      const index = this.outstandingGets_.length - 1;
      if (this.connected_) {
        this.sendGet_(index);
      }
      return deferred.promise;
    }
    listen(query, currentHashFn, tag, onComplete) {
      this.initConnection_();
      const queryId = query._queryIdentifier;
      const pathString = query._path.toString();
      this.log_("Listen called for " + pathString + " " + queryId);
      if (!this.listens.has(pathString)) {
        this.listens.set(pathString, /* @__PURE__ */ new Map());
      }
      assert(query._queryParams.isDefault() || !query._queryParams.loadsAllData(), "listen() called for non-default but complete query");
      assert(!this.listens.get(pathString).has(queryId), `listen() called twice for same path/queryId.`);
      const listenSpec = {
        onComplete,
        hashFn: currentHashFn,
        query,
        tag
      };
      this.listens.get(pathString).set(queryId, listenSpec);
      if (this.connected_) {
        this.sendListen_(listenSpec);
      }
    }
    sendGet_(index) {
      const get = this.outstandingGets_[index];
      this.sendRequest("g", get.request, (message) => {
        delete this.outstandingGets_[index];
        this.outstandingGetCount_--;
        if (this.outstandingGetCount_ === 0) {
          this.outstandingGets_ = [];
        }
        if (get.onComplete) {
          get.onComplete(message);
        }
      });
    }
    sendListen_(listenSpec) {
      const query = listenSpec.query;
      const pathString = query._path.toString();
      const queryId = query._queryIdentifier;
      this.log_("Listen on " + pathString + " for " + queryId);
      const req = {
        /*path*/
        p: pathString
      };
      const action = "q";
      if (listenSpec.tag) {
        req["q"] = query._queryObject;
        req["t"] = listenSpec.tag;
      }
      req[
        /*hash*/
        "h"
      ] = listenSpec.hashFn();
      this.sendRequest(action, req, (message) => {
        const payload = message[
          /*data*/
          "d"
        ];
        const status = message[
          /*status*/
          "s"
        ];
        PersistentConnection.warnOnListenWarnings_(payload, query);
        const currentListenSpec = this.listens.get(pathString) && this.listens.get(pathString).get(queryId);
        if (currentListenSpec === listenSpec) {
          this.log_("listen response", message);
          if (status !== "ok") {
            this.removeListen_(pathString, queryId);
          }
          if (listenSpec.onComplete) {
            listenSpec.onComplete(status, payload);
          }
        }
      });
    }
    static warnOnListenWarnings_(payload, query) {
      if (payload && typeof payload === "object" && contains(payload, "w")) {
        const warnings = safeGet(payload, "w");
        if (Array.isArray(warnings) && ~warnings.indexOf("no_index")) {
          const indexSpec = '".indexOn": "' + query._queryParams.getIndex().toString() + '"';
          const indexPath = query._path.toString();
          warn(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${indexSpec} at ${indexPath} to your security rules for better performance.`);
        }
      }
    }
    refreshAuthToken(token) {
      this.authToken_ = token;
      this.log_("Auth token refreshed");
      if (this.authToken_) {
        this.tryAuth();
      } else {
        if (this.connected_) {
          this.sendRequest("unauth", {}, () => {
          });
        }
      }
      this.reduceReconnectDelayIfAdminCredential_(token);
    }
    reduceReconnectDelayIfAdminCredential_(credential) {
      const isFirebaseSecret = credential && credential.length === 40;
      if (isFirebaseSecret || isAdmin(credential)) {
        this.log_("Admin auth credential detected.  Reducing max reconnect time.");
        this.maxReconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;
      }
    }
    refreshAppCheckToken(token) {
      this.appCheckToken_ = token;
      this.log_("App check token refreshed");
      if (this.appCheckToken_) {
        this.tryAppCheck();
      } else {
        if (this.connected_) {
          this.sendRequest("unappeck", {}, () => {
          });
        }
      }
    }
    /**
     * Attempts to authenticate with the given credentials. If the authentication attempt fails, it's triggered like
     * a auth revoked (the connection is closed).
     */
    tryAuth() {
      if (this.connected_ && this.authToken_) {
        const token = this.authToken_;
        const authMethod = isValidFormat(token) ? "auth" : "gauth";
        const requestData = { cred: token };
        if (this.authOverride_ === null) {
          requestData["noauth"] = true;
        } else if (typeof this.authOverride_ === "object") {
          requestData["authvar"] = this.authOverride_;
        }
        this.sendRequest(authMethod, requestData, (res) => {
          const status = res[
            /*status*/
            "s"
          ];
          const data = res[
            /*data*/
            "d"
          ] || "error";
          if (this.authToken_ === token) {
            if (status === "ok") {
              this.invalidAuthTokenCount_ = 0;
            } else {
              this.onAuthRevoked_(status, data);
            }
          }
        });
      }
    }
    /**
     * Attempts to authenticate with the given token. If the authentication
     * attempt fails, it's triggered like the token was revoked (the connection is
     * closed).
     */
    tryAppCheck() {
      if (this.connected_ && this.appCheckToken_) {
        this.sendRequest("appcheck", { "token": this.appCheckToken_ }, (res) => {
          const status = res[
            /*status*/
            "s"
          ];
          const data = res[
            /*data*/
            "d"
          ] || "error";
          if (status === "ok") {
            this.invalidAppCheckTokenCount_ = 0;
          } else {
            this.onAppCheckRevoked_(status, data);
          }
        });
      }
    }
    /**
     * @inheritDoc
     */
    unlisten(query, tag) {
      const pathString = query._path.toString();
      const queryId = query._queryIdentifier;
      this.log_("Unlisten called for " + pathString + " " + queryId);
      assert(query._queryParams.isDefault() || !query._queryParams.loadsAllData(), "unlisten() called for non-default but complete query");
      const listen = this.removeListen_(pathString, queryId);
      if (listen && this.connected_) {
        this.sendUnlisten_(pathString, queryId, query._queryObject, tag);
      }
    }
    sendUnlisten_(pathString, queryId, queryObj, tag) {
      this.log_("Unlisten on " + pathString + " for " + queryId);
      const req = {
        /*path*/
        p: pathString
      };
      const action = "n";
      if (tag) {
        req["q"] = queryObj;
        req["t"] = tag;
      }
      this.sendRequest(action, req);
    }
    onDisconnectPut(pathString, data, onComplete) {
      this.initConnection_();
      if (this.connected_) {
        this.sendOnDisconnect_("o", pathString, data, onComplete);
      } else {
        this.onDisconnectRequestQueue_.push({
          pathString,
          action: "o",
          data,
          onComplete
        });
      }
    }
    onDisconnectMerge(pathString, data, onComplete) {
      this.initConnection_();
      if (this.connected_) {
        this.sendOnDisconnect_("om", pathString, data, onComplete);
      } else {
        this.onDisconnectRequestQueue_.push({
          pathString,
          action: "om",
          data,
          onComplete
        });
      }
    }
    onDisconnectCancel(pathString, onComplete) {
      this.initConnection_();
      if (this.connected_) {
        this.sendOnDisconnect_("oc", pathString, null, onComplete);
      } else {
        this.onDisconnectRequestQueue_.push({
          pathString,
          action: "oc",
          data: null,
          onComplete
        });
      }
    }
    sendOnDisconnect_(action, pathString, data, onComplete) {
      const request = {
        /*path*/
        p: pathString,
        /*data*/
        d: data
      };
      this.log_("onDisconnect " + action, request);
      this.sendRequest(action, request, (response) => {
        if (onComplete) {
          setTimeout(() => {
            onComplete(response[
              /*status*/
              "s"
            ], response[
              /* data */
              "d"
            ]);
          }, Math.floor(0));
        }
      });
    }
    put(pathString, data, onComplete, hash) {
      this.putInternal("p", pathString, data, onComplete, hash);
    }
    merge(pathString, data, onComplete, hash) {
      this.putInternal("m", pathString, data, onComplete, hash);
    }
    putInternal(action, pathString, data, onComplete, hash) {
      this.initConnection_();
      const request = {
        /*path*/
        p: pathString,
        /*data*/
        d: data
      };
      if (hash !== void 0) {
        request[
          /*hash*/
          "h"
        ] = hash;
      }
      this.outstandingPuts_.push({
        action,
        request,
        onComplete
      });
      this.outstandingPutCount_++;
      const index = this.outstandingPuts_.length - 1;
      if (this.connected_) {
        this.sendPut_(index);
      } else {
        this.log_("Buffering put: " + pathString);
      }
    }
    sendPut_(index) {
      const action = this.outstandingPuts_[index].action;
      const request = this.outstandingPuts_[index].request;
      const onComplete = this.outstandingPuts_[index].onComplete;
      this.outstandingPuts_[index].queued = this.connected_;
      this.sendRequest(action, request, (message) => {
        this.log_(action + " response", message);
        delete this.outstandingPuts_[index];
        this.outstandingPutCount_--;
        if (this.outstandingPutCount_ === 0) {
          this.outstandingPuts_ = [];
        }
        if (onComplete) {
          onComplete(message[
            /*status*/
            "s"
          ], message[
            /* data */
            "d"
          ]);
        }
      });
    }
    reportStats(stats) {
      if (this.connected_) {
        const request = {
          /*counters*/
          c: stats
        };
        this.log_("reportStats", request);
        this.sendRequest(
          /*stats*/
          "s",
          request,
          (result2) => {
            const status = result2[
              /*status*/
              "s"
            ];
            if (status !== "ok") {
              const errorReason = result2[
                /* data */
                "d"
              ];
              this.log_("reportStats", "Error sending stats: " + errorReason);
            }
          }
        );
      }
    }
    onDataMessage_(message) {
      if ("r" in message) {
        this.log_("from server: " + stringify(message));
        const reqNum = message["r"];
        const onResponse = this.requestCBHash_[reqNum];
        if (onResponse) {
          delete this.requestCBHash_[reqNum];
          onResponse(message[
            /*body*/
            "b"
          ]);
        }
      } else if ("error" in message) {
        throw "A server-side error has occurred: " + message["error"];
      } else if ("a" in message) {
        this.onDataPush_(message["a"], message["b"]);
      }
    }
    onDataPush_(action, body) {
      this.log_("handleServerMessage", action, body);
      if (action === "d") {
        this.onDataUpdate_(
          body[
            /*path*/
            "p"
          ],
          body[
            /*data*/
            "d"
          ],
          /*isMerge*/
          false,
          body["t"]
        );
      } else if (action === "m") {
        this.onDataUpdate_(
          body[
            /*path*/
            "p"
          ],
          body[
            /*data*/
            "d"
          ],
          /*isMerge=*/
          true,
          body["t"]
        );
      } else if (action === "c") {
        this.onListenRevoked_(body[
          /*path*/
          "p"
        ], body[
          /*query*/
          "q"
        ]);
      } else if (action === "ac") {
        this.onAuthRevoked_(body[
          /*status code*/
          "s"
        ], body[
          /* explanation */
          "d"
        ]);
      } else if (action === "apc") {
        this.onAppCheckRevoked_(body[
          /*status code*/
          "s"
        ], body[
          /* explanation */
          "d"
        ]);
      } else if (action === "sd") {
        this.onSecurityDebugPacket_(body);
      } else {
        error("Unrecognized action received from server: " + stringify(action) + "\nAre you using the latest client?");
      }
    }
    onReady_(timestamp, sessionId) {
      this.log_("connection ready");
      this.connected_ = true;
      this.lastConnectionEstablishedTime_ = (/* @__PURE__ */ new Date()).getTime();
      this.handleTimestamp_(timestamp);
      this.lastSessionId = sessionId;
      if (this.firstConnection_) {
        this.sendConnectStats_();
      }
      this.restoreState_();
      this.firstConnection_ = false;
      this.onConnectStatus_(true);
    }
    scheduleConnect_(timeout) {
      assert(!this.realtime_, "Scheduling a connect when we're already connected/ing?");
      if (this.establishConnectionTimer_) {
        clearTimeout(this.establishConnectionTimer_);
      }
      this.establishConnectionTimer_ = setTimeout(() => {
        this.establishConnectionTimer_ = null;
        this.establishConnection_();
      }, Math.floor(timeout));
    }
    initConnection_() {
      if (!this.realtime_ && this.firstConnection_) {
        this.scheduleConnect_(0);
      }
    }
    onVisible_(visible) {
      if (visible && !this.visible_ && this.reconnectDelay_ === this.maxReconnectDelay_) {
        this.log_("Window became visible.  Reducing delay.");
        this.reconnectDelay_ = RECONNECT_MIN_DELAY;
        if (!this.realtime_) {
          this.scheduleConnect_(0);
        }
      }
      this.visible_ = visible;
    }
    onOnline_(online) {
      if (online) {
        this.log_("Browser went online.");
        this.reconnectDelay_ = RECONNECT_MIN_DELAY;
        if (!this.realtime_) {
          this.scheduleConnect_(0);
        }
      } else {
        this.log_("Browser went offline.  Killing connection.");
        if (this.realtime_) {
          this.realtime_.close();
        }
      }
    }
    onRealtimeDisconnect_() {
      this.log_("data client disconnected");
      this.connected_ = false;
      this.realtime_ = null;
      this.cancelSentTransactions_();
      this.requestCBHash_ = {};
      if (this.shouldReconnect_()) {
        if (!this.visible_) {
          this.log_("Window isn't visible.  Delaying reconnect.");
          this.reconnectDelay_ = this.maxReconnectDelay_;
          this.lastConnectionAttemptTime_ = (/* @__PURE__ */ new Date()).getTime();
        } else if (this.lastConnectionEstablishedTime_) {
          const timeSinceLastConnectSucceeded = (/* @__PURE__ */ new Date()).getTime() - this.lastConnectionEstablishedTime_;
          if (timeSinceLastConnectSucceeded > RECONNECT_DELAY_RESET_TIMEOUT) {
            this.reconnectDelay_ = RECONNECT_MIN_DELAY;
          }
          this.lastConnectionEstablishedTime_ = null;
        }
        const timeSinceLastConnectAttempt = Math.max(0, (/* @__PURE__ */ new Date()).getTime() - this.lastConnectionAttemptTime_);
        let reconnectDelay = Math.max(0, this.reconnectDelay_ - timeSinceLastConnectAttempt);
        reconnectDelay = Math.random() * reconnectDelay;
        this.log_("Trying to reconnect in " + reconnectDelay + "ms");
        this.scheduleConnect_(reconnectDelay);
        this.reconnectDelay_ = Math.min(this.maxReconnectDelay_, this.reconnectDelay_ * RECONNECT_DELAY_MULTIPLIER);
      }
      this.onConnectStatus_(false);
    }
    async establishConnection_() {
      if (this.shouldReconnect_()) {
        this.log_("Making a connection attempt");
        this.lastConnectionAttemptTime_ = (/* @__PURE__ */ new Date()).getTime();
        this.lastConnectionEstablishedTime_ = null;
        const onDataMessage = this.onDataMessage_.bind(this);
        const onReady = this.onReady_.bind(this);
        const onDisconnect = this.onRealtimeDisconnect_.bind(this);
        const connId = this.id + ":" + PersistentConnection.nextConnectionId_++;
        const lastSessionId = this.lastSessionId;
        let canceled = false;
        let connection = null;
        const closeFn = function() {
          if (connection) {
            connection.close();
          } else {
            canceled = true;
            onDisconnect();
          }
        };
        const sendRequestFn = function(msg) {
          assert(connection, "sendRequest call when we're not connected not allowed.");
          connection.sendRequest(msg);
        };
        this.realtime_ = {
          close: closeFn,
          sendRequest: sendRequestFn
        };
        const forceRefresh = this.forceTokenRefresh_;
        this.forceTokenRefresh_ = false;
        try {
          const [authToken, appCheckToken] = await Promise.all([
            this.authTokenProvider_.getToken(forceRefresh),
            this.appCheckTokenProvider_.getToken(forceRefresh)
          ]);
          if (!canceled) {
            log("getToken() completed. Creating connection.");
            this.authToken_ = authToken && authToken.accessToken;
            this.appCheckToken_ = appCheckToken && appCheckToken.token;
            connection = new Connection(
              connId,
              this.repoInfo_,
              this.applicationId_,
              this.appCheckToken_,
              this.authToken_,
              onDataMessage,
              onReady,
              onDisconnect,
              /* onKill= */
              (reason) => {
                warn(reason + " (" + this.repoInfo_.toString() + ")");
                this.interrupt(SERVER_KILL_INTERRUPT_REASON);
              },
              lastSessionId
            );
          } else {
            log("getToken() completed but was canceled");
          }
        } catch (error2) {
          this.log_("Failed to get token: " + error2);
          if (!canceled) {
            if (this.repoInfo_.nodeAdmin) {
              warn(error2);
            }
            closeFn();
          }
        }
      }
    }
    interrupt(reason) {
      log("Interrupting connection for reason: " + reason);
      this.interruptReasons_[reason] = true;
      if (this.realtime_) {
        this.realtime_.close();
      } else {
        if (this.establishConnectionTimer_) {
          clearTimeout(this.establishConnectionTimer_);
          this.establishConnectionTimer_ = null;
        }
        if (this.connected_) {
          this.onRealtimeDisconnect_();
        }
      }
    }
    resume(reason) {
      log("Resuming connection for reason: " + reason);
      delete this.interruptReasons_[reason];
      if (isEmpty(this.interruptReasons_)) {
        this.reconnectDelay_ = RECONNECT_MIN_DELAY;
        if (!this.realtime_) {
          this.scheduleConnect_(0);
        }
      }
    }
    handleTimestamp_(timestamp) {
      const delta = timestamp - (/* @__PURE__ */ new Date()).getTime();
      this.onServerInfoUpdate_({ serverTimeOffset: delta });
    }
    cancelSentTransactions_() {
      for (let i = 0; i < this.outstandingPuts_.length; i++) {
        const put = this.outstandingPuts_[i];
        if (put && /*hash*/
        "h" in put.request && put.queued) {
          if (put.onComplete) {
            put.onComplete("disconnect");
          }
          delete this.outstandingPuts_[i];
          this.outstandingPutCount_--;
        }
      }
      if (this.outstandingPutCount_ === 0) {
        this.outstandingPuts_ = [];
      }
    }
    onListenRevoked_(pathString, query) {
      let queryId;
      if (!query) {
        queryId = "default";
      } else {
        queryId = query.map((q) => ObjectToUniqueKey(q)).join("$");
      }
      const listen = this.removeListen_(pathString, queryId);
      if (listen && listen.onComplete) {
        listen.onComplete("permission_denied");
      }
    }
    removeListen_(pathString, queryId) {
      const normalizedPathString = new Path(pathString).toString();
      let listen;
      if (this.listens.has(normalizedPathString)) {
        const map2 = this.listens.get(normalizedPathString);
        listen = map2.get(queryId);
        map2.delete(queryId);
        if (map2.size === 0) {
          this.listens.delete(normalizedPathString);
        }
      } else {
        listen = void 0;
      }
      return listen;
    }
    onAuthRevoked_(statusCode, explanation) {
      log("Auth token revoked: " + statusCode + "/" + explanation);
      this.authToken_ = null;
      this.forceTokenRefresh_ = true;
      this.realtime_.close();
      if (statusCode === "invalid_token" || statusCode === "permission_denied") {
        this.invalidAuthTokenCount_++;
        if (this.invalidAuthTokenCount_ >= INVALID_TOKEN_THRESHOLD) {
          this.reconnectDelay_ = RECONNECT_MAX_DELAY_FOR_ADMINS;
          this.authTokenProvider_.notifyForInvalidToken();
        }
      }
    }
    onAppCheckRevoked_(statusCode, explanation) {
      log("App check token revoked: " + statusCode + "/" + explanation);
      this.appCheckToken_ = null;
      this.forceTokenRefresh_ = true;
      if (statusCode === "invalid_token" || statusCode === "permission_denied") {
        this.invalidAppCheckTokenCount_++;
        if (this.invalidAppCheckTokenCount_ >= INVALID_TOKEN_THRESHOLD) {
          this.appCheckTokenProvider_.notifyForInvalidToken();
        }
      }
    }
    onSecurityDebugPacket_(body) {
      if (this.securityDebugCallback_) {
        this.securityDebugCallback_(body);
      } else {
        if ("msg" in body) {
          console.log("FIREBASE: " + body["msg"].replace("\n", "\nFIREBASE: "));
        }
      }
    }
    restoreState_() {
      this.tryAuth();
      this.tryAppCheck();
      for (const queries of this.listens.values()) {
        for (const listenSpec of queries.values()) {
          this.sendListen_(listenSpec);
        }
      }
      for (let i = 0; i < this.outstandingPuts_.length; i++) {
        if (this.outstandingPuts_[i]) {
          this.sendPut_(i);
        }
      }
      while (this.onDisconnectRequestQueue_.length) {
        const request = this.onDisconnectRequestQueue_.shift();
        this.sendOnDisconnect_(request.action, request.pathString, request.data, request.onComplete);
      }
      for (let i = 0; i < this.outstandingGets_.length; i++) {
        if (this.outstandingGets_[i]) {
          this.sendGet_(i);
        }
      }
    }
    /**
     * Sends client stats for first connection
     */
    sendConnectStats_() {
      const stats = {};
      let clientName = "js";
      stats["sdk." + clientName + "." + SDK_VERSION.replace(/\./g, "-")] = 1;
      if (isMobileCordova()) {
        stats["framework.cordova"] = 1;
      } else if (isReactNative()) {
        stats["framework.reactnative"] = 1;
      }
      this.reportStats(stats);
    }
    shouldReconnect_() {
      const online = OnlineMonitor.getInstance().currentlyOnline();
      return isEmpty(this.interruptReasons_) && online;
    }
  }
  PersistentConnection.nextPersistentConnectionId_ = 0;
  PersistentConnection.nextConnectionId_ = 0;
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class NamedNode {
    constructor(name2, node) {
      this.name = name2;
      this.node = node;
    }
    static Wrap(name2, node) {
      return new NamedNode(name2, node);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Index {
    /**
     * @returns A standalone comparison function for
     * this index
     */
    getCompare() {
      return this.compare.bind(this);
    }
    /**
     * Given a before and after value for a node, determine if the indexed value has changed. Even if they are different,
     * it's possible that the changes are isolated to parts of the snapshot that are not indexed.
     *
     *
     * @returns True if the portion of the snapshot being indexed changed between oldNode and newNode
     */
    indexedValueChanged(oldNode, newNode) {
      const oldWrapped = new NamedNode(MIN_NAME, oldNode);
      const newWrapped = new NamedNode(MIN_NAME, newNode);
      return this.compare(oldWrapped, newWrapped) !== 0;
    }
    /**
     * @returns a node wrapper that will sort equal to or less than
     * any other node wrapper, using this index
     */
    minPost() {
      return NamedNode.MIN;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let __EMPTY_NODE;
  class KeyIndex extends Index {
    static get __EMPTY_NODE() {
      return __EMPTY_NODE;
    }
    static set __EMPTY_NODE(val) {
      __EMPTY_NODE = val;
    }
    compare(a, b2) {
      return nameCompare(a.name, b2.name);
    }
    isDefinedOn(node) {
      throw assertionError("KeyIndex.isDefinedOn not expected to be called.");
    }
    indexedValueChanged(oldNode, newNode) {
      return false;
    }
    minPost() {
      return NamedNode.MIN;
    }
    maxPost() {
      return new NamedNode(MAX_NAME, __EMPTY_NODE);
    }
    makePost(indexValue, name2) {
      assert(typeof indexValue === "string", "KeyIndex indexValue must always be a string.");
      return new NamedNode(indexValue, __EMPTY_NODE);
    }
    /**
     * @returns String representation for inclusion in a query spec
     */
    toString() {
      return ".key";
    }
  }
  const KEY_INDEX = new KeyIndex();
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class SortedMapIterator {
    /**
     * @param node - Node to iterate.
     * @param isReverse_ - Whether or not to iterate in reverse
     */
    constructor(node, startKey, comparator, isReverse_, resultGenerator_ = null) {
      this.isReverse_ = isReverse_;
      this.resultGenerator_ = resultGenerator_;
      this.nodeStack_ = [];
      let cmp = 1;
      while (!node.isEmpty()) {
        node = node;
        cmp = startKey ? comparator(node.key, startKey) : 1;
        if (isReverse_) {
          cmp *= -1;
        }
        if (cmp < 0) {
          if (this.isReverse_) {
            node = node.left;
          } else {
            node = node.right;
          }
        } else if (cmp === 0) {
          this.nodeStack_.push(node);
          break;
        } else {
          this.nodeStack_.push(node);
          if (this.isReverse_) {
            node = node.right;
          } else {
            node = node.left;
          }
        }
      }
    }
    getNext() {
      if (this.nodeStack_.length === 0) {
        return null;
      }
      let node = this.nodeStack_.pop();
      let result2;
      if (this.resultGenerator_) {
        result2 = this.resultGenerator_(node.key, node.value);
      } else {
        result2 = { key: node.key, value: node.value };
      }
      if (this.isReverse_) {
        node = node.left;
        while (!node.isEmpty()) {
          this.nodeStack_.push(node);
          node = node.right;
        }
      } else {
        node = node.right;
        while (!node.isEmpty()) {
          this.nodeStack_.push(node);
          node = node.left;
        }
      }
      return result2;
    }
    hasNext() {
      return this.nodeStack_.length > 0;
    }
    peek() {
      if (this.nodeStack_.length === 0) {
        return null;
      }
      const node = this.nodeStack_[this.nodeStack_.length - 1];
      if (this.resultGenerator_) {
        return this.resultGenerator_(node.key, node.value);
      } else {
        return { key: node.key, value: node.value };
      }
    }
  }
  class LLRBNode {
    /**
     * @param key - Key associated with this node.
     * @param value - Value associated with this node.
     * @param color - Whether this node is red.
     * @param left - Left child.
     * @param right - Right child.
     */
    constructor(key, value, color, left, right) {
      this.key = key;
      this.value = value;
      this.color = color != null ? color : LLRBNode.RED;
      this.left = left != null ? left : SortedMap.EMPTY_NODE;
      this.right = right != null ? right : SortedMap.EMPTY_NODE;
    }
    /**
     * Returns a copy of the current node, optionally replacing pieces of it.
     *
     * @param key - New key for the node, or null.
     * @param value - New value for the node, or null.
     * @param color - New color for the node, or null.
     * @param left - New left child for the node, or null.
     * @param right - New right child for the node, or null.
     * @returns The node copy.
     */
    copy(key, value, color, left, right) {
      return new LLRBNode(key != null ? key : this.key, value != null ? value : this.value, color != null ? color : this.color, left != null ? left : this.left, right != null ? right : this.right);
    }
    /**
     * @returns The total number of nodes in the tree.
     */
    count() {
      return this.left.count() + 1 + this.right.count();
    }
    /**
     * @returns True if the tree is empty.
     */
    isEmpty() {
      return false;
    }
    /**
     * Traverses the tree in key order and calls the specified action function
     * for each node.
     *
     * @param action - Callback function to be called for each
     *   node.  If it returns true, traversal is aborted.
     * @returns The first truthy value returned by action, or the last falsey
     *   value returned by action
     */
    inorderTraversal(action) {
      return this.left.inorderTraversal(action) || !!action(this.key, this.value) || this.right.inorderTraversal(action);
    }
    /**
     * Traverses the tree in reverse key order and calls the specified action function
     * for each node.
     *
     * @param action - Callback function to be called for each
     * node.  If it returns true, traversal is aborted.
     * @returns True if traversal was aborted.
     */
    reverseTraversal(action) {
      return this.right.reverseTraversal(action) || action(this.key, this.value) || this.left.reverseTraversal(action);
    }
    /**
     * @returns The minimum node in the tree.
     */
    min_() {
      if (this.left.isEmpty()) {
        return this;
      } else {
        return this.left.min_();
      }
    }
    /**
     * @returns The maximum key in the tree.
     */
    minKey() {
      return this.min_().key;
    }
    /**
     * @returns The maximum key in the tree.
     */
    maxKey() {
      if (this.right.isEmpty()) {
        return this.key;
      } else {
        return this.right.maxKey();
      }
    }
    /**
     * @param key - Key to insert.
     * @param value - Value to insert.
     * @param comparator - Comparator.
     * @returns New tree, with the key/value added.
     */
    insert(key, value, comparator) {
      let n = this;
      const cmp = comparator(key, n.key);
      if (cmp < 0) {
        n = n.copy(null, null, null, n.left.insert(key, value, comparator), null);
      } else if (cmp === 0) {
        n = n.copy(null, value, null, null, null);
      } else {
        n = n.copy(null, null, null, null, n.right.insert(key, value, comparator));
      }
      return n.fixUp_();
    }
    /**
     * @returns New tree, with the minimum key removed.
     */
    removeMin_() {
      if (this.left.isEmpty()) {
        return SortedMap.EMPTY_NODE;
      }
      let n = this;
      if (!n.left.isRed_() && !n.left.left.isRed_()) {
        n = n.moveRedLeft_();
      }
      n = n.copy(null, null, null, n.left.removeMin_(), null);
      return n.fixUp_();
    }
    /**
     * @param key - The key of the item to remove.
     * @param comparator - Comparator.
     * @returns New tree, with the specified item removed.
     */
    remove(key, comparator) {
      let n, smallest;
      n = this;
      if (comparator(key, n.key) < 0) {
        if (!n.left.isEmpty() && !n.left.isRed_() && !n.left.left.isRed_()) {
          n = n.moveRedLeft_();
        }
        n = n.copy(null, null, null, n.left.remove(key, comparator), null);
      } else {
        if (n.left.isRed_()) {
          n = n.rotateRight_();
        }
        if (!n.right.isEmpty() && !n.right.isRed_() && !n.right.left.isRed_()) {
          n = n.moveRedRight_();
        }
        if (comparator(key, n.key) === 0) {
          if (n.right.isEmpty()) {
            return SortedMap.EMPTY_NODE;
          } else {
            smallest = n.right.min_();
            n = n.copy(smallest.key, smallest.value, null, null, n.right.removeMin_());
          }
        }
        n = n.copy(null, null, null, null, n.right.remove(key, comparator));
      }
      return n.fixUp_();
    }
    /**
     * @returns Whether this is a RED node.
     */
    isRed_() {
      return this.color;
    }
    /**
     * @returns New tree after performing any needed rotations.
     */
    fixUp_() {
      let n = this;
      if (n.right.isRed_() && !n.left.isRed_()) {
        n = n.rotateLeft_();
      }
      if (n.left.isRed_() && n.left.left.isRed_()) {
        n = n.rotateRight_();
      }
      if (n.left.isRed_() && n.right.isRed_()) {
        n = n.colorFlip_();
      }
      return n;
    }
    /**
     * @returns New tree, after moveRedLeft.
     */
    moveRedLeft_() {
      let n = this.colorFlip_();
      if (n.right.left.isRed_()) {
        n = n.copy(null, null, null, null, n.right.rotateRight_());
        n = n.rotateLeft_();
        n = n.colorFlip_();
      }
      return n;
    }
    /**
     * @returns New tree, after moveRedRight.
     */
    moveRedRight_() {
      let n = this.colorFlip_();
      if (n.left.left.isRed_()) {
        n = n.rotateRight_();
        n = n.colorFlip_();
      }
      return n;
    }
    /**
     * @returns New tree, after rotateLeft.
     */
    rotateLeft_() {
      const nl = this.copy(null, null, LLRBNode.RED, null, this.right.left);
      return this.right.copy(null, null, this.color, nl, null);
    }
    /**
     * @returns New tree, after rotateRight.
     */
    rotateRight_() {
      const nr = this.copy(null, null, LLRBNode.RED, this.left.right, null);
      return this.left.copy(null, null, this.color, null, nr);
    }
    /**
     * @returns Newt ree, after colorFlip.
     */
    colorFlip_() {
      const left = this.left.copy(null, null, !this.left.color, null, null);
      const right = this.right.copy(null, null, !this.right.color, null, null);
      return this.copy(null, null, !this.color, left, right);
    }
    /**
     * For testing.
     *
     * @returns True if all is well.
     */
    checkMaxDepth_() {
      const blackDepth = this.check_();
      return Math.pow(2, blackDepth) <= this.count() + 1;
    }
    check_() {
      if (this.isRed_() && this.left.isRed_()) {
        throw new Error("Red node has red child(" + this.key + "," + this.value + ")");
      }
      if (this.right.isRed_()) {
        throw new Error("Right child of (" + this.key + "," + this.value + ") is red");
      }
      const blackDepth = this.left.check_();
      if (blackDepth !== this.right.check_()) {
        throw new Error("Black depths differ");
      } else {
        return blackDepth + (this.isRed_() ? 0 : 1);
      }
    }
  }
  LLRBNode.RED = true;
  LLRBNode.BLACK = false;
  class LLRBEmptyNode {
    /**
     * Returns a copy of the current node.
     *
     * @returns The node copy.
     */
    copy(key, value, color, left, right) {
      return this;
    }
    /**
     * Returns a copy of the tree, with the specified key/value added.
     *
     * @param key - Key to be added.
     * @param value - Value to be added.
     * @param comparator - Comparator.
     * @returns New tree, with item added.
     */
    insert(key, value, comparator) {
      return new LLRBNode(key, value, null);
    }
    /**
     * Returns a copy of the tree, with the specified key removed.
     *
     * @param key - The key to remove.
     * @param comparator - Comparator.
     * @returns New tree, with item removed.
     */
    remove(key, comparator) {
      return this;
    }
    /**
     * @returns The total number of nodes in the tree.
     */
    count() {
      return 0;
    }
    /**
     * @returns True if the tree is empty.
     */
    isEmpty() {
      return true;
    }
    /**
     * Traverses the tree in key order and calls the specified action function
     * for each node.
     *
     * @param action - Callback function to be called for each
     * node.  If it returns true, traversal is aborted.
     * @returns True if traversal was aborted.
     */
    inorderTraversal(action) {
      return false;
    }
    /**
     * Traverses the tree in reverse key order and calls the specified action function
     * for each node.
     *
     * @param action - Callback function to be called for each
     * node.  If it returns true, traversal is aborted.
     * @returns True if traversal was aborted.
     */
    reverseTraversal(action) {
      return false;
    }
    minKey() {
      return null;
    }
    maxKey() {
      return null;
    }
    check_() {
      return 0;
    }
    /**
     * @returns Whether this node is red.
     */
    isRed_() {
      return false;
    }
  }
  class SortedMap {
    /**
     * @param comparator_ - Key comparator.
     * @param root_ - Optional root node for the map.
     */
    constructor(comparator_, root_ = SortedMap.EMPTY_NODE) {
      this.comparator_ = comparator_;
      this.root_ = root_;
    }
    /**
     * Returns a copy of the map, with the specified key/value added or replaced.
     * (TODO: We should perhaps rename this method to 'put')
     *
     * @param key - Key to be added.
     * @param value - Value to be added.
     * @returns New map, with item added.
     */
    insert(key, value) {
      return new SortedMap(this.comparator_, this.root_.insert(key, value, this.comparator_).copy(null, null, LLRBNode.BLACK, null, null));
    }
    /**
     * Returns a copy of the map, with the specified key removed.
     *
     * @param key - The key to remove.
     * @returns New map, with item removed.
     */
    remove(key) {
      return new SortedMap(this.comparator_, this.root_.remove(key, this.comparator_).copy(null, null, LLRBNode.BLACK, null, null));
    }
    /**
     * Returns the value of the node with the given key, or null.
     *
     * @param key - The key to look up.
     * @returns The value of the node with the given key, or null if the
     * key doesn't exist.
     */
    get(key) {
      let cmp;
      let node = this.root_;
      while (!node.isEmpty()) {
        cmp = this.comparator_(key, node.key);
        if (cmp === 0) {
          return node.value;
        } else if (cmp < 0) {
          node = node.left;
        } else if (cmp > 0) {
          node = node.right;
        }
      }
      return null;
    }
    /**
     * Returns the key of the item *before* the specified key, or null if key is the first item.
     * @param key - The key to find the predecessor of
     * @returns The predecessor key.
     */
    getPredecessorKey(key) {
      let cmp, node = this.root_, rightParent = null;
      while (!node.isEmpty()) {
        cmp = this.comparator_(key, node.key);
        if (cmp === 0) {
          if (!node.left.isEmpty()) {
            node = node.left;
            while (!node.right.isEmpty()) {
              node = node.right;
            }
            return node.key;
          } else if (rightParent) {
            return rightParent.key;
          } else {
            return null;
          }
        } else if (cmp < 0) {
          node = node.left;
        } else if (cmp > 0) {
          rightParent = node;
          node = node.right;
        }
      }
      throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?");
    }
    /**
     * @returns True if the map is empty.
     */
    isEmpty() {
      return this.root_.isEmpty();
    }
    /**
     * @returns The total number of nodes in the map.
     */
    count() {
      return this.root_.count();
    }
    /**
     * @returns The minimum key in the map.
     */
    minKey() {
      return this.root_.minKey();
    }
    /**
     * @returns The maximum key in the map.
     */
    maxKey() {
      return this.root_.maxKey();
    }
    /**
     * Traverses the map in key order and calls the specified action function
     * for each key/value pair.
     *
     * @param action - Callback function to be called
     * for each key/value pair.  If action returns true, traversal is aborted.
     * @returns The first truthy value returned by action, or the last falsey
     *   value returned by action
     */
    inorderTraversal(action) {
      return this.root_.inorderTraversal(action);
    }
    /**
     * Traverses the map in reverse key order and calls the specified action function
     * for each key/value pair.
     *
     * @param action - Callback function to be called
     * for each key/value pair.  If action returns true, traversal is aborted.
     * @returns True if the traversal was aborted.
     */
    reverseTraversal(action) {
      return this.root_.reverseTraversal(action);
    }
    /**
     * Returns an iterator over the SortedMap.
     * @returns The iterator.
     */
    getIterator(resultGenerator) {
      return new SortedMapIterator(this.root_, null, this.comparator_, false, resultGenerator);
    }
    getIteratorFrom(key, resultGenerator) {
      return new SortedMapIterator(this.root_, key, this.comparator_, false, resultGenerator);
    }
    getReverseIteratorFrom(key, resultGenerator) {
      return new SortedMapIterator(this.root_, key, this.comparator_, true, resultGenerator);
    }
    getReverseIterator(resultGenerator) {
      return new SortedMapIterator(this.root_, null, this.comparator_, true, resultGenerator);
    }
  }
  SortedMap.EMPTY_NODE = new LLRBEmptyNode();
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function NAME_ONLY_COMPARATOR(left, right) {
    return nameCompare(left.name, right.name);
  }
  function NAME_COMPARATOR(left, right) {
    return nameCompare(left, right);
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let MAX_NODE$2;
  function setMaxNode$1(val) {
    MAX_NODE$2 = val;
  }
  const priorityHashText = function(priority) {
    if (typeof priority === "number") {
      return "number:" + doubleToIEEE754String(priority);
    } else {
      return "string:" + priority;
    }
  };
  const validatePriorityNode = function(priorityNode) {
    if (priorityNode.isLeafNode()) {
      const val = priorityNode.val();
      assert(typeof val === "string" || typeof val === "number" || typeof val === "object" && contains(val, ".sv"), "Priority must be a string or number.");
    } else {
      assert(priorityNode === MAX_NODE$2 || priorityNode.isEmpty(), "priority of unexpected type.");
    }
    assert(priorityNode === MAX_NODE$2 || priorityNode.getPriority().isEmpty(), "Priority nodes can't have a priority of their own.");
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let __childrenNodeConstructor;
  class LeafNode {
    static set __childrenNodeConstructor(val) {
      __childrenNodeConstructor = val;
    }
    static get __childrenNodeConstructor() {
      return __childrenNodeConstructor;
    }
    /**
     * @param value_ - The value to store in this leaf node. The object type is
     * possible in the event of a deferred value
     * @param priorityNode_ - The priority of this node.
     */
    constructor(value_, priorityNode_ = LeafNode.__childrenNodeConstructor.EMPTY_NODE) {
      this.value_ = value_;
      this.priorityNode_ = priorityNode_;
      this.lazyHash_ = null;
      assert(this.value_ !== void 0 && this.value_ !== null, "LeafNode shouldn't be created with null/undefined value.");
      validatePriorityNode(this.priorityNode_);
    }
    /** @inheritDoc */
    isLeafNode() {
      return true;
    }
    /** @inheritDoc */
    getPriority() {
      return this.priorityNode_;
    }
    /** @inheritDoc */
    updatePriority(newPriorityNode) {
      return new LeafNode(this.value_, newPriorityNode);
    }
    /** @inheritDoc */
    getImmediateChild(childName) {
      if (childName === ".priority") {
        return this.priorityNode_;
      } else {
        return LeafNode.__childrenNodeConstructor.EMPTY_NODE;
      }
    }
    /** @inheritDoc */
    getChild(path) {
      if (pathIsEmpty(path)) {
        return this;
      } else if (pathGetFront(path) === ".priority") {
        return this.priorityNode_;
      } else {
        return LeafNode.__childrenNodeConstructor.EMPTY_NODE;
      }
    }
    hasChild() {
      return false;
    }
    /** @inheritDoc */
    getPredecessorChildName(childName, childNode) {
      return null;
    }
    /** @inheritDoc */
    updateImmediateChild(childName, newChildNode) {
      if (childName === ".priority") {
        return this.updatePriority(newChildNode);
      } else if (newChildNode.isEmpty() && childName !== ".priority") {
        return this;
      } else {
        return LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(childName, newChildNode).updatePriority(this.priorityNode_);
      }
    }
    /** @inheritDoc */
    updateChild(path, newChildNode) {
      const front = pathGetFront(path);
      if (front === null) {
        return newChildNode;
      } else if (newChildNode.isEmpty() && front !== ".priority") {
        return this;
      } else {
        assert(front !== ".priority" || pathGetLength(path) === 1, ".priority must be the last token in a path");
        return this.updateImmediateChild(front, LeafNode.__childrenNodeConstructor.EMPTY_NODE.updateChild(pathPopFront(path), newChildNode));
      }
    }
    /** @inheritDoc */
    isEmpty() {
      return false;
    }
    /** @inheritDoc */
    numChildren() {
      return 0;
    }
    /** @inheritDoc */
    forEachChild(index, action) {
      return false;
    }
    val(exportFormat) {
      if (exportFormat && !this.getPriority().isEmpty()) {
        return {
          ".value": this.getValue(),
          ".priority": this.getPriority().val()
        };
      } else {
        return this.getValue();
      }
    }
    /** @inheritDoc */
    hash() {
      if (this.lazyHash_ === null) {
        let toHash = "";
        if (!this.priorityNode_.isEmpty()) {
          toHash += "priority:" + priorityHashText(this.priorityNode_.val()) + ":";
        }
        const type = typeof this.value_;
        toHash += type + ":";
        if (type === "number") {
          toHash += doubleToIEEE754String(this.value_);
        } else {
          toHash += this.value_;
        }
        this.lazyHash_ = sha1(toHash);
      }
      return this.lazyHash_;
    }
    /**
     * Returns the value of the leaf node.
     * @returns The value of the node.
     */
    getValue() {
      return this.value_;
    }
    compareTo(other) {
      if (other === LeafNode.__childrenNodeConstructor.EMPTY_NODE) {
        return 1;
      } else if (other instanceof LeafNode.__childrenNodeConstructor) {
        return -1;
      } else {
        assert(other.isLeafNode(), "Unknown node type");
        return this.compareToLeafNode_(other);
      }
    }
    /**
     * Comparison specifically for two leaf nodes
     */
    compareToLeafNode_(otherLeaf) {
      const otherLeafType = typeof otherLeaf.value_;
      const thisLeafType = typeof this.value_;
      const otherIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(otherLeafType);
      const thisIndex = LeafNode.VALUE_TYPE_ORDER.indexOf(thisLeafType);
      assert(otherIndex >= 0, "Unknown leaf type: " + otherLeafType);
      assert(thisIndex >= 0, "Unknown leaf type: " + thisLeafType);
      if (otherIndex === thisIndex) {
        if (thisLeafType === "object") {
          return 0;
        } else {
          if (this.value_ < otherLeaf.value_) {
            return -1;
          } else if (this.value_ === otherLeaf.value_) {
            return 0;
          } else {
            return 1;
          }
        }
      } else {
        return thisIndex - otherIndex;
      }
    }
    withIndex() {
      return this;
    }
    isIndexed() {
      return true;
    }
    equals(other) {
      if (other === this) {
        return true;
      } else if (other.isLeafNode()) {
        const otherLeaf = other;
        return this.value_ === otherLeaf.value_ && this.priorityNode_.equals(otherLeaf.priorityNode_);
      } else {
        return false;
      }
    }
  }
  LeafNode.VALUE_TYPE_ORDER = ["object", "boolean", "number", "string"];
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let nodeFromJSON$1;
  let MAX_NODE$1;
  function setNodeFromJSON(val) {
    nodeFromJSON$1 = val;
  }
  function setMaxNode(val) {
    MAX_NODE$1 = val;
  }
  class PriorityIndex extends Index {
    compare(a, b2) {
      const aPriority = a.node.getPriority();
      const bPriority = b2.node.getPriority();
      const indexCmp = aPriority.compareTo(bPriority);
      if (indexCmp === 0) {
        return nameCompare(a.name, b2.name);
      } else {
        return indexCmp;
      }
    }
    isDefinedOn(node) {
      return !node.getPriority().isEmpty();
    }
    indexedValueChanged(oldNode, newNode) {
      return !oldNode.getPriority().equals(newNode.getPriority());
    }
    minPost() {
      return NamedNode.MIN;
    }
    maxPost() {
      return new NamedNode(MAX_NAME, new LeafNode("[PRIORITY-POST]", MAX_NODE$1));
    }
    makePost(indexValue, name2) {
      const priorityNode = nodeFromJSON$1(indexValue);
      return new NamedNode(name2, new LeafNode("[PRIORITY-POST]", priorityNode));
    }
    /**
     * @returns String representation for inclusion in a query spec
     */
    toString() {
      return ".priority";
    }
  }
  const PRIORITY_INDEX = new PriorityIndex();
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const LOG_2 = Math.log(2);
  class Base12Num {
    constructor(length) {
      const logBase2 = (num) => (
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        parseInt(Math.log(num) / LOG_2, 10)
      );
      const bitMask = (bits) => parseInt(Array(bits + 1).join("1"), 2);
      this.count = logBase2(length + 1);
      this.current_ = this.count - 1;
      const mask = bitMask(this.count);
      this.bits_ = length + 1 & mask;
    }
    nextBitIsOne() {
      const result2 = !(this.bits_ & 1 << this.current_);
      this.current_--;
      return result2;
    }
  }
  const buildChildSet = function(childList, cmp, keyFn, mapSortFn) {
    childList.sort(cmp);
    const buildBalancedTree = function(low, high) {
      const length = high - low;
      let namedNode;
      let key;
      if (length === 0) {
        return null;
      } else if (length === 1) {
        namedNode = childList[low];
        key = keyFn ? keyFn(namedNode) : namedNode;
        return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, null, null);
      } else {
        const middle = parseInt(length / 2, 10) + low;
        const left = buildBalancedTree(low, middle);
        const right = buildBalancedTree(middle + 1, high);
        namedNode = childList[middle];
        key = keyFn ? keyFn(namedNode) : namedNode;
        return new LLRBNode(key, namedNode.node, LLRBNode.BLACK, left, right);
      }
    };
    const buildFrom12Array = function(base122) {
      let node = null;
      let root2 = null;
      let index = childList.length;
      const buildPennant = function(chunkSize, color) {
        const low = index - chunkSize;
        const high = index;
        index -= chunkSize;
        const childTree = buildBalancedTree(low + 1, high);
        const namedNode = childList[low];
        const key = keyFn ? keyFn(namedNode) : namedNode;
        attachPennant(new LLRBNode(key, namedNode.node, color, null, childTree));
      };
      const attachPennant = function(pennant) {
        if (node) {
          node.left = pennant;
          node = pennant;
        } else {
          root2 = pennant;
          node = pennant;
        }
      };
      for (let i = 0; i < base122.count; ++i) {
        const isOne = base122.nextBitIsOne();
        const chunkSize = Math.pow(2, base122.count - (i + 1));
        if (isOne) {
          buildPennant(chunkSize, LLRBNode.BLACK);
        } else {
          buildPennant(chunkSize, LLRBNode.BLACK);
          buildPennant(chunkSize, LLRBNode.RED);
        }
      }
      return root2;
    };
    const base12 = new Base12Num(childList.length);
    const root = buildFrom12Array(base12);
    return new SortedMap(mapSortFn || cmp, root);
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let _defaultIndexMap;
  const fallbackObject = {};
  class IndexMap {
    /**
     * The default IndexMap for nodes without a priority
     */
    static get Default() {
      assert(fallbackObject && PRIORITY_INDEX, "ChildrenNode.ts has not been loaded");
      _defaultIndexMap = _defaultIndexMap || new IndexMap({ ".priority": fallbackObject }, { ".priority": PRIORITY_INDEX });
      return _defaultIndexMap;
    }
    constructor(indexes_, indexSet_) {
      this.indexes_ = indexes_;
      this.indexSet_ = indexSet_;
    }
    get(indexKey) {
      const sortedMap = safeGet(this.indexes_, indexKey);
      if (!sortedMap) {
        throw new Error("No index defined for " + indexKey);
      }
      if (sortedMap instanceof SortedMap) {
        return sortedMap;
      } else {
        return null;
      }
    }
    hasIndex(indexDefinition) {
      return contains(this.indexSet_, indexDefinition.toString());
    }
    addIndex(indexDefinition, existingChildren) {
      assert(indexDefinition !== KEY_INDEX, "KeyIndex always exists and isn't meant to be added to the IndexMap.");
      const childList = [];
      let sawIndexedValue = false;
      const iter = existingChildren.getIterator(NamedNode.Wrap);
      let next = iter.getNext();
      while (next) {
        sawIndexedValue = sawIndexedValue || indexDefinition.isDefinedOn(next.node);
        childList.push(next);
        next = iter.getNext();
      }
      let newIndex;
      if (sawIndexedValue) {
        newIndex = buildChildSet(childList, indexDefinition.getCompare());
      } else {
        newIndex = fallbackObject;
      }
      const indexName = indexDefinition.toString();
      const newIndexSet = Object.assign({}, this.indexSet_);
      newIndexSet[indexName] = indexDefinition;
      const newIndexes = Object.assign({}, this.indexes_);
      newIndexes[indexName] = newIndex;
      return new IndexMap(newIndexes, newIndexSet);
    }
    /**
     * Ensure that this node is properly tracked in any indexes that we're maintaining
     */
    addToIndexes(namedNode, existingChildren) {
      const newIndexes = map(this.indexes_, (indexedChildren, indexName) => {
        const index = safeGet(this.indexSet_, indexName);
        assert(index, "Missing index implementation for " + indexName);
        if (indexedChildren === fallbackObject) {
          if (index.isDefinedOn(namedNode.node)) {
            const childList = [];
            const iter = existingChildren.getIterator(NamedNode.Wrap);
            let next = iter.getNext();
            while (next) {
              if (next.name !== namedNode.name) {
                childList.push(next);
              }
              next = iter.getNext();
            }
            childList.push(namedNode);
            return buildChildSet(childList, index.getCompare());
          } else {
            return fallbackObject;
          }
        } else {
          const existingSnap = existingChildren.get(namedNode.name);
          let newChildren = indexedChildren;
          if (existingSnap) {
            newChildren = newChildren.remove(new NamedNode(namedNode.name, existingSnap));
          }
          return newChildren.insert(namedNode, namedNode.node);
        }
      });
      return new IndexMap(newIndexes, this.indexSet_);
    }
    /**
     * Create a new IndexMap instance with the given value removed
     */
    removeFromIndexes(namedNode, existingChildren) {
      const newIndexes = map(this.indexes_, (indexedChildren) => {
        if (indexedChildren === fallbackObject) {
          return indexedChildren;
        } else {
          const existingSnap = existingChildren.get(namedNode.name);
          if (existingSnap) {
            return indexedChildren.remove(new NamedNode(namedNode.name, existingSnap));
          } else {
            return indexedChildren;
          }
        }
      });
      return new IndexMap(newIndexes, this.indexSet_);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let EMPTY_NODE;
  class ChildrenNode {
    static get EMPTY_NODE() {
      return EMPTY_NODE || (EMPTY_NODE = new ChildrenNode(new SortedMap(NAME_COMPARATOR), null, IndexMap.Default));
    }
    /**
     * @param children_ - List of children of this node..
     * @param priorityNode_ - The priority of this node (as a snapshot node).
     */
    constructor(children_, priorityNode_, indexMap_) {
      this.children_ = children_;
      this.priorityNode_ = priorityNode_;
      this.indexMap_ = indexMap_;
      this.lazyHash_ = null;
      if (this.priorityNode_) {
        validatePriorityNode(this.priorityNode_);
      }
      if (this.children_.isEmpty()) {
        assert(!this.priorityNode_ || this.priorityNode_.isEmpty(), "An empty node cannot have a priority");
      }
    }
    /** @inheritDoc */
    isLeafNode() {
      return false;
    }
    /** @inheritDoc */
    getPriority() {
      return this.priorityNode_ || EMPTY_NODE;
    }
    /** @inheritDoc */
    updatePriority(newPriorityNode) {
      if (this.children_.isEmpty()) {
        return this;
      } else {
        return new ChildrenNode(this.children_, newPriorityNode, this.indexMap_);
      }
    }
    /** @inheritDoc */
    getImmediateChild(childName) {
      if (childName === ".priority") {
        return this.getPriority();
      } else {
        const child = this.children_.get(childName);
        return child === null ? EMPTY_NODE : child;
      }
    }
    /** @inheritDoc */
    getChild(path) {
      const front = pathGetFront(path);
      if (front === null) {
        return this;
      }
      return this.getImmediateChild(front).getChild(pathPopFront(path));
    }
    /** @inheritDoc */
    hasChild(childName) {
      return this.children_.get(childName) !== null;
    }
    /** @inheritDoc */
    updateImmediateChild(childName, newChildNode) {
      assert(newChildNode, "We should always be passing snapshot nodes");
      if (childName === ".priority") {
        return this.updatePriority(newChildNode);
      } else {
        const namedNode = new NamedNode(childName, newChildNode);
        let newChildren, newIndexMap;
        if (newChildNode.isEmpty()) {
          newChildren = this.children_.remove(childName);
          newIndexMap = this.indexMap_.removeFromIndexes(namedNode, this.children_);
        } else {
          newChildren = this.children_.insert(childName, newChildNode);
          newIndexMap = this.indexMap_.addToIndexes(namedNode, this.children_);
        }
        const newPriority = newChildren.isEmpty() ? EMPTY_NODE : this.priorityNode_;
        return new ChildrenNode(newChildren, newPriority, newIndexMap);
      }
    }
    /** @inheritDoc */
    updateChild(path, newChildNode) {
      const front = pathGetFront(path);
      if (front === null) {
        return newChildNode;
      } else {
        assert(pathGetFront(path) !== ".priority" || pathGetLength(path) === 1, ".priority must be the last token in a path");
        const newImmediateChild = this.getImmediateChild(front).updateChild(pathPopFront(path), newChildNode);
        return this.updateImmediateChild(front, newImmediateChild);
      }
    }
    /** @inheritDoc */
    isEmpty() {
      return this.children_.isEmpty();
    }
    /** @inheritDoc */
    numChildren() {
      return this.children_.count();
    }
    /** @inheritDoc */
    val(exportFormat) {
      if (this.isEmpty()) {
        return null;
      }
      const obj = {};
      let numKeys = 0, maxKey = 0, allIntegerKeys = true;
      this.forEachChild(PRIORITY_INDEX, (key, childNode) => {
        obj[key] = childNode.val(exportFormat);
        numKeys++;
        if (allIntegerKeys && ChildrenNode.INTEGER_REGEXP_.test(key)) {
          maxKey = Math.max(maxKey, Number(key));
        } else {
          allIntegerKeys = false;
        }
      });
      if (!exportFormat && allIntegerKeys && maxKey < 2 * numKeys) {
        const array = [];
        for (const key in obj) {
          array[key] = obj[key];
        }
        return array;
      } else {
        if (exportFormat && !this.getPriority().isEmpty()) {
          obj[".priority"] = this.getPriority().val();
        }
        return obj;
      }
    }
    /** @inheritDoc */
    hash() {
      if (this.lazyHash_ === null) {
        let toHash = "";
        if (!this.getPriority().isEmpty()) {
          toHash += "priority:" + priorityHashText(this.getPriority().val()) + ":";
        }
        this.forEachChild(PRIORITY_INDEX, (key, childNode) => {
          const childHash = childNode.hash();
          if (childHash !== "") {
            toHash += ":" + key + ":" + childHash;
          }
        });
        this.lazyHash_ = toHash === "" ? "" : sha1(toHash);
      }
      return this.lazyHash_;
    }
    /** @inheritDoc */
    getPredecessorChildName(childName, childNode, index) {
      const idx = this.resolveIndex_(index);
      if (idx) {
        const predecessor = idx.getPredecessorKey(new NamedNode(childName, childNode));
        return predecessor ? predecessor.name : null;
      } else {
        return this.children_.getPredecessorKey(childName);
      }
    }
    getFirstChildName(indexDefinition) {
      const idx = this.resolveIndex_(indexDefinition);
      if (idx) {
        const minKey = idx.minKey();
        return minKey && minKey.name;
      } else {
        return this.children_.minKey();
      }
    }
    getFirstChild(indexDefinition) {
      const minKey = this.getFirstChildName(indexDefinition);
      if (minKey) {
        return new NamedNode(minKey, this.children_.get(minKey));
      } else {
        return null;
      }
    }
    /**
     * Given an index, return the key name of the largest value we have, according to that index
     */
    getLastChildName(indexDefinition) {
      const idx = this.resolveIndex_(indexDefinition);
      if (idx) {
        const maxKey = idx.maxKey();
        return maxKey && maxKey.name;
      } else {
        return this.children_.maxKey();
      }
    }
    getLastChild(indexDefinition) {
      const maxKey = this.getLastChildName(indexDefinition);
      if (maxKey) {
        return new NamedNode(maxKey, this.children_.get(maxKey));
      } else {
        return null;
      }
    }
    forEachChild(index, action) {
      const idx = this.resolveIndex_(index);
      if (idx) {
        return idx.inorderTraversal((wrappedNode) => {
          return action(wrappedNode.name, wrappedNode.node);
        });
      } else {
        return this.children_.inorderTraversal(action);
      }
    }
    getIterator(indexDefinition) {
      return this.getIteratorFrom(indexDefinition.minPost(), indexDefinition);
    }
    getIteratorFrom(startPost, indexDefinition) {
      const idx = this.resolveIndex_(indexDefinition);
      if (idx) {
        return idx.getIteratorFrom(startPost, (key) => key);
      } else {
        const iterator = this.children_.getIteratorFrom(startPost.name, NamedNode.Wrap);
        let next = iterator.peek();
        while (next != null && indexDefinition.compare(next, startPost) < 0) {
          iterator.getNext();
          next = iterator.peek();
        }
        return iterator;
      }
    }
    getReverseIterator(indexDefinition) {
      return this.getReverseIteratorFrom(indexDefinition.maxPost(), indexDefinition);
    }
    getReverseIteratorFrom(endPost, indexDefinition) {
      const idx = this.resolveIndex_(indexDefinition);
      if (idx) {
        return idx.getReverseIteratorFrom(endPost, (key) => {
          return key;
        });
      } else {
        const iterator = this.children_.getReverseIteratorFrom(endPost.name, NamedNode.Wrap);
        let next = iterator.peek();
        while (next != null && indexDefinition.compare(next, endPost) > 0) {
          iterator.getNext();
          next = iterator.peek();
        }
        return iterator;
      }
    }
    compareTo(other) {
      if (this.isEmpty()) {
        if (other.isEmpty()) {
          return 0;
        } else {
          return -1;
        }
      } else if (other.isLeafNode() || other.isEmpty()) {
        return 1;
      } else if (other === MAX_NODE) {
        return -1;
      } else {
        return 0;
      }
    }
    withIndex(indexDefinition) {
      if (indexDefinition === KEY_INDEX || this.indexMap_.hasIndex(indexDefinition)) {
        return this;
      } else {
        const newIndexMap = this.indexMap_.addIndex(indexDefinition, this.children_);
        return new ChildrenNode(this.children_, this.priorityNode_, newIndexMap);
      }
    }
    isIndexed(index) {
      return index === KEY_INDEX || this.indexMap_.hasIndex(index);
    }
    equals(other) {
      if (other === this) {
        return true;
      } else if (other.isLeafNode()) {
        return false;
      } else {
        const otherChildrenNode = other;
        if (!this.getPriority().equals(otherChildrenNode.getPriority())) {
          return false;
        } else if (this.children_.count() === otherChildrenNode.children_.count()) {
          const thisIter = this.getIterator(PRIORITY_INDEX);
          const otherIter = otherChildrenNode.getIterator(PRIORITY_INDEX);
          let thisCurrent = thisIter.getNext();
          let otherCurrent = otherIter.getNext();
          while (thisCurrent && otherCurrent) {
            if (thisCurrent.name !== otherCurrent.name || !thisCurrent.node.equals(otherCurrent.node)) {
              return false;
            }
            thisCurrent = thisIter.getNext();
            otherCurrent = otherIter.getNext();
          }
          return thisCurrent === null && otherCurrent === null;
        } else {
          return false;
        }
      }
    }
    /**
     * Returns a SortedMap ordered by index, or null if the default (by-key) ordering can be used
     * instead.
     *
     */
    resolveIndex_(indexDefinition) {
      if (indexDefinition === KEY_INDEX) {
        return null;
      } else {
        return this.indexMap_.get(indexDefinition.toString());
      }
    }
  }
  ChildrenNode.INTEGER_REGEXP_ = /^(0|[1-9]\d*)$/;
  class MaxNode extends ChildrenNode {
    constructor() {
      super(new SortedMap(NAME_COMPARATOR), ChildrenNode.EMPTY_NODE, IndexMap.Default);
    }
    compareTo(other) {
      if (other === this) {
        return 0;
      } else {
        return 1;
      }
    }
    equals(other) {
      return other === this;
    }
    getPriority() {
      return this;
    }
    getImmediateChild(childName) {
      return ChildrenNode.EMPTY_NODE;
    }
    isEmpty() {
      return false;
    }
  }
  const MAX_NODE = new MaxNode();
  Object.defineProperties(NamedNode, {
    MIN: {
      value: new NamedNode(MIN_NAME, ChildrenNode.EMPTY_NODE)
    },
    MAX: {
      value: new NamedNode(MAX_NAME, MAX_NODE)
    }
  });
  KeyIndex.__EMPTY_NODE = ChildrenNode.EMPTY_NODE;
  LeafNode.__childrenNodeConstructor = ChildrenNode;
  setMaxNode$1(MAX_NODE);
  setMaxNode(MAX_NODE);
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const USE_HINZE = true;
  function nodeFromJSON(json, priority = null) {
    if (json === null) {
      return ChildrenNode.EMPTY_NODE;
    }
    if (typeof json === "object" && ".priority" in json) {
      priority = json[".priority"];
    }
    assert(priority === null || typeof priority === "string" || typeof priority === "number" || typeof priority === "object" && ".sv" in priority, "Invalid priority type found: " + typeof priority);
    if (typeof json === "object" && ".value" in json && json[".value"] !== null) {
      json = json[".value"];
    }
    if (typeof json !== "object" || ".sv" in json) {
      const jsonLeaf = json;
      return new LeafNode(jsonLeaf, nodeFromJSON(priority));
    }
    if (!(json instanceof Array) && USE_HINZE) {
      const children = [];
      let childrenHavePriority = false;
      const hinzeJsonObj = json;
      each(hinzeJsonObj, (key, child) => {
        if (key.substring(0, 1) !== ".") {
          const childNode = nodeFromJSON(child);
          if (!childNode.isEmpty()) {
            childrenHavePriority = childrenHavePriority || !childNode.getPriority().isEmpty();
            children.push(new NamedNode(key, childNode));
          }
        }
      });
      if (children.length === 0) {
        return ChildrenNode.EMPTY_NODE;
      }
      const childSet = buildChildSet(children, NAME_ONLY_COMPARATOR, (namedNode) => namedNode.name, NAME_COMPARATOR);
      if (childrenHavePriority) {
        const sortedChildSet = buildChildSet(children, PRIORITY_INDEX.getCompare());
        return new ChildrenNode(childSet, nodeFromJSON(priority), new IndexMap({ ".priority": sortedChildSet }, { ".priority": PRIORITY_INDEX }));
      } else {
        return new ChildrenNode(childSet, nodeFromJSON(priority), IndexMap.Default);
      }
    } else {
      let node = ChildrenNode.EMPTY_NODE;
      each(json, (key, childData) => {
        if (contains(json, key)) {
          if (key.substring(0, 1) !== ".") {
            const childNode = nodeFromJSON(childData);
            if (childNode.isLeafNode() || !childNode.isEmpty()) {
              node = node.updateImmediateChild(key, childNode);
            }
          }
        }
      });
      return node.updatePriority(nodeFromJSON(priority));
    }
  }
  setNodeFromJSON(nodeFromJSON);
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class PathIndex extends Index {
    constructor(indexPath_) {
      super();
      this.indexPath_ = indexPath_;
      assert(!pathIsEmpty(indexPath_) && pathGetFront(indexPath_) !== ".priority", "Can't create PathIndex with empty path or .priority key");
    }
    extractChild(snap) {
      return snap.getChild(this.indexPath_);
    }
    isDefinedOn(node) {
      return !node.getChild(this.indexPath_).isEmpty();
    }
    compare(a, b2) {
      const aChild = this.extractChild(a.node);
      const bChild = this.extractChild(b2.node);
      const indexCmp = aChild.compareTo(bChild);
      if (indexCmp === 0) {
        return nameCompare(a.name, b2.name);
      } else {
        return indexCmp;
      }
    }
    makePost(indexValue, name2) {
      const valueNode = nodeFromJSON(indexValue);
      const node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, valueNode);
      return new NamedNode(name2, node);
    }
    maxPost() {
      const node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, MAX_NODE);
      return new NamedNode(MAX_NAME, node);
    }
    toString() {
      return pathSlice(this.indexPath_, 0).join("/");
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ValueIndex extends Index {
    compare(a, b2) {
      const indexCmp = a.node.compareTo(b2.node);
      if (indexCmp === 0) {
        return nameCompare(a.name, b2.name);
      } else {
        return indexCmp;
      }
    }
    isDefinedOn(node) {
      return true;
    }
    indexedValueChanged(oldNode, newNode) {
      return !oldNode.equals(newNode);
    }
    minPost() {
      return NamedNode.MIN;
    }
    maxPost() {
      return NamedNode.MAX;
    }
    makePost(indexValue, name2) {
      const valueNode = nodeFromJSON(indexValue);
      return new NamedNode(name2, valueNode);
    }
    /**
     * @returns String representation for inclusion in a query spec
     */
    toString() {
      return ".value";
    }
  }
  const VALUE_INDEX = new ValueIndex();
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function changeValue(snapshotNode) {
    return { type: "value", snapshotNode };
  }
  function changeChildAdded(childName, snapshotNode) {
    return { type: "child_added", snapshotNode, childName };
  }
  function changeChildRemoved(childName, snapshotNode) {
    return { type: "child_removed", snapshotNode, childName };
  }
  function changeChildChanged(childName, snapshotNode, oldSnap) {
    return {
      type: "child_changed",
      snapshotNode,
      childName,
      oldSnap
    };
  }
  function changeChildMoved(childName, snapshotNode) {
    return { type: "child_moved", snapshotNode, childName };
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class QueryParams {
    constructor() {
      this.limitSet_ = false;
      this.startSet_ = false;
      this.startNameSet_ = false;
      this.startAfterSet_ = false;
      this.endSet_ = false;
      this.endNameSet_ = false;
      this.endBeforeSet_ = false;
      this.limit_ = 0;
      this.viewFrom_ = "";
      this.indexStartValue_ = null;
      this.indexStartName_ = "";
      this.indexEndValue_ = null;
      this.indexEndName_ = "";
      this.index_ = PRIORITY_INDEX;
    }
    hasStart() {
      return this.startSet_;
    }
    /**
     * @returns True if it would return from left.
     */
    isViewFromLeft() {
      if (this.viewFrom_ === "") {
        return this.startSet_;
      } else {
        return this.viewFrom_ === "l";
      }
    }
    /**
     * Only valid to call if hasStart() returns true
     */
    getIndexStartValue() {
      assert(this.startSet_, "Only valid if start has been set");
      return this.indexStartValue_;
    }
    /**
     * Only valid to call if hasStart() returns true.
     * Returns the starting key name for the range defined by these query parameters
     */
    getIndexStartName() {
      assert(this.startSet_, "Only valid if start has been set");
      if (this.startNameSet_) {
        return this.indexStartName_;
      } else {
        return MIN_NAME;
      }
    }
    hasEnd() {
      return this.endSet_;
    }
    /**
     * Only valid to call if hasEnd() returns true.
     */
    getIndexEndValue() {
      assert(this.endSet_, "Only valid if end has been set");
      return this.indexEndValue_;
    }
    /**
     * Only valid to call if hasEnd() returns true.
     * Returns the end key name for the range defined by these query parameters
     */
    getIndexEndName() {
      assert(this.endSet_, "Only valid if end has been set");
      if (this.endNameSet_) {
        return this.indexEndName_;
      } else {
        return MAX_NAME;
      }
    }
    hasLimit() {
      return this.limitSet_;
    }
    /**
     * @returns True if a limit has been set and it has been explicitly anchored
     */
    hasAnchoredLimit() {
      return this.limitSet_ && this.viewFrom_ !== "";
    }
    /**
     * Only valid to call if hasLimit() returns true
     */
    getLimit() {
      assert(this.limitSet_, "Only valid if limit has been set");
      return this.limit_;
    }
    getIndex() {
      return this.index_;
    }
    loadsAllData() {
      return !(this.startSet_ || this.endSet_ || this.limitSet_);
    }
    isDefault() {
      return this.loadsAllData() && this.index_ === PRIORITY_INDEX;
    }
    copy() {
      const copy = new QueryParams();
      copy.limitSet_ = this.limitSet_;
      copy.limit_ = this.limit_;
      copy.startSet_ = this.startSet_;
      copy.startAfterSet_ = this.startAfterSet_;
      copy.indexStartValue_ = this.indexStartValue_;
      copy.startNameSet_ = this.startNameSet_;
      copy.indexStartName_ = this.indexStartName_;
      copy.endSet_ = this.endSet_;
      copy.endBeforeSet_ = this.endBeforeSet_;
      copy.indexEndValue_ = this.indexEndValue_;
      copy.endNameSet_ = this.endNameSet_;
      copy.indexEndName_ = this.indexEndName_;
      copy.index_ = this.index_;
      copy.viewFrom_ = this.viewFrom_;
      return copy;
    }
  }
  function queryParamsToRestQueryStringParameters(queryParams) {
    const qs = {};
    if (queryParams.isDefault()) {
      return qs;
    }
    let orderBy;
    if (queryParams.index_ === PRIORITY_INDEX) {
      orderBy = "$priority";
    } else if (queryParams.index_ === VALUE_INDEX) {
      orderBy = "$value";
    } else if (queryParams.index_ === KEY_INDEX) {
      orderBy = "$key";
    } else {
      assert(queryParams.index_ instanceof PathIndex, "Unrecognized index type!");
      orderBy = queryParams.index_.toString();
    }
    qs[
      "orderBy"
      /* REST_QUERY_CONSTANTS.ORDER_BY */
    ] = stringify(orderBy);
    if (queryParams.startSet_) {
      const startParam = queryParams.startAfterSet_ ? "startAfter" : "startAt";
      qs[startParam] = stringify(queryParams.indexStartValue_);
      if (queryParams.startNameSet_) {
        qs[startParam] += "," + stringify(queryParams.indexStartName_);
      }
    }
    if (queryParams.endSet_) {
      const endParam = queryParams.endBeforeSet_ ? "endBefore" : "endAt";
      qs[endParam] = stringify(queryParams.indexEndValue_);
      if (queryParams.endNameSet_) {
        qs[endParam] += "," + stringify(queryParams.indexEndName_);
      }
    }
    if (queryParams.limitSet_) {
      if (queryParams.isViewFromLeft()) {
        qs[
          "limitToFirst"
          /* REST_QUERY_CONSTANTS.LIMIT_TO_FIRST */
        ] = queryParams.limit_;
      } else {
        qs[
          "limitToLast"
          /* REST_QUERY_CONSTANTS.LIMIT_TO_LAST */
        ] = queryParams.limit_;
      }
    }
    return qs;
  }
  function queryParamsGetQueryObject(queryParams) {
    const obj = {};
    if (queryParams.startSet_) {
      obj[
        "sp"
        /* WIRE_PROTOCOL_CONSTANTS.INDEX_START_VALUE */
      ] = queryParams.indexStartValue_;
      if (queryParams.startNameSet_) {
        obj[
          "sn"
          /* WIRE_PROTOCOL_CONSTANTS.INDEX_START_NAME */
        ] = queryParams.indexStartName_;
      }
      obj[
        "sin"
        /* WIRE_PROTOCOL_CONSTANTS.INDEX_START_IS_INCLUSIVE */
      ] = !queryParams.startAfterSet_;
    }
    if (queryParams.endSet_) {
      obj[
        "ep"
        /* WIRE_PROTOCOL_CONSTANTS.INDEX_END_VALUE */
      ] = queryParams.indexEndValue_;
      if (queryParams.endNameSet_) {
        obj[
          "en"
          /* WIRE_PROTOCOL_CONSTANTS.INDEX_END_NAME */
        ] = queryParams.indexEndName_;
      }
      obj[
        "ein"
        /* WIRE_PROTOCOL_CONSTANTS.INDEX_END_IS_INCLUSIVE */
      ] = !queryParams.endBeforeSet_;
    }
    if (queryParams.limitSet_) {
      obj[
        "l"
        /* WIRE_PROTOCOL_CONSTANTS.LIMIT */
      ] = queryParams.limit_;
      let viewFrom = queryParams.viewFrom_;
      if (viewFrom === "") {
        if (queryParams.isViewFromLeft()) {
          viewFrom = "l";
        } else {
          viewFrom = "r";
        }
      }
      obj[
        "vf"
        /* WIRE_PROTOCOL_CONSTANTS.VIEW_FROM */
      ] = viewFrom;
    }
    if (queryParams.index_ !== PRIORITY_INDEX) {
      obj[
        "i"
        /* WIRE_PROTOCOL_CONSTANTS.INDEX */
      ] = queryParams.index_.toString();
    }
    return obj;
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ReadonlyRestClient extends ServerActions {
    reportStats(stats) {
      throw new Error("Method not implemented.");
    }
    static getListenId_(query, tag) {
      if (tag !== void 0) {
        return "tag$" + tag;
      } else {
        assert(query._queryParams.isDefault(), "should have a tag if it's not a default query.");
        return query._path.toString();
      }
    }
    /**
     * @param repoInfo_ - Data about the namespace we are connecting to
     * @param onDataUpdate_ - A callback for new data from the server
     */
    constructor(repoInfo_, onDataUpdate_, authTokenProvider_, appCheckTokenProvider_) {
      super();
      this.repoInfo_ = repoInfo_;
      this.onDataUpdate_ = onDataUpdate_;
      this.authTokenProvider_ = authTokenProvider_;
      this.appCheckTokenProvider_ = appCheckTokenProvider_;
      this.log_ = logWrapper("p:rest:");
      this.listens_ = {};
    }
    /** @inheritDoc */
    listen(query, currentHashFn, tag, onComplete) {
      const pathString = query._path.toString();
      this.log_("Listen called for " + pathString + " " + query._queryIdentifier);
      const listenId = ReadonlyRestClient.getListenId_(query, tag);
      const thisListen = {};
      this.listens_[listenId] = thisListen;
      const queryStringParameters = queryParamsToRestQueryStringParameters(query._queryParams);
      this.restRequest_(pathString + ".json", queryStringParameters, (error2, result2) => {
        let data = result2;
        if (error2 === 404) {
          data = null;
          error2 = null;
        }
        if (error2 === null) {
          this.onDataUpdate_(
            pathString,
            data,
            /*isMerge=*/
            false,
            tag
          );
        }
        if (safeGet(this.listens_, listenId) === thisListen) {
          let status;
          if (!error2) {
            status = "ok";
          } else if (error2 === 401) {
            status = "permission_denied";
          } else {
            status = "rest_error:" + error2;
          }
          onComplete(status, null);
        }
      });
    }
    /** @inheritDoc */
    unlisten(query, tag) {
      const listenId = ReadonlyRestClient.getListenId_(query, tag);
      delete this.listens_[listenId];
    }
    get(query) {
      const queryStringParameters = queryParamsToRestQueryStringParameters(query._queryParams);
      const pathString = query._path.toString();
      const deferred = new Deferred();
      this.restRequest_(pathString + ".json", queryStringParameters, (error2, result2) => {
        let data = result2;
        if (error2 === 404) {
          data = null;
          error2 = null;
        }
        if (error2 === null) {
          this.onDataUpdate_(
            pathString,
            data,
            /*isMerge=*/
            false,
            /*tag=*/
            null
          );
          deferred.resolve(data);
        } else {
          deferred.reject(new Error(data));
        }
      });
      return deferred.promise;
    }
    /** @inheritDoc */
    refreshAuthToken(token) {
    }
    /**
     * Performs a REST request to the given path, with the provided query string parameters,
     * and any auth credentials we have.
     */
    restRequest_(pathString, queryStringParameters = {}, callback) {
      queryStringParameters["format"] = "export";
      return Promise.all([
        this.authTokenProvider_.getToken(
          /*forceRefresh=*/
          false
        ),
        this.appCheckTokenProvider_.getToken(
          /*forceRefresh=*/
          false
        )
      ]).then(([authToken, appCheckToken]) => {
        if (authToken && authToken.accessToken) {
          queryStringParameters["auth"] = authToken.accessToken;
        }
        if (appCheckToken && appCheckToken.token) {
          queryStringParameters["ac"] = appCheckToken.token;
        }
        const url = (this.repoInfo_.secure ? "https://" : "http://") + this.repoInfo_.host + pathString + "?ns=" + this.repoInfo_.namespace + querystring(queryStringParameters);
        this.log_("Sending REST request for " + url);
        const xhr = new XMLHttpRequest();
        xhr.onreadystatechange = () => {
          if (callback && xhr.readyState === 4) {
            this.log_("REST Response for " + url + " received. status:", xhr.status, "response:", xhr.responseText);
            let res = null;
            if (xhr.status >= 200 && xhr.status < 300) {
              try {
                res = jsonEval(xhr.responseText);
              } catch (e) {
                warn("Failed to parse JSON response for " + url + ": " + xhr.responseText);
              }
              callback(null, res);
            } else {
              if (xhr.status !== 401 && xhr.status !== 404) {
                warn("Got unsuccessful REST response for " + url + " Status: " + xhr.status);
              }
              callback(xhr.status);
            }
            callback = null;
          }
        };
        xhr.open(
          "GET",
          url,
          /*asynchronous=*/
          true
        );
        xhr.send();
      });
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class SnapshotHolder {
    constructor() {
      this.rootNode_ = ChildrenNode.EMPTY_NODE;
    }
    getNode(path) {
      return this.rootNode_.getChild(path);
    }
    updateSnapshot(path, newSnapshotNode) {
      this.rootNode_ = this.rootNode_.updateChild(path, newSnapshotNode);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function newSparseSnapshotTree() {
    return {
      value: null,
      children: /* @__PURE__ */ new Map()
    };
  }
  function sparseSnapshotTreeRemember(sparseSnapshotTree, path, data) {
    if (pathIsEmpty(path)) {
      sparseSnapshotTree.value = data;
      sparseSnapshotTree.children.clear();
    } else if (sparseSnapshotTree.value !== null) {
      sparseSnapshotTree.value = sparseSnapshotTree.value.updateChild(path, data);
    } else {
      const childKey = pathGetFront(path);
      if (!sparseSnapshotTree.children.has(childKey)) {
        sparseSnapshotTree.children.set(childKey, newSparseSnapshotTree());
      }
      const child = sparseSnapshotTree.children.get(childKey);
      path = pathPopFront(path);
      sparseSnapshotTreeRemember(child, path, data);
    }
  }
  function sparseSnapshotTreeForEachTree(sparseSnapshotTree, prefixPath, func) {
    if (sparseSnapshotTree.value !== null) {
      func(prefixPath, sparseSnapshotTree.value);
    } else {
      sparseSnapshotTreeForEachChild(sparseSnapshotTree, (key, tree) => {
        const path = new Path(prefixPath.toString() + "/" + key);
        sparseSnapshotTreeForEachTree(tree, path, func);
      });
    }
  }
  function sparseSnapshotTreeForEachChild(sparseSnapshotTree, func) {
    sparseSnapshotTree.children.forEach((tree, key) => {
      func(key, tree);
    });
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class StatsListener {
    constructor(collection_) {
      this.collection_ = collection_;
      this.last_ = null;
    }
    get() {
      const newStats = this.collection_.get();
      const delta = Object.assign({}, newStats);
      if (this.last_) {
        each(this.last_, (stat, value) => {
          delta[stat] = delta[stat] - value;
        });
      }
      this.last_ = newStats;
      return delta;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const FIRST_STATS_MIN_TIME = 10 * 1e3;
  const FIRST_STATS_MAX_TIME = 30 * 1e3;
  const REPORT_STATS_INTERVAL = 5 * 60 * 1e3;
  class StatsReporter {
    constructor(collection, server_) {
      this.server_ = server_;
      this.statsToReport_ = {};
      this.statsListener_ = new StatsListener(collection);
      const timeout = FIRST_STATS_MIN_TIME + (FIRST_STATS_MAX_TIME - FIRST_STATS_MIN_TIME) * Math.random();
      setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(timeout));
    }
    reportStats_() {
      const stats = this.statsListener_.get();
      const reportedStats = {};
      let haveStatsToReport = false;
      each(stats, (stat, value) => {
        if (value > 0 && contains(this.statsToReport_, stat)) {
          reportedStats[stat] = value;
          haveStatsToReport = true;
        }
      });
      if (haveStatsToReport) {
        this.server_.reportStats(reportedStats);
      }
      setTimeoutNonBlocking(this.reportStats_.bind(this), Math.floor(Math.random() * 2 * REPORT_STATS_INTERVAL));
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  var OperationType;
  (function(OperationType2) {
    OperationType2[OperationType2["OVERWRITE"] = 0] = "OVERWRITE";
    OperationType2[OperationType2["MERGE"] = 1] = "MERGE";
    OperationType2[OperationType2["ACK_USER_WRITE"] = 2] = "ACK_USER_WRITE";
    OperationType2[OperationType2["LISTEN_COMPLETE"] = 3] = "LISTEN_COMPLETE";
  })(OperationType || (OperationType = {}));
  function newOperationSourceUser() {
    return {
      fromUser: true,
      fromServer: false,
      queryId: null,
      tagged: false
    };
  }
  function newOperationSourceServer() {
    return {
      fromUser: false,
      fromServer: true,
      queryId: null,
      tagged: false
    };
  }
  function newOperationSourceServerTaggedQuery(queryId) {
    return {
      fromUser: false,
      fromServer: true,
      queryId,
      tagged: true
    };
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class AckUserWrite {
    /**
     * @param affectedTree - A tree containing true for each affected path. Affected paths can't overlap.
     */
    constructor(path, affectedTree, revert) {
      this.path = path;
      this.affectedTree = affectedTree;
      this.revert = revert;
      this.type = OperationType.ACK_USER_WRITE;
      this.source = newOperationSourceUser();
    }
    operationForChild(childName) {
      if (!pathIsEmpty(this.path)) {
        assert(pathGetFront(this.path) === childName, "operationForChild called for unrelated child.");
        return new AckUserWrite(pathPopFront(this.path), this.affectedTree, this.revert);
      } else if (this.affectedTree.value != null) {
        assert(this.affectedTree.children.isEmpty(), "affectedTree should not have overlapping affected paths.");
        return this;
      } else {
        const childTree = this.affectedTree.subtree(new Path(childName));
        return new AckUserWrite(newEmptyPath(), childTree, this.revert);
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Overwrite {
    constructor(source, path, snap) {
      this.source = source;
      this.path = path;
      this.snap = snap;
      this.type = OperationType.OVERWRITE;
    }
    operationForChild(childName) {
      if (pathIsEmpty(this.path)) {
        return new Overwrite(this.source, newEmptyPath(), this.snap.getImmediateChild(childName));
      } else {
        return new Overwrite(this.source, pathPopFront(this.path), this.snap);
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Merge {
    constructor(source, path, children) {
      this.source = source;
      this.path = path;
      this.children = children;
      this.type = OperationType.MERGE;
    }
    operationForChild(childName) {
      if (pathIsEmpty(this.path)) {
        const childTree = this.children.subtree(new Path(childName));
        if (childTree.isEmpty()) {
          return null;
        } else if (childTree.value) {
          return new Overwrite(this.source, newEmptyPath(), childTree.value);
        } else {
          return new Merge(this.source, newEmptyPath(), childTree);
        }
      } else {
        assert(pathGetFront(this.path) === childName, "Can't get a merge for a child not on the path of the operation");
        return new Merge(this.source, pathPopFront(this.path), this.children);
      }
    }
    toString() {
      return "Operation(" + this.path + ": " + this.source.toString() + " merge: " + this.children.toString() + ")";
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class CacheNode {
    constructor(node_, fullyInitialized_, filtered_) {
      this.node_ = node_;
      this.fullyInitialized_ = fullyInitialized_;
      this.filtered_ = filtered_;
    }
    /**
     * Returns whether this node was fully initialized with either server data or a complete overwrite by the client
     */
    isFullyInitialized() {
      return this.fullyInitialized_;
    }
    /**
     * Returns whether this node is potentially missing children due to a filter applied to the node
     */
    isFiltered() {
      return this.filtered_;
    }
    isCompleteForPath(path) {
      if (pathIsEmpty(path)) {
        return this.isFullyInitialized() && !this.filtered_;
      }
      const childKey = pathGetFront(path);
      return this.isCompleteForChild(childKey);
    }
    isCompleteForChild(key) {
      return this.isFullyInitialized() && !this.filtered_ || this.node_.hasChild(key);
    }
    getNode() {
      return this.node_;
    }
  }
  function eventGeneratorGenerateEventsForChanges(eventGenerator, changes, eventCache, eventRegistrations) {
    const events = [];
    const moves = [];
    changes.forEach((change) => {
      if (change.type === "child_changed" && eventGenerator.index_.indexedValueChanged(change.oldSnap, change.snapshotNode)) {
        moves.push(changeChildMoved(change.childName, change.snapshotNode));
      }
    });
    eventGeneratorGenerateEventsForType(eventGenerator, events, "child_removed", changes, eventRegistrations, eventCache);
    eventGeneratorGenerateEventsForType(eventGenerator, events, "child_added", changes, eventRegistrations, eventCache);
    eventGeneratorGenerateEventsForType(eventGenerator, events, "child_moved", moves, eventRegistrations, eventCache);
    eventGeneratorGenerateEventsForType(eventGenerator, events, "child_changed", changes, eventRegistrations, eventCache);
    eventGeneratorGenerateEventsForType(eventGenerator, events, "value", changes, eventRegistrations, eventCache);
    return events;
  }
  function eventGeneratorGenerateEventsForType(eventGenerator, events, eventType, changes, registrations, eventCache) {
    const filteredChanges = changes.filter((change) => change.type === eventType);
    filteredChanges.sort((a, b2) => eventGeneratorCompareChanges(eventGenerator, a, b2));
    filteredChanges.forEach((change) => {
      const materializedChange = eventGeneratorMaterializeSingleChange(eventGenerator, change, eventCache);
      registrations.forEach((registration) => {
        if (registration.respondsTo(change.type)) {
          events.push(registration.createEvent(materializedChange, eventGenerator.query_));
        }
      });
    });
  }
  function eventGeneratorMaterializeSingleChange(eventGenerator, change, eventCache) {
    if (change.type === "value" || change.type === "child_removed") {
      return change;
    } else {
      change.prevName = eventCache.getPredecessorChildName(change.childName, change.snapshotNode, eventGenerator.index_);
      return change;
    }
  }
  function eventGeneratorCompareChanges(eventGenerator, a, b2) {
    if (a.childName == null || b2.childName == null) {
      throw assertionError("Should only compare child_ events.");
    }
    const aWrapped = new NamedNode(a.childName, a.snapshotNode);
    const bWrapped = new NamedNode(b2.childName, b2.snapshotNode);
    return eventGenerator.index_.compare(aWrapped, bWrapped);
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function newViewCache(eventCache, serverCache) {
    return { eventCache, serverCache };
  }
  function viewCacheUpdateEventSnap(viewCache, eventSnap, complete, filtered) {
    return newViewCache(new CacheNode(eventSnap, complete, filtered), viewCache.serverCache);
  }
  function viewCacheUpdateServerSnap(viewCache, serverSnap, complete, filtered) {
    return newViewCache(viewCache.eventCache, new CacheNode(serverSnap, complete, filtered));
  }
  function viewCacheGetCompleteEventSnap(viewCache) {
    return viewCache.eventCache.isFullyInitialized() ? viewCache.eventCache.getNode() : null;
  }
  function viewCacheGetCompleteServerSnap(viewCache) {
    return viewCache.serverCache.isFullyInitialized() ? viewCache.serverCache.getNode() : null;
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let emptyChildrenSingleton;
  const EmptyChildren = () => {
    if (!emptyChildrenSingleton) {
      emptyChildrenSingleton = new SortedMap(stringCompare);
    }
    return emptyChildrenSingleton;
  };
  class ImmutableTree {
    static fromObject(obj) {
      let tree = new ImmutableTree(null);
      each(obj, (childPath, childSnap) => {
        tree = tree.set(new Path(childPath), childSnap);
      });
      return tree;
    }
    constructor(value, children = EmptyChildren()) {
      this.value = value;
      this.children = children;
    }
    /**
     * True if the value is empty and there are no children
     */
    isEmpty() {
      return this.value === null && this.children.isEmpty();
    }
    /**
     * Given a path and predicate, return the first node and the path to that node
     * where the predicate returns true.
     *
     * TODO Do a perf test -- If we're creating a bunch of `{path: value:}`
     * objects on the way back out, it may be better to pass down a pathSoFar obj.
     *
     * @param relativePath - The remainder of the path
     * @param predicate - The predicate to satisfy to return a node
     */
    findRootMostMatchingPathAndValue(relativePath, predicate) {
      if (this.value != null && predicate(this.value)) {
        return { path: newEmptyPath(), value: this.value };
      } else {
        if (pathIsEmpty(relativePath)) {
          return null;
        } else {
          const front = pathGetFront(relativePath);
          const child = this.children.get(front);
          if (child !== null) {
            const childExistingPathAndValue = child.findRootMostMatchingPathAndValue(pathPopFront(relativePath), predicate);
            if (childExistingPathAndValue != null) {
              const fullPath = pathChild(new Path(front), childExistingPathAndValue.path);
              return { path: fullPath, value: childExistingPathAndValue.value };
            } else {
              return null;
            }
          } else {
            return null;
          }
        }
      }
    }
    /**
     * Find, if it exists, the shortest subpath of the given path that points a defined
     * value in the tree
     */
    findRootMostValueAndPath(relativePath) {
      return this.findRootMostMatchingPathAndValue(relativePath, () => true);
    }
    /**
     * @returns The subtree at the given path
     */
    subtree(relativePath) {
      if (pathIsEmpty(relativePath)) {
        return this;
      } else {
        const front = pathGetFront(relativePath);
        const childTree = this.children.get(front);
        if (childTree !== null) {
          return childTree.subtree(pathPopFront(relativePath));
        } else {
          return new ImmutableTree(null);
        }
      }
    }
    /**
     * Sets a value at the specified path.
     *
     * @param relativePath - Path to set value at.
     * @param toSet - Value to set.
     * @returns Resulting tree.
     */
    set(relativePath, toSet) {
      if (pathIsEmpty(relativePath)) {
        return new ImmutableTree(toSet, this.children);
      } else {
        const front = pathGetFront(relativePath);
        const child = this.children.get(front) || new ImmutableTree(null);
        const newChild = child.set(pathPopFront(relativePath), toSet);
        const newChildren = this.children.insert(front, newChild);
        return new ImmutableTree(this.value, newChildren);
      }
    }
    /**
     * Removes the value at the specified path.
     *
     * @param relativePath - Path to value to remove.
     * @returns Resulting tree.
     */
    remove(relativePath) {
      if (pathIsEmpty(relativePath)) {
        if (this.children.isEmpty()) {
          return new ImmutableTree(null);
        } else {
          return new ImmutableTree(null, this.children);
        }
      } else {
        const front = pathGetFront(relativePath);
        const child = this.children.get(front);
        if (child) {
          const newChild = child.remove(pathPopFront(relativePath));
          let newChildren;
          if (newChild.isEmpty()) {
            newChildren = this.children.remove(front);
          } else {
            newChildren = this.children.insert(front, newChild);
          }
          if (this.value === null && newChildren.isEmpty()) {
            return new ImmutableTree(null);
          } else {
            return new ImmutableTree(this.value, newChildren);
          }
        } else {
          return this;
        }
      }
    }
    /**
     * Gets a value from the tree.
     *
     * @param relativePath - Path to get value for.
     * @returns Value at path, or null.
     */
    get(relativePath) {
      if (pathIsEmpty(relativePath)) {
        return this.value;
      } else {
        const front = pathGetFront(relativePath);
        const child = this.children.get(front);
        if (child) {
          return child.get(pathPopFront(relativePath));
        } else {
          return null;
        }
      }
    }
    /**
     * Replace the subtree at the specified path with the given new tree.
     *
     * @param relativePath - Path to replace subtree for.
     * @param newTree - New tree.
     * @returns Resulting tree.
     */
    setTree(relativePath, newTree) {
      if (pathIsEmpty(relativePath)) {
        return newTree;
      } else {
        const front = pathGetFront(relativePath);
        const child = this.children.get(front) || new ImmutableTree(null);
        const newChild = child.setTree(pathPopFront(relativePath), newTree);
        let newChildren;
        if (newChild.isEmpty()) {
          newChildren = this.children.remove(front);
        } else {
          newChildren = this.children.insert(front, newChild);
        }
        return new ImmutableTree(this.value, newChildren);
      }
    }
    /**
     * Performs a depth first fold on this tree. Transforms a tree into a single
     * value, given a function that operates on the path to a node, an optional
     * current value, and a map of child names to folded subtrees
     */
    fold(fn) {
      return this.fold_(newEmptyPath(), fn);
    }
    /**
     * Recursive helper for public-facing fold() method
     */
    fold_(pathSoFar, fn) {
      const accum = {};
      this.children.inorderTraversal((childKey, childTree) => {
        accum[childKey] = childTree.fold_(pathChild(pathSoFar, childKey), fn);
      });
      return fn(pathSoFar, this.value, accum);
    }
    /**
     * Find the first matching value on the given path. Return the result of applying f to it.
     */
    findOnPath(path, f) {
      return this.findOnPath_(path, newEmptyPath(), f);
    }
    findOnPath_(pathToFollow, pathSoFar, f) {
      const result2 = this.value ? f(pathSoFar, this.value) : false;
      if (result2) {
        return result2;
      } else {
        if (pathIsEmpty(pathToFollow)) {
          return null;
        } else {
          const front = pathGetFront(pathToFollow);
          const nextChild = this.children.get(front);
          if (nextChild) {
            return nextChild.findOnPath_(pathPopFront(pathToFollow), pathChild(pathSoFar, front), f);
          } else {
            return null;
          }
        }
      }
    }
    foreachOnPath(path, f) {
      return this.foreachOnPath_(path, newEmptyPath(), f);
    }
    foreachOnPath_(pathToFollow, currentRelativePath, f) {
      if (pathIsEmpty(pathToFollow)) {
        return this;
      } else {
        if (this.value) {
          f(currentRelativePath, this.value);
        }
        const front = pathGetFront(pathToFollow);
        const nextChild = this.children.get(front);
        if (nextChild) {
          return nextChild.foreachOnPath_(pathPopFront(pathToFollow), pathChild(currentRelativePath, front), f);
        } else {
          return new ImmutableTree(null);
        }
      }
    }
    /**
     * Calls the given function for each node in the tree that has a value.
     *
     * @param f - A function to be called with the path from the root of the tree to
     * a node, and the value at that node. Called in depth-first order.
     */
    foreach(f) {
      this.foreach_(newEmptyPath(), f);
    }
    foreach_(currentRelativePath, f) {
      this.children.inorderTraversal((childName, childTree) => {
        childTree.foreach_(pathChild(currentRelativePath, childName), f);
      });
      if (this.value) {
        f(currentRelativePath, this.value);
      }
    }
    foreachChild(f) {
      this.children.inorderTraversal((childName, childTree) => {
        if (childTree.value) {
          f(childName, childTree.value);
        }
      });
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class CompoundWrite {
    constructor(writeTree_) {
      this.writeTree_ = writeTree_;
    }
    static empty() {
      return new CompoundWrite(new ImmutableTree(null));
    }
  }
  function compoundWriteAddWrite(compoundWrite, path, node) {
    if (pathIsEmpty(path)) {
      return new CompoundWrite(new ImmutableTree(node));
    } else {
      const rootmost = compoundWrite.writeTree_.findRootMostValueAndPath(path);
      if (rootmost != null) {
        const rootMostPath = rootmost.path;
        let value = rootmost.value;
        const relativePath = newRelativePath(rootMostPath, path);
        value = value.updateChild(relativePath, node);
        return new CompoundWrite(compoundWrite.writeTree_.set(rootMostPath, value));
      } else {
        const subtree = new ImmutableTree(node);
        const newWriteTree2 = compoundWrite.writeTree_.setTree(path, subtree);
        return new CompoundWrite(newWriteTree2);
      }
    }
  }
  function compoundWriteAddWrites(compoundWrite, path, updates) {
    let newWrite = compoundWrite;
    each(updates, (childKey, node) => {
      newWrite = compoundWriteAddWrite(newWrite, pathChild(path, childKey), node);
    });
    return newWrite;
  }
  function compoundWriteRemoveWrite(compoundWrite, path) {
    if (pathIsEmpty(path)) {
      return CompoundWrite.empty();
    } else {
      const newWriteTree2 = compoundWrite.writeTree_.setTree(path, new ImmutableTree(null));
      return new CompoundWrite(newWriteTree2);
    }
  }
  function compoundWriteHasCompleteWrite(compoundWrite, path) {
    return compoundWriteGetCompleteNode(compoundWrite, path) != null;
  }
  function compoundWriteGetCompleteNode(compoundWrite, path) {
    const rootmost = compoundWrite.writeTree_.findRootMostValueAndPath(path);
    if (rootmost != null) {
      return compoundWrite.writeTree_.get(rootmost.path).getChild(newRelativePath(rootmost.path, path));
    } else {
      return null;
    }
  }
  function compoundWriteGetCompleteChildren(compoundWrite) {
    const children = [];
    const node = compoundWrite.writeTree_.value;
    if (node != null) {
      if (!node.isLeafNode()) {
        node.forEachChild(PRIORITY_INDEX, (childName, childNode) => {
          children.push(new NamedNode(childName, childNode));
        });
      }
    } else {
      compoundWrite.writeTree_.children.inorderTraversal((childName, childTree) => {
        if (childTree.value != null) {
          children.push(new NamedNode(childName, childTree.value));
        }
      });
    }
    return children;
  }
  function compoundWriteChildCompoundWrite(compoundWrite, path) {
    if (pathIsEmpty(path)) {
      return compoundWrite;
    } else {
      const shadowingNode = compoundWriteGetCompleteNode(compoundWrite, path);
      if (shadowingNode != null) {
        return new CompoundWrite(new ImmutableTree(shadowingNode));
      } else {
        return new CompoundWrite(compoundWrite.writeTree_.subtree(path));
      }
    }
  }
  function compoundWriteIsEmpty(compoundWrite) {
    return compoundWrite.writeTree_.isEmpty();
  }
  function compoundWriteApply(compoundWrite, node) {
    return applySubtreeWrite(newEmptyPath(), compoundWrite.writeTree_, node);
  }
  function applySubtreeWrite(relativePath, writeTree, node) {
    if (writeTree.value != null) {
      return node.updateChild(relativePath, writeTree.value);
    } else {
      let priorityWrite = null;
      writeTree.children.inorderTraversal((childKey, childTree) => {
        if (childKey === ".priority") {
          assert(childTree.value !== null, "Priority writes must always be leaf nodes");
          priorityWrite = childTree.value;
        } else {
          node = applySubtreeWrite(pathChild(relativePath, childKey), childTree, node);
        }
      });
      if (!node.getChild(relativePath).isEmpty() && priorityWrite !== null) {
        node = node.updateChild(pathChild(relativePath, ".priority"), priorityWrite);
      }
      return node;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function writeTreeChildWrites(writeTree, path) {
    return newWriteTreeRef(path, writeTree);
  }
  function writeTreeAddOverwrite(writeTree, path, snap, writeId, visible) {
    assert(writeId > writeTree.lastWriteId, "Stacking an older write on top of newer ones");
    if (visible === void 0) {
      visible = true;
    }
    writeTree.allWrites.push({
      path,
      snap,
      writeId,
      visible
    });
    if (visible) {
      writeTree.visibleWrites = compoundWriteAddWrite(writeTree.visibleWrites, path, snap);
    }
    writeTree.lastWriteId = writeId;
  }
  function writeTreeGetWrite(writeTree, writeId) {
    for (let i = 0; i < writeTree.allWrites.length; i++) {
      const record = writeTree.allWrites[i];
      if (record.writeId === writeId) {
        return record;
      }
    }
    return null;
  }
  function writeTreeRemoveWrite(writeTree, writeId) {
    const idx = writeTree.allWrites.findIndex((s) => {
      return s.writeId === writeId;
    });
    assert(idx >= 0, "removeWrite called with nonexistent writeId.");
    const writeToRemove = writeTree.allWrites[idx];
    writeTree.allWrites.splice(idx, 1);
    let removedWriteWasVisible = writeToRemove.visible;
    let removedWriteOverlapsWithOtherWrites = false;
    let i = writeTree.allWrites.length - 1;
    while (removedWriteWasVisible && i >= 0) {
      const currentWrite = writeTree.allWrites[i];
      if (currentWrite.visible) {
        if (i >= idx && writeTreeRecordContainsPath_(currentWrite, writeToRemove.path)) {
          removedWriteWasVisible = false;
        } else if (pathContains(writeToRemove.path, currentWrite.path)) {
          removedWriteOverlapsWithOtherWrites = true;
        }
      }
      i--;
    }
    if (!removedWriteWasVisible) {
      return false;
    } else if (removedWriteOverlapsWithOtherWrites) {
      writeTreeResetTree_(writeTree);
      return true;
    } else {
      if (writeToRemove.snap) {
        writeTree.visibleWrites = compoundWriteRemoveWrite(writeTree.visibleWrites, writeToRemove.path);
      } else {
        const children = writeToRemove.children;
        each(children, (childName) => {
          writeTree.visibleWrites = compoundWriteRemoveWrite(writeTree.visibleWrites, pathChild(writeToRemove.path, childName));
        });
      }
      return true;
    }
  }
  function writeTreeRecordContainsPath_(writeRecord, path) {
    if (writeRecord.snap) {
      return pathContains(writeRecord.path, path);
    } else {
      for (const childName in writeRecord.children) {
        if (writeRecord.children.hasOwnProperty(childName) && pathContains(pathChild(writeRecord.path, childName), path)) {
          return true;
        }
      }
      return false;
    }
  }
  function writeTreeResetTree_(writeTree) {
    writeTree.visibleWrites = writeTreeLayerTree_(writeTree.allWrites, writeTreeDefaultFilter_, newEmptyPath());
    if (writeTree.allWrites.length > 0) {
      writeTree.lastWriteId = writeTree.allWrites[writeTree.allWrites.length - 1].writeId;
    } else {
      writeTree.lastWriteId = -1;
    }
  }
  function writeTreeDefaultFilter_(write) {
    return write.visible;
  }
  function writeTreeLayerTree_(writes, filter, treeRoot) {
    let compoundWrite = CompoundWrite.empty();
    for (let i = 0; i < writes.length; ++i) {
      const write = writes[i];
      if (filter(write)) {
        const writePath = write.path;
        let relativePath;
        if (write.snap) {
          if (pathContains(treeRoot, writePath)) {
            relativePath = newRelativePath(treeRoot, writePath);
            compoundWrite = compoundWriteAddWrite(compoundWrite, relativePath, write.snap);
          } else if (pathContains(writePath, treeRoot)) {
            relativePath = newRelativePath(writePath, treeRoot);
            compoundWrite = compoundWriteAddWrite(compoundWrite, newEmptyPath(), write.snap.getChild(relativePath));
          } else ;
        } else if (write.children) {
          if (pathContains(treeRoot, writePath)) {
            relativePath = newRelativePath(treeRoot, writePath);
            compoundWrite = compoundWriteAddWrites(compoundWrite, relativePath, write.children);
          } else if (pathContains(writePath, treeRoot)) {
            relativePath = newRelativePath(writePath, treeRoot);
            if (pathIsEmpty(relativePath)) {
              compoundWrite = compoundWriteAddWrites(compoundWrite, newEmptyPath(), write.children);
            } else {
              const child = safeGet(write.children, pathGetFront(relativePath));
              if (child) {
                const deepNode = child.getChild(pathPopFront(relativePath));
                compoundWrite = compoundWriteAddWrite(compoundWrite, newEmptyPath(), deepNode);
              }
            }
          } else ;
        } else {
          throw assertionError("WriteRecord should have .snap or .children");
        }
      }
    }
    return compoundWrite;
  }
  function writeTreeCalcCompleteEventCache(writeTree, treePath, completeServerCache, writeIdsToExclude, includeHiddenWrites) {
    if (!writeIdsToExclude && !includeHiddenWrites) {
      const shadowingNode = compoundWriteGetCompleteNode(writeTree.visibleWrites, treePath);
      if (shadowingNode != null) {
        return shadowingNode;
      } else {
        const subMerge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);
        if (compoundWriteIsEmpty(subMerge)) {
          return completeServerCache;
        } else if (completeServerCache == null && !compoundWriteHasCompleteWrite(subMerge, newEmptyPath())) {
          return null;
        } else {
          const layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;
          return compoundWriteApply(subMerge, layeredCache);
        }
      }
    } else {
      const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);
      if (!includeHiddenWrites && compoundWriteIsEmpty(merge)) {
        return completeServerCache;
      } else {
        if (!includeHiddenWrites && completeServerCache == null && !compoundWriteHasCompleteWrite(merge, newEmptyPath())) {
          return null;
        } else {
          const filter = function(write) {
            return (write.visible || includeHiddenWrites) && (!writeIdsToExclude || !~writeIdsToExclude.indexOf(write.writeId)) && (pathContains(write.path, treePath) || pathContains(treePath, write.path));
          };
          const mergeAtPath = writeTreeLayerTree_(writeTree.allWrites, filter, treePath);
          const layeredCache = completeServerCache || ChildrenNode.EMPTY_NODE;
          return compoundWriteApply(mergeAtPath, layeredCache);
        }
      }
    }
  }
  function writeTreeCalcCompleteEventChildren(writeTree, treePath, completeServerChildren) {
    let completeChildren = ChildrenNode.EMPTY_NODE;
    const topLevelSet = compoundWriteGetCompleteNode(writeTree.visibleWrites, treePath);
    if (topLevelSet) {
      if (!topLevelSet.isLeafNode()) {
        topLevelSet.forEachChild(PRIORITY_INDEX, (childName, childSnap) => {
          completeChildren = completeChildren.updateImmediateChild(childName, childSnap);
        });
      }
      return completeChildren;
    } else if (completeServerChildren) {
      const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);
      completeServerChildren.forEachChild(PRIORITY_INDEX, (childName, childNode) => {
        const node = compoundWriteApply(compoundWriteChildCompoundWrite(merge, new Path(childName)), childNode);
        completeChildren = completeChildren.updateImmediateChild(childName, node);
      });
      compoundWriteGetCompleteChildren(merge).forEach((namedNode) => {
        completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);
      });
      return completeChildren;
    } else {
      const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);
      compoundWriteGetCompleteChildren(merge).forEach((namedNode) => {
        completeChildren = completeChildren.updateImmediateChild(namedNode.name, namedNode.node);
      });
      return completeChildren;
    }
  }
  function writeTreeCalcEventCacheAfterServerOverwrite(writeTree, treePath, childPath, existingEventSnap, existingServerSnap) {
    assert(existingEventSnap || existingServerSnap, "Either existingEventSnap or existingServerSnap must exist");
    const path = pathChild(treePath, childPath);
    if (compoundWriteHasCompleteWrite(writeTree.visibleWrites, path)) {
      return null;
    } else {
      const childMerge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, path);
      if (compoundWriteIsEmpty(childMerge)) {
        return existingServerSnap.getChild(childPath);
      } else {
        return compoundWriteApply(childMerge, existingServerSnap.getChild(childPath));
      }
    }
  }
  function writeTreeCalcCompleteChild(writeTree, treePath, childKey, existingServerSnap) {
    const path = pathChild(treePath, childKey);
    const shadowingNode = compoundWriteGetCompleteNode(writeTree.visibleWrites, path);
    if (shadowingNode != null) {
      return shadowingNode;
    } else {
      if (existingServerSnap.isCompleteForChild(childKey)) {
        const childMerge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, path);
        return compoundWriteApply(childMerge, existingServerSnap.getNode().getImmediateChild(childKey));
      } else {
        return null;
      }
    }
  }
  function writeTreeShadowingWrite(writeTree, path) {
    return compoundWriteGetCompleteNode(writeTree.visibleWrites, path);
  }
  function writeTreeCalcIndexedSlice(writeTree, treePath, completeServerData, startPost, count, reverse, index) {
    let toIterate;
    const merge = compoundWriteChildCompoundWrite(writeTree.visibleWrites, treePath);
    const shadowingNode = compoundWriteGetCompleteNode(merge, newEmptyPath());
    if (shadowingNode != null) {
      toIterate = shadowingNode;
    } else if (completeServerData != null) {
      toIterate = compoundWriteApply(merge, completeServerData);
    } else {
      return [];
    }
    toIterate = toIterate.withIndex(index);
    if (!toIterate.isEmpty() && !toIterate.isLeafNode()) {
      const nodes = [];
      const cmp = index.getCompare();
      const iter = reverse ? toIterate.getReverseIteratorFrom(startPost, index) : toIterate.getIteratorFrom(startPost, index);
      let next = iter.getNext();
      while (next && nodes.length < count) {
        if (cmp(next, startPost) !== 0) {
          nodes.push(next);
        }
        next = iter.getNext();
      }
      return nodes;
    } else {
      return [];
    }
  }
  function newWriteTree() {
    return {
      visibleWrites: CompoundWrite.empty(),
      allWrites: [],
      lastWriteId: -1
    };
  }
  function writeTreeRefCalcCompleteEventCache(writeTreeRef, completeServerCache, writeIdsToExclude, includeHiddenWrites) {
    return writeTreeCalcCompleteEventCache(writeTreeRef.writeTree, writeTreeRef.treePath, completeServerCache, writeIdsToExclude, includeHiddenWrites);
  }
  function writeTreeRefCalcCompleteEventChildren(writeTreeRef, completeServerChildren) {
    return writeTreeCalcCompleteEventChildren(writeTreeRef.writeTree, writeTreeRef.treePath, completeServerChildren);
  }
  function writeTreeRefCalcEventCacheAfterServerOverwrite(writeTreeRef, path, existingEventSnap, existingServerSnap) {
    return writeTreeCalcEventCacheAfterServerOverwrite(writeTreeRef.writeTree, writeTreeRef.treePath, path, existingEventSnap, existingServerSnap);
  }
  function writeTreeRefShadowingWrite(writeTreeRef, path) {
    return writeTreeShadowingWrite(writeTreeRef.writeTree, pathChild(writeTreeRef.treePath, path));
  }
  function writeTreeRefCalcIndexedSlice(writeTreeRef, completeServerData, startPost, count, reverse, index) {
    return writeTreeCalcIndexedSlice(writeTreeRef.writeTree, writeTreeRef.treePath, completeServerData, startPost, count, reverse, index);
  }
  function writeTreeRefCalcCompleteChild(writeTreeRef, childKey, existingServerCache) {
    return writeTreeCalcCompleteChild(writeTreeRef.writeTree, writeTreeRef.treePath, childKey, existingServerCache);
  }
  function writeTreeRefChild(writeTreeRef, childName) {
    return newWriteTreeRef(pathChild(writeTreeRef.treePath, childName), writeTreeRef.writeTree);
  }
  function newWriteTreeRef(path, writeTree) {
    return {
      treePath: path,
      writeTree
    };
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ChildChangeAccumulator {
    constructor() {
      this.changeMap = /* @__PURE__ */ new Map();
    }
    trackChildChange(change) {
      const type = change.type;
      const childKey = change.childName;
      assert(type === "child_added" || type === "child_changed" || type === "child_removed", "Only child changes supported for tracking");
      assert(childKey !== ".priority", "Only non-priority child changes can be tracked.");
      const oldChange = this.changeMap.get(childKey);
      if (oldChange) {
        const oldType = oldChange.type;
        if (type === "child_added" && oldType === "child_removed") {
          this.changeMap.set(childKey, changeChildChanged(childKey, change.snapshotNode, oldChange.snapshotNode));
        } else if (type === "child_removed" && oldType === "child_added") {
          this.changeMap.delete(childKey);
        } else if (type === "child_removed" && oldType === "child_changed") {
          this.changeMap.set(childKey, changeChildRemoved(childKey, oldChange.oldSnap));
        } else if (type === "child_changed" && oldType === "child_added") {
          this.changeMap.set(childKey, changeChildAdded(childKey, change.snapshotNode));
        } else if (type === "child_changed" && oldType === "child_changed") {
          this.changeMap.set(childKey, changeChildChanged(childKey, change.snapshotNode, oldChange.oldSnap));
        } else {
          throw assertionError("Illegal combination of changes: " + change + " occurred after " + oldChange);
        }
      } else {
        this.changeMap.set(childKey, change);
      }
    }
    getChanges() {
      return Array.from(this.changeMap.values());
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class NoCompleteChildSource_ {
    getCompleteChild(childKey) {
      return null;
    }
    getChildAfterChild(index, child, reverse) {
      return null;
    }
  }
  const NO_COMPLETE_CHILD_SOURCE = new NoCompleteChildSource_();
  class WriteTreeCompleteChildSource {
    constructor(writes_, viewCache_, optCompleteServerCache_ = null) {
      this.writes_ = writes_;
      this.viewCache_ = viewCache_;
      this.optCompleteServerCache_ = optCompleteServerCache_;
    }
    getCompleteChild(childKey) {
      const node = this.viewCache_.eventCache;
      if (node.isCompleteForChild(childKey)) {
        return node.getNode().getImmediateChild(childKey);
      } else {
        const serverNode = this.optCompleteServerCache_ != null ? new CacheNode(this.optCompleteServerCache_, true, false) : this.viewCache_.serverCache;
        return writeTreeRefCalcCompleteChild(this.writes_, childKey, serverNode);
      }
    }
    getChildAfterChild(index, child, reverse) {
      const completeServerData = this.optCompleteServerCache_ != null ? this.optCompleteServerCache_ : viewCacheGetCompleteServerSnap(this.viewCache_);
      const nodes = writeTreeRefCalcIndexedSlice(this.writes_, completeServerData, child, 1, reverse, index);
      if (nodes.length === 0) {
        return null;
      } else {
        return nodes[0];
      }
    }
  }
  function viewProcessorAssertIndexed(viewProcessor, viewCache) {
    assert(viewCache.eventCache.getNode().isIndexed(viewProcessor.filter.getIndex()), "Event snap not indexed");
    assert(viewCache.serverCache.getNode().isIndexed(viewProcessor.filter.getIndex()), "Server snap not indexed");
  }
  function viewProcessorApplyOperation(viewProcessor, oldViewCache, operation, writesCache, completeCache) {
    const accumulator = new ChildChangeAccumulator();
    let newViewCache2, filterServerNode;
    if (operation.type === OperationType.OVERWRITE) {
      const overwrite = operation;
      if (overwrite.source.fromUser) {
        newViewCache2 = viewProcessorApplyUserOverwrite(viewProcessor, oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, accumulator);
      } else {
        assert(overwrite.source.fromServer, "Unknown source.");
        filterServerNode = overwrite.source.tagged || oldViewCache.serverCache.isFiltered() && !pathIsEmpty(overwrite.path);
        newViewCache2 = viewProcessorApplyServerOverwrite(viewProcessor, oldViewCache, overwrite.path, overwrite.snap, writesCache, completeCache, filterServerNode, accumulator);
      }
    } else if (operation.type === OperationType.MERGE) {
      const merge = operation;
      if (merge.source.fromUser) {
        newViewCache2 = viewProcessorApplyUserMerge(viewProcessor, oldViewCache, merge.path, merge.children, writesCache, completeCache, accumulator);
      } else {
        assert(merge.source.fromServer, "Unknown source.");
        filterServerNode = merge.source.tagged || oldViewCache.serverCache.isFiltered();
        newViewCache2 = viewProcessorApplyServerMerge(viewProcessor, oldViewCache, merge.path, merge.children, writesCache, completeCache, filterServerNode, accumulator);
      }
    } else if (operation.type === OperationType.ACK_USER_WRITE) {
      const ackUserWrite = operation;
      if (!ackUserWrite.revert) {
        newViewCache2 = viewProcessorAckUserWrite(viewProcessor, oldViewCache, ackUserWrite.path, ackUserWrite.affectedTree, writesCache, completeCache, accumulator);
      } else {
        newViewCache2 = viewProcessorRevertUserWrite(viewProcessor, oldViewCache, ackUserWrite.path, writesCache, completeCache, accumulator);
      }
    } else if (operation.type === OperationType.LISTEN_COMPLETE) {
      newViewCache2 = viewProcessorListenComplete(viewProcessor, oldViewCache, operation.path, writesCache, accumulator);
    } else {
      throw assertionError("Unknown operation type: " + operation.type);
    }
    const changes = accumulator.getChanges();
    viewProcessorMaybeAddValueEvent(oldViewCache, newViewCache2, changes);
    return { viewCache: newViewCache2, changes };
  }
  function viewProcessorMaybeAddValueEvent(oldViewCache, newViewCache2, accumulator) {
    const eventSnap = newViewCache2.eventCache;
    if (eventSnap.isFullyInitialized()) {
      const isLeafOrEmpty = eventSnap.getNode().isLeafNode() || eventSnap.getNode().isEmpty();
      const oldCompleteSnap = viewCacheGetCompleteEventSnap(oldViewCache);
      if (accumulator.length > 0 || !oldViewCache.eventCache.isFullyInitialized() || isLeafOrEmpty && !eventSnap.getNode().equals(oldCompleteSnap) || !eventSnap.getNode().getPriority().equals(oldCompleteSnap.getPriority())) {
        accumulator.push(changeValue(viewCacheGetCompleteEventSnap(newViewCache2)));
      }
    }
  }
  function viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor, viewCache, changePath, writesCache, source, accumulator) {
    const oldEventSnap = viewCache.eventCache;
    if (writeTreeRefShadowingWrite(writesCache, changePath) != null) {
      return viewCache;
    } else {
      let newEventCache, serverNode;
      if (pathIsEmpty(changePath)) {
        assert(viewCache.serverCache.isFullyInitialized(), "If change path is empty, we must have complete server data");
        if (viewCache.serverCache.isFiltered()) {
          const serverCache = viewCacheGetCompleteServerSnap(viewCache);
          const completeChildren = serverCache instanceof ChildrenNode ? serverCache : ChildrenNode.EMPTY_NODE;
          const completeEventChildren = writeTreeRefCalcCompleteEventChildren(writesCache, completeChildren);
          newEventCache = viewProcessor.filter.updateFullNode(viewCache.eventCache.getNode(), completeEventChildren, accumulator);
        } else {
          const completeNode = writeTreeRefCalcCompleteEventCache(writesCache, viewCacheGetCompleteServerSnap(viewCache));
          newEventCache = viewProcessor.filter.updateFullNode(viewCache.eventCache.getNode(), completeNode, accumulator);
        }
      } else {
        const childKey = pathGetFront(changePath);
        if (childKey === ".priority") {
          assert(pathGetLength(changePath) === 1, "Can't have a priority with additional path components");
          const oldEventNode = oldEventSnap.getNode();
          serverNode = viewCache.serverCache.getNode();
          const updatedPriority = writeTreeRefCalcEventCacheAfterServerOverwrite(writesCache, changePath, oldEventNode, serverNode);
          if (updatedPriority != null) {
            newEventCache = viewProcessor.filter.updatePriority(oldEventNode, updatedPriority);
          } else {
            newEventCache = oldEventSnap.getNode();
          }
        } else {
          const childChangePath = pathPopFront(changePath);
          let newEventChild;
          if (oldEventSnap.isCompleteForChild(childKey)) {
            serverNode = viewCache.serverCache.getNode();
            const eventChildUpdate = writeTreeRefCalcEventCacheAfterServerOverwrite(writesCache, changePath, oldEventSnap.getNode(), serverNode);
            if (eventChildUpdate != null) {
              newEventChild = oldEventSnap.getNode().getImmediateChild(childKey).updateChild(childChangePath, eventChildUpdate);
            } else {
              newEventChild = oldEventSnap.getNode().getImmediateChild(childKey);
            }
          } else {
            newEventChild = writeTreeRefCalcCompleteChild(writesCache, childKey, viewCache.serverCache);
          }
          if (newEventChild != null) {
            newEventCache = viewProcessor.filter.updateChild(oldEventSnap.getNode(), childKey, newEventChild, childChangePath, source, accumulator);
          } else {
            newEventCache = oldEventSnap.getNode();
          }
        }
      }
      return viewCacheUpdateEventSnap(viewCache, newEventCache, oldEventSnap.isFullyInitialized() || pathIsEmpty(changePath), viewProcessor.filter.filtersNodes());
    }
  }
  function viewProcessorApplyServerOverwrite(viewProcessor, oldViewCache, changePath, changedSnap, writesCache, completeCache, filterServerNode, accumulator) {
    const oldServerSnap = oldViewCache.serverCache;
    let newServerCache;
    const serverFilter = filterServerNode ? viewProcessor.filter : viewProcessor.filter.getIndexedFilter();
    if (pathIsEmpty(changePath)) {
      newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), changedSnap, null);
    } else if (serverFilter.filtersNodes() && !oldServerSnap.isFiltered()) {
      const newServerNode = oldServerSnap.getNode().updateChild(changePath, changedSnap);
      newServerCache = serverFilter.updateFullNode(oldServerSnap.getNode(), newServerNode, null);
    } else {
      const childKey = pathGetFront(changePath);
      if (!oldServerSnap.isCompleteForPath(changePath) && pathGetLength(changePath) > 1) {
        return oldViewCache;
      }
      const childChangePath = pathPopFront(changePath);
      const childNode = oldServerSnap.getNode().getImmediateChild(childKey);
      const newChildNode = childNode.updateChild(childChangePath, changedSnap);
      if (childKey === ".priority") {
        newServerCache = serverFilter.updatePriority(oldServerSnap.getNode(), newChildNode);
      } else {
        newServerCache = serverFilter.updateChild(oldServerSnap.getNode(), childKey, newChildNode, childChangePath, NO_COMPLETE_CHILD_SOURCE, null);
      }
    }
    const newViewCache2 = viewCacheUpdateServerSnap(oldViewCache, newServerCache, oldServerSnap.isFullyInitialized() || pathIsEmpty(changePath), serverFilter.filtersNodes());
    const source = new WriteTreeCompleteChildSource(writesCache, newViewCache2, completeCache);
    return viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor, newViewCache2, changePath, writesCache, source, accumulator);
  }
  function viewProcessorApplyUserOverwrite(viewProcessor, oldViewCache, changePath, changedSnap, writesCache, completeCache, accumulator) {
    const oldEventSnap = oldViewCache.eventCache;
    let newViewCache2, newEventCache;
    const source = new WriteTreeCompleteChildSource(writesCache, oldViewCache, completeCache);
    if (pathIsEmpty(changePath)) {
      newEventCache = viewProcessor.filter.updateFullNode(oldViewCache.eventCache.getNode(), changedSnap, accumulator);
      newViewCache2 = viewCacheUpdateEventSnap(oldViewCache, newEventCache, true, viewProcessor.filter.filtersNodes());
    } else {
      const childKey = pathGetFront(changePath);
      if (childKey === ".priority") {
        newEventCache = viewProcessor.filter.updatePriority(oldViewCache.eventCache.getNode(), changedSnap);
        newViewCache2 = viewCacheUpdateEventSnap(oldViewCache, newEventCache, oldEventSnap.isFullyInitialized(), oldEventSnap.isFiltered());
      } else {
        const childChangePath = pathPopFront(changePath);
        const oldChild = oldEventSnap.getNode().getImmediateChild(childKey);
        let newChild;
        if (pathIsEmpty(childChangePath)) {
          newChild = changedSnap;
        } else {
          const childNode = source.getCompleteChild(childKey);
          if (childNode != null) {
            if (pathGetBack(childChangePath) === ".priority" && childNode.getChild(pathParent(childChangePath)).isEmpty()) {
              newChild = childNode;
            } else {
              newChild = childNode.updateChild(childChangePath, changedSnap);
            }
          } else {
            newChild = ChildrenNode.EMPTY_NODE;
          }
        }
        if (!oldChild.equals(newChild)) {
          const newEventSnap = viewProcessor.filter.updateChild(oldEventSnap.getNode(), childKey, newChild, childChangePath, source, accumulator);
          newViewCache2 = viewCacheUpdateEventSnap(oldViewCache, newEventSnap, oldEventSnap.isFullyInitialized(), viewProcessor.filter.filtersNodes());
        } else {
          newViewCache2 = oldViewCache;
        }
      }
    }
    return newViewCache2;
  }
  function viewProcessorCacheHasChild(viewCache, childKey) {
    return viewCache.eventCache.isCompleteForChild(childKey);
  }
  function viewProcessorApplyUserMerge(viewProcessor, viewCache, path, changedChildren, writesCache, serverCache, accumulator) {
    let curViewCache = viewCache;
    changedChildren.foreach((relativePath, childNode) => {
      const writePath = pathChild(path, relativePath);
      if (viewProcessorCacheHasChild(viewCache, pathGetFront(writePath))) {
        curViewCache = viewProcessorApplyUserOverwrite(viewProcessor, curViewCache, writePath, childNode, writesCache, serverCache, accumulator);
      }
    });
    changedChildren.foreach((relativePath, childNode) => {
      const writePath = pathChild(path, relativePath);
      if (!viewProcessorCacheHasChild(viewCache, pathGetFront(writePath))) {
        curViewCache = viewProcessorApplyUserOverwrite(viewProcessor, curViewCache, writePath, childNode, writesCache, serverCache, accumulator);
      }
    });
    return curViewCache;
  }
  function viewProcessorApplyMerge(viewProcessor, node, merge) {
    merge.foreach((relativePath, childNode) => {
      node = node.updateChild(relativePath, childNode);
    });
    return node;
  }
  function viewProcessorApplyServerMerge(viewProcessor, viewCache, path, changedChildren, writesCache, serverCache, filterServerNode, accumulator) {
    if (viewCache.serverCache.getNode().isEmpty() && !viewCache.serverCache.isFullyInitialized()) {
      return viewCache;
    }
    let curViewCache = viewCache;
    let viewMergeTree;
    if (pathIsEmpty(path)) {
      viewMergeTree = changedChildren;
    } else {
      viewMergeTree = new ImmutableTree(null).setTree(path, changedChildren);
    }
    const serverNode = viewCache.serverCache.getNode();
    viewMergeTree.children.inorderTraversal((childKey, childTree) => {
      if (serverNode.hasChild(childKey)) {
        const serverChild = viewCache.serverCache.getNode().getImmediateChild(childKey);
        const newChild = viewProcessorApplyMerge(viewProcessor, serverChild, childTree);
        curViewCache = viewProcessorApplyServerOverwrite(viewProcessor, curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);
      }
    });
    viewMergeTree.children.inorderTraversal((childKey, childMergeTree) => {
      const isUnknownDeepMerge = !viewCache.serverCache.isCompleteForChild(childKey) && childMergeTree.value === null;
      if (!serverNode.hasChild(childKey) && !isUnknownDeepMerge) {
        const serverChild = viewCache.serverCache.getNode().getImmediateChild(childKey);
        const newChild = viewProcessorApplyMerge(viewProcessor, serverChild, childMergeTree);
        curViewCache = viewProcessorApplyServerOverwrite(viewProcessor, curViewCache, new Path(childKey), newChild, writesCache, serverCache, filterServerNode, accumulator);
      }
    });
    return curViewCache;
  }
  function viewProcessorAckUserWrite(viewProcessor, viewCache, ackPath, affectedTree, writesCache, completeCache, accumulator) {
    if (writeTreeRefShadowingWrite(writesCache, ackPath) != null) {
      return viewCache;
    }
    const filterServerNode = viewCache.serverCache.isFiltered();
    const serverCache = viewCache.serverCache;
    if (affectedTree.value != null) {
      if (pathIsEmpty(ackPath) && serverCache.isFullyInitialized() || serverCache.isCompleteForPath(ackPath)) {
        return viewProcessorApplyServerOverwrite(viewProcessor, viewCache, ackPath, serverCache.getNode().getChild(ackPath), writesCache, completeCache, filterServerNode, accumulator);
      } else if (pathIsEmpty(ackPath)) {
        let changedChildren = new ImmutableTree(null);
        serverCache.getNode().forEachChild(KEY_INDEX, (name2, node) => {
          changedChildren = changedChildren.set(new Path(name2), node);
        });
        return viewProcessorApplyServerMerge(viewProcessor, viewCache, ackPath, changedChildren, writesCache, completeCache, filterServerNode, accumulator);
      } else {
        return viewCache;
      }
    } else {
      let changedChildren = new ImmutableTree(null);
      affectedTree.foreach((mergePath, value) => {
        const serverCachePath = pathChild(ackPath, mergePath);
        if (serverCache.isCompleteForPath(serverCachePath)) {
          changedChildren = changedChildren.set(mergePath, serverCache.getNode().getChild(serverCachePath));
        }
      });
      return viewProcessorApplyServerMerge(viewProcessor, viewCache, ackPath, changedChildren, writesCache, completeCache, filterServerNode, accumulator);
    }
  }
  function viewProcessorListenComplete(viewProcessor, viewCache, path, writesCache, accumulator) {
    const oldServerNode = viewCache.serverCache;
    const newViewCache2 = viewCacheUpdateServerSnap(viewCache, oldServerNode.getNode(), oldServerNode.isFullyInitialized() || pathIsEmpty(path), oldServerNode.isFiltered());
    return viewProcessorGenerateEventCacheAfterServerEvent(viewProcessor, newViewCache2, path, writesCache, NO_COMPLETE_CHILD_SOURCE, accumulator);
  }
  function viewProcessorRevertUserWrite(viewProcessor, viewCache, path, writesCache, completeServerCache, accumulator) {
    let complete;
    if (writeTreeRefShadowingWrite(writesCache, path) != null) {
      return viewCache;
    } else {
      const source = new WriteTreeCompleteChildSource(writesCache, viewCache, completeServerCache);
      const oldEventCache = viewCache.eventCache.getNode();
      let newEventCache;
      if (pathIsEmpty(path) || pathGetFront(path) === ".priority") {
        let newNode;
        if (viewCache.serverCache.isFullyInitialized()) {
          newNode = writeTreeRefCalcCompleteEventCache(writesCache, viewCacheGetCompleteServerSnap(viewCache));
        } else {
          const serverChildren = viewCache.serverCache.getNode();
          assert(serverChildren instanceof ChildrenNode, "serverChildren would be complete if leaf node");
          newNode = writeTreeRefCalcCompleteEventChildren(writesCache, serverChildren);
        }
        newNode = newNode;
        newEventCache = viewProcessor.filter.updateFullNode(oldEventCache, newNode, accumulator);
      } else {
        const childKey = pathGetFront(path);
        let newChild = writeTreeRefCalcCompleteChild(writesCache, childKey, viewCache.serverCache);
        if (newChild == null && viewCache.serverCache.isCompleteForChild(childKey)) {
          newChild = oldEventCache.getImmediateChild(childKey);
        }
        if (newChild != null) {
          newEventCache = viewProcessor.filter.updateChild(oldEventCache, childKey, newChild, pathPopFront(path), source, accumulator);
        } else if (viewCache.eventCache.getNode().hasChild(childKey)) {
          newEventCache = viewProcessor.filter.updateChild(oldEventCache, childKey, ChildrenNode.EMPTY_NODE, pathPopFront(path), source, accumulator);
        } else {
          newEventCache = oldEventCache;
        }
        if (newEventCache.isEmpty() && viewCache.serverCache.isFullyInitialized()) {
          complete = writeTreeRefCalcCompleteEventCache(writesCache, viewCacheGetCompleteServerSnap(viewCache));
          if (complete.isLeafNode()) {
            newEventCache = viewProcessor.filter.updateFullNode(newEventCache, complete, accumulator);
          }
        }
      }
      complete = viewCache.serverCache.isFullyInitialized() || writeTreeRefShadowingWrite(writesCache, newEmptyPath()) != null;
      return viewCacheUpdateEventSnap(viewCache, newEventCache, complete, viewProcessor.filter.filtersNodes());
    }
  }
  function viewGetCompleteServerCache(view, path) {
    const cache = viewCacheGetCompleteServerSnap(view.viewCache_);
    if (cache) {
      if (view.query._queryParams.loadsAllData() || !pathIsEmpty(path) && !cache.getImmediateChild(pathGetFront(path)).isEmpty()) {
        return cache.getChild(path);
      }
    }
    return null;
  }
  function viewApplyOperation(view, operation, writesCache, completeServerCache) {
    if (operation.type === OperationType.MERGE && operation.source.queryId !== null) {
      assert(viewCacheGetCompleteServerSnap(view.viewCache_), "We should always have a full cache before handling merges");
      assert(viewCacheGetCompleteEventSnap(view.viewCache_), "Missing event cache, even though we have a server cache");
    }
    const oldViewCache = view.viewCache_;
    const result2 = viewProcessorApplyOperation(view.processor_, oldViewCache, operation, writesCache, completeServerCache);
    viewProcessorAssertIndexed(view.processor_, result2.viewCache);
    assert(result2.viewCache.serverCache.isFullyInitialized() || !oldViewCache.serverCache.isFullyInitialized(), "Once a server snap is complete, it should never go back");
    view.viewCache_ = result2.viewCache;
    return viewGenerateEventsForChanges_(view, result2.changes, result2.viewCache.eventCache.getNode());
  }
  function viewGenerateEventsForChanges_(view, changes, eventCache, eventRegistration) {
    const registrations = view.eventRegistrations_;
    return eventGeneratorGenerateEventsForChanges(view.eventGenerator_, changes, eventCache, registrations);
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let referenceConstructor$1;
  function syncPointSetReferenceConstructor(val) {
    assert(!referenceConstructor$1, "__referenceConstructor has already been defined");
    referenceConstructor$1 = val;
  }
  function syncPointApplyOperation(syncPoint, operation, writesCache, optCompleteServerCache) {
    const queryId = operation.source.queryId;
    if (queryId !== null) {
      const view = syncPoint.views.get(queryId);
      assert(view != null, "SyncTree gave us an op for an invalid query.");
      return viewApplyOperation(view, operation, writesCache, optCompleteServerCache);
    } else {
      let events = [];
      for (const view of syncPoint.views.values()) {
        events = events.concat(viewApplyOperation(view, operation, writesCache, optCompleteServerCache));
      }
      return events;
    }
  }
  function syncPointGetCompleteServerCache(syncPoint, path) {
    let serverCache = null;
    for (const view of syncPoint.views.values()) {
      serverCache = serverCache || viewGetCompleteServerCache(view, path);
    }
    return serverCache;
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  let referenceConstructor;
  function syncTreeSetReferenceConstructor(val) {
    assert(!referenceConstructor, "__referenceConstructor has already been defined");
    referenceConstructor = val;
  }
  class SyncTree {
    /**
     * @param listenProvider_ - Used by SyncTree to start / stop listening
     *   to server data.
     */
    constructor(listenProvider_) {
      this.listenProvider_ = listenProvider_;
      this.syncPointTree_ = new ImmutableTree(null);
      this.pendingWriteTree_ = newWriteTree();
      this.tagToQueryMap = /* @__PURE__ */ new Map();
      this.queryToTagMap = /* @__PURE__ */ new Map();
    }
  }
  function syncTreeApplyUserOverwrite(syncTree, path, newData, writeId, visible) {
    writeTreeAddOverwrite(syncTree.pendingWriteTree_, path, newData, writeId, visible);
    if (!visible) {
      return [];
    } else {
      return syncTreeApplyOperationToSyncPoints_(syncTree, new Overwrite(newOperationSourceUser(), path, newData));
    }
  }
  function syncTreeAckUserWrite(syncTree, writeId, revert = false) {
    const write = writeTreeGetWrite(syncTree.pendingWriteTree_, writeId);
    const needToReevaluate = writeTreeRemoveWrite(syncTree.pendingWriteTree_, writeId);
    if (!needToReevaluate) {
      return [];
    } else {
      let affectedTree = new ImmutableTree(null);
      if (write.snap != null) {
        affectedTree = affectedTree.set(newEmptyPath(), true);
      } else {
        each(write.children, (pathString) => {
          affectedTree = affectedTree.set(new Path(pathString), true);
        });
      }
      return syncTreeApplyOperationToSyncPoints_(syncTree, new AckUserWrite(write.path, affectedTree, revert));
    }
  }
  function syncTreeApplyServerOverwrite(syncTree, path, newData) {
    return syncTreeApplyOperationToSyncPoints_(syncTree, new Overwrite(newOperationSourceServer(), path, newData));
  }
  function syncTreeApplyServerMerge(syncTree, path, changedChildren) {
    const changeTree = ImmutableTree.fromObject(changedChildren);
    return syncTreeApplyOperationToSyncPoints_(syncTree, new Merge(newOperationSourceServer(), path, changeTree));
  }
  function syncTreeApplyTaggedQueryOverwrite(syncTree, path, snap, tag) {
    const queryKey = syncTreeQueryKeyForTag_(syncTree, tag);
    if (queryKey != null) {
      const r = syncTreeParseQueryKey_(queryKey);
      const queryPath = r.path, queryId = r.queryId;
      const relativePath = newRelativePath(queryPath, path);
      const op = new Overwrite(newOperationSourceServerTaggedQuery(queryId), relativePath, snap);
      return syncTreeApplyTaggedOperation_(syncTree, queryPath, op);
    } else {
      return [];
    }
  }
  function syncTreeApplyTaggedQueryMerge(syncTree, path, changedChildren, tag) {
    const queryKey = syncTreeQueryKeyForTag_(syncTree, tag);
    if (queryKey) {
      const r = syncTreeParseQueryKey_(queryKey);
      const queryPath = r.path, queryId = r.queryId;
      const relativePath = newRelativePath(queryPath, path);
      const changeTree = ImmutableTree.fromObject(changedChildren);
      const op = new Merge(newOperationSourceServerTaggedQuery(queryId), relativePath, changeTree);
      return syncTreeApplyTaggedOperation_(syncTree, queryPath, op);
    } else {
      return [];
    }
  }
  function syncTreeCalcCompleteEventCache(syncTree, path, writeIdsToExclude) {
    const includeHiddenSets = true;
    const writeTree = syncTree.pendingWriteTree_;
    const serverCache = syncTree.syncPointTree_.findOnPath(path, (pathSoFar, syncPoint) => {
      const relativePath = newRelativePath(pathSoFar, path);
      const serverCache2 = syncPointGetCompleteServerCache(syncPoint, relativePath);
      if (serverCache2) {
        return serverCache2;
      }
    });
    return writeTreeCalcCompleteEventCache(writeTree, path, serverCache, writeIdsToExclude, includeHiddenSets);
  }
  function syncTreeApplyOperationToSyncPoints_(syncTree, operation) {
    return syncTreeApplyOperationHelper_(
      operation,
      syncTree.syncPointTree_,
      /*serverCache=*/
      null,
      writeTreeChildWrites(syncTree.pendingWriteTree_, newEmptyPath())
    );
  }
  function syncTreeApplyOperationHelper_(operation, syncPointTree, serverCache, writesCache) {
    if (pathIsEmpty(operation.path)) {
      return syncTreeApplyOperationDescendantsHelper_(operation, syncPointTree, serverCache, writesCache);
    } else {
      const syncPoint = syncPointTree.get(newEmptyPath());
      if (serverCache == null && syncPoint != null) {
        serverCache = syncPointGetCompleteServerCache(syncPoint, newEmptyPath());
      }
      let events = [];
      const childName = pathGetFront(operation.path);
      const childOperation = operation.operationForChild(childName);
      const childTree = syncPointTree.children.get(childName);
      if (childTree && childOperation) {
        const childServerCache = serverCache ? serverCache.getImmediateChild(childName) : null;
        const childWritesCache = writeTreeRefChild(writesCache, childName);
        events = events.concat(syncTreeApplyOperationHelper_(childOperation, childTree, childServerCache, childWritesCache));
      }
      if (syncPoint) {
        events = events.concat(syncPointApplyOperation(syncPoint, operation, writesCache, serverCache));
      }
      return events;
    }
  }
  function syncTreeApplyOperationDescendantsHelper_(operation, syncPointTree, serverCache, writesCache) {
    const syncPoint = syncPointTree.get(newEmptyPath());
    if (serverCache == null && syncPoint != null) {
      serverCache = syncPointGetCompleteServerCache(syncPoint, newEmptyPath());
    }
    let events = [];
    syncPointTree.children.inorderTraversal((childName, childTree) => {
      const childServerCache = serverCache ? serverCache.getImmediateChild(childName) : null;
      const childWritesCache = writeTreeRefChild(writesCache, childName);
      const childOperation = operation.operationForChild(childName);
      if (childOperation) {
        events = events.concat(syncTreeApplyOperationDescendantsHelper_(childOperation, childTree, childServerCache, childWritesCache));
      }
    });
    if (syncPoint) {
      events = events.concat(syncPointApplyOperation(syncPoint, operation, writesCache, serverCache));
    }
    return events;
  }
  function syncTreeQueryKeyForTag_(syncTree, tag) {
    return syncTree.tagToQueryMap.get(tag);
  }
  function syncTreeParseQueryKey_(queryKey) {
    const splitIndex = queryKey.indexOf("$");
    assert(splitIndex !== -1 && splitIndex < queryKey.length - 1, "Bad queryKey.");
    return {
      queryId: queryKey.substr(splitIndex + 1),
      path: new Path(queryKey.substr(0, splitIndex))
    };
  }
  function syncTreeApplyTaggedOperation_(syncTree, queryPath, operation) {
    const syncPoint = syncTree.syncPointTree_.get(queryPath);
    assert(syncPoint, "Missing sync point for query tag that we're tracking");
    const writesCache = writeTreeChildWrites(syncTree.pendingWriteTree_, queryPath);
    return syncPointApplyOperation(syncPoint, operation, writesCache, null);
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class ExistingValueProvider {
    constructor(node_) {
      this.node_ = node_;
    }
    getImmediateChild(childName) {
      const child = this.node_.getImmediateChild(childName);
      return new ExistingValueProvider(child);
    }
    node() {
      return this.node_;
    }
  }
  class DeferredValueProvider {
    constructor(syncTree, path) {
      this.syncTree_ = syncTree;
      this.path_ = path;
    }
    getImmediateChild(childName) {
      const childPath = pathChild(this.path_, childName);
      return new DeferredValueProvider(this.syncTree_, childPath);
    }
    node() {
      return syncTreeCalcCompleteEventCache(this.syncTree_, this.path_);
    }
  }
  const generateWithValues = function(values) {
    values = values || {};
    values["timestamp"] = values["timestamp"] || (/* @__PURE__ */ new Date()).getTime();
    return values;
  };
  const resolveDeferredLeafValue = function(value, existingVal, serverValues) {
    if (!value || typeof value !== "object") {
      return value;
    }
    assert(".sv" in value, "Unexpected leaf node or priority contents");
    if (typeof value[".sv"] === "string") {
      return resolveScalarDeferredValue(value[".sv"], existingVal, serverValues);
    } else if (typeof value[".sv"] === "object") {
      return resolveComplexDeferredValue(value[".sv"], existingVal);
    } else {
      assert(false, "Unexpected server value: " + JSON.stringify(value, null, 2));
    }
  };
  const resolveScalarDeferredValue = function(op, existing, serverValues) {
    switch (op) {
      case "timestamp":
        return serverValues["timestamp"];
      default:
        assert(false, "Unexpected server value: " + op);
    }
  };
  const resolveComplexDeferredValue = function(op, existing, unused) {
    if (!op.hasOwnProperty("increment")) {
      assert(false, "Unexpected server value: " + JSON.stringify(op, null, 2));
    }
    const delta = op["increment"];
    if (typeof delta !== "number") {
      assert(false, "Unexpected increment value: " + delta);
    }
    const existingNode = existing.node();
    assert(existingNode !== null && typeof existingNode !== "undefined", "Expected ChildrenNode.EMPTY_NODE for nulls");
    if (!existingNode.isLeafNode()) {
      return delta;
    }
    const leaf = existingNode;
    const existingVal = leaf.getValue();
    if (typeof existingVal !== "number") {
      return delta;
    }
    return existingVal + delta;
  };
  const resolveDeferredValueTree = function(path, node, syncTree, serverValues) {
    return resolveDeferredValue(node, new DeferredValueProvider(syncTree, path), serverValues);
  };
  const resolveDeferredValueSnapshot = function(node, existing, serverValues) {
    return resolveDeferredValue(node, new ExistingValueProvider(existing), serverValues);
  };
  function resolveDeferredValue(node, existingVal, serverValues) {
    const rawPri = node.getPriority().val();
    const priority = resolveDeferredLeafValue(rawPri, existingVal.getImmediateChild(".priority"), serverValues);
    let newNode;
    if (node.isLeafNode()) {
      const leafNode = node;
      const value = resolveDeferredLeafValue(leafNode.getValue(), existingVal, serverValues);
      if (value !== leafNode.getValue() || priority !== leafNode.getPriority().val()) {
        return new LeafNode(value, nodeFromJSON(priority));
      } else {
        return node;
      }
    } else {
      const childrenNode = node;
      newNode = childrenNode;
      if (priority !== childrenNode.getPriority().val()) {
        newNode = newNode.updatePriority(new LeafNode(priority));
      }
      childrenNode.forEachChild(PRIORITY_INDEX, (childName, childNode) => {
        const newChildNode = resolveDeferredValue(childNode, existingVal.getImmediateChild(childName), serverValues);
        if (newChildNode !== childNode) {
          newNode = newNode.updateImmediateChild(childName, newChildNode);
        }
      });
      return newNode;
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class Tree {
    /**
     * @param name - Optional name of the node.
     * @param parent - Optional parent node.
     * @param node - Optional node to wrap.
     */
    constructor(name2 = "", parent = null, node = { children: {}, childCount: 0 }) {
      this.name = name2;
      this.parent = parent;
      this.node = node;
    }
  }
  function treeSubTree(tree, pathObj) {
    let path = pathObj instanceof Path ? pathObj : new Path(pathObj);
    let child = tree, next = pathGetFront(path);
    while (next !== null) {
      const childNode = safeGet(child.node.children, next) || {
        children: {},
        childCount: 0
      };
      child = new Tree(next, child, childNode);
      path = pathPopFront(path);
      next = pathGetFront(path);
    }
    return child;
  }
  function treeGetValue(tree) {
    return tree.node.value;
  }
  function treeSetValue(tree, value) {
    tree.node.value = value;
    treeUpdateParents(tree);
  }
  function treeHasChildren(tree) {
    return tree.node.childCount > 0;
  }
  function treeIsEmpty(tree) {
    return treeGetValue(tree) === void 0 && !treeHasChildren(tree);
  }
  function treeForEachChild(tree, action) {
    each(tree.node.children, (child, childTree) => {
      action(new Tree(child, tree, childTree));
    });
  }
  function treeForEachDescendant(tree, action, includeSelf, childrenFirst) {
    if (includeSelf && true) {
      action(tree);
    }
    treeForEachChild(tree, (child) => {
      treeForEachDescendant(child, action, true);
    });
  }
  function treeForEachAncestor(tree, action, includeSelf) {
    let node = tree.parent;
    while (node !== null) {
      if (action(node)) {
        return true;
      }
      node = node.parent;
    }
    return false;
  }
  function treeGetPath(tree) {
    return new Path(tree.parent === null ? tree.name : treeGetPath(tree.parent) + "/" + tree.name);
  }
  function treeUpdateParents(tree) {
    if (tree.parent !== null) {
      treeUpdateChild(tree.parent, tree.name, tree);
    }
  }
  function treeUpdateChild(tree, childName, child) {
    const childEmpty = treeIsEmpty(child);
    const childExists = contains(tree.node.children, childName);
    if (childEmpty && childExists) {
      delete tree.node.children[childName];
      tree.node.childCount--;
      treeUpdateParents(tree);
    } else if (!childEmpty && !childExists) {
      tree.node.children[childName] = child.node;
      tree.node.childCount++;
      treeUpdateParents(tree);
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const INVALID_KEY_REGEX_ = /[\[\].#$\/\u0000-\u001F\u007F]/;
  const INVALID_PATH_REGEX_ = /[\[\].#$\u0000-\u001F\u007F]/;
  const MAX_LEAF_SIZE_ = 10 * 1024 * 1024;
  const isValidKey = function(key) {
    return typeof key === "string" && key.length !== 0 && !INVALID_KEY_REGEX_.test(key);
  };
  const isValidPathString = function(pathString) {
    return typeof pathString === "string" && pathString.length !== 0 && !INVALID_PATH_REGEX_.test(pathString);
  };
  const isValidRootPathString = function(pathString) {
    if (pathString) {
      pathString = pathString.replace(/^\/*\.info(\/|$)/, "/");
    }
    return isValidPathString(pathString);
  };
  const validateFirebaseData = function(errorPrefix2, data, path_) {
    const path = path_ instanceof Path ? new ValidationPath(path_, errorPrefix2) : path_;
    if (data === void 0) {
      throw new Error(errorPrefix2 + "contains undefined " + validationPathToErrorString(path));
    }
    if (typeof data === "function") {
      throw new Error(errorPrefix2 + "contains a function " + validationPathToErrorString(path) + " with contents = " + data.toString());
    }
    if (isInvalidJSONNumber(data)) {
      throw new Error(errorPrefix2 + "contains " + data.toString() + " " + validationPathToErrorString(path));
    }
    if (typeof data === "string" && data.length > MAX_LEAF_SIZE_ / 3 && stringLength(data) > MAX_LEAF_SIZE_) {
      throw new Error(errorPrefix2 + "contains a string greater than " + MAX_LEAF_SIZE_ + " utf8 bytes " + validationPathToErrorString(path) + " ('" + data.substring(0, 50) + "...')");
    }
    if (data && typeof data === "object") {
      let hasDotValue = false;
      let hasActualChild = false;
      each(data, (key, value) => {
        if (key === ".value") {
          hasDotValue = true;
        } else if (key !== ".priority" && key !== ".sv") {
          hasActualChild = true;
          if (!isValidKey(key)) {
            throw new Error(errorPrefix2 + " contains an invalid key (" + key + ") " + validationPathToErrorString(path) + `.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);
          }
        }
        validationPathPush(path, key);
        validateFirebaseData(errorPrefix2, value, path);
        validationPathPop(path);
      });
      if (hasDotValue && hasActualChild) {
        throw new Error(errorPrefix2 + ' contains ".value" child ' + validationPathToErrorString(path) + " in addition to actual children.");
      }
    }
  };
  const validateUrl = function(fnName, parsedUrl) {
    const pathString = parsedUrl.path.toString();
    if (!(typeof parsedUrl.repoInfo.host === "string") || parsedUrl.repoInfo.host.length === 0 || !isValidKey(parsedUrl.repoInfo.namespace) && parsedUrl.repoInfo.host.split(":")[0] !== "localhost" || pathString.length !== 0 && !isValidRootPathString(pathString)) {
      throw new Error(errorPrefix(fnName, "url") + `must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`);
    }
  };
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class EventQueue {
    constructor() {
      this.eventLists_ = [];
      this.recursionDepth_ = 0;
    }
  }
  function eventQueueQueueEvents(eventQueue, eventDataList) {
    let currList = null;
    for (let i = 0; i < eventDataList.length; i++) {
      const data = eventDataList[i];
      const path = data.getPath();
      if (currList !== null && !pathEquals(path, currList.path)) {
        eventQueue.eventLists_.push(currList);
        currList = null;
      }
      if (currList === null) {
        currList = { events: [], path };
      }
      currList.events.push(data);
    }
    if (currList) {
      eventQueue.eventLists_.push(currList);
    }
  }
  function eventQueueRaiseEventsForChangedPath(eventQueue, changedPath, eventDataList) {
    eventQueueQueueEvents(eventQueue, eventDataList);
    eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue, (eventPath) => pathContains(eventPath, changedPath) || pathContains(changedPath, eventPath));
  }
  function eventQueueRaiseQueuedEventsMatchingPredicate(eventQueue, predicate) {
    eventQueue.recursionDepth_++;
    let sentAll = true;
    for (let i = 0; i < eventQueue.eventLists_.length; i++) {
      const eventList = eventQueue.eventLists_[i];
      if (eventList) {
        const eventPath = eventList.path;
        if (predicate(eventPath)) {
          eventListRaise(eventQueue.eventLists_[i]);
          eventQueue.eventLists_[i] = null;
        } else {
          sentAll = false;
        }
      }
    }
    if (sentAll) {
      eventQueue.eventLists_ = [];
    }
    eventQueue.recursionDepth_--;
  }
  function eventListRaise(eventList) {
    for (let i = 0; i < eventList.events.length; i++) {
      const eventData = eventList.events[i];
      if (eventData !== null) {
        eventList.events[i] = null;
        const eventFn = eventData.getEventRunner();
        if (logger$1) {
          log("event: " + eventData.toString());
        }
        exceptionGuard(eventFn);
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const INTERRUPT_REASON = "repo_interrupt";
  const MAX_TRANSACTION_RETRIES = 25;
  class Repo {
    constructor(repoInfo_, forceRestClient_, authTokenProvider_, appCheckProvider_) {
      this.repoInfo_ = repoInfo_;
      this.forceRestClient_ = forceRestClient_;
      this.authTokenProvider_ = authTokenProvider_;
      this.appCheckProvider_ = appCheckProvider_;
      this.dataUpdateCount = 0;
      this.statsListener_ = null;
      this.eventQueue_ = new EventQueue();
      this.nextWriteId_ = 1;
      this.interceptServerDataCallback_ = null;
      this.onDisconnect_ = newSparseSnapshotTree();
      this.transactionQueueTree_ = new Tree();
      this.persistentConnection_ = null;
      this.key = this.repoInfo_.toURLString();
    }
    /**
     * @returns The URL corresponding to the root of this Firebase.
     */
    toString() {
      return (this.repoInfo_.secure ? "https://" : "http://") + this.repoInfo_.host;
    }
  }
  function repoStart(repo, appId, authOverride) {
    repo.stats_ = statsManagerGetCollection(repo.repoInfo_);
    if (repo.forceRestClient_ || beingCrawled()) {
      repo.server_ = new ReadonlyRestClient(repo.repoInfo_, (pathString, data, isMerge, tag) => {
        repoOnDataUpdate(repo, pathString, data, isMerge, tag);
      }, repo.authTokenProvider_, repo.appCheckProvider_);
      setTimeout(() => repoOnConnectStatus(
        repo,
        /* connectStatus= */
        true
      ), 0);
    } else {
      if (typeof authOverride !== "undefined" && authOverride !== null) {
        if (typeof authOverride !== "object") {
          throw new Error("Only objects are supported for option databaseAuthVariableOverride");
        }
        try {
          stringify(authOverride);
        } catch (e) {
          throw new Error("Invalid authOverride provided: " + e);
        }
      }
      repo.persistentConnection_ = new PersistentConnection(repo.repoInfo_, appId, (pathString, data, isMerge, tag) => {
        repoOnDataUpdate(repo, pathString, data, isMerge, tag);
      }, (connectStatus) => {
        repoOnConnectStatus(repo, connectStatus);
      }, (updates) => {
        repoOnServerInfoUpdate(repo, updates);
      }, repo.authTokenProvider_, repo.appCheckProvider_, authOverride);
      repo.server_ = repo.persistentConnection_;
    }
    repo.authTokenProvider_.addTokenChangeListener((token) => {
      repo.server_.refreshAuthToken(token);
    });
    repo.appCheckProvider_.addTokenChangeListener((result2) => {
      repo.server_.refreshAppCheckToken(result2.token);
    });
    repo.statsReporter_ = statsManagerGetOrCreateReporter(repo.repoInfo_, () => new StatsReporter(repo.stats_, repo.server_));
    repo.infoData_ = new SnapshotHolder();
    repo.infoSyncTree_ = new SyncTree({
      startListening: (query, tag, currentHashFn, onComplete) => {
        let infoEvents = [];
        const node = repo.infoData_.getNode(query._path);
        if (!node.isEmpty()) {
          infoEvents = syncTreeApplyServerOverwrite(repo.infoSyncTree_, query._path, node);
          setTimeout(() => {
            onComplete("ok");
          }, 0);
        }
        return infoEvents;
      },
      stopListening: () => {
      }
    });
    repoUpdateInfo(repo, "connected", false);
    repo.serverSyncTree_ = new SyncTree({
      startListening: (query, tag, currentHashFn, onComplete) => {
        repo.server_.listen(query, currentHashFn, tag, (status, data) => {
          const events = onComplete(status, data);
          eventQueueRaiseEventsForChangedPath(repo.eventQueue_, query._path, events);
        });
        return [];
      },
      stopListening: (query, tag) => {
        repo.server_.unlisten(query, tag);
      }
    });
  }
  function repoServerTime(repo) {
    const offsetNode = repo.infoData_.getNode(new Path(".info/serverTimeOffset"));
    const offset = offsetNode.val() || 0;
    return (/* @__PURE__ */ new Date()).getTime() + offset;
  }
  function repoGenerateServerValues(repo) {
    return generateWithValues({
      timestamp: repoServerTime(repo)
    });
  }
  function repoOnDataUpdate(repo, pathString, data, isMerge, tag) {
    repo.dataUpdateCount++;
    const path = new Path(pathString);
    data = repo.interceptServerDataCallback_ ? repo.interceptServerDataCallback_(pathString, data) : data;
    let events = [];
    if (tag) {
      if (isMerge) {
        const taggedChildren = map(data, (raw) => nodeFromJSON(raw));
        events = syncTreeApplyTaggedQueryMerge(repo.serverSyncTree_, path, taggedChildren, tag);
      } else {
        const taggedSnap = nodeFromJSON(data);
        events = syncTreeApplyTaggedQueryOverwrite(repo.serverSyncTree_, path, taggedSnap, tag);
      }
    } else if (isMerge) {
      const changedChildren = map(data, (raw) => nodeFromJSON(raw));
      events = syncTreeApplyServerMerge(repo.serverSyncTree_, path, changedChildren);
    } else {
      const snap = nodeFromJSON(data);
      events = syncTreeApplyServerOverwrite(repo.serverSyncTree_, path, snap);
    }
    let affectedPath = path;
    if (events.length > 0) {
      affectedPath = repoRerunTransactions(repo, path);
    }
    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, affectedPath, events);
  }
  function repoOnConnectStatus(repo, connectStatus) {
    repoUpdateInfo(repo, "connected", connectStatus);
    if (connectStatus === false) {
      repoRunOnDisconnectEvents(repo);
    }
  }
  function repoOnServerInfoUpdate(repo, updates) {
    each(updates, (key, value) => {
      repoUpdateInfo(repo, key, value);
    });
  }
  function repoUpdateInfo(repo, pathString, value) {
    const path = new Path("/.info/" + pathString);
    const newNode = nodeFromJSON(value);
    repo.infoData_.updateSnapshot(path, newNode);
    const events = syncTreeApplyServerOverwrite(repo.infoSyncTree_, path, newNode);
    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);
  }
  function repoGetNextWriteId(repo) {
    return repo.nextWriteId_++;
  }
  function repoRunOnDisconnectEvents(repo) {
    repoLog(repo, "onDisconnectEvents");
    const serverValues = repoGenerateServerValues(repo);
    const resolvedOnDisconnectTree = newSparseSnapshotTree();
    sparseSnapshotTreeForEachTree(repo.onDisconnect_, newEmptyPath(), (path, node) => {
      const resolved = resolveDeferredValueTree(path, node, repo.serverSyncTree_, serverValues);
      sparseSnapshotTreeRemember(resolvedOnDisconnectTree, path, resolved);
    });
    let events = [];
    sparseSnapshotTreeForEachTree(resolvedOnDisconnectTree, newEmptyPath(), (path, snap) => {
      events = events.concat(syncTreeApplyServerOverwrite(repo.serverSyncTree_, path, snap));
      const affectedPath = repoAbortTransactions(repo, path);
      repoRerunTransactions(repo, affectedPath);
    });
    repo.onDisconnect_ = newSparseSnapshotTree();
    eventQueueRaiseEventsForChangedPath(repo.eventQueue_, newEmptyPath(), events);
  }
  function repoInterrupt(repo) {
    if (repo.persistentConnection_) {
      repo.persistentConnection_.interrupt(INTERRUPT_REASON);
    }
  }
  function repoLog(repo, ...varArgs) {
    let prefix = "";
    if (repo.persistentConnection_) {
      prefix = repo.persistentConnection_.id + ":";
    }
    log(prefix, ...varArgs);
  }
  function repoGetLatestState(repo, path, excludeSets) {
    return syncTreeCalcCompleteEventCache(repo.serverSyncTree_, path, excludeSets) || ChildrenNode.EMPTY_NODE;
  }
  function repoSendReadyTransactions(repo, node = repo.transactionQueueTree_) {
    if (!node) {
      repoPruneCompletedTransactionsBelowNode(repo, node);
    }
    if (treeGetValue(node)) {
      const queue = repoBuildTransactionQueue(repo, node);
      assert(queue.length > 0, "Sending zero length transaction queue");
      const allRun = queue.every(
        (transaction) => transaction.status === 0
        /* TransactionStatus.RUN */
      );
      if (allRun) {
        repoSendTransactionQueue(repo, treeGetPath(node), queue);
      }
    } else if (treeHasChildren(node)) {
      treeForEachChild(node, (childNode) => {
        repoSendReadyTransactions(repo, childNode);
      });
    }
  }
  function repoSendTransactionQueue(repo, path, queue) {
    const setsToIgnore = queue.map((txn) => {
      return txn.currentWriteId;
    });
    const latestState = repoGetLatestState(repo, path, setsToIgnore);
    let snapToSend = latestState;
    const latestHash = latestState.hash();
    for (let i = 0; i < queue.length; i++) {
      const txn = queue[i];
      assert(txn.status === 0, "tryToSendTransactionQueue_: items in queue should all be run.");
      txn.status = 1;
      txn.retryCount++;
      const relativePath = newRelativePath(path, txn.path);
      snapToSend = snapToSend.updateChild(relativePath, txn.currentOutputSnapshotRaw);
    }
    const dataToSend = snapToSend.val(true);
    const pathToSend = path;
    repo.server_.put(pathToSend.toString(), dataToSend, (status) => {
      repoLog(repo, "transaction put response", {
        path: pathToSend.toString(),
        status
      });
      let events = [];
      if (status === "ok") {
        const callbacks = [];
        for (let i = 0; i < queue.length; i++) {
          queue[i].status = 2;
          events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, queue[i].currentWriteId));
          if (queue[i].onComplete) {
            callbacks.push(() => queue[i].onComplete(null, true, queue[i].currentOutputSnapshotResolved));
          }
          queue[i].unwatcher();
        }
        repoPruneCompletedTransactionsBelowNode(repo, treeSubTree(repo.transactionQueueTree_, path));
        repoSendReadyTransactions(repo, repo.transactionQueueTree_);
        eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);
        for (let i = 0; i < callbacks.length; i++) {
          exceptionGuard(callbacks[i]);
        }
      } else {
        if (status === "datastale") {
          for (let i = 0; i < queue.length; i++) {
            if (queue[i].status === 3) {
              queue[i].status = 4;
            } else {
              queue[i].status = 0;
            }
          }
        } else {
          warn("transaction at " + pathToSend.toString() + " failed: " + status);
          for (let i = 0; i < queue.length; i++) {
            queue[i].status = 4;
            queue[i].abortReason = status;
          }
        }
        repoRerunTransactions(repo, path);
      }
    }, latestHash);
  }
  function repoRerunTransactions(repo, changedPath) {
    const rootMostTransactionNode = repoGetAncestorTransactionNode(repo, changedPath);
    const path = treeGetPath(rootMostTransactionNode);
    const queue = repoBuildTransactionQueue(repo, rootMostTransactionNode);
    repoRerunTransactionQueue(repo, queue, path);
    return path;
  }
  function repoRerunTransactionQueue(repo, queue, path) {
    if (queue.length === 0) {
      return;
    }
    const callbacks = [];
    let events = [];
    const txnsToRerun = queue.filter((q) => {
      return q.status === 0;
    });
    const setsToIgnore = txnsToRerun.map((q) => {
      return q.currentWriteId;
    });
    for (let i = 0; i < queue.length; i++) {
      const transaction = queue[i];
      const relativePath = newRelativePath(path, transaction.path);
      let abortTransaction = false, abortReason;
      assert(relativePath !== null, "rerunTransactionsUnderNode_: relativePath should not be null.");
      if (transaction.status === 4) {
        abortTransaction = true;
        abortReason = transaction.abortReason;
        events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, transaction.currentWriteId, true));
      } else if (transaction.status === 0) {
        if (transaction.retryCount >= MAX_TRANSACTION_RETRIES) {
          abortTransaction = true;
          abortReason = "maxretry";
          events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, transaction.currentWriteId, true));
        } else {
          const currentNode = repoGetLatestState(repo, transaction.path, setsToIgnore);
          transaction.currentInputSnapshot = currentNode;
          const newData = queue[i].update(currentNode.val());
          if (newData !== void 0) {
            validateFirebaseData("transaction failed: Data returned ", newData, transaction.path);
            let newDataNode = nodeFromJSON(newData);
            const hasExplicitPriority = typeof newData === "object" && newData != null && contains(newData, ".priority");
            if (!hasExplicitPriority) {
              newDataNode = newDataNode.updatePriority(currentNode.getPriority());
            }
            const oldWriteId = transaction.currentWriteId;
            const serverValues = repoGenerateServerValues(repo);
            const newNodeResolved = resolveDeferredValueSnapshot(newDataNode, currentNode, serverValues);
            transaction.currentOutputSnapshotRaw = newDataNode;
            transaction.currentOutputSnapshotResolved = newNodeResolved;
            transaction.currentWriteId = repoGetNextWriteId(repo);
            setsToIgnore.splice(setsToIgnore.indexOf(oldWriteId), 1);
            events = events.concat(syncTreeApplyUserOverwrite(repo.serverSyncTree_, transaction.path, newNodeResolved, transaction.currentWriteId, transaction.applyLocally));
            events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, oldWriteId, true));
          } else {
            abortTransaction = true;
            abortReason = "nodata";
            events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, transaction.currentWriteId, true));
          }
        }
      }
      eventQueueRaiseEventsForChangedPath(repo.eventQueue_, path, events);
      events = [];
      if (abortTransaction) {
        queue[i].status = 2;
        (function(unwatcher) {
          setTimeout(unwatcher, Math.floor(0));
        })(queue[i].unwatcher);
        if (queue[i].onComplete) {
          if (abortReason === "nodata") {
            callbacks.push(() => queue[i].onComplete(null, false, queue[i].currentInputSnapshot));
          } else {
            callbacks.push(() => queue[i].onComplete(new Error(abortReason), false, null));
          }
        }
      }
    }
    repoPruneCompletedTransactionsBelowNode(repo, repo.transactionQueueTree_);
    for (let i = 0; i < callbacks.length; i++) {
      exceptionGuard(callbacks[i]);
    }
    repoSendReadyTransactions(repo, repo.transactionQueueTree_);
  }
  function repoGetAncestorTransactionNode(repo, path) {
    let front;
    let transactionNode = repo.transactionQueueTree_;
    front = pathGetFront(path);
    while (front !== null && treeGetValue(transactionNode) === void 0) {
      transactionNode = treeSubTree(transactionNode, front);
      path = pathPopFront(path);
      front = pathGetFront(path);
    }
    return transactionNode;
  }
  function repoBuildTransactionQueue(repo, transactionNode) {
    const transactionQueue = [];
    repoAggregateTransactionQueuesForNode(repo, transactionNode, transactionQueue);
    transactionQueue.sort((a, b2) => a.order - b2.order);
    return transactionQueue;
  }
  function repoAggregateTransactionQueuesForNode(repo, node, queue) {
    const nodeQueue = treeGetValue(node);
    if (nodeQueue) {
      for (let i = 0; i < nodeQueue.length; i++) {
        queue.push(nodeQueue[i]);
      }
    }
    treeForEachChild(node, (child) => {
      repoAggregateTransactionQueuesForNode(repo, child, queue);
    });
  }
  function repoPruneCompletedTransactionsBelowNode(repo, node) {
    const queue = treeGetValue(node);
    if (queue) {
      let to = 0;
      for (let from = 0; from < queue.length; from++) {
        if (queue[from].status !== 2) {
          queue[to] = queue[from];
          to++;
        }
      }
      queue.length = to;
      treeSetValue(node, queue.length > 0 ? queue : void 0);
    }
    treeForEachChild(node, (childNode) => {
      repoPruneCompletedTransactionsBelowNode(repo, childNode);
    });
  }
  function repoAbortTransactions(repo, path) {
    const affectedPath = treeGetPath(repoGetAncestorTransactionNode(repo, path));
    const transactionNode = treeSubTree(repo.transactionQueueTree_, path);
    treeForEachAncestor(transactionNode, (node) => {
      repoAbortTransactionsOnNode(repo, node);
    });
    repoAbortTransactionsOnNode(repo, transactionNode);
    treeForEachDescendant(transactionNode, (node) => {
      repoAbortTransactionsOnNode(repo, node);
    });
    return affectedPath;
  }
  function repoAbortTransactionsOnNode(repo, node) {
    const queue = treeGetValue(node);
    if (queue) {
      const callbacks = [];
      let events = [];
      let lastSent = -1;
      for (let i = 0; i < queue.length; i++) {
        if (queue[i].status === 3) ;
        else if (queue[i].status === 1) {
          assert(lastSent === i - 1, "All SENT items should be at beginning of queue.");
          lastSent = i;
          queue[i].status = 3;
          queue[i].abortReason = "set";
        } else {
          assert(queue[i].status === 0, "Unexpected transaction status in abort");
          queue[i].unwatcher();
          events = events.concat(syncTreeAckUserWrite(repo.serverSyncTree_, queue[i].currentWriteId, true));
          if (queue[i].onComplete) {
            callbacks.push(queue[i].onComplete.bind(null, new Error("set"), false, null));
          }
        }
      }
      if (lastSent === -1) {
        treeSetValue(node, void 0);
      } else {
        queue.length = lastSent + 1;
      }
      eventQueueRaiseEventsForChangedPath(repo.eventQueue_, treeGetPath(node), events);
      for (let i = 0; i < callbacks.length; i++) {
        exceptionGuard(callbacks[i]);
      }
    }
  }
  /**
   * @license
   * Copyright 2017 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function decodePath(pathString) {
    let pathStringDecoded = "";
    const pieces = pathString.split("/");
    for (let i = 0; i < pieces.length; i++) {
      if (pieces[i].length > 0) {
        let piece = pieces[i];
        try {
          piece = decodeURIComponent(piece.replace(/\+/g, " "));
        } catch (e) {
        }
        pathStringDecoded += "/" + piece;
      }
    }
    return pathStringDecoded;
  }
  function decodeQuery(queryString) {
    const results = {};
    if (queryString.charAt(0) === "?") {
      queryString = queryString.substring(1);
    }
    for (const segment of queryString.split("&")) {
      if (segment.length === 0) {
        continue;
      }
      const kv = segment.split("=");
      if (kv.length === 2) {
        results[decodeURIComponent(kv[0])] = decodeURIComponent(kv[1]);
      } else {
        warn(`Invalid query segment '${segment}' in query '${queryString}'`);
      }
    }
    return results;
  }
  const parseRepoInfo = function(dataURL, nodeAdmin) {
    const parsedUrl = parseDatabaseURL(dataURL), namespace = parsedUrl.namespace;
    if (parsedUrl.domain === "firebase.com") {
      fatal(parsedUrl.host + " is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead");
    }
    if ((!namespace || namespace === "undefined") && parsedUrl.domain !== "localhost") {
      fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com");
    }
    if (!parsedUrl.secure) {
      warnIfPageIsSecure();
    }
    const webSocketOnly = parsedUrl.scheme === "ws" || parsedUrl.scheme === "wss";
    return {
      repoInfo: new RepoInfo(
        parsedUrl.host,
        parsedUrl.secure,
        namespace,
        webSocketOnly,
        nodeAdmin,
        /*persistenceKey=*/
        "",
        /*includeNamespaceInQueryParams=*/
        namespace !== parsedUrl.subdomain
      ),
      path: new Path(parsedUrl.pathString)
    };
  };
  const parseDatabaseURL = function(dataURL) {
    let host = "", domain = "", subdomain = "", pathString = "", namespace = "";
    let secure = true, scheme = "https", port = 443;
    if (typeof dataURL === "string") {
      let colonInd = dataURL.indexOf("//");
      if (colonInd >= 0) {
        scheme = dataURL.substring(0, colonInd - 1);
        dataURL = dataURL.substring(colonInd + 2);
      }
      let slashInd = dataURL.indexOf("/");
      if (slashInd === -1) {
        slashInd = dataURL.length;
      }
      let questionMarkInd = dataURL.indexOf("?");
      if (questionMarkInd === -1) {
        questionMarkInd = dataURL.length;
      }
      host = dataURL.substring(0, Math.min(slashInd, questionMarkInd));
      if (slashInd < questionMarkInd) {
        pathString = decodePath(dataURL.substring(slashInd, questionMarkInd));
      }
      const queryParams = decodeQuery(dataURL.substring(Math.min(dataURL.length, questionMarkInd)));
      colonInd = host.indexOf(":");
      if (colonInd >= 0) {
        secure = scheme === "https" || scheme === "wss";
        port = parseInt(host.substring(colonInd + 1), 10);
      } else {
        colonInd = host.length;
      }
      const hostWithoutPort = host.slice(0, colonInd);
      if (hostWithoutPort.toLowerCase() === "localhost") {
        domain = "localhost";
      } else if (hostWithoutPort.split(".").length <= 2) {
        domain = hostWithoutPort;
      } else {
        const dotInd = host.indexOf(".");
        subdomain = host.substring(0, dotInd).toLowerCase();
        domain = host.substring(dotInd + 1);
        namespace = subdomain;
      }
      if ("ns" in queryParams) {
        namespace = queryParams["ns"];
      }
    }
    return {
      host,
      port,
      domain,
      subdomain,
      secure,
      scheme,
      pathString,
      namespace
    };
  };
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  class QueryImpl {
    /**
     * @hideconstructor
     */
    constructor(_repo, _path, _queryParams, _orderByCalled) {
      this._repo = _repo;
      this._path = _path;
      this._queryParams = _queryParams;
      this._orderByCalled = _orderByCalled;
    }
    get key() {
      if (pathIsEmpty(this._path)) {
        return null;
      } else {
        return pathGetBack(this._path);
      }
    }
    get ref() {
      return new ReferenceImpl(this._repo, this._path);
    }
    get _queryIdentifier() {
      const obj = queryParamsGetQueryObject(this._queryParams);
      const id = ObjectToUniqueKey(obj);
      return id === "{}" ? "default" : id;
    }
    /**
     * An object representation of the query parameters used by this Query.
     */
    get _queryObject() {
      return queryParamsGetQueryObject(this._queryParams);
    }
    isEqual(other) {
      other = getModularInstance(other);
      if (!(other instanceof QueryImpl)) {
        return false;
      }
      const sameRepo = this._repo === other._repo;
      const samePath = pathEquals(this._path, other._path);
      const sameQueryIdentifier = this._queryIdentifier === other._queryIdentifier;
      return sameRepo && samePath && sameQueryIdentifier;
    }
    toJSON() {
      return this.toString();
    }
    toString() {
      return this._repo.toString() + pathToUrlEncodedString(this._path);
    }
  }
  class ReferenceImpl extends QueryImpl {
    /** @hideconstructor */
    constructor(repo, path) {
      super(repo, path, new QueryParams(), false);
    }
    get parent() {
      const parentPath = pathParent(this._path);
      return parentPath === null ? null : new ReferenceImpl(this._repo, parentPath);
    }
    get root() {
      let ref = this;
      while (ref.parent !== null) {
        ref = ref.parent;
      }
      return ref;
    }
  }
  syncPointSetReferenceConstructor(ReferenceImpl);
  syncTreeSetReferenceConstructor(ReferenceImpl);
  /**
   * @license
   * Copyright 2020 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  const FIREBASE_DATABASE_EMULATOR_HOST_VAR = "FIREBASE_DATABASE_EMULATOR_HOST";
  const repos = {};
  let useRestClient = false;
  function repoManagerApplyEmulatorSettings(repo, hostAndPort, emulatorOptions, tokenProvider) {
    repo.repoInfo_ = new RepoInfo(
      hostAndPort,
      /* secure= */
      false,
      repo.repoInfo_.namespace,
      repo.repoInfo_.webSocketOnly,
      repo.repoInfo_.nodeAdmin,
      repo.repoInfo_.persistenceKey,
      repo.repoInfo_.includeNamespaceInQueryParams,
      /*isUsingEmulator=*/
      true,
      emulatorOptions
    );
    if (tokenProvider) {
      repo.authTokenProvider_ = tokenProvider;
    }
  }
  function repoManagerDatabaseFromApp(app, authProvider, appCheckProvider, url, nodeAdmin) {
    let dbUrl = url || app.options.databaseURL;
    if (dbUrl === void 0) {
      if (!app.options.projectId) {
        fatal("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp().");
      }
      log("Using default host for project ", app.options.projectId);
      dbUrl = `${app.options.projectId}-default-rtdb.firebaseio.com`;
    }
    let parsedUrl = parseRepoInfo(dbUrl, nodeAdmin);
    let repoInfo = parsedUrl.repoInfo;
    let dbEmulatorHost = void 0;
    if (typeof process !== "undefined" && process.env) {
      dbEmulatorHost = process.env[FIREBASE_DATABASE_EMULATOR_HOST_VAR];
    }
    if (dbEmulatorHost) {
      dbUrl = `http://${dbEmulatorHost}?ns=${repoInfo.namespace}`;
      parsedUrl = parseRepoInfo(dbUrl, nodeAdmin);
      repoInfo = parsedUrl.repoInfo;
    } else {
      !parsedUrl.repoInfo.secure;
    }
    const authTokenProvider = new FirebaseAuthTokenProvider(app.name, app.options, authProvider);
    validateUrl("Invalid Firebase Database URL", parsedUrl);
    if (!pathIsEmpty(parsedUrl.path)) {
      fatal("Database URL must point to the root of a Firebase Database (not including a child path).");
    }
    const repo = repoManagerCreateRepo(repoInfo, app, authTokenProvider, new AppCheckTokenProvider(app, appCheckProvider));
    return new Database(repo, app);
  }
  function repoManagerDeleteRepo(repo, appName) {
    const appRepos = repos[appName];
    if (!appRepos || appRepos[repo.key] !== repo) {
      fatal(`Database ${appName}(${repo.repoInfo_}) has already been deleted.`);
    }
    repoInterrupt(repo);
    delete appRepos[repo.key];
  }
  function repoManagerCreateRepo(repoInfo, app, authTokenProvider, appCheckProvider) {
    let appRepos = repos[app.name];
    if (!appRepos) {
      appRepos = {};
      repos[app.name] = appRepos;
    }
    let repo = appRepos[repoInfo.toURLString()];
    if (repo) {
      fatal("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");
    }
    repo = new Repo(repoInfo, useRestClient, authTokenProvider, appCheckProvider);
    appRepos[repoInfo.toURLString()] = repo;
    return repo;
  }
  class Database {
    /** @hideconstructor */
    constructor(_repoInternal, app) {
      this._repoInternal = _repoInternal;
      this.app = app;
      this["type"] = "database";
      this._instanceStarted = false;
    }
    get _repo() {
      if (!this._instanceStarted) {
        repoStart(this._repoInternal, this.app.options.appId, this.app.options["databaseAuthVariableOverride"]);
        this._instanceStarted = true;
      }
      return this._repoInternal;
    }
    get _root() {
      if (!this._rootInternal) {
        this._rootInternal = new ReferenceImpl(this._repo, newEmptyPath());
      }
      return this._rootInternal;
    }
    _delete() {
      if (this._rootInternal !== null) {
        repoManagerDeleteRepo(this._repo, this.app.name);
        this._repoInternal = null;
        this._rootInternal = null;
      }
      return Promise.resolve();
    }
    _checkNotDeleted(apiName) {
      if (this._rootInternal === null) {
        fatal("Cannot call " + apiName + " on a deleted database.");
      }
    }
  }
  function getDatabase(app = getApp(), url) {
    const db = _getProvider(app, "database").getImmediate({
      identifier: url
    });
    if (!db._instanceStarted) {
      const emulator = getDefaultEmulatorHostnameAndPort("database");
      if (emulator) {
        connectDatabaseEmulator(db, ...emulator);
      }
    }
    return db;
  }
  function connectDatabaseEmulator(db, host, port, options = {}) {
    db = getModularInstance(db);
    db._checkNotDeleted("useEmulator");
    const hostAndPort = `${host}:${port}`;
    const repo = db._repoInternal;
    if (db._instanceStarted) {
      if (hostAndPort === db._repoInternal.repoInfo_.host && deepEqual(options, repo.repoInfo_.emulatorOptions)) {
        return;
      }
      fatal("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.");
    }
    let tokenProvider = void 0;
    if (repo.repoInfo_.nodeAdmin) {
      if (options.mockUserToken) {
        fatal('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".');
      }
      tokenProvider = new EmulatorTokenProvider(EmulatorTokenProvider.OWNER);
    } else if (options.mockUserToken) {
      const token = typeof options.mockUserToken === "string" ? options.mockUserToken : createMockUserToken(options.mockUserToken, db.app.options.projectId);
      tokenProvider = new EmulatorTokenProvider(token);
    }
    repoManagerApplyEmulatorSettings(repo, hostAndPort, options, tokenProvider);
  }
  /**
   * @license
   * Copyright 2021 Google LLC
   *
   * Licensed under the Apache License, Version 2.0 (the "License");
   * you may not use this file except in compliance with the License.
   * You may obtain a copy of the License at
   *
   *   http://www.apache.org/licenses/LICENSE-2.0
   *
   * Unless required by applicable law or agreed to in writing, software
   * distributed under the License is distributed on an "AS IS" BASIS,
   * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   * See the License for the specific language governing permissions and
   * limitations under the License.
   */
  function registerDatabase(variant) {
    setSDKVersion(SDK_VERSION$1);
    _registerComponent(new Component(
      "database",
      (container, { instanceIdentifier: url }) => {
        const app = container.getProvider("app").getImmediate();
        const authProvider = container.getProvider("auth-internal");
        const appCheckProvider = container.getProvider("app-check-internal");
        return repoManagerDatabaseFromApp(app, authProvider, appCheckProvider, url);
      },
      "PUBLIC"
      /* ComponentType.PUBLIC */
    ).setMultipleInstances(true));
    registerVersion(name, version, variant);
    registerVersion(name, version, "esm2017");
  }
  PersistentConnection.prototype.simpleListen = function(pathString, onComplete) {
    this.sendRequest("q", { p: pathString }, onComplete);
  };
  PersistentConnection.prototype.echo = function(data, onEcho) {
    this.sendRequest("echo", { d: data }, onEcho);
  };
  registerDatabase();
  const browser$2 = ((_b = (_a = globalThis.browser) == null ? void 0 : _a.runtime) == null ? void 0 : _b.id) ? globalThis.browser : globalThis.chrome;
  const browser$1 = browser$2;
  const clientCredentials = {
    apiKey: "AIzaSyAnHyYS-zdzfiTe97jJDfEaf1HxqmvLzmc",
    authDomain: "conflictology-conflict.firebaseapp.com",
    projectId: "conflictology-conflict",
    storageBucket: "conflictology-conflict.appspot.com",
    messagingSenderId: "205495071119",
    appId: "1:205495071119:web:c9077530939d71160c1bfa",
    databaseURL: "https://conflictology-conflict-default-rtdb.firebaseio.com"
  };
  let firebase_app = getApps().length ? getApps()[0] : initializeApp(clientCredentials);
  const auth = getAuth(firebase_app);
  getFirestore(firebase_app);
  getDatabase(firebase_app);
  setPersistence(auth, indexedDBLocalPersistence);
  browser$1.storage.local.get("user").then(({ user }) => {
    if (user && user.uid) {
      console.log("Found user in local storage, authenticating with Firebase...");
      authenticateWithFirebase(user.uid).then(() => console.log("Successfully initialized Firebase auth from storage")).catch((err) => console.error("Failed to initialize Firebase auth from storage:", err));
    } else {
      console.log("No user found in local storage");
    }
  });
  const authenticateWithFirebase = async (uid) => {
    var _a2;
    try {
      console.log("Authenticating with Firebase using UID:", uid);
      console.log("Fetching custom token from API...");
      const response = await fetch("https://conflictology-web.vercel.app/api/auth/token", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
          // no cors co-cors
        },
        body: JSON.stringify({ uid })
      });
      console.log("API response status:", response.status);
      if (!response.ok) {
        const error2 = await response.json();
        console.error("API error response:", error2);
        throw new Error(error2.error || "Failed to get custom token");
      }
      const responseData = await response.json();
      console.log("API response data:", responseData);
      const { customToken } = responseData;
      console.log("Custom token received:", customToken ? customToken.substring(0, 10) + "..." : "None");
      if (!customToken) {
        throw new Error("No custom token received");
      }
      console.log("Signing in with custom token...");
      const result2 = await signInWithCustomToken(auth, customToken);
      console.log("Sign in successful, user:", (_a2 = result2.user) == null ? void 0 : _a2.uid);
      const currentUser = auth.currentUser;
      console.log("Current Firebase user after authentication:", currentUser == null ? void 0 : currentUser.uid);
      return result2;
    } catch (error2) {
      console.error("Authentication error:", error2);
      throw error2;
    }
  };
  background;
  const definition = defineBackground(() => {
    const hasSidePanelSupport = !!browser$1.sidePanel && !!browser$1.sidePanel.open;
    browser$1.action.onClicked.addListener((tab) => {
      if (hasSidePanelSupport) {
        try {
          const windowId = tab.windowId;
          if (windowId) {
            browser$1.sidePanel.open({ windowId });
          }
        } catch (error2) {
          console.error("Error opening side panel:", error2);
          browser$1.tabs.create({ url: "standalone.html" });
        }
      } else {
        browser$1.tabs.create({ url: "standalone.html" });
      }
    });
    console.log("Side Panel Support: " + (hasSidePanelSupport ? "Yes" : "No"));
    browser$1.runtime.onInstalled.addListener((details) => {
      if (details.reason === "chrome_update") {
        return;
      }
      if (details.reason === "install") {
        browser$1.tabs.create({
          url: "https://conflictologygames.com/rules"
        });
      }
    });
    const OFFSCREEN_DOCUMENT_PATH = "/offscreen.html";
    let creatingOffscreenDocument = null;
    async function hasOffscreenDocument() {
      const matchedClients = await self.clients.matchAll();
      return matchedClients.some(
        (c) => c.url === browser$1.runtime.getURL(OFFSCREEN_DOCUMENT_PATH)
      );
    }
    async function setupOffscreenDocument() {
      if (await hasOffscreenDocument()) return;
      if (creatingOffscreenDocument) {
        await creatingOffscreenDocument;
      } else {
        creatingOffscreenDocument = browser$1.offscreen.createDocument({
          url: browser$1.runtime.getURL(OFFSCREEN_DOCUMENT_PATH),
          reasons: [browser$1.offscreen.Reason.DOM_SCRAPING],
          justification: "Firebase Authentication"
        });
        await creatingOffscreenDocument;
        creatingOffscreenDocument = null;
      }
    }
    async function getAuthFromOffscreen() {
      await setupOffscreenDocument();
      return new Promise((resolve, reject) => {
        browser$1.runtime.sendMessage({ action: "getAuth", target: "offscreen" }, (response) => {
          if (browser$1.runtime.lastError) {
            reject(browser$1.runtime.lastError);
          } else {
            resolve(response);
          }
        });
      });
    }
    browser$1.runtime.onMessage.addListener((message, sender, sendResponse) => {
      if (message.action === "signIn") {
        getAuthFromOffscreen().then(async (user) => {
          if (!user || !user.uid) {
            console.error("Failed to get valid user from auth flow");
            sendResponse({ error: "Authentication failed" });
            return;
          }
          console.log("Authentication successful for:", user.email || user.uid);
          const minimalUser = {
            uid: user.uid,
            email: user.email,
            displayName: user.displayName
          };
          console.log("Minimal user object:", minimalUser);
          if (user.uid) {
            const res = await authenticateWithFirebase(user.uid);
            console.log("Firebase authentication response:", res);
          }
          await browser$1.storage.local.set({ user: minimalUser });
          browser$1.runtime.sendMessage({
            type: "AUTH_STATE_CHANGED",
            user: minimalUser
          });
          sendResponse({ user: minimalUser });
        }).catch((error2) => {
          console.error("Authentication error:", error2);
          sendResponse({ error: error2.message });
        });
        return true;
      }
      if (message.action === "signOut") {
        (async () => {
          try {
            console.log("Processing sign out request");
            await browser$1.storage.local.remove("user");
            browser$1.runtime.sendMessage({
              type: "AUTH_STATE_CHANGED",
              user: null
            });
            console.log("Sign out complete");
            sendResponse({ success: true });
          } catch (error2) {
            console.error("Error during sign out:", error2);
            sendResponse({ error: String(error2) });
          }
        })();
        return true;
      }
      return false;
    });
    browser$1.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {
      var _a2, _b2;
      if (((_a2 = tab.url) == null ? void 0 : _a2.startsWith("https://accounts.google.com/o/oauth2/auth/")) || ((_b2 = tab.url) == null ? void 0 : _b2.startsWith("https://conflictology-conflict.firebaseapp.com"))) {
        if (tab.windowId) {
          browser$1.windows.update(tab.windowId, { focused: true });
        }
        return;
      }
    });
  });
  background;
  function initPlugins() {
  }
  var _MatchPattern = class {
    constructor(matchPattern) {
      if (matchPattern === "<all_urls>") {
        this.isAllUrls = true;
        this.protocolMatches = [..._MatchPattern.PROTOCOLS];
        this.hostnameMatch = "*";
        this.pathnameMatch = "*";
      } else {
        const groups = /(.*):\/\/(.*?)(\/.*)/.exec(matchPattern);
        if (groups == null)
          throw new InvalidMatchPattern(matchPattern, "Incorrect format");
        const [_, protocol, hostname, pathname] = groups;
        validateProtocol(matchPattern, protocol);
        validateHostname(matchPattern, hostname);
        this.protocolMatches = protocol === "*" ? ["http", "https"] : [protocol];
        this.hostnameMatch = hostname;
        this.pathnameMatch = pathname;
      }
    }
    includes(url) {
      if (this.isAllUrls)
        return true;
      const u = typeof url === "string" ? new URL(url) : url instanceof Location ? new URL(url.href) : url;
      return !!this.protocolMatches.find((protocol) => {
        if (protocol === "http")
          return this.isHttpMatch(u);
        if (protocol === "https")
          return this.isHttpsMatch(u);
        if (protocol === "file")
          return this.isFileMatch(u);
        if (protocol === "ftp")
          return this.isFtpMatch(u);
        if (protocol === "urn")
          return this.isUrnMatch(u);
      });
    }
    isHttpMatch(url) {
      return url.protocol === "http:" && this.isHostPathMatch(url);
    }
    isHttpsMatch(url) {
      return url.protocol === "https:" && this.isHostPathMatch(url);
    }
    isHostPathMatch(url) {
      if (!this.hostnameMatch || !this.pathnameMatch)
        return false;
      const hostnameMatchRegexs = [
        this.convertPatternToRegex(this.hostnameMatch),
        this.convertPatternToRegex(this.hostnameMatch.replace(/^\*\./, ""))
      ];
      const pathnameMatchRegex = this.convertPatternToRegex(this.pathnameMatch);
      return !!hostnameMatchRegexs.find((regex) => regex.test(url.hostname)) && pathnameMatchRegex.test(url.pathname);
    }
    isFileMatch(url) {
      throw Error("Not implemented: file:// pattern matching. Open a PR to add support");
    }
    isFtpMatch(url) {
      throw Error("Not implemented: ftp:// pattern matching. Open a PR to add support");
    }
    isUrnMatch(url) {
      throw Error("Not implemented: urn:// pattern matching. Open a PR to add support");
    }
    convertPatternToRegex(pattern) {
      const escaped = this.escapeForRegex(pattern);
      const starsReplaced = escaped.replace(/\\\*/g, ".*");
      return RegExp(`^${starsReplaced}$`);
    }
    escapeForRegex(string) {
      return string.replace(/[.*+?^${}()|[\]\\]/g, "\\$&");
    }
  };
  var MatchPattern = _MatchPattern;
  MatchPattern.PROTOCOLS = ["http", "https", "file", "ftp", "urn"];
  var InvalidMatchPattern = class extends Error {
    constructor(matchPattern, reason) {
      super(`Invalid match pattern "${matchPattern}": ${reason}`);
    }
  };
  function validateProtocol(matchPattern, protocol) {
    if (!MatchPattern.PROTOCOLS.includes(protocol) && protocol !== "*")
      throw new InvalidMatchPattern(
        matchPattern,
        `${protocol} not a valid protocol (${MatchPattern.PROTOCOLS.join(", ")})`
      );
  }
  function validateHostname(matchPattern, hostname) {
    if (hostname.includes(":"))
      throw new InvalidMatchPattern(matchPattern, `Hostname cannot include a port`);
    if (hostname.includes("*") && hostname.length > 1 && !hostname.startsWith("*."))
      throw new InvalidMatchPattern(
        matchPattern,
        `If using a wildcard (*), it must go at the start of the hostname`
      );
  }
  function print(method, ...args) {
    if (typeof args[0] === "string") {
      const message = args.shift();
      method(`[wxt] ${message}`, ...args);
    } else {
      method("[wxt]", ...args);
    }
  }
  const logger = {
    debug: (...args) => print(console.debug, ...args),
    log: (...args) => print(console.log, ...args),
    warn: (...args) => print(console.warn, ...args),
    error: (...args) => print(console.error, ...args)
  };
  let ws;
  function getDevServerWebSocket() {
    if (ws == null) {
      const serverUrl = `${"ws:"}//${"localhost"}:${3e3}`;
      logger.debug("Connecting to dev server @", serverUrl);
      ws = new WebSocket(serverUrl, "vite-hmr");
      ws.addWxtEventListener = ws.addEventListener.bind(ws);
      ws.sendCustom = (event, payload) => ws == null ? void 0 : ws.send(JSON.stringify({ type: "custom", event, payload }));
      ws.addEventListener("open", () => {
        logger.debug("Connected to dev server");
      });
      ws.addEventListener("close", () => {
        logger.debug("Disconnected from dev server");
      });
      ws.addEventListener("error", (event) => {
        logger.error("Failed to connect to dev server", event);
      });
      ws.addEventListener("message", (e) => {
        try {
          const message = JSON.parse(e.data);
          if (message.type === "custom") {
            ws == null ? void 0 : ws.dispatchEvent(
              new CustomEvent(message.event, { detail: message.data })
            );
          }
        } catch (err) {
          logger.error("Failed to handle message", err);
        }
      });
    }
    return ws;
  }
  function keepServiceWorkerAlive() {
    setInterval(async () => {
      await browser$1.runtime.getPlatformInfo();
    }, 5e3);
  }
  function reloadContentScript(payload) {
    const manifest = browser$1.runtime.getManifest();
    if (manifest.manifest_version == 2) {
      void reloadContentScriptMv2();
    } else {
      void reloadContentScriptMv3(payload);
    }
  }
  async function reloadContentScriptMv3({
    registration,
    contentScript
  }) {
    if (registration === "runtime") {
      await reloadRuntimeContentScriptMv3(contentScript);
    } else {
      await reloadManifestContentScriptMv3(contentScript);
    }
  }
  async function reloadManifestContentScriptMv3(contentScript) {
    const id = `wxt:${contentScript.js[0]}`;
    logger.log("Reloading content script:", contentScript);
    const registered = await browser$1.scripting.getRegisteredContentScripts();
    logger.debug("Existing scripts:", registered);
    const existing = registered.find((cs) => cs.id === id);
    if (existing) {
      logger.debug("Updating content script", existing);
      await browser$1.scripting.updateContentScripts([{ ...contentScript, id }]);
    } else {
      logger.debug("Registering new content script...");
      await browser$1.scripting.registerContentScripts([{ ...contentScript, id }]);
    }
    await reloadTabsForContentScript(contentScript);
  }
  async function reloadRuntimeContentScriptMv3(contentScript) {
    logger.log("Reloading content script:", contentScript);
    const registered = await browser$1.scripting.getRegisteredContentScripts();
    logger.debug("Existing scripts:", registered);
    const matches = registered.filter((cs) => {
      var _a2, _b2;
      const hasJs = (_a2 = contentScript.js) == null ? void 0 : _a2.find((js) => {
        var _a3;
        return (_a3 = cs.js) == null ? void 0 : _a3.includes(js);
      });
      const hasCss = (_b2 = contentScript.css) == null ? void 0 : _b2.find((css) => {
        var _a3;
        return (_a3 = cs.css) == null ? void 0 : _a3.includes(css);
      });
      return hasJs || hasCss;
    });
    if (matches.length === 0) {
      logger.log(
        "Content script is not registered yet, nothing to reload",
        contentScript
      );
      return;
    }
    await browser$1.scripting.updateContentScripts(matches);
    await reloadTabsForContentScript(contentScript);
  }
  async function reloadTabsForContentScript(contentScript) {
    const allTabs = await browser$1.tabs.query({});
    const matchPatterns = contentScript.matches.map(
      (match) => new MatchPattern(match)
    );
    const matchingTabs = allTabs.filter((tab) => {
      const url = tab.url;
      if (!url) return false;
      return !!matchPatterns.find((pattern) => pattern.includes(url));
    });
    await Promise.all(
      matchingTabs.map(async (tab) => {
        try {
          await browser$1.tabs.reload(tab.id);
        } catch (err) {
          logger.warn("Failed to reload tab:", err);
        }
      })
    );
  }
  async function reloadContentScriptMv2(_payload) {
    throw Error("TODO: reloadContentScriptMv2");
  }
  {
    try {
      const ws2 = getDevServerWebSocket();
      ws2.addWxtEventListener("wxt:reload-extension", () => {
        browser$1.runtime.reload();
      });
      ws2.addWxtEventListener("wxt:reload-content-script", (event) => {
        reloadContentScript(event.detail);
      });
      if (true) {
        ws2.addEventListener(
          "open",
          () => ws2.sendCustom("wxt:background-initialized")
        );
        keepServiceWorkerAlive();
      }
    } catch (err) {
      logger.error("Failed to setup web socket connection with dev server", err);
    }
    browser$1.commands.onCommand.addListener((command) => {
      if (command === "wxt:reload-extension") {
        browser$1.runtime.reload();
      }
    });
  }
  let result;
  try {
    initPlugins();
    result = definition.main();
    if (result instanceof Promise) {
      console.warn(
        "The background's main() function return a promise, but it must be synchronous"
      );
    }
  } catch (err) {
    logger.error("The background crashed on startup!");
    throw err;
  }
  const result$1 = result;
  return result$1;
}();
background;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja2dyb3VuZC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3d4dEAwLjIwLjAvbm9kZV9tb2R1bGVzL3d4dC9kaXN0L3V0aWxzL2RlZmluZS1iYWNrZ3JvdW5kLm1qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrdXRpbEAxLjExLjAvbm9kZV9tb2R1bGVzL0BmaXJlYmFzZS91dGlsL2Rpc3QvcG9zdGluc3RhbGwubWpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSt1dGlsQDEuMTEuMC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3V0aWwvZGlzdC9pbmRleC5lc20yMDE3LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZStjb21wb25lbnRAMC42LjEzL25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvY29tcG9uZW50L2Rpc3QvZXNtL2luZGV4LmVzbTIwMTcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2xvZ2dlckAwLjQuNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2xvZ2dlci9kaXN0L2VzbS9pbmRleC5lc20yMDE3LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2lkYkA3LjEuMS9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL3dyYXAtaWRiLXZhbHVlLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL2lkYkA3LjEuMS9ub2RlX21vZHVsZXMvaWRiL2J1aWxkL2luZGV4LmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSthcHBAMC4xMS40L25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXBwL2Rpc3QvZXNtL2luZGV4LmVzbTIwMTcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vZmlyZWJhc2VAMTEuNi4wL25vZGVfbW9kdWxlcy9maXJlYmFzZS9hcHAvZGlzdC9lc20vaW5kZXguZXNtLmpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL3RzbGliQDIuOC4xL25vZGVfbW9kdWxlcy90c2xpYi90c2xpYi5lczYubWpzIiwiLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL0BmaXJlYmFzZSthdXRoQDEuMTAuMF9AZmlyZWJhc2UrYXBwQDAuMTEuNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2F1dGgvZGlzdC93ZWItZXh0ZW5zaW9uLWVzbTIwMTcvcmVnaXN0ZXItMDA1MjJkODEuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2F1dGhAMS4xMC4wX0BmaXJlYmFzZSthcHBAMC4xMS40L25vZGVfbW9kdWxlcy9AZmlyZWJhc2UvYXV0aC9kaXN0L3dlYi1leHRlbnNpb24tZXNtMjAxNy9pbmRleC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2Urd2ViY2hhbm5lbC13cmFwcGVyQDEuMC4zL25vZGVfbW9kdWxlcy9AZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL2Rpc3QvYmxvb20tYmxvYi9lc20vYmxvb21fYmxvYl9lczIwMTguanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK3dlYmNoYW5uZWwtd3JhcHBlckAxLjAuMy9ub2RlX21vZHVsZXMvQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci9kaXN0L3dlYmNoYW5uZWwtYmxvYi9lc20vd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9AZmlyZWJhc2UrZmlyZXN0b3JlQDQuNy4xMF9AZmlyZWJhc2UrYXBwQDAuMTEuNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2ZpcmVzdG9yZS9kaXN0L2luZGV4LmVzbTIwMTcuanMiLCIuLi8uLi9ub2RlX21vZHVsZXMvLnBucG0vQGZpcmViYXNlK2RhdGFiYXNlQDEuMC4xNC9ub2RlX21vZHVsZXMvQGZpcmViYXNlL2RhdGFiYXNlL2Rpc3QvaW5kZXguZXNtMjAxNy5qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad3h0LWRlditicm93c2VyQDAuMC4zMTAvbm9kZV9tb2R1bGVzL0B3eHQtZGV2L2Jyb3dzZXIvc3JjL2luZGV4Lm1qcyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS93eHRAMC4yMC4wL25vZGVfbW9kdWxlcy93eHQvZGlzdC9icm93c2VyLm1qcyIsIi4uLy4uL2ZpcmViYXNlL2ZpcmViYXNlQ2xpZW50LnRzIiwiLi4vLi4vZW50cnlwb2ludHMvYmFja2dyb3VuZC50cyIsIi4uLy4uL25vZGVfbW9kdWxlcy8ucG5wbS9Ad2ViZXh0LWNvcmUrbWF0Y2gtcGF0dGVybnNAMS4wLjMvbm9kZV9tb2R1bGVzL0B3ZWJleHQtY29yZS9tYXRjaC1wYXR0ZXJucy9saWIvaW5kZXguanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGZ1bmN0aW9uIGRlZmluZUJhY2tncm91bmQoYXJnKSB7XG4gIGlmIChhcmcgPT0gbnVsbCB8fCB0eXBlb2YgYXJnID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiB7IG1haW46IGFyZyB9O1xuICByZXR1cm4gYXJnO1xufVxuIiwiY29uc3QgZ2V0RGVmYXVsdHNGcm9tUG9zdGluc3RhbGwgPSAoKSA9PiAodW5kZWZpbmVkKTtcbmV4cG9ydCB7IGdldERlZmF1bHRzRnJvbVBvc3RpbnN0YWxsIH07IiwiaW1wb3J0IHsgZ2V0RGVmYXVsdHNGcm9tUG9zdGluc3RhbGwgfSBmcm9tICcuL3Bvc3RpbnN0YWxsLm1qcyc7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgRmlyZWJhc2UgY29uc3RhbnRzLiAgU29tZSBvZiB0aGVzZSAoQGRlZmluZXMpIGNhbiBiZSBvdmVycmlkZGVuIGF0IGNvbXBpbGUtdGltZS5cbiAqL1xuY29uc3QgQ09OU1RBTlRTID0ge1xuICAgIC8qKlxuICAgICAqIEBkZWZpbmUge2Jvb2xlYW59IFdoZXRoZXIgdGhpcyBpcyB0aGUgY2xpZW50IE5vZGUuanMgU0RLLlxuICAgICAqL1xuICAgIE5PREVfQ0xJRU5UOiBmYWxzZSxcbiAgICAvKipcbiAgICAgKiBAZGVmaW5lIHtib29sZWFufSBXaGV0aGVyIHRoaXMgaXMgdGhlIEFkbWluIE5vZGUuanMgU0RLLlxuICAgICAqL1xuICAgIE5PREVfQURNSU46IGZhbHNlLFxuICAgIC8qKlxuICAgICAqIEZpcmViYXNlIFNESyBWZXJzaW9uXG4gICAgICovXG4gICAgU0RLX1ZFUlNJT046ICcke0pTQ09SRV9WRVJTSU9OfSdcbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRocm93cyBhbiBlcnJvciBpZiB0aGUgcHJvdmlkZWQgYXNzZXJ0aW9uIGlzIGZhbHN5XG4gKi9cbmNvbnN0IGFzc2VydCA9IGZ1bmN0aW9uIChhc3NlcnRpb24sIG1lc3NhZ2UpIHtcbiAgICBpZiAoIWFzc2VydGlvbikge1xuICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcihtZXNzYWdlKTtcbiAgICB9XG59O1xuLyoqXG4gKiBSZXR1cm5zIGFuIEVycm9yIG9iamVjdCBzdWl0YWJsZSBmb3IgdGhyb3dpbmcuXG4gKi9cbmNvbnN0IGFzc2VydGlvbkVycm9yID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICByZXR1cm4gbmV3IEVycm9yKCdGaXJlYmFzZSBEYXRhYmFzZSAoJyArXG4gICAgICAgIENPTlNUQU5UUy5TREtfVkVSU0lPTiArXG4gICAgICAgICcpIElOVEVSTkFMIEFTU0VSVCBGQUlMRUQ6ICcgK1xuICAgICAgICBtZXNzYWdlKTtcbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBzdHJpbmdUb0J5dGVBcnJheSQxID0gZnVuY3Rpb24gKHN0cikge1xuICAgIC8vIFRPRE8odXNlcik6IFVzZSBuYXRpdmUgaW1wbGVtZW50YXRpb25zIGlmL3doZW4gYXZhaWxhYmxlXG4gICAgY29uc3Qgb3V0ID0gW107XG4gICAgbGV0IHAgPSAwO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxldCBjID0gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgIGlmIChjIDwgMTI4KSB7XG4gICAgICAgICAgICBvdXRbcCsrXSA9IGM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYyA8IDIwNDgpIHtcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gNikgfCAxOTI7XG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKChjICYgMHhmYzAwKSA9PT0gMHhkODAwICYmXG4gICAgICAgICAgICBpICsgMSA8IHN0ci5sZW5ndGggJiZcbiAgICAgICAgICAgIChzdHIuY2hhckNvZGVBdChpICsgMSkgJiAweGZjMDApID09PSAweGRjMDApIHtcbiAgICAgICAgICAgIC8vIFN1cnJvZ2F0ZSBQYWlyXG4gICAgICAgICAgICBjID0gMHgxMDAwMCArICgoYyAmIDB4MDNmZikgPDwgMTApICsgKHN0ci5jaGFyQ29kZUF0KCsraSkgJiAweDAzZmYpO1xuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiAxOCkgfCAyNDA7XG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiAxMikgJiA2MykgfCAxMjg7XG4gICAgICAgICAgICBvdXRbcCsrXSA9ICgoYyA+PiA2KSAmIDYzKSB8IDEyODtcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDtcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4O1xuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gb3V0O1xufTtcbi8qKlxuICogVHVybnMgYW4gYXJyYXkgb2YgbnVtYmVycyBpbnRvIHRoZSBzdHJpbmcgZ2l2ZW4gYnkgdGhlIGNvbmNhdGVuYXRpb24gb2YgdGhlXG4gKiBjaGFyYWN0ZXJzIHRvIHdoaWNoIHRoZSBudW1iZXJzIGNvcnJlc3BvbmQuXG4gKiBAcGFyYW0gYnl0ZXMgQXJyYXkgb2YgbnVtYmVycyByZXByZXNlbnRpbmcgY2hhcmFjdGVycy5cbiAqIEByZXR1cm4gU3RyaW5naWZpY2F0aW9uIG9mIHRoZSBhcnJheS5cbiAqL1xuY29uc3QgYnl0ZUFycmF5VG9TdHJpbmcgPSBmdW5jdGlvbiAoYnl0ZXMpIHtcbiAgICAvLyBUT0RPKHVzZXIpOiBVc2UgbmF0aXZlIGltcGxlbWVudGF0aW9ucyBpZi93aGVuIGF2YWlsYWJsZVxuICAgIGNvbnN0IG91dCA9IFtdO1xuICAgIGxldCBwb3MgPSAwLCBjID0gMDtcbiAgICB3aGlsZSAocG9zIDwgYnl0ZXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGMxID0gYnl0ZXNbcG9zKytdO1xuICAgICAgICBpZiAoYzEgPCAxMjgpIHtcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZShjMSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYzEgPiAxOTEgJiYgYzEgPCAyMjQpIHtcbiAgICAgICAgICAgIGNvbnN0IGMyID0gYnl0ZXNbcG9zKytdO1xuICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKCgoYzEgJiAzMSkgPDwgNikgfCAoYzIgJiA2MykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGMxID4gMjM5ICYmIGMxIDwgMzY1KSB7XG4gICAgICAgICAgICAvLyBTdXJyb2dhdGUgUGFpclxuICAgICAgICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107XG4gICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTtcbiAgICAgICAgICAgIGNvbnN0IGM0ID0gYnl0ZXNbcG9zKytdO1xuICAgICAgICAgICAgY29uc3QgdSA9ICgoKGMxICYgNykgPDwgMTgpIHwgKChjMiAmIDYzKSA8PCAxMikgfCAoKGMzICYgNjMpIDw8IDYpIHwgKGM0ICYgNjMpKSAtXG4gICAgICAgICAgICAgICAgMHgxMDAwMDtcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgweGQ4MDAgKyAodSA+PiAxMCkpO1xuICAgICAgICAgICAgb3V0W2MrK10gPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4ZGMwMCArICh1ICYgMTAyMykpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgYzIgPSBieXRlc1twb3MrK107XG4gICAgICAgICAgICBjb25zdCBjMyA9IGJ5dGVzW3BvcysrXTtcbiAgICAgICAgICAgIG91dFtjKytdID0gU3RyaW5nLmZyb21DaGFyQ29kZSgoKGMxICYgMTUpIDw8IDEyKSB8ICgoYzIgJiA2MykgPDwgNikgfCAoYzMgJiA2MykpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQuam9pbignJyk7XG59O1xuLy8gV2UgZGVmaW5lIGl0IGFzIGFuIG9iamVjdCBsaXRlcmFsIGluc3RlYWQgb2YgYSBjbGFzcyBiZWNhdXNlIGEgY2xhc3MgY29tcGlsZWQgZG93biB0byBlczUgY2FuJ3Rcbi8vIGJlIHRyZWVzaGFrZWQuIGh0dHBzOi8vZ2l0aHViLmNvbS9yb2xsdXAvcm9sbHVwL2lzc3Vlcy8xNjkxXG4vLyBTdGF0aWMgbG9va3VwIG1hcHMsIGxhemlseSBwb3B1bGF0ZWQgYnkgaW5pdF8oKVxuLy8gVE9ETyhkbGFyb2NxdWUpOiBEZWZpbmUgdGhpcyBhcyBhIGNsYXNzLCBzaW5jZSB3ZSBubyBsb25nZXIgdGFyZ2V0IEVTNS5cbmNvbnN0IGJhc2U2NCA9IHtcbiAgICAvKipcbiAgICAgKiBNYXBzIGJ5dGVzIHRvIGNoYXJhY3RlcnMuXG4gICAgICovXG4gICAgYnl0ZVRvQ2hhck1hcF86IG51bGwsXG4gICAgLyoqXG4gICAgICogTWFwcyBjaGFyYWN0ZXJzIHRvIGJ5dGVzLlxuICAgICAqL1xuICAgIGNoYXJUb0J5dGVNYXBfOiBudWxsLFxuICAgIC8qKlxuICAgICAqIE1hcHMgYnl0ZXMgdG8gd2Vic2FmZSBjaGFyYWN0ZXJzLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgYnl0ZVRvQ2hhck1hcFdlYlNhZmVfOiBudWxsLFxuICAgIC8qKlxuICAgICAqIE1hcHMgd2Vic2FmZSBjaGFyYWN0ZXJzIHRvIGJ5dGVzLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgY2hhclRvQnl0ZU1hcFdlYlNhZmVfOiBudWxsLFxuICAgIC8qKlxuICAgICAqIE91ciBkZWZhdWx0IGFscGhhYmV0LCBzaGFyZWQgYmV0d2VlblxuICAgICAqIEVOQ09ERURfVkFMUyBhbmQgRU5DT0RFRF9WQUxTX1dFQlNBRkVcbiAgICAgKi9cbiAgICBFTkNPREVEX1ZBTFNfQkFTRTogJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJyArICdhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eicgKyAnMDEyMzQ1Njc4OScsXG4gICAgLyoqXG4gICAgICogT3VyIGRlZmF1bHQgYWxwaGFiZXQuIFZhbHVlIDY0ICg9KSBpcyBzcGVjaWFsOyBpdCBtZWFucyBcIm5vdGhpbmcuXCJcbiAgICAgKi9cbiAgICBnZXQgRU5DT0RFRF9WQUxTKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5FTkNPREVEX1ZBTFNfQkFTRSArICcrLz0nO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogT3VyIHdlYnNhZmUgYWxwaGFiZXQuXG4gICAgICovXG4gICAgZ2V0IEVOQ09ERURfVkFMU19XRUJTQUZFKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5FTkNPREVEX1ZBTFNfQkFTRSArICctXy4nO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogV2hldGhlciB0aGlzIGJyb3dzZXIgc3VwcG9ydHMgdGhlIGF0b2IgYW5kIGJ0b2EgZnVuY3Rpb25zLiBUaGlzIGV4dGVuc2lvblxuICAgICAqIHN0YXJ0ZWQgYXQgTW96aWxsYSBidXQgaXMgbm93IGltcGxlbWVudGVkIGJ5IG1hbnkgYnJvd3NlcnMuIFdlIHVzZSB0aGVcbiAgICAgKiBBU1NVTUVfKiB2YXJpYWJsZXMgdG8gYXZvaWQgcHVsbGluZyBpbiB0aGUgZnVsbCB1c2VyYWdlbnQgZGV0ZWN0aW9uIGxpYnJhcnlcbiAgICAgKiBidXQgc3RpbGwgYWxsb3dpbmcgdGhlIHN0YW5kYXJkIHBlci1icm93c2VyIGNvbXBpbGF0aW9ucy5cbiAgICAgKlxuICAgICAqL1xuICAgIEhBU19OQVRJVkVfU1VQUE9SVDogdHlwZW9mIGF0b2IgPT09ICdmdW5jdGlvbicsXG4gICAgLyoqXG4gICAgICogQmFzZTY0LWVuY29kZSBhbiBhcnJheSBvZiBieXRlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCBBbiBhcnJheSBvZiBieXRlcyAobnVtYmVycyB3aXRoXG4gICAgICogICAgIHZhbHVlIGluIFswLCAyNTVdKSB0byBlbmNvZGUuXG4gICAgICogQHBhcmFtIHdlYlNhZmUgQm9vbGVhbiBpbmRpY2F0aW5nIHdlIHNob3VsZCB1c2UgdGhlXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxuICAgICAqIEByZXR1cm4gVGhlIGJhc2U2NCBlbmNvZGVkIHN0cmluZy5cbiAgICAgKi9cbiAgICBlbmNvZGVCeXRlQXJyYXkoaW5wdXQsIHdlYlNhZmUpIHtcbiAgICAgICAgaWYgKCFBcnJheS5pc0FycmF5KGlucHV0KSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoJ2VuY29kZUJ5dGVBcnJheSB0YWtlcyBhbiBhcnJheSBhcyBhIHBhcmFtZXRlcicpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5pdF8oKTtcbiAgICAgICAgY29uc3QgYnl0ZVRvQ2hhck1hcCA9IHdlYlNhZmVcbiAgICAgICAgICAgID8gdGhpcy5ieXRlVG9DaGFyTWFwV2ViU2FmZV9cbiAgICAgICAgICAgIDogdGhpcy5ieXRlVG9DaGFyTWFwXztcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpICs9IDMpIHtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUxID0gaW5wdXRbaV07XG4gICAgICAgICAgICBjb25zdCBoYXZlQnl0ZTIgPSBpICsgMSA8IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUyID0gaGF2ZUJ5dGUyID8gaW5wdXRbaSArIDFdIDogMDtcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgKyAyIDwgaW5wdXQubGVuZ3RoO1xuICAgICAgICAgICAgY29uc3QgYnl0ZTMgPSBoYXZlQnl0ZTMgPyBpbnB1dFtpICsgMl0gOiAwO1xuICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTEgPSBieXRlMSA+PiAyO1xuICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTIgPSAoKGJ5dGUxICYgMHgwMykgPDwgNCkgfCAoYnl0ZTIgPj4gNCk7XG4gICAgICAgICAgICBsZXQgb3V0Qnl0ZTMgPSAoKGJ5dGUyICYgMHgwZikgPDwgMikgfCAoYnl0ZTMgPj4gNik7XG4gICAgICAgICAgICBsZXQgb3V0Qnl0ZTQgPSBieXRlMyAmIDB4M2Y7XG4gICAgICAgICAgICBpZiAoIWhhdmVCeXRlMykge1xuICAgICAgICAgICAgICAgIG91dEJ5dGU0ID0gNjQ7XG4gICAgICAgICAgICAgICAgaWYgKCFoYXZlQnl0ZTIpIHtcbiAgICAgICAgICAgICAgICAgICAgb3V0Qnl0ZTMgPSA2NDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBvdXRwdXQucHVzaChieXRlVG9DaGFyTWFwW291dEJ5dGUxXSwgYnl0ZVRvQ2hhck1hcFtvdXRCeXRlMl0sIGJ5dGVUb0NoYXJNYXBbb3V0Qnl0ZTNdLCBieXRlVG9DaGFyTWFwW291dEJ5dGU0XSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG91dHB1dC5qb2luKCcnKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEJhc2U2NC1lbmNvZGUgYSBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgQSBzdHJpbmcgdG8gZW5jb2RlLlxuICAgICAqIEBwYXJhbSB3ZWJTYWZlIElmIHRydWUsIHdlIHNob3VsZCB1c2UgdGhlXG4gICAgICogICAgIGFsdGVybmF0aXZlIGFscGhhYmV0LlxuICAgICAqIEByZXR1cm4gVGhlIGJhc2U2NCBlbmNvZGVkIHN0cmluZy5cbiAgICAgKi9cbiAgICBlbmNvZGVTdHJpbmcoaW5wdXQsIHdlYlNhZmUpIHtcbiAgICAgICAgLy8gU2hvcnRjdXQgZm9yIE1vemlsbGEgYnJvd3NlcnMgdGhhdCBpbXBsZW1lbnRcbiAgICAgICAgLy8gYSBuYXRpdmUgYmFzZTY0IGVuY29kZXIgaW4gdGhlIGZvcm0gb2YgXCJidG9hL2F0b2JcIlxuICAgICAgICBpZiAodGhpcy5IQVNfTkFUSVZFX1NVUFBPUlQgJiYgIXdlYlNhZmUpIHtcbiAgICAgICAgICAgIHJldHVybiBidG9hKGlucHV0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5lbmNvZGVCeXRlQXJyYXkoc3RyaW5nVG9CeXRlQXJyYXkkMShpbnB1dCksIHdlYlNhZmUpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogQmFzZTY0LWRlY29kZSBhIHN0cmluZy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBpbnB1dCB0byBkZWNvZGUuXG4gICAgICogQHBhcmFtIHdlYlNhZmUgVHJ1ZSBpZiB3ZSBzaG91bGQgdXNlIHRoZVxuICAgICAqICAgICBhbHRlcm5hdGl2ZSBhbHBoYWJldC5cbiAgICAgKiBAcmV0dXJuIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuXG4gICAgICovXG4gICAgZGVjb2RlU3RyaW5nKGlucHV0LCB3ZWJTYWZlKSB7XG4gICAgICAgIC8vIFNob3J0Y3V0IGZvciBNb3ppbGxhIGJyb3dzZXJzIHRoYXQgaW1wbGVtZW50XG4gICAgICAgIC8vIGEgbmF0aXZlIGJhc2U2NCBlbmNvZGVyIGluIHRoZSBmb3JtIG9mIFwiYnRvYS9hdG9iXCJcbiAgICAgICAgaWYgKHRoaXMuSEFTX05BVElWRV9TVVBQT1JUICYmICF3ZWJTYWZlKSB7XG4gICAgICAgICAgICByZXR1cm4gYXRvYihpbnB1dCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGJ5dGVBcnJheVRvU3RyaW5nKHRoaXMuZGVjb2RlU3RyaW5nVG9CeXRlQXJyYXkoaW5wdXQsIHdlYlNhZmUpKTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIEJhc2U2NC1kZWNvZGUgYSBzdHJpbmcuXG4gICAgICpcbiAgICAgKiBJbiBiYXNlLTY0IGRlY29kaW5nLCBncm91cHMgb2YgZm91ciBjaGFyYWN0ZXJzIGFyZSBjb252ZXJ0ZWQgaW50byB0aHJlZVxuICAgICAqIGJ5dGVzLiAgSWYgdGhlIGVuY29kZXIgZGlkIG5vdCBhcHBseSBwYWRkaW5nLCB0aGUgaW5wdXQgbGVuZ3RoIG1heSBub3RcbiAgICAgKiBiZSBhIG11bHRpcGxlIG9mIDQuXG4gICAgICpcbiAgICAgKiBJbiB0aGlzIGNhc2UsIHRoZSBsYXN0IGdyb3VwIHdpbGwgaGF2ZSBmZXdlciB0aGFuIDQgY2hhcmFjdGVycywgYW5kXG4gICAgICogcGFkZGluZyB3aWxsIGJlIGluZmVycmVkLiAgSWYgdGhlIGdyb3VwIGhhcyBvbmUgb3IgdHdvIGNoYXJhY3RlcnMsIGl0IGRlY29kZXNcbiAgICAgKiB0byBvbmUgYnl0ZS4gIElmIHRoZSBncm91cCBoYXMgdGhyZWUgY2hhcmFjdGVycywgaXQgZGVjb2RlcyB0byB0d28gYnl0ZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaW5wdXQgSW5wdXQgdG8gZGVjb2RlLlxuICAgICAqIEBwYXJhbSB3ZWJTYWZlIFRydWUgaWYgd2Ugc2hvdWxkIHVzZSB0aGUgd2ViLXNhZmUgYWxwaGFiZXQuXG4gICAgICogQHJldHVybiBieXRlcyByZXByZXNlbnRpbmcgdGhlIGRlY29kZWQgdmFsdWUuXG4gICAgICovXG4gICAgZGVjb2RlU3RyaW5nVG9CeXRlQXJyYXkoaW5wdXQsIHdlYlNhZmUpIHtcbiAgICAgICAgdGhpcy5pbml0XygpO1xuICAgICAgICBjb25zdCBjaGFyVG9CeXRlTWFwID0gd2ViU2FmZVxuICAgICAgICAgICAgPyB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlX1xuICAgICAgICAgICAgOiB0aGlzLmNoYXJUb0J5dGVNYXBfO1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7KSB7XG4gICAgICAgICAgICBjb25zdCBieXRlMSA9IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkrKyldO1xuICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGUyID0gaSA8IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGUyID0gaGF2ZUJ5dGUyID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogMDtcbiAgICAgICAgICAgICsraTtcbiAgICAgICAgICAgIGNvbnN0IGhhdmVCeXRlMyA9IGkgPCBpbnB1dC5sZW5ndGg7XG4gICAgICAgICAgICBjb25zdCBieXRlMyA9IGhhdmVCeXRlMyA/IGNoYXJUb0J5dGVNYXBbaW5wdXQuY2hhckF0KGkpXSA6IDY0O1xuICAgICAgICAgICAgKytpO1xuICAgICAgICAgICAgY29uc3QgaGF2ZUJ5dGU0ID0gaSA8IGlucHV0Lmxlbmd0aDtcbiAgICAgICAgICAgIGNvbnN0IGJ5dGU0ID0gaGF2ZUJ5dGU0ID8gY2hhclRvQnl0ZU1hcFtpbnB1dC5jaGFyQXQoaSldIDogNjQ7XG4gICAgICAgICAgICArK2k7XG4gICAgICAgICAgICBpZiAoYnl0ZTEgPT0gbnVsbCB8fCBieXRlMiA9PSBudWxsIHx8IGJ5dGUzID09IG51bGwgfHwgYnl0ZTQgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBEZWNvZGVCYXNlNjRTdHJpbmdFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTEgPSAoYnl0ZTEgPDwgMikgfCAoYnl0ZTIgPj4gNCk7XG4gICAgICAgICAgICBvdXRwdXQucHVzaChvdXRCeXRlMSk7XG4gICAgICAgICAgICBpZiAoYnl0ZTMgIT09IDY0KSB7XG4gICAgICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTIgPSAoKGJ5dGUyIDw8IDQpICYgMHhmMCkgfCAoYnl0ZTMgPj4gMik7XG4gICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTIpO1xuICAgICAgICAgICAgICAgIGlmIChieXRlNCAhPT0gNjQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgb3V0Qnl0ZTMgPSAoKGJ5dGUzIDw8IDYpICYgMHhjMCkgfCBieXRlNDtcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0LnB1c2gob3V0Qnl0ZTMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb3V0cHV0O1xuICAgIH0sXG4gICAgLyoqXG4gICAgICogTGF6eSBzdGF0aWMgaW5pdGlhbGl6YXRpb24gZnVuY3Rpb24uIENhbGxlZCBiZWZvcmVcbiAgICAgKiBhY2Nlc3NpbmcgYW55IG9mIHRoZSBzdGF0aWMgbWFwIHZhcmlhYmxlcy5cbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqL1xuICAgIGluaXRfKCkge1xuICAgICAgICBpZiAoIXRoaXMuYnl0ZVRvQ2hhck1hcF8pIHtcbiAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcF8gPSB7fTtcbiAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcF8gPSB7fTtcbiAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfID0ge307XG4gICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBXZWJTYWZlXyA9IHt9O1xuICAgICAgICAgICAgLy8gV2Ugd2FudCBxdWljayBtYXBwaW5ncyBiYWNrIGFuZCBmb3J0aCwgc28gd2UgcHJlY29tcHV0ZSB0d28gbWFwcy5cbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5FTkNPREVEX1ZBTFMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ5dGVUb0NoYXJNYXBfW2ldID0gdGhpcy5FTkNPREVEX1ZBTFMuY2hhckF0KGkpO1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcF9bdGhpcy5ieXRlVG9DaGFyTWFwX1tpXV0gPSBpO1xuICAgICAgICAgICAgICAgIHRoaXMuYnl0ZVRvQ2hhck1hcFdlYlNhZmVfW2ldID0gdGhpcy5FTkNPREVEX1ZBTFNfV0VCU0FGRS5jaGFyQXQoaSk7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFyVG9CeXRlTWFwV2ViU2FmZV9bdGhpcy5ieXRlVG9DaGFyTWFwV2ViU2FmZV9baV1dID0gaTtcbiAgICAgICAgICAgICAgICAvLyBCZSBmb3JnaXZpbmcgd2hlbiBkZWNvZGluZyBhbmQgY29ycmVjdGx5IGRlY29kZSBib3RoIGVuY29kaW5ncy5cbiAgICAgICAgICAgICAgICBpZiAoaSA+PSB0aGlzLkVOQ09ERURfVkFMU19CQVNFLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYXJUb0J5dGVNYXBfW3RoaXMuRU5DT0RFRF9WQUxTX1dFQlNBRkUuY2hhckF0KGkpXSA9IGk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2hhclRvQnl0ZU1hcFdlYlNhZmVfW3RoaXMuRU5DT0RFRF9WQUxTLmNoYXJBdChpKV0gPSBpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn07XG4vKipcbiAqIEFuIGVycm9yIGVuY291bnRlcmVkIHdoaWxlIGRlY29kaW5nIGJhc2U2NCBzdHJpbmcuXG4gKi9cbmNsYXNzIERlY29kZUJhc2U2NFN0cmluZ0Vycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICB0aGlzLm5hbWUgPSAnRGVjb2RlQmFzZTY0U3RyaW5nRXJyb3InO1xuICAgIH1cbn1cbi8qKlxuICogVVJMLXNhZmUgYmFzZTY0IGVuY29kaW5nXG4gKi9cbmNvbnN0IGJhc2U2NEVuY29kZSA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICBjb25zdCB1dGY4Qnl0ZXMgPSBzdHJpbmdUb0J5dGVBcnJheSQxKHN0cik7XG4gICAgcmV0dXJuIGJhc2U2NC5lbmNvZGVCeXRlQXJyYXkodXRmOEJ5dGVzLCB0cnVlKTtcbn07XG4vKipcbiAqIFVSTC1zYWZlIGJhc2U2NCBlbmNvZGluZyAod2l0aG91dCBcIi5cIiBwYWRkaW5nIGluIHRoZSBlbmQpLlxuICogZS5nLiBVc2VkIGluIEpTT04gV2ViIFRva2VuIChKV1QpIHBhcnRzLlxuICovXG5jb25zdCBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICAvLyBVc2UgYmFzZTY0dXJsIGVuY29kaW5nIGFuZCByZW1vdmUgcGFkZGluZyBpbiB0aGUgZW5kIChkb3QgY2hhcmFjdGVycykuXG4gICAgcmV0dXJuIGJhc2U2NEVuY29kZShzdHIpLnJlcGxhY2UoL1xcLi9nLCAnJyk7XG59O1xuLyoqXG4gKiBVUkwtc2FmZSBiYXNlNjQgZGVjb2RpbmdcbiAqXG4gKiBOT1RFOiBETyBOT1QgdXNlIHRoZSBnbG9iYWwgYXRvYigpIGZ1bmN0aW9uIC0gaXQgZG9lcyBOT1Qgc3VwcG9ydCB0aGVcbiAqIGJhc2U2NFVybCB2YXJpYW50IGVuY29kaW5nLlxuICpcbiAqIEBwYXJhbSBzdHIgVG8gYmUgZGVjb2RlZFxuICogQHJldHVybiBEZWNvZGVkIHJlc3VsdCwgaWYgcG9zc2libGVcbiAqL1xuY29uc3QgYmFzZTY0RGVjb2RlID0gZnVuY3Rpb24gKHN0cikge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBiYXNlNjQuZGVjb2RlU3RyaW5nKHN0ciwgdHJ1ZSk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ2Jhc2U2NERlY29kZSBmYWlsZWQ6ICcsIGUpO1xuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvIGEgZGVlcC1jb3B5IG9mIGJhc2ljIEphdmFTY3JpcHQgT2JqZWN0cyBvciBBcnJheXMuXG4gKi9cbmZ1bmN0aW9uIGRlZXBDb3B5KHZhbHVlKSB7XG4gICAgcmV0dXJuIGRlZXBFeHRlbmQodW5kZWZpbmVkLCB2YWx1ZSk7XG59XG4vKipcbiAqIENvcHkgcHJvcGVydGllcyBmcm9tIHNvdXJjZSB0byB0YXJnZXQgKHJlY3Vyc2l2ZWx5IGFsbG93cyBleHRlbnNpb25cbiAqIG9mIE9iamVjdHMgYW5kIEFycmF5cykuICBTY2FsYXIgdmFsdWVzIGluIHRoZSB0YXJnZXQgYXJlIG92ZXItd3JpdHRlbi5cbiAqIElmIHRhcmdldCBpcyB1bmRlZmluZWQsIGFuIG9iamVjdCBvZiB0aGUgYXBwcm9wcmlhdGUgdHlwZSB3aWxsIGJlIGNyZWF0ZWRcbiAqIChhbmQgcmV0dXJuZWQpLlxuICpcbiAqIFdlIHJlY3Vyc2l2ZWx5IGNvcHkgYWxsIGNoaWxkIHByb3BlcnRpZXMgb2YgcGxhaW4gT2JqZWN0cyBpbiB0aGUgc291cmNlLSBzb1xuICogdGhhdCBuYW1lc3BhY2UtIGxpa2UgZGljdGlvbmFyaWVzIGFyZSBtZXJnZWQuXG4gKlxuICogTm90ZSB0aGF0IHRoZSB0YXJnZXQgY2FuIGJlIGEgZnVuY3Rpb24sIGluIHdoaWNoIGNhc2UgdGhlIHByb3BlcnRpZXMgaW5cbiAqIHRoZSBzb3VyY2UgT2JqZWN0IGFyZSBjb3BpZWQgb250byBpdCBhcyBzdGF0aWMgcHJvcGVydGllcyBvZiB0aGUgRnVuY3Rpb24uXG4gKlxuICogTm90ZTogd2UgZG9uJ3QgbWVyZ2UgX19wcm90b19fIHRvIHByZXZlbnQgcHJvdG90eXBlIHBvbGx1dGlvblxuICovXG5mdW5jdGlvbiBkZWVwRXh0ZW5kKHRhcmdldCwgc291cmNlKSB7XG4gICAgaWYgKCEoc291cmNlIGluc3RhbmNlb2YgT2JqZWN0KSkge1xuICAgICAgICByZXR1cm4gc291cmNlO1xuICAgIH1cbiAgICBzd2l0Y2ggKHNvdXJjZS5jb25zdHJ1Y3Rvcikge1xuICAgICAgICBjYXNlIERhdGU6XG4gICAgICAgICAgICAvLyBUcmVhdCBEYXRlcyBsaWtlIHNjYWxhcnM7IGlmIHRoZSB0YXJnZXQgZGF0ZSBvYmplY3QgaGFkIGFueSBjaGlsZFxuICAgICAgICAgICAgLy8gcHJvcGVydGllcyAtIHRoZXkgd2lsbCBiZSBsb3N0IVxuICAgICAgICAgICAgY29uc3QgZGF0ZVZhbHVlID0gc291cmNlO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBEYXRlKGRhdGVWYWx1ZS5nZXRUaW1lKCkpO1xuICAgICAgICBjYXNlIE9iamVjdDpcbiAgICAgICAgICAgIGlmICh0YXJnZXQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRhcmdldCA9IHt9O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQXJyYXk6XG4gICAgICAgICAgICAvLyBBbHdheXMgY29weSB0aGUgYXJyYXkgc291cmNlIGFuZCBvdmVyd3JpdGUgdGhlIHRhcmdldC5cbiAgICAgICAgICAgIHRhcmdldCA9IFtdO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAvLyBOb3QgYSBwbGFpbiBPYmplY3QgLSB0cmVhdCBpdCBhcyBhIHNjYWxhci5cbiAgICAgICAgICAgIHJldHVybiBzb3VyY2U7XG4gICAgfVxuICAgIGZvciAoY29uc3QgcHJvcCBpbiBzb3VyY2UpIHtcbiAgICAgICAgLy8gdXNlIGlzVmFsaWRLZXkgdG8gZ3VhcmQgYWdhaW5zdCBwcm90b3R5cGUgcG9sbHV0aW9uLiBTZWUgaHR0cHM6Ly9zbnlrLmlvL3Z1bG4vU05ZSy1KUy1MT0RBU0gtNDUwMjAyXG4gICAgICAgIGlmICghc291cmNlLmhhc093blByb3BlcnR5KHByb3ApIHx8ICFpc1ZhbGlkS2V5KHByb3ApKSB7XG4gICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuICAgICAgICB0YXJnZXRbcHJvcF0gPSBkZWVwRXh0ZW5kKHRhcmdldFtwcm9wXSwgc291cmNlW3Byb3BdKTtcbiAgICB9XG4gICAgcmV0dXJuIHRhcmdldDtcbn1cbmZ1bmN0aW9uIGlzVmFsaWRLZXkoa2V5KSB7XG4gICAgcmV0dXJuIGtleSAhPT0gJ19fcHJvdG9fXyc7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFBvbHlmaWxsIGZvciBgZ2xvYmFsVGhpc2Agb2JqZWN0LlxuICogQHJldHVybnMgdGhlIGBnbG9iYWxUaGlzYCBvYmplY3QgZm9yIHRoZSBnaXZlbiBlbnZpcm9ubWVudC5cbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gZ2V0R2xvYmFsKCkge1xuICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIHNlbGY7XG4gICAgfVxuICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm4gd2luZG93O1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGdsb2JhbCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGdsb2JhbDtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gbG9jYXRlIGdsb2JhbCBvYmplY3QuJyk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBnZXREZWZhdWx0c0Zyb21HbG9iYWwgPSAoKSA9PiBnZXRHbG9iYWwoKS5fX0ZJUkVCQVNFX0RFRkFVTFRTX187XG4vKipcbiAqIEF0dGVtcHQgdG8gcmVhZCBkZWZhdWx0cyBmcm9tIGEgSlNPTiBzdHJpbmcgcHJvdmlkZWQgdG9cbiAqIHByb2Nlc3MoLillbnYoLilfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb3IgYSBKU09OIGZpbGUgd2hvc2UgcGF0aCBpcyBpblxuICogcHJvY2VzcyguKWVudiguKV9fRklSRUJBU0VfREVGQVVMVFNfUEFUSF9fXG4gKiBUaGUgZG90cyBhcmUgaW4gcGFyZW5zIGJlY2F1c2UgY2VydGFpbiBjb21waWxlcnMgKFZpdGU/KSBjYW5ub3RcbiAqIGhhbmRsZSBzZWVpbmcgdGhhdCB2YXJpYWJsZSBpbiBjb21tZW50cy5cbiAqIFNlZSBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82ODM4XG4gKi9cbmNvbnN0IGdldERlZmF1bHRzRnJvbUVudlZhcmlhYmxlID0gKCkgPT4ge1xuICAgIGlmICh0eXBlb2YgcHJvY2VzcyA9PT0gJ3VuZGVmaW5lZCcgfHwgdHlwZW9mIHByb2Nlc3MuZW52ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGRlZmF1bHRzSnNvblN0cmluZyA9IHByb2Nlc3MuZW52Ll9fRklSRUJBU0VfREVGQVVMVFNfXztcbiAgICBpZiAoZGVmYXVsdHNKc29uU3RyaW5nKSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGRlZmF1bHRzSnNvblN0cmluZyk7XG4gICAgfVxufTtcbmNvbnN0IGdldERlZmF1bHRzRnJvbUNvb2tpZSA9ICgpID0+IHtcbiAgICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGxldCBtYXRjaDtcbiAgICB0cnkge1xuICAgICAgICBtYXRjaCA9IGRvY3VtZW50LmNvb2tpZS5tYXRjaCgvX19GSVJFQkFTRV9ERUZBVUxUU19fPShbXjtdKykvKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gU29tZSBlbnZpcm9ubWVudHMgc3VjaCBhcyBBbmd1bGFyIFVuaXZlcnNhbCBTU1IgaGF2ZSBhXG4gICAgICAgIC8vIGBkb2N1bWVudGAgb2JqZWN0IGJ1dCBlcnJvciBvbiBhY2Nlc3NpbmcgYGRvY3VtZW50LmNvb2tpZWAuXG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgZGVjb2RlZCA9IG1hdGNoICYmIGJhc2U2NERlY29kZShtYXRjaFsxXSk7XG4gICAgcmV0dXJuIGRlY29kZWQgJiYgSlNPTi5wYXJzZShkZWNvZGVkKTtcbn07XG4vKipcbiAqIEdldCB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdC4gSXQgY2hlY2tzIGluIG9yZGVyOlxuICogKDEpIGlmIHN1Y2ggYW4gb2JqZWN0IGV4aXN0cyBhcyBhIHByb3BlcnR5IG9mIGBnbG9iYWxUaGlzYFxuICogKDIpIGlmIHN1Y2ggYW4gb2JqZWN0IHdhcyBwcm92aWRlZCBvbiBhIHNoZWxsIGVudmlyb25tZW50IHZhcmlhYmxlXG4gKiAoMykgaWYgc3VjaCBhbiBvYmplY3QgZXhpc3RzIGluIGEgY29va2llXG4gKiBAcHVibGljXG4gKi9cbmNvbnN0IGdldERlZmF1bHRzID0gKCkgPT4ge1xuICAgIHRyeSB7XG4gICAgICAgIHJldHVybiAoZ2V0RGVmYXVsdHNGcm9tUG9zdGluc3RhbGwoKSB8fFxuICAgICAgICAgICAgZ2V0RGVmYXVsdHNGcm9tR2xvYmFsKCkgfHxcbiAgICAgICAgICAgIGdldERlZmF1bHRzRnJvbUVudlZhcmlhYmxlKCkgfHxcbiAgICAgICAgICAgIGdldERlZmF1bHRzRnJvbUNvb2tpZSgpKTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhdGNoLWFsbCBmb3IgYmVpbmcgdW5hYmxlIHRvIGdldCBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gZHVlXG4gICAgICAgICAqIHRvIGFueSBlbnZpcm9ubWVudCBjYXNlIHdlIGhhdmUgbm90IGFjY291bnRlZCBmb3IuIExvZyB0b1xuICAgICAgICAgKiBpbmZvIGluc3RlYWQgb2Ygc3dhbGxvd2luZyBzbyB3ZSBjYW4gZmluZCB0aGVzZSB1bmtub3duIGNhc2VzXG4gICAgICAgICAqIGFuZCBhZGQgcGF0aHMgZm9yIHRoZW0gaWYgbmVlZGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgY29uc29sZS5pbmZvKGBVbmFibGUgdG8gZ2V0IF9fRklSRUJBU0VfREVGQVVMVFNfXyBkdWUgdG86ICR7ZX1gKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn07XG4vKipcbiAqIFJldHVybnMgZW11bGF0b3IgaG9zdCBzdG9yZWQgaW4gdGhlIF9fRklSRUJBU0VfREVGQVVMVFNfXyBvYmplY3RcbiAqIGZvciB0aGUgZ2l2ZW4gcHJvZHVjdC5cbiAqIEByZXR1cm5zIGEgVVJMIGhvc3QgZm9ybWF0dGVkIGxpa2UgYDEyNy4wLjAuMTo5OTk5YCBvciBgWzo6MV06NDAwMGAgaWYgYXZhaWxhYmxlXG4gKiBAcHVibGljXG4gKi9cbmNvbnN0IGdldERlZmF1bHRFbXVsYXRvckhvc3QgPSAocHJvZHVjdE5hbWUpID0+IHsgdmFyIF9hLCBfYjsgcmV0dXJuIChfYiA9IChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5lbXVsYXRvckhvc3RzKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2JbcHJvZHVjdE5hbWVdOyB9O1xuLyoqXG4gKiBSZXR1cm5zIGVtdWxhdG9yIGhvc3RuYW1lIGFuZCBwb3J0IHN0b3JlZCBpbiB0aGUgX19GSVJFQkFTRV9ERUZBVUxUU19fIG9iamVjdFxuICogZm9yIHRoZSBnaXZlbiBwcm9kdWN0LlxuICogQHJldHVybnMgYSBwYWlyIG9mIGhvc3RuYW1lIGFuZCBwb3J0IGxpa2UgYFtcIjo6MVwiLCA0MDAwXWAgaWYgYXZhaWxhYmxlXG4gKiBAcHVibGljXG4gKi9cbmNvbnN0IGdldERlZmF1bHRFbXVsYXRvckhvc3RuYW1lQW5kUG9ydCA9IChwcm9kdWN0TmFtZSkgPT4ge1xuICAgIGNvbnN0IGhvc3QgPSBnZXREZWZhdWx0RW11bGF0b3JIb3N0KHByb2R1Y3ROYW1lKTtcbiAgICBpZiAoIWhvc3QpIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgY29uc3Qgc2VwYXJhdG9ySW5kZXggPSBob3N0Lmxhc3RJbmRleE9mKCc6Jyk7IC8vIEZpbmRpbmcgdGhlIGxhc3Qgc2luY2UgSVB2NiBhZGRyIGFsc28gaGFzIGNvbG9ucy5cbiAgICBpZiAoc2VwYXJhdG9ySW5kZXggPD0gMCB8fCBzZXBhcmF0b3JJbmRleCArIDEgPT09IGhvc3QubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBob3N0ICR7aG9zdH0gd2l0aCBubyBzZXBhcmF0ZSBob3N0bmFtZSBhbmQgcG9ydCFgKTtcbiAgICB9XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlc3RyaWN0ZWQtZ2xvYmFsc1xuICAgIGNvbnN0IHBvcnQgPSBwYXJzZUludChob3N0LnN1YnN0cmluZyhzZXBhcmF0b3JJbmRleCArIDEpLCAxMCk7XG4gICAgaWYgKGhvc3RbMF0gPT09ICdbJykge1xuICAgICAgICAvLyBCcmFja2V0LXF1b3RlZCBgW2lwdjZhZGRyXTpwb3J0YCA9PiByZXR1cm4gXCJpcHY2YWRkclwiICh3aXRob3V0IGJyYWNrZXRzKS5cbiAgICAgICAgcmV0dXJuIFtob3N0LnN1YnN0cmluZygxLCBzZXBhcmF0b3JJbmRleCAtIDEpLCBwb3J0XTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBbaG9zdC5zdWJzdHJpbmcoMCwgc2VwYXJhdG9ySW5kZXgpLCBwb3J0XTtcbiAgICB9XG59O1xuLyoqXG4gKiBSZXR1cm5zIEZpcmViYXNlIGFwcCBjb25maWcgc3RvcmVkIGluIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0LlxuICogQHB1YmxpY1xuICovXG5jb25zdCBnZXREZWZhdWx0QXBwQ29uZmlnID0gKCkgPT4geyB2YXIgX2E7IHJldHVybiAoX2EgPSBnZXREZWZhdWx0cygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY29uZmlnOyB9O1xuLyoqXG4gKiBSZXR1cm5zIGFuIGV4cGVyaW1lbnRhbCBzZXR0aW5nIG9uIHRoZSBfX0ZJUkVCQVNFX0RFRkFVTFRTX18gb2JqZWN0IChwcm9wZXJ0aWVzXG4gKiBwcmVmaXhlZCBieSBcIl9cIilcbiAqIEBwdWJsaWNcbiAqL1xuY29uc3QgZ2V0RXhwZXJpbWVudGFsU2V0dGluZyA9IChuYW1lKSA9PiB7IHZhciBfYTsgcmV0dXJuIChfYSA9IGdldERlZmF1bHRzKCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYVtgXyR7bmFtZX1gXTsgfTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIERlZmVycmVkIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZWplY3QgPSAoKSA9PiB7IH07XG4gICAgICAgIHRoaXMucmVzb2x2ZSA9ICgpID0+IHsgfTtcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZXNvbHZlID0gcmVzb2x2ZTtcbiAgICAgICAgICAgIHRoaXMucmVqZWN0ID0gcmVqZWN0O1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT3VyIEFQSSBpbnRlcm5hbHMgYXJlIG5vdCBwcm9taXNpZmllZCBhbmQgY2Fubm90IGJlY2F1c2Ugb3VyIGNhbGxiYWNrIEFQSXMgaGF2ZSBzdWJ0bGUgZXhwZWN0YXRpb25zIGFyb3VuZFxuICAgICAqIGludm9raW5nIHByb21pc2VzIGlubGluZSwgd2hpY2ggUHJvbWlzZXMgYXJlIGZvcmJpZGRlbiB0byBkby4gVGhpcyBtZXRob2QgYWNjZXB0cyBhbiBvcHRpb25hbCBub2RlLXN0eWxlIGNhbGxiYWNrXG4gICAgICogYW5kIHJldHVybnMgYSBub2RlLXN0eWxlIGNhbGxiYWNrIHdoaWNoIHdpbGwgcmVzb2x2ZSBvciByZWplY3QgdGhlIERlZmVycmVkJ3MgcHJvbWlzZS5cbiAgICAgKi9cbiAgICB3cmFwQ2FsbGJhY2soY2FsbGJhY2spIHtcbiAgICAgICAgcmV0dXJuIChlcnJvciwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucmVzb2x2ZSh2YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodHlwZW9mIGNhbGxiYWNrID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICAgICAgLy8gQXR0YWNoaW5nIG5vb3AgaGFuZGxlciBqdXN0IGluIGNhc2UgZGV2ZWxvcGVyIHdhc24ndCBleHBlY3RpbmdcbiAgICAgICAgICAgICAgICAvLyBwcm9taXNlc1xuICAgICAgICAgICAgICAgIHRoaXMucHJvbWlzZS5jYXRjaCgoKSA9PiB7IH0pO1xuICAgICAgICAgICAgICAgIC8vIFNvbWUgb2Ygb3VyIGNhbGxiYWNrcyBkb24ndCBleHBlY3QgYSB2YWx1ZSBhbmQgb3VyIG93biB0ZXN0c1xuICAgICAgICAgICAgICAgIC8vIGFzc2VydCB0aGF0IHRoZSBwYXJhbWV0ZXIgbGVuZ3RoIGlzIDFcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2subGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIGNyZWF0ZU1vY2tVc2VyVG9rZW4odG9rZW4sIHByb2plY3RJZCkge1xuICAgIGlmICh0b2tlbi51aWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgXCJ1aWRcIiBmaWVsZCBpcyBubyBsb25nZXIgc3VwcG9ydGVkIGJ5IG1vY2tVc2VyVG9rZW4uIFBsZWFzZSB1c2UgXCJzdWJcIiBpbnN0ZWFkIGZvciBGaXJlYmFzZSBBdXRoIFVzZXIgSUQuJyk7XG4gICAgfVxuICAgIC8vIFVuc2VjdXJlZCBKV1RzIHVzZSBcIm5vbmVcIiBhcyB0aGUgYWxnb3JpdGhtLlxuICAgIGNvbnN0IGhlYWRlciA9IHtcbiAgICAgICAgYWxnOiAnbm9uZScsXG4gICAgICAgIHR5cGU6ICdKV1QnXG4gICAgfTtcbiAgICBjb25zdCBwcm9qZWN0ID0gcHJvamVjdElkIHx8ICdkZW1vLXByb2plY3QnO1xuICAgIGNvbnN0IGlhdCA9IHRva2VuLmlhdCB8fCAwO1xuICAgIGNvbnN0IHN1YiA9IHRva2VuLnN1YiB8fCB0b2tlbi51c2VyX2lkO1xuICAgIGlmICghc3ViKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIm1vY2tVc2VyVG9rZW4gbXVzdCBjb250YWluICdzdWInIG9yICd1c2VyX2lkJyBmaWVsZCFcIik7XG4gICAgfVxuICAgIGNvbnN0IHBheWxvYWQgPSBPYmplY3QuYXNzaWduKHsgXG4gICAgICAgIC8vIFNldCBhbGwgcmVxdWlyZWQgZmllbGRzIHRvIGRlY2VudCBkZWZhdWx0c1xuICAgICAgICBpc3M6IGBodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vJHtwcm9qZWN0fWAsIGF1ZDogcHJvamVjdCwgaWF0LCBleHA6IGlhdCArIDM2MDAsIGF1dGhfdGltZTogaWF0LCBzdWIsIHVzZXJfaWQ6IHN1YiwgZmlyZWJhc2U6IHtcbiAgICAgICAgICAgIHNpZ25faW5fcHJvdmlkZXI6ICdjdXN0b20nLFxuICAgICAgICAgICAgaWRlbnRpdGllczoge31cbiAgICAgICAgfSB9LCB0b2tlbik7XG4gICAgLy8gVW5zZWN1cmVkIEpXVHMgdXNlIHRoZSBlbXB0eSBzdHJpbmcgYXMgYSBzaWduYXR1cmUuXG4gICAgY29uc3Qgc2lnbmF0dXJlID0gJyc7XG4gICAgcmV0dXJuIFtcbiAgICAgICAgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkoaGVhZGVyKSksXG4gICAgICAgIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nKEpTT04uc3RyaW5naWZ5KHBheWxvYWQpKSxcbiAgICAgICAgc2lnbmF0dXJlXG4gICAgXS5qb2luKCcuJyk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgbmF2aWdhdG9yLnVzZXJBZ2VudCBzdHJpbmcgb3IgJycgaWYgaXQncyBub3QgZGVmaW5lZC5cbiAqIEByZXR1cm4gdXNlciBhZ2VudCBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gZ2V0VUEoKSB7XG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgIHR5cGVvZiBuYXZpZ2F0b3JbJ3VzZXJBZ2VudCddID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gbmF2aWdhdG9yWyd1c2VyQWdlbnQnXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9XG59XG4vKipcbiAqIERldGVjdCBDb3Jkb3ZhIC8gUGhvbmVHYXAgLyBJb25pYyBmcmFtZXdvcmtzIG9uIGEgbW9iaWxlIGRldmljZS5cbiAqXG4gKiBEZWxpYmVyYXRlbHkgZG9lcyBub3QgcmVseSBvbiBjaGVja2luZyBgZmlsZTovL2AgVVJMcyAoYXMgdGhpcyBmYWlscyBQaG9uZUdhcFxuICogaW4gdGhlIFJpcHBsZSBlbXVsYXRvcikgbm9yIENvcmRvdmEgYG9uRGV2aWNlUmVhZHlgLCB3aGljaCB3b3VsZCBub3JtYWxseVxuICogd2FpdCBmb3IgYSBjYWxsYmFjay5cbiAqL1xuZnVuY3Rpb24gaXNNb2JpbGVDb3Jkb3ZhKCkge1xuICAgIHJldHVybiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgLy8gQHRzLWlnbm9yZSBTZXR0aW5nIHVwIGFuIGJyb2FkbHkgYXBwbGljYWJsZSBpbmRleCBzaWduYXR1cmUgZm9yIFdpbmRvd1xuICAgICAgICAvLyBqdXN0IHRvIGRlYWwgd2l0aCB0aGlzIGNhc2Ugd291bGQgcHJvYmFibHkgYmUgYSBiYWQgaWRlYS5cbiAgICAgICAgISEod2luZG93Wydjb3Jkb3ZhJ10gfHwgd2luZG93WydwaG9uZWdhcCddIHx8IHdpbmRvd1snUGhvbmVHYXAnXSkgJiZcbiAgICAgICAgL2lvc3xpcGhvbmV8aXBvZHxpcGFkfGFuZHJvaWR8YmxhY2tiZXJyeXxpZW1vYmlsZS9pLnRlc3QoZ2V0VUEoKSkpO1xufVxuLyoqXG4gKiBEZXRlY3QgTm9kZS5qcy5cbiAqXG4gKiBAcmV0dXJuIHRydWUgaWYgTm9kZS5qcyBlbnZpcm9ubWVudCBpcyBkZXRlY3RlZCBvciBzcGVjaWZpZWQuXG4gKi9cbi8vIE5vZGUgZGV0ZWN0aW9uIGxvZ2ljIGZyb206IGh0dHBzOi8vZ2l0aHViLmNvbS9pbGlha2FuL2RldGVjdC1ub2RlL1xuZnVuY3Rpb24gaXNOb2RlKCkge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBmb3JjZUVudmlyb25tZW50ID0gKF9hID0gZ2V0RGVmYXVsdHMoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmZvcmNlRW52aXJvbm1lbnQ7XG4gICAgaWYgKGZvcmNlRW52aXJvbm1lbnQgPT09ICdub2RlJykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSBpZiAoZm9yY2VFbnZpcm9ubWVudCA9PT0gJ2Jyb3dzZXInKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoZ2xvYmFsLnByb2Nlc3MpID09PSAnW29iamVjdCBwcm9jZXNzXScpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuLyoqXG4gKiBEZXRlY3QgQnJvd3NlciBFbnZpcm9ubWVudC5cbiAqIE5vdGU6IFRoaXMgd2lsbCByZXR1cm4gdHJ1ZSBmb3IgY2VydGFpbiB0ZXN0IGZyYW1ld29ya3MgdGhhdCBhcmUgaW5jb21wbGV0ZWx5XG4gKiBtaW1pY2tpbmcgYSBicm93c2VyLCBhbmQgc2hvdWxkIG5vdCBsZWFkIHRvIGFzc3VtaW5nIGFsbCBicm93c2VyIEFQSXMgYXJlXG4gKiBhdmFpbGFibGUuXG4gKi9cbmZ1bmN0aW9uIGlzQnJvd3NlcigpIHtcbiAgICByZXR1cm4gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgfHwgaXNXZWJXb3JrZXIoKTtcbn1cbi8qKlxuICogRGV0ZWN0IFdlYiBXb3JrZXIgY29udGV4dC5cbiAqL1xuZnVuY3Rpb24gaXNXZWJXb3JrZXIoKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgV29ya2VyR2xvYmFsU2NvcGUgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgIHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICBzZWxmIGluc3RhbmNlb2YgV29ya2VyR2xvYmFsU2NvcGUpO1xufVxuLyoqXG4gKiBEZXRlY3QgQ2xvdWRmbGFyZSBXb3JrZXIgY29udGV4dC5cbiAqL1xuZnVuY3Rpb24gaXNDbG91ZGZsYXJlV29ya2VyKCkge1xuICAgIHJldHVybiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgbmF2aWdhdG9yLnVzZXJBZ2VudCA9PT0gJ0Nsb3VkZmxhcmUtV29ya2VycycpO1xufVxuZnVuY3Rpb24gaXNCcm93c2VyRXh0ZW5zaW9uKCkge1xuICAgIGNvbnN0IHJ1bnRpbWUgPSB0eXBlb2YgY2hyb21lID09PSAnb2JqZWN0J1xuICAgICAgICA/IGNocm9tZS5ydW50aW1lXG4gICAgICAgIDogdHlwZW9mIGJyb3dzZXIgPT09ICdvYmplY3QnXG4gICAgICAgICAgICA/IGJyb3dzZXIucnVudGltZVxuICAgICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgcmV0dXJuIHR5cGVvZiBydW50aW1lID09PSAnb2JqZWN0JyAmJiBydW50aW1lLmlkICE9PSB1bmRlZmluZWQ7XG59XG4vKipcbiAqIERldGVjdCBSZWFjdCBOYXRpdmUuXG4gKlxuICogQHJldHVybiB0cnVlIGlmIFJlYWN0TmF0aXZlIGVudmlyb25tZW50IGlzIGRldGVjdGVkLlxuICovXG5mdW5jdGlvbiBpc1JlYWN0TmF0aXZlKCkge1xuICAgIHJldHVybiAodHlwZW9mIG5hdmlnYXRvciA9PT0gJ29iamVjdCcgJiYgbmF2aWdhdG9yWydwcm9kdWN0J10gPT09ICdSZWFjdE5hdGl2ZScpO1xufVxuLyoqIERldGVjdHMgRWxlY3Ryb24gYXBwcy4gKi9cbmZ1bmN0aW9uIGlzRWxlY3Ryb24oKSB7XG4gICAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignRWxlY3Ryb24vJykgPj0gMDtcbn1cbi8qKiBEZXRlY3RzIEludGVybmV0IEV4cGxvcmVyLiAqL1xuZnVuY3Rpb24gaXNJRSgpIHtcbiAgICBjb25zdCB1YSA9IGdldFVBKCk7XG4gICAgcmV0dXJuIHVhLmluZGV4T2YoJ01TSUUgJykgPj0gMCB8fCB1YS5pbmRleE9mKCdUcmlkZW50LycpID49IDA7XG59XG4vKiogRGV0ZWN0cyBVbml2ZXJzYWwgV2luZG93cyBQbGF0Zm9ybSBhcHBzLiAqL1xuZnVuY3Rpb24gaXNVV1AoKSB7XG4gICAgcmV0dXJuIGdldFVBKCkuaW5kZXhPZignTVNBcHBIb3N0LycpID49IDA7XG59XG4vKipcbiAqIERldGVjdCB3aGV0aGVyIHRoZSBjdXJyZW50IFNESyBidWlsZCBpcyB0aGUgTm9kZSB2ZXJzaW9uLlxuICpcbiAqIEByZXR1cm4gdHJ1ZSBpZiBpdCdzIHRoZSBOb2RlIFNESyBidWlsZC5cbiAqL1xuZnVuY3Rpb24gaXNOb2RlU2RrKCkge1xuICAgIHJldHVybiBDT05TVEFOVFMuTk9ERV9DTElFTlQgPT09IHRydWUgfHwgQ09OU1RBTlRTLk5PREVfQURNSU4gPT09IHRydWU7XG59XG4vKiogUmV0dXJucyB0cnVlIGlmIHdlIGFyZSBydW5uaW5nIGluIFNhZmFyaS4gKi9cbmZ1bmN0aW9uIGlzU2FmYXJpKCkge1xuICAgIHJldHVybiAoIWlzTm9kZSgpICYmXG4gICAgICAgICEhbmF2aWdhdG9yLnVzZXJBZ2VudCAmJlxuICAgICAgICBuYXZpZ2F0b3IudXNlckFnZW50LmluY2x1ZGVzKCdTYWZhcmknKSAmJlxuICAgICAgICAhbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmNsdWRlcygnQ2hyb21lJykpO1xufVxuLyoqXG4gKiBUaGlzIG1ldGhvZCBjaGVja3MgaWYgaW5kZXhlZERCIGlzIHN1cHBvcnRlZCBieSBjdXJyZW50IGJyb3dzZXIvc2VydmljZSB3b3JrZXIgY29udGV4dFxuICogQHJldHVybiB0cnVlIGlmIGluZGV4ZWREQiBpcyBzdXBwb3J0ZWQgYnkgY3VycmVudCBicm93c2VyL3NlcnZpY2Ugd29ya2VyIGNvbnRleHRcbiAqL1xuZnVuY3Rpb24gaXNJbmRleGVkREJBdmFpbGFibGUoKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIHR5cGVvZiBpbmRleGVkREIgPT09ICdvYmplY3QnO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuLyoqXG4gKiBUaGlzIG1ldGhvZCB2YWxpZGF0ZXMgYnJvd3Nlci9zdyBjb250ZXh0IGZvciBpbmRleGVkREIgYnkgb3BlbmluZyBhIGR1bW15IGluZGV4ZWREQiBkYXRhYmFzZSBhbmQgcmVqZWN0XG4gKiBpZiBlcnJvcnMgb2NjdXIgZHVyaW5nIHRoZSBkYXRhYmFzZSBvcGVuIG9wZXJhdGlvbi5cbiAqXG4gKiBAdGhyb3dzIGV4Y2VwdGlvbiBpZiBjdXJyZW50IGJyb3dzZXIvc3cgY29udGV4dCBjYW4ndCBydW4gaWRiLm9wZW4gKGV4OiBTYWZhcmkgaWZyYW1lLCBGaXJlZm94XG4gKiBwcml2YXRlIGJyb3dzaW5nKVxuICovXG5mdW5jdGlvbiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKCkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgcHJlRXhpc3QgPSB0cnVlO1xuICAgICAgICAgICAgY29uc3QgREJfQ0hFQ0tfTkFNRSA9ICd2YWxpZGF0ZS1icm93c2VyLWNvbnRleHQtZm9yLWluZGV4ZWRkYi1hbmFseXRpY3MtbW9kdWxlJztcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSBzZWxmLmluZGV4ZWREQi5vcGVuKERCX0NIRUNLX05BTUUpO1xuICAgICAgICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdC5yZXN1bHQuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAvLyBkZWxldGUgZGF0YWJhc2Ugb25seSB3aGVuIGl0IGRvZXNuJ3QgcHJlLWV4aXN0XG4gICAgICAgICAgICAgICAgaWYgKCFwcmVFeGlzdCkge1xuICAgICAgICAgICAgICAgICAgICBzZWxmLmluZGV4ZWREQi5kZWxldGVEYXRhYmFzZShEQl9DSEVDS19OQU1FKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0cnVlKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXF1ZXN0Lm9udXBncmFkZW5lZWRlZCA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBwcmVFeGlzdCA9IGZhbHNlO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHJlcXVlc3Qub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgX2E7XG4gICAgICAgICAgICAgICAgcmVqZWN0KCgoX2EgPSByZXF1ZXN0LmVycm9yKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubWVzc2FnZSkgfHwgJycpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIHJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbi8qKlxuICpcbiAqIFRoaXMgbWV0aG9kIGNoZWNrcyB3aGV0aGVyIGNvb2tpZSBpcyBlbmFibGVkIHdpdGhpbiBjdXJyZW50IGJyb3dzZXJcbiAqIEByZXR1cm4gdHJ1ZSBpZiBjb29raWUgaXMgZW5hYmxlZCB3aXRoaW4gY3VycmVudCBicm93c2VyXG4gKi9cbmZ1bmN0aW9uIGFyZUNvb2tpZXNFbmFibGVkKCkge1xuICAgIGlmICh0eXBlb2YgbmF2aWdhdG9yID09PSAndW5kZWZpbmVkJyB8fCAhbmF2aWdhdG9yLmNvb2tpZUVuYWJsZWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQGZpbGVvdmVydmlldyBTdGFuZGFyZGl6ZWQgRmlyZWJhc2UgRXJyb3IuXG4gKlxuICogVXNhZ2U6XG4gKlxuICogICAvLyBUeXBlU2NyaXB0IHN0cmluZyBsaXRlcmFscyBmb3IgdHlwZS1zYWZlIGNvZGVzXG4gKiAgIHR5cGUgRXJyID1cbiAqICAgICAndW5rbm93bicgfFxuICogICAgICdvYmplY3Qtbm90LWZvdW5kJ1xuICogICAgIDtcbiAqXG4gKiAgIC8vIENsb3N1cmUgZW51bSBmb3IgdHlwZS1zYWZlIGVycm9yIGNvZGVzXG4gKiAgIC8vIGF0LWVudW0ge3N0cmluZ31cbiAqICAgdmFyIEVyciA9IHtcbiAqICAgICBVTktOT1dOOiAndW5rbm93bicsXG4gKiAgICAgT0JKRUNUX05PVF9GT1VORDogJ29iamVjdC1ub3QtZm91bmQnLFxuICogICB9XG4gKlxuICogICBsZXQgZXJyb3JzOiBNYXA8RXJyLCBzdHJpbmc+ID0ge1xuICogICAgICdnZW5lcmljLWVycm9yJzogXCJVbmtub3duIGVycm9yXCIsXG4gKiAgICAgJ2ZpbGUtbm90LWZvdW5kJzogXCJDb3VsZCBub3QgZmluZCBmaWxlOiB7JGZpbGV9XCIsXG4gKiAgIH07XG4gKlxuICogICAvLyBUeXBlLXNhZmUgZnVuY3Rpb24gLSBtdXN0IHBhc3MgYSB2YWxpZCBlcnJvciBjb2RlIGFzIHBhcmFtLlxuICogICBsZXQgZXJyb3IgPSBuZXcgRXJyb3JGYWN0b3J5PEVycj4oJ3NlcnZpY2UnLCAnU2VydmljZScsIGVycm9ycyk7XG4gKlxuICogICAuLi5cbiAqICAgdGhyb3cgZXJyb3IuY3JlYXRlKEVyci5HRU5FUklDKTtcbiAqICAgLi4uXG4gKiAgIHRocm93IGVycm9yLmNyZWF0ZShFcnIuRklMRV9OT1RfRk9VTkQsIHsnZmlsZSc6IGZpbGVOYW1lfSk7XG4gKiAgIC4uLlxuICogICAvLyBTZXJ2aWNlOiBDb3VsZCBub3QgZmlsZSBmaWxlOiBmb28udHh0IChzZXJ2aWNlL2ZpbGUtbm90LWZvdW5kKS5cbiAqXG4gKiAgIGNhdGNoIChlKSB7XG4gKiAgICAgYXNzZXJ0KGUubWVzc2FnZSA9PT0gXCJDb3VsZCBub3QgZmluZCBmaWxlOiBmb28udHh0LlwiKTtcbiAqICAgICBpZiAoKGUgYXMgRmlyZWJhc2VFcnJvcik/LmNvZGUgPT09ICdzZXJ2aWNlL2ZpbGUtbm90LWZvdW5kJykge1xuICogICAgICAgY29uc29sZS5sb2coXCJDb3VsZCBub3QgcmVhZCBmaWxlOiBcIiArIGVbJ2ZpbGUnXSk7XG4gKiAgICAgfVxuICogICB9XG4gKi9cbmNvbnN0IEVSUk9SX05BTUUgPSAnRmlyZWJhc2VFcnJvcic7XG4vLyBCYXNlZCBvbiBjb2RlIGZyb206XG4vLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9FcnJvciNDdXN0b21fRXJyb3JfVHlwZXNcbmNsYXNzIEZpcmViYXNlRXJyb3IgZXh0ZW5kcyBFcnJvciB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIFRoZSBlcnJvciBjb2RlIGZvciB0aGlzIGVycm9yLiAqL1xuICAgIGNvZGUsIG1lc3NhZ2UsIFxuICAgIC8qKiBDdXN0b20gZGF0YSBmb3IgdGhpcyBlcnJvci4gKi9cbiAgICBjdXN0b21EYXRhKSB7XG4gICAgICAgIHN1cGVyKG1lc3NhZ2UpO1xuICAgICAgICB0aGlzLmNvZGUgPSBjb2RlO1xuICAgICAgICB0aGlzLmN1c3RvbURhdGEgPSBjdXN0b21EYXRhO1xuICAgICAgICAvKiogVGhlIGN1c3RvbSBuYW1lIGZvciBhbGwgRmlyZWJhc2VFcnJvcnMuICovXG4gICAgICAgIHRoaXMubmFtZSA9IEVSUk9SX05BTUU7XG4gICAgICAgIC8vIEZpeCBGb3IgRVM1XG4gICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9NaWNyb3NvZnQvVHlwZVNjcmlwdC13aWtpL2Jsb2IvbWFzdGVyL0JyZWFraW5nLUNoYW5nZXMubWQjZXh0ZW5kaW5nLWJ1aWx0LWlucy1saWtlLWVycm9yLWFycmF5LWFuZC1tYXAtbWF5LW5vLWxvbmdlci13b3JrXG4gICAgICAgIC8vIFRPRE8oZGxhcm9jcXVlKTogUmVwbGFjZSB0aGlzIHdpdGggYG5ldy50YXJnZXRgOiBodHRwczovL3d3dy50eXBlc2NyaXB0bGFuZy5vcmcvZG9jcy9oYW5kYm9vay9yZWxlYXNlLW5vdGVzL3R5cGVzY3JpcHQtMi0yLmh0bWwjc3VwcG9ydC1mb3ItbmV3dGFyZ2V0XG4gICAgICAgIC8vICAgICAgICAgICAgICAgICAgIHdoaWNoIHdlIGNhbiBub3cgdXNlIHNpbmNlIHdlIG5vIGxvbmdlciB0YXJnZXQgRVM1LlxuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2YodGhpcywgRmlyZWJhc2VFcnJvci5wcm90b3R5cGUpO1xuICAgICAgICAvLyBNYWludGFpbnMgcHJvcGVyIHN0YWNrIHRyYWNlIGZvciB3aGVyZSBvdXIgZXJyb3Igd2FzIHRocm93bi5cbiAgICAgICAgLy8gT25seSBhdmFpbGFibGUgb24gVjguXG4gICAgICAgIGlmIChFcnJvci5jYXB0dXJlU3RhY2tUcmFjZSkge1xuICAgICAgICAgICAgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcywgRXJyb3JGYWN0b3J5LnByb3RvdHlwZS5jcmVhdGUpO1xuICAgICAgICB9XG4gICAgfVxufVxuY2xhc3MgRXJyb3JGYWN0b3J5IHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlLCBzZXJ2aWNlTmFtZSwgZXJyb3JzKSB7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgICAgIHRoaXMuc2VydmljZU5hbWUgPSBzZXJ2aWNlTmFtZTtcbiAgICAgICAgdGhpcy5lcnJvcnMgPSBlcnJvcnM7XG4gICAgfVxuICAgIGNyZWF0ZShjb2RlLCAuLi5kYXRhKSB7XG4gICAgICAgIGNvbnN0IGN1c3RvbURhdGEgPSBkYXRhWzBdIHx8IHt9O1xuICAgICAgICBjb25zdCBmdWxsQ29kZSA9IGAke3RoaXMuc2VydmljZX0vJHtjb2RlfWA7XG4gICAgICAgIGNvbnN0IHRlbXBsYXRlID0gdGhpcy5lcnJvcnNbY29kZV07XG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSB0ZW1wbGF0ZSA/IHJlcGxhY2VUZW1wbGF0ZSh0ZW1wbGF0ZSwgY3VzdG9tRGF0YSkgOiAnRXJyb3InO1xuICAgICAgICAvLyBTZXJ2aWNlIE5hbWU6IEVycm9yIG1lc3NhZ2UgKHNlcnZpY2UvY29kZSkuXG4gICAgICAgIGNvbnN0IGZ1bGxNZXNzYWdlID0gYCR7dGhpcy5zZXJ2aWNlTmFtZX06ICR7bWVzc2FnZX0gKCR7ZnVsbENvZGV9KS5gO1xuICAgICAgICBjb25zdCBlcnJvciA9IG5ldyBGaXJlYmFzZUVycm9yKGZ1bGxDb2RlLCBmdWxsTWVzc2FnZSwgY3VzdG9tRGF0YSk7XG4gICAgICAgIHJldHVybiBlcnJvcjtcbiAgICB9XG59XG5mdW5jdGlvbiByZXBsYWNlVGVtcGxhdGUodGVtcGxhdGUsIGRhdGEpIHtcbiAgICByZXR1cm4gdGVtcGxhdGUucmVwbGFjZShQQVRURVJOLCAoXywga2V5KSA9PiB7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gZGF0YVtrZXldO1xuICAgICAgICByZXR1cm4gdmFsdWUgIT0gbnVsbCA/IFN0cmluZyh2YWx1ZSkgOiBgPCR7a2V5fT8+YDtcbiAgICB9KTtcbn1cbmNvbnN0IFBBVFRFUk4gPSAvXFx7XFwkKFtefV0rKX0vZztcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRXZhbHVhdGVzIGEgSlNPTiBzdHJpbmcgaW50byBhIGphdmFzY3JpcHQgb2JqZWN0LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzdHIgQSBzdHJpbmcgY29udGFpbmluZyBKU09OLlxuICogQHJldHVybiB7Kn0gVGhlIGphdmFzY3JpcHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc3BlY2lmaWVkIEpTT04uXG4gKi9cbmZ1bmN0aW9uIGpzb25FdmFsKHN0cikge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHN0cik7XG59XG4vKipcbiAqIFJldHVybnMgSlNPTiByZXByZXNlbnRpbmcgYSBqYXZhc2NyaXB0IG9iamVjdC5cbiAqIEBwYXJhbSB7Kn0gZGF0YSBKYXZhU2NyaXB0IG9iamVjdCB0byBiZSBzdHJpbmdpZmllZC5cbiAqIEByZXR1cm4ge3N0cmluZ30gVGhlIEpTT04gY29udGVudHMgb2YgdGhlIG9iamVjdC5cbiAqL1xuZnVuY3Rpb24gc3RyaW5naWZ5KGRhdGEpIHtcbiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBpbnRvIGNvbnN0aXR1ZW50IHBhcnRzLlxuICpcbiAqIE5vdGVzOlxuICogLSBNYXkgcmV0dXJuIHdpdGggaW52YWxpZCAvIGluY29tcGxldGUgY2xhaW1zIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cbiAqL1xuY29uc3QgZGVjb2RlID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgbGV0IGhlYWRlciA9IHt9LCBjbGFpbXMgPSB7fSwgZGF0YSA9IHt9LCBzaWduYXR1cmUgPSAnJztcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBwYXJ0cyA9IHRva2VuLnNwbGl0KCcuJyk7XG4gICAgICAgIGhlYWRlciA9IGpzb25FdmFsKGJhc2U2NERlY29kZShwYXJ0c1swXSkgfHwgJycpO1xuICAgICAgICBjbGFpbXMgPSBqc29uRXZhbChiYXNlNjREZWNvZGUocGFydHNbMV0pIHx8ICcnKTtcbiAgICAgICAgc2lnbmF0dXJlID0gcGFydHNbMl07XG4gICAgICAgIGRhdGEgPSBjbGFpbXNbJ2QnXSB8fCB7fTtcbiAgICAgICAgZGVsZXRlIGNsYWltc1snZCddO1xuICAgIH1cbiAgICBjYXRjaCAoZSkgeyB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaGVhZGVyLFxuICAgICAgICBjbGFpbXMsXG4gICAgICAgIGRhdGEsXG4gICAgICAgIHNpZ25hdHVyZVxuICAgIH07XG59O1xuLyoqXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gYW5kIGNoZWNrcyB0aGUgdmFsaWRpdHkgb2YgaXRzIHRpbWUtYmFzZWQgY2xhaW1zLiBXaWxsIHJldHVybiB0cnVlIGlmIHRoZVxuICogdG9rZW4gaXMgd2l0aGluIHRoZSB0aW1lIHdpbmRvdyBhdXRob3JpemVkIGJ5IHRoZSAnbmJmJyAobm90LWJlZm9yZSkgYW5kICdpYXQnIChpc3N1ZWQtYXQpIGNsYWltcy5cbiAqXG4gKiBOb3RlczpcbiAqIC0gTWF5IHJldHVybiBhIGZhbHNlIG5lZ2F0aXZlIGlmIHRoZXJlJ3Mgbm8gbmF0aXZlIGJhc2U2NCBkZWNvZGluZyBzdXBwb3J0LlxuICogLSBEb2Vzbid0IGNoZWNrIGlmIHRoZSB0b2tlbiBpcyBhY3R1YWxseSB2YWxpZC5cbiAqL1xuY29uc3QgaXNWYWxpZFRpbWVzdGFtcCA9IGZ1bmN0aW9uICh0b2tlbikge1xuICAgIGNvbnN0IGNsYWltcyA9IGRlY29kZSh0b2tlbikuY2xhaW1zO1xuICAgIGNvbnN0IG5vdyA9IE1hdGguZmxvb3IobmV3IERhdGUoKS5nZXRUaW1lKCkgLyAxMDAwKTtcbiAgICBsZXQgdmFsaWRTaW5jZSA9IDAsIHZhbGlkVW50aWwgPSAwO1xuICAgIGlmICh0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0Jykge1xuICAgICAgICBpZiAoY2xhaW1zLmhhc093blByb3BlcnR5KCduYmYnKSkge1xuICAgICAgICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snbmJmJ107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2xhaW1zLmhhc093blByb3BlcnR5KCdpYXQnKSkge1xuICAgICAgICAgICAgdmFsaWRTaW5jZSA9IGNsYWltc1snaWF0J107XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNsYWltcy5oYXNPd25Qcm9wZXJ0eSgnZXhwJykpIHtcbiAgICAgICAgICAgIHZhbGlkVW50aWwgPSBjbGFpbXNbJ2V4cCddO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gdG9rZW4gd2lsbCBleHBpcmUgYWZ0ZXIgMjRoIGJ5IGRlZmF1bHRcbiAgICAgICAgICAgIHZhbGlkVW50aWwgPSB2YWxpZFNpbmNlICsgODY0MDA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuICghIW5vdyAmJlxuICAgICAgICAhIXZhbGlkU2luY2UgJiZcbiAgICAgICAgISF2YWxpZFVudGlsICYmXG4gICAgICAgIG5vdyA+PSB2YWxpZFNpbmNlICYmXG4gICAgICAgIG5vdyA8PSB2YWxpZFVudGlsKTtcbn07XG4vKipcbiAqIERlY29kZXMgYSBGaXJlYmFzZSBhdXRoLiB0b2tlbiBhbmQgcmV0dXJucyBpdHMgaXNzdWVkIGF0IHRpbWUgaWYgdmFsaWQsIG51bGwgb3RoZXJ3aXNlLlxuICpcbiAqIE5vdGVzOlxuICogLSBNYXkgcmV0dXJuIG51bGwgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxuICovXG5jb25zdCBpc3N1ZWRBdFRpbWUgPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICBjb25zdCBjbGFpbXMgPSBkZWNvZGUodG9rZW4pLmNsYWltcztcbiAgICBpZiAodHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zLmhhc093blByb3BlcnR5KCdpYXQnKSkge1xuICAgICAgICByZXR1cm4gY2xhaW1zWydpYXQnXTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG59O1xuLyoqXG4gKiBEZWNvZGVzIGEgRmlyZWJhc2UgYXV0aC4gdG9rZW4gYW5kIGNoZWNrcyB0aGUgdmFsaWRpdHkgb2YgaXRzIGZvcm1hdC4gRXhwZWN0cyBhIHZhbGlkIGlzc3VlZC1hdCB0aW1lLlxuICpcbiAqIE5vdGVzOlxuICogLSBNYXkgcmV0dXJuIGEgZmFsc2UgbmVnYXRpdmUgaWYgdGhlcmUncyBubyBuYXRpdmUgYmFzZTY0IGRlY29kaW5nIHN1cHBvcnQuXG4gKiAtIERvZXNuJ3QgY2hlY2sgaWYgdGhlIHRva2VuIGlzIGFjdHVhbGx5IHZhbGlkLlxuICovXG5jb25zdCBpc1ZhbGlkRm9ybWF0ID0gZnVuY3Rpb24gKHRva2VuKSB7XG4gICAgY29uc3QgZGVjb2RlZCA9IGRlY29kZSh0b2tlbiksIGNsYWltcyA9IGRlY29kZWQuY2xhaW1zO1xuICAgIHJldHVybiAhIWNsYWltcyAmJiB0eXBlb2YgY2xhaW1zID09PSAnb2JqZWN0JyAmJiBjbGFpbXMuaGFzT3duUHJvcGVydHkoJ2lhdCcpO1xufTtcbi8qKlxuICogQXR0ZW1wdHMgdG8gcGVlciBpbnRvIGFuIGF1dGggdG9rZW4gYW5kIGRldGVybWluZSBpZiBpdCdzIGFuIGFkbWluIGF1dGggdG9rZW4gYnkgbG9va2luZyBhdCB0aGUgY2xhaW1zIHBvcnRpb24uXG4gKlxuICogTm90ZXM6XG4gKiAtIE1heSByZXR1cm4gYSBmYWxzZSBuZWdhdGl2ZSBpZiB0aGVyZSdzIG5vIG5hdGl2ZSBiYXNlNjQgZGVjb2Rpbmcgc3VwcG9ydC5cbiAqIC0gRG9lc24ndCBjaGVjayBpZiB0aGUgdG9rZW4gaXMgYWN0dWFsbHkgdmFsaWQuXG4gKi9cbmNvbnN0IGlzQWRtaW4gPSBmdW5jdGlvbiAodG9rZW4pIHtcbiAgICBjb25zdCBjbGFpbXMgPSBkZWNvZGUodG9rZW4pLmNsYWltcztcbiAgICByZXR1cm4gdHlwZW9mIGNsYWltcyA9PT0gJ29iamVjdCcgJiYgY2xhaW1zWydhZG1pbiddID09PSB0cnVlO1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIGNvbnRhaW5zKG9iaiwga2V5KSB7XG4gICAgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSk7XG59XG5mdW5jdGlvbiBzYWZlR2V0KG9iaiwga2V5KSB7XG4gICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcbiAgICAgICAgcmV0dXJuIG9ialtrZXldO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG59XG5mdW5jdGlvbiBpc0VtcHR5KG9iaikge1xuICAgIGZvciAoY29uc3Qga2V5IGluIG9iaikge1xuICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuZnVuY3Rpb24gbWFwKG9iaiwgZm4sIGNvbnRleHRPYmopIHtcbiAgICBjb25zdCByZXMgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHtcbiAgICAgICAgICAgIHJlc1trZXldID0gZm4uY2FsbChjb250ZXh0T2JqLCBvYmpba2V5XSwga2V5LCBvYmopO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXM7XG59XG4vKipcbiAqIERlZXAgZXF1YWwgdHdvIG9iamVjdHMuIFN1cHBvcnQgQXJyYXlzIGFuZCBPYmplY3RzLlxuICovXG5mdW5jdGlvbiBkZWVwRXF1YWwoYSwgYikge1xuICAgIGlmIChhID09PSBiKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBjb25zdCBhS2V5cyA9IE9iamVjdC5rZXlzKGEpO1xuICAgIGNvbnN0IGJLZXlzID0gT2JqZWN0LmtleXMoYik7XG4gICAgZm9yIChjb25zdCBrIG9mIGFLZXlzKSB7XG4gICAgICAgIGlmICghYktleXMuaW5jbHVkZXMoaykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBhUHJvcCA9IGFba107XG4gICAgICAgIGNvbnN0IGJQcm9wID0gYltrXTtcbiAgICAgICAgaWYgKGlzT2JqZWN0KGFQcm9wKSAmJiBpc09iamVjdChiUHJvcCkpIHtcbiAgICAgICAgICAgIGlmICghZGVlcEVxdWFsKGFQcm9wLCBiUHJvcCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYVByb3AgIT09IGJQcm9wKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBrIG9mIGJLZXlzKSB7XG4gICAgICAgIGlmICghYUtleXMuaW5jbHVkZXMoaykpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIGlzT2JqZWN0KHRoaW5nKSB7XG4gICAgcmV0dXJuIHRoaW5nICE9PSBudWxsICYmIHR5cGVvZiB0aGluZyA9PT0gJ29iamVjdCc7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlamVjdHMgaWYgdGhlIGdpdmVuIHByb21pc2UgZG9lc24ndCByZXNvbHZlIGluIHRpbWVJbk1TIG1pbGxpc2Vjb25kcy5cbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBwcm9taXNlV2l0aFRpbWVvdXQocHJvbWlzZSwgdGltZUluTVMgPSAyMDAwKSB7XG4gICAgY29uc3QgZGVmZXJyZWRQcm9taXNlID0gbmV3IERlZmVycmVkKCk7XG4gICAgc2V0VGltZW91dCgoKSA9PiBkZWZlcnJlZFByb21pc2UucmVqZWN0KCd0aW1lb3V0IScpLCB0aW1lSW5NUyk7XG4gICAgcHJvbWlzZS50aGVuKGRlZmVycmVkUHJvbWlzZS5yZXNvbHZlLCBkZWZlcnJlZFByb21pc2UucmVqZWN0KTtcbiAgICByZXR1cm4gZGVmZXJyZWRQcm9taXNlLnByb21pc2U7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYSBxdWVyeXN0cmluZy1mb3JtYXR0ZWQgc3RyaW5nIChlLmcuICZhcmc9dmFsJmFyZzI9dmFsMikgZnJvbSBhXG4gKiBwYXJhbXMgb2JqZWN0IChlLmcuIHthcmc6ICd2YWwnLCBhcmcyOiAndmFsMid9KVxuICogTm90ZTogWW91IG11c3QgcHJlcGVuZCBpdCB3aXRoID8gd2hlbiBhZGRpbmcgaXQgdG8gYSBVUkwuXG4gKi9cbmZ1bmN0aW9uIHF1ZXJ5c3RyaW5nKHF1ZXJ5c3RyaW5nUGFyYW1zKSB7XG4gICAgY29uc3QgcGFyYW1zID0gW107XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocXVlcnlzdHJpbmdQYXJhbXMpKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgICAgICAgICAgdmFsdWUuZm9yRWFjaChhcnJheVZhbCA9PiB7XG4gICAgICAgICAgICAgICAgcGFyYW1zLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQoYXJyYXlWYWwpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcGFyYW1zLnB1c2goZW5jb2RlVVJJQ29tcG9uZW50KGtleSkgKyAnPScgKyBlbmNvZGVVUklDb21wb25lbnQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGFyYW1zLmxlbmd0aCA/ICcmJyArIHBhcmFtcy5qb2luKCcmJykgOiAnJztcbn1cbi8qKlxuICogRGVjb2RlcyBhIHF1ZXJ5c3RyaW5nIChlLmcuID9hcmc9dmFsJmFyZzI9dmFsMikgaW50byBhIHBhcmFtcyBvYmplY3RcbiAqIChlLmcuIHthcmc6ICd2YWwnLCBhcmcyOiAndmFsMid9KVxuICovXG5mdW5jdGlvbiBxdWVyeXN0cmluZ0RlY29kZShxdWVyeXN0cmluZykge1xuICAgIGNvbnN0IG9iaiA9IHt9O1xuICAgIGNvbnN0IHRva2VucyA9IHF1ZXJ5c3RyaW5nLnJlcGxhY2UoL15cXD8vLCAnJykuc3BsaXQoJyYnKTtcbiAgICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XG4gICAgICAgIGlmICh0b2tlbikge1xuICAgICAgICAgICAgY29uc3QgW2tleSwgdmFsdWVdID0gdG9rZW4uc3BsaXQoJz0nKTtcbiAgICAgICAgICAgIG9ialtkZWNvZGVVUklDb21wb25lbnQoa2V5KV0gPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIG9iajtcbn1cbi8qKlxuICogRXh0cmFjdCB0aGUgcXVlcnkgc3RyaW5nIHBhcnQgb2YgYSBVUkwsIGluY2x1ZGluZyB0aGUgbGVhZGluZyBxdWVzdGlvbiBtYXJrIChpZiBwcmVzZW50KS5cbiAqL1xuZnVuY3Rpb24gZXh0cmFjdFF1ZXJ5c3RyaW5nKHVybCkge1xuICAgIGNvbnN0IHF1ZXJ5U3RhcnQgPSB1cmwuaW5kZXhPZignPycpO1xuICAgIGlmICghcXVlcnlTdGFydCkge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxuICAgIGNvbnN0IGZyYWdtZW50U3RhcnQgPSB1cmwuaW5kZXhPZignIycsIHF1ZXJ5U3RhcnQpO1xuICAgIHJldHVybiB1cmwuc3Vic3RyaW5nKHF1ZXJ5U3RhcnQsIGZyYWdtZW50U3RhcnQgPiAwID8gZnJhZ21lbnRTdGFydCA6IHVuZGVmaW5lZCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBmaWxlb3ZlcnZpZXcgU0hBLTEgY3J5cHRvZ3JhcGhpYyBoYXNoLlxuICogVmFyaWFibGUgbmFtZXMgZm9sbG93IHRoZSBub3RhdGlvbiBpbiBGSVBTIFBVQiAxODAtMzpcbiAqIGh0dHA6Ly9jc3JjLm5pc3QuZ292L3B1YmxpY2F0aW9ucy9maXBzL2ZpcHMxODAtMy9maXBzMTgwLTNfZmluYWwucGRmLlxuICpcbiAqIFVzYWdlOlxuICogICB2YXIgc2hhMSA9IG5ldyBzaGExKCk7XG4gKiAgIHNoYTEudXBkYXRlKGJ5dGVzKTtcbiAqICAgdmFyIGhhc2ggPSBzaGExLmRpZ2VzdCgpO1xuICpcbiAqIFBlcmZvcm1hbmNlOlxuICogICBDaHJvbWUgMjM6ICAgfjQwMCBNYml0L3NcbiAqICAgRmlyZWZveCAxNjogIH4yNTAgTWJpdC9zXG4gKlxuICovXG4vKipcbiAqIFNIQS0xIGNyeXB0b2dyYXBoaWMgaGFzaCBjb25zdHJ1Y3Rvci5cbiAqXG4gKiBUaGUgcHJvcGVydGllcyBkZWNsYXJlZCBoZXJlIGFyZSBkaXNjdXNzZWQgaW4gdGhlIGFib3ZlIGFsZ29yaXRobSBkb2N1bWVudC5cbiAqIEBjb25zdHJ1Y3RvclxuICogQGZpbmFsXG4gKiBAc3RydWN0XG4gKi9cbmNsYXNzIFNoYTEge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvKipcbiAgICAgICAgICogSG9sZHMgdGhlIHByZXZpb3VzIHZhbHVlcyBvZiBhY2N1bXVsYXRlZCB2YXJpYWJsZXMgYS1lIGluIHRoZSBjb21wcmVzc19cbiAgICAgICAgICogZnVuY3Rpb24uXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoYWluXyA9IFtdO1xuICAgICAgICAvKipcbiAgICAgICAgICogQSBidWZmZXIgaG9sZGluZyB0aGUgcGFydGlhbGx5IGNvbXB1dGVkIGhhc2ggcmVzdWx0LlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5idWZfID0gW107XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBbiBhcnJheSBvZiA4MCBieXRlcywgZWFjaCBhIHBhcnQgb2YgdGhlIG1lc3NhZ2UgdG8gYmUgaGFzaGVkLiAgUmVmZXJyZWQgdG9cbiAgICAgICAgICogYXMgdGhlIG1lc3NhZ2Ugc2NoZWR1bGUgaW4gdGhlIGRvY3MuXG4gICAgICAgICAqIEBwcml2YXRlXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLldfID0gW107XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb250YWlucyBkYXRhIG5lZWRlZCB0byBwYWQgbWVzc2FnZXMgbGVzcyB0aGFuIDY0IGJ5dGVzLlxuICAgICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wYWRfID0gW107XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAcHJpdmF0ZSB7bnVtYmVyfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwO1xuICAgICAgICAvKipcbiAgICAgICAgICogQHByaXZhdGUge251bWJlcn1cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudG90YWxfID0gMDtcbiAgICAgICAgdGhpcy5ibG9ja1NpemUgPSA1MTIgLyA4O1xuICAgICAgICB0aGlzLnBhZF9bMF0gPSAxMjg7XG4gICAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgdGhpcy5ibG9ja1NpemU7ICsraSkge1xuICAgICAgICAgICAgdGhpcy5wYWRfW2ldID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLmNoYWluX1swXSA9IDB4Njc0NTIzMDE7XG4gICAgICAgIHRoaXMuY2hhaW5fWzFdID0gMHhlZmNkYWI4OTtcbiAgICAgICAgdGhpcy5jaGFpbl9bMl0gPSAweDk4YmFkY2ZlO1xuICAgICAgICB0aGlzLmNoYWluX1szXSA9IDB4MTAzMjU0NzY7XG4gICAgICAgIHRoaXMuY2hhaW5fWzRdID0gMHhjM2QyZTFmMDtcbiAgICAgICAgdGhpcy5pbmJ1Zl8gPSAwO1xuICAgICAgICB0aGlzLnRvdGFsXyA9IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEludGVybmFsIGNvbXByZXNzIGhlbHBlciBmdW5jdGlvbi5cbiAgICAgKiBAcGFyYW0gYnVmIEJsb2NrIHRvIGNvbXByZXNzLlxuICAgICAqIEBwYXJhbSBvZmZzZXQgT2Zmc2V0IG9mIHRoZSBibG9jayBpbiB0aGUgYnVmZmVyLlxuICAgICAqIEBwcml2YXRlXG4gICAgICovXG4gICAgY29tcHJlc3NfKGJ1Ziwgb2Zmc2V0KSB7XG4gICAgICAgIGlmICghb2Zmc2V0KSB7XG4gICAgICAgICAgICBvZmZzZXQgPSAwO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IFcgPSB0aGlzLldfO1xuICAgICAgICAvLyBnZXQgMTYgYmlnIGVuZGlhbiB3b3Jkc1xuICAgICAgICBpZiAodHlwZW9mIGJ1ZiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8odXNlcik6IFtidWcgODE0MDEyMl0gUmVjZW50IHZlcnNpb25zIG9mIFNhZmFyaSBmb3IgTWFjIE9TIGFuZCBpT1NcbiAgICAgICAgICAgICAgICAvLyBoYXZlIGEgYnVnIHRoYXQgdHVybnMgdGhlIHBvc3QtaW5jcmVtZW50ICsrIG9wZXJhdG9yIGludG8gcHJlLWluY3JlbWVudFxuICAgICAgICAgICAgICAgIC8vIGR1cmluZyBKSVQgY29tcGlsYXRpb24uICBXZSBoYXZlIGNvZGUgdGhhdCBkZXBlbmRzIGhlYXZpbHkgb24gU0hBLTEgZm9yXG4gICAgICAgICAgICAgICAgLy8gY29ycmVjdG5lc3MgYW5kIHdoaWNoIGlzIGFmZmVjdGVkIGJ5IHRoaXMgYnVnLCBzbyBJJ3ZlIHJlbW92ZWQgYWxsIHVzZXNcbiAgICAgICAgICAgICAgICAvLyBvZiBwb3N0LWluY3JlbWVudCArKyBpbiB3aGljaCB0aGUgcmVzdWx0IHZhbHVlIGlzIHVzZWQuICBXZSBjYW4gcmV2ZXJ0XG4gICAgICAgICAgICAgICAgLy8gdGhpcyBjaGFuZ2Ugb25jZSB0aGUgU2FmYXJpIGJ1Z1xuICAgICAgICAgICAgICAgIC8vIChodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MTA5MDM2KSBoYXMgYmVlbiBmaXhlZCBhbmRcbiAgICAgICAgICAgICAgICAvLyBtb3N0IGNsaWVudHMgaGF2ZSBiZWVuIHVwZGF0ZWQuXG4gICAgICAgICAgICAgICAgV1tpXSA9XG4gICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQpIDw8IDI0KSB8XG4gICAgICAgICAgICAgICAgICAgICAgICAoYnVmLmNoYXJDb2RlQXQob2Zmc2V0ICsgMSkgPDwgMTYpIHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChidWYuY2hhckNvZGVBdChvZmZzZXQgKyAyKSA8PCA4KSB8XG4gICAgICAgICAgICAgICAgICAgICAgICBidWYuY2hhckNvZGVBdChvZmZzZXQgKyAzKTtcbiAgICAgICAgICAgICAgICBvZmZzZXQgKz0gNDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMTY7IGkrKykge1xuICAgICAgICAgICAgICAgIFdbaV0gPVxuICAgICAgICAgICAgICAgICAgICAoYnVmW29mZnNldF0gPDwgMjQpIHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMV0gPDwgMTYpIHxcbiAgICAgICAgICAgICAgICAgICAgICAgIChidWZbb2Zmc2V0ICsgMl0gPDwgOCkgfFxuICAgICAgICAgICAgICAgICAgICAgICAgYnVmW29mZnNldCArIDNdO1xuICAgICAgICAgICAgICAgIG9mZnNldCArPSA0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIGV4cGFuZCB0byA4MCB3b3Jkc1xuICAgICAgICBmb3IgKGxldCBpID0gMTY7IGkgPCA4MDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gV1tpIC0gM10gXiBXW2kgLSA4XSBeIFdbaSAtIDE0XSBeIFdbaSAtIDE2XTtcbiAgICAgICAgICAgIFdbaV0gPSAoKHQgPDwgMSkgfCAodCA+Pj4gMzEpKSAmIDB4ZmZmZmZmZmY7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGEgPSB0aGlzLmNoYWluX1swXTtcbiAgICAgICAgbGV0IGIgPSB0aGlzLmNoYWluX1sxXTtcbiAgICAgICAgbGV0IGMgPSB0aGlzLmNoYWluX1syXTtcbiAgICAgICAgbGV0IGQgPSB0aGlzLmNoYWluX1szXTtcbiAgICAgICAgbGV0IGUgPSB0aGlzLmNoYWluX1s0XTtcbiAgICAgICAgbGV0IGYsIGs7XG4gICAgICAgIC8vIFRPRE8odXNlcik6IFRyeSB0byB1bnJvbGwgdGhpcyBsb29wIHRvIHNwZWVkIHVwIHRoZSBjb21wdXRhdGlvbi5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA4MDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoaSA8IDQwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgPCAyMCkge1xuICAgICAgICAgICAgICAgICAgICBmID0gZCBeIChiICYgKGMgXiBkKSk7XG4gICAgICAgICAgICAgICAgICAgIGsgPSAweDVhODI3OTk5O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDtcbiAgICAgICAgICAgICAgICAgICAgayA9IDB4NmVkOWViYTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKGkgPCA2MCkge1xuICAgICAgICAgICAgICAgICAgICBmID0gKGIgJiBjKSB8IChkICYgKGIgfCBjKSk7XG4gICAgICAgICAgICAgICAgICAgIGsgPSAweDhmMWJiY2RjO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZiA9IGIgXiBjIF4gZDtcbiAgICAgICAgICAgICAgICAgICAgayA9IDB4Y2E2MmMxZDY7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdCA9ICgoKGEgPDwgNSkgfCAoYSA+Pj4gMjcpKSArIGYgKyBlICsgayArIFdbaV0pICYgMHhmZmZmZmZmZjtcbiAgICAgICAgICAgIGUgPSBkO1xuICAgICAgICAgICAgZCA9IGM7XG4gICAgICAgICAgICBjID0gKChiIDw8IDMwKSB8IChiID4+PiAyKSkgJiAweGZmZmZmZmZmO1xuICAgICAgICAgICAgYiA9IGE7XG4gICAgICAgICAgICBhID0gdDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNoYWluX1swXSA9ICh0aGlzLmNoYWluX1swXSArIGEpICYgMHhmZmZmZmZmZjtcbiAgICAgICAgdGhpcy5jaGFpbl9bMV0gPSAodGhpcy5jaGFpbl9bMV0gKyBiKSAmIDB4ZmZmZmZmZmY7XG4gICAgICAgIHRoaXMuY2hhaW5fWzJdID0gKHRoaXMuY2hhaW5fWzJdICsgYykgJiAweGZmZmZmZmZmO1xuICAgICAgICB0aGlzLmNoYWluX1szXSA9ICh0aGlzLmNoYWluX1szXSArIGQpICYgMHhmZmZmZmZmZjtcbiAgICAgICAgdGhpcy5jaGFpbl9bNF0gPSAodGhpcy5jaGFpbl9bNF0gKyBlKSAmIDB4ZmZmZmZmZmY7XG4gICAgfVxuICAgIHVwZGF0ZShieXRlcywgbGVuZ3RoKSB7XG4gICAgICAgIC8vIFRPRE8oam9obmxlbnopOiB0aWdodGVuIHRoZSBmdW5jdGlvbiBzaWduYXR1cmUgYW5kIHJlbW92ZSB0aGlzIGNoZWNrXG4gICAgICAgIGlmIChieXRlcyA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxlbmd0aCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBsZW5ndGggPSBieXRlcy5sZW5ndGg7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgbGVuZ3RoTWludXNCbG9jayA9IGxlbmd0aCAtIHRoaXMuYmxvY2tTaXplO1xuICAgICAgICBsZXQgbiA9IDA7XG4gICAgICAgIC8vIFVzaW5nIGxvY2FsIGluc3RlYWQgb2YgbWVtYmVyIHZhcmlhYmxlcyBnaXZlcyB+NSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LlxuICAgICAgICBjb25zdCBidWYgPSB0aGlzLmJ1Zl87XG4gICAgICAgIGxldCBpbmJ1ZiA9IHRoaXMuaW5idWZfO1xuICAgICAgICAvLyBUaGUgb3V0ZXIgd2hpbGUgbG9vcCBzaG91bGQgZXhlY3V0ZSBhdCBtb3N0IHR3aWNlLlxuICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgLy8gV2hlbiB3ZSBoYXZlIG5vIGRhdGEgaW4gdGhlIGJsb2NrIHRvIHRvcCB1cCwgd2UgY2FuIGRpcmVjdGx5IHByb2Nlc3MgdGhlXG4gICAgICAgICAgICAvLyBpbnB1dCBidWZmZXIgKGFzc3VtaW5nIGl0IGNvbnRhaW5zIHN1ZmZpY2llbnQgZGF0YSkuIFRoaXMgZ2l2ZXMgfjI1JVxuICAgICAgICAgICAgLy8gc3BlZWR1cCBvbiBDaHJvbWUgMjMgYW5kIH4xNSUgc3BlZWR1cCBvbiBGaXJlZm94IDE2LCBidXQgcmVxdWlyZXMgdGhhdFxuICAgICAgICAgICAgLy8gdGhlIGRhdGEgaXMgcHJvdmlkZWQgaW4gbGFyZ2UgY2h1bmtzIChvciBpbiBtdWx0aXBsZXMgb2YgNjQgYnl0ZXMpLlxuICAgICAgICAgICAgaWYgKGluYnVmID09PSAwKSB7XG4gICAgICAgICAgICAgICAgd2hpbGUgKG4gPD0gbGVuZ3RoTWludXNCbG9jaykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhieXRlcywgbik7XG4gICAgICAgICAgICAgICAgICAgIG4gKz0gdGhpcy5ibG9ja1NpemU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBieXRlcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXMuY2hhckNvZGVBdChuKTtcbiAgICAgICAgICAgICAgICAgICAgKytpbmJ1ZjtcbiAgICAgICAgICAgICAgICAgICAgKytuO1xuICAgICAgICAgICAgICAgICAgICBpZiAoaW5idWYgPT09IHRoaXMuYmxvY2tTaXplKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNvbXByZXNzXyhidWYpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5idWYgPSAwO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgb3V0ZXIgbG9vcCBzbyB3ZSB1c2UgdGhlIGZ1bGwtYmxvY2sgb3B0aW1pemF0aW9uLlxuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB3aGlsZSAobiA8IGxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBidWZbaW5idWZdID0gYnl0ZXNbbl07XG4gICAgICAgICAgICAgICAgICAgICsraW5idWY7XG4gICAgICAgICAgICAgICAgICAgICsrbjtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluYnVmID09PSB0aGlzLmJsb2NrU2l6ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb21wcmVzc18oYnVmKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluYnVmID0gMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEp1bXAgdG8gdGhlIG91dGVyIGxvb3Agc28gd2UgdXNlIHRoZSBmdWxsLWJsb2NrIG9wdGltaXphdGlvbi5cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW5idWZfID0gaW5idWY7XG4gICAgICAgIHRoaXMudG90YWxfICs9IGxlbmd0aDtcbiAgICB9XG4gICAgLyoqIEBvdmVycmlkZSAqL1xuICAgIGRpZ2VzdCgpIHtcbiAgICAgICAgY29uc3QgZGlnZXN0ID0gW107XG4gICAgICAgIGxldCB0b3RhbEJpdHMgPSB0aGlzLnRvdGFsXyAqIDg7XG4gICAgICAgIC8vIEFkZCBwYWQgMHg4MCAweDAwKi5cbiAgICAgICAgaWYgKHRoaXMuaW5idWZfIDwgNTYpIHtcbiAgICAgICAgICAgIHRoaXMudXBkYXRlKHRoaXMucGFkXywgNTYgLSB0aGlzLmluYnVmXyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnVwZGF0ZSh0aGlzLnBhZF8sIHRoaXMuYmxvY2tTaXplIC0gKHRoaXMuaW5idWZfIC0gNTYpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBZGQgIyBiaXRzLlxuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5ibG9ja1NpemUgLSAxOyBpID49IDU2OyBpLS0pIHtcbiAgICAgICAgICAgIHRoaXMuYnVmX1tpXSA9IHRvdGFsQml0cyAmIDI1NTtcbiAgICAgICAgICAgIHRvdGFsQml0cyAvPSAyNTY7IC8vIERvbid0IHVzZSBiaXQtc2hpZnRpbmcgaGVyZSFcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbXByZXNzXyh0aGlzLmJ1Zl8pO1xuICAgICAgICBsZXQgbiA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgNTsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBqID0gMjQ7IGogPj0gMDsgaiAtPSA4KSB7XG4gICAgICAgICAgICAgICAgZGlnZXN0W25dID0gKHRoaXMuY2hhaW5fW2ldID4+IGopICYgMjU1O1xuICAgICAgICAgICAgICAgICsrbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGlnZXN0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gbWFrZSBhIFN1YnNjcmliZSBmdW5jdGlvbiAoanVzdCBsaWtlIFByb21pc2UgaGVscHMgbWFrZSBhXG4gKiBUaGVuYWJsZSkuXG4gKlxuICogQHBhcmFtIGV4ZWN1dG9yIEZ1bmN0aW9uIHdoaWNoIGNhbiBtYWtlIGNhbGxzIHRvIGEgc2luZ2xlIE9ic2VydmVyXG4gKiAgICAgYXMgYSBwcm94eS5cbiAqIEBwYXJhbSBvbk5vT2JzZXJ2ZXJzIENhbGxiYWNrIHdoZW4gY291bnQgb2YgT2JzZXJ2ZXJzIGdvZXMgdG8gemVyby5cbiAqL1xuZnVuY3Rpb24gY3JlYXRlU3Vic2NyaWJlKGV4ZWN1dG9yLCBvbk5vT2JzZXJ2ZXJzKSB7XG4gICAgY29uc3QgcHJveHkgPSBuZXcgT2JzZXJ2ZXJQcm94eShleGVjdXRvciwgb25Ob09ic2VydmVycyk7XG4gICAgcmV0dXJuIHByb3h5LnN1YnNjcmliZS5iaW5kKHByb3h5KTtcbn1cbi8qKlxuICogSW1wbGVtZW50IGZhbi1vdXQgZm9yIGFueSBudW1iZXIgb2YgT2JzZXJ2ZXJzIGF0dGFjaGVkIHZpYSBhIHN1YnNjcmliZVxuICogZnVuY3Rpb24uXG4gKi9cbmNsYXNzIE9ic2VydmVyUHJveHkge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBleGVjdXRvciBGdW5jdGlvbiB3aGljaCBjYW4gbWFrZSBjYWxscyB0byBhIHNpbmdsZSBPYnNlcnZlclxuICAgICAqICAgICBhcyBhIHByb3h5LlxuICAgICAqIEBwYXJhbSBvbk5vT2JzZXJ2ZXJzIENhbGxiYWNrIHdoZW4gY291bnQgb2YgT2JzZXJ2ZXJzIGdvZXMgdG8gemVyby5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihleGVjdXRvciwgb25Ob09ic2VydmVycykge1xuICAgICAgICB0aGlzLm9ic2VydmVycyA9IFtdO1xuICAgICAgICB0aGlzLnVuc3Vic2NyaWJlcyA9IFtdO1xuICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgPSAwO1xuICAgICAgICAvLyBNaWNyby10YXNrIHNjaGVkdWxpbmcgYnkgY2FsbGluZyB0YXNrLnRoZW4oKS5cbiAgICAgICAgdGhpcy50YXNrID0gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIHRoaXMuZmluYWxpemVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25Ob09ic2VydmVycyA9IG9uTm9PYnNlcnZlcnM7XG4gICAgICAgIC8vIENhbGwgdGhlIGV4ZWN1dG9yIGFzeW5jaHJvbm91c2x5IHNvIHN1YnNjcmliZXJzIHRoYXQgYXJlIGNhbGxlZFxuICAgICAgICAvLyBzeW5jaHJvbm91c2x5IGFmdGVyIHRoZSBjcmVhdGlvbiBvZiB0aGUgc3Vic2NyaWJlIGZ1bmN0aW9uXG4gICAgICAgIC8vIGNhbiBzdGlsbCByZWNlaXZlIHRoZSB2ZXJ5IGZpcnN0IHZhbHVlIGdlbmVyYXRlZCBpbiB0aGUgZXhlY3V0b3IuXG4gICAgICAgIHRoaXMudGFza1xuICAgICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgZXhlY3V0b3IodGhpcyk7XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVycm9yKGUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgbmV4dCh2YWx1ZSkge1xuICAgICAgICB0aGlzLmZvckVhY2hPYnNlcnZlcigob2JzZXJ2ZXIpID0+IHtcbiAgICAgICAgICAgIG9ic2VydmVyLm5leHQodmFsdWUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZXJyb3IoZXJyb3IpIHtcbiAgICAgICAgdGhpcy5mb3JFYWNoT2JzZXJ2ZXIoKG9ic2VydmVyKSA9PiB7XG4gICAgICAgICAgICBvYnNlcnZlci5lcnJvcihlcnJvcik7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNsb3NlKGVycm9yKTtcbiAgICB9XG4gICAgY29tcGxldGUoKSB7XG4gICAgICAgIHRoaXMuZm9yRWFjaE9ic2VydmVyKChvYnNlcnZlcikgPT4ge1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3Vic2NyaWJlIGZ1bmN0aW9uIHRoYXQgY2FuIGJlIHVzZWQgdG8gYWRkIGFuIE9ic2VydmVyIHRvIHRoZSBmYW4tb3V0IGxpc3QuXG4gICAgICpcbiAgICAgKiAtIFdlIHJlcXVpcmUgdGhhdCBubyBldmVudCBpcyBzZW50IHRvIGEgc3Vic2NyaWJlciBzeW5jaHJvbm91c2x5IHRvIHRoZWlyXG4gICAgICogICBjYWxsIHRvIHN1YnNjcmliZSgpLlxuICAgICAqL1xuICAgIHN1YnNjcmliZShuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlKSB7XG4gICAgICAgIGxldCBvYnNlcnZlcjtcbiAgICAgICAgaWYgKG5leHRPck9ic2VydmVyID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgIGVycm9yID09PSB1bmRlZmluZWQgJiZcbiAgICAgICAgICAgIGNvbXBsZXRlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTWlzc2luZyBPYnNlcnZlci4nKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBBc3NlbWJsZSBhbiBPYnNlcnZlciBvYmplY3Qgd2hlbiBwYXNzZWQgYXMgY2FsbGJhY2sgZnVuY3Rpb25zLlxuICAgICAgICBpZiAoaW1wbGVtZW50c0FueU1ldGhvZHMobmV4dE9yT2JzZXJ2ZXIsIFtcbiAgICAgICAgICAgICduZXh0JyxcbiAgICAgICAgICAgICdlcnJvcicsXG4gICAgICAgICAgICAnY29tcGxldGUnXG4gICAgICAgIF0pKSB7XG4gICAgICAgICAgICBvYnNlcnZlciA9IG5leHRPck9ic2VydmVyO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgb2JzZXJ2ZXIgPSB7XG4gICAgICAgICAgICAgICAgbmV4dDogbmV4dE9yT2JzZXJ2ZXIsXG4gICAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICAgICAgY29tcGxldGVcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9ic2VydmVyLm5leHQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIubmV4dCA9IG5vb3A7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9ic2VydmVyLmVycm9yID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIG9ic2VydmVyLmVycm9yID0gbm9vcDtcbiAgICAgICAgfVxuICAgICAgICBpZiAob2JzZXJ2ZXIuY29tcGxldGUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgb2JzZXJ2ZXIuY29tcGxldGUgPSBub29wO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHVuc3ViID0gdGhpcy51bnN1YnNjcmliZU9uZS5iaW5kKHRoaXMsIHRoaXMub2JzZXJ2ZXJzLmxlbmd0aCk7XG4gICAgICAgIC8vIEF0dGVtcHQgdG8gc3Vic2NyaWJlIHRvIGEgdGVybWluYXRlZCBPYnNlcnZhYmxlIC0gd2VcbiAgICAgICAgLy8ganVzdCByZXNwb25kIHRvIHRoZSBPYnNlcnZlciB3aXRoIHRoZSBmaW5hbCBlcnJvciBvciBjb21wbGV0ZVxuICAgICAgICAvLyBldmVudC5cbiAgICAgICAgaWYgKHRoaXMuZmluYWxpemVkKSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgICAgICB0aGlzLnRhc2sudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuZmluYWxFcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgb2JzZXJ2ZXIuZXJyb3IodGhpcy5maW5hbEVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9ic2VydmVyLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm90aGluZ1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm9ic2VydmVycy5wdXNoKG9ic2VydmVyKTtcbiAgICAgICAgcmV0dXJuIHVuc3ViO1xuICAgIH1cbiAgICAvLyBVbnN1YnNjcmliZSBpcyBzeW5jaHJvbm91cyAtIHdlIGd1YXJhbnRlZSB0aGF0IG5vIGV2ZW50cyBhcmUgc2VudCB0b1xuICAgIC8vIGFueSB1bnN1YnNjcmliZWQgT2JzZXJ2ZXIuXG4gICAgdW5zdWJzY3JpYmVPbmUoaSkge1xuICAgICAgICBpZiAodGhpcy5vYnNlcnZlcnMgPT09IHVuZGVmaW5lZCB8fCB0aGlzLm9ic2VydmVyc1tpXSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVsZXRlIHRoaXMub2JzZXJ2ZXJzW2ldO1xuICAgICAgICB0aGlzLm9ic2VydmVyQ291bnQgLT0gMTtcbiAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJDb3VudCA9PT0gMCAmJiB0aGlzLm9uTm9PYnNlcnZlcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzKHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZvckVhY2hPYnNlcnZlcihmbikge1xuICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcbiAgICAgICAgICAgIC8vIEFscmVhZHkgY2xvc2VkIGJ5IHByZXZpb3VzIGV2ZW50Li4uLmp1c3QgZWF0IHRoZSBhZGRpdGlvbmFsIHZhbHVlcy5cbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBTaW5jZSBzZW5kT25lIGNhbGxzIGFzeW5jaHJvbm91c2x5IC0gdGhlcmUgaXMgbm8gY2hhbmNlIHRoYXRcbiAgICAgICAgLy8gdGhpcy5vYnNlcnZlcnMgd2lsbCBiZWNvbWUgdW5kZWZpbmVkLlxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JzZXJ2ZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRPbmUoaSwgZm4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIENhbGwgdGhlIE9ic2VydmVyIHZpYSBvbmUgb2YgaXQncyBjYWxsYmFjayBmdW5jdGlvbi4gV2UgYXJlIGNhcmVmdWwgdG9cbiAgICAvLyBjb25maXJtIHRoYXQgdGhlIG9ic2VydmUgaGFzIG5vdCBiZWVuIHVuc3Vic2NyaWJlZCBzaW5jZSB0aGlzIGFzeW5jaHJvbm91c1xuICAgIC8vIGZ1bmN0aW9uIGhhZCBiZWVuIHF1ZXVlZC5cbiAgICBzZW5kT25lKGksIGZuKSB7XG4gICAgICAgIC8vIEV4ZWN1dGUgdGhlIGNhbGxiYWNrIGFzeW5jaHJvbm91c2x5XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhpcy50YXNrLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXJzICE9PSB1bmRlZmluZWQgJiYgdGhpcy5vYnNlcnZlcnNbaV0gIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGZuKHRoaXMub2JzZXJ2ZXJzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWdub3JlIGV4Y2VwdGlvbnMgcmFpc2VkIGluIE9ic2VydmVycyBvciBtaXNzaW5nIG1ldGhvZHMgb2YgYW5cbiAgICAgICAgICAgICAgICAgICAgLy8gT2JzZXJ2ZXIuXG4gICAgICAgICAgICAgICAgICAgIC8vIExvZyBlcnJvciB0byBjb25zb2xlLiBiLzMxNDA0ODA2XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29uc29sZSAhPT0gJ3VuZGVmaW5lZCcgJiYgY29uc29sZS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNsb3NlKGVycikge1xuICAgICAgICBpZiAodGhpcy5maW5hbGl6ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmZpbmFsaXplZCA9IHRydWU7XG4gICAgICAgIGlmIChlcnIgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgdGhpcy5maW5hbEVycm9yID0gZXJyO1xuICAgICAgICB9XG4gICAgICAgIC8vIFByb3h5IGlzIG5vIGxvbmdlciBuZWVkZWQgLSBnYXJiYWdlIGNvbGxlY3QgcmVmZXJlbmNlc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIHRoaXMudGFzay50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMub2JzZXJ2ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgdGhpcy5vbk5vT2JzZXJ2ZXJzID0gdW5kZWZpbmVkO1xuICAgICAgICB9KTtcbiAgICB9XG59XG4vKiogVHVybiBzeW5jaHJvbm91cyBmdW5jdGlvbiBpbnRvIG9uZSBjYWxsZWQgYXN5bmNocm9ub3VzbHkuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L2Jhbi10eXBlc1xuZnVuY3Rpb24gYXN5bmMoZm4sIG9uRXJyb3IpIHtcbiAgICByZXR1cm4gKC4uLmFyZ3MpID0+IHtcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKHRydWUpXG4gICAgICAgICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBmbiguLi5hcmdzKTtcbiAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgIGlmIChvbkVycm9yKSB7XG4gICAgICAgICAgICAgICAgb25FcnJvcihlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59XG4vKipcbiAqIFJldHVybiB0cnVlIGlmIHRoZSBvYmplY3QgcGFzc2VkIGluIGltcGxlbWVudHMgYW55IG9mIHRoZSBuYW1lZCBtZXRob2RzLlxuICovXG5mdW5jdGlvbiBpbXBsZW1lbnRzQW55TWV0aG9kcyhvYmosIG1ldGhvZHMpIHtcbiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZm9yIChjb25zdCBtZXRob2Qgb2YgbWV0aG9kcykge1xuICAgICAgICBpZiAobWV0aG9kIGluIG9iaiAmJiB0eXBlb2Ygb2JqW21ldGhvZF0gPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn1cbmZ1bmN0aW9uIG5vb3AoKSB7XG4gICAgLy8gZG8gbm90aGluZ1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDaGVjayB0byBtYWtlIHN1cmUgdGhlIGFwcHJvcHJpYXRlIG51bWJlciBvZiBhcmd1bWVudHMgYXJlIHByb3ZpZGVkIGZvciBhIHB1YmxpYyBmdW5jdGlvbi5cbiAqIFRocm93cyBhbiBlcnJvciBpZiBpdCBmYWlscy5cbiAqXG4gKiBAcGFyYW0gZm5OYW1lIFRoZSBmdW5jdGlvbiBuYW1lXG4gKiBAcGFyYW0gbWluQ291bnQgVGhlIG1pbmltdW0gbnVtYmVyIG9mIGFyZ3VtZW50cyB0byBhbGxvdyBmb3IgdGhlIGZ1bmN0aW9uIGNhbGxcbiAqIEBwYXJhbSBtYXhDb3VudCBUaGUgbWF4aW11bSBudW1iZXIgb2YgYXJndW1lbnQgdG8gYWxsb3cgZm9yIHRoZSBmdW5jdGlvbiBjYWxsXG4gKiBAcGFyYW0gYXJnQ291bnQgVGhlIGFjdHVhbCBudW1iZXIgb2YgYXJndW1lbnRzIHByb3ZpZGVkLlxuICovXG5jb25zdCB2YWxpZGF0ZUFyZ0NvdW50ID0gZnVuY3Rpb24gKGZuTmFtZSwgbWluQ291bnQsIG1heENvdW50LCBhcmdDb3VudCkge1xuICAgIGxldCBhcmdFcnJvcjtcbiAgICBpZiAoYXJnQ291bnQgPCBtaW5Db3VudCkge1xuICAgICAgICBhcmdFcnJvciA9ICdhdCBsZWFzdCAnICsgbWluQ291bnQ7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFyZ0NvdW50ID4gbWF4Q291bnQpIHtcbiAgICAgICAgYXJnRXJyb3IgPSBtYXhDb3VudCA9PT0gMCA/ICdub25lJyA6ICdubyBtb3JlIHRoYW4gJyArIG1heENvdW50O1xuICAgIH1cbiAgICBpZiAoYXJnRXJyb3IpIHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBmbk5hbWUgK1xuICAgICAgICAgICAgJyBmYWlsZWQ6IFdhcyBjYWxsZWQgd2l0aCAnICtcbiAgICAgICAgICAgIGFyZ0NvdW50ICtcbiAgICAgICAgICAgIChhcmdDb3VudCA9PT0gMSA/ICcgYXJndW1lbnQuJyA6ICcgYXJndW1lbnRzLicpICtcbiAgICAgICAgICAgICcgRXhwZWN0cyAnICtcbiAgICAgICAgICAgIGFyZ0Vycm9yICtcbiAgICAgICAgICAgICcuJztcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yKTtcbiAgICB9XG59O1xuLyoqXG4gKiBHZW5lcmF0ZXMgYSBzdHJpbmcgdG8gcHJlZml4IGFuIGVycm9yIG1lc3NhZ2UgYWJvdXQgZmFpbGVkIGFyZ3VtZW50IHZhbGlkYXRpb25cbiAqXG4gKiBAcGFyYW0gZm5OYW1lIFRoZSBmdW5jdGlvbiBuYW1lXG4gKiBAcGFyYW0gYXJnTmFtZSBUaGUgbmFtZSBvZiB0aGUgYXJndW1lbnRcbiAqIEByZXR1cm4gVGhlIHByZWZpeCB0byBhZGQgdG8gdGhlIGVycm9yIHRocm93biBmb3IgdmFsaWRhdGlvbi5cbiAqL1xuZnVuY3Rpb24gZXJyb3JQcmVmaXgoZm5OYW1lLCBhcmdOYW1lKSB7XG4gICAgcmV0dXJuIGAke2ZuTmFtZX0gZmFpbGVkOiAke2FyZ05hbWV9IGFyZ3VtZW50IGA7XG59XG4vKipcbiAqIEBwYXJhbSBmbk5hbWVcbiAqIEBwYXJhbSBhcmd1bWVudE51bWJlclxuICogQHBhcmFtIG5hbWVzcGFjZVxuICogQHBhcmFtIG9wdGlvbmFsXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlTmFtZXNwYWNlKGZuTmFtZSwgbmFtZXNwYWNlLCBvcHRpb25hbCkge1xuICAgIGlmIChvcHRpb25hbCAmJiAhbmFtZXNwYWNlKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBuYW1lc3BhY2UgIT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vVE9ETzogSSBzaG91bGQgZG8gbW9yZSB2YWxpZGF0aW9uIGhlcmUuIFdlIG9ubHkgYWxsb3cgY2VydGFpbiBjaGFycyBpbiBuYW1lc3BhY2VzLlxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCAnbmFtZXNwYWNlJykgKyAnbXVzdCBiZSBhIHZhbGlkIGZpcmViYXNlIG5hbWVzcGFjZS4nKTtcbiAgICB9XG59XG5mdW5jdGlvbiB2YWxpZGF0ZUNhbGxiYWNrKGZuTmFtZSwgYXJndW1lbnROYW1lLCBcbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvYmFuLXR5cGVzXG5jYWxsYmFjaywgb3B0aW9uYWwpIHtcbiAgICBpZiAob3B0aW9uYWwgJiYgIWNhbGxiYWNrKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjYWxsYmFjayAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCBhcmd1bWVudE5hbWUpICsgJ211c3QgYmUgYSB2YWxpZCBmdW5jdGlvbi4nKTtcbiAgICB9XG59XG5mdW5jdGlvbiB2YWxpZGF0ZUNvbnRleHRPYmplY3QoZm5OYW1lLCBhcmd1bWVudE5hbWUsIGNvbnRleHQsIG9wdGlvbmFsKSB7XG4gICAgaWYgKG9wdGlvbmFsICYmICFjb250ZXh0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjb250ZXh0ICE9PSAnb2JqZWN0JyB8fCBjb250ZXh0ID09PSBudWxsKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgKyAnbXVzdCBiZSBhIHZhbGlkIGNvbnRleHQgb2JqZWN0LicpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIENvZGUgb3JpZ2luYWxseSBjYW1lIGZyb20gZ29vZy5jcnlwdC5zdHJpbmdUb1V0ZjhCeXRlQXJyYXksIGJ1dCBmb3Igc29tZSByZWFzb24gdGhleVxuLy8gYXV0b21hdGljYWxseSByZXBsYWNlZCAnXFxyXFxuJyB3aXRoICdcXG4nLCBhbmQgdGhleSBkaWRuJ3QgaGFuZGxlIHN1cnJvZ2F0ZSBwYWlycyxcbi8vIHNvIGl0J3MgYmVlbiBtb2RpZmllZC5cbi8vIE5vdGUgdGhhdCBub3QgYWxsIFVuaWNvZGUgY2hhcmFjdGVycyBhcHBlYXIgYXMgc2luZ2xlIGNoYXJhY3RlcnMgaW4gSmF2YVNjcmlwdCBzdHJpbmdzLlxuLy8gZnJvbUNoYXJDb2RlIHJldHVybnMgdGhlIFVURi0xNiBlbmNvZGluZyBvZiBhIGNoYXJhY3RlciAtIHNvIHNvbWUgVW5pY29kZSBjaGFyYWN0ZXJzXG4vLyB1c2UgMiBjaGFyYWN0ZXJzIGluIEphdmFTY3JpcHQuICBBbGwgNC1ieXRlIFVURi04IGNoYXJhY3RlcnMgYmVnaW4gd2l0aCBhIGZpcnN0XG4vLyBjaGFyYWN0ZXIgaW4gdGhlIHJhbmdlIDB4RDgwMCAtIDB4REJGRiAodGhlIGZpcnN0IGNoYXJhY3RlciBvZiBhIHNvLWNhbGxlZCBzdXJyb2dhdGVcbi8vIHBhaXIpLlxuLy8gU2VlIGh0dHA6Ly93d3cuZWNtYS1pbnRlcm5hdGlvbmFsLm9yZy9lY21hLTI2Mi81LjEvI3NlYy0xNS4xLjNcbi8qKlxuICogQHBhcmFtIHtzdHJpbmd9IHN0clxuICogQHJldHVybiB7QXJyYXl9XG4gKi9cbmNvbnN0IHN0cmluZ1RvQnl0ZUFycmF5ID0gZnVuY3Rpb24gKHN0cikge1xuICAgIGNvbnN0IG91dCA9IFtdO1xuICAgIGxldCBwID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICBsZXQgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICAvLyBJcyB0aGlzIHRoZSBsZWFkIHN1cnJvZ2F0ZSBpbiBhIHN1cnJvZ2F0ZSBwYWlyP1xuICAgICAgICBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHtcbiAgICAgICAgICAgIGNvbnN0IGhpZ2ggPSBjIC0gMHhkODAwOyAvLyB0aGUgaGlnaCAxMCBiaXRzLlxuICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgYXNzZXJ0KGkgPCBzdHIubGVuZ3RoLCAnU3Vycm9nYXRlIHBhaXIgbWlzc2luZyB0cmFpbCBzdXJyb2dhdGUuJyk7XG4gICAgICAgICAgICBjb25zdCBsb3cgPSBzdHIuY2hhckNvZGVBdChpKSAtIDB4ZGMwMDsgLy8gdGhlIGxvdyAxMCBiaXRzLlxuICAgICAgICAgICAgYyA9IDB4MTAwMDAgKyAoaGlnaCA8PCAxMCkgKyBsb3c7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGMgPCAxMjgpIHtcbiAgICAgICAgICAgIG91dFtwKytdID0gYztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjIDwgMjA0OCkge1xuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyA+PiA2KSB8IDE5MjtcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgJiA2MykgfCAxMjg7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYyA8IDY1NTM2KSB7XG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjID4+IDEyKSB8IDIyNDtcbiAgICAgICAgICAgIG91dFtwKytdID0gKChjID4+IDYpICYgNjMpIHwgMTI4O1xuICAgICAgICAgICAgb3V0W3ArK10gPSAoYyAmIDYzKSB8IDEyODtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG91dFtwKytdID0gKGMgPj4gMTgpIHwgMjQwO1xuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gMTIpICYgNjMpIHwgMTI4O1xuICAgICAgICAgICAgb3V0W3ArK10gPSAoKGMgPj4gNikgJiA2MykgfCAxMjg7XG4gICAgICAgICAgICBvdXRbcCsrXSA9IChjICYgNjMpIHwgMTI4O1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBvdXQ7XG59O1xuLyoqXG4gKiBDYWxjdWxhdGUgbGVuZ3RoIHdpdGhvdXQgYWN0dWFsbHkgY29udmVydGluZzsgdXNlZnVsIGZvciBkb2luZyBjaGVhcGVyIHZhbGlkYXRpb24uXG4gKiBAcGFyYW0ge3N0cmluZ30gc3RyXG4gKiBAcmV0dXJuIHtudW1iZXJ9XG4gKi9cbmNvbnN0IHN0cmluZ0xlbmd0aCA9IGZ1bmN0aW9uIChzdHIpIHtcbiAgICBsZXQgcCA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgYyA9IHN0ci5jaGFyQ29kZUF0KGkpO1xuICAgICAgICBpZiAoYyA8IDEyOCkge1xuICAgICAgICAgICAgcCsrO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGMgPCAyMDQ4KSB7XG4gICAgICAgICAgICBwICs9IDI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYyA+PSAweGQ4MDAgJiYgYyA8PSAweGRiZmYpIHtcbiAgICAgICAgICAgIC8vIExlYWQgc3Vycm9nYXRlIG9mIGEgc3Vycm9nYXRlIHBhaXIuICBUaGUgcGFpciB0b2dldGhlciB3aWxsIHRha2UgNCBieXRlcyB0byByZXByZXNlbnQuXG4gICAgICAgICAgICBwICs9IDQ7XG4gICAgICAgICAgICBpKys7IC8vIHNraXAgdHJhaWwgc3Vycm9nYXRlLlxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcCArPSAzO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwO1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIGFtb3VudCBvZiBtaWxsaXNlY29uZHMgdG8gZXhwb25lbnRpYWxseSBpbmNyZWFzZS5cbiAqL1xuY29uc3QgREVGQVVMVF9JTlRFUlZBTF9NSUxMSVMgPSAxMDAwO1xuLyoqXG4gKiBUaGUgZmFjdG9yIHRvIGJhY2tvZmYgYnkuXG4gKiBTaG91bGQgYmUgYSBudW1iZXIgZ3JlYXRlciB0aGFuIDEuXG4gKi9cbmNvbnN0IERFRkFVTFRfQkFDS09GRl9GQUNUT1IgPSAyO1xuLyoqXG4gKiBUaGUgbWF4aW11bSBtaWxsaXNlY29uZHMgdG8gaW5jcmVhc2UgdG8uXG4gKlxuICogPHA+VmlzaWJsZSBmb3IgdGVzdGluZ1xuICovXG5jb25zdCBNQVhfVkFMVUVfTUlMTElTID0gNCAqIDYwICogNjAgKiAxMDAwOyAvLyBGb3VyIGhvdXJzLCBsaWtlIGlPUyBhbmQgQW5kcm9pZC5cbi8qKlxuICogVGhlIHBlcmNlbnRhZ2Ugb2YgYmFja29mZiB0aW1lIHRvIHJhbmRvbWl6ZSBieS5cbiAqIFNlZVxuICogaHR0cDovL2dvL3NhZmUtY2xpZW50LWJlaGF2aW9yI3N0ZXAtMS1kZXRlcm1pbmUtdGhlLWFwcHJvcHJpYXRlLXJldHJ5LWludGVydmFsLXRvLWhhbmRsZS1zcGlrZS10cmFmZmljXG4gKiBmb3IgY29udGV4dC5cbiAqXG4gKiA8cD5WaXNpYmxlIGZvciB0ZXN0aW5nXG4gKi9cbmNvbnN0IFJBTkRPTV9GQUNUT1IgPSAwLjU7XG4vKipcbiAqIEJhc2VkIG9uIHRoZSBiYWNrb2ZmIG1ldGhvZCBmcm9tXG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ29vZ2xlL2Nsb3N1cmUtbGlicmFyeS9ibG9iL21hc3Rlci9jbG9zdXJlL2dvb2cvbWF0aC9leHBvbmVudGlhbGJhY2tvZmYuanMuXG4gKiBFeHRyYWN0ZWQgaGVyZSBzbyB3ZSBkb24ndCBuZWVkIHRvIHBhc3MgbWV0YWRhdGEgYW5kIGEgc3RhdGVmdWwgRXhwb25lbnRpYWxCYWNrb2ZmIG9iamVjdCBhcm91bmQuXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZUJhY2tvZmZNaWxsaXMoYmFja29mZkNvdW50LCBpbnRlcnZhbE1pbGxpcyA9IERFRkFVTFRfSU5URVJWQUxfTUlMTElTLCBiYWNrb2ZmRmFjdG9yID0gREVGQVVMVF9CQUNLT0ZGX0ZBQ1RPUikge1xuICAgIC8vIENhbGN1bGF0ZXMgYW4gZXhwb25lbnRpYWxseSBpbmNyZWFzaW5nIHZhbHVlLlxuICAgIC8vIERldmlhdGlvbjogY2FsY3VsYXRlcyB2YWx1ZSBmcm9tIGNvdW50IGFuZCBhIGNvbnN0YW50IGludGVydmFsLCBzbyB3ZSBvbmx5IG5lZWQgdG8gc2F2ZSB2YWx1ZVxuICAgIC8vIGFuZCBjb3VudCB0byByZXN0b3JlIHN0YXRlLlxuICAgIGNvbnN0IGN1cnJCYXNlVmFsdWUgPSBpbnRlcnZhbE1pbGxpcyAqIE1hdGgucG93KGJhY2tvZmZGYWN0b3IsIGJhY2tvZmZDb3VudCk7XG4gICAgLy8gQSByYW5kb20gXCJmdXp6XCIgdG8gYXZvaWQgd2F2ZXMgb2YgcmV0cmllcy5cbiAgICAvLyBEZXZpYXRpb246IHJhbmRvbUZhY3RvciBpcyByZXF1aXJlZC5cbiAgICBjb25zdCByYW5kb21XYWl0ID0gTWF0aC5yb3VuZChcbiAgICAvLyBBIGZyYWN0aW9uIG9mIHRoZSBiYWNrb2ZmIHZhbHVlIHRvIGFkZC9zdWJ0cmFjdC5cbiAgICAvLyBEZXZpYXRpb246IGNoYW5nZXMgbXVsdGlwbGljYXRpb24gb3JkZXIgdG8gaW1wcm92ZSByZWFkYWJpbGl0eS5cbiAgICBSQU5ET01fRkFDVE9SICpcbiAgICAgICAgY3VyckJhc2VWYWx1ZSAqXG4gICAgICAgIC8vIEEgcmFuZG9tIGZsb2F0IChyb3VuZGVkIHRvIGludCBieSBNYXRoLnJvdW5kIGFib3ZlKSBpbiB0aGUgcmFuZ2UgWy0xLCAxXS4gRGV0ZXJtaW5lc1xuICAgICAgICAvLyBpZiB3ZSBhZGQgb3Igc3VidHJhY3QuXG4gICAgICAgIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqXG4gICAgICAgIDIpO1xuICAgIC8vIExpbWl0cyBiYWNrb2ZmIHRvIG1heCB0byBhdm9pZCBlZmZlY3RpdmVseSBwZXJtYW5lbnQgYmFja29mZi5cbiAgICByZXR1cm4gTWF0aC5taW4oTUFYX1ZBTFVFX01JTExJUywgY3VyckJhc2VWYWx1ZSArIHJhbmRvbVdhaXQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlIEVuZ2xpc2ggb3JkaW5hbCBsZXR0ZXJzIGFmdGVyIGEgbnVtYmVyXG4gKi9cbmZ1bmN0aW9uIG9yZGluYWwoaSkge1xuICAgIGlmICghTnVtYmVyLmlzRmluaXRlKGkpKSB7XG4gICAgICAgIHJldHVybiBgJHtpfWA7XG4gICAgfVxuICAgIHJldHVybiBpICsgaW5kaWNhdG9yKGkpO1xufVxuZnVuY3Rpb24gaW5kaWNhdG9yKGkpIHtcbiAgICBpID0gTWF0aC5hYnMoaSk7XG4gICAgY29uc3QgY2VudCA9IGkgJSAxMDA7XG4gICAgaWYgKGNlbnQgPj0gMTAgJiYgY2VudCA8PSAyMCkge1xuICAgICAgICByZXR1cm4gJ3RoJztcbiAgICB9XG4gICAgY29uc3QgZGVjID0gaSAlIDEwO1xuICAgIGlmIChkZWMgPT09IDEpIHtcbiAgICAgICAgcmV0dXJuICdzdCc7XG4gICAgfVxuICAgIGlmIChkZWMgPT09IDIpIHtcbiAgICAgICAgcmV0dXJuICduZCc7XG4gICAgfVxuICAgIGlmIChkZWMgPT09IDMpIHtcbiAgICAgICAgcmV0dXJuICdyZCc7XG4gICAgfVxuICAgIHJldHVybiAndGgnO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gZ2V0TW9kdWxhckluc3RhbmNlKHNlcnZpY2UpIHtcbiAgICBpZiAoc2VydmljZSAmJiBzZXJ2aWNlLl9kZWxlZ2F0ZSkge1xuICAgICAgICByZXR1cm4gc2VydmljZS5fZGVsZWdhdGU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gc2VydmljZTtcbiAgICB9XG59XG5cbmV4cG9ydCB7IENPTlNUQU5UUywgRGVjb2RlQmFzZTY0U3RyaW5nRXJyb3IsIERlZmVycmVkLCBFcnJvckZhY3RvcnksIEZpcmViYXNlRXJyb3IsIE1BWF9WQUxVRV9NSUxMSVMsIFJBTkRPTV9GQUNUT1IsIFNoYTEsIGFyZUNvb2tpZXNFbmFibGVkLCBhc3NlcnQsIGFzc2VydGlvbkVycm9yLCBhc3luYywgYmFzZTY0LCBiYXNlNjREZWNvZGUsIGJhc2U2NEVuY29kZSwgYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcsIGNhbGN1bGF0ZUJhY2tvZmZNaWxsaXMsIGNvbnRhaW5zLCBjcmVhdGVNb2NrVXNlclRva2VuLCBjcmVhdGVTdWJzY3JpYmUsIGRlY29kZSwgZGVlcENvcHksIGRlZXBFcXVhbCwgZGVlcEV4dGVuZCwgZXJyb3JQcmVmaXgsIGV4dHJhY3RRdWVyeXN0cmluZywgZ2V0RGVmYXVsdEFwcENvbmZpZywgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCwgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0LCBnZXREZWZhdWx0cywgZ2V0RXhwZXJpbWVudGFsU2V0dGluZywgZ2V0R2xvYmFsLCBnZXRNb2R1bGFySW5zdGFuY2UsIGdldFVBLCBpc0FkbWluLCBpc0Jyb3dzZXIsIGlzQnJvd3NlckV4dGVuc2lvbiwgaXNDbG91ZGZsYXJlV29ya2VyLCBpc0VsZWN0cm9uLCBpc0VtcHR5LCBpc0lFLCBpc0luZGV4ZWREQkF2YWlsYWJsZSwgaXNNb2JpbGVDb3Jkb3ZhLCBpc05vZGUsIGlzTm9kZVNkaywgaXNSZWFjdE5hdGl2ZSwgaXNTYWZhcmksIGlzVVdQLCBpc1ZhbGlkRm9ybWF0LCBpc1ZhbGlkVGltZXN0YW1wLCBpc1dlYldvcmtlciwgaXNzdWVkQXRUaW1lLCBqc29uRXZhbCwgbWFwLCBvcmRpbmFsLCBwcm9taXNlV2l0aFRpbWVvdXQsIHF1ZXJ5c3RyaW5nLCBxdWVyeXN0cmluZ0RlY29kZSwgc2FmZUdldCwgc3RyaW5nTGVuZ3RoLCBzdHJpbmdUb0J5dGVBcnJheSwgc3RyaW5naWZ5LCB2YWxpZGF0ZUFyZ0NvdW50LCB2YWxpZGF0ZUNhbGxiYWNrLCB2YWxpZGF0ZUNvbnRleHRPYmplY3QsIHZhbGlkYXRlSW5kZXhlZERCT3BlbmFibGUsIHZhbGlkYXRlTmFtZXNwYWNlIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiaW1wb3J0IHsgRGVmZXJyZWQgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5cbi8qKlxuICogQ29tcG9uZW50IGZvciBzZXJ2aWNlIG5hbWUgVCwgZS5nLiBgYXV0aGAsIGBhdXRoLWludGVybmFsYFxuICovXG5jbGFzcyBDb21wb25lbnQge1xuICAgIC8qKlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIHB1YmxpYyBzZXJ2aWNlIG5hbWUsIGUuZy4gYXBwLCBhdXRoLCBmaXJlc3RvcmUsIGRhdGFiYXNlXG4gICAgICogQHBhcmFtIGluc3RhbmNlRmFjdG9yeSBTZXJ2aWNlIGZhY3RvcnkgcmVzcG9uc2libGUgZm9yIGNyZWF0aW5nIHRoZSBwdWJsaWMgaW50ZXJmYWNlXG4gICAgICogQHBhcmFtIHR5cGUgd2hldGhlciB0aGUgc2VydmljZSBwcm92aWRlZCBieSB0aGUgY29tcG9uZW50IGlzIHB1YmxpYyBvciBwcml2YXRlXG4gICAgICovXG4gICAgY29uc3RydWN0b3IobmFtZSwgaW5zdGFuY2VGYWN0b3J5LCB0eXBlKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuaW5zdGFuY2VGYWN0b3J5ID0gaW5zdGFuY2VGYWN0b3J5O1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLm11bHRpcGxlSW5zdGFuY2VzID0gZmFsc2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBQcm9wZXJ0aWVzIHRvIGJlIGFkZGVkIHRvIHRoZSBzZXJ2aWNlIG5hbWVzcGFjZVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zZXJ2aWNlUHJvcHMgPSB7fTtcbiAgICAgICAgdGhpcy5pbnN0YW50aWF0aW9uTW9kZSA9IFwiTEFaWVwiIC8qIEluc3RhbnRpYXRpb25Nb2RlLkxBWlkgKi87XG4gICAgICAgIHRoaXMub25JbnN0YW5jZUNyZWF0ZWQgPSBudWxsO1xuICAgIH1cbiAgICBzZXRJbnN0YW50aWF0aW9uTW9kZShtb2RlKSB7XG4gICAgICAgIHRoaXMuaW5zdGFudGlhdGlvbk1vZGUgPSBtb2RlO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgc2V0TXVsdGlwbGVJbnN0YW5jZXMobXVsdGlwbGVJbnN0YW5jZXMpIHtcbiAgICAgICAgdGhpcy5tdWx0aXBsZUluc3RhbmNlcyA9IG11bHRpcGxlSW5zdGFuY2VzO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgc2V0U2VydmljZVByb3BzKHByb3BzKSB7XG4gICAgICAgIHRoaXMuc2VydmljZVByb3BzID0gcHJvcHM7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBzZXRJbnN0YW5jZUNyZWF0ZWRDYWxsYmFjayhjYWxsYmFjaykge1xuICAgICAgICB0aGlzLm9uSW5zdGFuY2VDcmVhdGVkID0gY2FsbGJhY2s7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IERFRkFVTFRfRU5UUllfTkFNRSA9ICdbREVGQVVMVF0nO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlciBmb3IgaW5zdGFuY2UgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuICdhdXRoJywgJ2F1dGgtaW50ZXJuYWwnXG4gKiBOYW1lU2VydmljZU1hcHBpbmdbVF0gaXMgYW4gYWxpYXMgZm9yIHRoZSB0eXBlIG9mIHRoZSBpbnN0YW5jZVxuICovXG5jbGFzcyBQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IobmFtZSwgY29udGFpbmVyKSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICB0aGlzLmNvbXBvbmVudCA9IG51bGw7XG4gICAgICAgIHRoaXMuaW5zdGFuY2VzID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmluc3RhbmNlc0RlZmVycmVkID0gbmV3IE1hcCgpO1xuICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMgPSBuZXcgTWFwKCk7XG4gICAgICAgIHRoaXMub25Jbml0Q2FsbGJhY2tzID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gaWRlbnRpZmllciBBIHByb3ZpZGVyIGNhbiBwcm92aWRlIG11bHRpcGxlIGluc3RhbmNlcyBvZiBhIHNlcnZpY2VcbiAgICAgKiBpZiB0aGlzLmNvbXBvbmVudC5tdWx0aXBsZUluc3RhbmNlcyBpcyB0cnVlLlxuICAgICAqL1xuICAgIGdldChpZGVudGlmaWVyKSB7XG4gICAgICAgIC8vIGlmIG11bHRpcGxlSW5zdGFuY2VzIGlzIG5vdCBzdXBwb3J0ZWQsIHVzZSB0aGUgZGVmYXVsdCBuYW1lXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICAgIGlmICghdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5oYXMobm9ybWFsaXplZElkZW50aWZpZXIpKSB7XG4gICAgICAgICAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpO1xuICAgICAgICAgICAgdGhpcy5pbnN0YW5jZXNEZWZlcnJlZC5zZXQobm9ybWFsaXplZElkZW50aWZpZXIsIGRlZmVycmVkKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQobm9ybWFsaXplZElkZW50aWZpZXIpIHx8XG4gICAgICAgICAgICAgICAgdGhpcy5zaG91bGRBdXRvSW5pdGlhbGl6ZSgpKSB7XG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6ZSB0aGUgc2VydmljZSBpZiBpdCBjYW4gYmUgYXV0by1pbml0aWFsaXplZFxuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbnN0YW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShpbnN0YW5jZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gd2hlbiB0aGUgaW5zdGFuY2UgZmFjdG9yeSB0aHJvd3MgYW4gZXhjZXB0aW9uIGR1cmluZyBnZXQoKSwgaXQgc2hvdWxkIG5vdCBjYXVzZVxuICAgICAgICAgICAgICAgICAgICAvLyBhIGZhdGFsIGVycm9yLiBXZSBqdXN0IHJldHVybiB0aGUgdW5yZXNvbHZlZCBwcm9taXNlIGluIHRoaXMgY2FzZS5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKS5wcm9taXNlO1xuICAgIH1cbiAgICBnZXRJbW1lZGlhdGUob3B0aW9ucykge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIGlmIG11bHRpcGxlSW5zdGFuY2VzIGlzIG5vdCBzdXBwb3J0ZWQsIHVzZSB0aGUgZGVmYXVsdCBuYW1lXG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIob3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmlkZW50aWZpZXIpO1xuICAgICAgICBjb25zdCBvcHRpb25hbCA9IChfYSA9IG9wdGlvbnMgPT09IG51bGwgfHwgb3B0aW9ucyA9PT0gdm9pZCAwID8gdm9pZCAwIDogb3B0aW9ucy5vcHRpb25hbCkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQobm9ybWFsaXplZElkZW50aWZpZXIpIHx8XG4gICAgICAgICAgICB0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9wdGlvbmFsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBJbiBjYXNlIGEgY29tcG9uZW50IGlzIG5vdCBpbml0aWFsaXplZCBhbmQgc2hvdWxkL2Nhbm5vdCBiZSBhdXRvLWluaXRpYWxpemVkIGF0IHRoZSBtb21lbnQsIHJldHVybiBudWxsIGlmIHRoZSBvcHRpb25hbCBmbGFnIGlzIHNldCwgb3IgdGhyb3dcbiAgICAgICAgICAgIGlmIChvcHRpb25hbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoYFNlcnZpY2UgJHt0aGlzLm5hbWV9IGlzIG5vdCBhdmFpbGFibGVgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDb21wb25lbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudDtcbiAgICB9XG4gICAgc2V0Q29tcG9uZW50KGNvbXBvbmVudCkge1xuICAgICAgICBpZiAoY29tcG9uZW50Lm5hbWUgIT09IHRoaXMubmFtZSkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYE1pc21hdGNoaW5nIENvbXBvbmVudCAke2NvbXBvbmVudC5uYW1lfSBmb3IgUHJvdmlkZXIgJHt0aGlzLm5hbWV9LmApO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoYENvbXBvbmVudCBmb3IgJHt0aGlzLm5hbWV9IGhhcyBhbHJlYWR5IGJlZW4gcHJvdmlkZWRgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmNvbXBvbmVudCA9IGNvbXBvbmVudDtcbiAgICAgICAgLy8gcmV0dXJuIGVhcmx5IHdpdGhvdXQgYXR0ZW1wdGluZyB0byBpbml0aWFsaXplIHRoZSBjb21wb25lbnQgaWYgdGhlIGNvbXBvbmVudCByZXF1aXJlcyBleHBsaWNpdCBpbml0aWFsaXphdGlvbiAoY2FsbGluZyBgUHJvdmlkZXIuaW5pdGlhbGl6ZSgpYClcbiAgICAgICAgaWYgKCF0aGlzLnNob3VsZEF1dG9Jbml0aWFsaXplKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBpZiB0aGUgc2VydmljZSBpcyBlYWdlciwgaW5pdGlhbGl6ZSB0aGUgZGVmYXVsdCBpbnN0YW5jZVxuICAgICAgICBpZiAoaXNDb21wb25lbnRFYWdlcihjb21wb25lbnQpKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7IGluc3RhbmNlSWRlbnRpZmllcjogREVGQVVMVF9FTlRSWV9OQU1FIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IGZvciBhbiBlYWdlciBDb21wb25lbnQgdGhyb3dzIGFuIGV4Y2VwdGlvbiBkdXJpbmcgdGhlIGVhZ2VyXG4gICAgICAgICAgICAgICAgLy8gaW5pdGlhbGl6YXRpb24sIGl0IHNob3VsZCBub3QgY2F1c2UgYSBmYXRhbCBlcnJvci5cbiAgICAgICAgICAgICAgICAvLyBUT0RPOiBJbnZlc3RpZ2F0ZSBpZiB3ZSBuZWVkIHRvIG1ha2UgaXQgY29uZmlndXJhYmxlLCBiZWNhdXNlIHNvbWUgY29tcG9uZW50IG1heSB3YW50IHRvIGNhdXNlXG4gICAgICAgICAgICAgICAgLy8gYSBmYXRhbCBlcnJvciBpbiB0aGlzIGNhc2U/XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gQ3JlYXRlIHNlcnZpY2UgaW5zdGFuY2VzIGZvciB0aGUgcGVuZGluZyBwcm9taXNlcyBhbmQgcmVzb2x2ZSB0aGVtXG4gICAgICAgIC8vIE5PVEU6IGlmIHRoaXMubXVsdGlwbGVJbnN0YW5jZXMgaXMgZmFsc2UsIG9ubHkgdGhlIGRlZmF1bHQgaW5zdGFuY2Ugd2lsbCBiZSBjcmVhdGVkXG4gICAgICAgIC8vIGFuZCBhbGwgcHJvbWlzZXMgd2l0aCByZXNvbHZlIHdpdGggaXQgcmVnYXJkbGVzcyBvZiB0aGUgaWRlbnRpZmllci5cbiAgICAgICAgZm9yIChjb25zdCBbaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZURlZmVycmVkXSBvZiB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpbnN0YW5jZUlkZW50aWZpZXIpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBgZ2V0T3JJbml0aWFsaXplU2VydmljZSgpYCBzaG91bGQgYWx3YXlzIHJldHVybiBhIHZhbGlkIGluc3RhbmNlIHNpbmNlIGEgY29tcG9uZW50IGlzIGd1YXJhbnRlZWQuIHVzZSAhIHRvIG1ha2UgdHlwZXNjcmlwdCBoYXBweS5cbiAgICAgICAgICAgICAgICBjb25zdCBpbnN0YW5jZSA9IHRoaXMuZ2V0T3JJbml0aWFsaXplU2VydmljZSh7XG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXJcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZURlZmVycmVkLnJlc29sdmUoaW5zdGFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyB3aGVuIHRoZSBpbnN0YW5jZSBmYWN0b3J5IHRocm93cyBhbiBleGNlcHRpb24sIGl0IHNob3VsZCBub3QgY2F1c2VcbiAgICAgICAgICAgICAgICAvLyBhIGZhdGFsIGVycm9yLiBXZSBqdXN0IGxlYXZlIHRoZSBwcm9taXNlIHVucmVzb2x2ZWQuXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xlYXJJbnN0YW5jZShpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XG4gICAgICAgIHRoaXMuaW5zdGFuY2VzRGVmZXJyZWQuZGVsZXRlKGlkZW50aWZpZXIpO1xuICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMuZGVsZXRlKGlkZW50aWZpZXIpO1xuICAgICAgICB0aGlzLmluc3RhbmNlcy5kZWxldGUoaWRlbnRpZmllcik7XG4gICAgfVxuICAgIC8vIGFwcC5kZWxldGUoKSB3aWxsIGNhbGwgdGhpcyBtZXRob2Qgb24gZXZlcnkgcHJvdmlkZXIgdG8gZGVsZXRlIHRoZSBzZXJ2aWNlc1xuICAgIC8vIFRPRE86IHNob3VsZCB3ZSBtYXJrIHRoZSBwcm92aWRlciBhcyBkZWxldGVkP1xuICAgIGFzeW5jIGRlbGV0ZSgpIHtcbiAgICAgICAgY29uc3Qgc2VydmljZXMgPSBBcnJheS5mcm9tKHRoaXMuaW5zdGFuY2VzLnZhbHVlcygpKTtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgLi4uc2VydmljZXNcbiAgICAgICAgICAgICAgICAuZmlsdGVyKHNlcnZpY2UgPT4gJ0lOVEVSTkFMJyBpbiBzZXJ2aWNlKSAvLyBsZWdhY3kgc2VydmljZXNcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIC5tYXAoc2VydmljZSA9PiBzZXJ2aWNlLklOVEVSTkFMLmRlbGV0ZSgpKSxcbiAgICAgICAgICAgIC4uLnNlcnZpY2VzXG4gICAgICAgICAgICAgICAgLmZpbHRlcihzZXJ2aWNlID0+ICdfZGVsZXRlJyBpbiBzZXJ2aWNlKSAvLyBtb2R1bGFyaXplZCBzZXJ2aWNlc1xuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICAgICAgLm1hcChzZXJ2aWNlID0+IHNlcnZpY2UuX2RlbGV0ZSgpKVxuICAgICAgICBdKTtcbiAgICB9XG4gICAgaXNDb21wb25lbnRTZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbXBvbmVudCAhPSBudWxsO1xuICAgIH1cbiAgICBpc0luaXRpYWxpemVkKGlkZW50aWZpZXIgPSBERUZBVUxUX0VOVFJZX05BTUUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5zdGFuY2VzLmhhcyhpZGVudGlmaWVyKTtcbiAgICB9XG4gICAgZ2V0T3B0aW9ucyhpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmluc3RhbmNlc09wdGlvbnMuZ2V0KGlkZW50aWZpZXIpIHx8IHt9O1xuICAgIH1cbiAgICBpbml0aWFsaXplKG9wdHMgPSB7fSkge1xuICAgICAgICBjb25zdCB7IG9wdGlvbnMgPSB7fSB9ID0gb3B0cztcbiAgICAgICAgY29uc3Qgbm9ybWFsaXplZElkZW50aWZpZXIgPSB0aGlzLm5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihvcHRzLmluc3RhbmNlSWRlbnRpZmllcik7XG4gICAgICAgIGlmICh0aGlzLmlzSW5pdGlhbGl6ZWQobm9ybWFsaXplZElkZW50aWZpZXIpKSB7XG4gICAgICAgICAgICB0aHJvdyBFcnJvcihgJHt0aGlzLm5hbWV9KCR7bm9ybWFsaXplZElkZW50aWZpZXJ9KSBoYXMgYWxyZWFkeSBiZWVuIGluaXRpYWxpemVkYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmlzQ29tcG9uZW50U2V0KCkpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKGBDb21wb25lbnQgJHt0aGlzLm5hbWV9IGhhcyBub3QgYmVlbiByZWdpc3RlcmVkIHlldGApO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluc3RhbmNlID0gdGhpcy5nZXRPckluaXRpYWxpemVTZXJ2aWNlKHtcbiAgICAgICAgICAgIGluc3RhbmNlSWRlbnRpZmllcjogbm9ybWFsaXplZElkZW50aWZpZXIsXG4gICAgICAgICAgICBvcHRpb25zXG4gICAgICAgIH0pO1xuICAgICAgICAvLyByZXNvbHZlIGFueSBwZW5kaW5nIHByb21pc2Ugd2FpdGluZyBmb3IgdGhlIHNlcnZpY2UgaW5zdGFuY2VcbiAgICAgICAgZm9yIChjb25zdCBbaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZURlZmVycmVkXSBvZiB0aGlzLmluc3RhbmNlc0RlZmVycmVkLmVudHJpZXMoKSkge1xuICAgICAgICAgICAgY29uc3Qgbm9ybWFsaXplZERlZmVycmVkSWRlbnRpZmllciA9IHRoaXMubm9ybWFsaXplSW5zdGFuY2VJZGVudGlmaWVyKGluc3RhbmNlSWRlbnRpZmllcik7XG4gICAgICAgICAgICBpZiAobm9ybWFsaXplZElkZW50aWZpZXIgPT09IG5vcm1hbGl6ZWREZWZlcnJlZElkZW50aWZpZXIpIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZURlZmVycmVkLnJlc29sdmUoaW5zdGFuY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBpbnN0YW5jZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgLSBhIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBpbnZva2VkICBhZnRlciB0aGUgcHJvdmlkZXIgaGFzIGJlZW4gaW5pdGlhbGl6ZWQgYnkgY2FsbGluZyBwcm92aWRlci5pbml0aWFsaXplKCkuXG4gICAgICogVGhlIGZ1bmN0aW9uIGlzIGludm9rZWQgU1lOQ0hST05PVVNMWSwgc28gaXQgc2hvdWxkIG5vdCBleGVjdXRlIGFueSBsb25ncnVubmluZyB0YXNrcyBpbiBvcmRlciB0byBub3QgYmxvY2sgdGhlIHByb2dyYW0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gaWRlbnRpZmllciBBbiBvcHRpb25hbCBpbnN0YW5jZSBpZGVudGlmaWVyXG4gICAgICogQHJldHVybnMgYSBmdW5jdGlvbiB0byB1bnJlZ2lzdGVyIHRoZSBjYWxsYmFja1xuICAgICAqL1xuICAgIG9uSW5pdChjYWxsYmFjaywgaWRlbnRpZmllcikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IG5vcm1hbGl6ZWRJZGVudGlmaWVyID0gdGhpcy5ub3JtYWxpemVJbnN0YW5jZUlkZW50aWZpZXIoaWRlbnRpZmllcik7XG4gICAgICAgIGNvbnN0IGV4aXN0aW5nQ2FsbGJhY2tzID0gKF9hID0gdGhpcy5vbkluaXRDYWxsYmFja3MuZ2V0KG5vcm1hbGl6ZWRJZGVudGlmaWVyKSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbmV3IFNldCgpO1xuICAgICAgICBleGlzdGluZ0NhbGxiYWNrcy5hZGQoY2FsbGJhY2spO1xuICAgICAgICB0aGlzLm9uSW5pdENhbGxiYWNrcy5zZXQobm9ybWFsaXplZElkZW50aWZpZXIsIGV4aXN0aW5nQ2FsbGJhY2tzKTtcbiAgICAgICAgY29uc3QgZXhpc3RpbmdJbnN0YW5jZSA9IHRoaXMuaW5zdGFuY2VzLmdldChub3JtYWxpemVkSWRlbnRpZmllcik7XG4gICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7XG4gICAgICAgICAgICBjYWxsYmFjayhleGlzdGluZ0luc3RhbmNlLCBub3JtYWxpemVkSWRlbnRpZmllcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGV4aXN0aW5nQ2FsbGJhY2tzLmRlbGV0ZShjYWxsYmFjayk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEludm9rZSBvbkluaXQgY2FsbGJhY2tzIHN5bmNocm9ub3VzbHlcbiAgICAgKiBAcGFyYW0gaW5zdGFuY2UgdGhlIHNlcnZpY2UgaW5zdGFuY2VgXG4gICAgICovXG4gICAgaW52b2tlT25Jbml0Q2FsbGJhY2tzKGluc3RhbmNlLCBpZGVudGlmaWVyKSB7XG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IHRoaXMub25Jbml0Q2FsbGJhY2tzLmdldChpZGVudGlmaWVyKTtcbiAgICAgICAgaWYgKCFjYWxsYmFja3MpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGNhbGxiYWNrIG9mIGNhbGxiYWNrcykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhpbnN0YW5jZSwgaWRlbnRpZmllcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgICAgICAgICAvLyBpZ25vcmUgZXJyb3JzIGluIHRoZSBvbkluaXQgY2FsbGJhY2tcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRPckluaXRpYWxpemVTZXJ2aWNlKHsgaW5zdGFuY2VJZGVudGlmaWVyLCBvcHRpb25zID0ge30gfSkge1xuICAgICAgICBsZXQgaW5zdGFuY2UgPSB0aGlzLmluc3RhbmNlcy5nZXQoaW5zdGFuY2VJZGVudGlmaWVyKTtcbiAgICAgICAgaWYgKCFpbnN0YW5jZSAmJiB0aGlzLmNvbXBvbmVudCkge1xuICAgICAgICAgICAgaW5zdGFuY2UgPSB0aGlzLmNvbXBvbmVudC5pbnN0YW5jZUZhY3RvcnkodGhpcy5jb250YWluZXIsIHtcbiAgICAgICAgICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5vcm1hbGl6ZUlkZW50aWZpZXJGb3JGYWN0b3J5KGluc3RhbmNlSWRlbnRpZmllciksXG4gICAgICAgICAgICAgICAgb3B0aW9uc1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlcy5zZXQoaW5zdGFuY2VJZGVudGlmaWVyLCBpbnN0YW5jZSk7XG4gICAgICAgICAgICB0aGlzLmluc3RhbmNlc09wdGlvbnMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgb3B0aW9ucyk7XG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEludm9rZSBvbkluaXQgbGlzdGVuZXJzLlxuICAgICAgICAgICAgICogTm90ZSB0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCBpcyBkaWZmZXJlbnQsIHdoaWNoIGlzIHVzZWQgYnkgdGhlIGNvbXBvbmVudCBjcmVhdG9yLFxuICAgICAgICAgICAgICogd2hpbGUgb25Jbml0IGxpc3RlbmVycyBhcmUgcmVnaXN0ZXJlZCBieSBjb25zdW1lcnMgb2YgdGhlIHByb3ZpZGVyLlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmludm9rZU9uSW5pdENhbGxiYWNrcyhpbnN0YW5jZSwgaW5zdGFuY2VJZGVudGlmaWVyKTtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogT3JkZXIgaXMgaW1wb3J0YW50XG4gICAgICAgICAgICAgKiBvbkluc3RhbmNlQ3JlYXRlZCgpIHNob3VsZCBiZSBjYWxsZWQgYWZ0ZXIgdGhpcy5pbnN0YW5jZXMuc2V0KGluc3RhbmNlSWRlbnRpZmllciwgaW5zdGFuY2UpOyB3aGljaFxuICAgICAgICAgICAgICogbWFrZXMgYGlzSW5pdGlhbGl6ZWQoKWAgcmV0dXJuIHRydWUuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvbmVudC5vbkluc3RhbmNlQ3JlYXRlZCkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY29tcG9uZW50Lm9uSW5zdGFuY2VDcmVhdGVkKHRoaXMuY29udGFpbmVyLCBpbnN0YW5jZUlkZW50aWZpZXIsIGluc3RhbmNlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBlcnJvcnMgaW4gdGhlIG9uSW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2tcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGluc3RhbmNlIHx8IG51bGw7XG4gICAgfVxuICAgIG5vcm1hbGl6ZUluc3RhbmNlSWRlbnRpZmllcihpZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29tcG9uZW50Lm11bHRpcGxlSW5zdGFuY2VzID8gaWRlbnRpZmllciA6IERFRkFVTFRfRU5UUllfTkFNRTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpZGVudGlmaWVyOyAvLyBhc3N1bWUgbXVsdGlwbGUgaW5zdGFuY2VzIGFyZSBzdXBwb3J0ZWQgYmVmb3JlIHRoZSBjb21wb25lbnQgaXMgcHJvdmlkZWQuXG4gICAgICAgIH1cbiAgICB9XG4gICAgc2hvdWxkQXV0b0luaXRpYWxpemUoKSB7XG4gICAgICAgIHJldHVybiAoISF0aGlzLmNvbXBvbmVudCAmJlxuICAgICAgICAgICAgdGhpcy5jb21wb25lbnQuaW5zdGFudGlhdGlvbk1vZGUgIT09IFwiRVhQTElDSVRcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLyk7XG4gICAgfVxufVxuLy8gdW5kZWZpbmVkIHNob3VsZCBiZSBwYXNzZWQgdG8gdGhlIHNlcnZpY2UgZmFjdG9yeSBmb3IgdGhlIGRlZmF1bHQgaW5zdGFuY2VcbmZ1bmN0aW9uIG5vcm1hbGl6ZUlkZW50aWZpZXJGb3JGYWN0b3J5KGlkZW50aWZpZXIpIHtcbiAgICByZXR1cm4gaWRlbnRpZmllciA9PT0gREVGQVVMVF9FTlRSWV9OQU1FID8gdW5kZWZpbmVkIDogaWRlbnRpZmllcjtcbn1cbmZ1bmN0aW9uIGlzQ29tcG9uZW50RWFnZXIoY29tcG9uZW50KSB7XG4gICAgcmV0dXJuIGNvbXBvbmVudC5pbnN0YW50aWF0aW9uTW9kZSA9PT0gXCJFQUdFUlwiIC8qIEluc3RhbnRpYXRpb25Nb2RlLkVBR0VSICovO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb21wb25lbnRDb250YWluZXIgdGhhdCBwcm92aWRlcyBQcm92aWRlcnMgZm9yIHNlcnZpY2UgbmFtZSBULCBlLmcuIGBhdXRoYCwgYGF1dGgtaW50ZXJuYWxgXG4gKi9cbmNsYXNzIENvbXBvbmVudENvbnRhaW5lciB7XG4gICAgY29uc3RydWN0b3IobmFtZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLnByb3ZpZGVycyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY29tcG9uZW50IENvbXBvbmVudCBiZWluZyBhZGRlZFxuICAgICAqIEBwYXJhbSBvdmVyd3JpdGUgV2hlbiBhIGNvbXBvbmVudCB3aXRoIHRoZSBzYW1lIG5hbWUgaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkLFxuICAgICAqIGlmIG92ZXJ3cml0ZSBpcyB0cnVlOiBvdmVyd3JpdGUgdGhlIGV4aXN0aW5nIGNvbXBvbmVudCB3aXRoIHRoZSBuZXcgY29tcG9uZW50IGFuZCBjcmVhdGUgYSBuZXdcbiAgICAgKiBwcm92aWRlciB3aXRoIHRoZSBuZXcgY29tcG9uZW50LiBJdCBjYW4gYmUgdXNlZnVsIGluIHRlc3RzIHdoZXJlIHlvdSB3YW50IHRvIHVzZSBkaWZmZXJlbnQgbW9ja3NcbiAgICAgKiBmb3IgZGlmZmVyZW50IHRlc3RzLlxuICAgICAqIGlmIG92ZXJ3cml0ZSBpcyBmYWxzZTogdGhyb3cgYW4gZXhjZXB0aW9uXG4gICAgICovXG4gICAgYWRkQ29tcG9uZW50KGNvbXBvbmVudCkge1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuZ2V0UHJvdmlkZXIoY29tcG9uZW50Lm5hbWUpO1xuICAgICAgICBpZiAocHJvdmlkZXIuaXNDb21wb25lbnRTZXQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gaGFzIGFscmVhZHkgYmVlbiByZWdpc3RlcmVkIHdpdGggJHt0aGlzLm5hbWV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgcHJvdmlkZXIuc2V0Q29tcG9uZW50KGNvbXBvbmVudCk7XG4gICAgfVxuICAgIGFkZE9yT3ZlcndyaXRlQ29tcG9uZW50KGNvbXBvbmVudCkge1xuICAgICAgICBjb25zdCBwcm92aWRlciA9IHRoaXMuZ2V0UHJvdmlkZXIoY29tcG9uZW50Lm5hbWUpO1xuICAgICAgICBpZiAocHJvdmlkZXIuaXNDb21wb25lbnRTZXQoKSkge1xuICAgICAgICAgICAgLy8gZGVsZXRlIHRoZSBleGlzdGluZyBwcm92aWRlciBmcm9tIHRoZSBjb250YWluZXIsIHNvIHdlIGNhbiByZWdpc3RlciB0aGUgbmV3IGNvbXBvbmVudFxuICAgICAgICAgICAgdGhpcy5wcm92aWRlcnMuZGVsZXRlKGNvbXBvbmVudC5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmFkZENvbXBvbmVudChjb21wb25lbnQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBnZXRQcm92aWRlciBwcm92aWRlcyBhIHR5cGUgc2FmZSBpbnRlcmZhY2Ugd2hlcmUgaXQgY2FuIG9ubHkgYmUgY2FsbGVkIHdpdGggYSBmaWVsZCBuYW1lXG4gICAgICogcHJlc2VudCBpbiBOYW1lU2VydmljZU1hcHBpbmcgaW50ZXJmYWNlLlxuICAgICAqXG4gICAgICogRmlyZWJhc2UgU0RLcyBwcm92aWRpbmcgc2VydmljZXMgc2hvdWxkIGV4dGVuZCBOYW1lU2VydmljZU1hcHBpbmcgaW50ZXJmYWNlIHRvIHJlZ2lzdGVyXG4gICAgICogdGhlbXNlbHZlcy5cbiAgICAgKi9cbiAgICBnZXRQcm92aWRlcihuYW1lKSB7XG4gICAgICAgIGlmICh0aGlzLnByb3ZpZGVycy5oYXMobmFtZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByb3ZpZGVycy5nZXQobmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gY3JlYXRlIGEgUHJvdmlkZXIgZm9yIGEgc2VydmljZSB0aGF0IGhhc24ndCByZWdpc3RlcmVkIHdpdGggRmlyZWJhc2VcbiAgICAgICAgY29uc3QgcHJvdmlkZXIgPSBuZXcgUHJvdmlkZXIobmFtZSwgdGhpcyk7XG4gICAgICAgIHRoaXMucHJvdmlkZXJzLnNldChuYW1lLCBwcm92aWRlcik7XG4gICAgICAgIHJldHVybiBwcm92aWRlcjtcbiAgICB9XG4gICAgZ2V0UHJvdmlkZXJzKCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLnByb3ZpZGVycy52YWx1ZXMoKSk7XG4gICAgfVxufVxuXG5leHBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudENvbnRhaW5lciwgUHJvdmlkZXIgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCIvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNvbnRhaW5lciBmb3IgYWxsIG9mIHRoZSBMb2dnZXIgaW5zdGFuY2VzXG4gKi9cbmNvbnN0IGluc3RhbmNlcyA9IFtdO1xuLyoqXG4gKiBUaGUgSlMgU0RLIHN1cHBvcnRzIDUgbG9nIGxldmVscyBhbmQgYWxzbyBhbGxvd3MgYSB1c2VyIHRoZSBhYmlsaXR5IHRvXG4gKiBzaWxlbmNlIHRoZSBsb2dzIGFsdG9nZXRoZXIuXG4gKlxuICogVGhlIG9yZGVyIGlzIGEgZm9sbG93czpcbiAqIERFQlVHIDwgVkVSQk9TRSA8IElORk8gPCBXQVJOIDwgRVJST1JcbiAqXG4gKiBBbGwgb2YgdGhlIGxvZyB0eXBlcyBhYm92ZSB0aGUgY3VycmVudCBsb2cgbGV2ZWwgd2lsbCBiZSBjYXB0dXJlZCAoaS5lLiBpZlxuICogeW91IHNldCB0aGUgbG9nIGxldmVsIHRvIGBJTkZPYCwgZXJyb3JzIHdpbGwgc3RpbGwgYmUgbG9nZ2VkLCBidXQgYERFQlVHYCBhbmRcbiAqIGBWRVJCT1NFYCBsb2dzIHdpbGwgbm90KVxuICovXG52YXIgTG9nTGV2ZWw7XG4oZnVuY3Rpb24gKExvZ0xldmVsKSB7XG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJERUJVR1wiXSA9IDBdID0gXCJERUJVR1wiO1xuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiVkVSQk9TRVwiXSA9IDFdID0gXCJWRVJCT1NFXCI7XG4gICAgTG9nTGV2ZWxbTG9nTGV2ZWxbXCJJTkZPXCJdID0gMl0gPSBcIklORk9cIjtcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIldBUk5cIl0gPSAzXSA9IFwiV0FSTlwiO1xuICAgIExvZ0xldmVsW0xvZ0xldmVsW1wiRVJST1JcIl0gPSA0XSA9IFwiRVJST1JcIjtcbiAgICBMb2dMZXZlbFtMb2dMZXZlbFtcIlNJTEVOVFwiXSA9IDVdID0gXCJTSUxFTlRcIjtcbn0pKExvZ0xldmVsIHx8IChMb2dMZXZlbCA9IHt9KSk7XG5jb25zdCBsZXZlbFN0cmluZ1RvRW51bSA9IHtcbiAgICAnZGVidWcnOiBMb2dMZXZlbC5ERUJVRyxcbiAgICAndmVyYm9zZSc6IExvZ0xldmVsLlZFUkJPU0UsXG4gICAgJ2luZm8nOiBMb2dMZXZlbC5JTkZPLFxuICAgICd3YXJuJzogTG9nTGV2ZWwuV0FSTixcbiAgICAnZXJyb3InOiBMb2dMZXZlbC5FUlJPUixcbiAgICAnc2lsZW50JzogTG9nTGV2ZWwuU0lMRU5UXG59O1xuLyoqXG4gKiBUaGUgZGVmYXVsdCBsb2cgbGV2ZWxcbiAqL1xuY29uc3QgZGVmYXVsdExvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTztcbi8qKlxuICogQnkgZGVmYXVsdCwgYGNvbnNvbGUuZGVidWdgIGlzIG5vdCBkaXNwbGF5ZWQgaW4gdGhlIGRldmVsb3BlciBjb25zb2xlIChpblxuICogY2hyb21lKS4gVG8gYXZvaWQgZm9yY2luZyB1c2VycyB0byBoYXZlIHRvIG9wdC1pbiB0byB0aGVzZSBsb2dzIHR3aWNlXG4gKiAoaS5lLiBvbmNlIGZvciBmaXJlYmFzZSwgYW5kIG9uY2UgaW4gdGhlIGNvbnNvbGUpLCB3ZSBhcmUgc2VuZGluZyBgREVCVUdgXG4gKiBsb2dzIHRvIHRoZSBgY29uc29sZS5sb2dgIGZ1bmN0aW9uLlxuICovXG5jb25zdCBDb25zb2xlTWV0aG9kID0ge1xuICAgIFtMb2dMZXZlbC5ERUJVR106ICdsb2cnLFxuICAgIFtMb2dMZXZlbC5WRVJCT1NFXTogJ2xvZycsXG4gICAgW0xvZ0xldmVsLklORk9dOiAnaW5mbycsXG4gICAgW0xvZ0xldmVsLldBUk5dOiAnd2FybicsXG4gICAgW0xvZ0xldmVsLkVSUk9SXTogJ2Vycm9yJ1xufTtcbi8qKlxuICogVGhlIGRlZmF1bHQgbG9nIGhhbmRsZXIgd2lsbCBmb3J3YXJkIERFQlVHLCBWRVJCT1NFLCBJTkZPLCBXQVJOLCBhbmQgRVJST1JcbiAqIG1lc3NhZ2VzIG9uIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgY29uc29sZSBjb3VudGVycGFydHMgKGlmIHRoZSBsb2cgbWV0aG9kXG4gKiBpcyBzdXBwb3J0ZWQgYnkgdGhlIGN1cnJlbnQgbG9nIGxldmVsKVxuICovXG5jb25zdCBkZWZhdWx0TG9nSGFuZGxlciA9IChpbnN0YW5jZSwgbG9nVHlwZSwgLi4uYXJncykgPT4ge1xuICAgIGlmIChsb2dUeXBlIDwgaW5zdGFuY2UubG9nTGV2ZWwpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgbWV0aG9kID0gQ29uc29sZU1ldGhvZFtsb2dUeXBlXTtcbiAgICBpZiAobWV0aG9kKSB7XG4gICAgICAgIGNvbnNvbGVbbWV0aG9kXShgWyR7bm93fV0gICR7aW5zdGFuY2UubmFtZX06YCwgLi4uYXJncyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEF0dGVtcHRlZCB0byBsb2cgYSBtZXNzYWdlIHdpdGggYW4gaW52YWxpZCBsb2dUeXBlICh2YWx1ZTogJHtsb2dUeXBlfSlgKTtcbiAgICB9XG59O1xuY2xhc3MgTG9nZ2VyIHtcbiAgICAvKipcbiAgICAgKiBHaXZlcyB5b3UgYW4gaW5zdGFuY2Ugb2YgYSBMb2dnZXIgdG8gY2FwdHVyZSBtZXNzYWdlcyBhY2NvcmRpbmcgdG9cbiAgICAgKiBGaXJlYmFzZSdzIGxvZ2dpbmcgc2NoZW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG5hbWUgVGhlIG5hbWUgdGhhdCB0aGUgbG9ncyB3aWxsIGJlIGFzc29jaWF0ZWQgd2l0aFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBsb2cgbGV2ZWwgb2YgdGhlIGdpdmVuIExvZ2dlciBpbnN0YW5jZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX2xvZ0xldmVsID0gZGVmYXVsdExvZ0xldmVsO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG1haW4gKGludGVybmFsKSBsb2cgaGFuZGxlciBmb3IgdGhlIExvZ2dlciBpbnN0YW5jZS5cbiAgICAgICAgICogQ2FuIGJlIHNldCB0byBhIG5ldyBmdW5jdGlvbiBpbiBpbnRlcm5hbCBwYWNrYWdlIGNvZGUgYnV0IG5vdCBieSB1c2VyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlciA9IGRlZmF1bHRMb2dIYW5kbGVyO1xuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIG9wdGlvbmFsLCBhZGRpdGlvbmFsLCB1c2VyLWRlZmluZWQgbG9nIGhhbmRsZXIgZm9yIHRoZSBMb2dnZXIgaW5zdGFuY2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYXB0dXJlIHRoZSBjdXJyZW50IGluc3RhbmNlIGZvciBsYXRlciB1c2VcbiAgICAgICAgICovXG4gICAgICAgIGluc3RhbmNlcy5wdXNoKHRoaXMpO1xuICAgIH1cbiAgICBnZXQgbG9nTGV2ZWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9sb2dMZXZlbDtcbiAgICB9XG4gICAgc2V0IGxvZ0xldmVsKHZhbCkge1xuICAgICAgICBpZiAoISh2YWwgaW4gTG9nTGV2ZWwpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBJbnZhbGlkIHZhbHVlIFwiJHt2YWx9XCIgYXNzaWduZWQgdG8gXFxgbG9nTGV2ZWxcXGBgKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9sb2dMZXZlbCA9IHZhbDtcbiAgICB9XG4gICAgLy8gV29ya2Fyb3VuZCBmb3Igc2V0dGVyL2dldHRlciBoYXZpbmcgdG8gYmUgdGhlIHNhbWUgdHlwZS5cbiAgICBzZXRMb2dMZXZlbCh2YWwpIHtcbiAgICAgICAgdGhpcy5fbG9nTGV2ZWwgPSB0eXBlb2YgdmFsID09PSAnc3RyaW5nJyA/IGxldmVsU3RyaW5nVG9FbnVtW3ZhbF0gOiB2YWw7XG4gICAgfVxuICAgIGdldCBsb2dIYW5kbGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbG9nSGFuZGxlcjtcbiAgICB9XG4gICAgc2V0IGxvZ0hhbmRsZXIodmFsKSB7XG4gICAgICAgIGlmICh0eXBlb2YgdmFsICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBhc3NpZ25lZCB0byBgbG9nSGFuZGxlcmAgbXVzdCBiZSBhIGZ1bmN0aW9uJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlciA9IHZhbDtcbiAgICB9XG4gICAgZ2V0IHVzZXJMb2dIYW5kbGVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdXNlckxvZ0hhbmRsZXI7XG4gICAgfVxuICAgIHNldCB1c2VyTG9nSGFuZGxlcih2YWwpIHtcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgPSB2YWw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBmdW5jdGlvbnMgYmVsb3cgYXJlIGFsbCBiYXNlZCBvbiB0aGUgYGNvbnNvbGVgIGludGVyZmFjZVxuICAgICAqL1xuICAgIGRlYnVnKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuREVCVUcsIC4uLmFyZ3MpO1xuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLkRFQlVHLCAuLi5hcmdzKTtcbiAgICB9XG4gICAgbG9nKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiZcbiAgICAgICAgICAgIHRoaXMuX3VzZXJMb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpO1xuICAgICAgICB0aGlzLl9sb2dIYW5kbGVyKHRoaXMsIExvZ0xldmVsLlZFUkJPU0UsIC4uLmFyZ3MpO1xuICAgIH1cbiAgICBpbmZvKC4uLmFyZ3MpIHtcbiAgICAgICAgdGhpcy5fdXNlckxvZ0hhbmRsZXIgJiYgdGhpcy5fdXNlckxvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7XG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuSU5GTywgLi4uYXJncyk7XG4gICAgfVxuICAgIHdhcm4oLi4uYXJncykge1xuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTtcbiAgICAgICAgdGhpcy5fbG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5XQVJOLCAuLi5hcmdzKTtcbiAgICB9XG4gICAgZXJyb3IoLi4uYXJncykge1xuICAgICAgICB0aGlzLl91c2VyTG9nSGFuZGxlciAmJiB0aGlzLl91c2VyTG9nSGFuZGxlcih0aGlzLCBMb2dMZXZlbC5FUlJPUiwgLi4uYXJncyk7XG4gICAgICAgIHRoaXMuX2xvZ0hhbmRsZXIodGhpcywgTG9nTGV2ZWwuRVJST1IsIC4uLmFyZ3MpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNldExvZ0xldmVsKGxldmVsKSB7XG4gICAgaW5zdGFuY2VzLmZvckVhY2goaW5zdCA9PiB7XG4gICAgICAgIGluc3Quc2V0TG9nTGV2ZWwobGV2ZWwpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gc2V0VXNlckxvZ0hhbmRsZXIobG9nQ2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICBmb3IgKGNvbnN0IGluc3RhbmNlIG9mIGluc3RhbmNlcykge1xuICAgICAgICBsZXQgY3VzdG9tTG9nTGV2ZWwgPSBudWxsO1xuICAgICAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLmxldmVsKSB7XG4gICAgICAgICAgICBjdXN0b21Mb2dMZXZlbCA9IGxldmVsU3RyaW5nVG9FbnVtW29wdGlvbnMubGV2ZWxdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChsb2dDYWxsYmFjayA9PT0gbnVsbCkge1xuICAgICAgICAgICAgaW5zdGFuY2UudXNlckxvZ0hhbmRsZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaW5zdGFuY2UudXNlckxvZ0hhbmRsZXIgPSAoaW5zdGFuY2UsIGxldmVsLCAuLi5hcmdzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZSA9IGFyZ3NcbiAgICAgICAgICAgICAgICAgICAgLm1hcChhcmcgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJnID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBhcmcgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGVvZiBhcmcgPT09ICdudW1iZXInIHx8IHR5cGVvZiBhcmcgPT09ICdib29sZWFuJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFyZy50b1N0cmluZygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGFyZyBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXJnLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShhcmcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGlnbm9yZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5maWx0ZXIoYXJnID0+IGFyZylcbiAgICAgICAgICAgICAgICAgICAgLmpvaW4oJyAnKTtcbiAgICAgICAgICAgICAgICBpZiAobGV2ZWwgPj0gKGN1c3RvbUxvZ0xldmVsICE9PSBudWxsICYmIGN1c3RvbUxvZ0xldmVsICE9PSB2b2lkIDAgPyBjdXN0b21Mb2dMZXZlbCA6IGluc3RhbmNlLmxvZ0xldmVsKSkge1xuICAgICAgICAgICAgICAgICAgICBsb2dDYWxsYmFjayh7XG4gICAgICAgICAgICAgICAgICAgICAgICBsZXZlbDogTG9nTGV2ZWxbbGV2ZWxdLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgYXJncyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IGluc3RhbmNlLm5hbWVcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZXhwb3J0IHsgTG9nTGV2ZWwsIExvZ2dlciwgc2V0TG9nTGV2ZWwsIHNldFVzZXJMb2dIYW5kbGVyIH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1pbmRleC5lc20yMDE3LmpzLm1hcFxuIiwiY29uc3QgaW5zdGFuY2VPZkFueSA9IChvYmplY3QsIGNvbnN0cnVjdG9ycykgPT4gY29uc3RydWN0b3JzLnNvbWUoKGMpID0+IG9iamVjdCBpbnN0YW5jZW9mIGMpO1xuXG5sZXQgaWRiUHJveHlhYmxlVHlwZXM7XG5sZXQgY3Vyc29yQWR2YW5jZU1ldGhvZHM7XG4vLyBUaGlzIGlzIGEgZnVuY3Rpb24gdG8gcHJldmVudCBpdCB0aHJvd2luZyB1cCBpbiBub2RlIGVudmlyb25tZW50cy5cbmZ1bmN0aW9uIGdldElkYlByb3h5YWJsZVR5cGVzKCkge1xuICAgIHJldHVybiAoaWRiUHJveHlhYmxlVHlwZXMgfHxcbiAgICAgICAgKGlkYlByb3h5YWJsZVR5cGVzID0gW1xuICAgICAgICAgICAgSURCRGF0YWJhc2UsXG4gICAgICAgICAgICBJREJPYmplY3RTdG9yZSxcbiAgICAgICAgICAgIElEQkluZGV4LFxuICAgICAgICAgICAgSURCQ3Vyc29yLFxuICAgICAgICAgICAgSURCVHJhbnNhY3Rpb24sXG4gICAgICAgIF0pKTtcbn1cbi8vIFRoaXMgaXMgYSBmdW5jdGlvbiB0byBwcmV2ZW50IGl0IHRocm93aW5nIHVwIGluIG5vZGUgZW52aXJvbm1lbnRzLlxuZnVuY3Rpb24gZ2V0Q3Vyc29yQWR2YW5jZU1ldGhvZHMoKSB7XG4gICAgcmV0dXJuIChjdXJzb3JBZHZhbmNlTWV0aG9kcyB8fFxuICAgICAgICAoY3Vyc29yQWR2YW5jZU1ldGhvZHMgPSBbXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmFkdmFuY2UsXG4gICAgICAgICAgICBJREJDdXJzb3IucHJvdG90eXBlLmNvbnRpbnVlLFxuICAgICAgICAgICAgSURCQ3Vyc29yLnByb3RvdHlwZS5jb250aW51ZVByaW1hcnlLZXksXG4gICAgICAgIF0pKTtcbn1cbmNvbnN0IGN1cnNvclJlcXVlc3RNYXAgPSBuZXcgV2Vha01hcCgpO1xuY29uc3QgdHJhbnNhY3Rpb25Eb25lTWFwID0gbmV3IFdlYWtNYXAoKTtcbmNvbnN0IHRyYW5zYWN0aW9uU3RvcmVOYW1lc01hcCA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCB0cmFuc2Zvcm1DYWNoZSA9IG5ldyBXZWFrTWFwKCk7XG5jb25zdCByZXZlcnNlVHJhbnNmb3JtQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xuZnVuY3Rpb24gcHJvbWlzaWZ5UmVxdWVzdChyZXF1ZXN0KSB7XG4gICAgY29uc3QgcHJvbWlzZSA9IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgY29uc3QgdW5saXN0ZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICByZXF1ZXN0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCBzdWNjZXNzKTtcbiAgICAgICAgICAgIHJlcXVlc3QucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICByZXNvbHZlKHdyYXAocmVxdWVzdC5yZXN1bHQpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICAgICAgdW5saXN0ZW4oKTtcbiAgICAgICAgfTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdzdWNjZXNzJywgc3VjY2Vzcyk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignZXJyb3InLCBlcnJvcik7XG4gICAgfSk7XG4gICAgcHJvbWlzZVxuICAgICAgICAudGhlbigodmFsdWUpID0+IHtcbiAgICAgICAgLy8gU2luY2UgY3Vyc29yaW5nIHJldXNlcyB0aGUgSURCUmVxdWVzdCAoKnNpZ2gqKSwgd2UgY2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbFxuICAgICAgICAvLyAoc2VlIHdyYXBGdW5jdGlvbikuXG4gICAgICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQkN1cnNvcikge1xuICAgICAgICAgICAgY3Vyc29yUmVxdWVzdE1hcC5zZXQodmFsdWUsIHJlcXVlc3QpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhdGNoaW5nIHRvIGF2b2lkIFwiVW5jYXVnaHQgUHJvbWlzZSBleGNlcHRpb25zXCJcbiAgICB9KVxuICAgICAgICAuY2F0Y2goKCkgPT4geyB9KTtcbiAgICAvLyBUaGlzIG1hcHBpbmcgZXhpc3RzIGluIHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBidXQgZG9lc24ndCBkb2Vzbid0IGV4aXN0IGluIHRyYW5zZm9ybUNhY2hlLiBUaGlzXG4gICAgLy8gaXMgYmVjYXVzZSB3ZSBjcmVhdGUgbWFueSBwcm9taXNlcyBmcm9tIGEgc2luZ2xlIElEQlJlcXVlc3QuXG4gICAgcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLnNldChwcm9taXNlLCByZXF1ZXN0KTtcbiAgICByZXR1cm4gcHJvbWlzZTtcbn1cbmZ1bmN0aW9uIGNhY2hlRG9uZVByb21pc2VGb3JUcmFuc2FjdGlvbih0eCkge1xuICAgIC8vIEVhcmx5IGJhaWwgaWYgd2UndmUgYWxyZWFkeSBjcmVhdGVkIGEgZG9uZSBwcm9taXNlIGZvciB0aGlzIHRyYW5zYWN0aW9uLlxuICAgIGlmICh0cmFuc2FjdGlvbkRvbmVNYXAuaGFzKHR4KSlcbiAgICAgICAgcmV0dXJuO1xuICAgIGNvbnN0IGRvbmUgPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgIGNvbnN0IHVubGlzdGVuID0gKCkgPT4ge1xuICAgICAgICAgICAgdHgucmVtb3ZlRXZlbnRMaXN0ZW5lcignY29tcGxldGUnLCBjb21wbGV0ZSk7XG4gICAgICAgICAgICB0eC5yZW1vdmVFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgICAgIHR4LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2Fib3J0JywgZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBjb21wbGV0ZSA9ICgpID0+IHtcbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHR4LmVycm9yIHx8IG5ldyBET01FeGNlcHRpb24oJ0Fib3J0RXJyb3InLCAnQWJvcnRFcnJvcicpKTtcbiAgICAgICAgICAgIHVubGlzdGVuKCk7XG4gICAgICAgIH07XG4gICAgICAgIHR4LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbXBsZXRlJywgY29tcGxldGUpO1xuICAgICAgICB0eC5hZGRFdmVudExpc3RlbmVyKCdlcnJvcicsIGVycm9yKTtcbiAgICAgICAgdHguYWRkRXZlbnRMaXN0ZW5lcignYWJvcnQnLCBlcnJvcik7XG4gICAgfSk7XG4gICAgLy8gQ2FjaGUgaXQgZm9yIGxhdGVyIHJldHJpZXZhbC5cbiAgICB0cmFuc2FjdGlvbkRvbmVNYXAuc2V0KHR4LCBkb25lKTtcbn1cbmxldCBpZGJQcm94eVRyYXBzID0ge1xuICAgIGdldCh0YXJnZXQsIHByb3AsIHJlY2VpdmVyKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgdHJhbnNhY3Rpb24uZG9uZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnZG9uZScpXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zYWN0aW9uRG9uZU1hcC5nZXQodGFyZ2V0KTtcbiAgICAgICAgICAgIC8vIFBvbHlmaWxsIGZvciBvYmplY3RTdG9yZU5hbWVzIGJlY2F1c2Ugb2YgRWRnZS5cbiAgICAgICAgICAgIGlmIChwcm9wID09PSAnb2JqZWN0U3RvcmVOYW1lcycpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGFyZ2V0Lm9iamVjdFN0b3JlTmFtZXMgfHwgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLmdldCh0YXJnZXQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gTWFrZSB0eC5zdG9yZSByZXR1cm4gdGhlIG9ubHkgc3RvcmUgaW4gdGhlIHRyYW5zYWN0aW9uLCBvciB1bmRlZmluZWQgaWYgdGhlcmUgYXJlIG1hbnkuXG4gICAgICAgICAgICBpZiAocHJvcCA9PT0gJ3N0b3JlJykge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWNlaXZlci5vYmplY3RTdG9yZU5hbWVzWzFdXG4gICAgICAgICAgICAgICAgICAgID8gdW5kZWZpbmVkXG4gICAgICAgICAgICAgICAgICAgIDogcmVjZWl2ZXIub2JqZWN0U3RvcmUocmVjZWl2ZXIub2JqZWN0U3RvcmVOYW1lc1swXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gRWxzZSB0cmFuc2Zvcm0gd2hhdGV2ZXIgd2UgZ2V0IGJhY2suXG4gICAgICAgIHJldHVybiB3cmFwKHRhcmdldFtwcm9wXSk7XG4gICAgfSxcbiAgICBzZXQodGFyZ2V0LCBwcm9wLCB2YWx1ZSkge1xuICAgICAgICB0YXJnZXRbcHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBoYXModGFyZ2V0LCBwcm9wKSB7XG4gICAgICAgIGlmICh0YXJnZXQgaW5zdGFuY2VvZiBJREJUcmFuc2FjdGlvbiAmJlxuICAgICAgICAgICAgKHByb3AgPT09ICdkb25lJyB8fCBwcm9wID09PSAnc3RvcmUnKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHByb3AgaW4gdGFyZ2V0O1xuICAgIH0sXG59O1xuZnVuY3Rpb24gcmVwbGFjZVRyYXBzKGNhbGxiYWNrKSB7XG4gICAgaWRiUHJveHlUcmFwcyA9IGNhbGxiYWNrKGlkYlByb3h5VHJhcHMpO1xufVxuZnVuY3Rpb24gd3JhcEZ1bmN0aW9uKGZ1bmMpIHtcbiAgICAvLyBEdWUgdG8gZXhwZWN0ZWQgb2JqZWN0IGVxdWFsaXR5ICh3aGljaCBpcyBlbmZvcmNlZCBieSB0aGUgY2FjaGluZyBpbiBgd3JhcGApLCB3ZVxuICAgIC8vIG9ubHkgY3JlYXRlIG9uZSBuZXcgZnVuYyBwZXIgZnVuYy5cbiAgICAvLyBFZGdlIGRvZXNuJ3Qgc3VwcG9ydCBvYmplY3RTdG9yZU5hbWVzIChib29vKSwgc28gd2UgcG9seWZpbGwgaXQgaGVyZS5cbiAgICBpZiAoZnVuYyA9PT0gSURCRGF0YWJhc2UucHJvdG90eXBlLnRyYW5zYWN0aW9uICYmXG4gICAgICAgICEoJ29iamVjdFN0b3JlTmFtZXMnIGluIElEQlRyYW5zYWN0aW9uLnByb3RvdHlwZSkpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChzdG9yZU5hbWVzLCAuLi5hcmdzKSB7XG4gICAgICAgICAgICBjb25zdCB0eCA9IGZ1bmMuY2FsbCh1bndyYXAodGhpcyksIHN0b3JlTmFtZXMsIC4uLmFyZ3MpO1xuICAgICAgICAgICAgdHJhbnNhY3Rpb25TdG9yZU5hbWVzTWFwLnNldCh0eCwgc3RvcmVOYW1lcy5zb3J0ID8gc3RvcmVOYW1lcy5zb3J0KCkgOiBbc3RvcmVOYW1lc10pO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAodHgpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvLyBDdXJzb3IgbWV0aG9kcyBhcmUgc3BlY2lhbCwgYXMgdGhlIGJlaGF2aW91ciBpcyBhIGxpdHRsZSBtb3JlIGRpZmZlcmVudCB0byBzdGFuZGFyZCBJREIuIEluXG4gICAgLy8gSURCLCB5b3UgYWR2YW5jZSB0aGUgY3Vyc29yIGFuZCB3YWl0IGZvciBhIG5ldyAnc3VjY2Vzcycgb24gdGhlIElEQlJlcXVlc3QgdGhhdCBnYXZlIHlvdSB0aGVcbiAgICAvLyBjdXJzb3IuIEl0J3Mga2luZGEgbGlrZSBhIHByb21pc2UgdGhhdCBjYW4gcmVzb2x2ZSB3aXRoIG1hbnkgdmFsdWVzLiBUaGF0IGRvZXNuJ3QgbWFrZSBzZW5zZVxuICAgIC8vIHdpdGggcmVhbCBwcm9taXNlcywgc28gZWFjaCBhZHZhbmNlIG1ldGhvZHMgcmV0dXJucyBhIG5ldyBwcm9taXNlIGZvciB0aGUgY3Vyc29yIG9iamVjdCwgb3JcbiAgICAvLyB1bmRlZmluZWQgaWYgdGhlIGVuZCBvZiB0aGUgY3Vyc29yIGhhcyBiZWVuIHJlYWNoZWQuXG4gICAgaWYgKGdldEN1cnNvckFkdmFuY2VNZXRob2RzKCkuaW5jbHVkZXMoZnVuYykpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uICguLi5hcmdzKSB7XG4gICAgICAgICAgICAvLyBDYWxsaW5nIHRoZSBvcmlnaW5hbCBmdW5jdGlvbiB3aXRoIHRoZSBwcm94eSBhcyAndGhpcycgY2F1c2VzIElMTEVHQUwgSU5WT0NBVElPTiwgc28gd2UgdXNlXG4gICAgICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICAgICAgZnVuYy5hcHBseSh1bndyYXAodGhpcyksIGFyZ3MpO1xuICAgICAgICAgICAgcmV0dXJuIHdyYXAoY3Vyc29yUmVxdWVzdE1hcC5nZXQodGhpcykpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLmFyZ3MpIHtcbiAgICAgICAgLy8gQ2FsbGluZyB0aGUgb3JpZ2luYWwgZnVuY3Rpb24gd2l0aCB0aGUgcHJveHkgYXMgJ3RoaXMnIGNhdXNlcyBJTExFR0FMIElOVk9DQVRJT04sIHNvIHdlIHVzZVxuICAgICAgICAvLyB0aGUgb3JpZ2luYWwgb2JqZWN0LlxuICAgICAgICByZXR1cm4gd3JhcChmdW5jLmFwcGx5KHVud3JhcCh0aGlzKSwgYXJncykpO1xuICAgIH07XG59XG5mdW5jdGlvbiB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKSB7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHdyYXBGdW5jdGlvbih2YWx1ZSk7XG4gICAgLy8gVGhpcyBkb2Vzbid0IHJldHVybiwgaXQganVzdCBjcmVhdGVzIGEgJ2RvbmUnIHByb21pc2UgZm9yIHRoZSB0cmFuc2FjdGlvbixcbiAgICAvLyB3aGljaCBpcyBsYXRlciByZXR1cm5lZCBmb3IgdHJhbnNhY3Rpb24uZG9uZSAoc2VlIGlkYk9iamVjdEhhbmRsZXIpLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlRyYW5zYWN0aW9uKVxuICAgICAgICBjYWNoZURvbmVQcm9taXNlRm9yVHJhbnNhY3Rpb24odmFsdWUpO1xuICAgIGlmIChpbnN0YW5jZU9mQW55KHZhbHVlLCBnZXRJZGJQcm94eWFibGVUeXBlcygpKSlcbiAgICAgICAgcmV0dXJuIG5ldyBQcm94eSh2YWx1ZSwgaWRiUHJveHlUcmFwcyk7XG4gICAgLy8gUmV0dXJuIHRoZSBzYW1lIHZhbHVlIGJhY2sgaWYgd2UncmUgbm90IGdvaW5nIHRvIHRyYW5zZm9ybSBpdC5cbiAgICByZXR1cm4gdmFsdWU7XG59XG5mdW5jdGlvbiB3cmFwKHZhbHVlKSB7XG4gICAgLy8gV2Ugc29tZXRpbWVzIGdlbmVyYXRlIG11bHRpcGxlIHByb21pc2VzIGZyb20gYSBzaW5nbGUgSURCUmVxdWVzdCAoZWcgd2hlbiBjdXJzb3JpbmcpLCBiZWNhdXNlXG4gICAgLy8gSURCIGlzIHdlaXJkIGFuZCBhIHNpbmdsZSBJREJSZXF1ZXN0IGNhbiB5aWVsZCBtYW55IHJlc3BvbnNlcywgc28gdGhlc2UgY2FuJ3QgYmUgY2FjaGVkLlxuICAgIGlmICh2YWx1ZSBpbnN0YW5jZW9mIElEQlJlcXVlc3QpXG4gICAgICAgIHJldHVybiBwcm9taXNpZnlSZXF1ZXN0KHZhbHVlKTtcbiAgICAvLyBJZiB3ZSd2ZSBhbHJlYWR5IHRyYW5zZm9ybWVkIHRoaXMgdmFsdWUgYmVmb3JlLCByZXVzZSB0aGUgdHJhbnNmb3JtZWQgdmFsdWUuXG4gICAgLy8gVGhpcyBpcyBmYXN0ZXIsIGJ1dCBpdCBhbHNvIHByb3ZpZGVzIG9iamVjdCBlcXVhbGl0eS5cbiAgICBpZiAodHJhbnNmb3JtQ2FjaGUuaGFzKHZhbHVlKSlcbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG4gICAgY29uc3QgbmV3VmFsdWUgPSB0cmFuc2Zvcm1DYWNoYWJsZVZhbHVlKHZhbHVlKTtcbiAgICAvLyBOb3QgYWxsIHR5cGVzIGFyZSB0cmFuc2Zvcm1lZC5cbiAgICAvLyBUaGVzZSBtYXkgYmUgcHJpbWl0aXZlIHR5cGVzLCBzbyB0aGV5IGNhbid0IGJlIFdlYWtNYXAga2V5cy5cbiAgICBpZiAobmV3VmFsdWUgIT09IHZhbHVlKSB7XG4gICAgICAgIHRyYW5zZm9ybUNhY2hlLnNldCh2YWx1ZSwgbmV3VmFsdWUpO1xuICAgICAgICByZXZlcnNlVHJhbnNmb3JtQ2FjaGUuc2V0KG5ld1ZhbHVlLCB2YWx1ZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXdWYWx1ZTtcbn1cbmNvbnN0IHVud3JhcCA9ICh2YWx1ZSkgPT4gcmV2ZXJzZVRyYW5zZm9ybUNhY2hlLmdldCh2YWx1ZSk7XG5cbmV4cG9ydCB7IHJldmVyc2VUcmFuc2Zvcm1DYWNoZSBhcyBhLCBpbnN0YW5jZU9mQW55IGFzIGksIHJlcGxhY2VUcmFwcyBhcyByLCB1bndyYXAgYXMgdSwgd3JhcCBhcyB3IH07XG4iLCJpbXBvcnQgeyB3IGFzIHdyYXAsIHIgYXMgcmVwbGFjZVRyYXBzIH0gZnJvbSAnLi93cmFwLWlkYi12YWx1ZS5qcyc7XG5leHBvcnQgeyB1IGFzIHVud3JhcCwgdyBhcyB3cmFwIH0gZnJvbSAnLi93cmFwLWlkYi12YWx1ZS5qcyc7XG5cbi8qKlxuICogT3BlbiBhIGRhdGFiYXNlLlxuICpcbiAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGRhdGFiYXNlLlxuICogQHBhcmFtIHZlcnNpb24gU2NoZW1hIHZlcnNpb24uXG4gKiBAcGFyYW0gY2FsbGJhY2tzIEFkZGl0aW9uYWwgY2FsbGJhY2tzLlxuICovXG5mdW5jdGlvbiBvcGVuREIobmFtZSwgdmVyc2lvbiwgeyBibG9ja2VkLCB1cGdyYWRlLCBibG9ja2luZywgdGVybWluYXRlZCB9ID0ge30pIHtcbiAgICBjb25zdCByZXF1ZXN0ID0gaW5kZXhlZERCLm9wZW4obmFtZSwgdmVyc2lvbik7XG4gICAgY29uc3Qgb3BlblByb21pc2UgPSB3cmFwKHJlcXVlc3QpO1xuICAgIGlmICh1cGdyYWRlKSB7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcigndXBncmFkZW5lZWRlZCcsIChldmVudCkgPT4ge1xuICAgICAgICAgICAgdXBncmFkZSh3cmFwKHJlcXVlc3QucmVzdWx0KSwgZXZlbnQub2xkVmVyc2lvbiwgZXZlbnQubmV3VmVyc2lvbiwgd3JhcChyZXF1ZXN0LnRyYW5zYWN0aW9uKSwgZXZlbnQpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGJsb2NrZWQpIHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKFxuICAgICAgICAvLyBDYXN0aW5nIGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQtRE9NLWxpYi1nZW5lcmF0b3IvcHVsbC8xNDA1XG4gICAgICAgIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50Lm5ld1ZlcnNpb24sIGV2ZW50KSk7XG4gICAgfVxuICAgIG9wZW5Qcm9taXNlXG4gICAgICAgIC50aGVuKChkYikgPT4ge1xuICAgICAgICBpZiAodGVybWluYXRlZClcbiAgICAgICAgICAgIGRiLmFkZEV2ZW50TGlzdGVuZXIoJ2Nsb3NlJywgKCkgPT4gdGVybWluYXRlZCgpKTtcbiAgICAgICAgaWYgKGJsb2NraW5nKSB7XG4gICAgICAgICAgICBkYi5hZGRFdmVudExpc3RlbmVyKCd2ZXJzaW9uY2hhbmdlJywgKGV2ZW50KSA9PiBibG9ja2luZyhldmVudC5vbGRWZXJzaW9uLCBldmVudC5uZXdWZXJzaW9uLCBldmVudCkpO1xuICAgICAgICB9XG4gICAgfSlcbiAgICAgICAgLmNhdGNoKCgpID0+IHsgfSk7XG4gICAgcmV0dXJuIG9wZW5Qcm9taXNlO1xufVxuLyoqXG4gKiBEZWxldGUgYSBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0gbmFtZSBOYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqL1xuZnVuY3Rpb24gZGVsZXRlREIobmFtZSwgeyBibG9ja2VkIH0gPSB7fSkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UobmFtZSk7XG4gICAgaWYgKGJsb2NrZWQpIHtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCdibG9ja2VkJywgKGV2ZW50KSA9PiBibG9ja2VkKFxuICAgICAgICAvLyBDYXN0aW5nIGR1ZSB0byBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQtRE9NLWxpYi1nZW5lcmF0b3IvcHVsbC8xNDA1XG4gICAgICAgIGV2ZW50Lm9sZFZlcnNpb24sIGV2ZW50KSk7XG4gICAgfVxuICAgIHJldHVybiB3cmFwKHJlcXVlc3QpLnRoZW4oKCkgPT4gdW5kZWZpbmVkKTtcbn1cblxuY29uc3QgcmVhZE1ldGhvZHMgPSBbJ2dldCcsICdnZXRLZXknLCAnZ2V0QWxsJywgJ2dldEFsbEtleXMnLCAnY291bnQnXTtcbmNvbnN0IHdyaXRlTWV0aG9kcyA9IFsncHV0JywgJ2FkZCcsICdkZWxldGUnLCAnY2xlYXInXTtcbmNvbnN0IGNhY2hlZE1ldGhvZHMgPSBuZXcgTWFwKCk7XG5mdW5jdGlvbiBnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB7XG4gICAgaWYgKCEodGFyZ2V0IGluc3RhbmNlb2YgSURCRGF0YWJhc2UgJiZcbiAgICAgICAgIShwcm9wIGluIHRhcmdldCkgJiZcbiAgICAgICAgdHlwZW9mIHByb3AgPT09ICdzdHJpbmcnKSkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjYWNoZWRNZXRob2RzLmdldChwcm9wKSlcbiAgICAgICAgcmV0dXJuIGNhY2hlZE1ldGhvZHMuZ2V0KHByb3ApO1xuICAgIGNvbnN0IHRhcmdldEZ1bmNOYW1lID0gcHJvcC5yZXBsYWNlKC9Gcm9tSW5kZXgkLywgJycpO1xuICAgIGNvbnN0IHVzZUluZGV4ID0gcHJvcCAhPT0gdGFyZ2V0RnVuY05hbWU7XG4gICAgY29uc3QgaXNXcml0ZSA9IHdyaXRlTWV0aG9kcy5pbmNsdWRlcyh0YXJnZXRGdW5jTmFtZSk7XG4gICAgaWYgKFxuICAgIC8vIEJhaWwgaWYgdGhlIHRhcmdldCBkb2Vzbid0IGV4aXN0IG9uIHRoZSB0YXJnZXQuIEVnLCBnZXRBbGwgaXNuJ3QgaW4gRWRnZS5cbiAgICAhKHRhcmdldEZ1bmNOYW1lIGluICh1c2VJbmRleCA/IElEQkluZGV4IDogSURCT2JqZWN0U3RvcmUpLnByb3RvdHlwZSkgfHxcbiAgICAgICAgIShpc1dyaXRlIHx8IHJlYWRNZXRob2RzLmluY2x1ZGVzKHRhcmdldEZ1bmNOYW1lKSkpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBtZXRob2QgPSBhc3luYyBmdW5jdGlvbiAoc3RvcmVOYW1lLCAuLi5hcmdzKSB7XG4gICAgICAgIC8vIGlzV3JpdGUgPyAncmVhZHdyaXRlJyA6IHVuZGVmaW5lZCBnemlwcHMgYmV0dGVyLCBidXQgZmFpbHMgaW4gRWRnZSA6KFxuICAgICAgICBjb25zdCB0eCA9IHRoaXMudHJhbnNhY3Rpb24oc3RvcmVOYW1lLCBpc1dyaXRlID8gJ3JlYWR3cml0ZScgOiAncmVhZG9ubHknKTtcbiAgICAgICAgbGV0IHRhcmdldCA9IHR4LnN0b3JlO1xuICAgICAgICBpZiAodXNlSW5kZXgpXG4gICAgICAgICAgICB0YXJnZXQgPSB0YXJnZXQuaW5kZXgoYXJncy5zaGlmdCgpKTtcbiAgICAgICAgLy8gTXVzdCByZWplY3QgaWYgb3AgcmVqZWN0cy5cbiAgICAgICAgLy8gSWYgaXQncyBhIHdyaXRlIG9wZXJhdGlvbiwgbXVzdCByZWplY3QgaWYgdHguZG9uZSByZWplY3RzLlxuICAgICAgICAvLyBNdXN0IHJlamVjdCB3aXRoIG9wIHJlamVjdGlvbiBmaXJzdC5cbiAgICAgICAgLy8gTXVzdCByZXNvbHZlIHdpdGggb3AgdmFsdWUuXG4gICAgICAgIC8vIE11c3QgaGFuZGxlIGJvdGggcHJvbWlzZXMgKG5vIHVuaGFuZGxlZCByZWplY3Rpb25zKVxuICAgICAgICByZXR1cm4gKGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgICAgICAgIHRhcmdldFt0YXJnZXRGdW5jTmFtZV0oLi4uYXJncyksXG4gICAgICAgICAgICBpc1dyaXRlICYmIHR4LmRvbmUsXG4gICAgICAgIF0pKVswXTtcbiAgICB9O1xuICAgIGNhY2hlZE1ldGhvZHMuc2V0KHByb3AsIG1ldGhvZCk7XG4gICAgcmV0dXJuIG1ldGhvZDtcbn1cbnJlcGxhY2VUcmFwcygob2xkVHJhcHMpID0+ICh7XG4gICAgLi4ub2xkVHJhcHMsXG4gICAgZ2V0OiAodGFyZ2V0LCBwcm9wLCByZWNlaXZlcikgPT4gZ2V0TWV0aG9kKHRhcmdldCwgcHJvcCkgfHwgb2xkVHJhcHMuZ2V0KHRhcmdldCwgcHJvcCwgcmVjZWl2ZXIpLFxuICAgIGhhczogKHRhcmdldCwgcHJvcCkgPT4gISFnZXRNZXRob2QodGFyZ2V0LCBwcm9wKSB8fCBvbGRUcmFwcy5oYXModGFyZ2V0LCBwcm9wKSxcbn0pKTtcblxuZXhwb3J0IHsgZGVsZXRlREIsIG9wZW5EQiB9O1xuIiwiaW1wb3J0IHsgQ29tcG9uZW50LCBDb21wb25lbnRDb250YWluZXIgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IExvZ2dlciwgc2V0VXNlckxvZ0hhbmRsZXIsIHNldExvZ0xldmVsIGFzIHNldExvZ0xldmVsJDEgfSBmcm9tICdAZmlyZWJhc2UvbG9nZ2VyJztcbmltcG9ydCB7IEVycm9yRmFjdG9yeSwgYmFzZTY0RGVjb2RlLCBnZXREZWZhdWx0QXBwQ29uZmlnLCBkZWVwRXF1YWwsIGlzQnJvd3NlciwgaXNXZWJXb3JrZXIsIEZpcmViYXNlRXJyb3IsIGJhc2U2NHVybEVuY29kZVdpdGhvdXRQYWRkaW5nLCBpc0luZGV4ZWREQkF2YWlsYWJsZSwgdmFsaWRhdGVJbmRleGVkREJPcGVuYWJsZSB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcbmV4cG9ydCB7IEZpcmViYXNlRXJyb3IgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBvcGVuREIgfSBmcm9tICdpZGInO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyKSB7XG4gICAgICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgIH1cbiAgICAvLyBJbiBpbml0aWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdpbGwgYmUgY2FsbGVkIGJ5IGluc3RhbGxhdGlvbnMgb25cbiAgICAvLyBhdXRoIHRva2VuIHJlZnJlc2gsIGFuZCBpbnN0YWxsYXRpb25zIHdpbGwgc2VuZCB0aGlzIHN0cmluZy5cbiAgICBnZXRQbGF0Zm9ybUluZm9TdHJpbmcoKSB7XG4gICAgICAgIGNvbnN0IHByb3ZpZGVycyA9IHRoaXMuY29udGFpbmVyLmdldFByb3ZpZGVycygpO1xuICAgICAgICAvLyBMb29wIHRocm91Z2ggcHJvdmlkZXJzIGFuZCBnZXQgbGlicmFyeS92ZXJzaW9uIHBhaXJzIGZyb20gYW55IHRoYXQgYXJlXG4gICAgICAgIC8vIHZlcnNpb24gY29tcG9uZW50cy5cbiAgICAgICAgcmV0dXJuIHByb3ZpZGVyc1xuICAgICAgICAgICAgLm1hcChwcm92aWRlciA9PiB7XG4gICAgICAgICAgICBpZiAoaXNWZXJzaW9uU2VydmljZVByb3ZpZGVyKHByb3ZpZGVyKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZpY2UgPSBwcm92aWRlci5nZXRJbW1lZGlhdGUoKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gYCR7c2VydmljZS5saWJyYXJ5fS8ke3NlcnZpY2UudmVyc2lvbn1gO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgICAgICAgICAuZmlsdGVyKGxvZ1N0cmluZyA9PiBsb2dTdHJpbmcpXG4gICAgICAgICAgICAuam9pbignICcpO1xuICAgIH1cbn1cbi8qKlxuICpcbiAqIEBwYXJhbSBwcm92aWRlciBjaGVjayBpZiB0aGlzIHByb3ZpZGVyIHByb3ZpZGVzIGEgVmVyc2lvblNlcnZpY2VcbiAqXG4gKiBOT1RFOiBVc2luZyBQcm92aWRlcjwnYXBwLXZlcnNpb24nPiBpcyBhIGhhY2sgdG8gaW5kaWNhdGUgdGhhdCB0aGUgcHJvdmlkZXJcbiAqIHByb3ZpZGVzIFZlcnNpb25TZXJ2aWNlLiBUaGUgcHJvdmlkZXIgaXMgbm90IG5lY2Vzc2FyaWx5IGEgJ2FwcC12ZXJzaW9uJ1xuICogcHJvdmlkZXIuXG4gKi9cbmZ1bmN0aW9uIGlzVmVyc2lvblNlcnZpY2VQcm92aWRlcihwcm92aWRlcikge1xuICAgIGNvbnN0IGNvbXBvbmVudCA9IHByb3ZpZGVyLmdldENvbXBvbmVudCgpO1xuICAgIHJldHVybiAoY29tcG9uZW50ID09PSBudWxsIHx8IGNvbXBvbmVudCA9PT0gdm9pZCAwID8gdm9pZCAwIDogY29tcG9uZW50LnR5cGUpID09PSBcIlZFUlNJT05cIiAvKiBDb21wb25lbnRUeXBlLlZFUlNJT04gKi87XG59XG5cbmNvbnN0IG5hbWUkcSA9IFwiQGZpcmViYXNlL2FwcFwiO1xuY29uc3QgdmVyc2lvbiQxID0gXCIwLjExLjRcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IGxvZ2dlciA9IG5ldyBMb2dnZXIoJ0BmaXJlYmFzZS9hcHAnKTtcblxuY29uc3QgbmFtZSRwID0gXCJAZmlyZWJhc2UvYXBwLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJG8gPSBcIkBmaXJlYmFzZS9hbmFseXRpY3MtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkbiA9IFwiQGZpcmViYXNlL2FuYWx5dGljc1wiO1xuXG5jb25zdCBuYW1lJG0gPSBcIkBmaXJlYmFzZS9hcHAtY2hlY2stY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkbCA9IFwiQGZpcmViYXNlL2FwcC1jaGVja1wiO1xuXG5jb25zdCBuYW1lJGsgPSBcIkBmaXJlYmFzZS9hdXRoXCI7XG5cbmNvbnN0IG5hbWUkaiA9IFwiQGZpcmViYXNlL2F1dGgtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkaSA9IFwiQGZpcmViYXNlL2RhdGFiYXNlXCI7XG5cbmNvbnN0IG5hbWUkaCA9IFwiQGZpcmViYXNlL2RhdGEtY29ubmVjdFwiO1xuXG5jb25zdCBuYW1lJGcgPSBcIkBmaXJlYmFzZS9kYXRhYmFzZS1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRmID0gXCJAZmlyZWJhc2UvZnVuY3Rpb25zXCI7XG5cbmNvbnN0IG5hbWUkZSA9IFwiQGZpcmViYXNlL2Z1bmN0aW9ucy1jb21wYXRcIjtcblxuY29uc3QgbmFtZSRkID0gXCJAZmlyZWJhc2UvaW5zdGFsbGF0aW9uc1wiO1xuXG5jb25zdCBuYW1lJGMgPSBcIkBmaXJlYmFzZS9pbnN0YWxsYXRpb25zLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJGIgPSBcIkBmaXJlYmFzZS9tZXNzYWdpbmdcIjtcblxuY29uc3QgbmFtZSRhID0gXCJAZmlyZWJhc2UvbWVzc2FnaW5nLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJDkgPSBcIkBmaXJlYmFzZS9wZXJmb3JtYW5jZVwiO1xuXG5jb25zdCBuYW1lJDggPSBcIkBmaXJlYmFzZS9wZXJmb3JtYW5jZS1jb21wYXRcIjtcblxuY29uc3QgbmFtZSQ3ID0gXCJAZmlyZWJhc2UvcmVtb3RlLWNvbmZpZ1wiO1xuXG5jb25zdCBuYW1lJDYgPSBcIkBmaXJlYmFzZS9yZW1vdGUtY29uZmlnLWNvbXBhdFwiO1xuXG5jb25zdCBuYW1lJDUgPSBcIkBmaXJlYmFzZS9zdG9yYWdlXCI7XG5cbmNvbnN0IG5hbWUkNCA9IFwiQGZpcmViYXNlL3N0b3JhZ2UtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUkMyA9IFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuXG5jb25zdCBuYW1lJDIgPSBcIkBmaXJlYmFzZS92ZXJ0ZXhhaVwiO1xuXG5jb25zdCBuYW1lJDEgPSBcIkBmaXJlYmFzZS9maXJlc3RvcmUtY29tcGF0XCI7XG5cbmNvbnN0IG5hbWUgPSBcImZpcmViYXNlXCI7XG5jb25zdCB2ZXJzaW9uID0gXCIxMS42LjBcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIGRlZmF1bHQgYXBwIG5hbWVcbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuY29uc3QgREVGQVVMVF9FTlRSWV9OQU1FID0gJ1tERUZBVUxUXSc7XG5jb25zdCBQTEFURk9STV9MT0dfU1RSSU5HID0ge1xuICAgIFtuYW1lJHFdOiAnZmlyZS1jb3JlJyxcbiAgICBbbmFtZSRwXTogJ2ZpcmUtY29yZS1jb21wYXQnLFxuICAgIFtuYW1lJG5dOiAnZmlyZS1hbmFseXRpY3MnLFxuICAgIFtuYW1lJG9dOiAnZmlyZS1hbmFseXRpY3MtY29tcGF0JyxcbiAgICBbbmFtZSRsXTogJ2ZpcmUtYXBwLWNoZWNrJyxcbiAgICBbbmFtZSRtXTogJ2ZpcmUtYXBwLWNoZWNrLWNvbXBhdCcsXG4gICAgW25hbWUka106ICdmaXJlLWF1dGgnLFxuICAgIFtuYW1lJGpdOiAnZmlyZS1hdXRoLWNvbXBhdCcsXG4gICAgW25hbWUkaV06ICdmaXJlLXJ0ZGInLFxuICAgIFtuYW1lJGhdOiAnZmlyZS1kYXRhLWNvbm5lY3QnLFxuICAgIFtuYW1lJGddOiAnZmlyZS1ydGRiLWNvbXBhdCcsXG4gICAgW25hbWUkZl06ICdmaXJlLWZuJyxcbiAgICBbbmFtZSRlXTogJ2ZpcmUtZm4tY29tcGF0JyxcbiAgICBbbmFtZSRkXTogJ2ZpcmUtaWlkJyxcbiAgICBbbmFtZSRjXTogJ2ZpcmUtaWlkLWNvbXBhdCcsXG4gICAgW25hbWUkYl06ICdmaXJlLWZjbScsXG4gICAgW25hbWUkYV06ICdmaXJlLWZjbS1jb21wYXQnLFxuICAgIFtuYW1lJDldOiAnZmlyZS1wZXJmJyxcbiAgICBbbmFtZSQ4XTogJ2ZpcmUtcGVyZi1jb21wYXQnLFxuICAgIFtuYW1lJDddOiAnZmlyZS1yYycsXG4gICAgW25hbWUkNl06ICdmaXJlLXJjLWNvbXBhdCcsXG4gICAgW25hbWUkNV06ICdmaXJlLWdjcycsXG4gICAgW25hbWUkNF06ICdmaXJlLWdjcy1jb21wYXQnLFxuICAgIFtuYW1lJDNdOiAnZmlyZS1mc3QnLFxuICAgIFtuYW1lJDFdOiAnZmlyZS1mc3QtY29tcGF0JyxcbiAgICBbbmFtZSQyXTogJ2ZpcmUtdmVydGV4JyxcbiAgICAnZmlyZS1qcyc6ICdmaXJlLWpzJywgLy8gUGxhdGZvcm0gaWRlbnRpZmllciBmb3IgSlMgU0RLLlxuICAgIFtuYW1lXTogJ2ZpcmUtanMtYWxsJ1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IF9hcHBzID0gbmV3IE1hcCgpO1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqL1xuY29uc3QgX3NlcnZlckFwcHMgPSBuZXcgTWFwKCk7XG4vKipcbiAqIFJlZ2lzdGVyZWQgY29tcG9uZW50cy5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmNvbnN0IF9jb21wb25lbnRzID0gbmV3IE1hcCgpO1xuLyoqXG4gKiBAcGFyYW0gY29tcG9uZW50IC0gdGhlIGNvbXBvbmVudCBiZWluZyBhZGRlZCB0byB0aGlzIGFwcCdzIGNvbnRhaW5lclxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBfYWRkQ29tcG9uZW50KGFwcCwgY29tcG9uZW50KSB7XG4gICAgdHJ5IHtcbiAgICAgICAgYXBwLmNvbnRhaW5lci5hZGRDb21wb25lbnQoY29tcG9uZW50KTtcbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGBDb21wb25lbnQgJHtjb21wb25lbnQubmFtZX0gZmFpbGVkIHRvIHJlZ2lzdGVyIHdpdGggRmlyZWJhc2VBcHAgJHthcHAubmFtZX1gLCBlKTtcbiAgICB9XG59XG4vKipcbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gX2FkZE9yT3ZlcndyaXRlQ29tcG9uZW50KGFwcCwgY29tcG9uZW50KSB7XG4gICAgYXBwLmNvbnRhaW5lci5hZGRPck92ZXJ3cml0ZUNvbXBvbmVudChjb21wb25lbnQpO1xufVxuLyoqXG4gKlxuICogQHBhcmFtIGNvbXBvbmVudCAtIHRoZSBjb21wb25lbnQgdG8gcmVnaXN0ZXJcbiAqIEByZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBjb21wb25lbnQgaXMgcmVnaXN0ZXJlZCBzdWNjZXNzZnVsbHlcbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gX3JlZ2lzdGVyQ29tcG9uZW50KGNvbXBvbmVudCkge1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBjb21wb25lbnQubmFtZTtcbiAgICBpZiAoX2NvbXBvbmVudHMuaGFzKGNvbXBvbmVudE5hbWUpKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgVGhlcmUgd2VyZSBtdWx0aXBsZSBhdHRlbXB0cyB0byByZWdpc3RlciBjb21wb25lbnQgJHtjb21wb25lbnROYW1lfS5gKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBfY29tcG9uZW50cy5zZXQoY29tcG9uZW50TmFtZSwgY29tcG9uZW50KTtcbiAgICAvLyBhZGQgdGhlIGNvbXBvbmVudCB0byBleGlzdGluZyBhcHAgaW5zdGFuY2VzXG4gICAgZm9yIChjb25zdCBhcHAgb2YgX2FwcHMudmFsdWVzKCkpIHtcbiAgICAgICAgX2FkZENvbXBvbmVudChhcHAsIGNvbXBvbmVudCk7XG4gICAgfVxuICAgIGZvciAoY29uc3Qgc2VydmVyQXBwIG9mIF9zZXJ2ZXJBcHBzLnZhbHVlcygpKSB7XG4gICAgICAgIF9hZGRDb21wb25lbnQoc2VydmVyQXBwLCBjb21wb25lbnQpO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbi8qKlxuICpcbiAqIEBwYXJhbSBhcHAgLSBGaXJlYmFzZUFwcCBpbnN0YW5jZVxuICogQHBhcmFtIG5hbWUgLSBzZXJ2aWNlIG5hbWVcbiAqXG4gKiBAcmV0dXJucyB0aGUgcHJvdmlkZXIgZm9yIHRoZSBzZXJ2aWNlIHdpdGggdGhlIG1hdGNoaW5nIG5hbWVcbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gX2dldFByb3ZpZGVyKGFwcCwgbmFtZSkge1xuICAgIGNvbnN0IGhlYXJ0YmVhdENvbnRyb2xsZXIgPSBhcHAuY29udGFpbmVyXG4gICAgICAgIC5nZXRQcm92aWRlcignaGVhcnRiZWF0JylcbiAgICAgICAgLmdldEltbWVkaWF0ZSh7IG9wdGlvbmFsOiB0cnVlIH0pO1xuICAgIGlmIChoZWFydGJlYXRDb250cm9sbGVyKSB7XG4gICAgICAgIHZvaWQgaGVhcnRiZWF0Q29udHJvbGxlci50cmlnZ2VySGVhcnRiZWF0KCk7XG4gICAgfVxuICAgIHJldHVybiBhcHAuY29udGFpbmVyLmdldFByb3ZpZGVyKG5hbWUpO1xufVxuLyoqXG4gKlxuICogQHBhcmFtIGFwcCAtIEZpcmViYXNlQXBwIGluc3RhbmNlXG4gKiBAcGFyYW0gbmFtZSAtIHNlcnZpY2UgbmFtZVxuICogQHBhcmFtIGluc3RhbmNlSWRlbnRpZmllciAtIHNlcnZpY2UgaW5zdGFuY2UgaWRlbnRpZmllciBpbiBjYXNlIHRoZSBzZXJ2aWNlIHN1cHBvcnRzIG11bHRpcGxlIGluc3RhbmNlc1xuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBfcmVtb3ZlU2VydmljZUluc3RhbmNlKGFwcCwgbmFtZSwgaW5zdGFuY2VJZGVudGlmaWVyID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XG4gICAgX2dldFByb3ZpZGVyKGFwcCwgbmFtZSkuY2xlYXJJbnN0YW5jZShpbnN0YW5jZUlkZW50aWZpZXIpO1xufVxuLyoqXG4gKlxuICogQHBhcmFtIG9iaiAtIGFuIG9iamVjdCBvZiB0eXBlIEZpcmViYXNlQXBwIG9yIEZpcmViYXNlT3B0aW9ucy5cbiAqXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlIG9iamVjdCBpcyBvZiB0eXBlIEZpcmViYXNlQXBwLlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBfaXNGaXJlYmFzZUFwcChvYmopIHtcbiAgICByZXR1cm4gb2JqLm9wdGlvbnMgIT09IHVuZGVmaW5lZDtcbn1cbi8qKlxuICpcbiAqIEBwYXJhbSBvYmogLSBhbiBvYmplY3Qgb2YgdHlwZSBGaXJlYmFzZUFwcC5cbiAqXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCBvYmplY3QgaXMgb2YgdHlwZSBGaXJlYmFzZVNlcnZlckFwcEltcGwuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIF9pc0ZpcmViYXNlU2VydmVyQXBwKG9iaikge1xuICAgIGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICByZXR1cm4gb2JqLnNldHRpbmdzICE9PSB1bmRlZmluZWQ7XG59XG4vKipcbiAqIFRlc3Qgb25seVxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5mdW5jdGlvbiBfY2xlYXJDb21wb25lbnRzKCkge1xuICAgIF9jb21wb25lbnRzLmNsZWFyKCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBFUlJPUlMgPSB7XG4gICAgW1wibm8tYXBwXCIgLyogQXBwRXJyb3IuTk9fQVBQICovXTogXCJObyBGaXJlYmFzZSBBcHAgJ3skYXBwTmFtZX0nIGhhcyBiZWVuIGNyZWF0ZWQgLSBcIiArXG4gICAgICAgICdjYWxsIGluaXRpYWxpemVBcHAoKSBmaXJzdCcsXG4gICAgW1wiYmFkLWFwcC1uYW1lXCIgLyogQXBwRXJyb3IuQkFEX0FQUF9OQU1FICovXTogXCJJbGxlZ2FsIEFwcCBuYW1lOiAneyRhcHBOYW1lfSdcIixcbiAgICBbXCJkdXBsaWNhdGUtYXBwXCIgLyogQXBwRXJyb3IuRFVQTElDQVRFX0FQUCAqL106IFwiRmlyZWJhc2UgQXBwIG5hbWVkICd7JGFwcE5hbWV9JyBhbHJlYWR5IGV4aXN0cyB3aXRoIGRpZmZlcmVudCBvcHRpb25zIG9yIGNvbmZpZ1wiLFxuICAgIFtcImFwcC1kZWxldGVkXCIgLyogQXBwRXJyb3IuQVBQX0RFTEVURUQgKi9dOiBcIkZpcmViYXNlIEFwcCBuYW1lZCAneyRhcHBOYW1lfScgYWxyZWFkeSBkZWxldGVkXCIsXG4gICAgW1wic2VydmVyLWFwcC1kZWxldGVkXCIgLyogQXBwRXJyb3IuU0VSVkVSX0FQUF9ERUxFVEVEICovXTogJ0ZpcmViYXNlIFNlcnZlciBBcHAgaGFzIGJlZW4gZGVsZXRlZCcsXG4gICAgW1wibm8tb3B0aW9uc1wiIC8qIEFwcEVycm9yLk5PX09QVElPTlMgKi9dOiAnTmVlZCB0byBwcm92aWRlIG9wdGlvbnMsIHdoZW4gbm90IGJlaW5nIGRlcGxveWVkIHRvIGhvc3RpbmcgdmlhIHNvdXJjZS4nLFxuICAgIFtcImludmFsaWQtYXBwLWFyZ3VtZW50XCIgLyogQXBwRXJyb3IuSU5WQUxJRF9BUFBfQVJHVU1FTlQgKi9dOiAnZmlyZWJhc2UueyRhcHBOYW1lfSgpIHRha2VzIGVpdGhlciBubyBhcmd1bWVudCBvciBhICcgK1xuICAgICAgICAnRmlyZWJhc2UgQXBwIGluc3RhbmNlLicsXG4gICAgW1wiaW52YWxpZC1sb2ctYXJndW1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX0xPR19BUkdVTUVOVCAqL106ICdGaXJzdCBhcmd1bWVudCB0byBgb25Mb2dgIG11c3QgYmUgbnVsbCBvciBhIGZ1bmN0aW9uLicsXG4gICAgW1wiaWRiLW9wZW5cIiAvKiBBcHBFcnJvci5JREJfT1BFTiAqL106ICdFcnJvciB0aHJvd24gd2hlbiBvcGVuaW5nIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXG4gICAgW1wiaWRiLWdldFwiIC8qIEFwcEVycm9yLklEQl9HRVQgKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gcmVhZGluZyBmcm9tIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXG4gICAgW1wiaWRiLXNldFwiIC8qIEFwcEVycm9yLklEQl9XUklURSAqL106ICdFcnJvciB0aHJvd24gd2hlbiB3cml0aW5nIHRvIEluZGV4ZWREQi4gT3JpZ2luYWwgZXJyb3I6IHskb3JpZ2luYWxFcnJvck1lc3NhZ2V9LicsXG4gICAgW1wiaWRiLWRlbGV0ZVwiIC8qIEFwcEVycm9yLklEQl9ERUxFVEUgKi9dOiAnRXJyb3IgdGhyb3duIHdoZW4gZGVsZXRpbmcgZnJvbSBJbmRleGVkREIuIE9yaWdpbmFsIGVycm9yOiB7JG9yaWdpbmFsRXJyb3JNZXNzYWdlfS4nLFxuICAgIFtcImZpbmFsaXphdGlvbi1yZWdpc3RyeS1ub3Qtc3VwcG9ydGVkXCIgLyogQXBwRXJyb3IuRklOQUxJWkFUSU9OX1JFR0lTVFJZX05PVF9TVVBQT1JURUQgKi9dOiAnRmlyZWJhc2VTZXJ2ZXJBcHAgZGVsZXRlT25EZXJlZiBmaWVsZCBkZWZpbmVkIGJ1dCB0aGUgSlMgcnVudGltZSBkb2VzIG5vdCBzdXBwb3J0IEZpbmFsaXphdGlvblJlZ2lzdHJ5LicsXG4gICAgW1wiaW52YWxpZC1zZXJ2ZXItYXBwLWVudmlyb25tZW50XCIgLyogQXBwRXJyb3IuSU5WQUxJRF9TRVJWRVJfQVBQX0VOVklST05NRU5UICovXTogJ0ZpcmViYXNlU2VydmVyQXBwIGlzIG5vdCBmb3IgdXNlIGluIGJyb3dzZXIgZW52aXJvbm1lbnRzLidcbn07XG5jb25zdCBFUlJPUl9GQUNUT1JZID0gbmV3IEVycm9yRmFjdG9yeSgnYXBwJywgJ0ZpcmViYXNlJywgRVJST1JTKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIEZpcmViYXNlQXBwSW1wbCB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucywgY29uZmlnLCBjb250YWluZXIpIHtcbiAgICAgICAgdGhpcy5faXNEZWxldGVkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuX29wdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5fY29uZmlnID0gT2JqZWN0LmFzc2lnbih7fSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy5fbmFtZSA9IGNvbmZpZy5uYW1lO1xuICAgICAgICB0aGlzLl9hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPVxuICAgICAgICAgICAgY29uZmlnLmF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDtcbiAgICAgICAgdGhpcy5fY29udGFpbmVyID0gY29udGFpbmVyO1xuICAgICAgICB0aGlzLmNvbnRhaW5lci5hZGRDb21wb25lbnQobmV3IENvbXBvbmVudCgnYXBwJywgKCkgPT4gdGhpcywgXCJQVUJMSUNcIiAvKiBDb21wb25lbnRUeXBlLlBVQkxJQyAqLykpO1xuICAgIH1cbiAgICBnZXQgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkKCkge1xuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQ7XG4gICAgfVxuICAgIHNldCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQodmFsKSB7XG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcbiAgICAgICAgdGhpcy5fYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkID0gdmFsO1xuICAgIH1cbiAgICBnZXQgbmFtZSgpIHtcbiAgICAgICAgdGhpcy5jaGVja0Rlc3Ryb3llZCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5fbmFtZTtcbiAgICB9XG4gICAgZ2V0IG9wdGlvbnMoKSB7XG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gICAgfVxuICAgIGdldCBjb25maWcoKSB7XG4gICAgICAgIHRoaXMuY2hlY2tEZXN0cm95ZWQoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbmZpZztcbiAgICB9XG4gICAgZ2V0IGNvbnRhaW5lcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NvbnRhaW5lcjtcbiAgICB9XG4gICAgZ2V0IGlzRGVsZXRlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2lzRGVsZXRlZDtcbiAgICB9XG4gICAgc2V0IGlzRGVsZXRlZCh2YWwpIHtcbiAgICAgICAgdGhpcy5faXNEZWxldGVkID0gdmFsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYW4gRXJyb3IgaWYgdGhlIEFwcCBoYXMgYWxyZWFkeSBiZWVuIGRlbGV0ZWQgLVxuICAgICAqIHVzZSBiZWZvcmUgcGVyZm9ybWluZyBBUEkgYWN0aW9ucyBvbiB0aGUgQXBwLlxuICAgICAqL1xuICAgIGNoZWNrRGVzdHJveWVkKCkge1xuICAgICAgICBpZiAodGhpcy5pc0RlbGV0ZWQpIHtcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiYXBwLWRlbGV0ZWRcIiAvKiBBcHBFcnJvci5BUFBfREVMRVRFRCAqLywgeyBhcHBOYW1lOiB0aGlzLl9uYW1lIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUGFyc2UgdGhlIHRva2VuIGFuZCBjaGVjayB0byBzZWUgaWYgdGhlIGBleHBgIGNsYWltIGlzIGluIHRoZSBmdXR1cmUuXG4vLyBSZXBvcnRzIGFuIGVycm9yIHRvIHRoZSBjb25zb2xlIGlmIHRoZSB0b2tlbiBvciBjbGFpbSBjb3VsZCBub3QgYmUgcGFyc2VkLCBvciBpZiBgZXhwYCBpcyBpblxuLy8gdGhlIHBhc3QuXG5mdW5jdGlvbiB2YWxpZGF0ZVRva2VuVFRMKGJhc2U2NFRva2VuLCB0b2tlbk5hbWUpIHtcbiAgICBjb25zdCBzZWNvbmRQYXJ0ID0gYmFzZTY0RGVjb2RlKGJhc2U2NFRva2VuLnNwbGl0KCcuJylbMV0pO1xuICAgIGlmIChzZWNvbmRQYXJ0ID09PSBudWxsKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYEZpcmViYXNlU2VydmVyQXBwICR7dG9rZW5OYW1lfSBpcyBpbnZhbGlkOiBzZWNvbmQgcGFydCBjb3VsZCBub3QgYmUgcGFyc2VkLmApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGV4cENsYWltID0gSlNPTi5wYXJzZShzZWNvbmRQYXJ0KS5leHA7XG4gICAgaWYgKGV4cENsYWltID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmlyZWJhc2VTZXJ2ZXJBcHAgJHt0b2tlbk5hbWV9IGlzIGludmFsaWQ6IGV4cGlyYXRpb24gY2xhaW0gY291bGQgbm90IGJlIHBhcnNlZGApO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGV4cCA9IEpTT04ucGFyc2Uoc2Vjb25kUGFydCkuZXhwICogMTAwMDtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICBjb25zdCBkaWZmID0gZXhwIC0gbm93O1xuICAgIGlmIChkaWZmIDw9IDApIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihgRmlyZWJhc2VTZXJ2ZXJBcHAgJHt0b2tlbk5hbWV9IGlzIGludmFsaWQ6IHRoZSB0b2tlbiBoYXMgZXhwaXJlZC5gKTtcbiAgICB9XG59XG5jbGFzcyBGaXJlYmFzZVNlcnZlckFwcEltcGwgZXh0ZW5kcyBGaXJlYmFzZUFwcEltcGwge1xuICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMsIHNlcnZlckNvbmZpZywgbmFtZSwgY29udGFpbmVyKSB7XG4gICAgICAgIC8vIEJ1aWxkIGNvbmZpZ3VyYXRpb24gcGFyYW1ldGVycyBmb3IgdGhlIEZpcmViYXNlQXBwSW1wbCBiYXNlIGNsYXNzLlxuICAgICAgICBjb25zdCBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPSBzZXJ2ZXJDb25maWcuYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgID8gc2VydmVyQ29uZmlnLmF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZFxuICAgICAgICAgICAgOiBmYWxzZTtcbiAgICAgICAgLy8gQ3JlYXRlIHRoZSBGaXJlYmFzZUFwcFNldHRpbmdzIG9iamVjdCBmb3IgdGhlIEZpcmViYXNlQXBwSW1wIGNvbnN0cnVjdG9yLlxuICAgICAgICBjb25zdCBjb25maWcgPSB7XG4gICAgICAgICAgICBuYW1lLFxuICAgICAgICAgICAgYXV0b21hdGljRGF0YUNvbGxlY3Rpb25FbmFibGVkXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvcHRpb25zLmFwaUtleSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAvLyBDb25zdHJ1Y3QgdGhlIHBhcmVudCBGaXJlYmFzZUFwcEltcCBvYmplY3QuXG4gICAgICAgICAgICBzdXBlcihvcHRpb25zLCBjb25maWcsIGNvbnRhaW5lcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBhcHBJbXBsID0gb3B0aW9ucztcbiAgICAgICAgICAgIHN1cGVyKGFwcEltcGwub3B0aW9ucywgY29uZmlnLCBjb250YWluZXIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIE5vdyBjb25zdHJ1Y3QgdGhlIGRhdGEgZm9yIHRoZSBGaXJlYmFzZVNlcnZlckFwcEltcGwuXG4gICAgICAgIHRoaXMuX3NlcnZlckNvbmZpZyA9IE9iamVjdC5hc3NpZ24oeyBhdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgfSwgc2VydmVyQ29uZmlnKTtcbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIGN1cnJlbnQgdGltZSBpcyB3aXRoaW4gdGhlIGBhdXRoSWR0b2tlbmAgd2luZG93IG9mIHZhbGlkaXR5LlxuICAgICAgICBpZiAodGhpcy5fc2VydmVyQ29uZmlnLmF1dGhJZFRva2VuKSB7XG4gICAgICAgICAgICB2YWxpZGF0ZVRva2VuVFRMKHRoaXMuX3NlcnZlckNvbmZpZy5hdXRoSWRUb2tlbiwgJ2F1dGhJZFRva2VuJyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRW5zdXJlIHRoYXQgdGhlIGN1cnJlbnQgdGltZSBpcyB3aXRoaW4gdGhlIGBhcHBDaGVja1Rva2VuYCB3aW5kb3cgb2YgdmFsaWRpdHkuXG4gICAgICAgIGlmICh0aGlzLl9zZXJ2ZXJDb25maWcuYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgdmFsaWRhdGVUb2tlblRUTCh0aGlzLl9zZXJ2ZXJDb25maWcuYXBwQ2hlY2tUb2tlbiwgJ2FwcENoZWNrVG9rZW4nKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9maW5hbGl6YXRpb25SZWdpc3RyeSA9IG51bGw7XG4gICAgICAgIGlmICh0eXBlb2YgRmluYWxpemF0aW9uUmVnaXN0cnkgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICB0aGlzLl9maW5hbGl6YXRpb25SZWdpc3RyeSA9IG5ldyBGaW5hbGl6YXRpb25SZWdpc3RyeSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRvbWF0aWNDbGVhbnVwKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZWZDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuaW5jUmVmQ291bnQodGhpcy5fc2VydmVyQ29uZmlnLnJlbGVhc2VPbkRlcmVmKTtcbiAgICAgICAgLy8gRG8gbm90IHJldGFpbiBhIGhhcmQgcmVmZXJlbmNlIHRvIHRoZSBkcmVmIG9iamVjdCwgb3RoZXJ3aXNlIHRoZSBGaW5hbGl6YXRpb25SZWdpc3RyeVxuICAgICAgICAvLyB3aWxsIG5ldmVyIHRyaWdnZXIuXG4gICAgICAgIHRoaXMuX3NlcnZlckNvbmZpZy5yZWxlYXNlT25EZXJlZiA9IHVuZGVmaW5lZDtcbiAgICAgICAgc2VydmVyQ29uZmlnLnJlbGVhc2VPbkRlcmVmID0gdW5kZWZpbmVkO1xuICAgICAgICByZWdpc3RlclZlcnNpb24obmFtZSRxLCB2ZXJzaW9uJDEsICdzZXJ2ZXJhcHAnKTtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICBnZXQgcmVmQ291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yZWZDb3VudDtcbiAgICB9XG4gICAgLy8gSW5jcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQgb2YgdGhpcyBzZXJ2ZXIgYXBwLiBJZiBhbiBvYmplY3QgaXMgcHJvdmlkZWQsIHJlZ2lzdGVyIGl0XG4gICAgLy8gd2l0aCB0aGUgZmluYWxpemF0aW9uIHJlZ2lzdHJ5LlxuICAgIGluY1JlZkNvdW50KG9iaikge1xuICAgICAgICBpZiAodGhpcy5pc0RlbGV0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9yZWZDb3VudCsrO1xuICAgICAgICBpZiAob2JqICE9PSB1bmRlZmluZWQgJiYgdGhpcy5fZmluYWxpemF0aW9uUmVnaXN0cnkgIT09IG51bGwpIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpbmFsaXphdGlvblJlZ2lzdHJ5LnJlZ2lzdGVyKG9iaiwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gRGVjcmVtZW50IHRoZSByZWZlcmVuY2UgY291bnQuXG4gICAgZGVjUmVmQ291bnQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkge1xuICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIC0tdGhpcy5fcmVmQ291bnQ7XG4gICAgfVxuICAgIC8vIEludm9rZWQgYnkgdGhlIEZpbmFsaXphdGlvblJlZ2lzdHJ5IGNhbGxiYWNrIHRvIG5vdGUgdGhhdCB0aGlzIGFwcCBzaG91bGQgZ28gdGhyb3VnaCBpdHNcbiAgICAvLyByZWZlcmVuY2UgY291bnRzIGFuZCBkZWxldGUgaXRzZWxmIGlmIG5vIHJlZmVyZW5jZSBjb3VudCByZW1haW4uIFRoZSBjb29yZGluYXRpbmcgbG9naWMgdGhhdFxuICAgIC8vIGhhbmRsZXMgdGhpcyBpcyBpbiBkZWxldGVBcHAoLi4uKS5cbiAgICBhdXRvbWF0aWNDbGVhbnVwKCkge1xuICAgICAgICB2b2lkIGRlbGV0ZUFwcCh0aGlzKTtcbiAgICB9XG4gICAgZ2V0IHNldHRpbmdzKCkge1xuICAgICAgICB0aGlzLmNoZWNrRGVzdHJveWVkKCk7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXJ2ZXJDb25maWc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgZnVuY3Rpb24gd2lsbCB0aHJvdyBhbiBFcnJvciBpZiB0aGUgQXBwIGhhcyBhbHJlYWR5IGJlZW4gZGVsZXRlZCAtXG4gICAgICogdXNlIGJlZm9yZSBwZXJmb3JtaW5nIEFQSSBhY3Rpb25zIG9uIHRoZSBBcHAuXG4gICAgICovXG4gICAgY2hlY2tEZXN0cm95ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRGVsZXRlZCkge1xuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJzZXJ2ZXItYXBwLWRlbGV0ZWRcIiAvKiBBcHBFcnJvci5TRVJWRVJfQVBQX0RFTEVURUQgKi8pO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgY3VycmVudCBTREsgdmVyc2lvbi5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNvbnN0IFNES19WRVJTSU9OID0gdmVyc2lvbjtcbmZ1bmN0aW9uIGluaXRpYWxpemVBcHAoX29wdGlvbnMsIHJhd0NvbmZpZyA9IHt9KSB7XG4gICAgbGV0IG9wdGlvbnMgPSBfb3B0aW9ucztcbiAgICBpZiAodHlwZW9mIHJhd0NvbmZpZyAhPT0gJ29iamVjdCcpIHtcbiAgICAgICAgY29uc3QgbmFtZSA9IHJhd0NvbmZpZztcbiAgICAgICAgcmF3Q29uZmlnID0geyBuYW1lIH07XG4gICAgfVxuICAgIGNvbnN0IGNvbmZpZyA9IE9iamVjdC5hc3NpZ24oeyBuYW1lOiBERUZBVUxUX0VOVFJZX05BTUUsIGF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZDogZmFsc2UgfSwgcmF3Q29uZmlnKTtcbiAgICBjb25zdCBuYW1lID0gY29uZmlnLm5hbWU7XG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSAnc3RyaW5nJyB8fCAhbmFtZSkge1xuICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImJhZC1hcHAtbmFtZVwiIC8qIEFwcEVycm9yLkJBRF9BUFBfTkFNRSAqLywge1xuICAgICAgICAgICAgYXBwTmFtZTogU3RyaW5nKG5hbWUpXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvcHRpb25zIHx8IChvcHRpb25zID0gZ2V0RGVmYXVsdEFwcENvbmZpZygpKTtcbiAgICBpZiAoIW9wdGlvbnMpIHtcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJuby1vcHRpb25zXCIgLyogQXBwRXJyb3IuTk9fT1BUSU9OUyAqLyk7XG4gICAgfVxuICAgIGNvbnN0IGV4aXN0aW5nQXBwID0gX2FwcHMuZ2V0KG5hbWUpO1xuICAgIGlmIChleGlzdGluZ0FwcCkge1xuICAgICAgICAvLyByZXR1cm4gdGhlIGV4aXN0aW5nIGFwcCBpZiBvcHRpb25zIGFuZCBjb25maWcgZGVlcCBlcXVhbCB0aGUgb25lcyBpbiB0aGUgZXhpc3RpbmcgYXBwLlxuICAgICAgICBpZiAoZGVlcEVxdWFsKG9wdGlvbnMsIGV4aXN0aW5nQXBwLm9wdGlvbnMpICYmXG4gICAgICAgICAgICBkZWVwRXF1YWwoY29uZmlnLCBleGlzdGluZ0FwcC5jb25maWcpKSB7XG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdBcHA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBFUlJPUl9GQUNUT1JZLmNyZWF0ZShcImR1cGxpY2F0ZS1hcHBcIiAvKiBBcHBFcnJvci5EVVBMSUNBVEVfQVBQICovLCB7IGFwcE5hbWU6IG5hbWUgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgY29udGFpbmVyID0gbmV3IENvbXBvbmVudENvbnRhaW5lcihuYW1lKTtcbiAgICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBfY29tcG9uZW50cy52YWx1ZXMoKSkge1xuICAgICAgICBjb250YWluZXIuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gICAgfVxuICAgIGNvbnN0IG5ld0FwcCA9IG5ldyBGaXJlYmFzZUFwcEltcGwob3B0aW9ucywgY29uZmlnLCBjb250YWluZXIpO1xuICAgIF9hcHBzLnNldChuYW1lLCBuZXdBcHApO1xuICAgIHJldHVybiBuZXdBcHA7XG59XG5mdW5jdGlvbiBpbml0aWFsaXplU2VydmVyQXBwKF9vcHRpb25zLCBfc2VydmVyQXBwQ29uZmlnKSB7XG4gICAgaWYgKGlzQnJvd3NlcigpICYmICFpc1dlYldvcmtlcigpKSB7XG4gICAgICAgIC8vIEZpcmViYXNlU2VydmVyQXBwIGlzbid0IGRlc2lnbmVkIHRvIGJlIHJ1biBpbiBicm93c2Vycy5cbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpbnZhbGlkLXNlcnZlci1hcHAtZW52aXJvbm1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX1NFUlZFUl9BUFBfRU5WSVJPTk1FTlQgKi8pO1xuICAgIH1cbiAgICBpZiAoX3NlcnZlckFwcENvbmZpZy5hdXRvbWF0aWNEYXRhQ29sbGVjdGlvbkVuYWJsZWQgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBfc2VydmVyQXBwQ29uZmlnLmF1dG9tYXRpY0RhdGFDb2xsZWN0aW9uRW5hYmxlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBsZXQgYXBwT3B0aW9ucztcbiAgICBpZiAoX2lzRmlyZWJhc2VBcHAoX29wdGlvbnMpKSB7XG4gICAgICAgIGFwcE9wdGlvbnMgPSBfb3B0aW9ucy5vcHRpb25zO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXBwT3B0aW9ucyA9IF9vcHRpb25zO1xuICAgIH1cbiAgICAvLyBCdWlsZCBhbiBhcHAgbmFtZSBiYXNlZCBvbiBhIGhhc2ggb2YgdGhlIGNvbmZpZ3VyYXRpb24gb3B0aW9ucy5cbiAgICBjb25zdCBuYW1lT2JqID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBfc2VydmVyQXBwQ29uZmlnKSwgYXBwT3B0aW9ucyk7XG4gICAgLy8gSG93ZXZlciwgRG8gbm90IG1hbmdsZSB0aGUgbmFtZSBiYXNlZCBvbiByZWxlYXNlT25EZXJlZiwgc2luY2UgaXQgd2lsbCB2YXJ5IGJldHdlZW4gdGhlXG4gICAgLy8gY29uc3RydWN0aW9uIG9mIEZpcmViYXNlU2VydmVyQXBwIGluc3RhbmNlcy4gRm9yIGV4YW1wbGUsIGlmIHRoZSBvYmplY3QgaXMgdGhlIHJlcXVlc3QgaGVhZGVycy5cbiAgICBpZiAobmFtZU9iai5yZWxlYXNlT25EZXJlZiAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGRlbGV0ZSBuYW1lT2JqLnJlbGVhc2VPbkRlcmVmO1xuICAgIH1cbiAgICBjb25zdCBoYXNoQ29kZSA9IChzKSA9PiB7XG4gICAgICAgIHJldHVybiBbLi4uc10ucmVkdWNlKChoYXNoLCBjKSA9PiAoTWF0aC5pbXVsKDMxLCBoYXNoKSArIGMuY2hhckNvZGVBdCgwKSkgfCAwLCAwKTtcbiAgICB9O1xuICAgIGlmIChfc2VydmVyQXBwQ29uZmlnLnJlbGVhc2VPbkRlcmVmICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBGaW5hbGl6YXRpb25SZWdpc3RyeSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiZmluYWxpemF0aW9uLXJlZ2lzdHJ5LW5vdC1zdXBwb3J0ZWRcIiAvKiBBcHBFcnJvci5GSU5BTElaQVRJT05fUkVHSVNUUllfTk9UX1NVUFBPUlRFRCAqLywge30pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG5hbWVTdHJpbmcgPSAnJyArIGhhc2hDb2RlKEpTT04uc3RyaW5naWZ5KG5hbWVPYmopKTtcbiAgICBjb25zdCBleGlzdGluZ0FwcCA9IF9zZXJ2ZXJBcHBzLmdldChuYW1lU3RyaW5nKTtcbiAgICBpZiAoZXhpc3RpbmdBcHApIHtcbiAgICAgICAgZXhpc3RpbmdBcHAuaW5jUmVmQ291bnQoX3NlcnZlckFwcENvbmZpZy5yZWxlYXNlT25EZXJlZik7XG4gICAgICAgIHJldHVybiBleGlzdGluZ0FwcDtcbiAgICB9XG4gICAgY29uc3QgY29udGFpbmVyID0gbmV3IENvbXBvbmVudENvbnRhaW5lcihuYW1lU3RyaW5nKTtcbiAgICBmb3IgKGNvbnN0IGNvbXBvbmVudCBvZiBfY29tcG9uZW50cy52YWx1ZXMoKSkge1xuICAgICAgICBjb250YWluZXIuYWRkQ29tcG9uZW50KGNvbXBvbmVudCk7XG4gICAgfVxuICAgIGNvbnN0IG5ld0FwcCA9IG5ldyBGaXJlYmFzZVNlcnZlckFwcEltcGwoYXBwT3B0aW9ucywgX3NlcnZlckFwcENvbmZpZywgbmFtZVN0cmluZywgY29udGFpbmVyKTtcbiAgICBfc2VydmVyQXBwcy5zZXQobmFtZVN0cmluZywgbmV3QXBwKTtcbiAgICByZXR1cm4gbmV3QXBwO1xufVxuLyoqXG4gKiBSZXRyaWV2ZXMgYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gaW5zdGFuY2UuXG4gKlxuICogV2hlbiBjYWxsZWQgd2l0aCBubyBhcmd1bWVudHMsIHRoZSBkZWZhdWx0IGFwcCBpcyByZXR1cm5lZC4gV2hlbiBhbiBhcHAgbmFtZVxuICogaXMgcHJvdmlkZWQsIHRoZSBhcHAgY29ycmVzcG9uZGluZyB0byB0aGF0IG5hbWUgaXMgcmV0dXJuZWQuXG4gKlxuICogQW4gZXhjZXB0aW9uIGlzIHRocm93biBpZiB0aGUgYXBwIGJlaW5nIHJldHJpZXZlZCBoYXMgbm90IHlldCBiZWVuXG4gKiBpbml0aWFsaXplZC5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogLy8gUmV0dXJuIHRoZSBkZWZhdWx0IGFwcFxuICogY29uc3QgYXBwID0gZ2V0QXBwKCk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogLy8gUmV0dXJuIGEgbmFtZWQgYXBwXG4gKiBjb25zdCBvdGhlckFwcCA9IGdldEFwcChcIm90aGVyQXBwXCIpO1xuICogYGBgXG4gKlxuICogQHBhcmFtIG5hbWUgLSBPcHRpb25hbCBuYW1lIG9mIHRoZSBhcHAgdG8gcmV0dXJuLiBJZiBubyBuYW1lIGlzXG4gKiAgIHByb3ZpZGVkLCB0aGUgZGVmYXVsdCBpcyBgXCJbREVGQVVMVF1cImAuXG4gKlxuICogQHJldHVybnMgVGhlIGFwcCBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm92aWRlZCBhcHAgbmFtZS5cbiAqICAgSWYgbm8gYXBwIG5hbWUgaXMgcHJvdmlkZWQsIHRoZSBkZWZhdWx0IGFwcCBpcyByZXR1cm5lZC5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIGdldEFwcChuYW1lID0gREVGQVVMVF9FTlRSWV9OQU1FKSB7XG4gICAgY29uc3QgYXBwID0gX2FwcHMuZ2V0KG5hbWUpO1xuICAgIGlmICghYXBwICYmIG5hbWUgPT09IERFRkFVTFRfRU5UUllfTkFNRSAmJiBnZXREZWZhdWx0QXBwQ29uZmlnKCkpIHtcbiAgICAgICAgcmV0dXJuIGluaXRpYWxpemVBcHAoKTtcbiAgICB9XG4gICAgaWYgKCFhcHApIHtcbiAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJuby1hcHBcIiAvKiBBcHBFcnJvci5OT19BUFAgKi8sIHsgYXBwTmFtZTogbmFtZSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGFwcDtcbn1cbi8qKlxuICogQSAocmVhZC1vbmx5KSBhcnJheSBvZiBhbGwgaW5pdGlhbGl6ZWQgYXBwcy5cbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gZ2V0QXBwcygpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShfYXBwcy52YWx1ZXMoKSk7XG59XG4vKipcbiAqIFJlbmRlcnMgdGhpcyBhcHAgdW51c2FibGUgYW5kIGZyZWVzIHRoZSByZXNvdXJjZXMgb2YgYWxsIGFzc29jaWF0ZWRcbiAqIHNlcnZpY2VzLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiBkZWxldGVBcHAoYXBwKVxuICogICAudGhlbihmdW5jdGlvbigpIHtcbiAqICAgICBjb25zb2xlLmxvZyhcIkFwcCBkZWxldGVkIHN1Y2Nlc3NmdWxseVwiKTtcbiAqICAgfSlcbiAqICAgLmNhdGNoKGZ1bmN0aW9uKGVycm9yKSB7XG4gKiAgICAgY29uc29sZS5sb2coXCJFcnJvciBkZWxldGluZyBhcHA6XCIsIGVycm9yKTtcbiAqICAgfSk7XG4gKiBgYGBcbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUFwcChhcHApIHtcbiAgICBsZXQgY2xlYW51cFByb3ZpZGVycyA9IGZhbHNlO1xuICAgIGNvbnN0IG5hbWUgPSBhcHAubmFtZTtcbiAgICBpZiAoX2FwcHMuaGFzKG5hbWUpKSB7XG4gICAgICAgIGNsZWFudXBQcm92aWRlcnMgPSB0cnVlO1xuICAgICAgICBfYXBwcy5kZWxldGUobmFtZSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKF9zZXJ2ZXJBcHBzLmhhcyhuYW1lKSkge1xuICAgICAgICBjb25zdCBmaXJlYmFzZVNlcnZlckFwcCA9IGFwcDtcbiAgICAgICAgaWYgKGZpcmViYXNlU2VydmVyQXBwLmRlY1JlZkNvdW50KCkgPD0gMCkge1xuICAgICAgICAgICAgX3NlcnZlckFwcHMuZGVsZXRlKG5hbWUpO1xuICAgICAgICAgICAgY2xlYW51cFByb3ZpZGVycyA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGNsZWFudXBQcm92aWRlcnMpIHtcbiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoYXBwLmNvbnRhaW5lclxuICAgICAgICAgICAgLmdldFByb3ZpZGVycygpXG4gICAgICAgICAgICAubWFwKHByb3ZpZGVyID0+IHByb3ZpZGVyLmRlbGV0ZSgpKSk7XG4gICAgICAgIGFwcC5pc0RlbGV0ZWQgPSB0cnVlO1xuICAgIH1cbn1cbi8qKlxuICogUmVnaXN0ZXJzIGEgbGlicmFyeSdzIG5hbWUgYW5kIHZlcnNpb24gZm9yIHBsYXRmb3JtIGxvZ2dpbmcgcHVycG9zZXMuXG4gKiBAcGFyYW0gbGlicmFyeSAtIE5hbWUgb2YgMXAgb3IgM3AgbGlicmFyeSAoZS5nLiBmaXJlc3RvcmUsIGFuZ3VsYXJmaXJlKVxuICogQHBhcmFtIHZlcnNpb24gLSBDdXJyZW50IHZlcnNpb24gb2YgdGhhdCBsaWJyYXJ5LlxuICogQHBhcmFtIHZhcmlhbnQgLSBCdW5kbGUgdmFyaWFudCwgZS5nLiwgbm9kZSwgcm4sIGV0Yy5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIHJlZ2lzdGVyVmVyc2lvbihsaWJyYXJ5S2V5T3JOYW1lLCB2ZXJzaW9uLCB2YXJpYW50KSB7XG4gICAgdmFyIF9hO1xuICAgIC8vIFRPRE86IFdlIGNhbiB1c2UgdGhpcyBjaGVjayB0byB3aGl0ZWxpc3Qgc3RyaW5ncyB3aGVuL2lmIHdlIHNldCB1cFxuICAgIC8vIGEgZ29vZCB3aGl0ZWxpc3Qgc3lzdGVtLlxuICAgIGxldCBsaWJyYXJ5ID0gKF9hID0gUExBVEZPUk1fTE9HX1NUUklOR1tsaWJyYXJ5S2V5T3JOYW1lXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbGlicmFyeUtleU9yTmFtZTtcbiAgICBpZiAodmFyaWFudCkge1xuICAgICAgICBsaWJyYXJ5ICs9IGAtJHt2YXJpYW50fWA7XG4gICAgfVxuICAgIGNvbnN0IGxpYnJhcnlNaXNtYXRjaCA9IGxpYnJhcnkubWF0Y2goL1xcc3xcXC8vKTtcbiAgICBjb25zdCB2ZXJzaW9uTWlzbWF0Y2ggPSB2ZXJzaW9uLm1hdGNoKC9cXHN8XFwvLyk7XG4gICAgaWYgKGxpYnJhcnlNaXNtYXRjaCB8fCB2ZXJzaW9uTWlzbWF0Y2gpIHtcbiAgICAgICAgY29uc3Qgd2FybmluZyA9IFtcbiAgICAgICAgICAgIGBVbmFibGUgdG8gcmVnaXN0ZXIgbGlicmFyeSBcIiR7bGlicmFyeX1cIiB3aXRoIHZlcnNpb24gXCIke3ZlcnNpb259XCI6YFxuICAgICAgICBdO1xuICAgICAgICBpZiAobGlicmFyeU1pc21hdGNoKSB7XG4gICAgICAgICAgICB3YXJuaW5nLnB1c2goYGxpYnJhcnkgbmFtZSBcIiR7bGlicmFyeX1cIiBjb250YWlucyBpbGxlZ2FsIGNoYXJhY3RlcnMgKHdoaXRlc3BhY2Ugb3IgXCIvXCIpYCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxpYnJhcnlNaXNtYXRjaCAmJiB2ZXJzaW9uTWlzbWF0Y2gpIHtcbiAgICAgICAgICAgIHdhcm5pbmcucHVzaCgnYW5kJyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZlcnNpb25NaXNtYXRjaCkge1xuICAgICAgICAgICAgd2FybmluZy5wdXNoKGB2ZXJzaW9uIG5hbWUgXCIke3ZlcnNpb259XCIgY29udGFpbnMgaWxsZWdhbCBjaGFyYWN0ZXJzICh3aGl0ZXNwYWNlIG9yIFwiL1wiKWApO1xuICAgICAgICB9XG4gICAgICAgIGxvZ2dlci53YXJuKHdhcm5pbmcuam9pbignICcpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudChgJHtsaWJyYXJ5fS12ZXJzaW9uYCwgKCkgPT4gKHsgbGlicmFyeSwgdmVyc2lvbiB9KSwgXCJWRVJTSU9OXCIgLyogQ29tcG9uZW50VHlwZS5WRVJTSU9OICovKSk7XG59XG4vKipcbiAqIFNldHMgbG9nIGhhbmRsZXIgZm9yIGFsbCBGaXJlYmFzZSBTREtzLlxuICogQHBhcmFtIGxvZ0NhbGxiYWNrIC0gQW4gb3B0aW9uYWwgY3VzdG9tIGxvZyBoYW5kbGVyIHRoYXQgZXhlY3V0ZXMgdXNlciBjb2RlIHdoZW5ldmVyXG4gKiB0aGUgRmlyZWJhc2UgU0RLIG1ha2VzIGEgbG9nZ2luZyBjYWxsLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gb25Mb2cobG9nQ2FsbGJhY2ssIG9wdGlvbnMpIHtcbiAgICBpZiAobG9nQ2FsbGJhY2sgIT09IG51bGwgJiYgdHlwZW9mIGxvZ0NhbGxiYWNrICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaW52YWxpZC1sb2ctYXJndW1lbnRcIiAvKiBBcHBFcnJvci5JTlZBTElEX0xPR19BUkdVTUVOVCAqLyk7XG4gICAgfVxuICAgIHNldFVzZXJMb2dIYW5kbGVyKGxvZ0NhbGxiYWNrLCBvcHRpb25zKTtcbn1cbi8qKlxuICogU2V0cyBsb2cgbGV2ZWwgZm9yIGFsbCBGaXJlYmFzZSBTREtzLlxuICpcbiAqIEFsbCBvZiB0aGUgbG9nIHR5cGVzIGFib3ZlIHRoZSBjdXJyZW50IGxvZyBsZXZlbCBhcmUgY2FwdHVyZWQgKGkuZS4gaWZcbiAqIHlvdSBzZXQgdGhlIGxvZyBsZXZlbCB0byBgaW5mb2AsIGVycm9ycyBhcmUgbG9nZ2VkLCBidXQgYGRlYnVnYCBhbmRcbiAqIGB2ZXJib3NlYCBsb2dzIGFyZSBub3QpLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gc2V0TG9nTGV2ZWwobG9nTGV2ZWwpIHtcbiAgICBzZXRMb2dMZXZlbCQxKGxvZ0xldmVsKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IERCX05BTUUgPSAnZmlyZWJhc2UtaGVhcnRiZWF0LWRhdGFiYXNlJztcbmNvbnN0IERCX1ZFUlNJT04gPSAxO1xuY29uc3QgU1RPUkVfTkFNRSA9ICdmaXJlYmFzZS1oZWFydGJlYXQtc3RvcmUnO1xubGV0IGRiUHJvbWlzZSA9IG51bGw7XG5mdW5jdGlvbiBnZXREYlByb21pc2UoKSB7XG4gICAgaWYgKCFkYlByb21pc2UpIHtcbiAgICAgICAgZGJQcm9taXNlID0gb3BlbkRCKERCX05BTUUsIERCX1ZFUlNJT04sIHtcbiAgICAgICAgICAgIHVwZ3JhZGU6IChkYiwgb2xkVmVyc2lvbikgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFdlIGRvbid0IHVzZSAnYnJlYWsnIGluIHRoaXMgc3dpdGNoIHN0YXRlbWVudCwgdGhlIGZhbGwtdGhyb3VnaFxuICAgICAgICAgICAgICAgIC8vIGJlaGF2aW9yIGlzIHdoYXQgd2Ugd2FudCwgYmVjYXVzZSBpZiB0aGVyZSBhcmUgbXVsdGlwbGUgdmVyc2lvbnMgYmV0d2VlblxuICAgICAgICAgICAgICAgIC8vIHRoZSBvbGQgdmVyc2lvbiBhbmQgdGhlIGN1cnJlbnQgdmVyc2lvbiwgd2Ugd2FudCBBTEwgdGhlIG1pZ3JhdGlvbnNcbiAgICAgICAgICAgICAgICAvLyB0aGF0IGNvcnJlc3BvbmQgdG8gdGhvc2UgdmVyc2lvbnMgdG8gcnVuLCBub3Qgb25seSB0aGUgbGFzdCBvbmUuXG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGRlZmF1bHQtY2FzZVxuICAgICAgICAgICAgICAgIHN3aXRjaCAob2xkVmVyc2lvbikge1xuICAgICAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRiLmNyZWF0ZU9iamVjdFN0b3JlKFNUT1JFX05BTUUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTYWZhcmkvaU9TIGJyb3dzZXJzIHRocm93IG9jY2FzaW9uYWwgZXhjZXB0aW9ucyBvblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRiLmNyZWF0ZU9iamVjdFN0b3JlKCkgdGhhdCBtYXkgYmUgYSBidWcuIEF2b2lkIGJsb2NraW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHJlc3Qgb2YgdGhlIGFwcCBmdW5jdGlvbmFsaXR5LlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgICAgdGhyb3cgRVJST1JfRkFDVE9SWS5jcmVhdGUoXCJpZGItb3BlblwiIC8qIEFwcEVycm9yLklEQl9PUEVOICovLCB7XG4gICAgICAgICAgICAgICAgb3JpZ2luYWxFcnJvck1lc3NhZ2U6IGUubWVzc2FnZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gZGJQcm9taXNlO1xufVxuYXN5bmMgZnVuY3Rpb24gcmVhZEhlYXJ0YmVhdHNGcm9tSW5kZXhlZERCKGFwcCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7XG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSk7XG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpLmdldChjb21wdXRlS2V5KGFwcCkpO1xuICAgICAgICAvLyBXZSBhbHJlYWR5IGhhdmUgdGhlIHZhbHVlIGJ1dCB0eC5kb25lIGNhbiB0aHJvdyxcbiAgICAgICAgLy8gc28gd2UgbmVlZCB0byBhd2FpdCBpdCBoZXJlIHRvIGNhdGNoIGVycm9yc1xuICAgICAgICBhd2FpdCB0eC5kb25lO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGUubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpZGJHZXRFcnJvciA9IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaWRiLWdldFwiIC8qIEFwcEVycm9yLklEQl9HRVQgKi8sIHtcbiAgICAgICAgICAgICAgICBvcmlnaW5hbEVycm9yTWVzc2FnZTogZSA9PT0gbnVsbCB8fCBlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBlLm1lc3NhZ2VcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oaWRiR2V0RXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiB3cml0ZUhlYXJ0YmVhdHNUb0luZGV4ZWREQihhcHAsIGhlYXJ0YmVhdE9iamVjdCkge1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRiID0gYXdhaXQgZ2V0RGJQcm9taXNlKCk7XG4gICAgICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oU1RPUkVfTkFNRSwgJ3JlYWR3cml0ZScpO1xuICAgICAgICBjb25zdCBvYmplY3RTdG9yZSA9IHR4Lm9iamVjdFN0b3JlKFNUT1JFX05BTUUpO1xuICAgICAgICBhd2FpdCBvYmplY3RTdG9yZS5wdXQoaGVhcnRiZWF0T2JqZWN0LCBjb21wdXRlS2V5KGFwcCkpO1xuICAgICAgICBhd2FpdCB0eC5kb25lO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEZpcmViYXNlRXJyb3IpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKGUubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpZGJHZXRFcnJvciA9IEVSUk9SX0ZBQ1RPUlkuY3JlYXRlKFwiaWRiLXNldFwiIC8qIEFwcEVycm9yLklEQl9XUklURSAqLywge1xuICAgICAgICAgICAgICAgIG9yaWdpbmFsRXJyb3JNZXNzYWdlOiBlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUubWVzc2FnZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBsb2dnZXIud2FybihpZGJHZXRFcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNvbXB1dGVLZXkoYXBwKSB7XG4gICAgcmV0dXJuIGAke2FwcC5uYW1lfSEke2FwcC5vcHRpb25zLmFwcElkfWA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBNQVhfSEVBREVSX0JZVEVTID0gMTAyNDtcbmNvbnN0IE1BWF9OVU1fU1RPUkVEX0hFQVJUQkVBVFMgPSAzMDtcbmNsYXNzIEhlYXJ0YmVhdFNlcnZpY2VJbXBsIHtcbiAgICBjb25zdHJ1Y3Rvcihjb250YWluZXIpIHtcbiAgICAgICAgdGhpcy5jb250YWluZXIgPSBjb250YWluZXI7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBJbi1tZW1vcnkgY2FjaGUgZm9yIGhlYXJ0YmVhdHMsIHVzZWQgYnkgZ2V0SGVhcnRiZWF0c0hlYWRlcigpIHRvIGdlbmVyYXRlXG4gICAgICAgICAqIHRoZSBoZWFkZXIgc3RyaW5nLlxuICAgICAgICAgKiBTdG9yZXMgb25lIHJlY29yZCBwZXIgZGF0ZS4gVGhpcyB3aWxsIGJlIGNvbnNvbGlkYXRlZCBpbnRvIHRoZSBzdGFuZGFyZFxuICAgICAgICAgKiBmb3JtYXQgb2Ygb25lIHJlY29yZCBwZXIgdXNlciBhZ2VudCBzdHJpbmcgYmVmb3JlIGJlaW5nIHNlbnQgYXMgYSBoZWFkZXIuXG4gICAgICAgICAqIFBvcHVsYXRlZCBmcm9tIGluZGV4ZWREQiB3aGVuIHRoZSBjb250cm9sbGVyIGlzIGluc3RhbnRpYXRlZCBhbmQgc2hvdWxkXG4gICAgICAgICAqIGJlIGtlcHQgaW4gc3luYyB3aXRoIGluZGV4ZWREQi5cbiAgICAgICAgICogTGVhdmUgcHVibGljIGZvciBlYXNpZXIgdGVzdGluZy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZSA9IG51bGw7XG4gICAgICAgIGNvbnN0IGFwcCA9IHRoaXMuY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTtcbiAgICAgICAgdGhpcy5fc3RvcmFnZSA9IG5ldyBIZWFydGJlYXRTdG9yYWdlSW1wbChhcHApO1xuICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGVQcm9taXNlID0gdGhpcy5fc3RvcmFnZS5yZWFkKCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gcmVzdWx0O1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbGxlZCB0byByZXBvcnQgYSBoZWFydGJlYXQuIFRoZSBmdW5jdGlvbiB3aWxsIGdlbmVyYXRlXG4gICAgICogYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgb2JqZWN0LCB1cGRhdGUgaGVhcnRiZWF0c0NhY2hlLCBhbmQgcGVyc2lzdCBpdFxuICAgICAqIHRvIEluZGV4ZWREQi5cbiAgICAgKiBOb3RlIHRoYXQgd2Ugb25seSBzdG9yZSBvbmUgaGVhcnRiZWF0IHBlciBkYXkuIFNvIGlmIGEgaGVhcnRiZWF0IGZvciB0b2RheSBpc1xuICAgICAqIGFscmVhZHkgbG9nZ2VkLCBzdWJzZXF1ZW50IGNhbGxzIHRvIHRoaXMgZnVuY3Rpb24gaW4gdGhlIHNhbWUgZGF5IHdpbGwgYmUgaWdub3JlZC5cbiAgICAgKi9cbiAgICBhc3luYyB0cmlnZ2VySGVhcnRiZWF0KCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcGxhdGZvcm1Mb2dnZXIgPSB0aGlzLmNvbnRhaW5lclxuICAgICAgICAgICAgICAgIC5nZXRQcm92aWRlcigncGxhdGZvcm0tbG9nZ2VyJylcbiAgICAgICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKCk7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBcIkZpcmViYXNlIHVzZXIgYWdlbnRcIiBzdHJpbmcgZnJvbSB0aGUgcGxhdGZvcm0gbG9nZ2VyXG4gICAgICAgICAgICAvLyBzZXJ2aWNlLCBub3QgdGhlIGJyb3dzZXIgdXNlciBhZ2VudC5cbiAgICAgICAgICAgIGNvbnN0IGFnZW50ID0gcGxhdGZvcm1Mb2dnZXIuZ2V0UGxhdGZvcm1JbmZvU3RyaW5nKCk7XG4gICAgICAgICAgICBjb25zdCBkYXRlID0gZ2V0VVRDRGF0ZVN0cmluZygpO1xuICAgICAgICAgICAgaWYgKCgoX2EgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5oZWFydGJlYXRzKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlID0gYXdhaXQgdGhpcy5faGVhcnRiZWF0c0NhY2hlUHJvbWlzZTtcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSBmYWlsZWQgdG8gY29uc3RydWN0IGEgaGVhcnRiZWF0cyBjYWNoZSwgdGhlbiByZXR1cm4gaW1tZWRpYXRlbHkuXG4gICAgICAgICAgICAgICAgaWYgKCgoX2IgPSB0aGlzLl9oZWFydGJlYXRzQ2FjaGUpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5oZWFydGJlYXRzKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBEbyBub3Qgc3RvcmUgYSBoZWFydGJlYXQgaWYgb25lIGlzIGFscmVhZHkgc3RvcmVkIGZvciB0aGlzIGRheVxuICAgICAgICAgICAgLy8gb3IgaWYgYSBoZWFkZXIgaGFzIGFscmVhZHkgYmVlbiBzZW50IHRvZGF5LlxuICAgICAgICAgICAgaWYgKHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5sYXN0U2VudEhlYXJ0YmVhdERhdGUgPT09IGRhdGUgfHxcbiAgICAgICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5zb21lKHNpbmdsZURhdGVIZWFydGJlYXQgPT4gc2luZ2xlRGF0ZUhlYXJ0YmVhdC5kYXRlID09PSBkYXRlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGlzIG5vIGVudHJ5IGZvciB0aGlzIGRhdGUuIENyZWF0ZSBvbmUuXG4gICAgICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMucHVzaCh7IGRhdGUsIGFnZW50IH0pO1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBudW1iZXIgb2Ygc3RvcmVkIGhlYXJ0YmVhdHMgZXhjZWVkcyB0aGUgbWF4aW11bSBudW1iZXIgb2Ygc3RvcmVkIGhlYXJ0YmVhdHMsIHJlbW92ZSB0aGUgaGVhcnRiZWF0IHdpdGggdGhlIGVhcmxpZXN0IGRhdGUuXG4gICAgICAgICAgICAgICAgLy8gU2luY2UgdGhpcyBpcyBleGVjdXRlZCBlYWNoIHRpbWUgYSBoZWFydGJlYXQgaXMgcHVzaGVkLCB0aGUgbGltaXQgY2FuIG9ubHkgYmUgZXhjZWVkZWQgYnkgb25lLCBzbyBvbmx5IG9uZSBuZWVkcyB0byBiZSByZW1vdmVkLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5sZW5ndGggPiBNQVhfTlVNX1NUT1JFRF9IRUFSVEJFQVRTKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGVhcmxpZXN0SGVhcnRiZWF0SWR4ID0gZ2V0RWFybGllc3RIZWFydGJlYXRJZHgodGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLl9oZWFydGJlYXRzQ2FjaGUuaGVhcnRiZWF0cy5zcGxpY2UoZWFybGllc3RIZWFydGJlYXRJZHgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9zdG9yYWdlLm92ZXJ3cml0ZSh0aGlzLl9oZWFydGJlYXRzQ2FjaGUpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybihlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgYmFzZTY0IGVuY29kZWQgc3RyaW5nIHdoaWNoIGNhbiBiZSBhdHRhY2hlZCB0byB0aGUgaGVhcnRiZWF0LXNwZWNpZmljIGhlYWRlciBkaXJlY3RseS5cbiAgICAgKiBJdCBhbHNvIGNsZWFycyBhbGwgaGVhcnRiZWF0cyBmcm9tIG1lbW9yeSBhcyB3ZWxsIGFzIGluIEluZGV4ZWREQi5cbiAgICAgKlxuICAgICAqIE5PVEU6IENvbnN1bWluZyBwcm9kdWN0IFNES3Mgc2hvdWxkIG5vdCBzZW5kIHRoZSBoZWFkZXIgaWYgdGhpcyBtZXRob2RcbiAgICAgKiByZXR1cm5zIGFuIGVtcHR5IHN0cmluZy5cbiAgICAgKi9cbiAgICBhc3luYyBnZXRIZWFydGJlYXRzSGVhZGVyKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAodGhpcy5faGVhcnRiZWF0c0NhY2hlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5faGVhcnRiZWF0c0NhY2hlUHJvbWlzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIGl0J3Mgc3RpbGwgbnVsbCBvciB0aGUgYXJyYXkgaXMgZW1wdHksIHRoZXJlIGlzIG5vIGRhdGEgdG8gc2VuZC5cbiAgICAgICAgICAgIGlmICgoKF9hID0gdGhpcy5faGVhcnRiZWF0c0NhY2hlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuaGVhcnRiZWF0cykgPT0gbnVsbCB8fFxuICAgICAgICAgICAgICAgIHRoaXMuX2hlYXJ0YmVhdHNDYWNoZS5oZWFydGJlYXRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiAnJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBnZXRVVENEYXRlU3RyaW5nKCk7XG4gICAgICAgICAgICAvLyBFeHRyYWN0IGFzIG1hbnkgaGVhcnRiZWF0cyBmcm9tIHRoZSBjYWNoZSBhcyB3aWxsIGZpdCB1bmRlciB0aGUgc2l6ZSBsaW1pdC5cbiAgICAgICAgICAgIGNvbnN0IHsgaGVhcnRiZWF0c1RvU2VuZCwgdW5zZW50RW50cmllcyB9ID0gZXh0cmFjdEhlYXJ0YmVhdHNGb3JIZWFkZXIodGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMpO1xuICAgICAgICAgICAgY29uc3QgaGVhZGVyU3RyaW5nID0gYmFzZTY0dXJsRW5jb2RlV2l0aG91dFBhZGRpbmcoSlNPTi5zdHJpbmdpZnkoeyB2ZXJzaW9uOiAyLCBoZWFydGJlYXRzOiBoZWFydGJlYXRzVG9TZW5kIH0pKTtcbiAgICAgICAgICAgIC8vIFN0b3JlIGxhc3Qgc2VudCBkYXRlIHRvIHByZXZlbnQgYW5vdGhlciBiZWluZyBsb2dnZWQvc2VudCBmb3IgdGhlIHNhbWUgZGF5LlxuICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmxhc3RTZW50SGVhcnRiZWF0RGF0ZSA9IGRhdGU7XG4gICAgICAgICAgICBpZiAodW5zZW50RW50cmllcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgLy8gU3RvcmUgYW55IHVuc2VudCBlbnRyaWVzIGlmIHRoZXkgZXhpc3QuXG4gICAgICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSB1bnNlbnRFbnRyaWVzO1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgc2VlbXMgbW9yZSBsaWtlbHkgdGhhbiBlbXB0eWluZyB0aGUgYXJyYXkgKGJlbG93KSB0byBsZWFkIHRvIHNvbWUgb2RkIHN0YXRlXG4gICAgICAgICAgICAgICAgLy8gc2luY2UgdGhlIGNhY2hlIGlzbid0IGVtcHR5IGFuZCB0aGlzIHdpbGwgYmUgY2FsbGVkIGFnYWluIG9uIHRoZSBuZXh0IHJlcXVlc3QsXG4gICAgICAgICAgICAgICAgLy8gYW5kIGlzIHByb2JhYmx5IHNhZmVzdCBpZiB3ZSBhd2FpdCBpdC5cbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLl9zdG9yYWdlLm92ZXJ3cml0ZSh0aGlzLl9oZWFydGJlYXRzQ2FjaGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5faGVhcnRiZWF0c0NhY2hlLmhlYXJ0YmVhdHMgPSBbXTtcbiAgICAgICAgICAgICAgICAvLyBEbyBub3Qgd2FpdCBmb3IgdGhpcywgdG8gcmVkdWNlIGxhdGVuY3kuXG4gICAgICAgICAgICAgICAgdm9pZCB0aGlzLl9zdG9yYWdlLm92ZXJ3cml0ZSh0aGlzLl9oZWFydGJlYXRzQ2FjaGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGhlYWRlclN0cmluZztcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oZSk7XG4gICAgICAgICAgICByZXR1cm4gJyc7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBnZXRVVENEYXRlU3RyaW5nKCkge1xuICAgIGNvbnN0IHRvZGF5ID0gbmV3IERhdGUoKTtcbiAgICAvLyBSZXR1cm5zIGRhdGUgZm9ybWF0ICdZWVlZLU1NLUREJ1xuICAgIHJldHVybiB0b2RheS50b0lTT1N0cmluZygpLnN1YnN0cmluZygwLCAxMCk7XG59XG5mdW5jdGlvbiBleHRyYWN0SGVhcnRiZWF0c0ZvckhlYWRlcihoZWFydGJlYXRzQ2FjaGUsIG1heFNpemUgPSBNQVhfSEVBREVSX0JZVEVTKSB7XG4gICAgLy8gSGVhcnRiZWF0cyBncm91cGVkIGJ5IHVzZXIgYWdlbnQgaW4gdGhlIHN0YW5kYXJkIGZvcm1hdCB0byBiZSBzZW50IGluXG4gICAgLy8gdGhlIGhlYWRlci5cbiAgICBjb25zdCBoZWFydGJlYXRzVG9TZW5kID0gW107XG4gICAgLy8gU2luZ2xlIGRhdGUgZm9ybWF0IGhlYXJ0YmVhdHMgdGhhdCBhcmUgbm90IHNlbnQuXG4gICAgbGV0IHVuc2VudEVudHJpZXMgPSBoZWFydGJlYXRzQ2FjaGUuc2xpY2UoKTtcbiAgICBmb3IgKGNvbnN0IHNpbmdsZURhdGVIZWFydGJlYXQgb2YgaGVhcnRiZWF0c0NhY2hlKSB7XG4gICAgICAgIC8vIExvb2sgZm9yIGFuIGV4aXN0aW5nIGVudHJ5IHdpdGggdGhlIHNhbWUgdXNlciBhZ2VudC5cbiAgICAgICAgY29uc3QgaGVhcnRiZWF0RW50cnkgPSBoZWFydGJlYXRzVG9TZW5kLmZpbmQoaGIgPT4gaGIuYWdlbnQgPT09IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQpO1xuICAgICAgICBpZiAoIWhlYXJ0YmVhdEVudHJ5KSB7XG4gICAgICAgICAgICAvLyBJZiBubyBlbnRyeSBmb3IgdGhpcyB1c2VyIGFnZW50IGV4aXN0cywgY3JlYXRlIG9uZS5cbiAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucHVzaCh7XG4gICAgICAgICAgICAgICAgYWdlbnQ6IHNpbmdsZURhdGVIZWFydGJlYXQuYWdlbnQsXG4gICAgICAgICAgICAgICAgZGF0ZXM6IFtzaW5nbGVEYXRlSGVhcnRiZWF0LmRhdGVdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkge1xuICAgICAgICAgICAgICAgIC8vIElmIHRoZSBoZWFkZXIgd291bGQgZXhjZWVkIG1heCBzaXplLCByZW1vdmUgdGhlIGFkZGVkIGhlYXJ0YmVhdFxuICAgICAgICAgICAgICAgIC8vIGVudHJ5IGFuZCBzdG9wIGFkZGluZyB0byB0aGUgaGVhZGVyLlxuICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQucG9wKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBoZWFydGJlYXRFbnRyeS5kYXRlcy5wdXNoKHNpbmdsZURhdGVIZWFydGJlYXQuZGF0ZSk7XG4gICAgICAgICAgICAvLyBJZiB0aGUgaGVhZGVyIHdvdWxkIGV4Y2VlZCBtYXggc2l6ZSwgcmVtb3ZlIHRoZSBhZGRlZCBkYXRlXG4gICAgICAgICAgICAvLyBhbmQgc3RvcCBhZGRpbmcgdG8gdGhlIGhlYWRlci5cbiAgICAgICAgICAgIGlmIChjb3VudEJ5dGVzKGhlYXJ0YmVhdHNUb1NlbmQpID4gbWF4U2l6ZSkge1xuICAgICAgICAgICAgICAgIGhlYXJ0YmVhdEVudHJ5LmRhdGVzLnBvcCgpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFBvcCB1bnNlbnQgZW50cnkgZnJvbSBxdWV1ZS4gKFNraXBwZWQgaWYgYWRkaW5nIHRoZSBlbnRyeSBleGNlZWRlZFxuICAgICAgICAvLyBxdW90YSBhbmQgdGhlIGxvb3AgYnJlYWtzIGVhcmx5LilcbiAgICAgICAgdW5zZW50RW50cmllcyA9IHVuc2VudEVudHJpZXMuc2xpY2UoMSk7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIGhlYXJ0YmVhdHNUb1NlbmQsXG4gICAgICAgIHVuc2VudEVudHJpZXNcbiAgICB9O1xufVxuY2xhc3MgSGVhcnRiZWF0U3RvcmFnZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGFwcCkge1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZSA9IHRoaXMucnVuSW5kZXhlZERCRW52aXJvbm1lbnRDaGVjaygpO1xuICAgIH1cbiAgICBhc3luYyBydW5JbmRleGVkREJFbnZpcm9ubWVudENoZWNrKCkge1xuICAgICAgICBpZiAoIWlzSW5kZXhlZERCQXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB2YWxpZGF0ZUluZGV4ZWREQk9wZW5hYmxlKClcbiAgICAgICAgICAgICAgICAudGhlbigoKSA9PiB0cnVlKVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoKSA9PiBmYWxzZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZCBhbGwgaGVhcnRiZWF0cy5cbiAgICAgKi9cbiAgICBhc3luYyByZWFkKCkge1xuICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xuICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikge1xuICAgICAgICAgICAgcmV0dXJuIHsgaGVhcnRiZWF0czogW10gfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGlkYkhlYXJ0YmVhdE9iamVjdCA9IGF3YWl0IHJlYWRIZWFydGJlYXRzRnJvbUluZGV4ZWREQih0aGlzLmFwcCk7XG4gICAgICAgICAgICBpZiAoaWRiSGVhcnRiZWF0T2JqZWN0ID09PSBudWxsIHx8IGlkYkhlYXJ0YmVhdE9iamVjdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWRiSGVhcnRiZWF0T2JqZWN0LmhlYXJ0YmVhdHMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gaWRiSGVhcnRiZWF0T2JqZWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHsgaGVhcnRiZWF0czogW10gfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvLyBvdmVyd3JpdGUgdGhlIHN0b3JhZ2Ugd2l0aCB0aGUgcHJvdmlkZWQgaGVhcnRiZWF0c1xuICAgIGFzeW5jIG92ZXJ3cml0ZShoZWFydGJlYXRzT2JqZWN0KSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgY2FuVXNlSW5kZXhlZERCID0gYXdhaXQgdGhpcy5fY2FuVXNlSW5kZXhlZERCUHJvbWlzZTtcbiAgICAgICAgaWYgKCFjYW5Vc2VJbmRleGVkREIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nSGVhcnRiZWF0c09iamVjdCA9IGF3YWl0IHRoaXMucmVhZCgpO1xuICAgICAgICAgICAgcmV0dXJuIHdyaXRlSGVhcnRiZWF0c1RvSW5kZXhlZERCKHRoaXMuYXBwLCB7XG4gICAgICAgICAgICAgICAgbGFzdFNlbnRIZWFydGJlYXREYXRlOiAoX2EgPSBoZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0Lmxhc3RTZW50SGVhcnRiZWF0RGF0ZSxcbiAgICAgICAgICAgICAgICBoZWFydGJlYXRzOiBoZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHNcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIGFkZCBoZWFydGJlYXRzXG4gICAgYXN5bmMgYWRkKGhlYXJ0YmVhdHNPYmplY3QpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBjYW5Vc2VJbmRleGVkREIgPSBhd2FpdCB0aGlzLl9jYW5Vc2VJbmRleGVkREJQcm9taXNlO1xuICAgICAgICBpZiAoIWNhblVzZUluZGV4ZWREQikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0ID0gYXdhaXQgdGhpcy5yZWFkKCk7XG4gICAgICAgICAgICByZXR1cm4gd3JpdGVIZWFydGJlYXRzVG9JbmRleGVkREIodGhpcy5hcHAsIHtcbiAgICAgICAgICAgICAgICBsYXN0U2VudEhlYXJ0YmVhdERhdGU6IChfYSA9IGhlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiBleGlzdGluZ0hlYXJ0YmVhdHNPYmplY3QubGFzdFNlbnRIZWFydGJlYXREYXRlLFxuICAgICAgICAgICAgICAgIGhlYXJ0YmVhdHM6IFtcbiAgICAgICAgICAgICAgICAgICAgLi4uZXhpc3RpbmdIZWFydGJlYXRzT2JqZWN0LmhlYXJ0YmVhdHMsXG4gICAgICAgICAgICAgICAgICAgIC4uLmhlYXJ0YmVhdHNPYmplY3QuaGVhcnRiZWF0c1xuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBDYWxjdWxhdGUgYnl0ZXMgb2YgYSBIZWFydGJlYXRzQnlVc2VyQWdlbnQgYXJyYXkgYWZ0ZXIgYmVpbmcgd3JhcHBlZFxuICogaW4gYSBwbGF0Zm9ybSBsb2dnaW5nIGhlYWRlciBKU09OIG9iamVjdCwgc3RyaW5naWZpZWQsIGFuZCBjb252ZXJ0ZWRcbiAqIHRvIGJhc2UgNjQuXG4gKi9cbmZ1bmN0aW9uIGNvdW50Qnl0ZXMoaGVhcnRiZWF0c0NhY2hlKSB7XG4gICAgLy8gYmFzZTY0IGhhcyBhIHJlc3RyaWN0ZWQgc2V0IG9mIGNoYXJhY3RlcnMsIGFsbCBvZiB3aGljaCBzaG91bGQgYmUgMSBieXRlLlxuICAgIHJldHVybiBiYXNlNjR1cmxFbmNvZGVXaXRob3V0UGFkZGluZyhcbiAgICAvLyBoZWFydGJlYXRzQ2FjaGUgd3JhcHBlciBwcm9wZXJ0aWVzXG4gICAgSlNPTi5zdHJpbmdpZnkoeyB2ZXJzaW9uOiAyLCBoZWFydGJlYXRzOiBoZWFydGJlYXRzQ2FjaGUgfSkpLmxlbmd0aDtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIGhlYXJ0YmVhdCB3aXRoIHRoZSBlYXJsaWVzdCBkYXRlLlxuICogSWYgdGhlIGhlYXJ0YmVhdHMgYXJyYXkgaXMgZW1wdHksIC0xIGlzIHJldHVybmVkLlxuICovXG5mdW5jdGlvbiBnZXRFYXJsaWVzdEhlYXJ0YmVhdElkeChoZWFydGJlYXRzKSB7XG4gICAgaWYgKGhlYXJ0YmVhdHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgbGV0IGVhcmxpZXN0SGVhcnRiZWF0SWR4ID0gMDtcbiAgICBsZXQgZWFybGllc3RIZWFydGJlYXREYXRlID0gaGVhcnRiZWF0c1swXS5kYXRlO1xuICAgIGZvciAobGV0IGkgPSAxOyBpIDwgaGVhcnRiZWF0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaGVhcnRiZWF0c1tpXS5kYXRlIDwgZWFybGllc3RIZWFydGJlYXREYXRlKSB7XG4gICAgICAgICAgICBlYXJsaWVzdEhlYXJ0YmVhdERhdGUgPSBoZWFydGJlYXRzW2ldLmRhdGU7XG4gICAgICAgICAgICBlYXJsaWVzdEhlYXJ0YmVhdElkeCA9IGk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGVhcmxpZXN0SGVhcnRiZWF0SWR4O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gcmVnaXN0ZXJDb3JlQ29tcG9uZW50cyh2YXJpYW50KSB7XG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoJ3BsYXRmb3JtLWxvZ2dlcicsIGNvbnRhaW5lciA9PiBuZXcgUGxhdGZvcm1Mb2dnZXJTZXJ2aWNlSW1wbChjb250YWluZXIpLCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTtcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgnaGVhcnRiZWF0JywgY29udGFpbmVyID0+IG5ldyBIZWFydGJlYXRTZXJ2aWNlSW1wbChjb250YWluZXIpLCBcIlBSSVZBVEVcIiAvKiBDb21wb25lbnRUeXBlLlBSSVZBVEUgKi8pKTtcbiAgICAvLyBSZWdpc3RlciBgYXBwYCBwYWNrYWdlLlxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lJHEsIHZlcnNpb24kMSwgdmFyaWFudCk7XG4gICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtMjAxNywgY2pzMjAxNywgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cbiAgICByZWdpc3RlclZlcnNpb24obmFtZSRxLCB2ZXJzaW9uJDEsICdlc20yMDE3Jyk7XG4gICAgLy8gUmVnaXN0ZXIgcGxhdGZvcm0gU0RLIGlkZW50aWZpZXIgKG5vIHZlcnNpb24pLlxuICAgIHJlZ2lzdGVyVmVyc2lvbignZmlyZS1qcycsICcnKTtcbn1cblxuLyoqXG4gKiBGaXJlYmFzZSBBcHBcbiAqXG4gKiBAcmVtYXJrcyBUaGlzIHBhY2thZ2UgY29vcmRpbmF0ZXMgdGhlIGNvbW11bmljYXRpb24gYmV0d2VlbiB0aGUgZGlmZmVyZW50IEZpcmViYXNlIGNvbXBvbmVudHNcbiAqIEBwYWNrYWdlRG9jdW1lbnRhdGlvblxuICovXG5yZWdpc3RlckNvcmVDb21wb25lbnRzKCcnKTtcblxuZXhwb3J0IHsgU0RLX1ZFUlNJT04sIERFRkFVTFRfRU5UUllfTkFNRSBhcyBfREVGQVVMVF9FTlRSWV9OQU1FLCBfYWRkQ29tcG9uZW50LCBfYWRkT3JPdmVyd3JpdGVDb21wb25lbnQsIF9hcHBzLCBfY2xlYXJDb21wb25lbnRzLCBfY29tcG9uZW50cywgX2dldFByb3ZpZGVyLCBfaXNGaXJlYmFzZUFwcCwgX2lzRmlyZWJhc2VTZXJ2ZXJBcHAsIF9yZWdpc3RlckNvbXBvbmVudCwgX3JlbW92ZVNlcnZpY2VJbnN0YW5jZSwgX3NlcnZlckFwcHMsIGRlbGV0ZUFwcCwgZ2V0QXBwLCBnZXRBcHBzLCBpbml0aWFsaXplQXBwLCBpbml0aWFsaXplU2VydmVyQXBwLCBvbkxvZywgcmVnaXN0ZXJWZXJzaW9uLCBzZXRMb2dMZXZlbCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguZXNtMjAxNy5qcy5tYXBcbiIsImltcG9ydCB7IHJlZ2lzdGVyVmVyc2lvbiB9IGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuZXhwb3J0ICogZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5cbnZhciBuYW1lID0gXCJmaXJlYmFzZVwiO1xudmFyIHZlcnNpb24gPSBcIjExLjYuMFwiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xucmVnaXN0ZXJWZXJzaW9uKG5hbWUsIHZlcnNpb24sICdhcHAnKTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbS5qcy5tYXBcbiIsIi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbkNvcHlyaWdodCAoYykgTWljcm9zb2Z0IENvcnBvcmF0aW9uLlxuXG5QZXJtaXNzaW9uIHRvIHVzZSwgY29weSwgbW9kaWZ5LCBhbmQvb3IgZGlzdHJpYnV0ZSB0aGlzIHNvZnR3YXJlIGZvciBhbnlcbnB1cnBvc2Ugd2l0aCBvciB3aXRob3V0IGZlZSBpcyBoZXJlYnkgZ3JhbnRlZC5cblxuVEhFIFNPRlRXQVJFIElTIFBST1ZJREVEIFwiQVMgSVNcIiBBTkQgVEhFIEFVVEhPUiBESVNDTEFJTVMgQUxMIFdBUlJBTlRJRVMgV0lUSFxuUkVHQVJEIFRPIFRISVMgU09GVFdBUkUgSU5DTFVESU5HIEFMTCBJTVBMSUVEIFdBUlJBTlRJRVMgT0YgTUVSQ0hBTlRBQklMSVRZXG5BTkQgRklUTkVTUy4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFIEFVVEhPUiBCRSBMSUFCTEUgRk9SIEFOWSBTUEVDSUFMLCBESVJFQ1QsXG5JTkRJUkVDVCwgT1IgQ09OU0VRVUVOVElBTCBEQU1BR0VTIE9SIEFOWSBEQU1BR0VTIFdIQVRTT0VWRVIgUkVTVUxUSU5HIEZST01cbkxPU1MgT0YgVVNFLCBEQVRBIE9SIFBST0ZJVFMsIFdIRVRIRVIgSU4gQU4gQUNUSU9OIE9GIENPTlRSQUNULCBORUdMSUdFTkNFIE9SXG5PVEhFUiBUT1JUSU9VUyBBQ1RJT04sIEFSSVNJTkcgT1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgVVNFIE9SXG5QRVJGT1JNQU5DRSBPRiBUSElTIFNPRlRXQVJFLlxuKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiogKi9cbi8qIGdsb2JhbCBSZWZsZWN0LCBQcm9taXNlLCBTdXBwcmVzc2VkRXJyb3IsIFN5bWJvbCwgSXRlcmF0b3IgKi9cblxudmFyIGV4dGVuZFN0YXRpY3MgPSBmdW5jdGlvbihkLCBiKSB7XG4gIGV4dGVuZFN0YXRpY3MgPSBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHxcbiAgICAgICh7IF9fcHJvdG9fXzogW10gfSBpbnN0YW5jZW9mIEFycmF5ICYmIGZ1bmN0aW9uIChkLCBiKSB7IGQuX19wcm90b19fID0gYjsgfSkgfHxcbiAgICAgIGZ1bmN0aW9uIChkLCBiKSB7IGZvciAodmFyIHAgaW4gYikgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChiLCBwKSkgZFtwXSA9IGJbcF07IH07XG4gIHJldHVybiBleHRlbmRTdGF0aWNzKGQsIGIpO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIF9fZXh0ZW5kcyhkLCBiKSB7XG4gIGlmICh0eXBlb2YgYiAhPT0gXCJmdW5jdGlvblwiICYmIGIgIT09IG51bGwpXG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2xhc3MgZXh0ZW5kcyB2YWx1ZSBcIiArIFN0cmluZyhiKSArIFwiIGlzIG5vdCBhIGNvbnN0cnVjdG9yIG9yIG51bGxcIik7XG4gIGV4dGVuZFN0YXRpY3MoZCwgYik7XG4gIGZ1bmN0aW9uIF9fKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gZDsgfVxuICBkLnByb3RvdHlwZSA9IGIgPT09IG51bGwgPyBPYmplY3QuY3JlYXRlKGIpIDogKF9fLnByb3RvdHlwZSA9IGIucHJvdG90eXBlLCBuZXcgX18oKSk7XG59XG5cbmV4cG9ydCB2YXIgX19hc3NpZ24gPSBmdW5jdGlvbigpIHtcbiAgX19hc3NpZ24gPSBPYmplY3QuYXNzaWduIHx8IGZ1bmN0aW9uIF9fYXNzaWduKHQpIHtcbiAgICAgIGZvciAodmFyIHMsIGkgPSAxLCBuID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IG47IGkrKykge1xuICAgICAgICAgIHMgPSBhcmd1bWVudHNbaV07XG4gICAgICAgICAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApKSB0W3BdID0gc1twXTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0O1xuICB9XG4gIHJldHVybiBfX2Fzc2lnbi5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19yZXN0KHMsIGUpIHtcbiAgdmFyIHQgPSB7fTtcbiAgZm9yICh2YXIgcCBpbiBzKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHMsIHApICYmIGUuaW5kZXhPZihwKSA8IDApXG4gICAgICB0W3BdID0gc1twXTtcbiAgaWYgKHMgIT0gbnVsbCAmJiB0eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyA9PT0gXCJmdW5jdGlvblwiKVxuICAgICAgZm9yICh2YXIgaSA9IDAsIHAgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKHMpOyBpIDwgcC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIGlmIChlLmluZGV4T2YocFtpXSkgPCAwICYmIE9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChzLCBwW2ldKSlcbiAgICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XG4gICAgICB9XG4gIHJldHVybiB0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xuICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19wYXJhbShwYXJhbUluZGV4LCBkZWNvcmF0b3IpIHtcbiAgcmV0dXJuIGZ1bmN0aW9uICh0YXJnZXQsIGtleSkgeyBkZWNvcmF0b3IodGFyZ2V0LCBrZXksIHBhcmFtSW5kZXgpOyB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2VzRGVjb3JhdGUoY3RvciwgZGVzY3JpcHRvckluLCBkZWNvcmF0b3JzLCBjb250ZXh0SW4sIGluaXRpYWxpemVycywgZXh0cmFJbml0aWFsaXplcnMpIHtcbiAgZnVuY3Rpb24gYWNjZXB0KGYpIHsgaWYgKGYgIT09IHZvaWQgMCAmJiB0eXBlb2YgZiAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiRnVuY3Rpb24gZXhwZWN0ZWRcIik7IHJldHVybiBmOyB9XG4gIHZhciBraW5kID0gY29udGV4dEluLmtpbmQsIGtleSA9IGtpbmQgPT09IFwiZ2V0dGVyXCIgPyBcImdldFwiIDoga2luZCA9PT0gXCJzZXR0ZXJcIiA/IFwic2V0XCIgOiBcInZhbHVlXCI7XG4gIHZhciB0YXJnZXQgPSAhZGVzY3JpcHRvckluICYmIGN0b3IgPyBjb250ZXh0SW5bXCJzdGF0aWNcIl0gPyBjdG9yIDogY3Rvci5wcm90b3R5cGUgOiBudWxsO1xuICB2YXIgZGVzY3JpcHRvciA9IGRlc2NyaXB0b3JJbiB8fCAodGFyZ2V0ID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGNvbnRleHRJbi5uYW1lKSA6IHt9KTtcbiAgdmFyIF8sIGRvbmUgPSBmYWxzZTtcbiAgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIHZhciBjb250ZXh0ID0ge307XG4gICAgICBmb3IgKHZhciBwIGluIGNvbnRleHRJbikgY29udGV4dFtwXSA9IHAgPT09IFwiYWNjZXNzXCIgPyB7fSA6IGNvbnRleHRJbltwXTtcbiAgICAgIGZvciAodmFyIHAgaW4gY29udGV4dEluLmFjY2VzcykgY29udGV4dC5hY2Nlc3NbcF0gPSBjb250ZXh0SW4uYWNjZXNzW3BdO1xuICAgICAgY29udGV4dC5hZGRJbml0aWFsaXplciA9IGZ1bmN0aW9uIChmKSB7IGlmIChkb25lKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiQ2Fubm90IGFkZCBpbml0aWFsaXplcnMgYWZ0ZXIgZGVjb3JhdGlvbiBoYXMgY29tcGxldGVkXCIpOyBleHRyYUluaXRpYWxpemVycy5wdXNoKGFjY2VwdChmIHx8IG51bGwpKTsgfTtcbiAgICAgIHZhciByZXN1bHQgPSAoMCwgZGVjb3JhdG9yc1tpXSkoa2luZCA9PT0gXCJhY2Nlc3NvclwiID8geyBnZXQ6IGRlc2NyaXB0b3IuZ2V0LCBzZXQ6IGRlc2NyaXB0b3Iuc2V0IH0gOiBkZXNjcmlwdG9yW2tleV0sIGNvbnRleHQpO1xuICAgICAgaWYgKGtpbmQgPT09IFwiYWNjZXNzb3JcIikge1xuICAgICAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgY29udGludWU7XG4gICAgICAgICAgaWYgKHJlc3VsdCA9PT0gbnVsbCB8fCB0eXBlb2YgcmVzdWx0ICE9PSBcIm9iamVjdFwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IGV4cGVjdGVkXCIpO1xuICAgICAgICAgIGlmIChfID0gYWNjZXB0KHJlc3VsdC5nZXQpKSBkZXNjcmlwdG9yLmdldCA9IF87XG4gICAgICAgICAgaWYgKF8gPSBhY2NlcHQocmVzdWx0LnNldCkpIGRlc2NyaXB0b3Iuc2V0ID0gXztcbiAgICAgICAgICBpZiAoXyA9IGFjY2VwdChyZXN1bHQuaW5pdCkpIGluaXRpYWxpemVycy51bnNoaWZ0KF8pO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoXyA9IGFjY2VwdChyZXN1bHQpKSB7XG4gICAgICAgICAgaWYgKGtpbmQgPT09IFwiZmllbGRcIikgaW5pdGlhbGl6ZXJzLnVuc2hpZnQoXyk7XG4gICAgICAgICAgZWxzZSBkZXNjcmlwdG9yW2tleV0gPSBfO1xuICAgICAgfVxuICB9XG4gIGlmICh0YXJnZXQpIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGNvbnRleHRJbi5uYW1lLCBkZXNjcmlwdG9yKTtcbiAgZG9uZSA9IHRydWU7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gX19ydW5Jbml0aWFsaXplcnModGhpc0FyZywgaW5pdGlhbGl6ZXJzLCB2YWx1ZSkge1xuICB2YXIgdXNlVmFsdWUgPSBhcmd1bWVudHMubGVuZ3RoID4gMjtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbml0aWFsaXplcnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIHZhbHVlID0gdXNlVmFsdWUgPyBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnLCB2YWx1ZSkgOiBpbml0aWFsaXplcnNbaV0uY2FsbCh0aGlzQXJnKTtcbiAgfVxuICByZXR1cm4gdXNlVmFsdWUgPyB2YWx1ZSA6IHZvaWQgMDtcbn07XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3Byb3BLZXkoeCkge1xuICByZXR1cm4gdHlwZW9mIHggPT09IFwic3ltYm9sXCIgPyB4IDogXCJcIi5jb25jYXQoeCk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gX19zZXRGdW5jdGlvbk5hbWUoZiwgbmFtZSwgcHJlZml4KSB7XG4gIGlmICh0eXBlb2YgbmFtZSA9PT0gXCJzeW1ib2xcIikgbmFtZSA9IG5hbWUuZGVzY3JpcHRpb24gPyBcIltcIi5jb25jYXQobmFtZS5kZXNjcmlwdGlvbiwgXCJdXCIpIDogXCJcIjtcbiAgcmV0dXJuIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShmLCBcIm5hbWVcIiwgeyBjb25maWd1cmFibGU6IHRydWUsIHZhbHVlOiBwcmVmaXggPyBcIlwiLmNvbmNhdChwcmVmaXgsIFwiIFwiLCBuYW1lKSA6IG5hbWUgfSk7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gX19tZXRhZGF0YShtZXRhZGF0YUtleSwgbWV0YWRhdGFWYWx1ZSkge1xuICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEobWV0YWRhdGFLZXksIG1ldGFkYXRhVmFsdWUpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdGVyKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xuICBmdW5jdGlvbiBhZG9wdCh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgaW5zdGFuY2VvZiBQID8gdmFsdWUgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHZhbHVlKTsgfSk7IH1cbiAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XG4gICAgICBmdW5jdGlvbiByZWplY3RlZCh2YWx1ZSkgeyB0cnkgeyBzdGVwKGdlbmVyYXRvcltcInRocm93XCJdKHZhbHVlKSk7IH0gY2F0Y2ggKGUpIHsgcmVqZWN0KGUpOyB9IH1cbiAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogYWRvcHQocmVzdWx0LnZhbHVlKS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XG4gICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19nZW5lcmF0b3IodGhpc0FyZywgYm9keSkge1xuICB2YXIgXyA9IHsgbGFiZWw6IDAsIHNlbnQ6IGZ1bmN0aW9uKCkgeyBpZiAodFswXSAmIDEpIHRocm93IHRbMV07IHJldHVybiB0WzFdOyB9LCB0cnlzOiBbXSwgb3BzOiBbXSB9LCBmLCB5LCB0LCBnID0gT2JqZWN0LmNyZWF0ZSgodHlwZW9mIEl0ZXJhdG9yID09PSBcImZ1bmN0aW9uXCIgPyBJdGVyYXRvciA6IE9iamVjdCkucHJvdG90eXBlKTtcbiAgcmV0dXJuIGcubmV4dCA9IHZlcmIoMCksIGdbXCJ0aHJvd1wiXSA9IHZlcmIoMSksIGdbXCJyZXR1cm5cIl0gPSB2ZXJiKDIpLCB0eXBlb2YgU3ltYm9sID09PSBcImZ1bmN0aW9uXCIgJiYgKGdbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uKCkgeyByZXR1cm4gdGhpczsgfSksIGc7XG4gIGZ1bmN0aW9uIHZlcmIobikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIHN0ZXAoW24sIHZdKTsgfTsgfVxuICBmdW5jdGlvbiBzdGVwKG9wKSB7XG4gICAgICBpZiAoZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkdlbmVyYXRvciBpcyBhbHJlYWR5IGV4ZWN1dGluZy5cIik7XG4gICAgICB3aGlsZSAoZyAmJiAoZyA9IDAsIG9wWzBdICYmIChfID0gMCkpLCBfKSB0cnkge1xuICAgICAgICAgIGlmIChmID0gMSwgeSAmJiAodCA9IG9wWzBdICYgMiA/IHlbXCJyZXR1cm5cIl0gOiBvcFswXSA/IHlbXCJ0aHJvd1wiXSB8fCAoKHQgPSB5W1wicmV0dXJuXCJdKSAmJiB0LmNhbGwoeSksIDApIDogeS5uZXh0KSAmJiAhKHQgPSB0LmNhbGwoeSwgb3BbMV0pKS5kb25lKSByZXR1cm4gdDtcbiAgICAgICAgICBpZiAoeSA9IDAsIHQpIG9wID0gW29wWzBdICYgMiwgdC52YWx1ZV07XG4gICAgICAgICAgc3dpdGNoIChvcFswXSkge1xuICAgICAgICAgICAgICBjYXNlIDA6IGNhc2UgMTogdCA9IG9wOyBicmVhaztcbiAgICAgICAgICAgICAgY2FzZSA0OiBfLmxhYmVsKys7IHJldHVybiB7IHZhbHVlOiBvcFsxXSwgZG9uZTogZmFsc2UgfTtcbiAgICAgICAgICAgICAgY2FzZSA1OiBfLmxhYmVsKys7IHkgPSBvcFsxXTsgb3AgPSBbMF07IGNvbnRpbnVlO1xuICAgICAgICAgICAgICBjYXNlIDc6IG9wID0gXy5vcHMucG9wKCk7IF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICBpZiAoISh0ID0gXy50cnlzLCB0ID0gdC5sZW5ndGggPiAwICYmIHRbdC5sZW5ndGggLSAxXSkgJiYgKG9wWzBdID09PSA2IHx8IG9wWzBdID09PSAyKSkgeyBfID0gMDsgY29udGludWU7IH1cbiAgICAgICAgICAgICAgICAgIGlmIChvcFswXSA9PT0gMyAmJiAoIXQgfHwgKG9wWzFdID4gdFswXSAmJiBvcFsxXSA8IHRbM10pKSkgeyBfLmxhYmVsID0gb3BbMV07IGJyZWFrOyB9XG4gICAgICAgICAgICAgICAgICBpZiAob3BbMF0gPT09IDYgJiYgXy5sYWJlbCA8IHRbMV0pIHsgXy5sYWJlbCA9IHRbMV07IHQgPSBvcDsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgIGlmICh0ICYmIF8ubGFiZWwgPCB0WzJdKSB7IF8ubGFiZWwgPSB0WzJdOyBfLm9wcy5wdXNoKG9wKTsgYnJlYWs7IH1cbiAgICAgICAgICAgICAgICAgIGlmICh0WzJdKSBfLm9wcy5wb3AoKTtcbiAgICAgICAgICAgICAgICAgIF8udHJ5cy5wb3AoKTsgY29udGludWU7XG4gICAgICAgICAgfVxuICAgICAgICAgIG9wID0gYm9keS5jYWxsKHRoaXNBcmcsIF8pO1xuICAgICAgfSBjYXRjaCAoZSkgeyBvcCA9IFs2LCBlXTsgeSA9IDA7IH0gZmluYWxseSB7IGYgPSB0ID0gMDsgfVxuICAgICAgaWYgKG9wWzBdICYgNSkgdGhyb3cgb3BbMV07IHJldHVybiB7IHZhbHVlOiBvcFswXSA/IG9wWzFdIDogdm9pZCAwLCBkb25lOiB0cnVlIH07XG4gIH1cbn1cblxuZXhwb3J0IHZhciBfX2NyZWF0ZUJpbmRpbmcgPSBPYmplY3QuY3JlYXRlID8gKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gIHZhciBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihtLCBrKTtcbiAgaWYgKCFkZXNjIHx8IChcImdldFwiIGluIGRlc2MgPyAhbS5fX2VzTW9kdWxlIDogZGVzYy53cml0YWJsZSB8fCBkZXNjLmNvbmZpZ3VyYWJsZSkpIHtcbiAgICAgIGRlc2MgPSB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZnVuY3Rpb24oKSB7IHJldHVybiBtW2tdOyB9IH07XG4gIH1cbiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KG8sIGsyLCBkZXNjKTtcbn0pIDogKGZ1bmN0aW9uKG8sIG0sIGssIGsyKSB7XG4gIGlmIChrMiA9PT0gdW5kZWZpbmVkKSBrMiA9IGs7XG4gIG9bazJdID0gbVtrXTtcbn0pO1xuXG5leHBvcnQgZnVuY3Rpb24gX19leHBvcnRTdGFyKG0sIG8pIHtcbiAgZm9yICh2YXIgcCBpbiBtKSBpZiAocCAhPT0gXCJkZWZhdWx0XCIgJiYgIU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvLCBwKSkgX19jcmVhdGVCaW5kaW5nKG8sIG0sIHApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX192YWx1ZXMobykge1xuICB2YXIgcyA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBTeW1ib2wuaXRlcmF0b3IsIG0gPSBzICYmIG9bc10sIGkgPSAwO1xuICBpZiAobSkgcmV0dXJuIG0uY2FsbChvKTtcbiAgaWYgKG8gJiYgdHlwZW9mIG8ubGVuZ3RoID09PSBcIm51bWJlclwiKSByZXR1cm4ge1xuICAgICAgbmV4dDogZnVuY3Rpb24gKCkge1xuICAgICAgICAgIGlmIChvICYmIGkgPj0gby5sZW5ndGgpIG8gPSB2b2lkIDA7XG4gICAgICAgICAgcmV0dXJuIHsgdmFsdWU6IG8gJiYgb1tpKytdLCBkb25lOiAhbyB9O1xuICAgICAgfVxuICB9O1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKHMgPyBcIk9iamVjdCBpcyBub3QgaXRlcmFibGUuXCIgOiBcIlN5bWJvbC5pdGVyYXRvciBpcyBub3QgZGVmaW5lZC5cIik7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX3JlYWQobywgbikge1xuICB2YXIgbSA9IHR5cGVvZiBTeW1ib2wgPT09IFwiZnVuY3Rpb25cIiAmJiBvW1N5bWJvbC5pdGVyYXRvcl07XG4gIGlmICghbSkgcmV0dXJuIG87XG4gIHZhciBpID0gbS5jYWxsKG8pLCByLCBhciA9IFtdLCBlO1xuICB0cnkge1xuICAgICAgd2hpbGUgKChuID09PSB2b2lkIDAgfHwgbi0tID4gMCkgJiYgIShyID0gaS5uZXh0KCkpLmRvbmUpIGFyLnB1c2goci52YWx1ZSk7XG4gIH1cbiAgY2F0Y2ggKGVycm9yKSB7IGUgPSB7IGVycm9yOiBlcnJvciB9OyB9XG4gIGZpbmFsbHkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAociAmJiAhci5kb25lICYmIChtID0gaVtcInJldHVyblwiXSkpIG0uY2FsbChpKTtcbiAgICAgIH1cbiAgICAgIGZpbmFsbHkgeyBpZiAoZSkgdGhyb3cgZS5lcnJvcjsgfVxuICB9XG4gIHJldHVybiBhcjtcbn1cblxuLyoqIEBkZXByZWNhdGVkICovXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWQoKSB7XG4gIGZvciAodmFyIGFyID0gW10sIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKVxuICAgICAgYXIgPSBhci5jb25jYXQoX19yZWFkKGFyZ3VtZW50c1tpXSkpO1xuICByZXR1cm4gYXI7XG59XG5cbi8qKiBAZGVwcmVjYXRlZCAqL1xuZXhwb3J0IGZ1bmN0aW9uIF9fc3ByZWFkQXJyYXlzKCkge1xuICBmb3IgKHZhciBzID0gMCwgaSA9IDAsIGlsID0gYXJndW1lbnRzLmxlbmd0aDsgaSA8IGlsOyBpKyspIHMgKz0gYXJndW1lbnRzW2ldLmxlbmd0aDtcbiAgZm9yICh2YXIgciA9IEFycmF5KHMpLCBrID0gMCwgaSA9IDA7IGkgPCBpbDsgaSsrKVxuICAgICAgZm9yICh2YXIgYSA9IGFyZ3VtZW50c1tpXSwgaiA9IDAsIGpsID0gYS5sZW5ndGg7IGogPCBqbDsgaisrLCBrKyspXG4gICAgICAgICAgcltrXSA9IGFbal07XG4gIHJldHVybiByO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19zcHJlYWRBcnJheSh0bywgZnJvbSwgcGFjaykge1xuICBpZiAocGFjayB8fCBhcmd1bWVudHMubGVuZ3RoID09PSAyKSBmb3IgKHZhciBpID0gMCwgbCA9IGZyb20ubGVuZ3RoLCBhcjsgaSA8IGw7IGkrKykge1xuICAgICAgaWYgKGFyIHx8ICEoaSBpbiBmcm9tKSkge1xuICAgICAgICAgIGlmICghYXIpIGFyID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSwgMCwgaSk7XG4gICAgICAgICAgYXJbaV0gPSBmcm9tW2ldO1xuICAgICAgfVxuICB9XG4gIHJldHVybiB0by5jb25jYXQoYXIgfHwgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoZnJvbSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19hd2FpdCh2KSB7XG4gIHJldHVybiB0aGlzIGluc3RhbmNlb2YgX19hd2FpdCA/ICh0aGlzLnYgPSB2LCB0aGlzKSA6IG5ldyBfX2F3YWl0KHYpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19hc3luY0dlbmVyYXRvcih0aGlzQXJnLCBfYXJndW1lbnRzLCBnZW5lcmF0b3IpIHtcbiAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcbiAgdmFyIGcgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSksIGksIHEgPSBbXTtcbiAgcmV0dXJuIGkgPSBPYmplY3QuY3JlYXRlKCh0eXBlb2YgQXN5bmNJdGVyYXRvciA9PT0gXCJmdW5jdGlvblwiID8gQXN5bmNJdGVyYXRvciA6IE9iamVjdCkucHJvdG90eXBlKSwgdmVyYihcIm5leHRcIiksIHZlcmIoXCJ0aHJvd1wiKSwgdmVyYihcInJldHVyblwiLCBhd2FpdFJldHVybiksIGlbU3ltYm9sLmFzeW5jSXRlcmF0b3JdID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gdGhpczsgfSwgaTtcbiAgZnVuY3Rpb24gYXdhaXRSZXR1cm4oZikgeyByZXR1cm4gZnVuY3Rpb24gKHYpIHsgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh2KS50aGVuKGYsIHJlamVjdCk7IH07IH1cbiAgZnVuY3Rpb24gdmVyYihuLCBmKSB7IGlmIChnW25dKSB7IGlbbl0gPSBmdW5jdGlvbiAodikgeyByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKGEsIGIpIHsgcS5wdXNoKFtuLCB2LCBhLCBiXSkgPiAxIHx8IHJlc3VtZShuLCB2KTsgfSk7IH07IGlmIChmKSBpW25dID0gZihpW25dKTsgfSB9XG4gIGZ1bmN0aW9uIHJlc3VtZShuLCB2KSB7IHRyeSB7IHN0ZXAoZ1tuXSh2KSk7IH0gY2F0Y2ggKGUpIHsgc2V0dGxlKHFbMF1bM10sIGUpOyB9IH1cbiAgZnVuY3Rpb24gc3RlcChyKSB7IHIudmFsdWUgaW5zdGFuY2VvZiBfX2F3YWl0ID8gUHJvbWlzZS5yZXNvbHZlKHIudmFsdWUudikudGhlbihmdWxmaWxsLCByZWplY3QpIDogc2V0dGxlKHFbMF1bMl0sIHIpOyB9XG4gIGZ1bmN0aW9uIGZ1bGZpbGwodmFsdWUpIHsgcmVzdW1lKFwibmV4dFwiLCB2YWx1ZSk7IH1cbiAgZnVuY3Rpb24gcmVqZWN0KHZhbHVlKSB7IHJlc3VtZShcInRocm93XCIsIHZhbHVlKTsgfVxuICBmdW5jdGlvbiBzZXR0bGUoZiwgdikgeyBpZiAoZih2KSwgcS5zaGlmdCgpLCBxLmxlbmd0aCkgcmVzdW1lKHFbMF1bMF0sIHFbMF1bMV0pOyB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jRGVsZWdhdG9yKG8pIHtcbiAgdmFyIGksIHA7XG4gIHJldHVybiBpID0ge30sIHZlcmIoXCJuZXh0XCIpLCB2ZXJiKFwidGhyb3dcIiwgZnVuY3Rpb24gKGUpIHsgdGhyb3cgZTsgfSksIHZlcmIoXCJyZXR1cm5cIiksIGlbU3ltYm9sLml0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGk7XG4gIGZ1bmN0aW9uIHZlcmIobiwgZikgeyBpW25dID0gb1tuXSA/IGZ1bmN0aW9uICh2KSB7IHJldHVybiAocCA9ICFwKSA/IHsgdmFsdWU6IF9fYXdhaXQob1tuXSh2KSksIGRvbmU6IGZhbHNlIH0gOiBmID8gZih2KSA6IHY7IH0gOiBmOyB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2FzeW5jVmFsdWVzKG8pIHtcbiAgaWYgKCFTeW1ib2wuYXN5bmNJdGVyYXRvcikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5hc3luY0l0ZXJhdG9yIGlzIG5vdCBkZWZpbmVkLlwiKTtcbiAgdmFyIG0gPSBvW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSwgaTtcbiAgcmV0dXJuIG0gPyBtLmNhbGwobykgOiAobyA9IHR5cGVvZiBfX3ZhbHVlcyA9PT0gXCJmdW5jdGlvblwiID8gX192YWx1ZXMobykgOiBvW1N5bWJvbC5pdGVyYXRvcl0oKSwgaSA9IHt9LCB2ZXJiKFwibmV4dFwiKSwgdmVyYihcInRocm93XCIpLCB2ZXJiKFwicmV0dXJuXCIpLCBpW1N5bWJvbC5hc3luY0l0ZXJhdG9yXSA9IGZ1bmN0aW9uICgpIHsgcmV0dXJuIHRoaXM7IH0sIGkpO1xuICBmdW5jdGlvbiB2ZXJiKG4pIHsgaVtuXSA9IG9bbl0gJiYgZnVuY3Rpb24gKHYpIHsgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsgdiA9IG9bbl0odiksIHNldHRsZShyZXNvbHZlLCByZWplY3QsIHYuZG9uZSwgdi52YWx1ZSk7IH0pOyB9OyB9XG4gIGZ1bmN0aW9uIHNldHRsZShyZXNvbHZlLCByZWplY3QsIGQsIHYpIHsgUHJvbWlzZS5yZXNvbHZlKHYpLnRoZW4oZnVuY3Rpb24odikgeyByZXNvbHZlKHsgdmFsdWU6IHYsIGRvbmU6IGQgfSk7IH0sIHJlamVjdCk7IH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fbWFrZVRlbXBsYXRlT2JqZWN0KGNvb2tlZCwgcmF3KSB7XG4gIGlmIChPYmplY3QuZGVmaW5lUHJvcGVydHkpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KGNvb2tlZCwgXCJyYXdcIiwgeyB2YWx1ZTogcmF3IH0pOyB9IGVsc2UgeyBjb29rZWQucmF3ID0gcmF3OyB9XG4gIHJldHVybiBjb29rZWQ7XG59O1xuXG52YXIgX19zZXRNb2R1bGVEZWZhdWx0ID0gT2JqZWN0LmNyZWF0ZSA/IChmdW5jdGlvbihvLCB2KSB7XG4gIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShvLCBcImRlZmF1bHRcIiwgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdiB9KTtcbn0pIDogZnVuY3Rpb24obywgdikge1xuICBvW1wiZGVmYXVsdFwiXSA9IHY7XG59O1xuXG52YXIgb3duS2V5cyA9IGZ1bmN0aW9uKG8pIHtcbiAgb3duS2V5cyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzIHx8IGZ1bmN0aW9uIChvKSB7XG4gICAgdmFyIGFyID0gW107XG4gICAgZm9yICh2YXIgayBpbiBvKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG8sIGspKSBhclthci5sZW5ndGhdID0gaztcbiAgICByZXR1cm4gYXI7XG4gIH07XG4gIHJldHVybiBvd25LZXlzKG8pO1xufTtcblxuZXhwb3J0IGZ1bmN0aW9uIF9faW1wb3J0U3Rhcihtb2QpIHtcbiAgaWYgKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgcmV0dXJuIG1vZDtcbiAgdmFyIHJlc3VsdCA9IHt9O1xuICBpZiAobW9kICE9IG51bGwpIGZvciAodmFyIGsgPSBvd25LZXlzKG1vZCksIGkgPSAwOyBpIDwgay5sZW5ndGg7IGkrKykgaWYgKGtbaV0gIT09IFwiZGVmYXVsdFwiKSBfX2NyZWF0ZUJpbmRpbmcocmVzdWx0LCBtb2QsIGtbaV0pO1xuICBfX3NldE1vZHVsZURlZmF1bHQocmVzdWx0LCBtb2QpO1xuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19pbXBvcnREZWZhdWx0KG1vZCkge1xuICByZXR1cm4gKG1vZCAmJiBtb2QuX19lc01vZHVsZSkgPyBtb2QgOiB7IGRlZmF1bHQ6IG1vZCB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19jbGFzc1ByaXZhdGVGaWVsZEdldChyZWNlaXZlciwgc3RhdGUsIGtpbmQsIGYpIHtcbiAgaWYgKGtpbmQgPT09IFwiYVwiICYmICFmKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiUHJpdmF0ZSBhY2Nlc3NvciB3YXMgZGVmaW5lZCB3aXRob3V0IGEgZ2V0dGVyXCIpO1xuICBpZiAodHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciAhPT0gc3RhdGUgfHwgIWYgOiAhc3RhdGUuaGFzKHJlY2VpdmVyKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCByZWFkIHByaXZhdGUgbWVtYmVyIGZyb20gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcbiAgcmV0dXJuIGtpbmQgPT09IFwibVwiID8gZiA6IGtpbmQgPT09IFwiYVwiID8gZi5jYWxsKHJlY2VpdmVyKSA6IGYgPyBmLnZhbHVlIDogc3RhdGUuZ2V0KHJlY2VpdmVyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fY2xhc3NQcml2YXRlRmllbGRTZXQocmVjZWl2ZXIsIHN0YXRlLCB2YWx1ZSwga2luZCwgZikge1xuICBpZiAoa2luZCA9PT0gXCJtXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJQcml2YXRlIG1ldGhvZCBpcyBub3Qgd3JpdGFibGVcIik7XG4gIGlmIChraW5kID09PSBcImFcIiAmJiAhZikgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlByaXZhdGUgYWNjZXNzb3Igd2FzIGRlZmluZWQgd2l0aG91dCBhIHNldHRlclwiKTtcbiAgaWYgKHR5cGVvZiBzdGF0ZSA9PT0gXCJmdW5jdGlvblwiID8gcmVjZWl2ZXIgIT09IHN0YXRlIHx8ICFmIDogIXN0YXRlLmhhcyhyZWNlaXZlcikpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJDYW5ub3Qgd3JpdGUgcHJpdmF0ZSBtZW1iZXIgdG8gYW4gb2JqZWN0IHdob3NlIGNsYXNzIGRpZCBub3QgZGVjbGFyZSBpdFwiKTtcbiAgcmV0dXJuIChraW5kID09PSBcImFcIiA/IGYuY2FsbChyZWNlaXZlciwgdmFsdWUpIDogZiA/IGYudmFsdWUgPSB2YWx1ZSA6IHN0YXRlLnNldChyZWNlaXZlciwgdmFsdWUpKSwgdmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4oc3RhdGUsIHJlY2VpdmVyKSB7XG4gIGlmIChyZWNlaXZlciA9PT0gbnVsbCB8fCAodHlwZW9mIHJlY2VpdmVyICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiByZWNlaXZlciAhPT0gXCJmdW5jdGlvblwiKSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCB1c2UgJ2luJyBvcGVyYXRvciBvbiBub24tb2JqZWN0XCIpO1xuICByZXR1cm4gdHlwZW9mIHN0YXRlID09PSBcImZ1bmN0aW9uXCIgPyByZWNlaXZlciA9PT0gc3RhdGUgOiBzdGF0ZS5oYXMocmVjZWl2ZXIpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX19hZGREaXNwb3NhYmxlUmVzb3VyY2UoZW52LCB2YWx1ZSwgYXN5bmMpIHtcbiAgaWYgKHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB2b2lkIDApIHtcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSBcIm9iamVjdFwiICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJmdW5jdGlvblwiKSB0aHJvdyBuZXcgVHlwZUVycm9yKFwiT2JqZWN0IGV4cGVjdGVkLlwiKTtcbiAgICB2YXIgZGlzcG9zZSwgaW5uZXI7XG4gICAgaWYgKGFzeW5jKSB7XG4gICAgICBpZiAoIVN5bWJvbC5hc3luY0Rpc3Bvc2UpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJTeW1ib2wuYXN5bmNEaXNwb3NlIGlzIG5vdCBkZWZpbmVkLlwiKTtcbiAgICAgIGRpc3Bvc2UgPSB2YWx1ZVtTeW1ib2wuYXN5bmNEaXNwb3NlXTtcbiAgICB9XG4gICAgaWYgKGRpc3Bvc2UgPT09IHZvaWQgMCkge1xuICAgICAgaWYgKCFTeW1ib2wuZGlzcG9zZSkgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlN5bWJvbC5kaXNwb3NlIGlzIG5vdCBkZWZpbmVkLlwiKTtcbiAgICAgIGRpc3Bvc2UgPSB2YWx1ZVtTeW1ib2wuZGlzcG9zZV07XG4gICAgICBpZiAoYXN5bmMpIGlubmVyID0gZGlzcG9zZTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBkaXNwb3NlICE9PSBcImZ1bmN0aW9uXCIpIHRocm93IG5ldyBUeXBlRXJyb3IoXCJPYmplY3Qgbm90IGRpc3Bvc2FibGUuXCIpO1xuICAgIGlmIChpbm5lcikgZGlzcG9zZSA9IGZ1bmN0aW9uKCkgeyB0cnkgeyBpbm5lci5jYWxsKHRoaXMpOyB9IGNhdGNoIChlKSB7IHJldHVybiBQcm9taXNlLnJlamVjdChlKTsgfSB9O1xuICAgIGVudi5zdGFjay5wdXNoKHsgdmFsdWU6IHZhbHVlLCBkaXNwb3NlOiBkaXNwb3NlLCBhc3luYzogYXN5bmMgfSk7XG4gIH1cbiAgZWxzZSBpZiAoYXN5bmMpIHtcbiAgICBlbnYuc3RhY2sucHVzaCh7IGFzeW5jOiB0cnVlIH0pO1xuICB9XG4gIHJldHVybiB2YWx1ZTtcbn1cblxudmFyIF9TdXBwcmVzc2VkRXJyb3IgPSB0eXBlb2YgU3VwcHJlc3NlZEVycm9yID09PSBcImZ1bmN0aW9uXCIgPyBTdXBwcmVzc2VkRXJyb3IgOiBmdW5jdGlvbiAoZXJyb3IsIHN1cHByZXNzZWQsIG1lc3NhZ2UpIHtcbiAgdmFyIGUgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gIHJldHVybiBlLm5hbWUgPSBcIlN1cHByZXNzZWRFcnJvclwiLCBlLmVycm9yID0gZXJyb3IsIGUuc3VwcHJlc3NlZCA9IHN1cHByZXNzZWQsIGU7XG59O1xuXG5leHBvcnQgZnVuY3Rpb24gX19kaXNwb3NlUmVzb3VyY2VzKGVudikge1xuICBmdW5jdGlvbiBmYWlsKGUpIHtcbiAgICBlbnYuZXJyb3IgPSBlbnYuaGFzRXJyb3IgPyBuZXcgX1N1cHByZXNzZWRFcnJvcihlLCBlbnYuZXJyb3IsIFwiQW4gZXJyb3Igd2FzIHN1cHByZXNzZWQgZHVyaW5nIGRpc3Bvc2FsLlwiKSA6IGU7XG4gICAgZW52Lmhhc0Vycm9yID0gdHJ1ZTtcbiAgfVxuICB2YXIgciwgcyA9IDA7XG4gIGZ1bmN0aW9uIG5leHQoKSB7XG4gICAgd2hpbGUgKHIgPSBlbnYuc3RhY2sucG9wKCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghci5hc3luYyAmJiBzID09PSAxKSByZXR1cm4gcyA9IDAsIGVudi5zdGFjay5wdXNoKHIpLCBQcm9taXNlLnJlc29sdmUoKS50aGVuKG5leHQpO1xuICAgICAgICBpZiAoci5kaXNwb3NlKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IHIuZGlzcG9zZS5jYWxsKHIudmFsdWUpO1xuICAgICAgICAgIGlmIChyLmFzeW5jKSByZXR1cm4gcyB8PSAyLCBQcm9taXNlLnJlc29sdmUocmVzdWx0KS50aGVuKG5leHQsIGZ1bmN0aW9uKGUpIHsgZmFpbChlKTsgcmV0dXJuIG5leHQoKTsgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBzIHw9IDE7XG4gICAgICB9XG4gICAgICBjYXRjaCAoZSkge1xuICAgICAgICBmYWlsKGUpO1xuICAgICAgfVxuICAgIH1cbiAgICBpZiAocyA9PT0gMSkgcmV0dXJuIGVudi5oYXNFcnJvciA/IFByb21pc2UucmVqZWN0KGVudi5lcnJvcikgOiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICBpZiAoZW52Lmhhc0Vycm9yKSB0aHJvdyBlbnYuZXJyb3I7XG4gIH1cbiAgcmV0dXJuIG5leHQoKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9fcmV3cml0ZVJlbGF0aXZlSW1wb3J0RXh0ZW5zaW9uKHBhdGgsIHByZXNlcnZlSnN4KSB7XG4gIGlmICh0eXBlb2YgcGF0aCA9PT0gXCJzdHJpbmdcIiAmJiAvXlxcLlxcLj9cXC8vLnRlc3QocGF0aCkpIHtcbiAgICAgIHJldHVybiBwYXRoLnJlcGxhY2UoL1xcLih0c3gpJHwoKD86XFwuZCk/KSgoPzpcXC5bXi4vXSs/KT8pXFwuKFtjbV0/KXRzJC9pLCBmdW5jdGlvbiAobSwgdHN4LCBkLCBleHQsIGNtKSB7XG4gICAgICAgICAgcmV0dXJuIHRzeCA/IHByZXNlcnZlSnN4ID8gXCIuanN4XCIgOiBcIi5qc1wiIDogZCAmJiAoIWV4dCB8fCAhY20pID8gbSA6IChkICsgZXh0ICsgXCIuXCIgKyBjbS50b0xvd2VyQ2FzZSgpICsgXCJqc1wiKTtcbiAgICAgIH0pO1xuICB9XG4gIHJldHVybiBwYXRoO1xufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gIF9fZXh0ZW5kcyxcbiAgX19hc3NpZ24sXG4gIF9fcmVzdCxcbiAgX19kZWNvcmF0ZSxcbiAgX19wYXJhbSxcbiAgX19lc0RlY29yYXRlLFxuICBfX3J1bkluaXRpYWxpemVycyxcbiAgX19wcm9wS2V5LFxuICBfX3NldEZ1bmN0aW9uTmFtZSxcbiAgX19tZXRhZGF0YSxcbiAgX19hd2FpdGVyLFxuICBfX2dlbmVyYXRvcixcbiAgX19jcmVhdGVCaW5kaW5nLFxuICBfX2V4cG9ydFN0YXIsXG4gIF9fdmFsdWVzLFxuICBfX3JlYWQsXG4gIF9fc3ByZWFkLFxuICBfX3NwcmVhZEFycmF5cyxcbiAgX19zcHJlYWRBcnJheSxcbiAgX19hd2FpdCxcbiAgX19hc3luY0dlbmVyYXRvcixcbiAgX19hc3luY0RlbGVnYXRvcixcbiAgX19hc3luY1ZhbHVlcyxcbiAgX19tYWtlVGVtcGxhdGVPYmplY3QsXG4gIF9faW1wb3J0U3RhcixcbiAgX19pbXBvcnREZWZhdWx0LFxuICBfX2NsYXNzUHJpdmF0ZUZpZWxkR2V0LFxuICBfX2NsYXNzUHJpdmF0ZUZpZWxkU2V0LFxuICBfX2NsYXNzUHJpdmF0ZUZpZWxkSW4sXG4gIF9fYWRkRGlzcG9zYWJsZVJlc291cmNlLFxuICBfX2Rpc3Bvc2VSZXNvdXJjZXMsXG4gIF9fcmV3cml0ZVJlbGF0aXZlSW1wb3J0RXh0ZW5zaW9uLFxufTtcbiIsImltcG9ydCB7IEVycm9yRmFjdG9yeSwgaXNCcm93c2VyRXh0ZW5zaW9uLCBpc01vYmlsZUNvcmRvdmEsIGlzUmVhY3ROYXRpdmUsIEZpcmViYXNlRXJyb3IsIHF1ZXJ5c3RyaW5nLCBpc0Nsb3VkZmxhcmVXb3JrZXIsIGdldE1vZHVsYXJJbnN0YW5jZSwgYmFzZTY0RGVjb2RlLCBnZXRVQSwgaXNJRSwgY3JlYXRlU3Vic2NyaWJlLCBkZWVwRXF1YWwsIHF1ZXJ5c3RyaW5nRGVjb2RlLCBleHRyYWN0UXVlcnlzdHJpbmcgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBTREtfVkVSU0lPTiwgX2lzRmlyZWJhc2VTZXJ2ZXJBcHAsIF9nZXRQcm92aWRlciwgX3JlZ2lzdGVyQ29tcG9uZW50LCByZWdpc3RlclZlcnNpb24gfSBmcm9tICdAZmlyZWJhc2UvYXBwJztcbmltcG9ydCB7IF9fcmVzdCB9IGZyb20gJ3RzbGliJztcbmltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0BmaXJlYmFzZS9jb21wb25lbnQnO1xuaW1wb3J0IHsgTG9nZ2VyLCBMb2dMZXZlbCB9IGZyb20gJ0BmaXJlYmFzZS9sb2dnZXInO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gX2RlYnVnRXJyb3JNYXAoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgW1wiYWRtaW4tcmVzdHJpY3RlZC1vcGVyYXRpb25cIiAvKiBBdXRoRXJyb3JDb2RlLkFETUlOX09OTFlfT1BFUkFUSU9OICovXTogJ1RoaXMgb3BlcmF0aW9uIGlzIHJlc3RyaWN0ZWQgdG8gYWRtaW5pc3RyYXRvcnMgb25seS4nLFxuICAgICAgICBbXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi9dOiAnJyxcbiAgICAgICAgW1wiYXBwLW5vdC1hdXRob3JpemVkXCIgLyogQXV0aEVycm9yQ29kZS5BUFBfTk9UX0FVVEhPUklaRUQgKi9dOiBcIlRoaXMgYXBwLCBpZGVudGlmaWVkIGJ5IHRoZSBkb21haW4gd2hlcmUgaXQncyBob3N0ZWQsIGlzIG5vdCBcIiArXG4gICAgICAgICAgICAnYXV0aG9yaXplZCB0byB1c2UgRmlyZWJhc2UgQXV0aGVudGljYXRpb24gd2l0aCB0aGUgcHJvdmlkZWQgQVBJIGtleS4gJyArXG4gICAgICAgICAgICAnUmV2aWV3IHlvdXIga2V5IGNvbmZpZ3VyYXRpb24gaW4gdGhlIEdvb2dsZSBBUEkgY29uc29sZS4nLFxuICAgICAgICBbXCJhcHAtbm90LWluc3RhbGxlZFwiIC8qIEF1dGhFcnJvckNvZGUuQVBQX05PVF9JTlNUQUxMRUQgKi9dOiAnVGhlIHJlcXVlc3RlZCBtb2JpbGUgYXBwbGljYXRpb24gY29ycmVzcG9uZGluZyB0byB0aGUgaWRlbnRpZmllciAoJyArXG4gICAgICAgICAgICAnQW5kcm9pZCBwYWNrYWdlIG5hbWUgb3IgaU9TIGJ1bmRsZSBJRCkgcHJvdmlkZWQgaXMgbm90IGluc3RhbGxlZCBvbiAnICtcbiAgICAgICAgICAgICd0aGlzIGRldmljZS4nLFxuICAgICAgICBbXCJjYXB0Y2hhLWNoZWNrLWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuQ0FQVENIQV9DSEVDS19GQUlMRUQgKi9dOiAnVGhlIHJlQ0FQVENIQSByZXNwb25zZSB0b2tlbiBwcm92aWRlZCBpcyBlaXRoZXIgaW52YWxpZCwgZXhwaXJlZCwgJyArXG4gICAgICAgICAgICAnYWxyZWFkeSB1c2VkIG9yIHRoZSBkb21haW4gYXNzb2NpYXRlZCB3aXRoIGl0IGRvZXMgbm90IG1hdGNoIHRoZSBsaXN0ICcgK1xuICAgICAgICAgICAgJ29mIHdoaXRlbGlzdGVkIGRvbWFpbnMuJyxcbiAgICAgICAgW1wiY29kZS1leHBpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5DT0RFX0VYUElSRUQgKi9dOiAnVGhlIFNNUyBjb2RlIGhhcyBleHBpcmVkLiBQbGVhc2UgcmUtc2VuZCB0aGUgdmVyaWZpY2F0aW9uIGNvZGUgdG8gdHJ5ICcgK1xuICAgICAgICAgICAgJ2FnYWluLicsXG4gICAgICAgIFtcImNvcmRvdmEtbm90LXJlYWR5XCIgLyogQXV0aEVycm9yQ29kZS5DT1JET1ZBX05PVF9SRUFEWSAqL106ICdDb3Jkb3ZhIGZyYW1ld29yayBpcyBub3QgcmVhZHkuJyxcbiAgICAgICAgW1wiY29ycy11bnN1cHBvcnRlZFwiIC8qIEF1dGhFcnJvckNvZGUuQ09SU19VTlNVUFBPUlRFRCAqL106ICdUaGlzIGJyb3dzZXIgaXMgbm90IHN1cHBvcnRlZC4nLFxuICAgICAgICBbXCJjcmVkZW50aWFsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX0FMUkVBRFlfSU5fVVNFICovXTogJ1RoaXMgY3JlZGVudGlhbCBpcyBhbHJlYWR5IGFzc29jaWF0ZWQgd2l0aCBhIGRpZmZlcmVudCB1c2VyIGFjY291bnQuJyxcbiAgICAgICAgW1wiY3VzdG9tLXRva2VuLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX01JU01BVENIICovXTogJ1RoZSBjdXN0b20gdG9rZW4gY29ycmVzcG9uZHMgdG8gYSBkaWZmZXJlbnQgYXVkaWVuY2UuJyxcbiAgICAgICAgW1wicmVxdWlyZXMtcmVjZW50LWxvZ2luXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU4gKi9dOiAnVGhpcyBvcGVyYXRpb24gaXMgc2Vuc2l0aXZlIGFuZCByZXF1aXJlcyByZWNlbnQgYXV0aGVudGljYXRpb24uIExvZyBpbiAnICtcbiAgICAgICAgICAgICdhZ2FpbiBiZWZvcmUgcmV0cnlpbmcgdGhpcyByZXF1ZXN0LicsXG4gICAgICAgIFtcImRlcGVuZGVudC1zZGstaW5pdGlhbGl6ZWQtYmVmb3JlLWF1dGhcIiAvKiBBdXRoRXJyb3JDb2RlLkRFUEVOREVOVF9TREtfSU5JVF9CRUZPUkVfQVVUSCAqL106ICdBbm90aGVyIEZpcmViYXNlIFNESyB3YXMgaW5pdGlhbGl6ZWQgYW5kIGlzIHRyeWluZyB0byB1c2UgQXV0aCBiZWZvcmUgQXV0aCBpcyAnICtcbiAgICAgICAgICAgICdpbml0aWFsaXplZC4gUGxlYXNlIGJlIHN1cmUgdG8gY2FsbCBgaW5pdGlhbGl6ZUF1dGhgIG9yIGBnZXRBdXRoYCBiZWZvcmUgJyArXG4gICAgICAgICAgICAnc3RhcnRpbmcgYW55IG90aGVyIEZpcmViYXNlIFNESy4nLFxuICAgICAgICBbXCJkeW5hbWljLWxpbmstbm90LWFjdGl2YXRlZFwiIC8qIEF1dGhFcnJvckNvZGUuRFlOQU1JQ19MSU5LX05PVF9BQ1RJVkFURUQgKi9dOiAnUGxlYXNlIGFjdGl2YXRlIER5bmFtaWMgTGlua3MgaW4gdGhlIEZpcmViYXNlIENvbnNvbGUgYW5kIGFncmVlIHRvIHRoZSB0ZXJtcyBhbmQgJyArXG4gICAgICAgICAgICAnY29uZGl0aW9ucy4nLFxuICAgICAgICBbXCJlbWFpbC1jaGFuZ2UtbmVlZHMtdmVyaWZpY2F0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9DSEFOR0VfTkVFRFNfVkVSSUZJQ0FUSU9OICovXTogJ011bHRpLWZhY3RvciB1c2VycyBtdXN0IGFsd2F5cyBoYXZlIGEgdmVyaWZpZWQgZW1haWwuJyxcbiAgICAgICAgW1wiZW1haWwtYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLkVNQUlMX0VYSVNUUyAqL106ICdUaGUgZW1haWwgYWRkcmVzcyBpcyBhbHJlYWR5IGluIHVzZSBieSBhbm90aGVyIGFjY291bnQuJyxcbiAgICAgICAgW1wiZW11bGF0b3ItY29uZmlnLWZhaWxlZFwiIC8qIEF1dGhFcnJvckNvZGUuRU1VTEFUT1JfQ09ORklHX0ZBSUxFRCAqL106ICdBdXRoIGluc3RhbmNlIGhhcyBhbHJlYWR5IGJlZW4gdXNlZCB0byBtYWtlIGEgbmV0d29yayBjYWxsLiBBdXRoIGNhbiAnICtcbiAgICAgICAgICAgICdubyBsb25nZXIgYmUgY29uZmlndXJlZCB0byB1c2UgdGhlIGVtdWxhdG9yLiBUcnkgY2FsbGluZyAnICtcbiAgICAgICAgICAgICdcImNvbm5lY3RBdXRoRW11bGF0b3IoKVwiIHNvb25lci4nLFxuICAgICAgICBbXCJleHBpcmVkLWFjdGlvbi1jb2RlXCIgLyogQXV0aEVycm9yQ29kZS5FWFBJUkVEX09PQl9DT0RFICovXTogJ1RoZSBhY3Rpb24gY29kZSBoYXMgZXhwaXJlZC4nLFxuICAgICAgICBbXCJjYW5jZWxsZWQtcG9wdXAtcmVxdWVzdFwiIC8qIEF1dGhFcnJvckNvZGUuRVhQSVJFRF9QT1BVUF9SRVFVRVNUICovXTogJ1RoaXMgb3BlcmF0aW9uIGhhcyBiZWVuIGNhbmNlbGxlZCBkdWUgdG8gYW5vdGhlciBjb25mbGljdGluZyBwb3B1cCBiZWluZyBvcGVuZWQuJyxcbiAgICAgICAgW1wiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcbiAgICAgICAgW1wiaW52YWxpZC1hcHAtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUFBfQ1JFREVOVElBTCAqL106ICdUaGUgcGhvbmUgdmVyaWZpY2F0aW9uIHJlcXVlc3QgY29udGFpbnMgYW4gaW52YWxpZCBhcHBsaWNhdGlvbiB2ZXJpZmllci4nICtcbiAgICAgICAgICAgICcgVGhlIHJlQ0FQVENIQSB0b2tlbiByZXNwb25zZSBpcyBlaXRoZXIgaW52YWxpZCBvciBleHBpcmVkLicsXG4gICAgICAgIFtcImludmFsaWQtYXBwLWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FQUF9JRCAqL106ICdUaGUgbW9iaWxlIGFwcCBpZGVudGlmaWVyIGlzIG5vdCByZWdpc3RlcmVkIGZvciB0aGUgY3VycmVudCBwcm9qZWN0LicsXG4gICAgICAgIFtcImludmFsaWQtdXNlci10b2tlblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIICovXTogXCJUaGlzIHVzZXIncyBjcmVkZW50aWFsIGlzbid0IHZhbGlkIGZvciB0aGlzIHByb2plY3QuIFRoaXMgY2FuIGhhcHBlbiBcIiArXG4gICAgICAgICAgICBcImlmIHRoZSB1c2VyJ3MgdG9rZW4gaGFzIGJlZW4gdGFtcGVyZWQgd2l0aCwgb3IgaWYgdGhlIHVzZXIgaXNuJ3QgZm9yIFwiICtcbiAgICAgICAgICAgICd0aGUgcHJvamVjdCBhc3NvY2lhdGVkIHdpdGggdGhpcyBBUEkga2V5LicsXG4gICAgICAgIFtcImludmFsaWQtYXV0aC1ldmVudFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BVVRIX0VWRU5UICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcbiAgICAgICAgW1wiaW52YWxpZC12ZXJpZmljYXRpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT0RFICovXTogJ1RoZSBTTVMgdmVyaWZpY2F0aW9uIGNvZGUgdXNlZCB0byBjcmVhdGUgdGhlIHBob25lIGF1dGggY3JlZGVudGlhbCBpcyAnICtcbiAgICAgICAgICAgICdpbnZhbGlkLiBQbGVhc2UgcmVzZW5kIHRoZSB2ZXJpZmljYXRpb24gY29kZSBzbXMgYW5kIGJlIHN1cmUgdG8gdXNlIHRoZSAnICtcbiAgICAgICAgICAgICd2ZXJpZmljYXRpb24gY29kZSBwcm92aWRlZCBieSB0aGUgdXNlci4nLFxuICAgICAgICBbXCJpbnZhbGlkLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT05USU5VRV9VUkkgKi9dOiAnVGhlIGNvbnRpbnVlIFVSTCBwcm92aWRlZCBpbiB0aGUgcmVxdWVzdCBpcyBpbnZhbGlkLicsXG4gICAgICAgIFtcImludmFsaWQtY29yZG92YS1jb25maWd1cmF0aW9uXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0NPUkRPVkFfQ09ORklHVVJBVElPTiAqL106ICdUaGUgZm9sbG93aW5nIENvcmRvdmEgcGx1Z2lucyBtdXN0IGJlIGluc3RhbGxlZCB0byBlbmFibGUgT0F1dGggc2lnbi1pbjogJyArXG4gICAgICAgICAgICAnY29yZG92YS1wbHVnaW4tYnVpbGRpbmZvLCBjb3Jkb3ZhLXVuaXZlcnNhbC1saW5rcy1wbHVnaW4sICcgK1xuICAgICAgICAgICAgJ2NvcmRvdmEtcGx1Z2luLWJyb3dzZXJ0YWIsIGNvcmRvdmEtcGx1Z2luLWluYXBwYnJvd3NlciBhbmQgJyArXG4gICAgICAgICAgICAnY29yZG92YS1wbHVnaW4tY3VzdG9tdXJsc2NoZW1lLicsXG4gICAgICAgIFtcImludmFsaWQtY3VzdG9tLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0NVU1RPTV9UT0tFTiAqL106ICdUaGUgY3VzdG9tIHRva2VuIGZvcm1hdCBpcyBpbmNvcnJlY3QuIFBsZWFzZSBjaGVjayB0aGUgZG9jdW1lbnRhdGlvbi4nLFxuICAgICAgICBbXCJpbnZhbGlkLWR5bmFtaWMtbGluay1kb21haW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRFlOQU1JQ19MSU5LX0RPTUFJTiAqL106ICdUaGUgcHJvdmlkZWQgZHluYW1pYyBsaW5rIGRvbWFpbiBpcyBub3QgY29uZmlndXJlZCBvciBhdXRob3JpemVkIGZvciB0aGUgY3VycmVudCBwcm9qZWN0LicsXG4gICAgICAgIFtcImludmFsaWQtZW1haWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRU1BSUwgKi9dOiAnVGhlIGVtYWlsIGFkZHJlc3MgaXMgYmFkbHkgZm9ybWF0dGVkLicsXG4gICAgICAgIFtcImludmFsaWQtZW11bGF0b3Itc2NoZW1lXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0VNVUxBVE9SX1NDSEVNRSAqL106ICdFbXVsYXRvciBVUkwgbXVzdCBzdGFydCB3aXRoIGEgdmFsaWQgc2NoZW1lIChodHRwOi8vIG9yIGh0dHBzOi8vKS4nLFxuICAgICAgICBbXCJpbnZhbGlkLWFwaS1rZXlcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVBJX0tFWSAqL106ICdZb3VyIEFQSSBrZXkgaXMgaW52YWxpZCwgcGxlYXNlIGNoZWNrIHlvdSBoYXZlIGNvcGllZCBpdCBjb3JyZWN0bHkuJyxcbiAgICAgICAgW1wiaW52YWxpZC1jZXJ0LWhhc2hcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ0VSVF9IQVNIICovXTogJ1RoZSBTSEEtMSBjZXJ0aWZpY2F0ZSBoYXNoIHByb3ZpZGVkIGlzIGludmFsaWQuJyxcbiAgICAgICAgW1wiaW52YWxpZC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0NSRURFTlRJQUwgKi9dOiAnVGhlIHN1cHBsaWVkIGF1dGggY3JlZGVudGlhbCBpcyBpbmNvcnJlY3QsIG1hbGZvcm1lZCBvciBoYXMgZXhwaXJlZC4nLFxuICAgICAgICBbXCJpbnZhbGlkLW1lc3NhZ2UtcGF5bG9hZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9NRVNTQUdFX1BBWUxPQUQgKi9dOiAnVGhlIGVtYWlsIHRlbXBsYXRlIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBhY3Rpb24gY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzIGluIGl0cyBtZXNzYWdlLiAnICtcbiAgICAgICAgICAgICdQbGVhc2UgZml4IGJ5IGdvaW5nIHRvIHRoZSBBdXRoIGVtYWlsIHRlbXBsYXRlcyBzZWN0aW9uIGluIHRoZSBGaXJlYmFzZSBDb25zb2xlLicsXG4gICAgICAgIFtcImludmFsaWQtbXVsdGktZmFjdG9yLXNlc3Npb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfTUZBX1NFU1NJT04gKi9dOiAnVGhlIHJlcXVlc3QgZG9lcyBub3QgY29udGFpbiBhIHZhbGlkIHByb29mIG9mIGZpcnN0IGZhY3RvciBzdWNjZXNzZnVsIHNpZ24taW4uJyxcbiAgICAgICAgW1wiaW52YWxpZC1vYXV0aC1wcm92aWRlclwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PQVVUSF9QUk9WSURFUiAqL106ICdFbWFpbEF1dGhQcm92aWRlciBpcyBub3Qgc3VwcG9ydGVkIGZvciB0aGlzIG9wZXJhdGlvbi4gVGhpcyBvcGVyYXRpb24gJyArXG4gICAgICAgICAgICAnb25seSBzdXBwb3J0cyBPQXV0aCBwcm92aWRlcnMuJyxcbiAgICAgICAgW1wiaW52YWxpZC1vYXV0aC1jbGllbnQtaWRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT0FVVEhfQ0xJRU5UX0lEICovXTogJ1RoZSBPQXV0aCBjbGllbnQgSUQgcHJvdmlkZWQgaXMgZWl0aGVyIGludmFsaWQgb3IgZG9lcyBub3QgbWF0Y2ggdGhlICcgK1xuICAgICAgICAgICAgJ3NwZWNpZmllZCBBUEkga2V5LicsXG4gICAgICAgIFtcInVuYXV0aG9yaXplZC1kb21haW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT1JJR0lOICovXTogJ1RoaXMgZG9tYWluIGlzIG5vdCBhdXRob3JpemVkIGZvciBPQXV0aCBvcGVyYXRpb25zIGZvciB5b3VyIEZpcmViYXNlICcgK1xuICAgICAgICAgICAgJ3Byb2plY3QuIEVkaXQgdGhlIGxpc3Qgb2YgYXV0aG9yaXplZCBkb21haW5zIGZyb20gdGhlIEZpcmViYXNlIGNvbnNvbGUuJyxcbiAgICAgICAgW1wiaW52YWxpZC1hY3Rpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9PT0JfQ09ERSAqL106ICdUaGUgYWN0aW9uIGNvZGUgaXMgaW52YWxpZC4gVGhpcyBjYW4gaGFwcGVuIGlmIHRoZSBjb2RlIGlzIG1hbGZvcm1lZCwgJyArXG4gICAgICAgICAgICAnZXhwaXJlZCwgb3IgaGFzIGFscmVhZHkgYmVlbiB1c2VkLicsXG4gICAgICAgIFtcIndyb25nLXBhc3N3b3JkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1BBU1NXT1JEICovXTogJ1RoZSBwYXNzd29yZCBpcyBpbnZhbGlkIG9yIHRoZSB1c2VyIGRvZXMgbm90IGhhdmUgYSBwYXNzd29yZC4nLFxuICAgICAgICBbXCJpbnZhbGlkLXBlcnNpc3RlbmNlLXR5cGVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEVSU0lTVEVOQ0UgKi9dOiAnVGhlIHNwZWNpZmllZCBwZXJzaXN0ZW5jZSB0eXBlIGlzIGludmFsaWQuIEl0IGNhbiBvbmx5IGJlIGxvY2FsLCBzZXNzaW9uIG9yIG5vbmUuJyxcbiAgICAgICAgW1wiaW52YWxpZC1waG9uZS1udW1iZXJcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEhPTkVfTlVNQkVSICovXTogJ1RoZSBmb3JtYXQgb2YgdGhlIHBob25lIG51bWJlciBwcm92aWRlZCBpcyBpbmNvcnJlY3QuIFBsZWFzZSBlbnRlciB0aGUgJyArXG4gICAgICAgICAgICAncGhvbmUgbnVtYmVyIGluIGEgZm9ybWF0IHRoYXQgY2FuIGJlIHBhcnNlZCBpbnRvIEUuMTY0IGZvcm1hdC4gRS4xNjQgJyArXG4gICAgICAgICAgICAncGhvbmUgbnVtYmVycyBhcmUgd3JpdHRlbiBpbiB0aGUgZm9ybWF0IFsrXVtjb3VudHJ5IGNvZGVdW3N1YnNjcmliZXIgJyArXG4gICAgICAgICAgICAnbnVtYmVyIGluY2x1ZGluZyBhcmVhIGNvZGVdLicsXG4gICAgICAgIFtcImludmFsaWQtcHJvdmlkZXItaWRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUFJPVklERVJfSUQgKi9dOiAnVGhlIHNwZWNpZmllZCBwcm92aWRlciBJRCBpcyBpbnZhbGlkLicsXG4gICAgICAgIFtcImludmFsaWQtcmVjaXBpZW50LWVtYWlsXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFQ0lQSUVOVF9FTUFJTCAqL106ICdUaGUgZW1haWwgY29ycmVzcG9uZGluZyB0byB0aGlzIGFjdGlvbiBmYWlsZWQgdG8gc2VuZCBhcyB0aGUgcHJvdmlkZWQgJyArXG4gICAgICAgICAgICAncmVjaXBpZW50IGVtYWlsIGFkZHJlc3MgaXMgaW52YWxpZC4nLFxuICAgICAgICBbXCJpbnZhbGlkLXNlbmRlclwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9TRU5ERVIgKi9dOiAnVGhlIGVtYWlsIHRlbXBsYXRlIGNvcnJlc3BvbmRpbmcgdG8gdGhpcyBhY3Rpb24gY29udGFpbnMgYW4gaW52YWxpZCBzZW5kZXIgZW1haWwgb3IgbmFtZS4gJyArXG4gICAgICAgICAgICAnUGxlYXNlIGZpeCBieSBnb2luZyB0byB0aGUgQXV0aCBlbWFpbCB0ZW1wbGF0ZXMgc2VjdGlvbiBpbiB0aGUgRmlyZWJhc2UgQ29uc29sZS4nLFxuICAgICAgICBbXCJpbnZhbGlkLXZlcmlmaWNhdGlvbi1pZFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9TRVNTSU9OX0lORk8gKi9dOiAnVGhlIHZlcmlmaWNhdGlvbiBJRCB1c2VkIHRvIGNyZWF0ZSB0aGUgcGhvbmUgYXV0aCBjcmVkZW50aWFsIGlzIGludmFsaWQuJyxcbiAgICAgICAgW1wiaW52YWxpZC10ZW5hbnQtaWRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfVEVOQU5UX0lEICovXTogXCJUaGUgQXV0aCBpbnN0YW5jZSdzIHRlbmFudCBJRCBpcyBpbnZhbGlkLlwiLFxuICAgICAgICBbXCJsb2dpbi1ibG9ja2VkXCIgLyogQXV0aEVycm9yQ29kZS5MT0dJTl9CTE9DS0VEICovXTogJ0xvZ2luIGJsb2NrZWQgYnkgdXNlci1wcm92aWRlZCBtZXRob2Q6IHskb3JpZ2luYWxNZXNzYWdlfScsXG4gICAgICAgIFtcIm1pc3NpbmctYW5kcm9pZC1wa2ctbmFtZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqL106ICdBbiBBbmRyb2lkIFBhY2thZ2UgTmFtZSBtdXN0IGJlIHByb3ZpZGVkIGlmIHRoZSBBbmRyb2lkIEFwcCBpcyByZXF1aXJlZCB0byBiZSBpbnN0YWxsZWQuJyxcbiAgICAgICAgW1wiYXV0aC1kb21haW4tY29uZmlnLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FVVEhfRE9NQUlOICovXTogJ0JlIHN1cmUgdG8gaW5jbHVkZSBhdXRoRG9tYWluIHdoZW4gY2FsbGluZyBmaXJlYmFzZS5pbml0aWFsaXplQXBwKCksICcgK1xuICAgICAgICAgICAgJ2J5IGZvbGxvd2luZyB0aGUgaW5zdHJ1Y3Rpb25zIGluIHRoZSBGaXJlYmFzZSBjb25zb2xlLicsXG4gICAgICAgIFtcIm1pc3NpbmctYXBwLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQVBQX0NSRURFTlRJQUwgKi9dOiAnVGhlIHBob25lIHZlcmlmaWNhdGlvbiByZXF1ZXN0IGlzIG1pc3NpbmcgYW4gYXBwbGljYXRpb24gdmVyaWZpZXIgJyArXG4gICAgICAgICAgICAnYXNzZXJ0aW9uLiBBIHJlQ0FQVENIQSByZXNwb25zZSB0b2tlbiBuZWVkcyB0byBiZSBwcm92aWRlZC4nLFxuICAgICAgICBbXCJtaXNzaW5nLXZlcmlmaWNhdGlvbi1jb2RlXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0NPREUgKi9dOiAnVGhlIHBob25lIGF1dGggY3JlZGVudGlhbCB3YXMgY3JlYXRlZCB3aXRoIGFuIGVtcHR5IFNNUyB2ZXJpZmljYXRpb24gY29kZS4nLFxuICAgICAgICBbXCJtaXNzaW5nLWNvbnRpbnVlLXVyaVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DT05USU5VRV9VUkkgKi9dOiAnQSBjb250aW51ZSBVUkwgbXVzdCBiZSBwcm92aWRlZCBpbiB0aGUgcmVxdWVzdC4nLFxuICAgICAgICBbXCJtaXNzaW5nLWlmcmFtZS1zdGFydFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19JRlJBTUVfU1RBUlQgKi9dOiAnQW4gaW50ZXJuYWwgQXV0aEVycm9yIGhhcyBvY2N1cnJlZC4nLFxuICAgICAgICBbXCJtaXNzaW5nLWlvcy1idW5kbGUtaWRcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfSU9TX0JVTkRMRV9JRCAqL106ICdBbiBpT1MgQnVuZGxlIElEIG11c3QgYmUgcHJvdmlkZWQgaWYgYW4gQXBwIFN0b3JlIElEIGlzIHByb3ZpZGVkLicsXG4gICAgICAgIFtcIm1pc3Npbmctb3ItaW52YWxpZC1ub25jZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19PUl9JTlZBTElEX05PTkNFICovXTogJ1RoZSByZXF1ZXN0IGRvZXMgbm90IGNvbnRhaW4gYSB2YWxpZCBub25jZS4gVGhpcyBjYW4gb2NjdXIgaWYgdGhlICcgK1xuICAgICAgICAgICAgJ1NIQS0yNTYgaGFzaCBvZiB0aGUgcHJvdmlkZWQgcmF3IG5vbmNlIGRvZXMgbm90IG1hdGNoIHRoZSBoYXNoZWQgbm9uY2UgJyArXG4gICAgICAgICAgICAnaW4gdGhlIElEIHRva2VuIHBheWxvYWQuJyxcbiAgICAgICAgW1wibWlzc2luZy1wYXNzd29yZFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19QQVNTV09SRCAqL106ICdBIG5vbi1lbXB0eSBwYXNzd29yZCBtdXN0IGJlIHByb3ZpZGVkJyxcbiAgICAgICAgW1wibWlzc2luZy1tdWx0aS1mYWN0b3ItaW5mb1wiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19NRkFfSU5GTyAqL106ICdObyBzZWNvbmQgZmFjdG9yIGlkZW50aWZpZXIgaXMgcHJvdmlkZWQuJyxcbiAgICAgICAgW1wibWlzc2luZy1tdWx0aS1mYWN0b3Itc2Vzc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19NRkFfU0VTU0lPTiAqL106ICdUaGUgcmVxdWVzdCBpcyBtaXNzaW5nIHByb29mIG9mIGZpcnN0IGZhY3RvciBzdWNjZXNzZnVsIHNpZ24taW4uJyxcbiAgICAgICAgW1wibWlzc2luZy1waG9uZS1udW1iZXJcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfUEhPTkVfTlVNQkVSICovXTogJ1RvIHNlbmQgdmVyaWZpY2F0aW9uIGNvZGVzLCBwcm92aWRlIGEgcGhvbmUgbnVtYmVyIGZvciB0aGUgcmVjaXBpZW50LicsXG4gICAgICAgIFtcIm1pc3NpbmctdmVyaWZpY2F0aW9uLWlkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1NFU1NJT05fSU5GTyAqL106ICdUaGUgcGhvbmUgYXV0aCBjcmVkZW50aWFsIHdhcyBjcmVhdGVkIHdpdGggYW4gZW1wdHkgdmVyaWZpY2F0aW9uIElELicsXG4gICAgICAgIFtcImFwcC1kZWxldGVkXCIgLyogQXV0aEVycm9yQ29kZS5NT0RVTEVfREVTVFJPWUVEICovXTogJ1RoaXMgaW5zdGFuY2Ugb2YgRmlyZWJhc2VBcHAgaGFzIGJlZW4gZGVsZXRlZC4nLFxuICAgICAgICBbXCJtdWx0aS1mYWN0b3ItaW5mby1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLk1GQV9JTkZPX05PVF9GT1VORCAqL106ICdUaGUgdXNlciBkb2VzIG5vdCBoYXZlIGEgc2Vjb25kIGZhY3RvciBtYXRjaGluZyB0aGUgaWRlbnRpZmllciBwcm92aWRlZC4nLFxuICAgICAgICBbXCJtdWx0aS1mYWN0b3ItYXV0aC1yZXF1aXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuTUZBX1JFUVVJUkVEICovXTogJ1Byb29mIG9mIG93bmVyc2hpcCBvZiBhIHNlY29uZCBmYWN0b3IgaXMgcmVxdWlyZWQgdG8gY29tcGxldGUgc2lnbi1pbi4nLFxuICAgICAgICBbXCJhY2NvdW50LWV4aXN0cy13aXRoLWRpZmZlcmVudC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5ORUVEX0NPTkZJUk1BVElPTiAqL106ICdBbiBhY2NvdW50IGFscmVhZHkgZXhpc3RzIHdpdGggdGhlIHNhbWUgZW1haWwgYWRkcmVzcyBidXQgZGlmZmVyZW50ICcgK1xuICAgICAgICAgICAgJ3NpZ24taW4gY3JlZGVudGlhbHMuIFNpZ24gaW4gdXNpbmcgYSBwcm92aWRlciBhc3NvY2lhdGVkIHdpdGggdGhpcyAnICtcbiAgICAgICAgICAgICdlbWFpbCBhZGRyZXNzLicsXG4gICAgICAgIFtcIm5ldHdvcmstcmVxdWVzdC1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi9dOiAnQSBuZXR3b3JrIEF1dGhFcnJvciAoc3VjaCBhcyB0aW1lb3V0LCBpbnRlcnJ1cHRlZCBjb25uZWN0aW9uIG9yIHVucmVhY2hhYmxlIGhvc3QpIGhhcyBvY2N1cnJlZC4nLFxuICAgICAgICBbXCJuby1hdXRoLWV2ZW50XCIgLyogQXV0aEVycm9yQ29kZS5OT19BVVRIX0VWRU5UICovXTogJ0FuIGludGVybmFsIEF1dGhFcnJvciBoYXMgb2NjdXJyZWQuJyxcbiAgICAgICAgW1wibm8tc3VjaC1wcm92aWRlclwiIC8qIEF1dGhFcnJvckNvZGUuTk9fU1VDSF9QUk9WSURFUiAqL106ICdVc2VyIHdhcyBub3QgbGlua2VkIHRvIGFuIGFjY291bnQgd2l0aCB0aGUgZ2l2ZW4gcHJvdmlkZXIuJyxcbiAgICAgICAgW1wibnVsbC11c2VyXCIgLyogQXV0aEVycm9yQ29kZS5OVUxMX1VTRVIgKi9dOiAnQSBudWxsIHVzZXIgb2JqZWN0IHdhcyBwcm92aWRlZCBhcyB0aGUgYXJndW1lbnQgZm9yIGFuIG9wZXJhdGlvbiB3aGljaCAnICtcbiAgICAgICAgICAgICdyZXF1aXJlcyBhIG5vbi1udWxsIHVzZXIgb2JqZWN0LicsXG4gICAgICAgIFtcIm9wZXJhdGlvbi1ub3QtYWxsb3dlZFwiIC8qIEF1dGhFcnJvckNvZGUuT1BFUkFUSU9OX05PVF9BTExPV0VEICovXTogJ1RoZSBnaXZlbiBzaWduLWluIHByb3ZpZGVyIGlzIGRpc2FibGVkIGZvciB0aGlzIEZpcmViYXNlIHByb2plY3QuICcgK1xuICAgICAgICAgICAgJ0VuYWJsZSBpdCBpbiB0aGUgRmlyZWJhc2UgY29uc29sZSwgdW5kZXIgdGhlIHNpZ24taW4gbWV0aG9kIHRhYiBvZiB0aGUgJyArXG4gICAgICAgICAgICAnQXV0aCBzZWN0aW9uLicsXG4gICAgICAgIFtcIm9wZXJhdGlvbi1ub3Qtc3VwcG9ydGVkLWluLXRoaXMtZW52aXJvbm1lbnRcIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfU1VQUE9SVEVEICovXTogJ1RoaXMgb3BlcmF0aW9uIGlzIG5vdCBzdXBwb3J0ZWQgaW4gdGhlIGVudmlyb25tZW50IHRoaXMgYXBwbGljYXRpb24gaXMgJyArXG4gICAgICAgICAgICAncnVubmluZyBvbi4gXCJsb2NhdGlvbi5wcm90b2NvbFwiIG11c3QgYmUgaHR0cCwgaHR0cHMgb3IgY2hyb21lLWV4dGVuc2lvbicgK1xuICAgICAgICAgICAgJyBhbmQgd2ViIHN0b3JhZ2UgbXVzdCBiZSBlbmFibGVkLicsXG4gICAgICAgIFtcInBvcHVwLWJsb2NrZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlBPUFVQX0JMT0NLRUQgKi9dOiAnVW5hYmxlIHRvIGVzdGFibGlzaCBhIGNvbm5lY3Rpb24gd2l0aCB0aGUgcG9wdXAuIEl0IG1heSBoYXZlIGJlZW4gYmxvY2tlZCBieSB0aGUgYnJvd3Nlci4nLFxuICAgICAgICBbXCJwb3B1cC1jbG9zZWQtYnktdXNlclwiIC8qIEF1dGhFcnJvckNvZGUuUE9QVVBfQ0xPU0VEX0JZX1VTRVIgKi9dOiAnVGhlIHBvcHVwIGhhcyBiZWVuIGNsb3NlZCBieSB0aGUgdXNlciBiZWZvcmUgZmluYWxpemluZyB0aGUgb3BlcmF0aW9uLicsXG4gICAgICAgIFtcInByb3ZpZGVyLWFscmVhZHktbGlua2VkXCIgLyogQXV0aEVycm9yQ29kZS5QUk9WSURFUl9BTFJFQURZX0xJTktFRCAqL106ICdVc2VyIGNhbiBvbmx5IGJlIGxpbmtlZCB0byBvbmUgaWRlbnRpdHkgZm9yIHRoZSBnaXZlbiBwcm92aWRlci4nLFxuICAgICAgICBbXCJxdW90YS1leGNlZWRlZFwiIC8qIEF1dGhFcnJvckNvZGUuUVVPVEFfRVhDRUVERUQgKi9dOiBcIlRoZSBwcm9qZWN0J3MgcXVvdGEgZm9yIHRoaXMgb3BlcmF0aW9uIGhhcyBiZWVuIGV4Y2VlZGVkLlwiLFxuICAgICAgICBbXCJyZWRpcmVjdC1jYW5jZWxsZWQtYnktdXNlclwiIC8qIEF1dGhFcnJvckNvZGUuUkVESVJFQ1RfQ0FOQ0VMTEVEX0JZX1VTRVIgKi9dOiAnVGhlIHJlZGlyZWN0IG9wZXJhdGlvbiBoYXMgYmVlbiBjYW5jZWxsZWQgYnkgdGhlIHVzZXIgYmVmb3JlIGZpbmFsaXppbmcuJyxcbiAgICAgICAgW1wicmVkaXJlY3Qtb3BlcmF0aW9uLXBlbmRpbmdcIiAvKiBBdXRoRXJyb3JDb2RlLlJFRElSRUNUX09QRVJBVElPTl9QRU5ESU5HICovXTogJ0EgcmVkaXJlY3Qgc2lnbi1pbiBvcGVyYXRpb24gaXMgYWxyZWFkeSBwZW5kaW5nLicsXG4gICAgICAgIFtcInJlamVjdGVkLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLlJFSkVDVEVEX0NSRURFTlRJQUwgKi9dOiAnVGhlIHJlcXVlc3QgY29udGFpbnMgbWFsZm9ybWVkIG9yIG1pc21hdGNoaW5nIGNyZWRlbnRpYWxzLicsXG4gICAgICAgIFtcInNlY29uZC1mYWN0b3ItYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLlNFQ09ORF9GQUNUT1JfQUxSRUFEWV9FTlJPTExFRCAqL106ICdUaGUgc2Vjb25kIGZhY3RvciBpcyBhbHJlYWR5IGVucm9sbGVkIG9uIHRoaXMgYWNjb3VudC4nLFxuICAgICAgICBbXCJtYXhpbXVtLXNlY29uZC1mYWN0b3ItY291bnQtZXhjZWVkZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQgKi9dOiAnVGhlIG1heGltdW0gYWxsb3dlZCBudW1iZXIgb2Ygc2Vjb25kIGZhY3RvcnMgb24gYSB1c2VyIGhhcyBiZWVuIGV4Y2VlZGVkLicsXG4gICAgICAgIFtcInRlbmFudC1pZC1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuVEVOQU5UX0lEX01JU01BVENIICovXTogXCJUaGUgcHJvdmlkZWQgdGVuYW50IElEIGRvZXMgbm90IG1hdGNoIHRoZSBBdXRoIGluc3RhbmNlJ3MgdGVuYW50IElEXCIsXG4gICAgICAgIFtcInRpbWVvdXRcIiAvKiBBdXRoRXJyb3JDb2RlLlRJTUVPVVQgKi9dOiAnVGhlIG9wZXJhdGlvbiBoYXMgdGltZWQgb3V0LicsXG4gICAgICAgIFtcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqL106IFwiVGhlIHVzZXIncyBjcmVkZW50aWFsIGlzIG5vIGxvbmdlciB2YWxpZC4gVGhlIHVzZXIgbXVzdCBzaWduIGluIGFnYWluLlwiLFxuICAgICAgICBbXCJ0b28tbWFueS1yZXF1ZXN0c1wiIC8qIEF1dGhFcnJvckNvZGUuVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSICovXTogJ1dlIGhhdmUgYmxvY2tlZCBhbGwgcmVxdWVzdHMgZnJvbSB0aGlzIGRldmljZSBkdWUgdG8gdW51c3VhbCBhY3Rpdml0eS4gJyArXG4gICAgICAgICAgICAnVHJ5IGFnYWluIGxhdGVyLicsXG4gICAgICAgIFtcInVuYXV0aG9yaXplZC1jb250aW51ZS11cmlcIiAvKiBBdXRoRXJyb3JDb2RlLlVOQVVUSE9SSVpFRF9ET01BSU4gKi9dOiAnVGhlIGRvbWFpbiBvZiB0aGUgY29udGludWUgVVJMIGlzIG5vdCB3aGl0ZWxpc3RlZC4gIFBsZWFzZSB3aGl0ZWxpc3QgJyArXG4gICAgICAgICAgICAndGhlIGRvbWFpbiBpbiB0aGUgRmlyZWJhc2UgY29uc29sZS4nLFxuICAgICAgICBbXCJ1bnN1cHBvcnRlZC1maXJzdC1mYWN0b3JcIiAvKiBBdXRoRXJyb3JDb2RlLlVOU1VQUE9SVEVEX0ZJUlNUX0ZBQ1RPUiAqL106ICdFbnJvbGxpbmcgYSBzZWNvbmQgZmFjdG9yIG9yIHNpZ25pbmcgaW4gd2l0aCBhIG11bHRpLWZhY3RvciBhY2NvdW50IHJlcXVpcmVzIHNpZ24taW4gd2l0aCBhIHN1cHBvcnRlZCBmaXJzdCBmYWN0b3IuJyxcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtcGVyc2lzdGVuY2UtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuVU5TVVBQT1JURURfUEVSU0lTVEVOQ0UgKi9dOiAnVGhlIGN1cnJlbnQgZW52aXJvbm1lbnQgZG9lcyBub3Qgc3VwcG9ydCB0aGUgc3BlY2lmaWVkIHBlcnNpc3RlbmNlIHR5cGUuJyxcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtdGVuYW50LW9wZXJhdGlvblwiIC8qIEF1dGhFcnJvckNvZGUuVU5TVVBQT1JURURfVEVOQU5UX09QRVJBVElPTiAqL106ICdUaGlzIG9wZXJhdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGluIGEgbXVsdGktdGVuYW50IGNvbnRleHQuJyxcbiAgICAgICAgW1widW52ZXJpZmllZC1lbWFpbFwiIC8qIEF1dGhFcnJvckNvZGUuVU5WRVJJRklFRF9FTUFJTCAqL106ICdUaGUgb3BlcmF0aW9uIHJlcXVpcmVzIGEgdmVyaWZpZWQgZW1haWwuJyxcbiAgICAgICAgW1widXNlci1jYW5jZWxsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfQ0FOQ0VMTEVEICovXTogJ1RoZSB1c2VyIGRpZCBub3QgZ3JhbnQgeW91ciBhcHBsaWNhdGlvbiB0aGUgcGVybWlzc2lvbnMgaXQgcmVxdWVzdGVkLicsXG4gICAgICAgIFtcInVzZXItbm90LWZvdW5kXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RFTEVURUQgKi9dOiAnVGhlcmUgaXMgbm8gdXNlciByZWNvcmQgY29ycmVzcG9uZGluZyB0byB0aGlzIGlkZW50aWZpZXIuIFRoZSB1c2VyIG1heSAnICtcbiAgICAgICAgICAgICdoYXZlIGJlZW4gZGVsZXRlZC4nLFxuICAgICAgICBbXCJ1c2VyLWRpc2FibGVkXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RJU0FCTEVEICovXTogJ1RoZSB1c2VyIGFjY291bnQgaGFzIGJlZW4gZGlzYWJsZWQgYnkgYW4gYWRtaW5pc3RyYXRvci4nLFxuICAgICAgICBbXCJ1c2VyLW1pc21hdGNoXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX01JU01BVENIICovXTogJ1RoZSBzdXBwbGllZCBjcmVkZW50aWFscyBkbyBub3QgY29ycmVzcG9uZCB0byB0aGUgcHJldmlvdXNseSBzaWduZWQgaW4gdXNlci4nLFxuICAgICAgICBbXCJ1c2VyLXNpZ25lZC1vdXRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfU0lHTkVEX09VVCAqL106ICcnLFxuICAgICAgICBbXCJ3ZWFrLXBhc3N3b3JkXCIgLyogQXV0aEVycm9yQ29kZS5XRUFLX1BBU1NXT1JEICovXTogJ1RoZSBwYXNzd29yZCBtdXN0IGJlIDYgY2hhcmFjdGVycyBsb25nIG9yIG1vcmUuJyxcbiAgICAgICAgW1wid2ViLXN0b3JhZ2UtdW5zdXBwb3J0ZWRcIiAvKiBBdXRoRXJyb3JDb2RlLldFQl9TVE9SQUdFX1VOU1VQUE9SVEVEICovXTogJ1RoaXMgYnJvd3NlciBpcyBub3Qgc3VwcG9ydGVkIG9yIDNyZCBwYXJ0eSBjb29raWVzIGFuZCBkYXRhIG1heSBiZSBkaXNhYmxlZC4nLFxuICAgICAgICBbXCJhbHJlYWR5LWluaXRpYWxpemVkXCIgLyogQXV0aEVycm9yQ29kZS5BTFJFQURZX0lOSVRJQUxJWkVEICovXTogJ2luaXRpYWxpemVBdXRoKCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQgd2l0aCAnICtcbiAgICAgICAgICAgICdkaWZmZXJlbnQgb3B0aW9ucy4gVG8gYXZvaWQgdGhpcyBlcnJvciwgY2FsbCBpbml0aWFsaXplQXV0aCgpIHdpdGggdGhlICcgK1xuICAgICAgICAgICAgJ3NhbWUgb3B0aW9ucyBhcyB3aGVuIGl0IHdhcyBvcmlnaW5hbGx5IGNhbGxlZCwgb3IgY2FsbCBnZXRBdXRoKCkgdG8gcmV0dXJuIHRoZScgK1xuICAgICAgICAgICAgJyBhbHJlYWR5IGluaXRpYWxpemVkIGluc3RhbmNlLicsXG4gICAgICAgIFtcIm1pc3NpbmctcmVjYXB0Y2hhLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqL106ICdUaGUgcmVDQVBUQ0hBIHRva2VuIGlzIG1pc3Npbmcgd2hlbiBzZW5kaW5nIHJlcXVlc3QgdG8gdGhlIGJhY2tlbmQuJyxcbiAgICAgICAgW1wiaW52YWxpZC1yZWNhcHRjaGEtdG9rZW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVDQVBUQ0hBX1RPS0VOICovXTogJ1RoZSByZUNBUFRDSEEgdG9rZW4gaXMgaW52YWxpZCB3aGVuIHNlbmRpbmcgcmVxdWVzdCB0byB0aGUgYmFja2VuZC4nLFxuICAgICAgICBbXCJpbnZhbGlkLXJlY2FwdGNoYS1hY3Rpb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVDQVBUQ0hBX0FDVElPTiAqL106ICdUaGUgcmVDQVBUQ0hBIGFjdGlvbiBpcyBpbnZhbGlkIHdoZW4gc2VuZGluZyByZXF1ZXN0IHRvIHRoZSBiYWNrZW5kLicsXG4gICAgICAgIFtcInJlY2FwdGNoYS1ub3QtZW5hYmxlZFwiIC8qIEF1dGhFcnJvckNvZGUuUkVDQVBUQ0hBX05PVF9FTkFCTEVEICovXTogJ3JlQ0FQVENIQSBFbnRlcnByaXNlIGludGVncmF0aW9uIGlzIG5vdCBlbmFibGVkIGZvciB0aGlzIHByb2plY3QuJyxcbiAgICAgICAgW1wibWlzc2luZy1jbGllbnQtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DTElFTlRfVFlQRSAqL106ICdUaGUgcmVDQVBUQ0hBIGNsaWVudCB0eXBlIGlzIG1pc3Npbmcgd2hlbiBzZW5kaW5nIHJlcXVlc3QgdG8gdGhlIGJhY2tlbmQuJyxcbiAgICAgICAgW1wibWlzc2luZy1yZWNhcHRjaGEtdmVyc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19SRUNBUFRDSEFfVkVSU0lPTiAqL106ICdUaGUgcmVDQVBUQ0hBIHZlcnNpb24gaXMgbWlzc2luZyB3aGVuIHNlbmRpbmcgcmVxdWVzdCB0byB0aGUgYmFja2VuZC4nLFxuICAgICAgICBbXCJpbnZhbGlkLXJlcS10eXBlXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1JFUV9UWVBFICovXTogJ0ludmFsaWQgcmVxdWVzdCBwYXJhbWV0ZXJzLicsXG4gICAgICAgIFtcImludmFsaWQtcmVjYXB0Y2hhLXZlcnNpb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT04gKi9dOiAnVGhlIHJlQ0FQVENIQSB2ZXJzaW9uIGlzIGludmFsaWQgd2hlbiBzZW5kaW5nIHJlcXVlc3QgdG8gdGhlIGJhY2tlbmQuJyxcbiAgICAgICAgW1widW5zdXBwb3J0ZWQtcGFzc3dvcmQtcG9saWN5LXNjaGVtYS12ZXJzaW9uXCIgLyogQXV0aEVycm9yQ29kZS5VTlNVUFBPUlRFRF9QQVNTV09SRF9QT0xJQ1lfU0NIRU1BX1ZFUlNJT04gKi9dOiAnVGhlIHBhc3N3b3JkIHBvbGljeSByZWNlaXZlZCBmcm9tIHRoZSBiYWNrZW5kIHVzZXMgYSBzY2hlbWEgdmVyc2lvbiB0aGF0IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyB2ZXJzaW9uIG9mIHRoZSBGaXJlYmFzZSBTREsuJyxcbiAgICAgICAgW1wicGFzc3dvcmQtZG9lcy1ub3QtbWVldC1yZXF1aXJlbWVudHNcIiAvKiBBdXRoRXJyb3JDb2RlLlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTICovXTogJ1RoZSBwYXNzd29yZCBkb2VzIG5vdCBtZWV0IHRoZSByZXF1aXJlbWVudHMuJyxcbiAgICAgICAgW1wiaW52YWxpZC1ob3N0aW5nLWxpbmstZG9tYWluXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0hPU1RJTkdfTElOS19ET01BSU4gKi9dOiAnVGhlIHByb3ZpZGVkIEhvc3RpbmcgbGluayBkb21haW4gaXMgbm90IGNvbmZpZ3VyZWQgaW4gRmlyZWJhc2UgSG9zdGluZyBvciBpcyBub3Qgb3duZWQgYnkgJyArXG4gICAgICAgICAgICAndGhlIGN1cnJlbnQgcHJvamVjdC4gVGhpcyBjYW5ub3QgYmUgYSBkZWZhdWx0IEhvc3RpbmcgZG9tYWluIChgd2ViLmFwcGAgb3IgYGZpcmViYXNlYXBwLmNvbWApLidcbiAgICB9O1xufVxuZnVuY3Rpb24gX3Byb2RFcnJvck1hcCgpIHtcbiAgICAvLyBXZSB3aWxsIGluY2x1ZGUgdGhpcyBvbmUgbWVzc2FnZSBpbiB0aGUgcHJvZCBlcnJvciBtYXAgc2luY2UgYnkgdGhlIHZlcnlcbiAgICAvLyBuYXR1cmUgb2YgdGhpcyBlcnJvciwgZGV2ZWxvcGVycyB3aWxsIG5ldmVyIGJlIGFibGUgdG8gc2VlIHRoZSBtZXNzYWdlXG4gICAgLy8gdXNpbmcgdGhlIGRlYnVnRXJyb3JNYXAgKHdoaWNoIGlzIGluc3RhbGxlZCBkdXJpbmcgYXV0aCBpbml0aWFsaXphdGlvbikuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgW1wiZGVwZW5kZW50LXNkay1pbml0aWFsaXplZC1iZWZvcmUtYXV0aFwiIC8qIEF1dGhFcnJvckNvZGUuREVQRU5ERU5UX1NES19JTklUX0JFRk9SRV9BVVRIICovXTogJ0Fub3RoZXIgRmlyZWJhc2UgU0RLIHdhcyBpbml0aWFsaXplZCBhbmQgaXMgdHJ5aW5nIHRvIHVzZSBBdXRoIGJlZm9yZSBBdXRoIGlzICcgK1xuICAgICAgICAgICAgJ2luaXRpYWxpemVkLiBQbGVhc2UgYmUgc3VyZSB0byBjYWxsIGBpbml0aWFsaXplQXV0aGAgb3IgYGdldEF1dGhgIGJlZm9yZSAnICtcbiAgICAgICAgICAgICdzdGFydGluZyBhbnkgb3RoZXIgRmlyZWJhc2UgU0RLLidcbiAgICB9O1xufVxuLyoqXG4gKiBBIHZlcmJvc2UgZXJyb3IgbWFwIHdpdGggZGV0YWlsZWQgZGVzY3JpcHRpb25zIGZvciBtb3N0IGVycm9yIGNvZGVzLlxuICpcbiAqIFNlZSBkaXNjdXNzaW9uIGF0IHtAbGluayBBdXRoRXJyb3JNYXB9XG4gKlxuICogQHB1YmxpY1xuICovXG5jb25zdCBkZWJ1Z0Vycm9yTWFwID0gX2RlYnVnRXJyb3JNYXA7XG4vKipcbiAqIEEgbWluaW1hbCBlcnJvciBtYXAgd2l0aCBhbGwgdmVyYm9zZSBlcnJvciBtZXNzYWdlcyBzdHJpcHBlZC5cbiAqXG4gKiBTZWUgZGlzY3Vzc2lvbiBhdCB7QGxpbmsgQXV0aEVycm9yTWFwfVxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY29uc3QgcHJvZEVycm9yTWFwID0gX3Byb2RFcnJvck1hcDtcbmNvbnN0IF9ERUZBVUxUX0FVVEhfRVJST1JfRkFDVE9SWSA9IG5ldyBFcnJvckZhY3RvcnkoJ2F1dGgnLCAnRmlyZWJhc2UnLCBfcHJvZEVycm9yTWFwKCkpO1xuLyoqXG4gKiBBIG1hcCBvZiBwb3RlbnRpYWwgYEF1dGhgIGVycm9yIGNvZGVzLCBmb3IgZWFzaWVyIGNvbXBhcmlzb24gd2l0aCBlcnJvcnNcbiAqIHRocm93biBieSB0aGUgU0RLLlxuICpcbiAqIEByZW1hcmtzXG4gKiBOb3RlIHRoYXQgeW91IGNhbid0IHRyZWUtc2hha2UgaW5kaXZpZHVhbCBrZXlzXG4gKiBpbiB0aGUgbWFwLCBzbyBieSB1c2luZyB0aGUgbWFwIHlvdSBtaWdodCBzdWJzdGFudGlhbGx5IGluY3JlYXNlIHlvdXJcbiAqIGJ1bmRsZSBzaXplLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY29uc3QgQVVUSF9FUlJPUl9DT0RFU19NQVBfRE9fTk9UX1VTRV9JTlRFUk5BTExZID0ge1xuICAgIEFETUlOX09OTFlfT1BFUkFUSU9OOiAnYXV0aC9hZG1pbi1yZXN0cmljdGVkLW9wZXJhdGlvbicsXG4gICAgQVJHVU1FTlRfRVJST1I6ICdhdXRoL2FyZ3VtZW50LWVycm9yJyxcbiAgICBBUFBfTk9UX0FVVEhPUklaRUQ6ICdhdXRoL2FwcC1ub3QtYXV0aG9yaXplZCcsXG4gICAgQVBQX05PVF9JTlNUQUxMRUQ6ICdhdXRoL2FwcC1ub3QtaW5zdGFsbGVkJyxcbiAgICBDQVBUQ0hBX0NIRUNLX0ZBSUxFRDogJ2F1dGgvY2FwdGNoYS1jaGVjay1mYWlsZWQnLFxuICAgIENPREVfRVhQSVJFRDogJ2F1dGgvY29kZS1leHBpcmVkJyxcbiAgICBDT1JET1ZBX05PVF9SRUFEWTogJ2F1dGgvY29yZG92YS1ub3QtcmVhZHknLFxuICAgIENPUlNfVU5TVVBQT1JURUQ6ICdhdXRoL2NvcnMtdW5zdXBwb3J0ZWQnLFxuICAgIENSRURFTlRJQUxfQUxSRUFEWV9JTl9VU0U6ICdhdXRoL2NyZWRlbnRpYWwtYWxyZWFkeS1pbi11c2UnLFxuICAgIENSRURFTlRJQUxfTUlTTUFUQ0g6ICdhdXRoL2N1c3RvbS10b2tlbi1taXNtYXRjaCcsXG4gICAgQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOOiAnYXV0aC9yZXF1aXJlcy1yZWNlbnQtbG9naW4nLFxuICAgIERFUEVOREVOVF9TREtfSU5JVF9CRUZPUkVfQVVUSDogJ2F1dGgvZGVwZW5kZW50LXNkay1pbml0aWFsaXplZC1iZWZvcmUtYXV0aCcsXG4gICAgRFlOQU1JQ19MSU5LX05PVF9BQ1RJVkFURUQ6ICdhdXRoL2R5bmFtaWMtbGluay1ub3QtYWN0aXZhdGVkJyxcbiAgICBFTUFJTF9DSEFOR0VfTkVFRFNfVkVSSUZJQ0FUSU9OOiAnYXV0aC9lbWFpbC1jaGFuZ2UtbmVlZHMtdmVyaWZpY2F0aW9uJyxcbiAgICBFTUFJTF9FWElTVFM6ICdhdXRoL2VtYWlsLWFscmVhZHktaW4tdXNlJyxcbiAgICBFTVVMQVRPUl9DT05GSUdfRkFJTEVEOiAnYXV0aC9lbXVsYXRvci1jb25maWctZmFpbGVkJyxcbiAgICBFWFBJUkVEX09PQl9DT0RFOiAnYXV0aC9leHBpcmVkLWFjdGlvbi1jb2RlJyxcbiAgICBFWFBJUkVEX1BPUFVQX1JFUVVFU1Q6ICdhdXRoL2NhbmNlbGxlZC1wb3B1cC1yZXF1ZXN0JyxcbiAgICBJTlRFUk5BTF9FUlJPUjogJ2F1dGgvaW50ZXJuYWwtZXJyb3InLFxuICAgIElOVkFMSURfQVBJX0tFWTogJ2F1dGgvaW52YWxpZC1hcGkta2V5JyxcbiAgICBJTlZBTElEX0FQUF9DUkVERU5USUFMOiAnYXV0aC9pbnZhbGlkLWFwcC1jcmVkZW50aWFsJyxcbiAgICBJTlZBTElEX0FQUF9JRDogJ2F1dGgvaW52YWxpZC1hcHAtaWQnLFxuICAgIElOVkFMSURfQVVUSDogJ2F1dGgvaW52YWxpZC11c2VyLXRva2VuJyxcbiAgICBJTlZBTElEX0FVVEhfRVZFTlQ6ICdhdXRoL2ludmFsaWQtYXV0aC1ldmVudCcsXG4gICAgSU5WQUxJRF9DRVJUX0hBU0g6ICdhdXRoL2ludmFsaWQtY2VydC1oYXNoJyxcbiAgICBJTlZBTElEX0NPREU6ICdhdXRoL2ludmFsaWQtdmVyaWZpY2F0aW9uLWNvZGUnLFxuICAgIElOVkFMSURfQ09OVElOVUVfVVJJOiAnYXV0aC9pbnZhbGlkLWNvbnRpbnVlLXVyaScsXG4gICAgSU5WQUxJRF9DT1JET1ZBX0NPTkZJR1VSQVRJT046ICdhdXRoL2ludmFsaWQtY29yZG92YS1jb25maWd1cmF0aW9uJyxcbiAgICBJTlZBTElEX0NVU1RPTV9UT0tFTjogJ2F1dGgvaW52YWxpZC1jdXN0b20tdG9rZW4nLFxuICAgIElOVkFMSURfRFlOQU1JQ19MSU5LX0RPTUFJTjogJ2F1dGgvaW52YWxpZC1keW5hbWljLWxpbmstZG9tYWluJyxcbiAgICBJTlZBTElEX0VNQUlMOiAnYXV0aC9pbnZhbGlkLWVtYWlsJyxcbiAgICBJTlZBTElEX0VNVUxBVE9SX1NDSEVNRTogJ2F1dGgvaW52YWxpZC1lbXVsYXRvci1zY2hlbWUnLFxuICAgIElOVkFMSURfSURQX1JFU1BPTlNFOiAnYXV0aC9pbnZhbGlkLWNyZWRlbnRpYWwnLFxuICAgIElOVkFMSURfTE9HSU5fQ1JFREVOVElBTFM6ICdhdXRoL2ludmFsaWQtY3JlZGVudGlhbCcsXG4gICAgSU5WQUxJRF9NRVNTQUdFX1BBWUxPQUQ6ICdhdXRoL2ludmFsaWQtbWVzc2FnZS1wYXlsb2FkJyxcbiAgICBJTlZBTElEX01GQV9TRVNTSU9OOiAnYXV0aC9pbnZhbGlkLW11bHRpLWZhY3Rvci1zZXNzaW9uJyxcbiAgICBJTlZBTElEX09BVVRIX0NMSUVOVF9JRDogJ2F1dGgvaW52YWxpZC1vYXV0aC1jbGllbnQtaWQnLFxuICAgIElOVkFMSURfT0FVVEhfUFJPVklERVI6ICdhdXRoL2ludmFsaWQtb2F1dGgtcHJvdmlkZXInLFxuICAgIElOVkFMSURfT09CX0NPREU6ICdhdXRoL2ludmFsaWQtYWN0aW9uLWNvZGUnLFxuICAgIElOVkFMSURfT1JJR0lOOiAnYXV0aC91bmF1dGhvcml6ZWQtZG9tYWluJyxcbiAgICBJTlZBTElEX1BBU1NXT1JEOiAnYXV0aC93cm9uZy1wYXNzd29yZCcsXG4gICAgSU5WQUxJRF9QRVJTSVNURU5DRTogJ2F1dGgvaW52YWxpZC1wZXJzaXN0ZW5jZS10eXBlJyxcbiAgICBJTlZBTElEX1BIT05FX05VTUJFUjogJ2F1dGgvaW52YWxpZC1waG9uZS1udW1iZXInLFxuICAgIElOVkFMSURfUFJPVklERVJfSUQ6ICdhdXRoL2ludmFsaWQtcHJvdmlkZXItaWQnLFxuICAgIElOVkFMSURfUkVDSVBJRU5UX0VNQUlMOiAnYXV0aC9pbnZhbGlkLXJlY2lwaWVudC1lbWFpbCcsXG4gICAgSU5WQUxJRF9TRU5ERVI6ICdhdXRoL2ludmFsaWQtc2VuZGVyJyxcbiAgICBJTlZBTElEX1NFU1NJT05fSU5GTzogJ2F1dGgvaW52YWxpZC12ZXJpZmljYXRpb24taWQnLFxuICAgIElOVkFMSURfVEVOQU5UX0lEOiAnYXV0aC9pbnZhbGlkLXRlbmFudC1pZCcsXG4gICAgTUZBX0lORk9fTk9UX0ZPVU5EOiAnYXV0aC9tdWx0aS1mYWN0b3ItaW5mby1ub3QtZm91bmQnLFxuICAgIE1GQV9SRVFVSVJFRDogJ2F1dGgvbXVsdGktZmFjdG9yLWF1dGgtcmVxdWlyZWQnLFxuICAgIE1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUU6ICdhdXRoL21pc3NpbmctYW5kcm9pZC1wa2ctbmFtZScsXG4gICAgTUlTU0lOR19BUFBfQ1JFREVOVElBTDogJ2F1dGgvbWlzc2luZy1hcHAtY3JlZGVudGlhbCcsXG4gICAgTUlTU0lOR19BVVRIX0RPTUFJTjogJ2F1dGgvYXV0aC1kb21haW4tY29uZmlnLXJlcXVpcmVkJyxcbiAgICBNSVNTSU5HX0NPREU6ICdhdXRoL21pc3NpbmctdmVyaWZpY2F0aW9uLWNvZGUnLFxuICAgIE1JU1NJTkdfQ09OVElOVUVfVVJJOiAnYXV0aC9taXNzaW5nLWNvbnRpbnVlLXVyaScsXG4gICAgTUlTU0lOR19JRlJBTUVfU1RBUlQ6ICdhdXRoL21pc3NpbmctaWZyYW1lLXN0YXJ0JyxcbiAgICBNSVNTSU5HX0lPU19CVU5ETEVfSUQ6ICdhdXRoL21pc3NpbmctaW9zLWJ1bmRsZS1pZCcsXG4gICAgTUlTU0lOR19PUl9JTlZBTElEX05PTkNFOiAnYXV0aC9taXNzaW5nLW9yLWludmFsaWQtbm9uY2UnLFxuICAgIE1JU1NJTkdfTUZBX0lORk86ICdhdXRoL21pc3NpbmctbXVsdGktZmFjdG9yLWluZm8nLFxuICAgIE1JU1NJTkdfTUZBX1NFU1NJT046ICdhdXRoL21pc3NpbmctbXVsdGktZmFjdG9yLXNlc3Npb24nLFxuICAgIE1JU1NJTkdfUEhPTkVfTlVNQkVSOiAnYXV0aC9taXNzaW5nLXBob25lLW51bWJlcicsXG4gICAgTUlTU0lOR19TRVNTSU9OX0lORk86ICdhdXRoL21pc3NpbmctdmVyaWZpY2F0aW9uLWlkJyxcbiAgICBNT0RVTEVfREVTVFJPWUVEOiAnYXV0aC9hcHAtZGVsZXRlZCcsXG4gICAgTkVFRF9DT05GSVJNQVRJT046ICdhdXRoL2FjY291bnQtZXhpc3RzLXdpdGgtZGlmZmVyZW50LWNyZWRlbnRpYWwnLFxuICAgIE5FVFdPUktfUkVRVUVTVF9GQUlMRUQ6ICdhdXRoL25ldHdvcmstcmVxdWVzdC1mYWlsZWQnLFxuICAgIE5VTExfVVNFUjogJ2F1dGgvbnVsbC11c2VyJyxcbiAgICBOT19BVVRIX0VWRU5UOiAnYXV0aC9uby1hdXRoLWV2ZW50JyxcbiAgICBOT19TVUNIX1BST1ZJREVSOiAnYXV0aC9uby1zdWNoLXByb3ZpZGVyJyxcbiAgICBPUEVSQVRJT05fTk9UX0FMTE9XRUQ6ICdhdXRoL29wZXJhdGlvbi1ub3QtYWxsb3dlZCcsXG4gICAgT1BFUkFUSU9OX05PVF9TVVBQT1JURUQ6ICdhdXRoL29wZXJhdGlvbi1ub3Qtc3VwcG9ydGVkLWluLXRoaXMtZW52aXJvbm1lbnQnLFxuICAgIFBPUFVQX0JMT0NLRUQ6ICdhdXRoL3BvcHVwLWJsb2NrZWQnLFxuICAgIFBPUFVQX0NMT1NFRF9CWV9VU0VSOiAnYXV0aC9wb3B1cC1jbG9zZWQtYnktdXNlcicsXG4gICAgUFJPVklERVJfQUxSRUFEWV9MSU5LRUQ6ICdhdXRoL3Byb3ZpZGVyLWFscmVhZHktbGlua2VkJyxcbiAgICBRVU9UQV9FWENFRURFRDogJ2F1dGgvcXVvdGEtZXhjZWVkZWQnLFxuICAgIFJFRElSRUNUX0NBTkNFTExFRF9CWV9VU0VSOiAnYXV0aC9yZWRpcmVjdC1jYW5jZWxsZWQtYnktdXNlcicsXG4gICAgUkVESVJFQ1RfT1BFUkFUSU9OX1BFTkRJTkc6ICdhdXRoL3JlZGlyZWN0LW9wZXJhdGlvbi1wZW5kaW5nJyxcbiAgICBSRUpFQ1RFRF9DUkVERU5USUFMOiAnYXV0aC9yZWplY3RlZC1jcmVkZW50aWFsJyxcbiAgICBTRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQ6ICdhdXRoL3NlY29uZC1mYWN0b3ItYWxyZWFkeS1pbi11c2UnLFxuICAgIFNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQ6ICdhdXRoL21heGltdW0tc2Vjb25kLWZhY3Rvci1jb3VudC1leGNlZWRlZCcsXG4gICAgVEVOQU5UX0lEX01JU01BVENIOiAnYXV0aC90ZW5hbnQtaWQtbWlzbWF0Y2gnLFxuICAgIFRJTUVPVVQ6ICdhdXRoL3RpbWVvdXQnLFxuICAgIFRPS0VOX0VYUElSRUQ6ICdhdXRoL3VzZXItdG9rZW4tZXhwaXJlZCcsXG4gICAgVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSOiAnYXV0aC90b28tbWFueS1yZXF1ZXN0cycsXG4gICAgVU5BVVRIT1JJWkVEX0RPTUFJTjogJ2F1dGgvdW5hdXRob3JpemVkLWNvbnRpbnVlLXVyaScsXG4gICAgVU5TVVBQT1JURURfRklSU1RfRkFDVE9SOiAnYXV0aC91bnN1cHBvcnRlZC1maXJzdC1mYWN0b3InLFxuICAgIFVOU1VQUE9SVEVEX1BFUlNJU1RFTkNFOiAnYXV0aC91bnN1cHBvcnRlZC1wZXJzaXN0ZW5jZS10eXBlJyxcbiAgICBVTlNVUFBPUlRFRF9URU5BTlRfT1BFUkFUSU9OOiAnYXV0aC91bnN1cHBvcnRlZC10ZW5hbnQtb3BlcmF0aW9uJyxcbiAgICBVTlZFUklGSUVEX0VNQUlMOiAnYXV0aC91bnZlcmlmaWVkLWVtYWlsJyxcbiAgICBVU0VSX0NBTkNFTExFRDogJ2F1dGgvdXNlci1jYW5jZWxsZWQnLFxuICAgIFVTRVJfREVMRVRFRDogJ2F1dGgvdXNlci1ub3QtZm91bmQnLFxuICAgIFVTRVJfRElTQUJMRUQ6ICdhdXRoL3VzZXItZGlzYWJsZWQnLFxuICAgIFVTRVJfTUlTTUFUQ0g6ICdhdXRoL3VzZXItbWlzbWF0Y2gnLFxuICAgIFVTRVJfU0lHTkVEX09VVDogJ2F1dGgvdXNlci1zaWduZWQtb3V0JyxcbiAgICBXRUFLX1BBU1NXT1JEOiAnYXV0aC93ZWFrLXBhc3N3b3JkJyxcbiAgICBXRUJfU1RPUkFHRV9VTlNVUFBPUlRFRDogJ2F1dGgvd2ViLXN0b3JhZ2UtdW5zdXBwb3J0ZWQnLFxuICAgIEFMUkVBRFlfSU5JVElBTElaRUQ6ICdhdXRoL2FscmVhZHktaW5pdGlhbGl6ZWQnLFxuICAgIFJFQ0FQVENIQV9OT1RfRU5BQkxFRDogJ2F1dGgvcmVjYXB0Y2hhLW5vdC1lbmFibGVkJyxcbiAgICBNSVNTSU5HX1JFQ0FQVENIQV9UT0tFTjogJ2F1dGgvbWlzc2luZy1yZWNhcHRjaGEtdG9rZW4nLFxuICAgIElOVkFMSURfUkVDQVBUQ0hBX1RPS0VOOiAnYXV0aC9pbnZhbGlkLXJlY2FwdGNoYS10b2tlbicsXG4gICAgSU5WQUxJRF9SRUNBUFRDSEFfQUNUSU9OOiAnYXV0aC9pbnZhbGlkLXJlY2FwdGNoYS1hY3Rpb24nLFxuICAgIE1JU1NJTkdfQ0xJRU5UX1RZUEU6ICdhdXRoL21pc3NpbmctY2xpZW50LXR5cGUnLFxuICAgIE1JU1NJTkdfUkVDQVBUQ0hBX1ZFUlNJT046ICdhdXRoL21pc3NpbmctcmVjYXB0Y2hhLXZlcnNpb24nLFxuICAgIElOVkFMSURfUkVDQVBUQ0hBX1ZFUlNJT046ICdhdXRoL2ludmFsaWQtcmVjYXB0Y2hhLXZlcnNpb24nLFxuICAgIElOVkFMSURfUkVRX1RZUEU6ICdhdXRoL2ludmFsaWQtcmVxLXR5cGUnLFxuICAgIElOVkFMSURfSE9TVElOR19MSU5LX0RPTUFJTjogJ2F1dGgvaW52YWxpZC1ob3N0aW5nLWxpbmstZG9tYWluJ1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IGxvZ0NsaWVudCA9IG5ldyBMb2dnZXIoJ0BmaXJlYmFzZS9hdXRoJyk7XG5mdW5jdGlvbiBfbG9nV2Fybihtc2csIC4uLmFyZ3MpIHtcbiAgICBpZiAobG9nQ2xpZW50LmxvZ0xldmVsIDw9IExvZ0xldmVsLldBUk4pIHtcbiAgICAgICAgbG9nQ2xpZW50Lndhcm4oYEF1dGggKCR7U0RLX1ZFUlNJT059KTogJHttc2d9YCwgLi4uYXJncyk7XG4gICAgfVxufVxuZnVuY3Rpb24gX2xvZ0Vycm9yKG1zZywgLi4uYXJncykge1xuICAgIGlmIChsb2dDbGllbnQubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuRVJST1IpIHtcbiAgICAgICAgbG9nQ2xpZW50LmVycm9yKGBBdXRoICgke1NES19WRVJTSU9OfSk6ICR7bXNnfWAsIC4uLmFyZ3MpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIF9mYWlsKGF1dGhPckNvZGUsIC4uLnJlc3QpIHtcbiAgICB0aHJvdyBjcmVhdGVFcnJvckludGVybmFsKGF1dGhPckNvZGUsIC4uLnJlc3QpO1xufVxuZnVuY3Rpb24gX2NyZWF0ZUVycm9yKGF1dGhPckNvZGUsIC4uLnJlc3QpIHtcbiAgICByZXR1cm4gY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KTtcbn1cbmZ1bmN0aW9uIF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIGNvZGUsIG1lc3NhZ2UpIHtcbiAgICBjb25zdCBlcnJvck1hcCA9IE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgcHJvZEVycm9yTWFwKCkpLCB7IFtjb2RlXTogbWVzc2FnZSB9KTtcbiAgICBjb25zdCBmYWN0b3J5ID0gbmV3IEVycm9yRmFjdG9yeSgnYXV0aCcsICdGaXJlYmFzZScsIGVycm9yTWFwKTtcbiAgICByZXR1cm4gZmFjdG9yeS5jcmVhdGUoY29kZSwge1xuICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWVcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpIHtcbiAgICByZXR1cm4gX2Vycm9yV2l0aEN1c3RvbU1lc3NhZ2UoYXV0aCwgXCJvcGVyYXRpb24tbm90LXN1cHBvcnRlZC1pbi10aGlzLWVudmlyb25tZW50XCIgLyogQXV0aEVycm9yQ29kZS5PUEVSQVRJT05fTk9UX1NVUFBPUlRFRCAqLywgJ09wZXJhdGlvbnMgdGhhdCBhbHRlciB0aGUgY3VycmVudCB1c2VyIGFyZSBub3Qgc3VwcG9ydGVkIGluIGNvbmp1bmN0aW9uIHdpdGggRmlyZWJhc2VTZXJ2ZXJBcHAnKTtcbn1cbmZ1bmN0aW9uIF9hc3NlcnRJbnN0YW5jZU9mKGF1dGgsIG9iamVjdCwgaW5zdGFuY2UpIHtcbiAgICBjb25zdCBjb25zdHJ1Y3Rvckluc3RhbmNlID0gaW5zdGFuY2U7XG4gICAgaWYgKCEob2JqZWN0IGluc3RhbmNlb2YgY29uc3RydWN0b3JJbnN0YW5jZSkpIHtcbiAgICAgICAgaWYgKGNvbnN0cnVjdG9ySW5zdGFuY2UubmFtZSAhPT0gb2JqZWN0LmNvbnN0cnVjdG9yLm5hbWUpIHtcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBfZXJyb3JXaXRoQ3VzdG9tTWVzc2FnZShhdXRoLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLywgYFR5cGUgb2YgJHtvYmplY3QuY29uc3RydWN0b3IubmFtZX0gZG9lcyBub3QgbWF0Y2ggZXhwZWN0ZWQgaW5zdGFuY2UuYCArXG4gICAgICAgICAgICBgRGlkIHlvdSBwYXNzIGEgcmVmZXJlbmNlIGZyb20gYSBkaWZmZXJlbnQgQXV0aCBTREs/YCk7XG4gICAgfVxufVxuZnVuY3Rpb24gY3JlYXRlRXJyb3JJbnRlcm5hbChhdXRoT3JDb2RlLCAuLi5yZXN0KSB7XG4gICAgaWYgKHR5cGVvZiBhdXRoT3JDb2RlICE9PSAnc3RyaW5nJykge1xuICAgICAgICBjb25zdCBjb2RlID0gcmVzdFswXTtcbiAgICAgICAgY29uc3QgZnVsbFBhcmFtcyA9IFsuLi5yZXN0LnNsaWNlKDEpXTtcbiAgICAgICAgaWYgKGZ1bGxQYXJhbXNbMF0pIHtcbiAgICAgICAgICAgIGZ1bGxQYXJhbXNbMF0uYXBwTmFtZSA9IGF1dGhPckNvZGUubmFtZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXV0aE9yQ29kZS5fZXJyb3JGYWN0b3J5LmNyZWF0ZShjb2RlLCAuLi5mdWxsUGFyYW1zKTtcbiAgICB9XG4gICAgcmV0dXJuIF9ERUZBVUxUX0FVVEhfRVJST1JfRkFDVE9SWS5jcmVhdGUoYXV0aE9yQ29kZSwgLi4ucmVzdCk7XG59XG5mdW5jdGlvbiBfYXNzZXJ0KGFzc2VydGlvbiwgYXV0aE9yQ29kZSwgLi4ucmVzdCkge1xuICAgIGlmICghYXNzZXJ0aW9uKSB7XG4gICAgICAgIHRocm93IGNyZWF0ZUVycm9ySW50ZXJuYWwoYXV0aE9yQ29kZSwgLi4ucmVzdCk7XG4gICAgfVxufVxuLyoqXG4gKiBVbmNvbmRpdGlvbmFsbHkgZmFpbHMsIHRocm93aW5nIGFuIGludGVybmFsIGVycm9yIHdpdGggdGhlIGdpdmVuIG1lc3NhZ2UuXG4gKlxuICogQHBhcmFtIGZhaWx1cmUgdHlwZSBvZiBmYWlsdXJlIGVuY291bnRlcmVkXG4gKiBAdGhyb3dzIEVycm9yXG4gKi9cbmZ1bmN0aW9uIGRlYnVnRmFpbChmYWlsdXJlKSB7XG4gICAgLy8gTG9nIHRoZSBmYWlsdXJlIGluIGFkZGl0aW9uIHRvIHRocm93IGFuIGV4Y2VwdGlvbiwganVzdCBpbiBjYXNlIHRoZVxuICAgIC8vIGV4Y2VwdGlvbiBpcyBzd2FsbG93ZWQuXG4gICAgY29uc3QgbWVzc2FnZSA9IGBJTlRFUk5BTCBBU1NFUlRJT04gRkFJTEVEOiBgICsgZmFpbHVyZTtcbiAgICBfbG9nRXJyb3IobWVzc2FnZSk7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgdXNlIEZpcmViYXNlRXJyb3IgaGVyZSBiZWNhdXNlIHRoZXNlIGFyZSBpbnRlcm5hbCBmYWlsdXJlc1xuICAgIC8vIHRoYXQgY2Fubm90IGJlIGhhbmRsZWQgYnkgdGhlIHVzZXIuIChBbHNvIGl0IHdvdWxkIGNyZWF0ZSBhIGNpcmN1bGFyXG4gICAgLy8gZGVwZW5kZW5jeSBiZXR3ZWVuIHRoZSBlcnJvciBhbmQgYXNzZXJ0IG1vZHVsZXMgd2hpY2ggZG9lc24ndCB3b3JrLilcbiAgICB0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG59XG4vKipcbiAqIEZhaWxzIGlmIHRoZSBnaXZlbiBhc3NlcnRpb24gY29uZGl0aW9uIGlzIGZhbHNlLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZVxuICogZ2l2ZW4gbWVzc2FnZSBpZiBpdCBkaWQuXG4gKlxuICogQHBhcmFtIGFzc2VydGlvblxuICogQHBhcmFtIG1lc3NhZ2VcbiAqL1xuZnVuY3Rpb24gZGVidWdBc3NlcnQoYXNzZXJ0aW9uLCBtZXNzYWdlKSB7XG4gICAgaWYgKCFhc3NlcnRpb24pIHtcbiAgICAgICAgZGVidWdGYWlsKG1lc3NhZ2UpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIF9nZXRDdXJyZW50VXJsKCkge1xuICAgIHZhciBfYTtcbiAgICByZXR1cm4gKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAoKF9hID0gc2VsZi5sb2NhdGlvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmhyZWYpKSB8fCAnJztcbn1cbmZ1bmN0aW9uIF9pc0h0dHBPckh0dHBzKCkge1xuICAgIHJldHVybiBfZ2V0Q3VycmVudFNjaGVtZSgpID09PSAnaHR0cDonIHx8IF9nZXRDdXJyZW50U2NoZW1lKCkgPT09ICdodHRwczonO1xufVxuZnVuY3Rpb24gX2dldEN1cnJlbnRTY2hlbWUoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnICYmICgoX2EgPSBzZWxmLmxvY2F0aW9uKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EucHJvdG9jb2wpKSB8fCBudWxsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEZXRlcm1pbmUgd2hldGhlciB0aGUgYnJvd3NlciBpcyB3b3JraW5nIG9ubGluZVxuICovXG5mdW5jdGlvbiBfaXNPbmxpbmUoKSB7XG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgIG5hdmlnYXRvciAmJlxuICAgICAgICAnb25MaW5lJyBpbiBuYXZpZ2F0b3IgJiZcbiAgICAgICAgdHlwZW9mIG5hdmlnYXRvci5vbkxpbmUgPT09ICdib29sZWFuJyAmJlxuICAgICAgICAvLyBBcHBseSBvbmx5IGZvciB0cmFkaXRpb25hbCB3ZWIgYXBwcyBhbmQgQ2hyb21lIGV4dGVuc2lvbnMuXG4gICAgICAgIC8vIFRoaXMgaXMgZXNwZWNpYWxseSB0cnVlIGZvciBDb3Jkb3ZhIGFwcHMgd2hpY2ggaGF2ZSB1bnJlbGlhYmxlXG4gICAgICAgIC8vIG5hdmlnYXRvci5vbkxpbmUgYmVoYXZpb3IgdW5sZXNzIGNvcmRvdmEtcGx1Z2luLW5ldHdvcmstaW5mb3JtYXRpb24gaXNcbiAgICAgICAgLy8gaW5zdGFsbGVkIHdoaWNoIG92ZXJ3cml0ZXMgdGhlIG5hdGl2ZSBuYXZpZ2F0b3Iub25MaW5lIHZhbHVlIGFuZFxuICAgICAgICAvLyBkZWZpbmVzIG5hdmlnYXRvci5jb25uZWN0aW9uLlxuICAgICAgICAoX2lzSHR0cE9ySHR0cHMoKSB8fCBpc0Jyb3dzZXJFeHRlbnNpb24oKSB8fCAnY29ubmVjdGlvbicgaW4gbmF2aWdhdG9yKSkge1xuICAgICAgICByZXR1cm4gbmF2aWdhdG9yLm9uTGluZTtcbiAgICB9XG4gICAgLy8gSWYgd2UgY2FuJ3QgZGV0ZXJtaW5lIHRoZSBzdGF0ZSwgYXNzdW1lIGl0IGlzIG9ubGluZS5cbiAgICByZXR1cm4gdHJ1ZTtcbn1cbmZ1bmN0aW9uIF9nZXRVc2VyTGFuZ3VhZ2UoKSB7XG4gICAgaWYgKHR5cGVvZiBuYXZpZ2F0b3IgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBuYXZpZ2F0b3JMYW5ndWFnZSA9IG5hdmlnYXRvcjtcbiAgICByZXR1cm4gKFxuICAgIC8vIE1vc3QgcmVsaWFibGUsIGJ1dCBvbmx5IHN1cHBvcnRlZCBpbiBDaHJvbWUvRmlyZWZveC5cbiAgICAobmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2VzICYmIG5hdmlnYXRvckxhbmd1YWdlLmxhbmd1YWdlc1swXSkgfHxcbiAgICAgICAgLy8gU3VwcG9ydGVkIGluIG1vc3QgYnJvd3NlcnMsIGJ1dCByZXR1cm5zIHRoZSBsYW5ndWFnZSBvZiB0aGUgYnJvd3NlclxuICAgICAgICAvLyBVSSwgbm90IHRoZSBsYW5ndWFnZSBzZXQgaW4gYnJvd3NlciBzZXR0aW5ncy5cbiAgICAgICAgbmF2aWdhdG9yTGFuZ3VhZ2UubGFuZ3VhZ2UgfHxcbiAgICAgICAgLy8gQ291bGRuJ3QgZGV0ZXJtaW5lIGxhbmd1YWdlLlxuICAgICAgICBudWxsKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBzdHJ1Y3R1cmUgdG8gaGVscCBwaWNrIGJldHdlZW4gYSByYW5nZSBvZiBsb25nIGFuZCBzaG9ydCBkZWxheSBkdXJhdGlvbnNcbiAqIGRlcGVuZGluZyBvbiB0aGUgY3VycmVudCBlbnZpcm9ubWVudC4gSW4gZ2VuZXJhbCwgdGhlIGxvbmcgZGVsYXkgaXMgdXNlZCBmb3JcbiAqIG1vYmlsZSBlbnZpcm9ubWVudHMgd2hlcmVhcyBzaG9ydCBkZWxheXMgYXJlIHVzZWQgZm9yIGRlc2t0b3AgZW52aXJvbm1lbnRzLlxuICovXG5jbGFzcyBEZWxheSB7XG4gICAgY29uc3RydWN0b3Ioc2hvcnREZWxheSwgbG9uZ0RlbGF5KSB7XG4gICAgICAgIHRoaXMuc2hvcnREZWxheSA9IHNob3J0RGVsYXk7XG4gICAgICAgIHRoaXMubG9uZ0RlbGF5ID0gbG9uZ0RlbGF5O1xuICAgICAgICAvLyBJbnRlcm5hbCBlcnJvciB3aGVuIGltcHJvcGVybHkgaW5pdGlhbGl6ZWQuXG4gICAgICAgIGRlYnVnQXNzZXJ0KGxvbmdEZWxheSA+IHNob3J0RGVsYXksICdTaG9ydCBkZWxheSBzaG91bGQgYmUgbGVzcyB0aGFuIGxvbmcgZGVsYXkhJyk7XG4gICAgICAgIHRoaXMuaXNNb2JpbGUgPSBpc01vYmlsZUNvcmRvdmEoKSB8fCBpc1JlYWN0TmF0aXZlKCk7XG4gICAgfVxuICAgIGdldCgpIHtcbiAgICAgICAgaWYgKCFfaXNPbmxpbmUoKSkge1xuICAgICAgICAgICAgLy8gUGljayB0aGUgc2hvcnRlciB0aW1lb3V0LlxuICAgICAgICAgICAgcmV0dXJuIE1hdGgubWluKDUwMDAgLyogRGVsYXlNaW4uT0ZGTElORSAqLywgdGhpcy5zaG9ydERlbGF5KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiBydW5uaW5nIGluIGEgbW9iaWxlIGVudmlyb25tZW50LCByZXR1cm4gdGhlIGxvbmcgZGVsYXksIG90aGVyd2lzZVxuICAgICAgICAvLyByZXR1cm4gdGhlIHNob3J0IGRlbGF5LlxuICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIGltcHJvdmVkIGluIHRoZSBmdXR1cmUgdG8gZHluYW1pY2FsbHkgY2hhbmdlIGJhc2VkIG9uIG90aGVyXG4gICAgICAgIC8vIHZhcmlhYmxlcyBpbnN0ZWFkIG9mIGp1c3QgcmVhZGluZyB0aGUgY3VycmVudCBlbnZpcm9ubWVudC5cbiAgICAgICAgcmV0dXJuIHRoaXMuaXNNb2JpbGUgPyB0aGlzLmxvbmdEZWxheSA6IHRoaXMuc2hvcnREZWxheTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBfZW11bGF0b3JVcmwoY29uZmlnLCBwYXRoKSB7XG4gICAgZGVidWdBc3NlcnQoY29uZmlnLmVtdWxhdG9yLCAnRW11bGF0b3Igc2hvdWxkIGFsd2F5cyBiZSBzZXQgaGVyZScpO1xuICAgIGNvbnN0IHsgdXJsIH0gPSBjb25maWcuZW11bGF0b3I7XG4gICAgaWYgKCFwYXRoKSB7XG4gICAgICAgIHJldHVybiB1cmw7XG4gICAgfVxuICAgIHJldHVybiBgJHt1cmx9JHtwYXRoLnN0YXJ0c1dpdGgoJy8nKSA/IHBhdGguc2xpY2UoMSkgOiBwYXRofWA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBGZXRjaFByb3ZpZGVyIHtcbiAgICBzdGF0aWMgaW5pdGlhbGl6ZShmZXRjaEltcGwsIGhlYWRlcnNJbXBsLCByZXNwb25zZUltcGwpIHtcbiAgICAgICAgdGhpcy5mZXRjaEltcGwgPSBmZXRjaEltcGw7XG4gICAgICAgIGlmIChoZWFkZXJzSW1wbCkge1xuICAgICAgICAgICAgdGhpcy5oZWFkZXJzSW1wbCA9IGhlYWRlcnNJbXBsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXNwb25zZUltcGwpIHtcbiAgICAgICAgICAgIHRoaXMucmVzcG9uc2VJbXBsID0gcmVzcG9uc2VJbXBsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHN0YXRpYyBmZXRjaCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZmV0Y2hJbXBsKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mZXRjaEltcGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyAmJiAnZmV0Y2gnIGluIHNlbGYpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmZldGNoO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gJ3VuZGVmaW5lZCcgJiYgZ2xvYmFsVGhpcy5mZXRjaCkge1xuICAgICAgICAgICAgcmV0dXJuIGdsb2JhbFRoaXMuZmV0Y2g7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBmZXRjaCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgIHJldHVybiBmZXRjaDtcbiAgICAgICAgfVxuICAgICAgICBkZWJ1Z0ZhaWwoJ0NvdWxkIG5vdCBmaW5kIGZldGNoIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpO1xuICAgIH1cbiAgICBzdGF0aWMgaGVhZGVycygpIHtcbiAgICAgICAgaWYgKHRoaXMuaGVhZGVyc0ltcGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmhlYWRlcnNJbXBsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ0hlYWRlcnMnIGluIHNlbGYpIHtcbiAgICAgICAgICAgIHJldHVybiBzZWxmLkhlYWRlcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyAmJiBnbG9iYWxUaGlzLkhlYWRlcnMpIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iYWxUaGlzLkhlYWRlcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBIZWFkZXJzICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgcmV0dXJuIEhlYWRlcnM7XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBIZWFkZXJzIGltcGxlbWVudGF0aW9uLCBtYWtlIHN1cmUgeW91IGNhbGwgRmV0Y2hQcm92aWRlci5pbml0aWFsaXplKCkgd2l0aCBhbiBhcHByb3ByaWF0ZSBwb2x5ZmlsbCcpO1xuICAgIH1cbiAgICBzdGF0aWMgcmVzcG9uc2UoKSB7XG4gICAgICAgIGlmICh0aGlzLnJlc3BvbnNlSW1wbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVzcG9uc2VJbXBsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgJiYgJ1Jlc3BvbnNlJyBpbiBzZWxmKSB7XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5SZXNwb25zZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGdsb2JhbFRoaXMgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbFRoaXMuUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBnbG9iYWxUaGlzLlJlc3BvbnNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gUmVzcG9uc2U7XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdGYWlsKCdDb3VsZCBub3QgZmluZCBSZXNwb25zZSBpbXBsZW1lbnRhdGlvbiwgbWFrZSBzdXJlIHlvdSBjYWxsIEZldGNoUHJvdmlkZXIuaW5pdGlhbGl6ZSgpIHdpdGggYW4gYXBwcm9wcmlhdGUgcG9seWZpbGwnKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE1hcCBmcm9tIGVycm9ycyByZXR1cm5lZCBieSB0aGUgc2VydmVyIHRvIGVycm9ycyB0byBkZXZlbG9wZXIgdmlzaWJsZSBlcnJvcnNcbiAqL1xuY29uc3QgU0VSVkVSX0VSUk9SX01BUCA9IHtcbiAgICAvLyBDdXN0b20gdG9rZW4gZXJyb3JzLlxuICAgIFtcIkNSRURFTlRJQUxfTUlTTUFUQ0hcIiAvKiBTZXJ2ZXJFcnJvci5DUkVERU5USUFMX01JU01BVENIICovXTogXCJjdXN0b20tdG9rZW4tbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLkNSRURFTlRJQUxfTUlTTUFUQ0ggKi8sXG4gICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0LlxuICAgIFtcIk1JU1NJTkdfQ1VTVE9NX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DVVNUT01fVE9LRU4gKi9dOiBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyxcbiAgICAvLyBDcmVhdGUgQXV0aCBVUkkgZXJyb3JzLlxuICAgIFtcIklOVkFMSURfSURFTlRJRklFUlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfSURFTlRJRklFUiAqL106IFwiaW52YWxpZC1lbWFpbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9FTUFJTCAqLyxcbiAgICAvLyBUaGlzIGNhbiBvbmx5IGhhcHBlbiBpZiB0aGUgU0RLIHNlbmRzIGEgYmFkIHJlcXVlc3QuXG4gICAgW1wiTUlTU0lOR19DT05USU5VRV9VUklcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX0NPTlRJTlVFX1VSSSAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxuICAgIC8vIFNpZ24gaW4gd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQgZXJyb3JzIChzb21lIGFwcGx5IHRvIHNpZ24gdXAgdG9vKS5cbiAgICBbXCJJTlZBTElEX1BBU1NXT1JEXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9QQVNTV09SRCAqL106IFwid3JvbmctcGFzc3dvcmRcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUEFTU1dPUkQgKi8sXG4gICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0LlxuICAgIFtcIk1JU1NJTkdfUEFTU1dPUkRcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX1BBU1NXT1JEICovXTogXCJtaXNzaW5nLXBhc3N3b3JkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1BBU1NXT1JEICovLFxuICAgIC8vIFRocm93biBpZiBFbWFpbCBFbnVtZXJhdGlvbiBQcm90ZWN0aW9uIGlzIGVuYWJsZWQgaW4gdGhlIHByb2plY3QgYW5kIHRoZSBlbWFpbCBvciBwYXNzd29yZCBpc1xuICAgIC8vIGludmFsaWQuXG4gICAgW1wiSU5WQUxJRF9MT0dJTl9DUkVERU5USUFMU1wiIC8qIFNlcnZlckVycm9yLklOVkFMSURfTE9HSU5fQ1JFREVOVElBTFMgKi9dOiBcImludmFsaWQtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DUkVERU5USUFMICovLFxuICAgIC8vIFNpZ24gdXAgd2l0aCBlbWFpbCBhbmQgcGFzc3dvcmQgZXJyb3JzLlxuICAgIFtcIkVNQUlMX0VYSVNUU1wiIC8qIFNlcnZlckVycm9yLkVNQUlMX0VYSVNUUyAqL106IFwiZW1haWwtYWxyZWFkeS1pbi11c2VcIiAvKiBBdXRoRXJyb3JDb2RlLkVNQUlMX0VYSVNUUyAqLyxcbiAgICBbXCJQQVNTV09SRF9MT0dJTl9ESVNBQkxFRFwiIC8qIFNlcnZlckVycm9yLlBBU1NXT1JEX0xPR0lOX0RJU0FCTEVEICovXTogXCJvcGVyYXRpb24tbm90LWFsbG93ZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk9QRVJBVElPTl9OT1RfQUxMT1dFRCAqLyxcbiAgICAvLyBWZXJpZnkgYXNzZXJ0aW9uIGZvciBzaWduIGluIHdpdGggY3JlZGVudGlhbCBlcnJvcnM6XG4gICAgW1wiSU5WQUxJRF9JRFBfUkVTUE9OU0VcIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX0lEUF9SRVNQT05TRSAqL106IFwiaW52YWxpZC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0NSRURFTlRJQUwgKi8sXG4gICAgW1wiSU5WQUxJRF9QRU5ESU5HX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9QRU5ESU5HX1RPS0VOICovXTogXCJpbnZhbGlkLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ1JFREVOVElBTCAqLyxcbiAgICBbXCJGRURFUkFURURfVVNFUl9JRF9BTFJFQURZX0xJTktFRFwiIC8qIFNlcnZlckVycm9yLkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEICovXTogXCJjcmVkZW50aWFsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5DUkVERU5USUFMX0FMUkVBRFlfSU5fVVNFICovLFxuICAgIC8vIFRoaXMgY2FuIG9ubHkgaGFwcGVuIGlmIHRoZSBTREsgc2VuZHMgYSBiYWQgcmVxdWVzdC5cbiAgICBbXCJNSVNTSU5HX1JFUV9UWVBFXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRVFfVFlQRSAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxuICAgIC8vIFNlbmQgUGFzc3dvcmQgcmVzZXQgZW1haWwgZXJyb3JzOlxuICAgIFtcIkVNQUlMX05PVF9GT1VORFwiIC8qIFNlcnZlckVycm9yLkVNQUlMX05PVF9GT1VORCAqL106IFwidXNlci1ub3QtZm91bmRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfREVMRVRFRCAqLyxcbiAgICBbXCJSRVNFVF9QQVNTV09SRF9FWENFRURfTElNSVRcIiAvKiBTZXJ2ZXJFcnJvci5SRVNFVF9QQVNTV09SRF9FWENFRURfTElNSVQgKi9dOiBcInRvby1tYW55LXJlcXVlc3RzXCIgLyogQXV0aEVycm9yQ29kZS5UT09fTUFOWV9BVFRFTVBUU19UUllfTEFURVIgKi8sXG4gICAgW1wiRVhQSVJFRF9PT0JfQ09ERVwiIC8qIFNlcnZlckVycm9yLkVYUElSRURfT09CX0NPREUgKi9dOiBcImV4cGlyZWQtYWN0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLkVYUElSRURfT09CX0NPREUgKi8sXG4gICAgW1wiSU5WQUxJRF9PT0JfQ09ERVwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfT09CX0NPREUgKi9dOiBcImludmFsaWQtYWN0aW9uLWNvZGVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfT09CX0NPREUgKi8sXG4gICAgLy8gVGhpcyBjYW4gb25seSBoYXBwZW4gaWYgdGhlIFNESyBzZW5kcyBhIGJhZCByZXF1ZXN0LlxuICAgIFtcIk1JU1NJTkdfT09CX0NPREVcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX09PQl9DT0RFICovXTogXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8sXG4gICAgLy8gT3BlcmF0aW9ucyB0aGF0IHJlcXVpcmUgSUQgdG9rZW4gaW4gcmVxdWVzdDpcbiAgICBbXCJDUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU5cIiAvKiBTZXJ2ZXJFcnJvci5DUkVERU5USUFMX1RPT19PTERfTE9HSU5fQUdBSU4gKi9dOiBcInJlcXVpcmVzLXJlY2VudC1sb2dpblwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOICovLFxuICAgIFtcIklOVkFMSURfSURfVE9LRU5cIiAvKiBTZXJ2ZXJFcnJvci5JTlZBTElEX0lEX1RPS0VOICovXTogXCJpbnZhbGlkLXVzZXItdG9rZW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVVUSCAqLyxcbiAgICBbXCJUT0tFTl9FWFBJUkVEXCIgLyogU2VydmVyRXJyb3IuVE9LRU5fRVhQSVJFRCAqL106IFwidXNlci10b2tlbi1leHBpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5UT0tFTl9FWFBJUkVEICovLFxuICAgIFtcIlVTRVJfTk9UX0ZPVU5EXCIgLyogU2VydmVyRXJyb3IuVVNFUl9OT1RfRk9VTkQgKi9dOiBcInVzZXItdG9rZW4tZXhwaXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuVE9LRU5fRVhQSVJFRCAqLyxcbiAgICAvLyBPdGhlciBlcnJvcnMuXG4gICAgW1wiVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSXCIgLyogU2VydmVyRXJyb3IuVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSICovXTogXCJ0b28tbWFueS1yZXF1ZXN0c1wiIC8qIEF1dGhFcnJvckNvZGUuVE9PX01BTllfQVRURU1QVFNfVFJZX0xBVEVSICovLFxuICAgIFtcIlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTXCIgLyogU2VydmVyRXJyb3IuUEFTU1dPUkRfRE9FU19OT1RfTUVFVF9SRVFVSVJFTUVOVFMgKi9dOiBcInBhc3N3b3JkLWRvZXMtbm90LW1lZXQtcmVxdWlyZW1lbnRzXCIgLyogQXV0aEVycm9yQ29kZS5QQVNTV09SRF9ET0VTX05PVF9NRUVUX1JFUVVJUkVNRU5UUyAqLyxcbiAgICAvLyBQaG9uZSBBdXRoIHJlbGF0ZWQgZXJyb3JzLlxuICAgIFtcIklOVkFMSURfQ09ERVwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfQ09ERSAqL106IFwiaW52YWxpZC12ZXJpZmljYXRpb24tY29kZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9DT0RFICovLFxuICAgIFtcIklOVkFMSURfU0VTU0lPTl9JTkZPXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9TRVNTSU9OX0lORk8gKi9dOiBcImludmFsaWQtdmVyaWZpY2F0aW9uLWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX1NFU1NJT05fSU5GTyAqLyxcbiAgICBbXCJJTlZBTElEX1RFTVBPUkFSWV9QUk9PRlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfVEVNUE9SQVJZX1BST09GICovXTogXCJpbnZhbGlkLWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ1JFREVOVElBTCAqLyxcbiAgICBbXCJNSVNTSU5HX1NFU1NJT05fSU5GT1wiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfU0VTU0lPTl9JTkZPICovXTogXCJtaXNzaW5nLXZlcmlmaWNhdGlvbi1pZFwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19TRVNTSU9OX0lORk8gKi8sXG4gICAgW1wiU0VTU0lPTl9FWFBJUkVEXCIgLyogU2VydmVyRXJyb3IuU0VTU0lPTl9FWFBJUkVEICovXTogXCJjb2RlLWV4cGlyZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkNPREVfRVhQSVJFRCAqLyxcbiAgICAvLyBPdGhlciBhY3Rpb24gY29kZSBlcnJvcnMgd2hlbiBhZGRpdGlvbmFsIHNldHRpbmdzIHBhc3NlZC5cbiAgICAvLyBNSVNTSU5HX0NPTlRJTlVFX1VSSSBpcyBnZXR0aW5nIG1hcHBlZCB0byBJTlRFUk5BTF9FUlJPUiBhYm92ZS5cbiAgICAvLyBUaGlzIGlzIE9LIGFzIHRoaXMgZXJyb3Igd2lsbCBiZSBjYXVnaHQgYnkgY2xpZW50IHNpZGUgdmFsaWRhdGlvbi5cbiAgICBbXCJNSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19BTkRST0lEX1BBQ0tBR0VfTkFNRSAqL106IFwibWlzc2luZy1hbmRyb2lkLXBrZy1uYW1lXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0FORFJPSURfUEFDS0FHRV9OQU1FICovLFxuICAgIFtcIlVOQVVUSE9SSVpFRF9ET01BSU5cIiAvKiBTZXJ2ZXJFcnJvci5VTkFVVEhPUklaRURfRE9NQUlOICovXTogXCJ1bmF1dGhvcml6ZWQtY29udGludWUtdXJpXCIgLyogQXV0aEVycm9yQ29kZS5VTkFVVEhPUklaRURfRE9NQUlOICovLFxuICAgIC8vIGdldFByb2plY3RDb25maWcgZXJyb3JzIHdoZW4gY2xpZW50SWQgaXMgcGFzc2VkLlxuICAgIFtcIklOVkFMSURfT0FVVEhfQ0xJRU5UX0lEXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9PQVVUSF9DTElFTlRfSUQgKi9dOiBcImludmFsaWQtb2F1dGgtY2xpZW50LWlkXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX09BVVRIX0NMSUVOVF9JRCAqLyxcbiAgICAvLyBVc2VyIGFjdGlvbnMgKHNpZ24tdXAgb3IgZGVsZXRpb24pIGRpc2FibGVkIGVycm9ycy5cbiAgICBbXCJBRE1JTl9PTkxZX09QRVJBVElPTlwiIC8qIFNlcnZlckVycm9yLkFETUlOX09OTFlfT1BFUkFUSU9OICovXTogXCJhZG1pbi1yZXN0cmljdGVkLW9wZXJhdGlvblwiIC8qIEF1dGhFcnJvckNvZGUuQURNSU5fT05MWV9PUEVSQVRJT04gKi8sXG4gICAgLy8gTXVsdGkgZmFjdG9yIHJlbGF0ZWQgZXJyb3JzLlxuICAgIFtcIklOVkFMSURfTUZBX1BFTkRJTkdfQ1JFREVOVElBTFwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfTUZBX1BFTkRJTkdfQ1JFREVOVElBTCAqL106IFwiaW52YWxpZC1tdWx0aS1mYWN0b3Itc2Vzc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9NRkFfU0VTU0lPTiAqLyxcbiAgICBbXCJNRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkRcIiAvKiBTZXJ2ZXJFcnJvci5NRkFfRU5ST0xMTUVOVF9OT1RfRk9VTkQgKi9dOiBcIm11bHRpLWZhY3Rvci1pbmZvLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuTUZBX0lORk9fTk9UX0ZPVU5EICovLFxuICAgIFtcIk1JU1NJTkdfTUZBX0VOUk9MTE1FTlRfSURcIiAvKiBTZXJ2ZXJFcnJvci5NSVNTSU5HX01GQV9FTlJPTExNRU5UX0lEICovXTogXCJtaXNzaW5nLW11bHRpLWZhY3Rvci1pbmZvXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX01GQV9JTkZPICovLFxuICAgIFtcIk1JU1NJTkdfTUZBX1BFTkRJTkdfQ1JFREVOVElBTFwiIC8qIFNlcnZlckVycm9yLk1JU1NJTkdfTUZBX1BFTkRJTkdfQ1JFREVOVElBTCAqL106IFwibWlzc2luZy1tdWx0aS1mYWN0b3Itc2Vzc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19NRkFfU0VTU0lPTiAqLyxcbiAgICBbXCJTRUNPTkRfRkFDVE9SX0VYSVNUU1wiIC8qIFNlcnZlckVycm9yLlNFQ09ORF9GQUNUT1JfRVhJU1RTICovXTogXCJzZWNvbmQtZmFjdG9yLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5TRUNPTkRfRkFDVE9SX0FMUkVBRFlfRU5ST0xMRUQgKi8sXG4gICAgW1wiU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRFwiIC8qIFNlcnZlckVycm9yLlNFQ09ORF9GQUNUT1JfTElNSVRfRVhDRUVERUQgKi9dOiBcIm1heGltdW0tc2Vjb25kLWZhY3Rvci1jb3VudC1leGNlZWRlZFwiIC8qIEF1dGhFcnJvckNvZGUuU0VDT05EX0ZBQ1RPUl9MSU1JVF9FWENFRURFRCAqLyxcbiAgICAvLyBCbG9ja2luZyBmdW5jdGlvbnMgcmVsYXRlZCBlcnJvcnMuXG4gICAgW1wiQkxPQ0tJTkdfRlVOQ1RJT05fRVJST1JfUkVTUE9OU0VcIiAvKiBTZXJ2ZXJFcnJvci5CTE9DS0lOR19GVU5DVElPTl9FUlJPUl9SRVNQT05TRSAqL106IFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLFxuICAgIC8vIFJlY2FwdGNoYSByZWxhdGVkIGVycm9ycy5cbiAgICBbXCJSRUNBUFRDSEFfTk9UX0VOQUJMRURcIiAvKiBTZXJ2ZXJFcnJvci5SRUNBUFRDSEFfTk9UX0VOQUJMRUQgKi9dOiBcInJlY2FwdGNoYS1ub3QtZW5hYmxlZFwiIC8qIEF1dGhFcnJvckNvZGUuUkVDQVBUQ0hBX05PVF9FTkFCTEVEICovLFxuICAgIFtcIk1JU1NJTkdfUkVDQVBUQ0hBX1RPS0VOXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRUNBUFRDSEFfVE9LRU4gKi9dOiBcIm1pc3NpbmctcmVjYXB0Y2hhLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqLyxcbiAgICBbXCJJTlZBTElEX1JFQ0FQVENIQV9UT0tFTlwiIC8qIFNlcnZlckVycm9yLklOVkFMSURfUkVDQVBUQ0hBX1RPS0VOICovXTogXCJpbnZhbGlkLXJlY2FwdGNoYS10b2tlblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNBUFRDSEFfVE9LRU4gKi8sXG4gICAgW1wiSU5WQUxJRF9SRUNBUFRDSEFfQUNUSU9OXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRUNBUFRDSEFfQUNUSU9OICovXTogXCJpbnZhbGlkLXJlY2FwdGNoYS1hY3Rpb25cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfUkVDQVBUQ0hBX0FDVElPTiAqLyxcbiAgICBbXCJNSVNTSU5HX0NMSUVOVF9UWVBFXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19DTElFTlRfVFlQRSAqL106IFwibWlzc2luZy1jbGllbnQtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19DTElFTlRfVFlQRSAqLyxcbiAgICBbXCJNSVNTSU5HX1JFQ0FQVENIQV9WRVJTSU9OXCIgLyogU2VydmVyRXJyb3IuTUlTU0lOR19SRUNBUFRDSEFfVkVSU0lPTiAqL106IFwibWlzc2luZy1yZWNhcHRjaGEtdmVyc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19SRUNBUFRDSEFfVkVSU0lPTiAqLyxcbiAgICBbXCJJTlZBTElEX1JFQ0FQVENIQV9WRVJTSU9OXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTiAqL106IFwiaW52YWxpZC1yZWNhcHRjaGEtdmVyc2lvblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRUNBUFRDSEFfVkVSU0lPTiAqLyxcbiAgICBbXCJJTlZBTElEX1JFUV9UWVBFXCIgLyogU2VydmVyRXJyb3IuSU5WQUxJRF9SRVFfVFlQRSAqL106IFwiaW52YWxpZC1yZXEtdHlwZVwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9SRVFfVFlQRSAqL1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IENvb2tpZUF1dGhQcm94aWVkRW5kcG9pbnRzID0gW1xuICAgIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhDdXN0b21Ub2tlblwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9DVVNUT01fVE9LRU4gKi8sXG4gICAgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aEVtYWlsTGlua1wiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9FTUFJTF9MSU5LICovLFxuICAgIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhJZHBcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfSURQICovLFxuICAgIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQYXNzd29yZFwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9QQVNTV09SRCAqLyxcbiAgICBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoUGhvbmVOdW1iZXJcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfUEhPTkVfTlVNQkVSICovLFxuICAgIFwiL3YxL3Rva2VuXCIgLyogRW5kcG9pbnQuVE9LRU4gKi9cbl07XG5jb25zdCBERUZBVUxUX0FQSV9USU1FT1VUX01TID0gbmV3IERlbGF5KDMwMDAwLCA2MDAwMCk7XG5mdW5jdGlvbiBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkge1xuICAgIGlmIChhdXRoLnRlbmFudElkICYmICFyZXF1ZXN0LnRlbmFudElkKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHJlcXVlc3QpLCB7IHRlbmFudElkOiBhdXRoLnRlbmFudElkIH0pO1xuICAgIH1cbiAgICByZXR1cm4gcmVxdWVzdDtcbn1cbmFzeW5jIGZ1bmN0aW9uIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBtZXRob2QsIHBhdGgsIHJlcXVlc3QsIGN1c3RvbUVycm9yTWFwID0ge30pIHtcbiAgICByZXR1cm4gX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIGN1c3RvbUVycm9yTWFwLCBhc3luYyAoKSA9PiB7XG4gICAgICAgIGxldCBib2R5ID0ge307XG4gICAgICAgIGxldCBwYXJhbXMgPSB7fTtcbiAgICAgICAgaWYgKHJlcXVlc3QpIHtcbiAgICAgICAgICAgIGlmIChtZXRob2QgPT09IFwiR0VUXCIgLyogSHR0cE1ldGhvZC5HRVQgKi8pIHtcbiAgICAgICAgICAgICAgICBwYXJhbXMgPSByZXF1ZXN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYm9keSA9IHtcbiAgICAgICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmVxdWVzdClcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gcXVlcnlzdHJpbmcoT2JqZWN0LmFzc2lnbih7IGtleTogYXV0aC5jb25maWcuYXBpS2V5IH0sIHBhcmFtcykpLnNsaWNlKDEpO1xuICAgICAgICBjb25zdCBoZWFkZXJzID0gYXdhaXQgYXV0aC5fZ2V0QWRkaXRpb25hbEhlYWRlcnMoKTtcbiAgICAgICAgaGVhZGVyc1tcIkNvbnRlbnQtVHlwZVwiIC8qIEh0dHBIZWFkZXIuQ09OVEVOVF9UWVBFICovXSA9ICdhcHBsaWNhdGlvbi9qc29uJztcbiAgICAgICAgaWYgKGF1dGgubGFuZ3VhZ2VDb2RlKSB7XG4gICAgICAgICAgICBoZWFkZXJzW1wiWC1GaXJlYmFzZS1Mb2NhbGVcIiAvKiBIdHRwSGVhZGVyLlhfRklSRUJBU0VfTE9DQUxFICovXSA9IGF1dGgubGFuZ3VhZ2VDb2RlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGZldGNoQXJncyA9IE9iamVjdC5hc3NpZ24oeyBtZXRob2QsXG4gICAgICAgICAgICBoZWFkZXJzIH0sIGJvZHkpO1xuICAgICAgICAvKiBTZWN1cml0eS1jb25zY2lvdXMgc2VydmVyLXNpZGUgZnJhbWV3b3JrcyB0ZW5kIHRvIGhhdmUgYnVpbHQgaW4gbWl0aWdhdGlvbnMgZm9yIHJlZmVycmVyXG4gICAgICAgICAgIHByb2JsZW1zXCIuIFNlZSB0aGUgQ2xvdWRmbGFyZSBHaXRIdWIgaXNzdWUgIzQ4NzogRXJyb3I6IFRoZSAncmVmZXJyZXJQb2xpY3knIGZpZWxkIG9uXG4gICAgICAgICAgICdSZXF1ZXN0SW5pdGlhbGl6ZXJEaWN0JyBpcyBub3QgaW1wbGVtZW50ZWQuXCJcbiAgICAgICAgICAgaHR0cHM6Ly9naXRodWIuY29tL2Nsb3VkZmxhcmUvbmV4dC1vbi1wYWdlcy9pc3N1ZXMvNDg3ICovXG4gICAgICAgIGlmICghaXNDbG91ZGZsYXJlV29ya2VyKCkpIHtcbiAgICAgICAgICAgIGZldGNoQXJncy5yZWZlcnJlclBvbGljeSA9ICduby1yZWZlcnJlcic7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEZldGNoUHJvdmlkZXIuZmV0Y2goKShhd2FpdCBfZ2V0RmluYWxUYXJnZXQoYXV0aCwgYXV0aC5jb25maWcuYXBpSG9zdCwgcGF0aCwgcXVlcnkpLCBmZXRjaEFyZ3MpO1xuICAgIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gX3BlcmZvcm1GZXRjaFdpdGhFcnJvckhhbmRsaW5nKGF1dGgsIGN1c3RvbUVycm9yTWFwLCBmZXRjaEZuKSB7XG4gICAgYXV0aC5fY2FuSW5pdEVtdWxhdG9yID0gZmFsc2U7XG4gICAgY29uc3QgZXJyb3JNYXAgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIFNFUlZFUl9FUlJPUl9NQVApLCBjdXN0b21FcnJvck1hcCk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgbmV0d29ya1RpbWVvdXQgPSBuZXcgTmV0d29ya1RpbWVvdXQoYXV0aCk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgUHJvbWlzZS5yYWNlKFtcbiAgICAgICAgICAgIGZldGNoRm4oKSxcbiAgICAgICAgICAgIG5ldHdvcmtUaW1lb3V0LnByb21pc2VcbiAgICAgICAgXSk7XG4gICAgICAgIC8vIElmIHdlJ3ZlIHJlYWNoZWQgdGhpcyBwb2ludCwgdGhlIGZldGNoIHN1Y2NlZWRlZCBhbmQgdGhlIG5ldHdvcmtUaW1lb3V0XG4gICAgICAgIC8vIGRpZG4ndCB0aHJvdzsgY2xlYXIgdGhlIG5ldHdvcmsgdGltZW91dCBkZWxheSBzbyB0aGF0IE5vZGUgd29uJ3QgaGFuZ1xuICAgICAgICBuZXR3b3JrVGltZW91dC5jbGVhck5ldHdvcmtUaW1lb3V0KCk7XG4gICAgICAgIGNvbnN0IGpzb24gPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgICAgIGlmICgnbmVlZENvbmZpcm1hdGlvbicgaW4ganNvbikge1xuICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcImFjY291bnQtZXhpc3RzLXdpdGgtZGlmZmVyZW50LWNyZWRlbnRpYWxcIiAvKiBBdXRoRXJyb3JDb2RlLk5FRURfQ09ORklSTUFUSU9OICovLCBqc29uKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzcG9uc2Uub2sgJiYgISgnZXJyb3JNZXNzYWdlJyBpbiBqc29uKSkge1xuICAgICAgICAgICAgcmV0dXJuIGpzb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSByZXNwb25zZS5vayA/IGpzb24uZXJyb3JNZXNzYWdlIDoganNvbi5lcnJvci5tZXNzYWdlO1xuICAgICAgICAgICAgY29uc3QgW3NlcnZlckVycm9yQ29kZSwgc2VydmVyRXJyb3JNZXNzYWdlXSA9IGVycm9yTWVzc2FnZS5zcGxpdCgnIDogJyk7XG4gICAgICAgICAgICBpZiAoc2VydmVyRXJyb3JDb2RlID09PSBcIkZFREVSQVRFRF9VU0VSX0lEX0FMUkVBRFlfTElOS0VEXCIgLyogU2VydmVyRXJyb3IuRkVERVJBVEVEX1VTRVJfSURfQUxSRUFEWV9MSU5LRUQgKi8pIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBfbWFrZVRhZ2dlZEVycm9yKGF1dGgsIFwiY3JlZGVudGlhbC1hbHJlYWR5LWluLXVzZVwiIC8qIEF1dGhFcnJvckNvZGUuQ1JFREVOVElBTF9BTFJFQURZX0lOX1VTRSAqLywganNvbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChzZXJ2ZXJFcnJvckNvZGUgPT09IFwiRU1BSUxfRVhJU1RTXCIgLyogU2VydmVyRXJyb3IuRU1BSUxfRVhJU1RTICovKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcImVtYWlsLWFscmVhZHktaW4tdXNlXCIgLyogQXV0aEVycm9yQ29kZS5FTUFJTF9FWElTVFMgKi8sIGpzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoc2VydmVyRXJyb3JDb2RlID09PSBcIlVTRVJfRElTQUJMRURcIiAvKiBTZXJ2ZXJFcnJvci5VU0VSX0RJU0FCTEVEICovKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgX21ha2VUYWdnZWRFcnJvcihhdXRoLCBcInVzZXItZGlzYWJsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfRElTQUJMRUQgKi8sIGpzb24pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgYXV0aEVycm9yID0gZXJyb3JNYXBbc2VydmVyRXJyb3JDb2RlXSB8fFxuICAgICAgICAgICAgICAgIHNlcnZlckVycm9yQ29kZVxuICAgICAgICAgICAgICAgICAgICAudG9Mb3dlckNhc2UoKVxuICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgvW19cXHNdKy9nLCAnLScpO1xuICAgICAgICAgICAgaWYgKHNlcnZlckVycm9yTWVzc2FnZSkge1xuICAgICAgICAgICAgICAgIHRocm93IF9lcnJvcldpdGhDdXN0b21NZXNzYWdlKGF1dGgsIGF1dGhFcnJvciwgc2VydmVyRXJyb3JNZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIF9mYWlsKGF1dGgsIGF1dGhFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBGaXJlYmFzZUVycm9yKSB7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoYW5naW5nIHRoaXMgdG8gYSBkaWZmZXJlbnQgZXJyb3IgY29kZSB3aWxsIGxvZyB1c2VyIG91dCB3aGVuIHRoZXJlIGlzIGEgbmV0d29yayBlcnJvclxuICAgICAgICAvLyBiZWNhdXNlIHdlIHRyZWF0IGFueSBlcnJvciBvdGhlciB0aGFuIE5FVFdPUktfUkVRVUVTVF9GQUlMRUQgYXMgdG9rZW4gaXMgaW52YWxpZC5cbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2ZpcmViYXNlL2ZpcmViYXNlLWpzLXNkay9ibG9iLzRmYmM3MzYxMGQ3MGJlNGUwODUyZTdkZTYzYTM5Y2I3ODk3ZTg1NDYvcGFja2FnZXMvYXV0aC9zcmMvY29yZS9hdXRoL2F1dGhfaW1wbC50cyNMMzA5LUwzMTZcbiAgICAgICAgX2ZhaWwoYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovLCB7ICdtZXNzYWdlJzogU3RyaW5nKGUpIH0pO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBtZXRob2QsIHBhdGgsIHJlcXVlc3QsIGN1c3RvbUVycm9yTWFwID0ge30pIHtcbiAgICBjb25zdCBzZXJ2ZXJSZXNwb25zZSA9IGF3YWl0IF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBtZXRob2QsIHBhdGgsIHJlcXVlc3QsIGN1c3RvbUVycm9yTWFwKTtcbiAgICBpZiAoJ21mYVBlbmRpbmdDcmVkZW50aWFsJyBpbiBzZXJ2ZXJSZXNwb25zZSkge1xuICAgICAgICBfZmFpbChhdXRoLCBcIm11bHRpLWZhY3Rvci1hdXRoLXJlcXVpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5NRkFfUkVRVUlSRUQgKi8sIHtcbiAgICAgICAgICAgIF9zZXJ2ZXJSZXNwb25zZTogc2VydmVyUmVzcG9uc2VcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBzZXJ2ZXJSZXNwb25zZTtcbn1cbmFzeW5jIGZ1bmN0aW9uIF9nZXRGaW5hbFRhcmdldChhdXRoLCBob3N0LCBwYXRoLCBxdWVyeSkge1xuICAgIGNvbnN0IGJhc2UgPSBgJHtob3N0fSR7cGF0aH0/JHtxdWVyeX1gO1xuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IGF1dGg7XG4gICAgY29uc3QgZmluYWxUYXJnZXQgPSBhdXRoSW50ZXJuYWwuY29uZmlnLmVtdWxhdG9yXG4gICAgICAgID8gX2VtdWxhdG9yVXJsKGF1dGguY29uZmlnLCBiYXNlKVxuICAgICAgICA6IGAke2F1dGguY29uZmlnLmFwaVNjaGVtZX06Ly8ke2Jhc2V9YDtcbiAgICAvLyBDb29raWUgYXV0aCB3b3JrcyBieSBNaVRNaW5nIHRoZSBzaWduSW4gYW5kIHRva2VuIGVuZHBvaW50cyBmcm9tIHRoZSBkZXZlbG9wZXIncyBiYWNrZW5kLFxuICAgIC8vIHNhdmluZyB0aGUgaWRUb2tlbiBhbmQgcmVmcmVzaFRva2VuIGludG8gY29va2llcywgYW5kIHRoZW4gcmVkYWN0aW5nIHRoZSByZWZyZXNoVG9rZW5cbiAgICAvLyBmcm9tIHRoZSByZXNwb25zZVxuICAgIGlmIChDb29raWVBdXRoUHJveGllZEVuZHBvaW50cy5pbmNsdWRlcyhwYXRoKSkge1xuICAgICAgICAvLyBQZXJzaXN0ZW5jZSBtYW5hZ2VyIGlzIGFzeW5jLCB3ZSBuZWVkIHRvIGF3YWl0IGl0LiBXZSBjYW4ndCBqdXN0IHdhaXQgZm9yIGF1dGggaW5pdGlhbGl6ZWRcbiAgICAgICAgLy8gaGVyZSBzaW5jZSBhdXRoIGluaXRpYWxpemF0aW9uIGNhbGxzIHRoaXMgZnVuY3Rpb24uXG4gICAgICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fcGVyc2lzdGVuY2VNYW5hZ2VyQXZhaWxhYmxlO1xuICAgICAgICBpZiAoYXV0aEludGVybmFsLl9nZXRQZXJzaXN0ZW5jZVR5cGUoKSA9PT0gXCJDT09LSUVcIiAvKiBQZXJzaXN0ZW5jZVR5cGUuQ09PS0lFICovKSB7XG4gICAgICAgICAgICBjb25zdCBjb29raWVQZXJzaXN0ZW5jZSA9IGF1dGhJbnRlcm5hbC5fZ2V0UGVyc2lzdGVuY2UoKTtcbiAgICAgICAgICAgIHJldHVybiBjb29raWVQZXJzaXN0ZW5jZS5fZ2V0RmluYWxUYXJnZXQoZmluYWxUYXJnZXQpLnRvU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZpbmFsVGFyZ2V0O1xufVxuZnVuY3Rpb24gX3BhcnNlRW5mb3JjZW1lbnRTdGF0ZShlbmZvcmNlbWVudFN0YXRlU3RyKSB7XG4gICAgc3dpdGNoIChlbmZvcmNlbWVudFN0YXRlU3RyKSB7XG4gICAgICAgIGNhc2UgJ0VORk9SQ0UnOlxuICAgICAgICAgICAgcmV0dXJuIFwiRU5GT1JDRVwiIC8qIEVuZm9yY2VtZW50U3RhdGUuRU5GT1JDRSAqLztcbiAgICAgICAgY2FzZSAnQVVESVQnOlxuICAgICAgICAgICAgcmV0dXJuIFwiQVVESVRcIiAvKiBFbmZvcmNlbWVudFN0YXRlLkFVRElUICovO1xuICAgICAgICBjYXNlICdPRkYnOlxuICAgICAgICAgICAgcmV0dXJuIFwiT0ZGXCIgLyogRW5mb3JjZW1lbnRTdGF0ZS5PRkYgKi87XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gXCJFTkZPUkNFTUVOVF9TVEFURV9VTlNQRUNJRklFRFwiIC8qIEVuZm9yY2VtZW50U3RhdGUuRU5GT1JDRU1FTlRfU1RBVEVfVU5TUEVDSUZJRUQgKi87XG4gICAgfVxufVxuY2xhc3MgTmV0d29ya1RpbWVvdXQge1xuICAgIGNsZWFyTmV0d29ya1RpbWVvdXQoKSB7XG4gICAgICAgIGNsZWFyVGltZW91dCh0aGlzLnRpbWVyKTtcbiAgICB9XG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xuICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgYXJlIGZ1bmRhbWVudGFsbHkgaW5jb21wYXRpYmxlLCBidXQgd2VcbiAgICAgICAgLy8gZG9uJ3QgY2FyZSBhYm91dCB0aGUgdmFsdWUgaGVyZVxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICB0aGlzLnRpbWVyID0gbnVsbDtcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKF8sIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy50aW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiByZWplY3QoX2NyZWF0ZUVycm9yKHRoaXMuYXV0aCwgXCJuZXR3b3JrLXJlcXVlc3QtZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5ORVRXT1JLX1JFUVVFU1RfRkFJTEVEICovKSk7XG4gICAgICAgICAgICB9LCBERUZBVUxUX0FQSV9USU1FT1VUX01TLmdldCgpKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gX21ha2VUYWdnZWRFcnJvcihhdXRoLCBjb2RlLCByZXNwb25zZSkge1xuICAgIGNvbnN0IGVycm9yUGFyYW1zID0ge1xuICAgICAgICBhcHBOYW1lOiBhdXRoLm5hbWVcbiAgICB9O1xuICAgIGlmIChyZXNwb25zZS5lbWFpbCkge1xuICAgICAgICBlcnJvclBhcmFtcy5lbWFpbCA9IHJlc3BvbnNlLmVtYWlsO1xuICAgIH1cbiAgICBpZiAocmVzcG9uc2UucGhvbmVOdW1iZXIpIHtcbiAgICAgICAgZXJyb3JQYXJhbXMucGhvbmVOdW1iZXIgPSByZXNwb25zZS5waG9uZU51bWJlcjtcbiAgICB9XG4gICAgY29uc3QgZXJyb3IgPSBfY3JlYXRlRXJyb3IoYXV0aCwgY29kZSwgZXJyb3JQYXJhbXMpO1xuICAgIC8vIFdlIGtub3cgY3VzdG9tRGF0YSBpcyBkZWZpbmVkIG9uIGVycm9yIGJlY2F1c2UgZXJyb3JQYXJhbXMgaXMgZGVmaW5lZFxuICAgIGVycm9yLmN1c3RvbURhdGEuX3Rva2VuUmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICByZXR1cm4gZXJyb3I7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBpc1YyKGdyZWNhcHRjaGEpIHtcbiAgICByZXR1cm4gKGdyZWNhcHRjaGEgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBncmVjYXB0Y2hhLmdldFJlc3BvbnNlICE9PSB1bmRlZmluZWQpO1xufVxuZnVuY3Rpb24gaXNFbnRlcnByaXNlKGdyZWNhcHRjaGEpIHtcbiAgICByZXR1cm4gKGdyZWNhcHRjaGEgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICBncmVjYXB0Y2hhLmVudGVycHJpc2UgIT09IHVuZGVmaW5lZCk7XG59XG5jbGFzcyBSZWNhcHRjaGFDb25maWcge1xuICAgIGNvbnN0cnVjdG9yKHJlc3BvbnNlKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgcmVDQVBUQ0hBIHNpdGUga2V5LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zaXRlS2V5ID0gJyc7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgbGlzdCBvZiBwcm92aWRlcnMgYW5kIHRoZWlyIGVuYWJsZW1lbnQgc3RhdHVzIGZvciByZUNBUFRDSEEgRW50ZXJwcmlzZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZSA9IFtdO1xuICAgICAgICBpZiAocmVzcG9uc2UucmVjYXB0Y2hhS2V5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVjYXB0Y2hhS2V5IHVuZGVmaW5lZCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEV4YW1wbGUgcmVzcG9uc2UucmVjYXB0Y2hhS2V5OiBcInByb2plY3RzL3Byb2oxMjMva2V5cy9zaXRla2V5MTIzXCJcbiAgICAgICAgdGhpcy5zaXRlS2V5ID0gcmVzcG9uc2UucmVjYXB0Y2hhS2V5LnNwbGl0KCcvJylbM107XG4gICAgICAgIHRoaXMucmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZSA9IHJlc3BvbnNlLnJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHJlQ0FQVENIQSBFbnRlcnByaXNlIGVuZm9yY2VtZW50IHN0YXRlIGZvciB0aGUgZ2l2ZW4gcHJvdmlkZXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcHJvdmlkZXJTdHIgLSBUaGUgcHJvdmlkZXIgd2hvc2UgZW5mb3JjZW1lbnQgc3RhdGUgaXMgdG8gYmUgcmV0dXJuZWQuXG4gICAgICogQHJldHVybnMgVGhlIHJlQ0FQVENIQSBFbnRlcnByaXNlIGVuZm9yY2VtZW50IHN0YXRlIGZvciB0aGUgZ2l2ZW4gcHJvdmlkZXIuXG4gICAgICovXG4gICAgZ2V0UHJvdmlkZXJFbmZvcmNlbWVudFN0YXRlKHByb3ZpZGVyU3RyKSB7XG4gICAgICAgIGlmICghdGhpcy5yZWNhcHRjaGFFbmZvcmNlbWVudFN0YXRlIHx8XG4gICAgICAgICAgICB0aGlzLnJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IHJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUgb2YgdGhpcy5yZWNhcHRjaGFFbmZvcmNlbWVudFN0YXRlKSB7XG4gICAgICAgICAgICBpZiAocmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZS5wcm92aWRlciAmJlxuICAgICAgICAgICAgICAgIHJlY2FwdGNoYUVuZm9yY2VtZW50U3RhdGUucHJvdmlkZXIgPT09IHByb3ZpZGVyU3RyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIF9wYXJzZUVuZm9yY2VtZW50U3RhdGUocmVjYXB0Y2hhRW5mb3JjZW1lbnRTdGF0ZS5lbmZvcmNlbWVudFN0YXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSByZUNBUFRDSEEgRW50ZXJwcmlzZSBlbmZvcmNlbWVudCBzdGF0ZSBmb3IgdGhlIHByb3ZpZGVyIGlzIHNldCB0byBFTkZPUkNFIG9yIEFVRElULlxuICAgICAqXG4gICAgICogQHBhcmFtIHByb3ZpZGVyU3RyIC0gVGhlIHByb3ZpZGVyIHdob3NlIGVuYWJsZW1lbnQgc3RhdGUgaXMgdG8gYmUgcmV0dXJuZWQuXG4gICAgICogQHJldHVybnMgV2hldGhlciBvciBub3QgcmVDQVBUQ0hBIEVudGVycHJpc2UgcHJvdGVjdGlvbiBpcyBlbmFibGVkIGZvciB0aGUgZ2l2ZW4gcHJvdmlkZXIuXG4gICAgICovXG4gICAgaXNQcm92aWRlckVuYWJsZWQocHJvdmlkZXJTdHIpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmdldFByb3ZpZGVyRW5mb3JjZW1lbnRTdGF0ZShwcm92aWRlclN0cikgPT09XG4gICAgICAgICAgICBcIkVORk9SQ0VcIiAvKiBFbmZvcmNlbWVudFN0YXRlLkVORk9SQ0UgKi8gfHxcbiAgICAgICAgICAgIHRoaXMuZ2V0UHJvdmlkZXJFbmZvcmNlbWVudFN0YXRlKHByb3ZpZGVyU3RyKSA9PT0gXCJBVURJVFwiIC8qIEVuZm9yY2VtZW50U3RhdGUuQVVESVQgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgcmVDQVBUQ0hBIEVudGVycHJpc2UgcHJvdGVjdGlvbiBpcyBlbmFibGVkIGluIGF0IGxlYXN0IG9uZSBwcm92aWRlciwgb3RoZXJ3aXNlXG4gICAgICogcmV0dXJucyBmYWxzZS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFdoZXRoZXIgb3Igbm90IHJlQ0FQVENIQSBFbnRlcnByaXNlIHByb3RlY3Rpb24gaXMgZW5hYmxlZCBmb3IgYXQgbGVhc3Qgb25lIHByb3ZpZGVyLlxuICAgICAqL1xuICAgIGlzQW55UHJvdmlkZXJFbmFibGVkKCkge1xuICAgICAgICByZXR1cm4gKHRoaXMuaXNQcm92aWRlckVuYWJsZWQoXCJFTUFJTF9QQVNTV09SRF9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYUF1dGhQcm92aWRlci5FTUFJTF9QQVNTV09SRF9QUk9WSURFUiAqLykgfHxcbiAgICAgICAgICAgIHRoaXMuaXNQcm92aWRlckVuYWJsZWQoXCJQSE9ORV9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYUF1dGhQcm92aWRlci5QSE9ORV9QUk9WSURFUiAqLykpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFJlY2FwdGNoYVBhcmFtcyhhdXRoKSB7XG4gICAgcmV0dXJuICgoYXdhaXQgX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiR0VUXCIgLyogSHR0cE1ldGhvZC5HRVQgKi8sIFwiL3YxL3JlY2FwdGNoYVBhcmFtc1wiIC8qIEVuZHBvaW50LkdFVF9SRUNBUFRDSEFfUEFSQU0gKi8pKS5yZWNhcHRjaGFTaXRlS2V5IHx8ICcnKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldFJlY2FwdGNoYUNvbmZpZyhhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIkdFVFwiIC8qIEh0dHBNZXRob2QuR0VUICovLCBcIi92Mi9yZWNhcHRjaGFDb25maWdcIiAvKiBFbmRwb2ludC5HRVRfUkVDQVBUQ0hBX0NPTkZJRyAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGRlbGV0ZUFjY291bnQoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpkZWxldGVcIiAvKiBFbmRwb2ludC5ERUxFVEVfQUNDT1VOVCAqLywgcmVxdWVzdCk7XG59XG5hc3luYyBmdW5jdGlvbiBkZWxldGVMaW5rZWRBY2NvdW50cyhhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnVwZGF0ZVwiIC8qIEVuZHBvaW50LlNFVF9BQ0NPVU5UX0lORk8gKi8sIHJlcXVlc3QpO1xufVxuYXN5bmMgZnVuY3Rpb24gZ2V0QWNjb3VudEluZm8oYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpsb29rdXBcIiAvKiBFbmRwb2ludC5HRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIHV0Y1RpbWVzdGFtcFRvRGF0ZVN0cmluZyh1dGNUaW1lc3RhbXApIHtcbiAgICBpZiAoIXV0Y1RpbWVzdGFtcCkge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICAvLyBDb252ZXJ0IHRvIGRhdGUgb2JqZWN0LlxuICAgICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUoTnVtYmVyKHV0Y1RpbWVzdGFtcCkpO1xuICAgICAgICAvLyBUZXN0IGRhdGUgaXMgdmFsaWQuXG4gICAgICAgIGlmICghaXNOYU4oZGF0ZS5nZXRUaW1lKCkpKSB7XG4gICAgICAgICAgICAvLyBDb252ZXJ0IHRvIFVUQyBkYXRlIHN0cmluZy5cbiAgICAgICAgICAgIHJldHVybiBkYXRlLnRvVVRDU3RyaW5nKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgLy8gRG8gbm90aGluZy4gdW5kZWZpbmVkIHdpbGwgYmUgcmV0dXJuZWQuXG4gICAgfVxuICAgIHJldHVybiB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYSBKU09OIFdlYiBUb2tlbiAoSldUKSB1c2VkIHRvIGlkZW50aWZ5IHRoZSB1c2VyIHRvIGEgRmlyZWJhc2Ugc2VydmljZS5cbiAqXG4gKiBAcmVtYXJrc1xuICogUmV0dXJucyB0aGUgY3VycmVudCB0b2tlbiBpZiBpdCBoYXMgbm90IGV4cGlyZWQgb3IgaWYgaXQgd2lsbCBub3QgZXhwaXJlIGluIHRoZSBuZXh0IGZpdmVcbiAqIG1pbnV0ZXMuIE90aGVyd2lzZSwgdGhpcyB3aWxsIHJlZnJlc2ggdGhlIHRva2VuIGFuZCByZXR1cm4gYSBuZXcgb25lLlxuICpcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXG4gKiBAcGFyYW0gZm9yY2VSZWZyZXNoIC0gRm9yY2UgcmVmcmVzaCByZWdhcmRsZXNzIG9mIHRva2VuIGV4cGlyYXRpb24uXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiBnZXRJZFRva2VuKHVzZXIsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7XG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKS5nZXRJZFRva2VuKGZvcmNlUmVmcmVzaCk7XG59XG4vKipcbiAqIFJldHVybnMgYSBkZXNlcmlhbGl6ZWQgSlNPTiBXZWIgVG9rZW4gKEpXVCkgdXNlZCB0byBpZGVudGlmeSB0aGUgdXNlciB0byBhIEZpcmViYXNlIHNlcnZpY2UuXG4gKlxuICogQHJlbWFya3NcbiAqIFJldHVybnMgdGhlIGN1cnJlbnQgdG9rZW4gaWYgaXQgaGFzIG5vdCBleHBpcmVkIG9yIGlmIGl0IHdpbGwgbm90IGV4cGlyZSBpbiB0aGUgbmV4dCBmaXZlXG4gKiBtaW51dGVzLiBPdGhlcndpc2UsIHRoaXMgd2lsbCByZWZyZXNoIHRoZSB0b2tlbiBhbmQgcmV0dXJuIGEgbmV3IG9uZS5cbiAqXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxuICogQHBhcmFtIGZvcmNlUmVmcmVzaCAtIEZvcmNlIHJlZnJlc2ggcmVnYXJkbGVzcyBvZiB0b2tlbiBleHBpcmF0aW9uLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0SWRUb2tlblJlc3VsdCh1c2VyLCBmb3JjZVJlZnJlc2ggPSBmYWxzZSkge1xuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IHVzZXJJbnRlcm5hbC5nZXRJZFRva2VuKGZvcmNlUmVmcmVzaCk7XG4gICAgY29uc3QgY2xhaW1zID0gX3BhcnNlVG9rZW4odG9rZW4pO1xuICAgIF9hc3NlcnQoY2xhaW1zICYmIGNsYWltcy5leHAgJiYgY2xhaW1zLmF1dGhfdGltZSAmJiBjbGFpbXMuaWF0LCB1c2VySW50ZXJuYWwuYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgIGNvbnN0IGZpcmViYXNlID0gdHlwZW9mIGNsYWltcy5maXJlYmFzZSA9PT0gJ29iamVjdCcgPyBjbGFpbXMuZmlyZWJhc2UgOiB1bmRlZmluZWQ7XG4gICAgY29uc3Qgc2lnbkluUHJvdmlkZXIgPSBmaXJlYmFzZSA9PT0gbnVsbCB8fCBmaXJlYmFzZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZmlyZWJhc2VbJ3NpZ25faW5fcHJvdmlkZXInXTtcbiAgICByZXR1cm4ge1xuICAgICAgICBjbGFpbXMsXG4gICAgICAgIHRva2VuLFxuICAgICAgICBhdXRoVGltZTogdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhjbGFpbXMuYXV0aF90aW1lKSksXG4gICAgICAgIGlzc3VlZEF0VGltZTogdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHNlY29uZHNTdHJpbmdUb01pbGxpc2Vjb25kcyhjbGFpbXMuaWF0KSksXG4gICAgICAgIGV4cGlyYXRpb25UaW1lOiB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcoc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKGNsYWltcy5leHApKSxcbiAgICAgICAgc2lnbkluUHJvdmlkZXI6IHNpZ25JblByb3ZpZGVyIHx8IG51bGwsXG4gICAgICAgIHNpZ25JblNlY29uZEZhY3RvcjogKGZpcmViYXNlID09PSBudWxsIHx8IGZpcmViYXNlID09PSB2b2lkIDAgPyB2b2lkIDAgOiBmaXJlYmFzZVsnc2lnbl9pbl9zZWNvbmRfZmFjdG9yJ10pIHx8IG51bGxcbiAgICB9O1xufVxuZnVuY3Rpb24gc2Vjb25kc1N0cmluZ1RvTWlsbGlzZWNvbmRzKHNlY29uZHMpIHtcbiAgICByZXR1cm4gTnVtYmVyKHNlY29uZHMpICogMTAwMDtcbn1cbmZ1bmN0aW9uIF9wYXJzZVRva2VuKHRva2VuKSB7XG4gICAgY29uc3QgW2FsZ29yaXRobSwgcGF5bG9hZCwgc2lnbmF0dXJlXSA9IHRva2VuLnNwbGl0KCcuJyk7XG4gICAgaWYgKGFsZ29yaXRobSA9PT0gdW5kZWZpbmVkIHx8XG4gICAgICAgIHBheWxvYWQgPT09IHVuZGVmaW5lZCB8fFxuICAgICAgICBzaWduYXR1cmUgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICBfbG9nRXJyb3IoJ0pXVCBtYWxmb3JtZWQsIGNvbnRhaW5lZCBmZXdlciB0aGFuIDMgc2VjdGlvbnMnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGRlY29kZWQgPSBiYXNlNjREZWNvZGUocGF5bG9hZCk7XG4gICAgICAgIGlmICghZGVjb2RlZCkge1xuICAgICAgICAgICAgX2xvZ0Vycm9yKCdGYWlsZWQgdG8gZGVjb2RlIGJhc2U2NCBKV1QgcGF5bG9hZCcpO1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZGVjb2RlZCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIF9sb2dFcnJvcignQ2F1Z2h0IGVycm9yIHBhcnNpbmcgSldUIHBheWxvYWQgYXMgSlNPTicsIGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS50b1N0cmluZygpKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuLyoqXG4gKiBFeHRyYWN0IGV4cGlyZXNJbiBUVEwgZnJvbSBhIHRva2VuIGJ5IHN1YnRyYWN0aW5nIHRoZSBleHBpcmF0aW9uIGZyb20gdGhlIGlzc3VhbmNlLlxuICovXG5mdW5jdGlvbiBfdG9rZW5FeHBpcmVzSW4odG9rZW4pIHtcbiAgICBjb25zdCBwYXJzZWRUb2tlbiA9IF9wYXJzZVRva2VuKHRva2VuKTtcbiAgICBfYXNzZXJ0KHBhcnNlZFRva2VuLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgX2Fzc2VydCh0eXBlb2YgcGFyc2VkVG9rZW4uZXhwICE9PSAndW5kZWZpbmVkJywgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgIF9hc3NlcnQodHlwZW9mIHBhcnNlZFRva2VuLmlhdCAhPT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICByZXR1cm4gTnVtYmVyKHBhcnNlZFRva2VuLmV4cCkgLSBOdW1iZXIocGFyc2VkVG9rZW4uaWF0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIHByb21pc2UsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7XG4gICAgaWYgKGJ5cGFzc0F1dGhTdGF0ZSkge1xuICAgICAgICByZXR1cm4gcHJvbWlzZTtcbiAgICB9XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHByb21pc2U7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRmlyZWJhc2VFcnJvciAmJiBpc1VzZXJJbnZhbGlkYXRlZChlKSkge1xuICAgICAgICAgICAgaWYgKHVzZXIuYXV0aC5jdXJyZW50VXNlciA9PT0gdXNlcikge1xuICAgICAgICAgICAgICAgIGF3YWl0IHVzZXIuYXV0aC5zaWduT3V0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZTtcbiAgICB9XG59XG5mdW5jdGlvbiBpc1VzZXJJbnZhbGlkYXRlZCh7IGNvZGUgfSkge1xuICAgIHJldHVybiAoY29kZSA9PT0gYGF1dGgvJHtcInVzZXItZGlzYWJsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfRElTQUJMRUQgKi99YCB8fFxuICAgICAgICBjb2RlID09PSBgYXV0aC8ke1widXNlci10b2tlbi1leHBpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5UT0tFTl9FWFBJUkVEICovfWApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgUHJvYWN0aXZlUmVmcmVzaCB7XG4gICAgY29uc3RydWN0b3IodXNlcikge1xuICAgICAgICB0aGlzLnVzZXIgPSB1c2VyO1xuICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlO1xuICAgICAgICAvLyBOb2RlIHRpbWVycyBhbmQgYnJvd3NlciB0aW1lcnMgcmV0dXJuIGZ1bmRhbWVudGFsbHkgZGlmZmVyZW50IHR5cGVzLlxuICAgICAgICAvLyBXZSBkb24ndCBhY3R1YWxseSBjYXJlIHdoYXQgdGhlIHZhbHVlIGlzIGJ1dCBUUyB3b24ndCBhY2NlcHQgdW5rbm93biBhbmRcbiAgICAgICAgLy8gd2UgY2FuJ3QgY2FzdCBwcm9wZXJseSBpbiBib3RoIGVudmlyb25tZW50cy5cbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgdGhpcy50aW1lcklkID0gbnVsbDtcbiAgICAgICAgdGhpcy5lcnJvckJhY2tvZmYgPSAzMDAwMCAvKiBEdXJhdGlvbi5SRVRSWV9CQUNLT0ZGX01JTiAqLztcbiAgICB9XG4gICAgX3N0YXJ0KCkge1xuICAgICAgICBpZiAodGhpcy5pc1J1bm5pbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzUnVubmluZyA9IHRydWU7XG4gICAgICAgIHRoaXMuc2NoZWR1bGUoKTtcbiAgICB9XG4gICAgX3N0b3AoKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmlzUnVubmluZyA9IGZhbHNlO1xuICAgICAgICBpZiAodGhpcy50aW1lcklkICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRJbnRlcnZhbCh3YXNFcnJvcikge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmICh3YXNFcnJvcikge1xuICAgICAgICAgICAgY29uc3QgaW50ZXJ2YWwgPSB0aGlzLmVycm9yQmFja29mZjtcbiAgICAgICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gTWF0aC5taW4odGhpcy5lcnJvckJhY2tvZmYgKiAyLCA5NjAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NQVggKi8pO1xuICAgICAgICAgICAgcmV0dXJuIGludGVydmFsO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gUmVzZXQgdGhlIGVycm9yIGJhY2tvZmZcbiAgICAgICAgICAgIHRoaXMuZXJyb3JCYWNrb2ZmID0gMzAwMDAgLyogRHVyYXRpb24uUkVUUllfQkFDS09GRl9NSU4gKi87XG4gICAgICAgICAgICBjb25zdCBleHBUaW1lID0gKF9hID0gdGhpcy51c2VyLnN0c1Rva2VuTWFuYWdlci5leHBpcmF0aW9uVGltZSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogMDtcbiAgICAgICAgICAgIGNvbnN0IGludGVydmFsID0gZXhwVGltZSAtIERhdGUubm93KCkgLSAzMDAwMDAgLyogRHVyYXRpb24uT0ZGU0VUICovO1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgubWF4KDAsIGludGVydmFsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzY2hlZHVsZSh3YXNFcnJvciA9IGZhbHNlKSB7XG4gICAgICAgIGlmICghdGhpcy5pc1J1bm5pbmcpIHtcbiAgICAgICAgICAgIC8vIEp1c3QgaW4gY2FzZS4uLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGludGVydmFsID0gdGhpcy5nZXRJbnRlcnZhbCh3YXNFcnJvcik7XG4gICAgICAgIHRoaXMudGltZXJJZCA9IHNldFRpbWVvdXQoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5pdGVyYXRpb24oKTtcbiAgICAgICAgfSwgaW50ZXJ2YWwpO1xuICAgIH1cbiAgICBhc3luYyBpdGVyYXRpb24oKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gT25seSByZXRyeSBvbiBuZXR3b3JrIGVycm9yc1xuICAgICAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgPT09XG4gICAgICAgICAgICAgICAgYGF1dGgvJHtcIm5ldHdvcmstcmVxdWVzdC1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi99YCkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGUoLyogd2FzRXJyb3IgKi8gdHJ1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zY2hlZHVsZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIFVzZXJNZXRhZGF0YSB7XG4gICAgY29uc3RydWN0b3IoY3JlYXRlZEF0LCBsYXN0TG9naW5BdCkge1xuICAgICAgICB0aGlzLmNyZWF0ZWRBdCA9IGNyZWF0ZWRBdDtcbiAgICAgICAgdGhpcy5sYXN0TG9naW5BdCA9IGxhc3RMb2dpbkF0O1xuICAgICAgICB0aGlzLl9pbml0aWFsaXplVGltZSgpO1xuICAgIH1cbiAgICBfaW5pdGlhbGl6ZVRpbWUoKSB7XG4gICAgICAgIHRoaXMubGFzdFNpZ25JblRpbWUgPSB1dGNUaW1lc3RhbXBUb0RhdGVTdHJpbmcodGhpcy5sYXN0TG9naW5BdCk7XG4gICAgICAgIHRoaXMuY3JlYXRpb25UaW1lID0gdXRjVGltZXN0YW1wVG9EYXRlU3RyaW5nKHRoaXMuY3JlYXRlZEF0KTtcbiAgICB9XG4gICAgX2NvcHkobWV0YWRhdGEpIHtcbiAgICAgICAgdGhpcy5jcmVhdGVkQXQgPSBtZXRhZGF0YS5jcmVhdGVkQXQ7XG4gICAgICAgIHRoaXMubGFzdExvZ2luQXQgPSBtZXRhZGF0YS5sYXN0TG9naW5BdDtcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZVRpbWUoKTtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3JlYXRlZEF0OiB0aGlzLmNyZWF0ZWRBdCxcbiAgICAgICAgICAgIGxhc3RMb2dpbkF0OiB0aGlzLmxhc3RMb2dpbkF0XG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcikge1xuICAgIHZhciBfYTtcbiAgICBjb25zdCBhdXRoID0gdXNlci5hdXRoO1xuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VyLmdldElkVG9rZW4oKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIGdldEFjY291bnRJbmZvKGF1dGgsIHsgaWRUb2tlbiB9KSk7XG4gICAgX2Fzc2VydChyZXNwb25zZSA9PT0gbnVsbCB8fCByZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcmVzcG9uc2UudXNlcnMubGVuZ3RoLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgY29uc3QgY29yZUFjY291bnQgPSByZXNwb25zZS51c2Vyc1swXTtcbiAgICB1c2VyLl9ub3RpZnlSZWxvYWRMaXN0ZW5lcihjb3JlQWNjb3VudCk7XG4gICAgY29uc3QgbmV3UHJvdmlkZXJEYXRhID0gKChfYSA9IGNvcmVBY2NvdW50LnByb3ZpZGVyVXNlckluZm8pID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5sZW5ndGgpXG4gICAgICAgID8gZXh0cmFjdFByb3ZpZGVyRGF0YShjb3JlQWNjb3VudC5wcm92aWRlclVzZXJJbmZvKVxuICAgICAgICA6IFtdO1xuICAgIGNvbnN0IHByb3ZpZGVyRGF0YSA9IG1lcmdlUHJvdmlkZXJEYXRhKHVzZXIucHJvdmlkZXJEYXRhLCBuZXdQcm92aWRlckRhdGEpO1xuICAgIC8vIFByZXNlcnZlcyB0aGUgbm9uLW5vbnltb3VzIHN0YXR1cyBvZiB0aGUgc3RvcmVkIHVzZXIsIGV2ZW4gaWYgbm8gbW9yZVxuICAgIC8vIGNyZWRlbnRpYWxzIChmZWRlcmF0ZWQgb3IgZW1haWwvcGFzc3dvcmQpIGFyZSBsaW5rZWQgdG8gdGhlIHVzZXIuIElmXG4gICAgLy8gdGhlIHVzZXIgd2FzIHByZXZpb3VzbHkgYW5vbnltb3VzLCB0aGVuIHVzZSBwcm92aWRlciBkYXRhIHRvIHVwZGF0ZS5cbiAgICAvLyBPbiB0aGUgb3RoZXIgaGFuZCwgaWYgaXQgd2FzIG5vdCBhbm9ueW1vdXMgYmVmb3JlLCBpdCBzaG91bGQgbmV2ZXIgYmVcbiAgICAvLyBjb25zaWRlcmVkIGFub255bW91cyBub3cuXG4gICAgY29uc3Qgb2xkSXNBbm9ueW1vdXMgPSB1c2VyLmlzQW5vbnltb3VzO1xuICAgIGNvbnN0IG5ld0lzQW5vbnltb3VzID0gISh1c2VyLmVtYWlsICYmIGNvcmVBY2NvdW50LnBhc3N3b3JkSGFzaCkgJiYgIShwcm92aWRlckRhdGEgPT09IG51bGwgfHwgcHJvdmlkZXJEYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm92aWRlckRhdGEubGVuZ3RoKTtcbiAgICBjb25zdCBpc0Fub255bW91cyA9ICFvbGRJc0Fub255bW91cyA/IGZhbHNlIDogbmV3SXNBbm9ueW1vdXM7XG4gICAgY29uc3QgdXBkYXRlcyA9IHtcbiAgICAgICAgdWlkOiBjb3JlQWNjb3VudC5sb2NhbElkLFxuICAgICAgICBkaXNwbGF5TmFtZTogY29yZUFjY291bnQuZGlzcGxheU5hbWUgfHwgbnVsbCxcbiAgICAgICAgcGhvdG9VUkw6IGNvcmVBY2NvdW50LnBob3RvVXJsIHx8IG51bGwsXG4gICAgICAgIGVtYWlsOiBjb3JlQWNjb3VudC5lbWFpbCB8fCBudWxsLFxuICAgICAgICBlbWFpbFZlcmlmaWVkOiBjb3JlQWNjb3VudC5lbWFpbFZlcmlmaWVkIHx8IGZhbHNlLFxuICAgICAgICBwaG9uZU51bWJlcjogY29yZUFjY291bnQucGhvbmVOdW1iZXIgfHwgbnVsbCxcbiAgICAgICAgdGVuYW50SWQ6IGNvcmVBY2NvdW50LnRlbmFudElkIHx8IG51bGwsXG4gICAgICAgIHByb3ZpZGVyRGF0YSxcbiAgICAgICAgbWV0YWRhdGE6IG5ldyBVc2VyTWV0YWRhdGEoY29yZUFjY291bnQuY3JlYXRlZEF0LCBjb3JlQWNjb3VudC5sYXN0TG9naW5BdCksXG4gICAgICAgIGlzQW5vbnltb3VzXG4gICAgfTtcbiAgICBPYmplY3QuYXNzaWduKHVzZXIsIHVwZGF0ZXMpO1xufVxuLyoqXG4gKiBSZWxvYWRzIHVzZXIgYWNjb3VudCBkYXRhLCBpZiBzaWduZWQgaW4uXG4gKlxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlbG9hZCh1c2VyKSB7XG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xuICAgIGF3YWl0IF9yZWxvYWRXaXRob3V0U2F2aW5nKHVzZXJJbnRlcm5hbCk7XG4gICAgLy8gRXZlbiB0aG91Z2ggdGhlIGN1cnJlbnQgdXNlciBoYXNuJ3QgY2hhbmdlZCwgdXBkYXRlXG4gICAgLy8gY3VycmVudCB1c2VyIHdpbGwgdHJpZ2dlciBhIHBlcnNpc3RlbmNlIHVwZGF0ZSB3LyB0aGVcbiAgICAvLyBuZXcgaW5mby5cbiAgICBhd2FpdCB1c2VySW50ZXJuYWwuYXV0aC5fcGVyc2lzdFVzZXJJZkN1cnJlbnQodXNlckludGVybmFsKTtcbiAgICB1c2VySW50ZXJuYWwuYXV0aC5fbm90aWZ5TGlzdGVuZXJzSWZDdXJyZW50KHVzZXJJbnRlcm5hbCk7XG59XG5mdW5jdGlvbiBtZXJnZVByb3ZpZGVyRGF0YShvcmlnaW5hbCwgbmV3RGF0YSkge1xuICAgIGNvbnN0IGRlZHVwZWQgPSBvcmlnaW5hbC5maWx0ZXIobyA9PiAhbmV3RGF0YS5zb21lKG4gPT4gbi5wcm92aWRlcklkID09PSBvLnByb3ZpZGVySWQpKTtcbiAgICByZXR1cm4gWy4uLmRlZHVwZWQsIC4uLm5ld0RhdGFdO1xufVxuZnVuY3Rpb24gZXh0cmFjdFByb3ZpZGVyRGF0YShwcm92aWRlcnMpIHtcbiAgICByZXR1cm4gcHJvdmlkZXJzLm1hcCgoX2EpID0+IHtcbiAgICAgICAgdmFyIHsgcHJvdmlkZXJJZCB9ID0gX2EsIHByb3ZpZGVyID0gX19yZXN0KF9hLCBbXCJwcm92aWRlcklkXCJdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQsXG4gICAgICAgICAgICB1aWQ6IHByb3ZpZGVyLnJhd0lkIHx8ICcnLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IHByb3ZpZGVyLmRpc3BsYXlOYW1lIHx8IG51bGwsXG4gICAgICAgICAgICBlbWFpbDogcHJvdmlkZXIuZW1haWwgfHwgbnVsbCxcbiAgICAgICAgICAgIHBob25lTnVtYmVyOiBwcm92aWRlci5waG9uZU51bWJlciB8fCBudWxsLFxuICAgICAgICAgICAgcGhvdG9VUkw6IHByb3ZpZGVyLnBob3RvVXJsIHx8IG51bGxcbiAgICAgICAgfTtcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlcXVlc3RTdHNUb2tlbihhdXRoLCByZWZyZXNoVG9rZW4pIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wZXJmb3JtRmV0Y2hXaXRoRXJyb3JIYW5kbGluZyhhdXRoLCB7fSwgYXN5bmMgKCkgPT4ge1xuICAgICAgICBjb25zdCBib2R5ID0gcXVlcnlzdHJpbmcoe1xuICAgICAgICAgICAgJ2dyYW50X3R5cGUnOiAncmVmcmVzaF90b2tlbicsXG4gICAgICAgICAgICAncmVmcmVzaF90b2tlbic6IHJlZnJlc2hUb2tlblxuICAgICAgICB9KS5zbGljZSgxKTtcbiAgICAgICAgY29uc3QgeyB0b2tlbkFwaUhvc3QsIGFwaUtleSB9ID0gYXV0aC5jb25maWc7XG4gICAgICAgIGNvbnN0IHVybCA9IGF3YWl0IF9nZXRGaW5hbFRhcmdldChhdXRoLCB0b2tlbkFwaUhvc3QsIFwiL3YxL3Rva2VuXCIgLyogRW5kcG9pbnQuVE9LRU4gKi8sIGBrZXk9JHthcGlLZXl9YCk7XG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSBhd2FpdCBhdXRoLl9nZXRBZGRpdGlvbmFsSGVhZGVycygpO1xuICAgICAgICBoZWFkZXJzW1wiQ29udGVudC1UeXBlXCIgLyogSHR0cEhlYWRlci5DT05URU5UX1RZUEUgKi9dID0gJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCc7XG4gICAgICAgIHJldHVybiBGZXRjaFByb3ZpZGVyLmZldGNoKCkodXJsLCB7XG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLyxcbiAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgICBib2R5XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIC8vIFRoZSByZXNwb25zZSBjb21lcyBiYWNrIGluIHNuYWtlX2Nhc2UuIENvbnZlcnQgdG8gY2FtZWw6XG4gICAgcmV0dXJuIHtcbiAgICAgICAgYWNjZXNzVG9rZW46IHJlc3BvbnNlLmFjY2Vzc190b2tlbixcbiAgICAgICAgZXhwaXJlc0luOiByZXNwb25zZS5leHBpcmVzX2luLFxuICAgICAgICByZWZyZXNoVG9rZW46IHJlc3BvbnNlLnJlZnJlc2hfdG9rZW5cbiAgICB9O1xufVxuYXN5bmMgZnVuY3Rpb24gcmV2b2tlVG9rZW4oYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92Mi9hY2NvdW50czpyZXZva2VUb2tlblwiIC8qIEVuZHBvaW50LlJFVk9LRV9UT0tFTiAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogV2UgbmVlZCB0byBtYXJrIHRoaXMgY2xhc3MgYXMgaW50ZXJuYWwgZXhwbGljaXRseSB0byBleGNsdWRlIGl0IGluIHRoZSBwdWJsaWMgdHlwaW5ncywgYmVjYXVzZVxuICogaXQgcmVmZXJlbmNlcyBBdXRoSW50ZXJuYWwgd2hpY2ggaGFzIGEgY2lyY3VsYXIgZGVwZW5kZW5jeSB3aXRoIFVzZXJJbnRlcm5hbC5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqL1xuY2xhc3MgU3RzVG9rZW5NYW5hZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5yZWZyZXNoVG9rZW4gPSBudWxsO1xuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gbnVsbDtcbiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IG51bGw7XG4gICAgfVxuICAgIGdldCBpc0V4cGlyZWQoKSB7XG4gICAgICAgIHJldHVybiAoIXRoaXMuZXhwaXJhdGlvblRpbWUgfHxcbiAgICAgICAgICAgIERhdGUubm93KCkgPiB0aGlzLmV4cGlyYXRpb25UaW1lIC0gMzAwMDAgLyogQnVmZmVyLlRPS0VOX1JFRlJFU0ggKi8pO1xuICAgIH1cbiAgICB1cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UocmVzcG9uc2UpIHtcbiAgICAgICAgX2Fzc2VydChyZXNwb25zZS5pZFRva2VuLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIF9hc3NlcnQodHlwZW9mIHJlc3BvbnNlLmlkVG9rZW4gIT09ICd1bmRlZmluZWQnLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIF9hc3NlcnQodHlwZW9mIHJlc3BvbnNlLnJlZnJlc2hUb2tlbiAhPT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgY29uc3QgZXhwaXJlc0luID0gJ2V4cGlyZXNJbicgaW4gcmVzcG9uc2UgJiYgdHlwZW9mIHJlc3BvbnNlLmV4cGlyZXNJbiAhPT0gJ3VuZGVmaW5lZCdcbiAgICAgICAgICAgID8gTnVtYmVyKHJlc3BvbnNlLmV4cGlyZXNJbilcbiAgICAgICAgICAgIDogX3Rva2VuRXhwaXJlc0luKHJlc3BvbnNlLmlkVG9rZW4pO1xuICAgICAgICB0aGlzLnVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24ocmVzcG9uc2UuaWRUb2tlbiwgcmVzcG9uc2UucmVmcmVzaFRva2VuLCBleHBpcmVzSW4pO1xuICAgIH1cbiAgICB1cGRhdGVGcm9tSWRUb2tlbihpZFRva2VuKSB7XG4gICAgICAgIF9hc3NlcnQoaWRUb2tlbi5sZW5ndGggIT09IDAsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgY29uc3QgZXhwaXJlc0luID0gX3Rva2VuRXhwaXJlc0luKGlkVG9rZW4pO1xuICAgICAgICB0aGlzLnVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24oaWRUb2tlbiwgbnVsbCwgZXhwaXJlc0luKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0VG9rZW4oYXV0aCwgZm9yY2VSZWZyZXNoID0gZmFsc2UpIHtcbiAgICAgICAgaWYgKCFmb3JjZVJlZnJlc2ggJiYgdGhpcy5hY2Nlc3NUb2tlbiAmJiAhdGhpcy5pc0V4cGlyZWQpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmFjY2Vzc1Rva2VuO1xuICAgICAgICB9XG4gICAgICAgIF9hc3NlcnQodGhpcy5yZWZyZXNoVG9rZW4sIGF1dGgsIFwidXNlci10b2tlbi1leHBpcmVkXCIgLyogQXV0aEVycm9yQ29kZS5UT0tFTl9FWFBJUkVEICovKTtcbiAgICAgICAgaWYgKHRoaXMucmVmcmVzaFRva2VuKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLnJlZnJlc2goYXV0aCwgdGhpcy5yZWZyZXNoVG9rZW4pO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYWNjZXNzVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNsZWFyUmVmcmVzaFRva2VuKCkge1xuICAgICAgICB0aGlzLnJlZnJlc2hUb2tlbiA9IG51bGw7XG4gICAgfVxuICAgIGFzeW5jIHJlZnJlc2goYXV0aCwgb2xkVG9rZW4pIHtcbiAgICAgICAgY29uc3QgeyBhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuLCBleHBpcmVzSW4gfSA9IGF3YWl0IHJlcXVlc3RTdHNUb2tlbihhdXRoLCBvbGRUb2tlbik7XG4gICAgICAgIHRoaXMudXBkYXRlVG9rZW5zQW5kRXhwaXJhdGlvbihhY2Nlc3NUb2tlbiwgcmVmcmVzaFRva2VuLCBOdW1iZXIoZXhwaXJlc0luKSk7XG4gICAgfVxuICAgIHVwZGF0ZVRva2Vuc0FuZEV4cGlyYXRpb24oYWNjZXNzVG9rZW4sIHJlZnJlc2hUb2tlbiwgZXhwaXJlc0luU2VjKSB7XG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gcmVmcmVzaFRva2VuIHx8IG51bGw7XG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBhY2Nlc3NUb2tlbiB8fCBudWxsO1xuICAgICAgICB0aGlzLmV4cGlyYXRpb25UaW1lID0gRGF0ZS5ub3coKSArIGV4cGlyZXNJblNlYyAqIDEwMDA7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tSlNPTihhcHBOYW1lLCBvYmplY3QpIHtcbiAgICAgICAgY29uc3QgeyByZWZyZXNoVG9rZW4sIGFjY2Vzc1Rva2VuLCBleHBpcmF0aW9uVGltZSB9ID0gb2JqZWN0O1xuICAgICAgICBjb25zdCBtYW5hZ2VyID0gbmV3IFN0c1Rva2VuTWFuYWdlcigpO1xuICAgICAgICBpZiAocmVmcmVzaFRva2VuKSB7XG4gICAgICAgICAgICBfYXNzZXJ0KHR5cGVvZiByZWZyZXNoVG9rZW4gPT09ICdzdHJpbmcnLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLywge1xuICAgICAgICAgICAgICAgIGFwcE5hbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbWFuYWdlci5yZWZyZXNoVG9rZW4gPSByZWZyZXNoVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICBfYXNzZXJ0KHR5cGVvZiBhY2Nlc3NUb2tlbiA9PT0gJ3N0cmluZycsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7XG4gICAgICAgICAgICAgICAgYXBwTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtYW5hZ2VyLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGV4cGlyYXRpb25UaW1lKSB7XG4gICAgICAgICAgICBfYXNzZXJ0KHR5cGVvZiBleHBpcmF0aW9uVGltZSA9PT0gJ251bWJlcicsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7XG4gICAgICAgICAgICAgICAgYXBwTmFtZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBtYW5hZ2VyLmV4cGlyYXRpb25UaW1lID0gZXhwaXJhdGlvblRpbWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG1hbmFnZXI7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHJlZnJlc2hUb2tlbjogdGhpcy5yZWZyZXNoVG9rZW4sXG4gICAgICAgICAgICBhY2Nlc3NUb2tlbjogdGhpcy5hY2Nlc3NUb2tlbixcbiAgICAgICAgICAgIGV4cGlyYXRpb25UaW1lOiB0aGlzLmV4cGlyYXRpb25UaW1lXG4gICAgICAgIH07XG4gICAgfVxuICAgIF9hc3NpZ24oc3RzVG9rZW5NYW5hZ2VyKSB7XG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBzdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW47XG4gICAgICAgIHRoaXMucmVmcmVzaFRva2VuID0gc3RzVG9rZW5NYW5hZ2VyLnJlZnJlc2hUb2tlbjtcbiAgICAgICAgdGhpcy5leHBpcmF0aW9uVGltZSA9IHN0c1Rva2VuTWFuYWdlci5leHBpcmF0aW9uVGltZTtcbiAgICB9XG4gICAgX2Nsb25lKCkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihuZXcgU3RzVG9rZW5NYW5hZ2VyKCksIHRoaXMudG9KU09OKCkpO1xuICAgIH1cbiAgICBfcGVyZm9ybVJlZnJlc2goKSB7XG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGFzc2VydGlvbiwgYXBwTmFtZSkge1xuICAgIF9hc3NlcnQodHlwZW9mIGFzc2VydGlvbiA9PT0gJ3N0cmluZycgfHwgdHlwZW9mIGFzc2VydGlvbiA9PT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovLCB7IGFwcE5hbWUgfSk7XG59XG5jbGFzcyBVc2VySW1wbCB7XG4gICAgY29uc3RydWN0b3IoX2EpIHtcbiAgICAgICAgdmFyIHsgdWlkLCBhdXRoLCBzdHNUb2tlbk1hbmFnZXIgfSA9IF9hLCBvcHQgPSBfX3Jlc3QoX2EsIFtcInVpZFwiLCBcImF1dGhcIiwgXCJzdHNUb2tlbk1hbmFnZXJcIl0pO1xuICAgICAgICAvLyBGb3IgdGhlIHVzZXIgb2JqZWN0LCBwcm92aWRlciBpcyBhbHdheXMgRmlyZWJhc2UuXG4gICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IFwiZmlyZWJhc2VcIiAvKiBQcm92aWRlcklkLkZJUkVCQVNFICovO1xuICAgICAgICB0aGlzLnByb2FjdGl2ZVJlZnJlc2ggPSBuZXcgUHJvYWN0aXZlUmVmcmVzaCh0aGlzKTtcbiAgICAgICAgdGhpcy5yZWxvYWRVc2VySW5mbyA9IG51bGw7XG4gICAgICAgIHRoaXMucmVsb2FkTGlzdGVuZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnVpZCA9IHVpZDtcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcbiAgICAgICAgdGhpcy5zdHNUb2tlbk1hbmFnZXIgPSBzdHNUb2tlbk1hbmFnZXI7XG4gICAgICAgIHRoaXMuYWNjZXNzVG9rZW4gPSBzdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW47XG4gICAgICAgIHRoaXMuZGlzcGxheU5hbWUgPSBvcHQuZGlzcGxheU5hbWUgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5lbWFpbCA9IG9wdC5lbWFpbCB8fCBudWxsO1xuICAgICAgICB0aGlzLmVtYWlsVmVyaWZpZWQgPSBvcHQuZW1haWxWZXJpZmllZCB8fCBmYWxzZTtcbiAgICAgICAgdGhpcy5waG9uZU51bWJlciA9IG9wdC5waG9uZU51bWJlciB8fCBudWxsO1xuICAgICAgICB0aGlzLnBob3RvVVJMID0gb3B0LnBob3RvVVJMIHx8IG51bGw7XG4gICAgICAgIHRoaXMuaXNBbm9ueW1vdXMgPSBvcHQuaXNBbm9ueW1vdXMgfHwgZmFsc2U7XG4gICAgICAgIHRoaXMudGVuYW50SWQgPSBvcHQudGVuYW50SWQgfHwgbnVsbDtcbiAgICAgICAgdGhpcy5wcm92aWRlckRhdGEgPSBvcHQucHJvdmlkZXJEYXRhID8gWy4uLm9wdC5wcm92aWRlckRhdGFdIDogW107XG4gICAgICAgIHRoaXMubWV0YWRhdGEgPSBuZXcgVXNlck1ldGFkYXRhKG9wdC5jcmVhdGVkQXQgfHwgdW5kZWZpbmVkLCBvcHQubGFzdExvZ2luQXQgfHwgdW5kZWZpbmVkKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0SWRUb2tlbihmb3JjZVJlZnJlc2gpIHtcbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh0aGlzLCB0aGlzLnN0c1Rva2VuTWFuYWdlci5nZXRUb2tlbih0aGlzLmF1dGgsIGZvcmNlUmVmcmVzaCkpO1xuICAgICAgICBfYXNzZXJ0KGFjY2Vzc1Rva2VuLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgaWYgKHRoaXMuYWNjZXNzVG9rZW4gIT09IGFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpO1xuICAgICAgICAgICAgdGhpcy5hdXRoLl9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodGhpcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFjY2Vzc1Rva2VuO1xuICAgIH1cbiAgICBnZXRJZFRva2VuUmVzdWx0KGZvcmNlUmVmcmVzaCkge1xuICAgICAgICByZXR1cm4gZ2V0SWRUb2tlblJlc3VsdCh0aGlzLCBmb3JjZVJlZnJlc2gpO1xuICAgIH1cbiAgICByZWxvYWQoKSB7XG4gICAgICAgIHJldHVybiByZWxvYWQodGhpcyk7XG4gICAgfVxuICAgIF9hc3NpZ24odXNlcikge1xuICAgICAgICBpZiAodGhpcyA9PT0gdXNlcikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIF9hc3NlcnQodGhpcy51aWQgPT09IHVzZXIudWlkLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IHVzZXIuZGlzcGxheU5hbWU7XG4gICAgICAgIHRoaXMucGhvdG9VUkwgPSB1c2VyLnBob3RvVVJMO1xuICAgICAgICB0aGlzLmVtYWlsID0gdXNlci5lbWFpbDtcbiAgICAgICAgdGhpcy5lbWFpbFZlcmlmaWVkID0gdXNlci5lbWFpbFZlcmlmaWVkO1xuICAgICAgICB0aGlzLnBob25lTnVtYmVyID0gdXNlci5waG9uZU51bWJlcjtcbiAgICAgICAgdGhpcy5pc0Fub255bW91cyA9IHVzZXIuaXNBbm9ueW1vdXM7XG4gICAgICAgIHRoaXMudGVuYW50SWQgPSB1c2VyLnRlbmFudElkO1xuICAgICAgICB0aGlzLnByb3ZpZGVyRGF0YSA9IHVzZXIucHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSk7XG4gICAgICAgIHRoaXMubWV0YWRhdGEuX2NvcHkodXNlci5tZXRhZGF0YSk7XG4gICAgICAgIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLl9hc3NpZ24odXNlci5zdHNUb2tlbk1hbmFnZXIpO1xuICAgIH1cbiAgICBfY2xvbmUoYXV0aCkge1xuICAgICAgICBjb25zdCBuZXdVc2VyID0gbmV3IFVzZXJJbXBsKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcyksIHsgYXV0aCwgc3RzVG9rZW5NYW5hZ2VyOiB0aGlzLnN0c1Rva2VuTWFuYWdlci5fY2xvbmUoKSB9KSk7XG4gICAgICAgIG5ld1VzZXIubWV0YWRhdGEuX2NvcHkodGhpcy5tZXRhZGF0YSk7XG4gICAgICAgIHJldHVybiBuZXdVc2VyO1xuICAgIH1cbiAgICBfb25SZWxvYWQoY2FsbGJhY2spIHtcbiAgICAgICAgLy8gVGhlcmUgc2hvdWxkIG9ubHkgZXZlciBiZSBvbmUgbGlzdGVuZXIsIGFuZCB0aGF0IGlzIGEgc2luZ2xlIGluc3RhbmNlIG9mIE11bHRpRmFjdG9yVXNlclxuICAgICAgICBfYXNzZXJ0KCF0aGlzLnJlbG9hZExpc3RlbmVyLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgdGhpcy5yZWxvYWRMaXN0ZW5lciA9IGNhbGxiYWNrO1xuICAgICAgICBpZiAodGhpcy5yZWxvYWRVc2VySW5mbykge1xuICAgICAgICAgICAgdGhpcy5fbm90aWZ5UmVsb2FkTGlzdGVuZXIodGhpcy5yZWxvYWRVc2VySW5mbyk7XG4gICAgICAgICAgICB0aGlzLnJlbG9hZFVzZXJJbmZvID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfbm90aWZ5UmVsb2FkTGlzdGVuZXIodXNlckluZm8pIHtcbiAgICAgICAgaWYgKHRoaXMucmVsb2FkTGlzdGVuZXIpIHtcbiAgICAgICAgICAgIHRoaXMucmVsb2FkTGlzdGVuZXIodXNlckluZm8pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgbm8gbGlzdGVuZXIgaXMgc3Vic2NyaWJlZCB5ZXQsIHNhdmUgdGhlIHJlc3VsdCBzbyBpdCdzIGF2YWlsYWJsZSB3aGVuIHRoZXkgZG8gc3Vic2NyaWJlXG4gICAgICAgICAgICB0aGlzLnJlbG9hZFVzZXJJbmZvID0gdXNlckluZm87XG4gICAgICAgIH1cbiAgICB9XG4gICAgX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5wcm9hY3RpdmVSZWZyZXNoLl9zdGFydCgpO1xuICAgIH1cbiAgICBfc3RvcFByb2FjdGl2ZVJlZnJlc2goKSB7XG4gICAgICAgIHRoaXMucHJvYWN0aXZlUmVmcmVzaC5fc3RvcCgpO1xuICAgIH1cbiAgICBhc3luYyBfdXBkYXRlVG9rZW5zSWZOZWNlc3NhcnkocmVzcG9uc2UsIHJlbG9hZCA9IGZhbHNlKSB7XG4gICAgICAgIGxldCB0b2tlbnNSZWZyZXNoZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHJlc3BvbnNlLmlkVG9rZW4gJiZcbiAgICAgICAgICAgIHJlc3BvbnNlLmlkVG9rZW4gIT09IHRoaXMuc3RzVG9rZW5NYW5hZ2VyLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICB0aGlzLnN0c1Rva2VuTWFuYWdlci51cGRhdGVGcm9tU2VydmVyUmVzcG9uc2UocmVzcG9uc2UpO1xuICAgICAgICAgICAgdG9rZW5zUmVmcmVzaGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVsb2FkKSB7XG4gICAgICAgICAgICBhd2FpdCBfcmVsb2FkV2l0aG91dFNhdmluZyh0aGlzKTtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCB0aGlzLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHRoaXMpO1xuICAgICAgICBpZiAodG9rZW5zUmVmcmVzaGVkKSB7XG4gICAgICAgICAgICB0aGlzLmF1dGguX25vdGlmeUxpc3RlbmVyc0lmQ3VycmVudCh0aGlzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBkZWxldGUoKSB7XG4gICAgICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcCh0aGlzLmF1dGguYXBwKSkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKHRoaXMuYXV0aCkpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLmdldElkVG9rZW4oKTtcbiAgICAgICAgYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodGhpcywgZGVsZXRlQWNjb3VudCh0aGlzLmF1dGgsIHsgaWRUb2tlbiB9KSk7XG4gICAgICAgIHRoaXMuc3RzVG9rZW5NYW5hZ2VyLmNsZWFyUmVmcmVzaFRva2VuKCk7XG4gICAgICAgIC8vIFRPRE86IERldGVybWluZSBpZiBjYW5jZWxsYWJsZS1wcm9taXNlcyBhcmUgbmVjZXNzYXJ5IHRvIHVzZSBpbiB0aGlzIGNsYXNzIHNvIHRoYXQgZGVsZXRlKClcbiAgICAgICAgLy8gICAgICAgY2FuY2VscyBwZW5kaW5nIGFjdGlvbnMuLi5cbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aC5zaWduT3V0KCk7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7IHVpZDogdGhpcy51aWQsIGVtYWlsOiB0aGlzLmVtYWlsIHx8IHVuZGVmaW5lZCwgZW1haWxWZXJpZmllZDogdGhpcy5lbWFpbFZlcmlmaWVkLCBkaXNwbGF5TmFtZTogdGhpcy5kaXNwbGF5TmFtZSB8fCB1bmRlZmluZWQsIGlzQW5vbnltb3VzOiB0aGlzLmlzQW5vbnltb3VzLCBwaG90b1VSTDogdGhpcy5waG90b1VSTCB8fCB1bmRlZmluZWQsIHBob25lTnVtYmVyOiB0aGlzLnBob25lTnVtYmVyIHx8IHVuZGVmaW5lZCwgdGVuYW50SWQ6IHRoaXMudGVuYW50SWQgfHwgdW5kZWZpbmVkLCBwcm92aWRlckRhdGE6IHRoaXMucHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSksIHN0c1Rva2VuTWFuYWdlcjogdGhpcy5zdHNUb2tlbk1hbmFnZXIudG9KU09OKCksIFxuICAgICAgICAgICAgLy8gUmVkaXJlY3QgZXZlbnQgSUQgbXVzdCBiZSBtYWludGFpbmVkIGluIGNhc2UgdGhlcmUgaXMgYSBwZW5kaW5nXG4gICAgICAgICAgICAvLyByZWRpcmVjdCBldmVudC5cbiAgICAgICAgICAgIF9yZWRpcmVjdEV2ZW50SWQ6IHRoaXMuX3JlZGlyZWN0RXZlbnRJZCB9LCB0aGlzLm1ldGFkYXRhLnRvSlNPTigpKSwgeyBcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBjb21wYXRpYmlsaXR5IHdpdGggdGhlIGxlZ2FjeSBTREsgKGdvL2ZpcmViYXNlLWF1dGgtc2RrLXBlcnNpc3RlbmNlLXBhcnNpbmcpOlxuICAgICAgICAgICAgYXBpS2V5OiB0aGlzLmF1dGguY29uZmlnLmFwaUtleSwgYXBwTmFtZTogdGhpcy5hdXRoLm5hbWUgfSk7XG4gICAgfVxuICAgIGdldCByZWZyZXNoVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnN0c1Rva2VuTWFuYWdlci5yZWZyZXNoVG9rZW4gfHwgJyc7XG4gICAgfVxuICAgIHN0YXRpYyBfZnJvbUpTT04oYXV0aCwgb2JqZWN0KSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZCwgX2UsIF9mLCBfZywgX2g7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlOYW1lID0gKF9hID0gb2JqZWN0LmRpc3BsYXlOYW1lKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IGVtYWlsID0gKF9iID0gb2JqZWN0LmVtYWlsKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHBob25lTnVtYmVyID0gKF9jID0gb2JqZWN0LnBob25lTnVtYmVyKSAhPT0gbnVsbCAmJiBfYyAhPT0gdm9pZCAwID8gX2MgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHBob3RvVVJMID0gKF9kID0gb2JqZWN0LnBob3RvVVJMKSAhPT0gbnVsbCAmJiBfZCAhPT0gdm9pZCAwID8gX2QgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHRlbmFudElkID0gKF9lID0gb2JqZWN0LnRlbmFudElkKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IF9yZWRpcmVjdEV2ZW50SWQgPSAoX2YgPSBvYmplY3QuX3JlZGlyZWN0RXZlbnRJZCkgIT09IG51bGwgJiYgX2YgIT09IHZvaWQgMCA/IF9mIDogdW5kZWZpbmVkO1xuICAgICAgICBjb25zdCBjcmVhdGVkQXQgPSAoX2cgPSBvYmplY3QuY3JlYXRlZEF0KSAhPT0gbnVsbCAmJiBfZyAhPT0gdm9pZCAwID8gX2cgOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IGxhc3RMb2dpbkF0ID0gKF9oID0gb2JqZWN0Lmxhc3RMb2dpbkF0KSAhPT0gbnVsbCAmJiBfaCAhPT0gdm9pZCAwID8gX2ggOiB1bmRlZmluZWQ7XG4gICAgICAgIGNvbnN0IHsgdWlkLCBlbWFpbFZlcmlmaWVkLCBpc0Fub255bW91cywgcHJvdmlkZXJEYXRhLCBzdHNUb2tlbk1hbmFnZXI6IHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyIH0gPSBvYmplY3Q7XG4gICAgICAgIF9hc3NlcnQodWlkICYmIHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IFN0c1Rva2VuTWFuYWdlci5mcm9tSlNPTih0aGlzLm5hbWUsIHBsYWluT2JqZWN0VG9rZW5NYW5hZ2VyKTtcbiAgICAgICAgX2Fzc2VydCh0eXBlb2YgdWlkID09PSAnc3RyaW5nJywgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChkaXNwbGF5TmFtZSwgYXV0aC5uYW1lKTtcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQoZW1haWwsIGF1dGgubmFtZSk7XG4gICAgICAgIF9hc3NlcnQodHlwZW9mIGVtYWlsVmVyaWZpZWQgPT09ICdib29sZWFuJywgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgICAgICBfYXNzZXJ0KHR5cGVvZiBpc0Fub255bW91cyA9PT0gJ2Jvb2xlYW4nLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKHBob25lTnVtYmVyLCBhdXRoLm5hbWUpO1xuICAgICAgICBhc3NlcnRTdHJpbmdPclVuZGVmaW5lZChwaG90b1VSTCwgYXV0aC5uYW1lKTtcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQodGVuYW50SWQsIGF1dGgubmFtZSk7XG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKF9yZWRpcmVjdEV2ZW50SWQsIGF1dGgubmFtZSk7XG4gICAgICAgIGFzc2VydFN0cmluZ09yVW5kZWZpbmVkKGNyZWF0ZWRBdCwgYXV0aC5uYW1lKTtcbiAgICAgICAgYXNzZXJ0U3RyaW5nT3JVbmRlZmluZWQobGFzdExvZ2luQXQsIGF1dGgubmFtZSk7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoe1xuICAgICAgICAgICAgdWlkLFxuICAgICAgICAgICAgYXV0aCxcbiAgICAgICAgICAgIGVtYWlsLFxuICAgICAgICAgICAgZW1haWxWZXJpZmllZCxcbiAgICAgICAgICAgIGRpc3BsYXlOYW1lLFxuICAgICAgICAgICAgaXNBbm9ueW1vdXMsXG4gICAgICAgICAgICBwaG90b1VSTCxcbiAgICAgICAgICAgIHBob25lTnVtYmVyLFxuICAgICAgICAgICAgdGVuYW50SWQsXG4gICAgICAgICAgICBzdHNUb2tlbk1hbmFnZXIsXG4gICAgICAgICAgICBjcmVhdGVkQXQsXG4gICAgICAgICAgICBsYXN0TG9naW5BdFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHByb3ZpZGVyRGF0YSAmJiBBcnJheS5pc0FycmF5KHByb3ZpZGVyRGF0YSkpIHtcbiAgICAgICAgICAgIHVzZXIucHJvdmlkZXJEYXRhID0gcHJvdmlkZXJEYXRhLm1hcCh1c2VySW5mbyA9PiAoT2JqZWN0LmFzc2lnbih7fSwgdXNlckluZm8pKSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKF9yZWRpcmVjdEV2ZW50SWQpIHtcbiAgICAgICAgICAgIHVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9IF9yZWRpcmVjdEV2ZW50SWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgYSBVc2VyIGZyb20gYW4gaWRUb2tlbiBzZXJ2ZXIgcmVzcG9uc2VcbiAgICAgKiBAcGFyYW0gYXV0aFxuICAgICAqIEBwYXJhbSBpZFRva2VuUmVzcG9uc2VcbiAgICAgKi9cbiAgICBzdGF0aWMgYXN5bmMgX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IHN0c1Rva2VuTWFuYWdlciA9IG5ldyBTdHNUb2tlbk1hbmFnZXIoKTtcbiAgICAgICAgc3RzVG9rZW5NYW5hZ2VyLnVwZGF0ZUZyb21TZXJ2ZXJSZXNwb25zZShpZFRva2VuUmVzcG9uc2UpO1xuICAgICAgICAvLyBJbml0aWFsaXplIHRoZSBGaXJlYmFzZSBBdXRoIHVzZXIuXG4gICAgICAgIGNvbnN0IHVzZXIgPSBuZXcgVXNlckltcGwoe1xuICAgICAgICAgICAgdWlkOiBpZFRva2VuUmVzcG9uc2UubG9jYWxJZCxcbiAgICAgICAgICAgIGF1dGgsXG4gICAgICAgICAgICBzdHNUb2tlbk1hbmFnZXIsXG4gICAgICAgICAgICBpc0Fub255bW91c1xuICAgICAgICB9KTtcbiAgICAgICAgLy8gVXBkYXRlcyB0aGUgdXNlciBpbmZvIGFuZCBkYXRhIGFuZCByZXNvbHZlcyB3aXRoIGEgdXNlciBpbnN0YW5jZS5cbiAgICAgICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7XG4gICAgICAgIHJldHVybiB1c2VyO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIGEgVXNlciBmcm9tIGFuIGlkVG9rZW4gc2VydmVyIHJlc3BvbnNlXG4gICAgICogQHBhcmFtIGF1dGhcbiAgICAgKiBAcGFyYW0gaWRUb2tlblJlc3BvbnNlXG4gICAgICovXG4gICAgc3RhdGljIGFzeW5jIF9mcm9tR2V0QWNjb3VudEluZm9SZXNwb25zZShhdXRoLCByZXNwb25zZSwgaWRUb2tlbikge1xuICAgICAgICBjb25zdCBjb3JlQWNjb3VudCA9IHJlc3BvbnNlLnVzZXJzWzBdO1xuICAgICAgICBfYXNzZXJ0KGNvcmVBY2NvdW50LmxvY2FsSWQgIT09IHVuZGVmaW5lZCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgICAgICBjb25zdCBwcm92aWRlckRhdGEgPSBjb3JlQWNjb3VudC5wcm92aWRlclVzZXJJbmZvICE9PSB1bmRlZmluZWRcbiAgICAgICAgICAgID8gZXh0cmFjdFByb3ZpZGVyRGF0YShjb3JlQWNjb3VudC5wcm92aWRlclVzZXJJbmZvKVxuICAgICAgICAgICAgOiBbXTtcbiAgICAgICAgY29uc3QgaXNBbm9ueW1vdXMgPSAhKGNvcmVBY2NvdW50LmVtYWlsICYmIGNvcmVBY2NvdW50LnBhc3N3b3JkSGFzaCkgJiYgIShwcm92aWRlckRhdGEgPT09IG51bGwgfHwgcHJvdmlkZXJEYXRhID09PSB2b2lkIDAgPyB2b2lkIDAgOiBwcm92aWRlckRhdGEubGVuZ3RoKTtcbiAgICAgICAgY29uc3Qgc3RzVG9rZW5NYW5hZ2VyID0gbmV3IFN0c1Rva2VuTWFuYWdlcigpO1xuICAgICAgICBzdHNUb2tlbk1hbmFnZXIudXBkYXRlRnJvbUlkVG9rZW4oaWRUb2tlbik7XG4gICAgICAgIC8vIEluaXRpYWxpemUgdGhlIEZpcmViYXNlIEF1dGggdXNlci5cbiAgICAgICAgY29uc3QgdXNlciA9IG5ldyBVc2VySW1wbCh7XG4gICAgICAgICAgICB1aWQ6IGNvcmVBY2NvdW50LmxvY2FsSWQsXG4gICAgICAgICAgICBhdXRoLFxuICAgICAgICAgICAgc3RzVG9rZW5NYW5hZ2VyLFxuICAgICAgICAgICAgaXNBbm9ueW1vdXNcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIHVwZGF0ZSB0aGUgdXNlciB3aXRoIGRhdGEgZnJvbSB0aGUgR2V0QWNjb3VudEluZm8gcmVzcG9uc2UuXG4gICAgICAgIGNvbnN0IHVwZGF0ZXMgPSB7XG4gICAgICAgICAgICB1aWQ6IGNvcmVBY2NvdW50LmxvY2FsSWQsXG4gICAgICAgICAgICBkaXNwbGF5TmFtZTogY29yZUFjY291bnQuZGlzcGxheU5hbWUgfHwgbnVsbCxcbiAgICAgICAgICAgIHBob3RvVVJMOiBjb3JlQWNjb3VudC5waG90b1VybCB8fCBudWxsLFxuICAgICAgICAgICAgZW1haWw6IGNvcmVBY2NvdW50LmVtYWlsIHx8IG51bGwsXG4gICAgICAgICAgICBlbWFpbFZlcmlmaWVkOiBjb3JlQWNjb3VudC5lbWFpbFZlcmlmaWVkIHx8IGZhbHNlLFxuICAgICAgICAgICAgcGhvbmVOdW1iZXI6IGNvcmVBY2NvdW50LnBob25lTnVtYmVyIHx8IG51bGwsXG4gICAgICAgICAgICB0ZW5hbnRJZDogY29yZUFjY291bnQudGVuYW50SWQgfHwgbnVsbCxcbiAgICAgICAgICAgIHByb3ZpZGVyRGF0YSxcbiAgICAgICAgICAgIG1ldGFkYXRhOiBuZXcgVXNlck1ldGFkYXRhKGNvcmVBY2NvdW50LmNyZWF0ZWRBdCwgY29yZUFjY291bnQubGFzdExvZ2luQXQpLFxuICAgICAgICAgICAgaXNBbm9ueW1vdXM6ICEoY29yZUFjY291bnQuZW1haWwgJiYgY29yZUFjY291bnQucGFzc3dvcmRIYXNoKSAmJlxuICAgICAgICAgICAgICAgICEocHJvdmlkZXJEYXRhID09PSBudWxsIHx8IHByb3ZpZGVyRGF0YSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvdmlkZXJEYXRhLmxlbmd0aClcbiAgICAgICAgfTtcbiAgICAgICAgT2JqZWN0LmFzc2lnbih1c2VyLCB1cGRhdGVzKTtcbiAgICAgICAgcmV0dXJuIHVzZXI7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgaW5zdGFuY2VDYWNoZSA9IG5ldyBNYXAoKTtcbmZ1bmN0aW9uIF9nZXRJbnN0YW5jZShjbHMpIHtcbiAgICBkZWJ1Z0Fzc2VydChjbHMgaW5zdGFuY2VvZiBGdW5jdGlvbiwgJ0V4cGVjdGVkIGEgY2xhc3MgZGVmaW5pdGlvbicpO1xuICAgIGxldCBpbnN0YW5jZSA9IGluc3RhbmNlQ2FjaGUuZ2V0KGNscyk7XG4gICAgaWYgKGluc3RhbmNlKSB7XG4gICAgICAgIGRlYnVnQXNzZXJ0KGluc3RhbmNlIGluc3RhbmNlb2YgY2xzLCAnSW5zdGFuY2Ugc3RvcmVkIGluIGNhY2hlIG1pc21hdGNoZWQgd2l0aCBjbGFzcycpO1xuICAgICAgICByZXR1cm4gaW5zdGFuY2U7XG4gICAgfVxuICAgIGluc3RhbmNlID0gbmV3IGNscygpO1xuICAgIGluc3RhbmNlQ2FjaGUuc2V0KGNscywgaW5zdGFuY2UpO1xuICAgIHJldHVybiBpbnN0YW5jZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIEluTWVtb3J5UGVyc2lzdGVuY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnR5cGUgPSBcIk5PTkVcIiAvKiBQZXJzaXN0ZW5jZVR5cGUuTk9ORSAqLztcbiAgICAgICAgdGhpcy5zdG9yYWdlID0ge307XG4gICAgfVxuICAgIGFzeW5jIF9pc0F2YWlsYWJsZSgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIGFzeW5jIF9zZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgICB0aGlzLnN0b3JhZ2Vba2V5XSA9IHZhbHVlO1xuICAgIH1cbiAgICBhc3luYyBfZ2V0KGtleSkge1xuICAgICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuc3RvcmFnZVtrZXldO1xuICAgICAgICByZXR1cm4gdmFsdWUgPT09IHVuZGVmaW5lZCA/IG51bGwgOiB2YWx1ZTtcbiAgICB9XG4gICAgYXN5bmMgX3JlbW92ZShrZXkpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuc3RvcmFnZVtrZXldO1xuICAgIH1cbiAgICBfYWRkTGlzdGVuZXIoX2tleSwgX2xpc3RlbmVyKSB7XG4gICAgICAgIC8vIExpc3RlbmVycyBhcmUgbm90IHN1cHBvcnRlZCBmb3IgaW4tbWVtb3J5IHN0b3JhZ2Ugc2luY2UgaXQgY2Fubm90IGJlIHNoYXJlZCBhY3Jvc3Mgd2luZG93cy93b3JrZXJzXG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgX3JlbW92ZUxpc3RlbmVyKF9rZXksIF9saXN0ZW5lcikge1xuICAgICAgICAvLyBMaXN0ZW5lcnMgYXJlIG5vdCBzdXBwb3J0ZWQgZm9yIGluLW1lbW9yeSBzdG9yYWdlIHNpbmNlIGl0IGNhbm5vdCBiZSBzaGFyZWQgYWNyb3NzIHdpbmRvd3Mvd29ya2Vyc1xuICAgICAgICByZXR1cm47XG4gICAgfVxufVxuSW5NZW1vcnlQZXJzaXN0ZW5jZS50eXBlID0gJ05PTkUnO1xuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiB7QGxpbmsgUGVyc2lzdGVuY2V9IG9mIHR5cGUgJ05PTkUnLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY29uc3QgaW5NZW1vcnlQZXJzaXN0ZW5jZSA9IEluTWVtb3J5UGVyc2lzdGVuY2U7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBfcGVyc2lzdGVuY2VLZXlOYW1lKGtleSwgYXBpS2V5LCBhcHBOYW1lKSB7XG4gICAgcmV0dXJuIGAke1wiZmlyZWJhc2VcIiAvKiBOYW1lc3BhY2UuUEVSU0lTVEVOQ0UgKi99OiR7a2V5fToke2FwaUtleX06JHthcHBOYW1lfWA7XG59XG5jbGFzcyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcihwZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gcGVyc2lzdGVuY2U7XG4gICAgICAgIHRoaXMuYXV0aCA9IGF1dGg7XG4gICAgICAgIHRoaXMudXNlcktleSA9IHVzZXJLZXk7XG4gICAgICAgIGNvbnN0IHsgY29uZmlnLCBuYW1lIH0gPSB0aGlzLmF1dGg7XG4gICAgICAgIHRoaXMuZnVsbFVzZXJLZXkgPSBfcGVyc2lzdGVuY2VLZXlOYW1lKHRoaXMudXNlcktleSwgY29uZmlnLmFwaUtleSwgbmFtZSk7XG4gICAgICAgIHRoaXMuZnVsbFBlcnNpc3RlbmNlS2V5ID0gX3BlcnNpc3RlbmNlS2V5TmFtZShcInBlcnNpc3RlbmNlXCIgLyogS2V5TmFtZS5QRVJTSVNURU5DRV9VU0VSICovLCBjb25maWcuYXBpS2V5LCBuYW1lKTtcbiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlciA9IGF1dGguX29uU3RvcmFnZUV2ZW50LmJpbmQoYXV0aCk7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UuX2FkZExpc3RlbmVyKHRoaXMuZnVsbFVzZXJLZXksIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpO1xuICAgIH1cbiAgICBzZXRDdXJyZW50VXNlcih1c2VyKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLl9zZXQodGhpcy5mdWxsVXNlcktleSwgdXNlci50b0pTT04oKSk7XG4gICAgfVxuICAgIGFzeW5jIGdldEN1cnJlbnRVc2VyKCkge1xuICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5fZ2V0KHRoaXMuZnVsbFVzZXJLZXkpO1xuICAgICAgICBpZiAoIWJsb2IpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgYmxvYiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0QWNjb3VudEluZm8odGhpcy5hdXRoLCB7IGlkVG9rZW46IGJsb2IgfSkuY2F0Y2goKCkgPT4gdW5kZWZpbmVkKTtcbiAgICAgICAgICAgIGlmICghcmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBVc2VySW1wbC5fZnJvbUdldEFjY291bnRJbmZvUmVzcG9uc2UodGhpcy5hdXRoLCByZXNwb25zZSwgYmxvYik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFVzZXJJbXBsLl9mcm9tSlNPTih0aGlzLmF1dGgsIGJsb2IpO1xuICAgIH1cbiAgICByZW1vdmVDdXJyZW50VXNlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuX3JlbW92ZSh0aGlzLmZ1bGxVc2VyS2V5KTtcbiAgICB9XG4gICAgc2F2ZVBlcnNpc3RlbmNlRm9yUmVkaXJlY3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLl9zZXQodGhpcy5mdWxsUGVyc2lzdGVuY2VLZXksIHRoaXMucGVyc2lzdGVuY2UudHlwZSk7XG4gICAgfVxuICAgIGFzeW5jIHNldFBlcnNpc3RlbmNlKG5ld1BlcnNpc3RlbmNlKSB7XG4gICAgICAgIGlmICh0aGlzLnBlcnNpc3RlbmNlID09PSBuZXdQZXJzaXN0ZW5jZSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGN1cnJlbnRVc2VyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50VXNlcigpO1xuICAgICAgICBhd2FpdCB0aGlzLnJlbW92ZUN1cnJlbnRVc2VyKCk7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBuZXdQZXJzaXN0ZW5jZTtcbiAgICAgICAgaWYgKGN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zZXRDdXJyZW50VXNlcihjdXJyZW50VXNlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZGVsZXRlKCkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlLl9yZW1vdmVMaXN0ZW5lcih0aGlzLmZ1bGxVc2VyS2V5LCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTtcbiAgICB9XG4gICAgc3RhdGljIGFzeW5jIGNyZWF0ZShhdXRoLCBwZXJzaXN0ZW5jZUhpZXJhcmNoeSwgdXNlcktleSA9IFwiYXV0aFVzZXJcIiAvKiBLZXlOYW1lLkFVVEhfVVNFUiAqLykge1xuICAgICAgICBpZiAoIXBlcnNpc3RlbmNlSGllcmFyY2h5Lmxlbmd0aCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyKF9nZXRJbnN0YW5jZShpbk1lbW9yeVBlcnNpc3RlbmNlKSwgYXV0aCwgdXNlcktleSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRWxpbWluYXRlIGFueSBwZXJzaXN0ZW5jZXMgdGhhdCBhcmUgbm90IGF2YWlsYWJsZVxuICAgICAgICBjb25zdCBhdmFpbGFibGVQZXJzaXN0ZW5jZXMgPSAoYXdhaXQgUHJvbWlzZS5hbGwocGVyc2lzdGVuY2VIaWVyYXJjaHkubWFwKGFzeW5jIChwZXJzaXN0ZW5jZSkgPT4ge1xuICAgICAgICAgICAgaWYgKGF3YWl0IHBlcnNpc3RlbmNlLl9pc0F2YWlsYWJsZSgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHBlcnNpc3RlbmNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfSkpKS5maWx0ZXIocGVyc2lzdGVuY2UgPT4gcGVyc2lzdGVuY2UpO1xuICAgICAgICAvLyBGYWxsIGJhY2sgdG8gdGhlIGZpcnN0IHBlcnNpc3RlbmNlIGxpc3RlZCwgb3IgaW4gbWVtb3J5IGlmIG5vbmUgYXZhaWxhYmxlXG4gICAgICAgIGxldCBzZWxlY3RlZFBlcnNpc3RlbmNlID0gYXZhaWxhYmxlUGVyc2lzdGVuY2VzWzBdIHx8XG4gICAgICAgICAgICBfZ2V0SW5zdGFuY2UoaW5NZW1vcnlQZXJzaXN0ZW5jZSk7XG4gICAgICAgIGNvbnN0IGtleSA9IF9wZXJzaXN0ZW5jZUtleU5hbWUodXNlcktleSwgYXV0aC5jb25maWcuYXBpS2V5LCBhdXRoLm5hbWUpO1xuICAgICAgICAvLyBQdWxsIG91dCB0aGUgZXhpc3RpbmcgdXNlciwgc2V0dGluZyB0aGUgY2hvc2VuIHBlcnNpc3RlbmNlIHRvIHRoYXRcbiAgICAgICAgLy8gcGVyc2lzdGVuY2UgaWYgdGhlIHVzZXIgZXhpc3RzLlxuICAgICAgICBsZXQgdXNlclRvTWlncmF0ZSA9IG51bGw7XG4gICAgICAgIC8vIE5vdGUsIGhlcmUgd2UgY2hlY2sgZm9yIGEgdXNlciBpbiBfYWxsXyBwZXJzaXN0ZW5jZXMsIG5vdCBqdXN0IHRoZVxuICAgICAgICAvLyBvbmVzIGRlZW1lZCBhdmFpbGFibGUuIElmIHdlIGNhbiBtaWdyYXRlIGEgdXNlciBvdXQgb2YgYSBicm9rZW5cbiAgICAgICAgLy8gcGVyc2lzdGVuY2UsIHdlIHdpbGwgKGJ1dCBvbmx5IGlmIHRoYXQgcGVyc2lzdGVuY2Ugc3VwcG9ydHMgbWlncmF0aW9uKS5cbiAgICAgICAgZm9yIChjb25zdCBwZXJzaXN0ZW5jZSBvZiBwZXJzaXN0ZW5jZUhpZXJhcmNoeSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgcGVyc2lzdGVuY2UuX2dldChrZXkpO1xuICAgICAgICAgICAgICAgIGlmIChibG9iKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCB1c2VyO1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGJsb2IgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldEFjY291bnRJbmZvKGF1dGgsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZFRva2VuOiBibG9iXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaCgoKSA9PiB1bmRlZmluZWQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlciA9IGF3YWl0IFVzZXJJbXBsLl9mcm9tR2V0QWNjb3VudEluZm9SZXNwb25zZShhdXRoLCByZXNwb25zZSwgYmxvYik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VyID0gVXNlckltcGwuX2Zyb21KU09OKGF1dGgsIGJsb2IpOyAvLyB0aHJvd3MgZm9yIHVucGFyc2FibGUgYmxvYiAod3JvbmcgZm9ybWF0KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChwZXJzaXN0ZW5jZSAhPT0gc2VsZWN0ZWRQZXJzaXN0ZW5jZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdXNlclRvTWlncmF0ZSA9IHVzZXI7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IHBlcnNpc3RlbmNlO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoX2EpIHsgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIHdlIGZpbmQgdGhlIHVzZXIgaW4gYSBwZXJzaXN0ZW5jZSB0aGF0IGRvZXMgc3VwcG9ydCBtaWdyYXRpb24sIHVzZVxuICAgICAgICAvLyB0aGF0IG1pZ3JhdGlvbiBwYXRoIChvZiBvbmx5IHBlcnNpc3RlbmNlcyB0aGF0IHN1cHBvcnQgbWlncmF0aW9uKVxuICAgICAgICBjb25zdCBtaWdyYXRpb25IaWVyYXJjaHkgPSBhdmFpbGFibGVQZXJzaXN0ZW5jZXMuZmlsdGVyKHAgPT4gcC5fc2hvdWxkQWxsb3dNaWdyYXRpb24pO1xuICAgICAgICAvLyBJZiB0aGUgcGVyc2lzdGVuY2UgZG9lcyBfbm90XyBhbGxvdyBtaWdyYXRpb24sIGp1c3QgZmluaXNoIG9mZiBoZXJlXG4gICAgICAgIGlmICghc2VsZWN0ZWRQZXJzaXN0ZW5jZS5fc2hvdWxkQWxsb3dNaWdyYXRpb24gfHxcbiAgICAgICAgICAgICFtaWdyYXRpb25IaWVyYXJjaHkubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoc2VsZWN0ZWRQZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSk7XG4gICAgICAgIH1cbiAgICAgICAgc2VsZWN0ZWRQZXJzaXN0ZW5jZSA9IG1pZ3JhdGlvbkhpZXJhcmNoeVswXTtcbiAgICAgICAgaWYgKHVzZXJUb01pZ3JhdGUpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgbm9ybWFsbHkgc2hvdWxkbid0IHRocm93IHNpbmNlIGNob3NlblBlcnNpc3RlbmNlLmlzQXZhaWxhYmxlKCkgaXMgdHJ1ZSwgYnV0IGlmIGl0IGRvZXNcbiAgICAgICAgICAgIC8vIHdlJ2xsIGp1c3QgbGV0IGl0IGJ1YmJsZSB0byBzdXJmYWNlIHRoZSBlcnJvci5cbiAgICAgICAgICAgIGF3YWl0IHNlbGVjdGVkUGVyc2lzdGVuY2UuX3NldChrZXksIHVzZXJUb01pZ3JhdGUudG9KU09OKCkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEF0dGVtcHQgdG8gY2xlYXIgdGhlIGtleSBpbiBvdGhlciBwZXJzaXN0ZW5jZXMgYnV0IGlnbm9yZSBlcnJvcnMuIFRoaXMgaGVscHMgcHJldmVudCBpc3N1ZXNcbiAgICAgICAgLy8gc3VjaCBhcyB1c2VycyBnZXR0aW5nIHN0dWNrIHdpdGggYSBwcmV2aW91cyBhY2NvdW50IGFmdGVyIHNpZ25pbmcgb3V0IGFuZCByZWZyZXNoaW5nIHRoZSB0YWIuXG4gICAgICAgIGF3YWl0IFByb21pc2UuYWxsKHBlcnNpc3RlbmNlSGllcmFyY2h5Lm1hcChhc3luYyAocGVyc2lzdGVuY2UpID0+IHtcbiAgICAgICAgICAgIGlmIChwZXJzaXN0ZW5jZSAhPT0gc2VsZWN0ZWRQZXJzaXN0ZW5jZSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHBlcnNpc3RlbmNlLl9yZW1vdmUoa2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKF9hKSB7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlVXNlck1hbmFnZXIoc2VsZWN0ZWRQZXJzaXN0ZW5jZSwgYXV0aCwgdXNlcktleSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBEZXRlcm1pbmUgdGhlIGJyb3dzZXIgZm9yIHRoZSBwdXJwb3NlcyBvZiByZXBvcnRpbmcgdXNhZ2UgdG8gdGhlIEFQSVxuICovXG5mdW5jdGlvbiBfZ2V0QnJvd3Nlck5hbWUodXNlckFnZW50KSB7XG4gICAgY29uc3QgdWEgPSB1c2VyQWdlbnQudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAodWEuaW5jbHVkZXMoJ29wZXJhLycpIHx8IHVhLmluY2x1ZGVzKCdvcHIvJykgfHwgdWEuaW5jbHVkZXMoJ29waW9zLycpKSB7XG4gICAgICAgIHJldHVybiBcIk9wZXJhXCIgLyogQnJvd3Nlck5hbWUuT1BFUkEgKi87XG4gICAgfVxuICAgIGVsc2UgaWYgKF9pc0lFTW9iaWxlKHVhKSkge1xuICAgICAgICAvLyBXaW5kb3dzIHBob25lIElFTW9iaWxlIGJyb3dzZXIuXG4gICAgICAgIHJldHVybiBcIklFTW9iaWxlXCIgLyogQnJvd3Nlck5hbWUuSUVNT0JJTEUgKi87XG4gICAgfVxuICAgIGVsc2UgaWYgKHVhLmluY2x1ZGVzKCdtc2llJykgfHwgdWEuaW5jbHVkZXMoJ3RyaWRlbnQvJykpIHtcbiAgICAgICAgcmV0dXJuIFwiSUVcIiAvKiBCcm93c2VyTmFtZS5JRSAqLztcbiAgICB9XG4gICAgZWxzZSBpZiAodWEuaW5jbHVkZXMoJ2VkZ2UvJykpIHtcbiAgICAgICAgcmV0dXJuIFwiRWRnZVwiIC8qIEJyb3dzZXJOYW1lLkVER0UgKi87XG4gICAgfVxuICAgIGVsc2UgaWYgKF9pc0ZpcmVmb3godWEpKSB7XG4gICAgICAgIHJldHVybiBcIkZpcmVmb3hcIiAvKiBCcm93c2VyTmFtZS5GSVJFRk9YICovO1xuICAgIH1cbiAgICBlbHNlIGlmICh1YS5pbmNsdWRlcygnc2lsay8nKSkge1xuICAgICAgICByZXR1cm4gXCJTaWxrXCIgLyogQnJvd3Nlck5hbWUuU0lMSyAqLztcbiAgICB9XG4gICAgZWxzZSBpZiAoX2lzQmxhY2tCZXJyeSh1YSkpIHtcbiAgICAgICAgLy8gQmxhY2tiZXJyeSBicm93c2VyLlxuICAgICAgICByZXR1cm4gXCJCbGFja2JlcnJ5XCIgLyogQnJvd3Nlck5hbWUuQkxBQ0tCRVJSWSAqLztcbiAgICB9XG4gICAgZWxzZSBpZiAoX2lzV2ViT1ModWEpKSB7XG4gICAgICAgIC8vIFdlYk9TIGRlZmF1bHQgYnJvd3Nlci5cbiAgICAgICAgcmV0dXJuIFwiV2Vib3NcIiAvKiBCcm93c2VyTmFtZS5XRUJPUyAqLztcbiAgICB9XG4gICAgZWxzZSBpZiAoX2lzU2FmYXJpKHVhKSkge1xuICAgICAgICByZXR1cm4gXCJTYWZhcmlcIiAvKiBCcm93c2VyTmFtZS5TQUZBUkkgKi87XG4gICAgfVxuICAgIGVsc2UgaWYgKCh1YS5pbmNsdWRlcygnY2hyb21lLycpIHx8IF9pc0Nocm9tZUlPUyh1YSkpICYmXG4gICAgICAgICF1YS5pbmNsdWRlcygnZWRnZS8nKSkge1xuICAgICAgICByZXR1cm4gXCJDaHJvbWVcIiAvKiBCcm93c2VyTmFtZS5DSFJPTUUgKi87XG4gICAgfVxuICAgIGVsc2UgaWYgKF9pc0FuZHJvaWQodWEpKSB7XG4gICAgICAgIC8vIEFuZHJvaWQgc3RvY2sgYnJvd3Nlci5cbiAgICAgICAgcmV0dXJuIFwiQW5kcm9pZFwiIC8qIEJyb3dzZXJOYW1lLkFORFJPSUQgKi87XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBNb3N0IG1vZGVybiBicm93c2VycyBoYXZlIG5hbWUvdmVyc2lvbiBhdCBlbmQgb2YgdXNlciBhZ2VudCBzdHJpbmcuXG4gICAgICAgIGNvbnN0IHJlID0gLyhbYS16QS1aXFxkXFwuXSspXFwvW2EtekEtWlxcZFxcLl0qJC87XG4gICAgICAgIGNvbnN0IG1hdGNoZXMgPSB1c2VyQWdlbnQubWF0Y2gocmUpO1xuICAgICAgICBpZiAoKG1hdGNoZXMgPT09IG51bGwgfHwgbWF0Y2hlcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogbWF0Y2hlcy5sZW5ndGgpID09PSAyKSB7XG4gICAgICAgICAgICByZXR1cm4gbWF0Y2hlc1sxXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCJPdGhlclwiIC8qIEJyb3dzZXJOYW1lLk9USEVSICovO1xufVxuZnVuY3Rpb24gX2lzRmlyZWZveCh1YSA9IGdldFVBKCkpIHtcbiAgICByZXR1cm4gL2ZpcmVmb3hcXC8vaS50ZXN0KHVhKTtcbn1cbmZ1bmN0aW9uIF9pc1NhZmFyaSh1c2VyQWdlbnQgPSBnZXRVQSgpKSB7XG4gICAgY29uc3QgdWEgPSB1c2VyQWdlbnQudG9Mb3dlckNhc2UoKTtcbiAgICByZXR1cm4gKHVhLmluY2x1ZGVzKCdzYWZhcmkvJykgJiZcbiAgICAgICAgIXVhLmluY2x1ZGVzKCdjaHJvbWUvJykgJiZcbiAgICAgICAgIXVhLmluY2x1ZGVzKCdjcmlvcy8nKSAmJlxuICAgICAgICAhdWEuaW5jbHVkZXMoJ2FuZHJvaWQnKSk7XG59XG5mdW5jdGlvbiBfaXNDaHJvbWVJT1ModWEgPSBnZXRVQSgpKSB7XG4gICAgcmV0dXJuIC9jcmlvc1xcLy9pLnRlc3QodWEpO1xufVxuZnVuY3Rpb24gX2lzSUVNb2JpbGUodWEgPSBnZXRVQSgpKSB7XG4gICAgcmV0dXJuIC9pZW1vYmlsZS9pLnRlc3QodWEpO1xufVxuZnVuY3Rpb24gX2lzQW5kcm9pZCh1YSA9IGdldFVBKCkpIHtcbiAgICByZXR1cm4gL2FuZHJvaWQvaS50ZXN0KHVhKTtcbn1cbmZ1bmN0aW9uIF9pc0JsYWNrQmVycnkodWEgPSBnZXRVQSgpKSB7XG4gICAgcmV0dXJuIC9ibGFja2JlcnJ5L2kudGVzdCh1YSk7XG59XG5mdW5jdGlvbiBfaXNXZWJPUyh1YSA9IGdldFVBKCkpIHtcbiAgICByZXR1cm4gL3dlYm9zL2kudGVzdCh1YSk7XG59XG5mdW5jdGlvbiBfaXNJT1ModWEgPSBnZXRVQSgpKSB7XG4gICAgcmV0dXJuICgvaXBob25lfGlwYWR8aXBvZC9pLnRlc3QodWEpIHx8XG4gICAgICAgICgvbWFjaW50b3NoL2kudGVzdCh1YSkgJiYgL21vYmlsZS9pLnRlc3QodWEpKSk7XG59XG5mdW5jdGlvbiBfaXNJT1M3T3I4KHVhID0gZ2V0VUEoKSkge1xuICAgIHJldHVybiAoLyhpUGFkfGlQaG9uZXxpUG9kKS4qT1MgN19cXGQvaS50ZXN0KHVhKSB8fFxuICAgICAgICAvKGlQYWR8aVBob25lfGlQb2QpLipPUyA4X1xcZC9pLnRlc3QodWEpKTtcbn1cbmZ1bmN0aW9uIF9pc0lPU1N0YW5kYWxvbmUodWEgPSBnZXRVQSgpKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiBfaXNJT1ModWEpICYmICEhKChfYSA9IHdpbmRvdy5uYXZpZ2F0b3IpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5zdGFuZGFsb25lKTtcbn1cbmZ1bmN0aW9uIF9pc0lFMTAoKSB7XG4gICAgcmV0dXJuIGlzSUUoKSAmJiBkb2N1bWVudC5kb2N1bWVudE1vZGUgPT09IDEwO1xufVxuZnVuY3Rpb24gX2lzTW9iaWxlQnJvd3Nlcih1YSA9IGdldFVBKCkpIHtcbiAgICAvLyBUT0RPOiBpbXBsZW1lbnQgZ2V0QnJvd3Nlck5hbWUgZXF1aXZhbGVudCBmb3IgT1MuXG4gICAgcmV0dXJuIChfaXNJT1ModWEpIHx8XG4gICAgICAgIF9pc0FuZHJvaWQodWEpIHx8XG4gICAgICAgIF9pc1dlYk9TKHVhKSB8fFxuICAgICAgICBfaXNCbGFja0JlcnJ5KHVhKSB8fFxuICAgICAgICAvd2luZG93cyBwaG9uZS9pLnRlc3QodWEpIHx8XG4gICAgICAgIF9pc0lFTW9iaWxlKHVhKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKlxuICogRGV0ZXJtaW5lIHRoZSBTREsgdmVyc2lvbiBzdHJpbmdcbiAqL1xuZnVuY3Rpb24gX2dldENsaWVudFZlcnNpb24oY2xpZW50UGxhdGZvcm0sIGZyYW1ld29ya3MgPSBbXSkge1xuICAgIGxldCByZXBvcnRlZFBsYXRmb3JtO1xuICAgIHN3aXRjaCAoY2xpZW50UGxhdGZvcm0pIHtcbiAgICAgICAgY2FzZSBcIkJyb3dzZXJcIiAvKiBDbGllbnRQbGF0Zm9ybS5CUk9XU0VSICovOlxuICAgICAgICAgICAgLy8gSW4gYSBicm93c2VyIGVudmlyb25tZW50LCByZXBvcnQgdGhlIGJyb3dzZXIgbmFtZS5cbiAgICAgICAgICAgIHJlcG9ydGVkUGxhdGZvcm0gPSBfZ2V0QnJvd3Nlck5hbWUoZ2V0VUEoKSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIldvcmtlclwiIC8qIENsaWVudFBsYXRmb3JtLldPUktFUiAqLzpcbiAgICAgICAgICAgIC8vIFRlY2huaWNhbGx5IGEgd29ya2VyIHJ1bnMgZnJvbSBhIGJyb3dzZXIgYnV0IHdlIG5lZWQgdG8gZGlmZmVyZW50aWF0ZSBhXG4gICAgICAgICAgICAvLyB3b3JrZXIgZnJvbSBhIGJyb3dzZXIuXG4gICAgICAgICAgICAvLyBGb3IgZXhhbXBsZTogQ2hyb21lLVdvcmtlci9Kc0NvcmUvNC45LjEvRmlyZWJhc2VDb3JlLXdlYi5cbiAgICAgICAgICAgIHJlcG9ydGVkUGxhdGZvcm0gPSBgJHtfZ2V0QnJvd3Nlck5hbWUoZ2V0VUEoKSl9LSR7Y2xpZW50UGxhdGZvcm19YDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmVwb3J0ZWRQbGF0Zm9ybSA9IGNsaWVudFBsYXRmb3JtO1xuICAgIH1cbiAgICBjb25zdCByZXBvcnRlZEZyYW1ld29ya3MgPSBmcmFtZXdvcmtzLmxlbmd0aFxuICAgICAgICA/IGZyYW1ld29ya3Muam9pbignLCcpXG4gICAgICAgIDogJ0ZpcmViYXNlQ29yZS13ZWInOyAvKiBkZWZhdWx0IHZhbHVlIGlmIG5vIG90aGVyIGZyYW1ld29yayBpcyB1c2VkICovXG4gICAgcmV0dXJuIGAke3JlcG9ydGVkUGxhdGZvcm19LyR7XCJKc0NvcmVcIiAvKiBDbGllbnRJbXBsZW1lbnRhdGlvbi5DT1JFICovfS8ke1NES19WRVJTSU9OfS8ke3JlcG9ydGVkRnJhbWV3b3Jrc31gO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgQXV0aE1pZGRsZXdhcmVRdWV1ZSB7XG4gICAgY29uc3RydWN0b3IoYXV0aCkge1xuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xuICAgICAgICB0aGlzLnF1ZXVlID0gW107XG4gICAgfVxuICAgIHB1c2hDYWxsYmFjayhjYWxsYmFjaywgb25BYm9ydCkge1xuICAgICAgICAvLyBUaGUgY2FsbGJhY2sgY291bGQgYmUgc3luYyBvciBhc3luYy4gV3JhcCBpdCBpbnRvIGFcbiAgICAgICAgLy8gZnVuY3Rpb24gdGhhdCBpcyBhbHdheXMgYXN5bmMuXG4gICAgICAgIGNvbnN0IHdyYXBwZWRDYWxsYmFjayA9ICh1c2VyKSA9PiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGNhbGxiYWNrKHVzZXIpO1xuICAgICAgICAgICAgICAgIC8vIEVpdGhlciByZXNvbHZlIHdpdGggZXhpc3RpbmcgcHJvbWlzZSBvciB3cmFwIGEgbm9uLXByb21pc2VcbiAgICAgICAgICAgICAgICAvLyByZXR1cm4gdmFsdWUgaW50byBhIHByb21pc2UuXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAvLyBTeW5jIGNhbGxiYWNrIHRocm93cy5cbiAgICAgICAgICAgICAgICByZWplY3QoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBdHRhY2ggdGhlIG9uQWJvcnQgaWYgcHJlc2VudFxuICAgICAgICB3cmFwcGVkQ2FsbGJhY2sub25BYm9ydCA9IG9uQWJvcnQ7XG4gICAgICAgIHRoaXMucXVldWUucHVzaCh3cmFwcGVkQ2FsbGJhY2spO1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMucXVldWUubGVuZ3RoIC0gMTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIC8vIFVuc3Vic2NyaWJlLiBSZXBsYWNlIHdpdGggbm8tb3AuIERvIG5vdCByZW1vdmUgZnJvbSBhcnJheSwgb3IgaXQgd2lsbCBkaXN0dXJiXG4gICAgICAgICAgICAvLyBpbmRleGluZyBvZiBvdGhlciBlbGVtZW50cy5cbiAgICAgICAgICAgIHRoaXMucXVldWVbaW5kZXhdID0gKCkgPT4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGFzeW5jIHJ1bk1pZGRsZXdhcmUobmV4dFVzZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuYXV0aC5jdXJyZW50VXNlciA9PT0gbmV4dFVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBXaGlsZSBydW5uaW5nIHRoZSBtaWRkbGV3YXJlLCBidWlsZCBhIHRlbXBvcmFyeSBzdGFjayBvZiBvbkFib3J0XG4gICAgICAgIC8vIGNhbGxiYWNrcyB0byBjYWxsIGlmIG9uZSBtaWRkbGV3YXJlIGNhbGxiYWNrIHJlamVjdHMuXG4gICAgICAgIGNvbnN0IG9uQWJvcnRTdGFjayA9IFtdO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgZm9yIChjb25zdCBiZWZvcmVTdGF0ZUNhbGxiYWNrIG9mIHRoaXMucXVldWUpIHtcbiAgICAgICAgICAgICAgICBhd2FpdCBiZWZvcmVTdGF0ZUNhbGxiYWNrKG5leHRVc2VyKTtcbiAgICAgICAgICAgICAgICAvLyBPbmx5IHB1c2ggdGhlIG9uQWJvcnQgaWYgdGhlIGNhbGxiYWNrIHN1Y2NlZWRzXG4gICAgICAgICAgICAgICAgaWYgKGJlZm9yZVN0YXRlQ2FsbGJhY2sub25BYm9ydCkge1xuICAgICAgICAgICAgICAgICAgICBvbkFib3J0U3RhY2sucHVzaChiZWZvcmVTdGF0ZUNhbGxiYWNrLm9uQWJvcnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gUnVuIGFsbCBvbkFib3J0LCB3aXRoIHNlcGFyYXRlIHRyeS9jYXRjaCB0byBpZ25vcmUgYW55IGVycm9ycyBhbmRcbiAgICAgICAgICAgIC8vIGNvbnRpbnVlXG4gICAgICAgICAgICBvbkFib3J0U3RhY2sucmV2ZXJzZSgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBvbkFib3J0IG9mIG9uQWJvcnRTdGFjaykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIG9uQWJvcnQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKF8pIHtcbiAgICAgICAgICAgICAgICAgICAgLyogc3dhbGxvdyBlcnJvciAqL1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRocm93IHRoaXMuYXV0aC5fZXJyb3JGYWN0b3J5LmNyZWF0ZShcImxvZ2luLWJsb2NrZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkxPR0lOX0JMT0NLRUQgKi8sIHtcbiAgICAgICAgICAgICAgICBvcmlnaW5hbE1lc3NhZ2U6IGUgPT09IG51bGwgfHwgZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogZS5tZXNzYWdlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRmV0Y2hlcyB0aGUgcGFzc3dvcmQgcG9saWN5IGZvciB0aGUgY3VycmVudGx5IHNldCB0ZW5hbnQgb3IgdGhlIHByb2plY3QgaWYgbm8gdGVuYW50IGlzIHNldC5cbiAqXG4gKiBAcGFyYW0gYXV0aCBBdXRoIG9iamVjdC5cbiAqIEBwYXJhbSByZXF1ZXN0IFBhc3N3b3JkIHBvbGljeSByZXF1ZXN0LlxuICogQHJldHVybnMgUGFzc3dvcmQgcG9saWN5IHJlc3BvbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiBfZ2V0UGFzc3dvcmRQb2xpY3koYXV0aCwgcmVxdWVzdCA9IHt9KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIkdFVFwiIC8qIEh0dHBNZXRob2QuR0VUICovLCBcIi92Mi9wYXNzd29yZFBvbGljeVwiIC8qIEVuZHBvaW50LkdFVF9QQVNTV09SRF9QT0xJQ1kgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBNaW5pbXVtIG1pbiBwYXNzd29yZCBsZW5ndGggZW5mb3JjZWQgYnkgdGhlIGJhY2tlbmQsIGV2ZW4gaWYgbm8gbWluaW11bSBsZW5ndGggaXMgc2V0LlxuY29uc3QgTUlOSU1VTV9NSU5fUEFTU1dPUkRfTEVOR1RIID0gNjtcbi8qKlxuICogU3RvcmVzIHBhc3N3b3JkIHBvbGljeSByZXF1aXJlbWVudHMgYW5kIHByb3ZpZGVzIHBhc3N3b3JkIHZhbGlkYXRpb24gYWdhaW5zdCB0aGUgcG9saWN5LlxuICpcbiAqIEBpbnRlcm5hbFxuICovXG5jbGFzcyBQYXNzd29yZFBvbGljeUltcGwge1xuICAgIGNvbnN0cnVjdG9yKHJlc3BvbnNlKSB7XG4gICAgICAgIHZhciBfYSwgX2IsIF9jLCBfZDtcbiAgICAgICAgLy8gT25seSBpbmNsdWRlIGN1c3RvbSBzdHJlbmd0aCBvcHRpb25zIGRlZmluZWQgaW4gdGhlIHJlc3BvbnNlLlxuICAgICAgICBjb25zdCByZXNwb25zZU9wdGlvbnMgPSByZXNwb25zZS5jdXN0b21TdHJlbmd0aE9wdGlvbnM7XG4gICAgICAgIHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zID0ge307XG4gICAgICAgIC8vIFRPRE86IFJlbW92ZSBvbmNlIHRoZSBiYWNrZW5kIGlzIHVwZGF0ZWQgdG8gaW5jbHVkZSB0aGUgbWluaW11bSBtaW4gcGFzc3dvcmQgbGVuZ3RoIGluc3RlYWQgb2YgdW5kZWZpbmVkIHdoZW4gdGhlcmUgaXMgbm8gbWluaW11bSBsZW5ndGggc2V0LlxuICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5taW5QYXNzd29yZExlbmd0aCA9XG4gICAgICAgICAgICAoX2EgPSByZXNwb25zZU9wdGlvbnMubWluUGFzc3dvcmRMZW5ndGgpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IE1JTklNVU1fTUlOX1BBU1NXT1JEX0xFTkdUSDtcbiAgICAgICAgaWYgKHJlc3BvbnNlT3B0aW9ucy5tYXhQYXNzd29yZExlbmd0aCkge1xuICAgICAgICAgICAgdGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMubWF4UGFzc3dvcmRMZW5ndGggPVxuICAgICAgICAgICAgICAgIHJlc3BvbnNlT3B0aW9ucy5tYXhQYXNzd29yZExlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zTG93ZXJjYXNlQ2hhcmFjdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLmNvbnRhaW5zTG93ZXJjYXNlTGV0dGVyID1cbiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMuY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlc3BvbnNlT3B0aW9ucy5jb250YWluc1VwcGVyY2FzZUNoYXJhY3RlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc1VwcGVyY2FzZUxldHRlciA9XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zVXBwZXJjYXNlQ2hhcmFjdGVyO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXNwb25zZU9wdGlvbnMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlciA9XG4gICAgICAgICAgICAgICAgcmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzcG9uc2VPcHRpb25zLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyID1cbiAgICAgICAgICAgICAgICByZXNwb25zZU9wdGlvbnMuY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5lbmZvcmNlbWVudFN0YXRlID0gcmVzcG9uc2UuZW5mb3JjZW1lbnRTdGF0ZTtcbiAgICAgICAgaWYgKHRoaXMuZW5mb3JjZW1lbnRTdGF0ZSA9PT0gJ0VORk9SQ0VNRU5UX1NUQVRFX1VOU1BFQ0lGSUVEJykge1xuICAgICAgICAgICAgdGhpcy5lbmZvcmNlbWVudFN0YXRlID0gJ09GRic7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVXNlIGFuIGVtcHR5IHN0cmluZyBpZiBubyBub24tYWxwaGFudW1lcmljIGNoYXJhY3RlcnMgYXJlIHNwZWNpZmllZCBpbiB0aGUgcmVzcG9uc2UuXG4gICAgICAgIHRoaXMuYWxsb3dlZE5vbkFscGhhbnVtZXJpY0NoYXJhY3RlcnMgPVxuICAgICAgICAgICAgKF9jID0gKF9iID0gcmVzcG9uc2UuYWxsb3dlZE5vbkFscGhhbnVtZXJpY0NoYXJhY3RlcnMpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5qb2luKCcnKSkgIT09IG51bGwgJiYgX2MgIT09IHZvaWQgMCA/IF9jIDogJyc7XG4gICAgICAgIHRoaXMuZm9yY2VVcGdyYWRlT25TaWduaW4gPSAoX2QgPSByZXNwb25zZS5mb3JjZVVwZ3JhZGVPblNpZ25pbikgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogZmFsc2U7XG4gICAgICAgIHRoaXMuc2NoZW1hVmVyc2lvbiA9IHJlc3BvbnNlLnNjaGVtYVZlcnNpb247XG4gICAgfVxuICAgIHZhbGlkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHtcbiAgICAgICAgdmFyIF9hLCBfYiwgX2MsIF9kLCBfZSwgX2Y7XG4gICAgICAgIGNvbnN0IHN0YXR1cyA9IHtcbiAgICAgICAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICAgICAgICBwYXNzd29yZFBvbGljeTogdGhpc1xuICAgICAgICB9O1xuICAgICAgICAvLyBDaGVjayB0aGUgcGFzc3dvcmQgbGVuZ3RoIGFuZCBjaGFyYWN0ZXIgb3B0aW9ucy5cbiAgICAgICAgdGhpcy52YWxpZGF0ZVBhc3N3b3JkTGVuZ3RoT3B0aW9ucyhwYXNzd29yZCwgc3RhdHVzKTtcbiAgICAgICAgdGhpcy52YWxpZGF0ZVBhc3N3b3JkQ2hhcmFjdGVyT3B0aW9ucyhwYXNzd29yZCwgc3RhdHVzKTtcbiAgICAgICAgLy8gQ29tYmluZSB0aGUgc3RhdHVzIGludG8gc2luZ2xlIGlzVmFsaWQgcHJvcGVydHkuXG4gICAgICAgIHN0YXR1cy5pc1ZhbGlkICYmIChzdGF0dXMuaXNWYWxpZCA9IChfYSA9IHN0YXR1cy5tZWV0c01pblBhc3N3b3JkTGVuZ3RoKSAhPT0gbnVsbCAmJiBfYSAhPT0gdm9pZCAwID8gX2EgOiB0cnVlKTtcbiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9iID0gc3RhdHVzLm1lZXRzTWF4UGFzc3dvcmRMZW5ndGgpICE9PSBudWxsICYmIF9iICE9PSB2b2lkIDAgPyBfYiA6IHRydWUpO1xuICAgICAgICBzdGF0dXMuaXNWYWxpZCAmJiAoc3RhdHVzLmlzVmFsaWQgPSAoX2MgPSBzdGF0dXMuY29udGFpbnNMb3dlcmNhc2VMZXR0ZXIpICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IHRydWUpO1xuICAgICAgICBzdGF0dXMuaXNWYWxpZCAmJiAoc3RhdHVzLmlzVmFsaWQgPSAoX2QgPSBzdGF0dXMuY29udGFpbnNVcHBlcmNhc2VMZXR0ZXIpICE9PSBudWxsICYmIF9kICE9PSB2b2lkIDAgPyBfZCA6IHRydWUpO1xuICAgICAgICBzdGF0dXMuaXNWYWxpZCAmJiAoc3RhdHVzLmlzVmFsaWQgPSAoX2UgPSBzdGF0dXMuY29udGFpbnNOdW1lcmljQ2hhcmFjdGVyKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiB0cnVlKTtcbiAgICAgICAgc3RhdHVzLmlzVmFsaWQgJiYgKHN0YXR1cy5pc1ZhbGlkID0gKF9mID0gc3RhdHVzLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyKSAhPT0gbnVsbCAmJiBfZiAhPT0gdm9pZCAwID8gX2YgOiB0cnVlKTtcbiAgICAgICAgcmV0dXJuIHN0YXR1cztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVmFsaWRhdGVzIHRoYXQgdGhlIHBhc3N3b3JkIG1lZXRzIHRoZSBsZW5ndGggb3B0aW9ucyBmb3IgdGhlIHBvbGljeS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXNzd29yZCBQYXNzd29yZCB0byB2YWxpZGF0ZS5cbiAgICAgKiBAcGFyYW0gc3RhdHVzIFZhbGlkYXRpb24gc3RhdHVzLlxuICAgICAqL1xuICAgIHZhbGlkYXRlUGFzc3dvcmRMZW5ndGhPcHRpb25zKHBhc3N3b3JkLCBzdGF0dXMpIHtcbiAgICAgICAgY29uc3QgbWluUGFzc3dvcmRMZW5ndGggPSB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5taW5QYXNzd29yZExlbmd0aDtcbiAgICAgICAgY29uc3QgbWF4UGFzc3dvcmRMZW5ndGggPSB0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5tYXhQYXNzd29yZExlbmd0aDtcbiAgICAgICAgaWYgKG1pblBhc3N3b3JkTGVuZ3RoKSB7XG4gICAgICAgICAgICBzdGF0dXMubWVldHNNaW5QYXNzd29yZExlbmd0aCA9IHBhc3N3b3JkLmxlbmd0aCA+PSBtaW5QYXNzd29yZExlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBpZiAobWF4UGFzc3dvcmRMZW5ndGgpIHtcbiAgICAgICAgICAgIHN0YXR1cy5tZWV0c01heFBhc3N3b3JkTGVuZ3RoID0gcGFzc3dvcmQubGVuZ3RoIDw9IG1heFBhc3N3b3JkTGVuZ3RoO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRlcyB0aGF0IHRoZSBwYXNzd29yZCBtZWV0cyB0aGUgY2hhcmFjdGVyIG9wdGlvbnMgZm9yIHRoZSBwb2xpY3kuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGFzc3dvcmQgUGFzc3dvcmQgdG8gdmFsaWRhdGUuXG4gICAgICogQHBhcmFtIHN0YXR1cyBWYWxpZGF0aW9uIHN0YXR1cy5cbiAgICAgKi9cbiAgICB2YWxpZGF0ZVBhc3N3b3JkQ2hhcmFjdGVyT3B0aW9ucyhwYXNzd29yZCwgc3RhdHVzKSB7XG4gICAgICAgIC8vIEFzc2lnbiBzdGF0dXNlcyBmb3IgcmVxdWlyZW1lbnRzIGV2ZW4gaWYgdGhlIHBhc3N3b3JkIGlzIGFuIGVtcHR5IHN0cmluZy5cbiAgICAgICAgdGhpcy51cGRhdGVQYXNzd29yZENoYXJhY3Rlck9wdGlvbnNTdGF0dXNlcyhzdGF0dXMsIFxuICAgICAgICAvKiBjb250YWluc0xvd2VyY2FzZUNoYXJhY3Rlcj0gKi8gZmFsc2UsIFxuICAgICAgICAvKiBjb250YWluc1VwcGVyY2FzZUNoYXJhY3Rlcj0gKi8gZmFsc2UsIFxuICAgICAgICAvKiBjb250YWluc051bWVyaWNDaGFyYWN0ZXI9ICovIGZhbHNlLCBcbiAgICAgICAgLyogY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXI9ICovIGZhbHNlKTtcbiAgICAgICAgbGV0IHBhc3N3b3JkQ2hhcjtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXNzd29yZC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgcGFzc3dvcmRDaGFyID0gcGFzc3dvcmQuY2hhckF0KGkpO1xuICAgICAgICAgICAgdGhpcy51cGRhdGVQYXNzd29yZENoYXJhY3Rlck9wdGlvbnNTdGF0dXNlcyhzdGF0dXMsIFxuICAgICAgICAgICAgLyogY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXI9ICovIHBhc3N3b3JkQ2hhciA+PSAnYScgJiZcbiAgICAgICAgICAgICAgICBwYXNzd29yZENoYXIgPD0gJ3onLCBcbiAgICAgICAgICAgIC8qIGNvbnRhaW5zVXBwZXJjYXNlQ2hhcmFjdGVyPSAqLyBwYXNzd29yZENoYXIgPj0gJ0EnICYmXG4gICAgICAgICAgICAgICAgcGFzc3dvcmRDaGFyIDw9ICdaJywgXG4gICAgICAgICAgICAvKiBjb250YWluc051bWVyaWNDaGFyYWN0ZXI9ICovIHBhc3N3b3JkQ2hhciA+PSAnMCcgJiZcbiAgICAgICAgICAgICAgICBwYXNzd29yZENoYXIgPD0gJzknLCBcbiAgICAgICAgICAgIC8qIGNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyPSAqLyB0aGlzLmFsbG93ZWROb25BbHBoYW51bWVyaWNDaGFyYWN0ZXJzLmluY2x1ZGVzKHBhc3N3b3JkQ2hhcikpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZXMgdGhlIHJ1bm5pbmcgdmFsaWRhdGlvbiBzdGF0dXMgd2l0aCB0aGUgc3RhdHVzZXMgZm9yIHRoZSBjaGFyYWN0ZXIgb3B0aW9ucy5cbiAgICAgKiBFeHBlY3RlZCB0byBiZSBjYWxsZWQgZWFjaCB0aW1lIGEgY2hhcmFjdGVyIGlzIHByb2Nlc3NlZCB0byB1cGRhdGUgZWFjaCBvcHRpb24gc3RhdHVzXG4gICAgICogYmFzZWQgb24gdGhlIGN1cnJlbnQgY2hhcmFjdGVyLlxuICAgICAqXG4gICAgICogQHBhcmFtIHN0YXR1cyBWYWxpZGF0aW9uIHN0YXR1cy5cbiAgICAgKiBAcGFyYW0gY29udGFpbnNMb3dlcmNhc2VDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgbG93ZXJjYXNlIGxldHRlci5cbiAgICAgKiBAcGFyYW0gY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGFuIHVwcGVyY2FzZSBsZXR0ZXIuXG4gICAgICogQHBhcmFtIGNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlciBXaGV0aGVyIHRoZSBjaGFyYWN0ZXIgaXMgYSBudW1lcmljIGNoYXJhY3Rlci5cbiAgICAgKiBAcGFyYW0gY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIgV2hldGhlciB0aGUgY2hhcmFjdGVyIGlzIGEgbm9uLWFscGhhbnVtZXJpYyBjaGFyYWN0ZXIuXG4gICAgICovXG4gICAgdXBkYXRlUGFzc3dvcmRDaGFyYWN0ZXJPcHRpb25zU3RhdHVzZXMoc3RhdHVzLCBjb250YWluc0xvd2VyY2FzZUNoYXJhY3RlciwgY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXIsIGNvbnRhaW5zTnVtZXJpY0NoYXJhY3RlciwgY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VzdG9tU3RyZW5ndGhPcHRpb25zLmNvbnRhaW5zTG93ZXJjYXNlTGV0dGVyKSB7XG4gICAgICAgICAgICBzdGF0dXMuY29udGFpbnNMb3dlcmNhc2VMZXR0ZXIgfHwgKHN0YXR1cy5jb250YWluc0xvd2VyY2FzZUxldHRlciA9IGNvbnRhaW5zTG93ZXJjYXNlQ2hhcmFjdGVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5jdXN0b21TdHJlbmd0aE9wdGlvbnMuY29udGFpbnNVcHBlcmNhc2VMZXR0ZXIpIHtcbiAgICAgICAgICAgIHN0YXR1cy5jb250YWluc1VwcGVyY2FzZUxldHRlciB8fCAoc3RhdHVzLmNvbnRhaW5zVXBwZXJjYXNlTGV0dGVyID0gY29udGFpbnNVcHBlcmNhc2VDaGFyYWN0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc051bWVyaWNDaGFyYWN0ZXIpIHtcbiAgICAgICAgICAgIHN0YXR1cy5jb250YWluc051bWVyaWNDaGFyYWN0ZXIgfHwgKHN0YXR1cy5jb250YWluc051bWVyaWNDaGFyYWN0ZXIgPSBjb250YWluc051bWVyaWNDaGFyYWN0ZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmN1c3RvbVN0cmVuZ3RoT3B0aW9ucy5jb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3Rlcikge1xuICAgICAgICAgICAgc3RhdHVzLmNvbnRhaW5zTm9uQWxwaGFudW1lcmljQ2hhcmFjdGVyIHx8IChzdGF0dXMuY29udGFpbnNOb25BbHBoYW51bWVyaWNDaGFyYWN0ZXIgPSBjb250YWluc05vbkFscGhhbnVtZXJpY0NoYXJhY3Rlcik7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBBdXRoSW1wbCB7XG4gICAgY29uc3RydWN0b3IoYXBwLCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIsIGFwcENoZWNrU2VydmljZVByb3ZpZGVyLCBjb25maWcpIHtcbiAgICAgICAgdGhpcy5hcHAgPSBhcHA7XG4gICAgICAgIHRoaXMuaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyID0gaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyO1xuICAgICAgICB0aGlzLmFwcENoZWNrU2VydmljZVByb3ZpZGVyID0gYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXI7XG4gICAgICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gbnVsbDtcbiAgICAgICAgdGhpcy5lbXVsYXRvckNvbmZpZyA9IG51bGw7XG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB0aGlzLmF1dGhTdGF0ZVN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24odGhpcyk7XG4gICAgICAgIHRoaXMuaWRUb2tlblN1YnNjcmlwdGlvbiA9IG5ldyBTdWJzY3JpcHRpb24odGhpcyk7XG4gICAgICAgIHRoaXMuYmVmb3JlU3RhdGVRdWV1ZSA9IG5ldyBBdXRoTWlkZGxld2FyZVF1ZXVlKHRoaXMpO1xuICAgICAgICB0aGlzLnJlZGlyZWN0VXNlciA9IG51bGw7XG4gICAgICAgIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLkVYUEVDVEVEX1BBU1NXT1JEX1BPTElDWV9TQ0hFTUFfVkVSU0lPTiA9IDE7XG4gICAgICAgIC8vIEFueSBuZXR3b3JrIGNhbGxzIHdpbGwgc2V0IHRoaXMgdG8gdHJ1ZSBhbmQgcHJldmVudCBzdWJzZXF1ZW50IGVtdWxhdG9yXG4gICAgICAgIC8vIGluaXRpYWxpemF0aW9uXG4gICAgICAgIHRoaXMuX2NhbkluaXRFbXVsYXRvciA9IHRydWU7XG4gICAgICAgIHRoaXMuX2lzSW5pdGlhbGl6ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5fZGVsZXRlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9pbml0aWFsaXphdGlvblByb21pc2UgPSBudWxsO1xuICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIgPSBudWxsO1xuICAgICAgICB0aGlzLl9lcnJvckZhY3RvcnkgPSBfREVGQVVMVF9BVVRIX0VSUk9SX0ZBQ1RPUlk7XG4gICAgICAgIHRoaXMuX2FnZW50UmVjYXB0Y2hhQ29uZmlnID0gbnVsbDtcbiAgICAgICAgdGhpcy5fdGVuYW50UmVjYXB0Y2hhQ29uZmlncyA9IHt9O1xuICAgICAgICB0aGlzLl9wcm9qZWN0UGFzc3dvcmRQb2xpY3kgPSBudWxsO1xuICAgICAgICB0aGlzLl90ZW5hbnRQYXNzd29yZFBvbGljaWVzID0ge307XG4gICAgICAgIHRoaXMuX3Jlc29sdmVQZXJzaXN0ZW5jZU1hbmFnZXJBdmFpbGFibGUgPSB1bmRlZmluZWQ7XG4gICAgICAgIC8vIFRyYWNrcyB0aGUgbGFzdCBub3RpZmllZCBVSUQgZm9yIHN0YXRlIGNoYW5nZSBsaXN0ZW5lcnMgdG8gcHJldmVudFxuICAgICAgICAvLyByZXBlYXRlZCBjYWxscyB0byB0aGUgY2FsbGJhY2tzLiBVbmRlZmluZWQgbWVhbnMgaXQncyBuZXZlciBiZWVuXG4gICAgICAgIC8vIGNhbGxlZCwgd2hlcmVhcyBudWxsIG1lYW5zIGl0J3MgYmVlbiBjYWxsZWQgd2l0aCBhIHNpZ25lZCBvdXQgdXNlclxuICAgICAgICB0aGlzLmxhc3ROb3RpZmllZFVpZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSBudWxsO1xuICAgICAgICB0aGlzLnRlbmFudElkID0gbnVsbDtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IHsgYXBwVmVyaWZpY2F0aW9uRGlzYWJsZWRGb3JUZXN0aW5nOiBmYWxzZSB9O1xuICAgICAgICB0aGlzLmZyYW1ld29ya3MgPSBbXTtcbiAgICAgICAgdGhpcy5uYW1lID0gYXBwLm5hbWU7XG4gICAgICAgIHRoaXMuY2xpZW50VmVyc2lvbiA9IGNvbmZpZy5zZGtDbGllbnRWZXJzaW9uO1xuICAgICAgICAvLyBUT0RPKGphbWVzZGFuaWVscykgZXhwbG9yZSBsZXNzIGhhY2t5IHdheSB0byBkbyB0aGlzLCBjb29raWUgYXV0aGVudGljYXRpb24gbmVlZHNcbiAgICAgICAgLy8gcGVyc2lzdGVuY2VNYW5hbmdlciB0byBiZSBhdmFpbGFibGUuIHNlZSBfZ2V0RmluYWxUYXJnZXQgZm9yIG1vcmUgY29udGV4dFxuICAgICAgICB0aGlzLl9wZXJzaXN0ZW5jZU1hbmFnZXJBdmFpbGFibGUgPSBuZXcgUHJvbWlzZShyZXNvbHZlID0+ICh0aGlzLl9yZXNvbHZlUGVyc2lzdGVuY2VNYW5hZ2VyQXZhaWxhYmxlID0gcmVzb2x2ZSkpO1xuICAgIH1cbiAgICBfaW5pdGlhbGl6ZVdpdGhQZXJzaXN0ZW5jZShwZXJzaXN0ZW5jZUhpZXJhcmNoeSwgcG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7XG4gICAgICAgIGlmIChwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlciA9IF9nZXRJbnN0YW5jZShwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEhhdmUgdG8gY2hlY2sgZm9yIGFwcCBkZWxldGlvbiB0aHJvdWdob3V0IGluaXRpYWxpemF0aW9uIChhZnRlciBlYWNoXG4gICAgICAgIC8vIHByb21pc2UgcmVzb2x1dGlvbilcbiAgICAgICAgdGhpcy5faW5pdGlhbGl6YXRpb25Qcm9taXNlID0gdGhpcy5xdWV1ZShhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB2YXIgX2EsIF9iLCBfYztcbiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIgPSBhd2FpdCBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyLmNyZWF0ZSh0aGlzLCBwZXJzaXN0ZW5jZUhpZXJhcmNoeSk7XG4gICAgICAgICAgICAoX2EgPSB0aGlzLl9yZXNvbHZlUGVyc2lzdGVuY2VNYW5hZ2VyQXZhaWxhYmxlKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSB0aGUgcmVzb2x2ZXIgZWFybHkgaWYgbmVjZXNzYXJ5IChvbmx5IGFwcGxpY2FibGUgdG8gd2ViOlxuICAgICAgICAgICAgLy8gdGhpcyB3aWxsIGNhdXNlIHRoZSBpZnJhbWUgdG8gbG9hZCBpbW1lZGlhdGVseSBpbiBjZXJ0YWluIGNhc2VzKVxuICAgICAgICAgICAgaWYgKChfYiA9IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLl9zaG91bGRJbml0UHJvYWN0aXZlbHkpIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGZhaWxzLCBkb24ndCBoYWx0IGF1dGggbG9hZGluZ1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlci5faW5pdGlhbGl6ZSh0aGlzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLyogSWdub3JlIHRoZSBlcnJvciAqL1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZUN1cnJlbnRVc2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcik7XG4gICAgICAgICAgICB0aGlzLmxhc3ROb3RpZmllZFVpZCA9ICgoX2MgPSB0aGlzLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYyA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2MudWlkKSB8fCBudWxsO1xuICAgICAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLl9pc0luaXRpYWxpemVkID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbml0aWFsaXphdGlvblByb21pc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIElmIHRoZSBwZXJzaXN0ZW5jZSBpcyBjaGFuZ2VkIGluIGFub3RoZXIgd2luZG93LCB0aGUgdXNlciBtYW5hZ2VyIHdpbGwgbGV0IHVzIGtub3dcbiAgICAgKi9cbiAgICBhc3luYyBfb25TdG9yYWdlRXZlbnQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5nZXRDdXJyZW50VXNlcigpO1xuICAgICAgICBpZiAoIXRoaXMuY3VycmVudFVzZXIgJiYgIXVzZXIpIHtcbiAgICAgICAgICAgIC8vIE5vIGNoYW5nZSwgZG8gbm90aGluZyAod2FzIHNpZ25lZCBvdXQgYW5kIHJlbWFpbmVkIHNpZ25lZCBvdXQpLlxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSBzYW1lIHVzZXIgaXMgdG8gYmUgc3luY2hyb25pemVkLlxuICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlciAmJiB1c2VyICYmIHRoaXMuY3VycmVudFVzZXIudWlkID09PSB1c2VyLnVpZCkge1xuICAgICAgICAgICAgLy8gRGF0YSB1cGRhdGUsIHNpbXBseSBjb3B5IGRhdGEgY2hhbmdlcy5cbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRVc2VyLl9hc3NpZ24odXNlcik7XG4gICAgICAgICAgICAvLyBJZiB0b2tlbnMgY2hhbmdlZCBmcm9tIHByZXZpb3VzIHVzZXIgdG9rZW5zLCB0aGlzIHdpbGwgdHJpZ2dlclxuICAgICAgICAgICAgLy8gbm90aWZ5QXV0aExpc3RlbmVyc18uXG4gICAgICAgICAgICBhd2FpdCB0aGlzLmN1cnJlbnRVc2VyLmdldElkVG9rZW4oKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBVcGRhdGUgY3VycmVudCBBdXRoIHN0YXRlLiBFaXRoZXIgYSBuZXcgbG9naW4gb3IgbG9nb3V0LlxuICAgICAgICAvLyBTa2lwIGJsb2NraW5nIGNhbGxiYWNrcywgdGhleSBzaG91bGQgbm90IGFwcGx5IHRvIGEgY2hhbmdlIGluIGFub3RoZXIgdGFiLlxuICAgICAgICBhd2FpdCB0aGlzLl91cGRhdGVDdXJyZW50VXNlcih1c2VyLCAvKiBza2lwQmVmb3JlU3RhdGVDYWxsYmFja3MgKi8gdHJ1ZSk7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemVDdXJyZW50VXNlckZyb21JZFRva2VuKGlkVG9rZW4pIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZ2V0QWNjb3VudEluZm8odGhpcywgeyBpZFRva2VuIH0pO1xuICAgICAgICAgICAgY29uc3QgdXNlciA9IGF3YWl0IFVzZXJJbXBsLl9mcm9tR2V0QWNjb3VudEluZm9SZXNwb25zZSh0aGlzLCByZXNwb25zZSwgaWRUb2tlbik7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIodXNlcik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKCdGaXJlYmFzZVNlcnZlckFwcCBjb3VsZCBub3QgbG9naW4gdXNlciB3aXRoIHByb3ZpZGVkIGF1dGhJZFRva2VuOiAnLCBlcnIpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemVDdXJyZW50VXNlcihwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAodGhpcy5hcHApKSB7XG4gICAgICAgICAgICBjb25zdCBpZFRva2VuID0gdGhpcy5hcHAuc2V0dGluZ3MuYXV0aElkVG9rZW47XG4gICAgICAgICAgICBpZiAoaWRUb2tlbikge1xuICAgICAgICAgICAgICAgIC8vIFN0YXJ0IHRoZSBhdXRoIG9wZXJhdGlvbiBpbiB0aGUgbmV4dCB0aWNrIHRvIGFsbG93IGEgbW9tZW50IGZvciB0aGUgY3VzdG9tZXIncyBhcHAgdG9cbiAgICAgICAgICAgICAgICAvLyBhdHRhY2ggYW4gZW11bGF0b3IsIGlmIGRlc2lyZWQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHRoaXMuaW5pdGlhbGl6ZUN1cnJlbnRVc2VyRnJvbUlkVG9rZW4oaWRUb2tlbikudGhlbihyZXNvbHZlLCByZXNvbHZlKSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEZpcnN0IGNoZWNrIHRvIHNlZSBpZiB3ZSBoYXZlIGEgcGVuZGluZyByZWRpcmVjdCBldmVudC5cbiAgICAgICAgY29uc3QgcHJldmlvdXNseVN0b3JlZFVzZXIgPSAoYXdhaXQgdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLmdldEN1cnJlbnRVc2VyKCkpO1xuICAgICAgICBsZXQgZnV0dXJlQ3VycmVudFVzZXIgPSBwcmV2aW91c2x5U3RvcmVkVXNlcjtcbiAgICAgICAgbGV0IG5lZWRzVG9jaGVja01pZGRsZXdhcmUgPSBmYWxzZTtcbiAgICAgICAgaWYgKHBvcHVwUmVkaXJlY3RSZXNvbHZlciAmJiB0aGlzLmNvbmZpZy5hdXRoRG9tYWluKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKCk7XG4gICAgICAgICAgICBjb25zdCByZWRpcmVjdFVzZXJFdmVudElkID0gKF9hID0gdGhpcy5yZWRpcmVjdFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5fcmVkaXJlY3RFdmVudElkO1xuICAgICAgICAgICAgY29uc3Qgc3RvcmVkVXNlckV2ZW50SWQgPSBmdXR1cmVDdXJyZW50VXNlciA9PT0gbnVsbCB8fCBmdXR1cmVDdXJyZW50VXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogZnV0dXJlQ3VycmVudFVzZXIuX3JlZGlyZWN0RXZlbnRJZDtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMudHJ5UmVkaXJlY3RTaWduSW4ocG9wdXBSZWRpcmVjdFJlc29sdmVyKTtcbiAgICAgICAgICAgIC8vIElmIHRoZSBzdG9yZWQgdXNlciAoaS5lLiB0aGUgb2xkIFwiY3VycmVudFVzZXJcIikgaGFzIGEgcmVkaXJlY3RJZCB0aGF0XG4gICAgICAgICAgICAvLyBtYXRjaGVzIHRoZSByZWRpcmVjdCB1c2VyLCB0aGVuIHdlIHdhbnQgdG8gaW5pdGlhbGx5IHNpZ24gaW4gd2l0aCB0aGVcbiAgICAgICAgICAgIC8vIG5ldyB1c2VyIG9iamVjdCBmcm9tIHJlc3VsdC5cbiAgICAgICAgICAgIC8vIFRPRE8oc2FtZ2hvKTogTW9yZSB0aG9yb3VnaGx5IHRlc3QgYWxsIG9mIHRoaXNcbiAgICAgICAgICAgIGlmICgoIXJlZGlyZWN0VXNlckV2ZW50SWQgfHwgcmVkaXJlY3RVc2VyRXZlbnRJZCA9PT0gc3RvcmVkVXNlckV2ZW50SWQpICYmXG4gICAgICAgICAgICAgICAgKHJlc3VsdCA9PT0gbnVsbCB8fCByZXN1bHQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHJlc3VsdC51c2VyKSkge1xuICAgICAgICAgICAgICAgIGZ1dHVyZUN1cnJlbnRVc2VyID0gcmVzdWx0LnVzZXI7XG4gICAgICAgICAgICAgICAgbmVlZHNUb2NoZWNrTWlkZGxld2FyZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgbm8gdXNlciBpbiBwZXJzaXN0ZW5jZSwgdGhlcmUgaXMgbm8gY3VycmVudCB1c2VyLiBTZXQgdG8gbnVsbC5cbiAgICAgICAgaWYgKCFmdXR1cmVDdXJyZW50VXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWZ1dHVyZUN1cnJlbnRVc2VyLl9yZWRpcmVjdEV2ZW50SWQpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgaXNuJ3QgYSByZWRpcmVjdCBsaW5rIG9wZXJhdGlvbiwgd2UgY2FuIHJlbG9hZCBhbmQgYmFpbC5cbiAgICAgICAgICAgIC8vIEZpcnN0IHRob3VnaCwgZW5zdXJlIHRoYXQgd2UgY2hlY2sgdGhlIG1pZGRsZXdhcmUgaXMgaGFwcHkuXG4gICAgICAgICAgICBpZiAobmVlZHNUb2NoZWNrTWlkZGxld2FyZSkge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKGZ1dHVyZUN1cnJlbnRVc2VyKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZnV0dXJlQ3VycmVudFVzZXIgPSBwcmV2aW91c2x5U3RvcmVkVXNlcjtcbiAgICAgICAgICAgICAgICAgICAgLy8gV2Uga25vdyB0aGlzIGlzIGF2YWlsYWJsZSBzaW5jZSB0aGUgYml0IGlzIG9ubHkgc2V0IHdoZW4gdGhlXG4gICAgICAgICAgICAgICAgICAgIC8vIHJlc29sdmVyIGlzIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIuX292ZXJyaWRlUmVkaXJlY3RSZXN1bHQodGhpcywgKCkgPT4gUHJvbWlzZS5yZWplY3QoZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChmdXR1cmVDdXJyZW50VXNlcikge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLnJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcihmdXR1cmVDdXJyZW50VXNlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKG51bGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIF9hc3NlcnQodGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyLCB0aGlzLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XG4gICAgICAgIGF3YWl0IHRoaXMuZ2V0T3JJbml0UmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIoKTtcbiAgICAgICAgLy8gSWYgdGhlIHJlZGlyZWN0IHVzZXIncyBldmVudCBJRCBtYXRjaGVzIHRoZSBjdXJyZW50IHVzZXIncyBldmVudCBJRCxcbiAgICAgICAgLy8gRE8gTk9UIHJlbG9hZCB0aGUgY3VycmVudCB1c2VyLCBvdGhlcndpc2UgdGhleSdsbCBiZSBjbGVhcmVkIGZyb20gc3RvcmFnZS5cbiAgICAgICAgLy8gVGhpcyBpcyBpbXBvcnRhbnQgZm9yIHRoZSByZWF1dGhlbnRpY2F0ZVdpdGhSZWRpcmVjdCgpIGZsb3cuXG4gICAgICAgIGlmICh0aGlzLnJlZGlyZWN0VXNlciAmJlxuICAgICAgICAgICAgdGhpcy5yZWRpcmVjdFVzZXIuX3JlZGlyZWN0RXZlbnRJZCA9PT0gZnV0dXJlQ3VycmVudFVzZXIuX3JlZGlyZWN0RXZlbnRJZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcihmdXR1cmVDdXJyZW50VXNlcik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucmVsb2FkQW5kU2V0Q3VycmVudFVzZXJPckNsZWFyKGZ1dHVyZUN1cnJlbnRVc2VyKTtcbiAgICB9XG4gICAgYXN5bmMgdHJ5UmVkaXJlY3RTaWduSW4ocmVkaXJlY3RSZXNvbHZlcikge1xuICAgICAgICAvLyBUaGUgcmVkaXJlY3QgdXNlciBuZWVkcyB0byBiZSBjaGVja2VkIChhbmQgc2lnbmVkIGluIGlmIGF2YWlsYWJsZSlcbiAgICAgICAgLy8gZHVyaW5nIGF1dGggaW5pdGlhbGl6YXRpb24uIEFsbCBvZiB0aGUgbm9ybWFsIHNpZ24gaW4gYW5kIGxpbmsvcmVhdXRoXG4gICAgICAgIC8vIGZsb3dzIGNhbGwgYmFjayBpbnRvIGF1dGggYW5kIHB1c2ggdGhpbmdzIG9udG8gdGhlIHByb21pc2UgcXVldWUuIFdlXG4gICAgICAgIC8vIG5lZWQgdG8gYXdhaXQgdGhlIHJlc3VsdCBvZiB0aGUgcmVkaXJlY3Qgc2lnbiBpbiAqaW5zaWRlIHRoZSBwcm9taXNlXG4gICAgICAgIC8vIHF1ZXVlKi4gVGhpcyBwcmVzZW50cyBhIHByb2JsZW06IHdlIHJ1biBpbnRvIGRlYWRsb2NrLiBTZWU6XG4gICAgICAgIC8vICAgIOKUjD4gW0luaXRpYWxpemF0aW9uXSDilIDilIDilIDilIDilIDilJBcbiAgICAgICAgLy8gICAg4pSMPiBbPG90aGVyIHF1ZXVlIHRhc2tzPl0g4pSCXG4gICAgICAgIC8vICAgIOKUlOKUgCBbZ2V0UmVkaXJlY3RSZXN1bHRdIDzilIDilJhcbiAgICAgICAgLy8gICAgd2hlcmUgW10gYXJlIHRhc2tzIG9uIHRoZSBxdWV1ZSBhbmQgYXJyb3dzIGRlbm90ZSBhd2FpdHNcbiAgICAgICAgLy8gSW5pdGlhbGl6YXRpb24gd2lsbCBuZXZlciBjb21wbGV0ZSBiZWNhdXNlIGl0J3Mgd2FpdGluZyBvbiBzb21ldGhpbmdcbiAgICAgICAgLy8gdGhhdCdzIHdhaXRpbmcgZm9yIGluaXRpYWxpemF0aW9uIHRvIGNvbXBsZXRlIVxuICAgICAgICAvL1xuICAgICAgICAvLyBJbnN0ZWFkLCB0aGlzIG1ldGhvZCBjYWxscyBnZXRSZWRpcmVjdFJlc3VsdCgpIChzdG9yZWQgaW5cbiAgICAgICAgLy8gX2NvbXBsZXRlUmVkaXJlY3RGbikgd2l0aCBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgdGhhdCBpbnN0cnVjdHMgYWxsIG9mXG4gICAgICAgIC8vIHRoZSB1bmRlcmx5aW5nIGF1dGggb3BlcmF0aW9ucyB0byBza2lwIGFueXRoaW5nIHRoYXQgbXV0YXRlcyBhdXRoIHN0YXRlLlxuICAgICAgICBsZXQgcmVzdWx0ID0gbnVsbDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFdlIGtub3cgdGhpcy5fcG9wdXBSZWRpcmVjdFJlc29sdmVyIGlzIHNldCBzaW5jZSByZWRpcmVjdFJlc29sdmVyXG4gICAgICAgICAgICAvLyBpcyBwYXNzZWQgaW4uIFRoZSBfY29tcGxldGVSZWRpcmVjdEZuIGV4cGVjdHMgdGhlIHVud3JhcHBlZCBleHRlcm4uXG4gICAgICAgICAgICByZXN1bHQgPSBhd2FpdCB0aGlzLl9wb3B1cFJlZGlyZWN0UmVzb2x2ZXIuX2NvbXBsZXRlUmVkaXJlY3RGbih0aGlzLCByZWRpcmVjdFJlc29sdmVyLCB0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gU3dhbGxvdyBhbnkgZXJyb3JzIGhlcmU7IHRoZSBjb2RlIGNhbiByZXRyaWV2ZSB0aGVtIGluXG4gICAgICAgICAgICAvLyBnZXRSZWRpcmVjdFJlc3VsdCgpLlxuICAgICAgICAgICAgYXdhaXQgdGhpcy5fc2V0UmVkaXJlY3RVc2VyKG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfVxuICAgIGFzeW5jIHJlbG9hZEFuZFNldEN1cnJlbnRVc2VyT3JDbGVhcih1c2VyKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBhd2FpdCBfcmVsb2FkV2l0aG91dFNhdmluZyh1c2VyKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgIT09XG4gICAgICAgICAgICAgICAgYGF1dGgvJHtcIm5ldHdvcmstcmVxdWVzdC1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLk5FVFdPUktfUkVRVUVTVF9GQUlMRUQgKi99YCkge1xuICAgICAgICAgICAgICAgIC8vIFNvbWV0aGluZydzIHdyb25nIHdpdGggdGhlIHVzZXIncyB0b2tlbi4gTG9nIHRoZW0gb3V0IGFuZCByZW1vdmVcbiAgICAgICAgICAgICAgICAvLyB0aGVtIGZyb20gc3RvcmFnZVxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmRpcmVjdGx5U2V0Q3VycmVudFVzZXIobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTtcbiAgICB9XG4gICAgdXNlRGV2aWNlTGFuZ3VhZ2UoKSB7XG4gICAgICAgIHRoaXMubGFuZ3VhZ2VDb2RlID0gX2dldFVzZXJMYW5ndWFnZSgpO1xuICAgIH1cbiAgICBhc3luYyBfZGVsZXRlKCkge1xuICAgICAgICB0aGlzLl9kZWxldGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgYXN5bmMgdXBkYXRlQ3VycmVudFVzZXIodXNlckV4dGVybikge1xuICAgICAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAodGhpcy5hcHApKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBwdWJsaWMgdXBkYXRlQ3VycmVudFVzZXIgbWV0aG9kIG5lZWRzIHRvIG1ha2UgYSBjb3B5IG9mIHRoZSB1c2VyLFxuICAgICAgICAvLyBhbmQgYWxzbyBjaGVjayB0aGF0IHRoZSBwcm9qZWN0IG1hdGNoZXNcbiAgICAgICAgY29uc3QgdXNlciA9IHVzZXJFeHRlcm5cbiAgICAgICAgICAgID8gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXJFeHRlcm4pXG4gICAgICAgICAgICA6IG51bGw7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICBfYXNzZXJ0KHVzZXIuYXV0aC5jb25maWcuYXBpS2V5ID09PSB0aGlzLmNvbmZpZy5hcGlLZXksIHRoaXMsIFwiaW52YWxpZC11c2VyLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5JTlZBTElEX0FVVEggKi8pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl91cGRhdGVDdXJyZW50VXNlcih1c2VyICYmIHVzZXIuX2Nsb25lKHRoaXMpKTtcbiAgICB9XG4gICAgYXN5bmMgX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXIsIHNraXBCZWZvcmVTdGF0ZUNhbGxiYWNrcyA9IGZhbHNlKSB7XG4gICAgICAgIGlmICh0aGlzLl9kZWxldGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIF9hc3NlcnQodGhpcy50ZW5hbnRJZCA9PT0gdXNlci50ZW5hbnRJZCwgdGhpcywgXCJ0ZW5hbnQtaWQtbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlRFTkFOVF9JRF9NSVNNQVRDSCAqLyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFza2lwQmVmb3JlU3RhdGVDYWxsYmFja3MpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKHVzZXIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXVlKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKTtcbiAgICAgICAgICAgIHRoaXMubm90aWZ5QXV0aExpc3RlbmVycygpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgc2lnbk91dCgpIHtcbiAgICAgICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKHRoaXMuYXBwKSkge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKHRoaXMpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBSdW4gZmlyc3QsIHRvIGJsb2NrIF9zZXRSZWRpcmVjdFVzZXIoKSBpZiBhbnkgY2FsbGJhY2tzIGZhaWwuXG4gICAgICAgIGF3YWl0IHRoaXMuYmVmb3JlU3RhdGVRdWV1ZS5ydW5NaWRkbGV3YXJlKG51bGwpO1xuICAgICAgICAvLyBDbGVhciB0aGUgcmVkaXJlY3QgdXNlciB3aGVuIHNpZ25PdXQgaXMgY2FsbGVkXG4gICAgICAgIGlmICh0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyIHx8IHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlcikge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5fc2V0UmVkaXJlY3RVc2VyKG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFByZXZlbnQgY2FsbGJhY2tzIGZyb20gYmVpbmcgY2FsbGVkIGFnYWluIGluIF91cGRhdGVDdXJyZW50VXNlciwgYXNcbiAgICAgICAgLy8gdGhleSB3ZXJlIGFscmVhZHkgY2FsbGVkIGluIHRoZSBmaXJzdCBsaW5lLlxuICAgICAgICByZXR1cm4gdGhpcy5fdXBkYXRlQ3VycmVudFVzZXIobnVsbCwgLyogc2tpcEJlZm9yZVN0YXRlQ2FsbGJhY2tzICovIHRydWUpO1xuICAgIH1cbiAgICBzZXRQZXJzaXN0ZW5jZShwZXJzaXN0ZW5jZSkge1xuICAgICAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAodGhpcy5hcHApKSB7XG4gICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodGhpcykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXVlKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5zZXRQZXJzaXN0ZW5jZShfZ2V0SW5zdGFuY2UocGVyc2lzdGVuY2UpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIF9nZXRSZWNhcHRjaGFDb25maWcoKSB7XG4gICAgICAgIGlmICh0aGlzLnRlbmFudElkID09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZ2VudFJlY2FwdGNoYUNvbmZpZztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW5hbnRSZWNhcHRjaGFDb25maWdzW3RoaXMudGVuYW50SWRdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIHZhbGlkYXRlUGFzc3dvcmQocGFzc3dvcmQpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9nZXRQYXNzd29yZFBvbGljeUludGVybmFsKCkpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMuX3VwZGF0ZVBhc3N3b3JkUG9saWN5KCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFzc3dvcmQgcG9saWN5IHdpbGwgYmUgZGVmaW5lZCBhZnRlciBmZXRjaGluZy5cbiAgICAgICAgY29uc3QgcGFzc3dvcmRQb2xpY3kgPSB0aGlzLl9nZXRQYXNzd29yZFBvbGljeUludGVybmFsKCk7XG4gICAgICAgIC8vIENoZWNrIHRoYXQgdGhlIHBvbGljeSBzY2hlbWEgdmVyc2lvbiBpcyBzdXBwb3J0ZWQgYnkgdGhlIFNESy5cbiAgICAgICAgLy8gVE9ETzogVXBkYXRlIHRoaXMgbG9naWMgdG8gdXNlIGEgbWF4IHN1cHBvcnRlZCBwb2xpY3kgc2NoZW1hIHZlcnNpb24gb25jZSB3ZSBoYXZlIG11bHRpcGxlIHNjaGVtYSB2ZXJzaW9ucy5cbiAgICAgICAgaWYgKHBhc3N3b3JkUG9saWN5LnNjaGVtYVZlcnNpb24gIT09XG4gICAgICAgICAgICB0aGlzLkVYUEVDVEVEX1BBU1NXT1JEX1BPTElDWV9TQ0hFTUFfVkVSU0lPTikge1xuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KHRoaXMuX2Vycm9yRmFjdG9yeS5jcmVhdGUoXCJ1bnN1cHBvcnRlZC1wYXNzd29yZC1wb2xpY3ktc2NoZW1hLXZlcnNpb25cIiAvKiBBdXRoRXJyb3JDb2RlLlVOU1VQUE9SVEVEX1BBU1NXT1JEX1BPTElDWV9TQ0hFTUFfVkVSU0lPTiAqLywge30pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcGFzc3dvcmRQb2xpY3kudmFsaWRhdGVQYXNzd29yZChwYXNzd29yZCk7XG4gICAgfVxuICAgIF9nZXRQYXNzd29yZFBvbGljeUludGVybmFsKCkge1xuICAgICAgICBpZiAodGhpcy50ZW5hbnRJZCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3Byb2plY3RQYXNzd29yZFBvbGljeTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW5hbnRQYXNzd29yZFBvbGljaWVzW3RoaXMudGVuYW50SWRdO1xuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIF91cGRhdGVQYXNzd29yZFBvbGljeSgpIHtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfZ2V0UGFzc3dvcmRQb2xpY3kodGhpcyk7XG4gICAgICAgIGNvbnN0IHBhc3N3b3JkUG9saWN5ID0gbmV3IFBhc3N3b3JkUG9saWN5SW1wbChyZXNwb25zZSk7XG4gICAgICAgIGlmICh0aGlzLnRlbmFudElkID09PSBudWxsKSB7XG4gICAgICAgICAgICB0aGlzLl9wcm9qZWN0UGFzc3dvcmRQb2xpY3kgPSBwYXNzd29yZFBvbGljeTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX3RlbmFudFBhc3N3b3JkUG9saWNpZXNbdGhpcy50ZW5hbnRJZF0gPSBwYXNzd29yZFBvbGljeTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfZ2V0UGVyc2lzdGVuY2VUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hc3NlcnRlZFBlcnNpc3RlbmNlLnBlcnNpc3RlbmNlLnR5cGU7XG4gICAgfVxuICAgIF9nZXRQZXJzaXN0ZW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXNzZXJ0ZWRQZXJzaXN0ZW5jZS5wZXJzaXN0ZW5jZTtcbiAgICB9XG4gICAgX3VwZGF0ZUVycm9yTWFwKGVycm9yTWFwKSB7XG4gICAgICAgIHRoaXMuX2Vycm9yRmFjdG9yeSA9IG5ldyBFcnJvckZhY3RvcnkoJ2F1dGgnLCAnRmlyZWJhc2UnLCBlcnJvck1hcCgpKTtcbiAgICB9XG4gICAgb25BdXRoU3RhdGVDaGFuZ2VkKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlZ2lzdGVyU3RhdGVMaXN0ZW5lcih0aGlzLmF1dGhTdGF0ZVN1YnNjcmlwdGlvbiwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpO1xuICAgIH1cbiAgICBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKGNhbGxiYWNrLCBvbkFib3J0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlZm9yZVN0YXRlUXVldWUucHVzaENhbGxiYWNrKGNhbGxiYWNrLCBvbkFib3J0KTtcbiAgICB9XG4gICAgb25JZFRva2VuQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWdpc3RlclN0YXRlTGlzdGVuZXIodGhpcy5pZFRva2VuU3Vic2NyaXB0aW9uLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7XG4gICAgfVxuICAgIGF1dGhTdGF0ZVJlYWR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IHRoaXMub25BdXRoU3RhdGVDaGFuZ2VkKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH0sIHJlamVjdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXZva2VzIHRoZSBnaXZlbiBhY2Nlc3MgdG9rZW4uIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRzIEFwcGxlIE9BdXRoIGFjY2VzcyB0b2tlbnMuXG4gICAgICovXG4gICAgYXN5bmMgcmV2b2tlQWNjZXNzVG9rZW4odG9rZW4pIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudFVzZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLmN1cnJlbnRVc2VyLmdldElkVG9rZW4oKTtcbiAgICAgICAgICAgIC8vIEdlbmVyYWxpemUgdGhpcyB0byBhY2NlcHQgb3RoZXIgcHJvdmlkZXJzIG9uY2Ugc3VwcG9ydGVkLlxuICAgICAgICAgICAgY29uc3QgcmVxdWVzdCA9IHtcbiAgICAgICAgICAgICAgICBwcm92aWRlcklkOiAnYXBwbGUuY29tJyxcbiAgICAgICAgICAgICAgICB0b2tlblR5cGU6IFwiQUNDRVNTX1RPS0VOXCIgLyogVG9rZW5UeXBlLkFDQ0VTU19UT0tFTiAqLyxcbiAgICAgICAgICAgICAgICB0b2tlbixcbiAgICAgICAgICAgICAgICBpZFRva2VuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgaWYgKHRoaXMudGVuYW50SWQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3QudGVuYW50SWQgPSB0aGlzLnRlbmFudElkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgcmV2b2tlVG9rZW4odGhpcywgcmVxdWVzdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhcGlLZXk6IHRoaXMuY29uZmlnLmFwaUtleSxcbiAgICAgICAgICAgIGF1dGhEb21haW46IHRoaXMuY29uZmlnLmF1dGhEb21haW4sXG4gICAgICAgICAgICBhcHBOYW1lOiB0aGlzLm5hbWUsXG4gICAgICAgICAgICBjdXJyZW50VXNlcjogKF9hID0gdGhpcy5fY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS50b0pTT04oKVxuICAgICAgICB9O1xuICAgIH1cbiAgICBhc3luYyBfc2V0UmVkaXJlY3RVc2VyKHVzZXIsIHBvcHVwUmVkaXJlY3RSZXNvbHZlcikge1xuICAgICAgICBjb25zdCByZWRpcmVjdE1hbmFnZXIgPSBhd2FpdCB0aGlzLmdldE9ySW5pdFJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyKHBvcHVwUmVkaXJlY3RSZXNvbHZlcik7XG4gICAgICAgIHJldHVybiB1c2VyID09PSBudWxsXG4gICAgICAgICAgICA/IHJlZGlyZWN0TWFuYWdlci5yZW1vdmVDdXJyZW50VXNlcigpXG4gICAgICAgICAgICA6IHJlZGlyZWN0TWFuYWdlci5zZXRDdXJyZW50VXNlcih1c2VyKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0T3JJbml0UmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIocG9wdXBSZWRpcmVjdFJlc29sdmVyKSB7XG4gICAgICAgIGlmICghdGhpcy5yZWRpcmVjdFBlcnNpc3RlbmNlTWFuYWdlcikge1xuICAgICAgICAgICAgY29uc3QgcmVzb2x2ZXIgPSAocG9wdXBSZWRpcmVjdFJlc29sdmVyICYmIF9nZXRJbnN0YW5jZShwb3B1cFJlZGlyZWN0UmVzb2x2ZXIpKSB8fFxuICAgICAgICAgICAgICAgIHRoaXMuX3BvcHVwUmVkaXJlY3RSZXNvbHZlcjtcbiAgICAgICAgICAgIF9hc3NlcnQocmVzb2x2ZXIsIHRoaXMsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXIgPSBhd2FpdCBQZXJzaXN0ZW5jZVVzZXJNYW5hZ2VyLmNyZWF0ZSh0aGlzLCBbX2dldEluc3RhbmNlKHJlc29sdmVyLl9yZWRpcmVjdFBlcnNpc3RlbmNlKV0sIFwicmVkaXJlY3RVc2VyXCIgLyogS2V5TmFtZS5SRURJUkVDVF9VU0VSICovKTtcbiAgICAgICAgICAgIHRoaXMucmVkaXJlY3RVc2VyID1cbiAgICAgICAgICAgICAgICBhd2FpdCB0aGlzLnJlZGlyZWN0UGVyc2lzdGVuY2VNYW5hZ2VyLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RQZXJzaXN0ZW5jZU1hbmFnZXI7XG4gICAgfVxuICAgIGFzeW5jIF9yZWRpcmVjdFVzZXJGb3JJZChpZCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAvLyBNYWtlIHN1cmUgd2UndmUgY2xlYXJlZCBhbnkgcGVuZGluZyBwZXJzaXN0ZW5jZSBhY3Rpb25zIGlmIHdlJ3JlIG5vdCBpblxuICAgICAgICAvLyB0aGUgaW5pdGlhbGl6ZXJcbiAgICAgICAgaWYgKHRoaXMuX2lzSW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIGF3YWl0IHRoaXMucXVldWUoYXN5bmMgKCkgPT4geyB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKChfYSA9IHRoaXMuX2N1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuX3JlZGlyZWN0RXZlbnRJZCkgPT09IGlkKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fY3VycmVudFVzZXI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCgoX2IgPSB0aGlzLnJlZGlyZWN0VXNlcikgPT09IG51bGwgfHwgX2IgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9iLl9yZWRpcmVjdEV2ZW50SWQpID09PSBpZCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucmVkaXJlY3RVc2VyO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBhc3luYyBfcGVyc2lzdFVzZXJJZkN1cnJlbnQodXNlcikge1xuICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMucXVldWUoYXN5bmMgKCkgPT4gdGhpcy5kaXJlY3RseVNldEN1cnJlbnRVc2VyKHVzZXIpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogTm90aWZpZXMgbGlzdGVuZXJzIG9ubHkgaWYgdGhlIHVzZXIgaXMgY3VycmVudCAqL1xuICAgIF9ub3RpZnlMaXN0ZW5lcnNJZkN1cnJlbnQodXNlcikge1xuICAgICAgICBpZiAodXNlciA9PT0gdGhpcy5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgdGhpcy5ub3RpZnlBdXRoTGlzdGVuZXJzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgX2tleSgpIHtcbiAgICAgICAgcmV0dXJuIGAke3RoaXMuY29uZmlnLmF1dGhEb21haW59OiR7dGhpcy5jb25maWcuYXBpS2V5fToke3RoaXMubmFtZX1gO1xuICAgIH1cbiAgICBfc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCkge1xuICAgICAgICB0aGlzLmlzUHJvYWN0aXZlUmVmcmVzaEVuYWJsZWQgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgdGhpcy5fY3VycmVudFVzZXIuX3N0YXJ0UHJvYWN0aXZlUmVmcmVzaCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpIHtcbiAgICAgICAgdGhpcy5pc1Byb2FjdGl2ZVJlZnJlc2hFbmFibGVkID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyKSB7XG4gICAgICAgICAgICB0aGlzLl9jdXJyZW50VXNlci5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgY3VycmVudCB1c2VyIGNhc3QgYXMgdGhlIGludGVybmFsIHR5cGUgKi9cbiAgICBnZXQgX2N1cnJlbnRVc2VyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jdXJyZW50VXNlcjtcbiAgICB9XG4gICAgbm90aWZ5QXV0aExpc3RlbmVycygpIHtcbiAgICAgICAgdmFyIF9hLCBfYjtcbiAgICAgICAgaWYgKCF0aGlzLl9pc0luaXRpYWxpemVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pZFRva2VuU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRVaWQgPSAoX2IgPSAoX2EgPSB0aGlzLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EudWlkKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBudWxsO1xuICAgICAgICBpZiAodGhpcy5sYXN0Tm90aWZpZWRVaWQgIT09IGN1cnJlbnRVaWQpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdE5vdGlmaWVkVWlkID0gY3VycmVudFVpZDtcbiAgICAgICAgICAgIHRoaXMuYXV0aFN0YXRlU3Vic2NyaXB0aW9uLm5leHQodGhpcy5jdXJyZW50VXNlcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVnaXN0ZXJTdGF0ZUxpc3RlbmVyKHN1YnNjcmlwdGlvbiwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHtcbiAgICAgICAgaWYgKHRoaXMuX2RlbGV0ZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7IH07XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2IgPSB0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbidcbiAgICAgICAgICAgID8gbmV4dE9yT2JzZXJ2ZXJcbiAgICAgICAgICAgIDogbmV4dE9yT2JzZXJ2ZXIubmV4dC5iaW5kKG5leHRPck9ic2VydmVyKTtcbiAgICAgICAgbGV0IGlzVW5zdWJzY3JpYmVkID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IHByb21pc2UgPSB0aGlzLl9pc0luaXRpYWxpemVkXG4gICAgICAgICAgICA/IFByb21pc2UucmVzb2x2ZSgpXG4gICAgICAgICAgICA6IHRoaXMuX2luaXRpYWxpemF0aW9uUHJvbWlzZTtcbiAgICAgICAgX2Fzc2VydChwcm9taXNlLCB0aGlzLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIC8vIFRoZSBjYWxsYmFjayBuZWVkcyB0byBiZSBjYWxsZWQgYXN5bmNocm9ub3VzbHkgcGVyIHRoZSBzcGVjLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIHByb21pc2UudGhlbigoKSA9PiB7XG4gICAgICAgICAgICBpZiAoaXNVbnN1YnNjcmliZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYih0aGlzLmN1cnJlbnRVc2VyKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0eXBlb2YgbmV4dE9yT2JzZXJ2ZXIgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gc3Vic2NyaXB0aW9uLmFkZE9ic2VydmVyKG5leHRPck9ic2VydmVyLCBlcnJvciwgY29tcGxldGVkKTtcbiAgICAgICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaXNVbnN1YnNjcmliZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSBzdWJzY3JpcHRpb24uYWRkT2JzZXJ2ZXIobmV4dE9yT2JzZXJ2ZXIpO1xuICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgICAgICBpc1Vuc3Vic2NyaWJlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgdW5zdWJzY3JpYmUoKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogVW5wcm90ZWN0ZWQgKGZyb20gcmFjZSBjb25kaXRpb25zKSBtZXRob2QgdG8gc2V0IHRoZSBjdXJyZW50IHVzZXIuIFRoaXNcbiAgICAgKiBzaG91bGQgb25seSBiZSBjYWxsZWQgZnJvbSB3aXRoaW4gYSBxdWV1ZWQgY2FsbGJhY2suIFRoaXMgaXMgbmVjZXNzYXJ5XG4gICAgICogYmVjYXVzZSB0aGUgcXVldWUgc2hvdWxkbid0IHJlbHkgb24gYW5vdGhlciBxdWV1ZWQgY2FsbGJhY2suXG4gICAgICovXG4gICAgYXN5bmMgZGlyZWN0bHlTZXRDdXJyZW50VXNlcih1c2VyKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRVc2VyICYmIHRoaXMuY3VycmVudFVzZXIgIT09IHVzZXIpIHtcbiAgICAgICAgICAgIHRoaXMuX2N1cnJlbnRVc2VyLl9zdG9wUHJvYWN0aXZlUmVmcmVzaCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh1c2VyICYmIHRoaXMuaXNQcm9hY3RpdmVSZWZyZXNoRW5hYmxlZCkge1xuICAgICAgICAgICAgdXNlci5fc3RhcnRQcm9hY3RpdmVSZWZyZXNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2Uuc2V0Q3VycmVudFVzZXIodXNlcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLmFzc2VydGVkUGVyc2lzdGVuY2UucmVtb3ZlQ3VycmVudFVzZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBxdWV1ZShhY3Rpb24pIHtcbiAgICAgICAgLy8gSW4gY2FzZSBzb21ldGhpbmcgZXJyb3JzLCB0aGUgY2FsbGJhY2sgc3RpbGwgc2hvdWxkIGJlIGNhbGxlZCBpbiBvcmRlclxuICAgICAgICAvLyB0byBrZWVwIHRoZSBwcm9taXNlIGNoYWluIGFsaXZlXG4gICAgICAgIHRoaXMub3BlcmF0aW9ucyA9IHRoaXMub3BlcmF0aW9ucy50aGVuKGFjdGlvbiwgYWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIHRoaXMub3BlcmF0aW9ucztcbiAgICB9XG4gICAgZ2V0IGFzc2VydGVkUGVyc2lzdGVuY2UoKSB7XG4gICAgICAgIF9hc3NlcnQodGhpcy5wZXJzaXN0ZW5jZU1hbmFnZXIsIHRoaXMsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2VNYW5hZ2VyO1xuICAgIH1cbiAgICBfbG9nRnJhbWV3b3JrKGZyYW1ld29yaykge1xuICAgICAgICBpZiAoIWZyYW1ld29yayB8fCB0aGlzLmZyYW1ld29ya3MuaW5jbHVkZXMoZnJhbWV3b3JrKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZnJhbWV3b3Jrcy5wdXNoKGZyYW1ld29yayk7XG4gICAgICAgIC8vIFNvcnQgYWxwaGFiZXRpY2FsbHkgc28gdGhhdCBcIkZpcmViYXNlQ29yZS13ZWIsRmlyZWJhc2VVSS13ZWJcIiBhbmRcbiAgICAgICAgLy8gXCJGaXJlYmFzZVVJLXdlYixGaXJlYmFzZUNvcmUtd2ViXCIgYXJlbid0IHZpZXdlZCBhcyBkaWZmZXJlbnQuXG4gICAgICAgIHRoaXMuZnJhbWV3b3Jrcy5zb3J0KCk7XG4gICAgICAgIHRoaXMuY2xpZW50VmVyc2lvbiA9IF9nZXRDbGllbnRWZXJzaW9uKHRoaXMuY29uZmlnLmNsaWVudFBsYXRmb3JtLCB0aGlzLl9nZXRGcmFtZXdvcmtzKCkpO1xuICAgIH1cbiAgICBfZ2V0RnJhbWV3b3JrcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZnJhbWV3b3JrcztcbiAgICB9XG4gICAgYXN5bmMgX2dldEFkZGl0aW9uYWxIZWFkZXJzKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIC8vIEFkZGl0aW9uYWwgaGVhZGVycyBvbiBldmVyeSByZXF1ZXN0XG4gICAgICAgIGNvbnN0IGhlYWRlcnMgPSB7XG4gICAgICAgICAgICBbXCJYLUNsaWVudC1WZXJzaW9uXCIgLyogSHR0cEhlYWRlci5YX0NMSUVOVF9WRVJTSU9OICovXTogdGhpcy5jbGllbnRWZXJzaW9uXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLmFwcC5vcHRpb25zLmFwcElkKSB7XG4gICAgICAgICAgICBoZWFkZXJzW1wiWC1GaXJlYmFzZS1nbXBpZFwiIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9HTVBJRCAqL10gPSB0aGlzLmFwcC5vcHRpb25zLmFwcElkO1xuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSBoZWFydGJlYXQgc2VydmljZSBleGlzdHMsIGFkZCB0aGUgaGVhcnRiZWF0IHN0cmluZ1xuICAgICAgICBjb25zdCBoZWFydGJlYXRzSGVhZGVyID0gYXdhaXQgKChfYSA9IHRoaXMuaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyXG4gICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgICAgIG9wdGlvbmFsOiB0cnVlXG4gICAgICAgIH0pKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0SGVhcnRiZWF0c0hlYWRlcigpKTtcbiAgICAgICAgaWYgKGhlYXJ0YmVhdHNIZWFkZXIpIHtcbiAgICAgICAgICAgIGhlYWRlcnNbXCJYLUZpcmViYXNlLUNsaWVudFwiIC8qIEh0dHBIZWFkZXIuWF9GSVJFQkFTRV9DTElFTlQgKi9dID0gaGVhcnRiZWF0c0hlYWRlcjtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB0aGUgQXBwIENoZWNrIHNlcnZpY2UgZXhpc3RzLCBhZGQgdGhlIEFwcCBDaGVjayB0b2tlbiBpbiB0aGUgaGVhZGVyc1xuICAgICAgICBjb25zdCBhcHBDaGVja1Rva2VuID0gYXdhaXQgdGhpcy5fZ2V0QXBwQ2hlY2tUb2tlbigpO1xuICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgaGVhZGVyc1tcIlgtRmlyZWJhc2UtQXBwQ2hlY2tcIiAvKiBIdHRwSGVhZGVyLlhfRklSRUJBU0VfQVBQX0NIRUNLICovXSA9IGFwcENoZWNrVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGhlYWRlcnM7XG4gICAgfVxuICAgIGFzeW5jIF9nZXRBcHBDaGVja1Rva2VuKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcCh0aGlzLmFwcCkgJiYgdGhpcy5hcHAuc2V0dGluZ3MuYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXBwLnNldHRpbmdzLmFwcENoZWNrVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYXBwQ2hlY2tUb2tlblJlc3VsdCA9IGF3YWl0ICgoX2EgPSB0aGlzLmFwcENoZWNrU2VydmljZVByb3ZpZGVyXG4gICAgICAgICAgICAuZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRUb2tlbigpKTtcbiAgICAgICAgaWYgKGFwcENoZWNrVG9rZW5SZXN1bHQgPT09IG51bGwgfHwgYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwQ2hlY2tUb2tlblJlc3VsdC5lcnJvcikge1xuICAgICAgICAgICAgLy8gQ29udGV4dDogYXBwQ2hlY2suZ2V0VG9rZW4oKSB3aWxsIG5ldmVyIHRocm93IGV2ZW4gaWYgYW4gZXJyb3IgaGFwcGVuZWQuXG4gICAgICAgICAgICAvLyBJbiB0aGUgZXJyb3IgY2FzZSwgYSBkdW1teSB0b2tlbiB3aWxsIGJlIHJldHVybmVkIGFsb25nIHdpdGggYW4gZXJyb3IgZmllbGQgZGVzY3JpYmluZ1xuICAgICAgICAgICAgLy8gdGhlIGVycm9yLiBJbiBnZW5lcmFsLCB3ZSBzaG91bGRuJ3QgY2FyZSBhYm91dCB0aGUgZXJyb3IgY29uZGl0aW9uIGFuZCBqdXN0IHVzZVxuICAgICAgICAgICAgLy8gdGhlIHRva2VuIChhY3R1YWwgb3IgZHVtbXkpIHRvIHNlbmQgcmVxdWVzdHMuXG4gICAgICAgICAgICBfbG9nV2FybihgRXJyb3Igd2hpbGUgcmV0cmlldmluZyBBcHAgQ2hlY2sgdG9rZW46ICR7YXBwQ2hlY2tUb2tlblJlc3VsdC5lcnJvcn1gKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYXBwQ2hlY2tUb2tlblJlc3VsdCA9PT0gbnVsbCB8fCBhcHBDaGVja1Rva2VuUmVzdWx0ID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhcHBDaGVja1Rva2VuUmVzdWx0LnRva2VuO1xuICAgIH1cbn1cbi8qKlxuICogTWV0aG9kIHRvIGJlIHVzZWQgdG8gY2FzdCBkb3duIHRvIG91ciBwcml2YXRlIGltcGxlbWVudGF0aW9uIG9mIEF1dGguXG4gKiBJdCB3aWxsIGFsc28gaGFuZGxlIHVud3JhcHBpbmcgZnJvbSB0aGUgY29tcGF0IHR5cGUgaWYgbmVjZXNzYXJ5XG4gKlxuICogQHBhcmFtIGF1dGggQXV0aCBvYmplY3QgcGFzc2VkIGluIGZyb20gZGV2ZWxvcGVyXG4gKi9cbmZ1bmN0aW9uIF9jYXN0QXV0aChhdXRoKSB7XG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKTtcbn1cbi8qKiBIZWxwZXIgY2xhc3MgdG8gd3JhcCBzdWJzY3JpYmVyIGxvZ2ljICovXG5jbGFzcyBTdWJzY3JpcHRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGF1dGgpIHtcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IG51bGw7XG4gICAgICAgIHRoaXMuYWRkT2JzZXJ2ZXIgPSBjcmVhdGVTdWJzY3JpYmUob2JzZXJ2ZXIgPT4gKHRoaXMub2JzZXJ2ZXIgPSBvYnNlcnZlcikpO1xuICAgIH1cbiAgICBnZXQgbmV4dCgpIHtcbiAgICAgICAgX2Fzc2VydCh0aGlzLm9ic2VydmVyLCB0aGlzLmF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgcmV0dXJuIHRoaXMub2JzZXJ2ZXIubmV4dC5iaW5kKHRoaXMub2JzZXJ2ZXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBleHRlcm5hbEpTUHJvdmlkZXIgPSB7XG4gICAgYXN5bmMgbG9hZEpTKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byBsb2FkIGV4dGVybmFsIHNjcmlwdHMnKTtcbiAgICB9LFxuICAgIHJlY2FwdGNoYVYyU2NyaXB0OiAnJyxcbiAgICByZWNhcHRjaGFFbnRlcnByaXNlU2NyaXB0OiAnJyxcbiAgICBnYXBpU2NyaXB0OiAnJ1xufTtcbmZ1bmN0aW9uIF9zZXRFeHRlcm5hbEpTUHJvdmlkZXIocCkge1xuICAgIGV4dGVybmFsSlNQcm92aWRlciA9IHA7XG59XG5mdW5jdGlvbiBfbG9hZEpTKHVybCkge1xuICAgIHJldHVybiBleHRlcm5hbEpTUHJvdmlkZXIubG9hZEpTKHVybCk7XG59XG5mdW5jdGlvbiBfcmVjYXB0Y2hhVjJTY3JpcHRVcmwoKSB7XG4gICAgcmV0dXJuIGV4dGVybmFsSlNQcm92aWRlci5yZWNhcHRjaGFWMlNjcmlwdDtcbn1cbmZ1bmN0aW9uIF9yZWNhcHRjaGFFbnRlcnByaXNlU2NyaXB0VXJsKCkge1xuICAgIHJldHVybiBleHRlcm5hbEpTUHJvdmlkZXIucmVjYXB0Y2hhRW50ZXJwcmlzZVNjcmlwdDtcbn1cbmZ1bmN0aW9uIF9nYXBpU2NyaXB0VXJsKCkge1xuICAgIHJldHVybiBleHRlcm5hbEpTUHJvdmlkZXIuZ2FwaVNjcmlwdDtcbn1cbmZ1bmN0aW9uIF9nZW5lcmF0ZUNhbGxiYWNrTmFtZShwcmVmaXgpIHtcbiAgICByZXR1cm4gYF9fJHtwcmVmaXh9JHtNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKX1gO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgX1NPTFZFX1RJTUVfTVMgPSA1MDA7XG5jb25zdCBfRVhQSVJBVElPTl9USU1FX01TID0gNjAwMDA7XG5jb25zdCBfV0lER0VUX0lEX1NUQVJUID0gMTAwMDAwMDAwMDAwMDtcbmNsYXNzIE1vY2tSZUNhcHRjaGEge1xuICAgIGNvbnN0cnVjdG9yKGF1dGgpIHtcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcbiAgICAgICAgdGhpcy5jb3VudGVyID0gX1dJREdFVF9JRF9TVEFSVDtcbiAgICAgICAgdGhpcy5fd2lkZ2V0cyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgcmVuZGVyKGNvbnRhaW5lciwgcGFyYW1ldGVycykge1xuICAgICAgICBjb25zdCBpZCA9IHRoaXMuY291bnRlcjtcbiAgICAgICAgdGhpcy5fd2lkZ2V0cy5zZXQoaWQsIG5ldyBNb2NrV2lkZ2V0KGNvbnRhaW5lciwgdGhpcy5hdXRoLm5hbWUsIHBhcmFtZXRlcnMgfHwge30pKTtcbiAgICAgICAgdGhpcy5jb3VudGVyKys7XG4gICAgICAgIHJldHVybiBpZDtcbiAgICB9XG4gICAgcmVzZXQob3B0V2lkZ2V0SWQpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBjb25zdCBpZCA9IG9wdFdpZGdldElkIHx8IF9XSURHRVRfSURfU1RBUlQ7XG4gICAgICAgIHZvaWQgKChfYSA9IHRoaXMuX3dpZGdldHMuZ2V0KGlkKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmRlbGV0ZSgpKTtcbiAgICAgICAgdGhpcy5fd2lkZ2V0cy5kZWxldGUoaWQpO1xuICAgIH1cbiAgICBnZXRSZXNwb25zZShvcHRXaWRnZXRJZCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGlkID0gb3B0V2lkZ2V0SWQgfHwgX1dJREdFVF9JRF9TVEFSVDtcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLl93aWRnZXRzLmdldChpZCkpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5nZXRSZXNwb25zZSgpKSB8fCAnJztcbiAgICB9XG4gICAgYXN5bmMgZXhlY3V0ZShvcHRXaWRnZXRJZCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIGNvbnN0IGlkID0gb3B0V2lkZ2V0SWQgfHwgX1dJREdFVF9JRF9TVEFSVDtcbiAgICAgICAgdm9pZCAoKF9hID0gdGhpcy5fd2lkZ2V0cy5nZXQoaWQpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZXhlY3V0ZSgpKTtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbn1cbmNsYXNzIE1vY2tHcmVDQVBUQ0hBVG9wTGV2ZWwge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmVudGVycHJpc2UgPSBuZXcgTW9ja0dyZUNBUFRDSEEoKTtcbiAgICB9XG4gICAgcmVhZHkoY2FsbGJhY2spIHtcbiAgICAgICAgY2FsbGJhY2soKTtcbiAgICB9XG4gICAgZXhlY3V0ZShcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgX3NpdGVLZXksIF9vcHRpb25zKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoJ3Rva2VuJyk7XG4gICAgfVxuICAgIHJlbmRlcihcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzXG4gICAgX2NvbnRhaW5lciwgX3BhcmFtZXRlcnMpIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbn1cbmNsYXNzIE1vY2tHcmVDQVBUQ0hBIHtcbiAgICByZWFkeShjYWxsYmFjaykge1xuICAgICAgICBjYWxsYmFjaygpO1xuICAgIH1cbiAgICBleGVjdXRlKFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBfc2l0ZUtleSwgX29wdGlvbnMpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgndG9rZW4nKTtcbiAgICB9XG4gICAgcmVuZGVyKFxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnNcbiAgICBfY29udGFpbmVyLCBfcGFyYW1ldGVycykge1xuICAgICAgICByZXR1cm4gJyc7XG4gICAgfVxufVxuY2xhc3MgTW9ja1dpZGdldCB7XG4gICAgY29uc3RydWN0b3IoY29udGFpbmVyT3JJZCwgYXBwTmFtZSwgcGFyYW1zKSB7XG4gICAgICAgIHRoaXMucGFyYW1zID0gcGFyYW1zO1xuICAgICAgICB0aGlzLnRpbWVySWQgPSBudWxsO1xuICAgICAgICB0aGlzLmRlbGV0ZWQgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZXNwb25zZVRva2VuID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbGlja0hhbmRsZXIgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gdHlwZW9mIGNvbnRhaW5lck9ySWQgPT09ICdzdHJpbmcnXG4gICAgICAgICAgICA/IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGNvbnRhaW5lck9ySWQpXG4gICAgICAgICAgICA6IGNvbnRhaW5lck9ySWQ7XG4gICAgICAgIF9hc3NlcnQoY29udGFpbmVyLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLywgeyBhcHBOYW1lIH0pO1xuICAgICAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcbiAgICAgICAgdGhpcy5pc1Zpc2libGUgPSB0aGlzLnBhcmFtcy5zaXplICE9PSAnaW52aXNpYmxlJztcbiAgICAgICAgaWYgKHRoaXMuaXNWaXNpYmxlKSB7XG4gICAgICAgICAgICB0aGlzLmV4ZWN1dGUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5jbGlja0hhbmRsZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldFJlc3BvbnNlKCkge1xuICAgICAgICB0aGlzLmNoZWNrSWZEZWxldGVkKCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJlc3BvbnNlVG9rZW47XG4gICAgfVxuICAgIGRlbGV0ZSgpIHtcbiAgICAgICAgdGhpcy5jaGVja0lmRGVsZXRlZCgpO1xuICAgICAgICB0aGlzLmRlbGV0ZWQgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy50aW1lcklkKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy50aW1lcklkKTtcbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmNsaWNrSGFuZGxlcik7XG4gICAgfVxuICAgIGV4ZWN1dGUoKSB7XG4gICAgICAgIHRoaXMuY2hlY2tJZkRlbGV0ZWQoKTtcbiAgICAgICAgaWYgKHRoaXMudGltZXJJZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVzcG9uc2VUb2tlbiA9IGdlbmVyYXRlUmFuZG9tQWxwaGFOdW1lcmljU3RyaW5nKDUwKTtcbiAgICAgICAgICAgIGNvbnN0IHsgY2FsbGJhY2ssICdleHBpcmVkLWNhbGxiYWNrJzogZXhwaXJlZENhbGxiYWNrIH0gPSB0aGlzLnBhcmFtcztcbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKHRoaXMucmVzcG9uc2VUb2tlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnRpbWVySWQgPSBudWxsO1xuICAgICAgICAgICAgICAgIHRoaXMucmVzcG9uc2VUb2tlbiA9IG51bGw7XG4gICAgICAgICAgICAgICAgaWYgKGV4cGlyZWRDYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlZENhbGxiYWNrKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHsgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1Zpc2libGUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5leGVjdXRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgX0VYUElSQVRJT05fVElNRV9NUyk7XG4gICAgICAgIH0sIF9TT0xWRV9USU1FX01TKTtcbiAgICB9XG4gICAgY2hlY2tJZkRlbGV0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLmRlbGV0ZWQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigncmVDQVBUQ0hBIG1vY2sgd2FzIGFscmVhZHkgZGVsZXRlZCEnKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGdlbmVyYXRlUmFuZG9tQWxwaGFOdW1lcmljU3RyaW5nKGxlbikge1xuICAgIGNvbnN0IGNoYXJzID0gW107XG4gICAgY29uc3QgYWxsb3dlZENoYXJzID0gJzEyMzQ1Njc4OTBhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5ekFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaJztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICAgIGNoYXJzLnB1c2goYWxsb3dlZENoYXJzLmNoYXJBdChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhbGxvd2VkQ2hhcnMubGVuZ3RoKSkpO1xuICAgIH1cbiAgICByZXR1cm4gY2hhcnMuam9pbignJyk7XG59XG5cbi8qIGVzbGludC1kaXNhYmxlIEB0eXBlc2NyaXB0LWVzbGludC9uby1yZXF1aXJlLWltcG9ydHMgKi9cbmNvbnN0IFJFQ0FQVENIQV9FTlRFUlBSSVNFX1ZFUklGSUVSX1RZUEUgPSAncmVjYXB0Y2hhLWVudGVycHJpc2UnO1xuY29uc3QgRkFLRV9UT0tFTiA9ICdOT19SRUNBUFRDSEEnO1xuY2xhc3MgUmVjYXB0Y2hhRW50ZXJwcmlzZVZlcmlmaWVyIHtcbiAgICAvKipcbiAgICAgKlxuICAgICAqIEBwYXJhbSBhdXRoRXh0ZXJuIC0gVGhlIGNvcnJlc3BvbmRpbmcgRmlyZWJhc2Uge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICAgICAqXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYXV0aEV4dGVybikge1xuICAgICAgICAvKipcbiAgICAgICAgICogSWRlbnRpZmllcyB0aGUgdHlwZSBvZiBhcHBsaWNhdGlvbiB2ZXJpZmllciAoZS5nLiBcInJlY2FwdGNoYS1lbnRlcnByaXNlXCIpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gUkVDQVBUQ0hBX0VOVEVSUFJJU0VfVkVSSUZJRVJfVFlQRTtcbiAgICAgICAgdGhpcy5hdXRoID0gX2Nhc3RBdXRoKGF1dGhFeHRlcm4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlcyB0aGUgdmVyaWZpY2F0aW9uIHByb2Nlc3MuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBBIFByb21pc2UgZm9yIGEgdG9rZW4gdGhhdCBjYW4gYmUgdXNlZCB0byBhc3NlcnQgdGhlIHZhbGlkaXR5IG9mIGEgcmVxdWVzdC5cbiAgICAgKi9cbiAgICBhc3luYyB2ZXJpZnkoYWN0aW9uID0gJ3ZlcmlmeScsIGZvcmNlUmVmcmVzaCA9IGZhbHNlKSB7XG4gICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJldHJpZXZlU2l0ZUtleShhdXRoKSB7XG4gICAgICAgICAgICBpZiAoIWZvcmNlUmVmcmVzaCkge1xuICAgICAgICAgICAgICAgIGlmIChhdXRoLnRlbmFudElkID09IG51bGwgJiYgYXV0aC5fYWdlbnRSZWNhcHRjaGFDb25maWcgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYXV0aC5fYWdlbnRSZWNhcHRjaGFDb25maWcuc2l0ZUtleTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGF1dGgudGVuYW50SWQgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgICAgICBhdXRoLl90ZW5hbnRSZWNhcHRjaGFDb25maWdzW2F1dGgudGVuYW50SWRdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGF1dGguX3RlbmFudFJlY2FwdGNoYUNvbmZpZ3NbYXV0aC50ZW5hbnRJZF0uc2l0ZUtleTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIGdldFJlY2FwdGNoYUNvbmZpZyhhdXRoLCB7XG4gICAgICAgICAgICAgICAgICAgIGNsaWVudFR5cGU6IFwiQ0xJRU5UX1RZUEVfV0VCXCIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sXG4gICAgICAgICAgICAgICAgICAgIHZlcnNpb246IFwiUkVDQVBUQ0hBX0VOVEVSUFJJU0VcIiAvKiBSZWNhcHRjaGFWZXJzaW9uLkVOVEVSUFJJU0UgKi9cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5yZWNhcHRjaGFLZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG5ldyBFcnJvcigncmVjYXB0Y2hhIEVudGVycHJpc2Ugc2l0ZSBrZXkgdW5kZWZpbmVkJykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29uZmlnID0gbmV3IFJlY2FwdGNoYUNvbmZpZyhyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXV0aC50ZW5hbnRJZCA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYXV0aC5fYWdlbnRSZWNhcHRjaGFDb25maWcgPSBjb25maWc7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhdXRoLl90ZW5hbnRSZWNhcHRjaGFDb25maWdzW2F1dGgudGVuYW50SWRdID0gY29uZmlnO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoY29uZmlnLnNpdGVLZXkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIHJldHJpZXZlUmVjYXB0Y2hhVG9rZW4oc2l0ZUtleSwgcmVzb2x2ZSwgcmVqZWN0KSB7XG4gICAgICAgICAgICBjb25zdCBncmVjYXB0Y2hhID0gd2luZG93LmdyZWNhcHRjaGE7XG4gICAgICAgICAgICBpZiAoaXNFbnRlcnByaXNlKGdyZWNhcHRjaGEpKSB7XG4gICAgICAgICAgICAgICAgZ3JlY2FwdGNoYS5lbnRlcnByaXNlLnJlYWR5KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZ3JlY2FwdGNoYS5lbnRlcnByaXNlXG4gICAgICAgICAgICAgICAgICAgICAgICAuZXhlY3V0ZShzaXRlS2V5LCB7IGFjdGlvbiB9KVxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4odG9rZW4gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSh0b2tlbik7XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICAuY2F0Y2goKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShGQUtFX1RPS0VOKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZWplY3QoRXJyb3IoJ05vIHJlQ0FQVENIQSBlbnRlcnByaXNlIHNjcmlwdCBsb2FkZWQuJykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIFJldHVybnMgUHJvbWlzZSBmb3IgYSBtb2NrIHRva2VuIHdoZW4gYXBwVmVyaWZpY2F0aW9uRGlzYWJsZWRGb3JUZXN0aW5nIGlzIHRydWUuXG4gICAgICAgIGlmICh0aGlzLmF1dGguc2V0dGluZ3MuYXBwVmVyaWZpY2F0aW9uRGlzYWJsZWRGb3JUZXN0aW5nKSB7XG4gICAgICAgICAgICBjb25zdCBtb2NrUmVjYXB0Y2hhID0gbmV3IE1vY2tHcmVDQVBUQ0hBVG9wTGV2ZWwoKTtcbiAgICAgICAgICAgIHJldHVybiBtb2NrUmVjYXB0Y2hhLmV4ZWN1dGUoJ3NpdGVLZXknLCB7IGFjdGlvbjogJ3ZlcmlmeScgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgICAgICAgIHJldHJpZXZlU2l0ZUtleSh0aGlzLmF1dGgpXG4gICAgICAgICAgICAgICAgLnRoZW4oc2l0ZUtleSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCFmb3JjZVJlZnJlc2ggJiYgaXNFbnRlcnByaXNlKHdpbmRvdy5ncmVjYXB0Y2hhKSkge1xuICAgICAgICAgICAgICAgICAgICByZXRyaWV2ZVJlY2FwdGNoYVRva2VuKHNpdGVLZXksIHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoJ1JlY2FwdGNoYVZlcmlmaWVyIGlzIG9ubHkgc3VwcG9ydGVkIGluIGJyb3dzZXInKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgbGV0IHVybCA9IF9yZWNhcHRjaGFFbnRlcnByaXNlU2NyaXB0VXJsKCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1cmwubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB1cmwgKz0gc2l0ZUtleTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBfbG9hZEpTKHVybClcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHJpZXZlUmVjYXB0Y2hhVG9rZW4oc2l0ZUtleSwgcmVzb2x2ZSwgcmVqZWN0KTtcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG59XG5hc3luYyBmdW5jdGlvbiBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aCwgcmVxdWVzdCwgYWN0aW9uLCBpc0NhcHRjaGFSZXNwID0gZmFsc2UsIGlzRmFrZVRva2VuID0gZmFsc2UpIHtcbiAgICBjb25zdCB2ZXJpZmllciA9IG5ldyBSZWNhcHRjaGFFbnRlcnByaXNlVmVyaWZpZXIoYXV0aCk7XG4gICAgbGV0IGNhcHRjaGFSZXNwb25zZTtcbiAgICBpZiAoaXNGYWtlVG9rZW4pIHtcbiAgICAgICAgY2FwdGNoYVJlc3BvbnNlID0gRkFLRV9UT0tFTjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjYXB0Y2hhUmVzcG9uc2UgPSBhd2FpdCB2ZXJpZmllci52ZXJpZnkoYWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNhcHRjaGFSZXNwb25zZSA9IGF3YWl0IHZlcmlmaWVyLnZlcmlmeShhY3Rpb24sIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG5ld1JlcXVlc3QgPSBPYmplY3QuYXNzaWduKHt9LCByZXF1ZXN0KTtcbiAgICBpZiAoYWN0aW9uID09PSBcIm1mYVNtc0Vucm9sbG1lbnRcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLk1GQV9TTVNfRU5ST0xMTUVOVCAqLyB8fFxuICAgICAgICBhY3Rpb24gPT09IFwibWZhU21zU2lnbkluXCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5NRkFfU01TX1NJR05JTiAqLykge1xuICAgICAgICBpZiAoJ3Bob25lRW5yb2xsbWVudEluZm8nIGluIG5ld1JlcXVlc3QpIHtcbiAgICAgICAgICAgIGNvbnN0IHBob25lTnVtYmVyID0gbmV3UmVxdWVzdC5waG9uZUVucm9sbG1lbnRJbmZvLnBob25lTnVtYmVyO1xuICAgICAgICAgICAgY29uc3QgcmVjYXB0Y2hhVG9rZW4gPSBuZXdSZXF1ZXN0LnBob25lRW5yb2xsbWVudEluZm8ucmVjYXB0Y2hhVG9rZW47XG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAncGhvbmVFbnJvbGxtZW50SW5mbyc6IHtcbiAgICAgICAgICAgICAgICAgICAgcGhvbmVOdW1iZXIsXG4gICAgICAgICAgICAgICAgICAgIHJlY2FwdGNoYVRva2VuLFxuICAgICAgICAgICAgICAgICAgICBjYXB0Y2hhUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgICdjbGllbnRUeXBlJzogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLyxcbiAgICAgICAgICAgICAgICAgICAgJ3JlY2FwdGNoYVZlcnNpb24nOiBcIlJFQ0FQVENIQV9FTlRFUlBSSVNFXCIgLyogUmVjYXB0Y2hhVmVyc2lvbi5FTlRFUlBSSVNFICovXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoJ3Bob25lU2lnbkluSW5mbycgaW4gbmV3UmVxdWVzdCkge1xuICAgICAgICAgICAgY29uc3QgcmVjYXB0Y2hhVG9rZW4gPSBuZXdSZXF1ZXN0LnBob25lU2lnbkluSW5mby5yZWNhcHRjaGFUb2tlbjtcbiAgICAgICAgICAgIE9iamVjdC5hc3NpZ24obmV3UmVxdWVzdCwge1xuICAgICAgICAgICAgICAgICdwaG9uZVNpZ25JbkluZm8nOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlY2FwdGNoYVRva2VuLFxuICAgICAgICAgICAgICAgICAgICBjYXB0Y2hhUmVzcG9uc2UsXG4gICAgICAgICAgICAgICAgICAgICdjbGllbnRUeXBlJzogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLyxcbiAgICAgICAgICAgICAgICAgICAgJ3JlY2FwdGNoYVZlcnNpb24nOiBcIlJFQ0FQVENIQV9FTlRFUlBSSVNFXCIgLyogUmVjYXB0Y2hhVmVyc2lvbi5FTlRFUlBSSVNFICovXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ld1JlcXVlc3Q7XG4gICAgfVxuICAgIGlmICghaXNDYXB0Y2hhUmVzcCkge1xuICAgICAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHsgY2FwdGNoYVJlc3BvbnNlIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgT2JqZWN0LmFzc2lnbihuZXdSZXF1ZXN0LCB7ICdjYXB0Y2hhUmVzcCc6IGNhcHRjaGFSZXNwb25zZSB9KTtcbiAgICB9XG4gICAgT2JqZWN0LmFzc2lnbihuZXdSZXF1ZXN0LCB7ICdjbGllbnRUeXBlJzogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqLyB9KTtcbiAgICBPYmplY3QuYXNzaWduKG5ld1JlcXVlc3QsIHtcbiAgICAgICAgJ3JlY2FwdGNoYVZlcnNpb24nOiBcIlJFQ0FQVENIQV9FTlRFUlBSSVNFXCIgLyogUmVjYXB0Y2hhVmVyc2lvbi5FTlRFUlBSSVNFICovXG4gICAgfSk7XG4gICAgcmV0dXJuIG5ld1JlcXVlc3Q7XG59XG5hc3luYyBmdW5jdGlvbiBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGhJbnN0YW5jZSwgcmVxdWVzdCwgYWN0aW9uTmFtZSwgYWN0aW9uTWV0aG9kLCByZWNhcHRjaGFBdXRoUHJvdmlkZXIpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmIChyZWNhcHRjaGFBdXRoUHJvdmlkZXIgPT09IFwiRU1BSUxfUEFTU1dPUkRfUFJPVklERVJcIiAvKiBSZWNhcHRjaGFBdXRoUHJvdmlkZXIuRU1BSUxfUEFTU1dPUkRfUFJPVklERVIgKi8pIHtcbiAgICAgICAgaWYgKChfYSA9IGF1dGhJbnN0YW5jZVxuICAgICAgICAgICAgLl9nZXRSZWNhcHRjaGFDb25maWcoKSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzUHJvdmlkZXJFbmFibGVkKFwiRU1BSUxfUEFTU1dPUkRfUFJPVklERVJcIiAvKiBSZWNhcHRjaGFBdXRoUHJvdmlkZXIuRU1BSUxfUEFTU1dPUkRfUFJPVklERVIgKi8pKSB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0V2l0aFJlY2FwdGNoYSA9IGF3YWl0IGluamVjdFJlY2FwdGNoYUZpZWxkcyhhdXRoSW5zdGFuY2UsIHJlcXVlc3QsIGFjdGlvbk5hbWUsIGFjdGlvbk5hbWUgPT09IFwiZ2V0T29iQ29kZVwiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuR0VUX09PQl9DT0RFICovKTtcbiAgICAgICAgICAgIHJldHVybiBhY3Rpb25NZXRob2QoYXV0aEluc3RhbmNlLCByZXF1ZXN0V2l0aFJlY2FwdGNoYSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aW9uTWV0aG9kKGF1dGhJbnN0YW5jZSwgcmVxdWVzdCkuY2F0Y2goYXN5bmMgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGBhdXRoLyR7XCJtaXNzaW5nLXJlY2FwdGNoYS10b2tlblwiIC8qIEF1dGhFcnJvckNvZGUuTUlTU0lOR19SRUNBUFRDSEFfVE9LRU4gKi99YCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgJHthY3Rpb25OYW1lfSBpcyBwcm90ZWN0ZWQgYnkgcmVDQVBUQ0hBIEVudGVycHJpc2UgZm9yIHRoaXMgcHJvamVjdC4gQXV0b21hdGljYWxseSB0cmlnZ2VyaW5nIHRoZSByZUNBUFRDSEEgZmxvdyBhbmQgcmVzdGFydGluZyB0aGUgZmxvdy5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGEgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aEluc3RhbmNlLCByZXF1ZXN0LCBhY3Rpb25OYW1lLCBhY3Rpb25OYW1lID09PSBcImdldE9vYkNvZGVcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLkdFVF9PT0JfQ09ERSAqLyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25NZXRob2QoYXV0aEluc3RhbmNlLCByZXF1ZXN0V2l0aFJlY2FwdGNoYSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoZXJyb3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHJlY2FwdGNoYUF1dGhQcm92aWRlciA9PT0gXCJQSE9ORV9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYUF1dGhQcm92aWRlci5QSE9ORV9QUk9WSURFUiAqLykge1xuICAgICAgICBpZiAoKF9iID0gYXV0aEluc3RhbmNlXG4gICAgICAgICAgICAuX2dldFJlY2FwdGNoYUNvbmZpZygpKSA9PT0gbnVsbCB8fCBfYiA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2IuaXNQcm92aWRlckVuYWJsZWQoXCJQSE9ORV9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYUF1dGhQcm92aWRlci5QSE9ORV9QUk9WSURFUiAqLykpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcXVlc3RXaXRoUmVjYXB0Y2hhID0gYXdhaXQgaW5qZWN0UmVjYXB0Y2hhRmllbGRzKGF1dGhJbnN0YW5jZSwgcmVxdWVzdCwgYWN0aW9uTmFtZSk7XG4gICAgICAgICAgICByZXR1cm4gYWN0aW9uTWV0aG9kKGF1dGhJbnN0YW5jZSwgcmVxdWVzdFdpdGhSZWNhcHRjaGEpLmNhdGNoKGFzeW5jIChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHZhciBfYTtcbiAgICAgICAgICAgICAgICBpZiAoKChfYSA9IGF1dGhJbnN0YW5jZVxuICAgICAgICAgICAgICAgICAgICAuX2dldFJlY2FwdGNoYUNvbmZpZygpKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0UHJvdmlkZXJFbmZvcmNlbWVudFN0YXRlKFwiUEhPTkVfUFJPVklERVJcIiAvKiBSZWNhcHRjaGFBdXRoUHJvdmlkZXIuUEhPTkVfUFJPVklERVIgKi8pKSA9PT0gXCJBVURJVFwiIC8qIEVuZm9yY2VtZW50U3RhdGUuQVVESVQgKi8pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQVVESVQgbW9kZVxuICAgICAgICAgICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gYGF1dGgvJHtcIm1pc3NpbmctcmVjYXB0Y2hhLXRva2VuXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX1JFQ0FQVENIQV9UT0tFTiAqL31gIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICBlcnJvci5jb2RlID09PSBgYXV0aC8ke1wiaW52YWxpZC1hcHAtY3JlZGVudGlhbFwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9BUFBfQ1JFREVOVElBTCAqL31gKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgRmFpbGVkIHRvIHZlcmlmeSB3aXRoIHJlQ0FQVENIQSBFbnRlcnByaXNlLiBBdXRvbWF0aWNhbGx5IHRyaWdnZXJpbmcgdGhlIHJlQ0FQVENIQSB2MiBmbG93IHRvIGNvbXBsZXRlIHRoZSAke2FjdGlvbk5hbWV9IGZsb3cuYCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZUNBUFRDSEEgRW50ZXJwcmlzZSB0b2tlbiBpcyBtaXNzaW5nIG9yIHJlQ0FQVENIQSBFbnRlcnByaXNlIHRva2VuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjaGVjayBmYWlscy5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZhbGxiYWNrIHRvIHJlQ0FQVENIQSB2MiBmbG93LlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVxdWVzdFdpdGhSZWNhcHRjaGFGaWVsZHMgPSBhd2FpdCBpbmplY3RSZWNhcHRjaGFGaWVsZHMoYXV0aEluc3RhbmNlLCByZXF1ZXN0LCBhY3Rpb25OYW1lLCBmYWxzZSwgLy8gaXNDYXB0Y2hhUmVzcFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJ1ZSAvLyBpc0Zha2VUb2tlblxuICAgICAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRoaXMgd2lsbCBjYWxsIHRoZSBQaG9uZUFwaUNhbGxlciB0byBmZXRjaCBhbmQgaW5qZWN0IHJlQ0FQVENIQSB2MiB0b2tlbi5cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb25NZXRob2QoYXV0aEluc3RhbmNlLCByZXF1ZXN0V2l0aFJlY2FwdGNoYUZpZWxkcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gRU5GT1JDRSBtb2RlIG9yIEFVRElUIG1vZGUgd2l0aCBhbnkgb3RoZXIgZXJyb3IuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gRG8gcmVDQVBUQ0hBIHYyIGZsb3cuXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0V2l0aFJlY2FwdGNoYUZpZWxkcyA9IGF3YWl0IGluamVjdFJlY2FwdGNoYUZpZWxkcyhhdXRoSW5zdGFuY2UsIHJlcXVlc3QsIGFjdGlvbk5hbWUsIGZhbHNlLCAvLyBpc0NhcHRjaGFSZXNwXG4gICAgICAgICAgICB0cnVlIC8vIGlzRmFrZVRva2VuXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgLy8gVGhpcyB3aWxsIGNhbGwgdGhlIFBob25lQXBpQ2FsbGVyIHRvIGZldGNoIGFuZCBpbmplY3QgdjIgdG9rZW4uXG4gICAgICAgICAgICByZXR1cm4gYWN0aW9uTWV0aG9kKGF1dGhJbnN0YW5jZSwgcmVxdWVzdFdpdGhSZWNhcHRjaGFGaWVsZHMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QocmVjYXB0Y2hhQXV0aFByb3ZpZGVyICsgJyBwcm92aWRlciBpcyBub3Qgc3VwcG9ydGVkLicpO1xuICAgIH1cbn1cbmFzeW5jIGZ1bmN0aW9uIF9pbml0aWFsaXplUmVjYXB0Y2hhQ29uZmlnKGF1dGgpIHtcbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBnZXRSZWNhcHRjaGFDb25maWcoYXV0aEludGVybmFsLCB7XG4gICAgICAgIGNsaWVudFR5cGU6IFwiQ0xJRU5UX1RZUEVfV0VCXCIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi8sXG4gICAgICAgIHZlcnNpb246IFwiUkVDQVBUQ0hBX0VOVEVSUFJJU0VcIiAvKiBSZWNhcHRjaGFWZXJzaW9uLkVOVEVSUFJJU0UgKi9cbiAgICB9KTtcbiAgICBjb25zdCBjb25maWcgPSBuZXcgUmVjYXB0Y2hhQ29uZmlnKHJlc3BvbnNlKTtcbiAgICBpZiAoYXV0aEludGVybmFsLnRlbmFudElkID09IG51bGwpIHtcbiAgICAgICAgYXV0aEludGVybmFsLl9hZ2VudFJlY2FwdGNoYUNvbmZpZyA9IGNvbmZpZztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGF1dGhJbnRlcm5hbC5fdGVuYW50UmVjYXB0Y2hhQ29uZmlnc1thdXRoSW50ZXJuYWwudGVuYW50SWRdID0gY29uZmlnO1xuICAgIH1cbiAgICBpZiAoY29uZmlnLmlzQW55UHJvdmlkZXJFbmFibGVkKCkpIHtcbiAgICAgICAgY29uc3QgdmVyaWZpZXIgPSBuZXcgUmVjYXB0Y2hhRW50ZXJwcmlzZVZlcmlmaWVyKGF1dGhJbnRlcm5hbCk7XG4gICAgICAgIHZvaWQgdmVyaWZpZXIudmVyaWZ5KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbml0aWFsaXplcyBhbiB7QGxpbmsgQXV0aH0gaW5zdGFuY2Ugd2l0aCBmaW5lLWdyYWluZWQgY29udHJvbCBvdmVyXG4gKiB7QGxpbmsgRGVwZW5kZW5jaWVzfS5cbiAqXG4gKiBAcmVtYXJrc1xuICpcbiAqIFRoaXMgZnVuY3Rpb24gYWxsb3dzIG1vcmUgY29udHJvbCBvdmVyIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdGhhblxuICoge0BsaW5rIGdldEF1dGh9LiBgZ2V0QXV0aGAgdXNlcyBwbGF0Zm9ybS1zcGVjaWZpYyBkZWZhdWx0cyB0byBzdXBwbHlcbiAqIHRoZSB7QGxpbmsgRGVwZW5kZW5jaWVzfS4gSW4gZ2VuZXJhbCwgYGdldEF1dGhgIGlzIHRoZSBlYXNpZXN0IHdheSB0b1xuICogaW5pdGlhbGl6ZSBBdXRoIGFuZCB3b3JrcyBmb3IgbW9zdCB1c2UgY2FzZXMuIFVzZSBgaW5pdGlhbGl6ZUF1dGhgIGlmIHlvdVxuICogbmVlZCBjb250cm9sIG92ZXIgd2hpY2ggcGVyc2lzdGVuY2UgbGF5ZXIgaXMgdXNlZCwgb3IgdG8gbWluaW1pemUgYnVuZGxlXG4gKiBzaXplIGlmIHlvdSdyZSBub3QgdXNpbmcgZWl0aGVyIGBzaWduSW5XaXRoUG9wdXBgIG9yIGBzaWduSW5XaXRoUmVkaXJlY3RgLlxuICpcbiAqIEZvciBleGFtcGxlLCBpZiB5b3VyIGFwcCBvbmx5IHVzZXMgYW5vbnltb3VzIGFjY291bnRzIGFuZCB5b3Ugb25seSB3YW50XG4gKiBhY2NvdW50cyBzYXZlZCBmb3IgdGhlIGN1cnJlbnQgc2Vzc2lvbiwgaW5pdGlhbGl6ZSBgQXV0aGAgd2l0aDpcbiAqXG4gKiBgYGBqc1xuICogY29uc3QgYXV0aCA9IGluaXRpYWxpemVBdXRoKGFwcCwge1xuICogICBwZXJzaXN0ZW5jZTogYnJvd3NlclNlc3Npb25QZXJzaXN0ZW5jZSxcbiAqICAgcG9wdXBSZWRpcmVjdFJlc29sdmVyOiB1bmRlZmluZWQsXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gaW5pdGlhbGl6ZUF1dGgoYXBwLCBkZXBzKSB7XG4gICAgY29uc3QgcHJvdmlkZXIgPSBfZ2V0UHJvdmlkZXIoYXBwLCAnYXV0aCcpO1xuICAgIGlmIChwcm92aWRlci5pc0luaXRpYWxpemVkKCkpIHtcbiAgICAgICAgY29uc3QgYXV0aCA9IHByb3ZpZGVyLmdldEltbWVkaWF0ZSgpO1xuICAgICAgICBjb25zdCBpbml0aWFsT3B0aW9ucyA9IHByb3ZpZGVyLmdldE9wdGlvbnMoKTtcbiAgICAgICAgaWYgKGRlZXBFcXVhbChpbml0aWFsT3B0aW9ucywgZGVwcyAhPT0gbnVsbCAmJiBkZXBzICE9PSB2b2lkIDAgPyBkZXBzIDoge30pKSB7XG4gICAgICAgICAgICByZXR1cm4gYXV0aDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiYWxyZWFkeS1pbml0aWFsaXplZFwiIC8qIEF1dGhFcnJvckNvZGUuQUxSRUFEWV9JTklUSUFMSVpFRCAqLyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgYXV0aCA9IHByb3ZpZGVyLmluaXRpYWxpemUoeyBvcHRpb25zOiBkZXBzIH0pO1xuICAgIHJldHVybiBhdXRoO1xufVxuZnVuY3Rpb24gX2luaXRpYWxpemVBdXRoSW5zdGFuY2UoYXV0aCwgZGVwcykge1xuICAgIGNvbnN0IHBlcnNpc3RlbmNlID0gKGRlcHMgPT09IG51bGwgfHwgZGVwcyA9PT0gdm9pZCAwID8gdm9pZCAwIDogZGVwcy5wZXJzaXN0ZW5jZSkgfHwgW107XG4gICAgY29uc3QgaGllcmFyY2h5ID0gKEFycmF5LmlzQXJyYXkocGVyc2lzdGVuY2UpID8gcGVyc2lzdGVuY2UgOiBbcGVyc2lzdGVuY2VdKS5tYXAoX2dldEluc3RhbmNlKTtcbiAgICBpZiAoZGVwcyA9PT0gbnVsbCB8fCBkZXBzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBkZXBzLmVycm9yTWFwKSB7XG4gICAgICAgIGF1dGguX3VwZGF0ZUVycm9yTWFwKGRlcHMuZXJyb3JNYXApO1xuICAgIH1cbiAgICAvLyBUaGlzIHByb21pc2UgaXMgaW50ZW5kZWQgdG8gZmxvYXQ7IGF1dGggaW5pdGlhbGl6YXRpb24gaGFwcGVucyBpbiB0aGVcbiAgICAvLyBiYWNrZ3JvdW5kLCBtZWFud2hpbGUgdGhlIGF1dGggb2JqZWN0IG1heSBiZSB1c2VkIGJ5IHRoZSBhcHAuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgIGF1dGguX2luaXRpYWxpemVXaXRoUGVyc2lzdGVuY2UoaGllcmFyY2h5LCBkZXBzID09PSBudWxsIHx8IGRlcHMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGRlcHMucG9wdXBSZWRpcmVjdFJlc29sdmVyKTtcbn1cblxuLyoqXG4gKiBDaGFuZ2VzIHRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdG8gY29tbXVuaWNhdGUgd2l0aCB0aGUgRmlyZWJhc2UgQXV0aCBFbXVsYXRvciwgaW5zdGVhZCBvZiBwcm9kdWN0aW9uXG4gKiBGaXJlYmFzZSBBdXRoIHNlcnZpY2VzLlxuICpcbiAqIEByZW1hcmtzXG4gKiBUaGlzIG11c3QgYmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgaW1tZWRpYXRlbHkgZm9sbG93aW5nIHRoZSBmaXJzdCBjYWxsIHRvXG4gKiB7QGxpbmsgaW5pdGlhbGl6ZUF1dGh9LiAgRG8gbm90IHVzZSB3aXRoIHByb2R1Y3Rpb24gY3JlZGVudGlhbHMgYXMgZW11bGF0b3JcbiAqIHRyYWZmaWMgaXMgbm90IGVuY3J5cHRlZC5cbiAqXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbm5lY3RBdXRoRW11bGF0b3IoYXV0aCwgJ2h0dHA6Ly8xMjcuMC4wLjE6OTA5OScsIHsgZGlzYWJsZVdhcm5pbmdzOiB0cnVlIH0pO1xuICogYGBgXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIHVybCAtIFRoZSBVUkwgYXQgd2hpY2ggdGhlIGVtdWxhdG9yIGlzIHJ1bm5pbmcgKGVnLCAnaHR0cDovL2xvY2FsaG9zdDo5MDk5JykuXG4gKiBAcGFyYW0gb3B0aW9ucyAtIE9wdGlvbmFsLiBgb3B0aW9ucy5kaXNhYmxlV2FybmluZ3NgIGRlZmF1bHRzIHRvIGBmYWxzZWAuIFNldCBpdCB0b1xuICogYHRydWVgIHRvIGRpc2FibGUgdGhlIHdhcm5pbmcgYmFubmVyIGF0dGFjaGVkIHRvIHRoZSBET00uXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiBjb25uZWN0QXV0aEVtdWxhdG9yKGF1dGgsIHVybCwgb3B0aW9ucykge1xuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcbiAgICBfYXNzZXJ0KC9eaHR0cHM/OlxcL1xcLy8udGVzdCh1cmwpLCBhdXRoSW50ZXJuYWwsIFwiaW52YWxpZC1lbXVsYXRvci1zY2hlbWVcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfRU1VTEFUT1JfU0NIRU1FICovKTtcbiAgICBjb25zdCBkaXNhYmxlV2FybmluZ3MgPSAhIShvcHRpb25zID09PSBudWxsIHx8IG9wdGlvbnMgPT09IHZvaWQgMCA/IHZvaWQgMCA6IG9wdGlvbnMuZGlzYWJsZVdhcm5pbmdzKTtcbiAgICBjb25zdCBwcm90b2NvbCA9IGV4dHJhY3RQcm90b2NvbCh1cmwpO1xuICAgIGNvbnN0IHsgaG9zdCwgcG9ydCB9ID0gZXh0cmFjdEhvc3RBbmRQb3J0KHVybCk7XG4gICAgY29uc3QgcG9ydFN0ciA9IHBvcnQgPT09IG51bGwgPyAnJyA6IGA6JHtwb3J0fWA7XG4gICAgLy8gQWx3YXlzIHJlcGxhY2UgcGF0aCB3aXRoIFwiL1wiIChldmVuIGlmIGlucHV0IHVybCBoYWQgbm8gcGF0aCBhdCBhbGwsIG9yIGhhZCBhIGRpZmZlcmVudCBvbmUpLlxuICAgIGNvbnN0IGVtdWxhdG9yID0geyB1cmw6IGAke3Byb3RvY29sfS8vJHtob3N0fSR7cG9ydFN0cn0vYCB9O1xuICAgIGNvbnN0IGVtdWxhdG9yQ29uZmlnID0gT2JqZWN0LmZyZWV6ZSh7XG4gICAgICAgIGhvc3QsXG4gICAgICAgIHBvcnQsXG4gICAgICAgIHByb3RvY29sOiBwcm90b2NvbC5yZXBsYWNlKCc6JywgJycpLFxuICAgICAgICBvcHRpb25zOiBPYmplY3QuZnJlZXplKHsgZGlzYWJsZVdhcm5pbmdzIH0pXG4gICAgfSk7XG4gICAgLy8gVGhlcmUgYXJlIGEgZmV3IHNjZW5hcmlvcyB0byBndWFyZCBhZ2FpbnN0IGlmIHRoZSBBdXRoIGluc3RhbmNlIGhhcyBhbHJlYWR5IHN0YXJ0ZWQ6XG4gICAgaWYgKCFhdXRoSW50ZXJuYWwuX2NhbkluaXRFbXVsYXRvcikge1xuICAgICAgICAvLyBBcHBsaWNhdGlvbnMgbWF5IG5vdCBpbml0aWFsaXplIHRoZSBlbXVsYXRvciBmb3IgdGhlIGZpcnN0IHRpbWUgaWYgQXV0aCBoYXMgYWxyZWFkeSBzdGFydGVkXG4gICAgICAgIC8vIHRvIG1ha2UgbmV0d29yayByZXF1ZXN0cy5cbiAgICAgICAgX2Fzc2VydChhdXRoSW50ZXJuYWwuY29uZmlnLmVtdWxhdG9yICYmIGF1dGhJbnRlcm5hbC5lbXVsYXRvckNvbmZpZywgYXV0aEludGVybmFsLCBcImVtdWxhdG9yLWNvbmZpZy1mYWlsZWRcIiAvKiBBdXRoRXJyb3JDb2RlLkVNVUxBVE9SX0NPTkZJR19GQUlMRUQgKi8pO1xuICAgICAgICAvLyBBcHBsaWNhdGlvbnMgbWF5IG5vdCBhbHRlciB0aGUgY29uZmlndXJhdGlvbiBvZiB0aGUgZW11bGF0b3IgKGFrYSBwYXNzIGEgZGlmZmVyZW50IGNvbmZpZylcbiAgICAgICAgLy8gb25jZSBBdXRoIGhhcyBzdGFydGVkIHRvIG1ha2UgbmV0d29yayByZXF1ZXN0cy5cbiAgICAgICAgX2Fzc2VydChkZWVwRXF1YWwoZW11bGF0b3IsIGF1dGhJbnRlcm5hbC5jb25maWcuZW11bGF0b3IpICYmXG4gICAgICAgICAgICBkZWVwRXF1YWwoZW11bGF0b3JDb25maWcsIGF1dGhJbnRlcm5hbC5lbXVsYXRvckNvbmZpZyksIGF1dGhJbnRlcm5hbCwgXCJlbXVsYXRvci1jb25maWctZmFpbGVkXCIgLyogQXV0aEVycm9yQ29kZS5FTVVMQVRPUl9DT05GSUdfRkFJTEVEICovKTtcbiAgICAgICAgLy8gSXQncyB2YWxpZCwgaG93ZXZlciwgdG8gaW52b2tlIGNvbm5lY3RBdXRoRW11bGF0b3IoKSBhZnRlciBBdXRoIGhhcyBzdGFydGVkIG1ha2luZ1xuICAgICAgICAvLyBjb25uZWN0aW9ucywgc28gbG9uZyBhcyB0aGUgY29uZmlnIG1hdGNoZXMgdGhlIGV4aXN0aW5nIGNvbmZpZy4gVGhpcyByZXN1bHRzIGluIGEgbm8tb3AuXG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgYXV0aEludGVybmFsLmNvbmZpZy5lbXVsYXRvciA9IGVtdWxhdG9yO1xuICAgIGF1dGhJbnRlcm5hbC5lbXVsYXRvckNvbmZpZyA9IGVtdWxhdG9yQ29uZmlnO1xuICAgIGF1dGhJbnRlcm5hbC5zZXR0aW5ncy5hcHBWZXJpZmljYXRpb25EaXNhYmxlZEZvclRlc3RpbmcgPSB0cnVlO1xuICAgIGlmICghZGlzYWJsZVdhcm5pbmdzKSB7XG4gICAgICAgIGVtaXRFbXVsYXRvcldhcm5pbmcoKTtcbiAgICB9XG59XG5mdW5jdGlvbiBleHRyYWN0UHJvdG9jb2wodXJsKSB7XG4gICAgY29uc3QgcHJvdG9jb2xFbmQgPSB1cmwuaW5kZXhPZignOicpO1xuICAgIHJldHVybiBwcm90b2NvbEVuZCA8IDAgPyAnJyA6IHVybC5zdWJzdHIoMCwgcHJvdG9jb2xFbmQgKyAxKTtcbn1cbmZ1bmN0aW9uIGV4dHJhY3RIb3N0QW5kUG9ydCh1cmwpIHtcbiAgICBjb25zdCBwcm90b2NvbCA9IGV4dHJhY3RQcm90b2NvbCh1cmwpO1xuICAgIGNvbnN0IGF1dGhvcml0eSA9IC8oXFwvXFwvKT8oW14/Iy9dKykvLmV4ZWModXJsLnN1YnN0cihwcm90b2NvbC5sZW5ndGgpKTsgLy8gQmV0d2VlbiAvLyBhbmQgLywgPyBvciAjLlxuICAgIGlmICghYXV0aG9yaXR5KSB7XG4gICAgICAgIHJldHVybiB7IGhvc3Q6ICcnLCBwb3J0OiBudWxsIH07XG4gICAgfVxuICAgIGNvbnN0IGhvc3RBbmRQb3J0ID0gYXV0aG9yaXR5WzJdLnNwbGl0KCdAJykucG9wKCkgfHwgJyc7IC8vIFN0cmlwIG91dCBcInVzZXJuYW1lOnBhc3N3b3JkQFwiLlxuICAgIGNvbnN0IGJyYWNrZXRlZElQdjYgPSAvXihcXFtbXlxcXV0rXFxdKSg6fCQpLy5leGVjKGhvc3RBbmRQb3J0KTtcbiAgICBpZiAoYnJhY2tldGVkSVB2Nikge1xuICAgICAgICBjb25zdCBob3N0ID0gYnJhY2tldGVkSVB2NlsxXTtcbiAgICAgICAgcmV0dXJuIHsgaG9zdCwgcG9ydDogcGFyc2VQb3J0KGhvc3RBbmRQb3J0LnN1YnN0cihob3N0Lmxlbmd0aCArIDEpKSB9O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgW2hvc3QsIHBvcnRdID0gaG9zdEFuZFBvcnQuc3BsaXQoJzonKTtcbiAgICAgICAgcmV0dXJuIHsgaG9zdCwgcG9ydDogcGFyc2VQb3J0KHBvcnQpIH07XG4gICAgfVxufVxuZnVuY3Rpb24gcGFyc2VQb3J0KHBvcnRTdHIpIHtcbiAgICBpZiAoIXBvcnRTdHIpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIGNvbnN0IHBvcnQgPSBOdW1iZXIocG9ydFN0cik7XG4gICAgaWYgKGlzTmFOKHBvcnQpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICByZXR1cm4gcG9ydDtcbn1cbmZ1bmN0aW9uIGVtaXRFbXVsYXRvcldhcm5pbmcoKSB7XG4gICAgZnVuY3Rpb24gYXR0YWNoQmFubmVyKCkge1xuICAgICAgICBjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICAgICAgY29uc3Qgc3R5ID0gZWwuc3R5bGU7XG4gICAgICAgIGVsLmlubmVyVGV4dCA9XG4gICAgICAgICAgICAnUnVubmluZyBpbiBlbXVsYXRvciBtb2RlLiBEbyBub3QgdXNlIHdpdGggcHJvZHVjdGlvbiBjcmVkZW50aWFscy4nO1xuICAgICAgICBzdHkucG9zaXRpb24gPSAnZml4ZWQnO1xuICAgICAgICBzdHkud2lkdGggPSAnMTAwJSc7XG4gICAgICAgIHN0eS5iYWNrZ3JvdW5kQ29sb3IgPSAnI2ZmZmZmZic7XG4gICAgICAgIHN0eS5ib3JkZXIgPSAnLjFlbSBzb2xpZCAjMDAwMDAwJztcbiAgICAgICAgc3R5LmNvbG9yID0gJyNiNTAwMDAnO1xuICAgICAgICBzdHkuYm90dG9tID0gJzBweCc7XG4gICAgICAgIHN0eS5sZWZ0ID0gJzBweCc7XG4gICAgICAgIHN0eS5tYXJnaW4gPSAnMHB4JztcbiAgICAgICAgc3R5LnpJbmRleCA9ICcxMDAwMCc7XG4gICAgICAgIHN0eS50ZXh0QWxpZ24gPSAnY2VudGVyJztcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZCgnZmlyZWJhc2UtZW11bGF0b3Itd2FybmluZycpO1xuICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBjb25zb2xlICE9PSAndW5kZWZpbmVkJyAmJiB0eXBlb2YgY29uc29sZS5pbmZvID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnNvbGUuaW5mbygnV0FSTklORzogWW91IGFyZSB1c2luZyB0aGUgQXV0aCBFbXVsYXRvciwnICtcbiAgICAgICAgICAgICcgd2hpY2ggaXMgaW50ZW5kZWQgZm9yIGxvY2FsIHRlc3Rpbmcgb25seS4gIERvIG5vdCB1c2Ugd2l0aCcgK1xuICAgICAgICAgICAgJyBwcm9kdWN0aW9uIGNyZWRlbnRpYWxzLicpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgdHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICBpZiAoZG9jdW1lbnQucmVhZHlTdGF0ZSA9PT0gJ2xvYWRpbmcnKSB7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGF0dGFjaEJhbm5lcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhdHRhY2hCYW5uZXIoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSW50ZXJmYWNlIHRoYXQgcmVwcmVzZW50cyB0aGUgY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkgYW4ge0BsaW5rIEF1dGhQcm92aWRlcn0uXG4gKlxuICogQHJlbWFya3NcbiAqIEltcGxlbWVudGF0aW9ucyBzcGVjaWZ5IHRoZSBkZXRhaWxzIGFib3V0IGVhY2ggYXV0aCBwcm92aWRlcidzIGNyZWRlbnRpYWwgcmVxdWlyZW1lbnRzLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgQXV0aENyZWRlbnRpYWwge1xuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgYXV0aGVudGljYXRpb24gcHJvdmlkZXIgSUQgZm9yIHRoZSBjcmVkZW50aWFsLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBGb3IgZXhhbXBsZSwgJ2ZhY2Vib29rLmNvbScsIG9yICdnb29nbGUuY29tJy5cbiAgICAgKi9cbiAgICBwcm92aWRlcklkLCBcbiAgICAvKipcbiAgICAgKiBUaGUgYXV0aGVudGljYXRpb24gc2lnbiBpbiBtZXRob2QgZm9yIHRoZSBjcmVkZW50aWFsLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBGb3IgZXhhbXBsZSwge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfUEFTU1dPUkQsIG9yXG4gICAgICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgc2lnbi1pbiBtZXRob2RcbiAgICAgKiBpZGVudGlmaWVyIGFzIHJldHVybmVkIGluIHtAbGluayBmZXRjaFNpZ25Jbk1ldGhvZHNGb3JFbWFpbH0uXG4gICAgICovXG4gICAgc2lnbkluTWV0aG9kKSB7XG4gICAgICAgIHRoaXMucHJvdmlkZXJJZCA9IHByb3ZpZGVySWQ7XG4gICAgICAgIHRoaXMuc2lnbkluTWV0aG9kID0gc2lnbkluTWV0aG9kO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBhIEpTT04tc2VyaWFsaXphYmxlIHJlcHJlc2VudGF0aW9uIG9mIHRoaXMgb2JqZWN0LlxuICAgICAqL1xuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIGRlYnVnRmFpbCgnbm90IGltcGxlbWVudGVkJyk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKF9hdXRoKSB7XG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2xpbmtUb0lkVG9rZW4oX2F1dGgsIF9pZFRva2VuKSB7XG4gICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ25vdCBpbXBsZW1lbnRlZCcpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihfYXV0aCkge1xuICAgICAgICByZXR1cm4gZGVidWdGYWlsKCdub3QgaW1wbGVtZW50ZWQnKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiByZXNldFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6cmVzZXRQYXNzd29yZFwiIC8qIEVuZHBvaW50LlJFU0VUX1BBU1NXT1JEICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuYXN5bmMgZnVuY3Rpb24gdXBkYXRlRW1haWxQYXNzd29yZChhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnVwZGF0ZVwiIC8qIEVuZHBvaW50LlNFVF9BQ0NPVU5UX0lORk8gKi8sIHJlcXVlc3QpO1xufVxuLy8gVXNlZCBmb3IgbGlua2luZyBhbiBlbWFpbC9wYXNzd29yZCBhY2NvdW50IHRvIGFuIGV4aXN0aW5nIGlkVG9rZW4uIFVzZXMgdGhlIHNhbWUgcmVxdWVzdC9yZXNwb25zZVxuLy8gZm9ybWF0IGFzIHVwZGF0ZUVtYWlsUGFzc3dvcmQuXG5hc3luYyBmdW5jdGlvbiBsaW5rRW1haWxQYXNzd29yZChhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25VcFwiIC8qIEVuZHBvaW50LlNJR05fVVAgKi8sIHJlcXVlc3QpO1xufVxuYXN5bmMgZnVuY3Rpb24gYXBwbHlBY3Rpb25Db2RlJDEoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czp1cGRhdGVcIiAvKiBFbmRwb2ludC5TRVRfQUNDT1VOVF9JTkZPICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aFBhc3N3b3JkXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX1BBU1NXT1JEICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuYXN5bmMgZnVuY3Rpb24gc2VuZE9vYkNvZGUoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzZW5kT29iQ29kZVwiIC8qIEVuZHBvaW50LlNFTkRfT09CX0NPREUgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5hc3luYyBmdW5jdGlvbiBzZW5kRW1haWxWZXJpZmljYXRpb24kMShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIHNlbmRPb2JDb2RlKGF1dGgsIHJlcXVlc3QpO1xufVxuYXN5bmMgZnVuY3Rpb24gc2VuZFBhc3N3b3JkUmVzZXRFbWFpbCQxKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gc2VuZE9vYkNvZGUoYXV0aCwgcmVxdWVzdCk7XG59XG5hc3luYyBmdW5jdGlvbiBzZW5kU2lnbkluTGlua1RvRW1haWwkMShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIHNlbmRPb2JDb2RlKGF1dGgsIHJlcXVlc3QpO1xufVxuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5QW5kQ2hhbmdlRW1haWwoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBzZW5kT29iQ29kZShhdXRoLCByZXF1ZXN0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmskMShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhFbWFpbExpbmtcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfRU1BSUxfTElOSyAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmtGb3JMaW5raW5nKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aEVtYWlsTGlua1wiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9FTUFJTF9MSU5LICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbnRlcmZhY2UgdGhhdCByZXByZXNlbnRzIHRoZSBjcmVkZW50aWFscyByZXR1cm5lZCBieSB7QGxpbmsgRW1haWxBdXRoUHJvdmlkZXJ9IGZvclxuICoge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JEXG4gKlxuICogQHJlbWFya3NcbiAqIENvdmVycyBib3RoIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JEIGFuZFxuICoge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEVtYWlsQXV0aENyZWRlbnRpYWwgZXh0ZW5kcyBBdXRoQ3JlZGVudGlhbCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZW1haWwsIFxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfcGFzc3dvcmQsIHNpZ25Jbk1ldGhvZCwgXG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF90ZW5hbnRJZCA9IG51bGwpIHtcbiAgICAgICAgc3VwZXIoXCJwYXNzd29yZFwiIC8qIFByb3ZpZGVySWQuUEFTU1dPUkQgKi8sIHNpZ25Jbk1ldGhvZCk7XG4gICAgICAgIHRoaXMuX2VtYWlsID0gX2VtYWlsO1xuICAgICAgICB0aGlzLl9wYXNzd29yZCA9IF9wYXNzd29yZDtcbiAgICAgICAgdGhpcy5fdGVuYW50SWQgPSBfdGVuYW50SWQ7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBzdGF0aWMgX2Zyb21FbWFpbEFuZFBhc3N3b3JkKGVtYWlsLCBwYXNzd29yZCkge1xuICAgICAgICByZXR1cm4gbmV3IEVtYWlsQXV0aENyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkLCBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBfZnJvbUVtYWlsQW5kQ29kZShlbWFpbCwgb29iQ29kZSwgdGVuYW50SWQgPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBuZXcgRW1haWxBdXRoQ3JlZGVudGlhbChlbWFpbCwgb29iQ29kZSwgXCJlbWFpbExpbmtcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLywgdGVuYW50SWQpO1xuICAgIH1cbiAgICAvKioge0Bpbmhlcml0ZG9jIEF1dGhDcmVkZW50aWFsLnRvSlNPTn0gKi9cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsXG4gICAgICAgICAgICBwYXNzd29yZDogdGhpcy5fcGFzc3dvcmQsXG4gICAgICAgICAgICBzaWduSW5NZXRob2Q6IHRoaXMuc2lnbkluTWV0aG9kLFxuICAgICAgICAgICAgdGVuYW50SWQ6IHRoaXMuX3RlbmFudElkXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXRpYyBtZXRob2QgdG8gZGVzZXJpYWxpemUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCBpbnRvIGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGpzb24gLSBFaXRoZXIgYG9iamVjdGAgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuIFdoZW4gc3RyaW5nIGlzXG4gICAgICogcHJvdmlkZWQsIGBKU09OLnBhcnNlYCB3b3VsZCBiZSBjYWxsZWQgZmlyc3QuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBJZiB0aGUgSlNPTiBpbnB1dCBkb2VzIG5vdCByZXByZXNlbnQgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSwgbnVsbCBpcyByZXR1cm5lZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikge1xuICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjtcbiAgICAgICAgaWYgKChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmouZW1haWwpICYmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmoucGFzc3dvcmQpKSB7XG4gICAgICAgICAgICBpZiAob2JqLnNpZ25Jbk1ldGhvZCA9PT0gXCJwYXNzd29yZFwiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9QQVNTV09SRCAqLykge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mcm9tRW1haWxBbmRQYXNzd29yZChvYmouZW1haWwsIG9iai5wYXNzd29yZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChvYmouc2lnbkluTWV0aG9kID09PSBcImVtYWlsTGlua1wiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2Zyb21FbWFpbEFuZENvZGUob2JqLmVtYWlsLCBvYmoucGFzc3dvcmQsIG9iai50ZW5hbnRJZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNpZ25Jbk1ldGhvZCkge1xuICAgICAgICAgICAgY2FzZSBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovOlxuICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLl9wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqL1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZVJlY2FwdGNoYUZsb3coYXV0aCwgcmVxdWVzdCwgXCJzaWduSW5XaXRoUGFzc3dvcmRcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLlNJR05fSU5fV0lUSF9QQVNTV09SRCAqLywgc2lnbkluV2l0aFBhc3N3b3JkLCBcIkVNQUlMX1BBU1NXT1JEX1BST1ZJREVSXCIgLyogUmVjYXB0Y2hhQXV0aFByb3ZpZGVyLkVNQUlMX1BBU1NXT1JEX1BST1ZJREVSICovKTtcbiAgICAgICAgICAgIGNhc2UgXCJlbWFpbExpbmtcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfTElOSyAqLzpcbiAgICAgICAgICAgICAgICByZXR1cm4gc2lnbkluV2l0aEVtYWlsTGluayQxKGF1dGgsIHtcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IHRoaXMuX2VtYWlsLFxuICAgICAgICAgICAgICAgICAgICBvb2JDb2RlOiB0aGlzLl9wYXNzd29yZFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBfZmFpbChhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLnNpZ25Jbk1ldGhvZCkge1xuICAgICAgICAgICAgY2FzZSBcInBhc3N3b3JkXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX1BBU1NXT1JEICovOlxuICAgICAgICAgICAgICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogdGhpcy5fZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiB0aGlzLl9wYXNzd29yZCxcbiAgICAgICAgICAgICAgICAgICAgY2xpZW50VHlwZTogXCJDTElFTlRfVFlQRV9XRUJcIiAvKiBSZWNhcHRjaGFDbGllbnRUeXBlLldFQiAqL1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIGhhbmRsZVJlY2FwdGNoYUZsb3coYXV0aCwgcmVxdWVzdCwgXCJzaWduVXBQYXNzd29yZFwiIC8qIFJlY2FwdGNoYUFjdGlvbk5hbWUuU0lHTl9VUF9QQVNTV09SRCAqLywgbGlua0VtYWlsUGFzc3dvcmQsIFwiRU1BSUxfUEFTU1dPUkRfUFJPVklERVJcIiAvKiBSZWNhcHRjaGFBdXRoUHJvdmlkZXIuRU1BSUxfUEFTU1dPUkRfUFJPVklERVIgKi8pO1xuICAgICAgICAgICAgY2FzZSBcImVtYWlsTGlua1wiIC8qIFNpZ25Jbk1ldGhvZC5FTUFJTF9MSU5LICovOlxuICAgICAgICAgICAgICAgIHJldHVybiBzaWduSW5XaXRoRW1haWxMaW5rRm9yTGlua2luZyhhdXRoLCB7XG4gICAgICAgICAgICAgICAgICAgIGlkVG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiB0aGlzLl9lbWFpbCxcbiAgICAgICAgICAgICAgICAgICAgb29iQ29kZTogdGhpcy5fcGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgX2ZhaWwoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aElkcFwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9JRFAgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBJRFBfUkVRVUVTVF9VUkkkMSA9ICdodHRwOi8vbG9jYWxob3N0Jztcbi8qKlxuICogUmVwcmVzZW50cyB0aGUgT0F1dGggY3JlZGVudGlhbHMgcmV0dXJuZWQgYnkgYW4ge0BsaW5rIE9BdXRoUHJvdmlkZXJ9LlxuICpcbiAqIEByZW1hcmtzXG4gKiBJbXBsZW1lbnRhdGlvbnMgc3BlY2lmeSB0aGUgZGV0YWlscyBhYm91dCBlYWNoIGF1dGggcHJvdmlkZXIncyBjcmVkZW50aWFsIHJlcXVpcmVtZW50cy5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIE9BdXRoQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy5wZW5kaW5nVG9rZW4gPSBudWxsO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgc3RhdGljIF9mcm9tUGFyYW1zKHBhcmFtcykge1xuICAgICAgICBjb25zdCBjcmVkID0gbmV3IE9BdXRoQ3JlZGVudGlhbChwYXJhbXMucHJvdmlkZXJJZCwgcGFyYW1zLnNpZ25Jbk1ldGhvZCk7XG4gICAgICAgIGlmIChwYXJhbXMuaWRUb2tlbiB8fCBwYXJhbXMuYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgIC8vIE9BdXRoIDIgYW5kIGVpdGhlciBJRCB0b2tlbiBvciBhY2Nlc3MgdG9rZW4uXG4gICAgICAgICAgICBpZiAocGFyYW1zLmlkVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBjcmVkLmlkVG9rZW4gPSBwYXJhbXMuaWRUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXJhbXMuYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcGFyYW1zLmFjY2Vzc1Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gQWRkIG5vbmNlIGlmIGF2YWlsYWJsZSBhbmQgbm8gcGVuZGluZ1Rva2VuIGlzIHByZXNlbnQuXG4gICAgICAgICAgICBpZiAocGFyYW1zLm5vbmNlICYmICFwYXJhbXMucGVuZGluZ1Rva2VuKSB7XG4gICAgICAgICAgICAgICAgY3JlZC5ub25jZSA9IHBhcmFtcy5ub25jZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChwYXJhbXMucGVuZGluZ1Rva2VuKSB7XG4gICAgICAgICAgICAgICAgY3JlZC5wZW5kaW5nVG9rZW4gPSBwYXJhbXMucGVuZGluZ1Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHBhcmFtcy5vYXV0aFRva2VuICYmIHBhcmFtcy5vYXV0aFRva2VuU2VjcmV0KSB7XG4gICAgICAgICAgICAvLyBPQXV0aCAxIGFuZCBPQXV0aCB0b2tlbiB3aXRoIHRva2VuIHNlY3JldFxuICAgICAgICAgICAgY3JlZC5hY2Nlc3NUb2tlbiA9IHBhcmFtcy5vYXV0aFRva2VuO1xuICAgICAgICAgICAgY3JlZC5zZWNyZXQgPSBwYXJhbXMub2F1dGhUb2tlblNlY3JldDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIF9mYWlsKFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY3JlZDtcbiAgICB9XG4gICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICAqL1xuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGlkVG9rZW46IHRoaXMuaWRUb2tlbixcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLmFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgc2VjcmV0OiB0aGlzLnNlY3JldCxcbiAgICAgICAgICAgIG5vbmNlOiB0aGlzLm5vbmNlLFxuICAgICAgICAgICAgcGVuZGluZ1Rva2VuOiB0aGlzLnBlbmRpbmdUb2tlbixcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IHRoaXMucHJvdmlkZXJJZCxcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogdGhpcy5zaWduSW5NZXRob2RcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RhdGljIG1ldGhvZCB0byBkZXNlcmlhbGl6ZSBhIEpTT04gcmVwcmVzZW50YXRpb24gb2YgYW4gb2JqZWN0IGludG8gYW5cbiAgICAgKiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBqc29uIC0gSW5wdXQgY2FuIGJlIGVpdGhlciBPYmplY3Qgb3IgdGhlIHN0cmluZ2lmaWVkIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBvYmplY3QuXG4gICAgICogV2hlbiBzdHJpbmcgaXMgcHJvdmlkZWQsIEpTT04ucGFyc2Ugd291bGQgYmUgY2FsbGVkIGZpcnN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMgSWYgdGhlIEpTT04gaW5wdXQgZG9lcyBub3QgcmVwcmVzZW50IGFuIHtAbGluayAgQXV0aENyZWRlbnRpYWx9LCBudWxsIGlzIHJldHVybmVkLlxuICAgICAqL1xuICAgIHN0YXRpYyBmcm9tSlNPTihqc29uKSB7XG4gICAgICAgIGNvbnN0IG9iaiA9IHR5cGVvZiBqc29uID09PSAnc3RyaW5nJyA/IEpTT04ucGFyc2UoanNvbikgOiBqc29uO1xuICAgICAgICBjb25zdCB7IHByb3ZpZGVySWQsIHNpZ25Jbk1ldGhvZCB9ID0gb2JqLCByZXN0ID0gX19yZXN0KG9iaiwgW1wicHJvdmlkZXJJZFwiLCBcInNpZ25Jbk1ldGhvZFwiXSk7XG4gICAgICAgIGlmICghcHJvdmlkZXJJZCB8fCAhc2lnbkluTWV0aG9kKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjcmVkID0gbmV3IE9BdXRoQ3JlZGVudGlhbChwcm92aWRlcklkLCBzaWduSW5NZXRob2QpO1xuICAgICAgICBjcmVkLmlkVG9rZW4gPSByZXN0LmlkVG9rZW4gfHwgdW5kZWZpbmVkO1xuICAgICAgICBjcmVkLmFjY2Vzc1Rva2VuID0gcmVzdC5hY2Nlc3NUb2tlbiB8fCB1bmRlZmluZWQ7XG4gICAgICAgIGNyZWQuc2VjcmV0ID0gcmVzdC5zZWNyZXQ7XG4gICAgICAgIGNyZWQubm9uY2UgPSByZXN0Lm5vbmNlO1xuICAgICAgICBjcmVkLnBlbmRpbmdUb2tlbiA9IHJlc3QucGVuZGluZ1Rva2VuIHx8IG51bGw7XG4gICAgICAgIHJldHVybiBjcmVkO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2dldElkVG9rZW5SZXNwb25zZShhdXRoKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpO1xuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9saW5rVG9JZFRva2VuKGF1dGgsIGlkVG9rZW4pIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7XG4gICAgICAgIHJlcXVlc3QuaWRUb2tlbiA9IGlkVG9rZW47XG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKSB7XG4gICAgICAgIGNvbnN0IHJlcXVlc3QgPSB0aGlzLmJ1aWxkUmVxdWVzdCgpO1xuICAgICAgICByZXF1ZXN0LmF1dG9DcmVhdGUgPSBmYWxzZTtcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7XG4gICAgfVxuICAgIGJ1aWxkUmVxdWVzdCgpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHtcbiAgICAgICAgICAgIHJlcXVlc3RVcmk6IElEUF9SRVFVRVNUX1VSSSQxLFxuICAgICAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1Rva2VuKSB7XG4gICAgICAgICAgICByZXF1ZXN0LnBlbmRpbmdUb2tlbiA9IHRoaXMucGVuZGluZ1Rva2VuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgcG9zdEJvZHkgPSB7fTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlkVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBwb3N0Qm9keVsnaWRfdG9rZW4nXSA9IHRoaXMuaWRUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICAgICAgcG9zdEJvZHlbJ2FjY2Vzc190b2tlbiddID0gdGhpcy5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLnNlY3JldCkge1xuICAgICAgICAgICAgICAgIHBvc3RCb2R5WydvYXV0aF90b2tlbl9zZWNyZXQnXSA9IHRoaXMuc2VjcmV0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcG9zdEJvZHlbJ3Byb3ZpZGVySWQnXSA9IHRoaXMucHJvdmlkZXJJZDtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vbmNlICYmICF0aGlzLnBlbmRpbmdUb2tlbikge1xuICAgICAgICAgICAgICAgIHBvc3RCb2R5Wydub25jZSddID0gdGhpcy5ub25jZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcXVlc3QucG9zdEJvZHkgPSBxdWVyeXN0cmluZyhwb3N0Qm9keSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlcXVlc3Q7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VuZFBob25lVmVyaWZpY2F0aW9uQ29kZShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNlbmRWZXJpZmljYXRpb25Db2RlXCIgLyogRW5kcG9pbnQuU0VORF9WRVJJRklDQVRJT05fQ09ERSAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhQaG9uZU51bWJlcihhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQaG9uZU51bWJlclwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9QSE9ORV9OVU1CRVIgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5hc3luYyBmdW5jdGlvbiBsaW5rV2l0aFBob25lTnVtYmVyKGF1dGgsIHJlcXVlc3QpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25JbldpdGhQaG9uZU51bWJlclwiIC8qIEVuZHBvaW50LlNJR05fSU5fV0lUSF9QSE9ORV9OVU1CRVIgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG4gICAgaWYgKHJlc3BvbnNlLnRlbXBvcmFyeVByb29mKSB7XG4gICAgICAgIHRocm93IF9tYWtlVGFnZ2VkRXJyb3IoYXV0aCwgXCJhY2NvdW50LWV4aXN0cy13aXRoLWRpZmZlcmVudC1jcmVkZW50aWFsXCIgLyogQXV0aEVycm9yQ29kZS5ORUVEX0NPTkZJUk1BVElPTiAqLywgcmVzcG9uc2UpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzcG9uc2U7XG59XG5jb25zdCBWRVJJRllfUEhPTkVfTlVNQkVSX0ZPUl9FWElTVElOR19FUlJPUl9NQVBfID0ge1xuICAgIFtcIlVTRVJfTk9UX0ZPVU5EXCIgLyogU2VydmVyRXJyb3IuVVNFUl9OT1RfRk9VTkQgKi9dOiBcInVzZXItbm90LWZvdW5kXCIgLyogQXV0aEVycm9yQ29kZS5VU0VSX0RFTEVURUQgKi9cbn07XG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlQaG9uZU51bWJlckZvckV4aXN0aW5nKGF1dGgsIHJlcXVlc3QpIHtcbiAgICBjb25zdCBhcGlSZXF1ZXN0ID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCByZXF1ZXN0KSwgeyBvcGVyYXRpb246ICdSRUFVVEgnIH0pO1xuICAgIHJldHVybiBfcGVyZm9ybVNpZ25JblJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czpzaWduSW5XaXRoUGhvbmVOdW1iZXJcIiAvKiBFbmRwb2ludC5TSUdOX0lOX1dJVEhfUEhPTkVfTlVNQkVSICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgYXBpUmVxdWVzdCksIFZFUklGWV9QSE9ORV9OVU1CRVJfRk9SX0VYSVNUSU5HX0VSUk9SX01BUF8pO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBjcmVkZW50aWFscyByZXR1cm5lZCBieSB7QGxpbmsgUGhvbmVBdXRoUHJvdmlkZXJ9LlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgUGhvbmVBdXRoQ3JlZGVudGlhbCBleHRlbmRzIEF1dGhDcmVkZW50aWFsIHtcbiAgICBjb25zdHJ1Y3RvcihwYXJhbXMpIHtcbiAgICAgICAgc3VwZXIoXCJwaG9uZVwiIC8qIFByb3ZpZGVySWQuUEhPTkUgKi8sIFwicGhvbmVcIiAvKiBTaWduSW5NZXRob2QuUEhPTkUgKi8pO1xuICAgICAgICB0aGlzLnBhcmFtcyA9IHBhcmFtcztcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBfZnJvbVZlcmlmaWNhdGlvbih2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSkge1xuICAgICAgICByZXR1cm4gbmV3IFBob25lQXV0aENyZWRlbnRpYWwoeyB2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBfZnJvbVRva2VuUmVzcG9uc2UocGhvbmVOdW1iZXIsIHRlbXBvcmFyeVByb29mKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGhvbmVBdXRoQ3JlZGVudGlhbCh7IHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZiB9KTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9nZXRJZFRva2VuUmVzcG9uc2UoYXV0aCkge1xuICAgICAgICByZXR1cm4gc2lnbkluV2l0aFBob25lTnVtYmVyKGF1dGgsIHRoaXMuX21ha2VWZXJpZmljYXRpb25SZXF1ZXN0KCkpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikge1xuICAgICAgICByZXR1cm4gbGlua1dpdGhQaG9uZU51bWJlcihhdXRoLCBPYmplY3QuYXNzaWduKHsgaWRUb2tlbiB9LCB0aGlzLl9tYWtlVmVyaWZpY2F0aW9uUmVxdWVzdCgpKSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcbiAgICAgICAgcmV0dXJuIHZlcmlmeVBob25lTnVtYmVyRm9yRXhpc3RpbmcoYXV0aCwgdGhpcy5fbWFrZVZlcmlmaWNhdGlvblJlcXVlc3QoKSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfbWFrZVZlcmlmaWNhdGlvblJlcXVlc3QoKSB7XG4gICAgICAgIGNvbnN0IHsgdGVtcG9yYXJ5UHJvb2YsIHBob25lTnVtYmVyLCB2ZXJpZmljYXRpb25JZCwgdmVyaWZpY2F0aW9uQ29kZSB9ID0gdGhpcy5wYXJhbXM7XG4gICAgICAgIGlmICh0ZW1wb3JhcnlQcm9vZiAmJiBwaG9uZU51bWJlcikge1xuICAgICAgICAgICAgcmV0dXJuIHsgdGVtcG9yYXJ5UHJvb2YsIHBob25lTnVtYmVyIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlc3Npb25JbmZvOiB2ZXJpZmljYXRpb25JZCxcbiAgICAgICAgICAgIGNvZGU6IHZlcmlmaWNhdGlvbkNvZGVcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICovXG4gICAgdG9KU09OKCkge1xuICAgICAgICBjb25zdCBvYmogPSB7XG4gICAgICAgICAgICBwcm92aWRlcklkOiB0aGlzLnByb3ZpZGVySWRcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKHRoaXMucGFyYW1zLnBob25lTnVtYmVyKSB7XG4gICAgICAgICAgICBvYmoucGhvbmVOdW1iZXIgPSB0aGlzLnBhcmFtcy5waG9uZU51bWJlcjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5wYXJhbXMudGVtcG9yYXJ5UHJvb2YpIHtcbiAgICAgICAgICAgIG9iai50ZW1wb3JhcnlQcm9vZiA9IHRoaXMucGFyYW1zLnRlbXBvcmFyeVByb29mO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBhcmFtcy52ZXJpZmljYXRpb25Db2RlKSB7XG4gICAgICAgICAgICBvYmoudmVyaWZpY2F0aW9uQ29kZSA9IHRoaXMucGFyYW1zLnZlcmlmaWNhdGlvbkNvZGU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMucGFyYW1zLnZlcmlmaWNhdGlvbklkKSB7XG4gICAgICAgICAgICBvYmoudmVyaWZpY2F0aW9uSWQgPSB0aGlzLnBhcmFtcy52ZXJpZmljYXRpb25JZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICAvKiogR2VuZXJhdGVzIGEgcGhvbmUgY3JlZGVudGlhbCBiYXNlZCBvbiBhIHBsYWluIG9iamVjdCBvciBhIEpTT04gc3RyaW5nLiAqL1xuICAgIHN0YXRpYyBmcm9tSlNPTihqc29uKSB7XG4gICAgICAgIGlmICh0eXBlb2YganNvbiA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGpzb24gPSBKU09OLnBhcnNlKGpzb24pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgdmVyaWZpY2F0aW9uSWQsIHZlcmlmaWNhdGlvbkNvZGUsIHBob25lTnVtYmVyLCB0ZW1wb3JhcnlQcm9vZiB9ID0ganNvbjtcbiAgICAgICAgaWYgKCF2ZXJpZmljYXRpb25Db2RlICYmXG4gICAgICAgICAgICAhdmVyaWZpY2F0aW9uSWQgJiZcbiAgICAgICAgICAgICFwaG9uZU51bWJlciAmJlxuICAgICAgICAgICAgIXRlbXBvcmFyeVByb29mKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFBob25lQXV0aENyZWRlbnRpYWwoe1xuICAgICAgICAgICAgdmVyaWZpY2F0aW9uSWQsXG4gICAgICAgICAgICB2ZXJpZmljYXRpb25Db2RlLFxuICAgICAgICAgICAgcGhvbmVOdW1iZXIsXG4gICAgICAgICAgICB0ZW1wb3JhcnlQcm9vZlxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE1hcHMgdGhlIG1vZGUgc3RyaW5nIGluIGFjdGlvbiBjb2RlIFVSTCB0byBBY3Rpb24gQ29kZSBJbmZvIG9wZXJhdGlvbi5cbiAqXG4gKiBAcGFyYW0gbW9kZVxuICovXG5mdW5jdGlvbiBwYXJzZU1vZGUobW9kZSkge1xuICAgIHN3aXRjaCAobW9kZSkge1xuICAgICAgICBjYXNlICdyZWNvdmVyRW1haWwnOlxuICAgICAgICAgICAgcmV0dXJuIFwiUkVDT1ZFUl9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uUkVDT1ZFUl9FTUFJTCAqLztcbiAgICAgICAgY2FzZSAncmVzZXRQYXNzd29yZCc6XG4gICAgICAgICAgICByZXR1cm4gXCJQQVNTV09SRF9SRVNFVFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uUEFTU1dPUkRfUkVTRVQgKi87XG4gICAgICAgIGNhc2UgJ3NpZ25Jbic6XG4gICAgICAgICAgICByZXR1cm4gXCJFTUFJTF9TSUdOSU5cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLkVNQUlMX1NJR05JTiAqLztcbiAgICAgICAgY2FzZSAndmVyaWZ5RW1haWwnOlxuICAgICAgICAgICAgcmV0dXJuIFwiVkVSSUZZX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfRU1BSUwgKi87XG4gICAgICAgIGNhc2UgJ3ZlcmlmeUFuZENoYW5nZUVtYWlsJzpcbiAgICAgICAgICAgIHJldHVybiBcIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfQU5EX0NIQU5HRV9FTUFJTCAqLztcbiAgICAgICAgY2FzZSAncmV2ZXJ0U2Vjb25kRmFjdG9yQWRkaXRpb24nOlxuICAgICAgICAgICAgcmV0dXJuIFwiUkVWRVJUX1NFQ09ORF9GQUNUT1JfQURESVRJT05cIiAvKiBBY3Rpb25Db2RlT3BlcmF0aW9uLlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OICovO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuLyoqXG4gKiBIZWxwZXIgdG8gcGFyc2UgRkRMIGxpbmtzXG4gKlxuICogQHBhcmFtIHVybFxuICovXG5mdW5jdGlvbiBwYXJzZURlZXBMaW5rKHVybCkge1xuICAgIGNvbnN0IGxpbmsgPSBxdWVyeXN0cmluZ0RlY29kZShleHRyYWN0UXVlcnlzdHJpbmcodXJsKSlbJ2xpbmsnXTtcbiAgICAvLyBEb3VibGUgbGluayBjYXNlIChhdXRvbWF0aWMgcmVkaXJlY3QpLlxuICAgIGNvbnN0IGRvdWJsZURlZXBMaW5rID0gbGlua1xuICAgICAgICA/IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyhsaW5rKSlbJ2RlZXBfbGlua19pZCddXG4gICAgICAgIDogbnVsbDtcbiAgICAvLyBpT1MgY3VzdG9tIHNjaGVtZSBsaW5rcy5cbiAgICBjb25zdCBpT1NEZWVwTGluayA9IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyh1cmwpKVsnZGVlcF9saW5rX2lkJ107XG4gICAgY29uc3QgaU9TRG91YmxlRGVlcExpbmsgPSBpT1NEZWVwTGlua1xuICAgICAgICA/IHF1ZXJ5c3RyaW5nRGVjb2RlKGV4dHJhY3RRdWVyeXN0cmluZyhpT1NEZWVwTGluaykpWydsaW5rJ11cbiAgICAgICAgOiBudWxsO1xuICAgIHJldHVybiBpT1NEb3VibGVEZWVwTGluayB8fCBpT1NEZWVwTGluayB8fCBkb3VibGVEZWVwTGluayB8fCBsaW5rIHx8IHVybDtcbn1cbi8qKlxuICogQSB1dGlsaXR5IGNsYXNzIHRvIHBhcnNlIGVtYWlsIGFjdGlvbiBVUkxzIHN1Y2ggYXMgcGFzc3dvcmQgcmVzZXQsIGVtYWlsIHZlcmlmaWNhdGlvbixcbiAqIGVtYWlsIGxpbmsgc2lnbiBpbiwgZXRjLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgQWN0aW9uQ29kZVVSTCB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGFjdGlvbkxpbmsgLSBUaGUgbGluayBmcm9tIHdoaWNoIHRvIGV4dHJhY3QgdGhlIFVSTC5cbiAgICAgKiBAcmV0dXJucyBUaGUge0BsaW5rIEFjdGlvbkNvZGVVUkx9IG9iamVjdCwgb3IgbnVsbCBpZiB0aGUgbGluayBpcyBpbnZhbGlkLlxuICAgICAqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoYWN0aW9uTGluaykge1xuICAgICAgICB2YXIgX2EsIF9iLCBfYywgX2QsIF9lLCBfZjtcbiAgICAgICAgY29uc3Qgc2VhcmNoUGFyYW1zID0gcXVlcnlzdHJpbmdEZWNvZGUoZXh0cmFjdFF1ZXJ5c3RyaW5nKGFjdGlvbkxpbmspKTtcbiAgICAgICAgY29uc3QgYXBpS2V5ID0gKF9hID0gc2VhcmNoUGFyYW1zW1wiYXBpS2V5XCIgLyogUXVlcnlGaWVsZC5BUElfS0VZICovXSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogbnVsbDtcbiAgICAgICAgY29uc3QgY29kZSA9IChfYiA9IHNlYXJjaFBhcmFtc1tcIm9vYkNvZGVcIiAvKiBRdWVyeUZpZWxkLkNPREUgKi9dKSAhPT0gbnVsbCAmJiBfYiAhPT0gdm9pZCAwID8gX2IgOiBudWxsO1xuICAgICAgICBjb25zdCBvcGVyYXRpb24gPSBwYXJzZU1vZGUoKF9jID0gc2VhcmNoUGFyYW1zW1wibW9kZVwiIC8qIFF1ZXJ5RmllbGQuTU9ERSAqL10pICE9PSBudWxsICYmIF9jICE9PSB2b2lkIDAgPyBfYyA6IG51bGwpO1xuICAgICAgICAvLyBWYWxpZGF0ZSBBUEkga2V5LCBjb2RlIGFuZCBtb2RlLlxuICAgICAgICBfYXNzZXJ0KGFwaUtleSAmJiBjb2RlICYmIG9wZXJhdGlvbiwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xuICAgICAgICB0aGlzLmFwaUtleSA9IGFwaUtleTtcbiAgICAgICAgdGhpcy5vcGVyYXRpb24gPSBvcGVyYXRpb247XG4gICAgICAgIHRoaXMuY29kZSA9IGNvZGU7XG4gICAgICAgIHRoaXMuY29udGludWVVcmwgPSAoX2QgPSBzZWFyY2hQYXJhbXNbXCJjb250aW51ZVVybFwiIC8qIFF1ZXJ5RmllbGQuQ09OVElOVUVfVVJMICovXSkgIT09IG51bGwgJiYgX2QgIT09IHZvaWQgMCA/IF9kIDogbnVsbDtcbiAgICAgICAgdGhpcy5sYW5ndWFnZUNvZGUgPSAoX2UgPSBzZWFyY2hQYXJhbXNbXCJsYW5ndWFnZUNvZGVcIiAvKiBRdWVyeUZpZWxkLkxBTkdVQUdFX0NPREUgKi9dKSAhPT0gbnVsbCAmJiBfZSAhPT0gdm9pZCAwID8gX2UgOiBudWxsO1xuICAgICAgICB0aGlzLnRlbmFudElkID0gKF9mID0gc2VhcmNoUGFyYW1zW1widGVuYW50SWRcIiAvKiBRdWVyeUZpZWxkLlRFTkFOVF9JRCAqL10pICE9PSBudWxsICYmIF9mICE9PSB2b2lkIDAgPyBfZiA6IG51bGw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyB0aGUgZW1haWwgYWN0aW9uIGxpbmsgc3RyaW5nIGFuZCByZXR1cm5zIGFuIHtAbGluayBBY3Rpb25Db2RlVVJMfSBpZiB0aGUgbGluayBpcyB2YWxpZCxcbiAgICAgKiBvdGhlcndpc2UgcmV0dXJucyBudWxsLlxuICAgICAqXG4gICAgICogQHBhcmFtIGxpbmsgIC0gVGhlIGVtYWlsIGFjdGlvbiBsaW5rIHN0cmluZy5cbiAgICAgKiBAcmV0dXJucyBUaGUge0BsaW5rIEFjdGlvbkNvZGVVUkx9IG9iamVjdCwgb3IgbnVsbCBpZiB0aGUgbGluayBpcyBpbnZhbGlkLlxuICAgICAqXG4gICAgICogQHB1YmxpY1xuICAgICAqL1xuICAgIHN0YXRpYyBwYXJzZUxpbmsobGluaykge1xuICAgICAgICBjb25zdCBhY3Rpb25MaW5rID0gcGFyc2VEZWVwTGluayhsaW5rKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQWN0aW9uQ29kZVVSTChhY3Rpb25MaW5rKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBQYXJzZXMgdGhlIGVtYWlsIGFjdGlvbiBsaW5rIHN0cmluZyBhbmQgcmV0dXJucyBhbiB7QGxpbmsgQWN0aW9uQ29kZVVSTH0gaWZcbiAqIHRoZSBsaW5rIGlzIHZhbGlkLCBvdGhlcndpc2UgcmV0dXJucyBudWxsLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gcGFyc2VBY3Rpb25Db2RlVVJMKGxpbmspIHtcbiAgICByZXR1cm4gQWN0aW9uQ29kZVVSTC5wYXJzZUxpbmsobGluayk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIHtAbGluayBFbWFpbEF1dGhDcmVkZW50aWFsfS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEVtYWlsQXV0aFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JELCBldmVuIGZvciBlbWFpbCBsaW5rLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gRW1haWxBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemUgYW4ge0BsaW5rIEF1dGhDcmVkZW50aWFsfSB1c2luZyBhbiBlbWFpbCBhbmQgcGFzc3dvcmQuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZVxuICAgICAqIGBgYGphdmFzY3JpcHRcbiAgICAgKiBjb25zdCBhdXRoQ3JlZGVudGlhbCA9IEVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGF1dGhDcmVkZW50aWFsKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aEVtYWlsQW5kUGFzc3dvcmQoYXV0aCwgZW1haWwsIHBhc3N3b3JkKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBlbWFpbCAtIEVtYWlsIGFkZHJlc3MuXG4gICAgICogQHBhcmFtIHBhc3N3b3JkIC0gVXNlciBhY2NvdW50IHBhc3N3b3JkLlxuICAgICAqIEByZXR1cm5zIFRoZSBhdXRoIHByb3ZpZGVyIGNyZWRlbnRpYWwuXG4gICAgICovXG4gICAgc3RhdGljIGNyZWRlbnRpYWwoZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgICAgIHJldHVybiBFbWFpbEF1dGhDcmVkZW50aWFsLl9mcm9tRW1haWxBbmRQYXNzd29yZChlbWFpbCwgcGFzc3dvcmQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplIGFuIHtAbGluayBBdXRoQ3JlZGVudGlhbH0gdXNpbmcgYW4gZW1haWwgYW5kIGFuIGVtYWlsIGxpbmsgYWZ0ZXIgYSBzaWduIGluIHdpdGhcbiAgICAgKiBlbWFpbCBsaW5rIG9wZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIGNvbnN0IGF1dGhDcmVkZW50aWFsID0gRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbFdpdGhMaW5rKGF1dGgsIGVtYWlsLCBlbWFpbExpbmspO1xuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgYXV0aENyZWRlbnRpYWwpO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogYXdhaXQgc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsIGVtYWlsKTtcbiAgICAgKiAvLyBPYnRhaW4gZW1haWxMaW5rIGZyb20gdXNlci5cbiAgICAgKiBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluayk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UgdXNlZCB0byB2ZXJpZnkgdGhlIGxpbmsuXG4gICAgICogQHBhcmFtIGVtYWlsIC0gRW1haWwgYWRkcmVzcy5cbiAgICAgKiBAcGFyYW0gZW1haWxMaW5rIC0gU2lnbi1pbiBlbWFpbCBsaW5rLlxuICAgICAqIEByZXR1cm5zIC0gVGhlIGF1dGggcHJvdmlkZXIgY3JlZGVudGlhbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbFdpdGhMaW5rKGVtYWlsLCBlbWFpbExpbmspIHtcbiAgICAgICAgY29uc3QgYWN0aW9uQ29kZVVybCA9IEFjdGlvbkNvZGVVUkwucGFyc2VMaW5rKGVtYWlsTGluayk7XG4gICAgICAgIF9hc3NlcnQoYWN0aW9uQ29kZVVybCwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xuICAgICAgICByZXR1cm4gRW1haWxBdXRoQ3JlZGVudGlhbC5fZnJvbUVtYWlsQW5kQ29kZShlbWFpbCwgYWN0aW9uQ29kZVVybC5jb2RlLCBhY3Rpb25Db2RlVXJsLnRlbmFudElkKTtcbiAgICB9XG59XG4vKipcbiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlBBU1NXT1JELCBldmVuIGZvciBlbWFpbCBsaW5rLlxuICovXG5FbWFpbEF1dGhQcm92aWRlci5QUk9WSURFUl9JRCA9IFwicGFzc3dvcmRcIiAvKiBQcm92aWRlcklkLlBBU1NXT1JEICovO1xuLyoqXG4gKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX1BBU1NXT1JELlxuICovXG5FbWFpbEF1dGhQcm92aWRlci5FTUFJTF9QQVNTV09SRF9TSUdOX0lOX01FVEhPRCA9IFwicGFzc3dvcmRcIiAvKiBTaWduSW5NZXRob2QuRU1BSUxfUEFTU1dPUkQgKi87XG4vKipcbiAqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uRU1BSUxfTElOSy5cbiAqL1xuRW1haWxBdXRoUHJvdmlkZXIuRU1BSUxfTElOS19TSUdOX0lOX01FVEhPRCA9IFwiZW1haWxMaW5rXCIgLyogU2lnbkluTWV0aG9kLkVNQUlMX0xJTksgKi87XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBiYXNlIGNsYXNzIGZvciBhbGwgRmVkZXJhdGVkIHByb3ZpZGVycyAoT0F1dGggKGluY2x1ZGluZyBPSURDKSwgU0FNTCkuXG4gKlxuICogVGhpcyBjbGFzcyBpcyBub3QgbWVhbnQgdG8gYmUgaW5zdGFudGlhdGVkIGRpcmVjdGx5LlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgRmVkZXJhdGVkQXV0aFByb3ZpZGVyIHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RvciBmb3IgZ2VuZXJpYyBPQXV0aCBwcm92aWRlcnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcHJvdmlkZXJJZCAtIFByb3ZpZGVyIGZvciB3aGljaCBjcmVkZW50aWFscyBzaG91bGQgYmUgZ2VuZXJhdGVkLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHByb3ZpZGVySWQpIHtcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDtcbiAgICAgICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgICAgICB0aGlzLmRlZmF1bHRMYW5ndWFnZUNvZGUgPSBudWxsO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMuY3VzdG9tUGFyYW1ldGVycyA9IHt9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXQgdGhlIGxhbmd1YWdlIGdvZGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbGFuZ3VhZ2VDb2RlIC0gbGFuZ3VhZ2UgY29kZVxuICAgICAqL1xuICAgIHNldERlZmF1bHRMYW5ndWFnZShsYW5ndWFnZUNvZGUpIHtcbiAgICAgICAgdGhpcy5kZWZhdWx0TGFuZ3VhZ2VDb2RlID0gbGFuZ3VhZ2VDb2RlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBPQXV0aCBjdXN0b20gcGFyYW1ldGVycyB0byBwYXNzIGluIGFuIE9BdXRoIHJlcXVlc3QgZm9yIHBvcHVwIGFuZCByZWRpcmVjdCBzaWduLWluXG4gICAgICogb3BlcmF0aW9ucy5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogRm9yIGEgZGV0YWlsZWQgbGlzdCwgY2hlY2sgdGhlIHJlc2VydmVkIHJlcXVpcmVkIE9BdXRoIDIuMCBwYXJhbWV0ZXJzIHN1Y2ggYXMgYGNsaWVudF9pZGAsXG4gICAgICogYHJlZGlyZWN0X3VyaWAsIGBzY29wZWAsIGByZXNwb25zZV90eXBlYCwgYW5kIGBzdGF0ZWAgYXJlIG5vdCBhbGxvd2VkIGFuZCB3aWxsIGJlIGlnbm9yZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gY3VzdG9tT0F1dGhQYXJhbWV0ZXJzIC0gVGhlIGN1c3RvbSBPQXV0aCBwYXJhbWV0ZXJzIHRvIHBhc3MgaW4gdGhlIE9BdXRoIHJlcXVlc3QuXG4gICAgICovXG4gICAgc2V0Q3VzdG9tUGFyYW1ldGVycyhjdXN0b21PQXV0aFBhcmFtZXRlcnMpIHtcbiAgICAgICAgdGhpcy5jdXN0b21QYXJhbWV0ZXJzID0gY3VzdG9tT0F1dGhQYXJhbWV0ZXJzO1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgbGlzdCBvZiB7QGxpbmsgQ3VzdG9tUGFyYW1ldGVyc30uXG4gICAgICovXG4gICAgZ2V0Q3VzdG9tUGFyYW1ldGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VzdG9tUGFyYW1ldGVycztcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENvbW1vbiBjb2RlIHRvIGFsbCBPQXV0aCBwcm92aWRlcnMuIFRoaXMgaXMgc2VwYXJhdGUgZnJvbSB0aGVcbiAqIHtAbGluayBPQXV0aFByb3ZpZGVyfSBzbyB0aGF0IGNoaWxkIHByb3ZpZGVycyAobGlrZVxuICoge0BsaW5rIEdvb2dsZUF1dGhQcm92aWRlcn0pIGRvbid0IGluaGVyaXQgdGhlIGBjcmVkZW50aWFsYCBpbnN0YW5jZSBtZXRob2QuXG4gKiBJbnN0ZWFkLCB0aGV5IHJlbHkgb24gYSBzdGF0aWMgYGNyZWRlbnRpYWxgIG1ldGhvZC5cbiAqL1xuY2xhc3MgQmFzZU9BdXRoUHJvdmlkZXIgZXh0ZW5kcyBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpO1xuICAgICAgICAvKiogQGludGVybmFsICovXG4gICAgICAgIHRoaXMuc2NvcGVzID0gW107XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZCBhbiBPQXV0aCBzY29wZSB0byB0aGUgY3JlZGVudGlhbC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzY29wZSAtIFByb3ZpZGVyIE9BdXRoIHNjb3BlIHRvIGFkZC5cbiAgICAgKi9cbiAgICBhZGRTY29wZShzY29wZSkge1xuICAgICAgICAvLyBJZiBub3QgYWxyZWFkeSBhZGRlZCwgYWRkIHNjb3BlIHRvIGxpc3QuXG4gICAgICAgIGlmICghdGhpcy5zY29wZXMuaW5jbHVkZXMoc2NvcGUpKSB7XG4gICAgICAgICAgICB0aGlzLnNjb3Blcy5wdXNoKHNjb3BlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmUgdGhlIGN1cnJlbnQgbGlzdCBvZiBPQXV0aCBzY29wZXMuXG4gICAgICovXG4gICAgZ2V0U2NvcGVzKCkge1xuICAgICAgICByZXR1cm4gWy4uLnRoaXMuc2NvcGVzXTtcbiAgICB9XG59XG4vKipcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGdlbmVyaWMge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSByZWRpcmVjdC5cbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IE9BdXRoUHJvdmlkZXIoJ2dvb2dsZS5jb20nKTtcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdwcm9maWxlJyk7XG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcbiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcbiAqXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcbiAqIGlmIChyZXN1bHQpIHtcbiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXJcbiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIE9BdXRoIEFjY2VzcyBUb2tlbiBmb3IgdGhlIHByb3ZpZGVyLlxuICogICBjb25zdCBjcmVkZW50aWFsID0gcHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQoYXV0aCwgcmVzdWx0KTtcbiAqICAgY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xuICogfVxuICogYGBgXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSBwb3B1cC5cbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IE9BdXRoUHJvdmlkZXIoJ2dvb2dsZS5jb20nKTtcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdwcm9maWxlJyk7XG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XG4gKlxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIE9BdXRoIEFjY2VzcyBUb2tlbiBmb3IgdGhlIHByb3ZpZGVyLlxuICogY29uc3QgY3JlZGVudGlhbCA9IHByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KGF1dGgsIHJlc3VsdCk7XG4gKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XG4gKiBgYGBcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgT0F1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHtcbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGFuIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSBKU09OIHN0cmluZyBvciBhIHBsYWluIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ganNvbiAtIEEgcGxhaW4gb2JqZWN0IG9yIGEgSlNPTiBzdHJpbmdcbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21KU09OKGpzb24pIHtcbiAgICAgICAgY29uc3Qgb2JqID0gdHlwZW9mIGpzb24gPT09ICdzdHJpbmcnID8gSlNPTi5wYXJzZShqc29uKSA6IGpzb247XG4gICAgICAgIF9hc3NlcnQoJ3Byb3ZpZGVySWQnIGluIG9iaiAmJiAnc2lnbkluTWV0aG9kJyBpbiBvYmosIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyhvYmopO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIGdlbmVyaWMgT0F1dGggcHJvdmlkZXIncyBhY2Nlc3MgdG9rZW4gb3IgSUQgdG9rZW4uXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoZSByYXcgbm9uY2UgaXMgcmVxdWlyZWQgd2hlbiBhbiBJRCB0b2tlbiB3aXRoIGEgbm9uY2UgZmllbGQgaXMgcHJvdmlkZWQuIFRoZSBTSEEtMjU2IGhhc2ggb2ZcbiAgICAgKiB0aGUgcmF3IG5vbmNlIG11c3QgbWF0Y2ggdGhlIG5vbmNlIGZpZWxkIGluIHRoZSBJRCB0b2tlbi5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgamF2YXNjcmlwdFxuICAgICAqIC8vIGBnb29nbGVVc2VyYCBmcm9tIHRoZSBvbnN1Y2Nlc3MgR29vZ2xlIFNpZ24gSW4gY2FsbGJhY2suXG4gICAgICogLy8gSW5pdGlhbGl6ZSBhIGdlbmVyYXRlIE9BdXRoIHByb3ZpZGVyIHdpdGggYSBgZ29vZ2xlLmNvbWAgcHJvdmlkZXJJZC5cbiAgICAgKiBjb25zdCBwcm92aWRlciA9IG5ldyBPQXV0aFByb3ZpZGVyKCdnb29nbGUuY29tJyk7XG4gICAgICogY29uc3QgY3JlZGVudGlhbCA9IHByb3ZpZGVyLmNyZWRlbnRpYWwoe1xuICAgICAqICAgaWRUb2tlbjogZ29vZ2xlVXNlci5nZXRBdXRoUmVzcG9uc2UoKS5pZF90b2tlbixcbiAgICAgKiB9KTtcbiAgICAgKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoQ3JlZGVudGlhbChjcmVkZW50aWFsKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBwYXJhbXMgLSBFaXRoZXIgdGhlIG9wdGlvbnMgb2JqZWN0IGNvbnRhaW5pbmcgdGhlIElEIHRva2VuLCBhY2Nlc3MgdG9rZW4gYW5kIHJhdyBub25jZVxuICAgICAqIG9yIHRoZSBJRCB0b2tlbiBzdHJpbmcuXG4gICAgICovXG4gICAgY3JlZGVudGlhbChwYXJhbXMpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NyZWRlbnRpYWwoT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBwYXJhbXMpLCB7IG5vbmNlOiBwYXJhbXMucmF3Tm9uY2UgfSkpO1xuICAgIH1cbiAgICAvKiogQW4gaW50ZXJuYWwgY3JlZGVudGlhbCBtZXRob2QgdGhhdCBhY2NlcHRzIG1vcmUgcGVybWlzc2l2ZSBvcHRpb25zICovXG4gICAgX2NyZWRlbnRpYWwocGFyYW1zKSB7XG4gICAgICAgIF9hc3NlcnQocGFyYW1zLmlkVG9rZW4gfHwgcGFyYW1zLmFjY2Vzc1Rva2VuLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XG4gICAgICAgIC8vIEZvciBPQXV0aENyZWRlbnRpYWwsIHNpZ24gaW4gbWV0aG9kIGlzIHNhbWUgYXMgcHJvdmlkZXJJZC5cbiAgICAgICAgcmV0dXJuIE9BdXRoQ3JlZGVudGlhbC5fZnJvbVBhcmFtcyhPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHBhcmFtcyksIHsgcHJvdmlkZXJJZDogdGhpcy5wcm92aWRlcklkLCBzaWduSW5NZXRob2Q6IHRoaXMucHJvdmlkZXJJZCB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXG4gICAgICovXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7XG4gICAgICAgIHJldHVybiBPQXV0aFByb3ZpZGVyLm9hdXRoQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QodXNlckNyZWRlbnRpYWwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBBdXRoRXJyb3J9IHdoaWNoIHdhc1xuICAgICAqIHRocm93biBkdXJpbmcgYSBzaWduLWluLCBsaW5rLCBvciByZWF1dGhlbnRpY2F0ZSBvcGVyYXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbUVycm9yKGVycm9yKSB7XG4gICAgICAgIHJldHVybiBPQXV0aFByb3ZpZGVyLm9hdXRoQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcbiAgICB9XG4gICAgc3RhdGljIG9hdXRoQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBvYXV0aElkVG9rZW4sIG9hdXRoQWNjZXNzVG9rZW4sIG9hdXRoVG9rZW5TZWNyZXQsIHBlbmRpbmdUb2tlbiwgbm9uY2UsIHByb3ZpZGVySWQgfSA9IHRva2VuUmVzcG9uc2U7XG4gICAgICAgIGlmICghb2F1dGhBY2Nlc3NUb2tlbiAmJlxuICAgICAgICAgICAgIW9hdXRoVG9rZW5TZWNyZXQgJiZcbiAgICAgICAgICAgICFvYXV0aElkVG9rZW4gJiZcbiAgICAgICAgICAgICFwZW5kaW5nVG9rZW4pIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmICghcHJvdmlkZXJJZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgT0F1dGhQcm92aWRlcihwcm92aWRlcklkKS5fY3JlZGVudGlhbCh7XG4gICAgICAgICAgICAgICAgaWRUb2tlbjogb2F1dGhJZFRva2VuLFxuICAgICAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiBvYXV0aEFjY2Vzc1Rva2VuLFxuICAgICAgICAgICAgICAgIG5vbmNlLFxuICAgICAgICAgICAgICAgIHBlbmRpbmdUb2tlblxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkZBQ0VCT09LLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpO1xuICogLy8gU3RhcnQgYSBzaWduIGluIHByb2Nlc3MgZm9yIGFuIHVuYXV0aGVudGljYXRlZCB1c2VyLlxuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTtcbiAqIGF3YWl0IHNpZ25JbldpdGhSZWRpcmVjdChhdXRoLCBwcm92aWRlcik7XG4gKiAvLyBUaGlzIHdpbGwgdHJpZ2dlciBhIGZ1bGwgcGFnZSByZWRpcmVjdCBhd2F5IGZyb20geW91ciBhcHBcbiAqXG4gKiAvLyBBZnRlciByZXR1cm5pbmcgZnJvbSB0aGUgcmVkaXJlY3Qgd2hlbiB5b3VyIGFwcCBpbml0aWFsaXplcyB5b3UgY2FuIG9idGFpbiB0aGUgcmVzdWx0XG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBnZXRSZWRpcmVjdFJlc3VsdChhdXRoKTtcbiAqIGlmIChyZXN1bHQpIHtcbiAqICAgLy8gVGhpcyBpcyB0aGUgc2lnbmVkLWluIHVzZXJcbiAqICAgY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xuICogICAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi5cbiAqICAgY29uc3QgY3JlZGVudGlhbCA9IEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBGYWNlYm9va0F1dGhQcm92aWRlcigpO1xuICogcHJvdmlkZXIuYWRkU2NvcGUoJ3VzZXJfYmlydGhkYXknKTtcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XG4gKlxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEZhY2Vib29rIEFjY2VzcyBUb2tlbi5cbiAqIGNvbnN0IGNyZWRlbnRpYWwgPSBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xuICogYGBgXG4gKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBGYWNlYm9va0F1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoXCJmYWNlYm9vay5jb21cIiAvKiBQcm92aWRlcklkLkZBQ0VCT09LICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGNyZWRlbnRpYWwgZm9yIEZhY2Vib29rLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogLy8gYGV2ZW50YCBmcm9tIHRoZSBGYWNlYm9vayBhdXRoLmF1dGhSZXNwb25zZUNoYW5nZSBjYWxsYmFjay5cbiAgICAgKiBjb25zdCBjcmVkZW50aWFsID0gRmFjZWJvb2tBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChldmVudC5hdXRoUmVzcG9uc2UuYWNjZXNzVG9rZW4pO1xuICAgICAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGNyZWRlbnRpYWwpO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gRmFjZWJvb2sgYWNjZXNzIHRva2VuLlxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVkZW50aWFsKGFjY2Vzc1Rva2VuKSB7XG4gICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoe1xuICAgICAgICAgICAgcHJvdmlkZXJJZDogRmFjZWJvb2tBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQsXG4gICAgICAgICAgICBzaWduSW5NZXRob2Q6IEZhY2Vib29rQXV0aFByb3ZpZGVyLkZBQ0VCT09LX1NJR05fSU5fTUVUSE9ELFxuICAgICAgICAgICAgYWNjZXNzVG9rZW5cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXG4gICAgICovXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7XG4gICAgICAgIHJldHVybiBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzXG4gICAgICogdGhyb3duIGR1cmluZyBhIHNpZ24taW4sIGxpbmssIG9yIHJlYXV0aGVudGljYXRlIG9wZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXG4gICAgICovXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIEZhY2Vib29rQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlIHx8ICEoJ29hdXRoQWNjZXNzVG9rZW4nIGluIHRva2VuUmVzcG9uc2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2Uub2F1dGhBY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBGYWNlYm9va0F1dGhQcm92aWRlci5jcmVkZW50aWFsKHRva2VuUmVzcG9uc2Uub2F1dGhBY2Nlc3NUb2tlbik7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBTaWduSW5NZXRob2R9LkZBQ0VCT09LLiAqL1xuRmFjZWJvb2tBdXRoUHJvdmlkZXIuRkFDRUJPT0tfU0lHTl9JTl9NRVRIT0QgPSBcImZhY2Vib29rLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5GQUNFQk9PSyAqLztcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5GQUNFQk9PSy4gKi9cbkZhY2Vib29rQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJmYWNlYm9vay5jb21cIiAvKiBQcm92aWRlcklkLkZBQ0VCT09LICovO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhbiB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmb3Ige0BsaW5rIFByb3ZpZGVySWR9LkdPT0dMRS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogLy8gU2lnbiBpbiB1c2luZyBhIHJlZGlyZWN0LlxuICogY29uc3QgcHJvdmlkZXIgPSBuZXcgR29vZ2xlQXV0aFByb3ZpZGVyKCk7XG4gKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuXG4gKiBwcm92aWRlci5hZGRTY29wZSgncHJvZmlsZScpO1xuICogcHJvdmlkZXIuYWRkU2NvcGUoJ2VtYWlsJyk7XG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXG4gKlxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XG4gKiBpZiAocmVzdWx0KSB7XG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBHb29nbGUgQWNjZXNzIFRva2VuLlxuICogICBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBHb29nbGVBdXRoUHJvdmlkZXIoKTtcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdwcm9maWxlJyk7XG4gKiBwcm92aWRlci5hZGRTY29wZSgnZW1haWwnKTtcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XG4gKlxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIEdvb2dsZSBBY2Nlc3MgVG9rZW4uXG4gKiBjb25zdCBjcmVkZW50aWFsID0gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XG4gKiBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XG4gKiBgYGBcbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdvb2dsZUF1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoXCJnb29nbGUuY29tXCIgLyogUHJvdmlkZXJJZC5HT09HTEUgKi8pO1xuICAgICAgICB0aGlzLmFkZFNjb3BlKCdwcm9maWxlJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBjcmVkZW50aWFsIGZvciBHb29nbGUuIEF0IGxlYXN0IG9uZSBvZiBJRCB0b2tlbiBhbmQgYWNjZXNzIHRva2VuIGlzIHJlcXVpcmVkLlxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogLy8gXFxgZ29vZ2xlVXNlclxcYCBmcm9tIHRoZSBvbnN1Y2Nlc3MgR29vZ2xlIFNpZ24gSW4gY2FsbGJhY2suXG4gICAgICogY29uc3QgY3JlZGVudGlhbCA9IEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsKGdvb2dsZVVzZXIuZ2V0QXV0aFJlc3BvbnNlKCkuaWRfdG9rZW4pO1xuICAgICAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhDcmVkZW50aWFsKGNyZWRlbnRpYWwpO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHBhcmFtIGlkVG9rZW4gLSBHb29nbGUgSUQgdG9rZW4uXG4gICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gR29vZ2xlIGFjY2VzcyB0b2tlbi5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbChpZFRva2VuLCBhY2Nlc3NUb2tlbikge1xuICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEdvb2dsZUF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogR29vZ2xlQXV0aFByb3ZpZGVyLkdPT0dMRV9TSUdOX0lOX01FVEhPRCxcbiAgICAgICAgICAgIGlkVG9rZW4sXG4gICAgICAgICAgICBhY2Nlc3NUb2tlblxuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHtcbiAgICAgICAgcmV0dXJuIEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh1c2VyQ3JlZGVudGlhbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIEF1dGhFcnJvcn0gd2hpY2ggd2FzXG4gICAgICogdGhyb3duIGR1cmluZyBhIHNpZ24taW4sIGxpbmssIG9yIHJlYXV0aGVudGljYXRlIG9wZXJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXG4gICAgICovXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tRXJyb3IoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIEdvb2dsZUF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBvYXV0aElkVG9rZW4sIG9hdXRoQWNjZXNzVG9rZW4gfSA9IHRva2VuUmVzcG9uc2U7XG4gICAgICAgIGlmICghb2F1dGhJZFRva2VuICYmICFvYXV0aEFjY2Vzc1Rva2VuKSB7XG4gICAgICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIGFuIG9hdXRoIDEgY3JlZGVudGlhbCBvciBhIHBob25lIGNyZWRlbnRpYWxcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gR29vZ2xlQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWwob2F1dGhJZFRva2VuLCBvYXV0aEFjY2Vzc1Rva2VuKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoX2EpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFNpZ25Jbk1ldGhvZH0uR09PR0xFLiAqL1xuR29vZ2xlQXV0aFByb3ZpZGVyLkdPT0dMRV9TSUdOX0lOX01FVEhPRCA9IFwiZ29vZ2xlLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5HT09HTEUgKi87XG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgUHJvdmlkZXJJZH0uR09PR0xFLiAqL1xuR29vZ2xlQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJnb29nbGUuY29tXCIgLyogUHJvdmlkZXJJZC5HT09HTEUgKi87XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGFuIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZvciB7QGxpbmsgUHJvdmlkZXJJZH0uR0lUSFVCLlxuICpcbiAqIEByZW1hcmtzXG4gKiBHaXRIdWIgcmVxdWlyZXMgYW4gT0F1dGggMi4wIHJlZGlyZWN0LCBzbyB5b3UgY2FuIGVpdGhlciBoYW5kbGUgdGhlIHJlZGlyZWN0IGRpcmVjdGx5LCBvciB1c2VcbiAqIHRoZSB7QGxpbmsgc2lnbkluV2l0aFBvcHVwfSBoYW5kbGVyOlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBHaXRodWJBdXRoUHJvdmlkZXIoKTtcbiAqIC8vIFN0YXJ0IGEgc2lnbiBpbiBwcm9jZXNzIGZvciBhbiB1bmF1dGhlbnRpY2F0ZWQgdXNlci5cbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdyZXBvJyk7XG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXG4gKlxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XG4gKiBpZiAocmVzdWx0KSB7XG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBHaXRIdWIgQWNjZXNzIFRva2VuLlxuICogICBjb25zdCBjcmVkZW50aWFsID0gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tUmVzdWx0KHJlc3VsdCk7XG4gKiAgIGNvbnN0IHRva2VuID0gY3JlZGVudGlhbC5hY2Nlc3NUb2tlbjtcbiAqIH1cbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcG9wdXAuXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBHaXRodWJBdXRoUHJvdmlkZXIoKTtcbiAqIHByb3ZpZGVyLmFkZFNjb3BlKCdyZXBvJyk7XG4gKiBjb25zdCByZXN1bHQgPSBhd2FpdCBzaWduSW5XaXRoUG9wdXAoYXV0aCwgcHJvdmlkZXIpO1xuICpcbiAqIC8vIFRoZSBzaWduZWQtaW4gdXNlciBpbmZvLlxuICogY29uc3QgdXNlciA9IHJlc3VsdC51c2VyO1xuICogLy8gVGhpcyBnaXZlcyB5b3UgYSBHaXRIdWIgQWNjZXNzIFRva2VuLlxuICogY29uc3QgY3JlZGVudGlhbCA9IEdpdGh1YkF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xuICogYGBgXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIEdpdGh1YkF1dGhQcm92aWRlciBleHRlbmRzIEJhc2VPQXV0aFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoXCJnaXRodWIuY29tXCIgLyogUHJvdmlkZXJJZC5HSVRIVUIgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgR2l0SHViLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFjY2Vzc1Rva2VuIC0gR2l0SHViIGFjY2VzcyB0b2tlbi5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbChhY2Nlc3NUb2tlbikge1xuICAgICAgICByZXR1cm4gT0F1dGhDcmVkZW50aWFsLl9mcm9tUGFyYW1zKHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IEdpdGh1YkF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogR2l0aHViQXV0aFByb3ZpZGVyLkdJVEhVQl9TSUdOX0lOX01FVEhPRCxcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVc2VkIHRvIGV4dHJhY3QgdGhlIHVuZGVybHlpbmcge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZnJvbSBhIHtAbGluayBVc2VyQ3JlZGVudGlhbH0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxuICAgICAqL1xuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVJlc3VsdCh1c2VyQ3JlZGVudGlhbCkge1xuICAgICAgICByZXR1cm4gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikge1xuICAgICAgICByZXR1cm4gR2l0aHViQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KChlcnJvci5jdXN0b21EYXRhIHx8IHt9KSk7XG4gICAgfVxuICAgIHN0YXRpYyBjcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCh7IF90b2tlblJlc3BvbnNlOiB0b2tlblJlc3BvbnNlIH0pIHtcbiAgICAgICAgaWYgKCF0b2tlblJlc3BvbnNlIHx8ICEoJ29hdXRoQWNjZXNzVG9rZW4nIGluIHRva2VuUmVzcG9uc2UpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2Uub2F1dGhBY2Nlc3NUb2tlbikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBHaXRodWJBdXRoUHJvdmlkZXIuY3JlZGVudGlhbCh0b2tlblJlc3BvbnNlLm9hdXRoQWNjZXNzVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfYSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5HSVRIVUIuICovXG5HaXRodWJBdXRoUHJvdmlkZXIuR0lUSFVCX1NJR05fSU5fTUVUSE9EID0gXCJnaXRodWIuY29tXCIgLyogU2lnbkluTWV0aG9kLkdJVEhVQiAqLztcbi8qKiBBbHdheXMgc2V0IHRvIHtAbGluayBQcm92aWRlcklkfS5HSVRIVUIuICovXG5HaXRodWJBdXRoUHJvdmlkZXIuUFJPVklERVJfSUQgPSBcImdpdGh1Yi5jb21cIiAvKiBQcm92aWRlcklkLkdJVEhVQiAqLztcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IElEUF9SRVFVRVNUX1VSSSA9ICdodHRwOi8vbG9jYWxob3N0Jztcbi8qKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBTQU1MQXV0aENyZWRlbnRpYWwgZXh0ZW5kcyBBdXRoQ3JlZGVudGlhbCB7XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGNvbnN0cnVjdG9yKHByb3ZpZGVySWQsIHBlbmRpbmdUb2tlbikge1xuICAgICAgICBzdXBlcihwcm92aWRlcklkLCBwcm92aWRlcklkKTtcbiAgICAgICAgdGhpcy5wZW5kaW5nVG9rZW4gPSBwZW5kaW5nVG9rZW47XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZ2V0SWRUb2tlblJlc3BvbnNlKGF1dGgpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7XG4gICAgICAgIHJldHVybiBzaWduSW5XaXRoSWRwKGF1dGgsIHJlcXVlc3QpO1xuICAgIH1cbiAgICAvKiogQGludGVybmFsICovXG4gICAgX2xpbmtUb0lkVG9rZW4oYXV0aCwgaWRUb2tlbikge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5idWlsZFJlcXVlc3QoKTtcbiAgICAgICAgcmVxdWVzdC5pZFRva2VuID0gaWRUb2tlbjtcbiAgICAgICAgcmV0dXJuIHNpZ25JbldpdGhJZHAoYXV0aCwgcmVxdWVzdCk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBfZ2V0UmVhdXRoZW50aWNhdGlvblJlc29sdmVyKGF1dGgpIHtcbiAgICAgICAgY29uc3QgcmVxdWVzdCA9IHRoaXMuYnVpbGRSZXF1ZXN0KCk7XG4gICAgICAgIHJlcXVlc3QuYXV0b0NyZWF0ZSA9IGZhbHNlO1xuICAgICAgICByZXR1cm4gc2lnbkluV2l0aElkcChhdXRoLCByZXF1ZXN0KTtcbiAgICB9XG4gICAgLyoqIHtAaW5oZXJpdGRvYyBBdXRoQ3JlZGVudGlhbC50b0pTT059ICAqL1xuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogdGhpcy5zaWduSW5NZXRob2QsXG4gICAgICAgICAgICBwcm92aWRlcklkOiB0aGlzLnByb3ZpZGVySWQsXG4gICAgICAgICAgICBwZW5kaW5nVG9rZW46IHRoaXMucGVuZGluZ1Rva2VuXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXRpYyBtZXRob2QgdG8gZGVzZXJpYWxpemUgYSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIGFuIG9iamVjdCBpbnRvIGFuXG4gICAgICoge0BsaW5rICBBdXRoQ3JlZGVudGlhbH0uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ganNvbiAtIElucHV0IGNhbiBiZSBlaXRoZXIgT2JqZWN0IG9yIHRoZSBzdHJpbmdpZmllZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgb2JqZWN0LlxuICAgICAqIFdoZW4gc3RyaW5nIGlzIHByb3ZpZGVkLCBKU09OLnBhcnNlIHdvdWxkIGJlIGNhbGxlZCBmaXJzdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIElmIHRoZSBKU09OIGlucHV0IGRvZXMgbm90IHJlcHJlc2VudCBhbiB7QGxpbmsgIEF1dGhDcmVkZW50aWFsfSwgbnVsbCBpcyByZXR1cm5lZC5cbiAgICAgKi9cbiAgICBzdGF0aWMgZnJvbUpTT04oanNvbikge1xuICAgICAgICBjb25zdCBvYmogPSB0eXBlb2YganNvbiA9PT0gJ3N0cmluZycgPyBKU09OLnBhcnNlKGpzb24pIDoganNvbjtcbiAgICAgICAgY29uc3QgeyBwcm92aWRlcklkLCBzaWduSW5NZXRob2QsIHBlbmRpbmdUb2tlbiB9ID0gb2JqO1xuICAgICAgICBpZiAoIXByb3ZpZGVySWQgfHxcbiAgICAgICAgICAgICFzaWduSW5NZXRob2QgfHxcbiAgICAgICAgICAgICFwZW5kaW5nVG9rZW4gfHxcbiAgICAgICAgICAgIHByb3ZpZGVySWQgIT09IHNpZ25Jbk1ldGhvZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBTQU1MQXV0aENyZWRlbnRpYWwocHJvdmlkZXJJZCwgcGVuZGluZ1Rva2VuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSGVscGVyIHN0YXRpYyBtZXRob2QgdG8gYXZvaWQgZXhwb3NpbmcgdGhlIGNvbnN0cnVjdG9yIHRvIGVuZCB1c2Vycy5cbiAgICAgKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIHN0YXRpYyBfY3JlYXRlKHByb3ZpZGVySWQsIHBlbmRpbmdUb2tlbikge1xuICAgICAgICByZXR1cm4gbmV3IFNBTUxBdXRoQ3JlZGVudGlhbChwcm92aWRlcklkLCBwZW5kaW5nVG9rZW4pO1xuICAgIH1cbiAgICBidWlsZFJlcXVlc3QoKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICByZXF1ZXN0VXJpOiBJRFBfUkVRVUVTVF9VUkksXG4gICAgICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZSxcbiAgICAgICAgICAgIHBlbmRpbmdUb2tlbjogdGhpcy5wZW5kaW5nVG9rZW5cbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBTQU1MX1BST1ZJREVSX1BSRUZJWCA9ICdzYW1sLic7XG4vKipcbiAqIEFuIHtAbGluayBBdXRoUHJvdmlkZXJ9IGZvciBTQU1MLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgU0FNTEF1dGhQcm92aWRlciBleHRlbmRzIEZlZGVyYXRlZEF1dGhQcm92aWRlciB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0b3IuIFRoZSBwcm92aWRlcklkIG11c3Qgc3RhcnQgd2l0aCBcInNhbWwuXCJcbiAgICAgKiBAcGFyYW0gcHJvdmlkZXJJZCAtIFNBTUwgcHJvdmlkZXIgSUQuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocHJvdmlkZXJJZCkge1xuICAgICAgICBfYXNzZXJ0KHByb3ZpZGVySWQuc3RhcnRzV2l0aChTQU1MX1BST1ZJREVSX1BSRUZJWCksIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgc3VwZXIocHJvdmlkZXJJZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdlbmVyYXRlcyBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgVXNlckNyZWRlbnRpYWx9IGFmdGVyIGFcbiAgICAgKiBzdWNjZXNzZnVsIFNBTUwgZmxvdyBjb21wbGV0ZXMuXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqXG4gICAgICogRm9yIGV4YW1wbGUsIHRvIGdldCBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9LCB5b3UgY291bGQgd3JpdGUgdGhlXG4gICAgICogZm9sbG93aW5nIGNvZGU6XG4gICAgICpcbiAgICAgKiBgYGBqc1xuICAgICAqIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgc2lnbkluV2l0aFBvcHVwKGF1dGgsIHNhbWxQcm92aWRlcik7XG4gICAgICogY29uc3QgY3JlZGVudGlhbCA9IFNBTUxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21SZXN1bHQodXNlckNyZWRlbnRpYWwpIHtcbiAgICAgICAgcmV0dXJuIFNBTUxBdXRoUHJvdmlkZXIuc2FtbENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikge1xuICAgICAgICByZXR1cm4gU0FNTEF1dGhQcm92aWRlci5zYW1sQ3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoKGVycm9yLmN1c3RvbURhdGEgfHwge30pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbiB7QGxpbmsgQXV0aENyZWRlbnRpYWx9IGZyb20gYSBKU09OIHN0cmluZyBvciBhIHBsYWluIG9iamVjdC5cbiAgICAgKiBAcGFyYW0ganNvbiAtIEEgcGxhaW4gb2JqZWN0IG9yIGEgSlNPTiBzdHJpbmdcbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21KU09OKGpzb24pIHtcbiAgICAgICAgY29uc3QgY3JlZGVudGlhbCA9IFNBTUxBdXRoQ3JlZGVudGlhbC5mcm9tSlNPTihqc29uKTtcbiAgICAgICAgX2Fzc2VydChjcmVkZW50aWFsLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XG4gICAgICAgIHJldHVybiBjcmVkZW50aWFsO1xuICAgIH1cbiAgICBzdGF0aWMgc2FtbENyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHsgX3Rva2VuUmVzcG9uc2U6IHRva2VuUmVzcG9uc2UgfSkge1xuICAgICAgICBpZiAoIXRva2VuUmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHsgcGVuZGluZ1Rva2VuLCBwcm92aWRlcklkIH0gPSB0b2tlblJlc3BvbnNlO1xuICAgICAgICBpZiAoIXBlbmRpbmdUb2tlbiB8fCAhcHJvdmlkZXJJZCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBTQU1MQXV0aENyZWRlbnRpYWwuX2NyZWF0ZShwcm92aWRlcklkLCBwZW5kaW5nVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUHJvdmlkZXIgZm9yIGdlbmVyYXRpbmcgYW4ge0BsaW5rIE9BdXRoQ3JlZGVudGlhbH0gZm9yIHtAbGluayBQcm92aWRlcklkfS5UV0lUVEVSLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBTaWduIGluIHVzaW5nIGEgcmVkaXJlY3QuXG4gKiBjb25zdCBwcm92aWRlciA9IG5ldyBUd2l0dGVyQXV0aFByb3ZpZGVyKCk7XG4gKiAvLyBTdGFydCBhIHNpZ24gaW4gcHJvY2VzcyBmb3IgYW4gdW5hdXRoZW50aWNhdGVkIHVzZXIuXG4gKiBhd2FpdCBzaWduSW5XaXRoUmVkaXJlY3QoYXV0aCwgcHJvdmlkZXIpO1xuICogLy8gVGhpcyB3aWxsIHRyaWdnZXIgYSBmdWxsIHBhZ2UgcmVkaXJlY3QgYXdheSBmcm9tIHlvdXIgYXBwXG4gKlxuICogLy8gQWZ0ZXIgcmV0dXJuaW5nIGZyb20gdGhlIHJlZGlyZWN0IHdoZW4geW91ciBhcHAgaW5pdGlhbGl6ZXMgeW91IGNhbiBvYnRhaW4gdGhlIHJlc3VsdFxuICogY29uc3QgcmVzdWx0ID0gYXdhaXQgZ2V0UmVkaXJlY3RSZXN1bHQoYXV0aCk7XG4gKiBpZiAocmVzdWx0KSB7XG4gKiAgIC8vIFRoaXMgaXMgdGhlIHNpZ25lZC1pbiB1c2VyXG4gKiAgIGNvbnN0IHVzZXIgPSByZXN1bHQudXNlcjtcbiAqICAgLy8gVGhpcyBnaXZlcyB5b3UgYSBUd2l0dGVyIEFjY2VzcyBUb2tlbiBhbmQgU2VjcmV0LlxuICogICBjb25zdCBjcmVkZW50aWFsID0gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xuICogICBjb25zdCB0b2tlbiA9IGNyZWRlbnRpYWwuYWNjZXNzVG9rZW47XG4gKiAgIGNvbnN0IHNlY3JldCA9IGNyZWRlbnRpYWwuc2VjcmV0O1xuICogfVxuICogYGBgXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIFNpZ24gaW4gdXNpbmcgYSBwb3B1cC5cbiAqIGNvbnN0IHByb3ZpZGVyID0gbmV3IFR3aXR0ZXJBdXRoUHJvdmlkZXIoKTtcbiAqIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpZ25JbldpdGhQb3B1cChhdXRoLCBwcm92aWRlcik7XG4gKlxuICogLy8gVGhlIHNpZ25lZC1pbiB1c2VyIGluZm8uXG4gKiBjb25zdCB1c2VyID0gcmVzdWx0LnVzZXI7XG4gKiAvLyBUaGlzIGdpdmVzIHlvdSBhIFR3aXR0ZXIgQWNjZXNzIFRva2VuIGFuZCBTZWNyZXQuXG4gKiBjb25zdCBjcmVkZW50aWFsID0gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVJlc3VsdChyZXN1bHQpO1xuICogY29uc3QgdG9rZW4gPSBjcmVkZW50aWFsLmFjY2Vzc1Rva2VuO1xuICogY29uc3Qgc2VjcmV0ID0gY3JlZGVudGlhbC5zZWNyZXQ7XG4gKiBgYGBcbiAqXG4gKiBAcHVibGljXG4gKi9cbmNsYXNzIFR3aXR0ZXJBdXRoUHJvdmlkZXIgZXh0ZW5kcyBCYXNlT0F1dGhQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKFwidHdpdHRlci5jb21cIiAvKiBQcm92aWRlcklkLlRXSVRURVIgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgY3JlZGVudGlhbCBmb3IgVHdpdHRlci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0b2tlbiAtIFR3aXR0ZXIgYWNjZXNzIHRva2VuLlxuICAgICAqIEBwYXJhbSBzZWNyZXQgLSBUd2l0dGVyIHNlY3JldC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbCh0b2tlbiwgc2VjcmV0KSB7XG4gICAgICAgIHJldHVybiBPQXV0aENyZWRlbnRpYWwuX2Zyb21QYXJhbXMoe1xuICAgICAgICAgICAgcHJvdmlkZXJJZDogVHdpdHRlckF1dGhQcm92aWRlci5QUk9WSURFUl9JRCxcbiAgICAgICAgICAgIHNpZ25Jbk1ldGhvZDogVHdpdHRlckF1dGhQcm92aWRlci5UV0lUVEVSX1NJR05fSU5fTUVUSE9ELFxuICAgICAgICAgICAgb2F1dGhUb2tlbjogdG9rZW4sXG4gICAgICAgICAgICBvYXV0aFRva2VuU2VjcmV0OiBzZWNyZXRcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVzZWQgdG8gZXh0cmFjdCB0aGUgdW5kZXJseWluZyB7QGxpbmsgT0F1dGhDcmVkZW50aWFsfSBmcm9tIGEge0BsaW5rIFVzZXJDcmVkZW50aWFsfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1c2VyQ3JlZGVudGlhbCAtIFRoZSB1c2VyIGNyZWRlbnRpYWwuXG4gICAgICovXG4gICAgc3RhdGljIGNyZWRlbnRpYWxGcm9tUmVzdWx0KHVzZXJDcmVkZW50aWFsKSB7XG4gICAgICAgIHJldHVybiBUd2l0dGVyQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxGcm9tVGFnZ2VkT2JqZWN0KHVzZXJDcmVkZW50aWFsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXNlZCB0byBleHRyYWN0IHRoZSB1bmRlcmx5aW5nIHtAbGluayBPQXV0aENyZWRlbnRpYWx9IGZyb20gYSB7QGxpbmsgQXV0aEVycm9yfSB3aGljaCB3YXNcbiAgICAgKiB0aHJvd24gZHVyaW5nIGEgc2lnbi1pbiwgbGluaywgb3IgcmVhdXRoZW50aWNhdGUgb3BlcmF0aW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHVzZXJDcmVkZW50aWFsIC0gVGhlIHVzZXIgY3JlZGVudGlhbC5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21FcnJvcihlcnJvcikge1xuICAgICAgICByZXR1cm4gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsRnJvbVRhZ2dlZE9iamVjdCgoZXJyb3IuY3VzdG9tRGF0YSB8fCB7fSkpO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlZGVudGlhbEZyb21UYWdnZWRPYmplY3QoeyBfdG9rZW5SZXNwb25zZTogdG9rZW5SZXNwb25zZSB9KSB7XG4gICAgICAgIGlmICghdG9rZW5SZXNwb25zZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgeyBvYXV0aEFjY2Vzc1Rva2VuLCBvYXV0aFRva2VuU2VjcmV0IH0gPSB0b2tlblJlc3BvbnNlO1xuICAgICAgICBpZiAoIW9hdXRoQWNjZXNzVG9rZW4gfHwgIW9hdXRoVG9rZW5TZWNyZXQpIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICByZXR1cm4gVHdpdHRlckF1dGhQcm92aWRlci5jcmVkZW50aWFsKG9hdXRoQWNjZXNzVG9rZW4sIG9hdXRoVG9rZW5TZWNyZXQpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfYSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG59XG4vKiogQWx3YXlzIHNldCB0byB7QGxpbmsgU2lnbkluTWV0aG9kfS5UV0lUVEVSLiAqL1xuVHdpdHRlckF1dGhQcm92aWRlci5UV0lUVEVSX1NJR05fSU5fTUVUSE9EID0gXCJ0d2l0dGVyLmNvbVwiIC8qIFNpZ25Jbk1ldGhvZC5UV0lUVEVSICovO1xuLyoqIEFsd2F5cyBzZXQgdG8ge0BsaW5rIFByb3ZpZGVySWR9LlRXSVRURVIuICovXG5Ud2l0dGVyQXV0aFByb3ZpZGVyLlBST1ZJREVSX0lEID0gXCJ0d2l0dGVyLmNvbVwiIC8qIFByb3ZpZGVySWQuVFdJVFRFUiAqLztcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpZ25VcChhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtU2lnbkluUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOnNpZ25VcFwiIC8qIEVuZHBvaW50LlNJR05fVVAgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBVc2VyQ3JlZGVudGlhbEltcGwge1xuICAgIGNvbnN0cnVjdG9yKHBhcmFtcykge1xuICAgICAgICB0aGlzLnVzZXIgPSBwYXJhbXMudXNlcjtcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcGFyYW1zLnByb3ZpZGVySWQ7XG4gICAgICAgIHRoaXMuX3Rva2VuUmVzcG9uc2UgPSBwYXJhbXMuX3Rva2VuUmVzcG9uc2U7XG4gICAgICAgIHRoaXMub3BlcmF0aW9uVHlwZSA9IHBhcmFtcy5vcGVyYXRpb25UeXBlO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aCwgb3BlcmF0aW9uVHlwZSwgaWRUb2tlblJlc3BvbnNlLCBpc0Fub255bW91cyA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VySW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBpZFRva2VuUmVzcG9uc2UsIGlzQW5vbnltb3VzKTtcbiAgICAgICAgY29uc3QgcHJvdmlkZXJJZCA9IHByb3ZpZGVySWRGb3JSZXNwb25zZShpZFRva2VuUmVzcG9uc2UpO1xuICAgICAgICBjb25zdCB1c2VyQ3JlZCA9IG5ldyBVc2VyQ3JlZGVudGlhbEltcGwoe1xuICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgIHByb3ZpZGVySWQsXG4gICAgICAgICAgICBfdG9rZW5SZXNwb25zZTogaWRUb2tlblJlc3BvbnNlLFxuICAgICAgICAgICAgb3BlcmF0aW9uVHlwZVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHVzZXJDcmVkO1xuICAgIH1cbiAgICBzdGF0aWMgYXN5bmMgX2Zvck9wZXJhdGlvbih1c2VyLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSkge1xuICAgICAgICBhd2FpdCB1c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSwgLyogcmVsb2FkICovIHRydWUpO1xuICAgICAgICBjb25zdCBwcm92aWRlcklkID0gcHJvdmlkZXJJZEZvclJlc3BvbnNlKHJlc3BvbnNlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBVc2VyQ3JlZGVudGlhbEltcGwoe1xuICAgICAgICAgICAgdXNlcixcbiAgICAgICAgICAgIHByb3ZpZGVySWQsXG4gICAgICAgICAgICBfdG9rZW5SZXNwb25zZTogcmVzcG9uc2UsXG4gICAgICAgICAgICBvcGVyYXRpb25UeXBlXG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHByb3ZpZGVySWRGb3JSZXNwb25zZShyZXNwb25zZSkge1xuICAgIGlmIChyZXNwb25zZS5wcm92aWRlcklkKSB7XG4gICAgICAgIHJldHVybiByZXNwb25zZS5wcm92aWRlcklkO1xuICAgIH1cbiAgICBpZiAoJ3Bob25lTnVtYmVyJyBpbiByZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gXCJwaG9uZVwiIC8qIFByb3ZpZGVySWQuUEhPTkUgKi87XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBc3luY2hyb25vdXNseSBzaWducyBpbiBhcyBhbiBhbm9ueW1vdXMgdXNlci5cbiAqXG4gKiBAcmVtYXJrc1xuICogSWYgdGhlcmUgaXMgYWxyZWFkeSBhbiBhbm9ueW1vdXMgdXNlciBzaWduZWQgaW4sIHRoYXQgdXNlciB3aWxsIGJlIHJldHVybmVkOyBvdGhlcndpc2UsIGFcbiAqIG5ldyBhbm9ueW1vdXMgdXNlciBpZGVudGl0eSB3aWxsIGJlIGNyZWF0ZWQgYW5kIHJldHVybmVkLlxuICpcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbkFub255bW91c2x5KGF1dGgpIHtcbiAgICB2YXIgX2E7XG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKGF1dGguYXBwKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IoYXV0aCkpO1xuICAgIH1cbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XG4gICAgYXdhaXQgYXV0aEludGVybmFsLl9pbml0aWFsaXphdGlvblByb21pc2U7XG4gICAgaWYgKChfYSA9IGF1dGhJbnRlcm5hbC5jdXJyZW50VXNlcikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLmlzQW5vbnltb3VzKSB7XG4gICAgICAgIC8vIElmIGFuIGFub255bW91cyB1c2VyIGlzIGFscmVhZHkgc2lnbmVkIGluLCBubyBuZWVkIHRvIHNpZ24gdGhlbSBpbiBhZ2Fpbi5cbiAgICAgICAgcmV0dXJuIG5ldyBVc2VyQ3JlZGVudGlhbEltcGwoe1xuICAgICAgICAgICAgdXNlcjogYXV0aEludGVybmFsLmN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgcHJvdmlkZXJJZDogbnVsbCxcbiAgICAgICAgICAgIG9wZXJhdGlvblR5cGU6IFwic2lnbkluXCIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IHNpZ25VcChhdXRoSW50ZXJuYWwsIHtcbiAgICAgICAgcmV0dXJuU2VjdXJlVG9rZW46IHRydWVcbiAgICB9KTtcbiAgICBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IFVzZXJDcmVkZW50aWFsSW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoSW50ZXJuYWwsIFwic2lnbkluXCIgLyogT3BlcmF0aW9uVHlwZS5TSUdOX0lOICovLCByZXNwb25zZSwgdHJ1ZSk7XG4gICAgYXdhaXQgYXV0aEludGVybmFsLl91cGRhdGVDdXJyZW50VXNlcih1c2VyQ3JlZGVudGlhbC51c2VyKTtcbiAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBNdWx0aUZhY3RvckVycm9yIGV4dGVuZHMgRmlyZWJhc2VFcnJvciB7XG4gICAgY29uc3RydWN0b3IoYXV0aCwgZXJyb3IsIG9wZXJhdGlvblR5cGUsIHVzZXIpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBzdXBlcihlcnJvci5jb2RlLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgdGhpcy5vcGVyYXRpb25UeXBlID0gb3BlcmF0aW9uVHlwZTtcbiAgICAgICAgdGhpcy51c2VyID0gdXNlcjtcbiAgICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL01pY3Jvc29mdC9UeXBlU2NyaXB0LXdpa2kvYmxvYi9tYXN0ZXIvQnJlYWtpbmctQ2hhbmdlcy5tZCNleHRlbmRpbmctYnVpbHQtaW5zLWxpa2UtZXJyb3ItYXJyYXktYW5kLW1hcC1tYXktbm8tbG9uZ2VyLXdvcmtcbiAgICAgICAgT2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsIE11bHRpRmFjdG9yRXJyb3IucHJvdG90eXBlKTtcbiAgICAgICAgdGhpcy5jdXN0b21EYXRhID0ge1xuICAgICAgICAgICAgYXBwTmFtZTogYXV0aC5uYW1lLFxuICAgICAgICAgICAgdGVuYW50SWQ6IChfYSA9IGF1dGgudGVuYW50SWQpICE9PSBudWxsICYmIF9hICE9PSB2b2lkIDAgPyBfYSA6IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIF9zZXJ2ZXJSZXNwb25zZTogZXJyb3IuY3VzdG9tRGF0YS5fc2VydmVyUmVzcG9uc2UsXG4gICAgICAgICAgICBvcGVyYXRpb25UeXBlXG4gICAgICAgIH07XG4gICAgfVxuICAgIHN0YXRpYyBfZnJvbUVycm9yQW5kT3BlcmF0aW9uKGF1dGgsIGVycm9yLCBvcGVyYXRpb25UeXBlLCB1c2VyKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JFcnJvcihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7XG4gICAgfVxufVxuZnVuY3Rpb24gX3Byb2Nlc3NDcmVkZW50aWFsU2F2aW5nTWZhQ29udGV4dElmTmVjZXNzYXJ5KGF1dGgsIG9wZXJhdGlvblR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpIHtcbiAgICBjb25zdCBpZFRva2VuUHJvdmlkZXIgPSBvcGVyYXRpb25UeXBlID09PSBcInJlYXV0aGVudGljYXRlXCIgLyogT3BlcmF0aW9uVHlwZS5SRUFVVEhFTlRJQ0FURSAqL1xuICAgICAgICA/IGNyZWRlbnRpYWwuX2dldFJlYXV0aGVudGljYXRpb25SZXNvbHZlcihhdXRoKVxuICAgICAgICA6IGNyZWRlbnRpYWwuX2dldElkVG9rZW5SZXNwb25zZShhdXRoKTtcbiAgICByZXR1cm4gaWRUb2tlblByb3ZpZGVyLmNhdGNoKGVycm9yID0+IHtcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGBhdXRoLyR7XCJtdWx0aS1mYWN0b3ItYXV0aC1yZXF1aXJlZFwiIC8qIEF1dGhFcnJvckNvZGUuTUZBX1JFUVVJUkVEICovfWApIHtcbiAgICAgICAgICAgIHRocm93IE11bHRpRmFjdG9yRXJyb3IuX2Zyb21FcnJvckFuZE9wZXJhdGlvbihhdXRoLCBlcnJvciwgb3BlcmF0aW9uVHlwZSwgdXNlcik7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRha2VzIGEgc2V0IG9mIFVzZXJJbmZvIHByb3ZpZGVyIGRhdGEgYW5kIGNvbnZlcnRzIGl0IHRvIGEgc2V0IG9mIG5hbWVzXG4gKi9cbmZ1bmN0aW9uIHByb3ZpZGVyRGF0YUFzTmFtZXMocHJvdmlkZXJEYXRhKSB7XG4gICAgcmV0dXJuIG5ldyBTZXQocHJvdmlkZXJEYXRhXG4gICAgICAgIC5tYXAoKHsgcHJvdmlkZXJJZCB9KSA9PiBwcm92aWRlcklkKVxuICAgICAgICAuZmlsdGVyKHBpZCA9PiAhIXBpZCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBVbmxpbmtzIGEgcHJvdmlkZXIgZnJvbSBhIHVzZXIgYWNjb3VudC5cbiAqXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxuICogQHBhcmFtIHByb3ZpZGVySWQgLSBUaGUgcHJvdmlkZXIgdG8gdW5saW5rLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gdW5saW5rKHVzZXIsIHByb3ZpZGVySWQpIHtcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XG4gICAgYXdhaXQgX2Fzc2VydExpbmtlZFN0YXR1cyh0cnVlLCB1c2VySW50ZXJuYWwsIHByb3ZpZGVySWQpO1xuICAgIGNvbnN0IHsgcHJvdmlkZXJVc2VySW5mbyB9ID0gYXdhaXQgZGVsZXRlTGlua2VkQWNjb3VudHModXNlckludGVybmFsLmF1dGgsIHtcbiAgICAgICAgaWRUb2tlbjogYXdhaXQgdXNlckludGVybmFsLmdldElkVG9rZW4oKSxcbiAgICAgICAgZGVsZXRlUHJvdmlkZXI6IFtwcm92aWRlcklkXVxuICAgIH0pO1xuICAgIGNvbnN0IHByb3ZpZGVyc0xlZnQgPSBwcm92aWRlckRhdGFBc05hbWVzKHByb3ZpZGVyVXNlckluZm8gfHwgW10pO1xuICAgIHVzZXJJbnRlcm5hbC5wcm92aWRlckRhdGEgPSB1c2VySW50ZXJuYWwucHJvdmlkZXJEYXRhLmZpbHRlcihwZCA9PiBwcm92aWRlcnNMZWZ0LmhhcyhwZC5wcm92aWRlcklkKSk7XG4gICAgaWYgKCFwcm92aWRlcnNMZWZ0LmhhcyhcInBob25lXCIgLyogUHJvdmlkZXJJZC5QSE9ORSAqLykpIHtcbiAgICAgICAgdXNlckludGVybmFsLnBob25lTnVtYmVyID0gbnVsbDtcbiAgICB9XG4gICAgYXdhaXQgdXNlckludGVybmFsLmF1dGguX3BlcnNpc3RVc2VySWZDdXJyZW50KHVzZXJJbnRlcm5hbCk7XG4gICAgcmV0dXJuIHVzZXJJbnRlcm5hbDtcbn1cbmFzeW5jIGZ1bmN0aW9uIF9saW5rKHVzZXIsIGNyZWRlbnRpYWwsIGJ5cGFzc0F1dGhTdGF0ZSA9IGZhbHNlKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCBjcmVkZW50aWFsLl9saW5rVG9JZFRva2VuKHVzZXIuYXV0aCwgYXdhaXQgdXNlci5nZXRJZFRva2VuKCkpLCBieXBhc3NBdXRoU3RhdGUpO1xuICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbih1c2VyLCBcImxpbmtcIiAvKiBPcGVyYXRpb25UeXBlLkxJTksgKi8sIHJlc3BvbnNlKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIF9hc3NlcnRMaW5rZWRTdGF0dXMoZXhwZWN0ZWQsIHVzZXIsIHByb3ZpZGVyKSB7XG4gICAgYXdhaXQgX3JlbG9hZFdpdGhvdXRTYXZpbmcodXNlcik7XG4gICAgY29uc3QgcHJvdmlkZXJJZHMgPSBwcm92aWRlckRhdGFBc05hbWVzKHVzZXIucHJvdmlkZXJEYXRhKTtcbiAgICBjb25zdCBjb2RlID0gZXhwZWN0ZWQgPT09IGZhbHNlXG4gICAgICAgID8gXCJwcm92aWRlci1hbHJlYWR5LWxpbmtlZFwiIC8qIEF1dGhFcnJvckNvZGUuUFJPVklERVJfQUxSRUFEWV9MSU5LRUQgKi9cbiAgICAgICAgOiBcIm5vLXN1Y2gtcHJvdmlkZXJcIiAvKiBBdXRoRXJyb3JDb2RlLk5PX1NVQ0hfUFJPVklERVIgKi87XG4gICAgX2Fzc2VydChwcm92aWRlcklkcy5oYXMocHJvdmlkZXIpID09PSBleHBlY3RlZCwgdXNlci5hdXRoLCBjb2RlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIF9yZWF1dGhlbnRpY2F0ZSh1c2VyLCBjcmVkZW50aWFsLCBieXBhc3NBdXRoU3RhdGUgPSBmYWxzZSkge1xuICAgIGNvbnN0IHsgYXV0aCB9ID0gdXNlcjtcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXV0aC5hcHApKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcihhdXRoKSk7XG4gICAgfVxuICAgIGNvbnN0IG9wZXJhdGlvblR5cGUgPSBcInJlYXV0aGVudGljYXRlXCIgLyogT3BlcmF0aW9uVHlwZS5SRUFVVEhFTlRJQ0FURSAqLztcbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXIsIF9wcm9jZXNzQ3JlZGVudGlhbFNhdmluZ01mYUNvbnRleHRJZk5lY2Vzc2FyeShhdXRoLCBvcGVyYXRpb25UeXBlLCBjcmVkZW50aWFsLCB1c2VyKSwgYnlwYXNzQXV0aFN0YXRlKTtcbiAgICAgICAgX2Fzc2VydChyZXNwb25zZS5pZFRva2VuLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IF9wYXJzZVRva2VuKHJlc3BvbnNlLmlkVG9rZW4pO1xuICAgICAgICBfYXNzZXJ0KHBhcnNlZCwgYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgICAgICBjb25zdCB7IHN1YjogbG9jYWxJZCB9ID0gcGFyc2VkO1xuICAgICAgICBfYXNzZXJ0KHVzZXIudWlkID09PSBsb2NhbElkLCBhdXRoLCBcInVzZXItbWlzbWF0Y2hcIiAvKiBBdXRoRXJyb3JDb2RlLlVTRVJfTUlTTUFUQ0ggKi8pO1xuICAgICAgICByZXR1cm4gVXNlckNyZWRlbnRpYWxJbXBsLl9mb3JPcGVyYXRpb24odXNlciwgb3BlcmF0aW9uVHlwZSwgcmVzcG9uc2UpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvLyBDb252ZXJ0IHVzZXIgZGVsZXRlZCBlcnJvciBpbnRvIHVzZXIgbWlzbWF0Y2hcbiAgICAgICAgaWYgKChlID09PSBudWxsIHx8IGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGUuY29kZSkgPT09IGBhdXRoLyR7XCJ1c2VyLW5vdC1mb3VuZFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9ERUxFVEVEICovfWApIHtcbiAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwidXNlci1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuVVNFUl9NSVNNQVRDSCAqLyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiBfc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aCwgY3JlZGVudGlhbCwgYnlwYXNzQXV0aFN0YXRlID0gZmFsc2UpIHtcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXV0aC5hcHApKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvcihhdXRoKSk7XG4gICAgfVxuICAgIGNvbnN0IG9wZXJhdGlvblR5cGUgPSBcInNpZ25JblwiIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLztcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9wcm9jZXNzQ3JlZGVudGlhbFNhdmluZ01mYUNvbnRleHRJZk5lY2Vzc2FyeShhdXRoLCBvcGVyYXRpb25UeXBlLCBjcmVkZW50aWFsKTtcbiAgICBjb25zdCB1c2VyQ3JlZGVudGlhbCA9IGF3YWl0IFVzZXJDcmVkZW50aWFsSW1wbC5fZnJvbUlkVG9rZW5SZXNwb25zZShhdXRoLCBvcGVyYXRpb25UeXBlLCByZXNwb25zZSk7XG4gICAgaWYgKCFieXBhc3NBdXRoU3RhdGUpIHtcbiAgICAgICAgYXdhaXQgYXV0aC5fdXBkYXRlQ3VycmVudFVzZXIodXNlckNyZWRlbnRpYWwudXNlcik7XG4gICAgfVxuICAgIHJldHVybiB1c2VyQ3JlZGVudGlhbDtcbn1cbi8qKlxuICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gd2l0aCB0aGUgZ2l2ZW4gY3JlZGVudGlhbHMuXG4gKlxuICogQHJlbWFya3NcbiAqIEFuIHtAbGluayBBdXRoUHJvdmlkZXJ9IGNhbiBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjcmVkZW50aWFsLlxuICpcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBjcmVkZW50aWFsIC0gVGhlIGF1dGggY3JlZGVudGlhbC5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhDcmVkZW50aWFsKGF1dGgsIGNyZWRlbnRpYWwpIHtcbiAgICByZXR1cm4gX3NpZ25JbldpdGhDcmVkZW50aWFsKF9jYXN0QXV0aChhdXRoKSwgY3JlZGVudGlhbCk7XG59XG4vKipcbiAqIExpbmtzIHRoZSB1c2VyIGFjY291bnQgd2l0aCB0aGUgZ2l2ZW4gY3JlZGVudGlhbHMuXG4gKlxuICogQHJlbWFya3NcbiAqIEFuIHtAbGluayBBdXRoUHJvdmlkZXJ9IGNhbiBiZSB1c2VkIHRvIGdlbmVyYXRlIHRoZSBjcmVkZW50aWFsLlxuICpcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXG4gKiBAcGFyYW0gY3JlZGVudGlhbCAtIFRoZSBhdXRoIGNyZWRlbnRpYWwuXG4gKlxuICogQHB1YmxpY1xuICovXG5hc3luYyBmdW5jdGlvbiBsaW5rV2l0aENyZWRlbnRpYWwodXNlciwgY3JlZGVudGlhbCkge1xuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcbiAgICBhd2FpdCBfYXNzZXJ0TGlua2VkU3RhdHVzKGZhbHNlLCB1c2VySW50ZXJuYWwsIGNyZWRlbnRpYWwucHJvdmlkZXJJZCk7XG4gICAgcmV0dXJuIF9saW5rKHVzZXJJbnRlcm5hbCwgY3JlZGVudGlhbCk7XG59XG4vKipcbiAqIFJlLWF1dGhlbnRpY2F0ZXMgYSB1c2VyIHVzaW5nIGEgZnJlc2ggY3JlZGVudGlhbC5cbiAqXG4gKiBAcmVtYXJrc1xuICogVXNlIGJlZm9yZSBvcGVyYXRpb25zIHN1Y2ggYXMge0BsaW5rIHVwZGF0ZVBhc3N3b3JkfSB0aGF0IHJlcXVpcmUgdG9rZW5zIGZyb20gcmVjZW50IHNpZ24taW5cbiAqIGF0dGVtcHRzLiBUaGlzIG1ldGhvZCBjYW4gYmUgdXNlZCB0byByZWNvdmVyIGZyb20gYSBgQ1JFREVOVElBTF9UT09fT0xEX0xPR0lOX0FHQUlOYCBlcnJvclxuICogb3IgYSBgVE9LRU5fRVhQSVJFRGAgZXJyb3IuXG4gKlxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBvbiBhbnkge0BsaW5rIFVzZXJ9IHNpZ25lZCBpbiBieSB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzXG4gKiBjcmVhdGVkIHdpdGggYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXG4gKlxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cbiAqIEBwYXJhbSBjcmVkZW50aWFsIC0gVGhlIGF1dGggY3JlZGVudGlhbC5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWwodXNlciwgY3JlZGVudGlhbCkge1xuICAgIHJldHVybiBfcmVhdXRoZW50aWNhdGUoZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpLCBjcmVkZW50aWFsKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhDdXN0b21Ub2tlbiQxKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1TaWduSW5SZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjEvYWNjb3VudHM6c2lnbkluV2l0aEN1c3RvbVRva2VuXCIgLyogRW5kcG9pbnQuU0lHTl9JTl9XSVRIX0NVU1RPTV9UT0tFTiAqLywgX2FkZFRpZElmTmVjZXNzYXJ5KGF1dGgsIHJlcXVlc3QpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gdXNpbmcgYSBjdXN0b20gdG9rZW4uXG4gKlxuICogQHJlbWFya3NcbiAqIEN1c3RvbSB0b2tlbnMgYXJlIHVzZWQgdG8gaW50ZWdyYXRlIEZpcmViYXNlIEF1dGggd2l0aCBleGlzdGluZyBhdXRoIHN5c3RlbXMsIGFuZCBtdXN0XG4gKiBiZSBnZW5lcmF0ZWQgYnkgYW4gYXV0aCBiYWNrZW5kIHVzaW5nIHRoZVxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL3JlZmVyZW5jZS9hZG1pbi9ub2RlL2FkbWluLmF1dGguQXV0aCNjcmVhdGVjdXN0b210b2tlbiB8IGNyZWF0ZUN1c3RvbVRva2VufVxuICogbWV0aG9kIGluIHRoZSB7QGxpbmsgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvYXV0aC9hZG1pbiB8IEFkbWluIFNES30gLlxuICpcbiAqIEZhaWxzIHdpdGggYW4gZXJyb3IgaWYgdGhlIHRva2VuIGlzIGludmFsaWQsIGV4cGlyZWQsIG9yIG5vdCBhY2NlcHRlZCBieSB0aGUgRmlyZWJhc2UgQXV0aCBzZXJ2aWNlLlxuICpcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBjdXN0b21Ub2tlbiAtIFRoZSBjdXN0b20gdG9rZW4gdG8gc2lnbiBpbiB3aXRoLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2lnbkluV2l0aEN1c3RvbVRva2VuKGF1dGgsIGN1c3RvbVRva2VuKSB7XG4gICAgaWYgKF9pc0ZpcmViYXNlU2VydmVyQXBwKGF1dGguYXBwKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IoYXV0aCkpO1xuICAgIH1cbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzaWduSW5XaXRoQ3VzdG9tVG9rZW4kMShhdXRoSW50ZXJuYWwsIHtcbiAgICAgICAgdG9rZW46IGN1c3RvbVRva2VuLFxuICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZVxuICAgIH0pO1xuICAgIGNvbnN0IGNyZWQgPSBhd2FpdCBVc2VyQ3JlZGVudGlhbEltcGwuX2Zyb21JZFRva2VuUmVzcG9uc2UoYXV0aEludGVybmFsLCBcInNpZ25JblwiIC8qIE9wZXJhdGlvblR5cGUuU0lHTl9JTiAqLywgcmVzcG9uc2UpO1xuICAgIGF3YWl0IGF1dGhJbnRlcm5hbC5fdXBkYXRlQ3VycmVudFVzZXIoY3JlZC51c2VyKTtcbiAgICByZXR1cm4gY3JlZDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIE11bHRpRmFjdG9ySW5mb0ltcGwge1xuICAgIGNvbnN0cnVjdG9yKGZhY3RvcklkLCByZXNwb25zZSkge1xuICAgICAgICB0aGlzLmZhY3RvcklkID0gZmFjdG9ySWQ7XG4gICAgICAgIHRoaXMudWlkID0gcmVzcG9uc2UubWZhRW5yb2xsbWVudElkO1xuICAgICAgICB0aGlzLmVucm9sbG1lbnRUaW1lID0gbmV3IERhdGUocmVzcG9uc2UuZW5yb2xsZWRBdCkudG9VVENTdHJpbmcoKTtcbiAgICAgICAgdGhpcy5kaXNwbGF5TmFtZSA9IHJlc3BvbnNlLmRpc3BsYXlOYW1lO1xuICAgIH1cbiAgICBzdGF0aWMgX2Zyb21TZXJ2ZXJSZXNwb25zZShhdXRoLCBlbnJvbGxtZW50KSB7XG4gICAgICAgIGlmICgncGhvbmVJbmZvJyBpbiBlbnJvbGxtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gUGhvbmVNdWx0aUZhY3RvckluZm9JbXBsLl9mcm9tU2VydmVyUmVzcG9uc2UoYXV0aCwgZW5yb2xsbWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoJ3RvdHBJbmZvJyBpbiBlbnJvbGxtZW50KSB7XG4gICAgICAgICAgICByZXR1cm4gVG90cE11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZShhdXRoLCBlbnJvbGxtZW50KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gX2ZhaWwoYXV0aCwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgIH1cbn1cbmNsYXNzIFBob25lTXVsdGlGYWN0b3JJbmZvSW1wbCBleHRlbmRzIE11bHRpRmFjdG9ySW5mb0ltcGwge1xuICAgIGNvbnN0cnVjdG9yKHJlc3BvbnNlKSB7XG4gICAgICAgIHN1cGVyKFwicGhvbmVcIiAvKiBGYWN0b3JJZC5QSE9ORSAqLywgcmVzcG9uc2UpO1xuICAgICAgICB0aGlzLnBob25lTnVtYmVyID0gcmVzcG9uc2UucGhvbmVJbmZvO1xuICAgIH1cbiAgICBzdGF0aWMgX2Zyb21TZXJ2ZXJSZXNwb25zZShfYXV0aCwgZW5yb2xsbWVudCkge1xuICAgICAgICByZXR1cm4gbmV3IFBob25lTXVsdGlGYWN0b3JJbmZvSW1wbChlbnJvbGxtZW50KTtcbiAgICB9XG59XG5jbGFzcyBUb3RwTXVsdGlGYWN0b3JJbmZvSW1wbCBleHRlbmRzIE11bHRpRmFjdG9ySW5mb0ltcGwge1xuICAgIGNvbnN0cnVjdG9yKHJlc3BvbnNlKSB7XG4gICAgICAgIHN1cGVyKFwidG90cFwiIC8qIEZhY3RvcklkLlRPVFAgKi8sIHJlc3BvbnNlKTtcbiAgICB9XG4gICAgc3RhdGljIF9mcm9tU2VydmVyUmVzcG9uc2UoX2F1dGgsIGVucm9sbG1lbnQpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUb3RwTXVsdGlGYWN0b3JJbmZvSW1wbChlbnJvbGxtZW50KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBfc2V0QWN0aW9uQ29kZVNldHRpbmdzT25SZXF1ZXN0KGF1dGgsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncykge1xuICAgIHZhciBfYTtcbiAgICBfYXNzZXJ0KCgoX2EgPSBhY3Rpb25Db2RlU2V0dGluZ3MudXJsKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EubGVuZ3RoKSA+IDAsIGF1dGgsIFwiaW52YWxpZC1jb250aW51ZS11cmlcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQ09OVElOVUVfVVJJICovKTtcbiAgICBfYXNzZXJ0KHR5cGVvZiBhY3Rpb25Db2RlU2V0dGluZ3MuZHluYW1pY0xpbmtEb21haW4gPT09ICd1bmRlZmluZWQnIHx8XG4gICAgICAgIGFjdGlvbkNvZGVTZXR0aW5ncy5keW5hbWljTGlua0RvbWFpbi5sZW5ndGggPiAwLCBhdXRoLCBcImludmFsaWQtZHluYW1pYy1saW5rLWRvbWFpblwiIC8qIEF1dGhFcnJvckNvZGUuSU5WQUxJRF9EWU5BTUlDX0xJTktfRE9NQUlOICovKTtcbiAgICBfYXNzZXJ0KHR5cGVvZiBhY3Rpb25Db2RlU2V0dGluZ3MubGlua0RvbWFpbiA9PT0gJ3VuZGVmaW5lZCcgfHxcbiAgICAgICAgYWN0aW9uQ29kZVNldHRpbmdzLmxpbmtEb21haW4ubGVuZ3RoID4gMCwgYXV0aCwgXCJpbnZhbGlkLWhvc3RpbmctbGluay1kb21haW5cIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfSE9TVElOR19MSU5LX0RPTUFJTiAqLyk7XG4gICAgcmVxdWVzdC5jb250aW51ZVVybCA9IGFjdGlvbkNvZGVTZXR0aW5ncy51cmw7XG4gICAgcmVxdWVzdC5keW5hbWljTGlua0RvbWFpbiA9IGFjdGlvbkNvZGVTZXR0aW5ncy5keW5hbWljTGlua0RvbWFpbjtcbiAgICByZXF1ZXN0LmxpbmtEb21haW4gPSBhY3Rpb25Db2RlU2V0dGluZ3MubGlua0RvbWFpbjtcbiAgICByZXF1ZXN0LmNhbkhhbmRsZUNvZGVJbkFwcCA9IGFjdGlvbkNvZGVTZXR0aW5ncy5oYW5kbGVDb2RlSW5BcHA7XG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncy5pT1MpIHtcbiAgICAgICAgX2Fzc2VydChhY3Rpb25Db2RlU2V0dGluZ3MuaU9TLmJ1bmRsZUlkLmxlbmd0aCA+IDAsIGF1dGgsIFwibWlzc2luZy1pb3MtYnVuZGxlLWlkXCIgLyogQXV0aEVycm9yQ29kZS5NSVNTSU5HX0lPU19CVU5ETEVfSUQgKi8pO1xuICAgICAgICByZXF1ZXN0LmlPU0J1bmRsZUlkID0gYWN0aW9uQ29kZVNldHRpbmdzLmlPUy5idW5kbGVJZDtcbiAgICB9XG4gICAgaWYgKGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkKSB7XG4gICAgICAgIF9hc3NlcnQoYWN0aW9uQ29kZVNldHRpbmdzLmFuZHJvaWQucGFja2FnZU5hbWUubGVuZ3RoID4gMCwgYXV0aCwgXCJtaXNzaW5nLWFuZHJvaWQtcGtnLW5hbWVcIiAvKiBBdXRoRXJyb3JDb2RlLk1JU1NJTkdfQU5EUk9JRF9QQUNLQUdFX05BTUUgKi8pO1xuICAgICAgICByZXF1ZXN0LmFuZHJvaWRJbnN0YWxsQXBwID0gYWN0aW9uQ29kZVNldHRpbmdzLmFuZHJvaWQuaW5zdGFsbEFwcDtcbiAgICAgICAgcmVxdWVzdC5hbmRyb2lkTWluaW11bVZlcnNpb25Db2RlID1cbiAgICAgICAgICAgIGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkLm1pbmltdW1WZXJzaW9uO1xuICAgICAgICByZXF1ZXN0LmFuZHJvaWRQYWNrYWdlTmFtZSA9IGFjdGlvbkNvZGVTZXR0aW5ncy5hbmRyb2lkLnBhY2thZ2VOYW1lO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVXBkYXRlcyB0aGUgcGFzc3dvcmQgcG9saWN5IGNhY2hlZCBpbiB0aGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIGlmIGEgcG9saWN5IGlzIGFscmVhZHlcbiAqIGNhY2hlZCBmb3IgdGhlIHByb2plY3Qgb3IgdGVuYW50LlxuICpcbiAqIEByZW1hcmtzXG4gKiBXZSBvbmx5IGZldGNoIHRoZSBwYXNzd29yZCBwb2xpY3kgaWYgdGhlIHBhc3N3b3JkIGRpZCBub3QgbWVldCBwb2xpY3kgcmVxdWlyZW1lbnRzIGFuZFxuICogdGhlcmUgaXMgYW4gZXhpc3RpbmcgcG9saWN5IGNhY2hlZC4gQSBkZXZlbG9wZXIgbXVzdCBjYWxsIHZhbGlkYXRlUGFzc3dvcmQgYXQgbGVhc3RcbiAqIG9uY2UgZm9yIHRoZSBjYWNoZSB0byBiZSBhdXRvbWF0aWNhbGx5IHVwZGF0ZWQuXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICpcbiAqIEBwcml2YXRlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHJlY2FjaGVQYXNzd29yZFBvbGljeShhdXRoKSB7XG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xuICAgIGlmIChhdXRoSW50ZXJuYWwuX2dldFBhc3N3b3JkUG9saWN5SW50ZXJuYWwoKSkge1xuICAgICAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX3VwZGF0ZVBhc3N3b3JkUG9saWN5KCk7XG4gICAgfVxufVxuLyoqXG4gKiBTZW5kcyBhIHBhc3N3b3JkIHJlc2V0IGVtYWlsIHRvIHRoZSBnaXZlbiBlbWFpbCBhZGRyZXNzLiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB0aHJvdyBhbiBlcnJvciB3aGVuXG4gKiB0aGVyZSdzIG5vIHVzZXIgYWNjb3VudCB3aXRoIHRoZSBnaXZlbiBlbWFpbCBhZGRyZXNzIGFuZFxuICoge0BsaW5rIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9pZGVudGl0eS1wbGF0Zm9ybS9kb2NzL2FkbWluL2VtYWlsLWVudW1lcmF0aW9uLXByb3RlY3Rpb24gfCBFbWFpbCBFbnVtZXJhdGlvbiBQcm90ZWN0aW9ufVxuICogaXMgZW5hYmxlZC5cbiAqXG4gKiBAcmVtYXJrc1xuICogVG8gY29tcGxldGUgdGhlIHBhc3N3b3JkIHJlc2V0LCBjYWxsIHtAbGluayBjb25maXJtUGFzc3dvcmRSZXNldH0gd2l0aCB0aGUgY29kZSBzdXBwbGllZCBpblxuICogdGhlIGVtYWlsIHNlbnQgdG8gdGhlIHVzZXIsIGFsb25nIHdpdGggdGhlIG5ldyBwYXNzd29yZCBzcGVjaWZpZWQgYnkgdGhlIHVzZXIuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbnN0IGFjdGlvbkNvZGVTZXR0aW5ncyA9IHtcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxuICogICBpT1M6IHtcbiAqICAgICAgYnVuZGxlSWQ6ICdjb20uZXhhbXBsZS5pb3MnXG4gKiAgIH0sXG4gKiAgIGFuZHJvaWQ6IHtcbiAqICAgICBwYWNrYWdlTmFtZTogJ2NvbS5leGFtcGxlLmFuZHJvaWQnLFxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcbiAqICAgfSxcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXG4gKiB9O1xuICogYXdhaXQgc2VuZFBhc3N3b3JkUmVzZXRFbWFpbChhdXRoLCAndXNlckBleGFtcGxlLmNvbScsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XG4gKiAvLyBPYnRhaW4gY29kZSBmcm9tIHVzZXIuXG4gKiBhd2FpdCBjb25maXJtUGFzc3dvcmRSZXNldCgndXNlckBleGFtcGxlLmNvbScsIGNvZGUpO1xuICogYGBgXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNlbmRQYXNzd29yZFJlc2V0RW1haWwoYXV0aCwgZW1haWwsIGFjdGlvbkNvZGVTZXR0aW5ncykge1xuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICByZXF1ZXN0VHlwZTogXCJQQVNTV09SRF9SRVNFVFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uUEFTU1dPUkRfUkVTRVQgKi8sXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBjbGllbnRUeXBlOiBcIkNMSUVOVF9UWVBFX1dFQlwiIC8qIFJlY2FwdGNoYUNsaWVudFR5cGUuV0VCICovXG4gICAgfTtcbiAgICBpZiAoYWN0aW9uQ29kZVNldHRpbmdzKSB7XG4gICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QoYXV0aEludGVybmFsLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xuICAgIH1cbiAgICBhd2FpdCBoYW5kbGVSZWNhcHRjaGFGbG93KGF1dGhJbnRlcm5hbCwgcmVxdWVzdCwgXCJnZXRPb2JDb2RlXCIgLyogUmVjYXB0Y2hhQWN0aW9uTmFtZS5HRVRfT09CX0NPREUgKi8sIHNlbmRQYXNzd29yZFJlc2V0RW1haWwkMSwgXCJFTUFJTF9QQVNTV09SRF9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYUF1dGhQcm92aWRlci5FTUFJTF9QQVNTV09SRF9QUk9WSURFUiAqLyk7XG59XG4vKipcbiAqIENvbXBsZXRlcyB0aGUgcGFzc3dvcmQgcmVzZXQgcHJvY2VzcywgZ2l2ZW4gYSBjb25maXJtYXRpb24gY29kZSBhbmQgbmV3IHBhc3N3b3JkLlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBvb2JDb2RlIC0gQSBjb25maXJtYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyLlxuICogQHBhcmFtIG5ld1Bhc3N3b3JkIC0gVGhlIG5ldyBwYXNzd29yZC5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNvbmZpcm1QYXNzd29yZFJlc2V0KGF1dGgsIG9vYkNvZGUsIG5ld1Bhc3N3b3JkKSB7XG4gICAgYXdhaXQgcmVzZXRQYXNzd29yZChnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCksIHtcbiAgICAgICAgb29iQ29kZSxcbiAgICAgICAgbmV3UGFzc3dvcmRcbiAgICB9KVxuICAgICAgICAuY2F0Y2goYXN5bmMgKGVycm9yKSA9PiB7XG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PVxuICAgICAgICAgICAgYGF1dGgvJHtcInBhc3N3b3JkLWRvZXMtbm90LW1lZXQtcmVxdWlyZW1lbnRzXCIgLyogQXV0aEVycm9yQ29kZS5QQVNTV09SRF9ET0VTX05PVF9NRUVUX1JFUVVJUkVNRU5UUyAqL31gKSB7XG4gICAgICAgICAgICB2b2lkIHJlY2FjaGVQYXNzd29yZFBvbGljeShhdXRoKTtcbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICB9KTtcbiAgICAvLyBEbyBub3QgcmV0dXJuIHRoZSBlbWFpbC5cbn1cbi8qKlxuICogQXBwbGllcyBhIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIgYnkgZW1haWwgb3Igb3RoZXIgb3V0LW9mLWJhbmQgbWVjaGFuaXNtLlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBvb2JDb2RlIC0gQSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYXBwbHlBY3Rpb25Db2RlKGF1dGgsIG9vYkNvZGUpIHtcbiAgICBhd2FpdCBhcHBseUFjdGlvbkNvZGUkMShnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCksIHsgb29iQ29kZSB9KTtcbn1cbi8qKlxuICogQ2hlY2tzIGEgdmVyaWZpY2F0aW9uIGNvZGUgc2VudCB0byB0aGUgdXNlciBieSBlbWFpbCBvciBvdGhlciBvdXQtb2YtYmFuZCBtZWNoYW5pc20uXG4gKlxuICogQHJldHVybnMgbWV0YWRhdGEgYWJvdXQgdGhlIGNvZGUuXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIG9vYkNvZGUgLSBBIHZlcmlmaWNhdGlvbiBjb2RlIHNlbnQgdG8gdGhlIHVzZXIuXG4gKlxuICogQHB1YmxpY1xuICovXG5hc3luYyBmdW5jdGlvbiBjaGVja0FjdGlvbkNvZGUoYXV0aCwgb29iQ29kZSkge1xuICAgIGNvbnN0IGF1dGhNb2R1bGFyID0gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgcmVzZXRQYXNzd29yZChhdXRoTW9kdWxhciwgeyBvb2JDb2RlIH0pO1xuICAgIC8vIEVtYWlsIGNvdWxkIGJlIGVtcHR5IG9ubHkgaWYgdGhlIHJlcXVlc3QgdHlwZSBpcyBFTUFJTF9TSUdOSU4gb3JcbiAgICAvLyBWRVJJRllfQU5EX0NIQU5HRV9FTUFJTC5cbiAgICAvLyBOZXcgZW1haWwgc2hvdWxkIG5vdCBiZSBlbXB0eSBpZiB0aGUgcmVxdWVzdCB0eXBlIGlzXG4gICAgLy8gVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwuXG4gICAgLy8gTXVsdGktZmFjdG9yIGluZm8gY291bGQgbm90IGJlIGVtcHR5IGlmIHRoZSByZXF1ZXN0IHR5cGUgaXNcbiAgICAvLyBSRVZFUlRfU0VDT05EX0ZBQ1RPUl9BRERJVElPTi5cbiAgICBjb25zdCBvcGVyYXRpb24gPSByZXNwb25zZS5yZXF1ZXN0VHlwZTtcbiAgICBfYXNzZXJ0KG9wZXJhdGlvbiwgYXV0aE1vZHVsYXIsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICBzd2l0Y2ggKG9wZXJhdGlvbikge1xuICAgICAgICBjYXNlIFwiRU1BSUxfU0lHTklOXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5FTUFJTF9TSUdOSU4gKi86XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfQU5EX0NIQU5HRV9FTUFJTCAqLzpcbiAgICAgICAgICAgIF9hc3NlcnQocmVzcG9uc2UubmV3RW1haWwsIGF1dGhNb2R1bGFyLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBcIlJFVkVSVF9TRUNPTkRfRkFDVE9SX0FERElUSU9OXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5SRVZFUlRfU0VDT05EX0ZBQ1RPUl9BRERJVElPTiAqLzpcbiAgICAgICAgICAgIF9hc3NlcnQocmVzcG9uc2UubWZhSW5mbywgYXV0aE1vZHVsYXIsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBfYXNzZXJ0KHJlc3BvbnNlLmVtYWlsLCBhdXRoTW9kdWxhciwgXCJpbnRlcm5hbC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuSU5URVJOQUxfRVJST1IgKi8pO1xuICAgIH1cbiAgICAvLyBUaGUgbXVsdGktZmFjdG9yIGluZm8gZm9yIHJldmVydCBzZWNvbmQgZmFjdG9yIGFkZGl0aW9uXG4gICAgbGV0IG11bHRpRmFjdG9ySW5mbyA9IG51bGw7XG4gICAgaWYgKHJlc3BvbnNlLm1mYUluZm8pIHtcbiAgICAgICAgbXVsdGlGYWN0b3JJbmZvID0gTXVsdGlGYWN0b3JJbmZvSW1wbC5fZnJvbVNlcnZlclJlc3BvbnNlKF9jYXN0QXV0aChhdXRoTW9kdWxhciksIHJlc3BvbnNlLm1mYUluZm8pO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBlbWFpbDogKHJlc3BvbnNlLnJlcXVlc3RUeXBlID09PSBcIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfQU5EX0NIQU5HRV9FTUFJTCAqL1xuICAgICAgICAgICAgICAgID8gcmVzcG9uc2UubmV3RW1haWxcbiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLmVtYWlsKSB8fCBudWxsLFxuICAgICAgICAgICAgcHJldmlvdXNFbWFpbDogKHJlc3BvbnNlLnJlcXVlc3RUeXBlID09PSBcIlZFUklGWV9BTkRfQ0hBTkdFX0VNQUlMXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5WRVJJRllfQU5EX0NIQU5HRV9FTUFJTCAqL1xuICAgICAgICAgICAgICAgID8gcmVzcG9uc2UuZW1haWxcbiAgICAgICAgICAgICAgICA6IHJlc3BvbnNlLm5ld0VtYWlsKSB8fCBudWxsLFxuICAgICAgICAgICAgbXVsdGlGYWN0b3JJbmZvXG4gICAgICAgIH0sXG4gICAgICAgIG9wZXJhdGlvblxuICAgIH07XG59XG4vKipcbiAqIENoZWNrcyBhIHBhc3N3b3JkIHJlc2V0IGNvZGUgc2VudCB0byB0aGUgdXNlciBieSBlbWFpbCBvciBvdGhlciBvdXQtb2YtYmFuZCBtZWNoYW5pc20uXG4gKlxuICogQHJldHVybnMgdGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzIGlmIHZhbGlkLlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBjb2RlIC0gQSB2ZXJpZmljYXRpb24gY29kZSBzZW50IHRvIHRoZSB1c2VyLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gdmVyaWZ5UGFzc3dvcmRSZXNldENvZGUoYXV0aCwgY29kZSkge1xuICAgIGNvbnN0IHsgZGF0YSB9ID0gYXdhaXQgY2hlY2tBY3Rpb25Db2RlKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgY29kZSk7XG4gICAgLy8gRW1haWwgc2hvdWxkIGFsd2F5cyBiZSBwcmVzZW50IHNpbmNlIGEgY29kZSB3YXMgc2VudCB0byBpdFxuICAgIHJldHVybiBkYXRhLmVtYWlsO1xufVxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHVzZXIgYWNjb3VudCBhc3NvY2lhdGVkIHdpdGggdGhlIHNwZWNpZmllZCBlbWFpbCBhZGRyZXNzIGFuZCBwYXNzd29yZC5cbiAqXG4gKiBAcmVtYXJrc1xuICogT24gc3VjY2Vzc2Z1bCBjcmVhdGlvbiBvZiB0aGUgdXNlciBhY2NvdW50LCB0aGlzIHVzZXIgd2lsbCBhbHNvIGJlIHNpZ25lZCBpbiB0byB5b3VyIGFwcGxpY2F0aW9uLlxuICpcbiAqIFVzZXIgYWNjb3VudCBjcmVhdGlvbiBjYW4gZmFpbCBpZiB0aGUgYWNjb3VudCBhbHJlYWR5IGV4aXN0cyBvciB0aGUgcGFzc3dvcmQgaXMgaW52YWxpZC5cbiAqXG4gKiBUaGlzIG1ldGhvZCBpcyBub3Qgc3VwcG9ydGVkIG9uIHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cbiAqXG4gKiBOb3RlOiBUaGUgZW1haWwgYWRkcmVzcyBhY3RzIGFzIGEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoZSB1c2VyIGFuZCBlbmFibGVzIGFuIGVtYWlsLWJhc2VkXG4gKiBwYXNzd29yZCByZXNldC4gVGhpcyBmdW5jdGlvbiB3aWxsIGNyZWF0ZSBhIG5ldyB1c2VyIGFjY291bnQgYW5kIHNldCB0aGUgaW5pdGlhbCB1c2VyIHBhc3N3b3JkLlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cbiAqIEBwYXJhbSBwYXNzd29yZCAtIFRoZSB1c2VyJ3MgY2hvc2VuIHBhc3N3b3JkLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCkge1xuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcChhdXRoLmFwcCkpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcbiAgICB9XG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQsXG4gICAgICAgIGNsaWVudFR5cGU6IFwiQ0xJRU5UX1RZUEVfV0VCXCIgLyogUmVjYXB0Y2hhQ2xpZW50VHlwZS5XRUIgKi9cbiAgICB9O1xuICAgIGNvbnN0IHNpZ25VcFJlc3BvbnNlID0gaGFuZGxlUmVjYXB0Y2hhRmxvdyhhdXRoSW50ZXJuYWwsIHJlcXVlc3QsIFwic2lnblVwUGFzc3dvcmRcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLlNJR05fVVBfUEFTU1dPUkQgKi8sIHNpZ25VcCwgXCJFTUFJTF9QQVNTV09SRF9QUk9WSURFUlwiIC8qIFJlY2FwdGNoYUF1dGhQcm92aWRlci5FTUFJTF9QQVNTV09SRF9QUk9WSURFUiAqLyk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzaWduVXBSZXNwb25zZS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgIGlmIChlcnJvci5jb2RlID09PSBgYXV0aC8ke1wicGFzc3dvcmQtZG9lcy1ub3QtbWVldC1yZXF1aXJlbWVudHNcIiAvKiBBdXRoRXJyb3JDb2RlLlBBU1NXT1JEX0RPRVNfTk9UX01FRVRfUkVRVUlSRU1FTlRTICovfWApIHtcbiAgICAgICAgICAgIHZvaWQgcmVjYWNoZVBhc3N3b3JkUG9saWN5KGF1dGgpO1xuICAgICAgICB9XG4gICAgICAgIHRocm93IGVycm9yO1xuICAgIH0pO1xuICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGhJbnRlcm5hbCwgXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi8sIHJlc3BvbnNlKTtcbiAgICBhd2FpdCBhdXRoSW50ZXJuYWwuX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXJDcmVkZW50aWFsLnVzZXIpO1xuICAgIHJldHVybiB1c2VyQ3JlZGVudGlhbDtcbn1cbi8qKlxuICogQXN5bmNocm9ub3VzbHkgc2lnbnMgaW4gdXNpbmcgYW4gZW1haWwgYW5kIHBhc3N3b3JkLlxuICpcbiAqIEByZW1hcmtzXG4gKiBGYWlscyB3aXRoIGFuIGVycm9yIGlmIHRoZSBlbWFpbCBhZGRyZXNzIGFuZCBwYXNzd29yZCBkbyBub3QgbWF0Y2guIFdoZW5cbiAqIHtAbGluayBodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vaWRlbnRpdHktcGxhdGZvcm0vZG9jcy9hZG1pbi9lbWFpbC1lbnVtZXJhdGlvbi1wcm90ZWN0aW9uIHwgRW1haWwgRW51bWVyYXRpb24gUHJvdGVjdGlvbn1cbiAqIGlzIGVuYWJsZWQsIHRoaXMgbWV0aG9kIGZhaWxzIHdpdGggXCJhdXRoL2ludmFsaWQtY3JlZGVudGlhbFwiIGluIGNhc2Ugb2YgYW4gaW52YWxpZFxuICogZW1haWwvcGFzc3dvcmQuXG4gKlxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBvbiB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXG4gKiB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXG4gKlxuICogTm90ZTogVGhlIHVzZXIncyBwYXNzd29yZCBpcyBOT1QgdGhlIHBhc3N3b3JkIHVzZWQgdG8gYWNjZXNzIHRoZSB1c2VyJ3MgZW1haWwgYWNjb3VudC4gVGhlXG4gKiBlbWFpbCBhZGRyZXNzIHNlcnZlcyBhcyBhIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdXNlciwgYW5kIHRoZSBwYXNzd29yZCBpcyB1c2VkIHRvIGFjY2Vzc1xuICogdGhlIHVzZXIncyBhY2NvdW50IGluIHlvdXIgRmlyZWJhc2UgcHJvamVjdC4gU2VlIGFsc286IHtAbGluayBjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmR9LlxuICpcbiAqXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXG4gKiBAcGFyYW0gZW1haWwgLSBUaGUgdXNlcnMgZW1haWwgYWRkcmVzcy5cbiAqIEBwYXJhbSBwYXNzd29yZCAtIFRoZSB1c2VycyBwYXNzd29yZC5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkKGF1dGgsIGVtYWlsLCBwYXNzd29yZCkge1xuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcChhdXRoLmFwcCkpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHNpZ25JbldpdGhDcmVkZW50aWFsKGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKSwgRW1haWxBdXRoUHJvdmlkZXIuY3JlZGVudGlhbChlbWFpbCwgcGFzc3dvcmQpKS5jYXRjaChhc3luYyAoZXJyb3IpID0+IHtcbiAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09IGBhdXRoLyR7XCJwYXNzd29yZC1kb2VzLW5vdC1tZWV0LXJlcXVpcmVtZW50c1wiIC8qIEF1dGhFcnJvckNvZGUuUEFTU1dPUkRfRE9FU19OT1RfTUVFVF9SRVFVSVJFTUVOVFMgKi99YCkge1xuICAgICAgICAgICAgdm9pZCByZWNhY2hlUGFzc3dvcmRQb2xpY3koYXV0aCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNlbmRzIGEgc2lnbi1pbiBlbWFpbCBsaW5rIHRvIHRoZSB1c2VyIHdpdGggdGhlIHNwZWNpZmllZCBlbWFpbC5cbiAqXG4gKiBAcmVtYXJrc1xuICogVGhlIHNpZ24taW4gb3BlcmF0aW9uIGhhcyB0byBhbHdheXMgYmUgY29tcGxldGVkIGluIHRoZSBhcHAgdW5saWtlIG90aGVyIG91dCBvZiBiYW5kIGVtYWlsXG4gKiBhY3Rpb25zIChwYXNzd29yZCByZXNldCBhbmQgZW1haWwgdmVyaWZpY2F0aW9ucykuIFRoaXMgaXMgYmVjYXVzZSwgYXQgdGhlIGVuZCBvZiB0aGUgZmxvdyxcbiAqIHRoZSB1c2VyIGlzIGV4cGVjdGVkIHRvIGJlIHNpZ25lZCBpbiBhbmQgdGhlaXIgQXV0aCBzdGF0ZSBwZXJzaXN0ZWQgd2l0aGluIHRoZSBhcHAuXG4gKlxuICogVG8gY29tcGxldGUgc2lnbiBpbiB3aXRoIHRoZSBlbWFpbCBsaW5rLCBjYWxsIHtAbGluayBzaWduSW5XaXRoRW1haWxMaW5rfSB3aXRoIHRoZSBlbWFpbFxuICogYWRkcmVzcyBhbmQgdGhlIGVtYWlsIGxpbmsgc3VwcGxpZWQgaW4gdGhlIGVtYWlsIHNlbnQgdG8gdGhlIHVzZXIuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbnN0IGFjdGlvbkNvZGVTZXR0aW5ncyA9IHtcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxuICogICBpT1M6IHtcbiAqICAgICAgYnVuZGxlSWQ6ICdjb20uZXhhbXBsZS5pb3MnXG4gKiAgIH0sXG4gKiAgIGFuZHJvaWQ6IHtcbiAqICAgICBwYWNrYWdlTmFtZTogJ2NvbS5leGFtcGxlLmFuZHJvaWQnLFxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcbiAqICAgfSxcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXG4gKiB9O1xuICogYXdhaXQgc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsICd1c2VyQGV4YW1wbGUuY29tJywgYWN0aW9uQ29kZVNldHRpbmdzKTtcbiAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB0aGUgdXNlci5cbiAqIGlmKGlzU2lnbkluV2l0aEVtYWlsTGluayhhdXRoLCBlbWFpbExpbmspKSB7XG4gKiAgIGF3YWl0IHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgJ3VzZXJAZXhhbXBsZS5jb20nLCBlbWFpbExpbmspO1xuICogfVxuICogYGBgXG4gKlxuICogQHBhcmFtIGF1dGhJbnRlcm5hbCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXG4gKiBAcGFyYW0gZW1haWwgLSBUaGUgdXNlcidzIGVtYWlsIGFkZHJlc3MuXG4gKiBAcGFyYW0gYWN0aW9uQ29kZVNldHRpbmdzIC0gVGhlIHtAbGluayBBY3Rpb25Db2RlU2V0dGluZ3N9LlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsIGVtYWlsLCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcbiAgICBjb25zdCBhdXRoSW50ZXJuYWwgPSBfY2FzdEF1dGgoYXV0aCk7XG4gICAgY29uc3QgcmVxdWVzdCA9IHtcbiAgICAgICAgcmVxdWVzdFR5cGU6IFwiRU1BSUxfU0lHTklOXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5FTUFJTF9TSUdOSU4gKi8sXG4gICAgICAgIGVtYWlsLFxuICAgICAgICBjbGllbnRUeXBlOiBcIkNMSUVOVF9UWVBFX1dFQlwiIC8qIFJlY2FwdGNoYUNsaWVudFR5cGUuV0VCICovXG4gICAgfTtcbiAgICBmdW5jdGlvbiBzZXRBY3Rpb25Db2RlU2V0dGluZ3MocmVxdWVzdCwgYWN0aW9uQ29kZVNldHRpbmdzKSB7XG4gICAgICAgIF9hc3NlcnQoYWN0aW9uQ29kZVNldHRpbmdzLmhhbmRsZUNvZGVJbkFwcCwgYXV0aEludGVybmFsLCBcImFyZ3VtZW50LWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5BUkdVTUVOVF9FUlJPUiAqLyk7XG4gICAgICAgIGlmIChhY3Rpb25Db2RlU2V0dGluZ3MpIHtcbiAgICAgICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QoYXV0aEludGVybmFsLCByZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldEFjdGlvbkNvZGVTZXR0aW5ncyhyZXF1ZXN0LCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xuICAgIGF3YWl0IGhhbmRsZVJlY2FwdGNoYUZsb3coYXV0aEludGVybmFsLCByZXF1ZXN0LCBcImdldE9vYkNvZGVcIiAvKiBSZWNhcHRjaGFBY3Rpb25OYW1lLkdFVF9PT0JfQ09ERSAqLywgc2VuZFNpZ25JbkxpbmtUb0VtYWlsJDEsIFwiRU1BSUxfUEFTU1dPUkRfUFJPVklERVJcIiAvKiBSZWNhcHRjaGFBdXRoUHJvdmlkZXIuRU1BSUxfUEFTU1dPUkRfUFJPVklERVIgKi8pO1xufVxuLyoqXG4gKiBDaGVja3MgaWYgYW4gaW5jb21pbmcgbGluayBpcyBhIHNpZ24taW4gd2l0aCBlbWFpbCBsaW5rIHN1aXRhYmxlIGZvciB7QGxpbmsgc2lnbkluV2l0aEVtYWlsTGlua30uXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIGVtYWlsTGluayAtIFRoZSBsaW5rIHNlbnQgdG8gdGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gaXNTaWduSW5XaXRoRW1haWxMaW5rKGF1dGgsIGVtYWlsTGluaykge1xuICAgIGNvbnN0IGFjdGlvbkNvZGVVcmwgPSBBY3Rpb25Db2RlVVJMLnBhcnNlTGluayhlbWFpbExpbmspO1xuICAgIHJldHVybiAoYWN0aW9uQ29kZVVybCA9PT0gbnVsbCB8fCBhY3Rpb25Db2RlVXJsID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhY3Rpb25Db2RlVXJsLm9wZXJhdGlvbikgPT09IFwiRU1BSUxfU0lHTklOXCIgLyogQWN0aW9uQ29kZU9wZXJhdGlvbi5FTUFJTF9TSUdOSU4gKi87XG59XG4vKipcbiAqIEFzeW5jaHJvbm91c2x5IHNpZ25zIGluIHVzaW5nIGFuIGVtYWlsIGFuZCBzaWduLWluIGVtYWlsIGxpbmsuXG4gKlxuICogQHJlbWFya3NcbiAqIElmIG5vIGxpbmsgaXMgcGFzc2VkLCB0aGUgbGluayBpcyBpbmZlcnJlZCBmcm9tIHRoZSBjdXJyZW50IFVSTC5cbiAqXG4gKiBGYWlscyB3aXRoIGFuIGVycm9yIGlmIHRoZSBlbWFpbCBhZGRyZXNzIGlzIGludmFsaWQgb3IgT1RQIGluIGVtYWlsIGxpbmsgZXhwaXJlcy5cbiAqXG4gKiBUaGlzIG1ldGhvZCBpcyBub3Qgc3VwcG9ydGVkIGJ5IHtAbGluayBBdXRofSBpbnN0YW5jZXMgY3JlYXRlZCB3aXRoIGFcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlU2VydmVyQXBwfS5cbiAqXG4gKiBOb3RlOiBDb25maXJtIHRoZSBsaW5rIGlzIGEgc2lnbi1pbiBlbWFpbCBsaW5rIGJlZm9yZSBjYWxsaW5nIHRoaXMgbWV0aG9kIGZpcmViYXNlLmF1dGguQXV0aC5pc1NpZ25JbldpdGhFbWFpbExpbmsuXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbnN0IGFjdGlvbkNvZGVTZXR0aW5ncyA9IHtcbiAqICAgdXJsOiAnaHR0cHM6Ly93d3cuZXhhbXBsZS5jb20vP2VtYWlsPXVzZXJAZXhhbXBsZS5jb20nLFxuICogICBpT1M6IHtcbiAqICAgICAgYnVuZGxlSWQ6ICdjb20uZXhhbXBsZS5pb3MnXG4gKiAgIH0sXG4gKiAgIGFuZHJvaWQ6IHtcbiAqICAgICBwYWNrYWdlTmFtZTogJ2NvbS5leGFtcGxlLmFuZHJvaWQnLFxuICogICAgIGluc3RhbGxBcHA6IHRydWUsXG4gKiAgICAgbWluaW11bVZlcnNpb246ICcxMidcbiAqICAgfSxcbiAqICAgaGFuZGxlQ29kZUluQXBwOiB0cnVlXG4gKiB9O1xuICogYXdhaXQgc2VuZFNpZ25JbkxpbmtUb0VtYWlsKGF1dGgsICd1c2VyQGV4YW1wbGUuY29tJywgYWN0aW9uQ29kZVNldHRpbmdzKTtcbiAqIC8vIE9idGFpbiBlbWFpbExpbmsgZnJvbSB0aGUgdXNlci5cbiAqIGlmKGlzU2lnbkluV2l0aEVtYWlsTGluayhhdXRoLCBlbWFpbExpbmspKSB7XG4gKiAgIGF3YWl0IHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgJ3VzZXJAZXhhbXBsZS5jb20nLCBlbWFpbExpbmspO1xuICogfVxuICogYGBgXG4gKlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBlbWFpbCAtIFRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cbiAqIEBwYXJhbSBlbWFpbExpbmsgLSBUaGUgbGluayBzZW50IHRvIHRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNpZ25JbldpdGhFbWFpbExpbmsoYXV0aCwgZW1haWwsIGVtYWlsTGluaykge1xuICAgIGlmIChfaXNGaXJlYmFzZVNlcnZlckFwcChhdXRoLmFwcCkpIHtcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KF9zZXJ2ZXJBcHBDdXJyZW50VXNlck9wZXJhdGlvbk5vdFN1cHBvcnRlZEVycm9yKGF1dGgpKTtcbiAgICB9XG4gICAgY29uc3QgYXV0aE1vZHVsYXIgPSBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCk7XG4gICAgY29uc3QgY3JlZGVudGlhbCA9IEVtYWlsQXV0aFByb3ZpZGVyLmNyZWRlbnRpYWxXaXRoTGluayhlbWFpbCwgZW1haWxMaW5rIHx8IF9nZXRDdXJyZW50VXJsKCkpO1xuICAgIC8vIENoZWNrIGlmIHRoZSB0ZW5hbnQgSUQgaW4gdGhlIGVtYWlsIGxpbmsgbWF0Y2hlcyB0aGUgdGVuYW50IElEIG9uIEF1dGhcbiAgICAvLyBpbnN0YW5jZS5cbiAgICBfYXNzZXJ0KGNyZWRlbnRpYWwuX3RlbmFudElkID09PSAoYXV0aE1vZHVsYXIudGVuYW50SWQgfHwgbnVsbCksIGF1dGhNb2R1bGFyLCBcInRlbmFudC1pZC1taXNtYXRjaFwiIC8qIEF1dGhFcnJvckNvZGUuVEVOQU5UX0lEX01JU01BVENIICovKTtcbiAgICByZXR1cm4gc2lnbkluV2l0aENyZWRlbnRpYWwoYXV0aE1vZHVsYXIsIGNyZWRlbnRpYWwpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gY3JlYXRlQXV0aFVyaShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YxL2FjY291bnRzOmNyZWF0ZUF1dGhVcmlcIiAvKiBFbmRwb2ludC5DUkVBVEVfQVVUSF9VUkkgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEdldHMgdGhlIGxpc3Qgb2YgcG9zc2libGUgc2lnbiBpbiBtZXRob2RzIGZvciB0aGUgZ2l2ZW4gZW1haWwgYWRkcmVzcy4gVGhpcyBtZXRob2QgcmV0dXJucyBhblxuICogZW1wdHkgbGlzdCB3aGVuXG4gKiB7QGxpbmsgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2lkZW50aXR5LXBsYXRmb3JtL2RvY3MvYWRtaW4vZW1haWwtZW51bWVyYXRpb24tcHJvdGVjdGlvbiB8IEVtYWlsIEVudW1lcmF0aW9uIFByb3RlY3Rpb259XG4gKiBpcyBlbmFibGVkLCBpcnJlc3BlY3RpdmUgb2YgdGhlIG51bWJlciBvZiBhdXRoZW50aWNhdGlvbiBtZXRob2RzIGF2YWlsYWJsZSBmb3IgdGhlIGdpdmVuIGVtYWlsLlxuICpcbiAqIEByZW1hcmtzXG4gKiBUaGlzIGlzIHVzZWZ1bCB0byBkaWZmZXJlbnRpYXRlIG1ldGhvZHMgb2Ygc2lnbi1pbiBmb3IgdGhlIHNhbWUgcHJvdmlkZXIsIGVnLlxuICoge0BsaW5rIEVtYWlsQXV0aFByb3ZpZGVyfSB3aGljaCBoYXMgMiBtZXRob2RzIG9mIHNpZ24taW4sXG4gKiB7QGxpbmsgU2lnbkluTWV0aG9kfS5FTUFJTF9QQVNTV09SRCBhbmRcbiAqIHtAbGluayBTaWduSW5NZXRob2R9LkVNQUlMX0xJTksuXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIGVtYWlsIC0gVGhlIHVzZXIncyBlbWFpbCBhZGRyZXNzLlxuICpcbiAqIERlcHJlY2F0ZWQuIE1pZ3JhdGluZyBvZmYgb2YgdGhpcyBtZXRob2QgaXMgcmVjb21tZW5kZWQgYXMgYSBzZWN1cml0eSBiZXN0LXByYWN0aWNlLlxuICogTGVhcm4gbW9yZSBpbiB0aGUgSWRlbnRpdHkgUGxhdGZvcm0gZG9jdW1lbnRhdGlvbiBmb3JcbiAqIHtAbGluayBodHRwczovL2Nsb3VkLmdvb2dsZS5jb20vaWRlbnRpdHktcGxhdGZvcm0vZG9jcy9hZG1pbi9lbWFpbC1lbnVtZXJhdGlvbi1wcm90ZWN0aW9uIHwgRW1haWwgRW51bWVyYXRpb24gUHJvdGVjdGlvbn0uXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGZldGNoU2lnbkluTWV0aG9kc0ZvckVtYWlsKGF1dGgsIGVtYWlsKSB7XG4gICAgLy8gY3JlYXRlQXV0aFVyaSByZXR1cm5zIGFuIGVycm9yIGlmIGNvbnRpbnVlIFVSSSBpcyBub3QgaHR0cCBvciBodHRwcy5cbiAgICAvLyBGb3IgZW52aXJvbm1lbnRzIGxpa2UgQ29yZG92YSwgQ2hyb21lIGV4dGVuc2lvbnMsIG5hdGl2ZSBmcmFtZXdvcmtzLCBmaWxlXG4gICAgLy8gc3lzdGVtcywgZXRjLCB1c2UgaHR0cDovL2xvY2FsaG9zdCBhcyBjb250aW51ZSBVUkwuXG4gICAgY29uc3QgY29udGludWVVcmkgPSBfaXNIdHRwT3JIdHRwcygpID8gX2dldEN1cnJlbnRVcmwoKSA6ICdodHRwOi8vbG9jYWxob3N0JztcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICBpZGVudGlmaWVyOiBlbWFpbCxcbiAgICAgICAgY29udGludWVVcmlcbiAgICB9O1xuICAgIGNvbnN0IHsgc2lnbmluTWV0aG9kcyB9ID0gYXdhaXQgY3JlYXRlQXV0aFVyaShnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCksIHJlcXVlc3QpO1xuICAgIHJldHVybiBzaWduaW5NZXRob2RzIHx8IFtdO1xufVxuLyoqXG4gKiBTZW5kcyBhIHZlcmlmaWNhdGlvbiBlbWFpbCB0byBhIHVzZXIuXG4gKlxuICogQHJlbWFya3NcbiAqIFRoZSB2ZXJpZmljYXRpb24gcHJvY2VzcyBpcyBjb21wbGV0ZWQgYnkgY2FsbGluZyB7QGxpbmsgYXBwbHlBY3Rpb25Db2RlfS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xuICogICB1cmw6ICdodHRwczovL3d3dy5leGFtcGxlLmNvbS8/ZW1haWw9dXNlckBleGFtcGxlLmNvbScsXG4gKiAgIGlPUzoge1xuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcbiAqICAgfSxcbiAqICAgYW5kcm9pZDoge1xuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXG4gKiAgICAgaW5zdGFsbEFwcDogdHJ1ZSxcbiAqICAgICBtaW5pbXVtVmVyc2lvbjogJzEyJ1xuICogICB9LFxuICogICBoYW5kbGVDb2RlSW5BcHA6IHRydWVcbiAqIH07XG4gKiBhd2FpdCBzZW5kRW1haWxWZXJpZmljYXRpb24odXNlciwgYWN0aW9uQ29kZVNldHRpbmdzKTtcbiAqIC8vIE9idGFpbiBjb2RlIGZyb20gdGhlIHVzZXIuXG4gKiBhd2FpdCBhcHBseUFjdGlvbkNvZGUoYXV0aCwgY29kZSk7XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxuICogQHBhcmFtIGFjdGlvbkNvZGVTZXR0aW5ncyAtIFRoZSB7QGxpbmsgQWN0aW9uQ29kZVNldHRpbmdzfS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHNlbmRFbWFpbFZlcmlmaWNhdGlvbih1c2VyLCBhY3Rpb25Db2RlU2V0dGluZ3MpIHtcbiAgICBjb25zdCB1c2VySW50ZXJuYWwgPSBnZXRNb2R1bGFySW5zdGFuY2UodXNlcik7XG4gICAgY29uc3QgaWRUb2tlbiA9IGF3YWl0IHVzZXIuZ2V0SWRUb2tlbigpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSB7XG4gICAgICAgIHJlcXVlc3RUeXBlOiBcIlZFUklGWV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0VNQUlMICovLFxuICAgICAgICBpZFRva2VuXG4gICAgfTtcbiAgICBpZiAoYWN0aW9uQ29kZVNldHRpbmdzKSB7XG4gICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QodXNlckludGVybmFsLmF1dGgsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XG4gICAgfVxuICAgIGNvbnN0IHsgZW1haWwgfSA9IGF3YWl0IHNlbmRFbWFpbFZlcmlmaWNhdGlvbiQxKHVzZXJJbnRlcm5hbC5hdXRoLCByZXF1ZXN0KTtcbiAgICBpZiAoZW1haWwgIT09IHVzZXIuZW1haWwpIHtcbiAgICAgICAgYXdhaXQgdXNlci5yZWxvYWQoKTtcbiAgICB9XG59XG4vKipcbiAqIFNlbmRzIGEgdmVyaWZpY2F0aW9uIGVtYWlsIHRvIGEgbmV3IGVtYWlsIGFkZHJlc3MuXG4gKlxuICogQHJlbWFya3NcbiAqIFRoZSB1c2VyJ3MgZW1haWwgd2lsbCBiZSB1cGRhdGVkIHRvIHRoZSBuZXcgb25lIGFmdGVyIGJlaW5nIHZlcmlmaWVkLlxuICpcbiAqIElmIHlvdSBoYXZlIGEgY3VzdG9tIGVtYWlsIGFjdGlvbiBoYW5kbGVyLCB5b3UgY2FuIGNvbXBsZXRlIHRoZSB2ZXJpZmljYXRpb24gcHJvY2VzcyBieSBjYWxsaW5nXG4gKiB7QGxpbmsgYXBwbHlBY3Rpb25Db2RlfS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogY29uc3QgYWN0aW9uQ29kZVNldHRpbmdzID0ge1xuICogICB1cmw6ICdodHRwczovL3d3dy5leGFtcGxlLmNvbS8/ZW1haWw9dXNlckBleGFtcGxlLmNvbScsXG4gKiAgIGlPUzoge1xuICogICAgICBidW5kbGVJZDogJ2NvbS5leGFtcGxlLmlvcydcbiAqICAgfSxcbiAqICAgYW5kcm9pZDoge1xuICogICAgIHBhY2thZ2VOYW1lOiAnY29tLmV4YW1wbGUuYW5kcm9pZCcsXG4gKiAgICAgaW5zdGFsbEFwcDogdHJ1ZSxcbiAqICAgICBtaW5pbXVtVmVyc2lvbjogJzEyJ1xuICogICB9LFxuICogICBoYW5kbGVDb2RlSW5BcHA6IHRydWVcbiAqIH07XG4gKiBhd2FpdCB2ZXJpZnlCZWZvcmVVcGRhdGVFbWFpbCh1c2VyLCAnbmV3ZW1haWxAZXhhbXBsZS5jb20nLCBhY3Rpb25Db2RlU2V0dGluZ3MpO1xuICogLy8gT2J0YWluIGNvZGUgZnJvbSB0aGUgdXNlci5cbiAqIGF3YWl0IGFwcGx5QWN0aW9uQ29kZShhdXRoLCBjb2RlKTtcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXG4gKiBAcGFyYW0gbmV3RW1haWwgLSBUaGUgbmV3IGVtYWlsIGFkZHJlc3MgdG8gYmUgdmVyaWZpZWQgYmVmb3JlIHVwZGF0ZS5cbiAqIEBwYXJhbSBhY3Rpb25Db2RlU2V0dGluZ3MgLSBUaGUge0BsaW5rIEFjdGlvbkNvZGVTZXR0aW5nc30uXG4gKlxuICogQHB1YmxpY1xuICovXG5hc3luYyBmdW5jdGlvbiB2ZXJpZnlCZWZvcmVVcGRhdGVFbWFpbCh1c2VyLCBuZXdFbWFpbCwgYWN0aW9uQ29kZVNldHRpbmdzKSB7XG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VyLmdldElkVG9rZW4oKTtcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICByZXF1ZXN0VHlwZTogXCJWRVJJRllfQU5EX0NIQU5HRV9FTUFJTFwiIC8qIEFjdGlvbkNvZGVPcGVyYXRpb24uVkVSSUZZX0FORF9DSEFOR0VfRU1BSUwgKi8sXG4gICAgICAgIGlkVG9rZW4sXG4gICAgICAgIG5ld0VtYWlsXG4gICAgfTtcbiAgICBpZiAoYWN0aW9uQ29kZVNldHRpbmdzKSB7XG4gICAgICAgIF9zZXRBY3Rpb25Db2RlU2V0dGluZ3NPblJlcXVlc3QodXNlckludGVybmFsLmF1dGgsIHJlcXVlc3QsIGFjdGlvbkNvZGVTZXR0aW5ncyk7XG4gICAgfVxuICAgIGNvbnN0IHsgZW1haWwgfSA9IGF3YWl0IHZlcmlmeUFuZENoYW5nZUVtYWlsKHVzZXJJbnRlcm5hbC5hdXRoLCByZXF1ZXN0KTtcbiAgICBpZiAoZW1haWwgIT09IHVzZXIuZW1haWwpIHtcbiAgICAgICAgLy8gSWYgdGhlIGxvY2FsIGNvcHkgb2YgdGhlIGVtYWlsIG9uIHVzZXIgaXMgb3V0ZGF0ZWQsIHJlbG9hZCB0aGVcbiAgICAgICAgLy8gdXNlci5cbiAgICAgICAgYXdhaXQgdXNlci5yZWxvYWQoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5hc3luYyBmdW5jdGlvbiB1cGRhdGVQcm9maWxlJDEoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92MS9hY2NvdW50czp1cGRhdGVcIiAvKiBFbmRwb2ludC5TRVRfQUNDT1VOVF9JTkZPICovLCByZXF1ZXN0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVXBkYXRlcyBhIHVzZXIncyBwcm9maWxlIGRhdGEuXG4gKlxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cbiAqIEBwYXJhbSBwcm9maWxlIC0gVGhlIHByb2ZpbGUncyBgZGlzcGxheU5hbWVgIGFuZCBgcGhvdG9VUkxgIHRvIHVwZGF0ZS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHVwZGF0ZVByb2ZpbGUodXNlciwgeyBkaXNwbGF5TmFtZSwgcGhvdG9VUkw6IHBob3RvVXJsIH0pIHtcbiAgICBpZiAoZGlzcGxheU5hbWUgPT09IHVuZGVmaW5lZCAmJiBwaG90b1VybCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3QgdXNlckludGVybmFsID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VySW50ZXJuYWwuZ2V0SWRUb2tlbigpO1xuICAgIGNvbnN0IHByb2ZpbGVSZXF1ZXN0ID0ge1xuICAgICAgICBpZFRva2VuLFxuICAgICAgICBkaXNwbGF5TmFtZSxcbiAgICAgICAgcGhvdG9VcmwsXG4gICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXG4gICAgfTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IF9sb2dvdXRJZkludmFsaWRhdGVkKHVzZXJJbnRlcm5hbCwgdXBkYXRlUHJvZmlsZSQxKHVzZXJJbnRlcm5hbC5hdXRoLCBwcm9maWxlUmVxdWVzdCkpO1xuICAgIHVzZXJJbnRlcm5hbC5kaXNwbGF5TmFtZSA9IHJlc3BvbnNlLmRpc3BsYXlOYW1lIHx8IG51bGw7XG4gICAgdXNlckludGVybmFsLnBob3RvVVJMID0gcmVzcG9uc2UucGhvdG9VcmwgfHwgbnVsbDtcbiAgICAvLyBVcGRhdGUgdGhlIHBhc3N3b3JkIHByb3ZpZGVyIGFzIHdlbGxcbiAgICBjb25zdCBwYXNzd29yZFByb3ZpZGVyID0gdXNlckludGVybmFsLnByb3ZpZGVyRGF0YS5maW5kKCh7IHByb3ZpZGVySWQgfSkgPT4gcHJvdmlkZXJJZCA9PT0gXCJwYXNzd29yZFwiIC8qIFByb3ZpZGVySWQuUEFTU1dPUkQgKi8pO1xuICAgIGlmIChwYXNzd29yZFByb3ZpZGVyKSB7XG4gICAgICAgIHBhc3N3b3JkUHJvdmlkZXIuZGlzcGxheU5hbWUgPSB1c2VySW50ZXJuYWwuZGlzcGxheU5hbWU7XG4gICAgICAgIHBhc3N3b3JkUHJvdmlkZXIucGhvdG9VUkwgPSB1c2VySW50ZXJuYWwucGhvdG9VUkw7XG4gICAgfVxuICAgIGF3YWl0IHVzZXJJbnRlcm5hbC5fdXBkYXRlVG9rZW5zSWZOZWNlc3NhcnkocmVzcG9uc2UpO1xufVxuLyoqXG4gKiBVcGRhdGVzIHRoZSB1c2VyJ3MgZW1haWwgYWRkcmVzcy5cbiAqXG4gKiBAcmVtYXJrc1xuICogQW4gZW1haWwgd2lsbCBiZSBzZW50IHRvIHRoZSBvcmlnaW5hbCBlbWFpbCBhZGRyZXNzIChpZiBpdCB3YXMgc2V0KSB0aGF0IGFsbG93cyB0byByZXZva2UgdGhlXG4gKiBlbWFpbCBhZGRyZXNzIGNoYW5nZSwgaW4gb3JkZXIgdG8gcHJvdGVjdCB0aGVtIGZyb20gYWNjb3VudCBoaWphY2tpbmcuXG4gKlxuICogVGhpcyBtZXRob2QgaXMgbm90IHN1cHBvcnRlZCBvbiBhbnkge0BsaW5rIFVzZXJ9IHNpZ25lZCBpbiBieSB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzXG4gKiBjcmVhdGVkIHdpdGggYSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXG4gKlxuICogSW1wb3J0YW50OiB0aGlzIGlzIGEgc2VjdXJpdHkgc2Vuc2l0aXZlIG9wZXJhdGlvbiB0aGF0IHJlcXVpcmVzIHRoZSB1c2VyIHRvIGhhdmUgcmVjZW50bHkgc2lnbmVkXG4gKiBpbi4gSWYgdGhpcyByZXF1aXJlbWVudCBpc24ndCBtZXQsIGFzayB0aGUgdXNlciB0byBhdXRoZW50aWNhdGUgYWdhaW4gYW5kIHRoZW4gY2FsbFxuICoge0BsaW5rIHJlYXV0aGVudGljYXRlV2l0aENyZWRlbnRpYWx9LlxuICpcbiAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIuXG4gKiBAcGFyYW0gbmV3RW1haWwgLSBUaGUgbmV3IGVtYWlsIGFkZHJlc3MuXG4gKlxuICogVGhyb3dzIFwiYXV0aC9vcGVyYXRpb24tbm90LWFsbG93ZWRcIiBlcnJvciB3aGVuXG4gKiB7QGxpbmsgaHR0cHM6Ly9jbG91ZC5nb29nbGUuY29tL2lkZW50aXR5LXBsYXRmb3JtL2RvY3MvYWRtaW4vZW1haWwtZW51bWVyYXRpb24tcHJvdGVjdGlvbiB8IEVtYWlsIEVudW1lcmF0aW9uIFByb3RlY3Rpb259XG4gKiBpcyBlbmFibGVkLlxuICogRGVwcmVjYXRlZCAtIFVzZSB7QGxpbmsgdmVyaWZ5QmVmb3JlVXBkYXRlRW1haWx9IGluc3RlYWQuXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiB1cGRhdGVFbWFpbCh1c2VyLCBuZXdFbWFpbCkge1xuICAgIGNvbnN0IHVzZXJJbnRlcm5hbCA9IGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKTtcbiAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAodXNlckludGVybmFsLmF1dGguYXBwKSkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZWplY3QoX3NlcnZlckFwcEN1cnJlbnRVc2VyT3BlcmF0aW9uTm90U3VwcG9ydGVkRXJyb3IodXNlckludGVybmFsLmF1dGgpKTtcbiAgICB9XG4gICAgcmV0dXJuIHVwZGF0ZUVtYWlsT3JQYXNzd29yZCh1c2VySW50ZXJuYWwsIG5ld0VtYWlsLCBudWxsKTtcbn1cbi8qKlxuICogVXBkYXRlcyB0aGUgdXNlcidzIHBhc3N3b3JkLlxuICpcbiAqIEByZW1hcmtzXG4gKiBJbXBvcnRhbnQ6IHRoaXMgaXMgYSBzZWN1cml0eSBzZW5zaXRpdmUgb3BlcmF0aW9uIHRoYXQgcmVxdWlyZXMgdGhlIHVzZXIgdG8gaGF2ZSByZWNlbnRseSBzaWduZWRcbiAqIGluLiBJZiB0aGlzIHJlcXVpcmVtZW50IGlzbid0IG1ldCwgYXNrIHRoZSB1c2VyIHRvIGF1dGhlbnRpY2F0ZSBhZ2FpbiBhbmQgdGhlbiBjYWxsXG4gKiB7QGxpbmsgcmVhdXRoZW50aWNhdGVXaXRoQ3JlZGVudGlhbH0uXG4gKlxuICogQHBhcmFtIHVzZXIgLSBUaGUgdXNlci5cbiAqIEBwYXJhbSBuZXdQYXNzd29yZCAtIFRoZSBuZXcgcGFzc3dvcmQuXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiB1cGRhdGVQYXNzd29yZCh1c2VyLCBuZXdQYXNzd29yZCkge1xuICAgIHJldHVybiB1cGRhdGVFbWFpbE9yUGFzc3dvcmQoZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpLCBudWxsLCBuZXdQYXNzd29yZCk7XG59XG5hc3luYyBmdW5jdGlvbiB1cGRhdGVFbWFpbE9yUGFzc3dvcmQodXNlciwgZW1haWwsIHBhc3N3b3JkKSB7XG4gICAgY29uc3QgeyBhdXRoIH0gPSB1c2VyO1xuICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB1c2VyLmdldElkVG9rZW4oKTtcbiAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICBpZFRva2VuLFxuICAgICAgICByZXR1cm5TZWN1cmVUb2tlbjogdHJ1ZVxuICAgIH07XG4gICAgaWYgKGVtYWlsKSB7XG4gICAgICAgIHJlcXVlc3QuZW1haWwgPSBlbWFpbDtcbiAgICB9XG4gICAgaWYgKHBhc3N3b3JkKSB7XG4gICAgICAgIHJlcXVlc3QucGFzc3dvcmQgPSBwYXNzd29yZDtcbiAgICB9XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBfbG9nb3V0SWZJbnZhbGlkYXRlZCh1c2VyLCB1cGRhdGVFbWFpbFBhc3N3b3JkKGF1dGgsIHJlcXVlc3QpKTtcbiAgICBhd2FpdCB1c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShyZXNwb25zZSwgLyogcmVsb2FkICovIHRydWUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQYXJzZSB0aGUgYEFkZGl0aW9uYWxVc2VySW5mb2AgZnJvbSB0aGUgSUQgdG9rZW4gcmVzcG9uc2UuXG4gKlxuICovXG5mdW5jdGlvbiBfZnJvbUlkVG9rZW5SZXNwb25zZShpZFRva2VuUmVzcG9uc2UpIHtcbiAgICB2YXIgX2EsIF9iO1xuICAgIGlmICghaWRUb2tlblJlc3BvbnNlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB7IHByb3ZpZGVySWQgfSA9IGlkVG9rZW5SZXNwb25zZTtcbiAgICBjb25zdCBwcm9maWxlID0gaWRUb2tlblJlc3BvbnNlLnJhd1VzZXJJbmZvXG4gICAgICAgID8gSlNPTi5wYXJzZShpZFRva2VuUmVzcG9uc2UucmF3VXNlckluZm8pXG4gICAgICAgIDoge307XG4gICAgY29uc3QgaXNOZXdVc2VyID0gaWRUb2tlblJlc3BvbnNlLmlzTmV3VXNlciB8fFxuICAgICAgICBpZFRva2VuUmVzcG9uc2Uua2luZCA9PT0gXCJpZGVudGl0eXRvb2xraXQjU2lnbnVwTmV3VXNlclJlc3BvbnNlXCIgLyogSWRUb2tlblJlc3BvbnNlS2luZC5TaWdudXBOZXdVc2VyICovO1xuICAgIGlmICghcHJvdmlkZXJJZCAmJiAoaWRUb2tlblJlc3BvbnNlID09PSBudWxsIHx8IGlkVG9rZW5SZXNwb25zZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogaWRUb2tlblJlc3BvbnNlLmlkVG9rZW4pKSB7XG4gICAgICAgIGNvbnN0IHNpZ25JblByb3ZpZGVyID0gKF9iID0gKF9hID0gX3BhcnNlVG9rZW4oaWRUb2tlblJlc3BvbnNlLmlkVG9rZW4pKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZmlyZWJhc2UpID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYlsnc2lnbl9pbl9wcm92aWRlciddO1xuICAgICAgICBpZiAoc2lnbkluUHJvdmlkZXIpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkUHJvdmlkZXJJZCA9IHNpZ25JblByb3ZpZGVyICE9PSBcImFub255bW91c1wiIC8qIFByb3ZpZGVySWQuQU5PTllNT1VTICovICYmXG4gICAgICAgICAgICAgICAgc2lnbkluUHJvdmlkZXIgIT09IFwiY3VzdG9tXCIgLyogUHJvdmlkZXJJZC5DVVNUT00gKi9cbiAgICAgICAgICAgICAgICA/IHNpZ25JblByb3ZpZGVyXG4gICAgICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICAgICAgLy8gVXNlcyBnZW5lcmljIGNsYXNzIGluIGFjY29yZGFuY2Ugd2l0aCB0aGUgbGVnYWN5IFNESy5cbiAgICAgICAgICAgIHJldHVybiBuZXcgR2VuZXJpY0FkZGl0aW9uYWxVc2VySW5mbyhpc05ld1VzZXIsIGZpbHRlcmVkUHJvdmlkZXJJZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKCFwcm92aWRlcklkKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBzd2l0Y2ggKHByb3ZpZGVySWQpIHtcbiAgICAgICAgY2FzZSBcImZhY2Vib29rLmNvbVwiIC8qIFByb3ZpZGVySWQuRkFDRUJPT0sgKi86XG4gICAgICAgICAgICByZXR1cm4gbmV3IEZhY2Vib29rQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgcHJvZmlsZSk7XG4gICAgICAgIGNhc2UgXCJnaXRodWIuY29tXCIgLyogUHJvdmlkZXJJZC5HSVRIVUIgKi86XG4gICAgICAgICAgICByZXR1cm4gbmV3IEdpdGh1YkFkZGl0aW9uYWxVc2VySW5mbyhpc05ld1VzZXIsIHByb2ZpbGUpO1xuICAgICAgICBjYXNlIFwiZ29vZ2xlLmNvbVwiIC8qIFByb3ZpZGVySWQuR09PR0xFICovOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBHb29nbGVBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBwcm9maWxlKTtcbiAgICAgICAgY2FzZSBcInR3aXR0ZXIuY29tXCIgLyogUHJvdmlkZXJJZC5UV0lUVEVSICovOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBUd2l0dGVyQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgcHJvZmlsZSwgaWRUb2tlblJlc3BvbnNlLnNjcmVlbk5hbWUgfHwgbnVsbCk7XG4gICAgICAgIGNhc2UgXCJjdXN0b21cIiAvKiBQcm92aWRlcklkLkNVU1RPTSAqLzpcbiAgICAgICAgY2FzZSBcImFub255bW91c1wiIC8qIFByb3ZpZGVySWQuQU5PTllNT1VTICovOlxuICAgICAgICAgICAgcmV0dXJuIG5ldyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvKGlzTmV3VXNlciwgbnVsbCk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICByZXR1cm4gbmV3IEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8oaXNOZXdVc2VyLCBwcm92aWRlcklkLCBwcm9maWxlKTtcbiAgICB9XG59XG5jbGFzcyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb3ZpZGVySWQsIHByb2ZpbGUgPSB7fSkge1xuICAgICAgICB0aGlzLmlzTmV3VXNlciA9IGlzTmV3VXNlcjtcbiAgICAgICAgdGhpcy5wcm92aWRlcklkID0gcHJvdmlkZXJJZDtcbiAgICAgICAgdGhpcy5wcm9maWxlID0gcHJvZmlsZTtcbiAgICB9XG59XG5jbGFzcyBGZWRlcmF0ZWRBZGRpdGlvbmFsVXNlckluZm9XaXRoVXNlcm5hbWUgZXh0ZW5kcyBHZW5lcmljQWRkaXRpb25hbFVzZXJJbmZvIHtcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb3ZpZGVySWQsIHByb2ZpbGUsIHVzZXJuYW1lKSB7XG4gICAgICAgIHN1cGVyKGlzTmV3VXNlciwgcHJvdmlkZXJJZCwgcHJvZmlsZSk7XG4gICAgICAgIHRoaXMudXNlcm5hbWUgPSB1c2VybmFtZTtcbiAgICB9XG59XG5jbGFzcyBGYWNlYm9va0FkZGl0aW9uYWxVc2VySW5mbyBleHRlbmRzIEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8ge1xuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvZmlsZSkge1xuICAgICAgICBzdXBlcihpc05ld1VzZXIsIFwiZmFjZWJvb2suY29tXCIgLyogUHJvdmlkZXJJZC5GQUNFQk9PSyAqLywgcHJvZmlsZSk7XG4gICAgfVxufVxuY2xhc3MgR2l0aHViQWRkaXRpb25hbFVzZXJJbmZvIGV4dGVuZHMgRmVkZXJhdGVkQWRkaXRpb25hbFVzZXJJbmZvV2l0aFVzZXJuYW1lIHtcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb2ZpbGUpIHtcbiAgICAgICAgc3VwZXIoaXNOZXdVc2VyLCBcImdpdGh1Yi5jb21cIiAvKiBQcm92aWRlcklkLkdJVEhVQiAqLywgcHJvZmlsZSwgdHlwZW9mIChwcm9maWxlID09PSBudWxsIHx8IHByb2ZpbGUgPT09IHZvaWQgMCA/IHZvaWQgMCA6IHByb2ZpbGUubG9naW4pID09PSAnc3RyaW5nJyA/IHByb2ZpbGUgPT09IG51bGwgfHwgcHJvZmlsZSA9PT0gdm9pZCAwID8gdm9pZCAwIDogcHJvZmlsZS5sb2dpbiA6IG51bGwpO1xuICAgIH1cbn1cbmNsYXNzIEdvb2dsZUFkZGl0aW9uYWxVc2VySW5mbyBleHRlbmRzIEdlbmVyaWNBZGRpdGlvbmFsVXNlckluZm8ge1xuICAgIGNvbnN0cnVjdG9yKGlzTmV3VXNlciwgcHJvZmlsZSkge1xuICAgICAgICBzdXBlcihpc05ld1VzZXIsIFwiZ29vZ2xlLmNvbVwiIC8qIFByb3ZpZGVySWQuR09PR0xFICovLCBwcm9maWxlKTtcbiAgICB9XG59XG5jbGFzcyBUd2l0dGVyQWRkaXRpb25hbFVzZXJJbmZvIGV4dGVuZHMgRmVkZXJhdGVkQWRkaXRpb25hbFVzZXJJbmZvV2l0aFVzZXJuYW1lIHtcbiAgICBjb25zdHJ1Y3Rvcihpc05ld1VzZXIsIHByb2ZpbGUsIHNjcmVlbk5hbWUpIHtcbiAgICAgICAgc3VwZXIoaXNOZXdVc2VyLCBcInR3aXR0ZXIuY29tXCIgLyogUHJvdmlkZXJJZC5UV0lUVEVSICovLCBwcm9maWxlLCBzY3JlZW5OYW1lKTtcbiAgICB9XG59XG4vKipcbiAqIEV4dHJhY3RzIHByb3ZpZGVyIHNwZWNpZmljIHtAbGluayBBZGRpdGlvbmFsVXNlckluZm99IGZvciB0aGUgZ2l2ZW4gY3JlZGVudGlhbC5cbiAqXG4gKiBAcGFyYW0gdXNlckNyZWRlbnRpYWwgLSBUaGUgdXNlciBjcmVkZW50aWFsLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gZ2V0QWRkaXRpb25hbFVzZXJJbmZvKHVzZXJDcmVkZW50aWFsKSB7XG4gICAgY29uc3QgeyB1c2VyLCBfdG9rZW5SZXNwb25zZSB9ID0gdXNlckNyZWRlbnRpYWw7XG4gICAgaWYgKHVzZXIuaXNBbm9ueW1vdXMgJiYgIV90b2tlblJlc3BvbnNlKSB7XG4gICAgICAgIC8vIEhhbmRsZSB0aGUgc3BlY2lhbCBjYXNlIHdoZXJlIHNpZ25JbkFub255bW91c2x5KCkgZ2V0cyBjYWxsZWQgdHdpY2UuXG4gICAgICAgIC8vIE5vIG5ldHdvcmsgY2FsbCBpcyBtYWRlIHNvIHRoZXJlJ3Mgbm90aGluZyB0byBhY3R1YWxseSBmaWxsIHRoaXMgaW5cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHByb3ZpZGVySWQ6IG51bGwsXG4gICAgICAgICAgICBpc05ld1VzZXI6IGZhbHNlLFxuICAgICAgICAgICAgcHJvZmlsZTogbnVsbFxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gX2Zyb21JZFRva2VuUmVzcG9uc2UoX3Rva2VuUmVzcG9uc2UpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gTm9uLW9wdGlvbmFsIGF1dGggbWV0aG9kcy5cbi8qKlxuICogQ2hhbmdlcyB0aGUgdHlwZSBvZiBwZXJzaXN0ZW5jZSBvbiB0aGUge0BsaW5rIEF1dGh9IGluc3RhbmNlIGZvciB0aGUgY3VycmVudGx5IHNhdmVkXG4gKiBgQXV0aGAgc2Vzc2lvbiBhbmQgYXBwbGllcyB0aGlzIHR5cGUgb2YgcGVyc2lzdGVuY2UgZm9yIGZ1dHVyZSBzaWduLWluIHJlcXVlc3RzLCBpbmNsdWRpbmdcbiAqIHNpZ24taW4gd2l0aCByZWRpcmVjdCByZXF1ZXN0cy5cbiAqXG4gKiBAcmVtYXJrc1xuICogVGhpcyBtYWtlcyBpdCBlYXN5IGZvciBhIHVzZXIgc2lnbmluZyBpbiB0byBzcGVjaWZ5IHdoZXRoZXIgdGhlaXIgc2Vzc2lvbiBzaG91bGQgYmVcbiAqIHJlbWVtYmVyZWQgb3Igbm90LiBJdCBhbHNvIG1ha2VzIGl0IGVhc2llciB0byBuZXZlciBwZXJzaXN0IHRoZSBgQXV0aGAgc3RhdGUgZm9yIGFwcGxpY2F0aW9uc1xuICogdGhhdCBhcmUgc2hhcmVkIGJ5IG90aGVyIHVzZXJzIG9yIGhhdmUgc2Vuc2l0aXZlIGRhdGEuXG4gKlxuICogVGhpcyBtZXRob2QgZG9lcyBub3Qgd29yayBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQgb3Igd2l0aCB7QGxpbmsgQXV0aH0gaW5zdGFuY2VzIGNyZWF0ZWQgd2l0aCBhXG4gKiB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZVNlcnZlckFwcH0uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIHNldFBlcnNpc3RlbmNlKGF1dGgsIGJyb3dzZXJTZXNzaW9uUGVyc2lzdGVuY2UpO1xuICogYGBgXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIHBlcnNpc3RlbmNlIC0gVGhlIHtAbGluayBQZXJzaXN0ZW5jZX0gdG8gdXNlLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCByZXNvbHZlcyBvbmNlIHRoZSBwZXJzaXN0ZW5jZSBjaGFuZ2UgaGFzIGNvbXBsZXRlZFxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gc2V0UGVyc2lzdGVuY2UoYXV0aCwgcGVyc2lzdGVuY2UpIHtcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLnNldFBlcnNpc3RlbmNlKHBlcnNpc3RlbmNlKTtcbn1cbi8qKlxuICogTG9hZHMgdGhlIHJlQ0FQVENIQSBjb25maWd1cmF0aW9uIGludG8gdGhlIGBBdXRoYCBpbnN0YW5jZS5cbiAqXG4gKiBAcmVtYXJrc1xuICogVGhpcyB3aWxsIGxvYWQgdGhlIHJlQ0FQVENIQSBjb25maWcsIHdoaWNoIGluZGljYXRlcyB3aGV0aGVyIHRoZSByZUNBUFRDSEFcbiAqIHZlcmlmaWNhdGlvbiBmbG93IHNob3VsZCBiZSB0cmlnZ2VyZWQgZm9yIGVhY2ggYXV0aCBwcm92aWRlciwgaW50byB0aGVcbiAqIGN1cnJlbnQgQXV0aCBzZXNzaW9uLlxuICpcbiAqIElmIGluaXRpYWxpemVSZWNhcHRjaGFDb25maWcoKSBpcyBub3QgaW52b2tlZCwgdGhlIGF1dGggZmxvdyB3aWxsIGFsd2F5cyBzdGFydFxuICogd2l0aG91dCByZUNBUFRDSEEgdmVyaWZpY2F0aW9uLiBJZiB0aGUgcHJvdmlkZXIgaXMgY29uZmlndXJlZCB0byByZXF1aXJlIHJlQ0FQVENIQVxuICogdmVyaWZpY2F0aW9uLCB0aGUgU0RLIHdpbGwgdHJhbnNwYXJlbnRseSBsb2FkIHRoZSByZUNBUFRDSEEgY29uZmlnIGFuZCByZXN0YXJ0IHRoZVxuICogYXV0aCBmbG93cy5cbiAqXG4gKiBUaHVzLCBieSBjYWxsaW5nIHRoaXMgb3B0aW9uYWwgbWV0aG9kLCB5b3Ugd2lsbCByZWR1Y2UgdGhlIGxhdGVuY3kgb2YgZnV0dXJlIGF1dGggZmxvd3MuXG4gKiBMb2FkaW5nIHRoZSByZUNBUFRDSEEgY29uZmlnIGVhcmx5IHdpbGwgYWxzbyBlbmhhbmNlIHRoZSBzaWduYWwgY29sbGVjdGVkIGJ5IHJlQ0FQVENIQS5cbiAqXG4gKiBUaGlzIG1ldGhvZCBkb2VzIG5vdCB3b3JrIGluIGEgTm9kZS5qcyBlbnZpcm9ubWVudC5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgamF2YXNjcmlwdFxuICogaW5pdGlhbGl6ZVJlY2FwdGNoYUNvbmZpZyhhdXRoKTtcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIGluaXRpYWxpemVSZWNhcHRjaGFDb25maWcoYXV0aCkge1xuICAgIHJldHVybiBfaW5pdGlhbGl6ZVJlY2FwdGNoYUNvbmZpZyhhdXRoKTtcbn1cbi8qKlxuICogVmFsaWRhdGVzIHRoZSBwYXNzd29yZCBhZ2FpbnN0IHRoZSBwYXNzd29yZCBwb2xpY3kgY29uZmlndXJlZCBmb3IgdGhlIHByb2plY3Qgb3IgdGVuYW50LlxuICpcbiAqIEByZW1hcmtzXG4gKiBJZiBubyB0ZW5hbnQgSUQgaXMgc2V0IG9uIHRoZSBgQXV0aGAgaW5zdGFuY2UsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCB1c2UgdGhlIHBhc3N3b3JkXG4gKiBwb2xpY3kgY29uZmlndXJlZCBmb3IgdGhlIHByb2plY3QuIE90aGVyd2lzZSwgdGhpcyBtZXRob2Qgd2lsbCB1c2UgdGhlIHBvbGljeSBjb25maWd1cmVkXG4gKiBmb3IgdGhlIHRlbmFudC4gSWYgYSBwYXNzd29yZCBwb2xpY3kgaGFzIG5vdCBiZWVuIGNvbmZpZ3VyZWQsIHRoZW4gdGhlIGRlZmF1bHQgcG9saWN5XG4gKiBjb25maWd1cmVkIGZvciBhbGwgcHJvamVjdHMgd2lsbCBiZSB1c2VkLlxuICpcbiAqIElmIGFuIGF1dGggZmxvdyBmYWlscyBiZWNhdXNlIGEgc3VibWl0dGVkIHBhc3N3b3JkIGRvZXMgbm90IG1lZXQgdGhlIHBhc3N3b3JkIHBvbGljeVxuICogcmVxdWlyZW1lbnRzIGFuZCB0aGlzIG1ldGhvZCBoYXMgcHJldmlvdXNseSBiZWVuIGNhbGxlZCwgdGhlbiB0aGlzIG1ldGhvZCB3aWxsIHVzZSB0aGVcbiAqIG1vc3QgcmVjZW50IHBvbGljeSBhdmFpbGFibGUgd2hlbiBjYWxsZWQgYWdhaW4uXG4gKlxuICogQGV4YW1wbGVcbiAqIGBgYGphdmFzY3JpcHRcbiAqIHZhbGlkYXRlUGFzc3dvcmQoYXV0aCwgJ3NvbWUtcGFzc3dvcmQnKTtcbiAqIGBgYFxuICpcbiAqIEBwYXJhbSBhdXRoIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXG4gKiBAcGFyYW0gcGFzc3dvcmQgVGhlIHBhc3N3b3JkIHRvIHZhbGlkYXRlLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gdmFsaWRhdGVQYXNzd29yZChhdXRoLCBwYXNzd29yZCkge1xuICAgIGNvbnN0IGF1dGhJbnRlcm5hbCA9IF9jYXN0QXV0aChhdXRoKTtcbiAgICByZXR1cm4gYXV0aEludGVybmFsLnZhbGlkYXRlUGFzc3dvcmQocGFzc3dvcmQpO1xufVxuLyoqXG4gKiBBZGRzIGFuIG9ic2VydmVyIGZvciBjaGFuZ2VzIHRvIHRoZSBzaWduZWQtaW4gdXNlcidzIElEIHRva2VuLlxuICpcbiAqIEByZW1hcmtzXG4gKiBUaGlzIGluY2x1ZGVzIHNpZ24taW4sIHNpZ24tb3V0LCBhbmQgdG9rZW4gcmVmcmVzaCBldmVudHMuXG4gKiBUaGlzIHdpbGwgbm90IGJlIHRyaWdnZXJlZCBhdXRvbWF0aWNhbGx5IHVwb24gSUQgdG9rZW4gZXhwaXJhdGlvbi4gVXNlIHtAbGluayBVc2VyLmdldElkVG9rZW59IHRvIHJlZnJlc2ggdGhlIElEIHRva2VuLlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBuZXh0T3JPYnNlcnZlciAtIGNhbGxiYWNrIHRyaWdnZXJlZCBvbiBjaGFuZ2UuXG4gKiBAcGFyYW0gZXJyb3IgLSBEZXByZWNhdGVkLiBUaGlzIGNhbGxiYWNrIGlzIG5ldmVyIHRyaWdnZXJlZC4gRXJyb3JzXG4gKiBvbiBzaWduaW5nIGluL291dCBjYW4gYmUgY2F1Z2h0IGluIHByb21pc2VzIHJldHVybmVkIGZyb21cbiAqIHNpZ24taW4vc2lnbi1vdXQgZnVuY3Rpb25zLlxuICogQHBhcmFtIGNvbXBsZXRlZCAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gb25JZFRva2VuQ2hhbmdlZChhdXRoLCBuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCkge1xuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkub25JZFRva2VuQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7XG59XG4vKipcbiAqIEFkZHMgYSBibG9ja2luZyBjYWxsYmFjayB0aGF0IHJ1bnMgYmVmb3JlIGFuIGF1dGggc3RhdGUgY2hhbmdlXG4gKiBzZXRzIGEgbmV3IHVzZXIuXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIGNhbGxiYWNrIC0gY2FsbGJhY2sgdHJpZ2dlcmVkIGJlZm9yZSBuZXcgdXNlciB2YWx1ZSBpcyBzZXQuXG4gKiAgIElmIHRoaXMgdGhyb3dzLCBpdCBibG9ja3MgdGhlIHVzZXIgZnJvbSBiZWluZyBzZXQuXG4gKiBAcGFyYW0gb25BYm9ydCAtIGNhbGxiYWNrIHRyaWdnZXJlZCBpZiBhIGxhdGVyIGBiZWZvcmVBdXRoU3RhdGVDaGFuZ2VkKClgXG4gKiAgIGNhbGxiYWNrIHRocm93cywgYWxsb3dpbmcgeW91IHRvIHVuZG8gYW55IHNpZGUgZWZmZWN0cy5cbiAqL1xuZnVuY3Rpb24gYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChhdXRoLCBjYWxsYmFjaywgb25BYm9ydCkge1xuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZChjYWxsYmFjaywgb25BYm9ydCk7XG59XG4vKipcbiAqIEFkZHMgYW4gb2JzZXJ2ZXIgZm9yIGNoYW5nZXMgdG8gdGhlIHVzZXIncyBzaWduLWluIHN0YXRlLlxuICpcbiAqIEByZW1hcmtzXG4gKiBUbyBrZWVwIHRoZSBvbGQgYmVoYXZpb3IsIHNlZSB7QGxpbmsgb25JZFRva2VuQ2hhbmdlZH0uXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIG5leHRPck9ic2VydmVyIC0gY2FsbGJhY2sgdHJpZ2dlcmVkIG9uIGNoYW5nZS5cbiAqIEBwYXJhbSBlcnJvciAtIERlcHJlY2F0ZWQuIFRoaXMgY2FsbGJhY2sgaXMgbmV2ZXIgdHJpZ2dlcmVkLiBFcnJvcnNcbiAqIG9uIHNpZ25pbmcgaW4vb3V0IGNhbiBiZSBjYXVnaHQgaW4gcHJvbWlzZXMgcmV0dXJuZWQgZnJvbVxuICogc2lnbi1pbi9zaWduLW91dCBmdW5jdGlvbnMuXG4gKiBAcGFyYW0gY29tcGxldGVkIC0gRGVwcmVjYXRlZC4gVGhpcyBjYWxsYmFjayBpcyBuZXZlciB0cmlnZ2VyZWQuXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiBvbkF1dGhTdGF0ZUNoYW5nZWQoYXV0aCwgbmV4dE9yT2JzZXJ2ZXIsIGVycm9yLCBjb21wbGV0ZWQpIHtcbiAgICByZXR1cm4gZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLm9uQXV0aFN0YXRlQ2hhbmdlZChuZXh0T3JPYnNlcnZlciwgZXJyb3IsIGNvbXBsZXRlZCk7XG59XG4vKipcbiAqIFNldHMgdGhlIGN1cnJlbnQgbGFuZ3VhZ2UgdG8gdGhlIGRlZmF1bHQgZGV2aWNlL2Jyb3dzZXIgcHJlZmVyZW5jZS5cbiAqXG4gKiBAcGFyYW0gYXV0aCAtIFRoZSB7QGxpbmsgQXV0aH0gaW5zdGFuY2UuXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiB1c2VEZXZpY2VMYW5ndWFnZShhdXRoKSB7XG4gICAgZ2V0TW9kdWxhckluc3RhbmNlKGF1dGgpLnVzZURldmljZUxhbmd1YWdlKCk7XG59XG4vKipcbiAqIEFzeW5jaHJvbm91c2x5IHNldHMgdGhlIHByb3ZpZGVkIHVzZXIgYXMge0BsaW5rIEF1dGguY3VycmVudFVzZXJ9IG9uIHRoZVxuICoge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICpcbiAqIEByZW1hcmtzXG4gKiBBIG5ldyBpbnN0YW5jZSBjb3B5IG9mIHRoZSB1c2VyIHByb3ZpZGVkIHdpbGwgYmUgbWFkZSBhbmQgc2V0IGFzIGN1cnJlbnRVc2VyLlxuICpcbiAqIFRoaXMgd2lsbCB0cmlnZ2VyIHtAbGluayBvbkF1dGhTdGF0ZUNoYW5nZWR9IGFuZCB7QGxpbmsgb25JZFRva2VuQ2hhbmdlZH0gbGlzdGVuZXJzXG4gKiBsaWtlIG90aGVyIHNpZ24gaW4gbWV0aG9kcy5cbiAqXG4gKiBUaGUgb3BlcmF0aW9uIGZhaWxzIHdpdGggYW4gZXJyb3IgaWYgdGhlIHVzZXIgdG8gYmUgdXBkYXRlZCBiZWxvbmdzIHRvIGEgZGlmZmVyZW50IEZpcmViYXNlXG4gKiBwcm9qZWN0LlxuICpcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSB1c2VyIC0gVGhlIG5ldyB7QGxpbmsgVXNlcn0uXG4gKlxuICogQHB1YmxpY1xuICovXG5mdW5jdGlvbiB1cGRhdGVDdXJyZW50VXNlcihhdXRoLCB1c2VyKSB7XG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZShhdXRoKS51cGRhdGVDdXJyZW50VXNlcih1c2VyKTtcbn1cbi8qKlxuICogU2lnbnMgb3V0IHRoZSBjdXJyZW50IHVzZXIuXG4gKlxuICogQHJlbWFya3NcbiAqIFRoaXMgbWV0aG9kIGlzIG5vdCBzdXBwb3J0ZWQgYnkge0BsaW5rIEF1dGh9IGluc3RhbmNlcyBjcmVhdGVkIHdpdGggYVxuICoge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VTZXJ2ZXJBcHB9LlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIHNpZ25PdXQoYXV0aCkge1xuICAgIHJldHVybiBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCkuc2lnbk91dCgpO1xufVxuLyoqXG4gKiBSZXZva2VzIHRoZSBnaXZlbiBhY2Nlc3MgdG9rZW4uIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRzIEFwcGxlIE9BdXRoIGFjY2VzcyB0b2tlbnMuXG4gKlxuICogQHBhcmFtIGF1dGggLSBUaGUge0BsaW5rIEF1dGh9IGluc3RhbmNlLlxuICogQHBhcmFtIHRva2VuIC0gVGhlIEFwcGxlIE9BdXRoIGFjY2VzcyB0b2tlbi5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIHJldm9rZUFjY2Vzc1Rva2VuKGF1dGgsIHRva2VuKSB7XG4gICAgY29uc3QgYXV0aEludGVybmFsID0gX2Nhc3RBdXRoKGF1dGgpO1xuICAgIHJldHVybiBhdXRoSW50ZXJuYWwucmV2b2tlQWNjZXNzVG9rZW4odG9rZW4pO1xufVxuLyoqXG4gKiBEZWxldGVzIGFuZCBzaWducyBvdXQgdGhlIHVzZXIuXG4gKlxuICogQHJlbWFya3NcbiAqIEltcG9ydGFudDogdGhpcyBpcyBhIHNlY3VyaXR5LXNlbnNpdGl2ZSBvcGVyYXRpb24gdGhhdCByZXF1aXJlcyB0aGUgdXNlciB0byBoYXZlIHJlY2VudGx5XG4gKiBzaWduZWQgaW4uIElmIHRoaXMgcmVxdWlyZW1lbnQgaXNuJ3QgbWV0LCBhc2sgdGhlIHVzZXIgdG8gYXV0aGVudGljYXRlIGFnYWluIGFuZCB0aGVuIGNhbGxcbiAqIHtAbGluayByZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsfS5cbiAqXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZGVsZXRlVXNlcih1c2VyKSB7XG4gICAgcmV0dXJuIGdldE1vZHVsYXJJbnN0YW5jZSh1c2VyKS5kZWxldGUoKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIE11bHRpRmFjdG9yU2Vzc2lvbkltcGwge1xuICAgIGNvbnN0cnVjdG9yKHR5cGUsIGNyZWRlbnRpYWwsIHVzZXIpIHtcbiAgICAgICAgdGhpcy50eXBlID0gdHlwZTtcbiAgICAgICAgdGhpcy5jcmVkZW50aWFsID0gY3JlZGVudGlhbDtcbiAgICAgICAgdGhpcy51c2VyID0gdXNlcjtcbiAgICB9XG4gICAgc3RhdGljIF9mcm9tSWR0b2tlbihpZFRva2VuLCB1c2VyKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JTZXNzaW9uSW1wbChcImVucm9sbFwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuRU5ST0xMICovLCBpZFRva2VuLCB1c2VyKTtcbiAgICB9XG4gICAgc3RhdGljIF9mcm9tTWZhUGVuZGluZ0NyZWRlbnRpYWwobWZhUGVuZGluZ0NyZWRlbnRpYWwpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNdWx0aUZhY3RvclNlc3Npb25JbXBsKFwic2lnbmluXCIgLyogTXVsdGlGYWN0b3JTZXNzaW9uVHlwZS5TSUdOX0lOICovLCBtZmFQZW5kaW5nQ3JlZGVudGlhbCk7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgY29uc3Qga2V5ID0gdGhpcy50eXBlID09PSBcImVucm9sbFwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuRU5ST0xMICovXG4gICAgICAgICAgICA/ICdpZFRva2VuJ1xuICAgICAgICAgICAgOiAncGVuZGluZ0NyZWRlbnRpYWwnO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbXVsdGlGYWN0b3JTZXNzaW9uOiB7XG4gICAgICAgICAgICAgICAgW2tleV06IHRoaXMuY3JlZGVudGlhbFxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbUpTT04ob2JqKSB7XG4gICAgICAgIHZhciBfYSwgX2I7XG4gICAgICAgIGlmIChvYmogPT09IG51bGwgfHwgb2JqID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvYmoubXVsdGlGYWN0b3JTZXNzaW9uKSB7XG4gICAgICAgICAgICBpZiAoKF9hID0gb2JqLm11bHRpRmFjdG9yU2Vzc2lvbikgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLnBlbmRpbmdDcmVkZW50aWFsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE11bHRpRmFjdG9yU2Vzc2lvbkltcGwuX2Zyb21NZmFQZW5kaW5nQ3JlZGVudGlhbChvYmoubXVsdGlGYWN0b3JTZXNzaW9uLnBlbmRpbmdDcmVkZW50aWFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKChfYiA9IG9iai5tdWx0aUZhY3RvclNlc3Npb24pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi5pZFRva2VuKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIE11bHRpRmFjdG9yU2Vzc2lvbkltcGwuX2Zyb21JZHRva2VuKG9iai5tdWx0aUZhY3RvclNlc3Npb24uaWRUb2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgTXVsdGlGYWN0b3JSZXNvbHZlckltcGwge1xuICAgIGNvbnN0cnVjdG9yKHNlc3Npb24sIGhpbnRzLCBzaWduSW5SZXNvbHZlcikge1xuICAgICAgICB0aGlzLnNlc3Npb24gPSBzZXNzaW9uO1xuICAgICAgICB0aGlzLmhpbnRzID0gaGludHM7XG4gICAgICAgIHRoaXMuc2lnbkluUmVzb2x2ZXIgPSBzaWduSW5SZXNvbHZlcjtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBfZnJvbUVycm9yKGF1dGhFeHRlcm4sIGVycm9yKSB7XG4gICAgICAgIGNvbnN0IGF1dGggPSBfY2FzdEF1dGgoYXV0aEV4dGVybik7XG4gICAgICAgIGNvbnN0IHNlcnZlclJlc3BvbnNlID0gZXJyb3IuY3VzdG9tRGF0YS5fc2VydmVyUmVzcG9uc2U7XG4gICAgICAgIGNvbnN0IGhpbnRzID0gKHNlcnZlclJlc3BvbnNlLm1mYUluZm8gfHwgW10pLm1hcChlbnJvbGxtZW50ID0+IE11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZShhdXRoLCBlbnJvbGxtZW50KSk7XG4gICAgICAgIF9hc3NlcnQoc2VydmVyUmVzcG9uc2UubWZhUGVuZGluZ0NyZWRlbnRpYWwsIGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IE11bHRpRmFjdG9yU2Vzc2lvbkltcGwuX2Zyb21NZmFQZW5kaW5nQ3JlZGVudGlhbChzZXJ2ZXJSZXNwb25zZS5tZmFQZW5kaW5nQ3JlZGVudGlhbCk7XG4gICAgICAgIHJldHVybiBuZXcgTXVsdGlGYWN0b3JSZXNvbHZlckltcGwoc2Vzc2lvbiwgaGludHMsIGFzeW5jIChhc3NlcnRpb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG1mYVJlc3BvbnNlID0gYXdhaXQgYXNzZXJ0aW9uLl9wcm9jZXNzKGF1dGgsIHNlc3Npb24pO1xuICAgICAgICAgICAgLy8gQ2xlYXIgb3V0IHRoZSB1bm5lZWRlZCBmaWVsZHMgZnJvbSB0aGUgb2xkIGxvZ2luIHJlc3BvbnNlXG4gICAgICAgICAgICBkZWxldGUgc2VydmVyUmVzcG9uc2UubWZhSW5mbztcbiAgICAgICAgICAgIGRlbGV0ZSBzZXJ2ZXJSZXNwb25zZS5tZmFQZW5kaW5nQ3JlZGVudGlhbDtcbiAgICAgICAgICAgIC8vIFVzZSBpbiB0aGUgbmV3IHRva2VuICYgcmVmcmVzaCB0b2tlbiBpbiB0aGUgb2xkIHJlc3BvbnNlXG4gICAgICAgICAgICBjb25zdCBpZFRva2VuUmVzcG9uc2UgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIHNlcnZlclJlc3BvbnNlKSwgeyBpZFRva2VuOiBtZmFSZXNwb25zZS5pZFRva2VuLCByZWZyZXNoVG9rZW46IG1mYVJlc3BvbnNlLnJlZnJlc2hUb2tlbiB9KTtcbiAgICAgICAgICAgIC8vIFRPRE86IHdlIHNob3VsZCBjb2xsYXBzZSB0aGlzIHN3aXRjaCBzdGF0ZW1lbnQgaW50byBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbiBhbmQgaGF2ZSBpdCBzdXBwb3J0IHRoZSBTSUdOX0lOIGNhc2VcbiAgICAgICAgICAgIHN3aXRjaCAoZXJyb3Iub3BlcmF0aW9uVHlwZSkge1xuICAgICAgICAgICAgICAgIGNhc2UgXCJzaWduSW5cIiAvKiBPcGVyYXRpb25UeXBlLlNJR05fSU4gKi86XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJDcmVkZW50aWFsID0gYXdhaXQgVXNlckNyZWRlbnRpYWxJbXBsLl9mcm9tSWRUb2tlblJlc3BvbnNlKGF1dGgsIGVycm9yLm9wZXJhdGlvblR5cGUsIGlkVG9rZW5SZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGF3YWl0IGF1dGguX3VwZGF0ZUN1cnJlbnRVc2VyKHVzZXJDcmVkZW50aWFsLnVzZXIpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlckNyZWRlbnRpYWw7XG4gICAgICAgICAgICAgICAgY2FzZSBcInJlYXV0aGVudGljYXRlXCIgLyogT3BlcmF0aW9uVHlwZS5SRUFVVEhFTlRJQ0FURSAqLzpcbiAgICAgICAgICAgICAgICAgICAgX2Fzc2VydChlcnJvci51c2VyLCBhdXRoLCBcImludGVybmFsLWVycm9yXCIgLyogQXV0aEVycm9yQ29kZS5JTlRFUk5BTF9FUlJPUiAqLyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBVc2VyQ3JlZGVudGlhbEltcGwuX2Zvck9wZXJhdGlvbihlcnJvci51c2VyLCBlcnJvci5vcGVyYXRpb25UeXBlLCBpZFRva2VuUmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIF9mYWlsKGF1dGgsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFzeW5jIHJlc29sdmVTaWduSW4oYXNzZXJ0aW9uRXh0ZXJuKSB7XG4gICAgICAgIGNvbnN0IGFzc2VydGlvbiA9IGFzc2VydGlvbkV4dGVybjtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2lnbkluUmVzb2x2ZXIoYXNzZXJ0aW9uKTtcbiAgICB9XG59XG4vKipcbiAqIFByb3ZpZGVzIGEge0BsaW5rIE11bHRpRmFjdG9yUmVzb2x2ZXJ9IHN1aXRhYmxlIGZvciBjb21wbGV0aW9uIG9mIGFcbiAqIG11bHRpLWZhY3RvciBmbG93LlxuICpcbiAqIEBwYXJhbSBhdXRoIC0gVGhlIHtAbGluayBBdXRofSBpbnN0YW5jZS5cbiAqIEBwYXJhbSBlcnJvciAtIFRoZSB7QGxpbmsgTXVsdGlGYWN0b3JFcnJvcn0gcmFpc2VkIGR1cmluZyBhIHNpZ24taW4sIG9yXG4gKiByZWF1dGhlbnRpY2F0aW9uIG9wZXJhdGlvbi5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIGdldE11bHRpRmFjdG9yUmVzb2x2ZXIoYXV0aCwgZXJyb3IpIHtcbiAgICB2YXIgX2E7XG4gICAgY29uc3QgYXV0aE1vZHVsYXIgPSBnZXRNb2R1bGFySW5zdGFuY2UoYXV0aCk7XG4gICAgY29uc3QgZXJyb3JJbnRlcm5hbCA9IGVycm9yO1xuICAgIF9hc3NlcnQoZXJyb3IuY3VzdG9tRGF0YS5vcGVyYXRpb25UeXBlLCBhdXRoTW9kdWxhciwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xuICAgIF9hc3NlcnQoKF9hID0gZXJyb3JJbnRlcm5hbC5jdXN0b21EYXRhLl9zZXJ2ZXJSZXNwb25zZSkgPT09IG51bGwgfHwgX2EgPT09IHZvaWQgMCA/IHZvaWQgMCA6IF9hLm1mYVBlbmRpbmdDcmVkZW50aWFsLCBhdXRoTW9kdWxhciwgXCJhcmd1bWVudC1lcnJvclwiIC8qIEF1dGhFcnJvckNvZGUuQVJHVU1FTlRfRVJST1IgKi8pO1xuICAgIHJldHVybiBNdWx0aUZhY3RvclJlc29sdmVySW1wbC5fZnJvbUVycm9yKGF1dGhNb2R1bGFyLCBlcnJvckludGVybmFsKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIHN0YXJ0RW5yb2xsUGhvbmVNZmEoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92Mi9hY2NvdW50cy9tZmFFbnJvbGxtZW50OnN0YXJ0XCIgLyogRW5kcG9pbnQuU1RBUlRfTUZBX0VOUk9MTE1FTlQgKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5mdW5jdGlvbiBmaW5hbGl6ZUVucm9sbFBob25lTWZhKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhRW5yb2xsbWVudDpmaW5hbGl6ZVwiIC8qIEVuZHBvaW50LkZJTkFMSVpFX01GQV9FTlJPTExNRU5UICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuZnVuY3Rpb24gc3RhcnRFbnJvbGxUb3RwTWZhKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhRW5yb2xsbWVudDpzdGFydFwiIC8qIEVuZHBvaW50LlNUQVJUX01GQV9FTlJPTExNRU5UICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuZnVuY3Rpb24gZmluYWxpemVFbnJvbGxUb3RwTWZhKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhRW5yb2xsbWVudDpmaW5hbGl6ZVwiIC8qIEVuZHBvaW50LkZJTkFMSVpFX01GQV9FTlJPTExNRU5UICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuZnVuY3Rpb24gd2l0aGRyYXdNZmEoYXV0aCwgcmVxdWVzdCkge1xuICAgIHJldHVybiBfcGVyZm9ybUFwaVJlcXVlc3QoYXV0aCwgXCJQT1NUXCIgLyogSHR0cE1ldGhvZC5QT1NUICovLCBcIi92Mi9hY2NvdW50cy9tZmFFbnJvbGxtZW50OndpdGhkcmF3XCIgLyogRW5kcG9pbnQuV0lUSERSQVdfTUZBICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuXG5jbGFzcyBNdWx0aUZhY3RvclVzZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3Rvcih1c2VyKSB7XG4gICAgICAgIHRoaXMudXNlciA9IHVzZXI7XG4gICAgICAgIHRoaXMuZW5yb2xsZWRGYWN0b3JzID0gW107XG4gICAgICAgIHVzZXIuX29uUmVsb2FkKHVzZXJJbmZvID0+IHtcbiAgICAgICAgICAgIGlmICh1c2VySW5mby5tZmFJbmZvKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5lbnJvbGxlZEZhY3RvcnMgPSB1c2VySW5mby5tZmFJbmZvLm1hcChlbnJvbGxtZW50ID0+IE11bHRpRmFjdG9ySW5mb0ltcGwuX2Zyb21TZXJ2ZXJSZXNwb25zZSh1c2VyLmF1dGgsIGVucm9sbG1lbnQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN0YXRpYyBfZnJvbVVzZXIodXNlcikge1xuICAgICAgICByZXR1cm4gbmV3IE11bHRpRmFjdG9yVXNlckltcGwodXNlcik7XG4gICAgfVxuICAgIGFzeW5jIGdldFNlc3Npb24oKSB7XG4gICAgICAgIHJldHVybiBNdWx0aUZhY3RvclNlc3Npb25JbXBsLl9mcm9tSWR0b2tlbihhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbigpLCB0aGlzLnVzZXIpO1xuICAgIH1cbiAgICBhc3luYyBlbnJvbGwoYXNzZXJ0aW9uRXh0ZXJuLCBkaXNwbGF5TmFtZSkge1xuICAgICAgICBjb25zdCBhc3NlcnRpb24gPSBhc3NlcnRpb25FeHRlcm47XG4gICAgICAgIGNvbnN0IHNlc3Npb24gPSAoYXdhaXQgdGhpcy5nZXRTZXNzaW9uKCkpO1xuICAgICAgICBjb25zdCBmaW5hbGl6ZU1mYVJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodGhpcy51c2VyLCBhc3NlcnRpb24uX3Byb2Nlc3ModGhpcy51c2VyLmF1dGgsIHNlc3Npb24sIGRpc3BsYXlOYW1lKSk7XG4gICAgICAgIC8vIE5ldyB0b2tlbnMgd2lsbCBiZSBpc3N1ZWQgYWZ0ZXIgZW5yb2xsbWVudCBvZiB0aGUgbmV3IHNlY29uZCBmYWN0b3JzLlxuICAgICAgICAvLyBUaGV5IG5lZWQgdG8gYmUgdXBkYXRlZCBvbiB0aGUgdXNlci5cbiAgICAgICAgYXdhaXQgdGhpcy51c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShmaW5hbGl6ZU1mYVJlc3BvbnNlKTtcbiAgICAgICAgLy8gVGhlIHVzZXIgbmVlZHMgdG8gYmUgcmVsb2FkZWQgdG8gZ2V0IHRoZSBuZXcgbXVsdGktZmFjdG9yIGluZm9ybWF0aW9uXG4gICAgICAgIC8vIGZyb20gc2VydmVyLiBVU0VSX1JFTE9BREVEIGV2ZW50IHdpbGwgYmUgdHJpZ2dlcmVkIGFuZCBgZW5yb2xsZWRGYWN0b3JzYFxuICAgICAgICAvLyB3aWxsIGJlIHVwZGF0ZWQuXG4gICAgICAgIHJldHVybiB0aGlzLnVzZXIucmVsb2FkKCk7XG4gICAgfVxuICAgIGFzeW5jIHVuZW5yb2xsKGluZm9PclVpZCkge1xuICAgICAgICBjb25zdCBtZmFFbnJvbGxtZW50SWQgPSB0eXBlb2YgaW5mb09yVWlkID09PSAnc3RyaW5nJyA/IGluZm9PclVpZCA6IGluZm9PclVpZC51aWQ7XG4gICAgICAgIGNvbnN0IGlkVG9rZW4gPSBhd2FpdCB0aGlzLnVzZXIuZ2V0SWRUb2tlbigpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaWRUb2tlblJlc3BvbnNlID0gYXdhaXQgX2xvZ291dElmSW52YWxpZGF0ZWQodGhpcy51c2VyLCB3aXRoZHJhd01mYSh0aGlzLnVzZXIuYXV0aCwge1xuICAgICAgICAgICAgICAgIGlkVG9rZW4sXG4gICAgICAgICAgICAgICAgbWZhRW5yb2xsbWVudElkXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAvLyBSZW1vdmUgdGhlIHNlY29uZCBmYWN0b3IgZnJvbSB0aGUgdXNlcidzIGxpc3QuXG4gICAgICAgICAgICB0aGlzLmVucm9sbGVkRmFjdG9ycyA9IHRoaXMuZW5yb2xsZWRGYWN0b3JzLmZpbHRlcigoeyB1aWQgfSkgPT4gdWlkICE9PSBtZmFFbnJvbGxtZW50SWQpO1xuICAgICAgICAgICAgLy8gRGVwZW5kaW5nIG9uIHdoZXRoZXIgdGhlIGJhY2tlbmQgZGVjaWRlZCB0byByZXZva2UgdGhlIHVzZXIncyBzZXNzaW9uLFxuICAgICAgICAgICAgLy8gdGhlIHRva2VuUmVzcG9uc2UgbWF5IGJlIGVtcHR5LiBJZiB0aGUgdG9rZW5zIHdlcmUgbm90IHVwZGF0ZWQgKGFuZCB0aGV5XG4gICAgICAgICAgICAvLyBhcmUgbm93IGludmFsaWQpLCByZWxvYWRpbmcgdGhlIHVzZXIgd2lsbCBkaXNjb3ZlciB0aGlzIGFuZCBpbnZhbGlkYXRlXG4gICAgICAgICAgICAvLyB0aGUgdXNlcidzIHN0YXRlIGFjY29yZGluZ2x5LlxuICAgICAgICAgICAgYXdhaXQgdGhpcy51c2VyLl91cGRhdGVUb2tlbnNJZk5lY2Vzc2FyeShpZFRva2VuUmVzcG9uc2UpO1xuICAgICAgICAgICAgYXdhaXQgdGhpcy51c2VyLnJlbG9hZCgpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9XG4gICAgfVxufVxuY29uc3QgbXVsdGlGYWN0b3JVc2VyQ2FjaGUgPSBuZXcgV2Vha01hcCgpO1xuLyoqXG4gKiBUaGUge0BsaW5rIE11bHRpRmFjdG9yVXNlcn0gY29ycmVzcG9uZGluZyB0byB0aGUgdXNlci5cbiAqXG4gKiBAcmVtYXJrc1xuICogVGhpcyBpcyB1c2VkIHRvIGFjY2VzcyBhbGwgbXVsdGktZmFjdG9yIHByb3BlcnRpZXMgYW5kIG9wZXJhdGlvbnMgcmVsYXRlZCB0byB0aGUgdXNlci5cbiAqXG4gKiBAcGFyYW0gdXNlciAtIFRoZSB1c2VyLlxuICpcbiAqIEBwdWJsaWNcbiAqL1xuZnVuY3Rpb24gbXVsdGlGYWN0b3IodXNlcikge1xuICAgIGNvbnN0IHVzZXJNb2R1bGFyID0gZ2V0TW9kdWxhckluc3RhbmNlKHVzZXIpO1xuICAgIGlmICghbXVsdGlGYWN0b3JVc2VyQ2FjaGUuaGFzKHVzZXJNb2R1bGFyKSkge1xuICAgICAgICBtdWx0aUZhY3RvclVzZXJDYWNoZS5zZXQodXNlck1vZHVsYXIsIE11bHRpRmFjdG9yVXNlckltcGwuX2Zyb21Vc2VyKHVzZXJNb2R1bGFyKSk7XG4gICAgfVxuICAgIHJldHVybiBtdWx0aUZhY3RvclVzZXJDYWNoZS5nZXQodXNlck1vZHVsYXIpO1xufVxuXG5jb25zdCBTVE9SQUdFX0FWQUlMQUJMRV9LRVkgPSAnX19zYWsnO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTaGltIGZvciBQcm9taXNlLmFsbFNldHRsZWQsIG5vdGUgdGhlIHNsaWdodGx5IGRpZmZlcmVudCBmb3JtYXQgb2YgYGZ1bGZpbGxlZGAgdnMgYHN0YXR1c2AuXG4gKlxuICogQHBhcmFtIHByb21pc2VzIC0gQXJyYXkgb2YgcHJvbWlzZXMgdG8gd2FpdCBvbi5cbiAqL1xuZnVuY3Rpb24gX2FsbFNldHRsZWQocHJvbWlzZXMpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMubWFwKGFzeW5jIChwcm9taXNlKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGF3YWl0IHByb21pc2U7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICB2YWx1ZVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAocmVhc29uKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGZ1bGZpbGxlZDogZmFsc2UsXG4gICAgICAgICAgICAgICAgcmVhc29uXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbnRlcmZhY2UgY2xhc3MgZm9yIHJlY2VpdmluZyBtZXNzYWdlcy5cbiAqXG4gKi9cbmNsYXNzIFJlY2VpdmVyIHtcbiAgICBjb25zdHJ1Y3RvcihldmVudFRhcmdldCkge1xuICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0ID0gZXZlbnRUYXJnZXQ7XG4gICAgICAgIHRoaXMuaGFuZGxlcnNNYXAgPSB7fTtcbiAgICAgICAgdGhpcy5ib3VuZEV2ZW50SGFuZGxlciA9IHRoaXMuaGFuZGxlRXZlbnQuYmluZCh0aGlzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT2J0YWluIGFuIGluc3RhbmNlIG9mIGEgUmVjZWl2ZXIgZm9yIGEgZ2l2ZW4gZXZlbnQgdGFyZ2V0LCBpZiBub25lIGV4aXN0cyBpdCB3aWxsIGJlIGNyZWF0ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnRUYXJnZXQgLSBBbiBldmVudCB0YXJnZXQgKHN1Y2ggYXMgd2luZG93IG9yIHNlbGYpIHRocm91Z2ggd2hpY2ggdGhlIHVuZGVybHlpbmdcbiAgICAgKiBtZXNzYWdlcyB3aWxsIGJlIHJlY2VpdmVkLlxuICAgICAqL1xuICAgIHN0YXRpYyBfZ2V0SW5zdGFuY2UoZXZlbnRUYXJnZXQpIHtcbiAgICAgICAgLy8gVGhlIHJlc3VsdHMgYXJlIHN0b3JlZCBpbiBhbiBhcnJheSBzaW5jZSBvYmplY3RzIGNhbid0IGJlIGtleXMgZm9yIG90aGVyXG4gICAgICAgIC8vIG9iamVjdHMuIEluIGFkZGl0aW9uLCBzZXR0aW5nIGEgdW5pcXVlIHByb3BlcnR5IG9uIGFuIGV2ZW50IHRhcmdldCBhcyBhXG4gICAgICAgIC8vIGhhc2ggbWFwIGtleSBtYXkgbm90IGJlIGFsbG93ZWQgZHVlIHRvIENPUlMgcmVzdHJpY3Rpb25zLlxuICAgICAgICBjb25zdCBleGlzdGluZ0luc3RhbmNlID0gdGhpcy5yZWNlaXZlcnMuZmluZChyZWNlaXZlciA9PiByZWNlaXZlci5pc0xpc3RlbmluZ3RvKGV2ZW50VGFyZ2V0KSk7XG4gICAgICAgIGlmIChleGlzdGluZ0luc3RhbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdJbnN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBuZXdJbnN0YW5jZSA9IG5ldyBSZWNlaXZlcihldmVudFRhcmdldCk7XG4gICAgICAgIHRoaXMucmVjZWl2ZXJzLnB1c2gobmV3SW5zdGFuY2UpO1xuICAgICAgICByZXR1cm4gbmV3SW5zdGFuY2U7XG4gICAgfVxuICAgIGlzTGlzdGVuaW5ndG8oZXZlbnRUYXJnZXQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZXZlbnRUYXJnZXQgPT09IGV2ZW50VGFyZ2V0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGYW5zIG91dCBhIE1lc3NhZ2VFdmVudCB0byB0aGUgYXBwcm9wcmlhdGUgbGlzdGVuZXJzLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiBTZW5kcyBhbiB7QGxpbmsgU3RhdHVzLkFDS30gdXBvbiByZWNlaXB0IGFuZCBhIHtAbGluayBTdGF0dXMuRE9ORX0gb25jZSBhbGwgaGFuZGxlcnMgaGF2ZVxuICAgICAqIGZpbmlzaGVkIHByb2Nlc3NpbmcuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnQgLSBUaGUgTWVzc2FnZUV2ZW50LlxuICAgICAqXG4gICAgICovXG4gICAgYXN5bmMgaGFuZGxlRXZlbnQoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZUV2ZW50ID0gZXZlbnQ7XG4gICAgICAgIGNvbnN0IHsgZXZlbnRJZCwgZXZlbnRUeXBlLCBkYXRhIH0gPSBtZXNzYWdlRXZlbnQuZGF0YTtcbiAgICAgICAgY29uc3QgaGFuZGxlcnMgPSB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV07XG4gICAgICAgIGlmICghKGhhbmRsZXJzID09PSBudWxsIHx8IGhhbmRsZXJzID09PSB2b2lkIDAgPyB2b2lkIDAgOiBoYW5kbGVycy5zaXplKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIG1lc3NhZ2VFdmVudC5wb3J0c1swXS5wb3N0TWVzc2FnZSh7XG4gICAgICAgICAgICBzdGF0dXM6IFwiYWNrXCIgLyogX1N0YXR1cy5BQ0sgKi8sXG4gICAgICAgICAgICBldmVudElkLFxuICAgICAgICAgICAgZXZlbnRUeXBlXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCBwcm9taXNlcyA9IEFycmF5LmZyb20oaGFuZGxlcnMpLm1hcChhc3luYyAoaGFuZGxlcikgPT4gaGFuZGxlcihtZXNzYWdlRXZlbnQub3JpZ2luLCBkYXRhKSk7XG4gICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgX2FsbFNldHRsZWQocHJvbWlzZXMpO1xuICAgICAgICBtZXNzYWdlRXZlbnQucG9ydHNbMF0ucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgc3RhdHVzOiBcImRvbmVcIiAvKiBfU3RhdHVzLkRPTkUgKi8sXG4gICAgICAgICAgICBldmVudElkLFxuICAgICAgICAgICAgZXZlbnRUeXBlLFxuICAgICAgICAgICAgcmVzcG9uc2VcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN1YnNjcmliZSBhbiBldmVudCBoYW5kbGVyIGZvciBhIHBhcnRpY3VsYXIgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gRXZlbnQgbmFtZSB0byBzdWJzY3JpYmUgdG8uXG4gICAgICogQHBhcmFtIGV2ZW50SGFuZGxlciAtIFRoZSBldmVudCBoYW5kbGVyIHdoaWNoIHNob3VsZCByZWNlaXZlIHRoZSBldmVudHMuXG4gICAgICpcbiAgICAgKi9cbiAgICBfc3Vic2NyaWJlKGV2ZW50VHlwZSwgZXZlbnRIYW5kbGVyKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmhhbmRsZXJzTWFwKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuZXZlbnRUYXJnZXQuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuYm91bmRFdmVudEhhbmRsZXIpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdKSB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0gPSBuZXcgU2V0KCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oYW5kbGVyc01hcFtldmVudFR5cGVdLmFkZChldmVudEhhbmRsZXIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVbnN1YnNjcmliZSBhbiBldmVudCBoYW5kbGVyIGZyb20gYSBwYXJ0aWN1bGFyIGV2ZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIGV2ZW50VHlwZSAtIEV2ZW50IG5hbWUgdG8gdW5zdWJzY3JpYmUgZnJvbS5cbiAgICAgKiBAcGFyYW0gZXZlbnRIYW5kbGVyIC0gT3B0aW9uYWwgZXZlbnQgaGFuZGxlciwgaWYgbm9uZSBwcm92aWRlZCwgdW5zdWJzY3JpYmUgYWxsIGhhbmRsZXJzIG9uIHRoaXMgZXZlbnQuXG4gICAgICpcbiAgICAgKi9cbiAgICBfdW5zdWJzY3JpYmUoZXZlbnRUeXBlLCBldmVudEhhbmRsZXIpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXSAmJiBldmVudEhhbmRsZXIpIHtcbiAgICAgICAgICAgIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXS5kZWxldGUoZXZlbnRIYW5kbGVyKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIWV2ZW50SGFuZGxlciB8fCB0aGlzLmhhbmRsZXJzTWFwW2V2ZW50VHlwZV0uc2l6ZSA9PT0gMCkge1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMuaGFuZGxlcnNNYXBbZXZlbnRUeXBlXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoT2JqZWN0LmtleXModGhpcy5oYW5kbGVyc01hcCkubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmV2ZW50VGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCB0aGlzLmJvdW5kRXZlbnRIYW5kbGVyKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblJlY2VpdmVyLnJlY2VpdmVycyA9IFtdO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gX2dlbmVyYXRlRXZlbnRJZChwcmVmaXggPSAnJywgZGlnaXRzID0gMTApIHtcbiAgICBsZXQgcmFuZG9tID0gJyc7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkaWdpdHM7IGkrKykge1xuICAgICAgICByYW5kb20gKz0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTApO1xuICAgIH1cbiAgICByZXR1cm4gcHJlZml4ICsgcmFuZG9tO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIHNlbmRpbmcgbWVzc2FnZXMgYW5kIHdhaXRpbmcgZm9yIGEgY29tcGxldGlvbiByZXNwb25zZS5cbiAqXG4gKi9cbmNsYXNzIFNlbmRlciB7XG4gICAgY29uc3RydWN0b3IodGFyZ2V0KSB7XG4gICAgICAgIHRoaXMudGFyZ2V0ID0gdGFyZ2V0O1xuICAgICAgICB0aGlzLmhhbmRsZXJzID0gbmV3IFNldCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVbnN1YnNjcmliZSB0aGUgaGFuZGxlciBhbmQgcmVtb3ZlIGl0IGZyb20gb3VyIHRyYWNraW5nIFNldC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBoYW5kbGVyIC0gVGhlIGhhbmRsZXIgdG8gdW5zdWJzY3JpYmUuXG4gICAgICovXG4gICAgcmVtb3ZlTWVzc2FnZUhhbmRsZXIoaGFuZGxlcikge1xuICAgICAgICBpZiAoaGFuZGxlci5tZXNzYWdlQ2hhbm5lbCkge1xuICAgICAgICAgICAgaGFuZGxlci5tZXNzYWdlQ2hhbm5lbC5wb3J0MS5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlci5vbk1lc3NhZ2UpO1xuICAgICAgICAgICAgaGFuZGxlci5tZXNzYWdlQ2hhbm5lbC5wb3J0MS5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFuZGxlcnMuZGVsZXRlKGhhbmRsZXIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byB0aGUgUmVjZWl2ZXIgbG9jYXRlZCBhdCB7QGxpbmsgdGFyZ2V0fS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogV2UnbGwgZmlyc3Qgd2FpdCBhIGJpdCBmb3IgYW4gQUNLICwgaWYgd2UgZ2V0IG9uZSB3ZSB3aWxsIHdhaXQgc2lnbmlmaWNhbnRseSBsb25nZXIgdW50aWwgdGhlXG4gICAgICogcmVjZWl2ZXIgaGFzIGhhZCBhIGNoYW5jZSB0byBmdWxseSBwcm9jZXNzIHRoZSBldmVudC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBldmVudFR5cGUgLSBUeXBlIG9mIGV2ZW50IHRvIHNlbmQuXG4gICAgICogQHBhcmFtIGRhdGEgLSBUaGUgcGF5bG9hZCBvZiB0aGUgZXZlbnQuXG4gICAgICogQHBhcmFtIHRpbWVvdXQgLSBUaW1lb3V0IGZvciB3YWl0aW5nIG9uIGFuIEFDSyBmcm9tIHRoZSByZWNlaXZlci5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIEFuIGFycmF5IG9mIHNldHRsZWQgcHJvbWlzZXMgZnJvbSBhbGwgdGhlIGhhbmRsZXJzIHRoYXQgd2VyZSBsaXN0ZW5pbmcgb24gdGhlIHJlY2VpdmVyLlxuICAgICAqL1xuICAgIGFzeW5jIF9zZW5kKGV2ZW50VHlwZSwgZGF0YSwgdGltZW91dCA9IDUwIC8qIF9UaW1lb3V0RHVyYXRpb24uQUNLICovKSB7XG4gICAgICAgIGNvbnN0IG1lc3NhZ2VDaGFubmVsID0gdHlwZW9mIE1lc3NhZ2VDaGFubmVsICE9PSAndW5kZWZpbmVkJyA/IG5ldyBNZXNzYWdlQ2hhbm5lbCgpIDogbnVsbDtcbiAgICAgICAgaWYgKCFtZXNzYWdlQ2hhbm5lbCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiY29ubmVjdGlvbl91bmF2YWlsYWJsZVwiIC8qIF9NZXNzYWdlRXJyb3IuQ09OTkVDVElPTl9VTkFWQUlMQUJMRSAqLyk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTm9kZSB0aW1lcnMgYW5kIGJyb3dzZXIgdGltZXJzIHJldHVybiBmdW5kYW1lbnRhbGx5IGRpZmZlcmVudCB0eXBlcy5cbiAgICAgICAgLy8gV2UgZG9uJ3QgYWN0dWFsbHkgY2FyZSB3aGF0IHRoZSB2YWx1ZSBpcyBidXQgVFMgd29uJ3QgYWNjZXB0IHVua25vd24gYW5kXG4gICAgICAgIC8vIHdlIGNhbid0IGNhc3QgcHJvcGVybHkgaW4gYm90aCBlbnZpcm9ubWVudHMuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGxldCBjb21wbGV0aW9uVGltZXI7XG4gICAgICAgIGxldCBoYW5kbGVyO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZXZlbnRJZCA9IF9nZW5lcmF0ZUV2ZW50SWQoJycsIDIwKTtcbiAgICAgICAgICAgIG1lc3NhZ2VDaGFubmVsLnBvcnQxLnN0YXJ0KCk7XG4gICAgICAgICAgICBjb25zdCBhY2tUaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJ1bnN1cHBvcnRlZF9ldmVudFwiIC8qIF9NZXNzYWdlRXJyb3IuVU5TVVBQT1JURURfRVZFTlQgKi8pKTtcbiAgICAgICAgICAgIH0sIHRpbWVvdXQpO1xuICAgICAgICAgICAgaGFuZGxlciA9IHtcbiAgICAgICAgICAgICAgICBtZXNzYWdlQ2hhbm5lbCxcbiAgICAgICAgICAgICAgICBvbk1lc3NhZ2UoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbWVzc2FnZUV2ZW50ID0gZXZlbnQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlRXZlbnQuZGF0YS5ldmVudElkICE9PSBldmVudElkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgc3dpdGNoIChtZXNzYWdlRXZlbnQuZGF0YS5zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJhY2tcIiAvKiBfU3RhdHVzLkFDSyAqLzpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGUgcmVjZWl2ZXIgc2hvdWxkIEFDSyBmaXJzdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoYWNrVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRpb25UaW1lciA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKFwidGltZW91dFwiIC8qIF9NZXNzYWdlRXJyb3IuVElNRU9VVCAqLykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sIDMwMDAgLyogX1RpbWVvdXREdXJhdGlvbi5DT01QTEVUSU9OICovKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJkb25lXCIgLyogX1N0YXR1cy5ET05FICovOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9uY2UgdGhlIHJlY2VpdmVyJ3MgaGFuZGxlcnMgYXJlIGZpbmlzaGVkIHdlIHdpbGwgZ2V0IHRoZSByZXN1bHRzLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChjb21wbGV0aW9uVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUobWVzc2FnZUV2ZW50LmRhdGEucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhclRpbWVvdXQoYWNrVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dChjb21wbGV0aW9uVGltZXIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoXCJpbnZhbGlkX3Jlc3BvbnNlXCIgLyogX01lc3NhZ2VFcnJvci5JTlZBTElEX1JFU1BPTlNFICovKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVycy5hZGQoaGFuZGxlcik7XG4gICAgICAgICAgICBtZXNzYWdlQ2hhbm5lbC5wb3J0MS5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlci5vbk1lc3NhZ2UpO1xuICAgICAgICAgICAgdGhpcy50YXJnZXQucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICAgIGV2ZW50VHlwZSxcbiAgICAgICAgICAgICAgICBldmVudElkLFxuICAgICAgICAgICAgICAgIGRhdGFcbiAgICAgICAgICAgIH0sIFttZXNzYWdlQ2hhbm5lbC5wb3J0Ml0pO1xuICAgICAgICB9KS5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVNZXNzYWdlSGFuZGxlcihoYW5kbGVyKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBMYXp5IGFjY2Vzc29yIGZvciB3aW5kb3csIHNpbmNlIHRoZSBjb21wYXQgbGF5ZXIgd29uJ3QgdHJlZSBzaGFrZSB0aGlzIG91dCxcbiAqIHdlIG5lZWQgdG8gbWFrZSBzdXJlIG5vdCB0byBtZXNzIHdpdGggd2luZG93IHVubGVzcyB3ZSBoYXZlIHRvXG4gKi9cbmZ1bmN0aW9uIF93aW5kb3coKSB7XG4gICAgcmV0dXJuIHdpbmRvdztcbn1cbmZ1bmN0aW9uIF9zZXRXaW5kb3dMb2NhdGlvbih1cmwpIHtcbiAgICBfd2luZG93KCkubG9jYXRpb24uaHJlZiA9IHVybDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQy5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBfaXNXb3JrZXIoKSB7XG4gICAgcmV0dXJuICh0eXBlb2YgX3dpbmRvdygpWydXb3JrZXJHbG9iYWxTY29wZSddICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICB0eXBlb2YgX3dpbmRvdygpWydpbXBvcnRTY3JpcHRzJ10gPT09ICdmdW5jdGlvbicpO1xufVxuYXN5bmMgZnVuY3Rpb24gX2dldEFjdGl2ZVNlcnZpY2VXb3JrZXIoKSB7XG4gICAgaWYgKCEobmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB0cnkge1xuICAgICAgICBjb25zdCByZWdpc3RyYXRpb24gPSBhd2FpdCBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeTtcbiAgICAgICAgcmV0dXJuIHJlZ2lzdHJhdGlvbi5hY3RpdmU7XG4gICAgfVxuICAgIGNhdGNoIChfYSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5mdW5jdGlvbiBfZ2V0U2VydmljZVdvcmtlckNvbnRyb2xsZXIoKSB7XG4gICAgdmFyIF9hO1xuICAgIHJldHVybiAoKF9hID0gbmF2aWdhdG9yID09PSBudWxsIHx8IG5hdmlnYXRvciA9PT0gdm9pZCAwID8gdm9pZCAwIDogbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5jb250cm9sbGVyKSB8fCBudWxsO1xufVxuZnVuY3Rpb24gX2dldFdvcmtlckdsb2JhbFNjb3BlKCkge1xuICAgIHJldHVybiBfaXNXb3JrZXIoKSA/IHNlbGYgOiBudWxsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgREJfTkFNRSA9ICdmaXJlYmFzZUxvY2FsU3RvcmFnZURiJztcbmNvbnN0IERCX1ZFUlNJT04gPSAxO1xuY29uc3QgREJfT0JKRUNUU1RPUkVfTkFNRSA9ICdmaXJlYmFzZUxvY2FsU3RvcmFnZSc7XG5jb25zdCBEQl9EQVRBX0tFWVBBVEggPSAnZmJhc2Vfa2V5Jztcbi8qKlxuICogUHJvbWlzZSB3cmFwcGVyIGZvciBJREJSZXF1ZXN0XG4gKlxuICogVW5mb3J0dW5hdGVseSB3ZSBjYW4ndCBjbGVhbmx5IGV4dGVuZCBQcm9taXNlPFQ+IHNpbmNlIHByb21pc2VzIGFyZSBub3QgY2FsbGFibGUgaW4gRVM2XG4gKlxuICovXG5jbGFzcyBEQlByb21pc2Uge1xuICAgIGNvbnN0cnVjdG9yKHJlcXVlc3QpIHtcbiAgICAgICAgdGhpcy5yZXF1ZXN0ID0gcmVxdWVzdDtcbiAgICB9XG4gICAgdG9Qcm9taXNlKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ3N1Y2Nlc3MnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSh0aGlzLnJlcXVlc3QucmVzdWx0KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5yZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIHJlamVjdCh0aGlzLnJlcXVlc3QuZXJyb3IpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGdldE9iamVjdFN0b3JlKGRiLCBpc1JlYWRXcml0ZSkge1xuICAgIHJldHVybiBkYlxuICAgICAgICAudHJhbnNhY3Rpb24oW0RCX09CSkVDVFNUT1JFX05BTUVdLCBpc1JlYWRXcml0ZSA/ICdyZWFkd3JpdGUnIDogJ3JlYWRvbmx5JylcbiAgICAgICAgLm9iamVjdFN0b3JlKERCX09CSkVDVFNUT1JFX05BTUUpO1xufVxuZnVuY3Rpb24gX2RlbGV0ZURhdGFiYXNlKCkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIuZGVsZXRlRGF0YWJhc2UoREJfTkFNRSk7XG4gICAgcmV0dXJuIG5ldyBEQlByb21pc2UocmVxdWVzdCkudG9Qcm9taXNlKCk7XG59XG5mdW5jdGlvbiBfb3BlbkRhdGFiYXNlKCkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBpbmRleGVkREIub3BlbihEQl9OQU1FLCBEQl9WRVJTSU9OKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICByZXF1ZXN0LmFkZEV2ZW50TGlzdGVuZXIoJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgICAgICAgcmVqZWN0KHJlcXVlc3QuZXJyb3IpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmVxdWVzdC5hZGRFdmVudExpc3RlbmVyKCd1cGdyYWRlbmVlZGVkJywgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGIgPSByZXF1ZXN0LnJlc3VsdDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZGIuY3JlYXRlT2JqZWN0U3RvcmUoREJfT0JKRUNUU1RPUkVfTkFNRSwgeyBrZXlQYXRoOiBEQl9EQVRBX0tFWVBBVEggfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIHJlamVjdChlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJlcXVlc3QuYWRkRXZlbnRMaXN0ZW5lcignc3VjY2VzcycsIGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRiID0gcmVxdWVzdC5yZXN1bHQ7XG4gICAgICAgICAgICAvLyBTdHJhbmdlIGJ1ZyB0aGF0IG9jY3VycyBpbiBGaXJlZm94IHdoZW4gbXVsdGlwbGUgdGFicyBhcmUgb3BlbmVkIGF0IHRoZVxuICAgICAgICAgICAgLy8gc2FtZSB0aW1lLiBUaGUgb25seSB3YXkgdG8gcmVjb3ZlciBzZWVtcyB0byBiZSBkZWxldGluZyB0aGUgZGF0YWJhc2VcbiAgICAgICAgICAgIC8vIGFuZCByZS1pbml0aWFsaXppbmcgaXQuXG4gICAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy82MzRcbiAgICAgICAgICAgIGlmICghZGIub2JqZWN0U3RvcmVOYW1lcy5jb250YWlucyhEQl9PQkpFQ1RTVE9SRV9OQU1FKSkge1xuICAgICAgICAgICAgICAgIC8vIE5lZWQgdG8gY2xvc2UgdGhlIGRhdGFiYXNlIG9yIGVsc2UgeW91IGdldCBhIGBibG9ja2VkYCBldmVudFxuICAgICAgICAgICAgICAgIGRiLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgYXdhaXQgX2RlbGV0ZURhdGFiYXNlKCk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhd2FpdCBfb3BlbkRhdGFiYXNlKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZShkYik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuYXN5bmMgZnVuY3Rpb24gX3B1dE9iamVjdChkYiwga2V5LCB2YWx1ZSkge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBnZXRPYmplY3RTdG9yZShkYiwgdHJ1ZSkucHV0KHtcbiAgICAgICAgW0RCX0RBVEFfS0VZUEFUSF06IGtleSxcbiAgICAgICAgdmFsdWVcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTtcbn1cbmFzeW5jIGZ1bmN0aW9uIGdldE9iamVjdChkYiwga2V5KSB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGdldE9iamVjdFN0b3JlKGRiLCBmYWxzZSkuZ2V0KGtleSk7XG4gICAgY29uc3QgZGF0YSA9IGF3YWl0IG5ldyBEQlByb21pc2UocmVxdWVzdCkudG9Qcm9taXNlKCk7XG4gICAgcmV0dXJuIGRhdGEgPT09IHVuZGVmaW5lZCA/IG51bGwgOiBkYXRhLnZhbHVlO1xufVxuZnVuY3Rpb24gX2RlbGV0ZU9iamVjdChkYiwga2V5KSB7XG4gICAgY29uc3QgcmVxdWVzdCA9IGdldE9iamVjdFN0b3JlKGRiLCB0cnVlKS5kZWxldGUoa2V5KTtcbiAgICByZXR1cm4gbmV3IERCUHJvbWlzZShyZXF1ZXN0KS50b1Byb21pc2UoKTtcbn1cbmNvbnN0IF9QT0xMSU5HX0lOVEVSVkFMX01TID0gODAwO1xuY29uc3QgX1RSQU5TQUNUSU9OX1JFVFJZX0NPVU5UID0gMztcbmNsYXNzIEluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2Uge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnR5cGUgPSBcIkxPQ0FMXCIgLyogUGVyc2lzdGVuY2VUeXBlLkxPQ0FMICovO1xuICAgICAgICB0aGlzLl9zaG91bGRBbGxvd01pZ3JhdGlvbiA9IHRydWU7XG4gICAgICAgIHRoaXMubGlzdGVuZXJzID0ge307XG4gICAgICAgIHRoaXMubG9jYWxDYWNoZSA9IHt9O1xuICAgICAgICAvLyBzZXRUaW1lb3V0IHJldHVybiB2YWx1ZSBpcyBwbGF0Zm9ybSBzcGVjaWZpY1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICB0aGlzLnBvbGxUaW1lciA9IG51bGw7XG4gICAgICAgIHRoaXMucGVuZGluZ1dyaXRlcyA9IDA7XG4gICAgICAgIHRoaXMucmVjZWl2ZXIgPSBudWxsO1xuICAgICAgICB0aGlzLnNlbmRlciA9IG51bGw7XG4gICAgICAgIHRoaXMuc2VydmljZVdvcmtlclJlY2VpdmVyQXZhaWxhYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuYWN0aXZlU2VydmljZVdvcmtlciA9IG51bGw7XG4gICAgICAgIC8vIEZpcmUgJiBmb3JnZXQgdGhlIHNlcnZpY2Ugd29ya2VyIHJlZ2lzdHJhdGlvbiBhcyBpdCBtYXkgbmV2ZXIgcmVzb2x2ZVxuICAgICAgICB0aGlzLl93b3JrZXJJbml0aWFsaXphdGlvblByb21pc2UgPVxuICAgICAgICAgICAgdGhpcy5pbml0aWFsaXplU2VydmljZVdvcmtlck1lc3NhZ2luZygpLnRoZW4oKCkgPT4geyB9LCAoKSA9PiB7IH0pO1xuICAgIH1cbiAgICBhc3luYyBfb3BlbkRiKCkge1xuICAgICAgICBpZiAodGhpcy5kYikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5kYiA9IGF3YWl0IF9vcGVuRGF0YWJhc2UoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGI7XG4gICAgfVxuICAgIGFzeW5jIF93aXRoUmV0cmllcyhvcCkge1xuICAgICAgICBsZXQgbnVtQXR0ZW1wdHMgPSAwO1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBkYiA9IGF3YWl0IHRoaXMuX29wZW5EYigpO1xuICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBvcChkYik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChudW1BdHRlbXB0cysrID4gX1RSQU5TQUNUSU9OX1JFVFJZX0NPVU5UKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmRiKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGIuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kYiA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gVE9ETzogY29uc2lkZXIgYWRkaW5nIGV4cG9uZW50aWFsIGJhY2tvZmZcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbmRleGVkREIgZXZlbnRzIGRvIG5vdCBwcm9wYWdhdGUgZnJvbSB0aGUgbWFpbiB3aW5kb3cgdG8gdGhlIHdvcmtlciBjb250ZXh0LiAgV2UgcmVseSBvbiBhXG4gICAgICogcG9zdE1lc3NhZ2UgaW50ZXJmYWNlIHRvIHNlbmQgdGhlc2UgZXZlbnRzIHRvIHRoZSB3b3JrZXIgb3Vyc2VsdmVzLlxuICAgICAqL1xuICAgIGFzeW5jIGluaXRpYWxpemVTZXJ2aWNlV29ya2VyTWVzc2FnaW5nKCkge1xuICAgICAgICByZXR1cm4gX2lzV29ya2VyKCkgPyB0aGlzLmluaXRpYWxpemVSZWNlaXZlcigpIDogdGhpcy5pbml0aWFsaXplU2VuZGVyKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFzIHRoZSB3b3JrZXIgd2Ugc2hvdWxkIGxpc3RlbiB0byBldmVudHMgZnJvbSB0aGUgbWFpbiB3aW5kb3cuXG4gICAgICovXG4gICAgYXN5bmMgaW5pdGlhbGl6ZVJlY2VpdmVyKCkge1xuICAgICAgICB0aGlzLnJlY2VpdmVyID0gUmVjZWl2ZXIuX2dldEluc3RhbmNlKF9nZXRXb3JrZXJHbG9iYWxTY29wZSgpKTtcbiAgICAgICAgLy8gUmVmcmVzaCBmcm9tIHBlcnNpc3RlbmNlIGlmIHdlIHJlY2VpdmUgYSBLZXlDaGFuZ2VkIG1lc3NhZ2UuXG4gICAgICAgIHRoaXMucmVjZWl2ZXIuX3N1YnNjcmliZShcImtleUNoYW5nZWRcIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovLCBhc3luYyAoX29yaWdpbiwgZGF0YSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qga2V5cyA9IGF3YWl0IHRoaXMuX3BvbGwoKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAga2V5UHJvY2Vzc2VkOiBrZXlzLmluY2x1ZGVzKGRhdGEua2V5KVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIExldCB0aGUgc2VuZGVyIGtub3cgdGhhdCB3ZSBhcmUgbGlzdGVuaW5nIHNvIHRoZXkgZ2l2ZSB1cyBtb3JlIHRpbWVvdXQuXG4gICAgICAgIHRoaXMucmVjZWl2ZXIuX3N1YnNjcmliZShcInBpbmdcIiAvKiBfRXZlbnRUeXBlLlBJTkcgKi8sIGFzeW5jIChfb3JpZ2luLCBfZGF0YSkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIFtcImtleUNoYW5nZWRcIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovXTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFzIHRoZSBtYWluIHdpbmRvdywgd2Ugc2hvdWxkIGxldCB0aGUgd29ya2VyIGtub3cgd2hlbiBrZXlzIGNoYW5nZSAoc2V0IGFuZCByZW1vdmUpLlxuICAgICAqXG4gICAgICogQHJlbWFya3NcbiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL1NlcnZpY2VXb3JrZXJDb250YWluZXIvcmVhZHkgfCBTZXJ2aWNlV29ya2VyQ29udGFpbmVyLnJlYWR5fVxuICAgICAqIG1heSBub3QgcmVzb2x2ZS5cbiAgICAgKi9cbiAgICBhc3luYyBpbml0aWFsaXplU2VuZGVyKCkge1xuICAgICAgICB2YXIgX2EsIF9iO1xuICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlcmUncyBhbiBhY3RpdmUgc2VydmljZSB3b3JrZXIuXG4gICAgICAgIHRoaXMuYWN0aXZlU2VydmljZVdvcmtlciA9IGF3YWl0IF9nZXRBY3RpdmVTZXJ2aWNlV29ya2VyKCk7XG4gICAgICAgIGlmICghdGhpcy5hY3RpdmVTZXJ2aWNlV29ya2VyKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZW5kZXIgPSBuZXcgU2VuZGVyKHRoaXMuYWN0aXZlU2VydmljZVdvcmtlcik7XG4gICAgICAgIC8vIFBpbmcgdGhlIHNlcnZpY2Ugd29ya2VyIHRvIGNoZWNrIHdoYXQgZXZlbnRzIHRoZXkgY2FuIGhhbmRsZS5cbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IHRoaXMuc2VuZGVyLl9zZW5kKFwicGluZ1wiIC8qIF9FdmVudFR5cGUuUElORyAqLywge30sIDgwMCAvKiBfVGltZW91dER1cmF0aW9uLkxPTkdfQUNLICovKTtcbiAgICAgICAgaWYgKCFyZXN1bHRzKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCgoX2EgPSByZXN1bHRzWzBdKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZnVsZmlsbGVkKSAmJlxuICAgICAgICAgICAgKChfYiA9IHJlc3VsdHNbMF0pID09PSBudWxsIHx8IF9iID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYi52YWx1ZS5pbmNsdWRlcyhcImtleUNoYW5nZWRcIiAvKiBfRXZlbnRUeXBlLktFWV9DSEFOR0VEICovKSkpIHtcbiAgICAgICAgICAgIHRoaXMuc2VydmljZVdvcmtlclJlY2VpdmVyQXZhaWxhYmxlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBMZXQgdGhlIHdvcmtlciBrbm93IGFib3V0IGEgY2hhbmdlZCBrZXksIHRoZSBleGFjdCBrZXkgZG9lc24ndCB0ZWNobmljYWxseSBtYXR0ZXIgc2luY2UgdGhlXG4gICAgICogd29ya2VyIHdpbGwganVzdCB0cmlnZ2VyIGEgZnVsbCBzeW5jIGFueXdheS5cbiAgICAgKlxuICAgICAqIEByZW1hcmtzXG4gICAgICogRm9yIG5vdywgd2Ugb25seSBzdXBwb3J0IG9uZSBzZXJ2aWNlIHdvcmtlciBwZXIgcGFnZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBrZXkgLSBTdG9yYWdlIGtleSB3aGljaCBjaGFuZ2VkLlxuICAgICAqL1xuICAgIGFzeW5jIG5vdGlmeVNlcnZpY2VXb3JrZXIoa2V5KSB7XG4gICAgICAgIGlmICghdGhpcy5zZW5kZXIgfHxcbiAgICAgICAgICAgICF0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIgfHxcbiAgICAgICAgICAgIF9nZXRTZXJ2aWNlV29ya2VyQ29udHJvbGxlcigpICE9PSB0aGlzLmFjdGl2ZVNlcnZpY2VXb3JrZXIpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5zZW5kZXIuX3NlbmQoXCJrZXlDaGFuZ2VkXCIgLyogX0V2ZW50VHlwZS5LRVlfQ0hBTkdFRCAqLywgeyBrZXkgfSwgXG4gICAgICAgICAgICAvLyBVc2UgbG9uZyB0aW1lb3V0IGlmIHJlY2VpdmVyIGhhcyBwcmV2aW91c2x5IHJlc3BvbmRlZCB0byBhIHBpbmcgZnJvbSB1cy5cbiAgICAgICAgICAgIHRoaXMuc2VydmljZVdvcmtlclJlY2VpdmVyQXZhaWxhYmxlXG4gICAgICAgICAgICAgICAgPyA4MDAgLyogX1RpbWVvdXREdXJhdGlvbi5MT05HX0FDSyAqL1xuICAgICAgICAgICAgICAgIDogNTAgLyogX1RpbWVvdXREdXJhdGlvbi5BQ0sgKi8pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfYSkge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGJlc3QgZWZmb3J0IGFwcHJvYWNoLiBJZ25vcmUgZXJyb3JzLlxuICAgICAgICB9XG4gICAgfVxuICAgIGFzeW5jIF9pc0F2YWlsYWJsZSgpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghaW5kZXhlZERCKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZGIgPSBhd2FpdCBfb3BlbkRhdGFiYXNlKCk7XG4gICAgICAgICAgICBhd2FpdCBfcHV0T2JqZWN0KGRiLCBTVE9SQUdFX0FWQUlMQUJMRV9LRVksICcxJyk7XG4gICAgICAgICAgICBhd2FpdCBfZGVsZXRlT2JqZWN0KGRiLCBTVE9SQUdFX0FWQUlMQUJMRV9LRVkpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKF9hKSB7IH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBhc3luYyBfd2l0aFBlbmRpbmdXcml0ZSh3cml0ZSkge1xuICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZXMrKztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IHdyaXRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZmluYWxseSB7XG4gICAgICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZXMtLTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBhc3luYyBfc2V0KGtleSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3dpdGhQZW5kaW5nV3JpdGUoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiBfcHV0T2JqZWN0KGRiLCBrZXksIHZhbHVlKSk7XG4gICAgICAgICAgICB0aGlzLmxvY2FsQ2FjaGVba2V5XSA9IHZhbHVlO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5U2VydmljZVdvcmtlcihrZXkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgX2dldChrZXkpIHtcbiAgICAgICAgY29uc3Qgb2JqID0gKGF3YWl0IHRoaXMuX3dpdGhSZXRyaWVzKChkYikgPT4gZ2V0T2JqZWN0KGRiLCBrZXkpKSk7XG4gICAgICAgIHRoaXMubG9jYWxDYWNoZVtrZXldID0gb2JqO1xuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cbiAgICBhc3luYyBfcmVtb3ZlKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fd2l0aFBlbmRpbmdXcml0ZShhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLl93aXRoUmV0cmllcygoZGIpID0+IF9kZWxldGVPYmplY3QoZGIsIGtleSkpO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMubG9jYWxDYWNoZVtrZXldO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubm90aWZ5U2VydmljZVdvcmtlcihrZXkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgYXN5bmMgX3BvbGwoKSB7XG4gICAgICAgIC8vIFRPRE86IGNoZWNrIGlmIHdlIG5lZWQgdG8gZmFsbGJhY2sgaWYgZ2V0QWxsIGlzIG5vdCBzdXBwb3J0ZWRcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5fd2l0aFJldHJpZXMoKGRiKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBnZXRBbGxSZXF1ZXN0ID0gZ2V0T2JqZWN0U3RvcmUoZGIsIGZhbHNlKS5nZXRBbGwoKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgREJQcm9taXNlKGdldEFsbFJlcXVlc3QpLnRvUHJvbWlzZSgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFyZXN1bHQpIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICAvLyBJZiB3ZSBoYXZlIHBlbmRpbmcgd3JpdGVzIGluIHByb2dyZXNzIGFib3J0LCB3ZSdsbCBnZXQgcGlja2VkIHVwIG9uIHRoZSBuZXh0IHBvbGxcbiAgICAgICAgaWYgKHRoaXMucGVuZGluZ1dyaXRlcyAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGtleXMgPSBbXTtcbiAgICAgICAgY29uc3Qga2V5c0luUmVzdWx0ID0gbmV3IFNldCgpO1xuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB7IGZiYXNlX2tleToga2V5LCB2YWx1ZSB9IG9mIHJlc3VsdCkge1xuICAgICAgICAgICAgICAgIGtleXNJblJlc3VsdC5hZGQoa2V5KTtcbiAgICAgICAgICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkodGhpcy5sb2NhbENhY2hlW2tleV0pICE9PSBKU09OLnN0cmluZ2lmeSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ub3RpZnlMaXN0ZW5lcnMoa2V5LCB2YWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgIGtleXMucHVzaChrZXkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBmb3IgKGNvbnN0IGxvY2FsS2V5IG9mIE9iamVjdC5rZXlzKHRoaXMubG9jYWxDYWNoZSkpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmxvY2FsQ2FjaGVbbG9jYWxLZXldICYmICFrZXlzSW5SZXN1bHQuaGFzKGxvY2FsS2V5KSkge1xuICAgICAgICAgICAgICAgIC8vIERlbGV0ZWRcbiAgICAgICAgICAgICAgICB0aGlzLm5vdGlmeUxpc3RlbmVycyhsb2NhbEtleSwgbnVsbCk7XG4gICAgICAgICAgICAgICAga2V5cy5wdXNoKGxvY2FsS2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ga2V5cztcbiAgICB9XG4gICAgbm90aWZ5TGlzdGVuZXJzKGtleSwgbmV3VmFsdWUpIHtcbiAgICAgICAgdGhpcy5sb2NhbENhY2hlW2tleV0gPSBuZXdWYWx1ZTtcbiAgICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnNba2V5XTtcbiAgICAgICAgaWYgKGxpc3RlbmVycykge1xuICAgICAgICAgICAgZm9yIChjb25zdCBsaXN0ZW5lciBvZiBBcnJheS5mcm9tKGxpc3RlbmVycykpIHtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lcihuZXdWYWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhcnRQb2xsaW5nKCkge1xuICAgICAgICB0aGlzLnN0b3BQb2xsaW5nKCk7XG4gICAgICAgIHRoaXMucG9sbFRpbWVyID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4gdGhpcy5fcG9sbCgpLCBfUE9MTElOR19JTlRFUlZBTF9NUyk7XG4gICAgfVxuICAgIHN0b3BQb2xsaW5nKCkge1xuICAgICAgICBpZiAodGhpcy5wb2xsVGltZXIpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wb2xsVGltZXIpO1xuICAgICAgICAgICAgdGhpcy5wb2xsVGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIF9hZGRMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7XG4gICAgICAgIGlmIChPYmplY3Qua2V5cyh0aGlzLmxpc3RlbmVycykubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0UG9sbGluZygpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghdGhpcy5saXN0ZW5lcnNba2V5XSkge1xuICAgICAgICAgICAgdGhpcy5saXN0ZW5lcnNba2V5XSA9IG5ldyBTZXQoKTtcbiAgICAgICAgICAgIC8vIFBvcHVsYXRlIHRoZSBjYWNoZSB0byBhdm9pZCBzcHVyaW91c2x5IHRyaWdnZXJpbmcgb24gZmlyc3QgcG9sbC5cbiAgICAgICAgICAgIHZvaWQgdGhpcy5fZ2V0KGtleSk7IC8vIFRoaXMgY2FuIGhhcHBlbiBpbiB0aGUgYmFja2dyb3VuZCBhc3luYyBhbmQgd2UgY2FuIHJldHVybiBpbW1lZGlhdGVseS5cbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldLmFkZChsaXN0ZW5lcik7XG4gICAgfVxuICAgIF9yZW1vdmVMaXN0ZW5lcihrZXksIGxpc3RlbmVyKSB7XG4gICAgICAgIGlmICh0aGlzLmxpc3RlbmVyc1trZXldKSB7XG4gICAgICAgICAgICB0aGlzLmxpc3RlbmVyc1trZXldLmRlbGV0ZShsaXN0ZW5lcik7XG4gICAgICAgICAgICBpZiAodGhpcy5saXN0ZW5lcnNba2V5XS5zaXplID09PSAwKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlIHRoaXMubGlzdGVuZXJzW2tleV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKE9iamVjdC5rZXlzKHRoaXMubGlzdGVuZXJzKS5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc3RvcFBvbGxpbmcoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbkluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UudHlwZSA9ICdMT0NBTCc7XG4vKipcbiAqIEFuIGltcGxlbWVudGF0aW9uIG9mIHtAbGluayBQZXJzaXN0ZW5jZX0gb2YgdHlwZSBgTE9DQUxgIHVzaW5nIGBpbmRleGVkREJgXG4gKiBmb3IgdGhlIHVuZGVybHlpbmcgc3RvcmFnZS5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmNvbnN0IGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UgPSBJbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gc3RhcnRTaWduSW5QaG9uZU1mYShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYVNpZ25JbjpzdGFydFwiIC8qIEVuZHBvaW50LlNUQVJUX01GQV9TSUdOX0lOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuZnVuY3Rpb24gZmluYWxpemVTaWduSW5QaG9uZU1mYShhdXRoLCByZXF1ZXN0KSB7XG4gICAgcmV0dXJuIF9wZXJmb3JtQXBpUmVxdWVzdChhdXRoLCBcIlBPU1RcIiAvKiBIdHRwTWV0aG9kLlBPU1QgKi8sIFwiL3YyL2FjY291bnRzL21mYVNpZ25JbjpmaW5hbGl6ZVwiIC8qIEVuZHBvaW50LkZJTkFMSVpFX01GQV9TSUdOX0lOICovLCBfYWRkVGlkSWZOZWNlc3NhcnkoYXV0aCwgcmVxdWVzdCkpO1xufVxuZnVuY3Rpb24gZmluYWxpemVTaWduSW5Ub3RwTWZhKGF1dGgsIHJlcXVlc3QpIHtcbiAgICByZXR1cm4gX3BlcmZvcm1BcGlSZXF1ZXN0KGF1dGgsIFwiUE9TVFwiIC8qIEh0dHBNZXRob2QuUE9TVCAqLywgXCIvdjIvYWNjb3VudHMvbWZhU2lnbkluOmZpbmFsaXplXCIgLyogRW5kcG9pbnQuRklOQUxJWkVfTUZBX1NJR05fSU4gKi8sIF9hZGRUaWRJZk5lY2Vzc2FyeShhdXRoLCByZXF1ZXN0KSk7XG59XG5cbmNsYXNzIE11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZmFjdG9ySWQpIHtcbiAgICAgICAgdGhpcy5mYWN0b3JJZCA9IGZhY3RvcklkO1xuICAgIH1cbiAgICBfcHJvY2VzcyhhdXRoLCBzZXNzaW9uLCBkaXNwbGF5TmFtZSkge1xuICAgICAgICBzd2l0Y2ggKHNlc3Npb24udHlwZSkge1xuICAgICAgICAgICAgY2FzZSBcImVucm9sbFwiIC8qIE11bHRpRmFjdG9yU2Vzc2lvblR5cGUuRU5ST0xMICovOlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9maW5hbGl6ZUVucm9sbChhdXRoLCBzZXNzaW9uLmNyZWRlbnRpYWwsIGRpc3BsYXlOYW1lKTtcbiAgICAgICAgICAgIGNhc2UgXCJzaWduaW5cIiAvKiBNdWx0aUZhY3RvclNlc3Npb25UeXBlLlNJR05fSU4gKi86XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbmFsaXplU2lnbkluKGF1dGgsIHNlc3Npb24uY3JlZGVudGlhbCk7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBkZWJ1Z0ZhaWwoJ3VuZXhwZWN0ZWQgTXVsdGlGYWN0b3JTZXNzaW9uVHlwZScpO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIFByb3ZpZGVyIGZvciBnZW5lcmF0aW5nIGEge0BsaW5rIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbn0uXG4gKlxuICogQHB1YmxpY1xuICovXG5jbGFzcyBUb3RwTXVsdGlGYWN0b3JHZW5lcmF0b3Ige1xuICAgIC8qKlxuICAgICAqIFByb3ZpZGVzIGEge0BsaW5rIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbn0gdG8gY29uZmlybSBvd25lcnNoaXAgb2ZcbiAgICAgKiB0aGUgVE9UUCAodGltZS1iYXNlZCBvbmUtdGltZSBwYXNzd29yZCkgc2Vjb25kIGZhY3Rvci5cbiAgICAgKiBUaGlzIGFzc2VydGlvbiBpcyB1c2VkIHRvIGNvbXBsZXRlIGVucm9sbG1lbnQgaW4gVE9UUCBzZWNvbmQgZmFjdG9yLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlY3JldCBBIHtAbGluayBUb3RwU2VjcmV0fSBjb250YWluaW5nIHRoZSBzaGFyZWQgc2VjcmV0IGtleSBhbmQgb3RoZXIgVE9UUCBwYXJhbWV0ZXJzLlxuICAgICAqIEBwYXJhbSBvbmVUaW1lUGFzc3dvcmQgT25lLXRpbWUgcGFzc3dvcmQgZnJvbSBUT1RQIEFwcC5cbiAgICAgKiBAcmV0dXJucyBBIHtAbGluayBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb259IHdoaWNoIGNhbiBiZSB1c2VkIHdpdGhcbiAgICAgKiB7QGxpbmsgTXVsdGlGYWN0b3JVc2VyLmVucm9sbH0uXG4gICAgICovXG4gICAgc3RhdGljIGFzc2VydGlvbkZvckVucm9sbG1lbnQoc2VjcmV0LCBvbmVUaW1lUGFzc3dvcmQpIHtcbiAgICAgICAgcmV0dXJuIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwuX2Zyb21TZWNyZXQoc2VjcmV0LCBvbmVUaW1lUGFzc3dvcmQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQcm92aWRlcyBhIHtAbGluayBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb259IHRvIGNvbmZpcm0gb3duZXJzaGlwIG9mIHRoZSBUT1RQIHNlY29uZCBmYWN0b3IuXG4gICAgICogVGhpcyBhc3NlcnRpb24gaXMgdXNlZCB0byBjb21wbGV0ZSBzaWduSW4gd2l0aCBUT1RQIGFzIHRoZSBzZWNvbmQgZmFjdG9yLlxuICAgICAqXG4gICAgICogQHBhcmFtIGVucm9sbG1lbnRJZCBpZGVudGlmaWVzIHRoZSBlbnJvbGxlZCBUT1RQIHNlY29uZCBmYWN0b3IuXG4gICAgICogQHBhcmFtIG9uZVRpbWVQYXNzd29yZCBPbmUtdGltZSBwYXNzd29yZCBmcm9tIFRPVFAgQXBwLlxuICAgICAqIEByZXR1cm5zIEEge0BsaW5rIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbn0gd2hpY2ggY2FuIGJlIHVzZWQgd2l0aFxuICAgICAqIHtAbGluayBNdWx0aUZhY3RvclJlc29sdmVyLnJlc29sdmVTaWduSW59LlxuICAgICAqL1xuICAgIHN0YXRpYyBhc3NlcnRpb25Gb3JTaWduSW4oZW5yb2xsbWVudElkLCBvbmVUaW1lUGFzc3dvcmQpIHtcbiAgICAgICAgcmV0dXJuIFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwuX2Zyb21FbnJvbGxtZW50SWQoZW5yb2xsbWVudElkLCBvbmVUaW1lUGFzc3dvcmQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB0byB7QGxpbmsgVG90cFNlY3JldH0gd2hpY2ggY29udGFpbnMgdGhlIFRPVFAgc2hhcmVkIHNlY3JldCBrZXkgYW5kIG90aGVyIHBhcmFtZXRlcnMuXG4gICAgICogQ3JlYXRlcyBhIFRPVFAgc2VjcmV0IGFzIHBhcnQgb2YgZW5yb2xsaW5nIGEgVE9UUCBzZWNvbmQgZmFjdG9yLlxuICAgICAqIFVzZWQgZm9yIGdlbmVyYXRpbmcgYSBRUiBjb2RlIFVSTCBvciBpbnB1dHRpbmcgaW50byBhIFRPVFAgYXBwLlxuICAgICAqIFRoaXMgbWV0aG9kIHVzZXMgdGhlIGF1dGggaW5zdGFuY2UgY29ycmVzcG9uZGluZyB0byB0aGUgdXNlciBpbiB0aGUgbXVsdGlGYWN0b3JTZXNzaW9uLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlc3Npb24gVGhlIHtAbGluayBNdWx0aUZhY3RvclNlc3Npb259IHRoYXQgdGhlIHVzZXIgaXMgcGFydCBvZi5cbiAgICAgKiBAcmV0dXJucyBBIHByb21pc2UgdG8ge0BsaW5rIFRvdHBTZWNyZXR9LlxuICAgICAqL1xuICAgIHN0YXRpYyBhc3luYyBnZW5lcmF0ZVNlY3JldChzZXNzaW9uKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgY29uc3QgbWZhU2Vzc2lvbiA9IHNlc3Npb247XG4gICAgICAgIF9hc3NlcnQodHlwZW9mICgoX2EgPSBtZmFTZXNzaW9uLnVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS5hdXRoKSAhPT0gJ3VuZGVmaW5lZCcsIFwiaW50ZXJuYWwtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLklOVEVSTkFMX0VSUk9SICovKTtcbiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBzdGFydEVucm9sbFRvdHBNZmEobWZhU2Vzc2lvbi51c2VyLmF1dGgsIHtcbiAgICAgICAgICAgIGlkVG9rZW46IG1mYVNlc3Npb24uY3JlZGVudGlhbCxcbiAgICAgICAgICAgIHRvdHBFbnJvbGxtZW50SW5mbzoge31cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBUb3RwU2VjcmV0Ll9mcm9tU3RhcnRUb3RwTWZhRW5yb2xsbWVudFJlc3BvbnNlKHJlc3BvbnNlLCBtZmFTZXNzaW9uLnVzZXIuYXV0aCk7XG4gICAgfVxufVxuLyoqXG4gKiBUaGUgaWRlbnRpZmllciBvZiB0aGUgVE9UUCBzZWNvbmQgZmFjdG9yOiBgdG90cGAuXG4gKi9cblRvdHBNdWx0aUZhY3RvckdlbmVyYXRvci5GQUNUT1JfSUQgPSBcInRvdHBcIiAvKiBGYWN0b3JJZC5UT1RQICovO1xuY2xhc3MgVG90cE11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbCBleHRlbmRzIE11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbCB7XG4gICAgY29uc3RydWN0b3Iob3RwLCBlbnJvbGxtZW50SWQsIHNlY3JldCkge1xuICAgICAgICBzdXBlcihcInRvdHBcIiAvKiBGYWN0b3JJZC5UT1RQICovKTtcbiAgICAgICAgdGhpcy5vdHAgPSBvdHA7XG4gICAgICAgIHRoaXMuZW5yb2xsbWVudElkID0gZW5yb2xsbWVudElkO1xuICAgICAgICB0aGlzLnNlY3JldCA9IHNlY3JldDtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBfZnJvbVNlY3JldChzZWNyZXQsIG90cCkge1xuICAgICAgICByZXR1cm4gbmV3IFRvdHBNdWx0aUZhY3RvckFzc2VydGlvbkltcGwob3RwLCB1bmRlZmluZWQsIHNlY3JldCk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBzdGF0aWMgX2Zyb21FbnJvbGxtZW50SWQoZW5yb2xsbWVudElkLCBvdHApIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb25JbXBsKG90cCwgZW5yb2xsbWVudElkKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIGFzeW5jIF9maW5hbGl6ZUVucm9sbChhdXRoLCBpZFRva2VuLCBkaXNwbGF5TmFtZSkge1xuICAgICAgICBfYXNzZXJ0KHR5cGVvZiB0aGlzLnNlY3JldCAhPT0gJ3VuZGVmaW5lZCcsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgcmV0dXJuIGZpbmFsaXplRW5yb2xsVG90cE1mYShhdXRoLCB7XG4gICAgICAgICAgICBpZFRva2VuLFxuICAgICAgICAgICAgZGlzcGxheU5hbWUsXG4gICAgICAgICAgICB0b3RwVmVyaWZpY2F0aW9uSW5mbzogdGhpcy5zZWNyZXQuX21ha2VUb3RwVmVyaWZpY2F0aW9uSW5mbyh0aGlzLm90cClcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKiBAaW50ZXJuYWwgKi9cbiAgICBhc3luYyBfZmluYWxpemVTaWduSW4oYXV0aCwgbWZhUGVuZGluZ0NyZWRlbnRpYWwpIHtcbiAgICAgICAgX2Fzc2VydCh0aGlzLmVucm9sbG1lbnRJZCAhPT0gdW5kZWZpbmVkICYmIHRoaXMub3RwICE9PSB1bmRlZmluZWQsIGF1dGgsIFwiYXJndW1lbnQtZXJyb3JcIiAvKiBBdXRoRXJyb3JDb2RlLkFSR1VNRU5UX0VSUk9SICovKTtcbiAgICAgICAgY29uc3QgdG90cFZlcmlmaWNhdGlvbkluZm8gPSB7IHZlcmlmaWNhdGlvbkNvZGU6IHRoaXMub3RwIH07XG4gICAgICAgIHJldHVybiBmaW5hbGl6ZVNpZ25JblRvdHBNZmEoYXV0aCwge1xuICAgICAgICAgICAgbWZhUGVuZGluZ0NyZWRlbnRpYWwsXG4gICAgICAgICAgICBtZmFFbnJvbGxtZW50SWQ6IHRoaXMuZW5yb2xsbWVudElkLFxuICAgICAgICAgICAgdG90cFZlcmlmaWNhdGlvbkluZm9cbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBQcm92aWRlciBmb3IgZ2VuZXJhdGluZyBhIHtAbGluayBUb3RwTXVsdGlGYWN0b3JBc3NlcnRpb259LlxuICpcbiAqIFN0b3JlcyB0aGUgc2hhcmVkIHNlY3JldCBrZXkgYW5kIG90aGVyIHBhcmFtZXRlcnMgdG8gZ2VuZXJhdGUgdGltZS1iYXNlZCBPVFBzLlxuICogSW1wbGVtZW50cyBtZXRob2RzIHRvIHJldHJpZXZlIHRoZSBzaGFyZWQgc2VjcmV0IGtleSBhbmQgZ2VuZXJhdGUgYSBRUiBjb2RlIFVSTC5cbiAqIEBwdWJsaWNcbiAqL1xuY2xhc3MgVG90cFNlY3JldCB7XG4gICAgLy8gVGhlIHB1YmxpYyBtZW1iZXJzIGFyZSBkZWNsYXJlZCBvdXRzaWRlIHRoZSBjb25zdHJ1Y3RvciBzbyB0aGUgZG9jcyBjYW4gYmUgZ2VuZXJhdGVkLlxuICAgIGNvbnN0cnVjdG9yKHNlY3JldEtleSwgaGFzaGluZ0FsZ29yaXRobSwgY29kZUxlbmd0aCwgY29kZUludGVydmFsU2Vjb25kcywgZW5yb2xsbWVudENvbXBsZXRpb25EZWFkbGluZSwgc2Vzc2lvbkluZm8sIGF1dGgpIHtcbiAgICAgICAgdGhpcy5zZXNzaW9uSW5mbyA9IHNlc3Npb25JbmZvO1xuICAgICAgICB0aGlzLmF1dGggPSBhdXRoO1xuICAgICAgICB0aGlzLnNlY3JldEtleSA9IHNlY3JldEtleTtcbiAgICAgICAgdGhpcy5oYXNoaW5nQWxnb3JpdGhtID0gaGFzaGluZ0FsZ29yaXRobTtcbiAgICAgICAgdGhpcy5jb2RlTGVuZ3RoID0gY29kZUxlbmd0aDtcbiAgICAgICAgdGhpcy5jb2RlSW50ZXJ2YWxTZWNvbmRzID0gY29kZUludGVydmFsU2Vjb25kcztcbiAgICAgICAgdGhpcy5lbnJvbGxtZW50Q29tcGxldGlvbkRlYWRsaW5lID0gZW5yb2xsbWVudENvbXBsZXRpb25EZWFkbGluZTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIHN0YXRpYyBfZnJvbVN0YXJ0VG90cE1mYUVucm9sbG1lbnRSZXNwb25zZShyZXNwb25zZSwgYXV0aCkge1xuICAgICAgICByZXR1cm4gbmV3IFRvdHBTZWNyZXQocmVzcG9uc2UudG90cFNlc3Npb25JbmZvLnNoYXJlZFNlY3JldEtleSwgcmVzcG9uc2UudG90cFNlc3Npb25JbmZvLmhhc2hpbmdBbGdvcml0aG0sIHJlc3BvbnNlLnRvdHBTZXNzaW9uSW5mby52ZXJpZmljYXRpb25Db2RlTGVuZ3RoLCByZXNwb25zZS50b3RwU2Vzc2lvbkluZm8ucGVyaW9kU2VjLCBuZXcgRGF0ZShyZXNwb25zZS50b3RwU2Vzc2lvbkluZm8uZmluYWxpemVFbnJvbGxtZW50VGltZSkudG9VVENTdHJpbmcoKSwgcmVzcG9uc2UudG90cFNlc3Npb25JbmZvLnNlc3Npb25JbmZvLCBhdXRoKTtcbiAgICB9XG4gICAgLyoqIEBpbnRlcm5hbCAqL1xuICAgIF9tYWtlVG90cFZlcmlmaWNhdGlvbkluZm8ob3RwKSB7XG4gICAgICAgIHJldHVybiB7IHNlc3Npb25JbmZvOiB0aGlzLnNlc3Npb25JbmZvLCB2ZXJpZmljYXRpb25Db2RlOiBvdHAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIFFSIGNvZGUgVVJMIGFzIGRlc2NyaWJlZCBpblxuICAgICAqIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvZ29vZ2xlLWF1dGhlbnRpY2F0b3Ivd2lraS9LZXktVXJpLUZvcm1hdFxuICAgICAqIFRoaXMgY2FuIGJlIGRpc3BsYXllZCB0byB0aGUgdXNlciBhcyBhIFFSIGNvZGUgdG8gYmUgc2Nhbm5lZCBpbnRvIGEgVE9UUCBhcHAgbGlrZSBHb29nbGUgQXV0aGVudGljYXRvci5cbiAgICAgKiBJZiB0aGUgb3B0aW9uYWwgcGFyYW1ldGVycyBhcmUgdW5zcGVjaWZpZWQsIGFuIGFjY291bnROYW1lIG9mIDx1c2VyRW1haWw+IGFuZCBpc3N1ZXIgb2YgPGZpcmViYXNlQXBwTmFtZT4gYXJlIHVzZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWNjb3VudE5hbWUgdGhlIG5hbWUgb2YgdGhlIGFjY291bnQvYXBwIGFsb25nIHdpdGggYSB1c2VyIGlkZW50aWZpZXIuXG4gICAgICogQHBhcmFtIGlzc3VlciBpc3N1ZXIgb2YgdGhlIFRPVFAgKGxpa2VseSB0aGUgYXBwIG5hbWUpLlxuICAgICAqIEByZXR1cm5zIEEgUVIgY29kZSBVUkwgc3RyaW5nLlxuICAgICAqL1xuICAgIGdlbmVyYXRlUXJDb2RlVXJsKGFjY291bnROYW1lLCBpc3N1ZXIpIHtcbiAgICAgICAgdmFyIF9hO1xuICAgICAgICBsZXQgdXNlRGVmYXVsdHMgPSBmYWxzZTtcbiAgICAgICAgaWYgKF9pc0VtcHR5U3RyaW5nKGFjY291bnROYW1lKSB8fCBfaXNFbXB0eVN0cmluZyhpc3N1ZXIpKSB7XG4gICAgICAgICAgICB1c2VEZWZhdWx0cyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZURlZmF1bHRzKSB7XG4gICAgICAgICAgICBpZiAoX2lzRW1wdHlTdHJpbmcoYWNjb3VudE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgYWNjb3VudE5hbWUgPSAoKF9hID0gdGhpcy5hdXRoLmN1cnJlbnRVc2VyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZW1haWwpIHx8ICd1bmtub3dudXNlcic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoX2lzRW1wdHlTdHJpbmcoaXNzdWVyKSkge1xuICAgICAgICAgICAgICAgIGlzc3VlciA9IHRoaXMuYXV0aC5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgb3RwYXV0aDovL3RvdHAvJHtpc3N1ZXJ9OiR7YWNjb3VudE5hbWV9P3NlY3JldD0ke3RoaXMuc2VjcmV0S2V5fSZpc3N1ZXI9JHtpc3N1ZXJ9JmFsZ29yaXRobT0ke3RoaXMuaGFzaGluZ0FsZ29yaXRobX0mZGlnaXRzPSR7dGhpcy5jb2RlTGVuZ3RofWA7XG4gICAgfVxufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gX2lzRW1wdHlTdHJpbmcoaW5wdXQpIHtcbiAgICByZXR1cm4gdHlwZW9mIGlucHV0ID09PSAndW5kZWZpbmVkJyB8fCAoaW5wdXQgPT09IG51bGwgfHwgaW5wdXQgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGlucHV0Lmxlbmd0aCkgPT09IDA7XG59XG5cbnZhciBuYW1lID0gXCJAZmlyZWJhc2UvYXV0aFwiO1xudmFyIHZlcnNpb24gPSBcIjEuMTAuMFwiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgQXV0aEludGVyb3Age1xuICAgIGNvbnN0cnVjdG9yKGF1dGgpIHtcbiAgICAgICAgdGhpcy5hdXRoID0gYXV0aDtcbiAgICAgICAgdGhpcy5pbnRlcm5hbExpc3RlbmVycyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gICAgZ2V0VWlkKCkge1xuICAgICAgICB2YXIgX2E7XG4gICAgICAgIHRoaXMuYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKTtcbiAgICAgICAgcmV0dXJuICgoX2EgPSB0aGlzLmF1dGguY3VycmVudFVzZXIpID09PSBudWxsIHx8IF9hID09PSB2b2lkIDAgPyB2b2lkIDAgOiBfYS51aWQpIHx8IG51bGw7XG4gICAgfVxuICAgIGFzeW5jIGdldFRva2VuKGZvcmNlUmVmcmVzaCkge1xuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XG4gICAgICAgIGF3YWl0IHRoaXMuYXV0aC5faW5pdGlhbGl6YXRpb25Qcm9taXNlO1xuICAgICAgICBpZiAoIXRoaXMuYXV0aC5jdXJyZW50VXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYWNjZXNzVG9rZW4gPSBhd2FpdCB0aGlzLmF1dGguY3VycmVudFVzZXIuZ2V0SWRUb2tlbihmb3JjZVJlZnJlc2gpO1xuICAgICAgICByZXR1cm4geyBhY2Nlc3NUb2tlbiB9O1xuICAgIH1cbiAgICBhZGRBdXRoVG9rZW5MaXN0ZW5lcihsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmFzc2VydEF1dGhDb25maWd1cmVkKCk7XG4gICAgICAgIGlmICh0aGlzLmludGVybmFsTGlzdGVuZXJzLmhhcyhsaXN0ZW5lcikpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1bnN1YnNjcmliZSA9IHRoaXMuYXV0aC5vbklkVG9rZW5DaGFuZ2VkKHVzZXIgPT4ge1xuICAgICAgICAgICAgbGlzdGVuZXIoKHVzZXIgPT09IG51bGwgfHwgdXNlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogdXNlci5zdHNUb2tlbk1hbmFnZXIuYWNjZXNzVG9rZW4pIHx8IG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5pbnRlcm5hbExpc3RlbmVycy5zZXQobGlzdGVuZXIsIHVuc3Vic2NyaWJlKTtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9hY3RpdmVSZWZyZXNoKCk7XG4gICAgfVxuICAgIHJlbW92ZUF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0QXV0aENvbmZpZ3VyZWQoKTtcbiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmUgPSB0aGlzLmludGVybmFsTGlzdGVuZXJzLmdldChsaXN0ZW5lcik7XG4gICAgICAgIGlmICghdW5zdWJzY3JpYmUpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmludGVybmFsTGlzdGVuZXJzLmRlbGV0ZShsaXN0ZW5lcik7XG4gICAgICAgIHVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHRoaXMudXBkYXRlUHJvYWN0aXZlUmVmcmVzaCgpO1xuICAgIH1cbiAgICBhc3NlcnRBdXRoQ29uZmlndXJlZCgpIHtcbiAgICAgICAgX2Fzc2VydCh0aGlzLmF1dGguX2luaXRpYWxpemF0aW9uUHJvbWlzZSwgXCJkZXBlbmRlbnQtc2RrLWluaXRpYWxpemVkLWJlZm9yZS1hdXRoXCIgLyogQXV0aEVycm9yQ29kZS5ERVBFTkRFTlRfU0RLX0lOSVRfQkVGT1JFX0FVVEggKi8pO1xuICAgIH1cbiAgICB1cGRhdGVQcm9hY3RpdmVSZWZyZXNoKCkge1xuICAgICAgICBpZiAodGhpcy5pbnRlcm5hbExpc3RlbmVycy5zaXplID4gMCkge1xuICAgICAgICAgICAgdGhpcy5hdXRoLl9zdGFydFByb2FjdGl2ZVJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYXV0aC5fc3RvcFByb2FjdGl2ZVJlZnJlc2goKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmZ1bmN0aW9uIGdldFZlcnNpb25Gb3JQbGF0Zm9ybShjbGllbnRQbGF0Zm9ybSkge1xuICAgIHN3aXRjaCAoY2xpZW50UGxhdGZvcm0pIHtcbiAgICAgICAgY2FzZSBcIk5vZGVcIiAvKiBDbGllbnRQbGF0Zm9ybS5OT0RFICovOlxuICAgICAgICAgICAgcmV0dXJuICdub2RlJztcbiAgICAgICAgY2FzZSBcIlJlYWN0TmF0aXZlXCIgLyogQ2xpZW50UGxhdGZvcm0uUkVBQ1RfTkFUSVZFICovOlxuICAgICAgICAgICAgcmV0dXJuICdybic7XG4gICAgICAgIGNhc2UgXCJXb3JrZXJcIiAvKiBDbGllbnRQbGF0Zm9ybS5XT1JLRVIgKi86XG4gICAgICAgICAgICByZXR1cm4gJ3dlYndvcmtlcic7XG4gICAgICAgIGNhc2UgXCJDb3Jkb3ZhXCIgLyogQ2xpZW50UGxhdGZvcm0uQ09SRE9WQSAqLzpcbiAgICAgICAgICAgIHJldHVybiAnY29yZG92YSc7XG4gICAgICAgIGNhc2UgXCJXZWJFeHRlbnNpb25cIiAvKiBDbGllbnRQbGF0Zm9ybS5XRUJfRVhURU5TSU9OICovOlxuICAgICAgICAgICAgcmV0dXJuICd3ZWItZXh0ZW5zaW9uJztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxufVxuLyoqIEBpbnRlcm5hbCAqL1xuZnVuY3Rpb24gcmVnaXN0ZXJBdXRoKGNsaWVudFBsYXRmb3JtKSB7XG4gICAgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJhdXRoXCIgLyogX0NvbXBvbmVudE5hbWUuQVVUSCAqLywgKGNvbnRhaW5lciwgeyBvcHRpb25zOiBkZXBzIH0pID0+IHtcbiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTtcbiAgICAgICAgY29uc3QgaGVhcnRiZWF0U2VydmljZVByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdoZWFydGJlYXQnKTtcbiAgICAgICAgY29uc3QgYXBwQ2hlY2tTZXJ2aWNlUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcC1jaGVjay1pbnRlcm5hbCcpO1xuICAgICAgICBjb25zdCB7IGFwaUtleSwgYXV0aERvbWFpbiB9ID0gYXBwLm9wdGlvbnM7XG4gICAgICAgIF9hc3NlcnQoYXBpS2V5ICYmICFhcGlLZXkuaW5jbHVkZXMoJzonKSwgXCJpbnZhbGlkLWFwaS1rZXlcIiAvKiBBdXRoRXJyb3JDb2RlLklOVkFMSURfQVBJX0tFWSAqLywgeyBhcHBOYW1lOiBhcHAubmFtZSB9KTtcbiAgICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICAgICAgYXBpS2V5LFxuICAgICAgICAgICAgYXV0aERvbWFpbixcbiAgICAgICAgICAgIGNsaWVudFBsYXRmb3JtLFxuICAgICAgICAgICAgYXBpSG9zdDogXCJpZGVudGl0eXRvb2xraXQuZ29vZ2xlYXBpcy5jb21cIiAvKiBEZWZhdWx0Q29uZmlnLkFQSV9IT1NUICovLFxuICAgICAgICAgICAgdG9rZW5BcGlIb3N0OiBcInNlY3VyZXRva2VuLmdvb2dsZWFwaXMuY29tXCIgLyogRGVmYXVsdENvbmZpZy5UT0tFTl9BUElfSE9TVCAqLyxcbiAgICAgICAgICAgIGFwaVNjaGVtZTogXCJodHRwc1wiIC8qIERlZmF1bHRDb25maWcuQVBJX1NDSEVNRSAqLyxcbiAgICAgICAgICAgIHNka0NsaWVudFZlcnNpb246IF9nZXRDbGllbnRWZXJzaW9uKGNsaWVudFBsYXRmb3JtKVxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBhdXRoSW5zdGFuY2UgPSBuZXcgQXV0aEltcGwoYXBwLCBoZWFydGJlYXRTZXJ2aWNlUHJvdmlkZXIsIGFwcENoZWNrU2VydmljZVByb3ZpZGVyLCBjb25maWcpO1xuICAgICAgICBfaW5pdGlhbGl6ZUF1dGhJbnN0YW5jZShhdXRoSW5zdGFuY2UsIGRlcHMpO1xuICAgICAgICByZXR1cm4gYXV0aEluc3RhbmNlO1xuICAgIH0sIFwiUFVCTElDXCIgLyogQ29tcG9uZW50VHlwZS5QVUJMSUMgKi8pXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBdXRoIGNhbiBvbmx5IGJlIGluaXRpYWxpemVkIGJ5IGV4cGxpY2l0bHkgY2FsbGluZyBnZXRBdXRoKCkgb3IgaW5pdGlhbGl6ZUF1dGgoKVxuICAgICAgICAgKiBGb3Igd2h5IHdlIGRvIHRoaXMsIFNlZSBnby9maXJlYmFzZS1uZXh0LWF1dGgtaW5pdFxuICAgICAgICAgKi9cbiAgICAgICAgLnNldEluc3RhbnRpYXRpb25Nb2RlKFwiRVhQTElDSVRcIiAvKiBJbnN0YW50aWF0aW9uTW9kZS5FWFBMSUNJVCAqLylcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJlY2F1c2UgYWxsIGZpcmViYXNlIHByb2R1Y3RzIHRoYXQgZGVwZW5kIG9uIGF1dGggZGVwZW5kIG9uIGF1dGgtaW50ZXJuYWwgZGlyZWN0bHksXG4gICAgICAgICAqIHdlIG5lZWQgdG8gaW5pdGlhbGl6ZSBhdXRoLWludGVybmFsIGFmdGVyIGF1dGggaXMgaW5pdGlhbGl6ZWQgdG8gbWFrZSBpdCBhdmFpbGFibGUgdG8gb3RoZXIgZmlyZWJhc2UgcHJvZHVjdHMuXG4gICAgICAgICAqL1xuICAgICAgICAuc2V0SW5zdGFuY2VDcmVhdGVkQ2FsbGJhY2soKGNvbnRhaW5lciwgX2luc3RhbmNlSWRlbnRpZmllciwgX2luc3RhbmNlKSA9PiB7XG4gICAgICAgIGNvbnN0IGF1dGhJbnRlcm5hbFByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKFwiYXV0aC1pbnRlcm5hbFwiIC8qIF9Db21wb25lbnROYW1lLkFVVEhfSU5URVJOQUwgKi8pO1xuICAgICAgICBhdXRoSW50ZXJuYWxQcm92aWRlci5pbml0aWFsaXplKCk7XG4gICAgfSkpO1xuICAgIF9yZWdpc3RlckNvbXBvbmVudChuZXcgQ29tcG9uZW50KFwiYXV0aC1pbnRlcm5hbFwiIC8qIF9Db21wb25lbnROYW1lLkFVVEhfSU5URVJOQUwgKi8sIGNvbnRhaW5lciA9PiB7XG4gICAgICAgIGNvbnN0IGF1dGggPSBfY2FzdEF1dGgoY29udGFpbmVyLmdldFByb3ZpZGVyKFwiYXV0aFwiIC8qIF9Db21wb25lbnROYW1lLkFVVEggKi8pLmdldEltbWVkaWF0ZSgpKTtcbiAgICAgICAgcmV0dXJuIChhdXRoID0+IG5ldyBBdXRoSW50ZXJvcChhdXRoKSkoYXV0aCk7XG4gICAgfSwgXCJQUklWQVRFXCIgLyogQ29tcG9uZW50VHlwZS5QUklWQVRFICovKS5zZXRJbnN0YW50aWF0aW9uTW9kZShcIkVYUExJQ0lUXCIgLyogSW5zdGFudGlhdGlvbk1vZGUuRVhQTElDSVQgKi8pKTtcbiAgICByZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgZ2V0VmVyc2lvbkZvclBsYXRmb3JtKGNsaWVudFBsYXRmb3JtKSk7XG4gICAgLy8gQlVJTERfVEFSR0VUIHdpbGwgYmUgcmVwbGFjZWQgYnkgdmFsdWVzIGxpa2UgZXNtMjAxNywgY2pzMjAxNywgZXRjIGR1cmluZyB0aGUgY29tcGlsYXRpb25cbiAgICByZWdpc3RlclZlcnNpb24obmFtZSwgdmVyc2lvbiwgJ2VzbTIwMTcnKTtcbn1cblxuZXhwb3J0IHsgdXBkYXRlRW1haWwgYXMgJCwgQVVUSF9FUlJPUl9DT0RFU19NQVBfRE9fTk9UX1VTRV9JTlRFUk5BTExZIGFzIEEsIGxpbmtXaXRoQ3JlZGVudGlhbCBhcyBCLCByZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsIGFzIEMsIHNpZ25JbldpdGhDdXN0b21Ub2tlbiBhcyBELCBFbWFpbEF1dGhDcmVkZW50aWFsIGFzIEUsIEZhY2Vib29rQXV0aFByb3ZpZGVyIGFzIEYsIEdvb2dsZUF1dGhQcm92aWRlciBhcyBHLCBzZW5kUGFzc3dvcmRSZXNldEVtYWlsIGFzIEgsIGNvbmZpcm1QYXNzd29yZFJlc2V0IGFzIEksIGFwcGx5QWN0aW9uQ29kZSBhcyBKLCBjaGVja0FjdGlvbkNvZGUgYXMgSywgdmVyaWZ5UGFzc3dvcmRSZXNldENvZGUgYXMgTCwgY3JlYXRlVXNlcldpdGhFbWFpbEFuZFBhc3N3b3JkIGFzIE0sIHNpZ25JbldpdGhFbWFpbEFuZFBhc3N3b3JkIGFzIE4sIE9BdXRoQ3JlZGVudGlhbCBhcyBPLCBQaG9uZUF1dGhDcmVkZW50aWFsIGFzIFAsIHNlbmRTaWduSW5MaW5rVG9FbWFpbCBhcyBRLCBpc1NpZ25JbldpdGhFbWFpbExpbmsgYXMgUiwgU0FNTEF1dGhQcm92aWRlciBhcyBTLCBUb3RwTXVsdGlGYWN0b3JHZW5lcmF0b3IgYXMgVCwgc2lnbkluV2l0aEVtYWlsTGluayBhcyBVLCBmZXRjaFNpZ25Jbk1ldGhvZHNGb3JFbWFpbCBhcyBWLCBzZW5kRW1haWxWZXJpZmljYXRpb24gYXMgVywgdmVyaWZ5QmVmb3JlVXBkYXRlRW1haWwgYXMgWCwgQWN0aW9uQ29kZVVSTCBhcyBZLCBwYXJzZUFjdGlvbkNvZGVVUkwgYXMgWiwgdXBkYXRlUHJvZmlsZSBhcyBfLCBpbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlIGFzIGEsIEZldGNoUHJvdmlkZXIgYXMgYSQsIHVwZGF0ZVBhc3N3b3JkIGFzIGEwLCBnZXRJZFRva2VuIGFzIGExLCBnZXRJZFRva2VuUmVzdWx0IGFzIGEyLCB1bmxpbmsgYXMgYTMsIGdldEFkZGl0aW9uYWxVc2VySW5mbyBhcyBhNCwgcmVsb2FkIGFzIGE1LCBnZXRNdWx0aUZhY3RvclJlc29sdmVyIGFzIGE2LCBtdWx0aUZhY3RvciBhcyBhNywgU1RPUkFHRV9BVkFJTEFCTEVfS0VZIGFzIGE4LCBfaXNNb2JpbGVCcm93c2VyIGFzIGE5LCBzaWduSW5XaXRoSWRwIGFzIGFBLCBfZmFpbCBhcyBhQiwgZGVidWdBc3NlcnQgYXMgYUMsIF9hc3NlcnRJbnN0YW5jZU9mIGFzIGFELCBfZ2VuZXJhdGVFdmVudElkIGFzIGFFLCBGZWRlcmF0ZWRBdXRoUHJvdmlkZXIgYXMgYUYsIF9wZXJzaXN0ZW5jZUtleU5hbWUgYXMgYUcsIF9wZXJmb3JtQXBpUmVxdWVzdCBhcyBhSCwgX2dldEN1cnJlbnRVcmwgYXMgYUksIF9nYXBpU2NyaXB0VXJsIGFzIGFKLCBfZW11bGF0b3JVcmwgYXMgYUssIF9pc0Nocm9tZUlPUyBhcyBhTCwgX2lzRmlyZWZveCBhcyBhTSwgX2lzSU9TU3RhbmRhbG9uZSBhcyBhTiwgQmFzZU9BdXRoUHJvdmlkZXIgYXMgYU8sIF9zZXRXaW5kb3dMb2NhdGlvbiBhcyBhUCwgX2lzU2FmYXJpIGFzIGFRLCBfaXNJT1MgYXMgYVIsIE11bHRpRmFjdG9yQXNzZXJ0aW9uSW1wbCBhcyBhUywgZmluYWxpemVFbnJvbGxQaG9uZU1mYSBhcyBhVCwgZmluYWxpemVTaWduSW5QaG9uZU1mYSBhcyBhVSwgX3NldEV4dGVybmFsSlNQcm92aWRlciBhcyBhViwgX2lzQW5kcm9pZCBhcyBhVywgX2lzSU9TN09yOCBhcyBhWCwgVXNlckltcGwgYXMgYVksIEF1dGhJbXBsIGFzIGFaLCBfZ2V0Q2xpZW50VmVyc2lvbiBhcyBhXywgX2lzSUUxMCBhcyBhYSwgRGVsYXkgYXMgYWIsIF93aW5kb3cgYXMgYWMsIF9hc3NlcnQgYXMgYWQsIGlzVjIgYXMgYWUsIF9jcmVhdGVFcnJvciBhcyBhZiwgX3JlY2FwdGNoYVYyU2NyaXB0VXJsIGFzIGFnLCBfbG9hZEpTIGFzIGFoLCBNb2NrUmVDYXB0Y2hhIGFzIGFpLCBfZ2VuZXJhdGVDYWxsYmFja05hbWUgYXMgYWosIF9jYXN0QXV0aCBhcyBhaywgX2lzSHR0cE9ySHR0cHMgYXMgYWwsIF9pc1dvcmtlciBhcyBhbSwgZ2V0UmVjYXB0Y2hhUGFyYW1zIGFzIGFuLCBfc2VydmVyQXBwQ3VycmVudFVzZXJPcGVyYXRpb25Ob3RTdXBwb3J0ZWRFcnJvciBhcyBhbywgX2Fzc2VydExpbmtlZFN0YXR1cyBhcyBhcCwgX2luaXRpYWxpemVSZWNhcHRjaGFDb25maWcgYXMgYXEsIEZBS0VfVE9LRU4gYXMgYXIsIHN0YXJ0RW5yb2xsUGhvbmVNZmEgYXMgYXMsIGhhbmRsZVJlY2FwdGNoYUZsb3cgYXMgYXQsIHN0YXJ0U2lnbkluUGhvbmVNZmEgYXMgYXUsIHNlbmRQaG9uZVZlcmlmaWNhdGlvbkNvZGUgYXMgYXYsIF9saW5rIGFzIGF3LCBfZ2V0SW5zdGFuY2UgYXMgYXgsIF9zaWduSW5XaXRoQ3JlZGVudGlhbCBhcyBheSwgX3JlYXV0aGVudGljYXRlIGFzIGF6LCBUb3RwU2VjcmV0IGFzIGIsIFNBTUxBdXRoQ3JlZGVudGlhbCBhcyBiMCwgY29ubmVjdEF1dGhFbXVsYXRvciBhcyBjLCBpbml0aWFsaXplUmVjYXB0Y2hhQ29uZmlnIGFzIGQsIGJlZm9yZUF1dGhTdGF0ZUNoYW5nZWQgYXMgZSwgb25BdXRoU3RhdGVDaGFuZ2VkIGFzIGYsIHVwZGF0ZUN1cnJlbnRVc2VyIGFzIGcsIHNpZ25PdXQgYXMgaCwgaW5pdGlhbGl6ZUF1dGggYXMgaSwgcmV2b2tlQWNjZXNzVG9rZW4gYXMgaiwgZGVsZXRlVXNlciBhcyBrLCBkZWJ1Z0Vycm9yTWFwIGFzIGwsIEF1dGhDcmVkZW50aWFsIGFzIG0sIGluTWVtb3J5UGVyc2lzdGVuY2UgYXMgbiwgb25JZFRva2VuQ2hhbmdlZCBhcyBvLCBwcm9kRXJyb3JNYXAgYXMgcCwgRW1haWxBdXRoUHJvdmlkZXIgYXMgcSwgcmVnaXN0ZXJBdXRoIGFzIHIsIHNldFBlcnNpc3RlbmNlIGFzIHMsIEdpdGh1YkF1dGhQcm92aWRlciBhcyB0LCB1c2VEZXZpY2VMYW5ndWFnZSBhcyB1LCB2YWxpZGF0ZVBhc3N3b3JkIGFzIHYsIE9BdXRoUHJvdmlkZXIgYXMgdywgVHdpdHRlckF1dGhQcm92aWRlciBhcyB4LCBzaWduSW5Bbm9ueW1vdXNseSBhcyB5LCBzaWduSW5XaXRoQ3JlZGVudGlhbCBhcyB6IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1yZWdpc3Rlci0wMDUyMmQ4MS5qcy5tYXBcbiIsImltcG9ydCB7IHIgYXMgcmVnaXN0ZXJBdXRoLCBpIGFzIGluaXRpYWxpemVBdXRoLCBhIGFzIGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UsIGMgYXMgY29ubmVjdEF1dGhFbXVsYXRvciB9IGZyb20gJy4vcmVnaXN0ZXItMDA1MjJkODEuanMnO1xuZXhwb3J0IHsgWSBhcyBBY3Rpb25Db2RlVVJMLCBtIGFzIEF1dGhDcmVkZW50aWFsLCBBIGFzIEF1dGhFcnJvckNvZGVzLCBFIGFzIEVtYWlsQXV0aENyZWRlbnRpYWwsIHEgYXMgRW1haWxBdXRoUHJvdmlkZXIsIEYgYXMgRmFjZWJvb2tBdXRoUHJvdmlkZXIsIHQgYXMgR2l0aHViQXV0aFByb3ZpZGVyLCBHIGFzIEdvb2dsZUF1dGhQcm92aWRlciwgTyBhcyBPQXV0aENyZWRlbnRpYWwsIHcgYXMgT0F1dGhQcm92aWRlciwgUCBhcyBQaG9uZUF1dGhDcmVkZW50aWFsLCBTIGFzIFNBTUxBdXRoUHJvdmlkZXIsIFQgYXMgVG90cE11bHRpRmFjdG9yR2VuZXJhdG9yLCBiIGFzIFRvdHBTZWNyZXQsIHggYXMgVHdpdHRlckF1dGhQcm92aWRlciwgSiBhcyBhcHBseUFjdGlvbkNvZGUsIGUgYXMgYmVmb3JlQXV0aFN0YXRlQ2hhbmdlZCwgSyBhcyBjaGVja0FjdGlvbkNvZGUsIEkgYXMgY29uZmlybVBhc3N3b3JkUmVzZXQsIGMgYXMgY29ubmVjdEF1dGhFbXVsYXRvciwgTSBhcyBjcmVhdGVVc2VyV2l0aEVtYWlsQW5kUGFzc3dvcmQsIGwgYXMgZGVidWdFcnJvck1hcCwgayBhcyBkZWxldGVVc2VyLCBWIGFzIGZldGNoU2lnbkluTWV0aG9kc0ZvckVtYWlsLCBhNCBhcyBnZXRBZGRpdGlvbmFsVXNlckluZm8sIGExIGFzIGdldElkVG9rZW4sIGEyIGFzIGdldElkVG9rZW5SZXN1bHQsIGE2IGFzIGdldE11bHRpRmFjdG9yUmVzb2x2ZXIsIG4gYXMgaW5NZW1vcnlQZXJzaXN0ZW5jZSwgYSBhcyBpbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlLCBpIGFzIGluaXRpYWxpemVBdXRoLCBkIGFzIGluaXRpYWxpemVSZWNhcHRjaGFDb25maWcsIFIgYXMgaXNTaWduSW5XaXRoRW1haWxMaW5rLCBCIGFzIGxpbmtXaXRoQ3JlZGVudGlhbCwgYTcgYXMgbXVsdGlGYWN0b3IsIGYgYXMgb25BdXRoU3RhdGVDaGFuZ2VkLCBvIGFzIG9uSWRUb2tlbkNoYW5nZWQsIFogYXMgcGFyc2VBY3Rpb25Db2RlVVJMLCBwIGFzIHByb2RFcnJvck1hcCwgQyBhcyByZWF1dGhlbnRpY2F0ZVdpdGhDcmVkZW50aWFsLCBhNSBhcyByZWxvYWQsIGogYXMgcmV2b2tlQWNjZXNzVG9rZW4sIFcgYXMgc2VuZEVtYWlsVmVyaWZpY2F0aW9uLCBIIGFzIHNlbmRQYXNzd29yZFJlc2V0RW1haWwsIFEgYXMgc2VuZFNpZ25JbkxpbmtUb0VtYWlsLCBzIGFzIHNldFBlcnNpc3RlbmNlLCB5IGFzIHNpZ25JbkFub255bW91c2x5LCB6IGFzIHNpZ25JbldpdGhDcmVkZW50aWFsLCBEIGFzIHNpZ25JbldpdGhDdXN0b21Ub2tlbiwgTiBhcyBzaWduSW5XaXRoRW1haWxBbmRQYXNzd29yZCwgVSBhcyBzaWduSW5XaXRoRW1haWxMaW5rLCBoIGFzIHNpZ25PdXQsIGEzIGFzIHVubGluaywgZyBhcyB1cGRhdGVDdXJyZW50VXNlciwgJCBhcyB1cGRhdGVFbWFpbCwgYTAgYXMgdXBkYXRlUGFzc3dvcmQsIF8gYXMgdXBkYXRlUHJvZmlsZSwgdSBhcyB1c2VEZXZpY2VMYW5ndWFnZSwgdiBhcyB2YWxpZGF0ZVBhc3N3b3JkLCBYIGFzIHZlcmlmeUJlZm9yZVVwZGF0ZUVtYWlsLCBMIGFzIHZlcmlmeVBhc3N3b3JkUmVzZXRDb2RlIH0gZnJvbSAnLi9yZWdpc3Rlci0wMDUyMmQ4MS5qcyc7XG5pbXBvcnQgeyBfZ2V0UHJvdmlkZXIsIGdldEFwcCB9IGZyb20gJ0BmaXJlYmFzZS9hcHAnO1xuaW1wb3J0IHsgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdCB9IGZyb20gJ0BmaXJlYmFzZS91dGlsJztcbmltcG9ydCAndHNsaWInO1xuaW1wb3J0ICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCAnQGZpcmViYXNlL2xvZ2dlcic7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIEF1dGggaW5zdGFuY2UgYXNzb2NpYXRlZCB3aXRoIHRoZSBwcm92aWRlZCB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0uXG4gKiBJZiBubyBpbnN0YW5jZSBleGlzdHMsIGluaXRpYWxpemVzIGFuIEF1dGggaW5zdGFuY2Ugd2l0aCBwbGF0Zm9ybS1zcGVjaWZpYyBkZWZhdWx0IGRlcGVuZGVuY2llcy5cbiAqXG4gKiBAcGFyYW0gYXBwIC0gVGhlIEZpcmViYXNlIEFwcC5cbiAqXG4gKiBAcHVibGljXG4gKi9cbmZ1bmN0aW9uIGdldEF1dGgoYXBwID0gZ2V0QXBwKCkpIHtcbiAgICBjb25zdCBwcm92aWRlciA9IF9nZXRQcm92aWRlcihhcHAsICdhdXRoJyk7XG4gICAgaWYgKHByb3ZpZGVyLmlzSW5pdGlhbGl6ZWQoKSkge1xuICAgICAgICByZXR1cm4gcHJvdmlkZXIuZ2V0SW1tZWRpYXRlKCk7XG4gICAgfVxuICAgIGNvbnN0IGF1dGggPSBpbml0aWFsaXplQXV0aChhcHAsIHtcbiAgICAgICAgcGVyc2lzdGVuY2U6IFtpbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlXVxuICAgIH0pO1xuICAgIGNvbnN0IGF1dGhFbXVsYXRvckhvc3QgPSBnZXREZWZhdWx0RW11bGF0b3JIb3N0KCdhdXRoJyk7XG4gICAgaWYgKGF1dGhFbXVsYXRvckhvc3QpIHtcbiAgICAgICAgY29ubmVjdEF1dGhFbXVsYXRvcihhdXRoLCBgaHR0cDovLyR7YXV0aEVtdWxhdG9ySG9zdH1gKTtcbiAgICB9XG4gICAgcmV0dXJuIGF1dGg7XG59XG5yZWdpc3RlckF1dGgoXCJXZWJFeHRlbnNpb25cIiAvKiBDbGllbnRQbGF0Zm9ybS5XRUJfRVhURU5TSU9OICovKTtcblxuZXhwb3J0IHsgZ2V0QXV0aCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9aW5kZXguanMubWFwXG4iLCJ2YXIgY29tbW9uanNHbG9iYWwgPSB0eXBlb2YgZ2xvYmFsVGhpcyAhPT0gJ3VuZGVmaW5lZCcgPyBnbG9iYWxUaGlzIDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgOiB0eXBlb2YgZ2xvYmFsICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgOiB7fTtcblxudmFyIGJsb29tX2Jsb2JfZXMyMDE4ID0ge307XG5cbi8qKiBAbGljZW5zZVxuQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cblNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4qL1xuXG52YXIgSW50ZWdlcjtcbnZhciBNZDU7XG4oZnVuY3Rpb24oKSB7dmFyIGg7LyoqIEBsaWNlbnNlXG5cbiBDb3B5cmlnaHQgVGhlIENsb3N1cmUgTGlicmFyeSBBdXRob3JzLlxuIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4qL1xuZnVuY3Rpb24gayhmLGEpe2Z1bmN0aW9uIGMoKXt9Yy5wcm90b3R5cGU9YS5wcm90b3R5cGU7Zi5EPWEucHJvdG90eXBlO2YucHJvdG90eXBlPW5ldyBjO2YucHJvdG90eXBlLmNvbnN0cnVjdG9yPWY7Zi5DPWZ1bmN0aW9uKGQsZSxnKXtmb3IodmFyIGI9QXJyYXkoYXJndW1lbnRzLmxlbmd0aC0yKSxyPTI7cjxhcmd1bWVudHMubGVuZ3RoO3IrKyliW3ItMl09YXJndW1lbnRzW3JdO3JldHVybiBhLnByb3RvdHlwZVtlXS5hcHBseShkLGIpfTt9ZnVuY3Rpb24gbCgpe3RoaXMuYmxvY2tTaXplPS0xO31mdW5jdGlvbiBtKCl7dGhpcy5ibG9ja1NpemU9LTE7dGhpcy5ibG9ja1NpemU9NjQ7dGhpcy5nPUFycmF5KDQpO3RoaXMuQj1BcnJheSh0aGlzLmJsb2NrU2l6ZSk7dGhpcy5vPXRoaXMuaD0wO3RoaXMucygpO31rKG0sbCk7bS5wcm90b3R5cGUucz1mdW5jdGlvbigpe3RoaXMuZ1swXT0xNzMyNTg0MTkzO3RoaXMuZ1sxXT00MDIzMjMzNDE3O3RoaXMuZ1syXT0yNTYyMzgzMTAyO3RoaXMuZ1szXT0yNzE3MzM4Nzg7dGhpcy5vPXRoaXMuaD0wO307XG5mdW5jdGlvbiBuKGYsYSxjKXtjfHwoYz0wKTt2YXIgZD1BcnJheSgxNik7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKWZvcih2YXIgZT0wOzE2PmU7KytlKWRbZV09YS5jaGFyQ29kZUF0KGMrKyl8YS5jaGFyQ29kZUF0KGMrKyk8PDh8YS5jaGFyQ29kZUF0KGMrKyk8PDE2fGEuY2hhckNvZGVBdChjKyspPDwyNDtlbHNlIGZvcihlPTA7MTY+ZTsrK2UpZFtlXT1hW2MrK118YVtjKytdPDw4fGFbYysrXTw8MTZ8YVtjKytdPDwyNDthPWYuZ1swXTtjPWYuZ1sxXTtlPWYuZ1syXTt2YXIgZz1mLmdbM107dmFyIGI9YSsoZ15jJihlXmcpKStkWzBdKzM2MTQwOTAzNjAmNDI5NDk2NzI5NTthPWMrKGI8PDcmNDI5NDk2NzI5NXxiPj4+MjUpO2I9ZysoZV5hJihjXmUpKStkWzFdKzM5MDU0MDI3MTAmNDI5NDk2NzI5NTtnPWErKGI8PDEyJjQyOTQ5NjcyOTV8Yj4+PjIwKTtiPWUrKGNeZyYoYV5jKSkrZFsyXSs2MDYxMDU4MTkmNDI5NDk2NzI5NTtlPWcrKGI8PDE3JjQyOTQ5NjcyOTV8Yj4+PjE1KTtcbmI9YysoYV5lJihnXmEpKStkWzNdKzMyNTA0NDE5NjYmNDI5NDk2NzI5NTtjPWUrKGI8PDIyJjQyOTQ5NjcyOTV8Yj4+PjEwKTtiPWErKGdeYyYoZV5nKSkrZFs0XSs0MTE4NTQ4Mzk5JjQyOTQ5NjcyOTU7YT1jKyhiPDw3JjQyOTQ5NjcyOTV8Yj4+PjI1KTtiPWcrKGVeYSYoY15lKSkrZFs1XSsxMjAwMDgwNDI2JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMiY0Mjk0OTY3Mjk1fGI+Pj4yMCk7Yj1lKyhjXmcmKGFeYykpK2RbNl0rMjgyMTczNTk1NSY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTcmNDI5NDk2NzI5NXxiPj4+MTUpO2I9YysoYV5lJihnXmEpKStkWzddKzQyNDkyNjEzMTMmNDI5NDk2NzI5NTtjPWUrKGI8PDIyJjQyOTQ5NjcyOTV8Yj4+PjEwKTtiPWErKGdeYyYoZV5nKSkrZFs4XSsxNzcwMDM1NDE2JjQyOTQ5NjcyOTU7YT1jKyhiPDw3JjQyOTQ5NjcyOTV8Yj4+PjI1KTtiPWcrKGVeYSYoY15lKSkrZFs5XSsyMzM2NTUyODc5JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMiY0Mjk0OTY3Mjk1fFxuYj4+PjIwKTtiPWUrKGNeZyYoYV5jKSkrZFsxMF0rNDI5NDkyNTIzMyY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTcmNDI5NDk2NzI5NXxiPj4+MTUpO2I9YysoYV5lJihnXmEpKStkWzExXSsyMzA0NTYzMTM0JjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMiY0Mjk0OTY3Mjk1fGI+Pj4xMCk7Yj1hKyhnXmMmKGVeZykpK2RbMTJdKzE4MDQ2MDM2ODImNDI5NDk2NzI5NTthPWMrKGI8PDcmNDI5NDk2NzI5NXxiPj4+MjUpO2I9ZysoZV5hJihjXmUpKStkWzEzXSs0MjU0NjI2MTk1JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMiY0Mjk0OTY3Mjk1fGI+Pj4yMCk7Yj1lKyhjXmcmKGFeYykpK2RbMTRdKzI3OTI5NjUwMDYmNDI5NDk2NzI5NTtlPWcrKGI8PDE3JjQyOTQ5NjcyOTV8Yj4+PjE1KTtiPWMrKGFeZSYoZ15hKSkrZFsxNV0rMTIzNjUzNTMyOSY0Mjk0OTY3Mjk1O2M9ZSsoYjw8MjImNDI5NDk2NzI5NXxiPj4+MTApO2I9YSsoZV5nJihjXmUpKStkWzFdKzQxMjkxNzA3ODYmNDI5NDk2NzI5NTthPWMrKGI8PFxuNSY0Mjk0OTY3Mjk1fGI+Pj4yNyk7Yj1nKyhjXmUmKGFeYykpK2RbNl0rMzIyNTQ2NTY2NCY0Mjk0OTY3Mjk1O2c9YSsoYjw8OSY0Mjk0OTY3Mjk1fGI+Pj4yMyk7Yj1lKyhhXmMmKGdeYSkpK2RbMTFdKzY0MzcxNzcxMyY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTQmNDI5NDk2NzI5NXxiPj4+MTgpO2I9YysoZ15hJihlXmcpKStkWzBdKzM5MjEwNjk5OTQmNDI5NDk2NzI5NTtjPWUrKGI8PDIwJjQyOTQ5NjcyOTV8Yj4+PjEyKTtiPWErKGVeZyYoY15lKSkrZFs1XSszNTkzNDA4NjA1JjQyOTQ5NjcyOTU7YT1jKyhiPDw1JjQyOTQ5NjcyOTV8Yj4+PjI3KTtiPWcrKGNeZSYoYV5jKSkrZFsxMF0rMzgwMTYwODMmNDI5NDk2NzI5NTtnPWErKGI8PDkmNDI5NDk2NzI5NXxiPj4+MjMpO2I9ZSsoYV5jJihnXmEpKStkWzE1XSszNjM0NDg4OTYxJjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNCY0Mjk0OTY3Mjk1fGI+Pj4xOCk7Yj1jKyhnXmEmKGVeZykpK2RbNF0rMzg4OTQyOTQ0OCY0Mjk0OTY3Mjk1O2M9XG5lKyhiPDwyMCY0Mjk0OTY3Mjk1fGI+Pj4xMik7Yj1hKyhlXmcmKGNeZSkpK2RbOV0rNTY4NDQ2NDM4JjQyOTQ5NjcyOTU7YT1jKyhiPDw1JjQyOTQ5NjcyOTV8Yj4+PjI3KTtiPWcrKGNeZSYoYV5jKSkrZFsxNF0rMzI3NTE2MzYwNiY0Mjk0OTY3Mjk1O2c9YSsoYjw8OSY0Mjk0OTY3Mjk1fGI+Pj4yMyk7Yj1lKyhhXmMmKGdeYSkpK2RbM10rNDEwNzYwMzMzNSY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTQmNDI5NDk2NzI5NXxiPj4+MTgpO2I9YysoZ15hJihlXmcpKStkWzhdKzExNjM1MzE1MDEmNDI5NDk2NzI5NTtjPWUrKGI8PDIwJjQyOTQ5NjcyOTV8Yj4+PjEyKTtiPWErKGVeZyYoY15lKSkrZFsxM10rMjg1MDI4NTgyOSY0Mjk0OTY3Mjk1O2E9YysoYjw8NSY0Mjk0OTY3Mjk1fGI+Pj4yNyk7Yj1nKyhjXmUmKGFeYykpK2RbMl0rNDI0MzU2MzUxMiY0Mjk0OTY3Mjk1O2c9YSsoYjw8OSY0Mjk0OTY3Mjk1fGI+Pj4yMyk7Yj1lKyhhXmMmKGdeYSkpK2RbN10rMTczNTMyODQ3MyY0Mjk0OTY3Mjk1O1xuZT1nKyhiPDwxNCY0Mjk0OTY3Mjk1fGI+Pj4xOCk7Yj1jKyhnXmEmKGVeZykpK2RbMTJdKzIzNjgzNTk1NjImNDI5NDk2NzI5NTtjPWUrKGI8PDIwJjQyOTQ5NjcyOTV8Yj4+PjEyKTtiPWErKGNeZV5nKStkWzVdKzQyOTQ1ODg3MzgmNDI5NDk2NzI5NTthPWMrKGI8PDQmNDI5NDk2NzI5NXxiPj4+MjgpO2I9ZysoYV5jXmUpK2RbOF0rMjI3MjM5MjgzMyY0Mjk0OTY3Mjk1O2c9YSsoYjw8MTEmNDI5NDk2NzI5NXxiPj4+MjEpO2I9ZSsoZ15hXmMpK2RbMTFdKzE4MzkwMzA1NjImNDI5NDk2NzI5NTtlPWcrKGI8PDE2JjQyOTQ5NjcyOTV8Yj4+PjE2KTtiPWMrKGVeZ15hKStkWzE0XSs0MjU5NjU3NzQwJjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMyY0Mjk0OTY3Mjk1fGI+Pj45KTtiPWErKGNeZV5nKStkWzFdKzI3NjM5NzUyMzYmNDI5NDk2NzI5NTthPWMrKGI8PDQmNDI5NDk2NzI5NXxiPj4+MjgpO2I9ZysoYV5jXmUpK2RbNF0rMTI3Mjg5MzM1MyY0Mjk0OTY3Mjk1O2c9YSsoYjw8MTEmNDI5NDk2NzI5NXxcbmI+Pj4yMSk7Yj1lKyhnXmFeYykrZFs3XSs0MTM5NDY5NjY0JjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNiY0Mjk0OTY3Mjk1fGI+Pj4xNik7Yj1jKyhlXmdeYSkrZFsxMF0rMzIwMDIzNjY1NiY0Mjk0OTY3Mjk1O2M9ZSsoYjw8MjMmNDI5NDk2NzI5NXxiPj4+OSk7Yj1hKyhjXmVeZykrZFsxM10rNjgxMjc5MTc0JjQyOTQ5NjcyOTU7YT1jKyhiPDw0JjQyOTQ5NjcyOTV8Yj4+PjI4KTtiPWcrKGFeY15lKStkWzBdKzM5MzY0MzAwNzQmNDI5NDk2NzI5NTtnPWErKGI8PDExJjQyOTQ5NjcyOTV8Yj4+PjIxKTtiPWUrKGdeYV5jKStkWzNdKzM1NzI0NDUzMTcmNDI5NDk2NzI5NTtlPWcrKGI8PDE2JjQyOTQ5NjcyOTV8Yj4+PjE2KTtiPWMrKGVeZ15hKStkWzZdKzc2MDI5MTg5JjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMyY0Mjk0OTY3Mjk1fGI+Pj45KTtiPWErKGNeZV5nKStkWzldKzM2NTQ2MDI4MDkmNDI5NDk2NzI5NTthPWMrKGI8PDQmNDI5NDk2NzI5NXxiPj4+MjgpO2I9ZysoYV5jXmUpK2RbMTJdK1xuMzg3MzE1MTQ2MSY0Mjk0OTY3Mjk1O2c9YSsoYjw8MTEmNDI5NDk2NzI5NXxiPj4+MjEpO2I9ZSsoZ15hXmMpK2RbMTVdKzUzMDc0MjUyMCY0Mjk0OTY3Mjk1O2U9ZysoYjw8MTYmNDI5NDk2NzI5NXxiPj4+MTYpO2I9YysoZV5nXmEpK2RbMl0rMzI5OTYyODY0NSY0Mjk0OTY3Mjk1O2M9ZSsoYjw8MjMmNDI5NDk2NzI5NXxiPj4+OSk7Yj1hKyhlXihjfH5nKSkrZFswXSs0MDk2MzM2NDUyJjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzddKzExMjY4OTE0MTUmNDI5NDk2NzI5NTtnPWErKGI8PDEwJjQyOTQ5NjcyOTV8Yj4+PjIyKTtiPWUrKGFeKGd8fmMpKStkWzE0XSsyODc4NjEyMzkxJjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNSY0Mjk0OTY3Mjk1fGI+Pj4xNyk7Yj1jKyhnXihlfH5hKSkrZFs1XSs0MjM3NTMzMjQxJjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSk7Yj1hKyhlXihjfH5nKSkrZFsxMl0rMTcwMDQ4NTU3MSZcbjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzNdKzIzOTk5ODA2OTAmNDI5NDk2NzI5NTtnPWErKGI8PDEwJjQyOTQ5NjcyOTV8Yj4+PjIyKTtiPWUrKGFeKGd8fmMpKStkWzEwXSs0MjkzOTE1NzczJjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNSY0Mjk0OTY3Mjk1fGI+Pj4xNyk7Yj1jKyhnXihlfH5hKSkrZFsxXSsyMjQwMDQ0NDk3JjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSk7Yj1hKyhlXihjfH5nKSkrZFs4XSsxODczMzEzMzU5JjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzE1XSs0MjY0MzU1NTUyJjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMCY0Mjk0OTY3Mjk1fGI+Pj4yMik7Yj1lKyhhXihnfH5jKSkrZFs2XSsyNzM0NzY4OTE2JjQyOTQ5NjcyOTU7ZT1nKyhiPDwxNSY0Mjk0OTY3Mjk1fGI+Pj4xNyk7Yj1jKyhnXihlfH5hKSkrZFsxM10rMTMwOTE1MTY0OSZcbjQyOTQ5NjcyOTU7Yz1lKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSk7Yj1hKyhlXihjfH5nKSkrZFs0XSs0MTQ5NDQ0MjI2JjQyOTQ5NjcyOTU7YT1jKyhiPDw2JjQyOTQ5NjcyOTV8Yj4+PjI2KTtiPWcrKGNeKGF8fmUpKStkWzExXSszMTc0NzU2OTE3JjQyOTQ5NjcyOTU7Zz1hKyhiPDwxMCY0Mjk0OTY3Mjk1fGI+Pj4yMik7Yj1lKyhhXihnfH5jKSkrZFsyXSs3MTg3ODcyNTkmNDI5NDk2NzI5NTtlPWcrKGI8PDE1JjQyOTQ5NjcyOTV8Yj4+PjE3KTtiPWMrKGdeKGV8fmEpKStkWzldKzM5NTE0ODE3NDUmNDI5NDk2NzI5NTtmLmdbMF09Zi5nWzBdK2EmNDI5NDk2NzI5NTtmLmdbMV09Zi5nWzFdKyhlKyhiPDwyMSY0Mjk0OTY3Mjk1fGI+Pj4xMSkpJjQyOTQ5NjcyOTU7Zi5nWzJdPWYuZ1syXStlJjQyOTQ5NjcyOTU7Zi5nWzNdPWYuZ1szXStnJjQyOTQ5NjcyOTU7fVxubS5wcm90b3R5cGUudT1mdW5jdGlvbihmLGEpe3ZvaWQgMD09PWEmJihhPWYubGVuZ3RoKTtmb3IodmFyIGM9YS10aGlzLmJsb2NrU2l6ZSxkPXRoaXMuQixlPXRoaXMuaCxnPTA7ZzxhOyl7aWYoMD09ZSlmb3IoO2c8PWM7KW4odGhpcyxmLGcpLGcrPXRoaXMuYmxvY2tTaXplO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgZilmb3IoO2c8YTspe2lmKGRbZSsrXT1mLmNoYXJDb2RlQXQoZysrKSxlPT10aGlzLmJsb2NrU2l6ZSl7bih0aGlzLGQpO2U9MDticmVha319ZWxzZSBmb3IoO2c8YTspaWYoZFtlKytdPWZbZysrXSxlPT10aGlzLmJsb2NrU2l6ZSl7bih0aGlzLGQpO2U9MDticmVha319dGhpcy5oPWU7dGhpcy5vKz1hO307XG5tLnByb3RvdHlwZS52PWZ1bmN0aW9uKCl7dmFyIGY9QXJyYXkoKDU2PnRoaXMuaD90aGlzLmJsb2NrU2l6ZToyKnRoaXMuYmxvY2tTaXplKS10aGlzLmgpO2ZbMF09MTI4O2Zvcih2YXIgYT0xO2E8Zi5sZW5ndGgtODsrK2EpZlthXT0wO3ZhciBjPTgqdGhpcy5vO2ZvcihhPWYubGVuZ3RoLTg7YTxmLmxlbmd0aDsrK2EpZlthXT1jJjI1NSxjLz0yNTY7dGhpcy51KGYpO2Y9QXJyYXkoMTYpO2ZvcihhPWM9MDs0PmE7KythKWZvcih2YXIgZD0wOzMyPmQ7ZCs9OClmW2MrK109dGhpcy5nW2FdPj4+ZCYyNTU7cmV0dXJuIGZ9O2Z1bmN0aW9uIHAoZixhKXt2YXIgYz1xO3JldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoYyxmKT9jW2ZdOmNbZl09YShmKX1mdW5jdGlvbiB0KGYsYSl7dGhpcy5oPWE7Zm9yKHZhciBjPVtdLGQ9ITAsZT1mLmxlbmd0aC0xOzA8PWU7ZS0tKXt2YXIgZz1mW2VdfDA7ZCYmZz09YXx8KGNbZV09ZyxkPSExKTt9dGhpcy5nPWM7fXZhciBxPXt9O2Z1bmN0aW9uIHUoZil7cmV0dXJuIC0xMjg8PWYmJjEyOD5mP3AoZixmdW5jdGlvbihhKXtyZXR1cm4gbmV3IHQoW2F8MF0sMD5hPy0xOjApfSk6bmV3IHQoW2Z8MF0sMD5mPy0xOjApfWZ1bmN0aW9uIHYoZil7aWYoaXNOYU4oZil8fCFpc0Zpbml0ZShmKSlyZXR1cm4gdztpZigwPmYpcmV0dXJuIHgodigtZikpO2Zvcih2YXIgYT1bXSxjPTEsZD0wO2Y+PWM7ZCsrKWFbZF09Zi9jfDAsYyo9NDI5NDk2NzI5NjtyZXR1cm4gbmV3IHQoYSwwKX1cbmZ1bmN0aW9uIHkoZixhKXtpZigwPT1mLmxlbmd0aCl0aHJvdyBFcnJvcihcIm51bWJlciBmb3JtYXQgZXJyb3I6IGVtcHR5IHN0cmluZ1wiKTthPWF8fDEwO2lmKDI+YXx8MzY8YSl0aHJvdyBFcnJvcihcInJhZGl4IG91dCBvZiByYW5nZTogXCIrYSk7aWYoXCItXCI9PWYuY2hhckF0KDApKXJldHVybiB4KHkoZi5zdWJzdHJpbmcoMSksYSkpO2lmKDA8PWYuaW5kZXhPZihcIi1cIikpdGhyb3cgRXJyb3IoJ251bWJlciBmb3JtYXQgZXJyb3I6IGludGVyaW9yIFwiLVwiIGNoYXJhY3RlcicpO2Zvcih2YXIgYz12KE1hdGgucG93KGEsOCkpLGQ9dyxlPTA7ZTxmLmxlbmd0aDtlKz04KXt2YXIgZz1NYXRoLm1pbig4LGYubGVuZ3RoLWUpLGI9cGFyc2VJbnQoZi5zdWJzdHJpbmcoZSxlK2cpLGEpOzg+Zz8oZz12KE1hdGgucG93KGEsZykpLGQ9ZC5qKGcpLmFkZCh2KGIpKSk6KGQ9ZC5qKGMpLGQ9ZC5hZGQodihiKSkpO31yZXR1cm4gZH12YXIgdz11KDApLHo9dSgxKSxBPXUoMTY3NzcyMTYpO2g9dC5wcm90b3R5cGU7XG5oLm09ZnVuY3Rpb24oKXtpZihCKHRoaXMpKXJldHVybiAteCh0aGlzKS5tKCk7Zm9yKHZhciBmPTAsYT0xLGM9MDtjPHRoaXMuZy5sZW5ndGg7YysrKXt2YXIgZD10aGlzLmkoYyk7Zis9KDA8PWQ/ZDo0Mjk0OTY3Mjk2K2QpKmE7YSo9NDI5NDk2NzI5Njt9cmV0dXJuIGZ9O2gudG9TdHJpbmc9ZnVuY3Rpb24oZil7Zj1mfHwxMDtpZigyPmZ8fDM2PGYpdGhyb3cgRXJyb3IoXCJyYWRpeCBvdXQgb2YgcmFuZ2U6IFwiK2YpO2lmKEModGhpcykpcmV0dXJuIFwiMFwiO2lmKEIodGhpcykpcmV0dXJuIFwiLVwiK3godGhpcykudG9TdHJpbmcoZik7Zm9yKHZhciBhPXYoTWF0aC5wb3coZiw2KSksYz10aGlzLGQ9XCJcIjs7KXt2YXIgZT1EKGMsYSkuZztjPUYoYyxlLmooYSkpO3ZhciBnPSgoMDxjLmcubGVuZ3RoP2MuZ1swXTpjLmgpPj4+MCkudG9TdHJpbmcoZik7Yz1lO2lmKEMoYykpcmV0dXJuIGcrZDtmb3IoOzY+Zy5sZW5ndGg7KWc9XCIwXCIrZztkPWcrZDt9fTtcbmguaT1mdW5jdGlvbihmKXtyZXR1cm4gMD5mPzA6Zjx0aGlzLmcubGVuZ3RoP3RoaXMuZ1tmXTp0aGlzLmh9O2Z1bmN0aW9uIEMoZil7aWYoMCE9Zi5oKXJldHVybiAhMTtmb3IodmFyIGE9MDthPGYuZy5sZW5ndGg7YSsrKWlmKDAhPWYuZ1thXSlyZXR1cm4gITE7cmV0dXJuICEwfWZ1bmN0aW9uIEIoZil7cmV0dXJuIC0xPT1mLmh9aC5sPWZ1bmN0aW9uKGYpe2Y9Rih0aGlzLGYpO3JldHVybiBCKGYpPy0xOkMoZik/MDoxfTtmdW5jdGlvbiB4KGYpe2Zvcih2YXIgYT1mLmcubGVuZ3RoLGM9W10sZD0wO2Q8YTtkKyspY1tkXT1+Zi5nW2RdO3JldHVybiAobmV3IHQoYyx+Zi5oKSkuYWRkKHopfWguYWJzPWZ1bmN0aW9uKCl7cmV0dXJuIEIodGhpcyk/eCh0aGlzKTp0aGlzfTtcbmguYWRkPWZ1bmN0aW9uKGYpe2Zvcih2YXIgYT1NYXRoLm1heCh0aGlzLmcubGVuZ3RoLGYuZy5sZW5ndGgpLGM9W10sZD0wLGU9MDtlPD1hO2UrKyl7dmFyIGc9ZCsodGhpcy5pKGUpJjY1NTM1KSsoZi5pKGUpJjY1NTM1KSxiPShnPj4+MTYpKyh0aGlzLmkoZSk+Pj4xNikrKGYuaShlKT4+PjE2KTtkPWI+Pj4xNjtnJj02NTUzNTtiJj02NTUzNTtjW2VdPWI8PDE2fGc7fXJldHVybiBuZXcgdChjLGNbYy5sZW5ndGgtMV0mLTIxNDc0ODM2NDg/LTE6MCl9O2Z1bmN0aW9uIEYoZixhKXtyZXR1cm4gZi5hZGQoeChhKSl9XG5oLmo9ZnVuY3Rpb24oZil7aWYoQyh0aGlzKXx8QyhmKSlyZXR1cm4gdztpZihCKHRoaXMpKXJldHVybiBCKGYpP3godGhpcykuaih4KGYpKTp4KHgodGhpcykuaihmKSk7aWYoQihmKSlyZXR1cm4geCh0aGlzLmooeChmKSkpO2lmKDA+dGhpcy5sKEEpJiYwPmYubChBKSlyZXR1cm4gdih0aGlzLm0oKSpmLm0oKSk7Zm9yKHZhciBhPXRoaXMuZy5sZW5ndGgrZi5nLmxlbmd0aCxjPVtdLGQ9MDtkPDIqYTtkKyspY1tkXT0wO2ZvcihkPTA7ZDx0aGlzLmcubGVuZ3RoO2QrKylmb3IodmFyIGU9MDtlPGYuZy5sZW5ndGg7ZSsrKXt2YXIgZz10aGlzLmkoZCk+Pj4xNixiPXRoaXMuaShkKSY2NTUzNSxyPWYuaShlKT4+PjE2LEU9Zi5pKGUpJjY1NTM1O2NbMipkKzIqZV0rPWIqRTtHKGMsMipkKzIqZSk7Y1syKmQrMiplKzFdKz1nKkU7RyhjLDIqZCsyKmUrMSk7Y1syKmQrMiplKzFdKz1iKnI7RyhjLDIqZCsyKmUrMSk7Y1syKmQrMiplKzJdKz1nKnI7RyhjLDIqZCsyKmUrMik7fWZvcihkPTA7ZDxcbmE7ZCsrKWNbZF09Y1syKmQrMV08PDE2fGNbMipkXTtmb3IoZD1hO2Q8MiphO2QrKyljW2RdPTA7cmV0dXJuIG5ldyB0KGMsMCl9O2Z1bmN0aW9uIEcoZixhKXtmb3IoOyhmW2FdJjY1NTM1KSE9ZlthXTspZlthKzFdKz1mW2FdPj4+MTYsZlthXSY9NjU1MzUsYSsrO31mdW5jdGlvbiBIKGYsYSl7dGhpcy5nPWY7dGhpcy5oPWE7fVxuZnVuY3Rpb24gRChmLGEpe2lmKEMoYSkpdGhyb3cgRXJyb3IoXCJkaXZpc2lvbiBieSB6ZXJvXCIpO2lmKEMoZikpcmV0dXJuIG5ldyBIKHcsdyk7aWYoQihmKSlyZXR1cm4gYT1EKHgoZiksYSksbmV3IEgoeChhLmcpLHgoYS5oKSk7aWYoQihhKSlyZXR1cm4gYT1EKGYseChhKSksbmV3IEgoeChhLmcpLGEuaCk7aWYoMzA8Zi5nLmxlbmd0aCl7aWYoQihmKXx8QihhKSl0aHJvdyBFcnJvcihcInNsb3dEaXZpZGVfIG9ubHkgd29ya3Mgd2l0aCBwb3NpdGl2ZSBpbnRlZ2Vycy5cIik7Zm9yKHZhciBjPXosZD1hOzA+PWQubChmKTspYz1JKGMpLGQ9SShkKTt2YXIgZT1KKGMsMSksZz1KKGQsMSk7ZD1KKGQsMik7Zm9yKGM9SihjLDIpOyFDKGQpOyl7dmFyIGI9Zy5hZGQoZCk7MD49Yi5sKGYpJiYoZT1lLmFkZChjKSxnPWIpO2Q9SihkLDEpO2M9SihjLDEpO31hPUYoZixlLmooYSkpO3JldHVybiBuZXcgSChlLGEpfWZvcihlPXc7MDw9Zi5sKGEpOyl7Yz1NYXRoLm1heCgxLE1hdGguZmxvb3IoZi5tKCkvXG5hLm0oKSkpO2Q9TWF0aC5jZWlsKE1hdGgubG9nKGMpL01hdGguTE4yKTtkPTQ4Pj1kPzE6TWF0aC5wb3coMixkLTQ4KTtnPXYoYyk7Zm9yKGI9Zy5qKGEpO0IoYil8fDA8Yi5sKGYpOyljLT1kLGc9dihjKSxiPWcuaihhKTtDKGcpJiYoZz16KTtlPWUuYWRkKGcpO2Y9RihmLGIpO31yZXR1cm4gbmV3IEgoZSxmKX1oLkE9ZnVuY3Rpb24oZil7cmV0dXJuIEQodGhpcyxmKS5ofTtoLmFuZD1mdW5jdGlvbihmKXtmb3IodmFyIGE9TWF0aC5tYXgodGhpcy5nLmxlbmd0aCxmLmcubGVuZ3RoKSxjPVtdLGQ9MDtkPGE7ZCsrKWNbZF09dGhpcy5pKGQpJmYuaShkKTtyZXR1cm4gbmV3IHQoYyx0aGlzLmgmZi5oKX07aC5vcj1mdW5jdGlvbihmKXtmb3IodmFyIGE9TWF0aC5tYXgodGhpcy5nLmxlbmd0aCxmLmcubGVuZ3RoKSxjPVtdLGQ9MDtkPGE7ZCsrKWNbZF09dGhpcy5pKGQpfGYuaShkKTtyZXR1cm4gbmV3IHQoYyx0aGlzLmh8Zi5oKX07XG5oLnhvcj1mdW5jdGlvbihmKXtmb3IodmFyIGE9TWF0aC5tYXgodGhpcy5nLmxlbmd0aCxmLmcubGVuZ3RoKSxjPVtdLGQ9MDtkPGE7ZCsrKWNbZF09dGhpcy5pKGQpXmYuaShkKTtyZXR1cm4gbmV3IHQoYyx0aGlzLmheZi5oKX07ZnVuY3Rpb24gSShmKXtmb3IodmFyIGE9Zi5nLmxlbmd0aCsxLGM9W10sZD0wO2Q8YTtkKyspY1tkXT1mLmkoZCk8PDF8Zi5pKGQtMSk+Pj4zMTtyZXR1cm4gbmV3IHQoYyxmLmgpfWZ1bmN0aW9uIEooZixhKXt2YXIgYz1hPj41O2ElPTMyO2Zvcih2YXIgZD1mLmcubGVuZ3RoLWMsZT1bXSxnPTA7ZzxkO2crKyllW2ddPTA8YT9mLmkoZytjKT4+PmF8Zi5pKGcrYysxKTw8MzItYTpmLmkoZytjKTtyZXR1cm4gbmV3IHQoZSxmLmgpfW0ucHJvdG90eXBlLmRpZ2VzdD1tLnByb3RvdHlwZS52O20ucHJvdG90eXBlLnJlc2V0PW0ucHJvdG90eXBlLnM7bS5wcm90b3R5cGUudXBkYXRlPW0ucHJvdG90eXBlLnU7TWQ1ID0gYmxvb21fYmxvYl9lczIwMTguTWQ1PW07dC5wcm90b3R5cGUuYWRkPXQucHJvdG90eXBlLmFkZDt0LnByb3RvdHlwZS5tdWx0aXBseT10LnByb3RvdHlwZS5qO3QucHJvdG90eXBlLm1vZHVsbz10LnByb3RvdHlwZS5BO3QucHJvdG90eXBlLmNvbXBhcmU9dC5wcm90b3R5cGUubDt0LnByb3RvdHlwZS50b051bWJlcj10LnByb3RvdHlwZS5tO3QucHJvdG90eXBlLnRvU3RyaW5nPXQucHJvdG90eXBlLnRvU3RyaW5nO3QucHJvdG90eXBlLmdldEJpdHM9dC5wcm90b3R5cGUuaTt0LmZyb21OdW1iZXI9djt0LmZyb21TdHJpbmc9eTtJbnRlZ2VyID0gYmxvb21fYmxvYl9lczIwMTguSW50ZWdlcj10O30pLmFwcGx5KCB0eXBlb2YgY29tbW9uanNHbG9iYWwgIT09ICd1bmRlZmluZWQnID8gY29tbW9uanNHbG9iYWwgOiB0eXBlb2Ygc2VsZiAhPT0gJ3VuZGVmaW5lZCcgPyBzZWxmICA6IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnID8gd2luZG93ICA6IHt9KTtcblxuZXhwb3J0IHsgSW50ZWdlciwgTWQ1LCBibG9vbV9ibG9iX2VzMjAxOCBhcyBkZWZhdWx0IH07XG4vLyMgc291cmNlTWFwcGluZ1VSTD1ibG9vbV9ibG9iX2VzMjAxOC5qcy5tYXBcbiIsInZhciBjb21tb25qc0dsb2JhbCA9IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJyA/IGdsb2JhbFRoaXMgOiB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyA/IHdpbmRvdyA6IHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnID8gc2VsZiA6IHt9O1xuXG52YXIgd2ViY2hhbm5lbF9ibG9iX2VzMjAxOCA9IHt9O1xuXG4vKiogQGxpY2Vuc2VcbkNvcHlyaWdodCBUaGUgQ2xvc3VyZSBMaWJyYXJ5IEF1dGhvcnMuXG5TUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuKi9cblxudmFyIFhocklvO1xudmFyIEZldGNoWG1sSHR0cEZhY3Rvcnk7XG52YXIgV2ViQ2hhbm5lbDtcbnZhciBFdmVudFR5cGU7XG52YXIgRXJyb3JDb2RlO1xudmFyIFN0YXQ7XG52YXIgRXZlbnQ7XG52YXIgZ2V0U3RhdEV2ZW50VGFyZ2V0O1xudmFyIGNyZWF0ZVdlYkNoYW5uZWxUcmFuc3BvcnQ7XG4oZnVuY3Rpb24oKSB7dmFyIGgsYWE9XCJmdW5jdGlvblwiPT10eXBlb2YgT2JqZWN0LmRlZmluZVByb3BlcnRpZXM/T2JqZWN0LmRlZmluZVByb3BlcnR5OmZ1bmN0aW9uKGEsYixjKXtpZihhPT1BcnJheS5wcm90b3R5cGV8fGE9PU9iamVjdC5wcm90b3R5cGUpcmV0dXJuIGE7YVtiXT1jLnZhbHVlO3JldHVybiBhfTtmdW5jdGlvbiBiYShhKXthPVtcIm9iamVjdFwiPT10eXBlb2YgZ2xvYmFsVGhpcyYmZ2xvYmFsVGhpcyxhLFwib2JqZWN0XCI9PXR5cGVvZiB3aW5kb3cmJndpbmRvdyxcIm9iamVjdFwiPT10eXBlb2Ygc2VsZiYmc2VsZixcIm9iamVjdFwiPT10eXBlb2YgY29tbW9uanNHbG9iYWwmJmNvbW1vbmpzR2xvYmFsXTtmb3IodmFyIGI9MDtiPGEubGVuZ3RoOysrYil7dmFyIGM9YVtiXTtpZihjJiZjLk1hdGg9PU1hdGgpcmV0dXJuIGN9dGhyb3cgRXJyb3IoXCJDYW5ub3QgZmluZCBnbG9iYWwgb2JqZWN0XCIpO312YXIgY2E9YmEodGhpcyk7XG5mdW5jdGlvbiBkYShhLGIpe2lmKGIpYTp7dmFyIGM9Y2E7YT1hLnNwbGl0KFwiLlwiKTtmb3IodmFyIGQ9MDtkPGEubGVuZ3RoLTE7ZCsrKXt2YXIgZT1hW2RdO2lmKCEoZSBpbiBjKSlicmVhayBhO2M9Y1tlXTt9YT1hW2EubGVuZ3RoLTFdO2Q9Y1thXTtiPWIoZCk7YiE9ZCYmbnVsbCE9YiYmYWEoYyxhLHtjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6Yn0pO319ZnVuY3Rpb24gZWEoYSxiKXthIGluc3RhbmNlb2YgU3RyaW5nJiYoYSs9XCJcIik7dmFyIGM9MCxkPSExLGU9e25leHQ6ZnVuY3Rpb24oKXtpZighZCYmYzxhLmxlbmd0aCl7dmFyIGY9YysrO3JldHVybiB7dmFsdWU6YihmLGFbZl0pLGRvbmU6ITF9fWQ9ITA7cmV0dXJuIHtkb25lOiEwLHZhbHVlOnZvaWQgMH19fTtlW1N5bWJvbC5pdGVyYXRvcl09ZnVuY3Rpb24oKXtyZXR1cm4gZX07cmV0dXJuIGV9XG5kYShcIkFycmF5LnByb3RvdHlwZS52YWx1ZXNcIixmdW5jdGlvbihhKXtyZXR1cm4gYT9hOmZ1bmN0aW9uKCl7cmV0dXJuIGVhKHRoaXMsZnVuY3Rpb24oYixjKXtyZXR1cm4gY30pfX0pOy8qKiBAbGljZW5zZVxuXG4gQ29weXJpZ2h0IFRoZSBDbG9zdXJlIExpYnJhcnkgQXV0aG9ycy5cbiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogQXBhY2hlLTIuMFxuKi9cbnZhciBmYT1mYXx8e30saz10aGlzfHxzZWxmO2Z1bmN0aW9uIGhhKGEpe3ZhciBiPXR5cGVvZiBhO2I9XCJvYmplY3RcIiE9Yj9iOmE/QXJyYXkuaXNBcnJheShhKT9cImFycmF5XCI6YjpcIm51bGxcIjtyZXR1cm4gXCJhcnJheVwiPT1ifHxcIm9iamVjdFwiPT1iJiZcIm51bWJlclwiPT10eXBlb2YgYS5sZW5ndGh9ZnVuY3Rpb24gbihhKXt2YXIgYj10eXBlb2YgYTtyZXR1cm4gXCJvYmplY3RcIj09YiYmbnVsbCE9YXx8XCJmdW5jdGlvblwiPT1ifWZ1bmN0aW9uIGlhKGEsYixjKXtyZXR1cm4gYS5jYWxsLmFwcGx5KGEuYmluZCxhcmd1bWVudHMpfVxuZnVuY3Rpb24gamEoYSxiLGMpe2lmKCFhKXRocm93IEVycm9yKCk7aWYoMjxhcmd1bWVudHMubGVuZ3RoKXt2YXIgZD1BcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsMik7cmV0dXJuIGZ1bmN0aW9uKCl7dmFyIGU9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtBcnJheS5wcm90b3R5cGUudW5zaGlmdC5hcHBseShlLGQpO3JldHVybiBhLmFwcGx5KGIsZSl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBhLmFwcGx5KGIsYXJndW1lbnRzKX19ZnVuY3Rpb24gcChhLGIsYyl7cD1GdW5jdGlvbi5wcm90b3R5cGUuYmluZCYmLTEhPUZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLnRvU3RyaW5nKCkuaW5kZXhPZihcIm5hdGl2ZSBjb2RlXCIpP2lhOmphO3JldHVybiBwLmFwcGx5KG51bGwsYXJndW1lbnRzKX1cbmZ1bmN0aW9uIGthKGEsYil7dmFyIGM9QXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpO3JldHVybiBmdW5jdGlvbigpe3ZhciBkPWMuc2xpY2UoKTtkLnB1c2guYXBwbHkoZCxhcmd1bWVudHMpO3JldHVybiBhLmFwcGx5KHRoaXMsZCl9fWZ1bmN0aW9uIHIoYSxiKXtmdW5jdGlvbiBjKCl7fWMucHJvdG90eXBlPWIucHJvdG90eXBlO2EuYWE9Yi5wcm90b3R5cGU7YS5wcm90b3R5cGU9bmV3IGM7YS5wcm90b3R5cGUuY29uc3RydWN0b3I9YTthLlFiPWZ1bmN0aW9uKGQsZSxmKXtmb3IodmFyIGc9QXJyYXkoYXJndW1lbnRzLmxlbmd0aC0yKSxtPTI7bTxhcmd1bWVudHMubGVuZ3RoO20rKylnW20tMl09YXJndW1lbnRzW21dO3JldHVybiBiLnByb3RvdHlwZVtlXS5hcHBseShkLGcpfTt9ZnVuY3Rpb24gbGEoYSl7Y29uc3QgYj1hLmxlbmd0aDtpZigwPGIpe2NvbnN0IGM9QXJyYXkoYik7Zm9yKGxldCBkPTA7ZDxiO2QrKyljW2RdPWFbZF07cmV0dXJuIGN9cmV0dXJuIFtdfWZ1bmN0aW9uIG1hKGEsYil7Zm9yKGxldCBjPTE7Yzxhcmd1bWVudHMubGVuZ3RoO2MrKyl7Y29uc3QgZD1hcmd1bWVudHNbY107aWYoaGEoZCkpe2NvbnN0IGU9YS5sZW5ndGh8fDAsZj1kLmxlbmd0aHx8MDthLmxlbmd0aD1lK2Y7Zm9yKGxldCBnPTA7ZzxmO2crKylhW2UrZ109ZFtnXTt9ZWxzZSBhLnB1c2goZCk7fX1jbGFzcyBuYXtjb25zdHJ1Y3RvcihhLGIpe3RoaXMuaT1hO3RoaXMuaj1iO3RoaXMuaD0wO3RoaXMuZz1udWxsO31nZXQoKXtsZXQgYTswPHRoaXMuaD8odGhpcy5oLS0sYT10aGlzLmcsdGhpcy5nPWEubmV4dCxhLm5leHQ9bnVsbCk6YT10aGlzLmkoKTtyZXR1cm4gYX19ZnVuY3Rpb24gdChhKXtyZXR1cm4gL15bXFxzXFx4YTBdKiQvLnRlc3QoYSl9ZnVuY3Rpb24gdSgpe3ZhciBhPWsubmF2aWdhdG9yO3JldHVybiBhJiYoYT1hLnVzZXJBZ2VudCk/YTpcIlwifWZ1bmN0aW9uIG9hKGEpe29hW1wiIFwiXShhKTtyZXR1cm4gYX1vYVtcIiBcIl09ZnVuY3Rpb24oKXt9O3ZhciBwYT0tMSE9dSgpLmluZGV4T2YoXCJHZWNrb1wiKSYmISgtMSE9dSgpLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcIndlYmtpdFwiKSYmLTE9PXUoKS5pbmRleE9mKFwiRWRnZVwiKSkmJiEoLTEhPXUoKS5pbmRleE9mKFwiVHJpZGVudFwiKXx8LTEhPXUoKS5pbmRleE9mKFwiTVNJRVwiKSkmJi0xPT11KCkuaW5kZXhPZihcIkVkZ2VcIik7ZnVuY3Rpb24gcWEoYSxiLGMpe2Zvcihjb25zdCBkIGluIGEpYi5jYWxsKGMsYVtkXSxkLGEpO31mdW5jdGlvbiByYShhLGIpe2Zvcihjb25zdCBjIGluIGEpYi5jYWxsKHZvaWQgMCxhW2NdLGMsYSk7fWZ1bmN0aW9uIHNhKGEpe2NvbnN0IGI9e307Zm9yKGNvbnN0IGMgaW4gYSliW2NdPWFbY107cmV0dXJuIGJ9Y29uc3QgdGE9XCJjb25zdHJ1Y3RvciBoYXNPd25Qcm9wZXJ0eSBpc1Byb3RvdHlwZU9mIHByb3BlcnR5SXNFbnVtZXJhYmxlIHRvTG9jYWxlU3RyaW5nIHRvU3RyaW5nIHZhbHVlT2ZcIi5zcGxpdChcIiBcIik7ZnVuY3Rpb24gdWEoYSxiKXtsZXQgYyxkO2ZvcihsZXQgZT0xO2U8YXJndW1lbnRzLmxlbmd0aDtlKyspe2Q9YXJndW1lbnRzW2VdO2ZvcihjIGluIGQpYVtjXT1kW2NdO2ZvcihsZXQgZj0wO2Y8dGEubGVuZ3RoO2YrKyljPXRhW2ZdLE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChkLGMpJiYoYVtjXT1kW2NdKTt9fWZ1bmN0aW9uIHZhKGEpe3ZhciBiPTE7YT1hLnNwbGl0KFwiOlwiKTtjb25zdCBjPVtdO2Zvcig7MDxiJiZhLmxlbmd0aDspYy5wdXNoKGEuc2hpZnQoKSksYi0tO2EubGVuZ3RoJiZjLnB1c2goYS5qb2luKFwiOlwiKSk7cmV0dXJuIGN9ZnVuY3Rpb24gd2EoYSl7ay5zZXRUaW1lb3V0KCgpPT57dGhyb3cgYTt9LDApO31mdW5jdGlvbiB4YSgpe3ZhciBhPXphO2xldCBiPW51bGw7YS5nJiYoYj1hLmcsYS5nPWEuZy5uZXh0LGEuZ3x8KGEuaD1udWxsKSxiLm5leHQ9bnVsbCk7cmV0dXJuIGJ9Y2xhc3MgQWF7Y29uc3RydWN0b3IoKXt0aGlzLmg9dGhpcy5nPW51bGw7fWFkZChhLGIpe2NvbnN0IGM9QmEuZ2V0KCk7Yy5zZXQoYSxiKTt0aGlzLmg/dGhpcy5oLm5leHQ9Yzp0aGlzLmc9Yzt0aGlzLmg9Yzt9fXZhciBCYT1uZXcgbmEoKCk9Pm5ldyBDYSxhPT5hLnJlc2V0KCkpO2NsYXNzIENhe2NvbnN0cnVjdG9yKCl7dGhpcy5uZXh0PXRoaXMuZz10aGlzLmg9bnVsbDt9c2V0KGEsYil7dGhpcy5oPWE7dGhpcy5nPWI7dGhpcy5uZXh0PW51bGw7fXJlc2V0KCl7dGhpcy5uZXh0PXRoaXMuZz10aGlzLmg9bnVsbDt9fWxldCB4LHk9ITEsemE9bmV3IEFhLEVhPSgpPT57Y29uc3QgYT1rLlByb21pc2UucmVzb2x2ZSh2b2lkIDApO3g9KCk9PnthLnRoZW4oRGEpO307fTt2YXIgRGE9KCk9Pntmb3IodmFyIGE7YT14YSgpOyl7dHJ5e2EuaC5jYWxsKGEuZyk7fWNhdGNoKGMpe3dhKGMpO312YXIgYj1CYTtiLmooYSk7MTAwPmIuaCYmKGIuaCsrLGEubmV4dD1iLmcsYi5nPWEpO315PSExO307ZnVuY3Rpb24geigpe3RoaXMucz10aGlzLnM7dGhpcy5DPXRoaXMuQzt9ei5wcm90b3R5cGUucz0hMTt6LnByb3RvdHlwZS5tYT1mdW5jdGlvbigpe3RoaXMuc3x8KHRoaXMucz0hMCx0aGlzLk4oKSk7fTt6LnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7aWYodGhpcy5DKWZvcig7dGhpcy5DLmxlbmd0aDspdGhpcy5DLnNoaWZ0KCkoKTt9O2Z1bmN0aW9uIEEoYSxiKXt0aGlzLnR5cGU9YTt0aGlzLmc9dGhpcy50YXJnZXQ9Yjt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITE7fUEucHJvdG90eXBlLmg9ZnVuY3Rpb24oKXt0aGlzLmRlZmF1bHRQcmV2ZW50ZWQ9ITA7fTt2YXIgRmE9ZnVuY3Rpb24oKXtpZighay5hZGRFdmVudExpc3RlbmVyfHwhT2JqZWN0LmRlZmluZVByb3BlcnR5KXJldHVybiAhMTt2YXIgYT0hMSxiPU9iamVjdC5kZWZpbmVQcm9wZXJ0eSh7fSxcInBhc3NpdmVcIix7Z2V0OmZ1bmN0aW9uKCl7YT0hMDt9fSk7dHJ5e2NvbnN0IGM9KCk9Pnt9O2suYWRkRXZlbnRMaXN0ZW5lcihcInRlc3RcIixjLGIpO2sucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRlc3RcIixjLGIpO31jYXRjaChjKXt9cmV0dXJuIGF9KCk7ZnVuY3Rpb24gQyhhLGIpe0EuY2FsbCh0aGlzLGE/YS50eXBlOlwiXCIpO3RoaXMucmVsYXRlZFRhcmdldD10aGlzLmc9dGhpcy50YXJnZXQ9bnVsbDt0aGlzLmJ1dHRvbj10aGlzLnNjcmVlblk9dGhpcy5zY3JlZW5YPXRoaXMuY2xpZW50WT10aGlzLmNsaWVudFg9MDt0aGlzLmtleT1cIlwiO3RoaXMubWV0YUtleT10aGlzLnNoaWZ0S2V5PXRoaXMuYWx0S2V5PXRoaXMuY3RybEtleT0hMTt0aGlzLnN0YXRlPW51bGw7dGhpcy5wb2ludGVySWQ9MDt0aGlzLnBvaW50ZXJUeXBlPVwiXCI7dGhpcy5pPW51bGw7aWYoYSl7dmFyIGM9dGhpcy50eXBlPWEudHlwZSxkPWEuY2hhbmdlZFRvdWNoZXMmJmEuY2hhbmdlZFRvdWNoZXMubGVuZ3RoP2EuY2hhbmdlZFRvdWNoZXNbMF06bnVsbDt0aGlzLnRhcmdldD1hLnRhcmdldHx8YS5zcmNFbGVtZW50O3RoaXMuZz1iO2lmKGI9YS5yZWxhdGVkVGFyZ2V0KXtpZihwYSl7YTp7dHJ5e29hKGIubm9kZU5hbWUpO3ZhciBlPSEwO2JyZWFrIGF9Y2F0Y2goZil7fWU9XG4hMTt9ZXx8KGI9bnVsbCk7fX1lbHNlIFwibW91c2VvdmVyXCI9PWM/Yj1hLmZyb21FbGVtZW50OlwibW91c2VvdXRcIj09YyYmKGI9YS50b0VsZW1lbnQpO3RoaXMucmVsYXRlZFRhcmdldD1iO2Q/KHRoaXMuY2xpZW50WD12b2lkIDAhPT1kLmNsaWVudFg/ZC5jbGllbnRYOmQucGFnZVgsdGhpcy5jbGllbnRZPXZvaWQgMCE9PWQuY2xpZW50WT9kLmNsaWVudFk6ZC5wYWdlWSx0aGlzLnNjcmVlblg9ZC5zY3JlZW5YfHwwLHRoaXMuc2NyZWVuWT1kLnNjcmVlbll8fDApOih0aGlzLmNsaWVudFg9dm9pZCAwIT09YS5jbGllbnRYP2EuY2xpZW50WDphLnBhZ2VYLHRoaXMuY2xpZW50WT12b2lkIDAhPT1hLmNsaWVudFk/YS5jbGllbnRZOmEucGFnZVksdGhpcy5zY3JlZW5YPWEuc2NyZWVuWHx8MCx0aGlzLnNjcmVlblk9YS5zY3JlZW5ZfHwwKTt0aGlzLmJ1dHRvbj1hLmJ1dHRvbjt0aGlzLmtleT1hLmtleXx8XCJcIjt0aGlzLmN0cmxLZXk9YS5jdHJsS2V5O3RoaXMuYWx0S2V5PWEuYWx0S2V5O3RoaXMuc2hpZnRLZXk9XG5hLnNoaWZ0S2V5O3RoaXMubWV0YUtleT1hLm1ldGFLZXk7dGhpcy5wb2ludGVySWQ9YS5wb2ludGVySWR8fDA7dGhpcy5wb2ludGVyVHlwZT1cInN0cmluZ1wiPT09dHlwZW9mIGEucG9pbnRlclR5cGU/YS5wb2ludGVyVHlwZTpHYVthLnBvaW50ZXJUeXBlXXx8XCJcIjt0aGlzLnN0YXRlPWEuc3RhdGU7dGhpcy5pPWE7YS5kZWZhdWx0UHJldmVudGVkJiZDLmFhLmguY2FsbCh0aGlzKTt9fXIoQyxBKTt2YXIgR2E9ezI6XCJ0b3VjaFwiLDM6XCJwZW5cIiw0OlwibW91c2VcIn07Qy5wcm90b3R5cGUuaD1mdW5jdGlvbigpe0MuYWEuaC5jYWxsKHRoaXMpO3ZhciBhPXRoaXMuaTthLnByZXZlbnREZWZhdWx0P2EucHJldmVudERlZmF1bHQoKTphLnJldHVyblZhbHVlPSExO307dmFyIEQ9XCJjbG9zdXJlX2xpc3RlbmFibGVfXCIrKDFFNipNYXRoLnJhbmRvbSgpfDApO3ZhciBIYT0wO2Z1bmN0aW9uIElhKGEsYixjLGQsZSl7dGhpcy5saXN0ZW5lcj1hO3RoaXMucHJveHk9bnVsbDt0aGlzLnNyYz1iO3RoaXMudHlwZT1jO3RoaXMuY2FwdHVyZT0hIWQ7dGhpcy5oYT1lO3RoaXMua2V5PSsrSGE7dGhpcy5kYT10aGlzLmZhPSExO31mdW5jdGlvbiBKYShhKXthLmRhPSEwO2EubGlzdGVuZXI9bnVsbDthLnByb3h5PW51bGw7YS5zcmM9bnVsbDthLmhhPW51bGw7fWZ1bmN0aW9uIEthKGEpe3RoaXMuc3JjPWE7dGhpcy5nPXt9O3RoaXMuaD0wO31LYS5wcm90b3R5cGUuYWRkPWZ1bmN0aW9uKGEsYixjLGQsZSl7dmFyIGY9YS50b1N0cmluZygpO2E9dGhpcy5nW2ZdO2F8fChhPXRoaXMuZ1tmXT1bXSx0aGlzLmgrKyk7dmFyIGc9TGEoYSxiLGQsZSk7LTE8Zz8oYj1hW2ddLGN8fChiLmZhPSExKSk6KGI9bmV3IElhKGIsdGhpcy5zcmMsZiwhIWQsZSksYi5mYT1jLGEucHVzaChiKSk7cmV0dXJuIGJ9O2Z1bmN0aW9uIE1hKGEsYil7dmFyIGM9Yi50eXBlO2lmKGMgaW4gYS5nKXt2YXIgZD1hLmdbY10sZT1BcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKGQsYix2b2lkIDApLGY7KGY9MDw9ZSkmJkFycmF5LnByb3RvdHlwZS5zcGxpY2UuY2FsbChkLGUsMSk7ZiYmKEphKGIpLDA9PWEuZ1tjXS5sZW5ndGgmJihkZWxldGUgYS5nW2NdLGEuaC0tKSk7fX1cbmZ1bmN0aW9uIExhKGEsYixjLGQpe2Zvcih2YXIgZT0wO2U8YS5sZW5ndGg7KytlKXt2YXIgZj1hW2VdO2lmKCFmLmRhJiZmLmxpc3RlbmVyPT1iJiZmLmNhcHR1cmU9PSEhYyYmZi5oYT09ZClyZXR1cm4gZX1yZXR1cm4gLTF9dmFyIE5hPVwiY2xvc3VyZV9sbV9cIisoMUU2Kk1hdGgucmFuZG9tKCl8MCksT2E9e307ZnVuY3Rpb24gUWEoYSxiLGMsZCxlKXtpZihkJiZkLm9uY2UpcmV0dXJuIFJhKGEsYixjLGQsZSk7aWYoQXJyYXkuaXNBcnJheShiKSl7Zm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspUWEoYSxiW2ZdLGMsZCxlKTtyZXR1cm4gbnVsbH1jPVNhKGMpO3JldHVybiBhJiZhW0RdP2EuSyhiLGMsbihkKT8hIWQuY2FwdHVyZTohIWQsZSk6VGEoYSxiLGMsITEsZCxlKX1cbmZ1bmN0aW9uIFRhKGEsYixjLGQsZSxmKXtpZighYil0aHJvdyBFcnJvcihcIkludmFsaWQgZXZlbnQgdHlwZVwiKTt2YXIgZz1uKGUpPyEhZS5jYXB0dXJlOiEhZSxtPVVhKGEpO218fChhW05hXT1tPW5ldyBLYShhKSk7Yz1tLmFkZChiLGMsZCxnLGYpO2lmKGMucHJveHkpcmV0dXJuIGM7ZD1WYSgpO2MucHJveHk9ZDtkLnNyYz1hO2QubGlzdGVuZXI9YztpZihhLmFkZEV2ZW50TGlzdGVuZXIpRmF8fChlPWcpLHZvaWQgMD09PWUmJihlPSExKSxhLmFkZEV2ZW50TGlzdGVuZXIoYi50b1N0cmluZygpLGQsZSk7ZWxzZSBpZihhLmF0dGFjaEV2ZW50KWEuYXR0YWNoRXZlbnQoV2EoYi50b1N0cmluZygpKSxkKTtlbHNlIGlmKGEuYWRkTGlzdGVuZXImJmEucmVtb3ZlTGlzdGVuZXIpYS5hZGRMaXN0ZW5lcihkKTtlbHNlIHRocm93IEVycm9yKFwiYWRkRXZlbnRMaXN0ZW5lciBhbmQgYXR0YWNoRXZlbnQgYXJlIHVuYXZhaWxhYmxlLlwiKTtyZXR1cm4gY31cbmZ1bmN0aW9uIFZhKCl7ZnVuY3Rpb24gYShjKXtyZXR1cm4gYi5jYWxsKGEuc3JjLGEubGlzdGVuZXIsYyl9Y29uc3QgYj1YYTtyZXR1cm4gYX1mdW5jdGlvbiBSYShhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpe2Zvcih2YXIgZj0wO2Y8Yi5sZW5ndGg7ZisrKVJhKGEsYltmXSxjLGQsZSk7cmV0dXJuIG51bGx9Yz1TYShjKTtyZXR1cm4gYSYmYVtEXT9hLkwoYixjLG4oZCk/ISFkLmNhcHR1cmU6ISFkLGUpOlRhKGEsYixjLCEwLGQsZSl9XG5mdW5jdGlvbiBZYShhLGIsYyxkLGUpe2lmKEFycmF5LmlzQXJyYXkoYikpZm9yKHZhciBmPTA7ZjxiLmxlbmd0aDtmKyspWWEoYSxiW2ZdLGMsZCxlKTtlbHNlIChkPW4oZCk/ISFkLmNhcHR1cmU6ISFkLGM9U2EoYyksYSYmYVtEXSk/KGE9YS5pLGI9U3RyaW5nKGIpLnRvU3RyaW5nKCksYiBpbiBhLmcmJihmPWEuZ1tiXSxjPUxhKGYsYyxkLGUpLC0xPGMmJihKYShmW2NdKSxBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoZixjLDEpLDA9PWYubGVuZ3RoJiYoZGVsZXRlIGEuZ1tiXSxhLmgtLSkpKSk6YSYmKGE9VWEoYSkpJiYoYj1hLmdbYi50b1N0cmluZygpXSxhPS0xLGImJihhPUxhKGIsYyxkLGUpKSwoYz0tMTxhP2JbYV06bnVsbCkmJlphKGMpKTt9XG5mdW5jdGlvbiBaYShhKXtpZihcIm51bWJlclwiIT09dHlwZW9mIGEmJmEmJiFhLmRhKXt2YXIgYj1hLnNyYztpZihiJiZiW0RdKU1hKGIuaSxhKTtlbHNlIHt2YXIgYz1hLnR5cGUsZD1hLnByb3h5O2IucmVtb3ZlRXZlbnRMaXN0ZW5lcj9iLnJlbW92ZUV2ZW50TGlzdGVuZXIoYyxkLGEuY2FwdHVyZSk6Yi5kZXRhY2hFdmVudD9iLmRldGFjaEV2ZW50KFdhKGMpLGQpOmIuYWRkTGlzdGVuZXImJmIucmVtb3ZlTGlzdGVuZXImJmIucmVtb3ZlTGlzdGVuZXIoZCk7KGM9VWEoYikpPyhNYShjLGEpLDA9PWMuaCYmKGMuc3JjPW51bGwsYltOYV09bnVsbCkpOkphKGEpO319fWZ1bmN0aW9uIFdhKGEpe3JldHVybiBhIGluIE9hP09hW2FdOk9hW2FdPVwib25cIithfWZ1bmN0aW9uIFhhKGEsYil7aWYoYS5kYSlhPSEwO2Vsc2Uge2I9bmV3IEMoYix0aGlzKTt2YXIgYz1hLmxpc3RlbmVyLGQ9YS5oYXx8YS5zcmM7YS5mYSYmWmEoYSk7YT1jLmNhbGwoZCxiKTt9cmV0dXJuIGF9XG5mdW5jdGlvbiBVYShhKXthPWFbTmFdO3JldHVybiBhIGluc3RhbmNlb2YgS2E/YTpudWxsfXZhciAkYT1cIl9fY2xvc3VyZV9ldmVudHNfZm5fXCIrKDFFOSpNYXRoLnJhbmRvbSgpPj4+MCk7ZnVuY3Rpb24gU2EoYSl7aWYoXCJmdW5jdGlvblwiPT09dHlwZW9mIGEpcmV0dXJuIGE7YVskYV18fChhWyRhXT1mdW5jdGlvbihiKXtyZXR1cm4gYS5oYW5kbGVFdmVudChiKX0pO3JldHVybiBhWyRhXX1mdW5jdGlvbiBFKCl7ei5jYWxsKHRoaXMpO3RoaXMuaT1uZXcgS2EodGhpcyk7dGhpcy5NPXRoaXM7dGhpcy5GPW51bGw7fXIoRSx6KTtFLnByb3RvdHlwZVtEXT0hMDtFLnByb3RvdHlwZS5yZW1vdmVFdmVudExpc3RlbmVyPWZ1bmN0aW9uKGEsYixjLGQpe1lhKHRoaXMsYSxiLGMsZCk7fTtcbmZ1bmN0aW9uIEYoYSxiKXt2YXIgYyxkPWEuRjtpZihkKWZvcihjPVtdO2Q7ZD1kLkYpYy5wdXNoKGQpO2E9YS5NO2Q9Yi50eXBlfHxiO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYiliPW5ldyBBKGIsYSk7ZWxzZSBpZihiIGluc3RhbmNlb2YgQSliLnRhcmdldD1iLnRhcmdldHx8YTtlbHNlIHt2YXIgZT1iO2I9bmV3IEEoZCxhKTt1YShiLGUpO31lPSEwO2lmKGMpZm9yKHZhciBmPWMubGVuZ3RoLTE7MDw9ZjtmLS0pe3ZhciBnPWIuZz1jW2ZdO2U9YWIoZyxkLCEwLGIpJiZlO31nPWIuZz1hO2U9YWIoZyxkLCEwLGIpJiZlO2U9YWIoZyxkLCExLGIpJiZlO2lmKGMpZm9yKGY9MDtmPGMubGVuZ3RoO2YrKylnPWIuZz1jW2ZdLGU9YWIoZyxkLCExLGIpJiZlO31cbkUucHJvdG90eXBlLk49ZnVuY3Rpb24oKXtFLmFhLk4uY2FsbCh0aGlzKTtpZih0aGlzLmkpe3ZhciBhPXRoaXMuaSxjO2ZvcihjIGluIGEuZyl7Zm9yKHZhciBkPWEuZ1tjXSxlPTA7ZTxkLmxlbmd0aDtlKyspSmEoZFtlXSk7ZGVsZXRlIGEuZ1tjXTthLmgtLTt9fXRoaXMuRj1udWxsO307RS5wcm90b3R5cGUuSz1mdW5jdGlvbihhLGIsYyxkKXtyZXR1cm4gdGhpcy5pLmFkZChTdHJpbmcoYSksYiwhMSxjLGQpfTtFLnByb3RvdHlwZS5MPWZ1bmN0aW9uKGEsYixjLGQpe3JldHVybiB0aGlzLmkuYWRkKFN0cmluZyhhKSxiLCEwLGMsZCl9O1xuZnVuY3Rpb24gYWIoYSxiLGMsZCl7Yj1hLmkuZ1tTdHJpbmcoYildO2lmKCFiKXJldHVybiAhMDtiPWIuY29uY2F0KCk7Zm9yKHZhciBlPSEwLGY9MDtmPGIubGVuZ3RoOysrZil7dmFyIGc9YltmXTtpZihnJiYhZy5kYSYmZy5jYXB0dXJlPT1jKXt2YXIgbT1nLmxpc3RlbmVyLHE9Zy5oYXx8Zy5zcmM7Zy5mYSYmTWEoYS5pLGcpO2U9ITEhPT1tLmNhbGwocSxkKSYmZTt9fXJldHVybiBlJiYhZC5kZWZhdWx0UHJldmVudGVkfWZ1bmN0aW9uIGJiKGEsYixjKXtpZihcImZ1bmN0aW9uXCI9PT10eXBlb2YgYSljJiYoYT1wKGEsYykpO2Vsc2UgaWYoYSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYS5oYW5kbGVFdmVudClhPXAoYS5oYW5kbGVFdmVudCxhKTtlbHNlIHRocm93IEVycm9yKFwiSW52YWxpZCBsaXN0ZW5lciBhcmd1bWVudFwiKTtyZXR1cm4gMjE0NzQ4MzY0NzxOdW1iZXIoYik/LTE6ay5zZXRUaW1lb3V0KGEsYnx8MCl9ZnVuY3Rpb24gY2IoYSl7YS5nPWJiKCgpPT57YS5nPW51bGw7YS5pJiYoYS5pPSExLGNiKGEpKTt9LGEubCk7Y29uc3QgYj1hLmg7YS5oPW51bGw7YS5tLmFwcGx5KG51bGwsYik7fWNsYXNzIGViIGV4dGVuZHMgentjb25zdHJ1Y3RvcihhLGIpe3N1cGVyKCk7dGhpcy5tPWE7dGhpcy5sPWI7dGhpcy5oPW51bGw7dGhpcy5pPSExO3RoaXMuZz1udWxsO31qKGEpe3RoaXMuaD1hcmd1bWVudHM7dGhpcy5nP3RoaXMuaT0hMDpjYih0aGlzKTt9Tigpe3N1cGVyLk4oKTt0aGlzLmcmJihrLmNsZWFyVGltZW91dCh0aGlzLmcpLHRoaXMuZz1udWxsLHRoaXMuaT0hMSx0aGlzLmg9bnVsbCk7fX1mdW5jdGlvbiBHKGEpe3ouY2FsbCh0aGlzKTt0aGlzLmg9YTt0aGlzLmc9e307fXIoRyx6KTt2YXIgZmI9W107ZnVuY3Rpb24gZ2IoYSl7cWEoYS5nLGZ1bmN0aW9uKGIsYyl7dGhpcy5nLmhhc093blByb3BlcnR5KGMpJiZaYShiKTt9LGEpO2EuZz17fTt9Ry5wcm90b3R5cGUuTj1mdW5jdGlvbigpe0cuYWEuTi5jYWxsKHRoaXMpO2diKHRoaXMpO307Ry5wcm90b3R5cGUuaGFuZGxlRXZlbnQ9ZnVuY3Rpb24oKXt0aHJvdyBFcnJvcihcIkV2ZW50SGFuZGxlci5oYW5kbGVFdmVudCBub3QgaW1wbGVtZW50ZWRcIik7fTt2YXIgaGI9ay5KU09OLnN0cmluZ2lmeTt2YXIgaWI9ay5KU09OLnBhcnNlO3ZhciBqYj1jbGFzc3tzdHJpbmdpZnkoYSl7cmV0dXJuIGsuSlNPTi5zdHJpbmdpZnkoYSx2b2lkIDApfXBhcnNlKGEpe3JldHVybiBrLkpTT04ucGFyc2UoYSx2b2lkIDApfX07ZnVuY3Rpb24ga2IoKXt9a2IucHJvdG90eXBlLmg9bnVsbDtmdW5jdGlvbiBsYihhKXtyZXR1cm4gYS5ofHwoYS5oPWEuaSgpKX1mdW5jdGlvbiBtYigpe312YXIgSD17T1BFTjpcImFcIixrYjpcImJcIixKYTpcImNcIix3YjpcImRcIn07ZnVuY3Rpb24gbmIoKXtBLmNhbGwodGhpcyxcImRcIik7fXIobmIsQSk7ZnVuY3Rpb24gb2IoKXtBLmNhbGwodGhpcyxcImNcIik7fXIob2IsQSk7dmFyIEk9e30scGI9bnVsbDtmdW5jdGlvbiBxYigpe3JldHVybiBwYj1wYnx8bmV3IEV9SS5MYT1cInNlcnZlcnJlYWNoYWJpbGl0eVwiO2Z1bmN0aW9uIHJiKGEpe0EuY2FsbCh0aGlzLEkuTGEsYSk7fXIocmIsQSk7ZnVuY3Rpb24gSihhKXtjb25zdCBiPXFiKCk7RihiLG5ldyByYihiKSk7fUkuU1RBVF9FVkVOVD1cInN0YXRldmVudFwiO2Z1bmN0aW9uIHNiKGEsYil7QS5jYWxsKHRoaXMsSS5TVEFUX0VWRU5ULGEpO3RoaXMuc3RhdD1iO31yKHNiLEEpO2Z1bmN0aW9uIEsoYSl7Y29uc3QgYj1xYigpO0YoYixuZXcgc2IoYixhKSk7fUkuTWE9XCJ0aW1pbmdldmVudFwiO2Z1bmN0aW9uIHRiKGEsYil7QS5jYWxsKHRoaXMsSS5NYSxhKTt0aGlzLnNpemU9Yjt9cih0YixBKTtcbmZ1bmN0aW9uIHViKGEsYil7aWYoXCJmdW5jdGlvblwiIT09dHlwZW9mIGEpdGhyb3cgRXJyb3IoXCJGbiBtdXN0IG5vdCBiZSBudWxsIGFuZCBtdXN0IGJlIGEgZnVuY3Rpb25cIik7cmV0dXJuIGsuc2V0VGltZW91dChmdW5jdGlvbigpe2EoKTt9LGIpfWZ1bmN0aW9uIHZiKCl7dGhpcy5nPSEwO312Yi5wcm90b3R5cGUueGE9ZnVuY3Rpb24oKXt0aGlzLmc9ITE7fTtmdW5jdGlvbiB3YihhLGIsYyxkLGUsZil7YS5pbmZvKGZ1bmN0aW9uKCl7aWYoYS5nKWlmKGYpe3ZhciBnPVwiXCI7Zm9yKHZhciBtPWYuc3BsaXQoXCImXCIpLHE9MDtxPG0ubGVuZ3RoO3ErKyl7dmFyIGw9bVtxXS5zcGxpdChcIj1cIik7aWYoMTxsLmxlbmd0aCl7dmFyIHY9bFswXTtsPWxbMV07dmFyIHc9di5zcGxpdChcIl9cIik7Zz0yPD13Lmxlbmd0aCYmXCJ0eXBlXCI9PXdbMV0/ZysoditcIj1cIitsK1wiJlwiKTpnKyh2K1wiPXJlZGFjdGVkJlwiKTt9fX1lbHNlIGc9bnVsbDtlbHNlIGc9ZjtyZXR1cm4gXCJYTUxIVFRQIFJFUSAoXCIrZCtcIikgW2F0dGVtcHQgXCIrZStcIl06IFwiK2IrXCJcXG5cIitjK1wiXFxuXCIrZ30pO31cbmZ1bmN0aW9uIHhiKGEsYixjLGQsZSxmLGcpe2EuaW5mbyhmdW5jdGlvbigpe3JldHVybiBcIlhNTEhUVFAgUkVTUCAoXCIrZCtcIikgWyBhdHRlbXB0IFwiK2UrXCJdOiBcIitiK1wiXFxuXCIrYytcIlxcblwiK2YrXCIgXCIrZ30pO31mdW5jdGlvbiBMKGEsYixjLGQpe2EuaW5mbyhmdW5jdGlvbigpe3JldHVybiBcIlhNTEhUVFAgVEVYVCAoXCIrYitcIik6IFwiK3liKGEsYykrKGQ/XCIgXCIrZDpcIlwiKX0pO31mdW5jdGlvbiB6YihhLGIpe2EuaW5mbyhmdW5jdGlvbigpe3JldHVybiBcIlRJTUVPVVQ6IFwiK2J9KTt9dmIucHJvdG90eXBlLmluZm89ZnVuY3Rpb24oKXt9O1xuZnVuY3Rpb24geWIoYSxiKXtpZighYS5nKXJldHVybiBiO2lmKCFiKXJldHVybiBudWxsO3RyeXt2YXIgYz1KU09OLnBhcnNlKGIpO2lmKGMpZm9yKGE9MDthPGMubGVuZ3RoO2ErKylpZihBcnJheS5pc0FycmF5KGNbYV0pKXt2YXIgZD1jW2FdO2lmKCEoMj5kLmxlbmd0aCkpe3ZhciBlPWRbMV07aWYoQXJyYXkuaXNBcnJheShlKSYmISgxPmUubGVuZ3RoKSl7dmFyIGY9ZVswXTtpZihcIm5vb3BcIiE9ZiYmXCJzdG9wXCIhPWYmJlwiY2xvc2VcIiE9Zilmb3IodmFyIGc9MTtnPGUubGVuZ3RoO2crKyllW2ddPVwiXCI7fX19cmV0dXJuIGhiKGMpfWNhdGNoKG0pe3JldHVybiBifX12YXIgQWI9e05PX0VSUk9SOjAsZ2I6MSx0YjoyLHNiOjMsbmI6NCxyYjo1LHViOjYsSWE6NyxUSU1FT1VUOjgseGI6OX07dmFyIEJiPXtsYjpcImNvbXBsZXRlXCIsSGI6XCJzdWNjZXNzXCIsSmE6XCJlcnJvclwiLElhOlwiYWJvcnRcIix6YjpcInJlYWR5XCIsQWI6XCJyZWFkeXN0YXRlY2hhbmdlXCIsVElNRU9VVDpcInRpbWVvdXRcIix2YjpcImluY3JlbWVudGFsZGF0YVwiLHliOlwicHJvZ3Jlc3NcIixvYjpcImRvd25sb2FkcHJvZ3Jlc3NcIixQYjpcInVwbG9hZHByb2dyZXNzXCJ9O3ZhciBDYjtmdW5jdGlvbiBEYigpe31yKERiLGtiKTtEYi5wcm90b3R5cGUuZz1mdW5jdGlvbigpe3JldHVybiBuZXcgWE1MSHR0cFJlcXVlc3R9O0RiLnByb3RvdHlwZS5pPWZ1bmN0aW9uKCl7cmV0dXJuIHt9fTtDYj1uZXcgRGI7ZnVuY3Rpb24gTShhLGIsYyxkKXt0aGlzLmo9YTt0aGlzLmk9Yjt0aGlzLmw9Yzt0aGlzLlI9ZHx8MTt0aGlzLlU9bmV3IEcodGhpcyk7dGhpcy5JPTQ1RTM7dGhpcy5IPW51bGw7dGhpcy5vPSExO3RoaXMubT10aGlzLkE9dGhpcy52PXRoaXMuTD10aGlzLkY9dGhpcy5TPXRoaXMuQj1udWxsO3RoaXMuRD1bXTt0aGlzLmc9bnVsbDt0aGlzLkM9MDt0aGlzLnM9dGhpcy51PW51bGw7dGhpcy5YPS0xO3RoaXMuSj0hMTt0aGlzLk89MDt0aGlzLk09bnVsbDt0aGlzLlc9dGhpcy5LPXRoaXMuVD10aGlzLlA9ITE7dGhpcy5oPW5ldyBFYjt9ZnVuY3Rpb24gRWIoKXt0aGlzLmk9bnVsbDt0aGlzLmc9XCJcIjt0aGlzLmg9ITE7fXZhciBGYj17fSxHYj17fTtmdW5jdGlvbiBIYihhLGIsYyl7YS5MPTE7YS52PUliKE4oYikpO2EubT1jO2EuUD0hMDtKYihhLG51bGwpO31cbmZ1bmN0aW9uIEpiKGEsYil7YS5GPURhdGUubm93KCk7S2IoYSk7YS5BPU4oYS52KTt2YXIgYz1hLkEsZD1hLlI7QXJyYXkuaXNBcnJheShkKXx8KGQ9W1N0cmluZyhkKV0pO0xiKGMuaSxcInRcIixkKTthLkM9MDtjPWEuai5KO2EuaD1uZXcgRWI7YS5nPU1iKGEuaixjP2I6bnVsbCwhYS5tKTswPGEuTyYmKGEuTT1uZXcgZWIocChhLlksYSxhLmcpLGEuTykpO2I9YS5VO2M9YS5nO2Q9YS5jYTt2YXIgZT1cInJlYWR5c3RhdGVjaGFuZ2VcIjtBcnJheS5pc0FycmF5KGUpfHwoZSYmKGZiWzBdPWUudG9TdHJpbmcoKSksZT1mYik7Zm9yKHZhciBmPTA7ZjxlLmxlbmd0aDtmKyspe3ZhciBnPVFhKGMsZVtmXSxkfHxiLmhhbmRsZUV2ZW50LCExLGIuaHx8Yik7aWYoIWcpYnJlYWs7Yi5nW2cua2V5XT1nO31iPWEuSD9zYShhLkgpOnt9O2EubT8oYS51fHwoYS51PVwiUE9TVFwiKSxiW1wiQ29udGVudC1UeXBlXCJdPVwiYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkXCIsYS5nLmVhKGEuQSxhLnUsXG5hLm0sYikpOihhLnU9XCJHRVRcIixhLmcuZWEoYS5BLGEudSxudWxsLGIpKTtKKCk7d2IoYS5pLGEudSxhLkEsYS5sLGEuUixhLm0pO31NLnByb3RvdHlwZS5jYT1mdW5jdGlvbihhKXthPWEudGFyZ2V0O2NvbnN0IGI9dGhpcy5NO2ImJjM9PVAoYSk/Yi5qKCk6dGhpcy5ZKGEpO307XG5NLnByb3RvdHlwZS5ZPWZ1bmN0aW9uKGEpe3RyeXtpZihhPT10aGlzLmcpYTp7Y29uc3Qgdz1QKHRoaXMuZyk7dmFyIGI9dGhpcy5nLkJhKCk7Y29uc3QgTz10aGlzLmcuWigpO2lmKCEoMz53KSYmKDMhPXd8fHRoaXMuZyYmKHRoaXMuaC5ofHx0aGlzLmcub2EoKXx8TmIodGhpcy5nKSkpKXt0aGlzLkp8fDQhPXd8fDc9PWJ8fCg4PT1ifHwwPj1PP0ooMyk6SigyKSk7T2IodGhpcyk7dmFyIGM9dGhpcy5nLlooKTt0aGlzLlg9YztiOmlmKFBiKHRoaXMpKXt2YXIgZD1OYih0aGlzLmcpO2E9XCJcIjt2YXIgZT1kLmxlbmd0aCxmPTQ9PVAodGhpcy5nKTtpZighdGhpcy5oLmkpe2lmKFwidW5kZWZpbmVkXCI9PT10eXBlb2YgVGV4dERlY29kZXIpe1EodGhpcyk7UWIodGhpcyk7dmFyIGc9XCJcIjticmVhayBifXRoaXMuaC5pPW5ldyBrLlRleHREZWNvZGVyO31mb3IoYj0wO2I8ZTtiKyspdGhpcy5oLmg9ITAsYSs9dGhpcy5oLmkuZGVjb2RlKGRbYl0se3N0cmVhbTohKGYmJmI9PWUtMSl9KTtkLmxlbmd0aD1cbjA7dGhpcy5oLmcrPWE7dGhpcy5DPTA7Zz10aGlzLmguZzt9ZWxzZSBnPXRoaXMuZy5vYSgpO3RoaXMubz0yMDA9PWM7eGIodGhpcy5pLHRoaXMudSx0aGlzLkEsdGhpcy5sLHRoaXMuUix3LGMpO2lmKHRoaXMubyl7aWYodGhpcy5UJiYhdGhpcy5LKXtiOntpZih0aGlzLmcpe3ZhciBtLHE9dGhpcy5nO2lmKChtPXEuZz9xLmcuZ2V0UmVzcG9uc2VIZWFkZXIoXCJYLUhUVFAtSW5pdGlhbC1SZXNwb25zZVwiKTpudWxsKSYmIXQobSkpe3ZhciBsPW07YnJlYWsgYn19bD1udWxsO31pZihjPWwpTCh0aGlzLmksdGhpcy5sLGMsXCJJbml0aWFsIGhhbmRzaGFrZSByZXNwb25zZSB2aWEgWC1IVFRQLUluaXRpYWwtUmVzcG9uc2VcIiksdGhpcy5LPSEwLFJiKHRoaXMsYyk7ZWxzZSB7dGhpcy5vPSExO3RoaXMucz0zO0soMTIpO1EodGhpcyk7UWIodGhpcyk7YnJlYWsgYX19aWYodGhpcy5QKXtjPSEwO2xldCBCO2Zvcig7IXRoaXMuSiYmdGhpcy5DPGcubGVuZ3RoOylpZihCPVNiKHRoaXMsZyksQj09R2IpezQ9PVxudyYmKHRoaXMucz00LEsoMTQpLGM9ITEpO0wodGhpcy5pLHRoaXMubCxudWxsLFwiW0luY29tcGxldGUgUmVzcG9uc2VdXCIpO2JyZWFrfWVsc2UgaWYoQj09RmIpe3RoaXMucz00O0soMTUpO0wodGhpcy5pLHRoaXMubCxnLFwiW0ludmFsaWQgQ2h1bmtdXCIpO2M9ITE7YnJlYWt9ZWxzZSBMKHRoaXMuaSx0aGlzLmwsQixudWxsKSxSYih0aGlzLEIpO1BiKHRoaXMpJiYwIT10aGlzLkMmJih0aGlzLmguZz10aGlzLmguZy5zbGljZSh0aGlzLkMpLHRoaXMuQz0wKTs0IT13fHwwIT1nLmxlbmd0aHx8dGhpcy5oLmh8fCh0aGlzLnM9MSxLKDE2KSxjPSExKTt0aGlzLm89dGhpcy5vJiZjO2lmKCFjKUwodGhpcy5pLHRoaXMubCxnLFwiW0ludmFsaWQgQ2h1bmtlZCBSZXNwb25zZV1cIiksUSh0aGlzKSxRYih0aGlzKTtlbHNlIGlmKDA8Zy5sZW5ndGgmJiF0aGlzLlcpe3RoaXMuVz0hMDt2YXIgdj10aGlzLmo7di5nPT10aGlzJiZ2LmJhJiYhdi5NJiYodi5qLmluZm8oXCJHcmVhdCwgbm8gYnVmZmVyaW5nIHByb3h5IGRldGVjdGVkLiBCeXRlcyByZWNlaXZlZDogXCIrXG5nLmxlbmd0aCksVGIodiksdi5NPSEwLEsoMTEpKTt9fWVsc2UgTCh0aGlzLmksdGhpcy5sLGcsbnVsbCksUmIodGhpcyxnKTs0PT13JiZRKHRoaXMpO3RoaXMubyYmIXRoaXMuSiYmKDQ9PXc/VWIodGhpcy5qLHRoaXMpOih0aGlzLm89ITEsS2IodGhpcykpKTt9ZWxzZSBWYih0aGlzLmcpLDQwMD09YyYmMDxnLmluZGV4T2YoXCJVbmtub3duIFNJRFwiKT8odGhpcy5zPTMsSygxMikpOih0aGlzLnM9MCxLKDEzKSksUSh0aGlzKSxRYih0aGlzKTt9fX1jYXRjaCh3KXt9ZmluYWxseXt9fTtmdW5jdGlvbiBQYihhKXtyZXR1cm4gYS5nP1wiR0VUXCI9PWEudSYmMiE9YS5MJiZhLmouQ2E6ITF9XG5mdW5jdGlvbiBTYihhLGIpe3ZhciBjPWEuQyxkPWIuaW5kZXhPZihcIlxcblwiLGMpO2lmKC0xPT1kKXJldHVybiBHYjtjPU51bWJlcihiLnN1YnN0cmluZyhjLGQpKTtpZihpc05hTihjKSlyZXR1cm4gRmI7ZCs9MTtpZihkK2M+Yi5sZW5ndGgpcmV0dXJuIEdiO2I9Yi5zbGljZShkLGQrYyk7YS5DPWQrYztyZXR1cm4gYn1NLnByb3RvdHlwZS5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLko9ITA7USh0aGlzKTt9O2Z1bmN0aW9uIEtiKGEpe2EuUz1EYXRlLm5vdygpK2EuSTtXYihhLGEuSSk7fWZ1bmN0aW9uIFdiKGEsYil7aWYobnVsbCE9YS5CKXRocm93IEVycm9yKFwiV2F0Y2hEb2cgdGltZXIgbm90IG51bGxcIik7YS5CPXViKHAoYS5iYSxhKSxiKTt9ZnVuY3Rpb24gT2IoYSl7YS5CJiYoay5jbGVhclRpbWVvdXQoYS5CKSxhLkI9bnVsbCk7fVxuTS5wcm90b3R5cGUuYmE9ZnVuY3Rpb24oKXt0aGlzLkI9bnVsbDtjb25zdCBhPURhdGUubm93KCk7MDw9YS10aGlzLlM/KHpiKHRoaXMuaSx0aGlzLkEpLDIhPXRoaXMuTCYmKEooKSxLKDE3KSksUSh0aGlzKSx0aGlzLnM9MixRYih0aGlzKSk6V2IodGhpcyx0aGlzLlMtYSk7fTtmdW5jdGlvbiBRYihhKXswPT1hLmouR3x8YS5KfHxVYihhLmosYSk7fWZ1bmN0aW9uIFEoYSl7T2IoYSk7dmFyIGI9YS5NO2ImJlwiZnVuY3Rpb25cIj09dHlwZW9mIGIubWEmJmIubWEoKTthLk09bnVsbDtnYihhLlUpO2EuZyYmKGI9YS5nLGEuZz1udWxsLGIuYWJvcnQoKSxiLm1hKCkpO31cbmZ1bmN0aW9uIFJiKGEsYil7dHJ5e3ZhciBjPWEuajtpZigwIT1jLkcmJihjLmc9PWF8fFhiKGMuaCxhKSkpaWYoIWEuSyYmWGIoYy5oLGEpJiYzPT1jLkcpe3RyeXt2YXIgZD1jLkRhLmcucGFyc2UoYik7fWNhdGNoKGwpe2Q9bnVsbDt9aWYoQXJyYXkuaXNBcnJheShkKSYmMz09ZC5sZW5ndGgpe3ZhciBlPWQ7aWYoMD09ZVswXSlhOntpZighYy51KXtpZihjLmcpaWYoYy5nLkYrM0UzPGEuRilZYihjKSxaYihjKTtlbHNlIGJyZWFrIGE7JGIoYyk7SygxOCk7fX1lbHNlIGMuemE9ZVsxXSwwPGMuemEtYy5UJiYzNzUwMD5lWzJdJiZjLkYmJjA9PWMudiYmIWMuQyYmKGMuQz11YihwKGMuWmEsYyksNkUzKSk7aWYoMT49YWMoYy5oKSYmYy5jYSl7dHJ5e2MuY2EoKTt9Y2F0Y2gobCl7fWMuY2E9dm9pZCAwO319ZWxzZSBSKGMsMTEpO31lbHNlIGlmKChhLkt8fGMuZz09YSkmJlliKGMpLCF0KGIpKWZvcihlPWMuRGEuZy5wYXJzZShiKSxiPTA7YjxlLmxlbmd0aDtiKyspe2xldCBsPWVbYl07Yy5UPVxubFswXTtsPWxbMV07aWYoMj09Yy5HKWlmKFwiY1wiPT1sWzBdKXtjLks9bFsxXTtjLmlhPWxbMl07Y29uc3Qgdj1sWzNdO251bGwhPXYmJihjLmxhPXYsYy5qLmluZm8oXCJWRVI9XCIrYy5sYSkpO2NvbnN0IHc9bFs0XTtudWxsIT13JiYoYy5BYT13LGMuai5pbmZvKFwiU1ZFUj1cIitjLkFhKSk7Y29uc3QgTz1sWzVdO251bGwhPU8mJlwibnVtYmVyXCI9PT10eXBlb2YgTyYmMDxPJiYoZD0xLjUqTyxjLkw9ZCxjLmouaW5mbyhcImJhY2tDaGFubmVsUmVxdWVzdFRpbWVvdXRNc189XCIrZCkpO2Q9Yztjb25zdCBCPWEuZztpZihCKXtjb25zdCB5YT1CLmc/Qi5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1DbGllbnQtV2lyZS1Qcm90b2NvbFwiKTpudWxsO2lmKHlhKXt2YXIgZj1kLmg7Zi5nfHwtMT09eWEuaW5kZXhPZihcInNwZHlcIikmJi0xPT15YS5pbmRleE9mKFwicXVpY1wiKSYmLTE9PXlhLmluZGV4T2YoXCJoMlwiKXx8KGYuaj1mLmwsZi5nPW5ldyBTZXQsZi5oJiYoYmMoZixmLmgpLGYuaD1udWxsKSk7fWlmKGQuRCl7Y29uc3QgZGI9XG5CLmc/Qi5nLmdldFJlc3BvbnNlSGVhZGVyKFwiWC1IVFRQLVNlc3Npb24tSWRcIik6bnVsbDtkYiYmKGQueWE9ZGIsUyhkLkksZC5ELGRiKSk7fX1jLkc9MztjLmwmJmMubC51YSgpO2MuYmEmJihjLlI9RGF0ZS5ub3coKS1hLkYsYy5qLmluZm8oXCJIYW5kc2hha2UgUlRUOiBcIitjLlIrXCJtc1wiKSk7ZD1jO3ZhciBnPWE7ZC5xYT1jYyhkLGQuSj9kLmlhOm51bGwsZC5XKTtpZihnLkspe2RjKGQuaCxnKTt2YXIgbT1nLHE9ZC5MO3EmJihtLkk9cSk7bS5CJiYoT2IobSksS2IobSkpO2QuZz1nO31lbHNlIGVjKGQpOzA8Yy5pLmxlbmd0aCYmZmMoYyk7fWVsc2UgXCJzdG9wXCIhPWxbMF0mJlwiY2xvc2VcIiE9bFswXXx8UihjLDcpO2Vsc2UgMz09Yy5HJiYoXCJzdG9wXCI9PWxbMF18fFwiY2xvc2VcIj09bFswXT9cInN0b3BcIj09bFswXT9SKGMsNyk6Z2MoYyk6XCJub29wXCIhPWxbMF0mJmMubCYmYy5sLnRhKGwpLGMudj0wKTt9Sig0KTt9Y2F0Y2gobCl7fX12YXIgaGM9Y2xhc3N7Y29uc3RydWN0b3IoYSxiKXt0aGlzLmc9YTt0aGlzLm1hcD1iO319O2Z1bmN0aW9uIGljKGEpe3RoaXMubD1hfHwxMDtrLlBlcmZvcm1hbmNlTmF2aWdhdGlvblRpbWluZz8oYT1rLnBlcmZvcm1hbmNlLmdldEVudHJpZXNCeVR5cGUoXCJuYXZpZ2F0aW9uXCIpLGE9MDxhLmxlbmd0aCYmKFwiaHFcIj09YVswXS5uZXh0SG9wUHJvdG9jb2x8fFwiaDJcIj09YVswXS5uZXh0SG9wUHJvdG9jb2wpKTphPSEhKGsuY2hyb21lJiZrLmNocm9tZS5sb2FkVGltZXMmJmsuY2hyb21lLmxvYWRUaW1lcygpJiZrLmNocm9tZS5sb2FkVGltZXMoKS53YXNGZXRjaGVkVmlhU3BkeSk7dGhpcy5qPWE/dGhpcy5sOjE7dGhpcy5nPW51bGw7MTx0aGlzLmomJih0aGlzLmc9bmV3IFNldCk7dGhpcy5oPW51bGw7dGhpcy5pPVtdO31mdW5jdGlvbiBqYyhhKXtyZXR1cm4gYS5oPyEwOmEuZz9hLmcuc2l6ZT49YS5qOiExfWZ1bmN0aW9uIGFjKGEpe3JldHVybiBhLmg/MTphLmc/YS5nLnNpemU6MH1mdW5jdGlvbiBYYihhLGIpe3JldHVybiBhLmg/YS5oPT1iOmEuZz9hLmcuaGFzKGIpOiExfVxuZnVuY3Rpb24gYmMoYSxiKXthLmc/YS5nLmFkZChiKTphLmg9Yjt9ZnVuY3Rpb24gZGMoYSxiKXthLmgmJmEuaD09Yj9hLmg9bnVsbDphLmcmJmEuZy5oYXMoYikmJmEuZy5kZWxldGUoYik7fWljLnByb3RvdHlwZS5jYW5jZWw9ZnVuY3Rpb24oKXt0aGlzLmk9a2ModGhpcyk7aWYodGhpcy5oKXRoaXMuaC5jYW5jZWwoKSx0aGlzLmg9bnVsbDtlbHNlIGlmKHRoaXMuZyYmMCE9PXRoaXMuZy5zaXplKXtmb3IoY29uc3QgYSBvZiB0aGlzLmcudmFsdWVzKCkpYS5jYW5jZWwoKTt0aGlzLmcuY2xlYXIoKTt9fTtmdW5jdGlvbiBrYyhhKXtpZihudWxsIT1hLmgpcmV0dXJuIGEuaS5jb25jYXQoYS5oLkQpO2lmKG51bGwhPWEuZyYmMCE9PWEuZy5zaXplKXtsZXQgYj1hLmk7Zm9yKGNvbnN0IGMgb2YgYS5nLnZhbHVlcygpKWI9Yi5jb25jYXQoYy5EKTtyZXR1cm4gYn1yZXR1cm4gbGEoYS5pKX1mdW5jdGlvbiBsYyhhKXtpZihhLlYmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuVilyZXR1cm4gYS5WKCk7aWYoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBNYXAmJmEgaW5zdGFuY2VvZiBNYXB8fFwidW5kZWZpbmVkXCIhPT10eXBlb2YgU2V0JiZhIGluc3RhbmNlb2YgU2V0KXJldHVybiBBcnJheS5mcm9tKGEudmFsdWVzKCkpO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlyZXR1cm4gYS5zcGxpdChcIlwiKTtpZihoYShhKSl7Zm9yKHZhciBiPVtdLGM9YS5sZW5ndGgsZD0wO2Q8YztkKyspYi5wdXNoKGFbZF0pO3JldHVybiBifWI9W107Yz0wO2ZvcihkIGluIGEpYltjKytdPWFbZF07cmV0dXJuIGJ9XG5mdW5jdGlvbiBtYyhhKXtpZihhLm5hJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhLm5hKXJldHVybiBhLm5hKCk7aWYoIWEuVnx8XCJmdW5jdGlvblwiIT10eXBlb2YgYS5WKXtpZihcInVuZGVmaW5lZFwiIT09dHlwZW9mIE1hcCYmYSBpbnN0YW5jZW9mIE1hcClyZXR1cm4gQXJyYXkuZnJvbShhLmtleXMoKSk7aWYoIShcInVuZGVmaW5lZFwiIT09dHlwZW9mIFNldCYmYSBpbnN0YW5jZW9mIFNldCkpe2lmKGhhKGEpfHxcInN0cmluZ1wiPT09dHlwZW9mIGEpe3ZhciBiPVtdO2E9YS5sZW5ndGg7Zm9yKHZhciBjPTA7YzxhO2MrKyliLnB1c2goYyk7cmV0dXJuIGJ9Yj1bXTtjPTA7Zm9yKGNvbnN0IGQgaW4gYSliW2MrK109ZDtyZXR1cm4gYn19fVxuZnVuY3Rpb24gbmMoYSxiKXtpZihhLmZvckVhY2gmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGEuZm9yRWFjaClhLmZvckVhY2goYix2b2lkIDApO2Vsc2UgaWYoaGEoYSl8fFwic3RyaW5nXCI9PT10eXBlb2YgYSlBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGEsYix2b2lkIDApO2Vsc2UgZm9yKHZhciBjPW1jKGEpLGQ9bGMoYSksZT1kLmxlbmd0aCxmPTA7ZjxlO2YrKyliLmNhbGwodm9pZCAwLGRbZl0sYyYmY1tmXSxhKTt9dmFyIG9jPVJlZ0V4cChcIl4oPzooW146Lz8jLl0rKTopPyg/Oi8vKD86KFteXFxcXFxcXFwvPyNdKilAKT8oW15cXFxcXFxcXC8/I10qPykoPzo6KFswLTldKykpPyg/PVtcXFxcXFxcXC8/I118JCkpPyhbXj8jXSspPyg/OlxcXFw/KFteI10qKSk/KD86IyhbXFxcXHNcXFxcU10qKSk/JFwiKTtmdW5jdGlvbiBwYyhhLGIpe2lmKGEpe2E9YS5zcGxpdChcIiZcIik7Zm9yKHZhciBjPTA7YzxhLmxlbmd0aDtjKyspe3ZhciBkPWFbY10uaW5kZXhPZihcIj1cIiksZT1udWxsO2lmKDA8PWQpe3ZhciBmPWFbY10uc3Vic3RyaW5nKDAsZCk7ZT1hW2NdLnN1YnN0cmluZyhkKzEpO31lbHNlIGY9YVtjXTtiKGYsZT9kZWNvZGVVUklDb21wb25lbnQoZS5yZXBsYWNlKC9cXCsvZyxcIiBcIikpOlwiXCIpO319fWZ1bmN0aW9uIFQoYSl7dGhpcy5nPXRoaXMubz10aGlzLmo9XCJcIjt0aGlzLnM9bnVsbDt0aGlzLm09dGhpcy5sPVwiXCI7dGhpcy5oPSExO2lmKGEgaW5zdGFuY2VvZiBUKXt0aGlzLmg9YS5oO3FjKHRoaXMsYS5qKTt0aGlzLm89YS5vO3RoaXMuZz1hLmc7cmModGhpcyxhLnMpO3RoaXMubD1hLmw7dmFyIGI9YS5pO3ZhciBjPW5ldyBzYztjLmk9Yi5pO2IuZyYmKGMuZz1uZXcgTWFwKGIuZyksYy5oPWIuaCk7dGModGhpcyxjKTt0aGlzLm09YS5tO31lbHNlIGEmJihiPVN0cmluZyhhKS5tYXRjaChvYykpPyh0aGlzLmg9ITEscWModGhpcyxiWzFdfHxcIlwiLCEwKSx0aGlzLm89dWMoYlsyXXx8XCJcIiksdGhpcy5nPXVjKGJbM118fFwiXCIsITApLHJjKHRoaXMsYls0XSksdGhpcy5sPXVjKGJbNV18fFwiXCIsITApLHRjKHRoaXMsYls2XXx8XCJcIiwhMCksdGhpcy5tPXVjKGJbN118fFwiXCIpKToodGhpcy5oPSExLHRoaXMuaT1uZXcgc2MobnVsbCx0aGlzLmgpKTt9XG5ULnByb3RvdHlwZS50b1N0cmluZz1mdW5jdGlvbigpe3ZhciBhPVtdLGI9dGhpcy5qO2ImJmEucHVzaCh2YyhiLHdjLCEwKSxcIjpcIik7dmFyIGM9dGhpcy5nO2lmKGN8fFwiZmlsZVwiPT1iKWEucHVzaChcIi8vXCIpLChiPXRoaXMubykmJmEucHVzaCh2YyhiLHdjLCEwKSxcIkBcIiksYS5wdXNoKGVuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoYykpLnJlcGxhY2UoLyUyNShbMC05YS1mQS1GXXsyfSkvZyxcIiUkMVwiKSksYz10aGlzLnMsbnVsbCE9YyYmYS5wdXNoKFwiOlwiLFN0cmluZyhjKSk7aWYoYz10aGlzLmwpdGhpcy5nJiZcIi9cIiE9Yy5jaGFyQXQoMCkmJmEucHVzaChcIi9cIiksYS5wdXNoKHZjKGMsXCIvXCI9PWMuY2hhckF0KDApP3hjOnljLCEwKSk7KGM9dGhpcy5pLnRvU3RyaW5nKCkpJiZhLnB1c2goXCI/XCIsYyk7KGM9dGhpcy5tKSYmYS5wdXNoKFwiI1wiLHZjKGMsemMpKTtyZXR1cm4gYS5qb2luKFwiXCIpfTtmdW5jdGlvbiBOKGEpe3JldHVybiBuZXcgVChhKX1cbmZ1bmN0aW9uIHFjKGEsYixjKXthLmo9Yz91YyhiLCEwKTpiO2EuaiYmKGEuaj1hLmoucmVwbGFjZSgvOiQvLFwiXCIpKTt9ZnVuY3Rpb24gcmMoYSxiKXtpZihiKXtiPU51bWJlcihiKTtpZihpc05hTihiKXx8MD5iKXRocm93IEVycm9yKFwiQmFkIHBvcnQgbnVtYmVyIFwiK2IpO2Eucz1iO31lbHNlIGEucz1udWxsO31mdW5jdGlvbiB0YyhhLGIsYyl7YiBpbnN0YW5jZW9mIHNjPyhhLmk9YixBYyhhLmksYS5oKSk6KGN8fChiPXZjKGIsQmMpKSxhLmk9bmV3IHNjKGIsYS5oKSk7fWZ1bmN0aW9uIFMoYSxiLGMpe2EuaS5zZXQoYixjKTt9ZnVuY3Rpb24gSWIoYSl7UyhhLFwienhcIixNYXRoLmZsb29yKDIxNDc0ODM2NDgqTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoMzYpK01hdGguYWJzKE1hdGguZmxvb3IoMjE0NzQ4MzY0OCpNYXRoLnJhbmRvbSgpKV5EYXRlLm5vdygpKS50b1N0cmluZygzNikpO3JldHVybiBhfVxuZnVuY3Rpb24gdWMoYSxiKXtyZXR1cm4gYT9iP2RlY29kZVVSSShhLnJlcGxhY2UoLyUyNS9nLFwiJTI1MjVcIikpOmRlY29kZVVSSUNvbXBvbmVudChhKTpcIlwifWZ1bmN0aW9uIHZjKGEsYixjKXtyZXR1cm4gXCJzdHJpbmdcIj09PXR5cGVvZiBhPyhhPWVuY29kZVVSSShhKS5yZXBsYWNlKGIsQ2MpLGMmJihhPWEucmVwbGFjZSgvJTI1KFswLTlhLWZBLUZdezJ9KS9nLFwiJSQxXCIpKSxhKTpudWxsfWZ1bmN0aW9uIENjKGEpe2E9YS5jaGFyQ29kZUF0KDApO3JldHVybiBcIiVcIisoYT4+NCYxNSkudG9TdHJpbmcoMTYpKyhhJjE1KS50b1N0cmluZygxNil9dmFyIHdjPS9bI1xcL1xcP0BdL2cseWM9L1sjXFw/Ol0vZyx4Yz0vWyNcXD9dL2csQmM9L1sjXFw/QF0vZyx6Yz0vIy9nO2Z1bmN0aW9uIHNjKGEsYil7dGhpcy5oPXRoaXMuZz1udWxsO3RoaXMuaT1hfHxudWxsO3RoaXMuaj0hIWI7fVxuZnVuY3Rpb24gVShhKXthLmd8fChhLmc9bmV3IE1hcCxhLmg9MCxhLmkmJnBjKGEuaSxmdW5jdGlvbihiLGMpe2EuYWRkKGRlY29kZVVSSUNvbXBvbmVudChiLnJlcGxhY2UoL1xcKy9nLFwiIFwiKSksYyk7fSkpO31oPXNjLnByb3RvdHlwZTtoLmFkZD1mdW5jdGlvbihhLGIpe1UodGhpcyk7dGhpcy5pPW51bGw7YT1WKHRoaXMsYSk7dmFyIGM9dGhpcy5nLmdldChhKTtjfHx0aGlzLmcuc2V0KGEsYz1bXSk7Yy5wdXNoKGIpO3RoaXMuaCs9MTtyZXR1cm4gdGhpc307ZnVuY3Rpb24gRGMoYSxiKXtVKGEpO2I9VihhLGIpO2EuZy5oYXMoYikmJihhLmk9bnVsbCxhLmgtPWEuZy5nZXQoYikubGVuZ3RoLGEuZy5kZWxldGUoYikpO31mdW5jdGlvbiBFYyhhLGIpe1UoYSk7Yj1WKGEsYik7cmV0dXJuIGEuZy5oYXMoYil9XG5oLmZvckVhY2g9ZnVuY3Rpb24oYSxiKXtVKHRoaXMpO3RoaXMuZy5mb3JFYWNoKGZ1bmN0aW9uKGMsZCl7Yy5mb3JFYWNoKGZ1bmN0aW9uKGUpe2EuY2FsbChiLGUsZCx0aGlzKTt9LHRoaXMpO30sdGhpcyk7fTtoLm5hPWZ1bmN0aW9uKCl7VSh0aGlzKTtjb25zdCBhPUFycmF5LmZyb20odGhpcy5nLnZhbHVlcygpKSxiPUFycmF5LmZyb20odGhpcy5nLmtleXMoKSksYz1bXTtmb3IobGV0IGQ9MDtkPGIubGVuZ3RoO2QrKyl7Y29uc3QgZT1hW2RdO2ZvcihsZXQgZj0wO2Y8ZS5sZW5ndGg7ZisrKWMucHVzaChiW2RdKTt9cmV0dXJuIGN9O2guVj1mdW5jdGlvbihhKXtVKHRoaXMpO2xldCBiPVtdO2lmKFwic3RyaW5nXCI9PT10eXBlb2YgYSlFYyh0aGlzLGEpJiYoYj1iLmNvbmNhdCh0aGlzLmcuZ2V0KFYodGhpcyxhKSkpKTtlbHNlIHthPUFycmF5LmZyb20odGhpcy5nLnZhbHVlcygpKTtmb3IobGV0IGM9MDtjPGEubGVuZ3RoO2MrKyliPWIuY29uY2F0KGFbY10pO31yZXR1cm4gYn07XG5oLnNldD1mdW5jdGlvbihhLGIpe1UodGhpcyk7dGhpcy5pPW51bGw7YT1WKHRoaXMsYSk7RWModGhpcyxhKSYmKHRoaXMuaC09dGhpcy5nLmdldChhKS5sZW5ndGgpO3RoaXMuZy5zZXQoYSxbYl0pO3RoaXMuaCs9MTtyZXR1cm4gdGhpc307aC5nZXQ9ZnVuY3Rpb24oYSxiKXtpZighYSlyZXR1cm4gYjthPXRoaXMuVihhKTtyZXR1cm4gMDxhLmxlbmd0aD9TdHJpbmcoYVswXSk6Yn07ZnVuY3Rpb24gTGIoYSxiLGMpe0RjKGEsYik7MDxjLmxlbmd0aCYmKGEuaT1udWxsLGEuZy5zZXQoVihhLGIpLGxhKGMpKSxhLmgrPWMubGVuZ3RoKTt9XG5oLnRvU3RyaW5nPWZ1bmN0aW9uKCl7aWYodGhpcy5pKXJldHVybiB0aGlzLmk7aWYoIXRoaXMuZylyZXR1cm4gXCJcIjtjb25zdCBhPVtdLGI9QXJyYXkuZnJvbSh0aGlzLmcua2V5cygpKTtmb3IodmFyIGM9MDtjPGIubGVuZ3RoO2MrKyl7dmFyIGQ9YltjXTtjb25zdCBmPWVuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoZCkpLGc9dGhpcy5WKGQpO2ZvcihkPTA7ZDxnLmxlbmd0aDtkKyspe3ZhciBlPWY7XCJcIiE9PWdbZF0mJihlKz1cIj1cIitlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKGdbZF0pKSk7YS5wdXNoKGUpO319cmV0dXJuIHRoaXMuaT1hLmpvaW4oXCImXCIpfTtmdW5jdGlvbiBWKGEsYil7Yj1TdHJpbmcoYik7YS5qJiYoYj1iLnRvTG93ZXJDYXNlKCkpO3JldHVybiBifVxuZnVuY3Rpb24gQWMoYSxiKXtiJiYhYS5qJiYoVShhKSxhLmk9bnVsbCxhLmcuZm9yRWFjaChmdW5jdGlvbihjLGQpe3ZhciBlPWQudG9Mb3dlckNhc2UoKTtkIT1lJiYoRGModGhpcyxkKSxMYih0aGlzLGUsYykpO30sYSkpO2Euaj1iO31mdW5jdGlvbiBGYyhhLGIpe2NvbnN0IGM9bmV3IHZiO2lmKGsuSW1hZ2Upe2NvbnN0IGQ9bmV3IEltYWdlO2Qub25sb2FkPWthKFcsYyxcIlRlc3RMb2FkSW1hZ2U6IGxvYWRlZFwiLCEwLGIsZCk7ZC5vbmVycm9yPWthKFcsYyxcIlRlc3RMb2FkSW1hZ2U6IGVycm9yXCIsITEsYixkKTtkLm9uYWJvcnQ9a2EoVyxjLFwiVGVzdExvYWRJbWFnZTogYWJvcnRcIiwhMSxiLGQpO2Qub250aW1lb3V0PWthKFcsYyxcIlRlc3RMb2FkSW1hZ2U6IHRpbWVvdXRcIiwhMSxiLGQpO2suc2V0VGltZW91dChmdW5jdGlvbigpe2lmKGQub250aW1lb3V0KWQub250aW1lb3V0KCk7fSwxRTQpO2Quc3JjPWE7fWVsc2UgYighMSk7fVxuZnVuY3Rpb24gR2MoYSxiKXtjb25zdCBjPW5ldyB2YixkPW5ldyBBYm9ydENvbnRyb2xsZXIsZT1zZXRUaW1lb3V0KCgpPT57ZC5hYm9ydCgpO1coYyxcIlRlc3RQaW5nU2VydmVyOiB0aW1lb3V0XCIsITEsYik7fSwxRTQpO2ZldGNoKGEse3NpZ25hbDpkLnNpZ25hbH0pLnRoZW4oZj0+e2NsZWFyVGltZW91dChlKTtmLm9rP1coYyxcIlRlc3RQaW5nU2VydmVyOiBva1wiLCEwLGIpOlcoYyxcIlRlc3RQaW5nU2VydmVyOiBzZXJ2ZXIgZXJyb3JcIiwhMSxiKTt9KS5jYXRjaCgoKT0+e2NsZWFyVGltZW91dChlKTtXKGMsXCJUZXN0UGluZ1NlcnZlcjogZXJyb3JcIiwhMSxiKTt9KTt9ZnVuY3Rpb24gVyhhLGIsYyxkLGUpe3RyeXtlJiYoZS5vbmxvYWQ9bnVsbCxlLm9uZXJyb3I9bnVsbCxlLm9uYWJvcnQ9bnVsbCxlLm9udGltZW91dD1udWxsKSxkKGMpO31jYXRjaChmKXt9fWZ1bmN0aW9uIEhjKCl7dGhpcy5nPW5ldyBqYjt9ZnVuY3Rpb24gSWMoYSxiLGMpe2NvbnN0IGQ9Y3x8XCJcIjt0cnl7bmMoYSxmdW5jdGlvbihlLGYpe2xldCBnPWU7bihlKSYmKGc9aGIoZSkpO2IucHVzaChkK2YrXCI9XCIrZW5jb2RlVVJJQ29tcG9uZW50KGcpKTt9KTt9Y2F0Y2goZSl7dGhyb3cgYi5wdXNoKGQrXCJ0eXBlPVwiK2VuY29kZVVSSUNvbXBvbmVudChcIl9iYWRtYXBcIikpLGU7fX1mdW5jdGlvbiBKYyhhKXt0aGlzLmw9YS5VYnx8bnVsbDt0aGlzLmo9YS5lYnx8ITE7fXIoSmMsa2IpO0pjLnByb3RvdHlwZS5nPWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBLYyh0aGlzLmwsdGhpcy5qKX07SmMucHJvdG90eXBlLmk9ZnVuY3Rpb24oYSl7cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIGF9fSh7fSk7ZnVuY3Rpb24gS2MoYSxiKXtFLmNhbGwodGhpcyk7dGhpcy5EPWE7dGhpcy5vPWI7dGhpcy5tPXZvaWQgMDt0aGlzLnN0YXR1cz10aGlzLnJlYWR5U3RhdGU9MDt0aGlzLnJlc3BvbnNlVHlwZT10aGlzLnJlc3BvbnNlVGV4dD10aGlzLnJlc3BvbnNlPXRoaXMuc3RhdHVzVGV4dD1cIlwiO3RoaXMub25yZWFkeXN0YXRlY2hhbmdlPW51bGw7dGhpcy51PW5ldyBIZWFkZXJzO3RoaXMuaD1udWxsO3RoaXMuQj1cIkdFVFwiO3RoaXMuQT1cIlwiO3RoaXMuZz0hMTt0aGlzLnY9dGhpcy5qPXRoaXMubD1udWxsO31yKEtjLEUpO2g9S2MucHJvdG90eXBlO1xuaC5vcGVuPWZ1bmN0aW9uKGEsYil7aWYoMCE9dGhpcy5yZWFkeVN0YXRlKXRocm93IHRoaXMuYWJvcnQoKSxFcnJvcihcIkVycm9yIHJlb3BlbmluZyBhIGNvbm5lY3Rpb25cIik7dGhpcy5CPWE7dGhpcy5BPWI7dGhpcy5yZWFkeVN0YXRlPTE7TGModGhpcyk7fTtoLnNlbmQ9ZnVuY3Rpb24oYSl7aWYoMSE9dGhpcy5yZWFkeVN0YXRlKXRocm93IHRoaXMuYWJvcnQoKSxFcnJvcihcIm5lZWQgdG8gY2FsbCBvcGVuKCkgZmlyc3QuIFwiKTt0aGlzLmc9ITA7Y29uc3QgYj17aGVhZGVyczp0aGlzLnUsbWV0aG9kOnRoaXMuQixjcmVkZW50aWFsczp0aGlzLm0sY2FjaGU6dm9pZCAwfTthJiYoYi5ib2R5PWEpOyh0aGlzLkR8fGspLmZldGNoKG5ldyBSZXF1ZXN0KHRoaXMuQSxiKSkudGhlbih0aGlzLlNhLmJpbmQodGhpcyksdGhpcy5nYS5iaW5kKHRoaXMpKTt9O1xuaC5hYm9ydD1mdW5jdGlvbigpe3RoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQ9XCJcIjt0aGlzLnU9bmV3IEhlYWRlcnM7dGhpcy5zdGF0dXM9MDt0aGlzLmomJnRoaXMuai5jYW5jZWwoXCJSZXF1ZXN0IHdhcyBhYm9ydGVkLlwiKS5jYXRjaCgoKT0+e30pOzE8PXRoaXMucmVhZHlTdGF0ZSYmdGhpcy5nJiY0IT10aGlzLnJlYWR5U3RhdGUmJih0aGlzLmc9ITEsTWModGhpcykpO3RoaXMucmVhZHlTdGF0ZT0wO307XG5oLlNhPWZ1bmN0aW9uKGEpe2lmKHRoaXMuZyYmKHRoaXMubD1hLHRoaXMuaHx8KHRoaXMuc3RhdHVzPXRoaXMubC5zdGF0dXMsdGhpcy5zdGF0dXNUZXh0PXRoaXMubC5zdGF0dXNUZXh0LHRoaXMuaD1hLmhlYWRlcnMsdGhpcy5yZWFkeVN0YXRlPTIsTGModGhpcykpLHRoaXMuZyYmKHRoaXMucmVhZHlTdGF0ZT0zLExjKHRoaXMpLHRoaXMuZykpKWlmKFwiYXJyYXlidWZmZXJcIj09PXRoaXMucmVzcG9uc2VUeXBlKWEuYXJyYXlCdWZmZXIoKS50aGVuKHRoaXMuUWEuYmluZCh0aGlzKSx0aGlzLmdhLmJpbmQodGhpcykpO2Vsc2UgaWYoXCJ1bmRlZmluZWRcIiE9PXR5cGVvZiBrLlJlYWRhYmxlU3RyZWFtJiZcImJvZHlcImluIGEpe3RoaXMuaj1hLmJvZHkuZ2V0UmVhZGVyKCk7aWYodGhpcy5vKXtpZih0aGlzLnJlc3BvbnNlVHlwZSl0aHJvdyBFcnJvcigncmVzcG9uc2VUeXBlIG11c3QgYmUgZW1wdHkgZm9yIFwic3RyZWFtQmluYXJ5Q2h1bmtzXCIgbW9kZSByZXNwb25zZXMuJyk7dGhpcy5yZXNwb25zZT1cbltdO31lbHNlIHRoaXMucmVzcG9uc2U9dGhpcy5yZXNwb25zZVRleHQ9XCJcIix0aGlzLnY9bmV3IFRleHREZWNvZGVyO05jKHRoaXMpO31lbHNlIGEudGV4dCgpLnRoZW4odGhpcy5SYS5iaW5kKHRoaXMpLHRoaXMuZ2EuYmluZCh0aGlzKSk7fTtmdW5jdGlvbiBOYyhhKXthLmoucmVhZCgpLnRoZW4oYS5QYS5iaW5kKGEpKS5jYXRjaChhLmdhLmJpbmQoYSkpO31oLlBhPWZ1bmN0aW9uKGEpe2lmKHRoaXMuZyl7aWYodGhpcy5vJiZhLnZhbHVlKXRoaXMucmVzcG9uc2UucHVzaChhLnZhbHVlKTtlbHNlIGlmKCF0aGlzLm8pe3ZhciBiPWEudmFsdWU/YS52YWx1ZTpuZXcgVWludDhBcnJheSgwKTtpZihiPXRoaXMudi5kZWNvZGUoYix7c3RyZWFtOiFhLmRvbmV9KSl0aGlzLnJlc3BvbnNlPXRoaXMucmVzcG9uc2VUZXh0Kz1iO31hLmRvbmU/TWModGhpcyk6TGModGhpcyk7Mz09dGhpcy5yZWFkeVN0YXRlJiZOYyh0aGlzKTt9fTtcbmguUmE9ZnVuY3Rpb24oYSl7dGhpcy5nJiYodGhpcy5yZXNwb25zZT10aGlzLnJlc3BvbnNlVGV4dD1hLE1jKHRoaXMpKTt9O2guUWE9ZnVuY3Rpb24oYSl7dGhpcy5nJiYodGhpcy5yZXNwb25zZT1hLE1jKHRoaXMpKTt9O2guZ2E9ZnVuY3Rpb24oKXt0aGlzLmcmJk1jKHRoaXMpO307ZnVuY3Rpb24gTWMoYSl7YS5yZWFkeVN0YXRlPTQ7YS5sPW51bGw7YS5qPW51bGw7YS52PW51bGw7TGMoYSk7fWguc2V0UmVxdWVzdEhlYWRlcj1mdW5jdGlvbihhLGIpe3RoaXMudS5hcHBlbmQoYSxiKTt9O2guZ2V0UmVzcG9uc2VIZWFkZXI9ZnVuY3Rpb24oYSl7cmV0dXJuIHRoaXMuaD90aGlzLmguZ2V0KGEudG9Mb3dlckNhc2UoKSl8fFwiXCI6XCJcIn07XG5oLmdldEFsbFJlc3BvbnNlSGVhZGVycz1mdW5jdGlvbigpe2lmKCF0aGlzLmgpcmV0dXJuIFwiXCI7Y29uc3QgYT1bXSxiPXRoaXMuaC5lbnRyaWVzKCk7Zm9yKHZhciBjPWIubmV4dCgpOyFjLmRvbmU7KWM9Yy52YWx1ZSxhLnB1c2goY1swXStcIjogXCIrY1sxXSksYz1iLm5leHQoKTtyZXR1cm4gYS5qb2luKFwiXFxyXFxuXCIpfTtmdW5jdGlvbiBMYyhhKXthLm9ucmVhZHlzdGF0ZWNoYW5nZSYmYS5vbnJlYWR5c3RhdGVjaGFuZ2UuY2FsbChhKTt9T2JqZWN0LmRlZmluZVByb3BlcnR5KEtjLnByb3RvdHlwZSxcIndpdGhDcmVkZW50aWFsc1wiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gXCJpbmNsdWRlXCI9PT10aGlzLm19LHNldDpmdW5jdGlvbihhKXt0aGlzLm09YT9cImluY2x1ZGVcIjpcInNhbWUtb3JpZ2luXCI7fX0pO2Z1bmN0aW9uIE9jKGEpe2xldCBiPVwiXCI7cWEoYSxmdW5jdGlvbihjLGQpe2IrPWQ7Yis9XCI6XCI7Yis9YztiKz1cIlxcclxcblwiO30pO3JldHVybiBifWZ1bmN0aW9uIFBjKGEsYixjKXthOntmb3IoZCBpbiBjKXt2YXIgZD0hMTticmVhayBhfWQ9ITA7fWR8fChjPU9jKGMpLFwic3RyaW5nXCI9PT10eXBlb2YgYT8obnVsbCE9YyYmZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhjKSkpOlMoYSxiLGMpKTt9ZnVuY3Rpb24gWChhKXtFLmNhbGwodGhpcyk7dGhpcy5oZWFkZXJzPW5ldyBNYXA7dGhpcy5vPWF8fG51bGw7dGhpcy5oPSExO3RoaXMudj10aGlzLmc9bnVsbDt0aGlzLkQ9XCJcIjt0aGlzLm09MDt0aGlzLmw9XCJcIjt0aGlzLmo9dGhpcy5CPXRoaXMudT10aGlzLkE9ITE7dGhpcy5JPW51bGw7dGhpcy5IPVwiXCI7dGhpcy5KPSExO31yKFgsRSk7dmFyIFFjPS9eaHR0cHM/JC9pLFJjPVtcIlBPU1RcIixcIlBVVFwiXTtoPVgucHJvdG90eXBlO2guSGE9ZnVuY3Rpb24oYSl7dGhpcy5KPWE7fTtcbmguZWE9ZnVuY3Rpb24oYSxiLGMsZCl7aWYodGhpcy5nKXRocm93IEVycm9yKFwiW2dvb2cubmV0LlhocklvXSBPYmplY3QgaXMgYWN0aXZlIHdpdGggYW5vdGhlciByZXF1ZXN0PVwiK3RoaXMuRCtcIjsgbmV3VXJpPVwiK2EpO2I9Yj9iLnRvVXBwZXJDYXNlKCk6XCJHRVRcIjt0aGlzLkQ9YTt0aGlzLmw9XCJcIjt0aGlzLm09MDt0aGlzLkE9ITE7dGhpcy5oPSEwO3RoaXMuZz10aGlzLm8/dGhpcy5vLmcoKTpDYi5nKCk7dGhpcy52PXRoaXMubz9sYih0aGlzLm8pOmxiKENiKTt0aGlzLmcub25yZWFkeXN0YXRlY2hhbmdlPXAodGhpcy5FYSx0aGlzKTt0cnl7dGhpcy5CPSEwLHRoaXMuZy5vcGVuKGIsU3RyaW5nKGEpLCEwKSx0aGlzLkI9ITE7fWNhdGNoKGYpe1NjKHRoaXMsZik7cmV0dXJufWE9Y3x8XCJcIjtjPW5ldyBNYXAodGhpcy5oZWFkZXJzKTtpZihkKWlmKE9iamVjdC5nZXRQcm90b3R5cGVPZihkKT09PU9iamVjdC5wcm90b3R5cGUpZm9yKHZhciBlIGluIGQpYy5zZXQoZSxkW2VdKTtlbHNlIGlmKFwiZnVuY3Rpb25cIj09PVxudHlwZW9mIGQua2V5cyYmXCJmdW5jdGlvblwiPT09dHlwZW9mIGQuZ2V0KWZvcihjb25zdCBmIG9mIGQua2V5cygpKWMuc2V0KGYsZC5nZXQoZikpO2Vsc2UgdGhyb3cgRXJyb3IoXCJVbmtub3duIGlucHV0IHR5cGUgZm9yIG9wdF9oZWFkZXJzOiBcIitTdHJpbmcoZCkpO2Q9QXJyYXkuZnJvbShjLmtleXMoKSkuZmluZChmPT5cImNvbnRlbnQtdHlwZVwiPT1mLnRvTG93ZXJDYXNlKCkpO2U9ay5Gb3JtRGF0YSYmYSBpbnN0YW5jZW9mIGsuRm9ybURhdGE7ISgwPD1BcnJheS5wcm90b3R5cGUuaW5kZXhPZi5jYWxsKFJjLGIsdm9pZCAwKSl8fGR8fGV8fGMuc2V0KFwiQ29udGVudC1UeXBlXCIsXCJhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQ7Y2hhcnNldD11dGYtOFwiKTtmb3IoY29uc3QgW2YsZ11vZiBjKXRoaXMuZy5zZXRSZXF1ZXN0SGVhZGVyKGYsZyk7dGhpcy5IJiYodGhpcy5nLnJlc3BvbnNlVHlwZT10aGlzLkgpO1wid2l0aENyZWRlbnRpYWxzXCJpbiB0aGlzLmcmJnRoaXMuZy53aXRoQ3JlZGVudGlhbHMhPT1cbnRoaXMuSiYmKHRoaXMuZy53aXRoQ3JlZGVudGlhbHM9dGhpcy5KKTt0cnl7VGModGhpcyksdGhpcy51PSEwLHRoaXMuZy5zZW5kKGEpLHRoaXMudT0hMTt9Y2F0Y2goZil7U2ModGhpcyxmKTt9fTtmdW5jdGlvbiBTYyhhLGIpe2EuaD0hMTthLmcmJihhLmo9ITAsYS5nLmFib3J0KCksYS5qPSExKTthLmw9YjthLm09NTtVYyhhKTtWYyhhKTt9ZnVuY3Rpb24gVWMoYSl7YS5BfHwoYS5BPSEwLEYoYSxcImNvbXBsZXRlXCIpLEYoYSxcImVycm9yXCIpKTt9aC5hYm9ydD1mdW5jdGlvbihhKXt0aGlzLmcmJnRoaXMuaCYmKHRoaXMuaD0hMSx0aGlzLmo9ITAsdGhpcy5nLmFib3J0KCksdGhpcy5qPSExLHRoaXMubT1hfHw3LEYodGhpcyxcImNvbXBsZXRlXCIpLEYodGhpcyxcImFib3J0XCIpLFZjKHRoaXMpKTt9O2guTj1mdW5jdGlvbigpe3RoaXMuZyYmKHRoaXMuaCYmKHRoaXMuaD0hMSx0aGlzLmo9ITAsdGhpcy5nLmFib3J0KCksdGhpcy5qPSExKSxWYyh0aGlzLCEwKSk7WC5hYS5OLmNhbGwodGhpcyk7fTtcbmguRWE9ZnVuY3Rpb24oKXt0aGlzLnN8fCh0aGlzLkJ8fHRoaXMudXx8dGhpcy5qP1djKHRoaXMpOnRoaXMuYmIoKSk7fTtoLmJiPWZ1bmN0aW9uKCl7V2ModGhpcyk7fTtcbmZ1bmN0aW9uIFdjKGEpe2lmKGEuaCYmXCJ1bmRlZmluZWRcIiE9dHlwZW9mIGZhJiYoIWEudlsxXXx8NCE9UChhKXx8MiE9YS5aKCkpKWlmKGEudSYmND09UChhKSliYihhLkVhLDAsYSk7ZWxzZSBpZihGKGEsXCJyZWFkeXN0YXRlY2hhbmdlXCIpLDQ9PVAoYSkpe2EuaD0hMTt0cnl7Y29uc3QgZz1hLlooKTthOnN3aXRjaChnKXtjYXNlIDIwMDpjYXNlIDIwMTpjYXNlIDIwMjpjYXNlIDIwNDpjYXNlIDIwNjpjYXNlIDMwNDpjYXNlIDEyMjM6dmFyIGI9ITA7YnJlYWsgYTtkZWZhdWx0OmI9ITE7fXZhciBjO2lmKCEoYz1iKSl7dmFyIGQ7aWYoZD0wPT09Zyl7dmFyIGU9U3RyaW5nKGEuRCkubWF0Y2gob2MpWzFdfHxudWxsOyFlJiZrLnNlbGYmJmsuc2VsZi5sb2NhdGlvbiYmKGU9ay5zZWxmLmxvY2F0aW9uLnByb3RvY29sLnNsaWNlKDAsLTEpKTtkPSFRYy50ZXN0KGU/ZS50b0xvd2VyQ2FzZSgpOlwiXCIpO31jPWQ7fWlmKGMpRihhLFwiY29tcGxldGVcIiksRihhLFwic3VjY2Vzc1wiKTtlbHNlIHthLm09XG42O3RyeXt2YXIgZj0yPFAoYSk/YS5nLnN0YXR1c1RleHQ6XCJcIjt9Y2F0Y2gobSl7Zj1cIlwiO31hLmw9ZitcIiBbXCIrYS5aKCkrXCJdXCI7VWMoYSk7fX1maW5hbGx5e1ZjKGEpO319fWZ1bmN0aW9uIFZjKGEsYil7aWYoYS5nKXtUYyhhKTtjb25zdCBjPWEuZyxkPWEudlswXT8oKT0+e306bnVsbDthLmc9bnVsbDthLnY9bnVsbDtifHxGKGEsXCJyZWFkeVwiKTt0cnl7Yy5vbnJlYWR5c3RhdGVjaGFuZ2U9ZDt9Y2F0Y2goZSl7fX19ZnVuY3Rpb24gVGMoYSl7YS5JJiYoay5jbGVhclRpbWVvdXQoYS5JKSxhLkk9bnVsbCk7fWguaXNBY3RpdmU9ZnVuY3Rpb24oKXtyZXR1cm4gISF0aGlzLmd9O2Z1bmN0aW9uIFAoYSl7cmV0dXJuIGEuZz9hLmcucmVhZHlTdGF0ZTowfWguWj1mdW5jdGlvbigpe3RyeXtyZXR1cm4gMjxQKHRoaXMpP3RoaXMuZy5zdGF0dXM6LTF9Y2F0Y2goYSl7cmV0dXJuIC0xfX07aC5vYT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gdGhpcy5nP3RoaXMuZy5yZXNwb25zZVRleHQ6XCJcIn1jYXRjaChhKXtyZXR1cm4gXCJcIn19O1xuaC5PYT1mdW5jdGlvbihhKXtpZih0aGlzLmcpe3ZhciBiPXRoaXMuZy5yZXNwb25zZVRleHQ7YSYmMD09Yi5pbmRleE9mKGEpJiYoYj1iLnN1YnN0cmluZyhhLmxlbmd0aCkpO3JldHVybiBpYihiKX19O2Z1bmN0aW9uIE5iKGEpe3RyeXtpZighYS5nKXJldHVybiBudWxsO2lmKFwicmVzcG9uc2VcImluIGEuZylyZXR1cm4gYS5nLnJlc3BvbnNlO3N3aXRjaChhLkgpe2Nhc2UgXCJcIjpjYXNlIFwidGV4dFwiOnJldHVybiBhLmcucmVzcG9uc2VUZXh0O2Nhc2UgXCJhcnJheWJ1ZmZlclwiOmlmKFwibW96UmVzcG9uc2VBcnJheUJ1ZmZlclwiaW4gYS5nKXJldHVybiBhLmcubW96UmVzcG9uc2VBcnJheUJ1ZmZlcn1yZXR1cm4gbnVsbH1jYXRjaChiKXtyZXR1cm4gbnVsbH19XG5mdW5jdGlvbiBWYihhKXtjb25zdCBiPXt9O2E9KGEuZyYmMjw9UChhKT9hLmcuZ2V0QWxsUmVzcG9uc2VIZWFkZXJzKCl8fFwiXCI6XCJcIikuc3BsaXQoXCJcXHJcXG5cIik7Zm9yKGxldCBkPTA7ZDxhLmxlbmd0aDtkKyspe2lmKHQoYVtkXSkpY29udGludWU7dmFyIGM9dmEoYVtkXSk7Y29uc3QgZT1jWzBdO2M9Y1sxXTtpZihcInN0cmluZ1wiIT09dHlwZW9mIGMpY29udGludWU7Yz1jLnRyaW0oKTtjb25zdCBmPWJbZV18fFtdO2JbZV09ZjtmLnB1c2goYyk7fXJhKGIsZnVuY3Rpb24oZCl7cmV0dXJuIGQuam9pbihcIiwgXCIpfSk7fWguQmE9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5tfTtoLkthPWZ1bmN0aW9uKCl7cmV0dXJuIFwic3RyaW5nXCI9PT10eXBlb2YgdGhpcy5sP3RoaXMubDpTdHJpbmcodGhpcy5sKX07ZnVuY3Rpb24gWGMoYSxiLGMpe3JldHVybiBjJiZjLmludGVybmFsQ2hhbm5lbFBhcmFtcz9jLmludGVybmFsQ2hhbm5lbFBhcmFtc1thXXx8YjpifVxuZnVuY3Rpb24gWWMoYSl7dGhpcy5BYT0wO3RoaXMuaT1bXTt0aGlzLmo9bmV3IHZiO3RoaXMuaWE9dGhpcy5xYT10aGlzLkk9dGhpcy5XPXRoaXMuZz10aGlzLnlhPXRoaXMuRD10aGlzLkg9dGhpcy5tPXRoaXMuUz10aGlzLm89bnVsbDt0aGlzLllhPXRoaXMuVT0wO3RoaXMuVmE9WGMoXCJmYWlsRmFzdFwiLCExLGEpO3RoaXMuRj10aGlzLkM9dGhpcy51PXRoaXMucz10aGlzLmw9bnVsbDt0aGlzLlg9ITA7dGhpcy56YT10aGlzLlQ9LTE7dGhpcy5ZPXRoaXMudj10aGlzLkI9MDt0aGlzLlRhPVhjKFwiYmFzZVJldHJ5RGVsYXlNc1wiLDVFMyxhKTt0aGlzLmNiPVhjKFwicmV0cnlEZWxheVNlZWRNc1wiLDFFNCxhKTt0aGlzLldhPVhjKFwiZm9yd2FyZENoYW5uZWxNYXhSZXRyaWVzXCIsMixhKTt0aGlzLndhPVhjKFwiZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zXCIsMkU0LGEpO3RoaXMucGE9YSYmYS54bWxIdHRwRmFjdG9yeXx8dm9pZCAwO3RoaXMuWGE9YSYmYS5UYnx8dm9pZCAwO3RoaXMuQ2E9XG5hJiZhLnVzZUZldGNoU3RyZWFtc3x8ITE7dGhpcy5MPXZvaWQgMDt0aGlzLko9YSYmYS5zdXBwb3J0c0Nyb3NzRG9tYWluWGhyfHwhMTt0aGlzLks9XCJcIjt0aGlzLmg9bmV3IGljKGEmJmEuY29uY3VycmVudFJlcXVlc3RMaW1pdCk7dGhpcy5EYT1uZXcgSGM7dGhpcy5QPWEmJmEuZmFzdEhhbmRzaGFrZXx8ITE7dGhpcy5PPWEmJmEuZW5jb2RlSW5pdE1lc3NhZ2VIZWFkZXJzfHwhMTt0aGlzLlAmJnRoaXMuTyYmKHRoaXMuTz0hMSk7dGhpcy5VYT1hJiZhLlJifHwhMTthJiZhLnhhJiZ0aGlzLmoueGEoKTthJiZhLmZvcmNlTG9uZ1BvbGxpbmcmJih0aGlzLlg9ITEpO3RoaXMuYmE9IXRoaXMuUCYmdGhpcy5YJiZhJiZhLmRldGVjdEJ1ZmZlcmluZ1Byb3h5fHwhMTt0aGlzLmphPXZvaWQgMDthJiZhLmxvbmdQb2xsaW5nVGltZW91dCYmMDxhLmxvbmdQb2xsaW5nVGltZW91dCYmKHRoaXMuamE9YS5sb25nUG9sbGluZ1RpbWVvdXQpO3RoaXMuY2E9dm9pZCAwO3RoaXMuUj0wO3RoaXMuTT1cbiExO3RoaXMua2E9dGhpcy5BPW51bGw7fWg9WWMucHJvdG90eXBlO2gubGE9ODtoLkc9MTtoLmNvbm5lY3Q9ZnVuY3Rpb24oYSxiLGMsZCl7SygwKTt0aGlzLlc9YTt0aGlzLkg9Ynx8e307YyYmdm9pZCAwIT09ZCYmKHRoaXMuSC5PU0lEPWMsdGhpcy5ILk9BSUQ9ZCk7dGhpcy5GPXRoaXMuWDt0aGlzLkk9Y2ModGhpcyxudWxsLHRoaXMuVyk7ZmModGhpcyk7fTtcbmZ1bmN0aW9uIGdjKGEpe1pjKGEpO2lmKDM9PWEuRyl7dmFyIGI9YS5VKyssYz1OKGEuSSk7UyhjLFwiU0lEXCIsYS5LKTtTKGMsXCJSSURcIixiKTtTKGMsXCJUWVBFXCIsXCJ0ZXJtaW5hdGVcIik7JGMoYSxjKTtiPW5ldyBNKGEsYS5qLGIpO2IuTD0yO2Iudj1JYihOKGMpKTtjPSExO2lmKGsubmF2aWdhdG9yJiZrLm5hdmlnYXRvci5zZW5kQmVhY29uKXRyeXtjPWsubmF2aWdhdG9yLnNlbmRCZWFjb24oYi52LnRvU3RyaW5nKCksXCJcIik7fWNhdGNoKGQpe30hYyYmay5JbWFnZSYmKChuZXcgSW1hZ2UpLnNyYz1iLnYsYz0hMCk7Y3x8KGIuZz1NYihiLmosbnVsbCksYi5nLmVhKGIudikpO2IuRj1EYXRlLm5vdygpO0tiKGIpO31hZChhKTt9ZnVuY3Rpb24gWmIoYSl7YS5nJiYoVGIoYSksYS5nLmNhbmNlbCgpLGEuZz1udWxsKTt9XG5mdW5jdGlvbiBaYyhhKXtaYihhKTthLnUmJihrLmNsZWFyVGltZW91dChhLnUpLGEudT1udWxsKTtZYihhKTthLmguY2FuY2VsKCk7YS5zJiYoXCJudW1iZXJcIj09PXR5cGVvZiBhLnMmJmsuY2xlYXJUaW1lb3V0KGEucyksYS5zPW51bGwpO31mdW5jdGlvbiBmYyhhKXtpZighamMoYS5oKSYmIWEucyl7YS5zPSEwO3ZhciBiPWEuR2E7eHx8RWEoKTt5fHwoeCgpLHk9ITApO3phLmFkZChiLGEpO2EuQj0wO319ZnVuY3Rpb24gYmQoYSxiKXtpZihhYyhhLmgpPj1hLmguai0oYS5zPzE6MCkpcmV0dXJuICExO2lmKGEucylyZXR1cm4gYS5pPWIuRC5jb25jYXQoYS5pKSwhMDtpZigxPT1hLkd8fDI9PWEuR3x8YS5CPj0oYS5WYT8wOmEuV2EpKXJldHVybiAhMTthLnM9dWIocChhLkdhLGEsYiksY2QoYSxhLkIpKTthLkIrKztyZXR1cm4gITB9XG5oLkdhPWZ1bmN0aW9uKGEpe2lmKHRoaXMucylpZih0aGlzLnM9bnVsbCwxPT10aGlzLkcpe2lmKCFhKXt0aGlzLlU9TWF0aC5mbG9vcigxRTUqTWF0aC5yYW5kb20oKSk7YT10aGlzLlUrKztjb25zdCBlPW5ldyBNKHRoaXMsdGhpcy5qLGEpO2xldCBmPXRoaXMubzt0aGlzLlMmJihmPyhmPXNhKGYpLHVhKGYsdGhpcy5TKSk6Zj10aGlzLlMpO251bGwhPT10aGlzLm18fHRoaXMuT3x8KGUuSD1mLGY9bnVsbCk7aWYodGhpcy5QKWE6e3ZhciBiPTA7Zm9yKHZhciBjPTA7Yzx0aGlzLmkubGVuZ3RoO2MrKyl7Yjp7dmFyIGQ9dGhpcy5pW2NdO2lmKFwiX19kYXRhX19cImluIGQubWFwJiYoZD1kLm1hcC5fX2RhdGFfXyxcInN0cmluZ1wiPT09dHlwZW9mIGQpKXtkPWQubGVuZ3RoO2JyZWFrIGJ9ZD12b2lkIDA7fWlmKHZvaWQgMD09PWQpYnJlYWs7Yis9ZDtpZig0MDk2PGIpe2I9YzticmVhayBhfWlmKDQwOTY9PT1ifHxjPT09dGhpcy5pLmxlbmd0aC0xKXtiPWMrMTticmVhayBhfX1iPTFFMzt9ZWxzZSBiPVxuMUUzO2I9ZGQodGhpcyxlLGIpO2M9Tih0aGlzLkkpO1MoYyxcIlJJRFwiLGEpO1MoYyxcIkNWRVJcIiwyMik7dGhpcy5EJiZTKGMsXCJYLUhUVFAtU2Vzc2lvbi1JZFwiLHRoaXMuRCk7JGModGhpcyxjKTtmJiYodGhpcy5PP2I9XCJoZWFkZXJzPVwiK2VuY29kZVVSSUNvbXBvbmVudChTdHJpbmcoT2MoZikpKStcIiZcIitiOnRoaXMubSYmUGMoYyx0aGlzLm0sZikpO2JjKHRoaXMuaCxlKTt0aGlzLlVhJiZTKGMsXCJUWVBFXCIsXCJpbml0XCIpO3RoaXMuUD8oUyhjLFwiJHJlcVwiLGIpLFMoYyxcIlNJRFwiLFwibnVsbFwiKSxlLlQ9ITAsSGIoZSxjLG51bGwpKTpIYihlLGMsYik7dGhpcy5HPTI7fX1lbHNlIDM9PXRoaXMuRyYmKGE/ZWQodGhpcyxhKTowPT10aGlzLmkubGVuZ3RofHxqYyh0aGlzLmgpfHxlZCh0aGlzKSk7fTtcbmZ1bmN0aW9uIGVkKGEsYil7dmFyIGM7Yj9jPWIubDpjPWEuVSsrO2NvbnN0IGQ9TihhLkkpO1MoZCxcIlNJRFwiLGEuSyk7UyhkLFwiUklEXCIsYyk7UyhkLFwiQUlEXCIsYS5UKTskYyhhLGQpO2EubSYmYS5vJiZQYyhkLGEubSxhLm8pO2M9bmV3IE0oYSxhLmosYyxhLkIrMSk7bnVsbD09PWEubSYmKGMuSD1hLm8pO2ImJihhLmk9Yi5ELmNvbmNhdChhLmkpKTtiPWRkKGEsYywxRTMpO2MuST1NYXRoLnJvdW5kKC41KmEud2EpK01hdGgucm91bmQoLjUqYS53YSpNYXRoLnJhbmRvbSgpKTtiYyhhLmgsYyk7SGIoYyxkLGIpO31mdW5jdGlvbiAkYyhhLGIpe2EuSCYmcWEoYS5ILGZ1bmN0aW9uKGMsZCl7UyhiLGQsYyk7fSk7YS5sJiZuYyh7fSxmdW5jdGlvbihjLGQpe1MoYixkLGMpO30pO31cbmZ1bmN0aW9uIGRkKGEsYixjKXtjPU1hdGgubWluKGEuaS5sZW5ndGgsYyk7dmFyIGQ9YS5sP3AoYS5sLk5hLGEubCxhKTpudWxsO2E6e3ZhciBlPWEuaTtsZXQgZj0tMTtmb3IoOzspe2NvbnN0IGc9W1wiY291bnQ9XCIrY107LTE9PWY/MDxjPyhmPWVbMF0uZyxnLnB1c2goXCJvZnM9XCIrZikpOmY9MDpnLnB1c2goXCJvZnM9XCIrZik7bGV0IG09ITA7Zm9yKGxldCBxPTA7cTxjO3ErKyl7bGV0IGw9ZVtxXS5nO2NvbnN0IHY9ZVtxXS5tYXA7bC09ZjtpZigwPmwpZj1NYXRoLm1heCgwLGVbcV0uZy0xMDApLG09ITE7ZWxzZSB0cnl7SWModixnLFwicmVxXCIrbCtcIl9cIik7fWNhdGNoKHcpe2QmJmQodik7fX1pZihtKXtkPWcuam9pbihcIiZcIik7YnJlYWsgYX19fWE9YS5pLnNwbGljZSgwLGMpO2IuRD1hO3JldHVybiBkfWZ1bmN0aW9uIGVjKGEpe2lmKCFhLmcmJiFhLnUpe2EuWT0xO3ZhciBiPWEuRmE7eHx8RWEoKTt5fHwoeCgpLHk9ITApO3phLmFkZChiLGEpO2Eudj0wO319XG5mdW5jdGlvbiAkYihhKXtpZihhLmd8fGEudXx8Mzw9YS52KXJldHVybiAhMTthLlkrKzthLnU9dWIocChhLkZhLGEpLGNkKGEsYS52KSk7YS52Kys7cmV0dXJuICEwfWguRmE9ZnVuY3Rpb24oKXt0aGlzLnU9bnVsbDtmZCh0aGlzKTtpZih0aGlzLmJhJiYhKHRoaXMuTXx8bnVsbD09dGhpcy5nfHwwPj10aGlzLlIpKXt2YXIgYT0yKnRoaXMuUjt0aGlzLmouaW5mbyhcIkJQIGRldGVjdGlvbiB0aW1lciBlbmFibGVkOiBcIithKTt0aGlzLkE9dWIocCh0aGlzLmFiLHRoaXMpLGEpO319O2guYWI9ZnVuY3Rpb24oKXt0aGlzLkEmJih0aGlzLkE9bnVsbCx0aGlzLmouaW5mbyhcIkJQIGRldGVjdGlvbiB0aW1lb3V0IHJlYWNoZWQuXCIpLHRoaXMuai5pbmZvKFwiQnVmZmVyaW5nIHByb3h5IGRldGVjdGVkIGFuZCBzd2l0Y2ggdG8gbG9uZy1wb2xsaW5nIVwiKSx0aGlzLkY9ITEsdGhpcy5NPSEwLEsoMTApLFpiKHRoaXMpLGZkKHRoaXMpKTt9O1xuZnVuY3Rpb24gVGIoYSl7bnVsbCE9YS5BJiYoay5jbGVhclRpbWVvdXQoYS5BKSxhLkE9bnVsbCk7fWZ1bmN0aW9uIGZkKGEpe2EuZz1uZXcgTShhLGEuaixcInJwY1wiLGEuWSk7bnVsbD09PWEubSYmKGEuZy5IPWEubyk7YS5nLk89MDt2YXIgYj1OKGEucWEpO1MoYixcIlJJRFwiLFwicnBjXCIpO1MoYixcIlNJRFwiLGEuSyk7UyhiLFwiQUlEXCIsYS5UKTtTKGIsXCJDSVwiLGEuRj9cIjBcIjpcIjFcIik7IWEuRiYmYS5qYSYmUyhiLFwiVE9cIixhLmphKTtTKGIsXCJUWVBFXCIsXCJ4bWxodHRwXCIpOyRjKGEsYik7YS5tJiZhLm8mJlBjKGIsYS5tLGEubyk7YS5MJiYoYS5nLkk9YS5MKTt2YXIgYz1hLmc7YT1hLmlhO2MuTD0xO2Mudj1JYihOKGIpKTtjLm09bnVsbDtjLlA9ITA7SmIoYyxhKTt9aC5aYT1mdW5jdGlvbigpe251bGwhPXRoaXMuQyYmKHRoaXMuQz1udWxsLFpiKHRoaXMpLCRiKHRoaXMpLEsoMTkpKTt9O2Z1bmN0aW9uIFliKGEpe251bGwhPWEuQyYmKGsuY2xlYXJUaW1lb3V0KGEuQyksYS5DPW51bGwpO31cbmZ1bmN0aW9uIFViKGEsYil7dmFyIGM9bnVsbDtpZihhLmc9PWIpe1liKGEpO1RiKGEpO2EuZz1udWxsO3ZhciBkPTI7fWVsc2UgaWYoWGIoYS5oLGIpKWM9Yi5ELGRjKGEuaCxiKSxkPTE7ZWxzZSByZXR1cm47aWYoMCE9YS5HKWlmKGIubylpZigxPT1kKXtjPWIubT9iLm0ubGVuZ3RoOjA7Yj1EYXRlLm5vdygpLWIuRjt2YXIgZT1hLkI7ZD1xYigpO0YoZCxuZXcgdGIoZCxjKSk7ZmMoYSk7fWVsc2UgZWMoYSk7ZWxzZSBpZihlPWIucywzPT1lfHwwPT1lJiYwPGIuWHx8ISgxPT1kJiZiZChhLGIpfHwyPT1kJiYkYihhKSkpc3dpdGNoKGMmJjA8Yy5sZW5ndGgmJihiPWEuaCxiLmk9Yi5pLmNvbmNhdChjKSksZSl7Y2FzZSAxOlIoYSw1KTticmVhaztjYXNlIDQ6UihhLDEwKTticmVhaztjYXNlIDM6UihhLDYpO2JyZWFrO2RlZmF1bHQ6UihhLDIpO319XG5mdW5jdGlvbiBjZChhLGIpe2xldCBjPWEuVGErTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpKmEuY2IpO2EuaXNBY3RpdmUoKXx8KGMqPTIpO3JldHVybiBjKmJ9ZnVuY3Rpb24gUihhLGIpe2Euai5pbmZvKFwiRXJyb3IgY29kZSBcIitiKTtpZigyPT1iKXt2YXIgYz1wKGEuZmIsYSksZD1hLlhhO2NvbnN0IGU9IWQ7ZD1uZXcgVChkfHxcIi8vd3d3Lmdvb2dsZS5jb20vaW1hZ2VzL2NsZWFyZG90LmdpZlwiKTtrLmxvY2F0aW9uJiZcImh0dHBcIj09ay5sb2NhdGlvbi5wcm90b2NvbHx8cWMoZCxcImh0dHBzXCIpO0liKGQpO2U/RmMoZC50b1N0cmluZygpLGMpOkdjKGQudG9TdHJpbmcoKSxjKTt9ZWxzZSBLKDIpO2EuRz0wO2EubCYmYS5sLnNhKGIpO2FkKGEpO1pjKGEpO31oLmZiPWZ1bmN0aW9uKGEpe2E/KHRoaXMuai5pbmZvKFwiU3VjY2Vzc2Z1bGx5IHBpbmdlZCBnb29nbGUuY29tXCIpLEsoMikpOih0aGlzLmouaW5mbyhcIkZhaWxlZCB0byBwaW5nIGdvb2dsZS5jb21cIiksSygxKSk7fTtcbmZ1bmN0aW9uIGFkKGEpe2EuRz0wO2Eua2E9W107aWYoYS5sKXtjb25zdCBiPWtjKGEuaCk7aWYoMCE9Yi5sZW5ndGh8fDAhPWEuaS5sZW5ndGgpbWEoYS5rYSxiKSxtYShhLmthLGEuaSksYS5oLmkubGVuZ3RoPTAsbGEoYS5pKSxhLmkubGVuZ3RoPTA7YS5sLnJhKCk7fX1mdW5jdGlvbiBjYyhhLGIsYyl7dmFyIGQ9YyBpbnN0YW5jZW9mIFQ/TihjKTpuZXcgVChjKTtpZihcIlwiIT1kLmcpYiYmKGQuZz1iK1wiLlwiK2QuZykscmMoZCxkLnMpO2Vsc2Uge3ZhciBlPWsubG9jYXRpb247ZD1lLnByb3RvY29sO2I9Yj9iK1wiLlwiK2UuaG9zdG5hbWU6ZS5ob3N0bmFtZTtlPStlLnBvcnQ7dmFyIGY9bmV3IFQobnVsbCk7ZCYmcWMoZixkKTtiJiYoZi5nPWIpO2UmJnJjKGYsZSk7YyYmKGYubD1jKTtkPWY7fWM9YS5EO2I9YS55YTtjJiZiJiZTKGQsYyxiKTtTKGQsXCJWRVJcIixhLmxhKTskYyhhLGQpO3JldHVybiBkfVxuZnVuY3Rpb24gTWIoYSxiLGMpe2lmKGImJiFhLkopdGhyb3cgRXJyb3IoXCJDYW4ndCBjcmVhdGUgc2Vjb25kYXJ5IGRvbWFpbiBjYXBhYmxlIFhocklvIG9iamVjdC5cIik7Yj1hLkNhJiYhYS5wYT9uZXcgWChuZXcgSmMoe2ViOmN9KSk6bmV3IFgoYS5wYSk7Yi5IYShhLkopO3JldHVybiBifWguaXNBY3RpdmU9ZnVuY3Rpb24oKXtyZXR1cm4gISF0aGlzLmwmJnRoaXMubC5pc0FjdGl2ZSh0aGlzKX07ZnVuY3Rpb24gZ2QoKXt9aD1nZC5wcm90b3R5cGU7aC51YT1mdW5jdGlvbigpe307aC50YT1mdW5jdGlvbigpe307aC5zYT1mdW5jdGlvbigpe307aC5yYT1mdW5jdGlvbigpe307aC5pc0FjdGl2ZT1mdW5jdGlvbigpe3JldHVybiAhMH07aC5OYT1mdW5jdGlvbigpe307ZnVuY3Rpb24gaGQoKXt9aGQucHJvdG90eXBlLmc9ZnVuY3Rpb24oYSxiKXtyZXR1cm4gbmV3IFkoYSxiKX07XG5mdW5jdGlvbiBZKGEsYil7RS5jYWxsKHRoaXMpO3RoaXMuZz1uZXcgWWMoYik7dGhpcy5sPWE7dGhpcy5oPWImJmIubWVzc2FnZVVybFBhcmFtc3x8bnVsbDthPWImJmIubWVzc2FnZUhlYWRlcnN8fG51bGw7YiYmYi5jbGllbnRQcm90b2NvbEhlYWRlclJlcXVpcmVkJiYoYT9hW1wiWC1DbGllbnQtUHJvdG9jb2xcIl09XCJ3ZWJjaGFubmVsXCI6YT17XCJYLUNsaWVudC1Qcm90b2NvbFwiOlwid2ViY2hhbm5lbFwifSk7dGhpcy5nLm89YTthPWImJmIuaW5pdE1lc3NhZ2VIZWFkZXJzfHxudWxsO2ImJmIubWVzc2FnZUNvbnRlbnRUeXBlJiYoYT9hW1wiWC1XZWJDaGFubmVsLUNvbnRlbnQtVHlwZVwiXT1iLm1lc3NhZ2VDb250ZW50VHlwZTphPXtcIlgtV2ViQ2hhbm5lbC1Db250ZW50LVR5cGVcIjpiLm1lc3NhZ2VDb250ZW50VHlwZX0pO2ImJmIudmEmJihhP2FbXCJYLVdlYkNoYW5uZWwtQ2xpZW50LVByb2ZpbGVcIl09Yi52YTphPXtcIlgtV2ViQ2hhbm5lbC1DbGllbnQtUHJvZmlsZVwiOmIudmF9KTt0aGlzLmcuUz1cbmE7KGE9YiYmYi5TYikmJiF0KGEpJiYodGhpcy5nLm09YSk7dGhpcy52PWImJmIuc3VwcG9ydHNDcm9zc0RvbWFpblhocnx8ITE7dGhpcy51PWImJmIuc2VuZFJhd0pzb258fCExOyhiPWImJmIuaHR0cFNlc3Npb25JZFBhcmFtKSYmIXQoYikmJih0aGlzLmcuRD1iLGE9dGhpcy5oLG51bGwhPT1hJiZiIGluIGEmJihhPXRoaXMuaCxiIGluIGEmJmRlbGV0ZSBhW2JdKSk7dGhpcy5qPW5ldyBaKHRoaXMpO31yKFksRSk7WS5wcm90b3R5cGUubT1mdW5jdGlvbigpe3RoaXMuZy5sPXRoaXMuajt0aGlzLnYmJih0aGlzLmcuSj0hMCk7dGhpcy5nLmNvbm5lY3QodGhpcy5sLHRoaXMuaHx8dm9pZCAwKTt9O1kucHJvdG90eXBlLmNsb3NlPWZ1bmN0aW9uKCl7Z2ModGhpcy5nKTt9O1xuWS5wcm90b3R5cGUubz1mdW5jdGlvbihhKXt2YXIgYj10aGlzLmc7aWYoXCJzdHJpbmdcIj09PXR5cGVvZiBhKXt2YXIgYz17fTtjLl9fZGF0YV9fPWE7YT1jO31lbHNlIHRoaXMudSYmKGM9e30sYy5fX2RhdGFfXz1oYihhKSxhPWMpO2IuaS5wdXNoKG5ldyBoYyhiLllhKyssYSkpOzM9PWIuRyYmZmMoYik7fTtZLnByb3RvdHlwZS5OPWZ1bmN0aW9uKCl7dGhpcy5nLmw9bnVsbDtkZWxldGUgdGhpcy5qO2djKHRoaXMuZyk7ZGVsZXRlIHRoaXMuZztZLmFhLk4uY2FsbCh0aGlzKTt9O1xuZnVuY3Rpb24gaWQoYSl7bmIuY2FsbCh0aGlzKTthLl9faGVhZGVyc19fJiYodGhpcy5oZWFkZXJzPWEuX19oZWFkZXJzX18sdGhpcy5zdGF0dXNDb2RlPWEuX19zdGF0dXNfXyxkZWxldGUgYS5fX2hlYWRlcnNfXyxkZWxldGUgYS5fX3N0YXR1c19fKTt2YXIgYj1hLl9fc21fXztpZihiKXthOntmb3IoY29uc3QgYyBpbiBiKXthPWM7YnJlYWsgYX1hPXZvaWQgMDt9aWYodGhpcy5pPWEpYT10aGlzLmksYj1udWxsIT09YiYmYSBpbiBiP2JbYV06dm9pZCAwO3RoaXMuZGF0YT1iO31lbHNlIHRoaXMuZGF0YT1hO31yKGlkLG5iKTtmdW5jdGlvbiBqZCgpe29iLmNhbGwodGhpcyk7dGhpcy5zdGF0dXM9MTt9cihqZCxvYik7ZnVuY3Rpb24gWihhKXt0aGlzLmc9YTt9cihaLGdkKTtaLnByb3RvdHlwZS51YT1mdW5jdGlvbigpe0YodGhpcy5nLFwiYVwiKTt9O1oucHJvdG90eXBlLnRhPWZ1bmN0aW9uKGEpe0YodGhpcy5nLG5ldyBpZChhKSk7fTtcbloucHJvdG90eXBlLnNhPWZ1bmN0aW9uKGEpe0YodGhpcy5nLG5ldyBqZCgpKTt9O1oucHJvdG90eXBlLnJhPWZ1bmN0aW9uKCl7Rih0aGlzLmcsXCJiXCIpO307aGQucHJvdG90eXBlLmNyZWF0ZVdlYkNoYW5uZWw9aGQucHJvdG90eXBlLmc7WS5wcm90b3R5cGUuc2VuZD1ZLnByb3RvdHlwZS5vO1kucHJvdG90eXBlLm9wZW49WS5wcm90b3R5cGUubTtZLnByb3RvdHlwZS5jbG9zZT1ZLnByb3RvdHlwZS5jbG9zZTtjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0ID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5jcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0PWZ1bmN0aW9uKCl7cmV0dXJuIG5ldyBoZH07Z2V0U3RhdEV2ZW50VGFyZ2V0ID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5nZXRTdGF0RXZlbnRUYXJnZXQ9ZnVuY3Rpb24oKXtyZXR1cm4gcWIoKX07RXZlbnQgPSB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4LkV2ZW50PUk7U3RhdCA9IHdlYmNoYW5uZWxfYmxvYl9lczIwMTguU3RhdD17bWI6MCxwYjoxLHFiOjIsSmI6MyxPYjo0LExiOjUsTWI6NixLYjo3LEliOjgsTmI6OSxQUk9YWToxMCxOT1BST1hZOjExLEdiOjEyLENiOjEzLERiOjE0LEJiOjE1LEViOjE2LEZiOjE3LGliOjE4LGhiOjE5LGpiOjIwfTtBYi5OT19FUlJPUj0wO0FiLlRJTUVPVVQ9ODtBYi5IVFRQX0VSUk9SPTY7XG5FcnJvckNvZGUgPSB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4LkVycm9yQ29kZT1BYjtCYi5DT01QTEVURT1cImNvbXBsZXRlXCI7RXZlbnRUeXBlID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5FdmVudFR5cGU9QmI7bWIuRXZlbnRUeXBlPUg7SC5PUEVOPVwiYVwiO0guQ0xPU0U9XCJiXCI7SC5FUlJPUj1cImNcIjtILk1FU1NBR0U9XCJkXCI7RS5wcm90b3R5cGUubGlzdGVuPUUucHJvdG90eXBlLks7V2ViQ2hhbm5lbCA9IHdlYmNoYW5uZWxfYmxvYl9lczIwMTguV2ViQ2hhbm5lbD1tYjtGZXRjaFhtbEh0dHBGYWN0b3J5ID0gd2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5GZXRjaFhtbEh0dHBGYWN0b3J5PUpjO1gucHJvdG90eXBlLmxpc3Rlbk9uY2U9WC5wcm90b3R5cGUuTDtYLnByb3RvdHlwZS5nZXRMYXN0RXJyb3I9WC5wcm90b3R5cGUuS2E7WC5wcm90b3R5cGUuZ2V0TGFzdEVycm9yQ29kZT1YLnByb3RvdHlwZS5CYTtYLnByb3RvdHlwZS5nZXRTdGF0dXM9WC5wcm90b3R5cGUuWjtYLnByb3RvdHlwZS5nZXRSZXNwb25zZUpzb249WC5wcm90b3R5cGUuT2E7WC5wcm90b3R5cGUuZ2V0UmVzcG9uc2VUZXh0PVgucHJvdG90eXBlLm9hO1xuWC5wcm90b3R5cGUuc2VuZD1YLnByb3RvdHlwZS5lYTtYLnByb3RvdHlwZS5zZXRXaXRoQ3JlZGVudGlhbHM9WC5wcm90b3R5cGUuSGE7WGhySW8gPSB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4LlhocklvPVg7fSkuYXBwbHkoIHR5cGVvZiBjb21tb25qc0dsb2JhbCAhPT0gJ3VuZGVmaW5lZCcgPyBjb21tb25qc0dsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyA/IHNlbGYgIDogdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgPyB3aW5kb3cgIDoge30pO1xuXG5leHBvcnQgeyBFcnJvckNvZGUsIEV2ZW50LCBFdmVudFR5cGUsIEZldGNoWG1sSHR0cEZhY3RvcnksIFN0YXQsIFdlYkNoYW5uZWwsIFhocklvLCBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0LCB3ZWJjaGFubmVsX2Jsb2JfZXMyMDE4IGFzIGRlZmF1bHQsIGdldFN0YXRFdmVudFRhcmdldCB9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9d2ViY2hhbm5lbF9ibG9iX2VzMjAxOC5qcy5tYXBcbiIsImltcG9ydCB7IF9yZWdpc3RlckNvbXBvbmVudCwgcmVnaXN0ZXJWZXJzaW9uLCBfaXNGaXJlYmFzZVNlcnZlckFwcCwgX2dldFByb3ZpZGVyLCBnZXRBcHAsIF9yZW1vdmVTZXJ2aWNlSW5zdGFuY2UsIFNES19WRVJTSU9OIH0gZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5pbXBvcnQgeyBDb21wb25lbnQgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IExvZ2dlciwgTG9nTGV2ZWwgfSBmcm9tICdAZmlyZWJhc2UvbG9nZ2VyJztcbmltcG9ydCB7IEZpcmViYXNlRXJyb3IsIGRlZXBFcXVhbCwgY3JlYXRlTW9ja1VzZXJUb2tlbiwgZ2V0TW9kdWxhckluc3RhbmNlLCBnZXREZWZhdWx0RW11bGF0b3JIb3N0bmFtZUFuZFBvcnQsIGlzSW5kZXhlZERCQXZhaWxhYmxlLCBnZXRVQSwgaXNTYWZhcmkgfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBJbnRlZ2VyLCBNZDUgfSBmcm9tICdAZmlyZWJhc2Uvd2ViY2hhbm5lbC13cmFwcGVyL2Jsb29tLWJsb2InO1xuaW1wb3J0IHsgWGhySW8sIEV2ZW50VHlwZSwgRXJyb3JDb2RlLCBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0LCBnZXRTdGF0RXZlbnRUYXJnZXQsIFdlYkNoYW5uZWwsIEV2ZW50LCBTdGF0IH0gZnJvbSAnQGZpcmViYXNlL3dlYmNoYW5uZWwtd3JhcHBlci93ZWJjaGFubmVsLWJsb2InO1xuXG5jb25zdCBTID0gXCJAZmlyZWJhc2UvZmlyZXN0b3JlXCIsIGIgPSBcIjQuNy4xMFwiO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTaW1wbGUgd3JhcHBlciBhcm91bmQgYSBudWxsYWJsZSBVSUQuIE1vc3RseSBleGlzdHMgdG8gbWFrZSBjb2RlIG1vcmVcbiAqIHJlYWRhYmxlLlxuICovXG5jbGFzcyBVc2VyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudWlkID0gZTtcbiAgICB9XG4gICAgaXNBdXRoZW50aWNhdGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPSB0aGlzLnVpZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGtleSByZXByZXNlbnRpbmcgdGhpcyB1c2VyLCBzdWl0YWJsZSBmb3IgaW5jbHVzaW9uIGluIGFcbiAgICAgKiBkaWN0aW9uYXJ5LlxuICAgICAqLyAgICB0b0tleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaXNBdXRoZW50aWNhdGVkKCkgPyBcInVpZDpcIiArIHRoaXMudWlkIDogXCJhbm9ueW1vdXMtdXNlclwiO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUudWlkID09PSB0aGlzLnVpZDtcbiAgICB9XG59XG5cbi8qKiBBIHVzZXIgd2l0aCBhIG51bGwgVUlELiAqLyBVc2VyLlVOQVVUSEVOVElDQVRFRCA9IG5ldyBVc2VyKG51bGwpLCBcbi8vIFRPRE8obWlrZWxlaGVuKTogTG9vayBpbnRvIGdldHRpbmcgYSBwcm9wZXIgdWlkLWVxdWl2YWxlbnQgZm9yXG4vLyBub24tRmlyZWJhc2VBdXRoIHByb3ZpZGVycy5cblVzZXIuR09PR0xFX0NSRURFTlRJQUxTID0gbmV3IFVzZXIoXCJnb29nbGUtY3JlZGVudGlhbHMtdWlkXCIpLCBVc2VyLkZJUlNUX1BBUlRZID0gbmV3IFVzZXIoXCJmaXJzdC1wYXJ0eS11aWRcIiksIFxuVXNlci5NT0NLX1VTRVIgPSBuZXcgVXNlcihcIm1vY2stdXNlclwiKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBEID0gXCIxMS41LjBcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IHYgPSBuZXcgTG9nZ2VyKFwiQGZpcmViYXNlL2ZpcmVzdG9yZVwiKTtcblxuLy8gSGVscGVyIG1ldGhvZHMgYXJlIG5lZWRlZCBiZWNhdXNlIHZhcmlhYmxlcyBjYW4ndCBiZSBleHBvcnRlZCBhcyByZWFkL3dyaXRlXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0TG9nTGV2ZWwoKSB7XG4gICAgcmV0dXJuIHYubG9nTGV2ZWw7XG59XG5cbi8qKlxuICogU2V0cyB0aGUgdmVyYm9zaXR5IG9mIENsb3VkIEZpcmVzdG9yZSBsb2dzIChkZWJ1ZywgZXJyb3IsIG9yIHNpbGVudCkuXG4gKlxuICogQHBhcmFtIGxvZ0xldmVsIC0gVGhlIHZlcmJvc2l0eSB5b3Ugc2V0IGZvciBhY3Rpdml0eSBhbmQgZXJyb3IgbG9nZ2luZy4gQ2FuXG4gKiAgIGJlIGFueSBvZiB0aGUgZm9sbG93aW5nIHZhbHVlczpcbiAqXG4gKiAgIDx1bD5cbiAqICAgICA8bGk+YGRlYnVnYCBmb3IgdGhlIG1vc3QgdmVyYm9zZSBsb2dnaW5nIGxldmVsLCBwcmltYXJpbHkgZm9yXG4gKiAgICAgZGVidWdnaW5nLjwvbGk+XG4gKiAgICAgPGxpPmBlcnJvcmAgdG8gbG9nIGVycm9ycyBvbmx5LjwvbGk+XG4gKiAgICAgPGxpPjxjb2RlPmBzaWxlbnRgIHRvIHR1cm4gb2ZmIGxvZ2dpbmcuPC9saT5cbiAqICAgPC91bD5cbiAqLyBmdW5jdGlvbiBzZXRMb2dMZXZlbChlKSB7XG4gICAgdi5zZXRMb2dMZXZlbChlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2xvZ0RlYnVnKGUsIC4uLnQpIHtcbiAgICBpZiAodi5sb2dMZXZlbCA8PSBMb2dMZXZlbC5ERUJVRykge1xuICAgICAgICBjb25zdCBuID0gdC5tYXAoX19QUklWQVRFX2FyZ1RvU3RyaW5nKTtcbiAgICAgICAgdi5kZWJ1ZyhgRmlyZXN0b3JlICgke0R9KTogJHtlfWAsIC4uLm4pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2xvZ0Vycm9yKGUsIC4uLnQpIHtcbiAgICBpZiAodi5sb2dMZXZlbCA8PSBMb2dMZXZlbC5FUlJPUikge1xuICAgICAgICBjb25zdCBuID0gdC5tYXAoX19QUklWQVRFX2FyZ1RvU3RyaW5nKTtcbiAgICAgICAgdi5lcnJvcihgRmlyZXN0b3JlICgke0R9KTogJHtlfWAsIC4uLm4pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9nV2FybihlLCAuLi50KSB7XG4gICAgaWYgKHYubG9nTGV2ZWwgPD0gTG9nTGV2ZWwuV0FSTikge1xuICAgICAgICBjb25zdCBuID0gdC5tYXAoX19QUklWQVRFX2FyZ1RvU3RyaW5nKTtcbiAgICAgICAgdi53YXJuKGBGaXJlc3RvcmUgKCR7RH0pOiAke2V9YCwgLi4ubik7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbnZlcnRzIGFuIGFkZGl0aW9uYWwgbG9nIHBhcmFtZXRlciB0byBhIHN0cmluZyByZXByZXNlbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYXJnVG9TdHJpbmcoZSkge1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKSByZXR1cm4gZTtcbiAgICB0cnkge1xuICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgICAgICAvKiogRm9ybWF0cyBhbiBvYmplY3QgYXMgYSBKU09OIHN0cmluZywgc3VpdGFibGUgZm9yIGxvZ2dpbmcuICovXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZm9ybWF0SlNPTihlKSB7XG4gICAgICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkoZSk7XG4gICAgICAgIH0oZSk7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICAvLyBDb252ZXJ0aW5nIHRvIEpTT04gZmFpbGVkLCBqdXN0IGxvZyB0aGUgb2JqZWN0IGRpcmVjdGx5XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVW5jb25kaXRpb25hbGx5IGZhaWxzLCB0aHJvd2luZyBhbiBFcnJvciB3aXRoIHRoZSBnaXZlbiBtZXNzYWdlLlxuICogTWVzc2FnZXMgYXJlIHN0cmlwcGVkIGluIHByb2R1Y3Rpb24gYnVpbGRzLlxuICpcbiAqIFJldHVybnMgYG5ldmVyYCBhbmQgY2FuIGJlIHVzZWQgaW4gZXhwcmVzc2lvbnM6XG4gKiBAZXhhbXBsZVxuICogbGV0IGZ1dHVyZVZhciA9IGZhaWwoJ25vdCBpbXBsZW1lbnRlZCB5ZXQnKTtcbiAqLyBmdW5jdGlvbiBmYWlsKGUgPSBcIlVuZXhwZWN0ZWQgc3RhdGVcIikge1xuICAgIC8vIExvZyB0aGUgZmFpbHVyZSBpbiBhZGRpdGlvbiB0byB0aHJvdyBhbiBleGNlcHRpb24sIGp1c3QgaW4gY2FzZSB0aGVcbiAgICAvLyBleGNlcHRpb24gaXMgc3dhbGxvd2VkLlxuICAgIGNvbnN0IHQgPSBgRklSRVNUT1JFICgke0R9KSBJTlRFUk5BTCBBU1NFUlRJT04gRkFJTEVEOiBgICsgZTtcbiAgICAvLyBOT1RFOiBXZSBkb24ndCB1c2UgRmlyZXN0b3JlRXJyb3IgaGVyZSBiZWNhdXNlIHRoZXNlIGFyZSBpbnRlcm5hbCBmYWlsdXJlc1xuICAgIC8vIHRoYXQgY2Fubm90IGJlIGhhbmRsZWQgYnkgdGhlIHVzZXIuIChBbHNvIGl0IHdvdWxkIGNyZWF0ZSBhIGNpcmN1bGFyXG4gICAgLy8gZGVwZW5kZW5jeSBiZXR3ZWVuIHRoZSBlcnJvciBhbmQgYXNzZXJ0IG1vZHVsZXMgd2hpY2ggZG9lc24ndCB3b3JrLilcbiAgICB0aHJvdyBfX1BSSVZBVEVfbG9nRXJyb3IodCksIG5ldyBFcnJvcih0KTtcbn1cblxuLyoqXG4gKiBGYWlscyBpZiB0aGUgZ2l2ZW4gYXNzZXJ0aW9uIGNvbmRpdGlvbiBpcyBmYWxzZSwgdGhyb3dpbmcgYW4gRXJyb3Igd2l0aCB0aGVcbiAqIGdpdmVuIG1lc3NhZ2UgaWYgaXQgZGlkLlxuICpcbiAqIE1lc3NhZ2VzIGFyZSBzdHJpcHBlZCBpbiBwcm9kdWN0aW9uIGJ1aWxkcy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaGFyZEFzc2VydChlLCB0KSB7XG4gICAgZSB8fCBmYWlsKCk7XG59XG5cbi8qKlxuICogRmFpbHMgaWYgdGhlIGdpdmVuIGFzc2VydGlvbiBjb25kaXRpb24gaXMgZmFsc2UsIHRocm93aW5nIGFuIEVycm9yIHdpdGggdGhlXG4gKiBnaXZlbiBtZXNzYWdlIGlmIGl0IGRpZC5cbiAqXG4gKiBUaGUgY29kZSBvZiBjYWxsc2l0ZXMgaW52b2tpbmcgdGhpcyBmdW5jdGlvbiBhcmUgc3RyaXBwZWQgb3V0IGluIHByb2R1Y3Rpb25cbiAqIGJ1aWxkcy4gQW55IHNpZGUtZWZmZWN0cyBvZiBjb2RlIHdpdGhpbiB0aGUgZGVidWdBc3NlcnQoKSBpbnZvY2F0aW9uIHdpbGwgbm90XG4gKiBoYXBwZW4gaW4gdGhpcyBjYXNlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kZWJ1Z0Fzc2VydChlLCB0KSB7XG4gICAgZSB8fCBmYWlsKCk7XG59XG5cbi8qKlxuICogQ2FzdHMgYG9iamAgdG8gYFRgLiBJbiBub24tcHJvZHVjdGlvbiBidWlsZHMsIHZlcmlmaWVzIHRoYXQgYG9iamAgaXMgYW5cbiAqIGluc3RhbmNlIG9mIGBUYCBiZWZvcmUgY2FzdGluZy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGVidWdDYXN0KGUsIFxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbnQpIHtcbiAgICByZXR1cm4gZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgQyA9IHtcbiAgICAvLyBDYXVzZXMgYXJlIGNvcGllZCBmcm9tOlxuICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ncnBjL2dycGMvYmxvYi9iY2VlYzk0ZWE0ZmM1ZjAwODVkODEyMzVkOGUxYzA2Nzk4ZGMzNDFhL2luY2x1ZGUvZ3JwYyUyQiUyQi9pbXBsL2NvZGVnZW4vc3RhdHVzX2NvZGVfZW51bS5oXG4gICAgLyoqIE5vdCBhbiBlcnJvcjsgcmV0dXJuZWQgb24gc3VjY2Vzcy4gKi9cbiAgICBPSzogXCJva1wiLFxuICAgIC8qKiBUaGUgb3BlcmF0aW9uIHdhcyBjYW5jZWxsZWQgKHR5cGljYWxseSBieSB0aGUgY2FsbGVyKS4gKi9cbiAgICBDQU5DRUxMRUQ6IFwiY2FuY2VsbGVkXCIsXG4gICAgLyoqIFVua25vd24gZXJyb3Igb3IgYW4gZXJyb3IgZnJvbSBhIGRpZmZlcmVudCBlcnJvciBkb21haW4uICovXG4gICAgVU5LTk9XTjogXCJ1bmtub3duXCIsXG4gICAgLyoqXG4gICAgICogQ2xpZW50IHNwZWNpZmllZCBhbiBpbnZhbGlkIGFyZ3VtZW50LiBOb3RlIHRoYXQgdGhpcyBkaWZmZXJzIGZyb21cbiAgICAgKiBGQUlMRURfUFJFQ09ORElUSU9OLiBJTlZBTElEX0FSR1VNRU5UIGluZGljYXRlcyBhcmd1bWVudHMgdGhhdCBhcmVcbiAgICAgKiBwcm9ibGVtYXRpYyByZWdhcmRsZXNzIG9mIHRoZSBzdGF0ZSBvZiB0aGUgc3lzdGVtIChlLmcuLCBhIG1hbGZvcm1lZCBmaWxlXG4gICAgICogbmFtZSkuXG4gICAgICovXG4gICAgSU5WQUxJRF9BUkdVTUVOVDogXCJpbnZhbGlkLWFyZ3VtZW50XCIsXG4gICAgLyoqXG4gICAgICogRGVhZGxpbmUgZXhwaXJlZCBiZWZvcmUgb3BlcmF0aW9uIGNvdWxkIGNvbXBsZXRlLiBGb3Igb3BlcmF0aW9ucyB0aGF0XG4gICAgICogY2hhbmdlIHRoZSBzdGF0ZSBvZiB0aGUgc3lzdGVtLCB0aGlzIGVycm9yIG1heSBiZSByZXR1cm5lZCBldmVuIGlmIHRoZVxuICAgICAqIG9wZXJhdGlvbiBoYXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseS4gRm9yIGV4YW1wbGUsIGEgc3VjY2Vzc2Z1bCByZXNwb25zZVxuICAgICAqIGZyb20gYSBzZXJ2ZXIgY291bGQgaGF2ZSBiZWVuIGRlbGF5ZWQgbG9uZyBlbm91Z2ggZm9yIHRoZSBkZWFkbGluZSB0b1xuICAgICAqIGV4cGlyZS5cbiAgICAgKi9cbiAgICBERUFETElORV9FWENFRURFRDogXCJkZWFkbGluZS1leGNlZWRlZFwiLFxuICAgIC8qKiBTb21lIHJlcXVlc3RlZCBlbnRpdHkgKGUuZy4sIGZpbGUgb3IgZGlyZWN0b3J5KSB3YXMgbm90IGZvdW5kLiAqL1xuICAgIE5PVF9GT1VORDogXCJub3QtZm91bmRcIixcbiAgICAvKipcbiAgICAgKiBTb21lIGVudGl0eSB0aGF0IHdlIGF0dGVtcHRlZCB0byBjcmVhdGUgKGUuZy4sIGZpbGUgb3IgZGlyZWN0b3J5KSBhbHJlYWR5XG4gICAgICogZXhpc3RzLlxuICAgICAqL1xuICAgIEFMUkVBRFlfRVhJU1RTOiBcImFscmVhZHktZXhpc3RzXCIsXG4gICAgLyoqXG4gICAgICogVGhlIGNhbGxlciBkb2VzIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gZXhlY3V0ZSB0aGUgc3BlY2lmaWVkIG9wZXJhdGlvbi5cbiAgICAgKiBQRVJNSVNTSU9OX0RFTklFRCBtdXN0IG5vdCBiZSB1c2VkIGZvciByZWplY3Rpb25zIGNhdXNlZCBieSBleGhhdXN0aW5nXG4gICAgICogc29tZSByZXNvdXJjZSAodXNlIFJFU09VUkNFX0VYSEFVU1RFRCBpbnN0ZWFkIGZvciB0aG9zZSBlcnJvcnMpLlxuICAgICAqIFBFUk1JU1NJT05fREVOSUVEIG11c3Qgbm90IGJlIHVzZWQgaWYgdGhlIGNhbGxlciBjYW5ub3QgYmUgaWRlbnRpZmllZFxuICAgICAqICh1c2UgVU5BVVRIRU5USUNBVEVEIGluc3RlYWQgZm9yIHRob3NlIGVycm9ycykuXG4gICAgICovXG4gICAgUEVSTUlTU0lPTl9ERU5JRUQ6IFwicGVybWlzc2lvbi1kZW5pZWRcIixcbiAgICAvKipcbiAgICAgKiBUaGUgcmVxdWVzdCBkb2VzIG5vdCBoYXZlIHZhbGlkIGF1dGhlbnRpY2F0aW9uIGNyZWRlbnRpYWxzIGZvciB0aGVcbiAgICAgKiBvcGVyYXRpb24uXG4gICAgICovXG4gICAgVU5BVVRIRU5USUNBVEVEOiBcInVuYXV0aGVudGljYXRlZFwiLFxuICAgIC8qKlxuICAgICAqIFNvbWUgcmVzb3VyY2UgaGFzIGJlZW4gZXhoYXVzdGVkLCBwZXJoYXBzIGEgcGVyLXVzZXIgcXVvdGEsIG9yIHBlcmhhcHMgdGhlXG4gICAgICogZW50aXJlIGZpbGUgc3lzdGVtIGlzIG91dCBvZiBzcGFjZS5cbiAgICAgKi9cbiAgICBSRVNPVVJDRV9FWEhBVVNURUQ6IFwicmVzb3VyY2UtZXhoYXVzdGVkXCIsXG4gICAgLyoqXG4gICAgICogT3BlcmF0aW9uIHdhcyByZWplY3RlZCBiZWNhdXNlIHRoZSBzeXN0ZW0gaXMgbm90IGluIGEgc3RhdGUgcmVxdWlyZWQgZm9yXG4gICAgICogdGhlIG9wZXJhdGlvbidzIGV4ZWN1dGlvbi4gRm9yIGV4YW1wbGUsIGRpcmVjdG9yeSB0byBiZSBkZWxldGVkIG1heSBiZVxuICAgICAqIG5vbi1lbXB0eSwgYW4gcm1kaXIgb3BlcmF0aW9uIGlzIGFwcGxpZWQgdG8gYSBub24tZGlyZWN0b3J5LCBldGMuXG4gICAgICpcbiAgICAgKiBBIGxpdG11cyB0ZXN0IHRoYXQgbWF5IGhlbHAgYSBzZXJ2aWNlIGltcGxlbWVudG9yIGluIGRlY2lkaW5nXG4gICAgICogYmV0d2VlbiBGQUlMRURfUFJFQ09ORElUSU9OLCBBQk9SVEVELCBhbmQgVU5BVkFJTEFCTEU6XG4gICAgICogIChhKSBVc2UgVU5BVkFJTEFCTEUgaWYgdGhlIGNsaWVudCBjYW4gcmV0cnkganVzdCB0aGUgZmFpbGluZyBjYWxsLlxuICAgICAqICAoYikgVXNlIEFCT1JURUQgaWYgdGhlIGNsaWVudCBzaG91bGQgcmV0cnkgYXQgYSBoaWdoZXItbGV2ZWxcbiAgICAgKiAgICAgIChlLmcuLCByZXN0YXJ0aW5nIGEgcmVhZC1tb2RpZnktd3JpdGUgc2VxdWVuY2UpLlxuICAgICAqICAoYykgVXNlIEZBSUxFRF9QUkVDT05ESVRJT04gaWYgdGhlIGNsaWVudCBzaG91bGQgbm90IHJldHJ5IHVudGlsXG4gICAgICogICAgICB0aGUgc3lzdGVtIHN0YXRlIGhhcyBiZWVuIGV4cGxpY2l0bHkgZml4ZWQuIEUuZy4sIGlmIGFuIFwicm1kaXJcIlxuICAgICAqICAgICAgZmFpbHMgYmVjYXVzZSB0aGUgZGlyZWN0b3J5IGlzIG5vbi1lbXB0eSwgRkFJTEVEX1BSRUNPTkRJVElPTlxuICAgICAqICAgICAgc2hvdWxkIGJlIHJldHVybmVkIHNpbmNlIHRoZSBjbGllbnQgc2hvdWxkIG5vdCByZXRyeSB1bmxlc3NcbiAgICAgKiAgICAgIHRoZXkgaGF2ZSBmaXJzdCBmaXhlZCB1cCB0aGUgZGlyZWN0b3J5IGJ5IGRlbGV0aW5nIGZpbGVzIGZyb20gaXQuXG4gICAgICogIChkKSBVc2UgRkFJTEVEX1BSRUNPTkRJVElPTiBpZiB0aGUgY2xpZW50IHBlcmZvcm1zIGNvbmRpdGlvbmFsXG4gICAgICogICAgICBSRVNUIEdldC9VcGRhdGUvRGVsZXRlIG9uIGEgcmVzb3VyY2UgYW5kIHRoZSByZXNvdXJjZSBvbiB0aGVcbiAgICAgKiAgICAgIHNlcnZlciBkb2VzIG5vdCBtYXRjaCB0aGUgY29uZGl0aW9uLiBFLmcuLCBjb25mbGljdGluZ1xuICAgICAqICAgICAgcmVhZC1tb2RpZnktd3JpdGUgb24gdGhlIHNhbWUgcmVzb3VyY2UuXG4gICAgICovXG4gICAgRkFJTEVEX1BSRUNPTkRJVElPTjogXCJmYWlsZWQtcHJlY29uZGl0aW9uXCIsXG4gICAgLyoqXG4gICAgICogVGhlIG9wZXJhdGlvbiB3YXMgYWJvcnRlZCwgdHlwaWNhbGx5IGR1ZSB0byBhIGNvbmN1cnJlbmN5IGlzc3VlIGxpa2VcbiAgICAgKiBzZXF1ZW5jZXIgY2hlY2sgZmFpbHVyZXMsIHRyYW5zYWN0aW9uIGFib3J0cywgZXRjLlxuICAgICAqXG4gICAgICogU2VlIGxpdG11cyB0ZXN0IGFib3ZlIGZvciBkZWNpZGluZyBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04sIEFCT1JURUQsXG4gICAgICogYW5kIFVOQVZBSUxBQkxFLlxuICAgICAqL1xuICAgIEFCT1JURUQ6IFwiYWJvcnRlZFwiLFxuICAgIC8qKlxuICAgICAqIE9wZXJhdGlvbiB3YXMgYXR0ZW1wdGVkIHBhc3QgdGhlIHZhbGlkIHJhbmdlLiBFLmcuLCBzZWVraW5nIG9yIHJlYWRpbmdcbiAgICAgKiBwYXN0IGVuZCBvZiBmaWxlLlxuICAgICAqXG4gICAgICogVW5saWtlIElOVkFMSURfQVJHVU1FTlQsIHRoaXMgZXJyb3IgaW5kaWNhdGVzIGEgcHJvYmxlbSB0aGF0IG1heSBiZSBmaXhlZFxuICAgICAqIGlmIHRoZSBzeXN0ZW0gc3RhdGUgY2hhbmdlcy4gRm9yIGV4YW1wbGUsIGEgMzItYml0IGZpbGUgc3lzdGVtIHdpbGxcbiAgICAgKiBnZW5lcmF0ZSBJTlZBTElEX0FSR1VNRU5UIGlmIGFza2VkIHRvIHJlYWQgYXQgYW4gb2Zmc2V0IHRoYXQgaXMgbm90IGluIHRoZVxuICAgICAqIHJhbmdlIFswLDJeMzItMV0sIGJ1dCBpdCB3aWxsIGdlbmVyYXRlIE9VVF9PRl9SQU5HRSBpZiBhc2tlZCB0byByZWFkIGZyb21cbiAgICAgKiBhbiBvZmZzZXQgcGFzdCB0aGUgY3VycmVudCBmaWxlIHNpemUuXG4gICAgICpcbiAgICAgKiBUaGVyZSBpcyBhIGZhaXIgYml0IG9mIG92ZXJsYXAgYmV0d2VlbiBGQUlMRURfUFJFQ09ORElUSU9OIGFuZFxuICAgICAqIE9VVF9PRl9SQU5HRS4gV2UgcmVjb21tZW5kIHVzaW5nIE9VVF9PRl9SQU5HRSAodGhlIG1vcmUgc3BlY2lmaWMgZXJyb3IpXG4gICAgICogd2hlbiBpdCBhcHBsaWVzIHNvIHRoYXQgY2FsbGVycyB3aG8gYXJlIGl0ZXJhdGluZyB0aHJvdWdoIGEgc3BhY2UgY2FuXG4gICAgICogZWFzaWx5IGxvb2sgZm9yIGFuIE9VVF9PRl9SQU5HRSBlcnJvciB0byBkZXRlY3Qgd2hlbiB0aGV5IGFyZSBkb25lLlxuICAgICAqL1xuICAgIE9VVF9PRl9SQU5HRTogXCJvdXQtb2YtcmFuZ2VcIixcbiAgICAvKiogT3BlcmF0aW9uIGlzIG5vdCBpbXBsZW1lbnRlZCBvciBub3Qgc3VwcG9ydGVkL2VuYWJsZWQgaW4gdGhpcyBzZXJ2aWNlLiAqL1xuICAgIFVOSU1QTEVNRU5URUQ6IFwidW5pbXBsZW1lbnRlZFwiLFxuICAgIC8qKlxuICAgICAqIEludGVybmFsIGVycm9ycy4gTWVhbnMgc29tZSBpbnZhcmlhbnRzIGV4cGVjdGVkIGJ5IHVuZGVybHlpbmcgU3lzdGVtIGhhc1xuICAgICAqIGJlZW4gYnJva2VuLiBJZiB5b3Ugc2VlIG9uZSBvZiB0aGVzZSBlcnJvcnMsIFNvbWV0aGluZyBpcyB2ZXJ5IGJyb2tlbi5cbiAgICAgKi9cbiAgICBJTlRFUk5BTDogXCJpbnRlcm5hbFwiLFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXJ2aWNlIGlzIGN1cnJlbnRseSB1bmF2YWlsYWJsZS4gVGhpcyBpcyBhIG1vc3QgbGlrZWx5IGEgdHJhbnNpZW50XG4gICAgICogY29uZGl0aW9uIGFuZCBtYXkgYmUgY29ycmVjdGVkIGJ5IHJldHJ5aW5nIHdpdGggYSBiYWNrb2ZmLlxuICAgICAqXG4gICAgICogU2VlIGxpdG11cyB0ZXN0IGFib3ZlIGZvciBkZWNpZGluZyBiZXR3ZWVuIEZBSUxFRF9QUkVDT05ESVRJT04sIEFCT1JURUQsXG4gICAgICogYW5kIFVOQVZBSUxBQkxFLlxuICAgICAqL1xuICAgIFVOQVZBSUxBQkxFOiBcInVuYXZhaWxhYmxlXCIsXG4gICAgLyoqIFVucmVjb3ZlcmFibGUgZGF0YSBsb3NzIG9yIGNvcnJ1cHRpb24uICovXG4gICAgREFUQV9MT1NTOiBcImRhdGEtbG9zc1wiXG59O1xuXG4vKiogQW4gZXJyb3IgcmV0dXJuZWQgYnkgYSBGaXJlc3RvcmUgb3BlcmF0aW9uLiAqLyBjbGFzcyBGaXJlc3RvcmVFcnJvciBleHRlbmRzIEZpcmViYXNlRXJyb3Ige1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGJhY2tlbmQgZXJyb3IgY29kZSBhc3NvY2lhdGVkIHdpdGggdGhpcyBlcnJvci5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBBIGN1c3RvbSBlcnJvciBkZXNjcmlwdGlvbi5cbiAgICAgKi9cbiAgICB0KSB7XG4gICAgICAgIHN1cGVyKGUsIHQpLCB0aGlzLmNvZGUgPSBlLCB0aGlzLm1lc3NhZ2UgPSB0LCBcbiAgICAgICAgLy8gSEFDSzogV2Ugd3JpdGUgYSB0b1N0cmluZyBwcm9wZXJ0eSBkaXJlY3RseSBiZWNhdXNlIEVycm9yIGlzIG5vdCBhIHJlYWxcbiAgICAgICAgLy8gY2xhc3MgYW5kIHNvIGluaGVyaXRhbmNlIGRvZXMgbm90IHdvcmsgY29ycmVjdGx5LiBXZSBjb3VsZCBhbHRlcm5hdGl2ZWx5XG4gICAgICAgIC8vIGRvIHRoZSBzYW1lIFwiYmFjay1kb29yIGluaGVyaXRhbmNlXCIgdHJpY2sgdGhhdCBGaXJlYmFzZUVycm9yIGRvZXMuXG4gICAgICAgIHRoaXMudG9TdHJpbmcgPSAoKSA9PiBgJHt0aGlzLm5hbWV9OiBbY29kZT0ke3RoaXMuY29kZX1dOiAke3RoaXMubWVzc2FnZX1gO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX0RlZmVycmVkIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5wcm9taXNlID0gbmV3IFByb21pc2UoKChlLCB0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlc29sdmUgPSBlLCB0aGlzLnJlamVjdCA9IHQ7XG4gICAgICAgIH0pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9PQXV0aFRva2VuIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMudXNlciA9IHQsIHRoaXMudHlwZSA9IFwiT0F1dGhcIiwgdGhpcy5oZWFkZXJzID0gbmV3IE1hcCwgdGhpcy5oZWFkZXJzLnNldChcIkF1dGhvcml6YXRpb25cIiwgYEJlYXJlciAke2V9YCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgQ3JlZGVudGlhbHNQcm92aWRlciB0aGF0IGFsd2F5cyB5aWVsZHMgYW4gZW1wdHkgdG9rZW4uXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBfX1BSSVZBVEVfRW1wdHlBdXRoQ3JlZGVudGlhbHNQcm92aWRlciB7XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG4gICAgc3RhcnQoZSwgdCkge1xuICAgICAgICAvLyBGaXJlIHdpdGggaW5pdGlhbCB1c2VyLlxuICAgICAgICBlLmVucXVldWVSZXRyeWFibGUoKCgpID0+IHQoVXNlci5VTkFVVEhFTlRJQ0FURUQpKSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge31cbn1cblxuLyoqXG4gKiBBIENyZWRlbnRpYWxzUHJvdmlkZXIgdGhhdCBhbHdheXMgcmV0dXJucyBhIGNvbnN0YW50IHRva2VuLiBVc2VkIGZvclxuICogZW11bGF0b3IgdG9rZW4gbW9ja2luZy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRW11bGF0b3JBdXRoQ3JlZGVudGlhbHNQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnRva2VuID0gZSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTdG9yZXMgdGhlIGxpc3RlbmVyIHJlZ2lzdGVyZWQgd2l0aCBzZXRDaGFuZ2VMaXN0ZW5lcigpXG4gICAgICAgICAqIFRoaXMgaXNuJ3QgYWN0dWFsbHkgbmVjZXNzYXJ5IHNpbmNlIHRoZSBVSUQgbmV2ZXIgY2hhbmdlcywgYnV0IHdlIHVzZSB0aGlzXG4gICAgICAgICAqIHRvIHZlcmlmeSB0aGUgbGlzdGVuIGNvbnRyYWN0IGlzIGFkaGVyZWQgdG8gaW4gdGVzdHMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gbnVsbDtcbiAgICB9XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUodGhpcy50b2tlbik7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHt9XG4gICAgc3RhcnQoZSwgdCkge1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gdCwgXG4gICAgICAgIC8vIEZpcmUgd2l0aCBpbml0aWFsIHVzZXIuXG4gICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdCh0aGlzLnRva2VuLnVzZXIpKSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB0aGlzLmNoYW5nZUxpc3RlbmVyID0gbnVsbDtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9GaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudCA9IGUsIFxuICAgICAgICAvKiogVHJhY2tzIHRoZSBjdXJyZW50IFVzZXIuICovXG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBVc2VyLlVOQVVUSEVOVElDQVRFRCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb3VudGVyIHVzZWQgdG8gZGV0ZWN0IGlmIHRoZSB0b2tlbiBjaGFuZ2VkIHdoaWxlIGEgZ2V0VG9rZW4gcmVxdWVzdCB3YXNcbiAgICAgICAgICogb3V0c3RhbmRpbmcuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmkgPSAwLCB0aGlzLmZvcmNlUmVmcmVzaCA9ICExLCB0aGlzLmF1dGggPSBudWxsO1xuICAgIH1cbiAgICBzdGFydChlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KHZvaWQgMCA9PT0gdGhpcy5vKTtcbiAgICAgICAgbGV0IG4gPSB0aGlzLmk7XG4gICAgICAgIC8vIEEgY2hhbmdlIGxpc3RlbmVyIHRoYXQgcHJldmVudHMgZG91YmxlLWZpcmluZyBmb3IgdGhlIHNhbWUgdG9rZW4gY2hhbmdlLlxuICAgICAgICAgICAgICAgIGNvbnN0IF9fUFJJVkFURV9ndWFyZGVkQ2hhbmdlTGlzdGVuZXIgPSBlID0+IHRoaXMuaSAhPT0gbiA/IChuID0gdGhpcy5pLCBcbiAgICAgICAgdChlKSkgOiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgLy8gQSBwcm9taXNlIHRoYXQgY2FuIGJlIHdhaXRlZCBvbiB0byBibG9jayBvbiB0aGUgbmV4dCB0b2tlbiBjaGFuZ2UuXG4gICAgICAgIC8vIFRoaXMgcHJvbWlzZSBpcyByZS1jcmVhdGVkIGFmdGVyIGVhY2ggY2hhbmdlLlxuICAgICAgICAgICAgICAgIGxldCByID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICAgICAgdGhpcy5vID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5pKyssIHRoaXMuY3VycmVudFVzZXIgPSB0aGlzLnUoKSwgci5yZXNvbHZlKCksIHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkLCBcbiAgICAgICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gX19QUklWQVRFX2d1YXJkZWRDaGFuZ2VMaXN0ZW5lcih0aGlzLmN1cnJlbnRVc2VyKSkpO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBfX1BSSVZBVEVfYXdhaXROZXh0VG9rZW4gPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gcjtcbiAgICAgICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGF3YWl0IHQucHJvbWlzZSwgYXdhaXQgX19QUklWQVRFX2d1YXJkZWRDaGFuZ2VMaXN0ZW5lcih0aGlzLmN1cnJlbnRVc2VyKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSwgX19QUklWQVRFX3JlZ2lzdGVyQXV0aCA9IGUgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlclwiLCBcIkF1dGggZGV0ZWN0ZWRcIiksIHRoaXMuYXV0aCA9IGUsIFxuICAgICAgICAgICAgdGhpcy5vICYmICh0aGlzLmF1dGguYWRkQXV0aFRva2VuTGlzdGVuZXIodGhpcy5vKSwgX19QUklWQVRFX2F3YWl0TmV4dFRva2VuKCkpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLnQub25Jbml0KChlID0+IF9fUFJJVkFURV9yZWdpc3RlckF1dGgoZSkpKSwgXG4gICAgICAgIC8vIE91ciB1c2VycyBjYW4gaW5pdGlhbGl6ZSBBdXRoIHJpZ2h0IGFmdGVyIEZpcmVzdG9yZSwgc28gd2UgZ2l2ZSBpdFxuICAgICAgICAvLyBhIGNoYW5jZSB0byByZWdpc3RlciBpdHNlbGYgd2l0aCB0aGUgY29tcG9uZW50IGZyYW1ld29yayBiZWZvcmUgd2VcbiAgICAgICAgLy8gZGV0ZXJtaW5lIHdoZXRoZXIgdG8gc3RhcnQgdXAgaW4gdW5hdXRoZW50aWNhdGVkIG1vZGUuXG4gICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5hdXRoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMudC5nZXRJbW1lZGlhdGUoe1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25hbDogITBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBlID8gX19QUklWQVRFX3JlZ2lzdGVyQXV0aChlKSA6IChcbiAgICAgICAgICAgICAgICAvLyBJZiBhdXRoIGlzIHN0aWxsIG5vdCBhdmFpbGFibGUsIHByb2NlZWQgd2l0aCBgbnVsbGAgdXNlclxuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXJcIiwgXCJBdXRoIG5vdCB5ZXQgZGV0ZWN0ZWRcIiksIFxuICAgICAgICAgICAgICAgIHIucmVzb2x2ZSgpLCByID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCAwKSwgX19QUklWQVRFX2F3YWl0TmV4dFRva2VuKCk7XG4gICAgfVxuICAgIGdldFRva2VuKCkge1xuICAgICAgICAvLyBUYWtlIG5vdGUgb2YgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIHRva2VuQ291bnRlciBzbyB0aGF0IHRoaXMgbWV0aG9kXG4gICAgICAgIC8vIGNhbiBmYWlsICh3aXRoIGFuIEFCT1JURUQgZXJyb3IpIGlmIHRoZXJlIGlzIGEgdG9rZW4gY2hhbmdlIHdoaWxlIHRoZVxuICAgICAgICAvLyByZXF1ZXN0IGlzIG91dHN0YW5kaW5nLlxuICAgICAgICBjb25zdCBlID0gdGhpcy5pLCB0ID0gdGhpcy5mb3JjZVJlZnJlc2g7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcmNlUmVmcmVzaCA9ICExLCB0aGlzLmF1dGggPyB0aGlzLmF1dGguZ2V0VG9rZW4odCkudGhlbigodCA9PiBcbiAgICAgICAgLy8gQ2FuY2VsIHRoZSByZXF1ZXN0IHNpbmNlIHRoZSB0b2tlbiBjaGFuZ2VkIHdoaWxlIHRoZSByZXF1ZXN0IHdhc1xuICAgICAgICAvLyBvdXRzdGFuZGluZyBzbyB0aGUgcmVzcG9uc2UgaXMgcG90ZW50aWFsbHkgZm9yIGEgcHJldmlvdXMgdXNlciAod2hpY2hcbiAgICAgICAgLy8gdXNlciwgd2UgY2FuJ3QgYmUgc3VyZSkuXG4gICAgICAgIHRoaXMuaSAhPT0gZSA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJGaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyXCIsIFwiZ2V0VG9rZW4gYWJvcnRlZCBkdWUgdG8gdG9rZW4gY2hhbmdlLlwiKSwgXG4gICAgICAgIHRoaXMuZ2V0VG9rZW4oKSkgOiB0ID8gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwic3RyaW5nXCIgPT0gdHlwZW9mIHQuYWNjZXNzVG9rZW4pLCBcbiAgICAgICAgbmV3IF9fUFJJVkFURV9PQXV0aFRva2VuKHQuYWNjZXNzVG9rZW4sIHRoaXMuY3VycmVudFVzZXIpKSA6IG51bGwpKSA6IFByb21pc2UucmVzb2x2ZShudWxsKTtcbiAgICB9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge1xuICAgICAgICB0aGlzLmZvcmNlUmVmcmVzaCA9ICEwO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHtcbiAgICAgICAgdGhpcy5hdXRoICYmIHRoaXMubyAmJiB0aGlzLmF1dGgucmVtb3ZlQXV0aFRva2VuTGlzdGVuZXIodGhpcy5vKSwgdGhpcy5vID0gdm9pZCAwO1xuICAgIH1cbiAgICAvLyBBdXRoLmdldFVpZCgpIGNhbiByZXR1cm4gbnVsbCBldmVuIHdpdGggYSB1c2VyIGxvZ2dlZCBpbi4gSXQgaXMgYmVjYXVzZVxuICAgIC8vIGdldFVpZCgpIGlzIHN5bmNocm9ub3VzLCBidXQgdGhlIGF1dGggY29kZSBwb3B1bGF0aW5nIFVpZCBpcyBhc3luY2hyb25vdXMuXG4gICAgLy8gVGhpcyBtZXRob2Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGluIHRoZSBBdXRoVG9rZW5MaXN0ZW5lciBjYWxsYmFja1xuICAgIC8vIHRvIGd1YXJhbnRlZSB0byBnZXQgdGhlIGFjdHVhbCB1c2VyLlxuICAgIHUoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmF1dGggJiYgdGhpcy5hdXRoLmdldFVpZCgpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQobnVsbCA9PT0gZSB8fCBcInN0cmluZ1wiID09IHR5cGVvZiBlKSwgbmV3IFVzZXIoZSk7XG4gICAgfVxufVxuXG4vKlxuICogRmlyc3RQYXJ0eVRva2VuIHByb3ZpZGVzIGEgZnJlc2ggdG9rZW4gZWFjaCB0aW1lIGl0cyB2YWx1ZVxuICogaXMgcmVxdWVzdGVkLCBiZWNhdXNlIGlmIHRoZSB0b2tlbiBpcyB0b28gb2xkLCByZXF1ZXN0cyB3aWxsIGJlIHJlamVjdGVkLlxuICogVGVjaG5pY2FsbHkgdGhpcyBtYXkgbm8gbG9uZ2VyIGJlIG5lY2Vzc2FyeSBzaW5jZSB0aGUgU0RLIHNob3VsZCBncmFjZWZ1bGx5XG4gKiByZWNvdmVyIGZyb20gdW5hdXRoZW50aWNhdGVkIGVycm9ycyAoc2VlIGIvMzMxNDc4MTggZm9yIGNvbnRleHQpLCBidXQgaXQnc1xuICogc2FmZXIgdG8ga2VlcCB0aGUgaW1wbGVtZW50YXRpb24gYXMtaXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX0ZpcnN0UGFydHlUb2tlbiB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLmwgPSBlLCB0aGlzLmggPSB0LCB0aGlzLlAgPSBuLCB0aGlzLnR5cGUgPSBcIkZpcnN0UGFydHlcIiwgdGhpcy51c2VyID0gVXNlci5GSVJTVF9QQVJUWSwgXG4gICAgICAgIHRoaXMuVCA9IG5ldyBNYXA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgYW4gYXV0aG9yaXphdGlvbiB0b2tlbiwgdXNpbmcgYSBwcm92aWRlZCBmYWN0b3J5IGZ1bmN0aW9uLCBvciByZXR1cm5cbiAgICAgKiBudWxsLlxuICAgICAqLyAgICBJKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5QID8gdGhpcy5QKCkgOiBudWxsO1xuICAgIH1cbiAgICBnZXQgaGVhZGVycygpIHtcbiAgICAgICAgdGhpcy5ULnNldChcIlgtR29vZy1BdXRoVXNlclwiLCB0aGlzLmwpO1xuICAgICAgICAvLyBVc2UgYXJyYXkgbm90YXRpb24gdG8gcHJldmVudCBtaW5pZmljYXRpb25cbiAgICAgICAgY29uc3QgZSA9IHRoaXMuSSgpO1xuICAgICAgICByZXR1cm4gZSAmJiB0aGlzLlQuc2V0KFwiQXV0aG9yaXphdGlvblwiLCBlKSwgdGhpcy5oICYmIHRoaXMuVC5zZXQoXCJYLUdvb2ctSWFtLUF1dGhvcml6YXRpb24tVG9rZW5cIiwgdGhpcy5oKSwgXG4gICAgICAgIHRoaXMuVDtcbiAgICB9XG59XG5cbi8qXG4gKiBQcm92aWRlcyB1c2VyIGNyZWRlbnRpYWxzIHJlcXVpcmVkIGZvciB0aGUgRmlyZXN0b3JlIEphdmFTY3JpcHQgU0RLXG4gKiB0byBhdXRoZW50aWNhdGUgdGhlIHVzZXIsIHVzaW5nIHRlY2huaXF1ZSB0aGF0IGlzIG9ubHkgYXZhaWxhYmxlXG4gKiB0byBhcHBsaWNhdGlvbnMgaG9zdGVkIGJ5IEdvb2dsZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfRmlyc3RQYXJ0eUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMubCA9IGUsIHRoaXMuaCA9IHQsIHRoaXMuUCA9IG47XG4gICAgfVxuICAgIGdldFRva2VuKCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBfX1BSSVZBVEVfRmlyc3RQYXJ0eVRva2VuKHRoaXMubCwgdGhpcy5oLCB0aGlzLlApKTtcbiAgICB9XG4gICAgc3RhcnQoZSwgdCkge1xuICAgICAgICAvLyBGaXJlIHdpdGggaW5pdGlhbCB1aWQuXG4gICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gdChVc2VyLkZJUlNUX1BBUlRZKSkpO1xuICAgIH1cbiAgICBzaHV0ZG93bigpIHt9XG4gICAgaW52YWxpZGF0ZVRva2VuKCkge31cbn1cblxuY2xhc3MgQXBwQ2hlY2tUb2tlbiB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gZSwgdGhpcy50eXBlID0gXCJBcHBDaGVja1wiLCB0aGlzLmhlYWRlcnMgPSBuZXcgTWFwLCBlICYmIGUubGVuZ3RoID4gMCAmJiB0aGlzLmhlYWRlcnMuc2V0KFwieC1maXJlYmFzZS1hcHBjaGVja1wiLCB0aGlzLnZhbHVlKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9GaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IodCwgbikge1xuICAgICAgICB0aGlzLkEgPSBuLCB0aGlzLmZvcmNlUmVmcmVzaCA9ICExLCB0aGlzLmFwcENoZWNrID0gbnVsbCwgdGhpcy5SID0gbnVsbCwgdGhpcy5WID0gbnVsbCwgXG4gICAgICAgIF9pc0ZpcmViYXNlU2VydmVyQXBwKHQpICYmIHQuc2V0dGluZ3MuYXBwQ2hlY2tUb2tlbiAmJiAodGhpcy5WID0gdC5zZXR0aW5ncy5hcHBDaGVja1Rva2VuKTtcbiAgICB9XG4gICAgc3RhcnQoZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCh2b2lkIDAgPT09IHRoaXMubyk7XG4gICAgICAgIGNvbnN0IG9uVG9rZW5DaGFuZ2VkID0gZSA9PiB7XG4gICAgICAgICAgICBudWxsICE9IGUuZXJyb3IgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgYEVycm9yIGdldHRpbmcgQXBwIENoZWNrIHRva2VuOyB1c2luZyBwbGFjZWhvbGRlciB0b2tlbiBpbnN0ZWFkLiBFcnJvcjogJHtlLmVycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgICAgICBjb25zdCBuID0gZS50b2tlbiAhPT0gdGhpcy5SO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuUiA9IGUudG9rZW4sIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIGBSZWNlaXZlZCAke24gPyBcIm5ld1wiIDogXCJleGlzdGluZ1wifSB0b2tlbi5gKSwgXG4gICAgICAgICAgICBuID8gdChlLnRva2VuKSA6IFByb21pc2UucmVzb2x2ZSgpO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm8gPSB0ID0+IHtcbiAgICAgICAgICAgIGUuZW5xdWV1ZVJldHJ5YWJsZSgoKCkgPT4gb25Ub2tlbkNoYW5nZWQodCkpKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgX19QUklWQVRFX3JlZ2lzdGVyQXBwQ2hlY2sgPSBlID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkZpcmViYXNlQXBwQ2hlY2tUb2tlblByb3ZpZGVyXCIsIFwiQXBwQ2hlY2sgZGV0ZWN0ZWRcIiksIHRoaXMuYXBwQ2hlY2sgPSBlLCBcbiAgICAgICAgICAgIHRoaXMubyAmJiB0aGlzLmFwcENoZWNrLmFkZFRva2VuTGlzdGVuZXIodGhpcy5vKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5BLm9uSW5pdCgoZSA9PiBfX1BSSVZBVEVfcmVnaXN0ZXJBcHBDaGVjayhlKSkpLCBcbiAgICAgICAgLy8gT3VyIHVzZXJzIGNhbiBpbml0aWFsaXplIEFwcENoZWNrIGFmdGVyIEZpcmVzdG9yZSwgc28gd2UgZ2l2ZSBpdFxuICAgICAgICAvLyBhIGNoYW5jZSB0byByZWdpc3RlciBpdHNlbGYgd2l0aCB0aGUgY29tcG9uZW50IGZyYW1ld29yay5cbiAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFwcENoZWNrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuQS5nZXRJbW1lZGlhdGUoe1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25hbDogITBcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBlID8gX19QUklWQVRFX3JlZ2lzdGVyQXBwQ2hlY2soZSkgOiBcbiAgICAgICAgICAgICAgICAvLyBJZiBBcHBDaGVjayBpcyBzdGlsbCBub3QgYXZhaWxhYmxlLCBwcm9jZWVkIHdpdGhvdXQgaXQuXG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFwiRmlyZWJhc2VBcHBDaGVja1Rva2VuUHJvdmlkZXJcIiwgXCJBcHBDaGVjayBub3QgeWV0IGRldGVjdGVkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSwgMCk7XG4gICAgfVxuICAgIGdldFRva2VuKCkge1xuICAgICAgICBpZiAodGhpcy5WKSByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKG5ldyBBcHBDaGVja1Rva2VuKHRoaXMuVikpO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5mb3JjZVJlZnJlc2g7XG4gICAgICAgIHJldHVybiB0aGlzLmZvcmNlUmVmcmVzaCA9ICExLCB0aGlzLmFwcENoZWNrID8gdGhpcy5hcHBDaGVjay5nZXRUb2tlbihlKS50aGVuKChlID0+IGUgPyAoX19QUklWQVRFX2hhcmRBc3NlcnQoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZS50b2tlbiksIFxuICAgICAgICB0aGlzLlIgPSBlLnRva2VuLCBuZXcgQXBwQ2hlY2tUb2tlbihlLnRva2VuKSkgOiBudWxsKSkgOiBQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGludmFsaWRhdGVUb2tlbigpIHtcbiAgICAgICAgdGhpcy5mb3JjZVJlZnJlc2ggPSAhMDtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuYXBwQ2hlY2sgJiYgdGhpcy5vICYmIHRoaXMuYXBwQ2hlY2sucmVtb3ZlVG9rZW5MaXN0ZW5lcih0aGlzLm8pLCB0aGlzLm8gPSB2b2lkIDA7XG4gICAgfVxufVxuXG4vKipcbiAqIEFuIEFwcENoZWNrIHRva2VuIHByb3ZpZGVyIHRoYXQgYWx3YXlzIHlpZWxkcyBhbiBlbXB0eSB0b2tlbi5cbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIF9fUFJJVkFURV9FbXB0eUFwcENoZWNrVG9rZW5Qcm92aWRlciB7XG4gICAgZ2V0VG9rZW4oKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUobmV3IEFwcENoZWNrVG9rZW4oXCJcIikpO1xuICAgIH1cbiAgICBpbnZhbGlkYXRlVG9rZW4oKSB7fVxuICAgIHN0YXJ0KGUsIHQpIHt9XG4gICAgc2h1dGRvd24oKSB7fVxufVxuXG4vKipcbiAqIEJ1aWxkcyBhIENyZWRlbnRpYWxzUHJvdmlkZXIgZGVwZW5kaW5nIG9uIHRoZSB0eXBlIG9mXG4gKiB0aGUgY3JlZGVudGlhbHMgcGFzc2VkIGluLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgYG5CeXRlc2Agb2YgcmFuZG9tIGJ5dGVzLlxuICpcbiAqIElmIGBuQnl0ZXMgPCAwYCAsIGFuIGVycm9yIHdpbGwgYmUgdGhyb3duLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmFuZG9tQnl0ZXMoZSkge1xuICAgIC8vIFBvbHlmaWxscyBmb3IgSUUgYW5kIFdlYldvcmtlciBieSB1c2luZyBgc2VsZmAgYW5kIGBtc0NyeXB0b2Agd2hlbiBgY3J5cHRvYCBpcyBub3QgYXZhaWxhYmxlLlxuICAgIGNvbnN0IHQgPSBcbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHNlbGYgJiYgKHNlbGYuY3J5cHRvIHx8IHNlbGYubXNDcnlwdG8pLCBuID0gbmV3IFVpbnQ4QXJyYXkoZSk7XG4gICAgaWYgKHQgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB0LmdldFJhbmRvbVZhbHVlcykgdC5nZXRSYW5kb21WYWx1ZXMobik7IGVsc2UgXG4gICAgLy8gRmFsbHMgYmFjayB0byBNYXRoLnJhbmRvbVxuICAgIGZvciAobGV0IHQgPSAwOyB0IDwgZTsgdCsrKSBuW3RdID0gTWF0aC5mbG9vcigyNTYgKiBNYXRoLnJhbmRvbSgpKTtcbiAgICByZXR1cm4gbjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW5zdGFuY2Ugb2YgdGhlIFBsYXRmb3JtJ3MgJ1RleHRFbmNvZGVyJyBpbXBsZW1lbnRhdGlvbi5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3VGV4dEVuY29kZXIoKSB7XG4gICAgcmV0dXJuIG5ldyBUZXh0RW5jb2Rlcjtcbn1cblxuLyoqXG4gKiBBbiBpbnN0YW5jZSBvZiB0aGUgUGxhdGZvcm0ncyAnVGV4dERlY29kZXInIGltcGxlbWVudGF0aW9uLlxuICovXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHV0aWxpdHkgY2xhc3MgZm9yIGdlbmVyYXRpbmcgdW5pcXVlIGFscGhhbnVtZXJpYyBJRHMgb2YgYSBzcGVjaWZpZWQgbGVuZ3RoLlxuICpcbiAqIEBpbnRlcm5hbFxuICogRXhwb3J0ZWQgaW50ZXJuYWxseSBmb3IgdGVzdGluZyBwdXJwb3Nlcy5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0F1dG9JZCB7XG4gICAgc3RhdGljIG5ld0lkKCkge1xuICAgICAgICAvLyBBbHBoYW51bWVyaWMgY2hhcmFjdGVyc1xuICAgICAgICBjb25zdCBlID0gXCJBQkNERUZHSElKS0xNTk9QUVJTVFVWV1hZWmFiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6MDEyMzQ1Njc4OVwiLCB0ID0gNjIgKiBNYXRoLmZsb29yKDI1NiAvIDYyKTtcbiAgICAgICAgLy8gVGhlIGxhcmdlc3QgYnl0ZSB2YWx1ZSB0aGF0IGlzIGEgbXVsdGlwbGUgb2YgYGNoYXIubGVuZ3RoYC5cbiAgICAgICAgICAgICAgICBsZXQgbiA9IFwiXCI7XG4gICAgICAgIGZvciAoO24ubGVuZ3RoIDwgMjA7ICkge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9yYW5kb21CeXRlcyg0MCk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHIubGVuZ3RoOyArK2kpIFxuICAgICAgICAgICAgLy8gT25seSBhY2NlcHQgdmFsdWVzIHRoYXQgYXJlIFswLCBtYXhNdWx0aXBsZSksIHRoaXMgZW5zdXJlcyB0aGV5IGNhblxuICAgICAgICAgICAgLy8gYmUgZXZlbmx5IG1hcHBlZCB0byBpbmRpY2VzIG9mIGBjaGFyc2AgdmlhIGEgbW9kdWxvIG9wZXJhdGlvbi5cbiAgICAgICAgICAgIG4ubGVuZ3RoIDwgMjAgJiYgcltpXSA8IHQgJiYgKG4gKz0gZS5jaGFyQXQocltpXSAlIDYyKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLCB0KSB7XG4gICAgcmV0dXJuIGUgPCB0ID8gLTEgOiBlID4gdCA/IDEgOiAwO1xufVxuXG4vKiogQ29tcGFyZSBzdHJpbmdzIGluIFVURi04IGVuY29kZWQgYnl0ZSBvcmRlciAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZVV0ZjhTdHJpbmdzKGUsIHQpIHtcbiAgICBsZXQgbiA9IDA7XG4gICAgZm9yICg7biA8IGUubGVuZ3RoICYmIG4gPCB0Lmxlbmd0aDsgKSB7XG4gICAgICAgIGNvbnN0IHIgPSBlLmNvZGVQb2ludEF0KG4pLCBpID0gdC5jb2RlUG9pbnRBdChuKTtcbiAgICAgICAgaWYgKHIgIT09IGkpIHtcbiAgICAgICAgICAgIGlmIChyIDwgMTI4ICYmIGkgPCAxMjgpIFxuICAgICAgICAgICAgLy8gQVNDSUkgY29tcGFyaXNvblxuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHIsIGkpO1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8vIExhenkgaW5zdGFudGlhdGUgVGV4dEVuY29kZXJcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX25ld1RleHRFbmNvZGVyKCksIG8gPSBfX1BSSVZBVEVfY29tcGFyZUJ5dGVBcnJheXMkMShzLmVuY29kZShfX1BSSVZBVEVfZ2V0VXRmOFNhZmVTdWJzdHJpbmcoZSwgbikpLCBzLmVuY29kZShfX1BSSVZBVEVfZ2V0VXRmOFNhZmVTdWJzdHJpbmcodCwgbikpKTtcbiAgICAgICAgICAgICAgICAvLyBVVEYtOCBlbmNvZGUgdGhlIGNoYXJhY3RlciBhdCBpbmRleCBpIGZvciBieXRlIGNvbXBhcmlzb24uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiAwICE9PSBvID8gbyA6IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHIsIGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIEluY3JlbWVudCBieSAyIGZvciBzdXJyb2dhdGUgcGFpcnMsIDEgb3RoZXJ3aXNlXG4gICAgICAgICAgICAgICAgbiArPSByID4gNjU1MzUgPyAyIDogMTtcbiAgICB9XG4gICAgLy8gQ29tcGFyZSBsZW5ndGhzIGlmIGFsbCBjaGFyYWN0ZXJzIGFyZSBlcXVhbFxuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5sZW5ndGgsIHQubGVuZ3RoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFV0ZjhTYWZlU3Vic3RyaW5nKGUsIHQpIHtcbiAgICByZXR1cm4gZS5jb2RlUG9pbnRBdCh0KSA+IDY1NTM1ID8gZS5zdWJzdHJpbmcodCwgdCArIDIpIDogZS5zdWJzdHJpbmcodCwgdCArIDEpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUJ5dGVBcnJheXMkMShlLCB0KSB7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aCAmJiBuIDwgdC5sZW5ndGg7ICsrbikgaWYgKGVbbl0gIT09IHRbbl0pIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlW25dLCB0W25dKTtcbiAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5sZW5ndGgsIHQubGVuZ3RoKTtcbn1cblxuLyoqIEhlbHBlciB0byBjb21wYXJlIGFycmF5cyB1c2luZyBpc0VxdWFsKCkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcnJheUVxdWFscyhlLCB0LCBuKSB7XG4gICAgcmV0dXJuIGUubGVuZ3RoID09PSB0Lmxlbmd0aCAmJiBlLmV2ZXJ5KCgoZSwgcikgPT4gbihlLCB0W3JdKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGltbWVkaWF0ZSBsZXhpY29ncmFwaGljYWxseS1mb2xsb3dpbmcgc3RyaW5nLiBUaGlzIGlzIHVzZWZ1bCB0b1xuICogY29uc3RydWN0IGFuIGluY2x1c2l2ZSByYW5nZSBmb3IgaW5kZXhlZGRiIGl0ZXJhdG9ycy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW1tZWRpYXRlU3VjY2Vzc29yKGUpIHtcbiAgICAvLyBSZXR1cm4gdGhlIGlucHV0IHN0cmluZywgd2l0aCBhbiBhZGRpdGlvbmFsIE5VTCBieXRlIGFwcGVuZGVkLlxuICAgIHJldHVybiBlICsgXCJcXDBcIjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRoZSBlYXJsaWVzdCBkYXRlIHN1cHBvcnRlZCBieSBGaXJlc3RvcmUgdGltZXN0YW1wcyAoMDAwMS0wMS0wMVQwMDowMDowMFopLlxuY29uc3QgRiA9IC02MjEzNTU5NjgwMCwgTSA9IDFlNjtcblxuLy8gTnVtYmVyIG9mIG5hbm9zZWNvbmRzIGluIGEgbWlsbGlzZWNvbmQuXG4vKipcbiAqIEEgYFRpbWVzdGFtcGAgcmVwcmVzZW50cyBhIHBvaW50IGluIHRpbWUgaW5kZXBlbmRlbnQgb2YgYW55IHRpbWUgem9uZSBvclxuICogY2FsZW5kYXIsIHJlcHJlc2VudGVkIGFzIHNlY29uZHMgYW5kIGZyYWN0aW9ucyBvZiBzZWNvbmRzIGF0IG5hbm9zZWNvbmRcbiAqIHJlc29sdXRpb24gaW4gVVRDIEVwb2NoIHRpbWUuXG4gKlxuICogSXQgaXMgZW5jb2RlZCB1c2luZyB0aGUgUHJvbGVwdGljIEdyZWdvcmlhbiBDYWxlbmRhciB3aGljaCBleHRlbmRzIHRoZVxuICogR3JlZ29yaWFuIGNhbGVuZGFyIGJhY2t3YXJkcyB0byB5ZWFyIG9uZS4gSXQgaXMgZW5jb2RlZCBhc3N1bWluZyBhbGwgbWludXRlc1xuICogYXJlIDYwIHNlY29uZHMgbG9uZywgaS5lLiBsZWFwIHNlY29uZHMgYXJlIFwic21lYXJlZFwiIHNvIHRoYXQgbm8gbGVhcCBzZWNvbmRcbiAqIHRhYmxlIGlzIG5lZWRlZCBmb3IgaW50ZXJwcmV0YXRpb24uIFJhbmdlIGlzIGZyb20gMDAwMS0wMS0wMVQwMDowMDowMFogdG9cbiAqIDk5OTktMTItMzFUMjM6NTk6NTkuOTk5OTk5OTk5Wi5cbiAqXG4gKiBGb3IgZXhhbXBsZXMgYW5kIGZ1cnRoZXIgc3BlY2lmaWNhdGlvbnMsIHJlZmVyIHRvIHRoZVxuICoge0BsaW5rIGh0dHBzOi8vZ2l0aHViLmNvbS9nb29nbGUvcHJvdG9idWYvYmxvYi9tYXN0ZXIvc3JjL2dvb2dsZS9wcm90b2J1Zi90aW1lc3RhbXAucHJvdG8gfCBUaW1lc3RhbXAgZGVmaW5pdGlvbn0uXG4gKi9cbmNsYXNzIFRpbWVzdGFtcCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0aW1lc3RhbXAgd2l0aCB0aGUgY3VycmVudCBkYXRlLCB3aXRoIG1pbGxpc2Vjb25kIHByZWNpc2lvbi5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGEgbmV3IHRpbWVzdGFtcCByZXByZXNlbnRpbmcgdGhlIGN1cnJlbnQgZGF0ZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgbm93KCkge1xuICAgICAgICByZXR1cm4gVGltZXN0YW1wLmZyb21NaWxsaXMoRGF0ZS5ub3coKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wIGZyb20gdGhlIGdpdmVuIGRhdGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZGF0ZSAtIFRoZSBkYXRlIHRvIGluaXRpYWxpemUgdGhlIGBUaW1lc3RhbXBgIGZyb20uXG4gICAgICogQHJldHVybnMgQSBuZXcgYFRpbWVzdGFtcGAgcmVwcmVzZW50aW5nIHRoZSBzYW1lIHBvaW50IGluIHRpbWUgYXMgdGhlIGdpdmVuXG4gICAgICogICAgIGRhdGUuXG4gICAgICovICAgIHN0YXRpYyBmcm9tRGF0ZShlKSB7XG4gICAgICAgIHJldHVybiBUaW1lc3RhbXAuZnJvbU1pbGxpcyhlLmdldFRpbWUoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgdGltZXN0YW1wIGZyb20gdGhlIGdpdmVuIG51bWJlciBvZiBtaWxsaXNlY29uZHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gbWlsbGlzZWNvbmRzIC0gTnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoXG4gICAgICogICAgIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqIEByZXR1cm5zIEEgbmV3IGBUaW1lc3RhbXBgIHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzIHRoZSBnaXZlblxuICAgICAqICAgICBudW1iZXIgb2YgbWlsbGlzZWNvbmRzLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbU1pbGxpcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBNYXRoLmZsb29yKGUgLyAxZTMpLCBuID0gTWF0aC5mbG9vcigoZSAtIDFlMyAqIHQpICogTSk7XG4gICAgICAgIHJldHVybiBuZXcgVGltZXN0YW1wKHQsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRpbWVzdGFtcC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzZWNvbmRzIC0gVGhlIG51bWJlciBvZiBzZWNvbmRzIG9mIFVUQyB0aW1lIHNpbmNlIFVuaXggZXBvY2hcbiAgICAgKiAgICAgMTk3MC0wMS0wMVQwMDowMDowMFouIE11c3QgYmUgZnJvbSAwMDAxLTAxLTAxVDAwOjAwOjAwWiB0b1xuICAgICAqICAgICA5OTk5LTEyLTMxVDIzOjU5OjU5WiBpbmNsdXNpdmUuXG4gICAgICogQHBhcmFtIG5hbm9zZWNvbmRzIC0gVGhlIG5vbi1uZWdhdGl2ZSBmcmFjdGlvbnMgb2YgYSBzZWNvbmQgYXQgbmFub3NlY29uZFxuICAgICAqICAgICByZXNvbHV0aW9uLiBOZWdhdGl2ZSBzZWNvbmQgdmFsdWVzIHdpdGggZnJhY3Rpb25zIG11c3Qgc3RpbGwgaGF2ZVxuICAgICAqICAgICBub24tbmVnYXRpdmUgbmFub3NlY29uZHMgdmFsdWVzIHRoYXQgY291bnQgZm9yd2FyZCBpbiB0aW1lLiBNdXN0IGJlXG4gICAgICogICAgIGZyb20gMCB0byA5OTksOTk5LDk5OSBpbmNsdXNpdmUuXG4gICAgICovICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBudW1iZXIgb2Ygc2Vjb25kcyBvZiBVVEMgdGltZSBzaW5jZSBVbml4IGVwb2NoIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSBmcmFjdGlvbnMgb2YgYSBzZWNvbmQgYXQgbmFub3NlY29uZCByZXNvbHV0aW9uLipcbiAgICAgKi9cbiAgICB0KSB7XG4gICAgICAgIGlmICh0aGlzLnNlY29uZHMgPSBlLCB0aGlzLm5hbm9zZWNvbmRzID0gdCwgdCA8IDApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiVGltZXN0YW1wIG5hbm9zZWNvbmRzIG91dCBvZiByYW5nZTogXCIgKyB0KTtcbiAgICAgICAgaWYgKHQgPj0gMWU5KSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBuYW5vc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgdCk7XG4gICAgICAgIGlmIChlIDwgRikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJUaW1lc3RhbXAgc2Vjb25kcyBvdXQgb2YgcmFuZ2U6IFwiICsgZSk7XG4gICAgICAgIC8vIFRoaXMgd2lsbCBicmVhayBpbiB0aGUgeWVhciAxMCwwMDAuXG4gICAgICAgICAgICAgICAgaWYgKGUgPj0gMjUzNDAyMzAwODAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIlRpbWVzdGFtcCBzZWNvbmRzIG91dCBvZiByYW5nZTogXCIgKyBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgYSBgVGltZXN0YW1wYCB0byBhIEphdmFTY3JpcHQgYERhdGVgIG9iamVjdC4gVGhpcyBjb252ZXJzaW9uXG4gICAgICogY2F1c2VzIGEgbG9zcyBvZiBwcmVjaXNpb24gc2luY2UgYERhdGVgIG9iamVjdHMgb25seSBzdXBwb3J0IG1pbGxpc2Vjb25kXG4gICAgICogcHJlY2lzaW9uLlxuICAgICAqXG4gICAgICogQHJldHVybnMgSmF2YVNjcmlwdCBgRGF0ZWAgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgc2FtZSBwb2ludCBpbiB0aW1lIGFzXG4gICAgICogICAgIHRoaXMgYFRpbWVzdGFtcGAsIHdpdGggbWlsbGlzZWNvbmQgcHJlY2lzaW9uLlxuICAgICAqLyAgICB0b0RhdGUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSh0aGlzLnRvTWlsbGlzKCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb252ZXJ0cyBhIGBUaW1lc3RhbXBgIHRvIGEgbnVtZXJpYyB0aW1lc3RhbXAgKGluIG1pbGxpc2Vjb25kcyBzaW5jZVxuICAgICAqIGVwb2NoKS4gVGhpcyBvcGVyYXRpb24gY2F1c2VzIGEgbG9zcyBvZiBwcmVjaXNpb24uXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgcG9pbnQgaW4gdGltZSBjb3JyZXNwb25kaW5nIHRvIHRoaXMgdGltZXN0YW1wLCByZXByZXNlbnRlZCBhc1xuICAgICAqICAgICB0aGUgbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBzaW5jZSBVbml4IGVwb2NoIDE5NzAtMDEtMDFUMDA6MDA6MDBaLlxuICAgICAqLyAgICB0b01pbGxpcygpIHtcbiAgICAgICAgcmV0dXJuIDFlMyAqIHRoaXMuc2Vjb25kcyArIHRoaXMubmFub3NlY29uZHMgLyBNO1xuICAgIH1cbiAgICBfY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2Vjb25kcyA9PT0gZS5zZWNvbmRzID8gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IodGhpcy5uYW5vc2Vjb25kcywgZS5uYW5vc2Vjb25kcykgOiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcih0aGlzLnNlY29uZHMsIGUuc2Vjb25kcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBUaW1lc3RhbXBgIGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3RoZXIgLSBUaGUgYFRpbWVzdGFtcGAgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgVGltZXN0YW1wYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUuc2Vjb25kcyA9PT0gdGhpcy5zZWNvbmRzICYmIGUubmFub3NlY29uZHMgPT09IHRoaXMubmFub3NlY29uZHM7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgdGV4dHVhbCByZXByZXNlbnRhdGlvbiBvZiB0aGlzIGBUaW1lc3RhbXBgLiAqLyAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIFwiVGltZXN0YW1wKHNlY29uZHM9XCIgKyB0aGlzLnNlY29uZHMgKyBcIiwgbmFub3NlY29uZHM9XCIgKyB0aGlzLm5hbm9zZWNvbmRzICsgXCIpXCI7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBgVGltZXN0YW1wYC4gKi8gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgc2Vjb25kczogdGhpcy5zZWNvbmRzLFxuICAgICAgICAgICAgbmFub3NlY29uZHM6IHRoaXMubmFub3NlY29uZHNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBvYmplY3QgdG8gYSBwcmltaXRpdmUgc3RyaW5nLCB3aGljaCBhbGxvd3MgYFRpbWVzdGFtcGAgb2JqZWN0c1xuICAgICAqIHRvIGJlIGNvbXBhcmVkIHVzaW5nIHRoZSBgPmAsIGA8PWAsIGA+PWAgYW5kIGA+YCBvcGVyYXRvcnMuXG4gICAgICovICAgIHZhbHVlT2YoKSB7XG4gICAgICAgIC8vIFRoaXMgbWV0aG9kIHJldHVybnMgYSBzdHJpbmcgb2YgdGhlIGZvcm0gPHNlY29uZHM+LjxuYW5vc2Vjb25kcz4gd2hlcmVcbiAgICAgICAgLy8gPHNlY29uZHM+IGlzIHRyYW5zbGF0ZWQgdG8gaGF2ZSBhIG5vbi1uZWdhdGl2ZSB2YWx1ZSBhbmQgYm90aCA8c2Vjb25kcz5cbiAgICAgICAgLy8gYW5kIDxuYW5vc2Vjb25kcz4gYXJlIGxlZnQtcGFkZGVkIHdpdGggemVyb2VzIHRvIGJlIGEgY29uc2lzdGVudCBsZW5ndGguXG4gICAgICAgIC8vIFN0cmluZ3Mgd2l0aCB0aGlzIGZvcm1hdCB0aGVuIGhhdmUgYSBsZXhpY29ncmFwaGljYWwgb3JkZXJpbmcgdGhhdCBtYXRjaGVzXG4gICAgICAgIC8vIHRoZSBleHBlY3RlZCBvcmRlcmluZy4gVGhlIDxzZWNvbmRzPiB0cmFuc2xhdGlvbiBpcyBkb25lIHRvIGF2b2lkIGhhdmluZ1xuICAgICAgICAvLyBhIGxlYWRpbmcgbmVnYXRpdmUgc2lnbiAoaS5lLiBhIGxlYWRpbmcgJy0nIGNoYXJhY3RlcikgaW4gaXRzIHN0cmluZ1xuICAgICAgICAvLyByZXByZXNlbnRhdGlvbiwgd2hpY2ggd291bGQgYWZmZWN0IGl0cyBsZXhpY29ncmFwaGljYWwgb3JkZXJpbmcuXG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnNlY29uZHMgLSBGO1xuICAgICAgICAvLyBOb3RlOiBVcCB0byAxMiBkZWNpbWFsIGRpZ2l0cyBhcmUgcmVxdWlyZWQgdG8gcmVwcmVzZW50IGFsbCB2YWxpZFxuICAgICAgICAvLyAnc2Vjb25kcycgdmFsdWVzLlxuICAgICAgICAgICAgICAgIHJldHVybiBTdHJpbmcoZSkucGFkU3RhcnQoMTIsIFwiMFwiKSArIFwiLlwiICsgU3RyaW5nKHRoaXMubmFub3NlY29uZHMpLnBhZFN0YXJ0KDksIFwiMFwiKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgdmVyc2lvbiBvZiBhIGRvY3VtZW50IGluIEZpcmVzdG9yZS4gVGhpcyBjb3JyZXNwb25kcyB0byB0aGUgdmVyc2lvblxuICogdGltZXN0YW1wLCBzdWNoIGFzIHVwZGF0ZV90aW1lIG9yIHJlYWRfdGltZS5cbiAqLyBjbGFzcyBTbmFwc2hvdFZlcnNpb24ge1xuICAgIHN0YXRpYyBmcm9tVGltZXN0YW1wKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTbmFwc2hvdFZlcnNpb24oZSk7XG4gICAgfVxuICAgIHN0YXRpYyBtaW4oKSB7XG4gICAgICAgIHJldHVybiBuZXcgU25hcHNob3RWZXJzaW9uKG5ldyBUaW1lc3RhbXAoMCwgMCkpO1xuICAgIH1cbiAgICBzdGF0aWMgbWF4KCkge1xuICAgICAgICByZXR1cm4gbmV3IFNuYXBzaG90VmVyc2lvbihuZXcgVGltZXN0YW1wKDI1MzQwMjMwMDc5OSwgOTk5OTk5OTk5KSk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy50aW1lc3RhbXAgPSBlO1xuICAgIH1cbiAgICBjb21wYXJlVG8oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lc3RhbXAuX2NvbXBhcmVUbyhlLnRpbWVzdGFtcCk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy50aW1lc3RhbXAuaXNFcXVhbChlLnRpbWVzdGFtcCk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgbnVtYmVyIHJlcHJlc2VudGF0aW9uIG9mIHRoZSB2ZXJzaW9uIGZvciB1c2UgaW4gc3BlYyB0ZXN0cy4gKi8gICAgdG9NaWNyb3NlY29uZHMoKSB7XG4gICAgICAgIC8vIENvbnZlcnQgdG8gbWljcm9zZWNvbmRzLlxuICAgICAgICByZXR1cm4gMWU2ICogdGhpcy50aW1lc3RhbXAuc2Vjb25kcyArIHRoaXMudGltZXN0YW1wLm5hbm9zZWNvbmRzIC8gMWUzO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIFwiU25hcHNob3RWZXJzaW9uKFwiICsgdGhpcy50aW1lc3RhbXAudG9TdHJpbmcoKSArIFwiKVwiO1xuICAgIH1cbiAgICB0b1RpbWVzdGFtcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGltZXN0YW1wO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgeCA9IFwiX19uYW1lX19cIjtcblxuLyoqXG4gKiBQYXRoIHJlcHJlc2VudHMgYW4gb3JkZXJlZCBzZXF1ZW5jZSBvZiBzdHJpbmcgc2VnbWVudHMuXG4gKi8gY2xhc3MgQmFzZVBhdGgge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdm9pZCAwID09PSB0ID8gdCA9IDAgOiB0ID4gZS5sZW5ndGggJiYgZmFpbCgpLCB2b2lkIDAgPT09IG4gPyBuID0gZS5sZW5ndGggLSB0IDogbiA+IGUubGVuZ3RoIC0gdCAmJiBmYWlsKCksIFxuICAgICAgICB0aGlzLnNlZ21lbnRzID0gZSwgdGhpcy5vZmZzZXQgPSB0LCB0aGlzLmxlbiA9IG47XG4gICAgfVxuICAgIGdldCBsZW5ndGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlbjtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiAwID09PSBCYXNlUGF0aC5jb21wYXJhdG9yKHRoaXMsIGUpO1xuICAgIH1cbiAgICBjaGlsZChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnNlZ21lbnRzLnNsaWNlKHRoaXMub2Zmc2V0LCB0aGlzLmxpbWl0KCkpO1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEJhc2VQYXRoID8gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQucHVzaChlKTtcbiAgICAgICAgfSkpIDogdC5wdXNoKGUpLCB0aGlzLmNvbnN0cnVjdCh0KTtcbiAgICB9XG4gICAgLyoqIFRoZSBpbmRleCBvZiBvbmUgcGFzdCB0aGUgbGFzdCBzZWdtZW50IG9mIHRoZSBwYXRoLiAqLyAgICBsaW1pdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2Zmc2V0ICsgdGhpcy5sZW5ndGg7XG4gICAgfVxuICAgIHBvcEZpcnN0KGUpIHtcbiAgICAgICAgcmV0dXJuIGUgPSB2b2lkIDAgPT09IGUgPyAxIDogZSwgdGhpcy5jb25zdHJ1Y3QodGhpcy5zZWdtZW50cywgdGhpcy5vZmZzZXQgKyBlLCB0aGlzLmxlbmd0aCAtIGUpO1xuICAgIH1cbiAgICBwb3BMYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3QodGhpcy5zZWdtZW50cywgdGhpcy5vZmZzZXQsIHRoaXMubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGZpcnN0U2VnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2VnbWVudHNbdGhpcy5vZmZzZXRdO1xuICAgIH1cbiAgICBsYXN0U2VnbWVudCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0KHRoaXMubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIGdldChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlZ21lbnRzW3RoaXMub2Zmc2V0ICsgZV07XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiAwID09PSB0aGlzLmxlbmd0aDtcbiAgICB9XG4gICAgaXNQcmVmaXhPZihlKSB7XG4gICAgICAgIGlmIChlLmxlbmd0aCA8IHRoaXMubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgICAgIGZvciAobGV0IHQgPSAwOyB0IDwgdGhpcy5sZW5ndGg7IHQrKykgaWYgKHRoaXMuZ2V0KHQpICE9PSBlLmdldCh0KSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGlzSW1tZWRpYXRlUGFyZW50T2YoZSkge1xuICAgICAgICBpZiAodGhpcy5sZW5ndGggKyAxICE9PSBlLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IHRoaXMubGVuZ3RoOyB0KyspIGlmICh0aGlzLmdldCh0KSAhPT0gZS5nZXQodCkpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgZm9yIChsZXQgdCA9IHRoaXMub2Zmc2V0LCBuID0gdGhpcy5saW1pdCgpOyB0IDwgbjsgdCsrKSBlKHRoaXMuc2VnbWVudHNbdF0pO1xuICAgIH1cbiAgICB0b0FycmF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZWdtZW50cy5zbGljZSh0aGlzLm9mZnNldCwgdGhpcy5saW1pdCgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tcGFyZSAyIHBhdGhzIHNlZ21lbnQgYnkgc2VnbWVudCwgcHJpb3JpdGl6aW5nIG51bWVyaWMgSURzXG4gICAgICogKGUuZy4sIFwiX19pZDEyM19fXCIpIGluIG51bWVyaWMgYXNjZW5kaW5nIG9yZGVyLCBmb2xsb3dlZCBieSBzdHJpbmdcbiAgICAgKiBzZWdtZW50cyBpbiBsZXhpY29ncmFwaGljYWwgb3JkZXIuXG4gICAgICovICAgIHN0YXRpYyBjb21wYXJhdG9yKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IE1hdGgubWluKGUubGVuZ3RoLCB0Lmxlbmd0aCk7XG4gICAgICAgIGZvciAobGV0IHIgPSAwOyByIDwgbjsgcisrKSB7XG4gICAgICAgICAgICBjb25zdCBuID0gQmFzZVBhdGguY29tcGFyZVNlZ21lbnRzKGUuZ2V0KHIpLCB0LmdldChyKSk7XG4gICAgICAgICAgICBpZiAoMCAhPT0gbikgcmV0dXJuIG47XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUubGVuZ3RoLCB0Lmxlbmd0aCk7XG4gICAgfVxuICAgIHN0YXRpYyBjb21wYXJlU2VnbWVudHMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gQmFzZVBhdGguaXNOdW1lcmljSWQoZSksIHIgPSBCYXNlUGF0aC5pc051bWVyaWNJZCh0KTtcbiAgICAgICAgcmV0dXJuIG4gJiYgIXIgPyAtMSA6ICFuICYmIHIgPyAxIDogbiAmJiByID8gQmFzZVBhdGguZXh0cmFjdE51bWVyaWNJZChlKS5jb21wYXJlKEJhc2VQYXRoLmV4dHJhY3ROdW1lcmljSWQodCkpIDogX19QUklWQVRFX2NvbXBhcmVVdGY4U3RyaW5ncyhlLCB0KTtcbiAgICB9XG4gICAgLy8gQ2hlY2tzIGlmIGEgc2VnbWVudCBpcyBhIG51bWVyaWMgSUQgKHN0YXJ0cyB3aXRoIFwiX19pZFwiIGFuZCBlbmRzIHdpdGggXCJfX1wiKS5cbiAgICBzdGF0aWMgaXNOdW1lcmljSWQoZSkge1xuICAgICAgICByZXR1cm4gZS5zdGFydHNXaXRoKFwiX19pZFwiKSAmJiBlLmVuZHNXaXRoKFwiX19cIik7XG4gICAgfVxuICAgIHN0YXRpYyBleHRyYWN0TnVtZXJpY0lkKGUpIHtcbiAgICAgICAgcmV0dXJuIEludGVnZXIuZnJvbVN0cmluZyhlLnN1YnN0cmluZyg0LCBlLmxlbmd0aCAtIDIpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBzbGFzaC1zZXBhcmF0ZWQgcGF0aCBmb3IgbmF2aWdhdGluZyByZXNvdXJjZXMgKGRvY3VtZW50cyBhbmQgY29sbGVjdGlvbnMpXG4gKiB3aXRoaW4gRmlyZXN0b3JlLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIGNsYXNzIFJlc291cmNlUGF0aCBleHRlbmRzIEJhc2VQYXRoIHtcbiAgICBjb25zdHJ1Y3QoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFJlc291cmNlUGF0aChlLCB0LCBuKTtcbiAgICB9XG4gICAgY2Fub25pY2FsU3RyaW5nKCkge1xuICAgICAgICAvLyBOT1RFOiBUaGUgY2xpZW50IGlzIGlnbm9yYW50IG9mIGFueSBwYXRoIHNlZ21lbnRzIGNvbnRhaW5pbmcgZXNjYXBlXG4gICAgICAgIC8vIHNlcXVlbmNlcyAoZS5nLiBfX2lkMTIzX18pIGFuZCBqdXN0IHBhc3NlcyB0aGVtIHRocm91Z2ggcmF3ICh0aGV5IGV4aXN0XG4gICAgICAgIC8vIGZvciBsZWdhY3kgcmVhc29ucyBhbmQgc2hvdWxkIG5vdCBiZSB1c2VkIGZyZXF1ZW50bHkpLlxuICAgICAgICByZXR1cm4gdGhpcy50b0FycmF5KCkuam9pbihcIi9cIik7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHN0cmluZyByZXByZXNlbnRhdGlvbiBvZiB0aGlzIHBhdGhcbiAgICAgKiB3aGVyZSBlYWNoIHBhdGggc2VnbWVudCBoYXMgYmVlbiBlbmNvZGVkIHdpdGhcbiAgICAgKiBgZW5jb2RlVVJJQ29tcG9uZW50YC5cbiAgICAgKi8gICAgdG9VcmlFbmNvZGVkU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b0FycmF5KCkubWFwKGVuY29kZVVSSUNvbXBvbmVudCkuam9pbihcIi9cIik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSByZXNvdXJjZSBwYXRoIGZyb20gdGhlIGdpdmVuIHNsYXNoLWRlbGltaXRlZCBzdHJpbmcuIElmIG11bHRpcGxlXG4gICAgICogYXJndW1lbnRzIGFyZSBwcm92aWRlZCwgYWxsIGNvbXBvbmVudHMgYXJlIGNvbWJpbmVkLiBMZWFkaW5nIGFuZCB0cmFpbGluZ1xuICAgICAqIHNsYXNoZXMgZnJvbSBhbGwgY29tcG9uZW50cyBhcmUgaWdub3JlZC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21TdHJpbmcoLi4uZSkge1xuICAgICAgICAvLyBOT1RFOiBUaGUgY2xpZW50IGlzIGlnbm9yYW50IG9mIGFueSBwYXRoIHNlZ21lbnRzIGNvbnRhaW5pbmcgZXNjYXBlXG4gICAgICAgIC8vIHNlcXVlbmNlcyAoZS5nLiBfX2lkMTIzX18pIGFuZCBqdXN0IHBhc3NlcyB0aGVtIHRocm91Z2ggcmF3ICh0aGV5IGV4aXN0XG4gICAgICAgIC8vIGZvciBsZWdhY3kgcmVhc29ucyBhbmQgc2hvdWxkIG5vdCBiZSB1c2VkIGZyZXF1ZW50bHkpLlxuICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlKSB7XG4gICAgICAgICAgICBpZiAobi5pbmRleE9mKFwiLy9cIikgPj0gMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgc2VnbWVudCAoJHtufSkuIFBhdGhzIG11c3Qgbm90IGNvbnRhaW4gLy8gaW4gdGhlbS5gKTtcbiAgICAgICAgICAgIC8vIFN0cmlwIGxlYWRpbmcgYW5kIHRyYWlsaW5nIHNsYXNoZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICB0LnB1c2goLi4ubi5zcGxpdChcIi9cIikuZmlsdGVyKChlID0+IGUubGVuZ3RoID4gMCkpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFJlc291cmNlUGF0aCh0KTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgoW10pO1xuICAgIH1cbn1cblxuY29uc3QgTyA9IC9eW19hLXpBLVpdW19hLXpBLVowLTldKiQvO1xuXG4vKipcbiAqIEEgZG90LXNlcGFyYXRlZCBwYXRoIGZvciBuYXZpZ2F0aW5nIHN1Yi1vYmplY3RzIHdpdGhpbiBhIGRvY3VtZW50LlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgRmllbGRQYXRoJDEgZXh0ZW5kcyBCYXNlUGF0aCB7XG4gICAgY29uc3RydWN0KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgkMShlLCB0LCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBzdHJpbmcgY291bGQgYmUgdXNlZCBhcyBhIHNlZ21lbnQgaW4gYSBmaWVsZCBwYXRoXG4gICAgICogd2l0aG91dCBlc2NhcGluZy5cbiAgICAgKi8gICAgc3RhdGljIGlzVmFsaWRJZGVudGlmaWVyKGUpIHtcbiAgICAgICAgcmV0dXJuIE8udGVzdChlKTtcbiAgICB9XG4gICAgY2Fub25pY2FsU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b0FycmF5KCkubWFwKChlID0+IChlID0gZS5yZXBsYWNlKC9cXFxcL2csIFwiXFxcXFxcXFxcIikucmVwbGFjZSgvYC9nLCBcIlxcXFxgXCIpLCBcbiAgICAgICAgRmllbGRQYXRoJDEuaXNWYWxpZElkZW50aWZpZXIoZSkgfHwgKGUgPSBcImBcIiArIGUgKyBcImBcIiksIGUpKSkuam9pbihcIi5cIik7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgZmllbGQgcmVmZXJlbmNlcyB0aGUga2V5IG9mIGEgZG9jdW1lbnQuXG4gICAgICovICAgIGlzS2V5RmllbGQoKSB7XG4gICAgICAgIHJldHVybiAxID09PSB0aGlzLmxlbmd0aCAmJiB0aGlzLmdldCgwKSA9PT0geDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGZpZWxkIGRlc2lnbmF0aW5nIHRoZSBrZXkgb2YgYSBkb2N1bWVudC5cbiAgICAgKi8gICAgc3RhdGljIGtleUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkUGF0aCQxKFsgeCBdKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgZmllbGQgc3RyaW5nIGZyb20gdGhlIGdpdmVuIHNlcnZlci1mb3JtYXR0ZWQgc3RyaW5nLlxuICAgICAqXG4gICAgICogLSBTcGxpdHRpbmcgdGhlIGVtcHR5IHN0cmluZyBpcyBub3QgYWxsb3dlZCAoZm9yIG5vdyBhdCBsZWFzdCkuXG4gICAgICogLSBFbXB0eSBzZWdtZW50cyB3aXRoaW4gdGhlIHN0cmluZyAoZS5nLiBpZiB0aGVyZSBhcmUgdHdvIGNvbnNlY3V0aXZlXG4gICAgICogICBzZXBhcmF0b3JzKSBhcmUgbm90IGFsbG93ZWQuXG4gICAgICpcbiAgICAgKiBUT0RPKGIvMzcyNDQxNTcpOiB3ZSBzaG91bGQgbWFrZSB0aGlzIG1vcmUgc3RyaWN0LiBSaWdodCBub3csIGl0IGFsbG93c1xuICAgICAqIG5vbi1pZGVudGlmaWVyIHBhdGggY29tcG9uZW50cywgZXZlbiBpZiB0aGV5IGFyZW4ndCBlc2NhcGVkLlxuICAgICAqLyAgICBzdGF0aWMgZnJvbVNlcnZlckZvcm1hdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgbGV0IG4gPSBcIlwiLCByID0gMDtcbiAgICAgICAgY29uc3QgX19QUklWQVRFX2FkZEN1cnJlbnRTZWdtZW50ID0gKCkgPT4ge1xuICAgICAgICAgICAgaWYgKDAgPT09IG4ubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBmaWVsZCBwYXRoICgke2V9KS4gUGF0aHMgbXVzdCBub3QgYmUgZW1wdHksIGJlZ2luIHdpdGggJy4nLCBlbmQgd2l0aCAnLicsIG9yIGNvbnRhaW4gJy4uJ2ApO1xuICAgICAgICAgICAgdC5wdXNoKG4pLCBuID0gXCJcIjtcbiAgICAgICAgfTtcbiAgICAgICAgbGV0IGkgPSAhMTtcbiAgICAgICAgZm9yICg7ciA8IGUubGVuZ3RoOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlW3JdO1xuICAgICAgICAgICAgaWYgKFwiXFxcXFwiID09PSB0KSB7XG4gICAgICAgICAgICAgICAgaWYgKHIgKyAxID09PSBlLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJQYXRoIGhhcyB0cmFpbGluZyBlc2NhcGUgY2hhcmFjdGVyOiBcIiArIGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlW3IgKyAxXTtcbiAgICAgICAgICAgICAgICBpZiAoXCJcXFxcXCIgIT09IHQgJiYgXCIuXCIgIT09IHQgJiYgXCJgXCIgIT09IHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiUGF0aCBoYXMgaW52YWxpZCBlc2NhcGUgc2VxdWVuY2U6IFwiICsgZSk7XG4gICAgICAgICAgICAgICAgbiArPSB0LCByICs9IDI7XG4gICAgICAgICAgICB9IGVsc2UgXCJgXCIgPT09IHQgPyAoaSA9ICFpLCByKyspIDogXCIuXCIgIT09IHQgfHwgaSA/IChuICs9IHQsIHIrKykgOiAoX19QUklWQVRFX2FkZEN1cnJlbnRTZWdtZW50KCksIFxuICAgICAgICAgICAgcisrKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoX19QUklWQVRFX2FkZEN1cnJlbnRTZWdtZW50KCksIGkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiVW50ZXJtaW5hdGVkIGAgaW4gcGF0aDogXCIgKyBlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgkMSh0KTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgkMShbXSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBEb2N1bWVudEtleSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnBhdGggPSBlO1xuICAgIH1cbiAgICBzdGF0aWMgZnJvbVBhdGgoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGUpKTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21OYW1lKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEtleShSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhlKS5wb3BGaXJzdCg1KSk7XG4gICAgfVxuICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudEtleShSZXNvdXJjZVBhdGguZW1wdHlQYXRoKCkpO1xuICAgIH1cbiAgICBnZXQgY29sbGVjdGlvbkdyb3VwKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnBvcExhc3QoKS5sYXN0U2VnbWVudCgpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0cnVlIGlmIHRoZSBkb2N1bWVudCBpcyBpbiB0aGUgc3BlY2lmaWVkIGNvbGxlY3Rpb25JZC4gKi8gICAgaGFzQ29sbGVjdGlvbklkKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5sZW5ndGggPj0gMiAmJiB0aGlzLnBhdGguZ2V0KHRoaXMucGF0aC5sZW5ndGggLSAyKSA9PT0gZTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdGhlIGNvbGxlY3Rpb24gZ3JvdXAgKGkuZS4gdGhlIG5hbWUgb2YgdGhlIHBhcmVudCBjb2xsZWN0aW9uKSBmb3IgdGhpcyBrZXkuICovICAgIGdldENvbGxlY3Rpb25Hcm91cCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5nZXQodGhpcy5wYXRoLmxlbmd0aCAtIDIpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgZnVsbHkgcXVhbGlmaWVkIHBhdGggdG8gdGhlIHBhcmVudCBjb2xsZWN0aW9uLiAqLyAgICBnZXRDb2xsZWN0aW9uUGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aC5wb3BMYXN0KCk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZSAmJiAwID09PSBSZXNvdXJjZVBhdGguY29tcGFyYXRvcih0aGlzLnBhdGgsIGUucGF0aCk7XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wYXRoLnRvU3RyaW5nKCk7XG4gICAgfVxuICAgIHN0YXRpYyBjb21wYXJhdG9yKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFJlc291cmNlUGF0aC5jb21wYXJhdG9yKGUucGF0aCwgdC5wYXRoKTtcbiAgICB9XG4gICAgc3RhdGljIGlzRG9jdW1lbnRLZXkoZSkge1xuICAgICAgICByZXR1cm4gZS5sZW5ndGggJSAyID09IDA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgZG9jdW1lbnQga2V5IHdpdGggdGhlIGdpdmVuIHNlZ21lbnRzLlxuICAgICAqXG4gICAgICogQHBhcmFtIHNlZ21lbnRzIC0gVGhlIHNlZ21lbnRzIG9mIHRoZSBwYXRoIHRvIHRoZSBkb2N1bWVudFxuICAgICAqIEByZXR1cm5zIEEgbmV3IGluc3RhbmNlIG9mIERvY3VtZW50S2V5XG4gICAgICovICAgIHN0YXRpYyBmcm9tU2VnbWVudHMoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50S2V5KG5ldyBSZXNvdXJjZVBhdGgoZS5zbGljZSgpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgaW5pdGlhbCBtdXRhdGlvbiBiYXRjaCBpZCBmb3IgZWFjaCBpbmRleC4gR2V0cyB1cGRhdGVkIGR1cmluZyBpbmRleFxuICogYmFja2ZpbGwuXG4gKi8gY29uc3QgTiA9IC0xO1xuXG4vKipcbiAqIFRoZSBpbml0aWFsIHNlcXVlbmNlIG51bWJlciBmb3IgZWFjaCBpbmRleC4gR2V0cyB1cGRhdGVkIGR1cmluZyBpbmRleFxuICogYmFja2ZpbGwuXG4gKi9cbi8qKlxuICogQW4gaW5kZXggZGVmaW5pdGlvbiBmb3IgZmllbGQgaW5kZXhlcyBpbiBGaXJlc3RvcmUuXG4gKlxuICogRXZlcnkgaW5kZXggaXMgYXNzb2NpYXRlZCB3aXRoIGEgY29sbGVjdGlvbi4gVGhlIGRlZmluaXRpb24gY29udGFpbnMgYSBsaXN0XG4gKiBvZiBmaWVsZHMgYW5kIHRoZWlyIGluZGV4IGtpbmQgKHdoaWNoIGNhbiBiZSBgQVNDRU5ESU5HYCwgYERFU0NFTkRJTkdgIG9yXG4gKiBgQ09OVEFJTlNgIGZvciBBcnJheUNvbnRhaW5zL0FycmF5Q29udGFpbnNBbnkgcXVlcmllcykuXG4gKlxuICogVW5saWtlIHRoZSBiYWNrZW5kLCB0aGUgU0RLIGRvZXMgbm90IGRpZmZlcmVudGlhdGUgYmV0d2VlbiBjb2xsZWN0aW9uIG9yXG4gKiBjb2xsZWN0aW9uIGdyb3VwLXNjb3BlZCBpbmRpY2VzLiBFdmVyeSBpbmRleCBjYW4gYmUgdXNlZCBmb3IgYm90aCBzaW5nbGVcbiAqIGNvbGxlY3Rpb24gYW5kIGNvbGxlY3Rpb24gZ3JvdXAgcXVlcmllcy5cbiAqL1xuY2xhc3MgRmllbGRJbmRleCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGluZGV4IElELiBSZXR1cm5zIC0xIGlmIHRoZSBpbmRleCBJRCBpcyBub3QgYXZhaWxhYmxlIChlLmcuIHRoZSBpbmRleFxuICAgICAqIGhhcyBub3QgeWV0IGJlZW4gcGVyc2lzdGVkKS5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGNvbGxlY3Rpb24gSUQgdGhpcyBpbmRleCBhcHBsaWVzIHRvLiAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUgZmllbGQgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovXG4gICAgbiwgXG4gICAgLyoqIFNob3dzIGhvdyB1cC10by1kYXRlIHRoZSBpbmRleCBpcyBmb3IgdGhlIGN1cnJlbnQgdXNlci4gKi9cbiAgICByKSB7XG4gICAgICAgIHRoaXMuaW5kZXhJZCA9IGUsIHRoaXMuY29sbGVjdGlvbkdyb3VwID0gdCwgdGhpcy5maWVsZHMgPSBuLCB0aGlzLmluZGV4U3RhdGUgPSByO1xuICAgIH1cbn1cblxuLyoqIEFuIElEIGZvciBhbiBpbmRleCB0aGF0IGhhcyBub3QgeWV0IGJlZW4gYWRkZWQgdG8gcGVyc2lzdGVuY2UuICAqL1xuLyoqIFJldHVybnMgdGhlIEFycmF5Q29udGFpbnMvQXJyYXlDb250YWluc0FueSBzZWdtZW50IGZvciB0aGlzIGluZGV4LiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXRBcnJheVNlZ21lbnQoZSkge1xuICAgIHJldHVybiBlLmZpZWxkcy5maW5kKChlID0+IDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovID09PSBlLmtpbmQpKTtcbn1cblxuLyoqIFJldHVybnMgYWxsIGRpcmVjdGlvbmFsIChhc2NlbmRpbmcvZGVzY2VuZGluZykgc2VnbWVudHMgZm9yIHRoaXMgaW5kZXguICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZEluZGV4R2V0RGlyZWN0aW9uYWxTZWdtZW50cyhlKSB7XG4gICAgcmV0dXJuIGUuZmllbGRzLmZpbHRlcigoZSA9PiAyIC8qIEluZGV4S2luZC5DT05UQUlOUyAqLyAhPT0gZS5raW5kKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgb3JkZXIgb2YgdGhlIGRvY3VtZW50IGtleSBjb21wb25lbnQgZm9yIHRoZSBnaXZlbiBpbmRleC5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGluIHRoZSBXZWIgSW5kZXhlZERiIGltcGxlbWVudGF0aW9uLlxuICovXG4vKipcbiAqIENvbXBhcmVzIGluZGV4ZXMgYnkgY29sbGVjdGlvbiBncm91cCBhbmQgc2VnbWVudHMuIElnbm9yZXMgdXBkYXRlIHRpbWUgYW5kXG4gKiBpbmRleCBJRC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhTZW1hbnRpY0NvbXBhcmF0b3IoZSwgdCkge1xuICAgIGxldCBuID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jb2xsZWN0aW9uR3JvdXAsIHQuY29sbGVjdGlvbkdyb3VwKTtcbiAgICBpZiAoMCAhPT0gbikgcmV0dXJuIG47XG4gICAgZm9yIChsZXQgciA9IDA7IHIgPCBNYXRoLm1pbihlLmZpZWxkcy5sZW5ndGgsIHQuZmllbGRzLmxlbmd0aCk7ICsrcikgaWYgKG4gPSBfX1BSSVZBVEVfaW5kZXhTZWdtZW50Q29tcGFyYXRvcihlLmZpZWxkc1tyXSwgdC5maWVsZHNbcl0pLCBcbiAgICAwICE9PSBuKSByZXR1cm4gbjtcbiAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5maWVsZHMubGVuZ3RoLCB0LmZpZWxkcy5sZW5ndGgpO1xufVxuXG4vKiogUmV0dXJucyBhIGRlYnVnIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBmaWVsZCBpbmRleCAqLyBGaWVsZEluZGV4LlVOS05PV05fSUQgPSAtMTtcblxuLyoqIEFuIGluZGV4IGNvbXBvbmVudCBjb25zaXN0aW5nIG9mIGZpZWxkIHBhdGggYW5kIGluZGV4IHR5cGUuICAqL1xuY2xhc3MgSW5kZXhTZWdtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIGZpZWxkIHBhdGggb2YgdGhlIGNvbXBvbmVudC4gKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIGZpZWxkcyBzb3J0aW5nIG9yZGVyLiAqL1xuICAgIHQpIHtcbiAgICAgICAgdGhpcy5maWVsZFBhdGggPSBlLCB0aGlzLmtpbmQgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2luZGV4U2VnbWVudENvbXBhcmF0b3IoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBGaWVsZFBhdGgkMS5jb21wYXJhdG9yKGUuZmllbGRQYXRoLCB0LmZpZWxkUGF0aCk7XG4gICAgcmV0dXJuIDAgIT09IG4gPyBuIDogX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5raW5kLCB0LmtpbmQpO1xufVxuXG4vKipcbiAqIFN0b3JlcyB0aGUgXCJoaWdoIHdhdGVyIG1hcmtcIiB0aGF0IGluZGljYXRlcyBob3cgdXBkYXRlZCB0aGUgSW5kZXggaXMgZm9yIHRoZVxuICogY3VycmVudCB1c2VyLlxuICovIGNsYXNzIEluZGV4U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIEluZGljYXRlcyB3aGVuIHRoZSBpbmRleCB3YXMgbGFzdCB1cGRhdGVkIChyZWxhdGl2ZSB0byBvdGhlciBpbmRleGVzKS5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKiogVGhlIHRoZSBsYXRlc3QgaW5kZXhlZCByZWFkIHRpbWUsIGRvY3VtZW50IGFuZCBiYXRjaCBpZC4gKi9cbiAgICB0KSB7XG4gICAgICAgIHRoaXMuc2VxdWVuY2VOdW1iZXIgPSBlLCB0aGlzLm9mZnNldCA9IHQ7XG4gICAgfVxuICAgIC8qKiBUaGUgc3RhdGUgb2YgYW4gaW5kZXggdGhhdCBoYXMgbm90IHlldCBiZWVuIGJhY2tmaWxsZWQuICovICAgIHN0YXRpYyBlbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleFN0YXRlKDAsIEluZGV4T2Zmc2V0Lm1pbigpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBvZmZzZXQgdGhhdCBtYXRjaGVzIGFsbCBkb2N1bWVudHMgd2l0aCBhIHJlYWQgdGltZSBoaWdoZXIgdGhhblxuICogYHJlYWRUaW1lYC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRTdWNjZXNzb3JGcm9tUmVhZFRpbWUoZSwgdCkge1xuICAgIC8vIFdlIHdhbnQgdG8gY3JlYXRlIGFuIG9mZnNldCB0aGF0IG1hdGNoZXMgYWxsIGRvY3VtZW50cyB3aXRoIGEgcmVhZCB0aW1lXG4gICAgLy8gZ3JlYXRlciB0aGFuIHRoZSBwcm92aWRlZCByZWFkIHRpbWUuIFRvIGRvIHNvLCB3ZSB0ZWNobmljYWxseSBuZWVkIHRvXG4gICAgLy8gY3JlYXRlIGFuIG9mZnNldCBmb3IgYChyZWFkVGltZSwgTUFYX0RPQ1VNRU5UX0tFWSlgLiBXaGlsZSB3ZSBjb3VsZCB1c2VcbiAgICAvLyBVbmljb2RlIGNvZGVwb2ludHMgdG8gZ2VuZXJhdGUgTUFYX0RPQ1VNRU5UX0tFWSwgaXQgaXMgbXVjaCBlYXNpZXIgdG8gdXNlXG4gICAgLy8gYChyZWFkVGltZSArIDEsIERvY3VtZW50S2V5LmVtcHR5KCkpYCBzaW5jZSBgPiBEb2N1bWVudEtleS5lbXB0eSgpYCBtYXRjaGVzXG4gICAgLy8gYWxsIHZhbGlkIGRvY3VtZW50IElEcy5cbiAgICBjb25zdCBuID0gZS50b1RpbWVzdGFtcCgpLnNlY29uZHMsIHIgPSBlLnRvVGltZXN0YW1wKCkubmFub3NlY29uZHMgKyAxLCBpID0gU25hcHNob3RWZXJzaW9uLmZyb21UaW1lc3RhbXAoMWU5ID09PSByID8gbmV3IFRpbWVzdGFtcChuICsgMSwgMCkgOiBuZXcgVGltZXN0YW1wKG4sIHIpKTtcbiAgICByZXR1cm4gbmV3IEluZGV4T2Zmc2V0KGksIERvY3VtZW50S2V5LmVtcHR5KCksIHQpO1xufVxuXG4vKiogQ3JlYXRlcyBhIG5ldyBvZmZzZXQgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGRvY3VtZW50LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRGcm9tRG9jdW1lbnQoZSkge1xuICAgIHJldHVybiBuZXcgSW5kZXhPZmZzZXQoZS5yZWFkVGltZSwgZS5rZXksIE4pO1xufVxuXG4vKipcbiAqIFN0b3JlcyB0aGUgbGF0ZXN0IHJlYWQgdGltZSwgZG9jdW1lbnQgYW5kIGJhdGNoIElEIHRoYXQgd2VyZSBwcm9jZXNzZWQgZm9yIGFuXG4gKiBpbmRleC5cbiAqLyBjbGFzcyBJbmRleE9mZnNldCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogVGhlIGxhdGVzdCByZWFkIHRpbWUgdmVyc2lvbiB0aGF0IGhhcyBiZWVuIGluZGV4ZWQgYnkgRmlyZXN0b3JlIGZvciB0aGlzXG4gICAgICogZmllbGQgaW5kZXguXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGtleSBvZiB0aGUgbGFzdCBkb2N1bWVudCB0aGF0IHdhcyBpbmRleGVkIGZvciB0aGlzIHF1ZXJ5LiBVc2VcbiAgICAgKiBgRG9jdW1lbnRLZXkuZW1wdHkoKWAgaWYgbm8gZG9jdW1lbnQgaGFzIGJlZW4gaW5kZXhlZC5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKlxuICAgICAqIFRoZSBsYXJnZXN0IG11dGF0aW9uIGJhdGNoIGlkIHRoYXQncyBiZWVuIHByb2Nlc3NlZCBieSBGaXJlc3RvcmUuXG4gICAgICovXG4gICAgbikge1xuICAgICAgICB0aGlzLnJlYWRUaW1lID0gZSwgdGhpcy5kb2N1bWVudEtleSA9IHQsIHRoaXMubGFyZ2VzdEJhdGNoSWQgPSBuO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbiBvZmZzZXQgdGhhdCBzb3J0cyBiZWZvcmUgYWxsIHJlZ3VsYXIgb2Zmc2V0cy4gKi8gICAgc3RhdGljIG1pbigpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE9mZnNldChTbmFwc2hvdFZlcnNpb24ubWluKCksIERvY3VtZW50S2V5LmVtcHR5KCksIE4pO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhbiBvZmZzZXQgdGhhdCBzb3J0cyBhZnRlciBhbGwgcmVndWxhciBvZmZzZXRzLiAqLyAgICBzdGF0aWMgbWF4KCkge1xuICAgICAgICByZXR1cm4gbmV3IEluZGV4T2Zmc2V0KFNuYXBzaG90VmVyc2lvbi5tYXgoKSwgRG9jdW1lbnRLZXkuZW1wdHkoKSwgTik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhPZmZzZXRDb21wYXJhdG9yKGUsIHQpIHtcbiAgICBsZXQgbiA9IGUucmVhZFRpbWUuY29tcGFyZVRvKHQucmVhZFRpbWUpO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IChuID0gRG9jdW1lbnRLZXkuY29tcGFyYXRvcihlLmRvY3VtZW50S2V5LCB0LmRvY3VtZW50S2V5KSwgXG4gICAgMCAhPT0gbiA/IG4gOiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmxhcmdlc3RCYXRjaElkLCB0Lmxhcmdlc3RCYXRjaElkKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IEIgPSBcIlRoZSBjdXJyZW50IHRhYiBpcyBub3QgaW4gdGhlIHJlcXVpcmVkIHN0YXRlIHRvIHBlcmZvcm0gdGhpcyBvcGVyYXRpb24uIEl0IG1pZ2h0IGJlIG5lY2Vzc2FyeSB0byByZWZyZXNoIHRoZSBicm93c2VyIHRhYi5cIjtcblxuLyoqXG4gKiBBIGJhc2UgY2xhc3MgcmVwcmVzZW50aW5nIGEgcGVyc2lzdGVuY2UgdHJhbnNhY3Rpb24sIGVuY2Fwc3VsYXRpbmcgYm90aCB0aGVcbiAqIHRyYW5zYWN0aW9uJ3Mgc2VxdWVuY2UgbnVtYmVycyBhcyB3ZWxsIGFzIGEgbGlzdCBvZiBvbkNvbW1pdHRlZCBsaXN0ZW5lcnMuXG4gKlxuICogV2hlbiB5b3UgY2FsbCBQZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbigpLCBpdCB3aWxsIGNyZWF0ZSBhIHRyYW5zYWN0aW9uIGFuZFxuICogcGFzcyBpdCB0byB5b3VyIGNhbGxiYWNrLiBZb3UgdGhlbiBwYXNzIGl0IHRvIGFueSBtZXRob2QgdGhhdCBvcGVyYXRlc1xuICogb24gcGVyc2lzdGVuY2UuXG4gKi8gY2xhc3MgUGVyc2lzdGVuY2VUcmFuc2FjdGlvbiB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMub25Db21taXR0ZWRMaXN0ZW5lcnMgPSBbXTtcbiAgICB9XG4gICAgYWRkT25Db21taXR0ZWRMaXN0ZW5lcihlKSB7XG4gICAgICAgIHRoaXMub25Db21taXR0ZWRMaXN0ZW5lcnMucHVzaChlKTtcbiAgICB9XG4gICAgcmFpc2VPbkNvbW1pdHRlZEV2ZW50KCkge1xuICAgICAgICB0aGlzLm9uQ29tbWl0dGVkTGlzdGVuZXJzLmZvckVhY2goKGUgPT4gZSgpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBWZXJpZmllcyB0aGUgZXJyb3IgdGhyb3duIGJ5IGEgTG9jYWxTdG9yZSBvcGVyYXRpb24uIElmIGEgTG9jYWxTdG9yZVxuICogb3BlcmF0aW9uIGZhaWxzIGJlY2F1c2UgdGhlIHByaW1hcnkgbGVhc2UgaGFzIGJlZW4gdGFrZW4gYnkgYW5vdGhlciBjbGllbnQsXG4gKiB3ZSBpZ25vcmUgdGhlIGVycm9yICh0aGUgcGVyc2lzdGVuY2UgbGF5ZXIgd2lsbCBpbW1lZGlhdGVseSBjYWxsXG4gKiBgYXBwbHlQcmltYXJ5TGVhc2VgIHRvIHByb3BhZ2F0ZSB0aGUgcHJpbWFyeSBzdGF0ZSBjaGFuZ2UpLiBBbGwgb3RoZXIgZXJyb3JzXG4gKiBhcmUgcmUtdGhyb3duLlxuICpcbiAqIEBwYXJhbSBlcnIgLSBBbiBlcnJvciByZXR1cm5lZCBieSBhIExvY2FsU3RvcmUgb3BlcmF0aW9uLlxuICogQHJldHVybnMgQSBQcm9taXNlIHRoYXQgcmVzb2x2ZXMgYWZ0ZXIgd2UgcmVjb3ZlcmVkLCBvciB0aGUgb3JpZ2luYWwgZXJyb3IuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKSB7XG4gICAgaWYgKGUuY29kZSAhPT0gQy5GQUlMRURfUFJFQ09ORElUSU9OIHx8IGUubWVzc2FnZSAhPT0gQikgdGhyb3cgZTtcbiAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJMb2NhbFN0b3JlXCIsIFwiVW5leHBlY3RlZGx5IGxvc3QgcHJpbWFyeSBsZWFzZVwiKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUGVyc2lzdGVuY2VQcm9taXNlIGlzIGVzc2VudGlhbGx5IGEgcmUtaW1wbGVtZW50YXRpb24gb2YgUHJvbWlzZSBleGNlcHRcbiAqIGl0IGhhcyBhIC5uZXh0KCkgbWV0aG9kIGluc3RlYWQgb2YgLnRoZW4oKSBhbmQgLm5leHQoKSBhbmQgLmNhdGNoKCkgY2FsbGJhY2tzXG4gKiBhcmUgZXhlY3V0ZWQgc3luY2hyb25vdXNseSB3aGVuIGEgUGVyc2lzdGVuY2VQcm9taXNlIHJlc29sdmVzIHJhdGhlciB0aGFuXG4gKiBhc3luY2hyb25vdXNseSAoUHJvbWlzZSBpbXBsZW1lbnRhdGlvbnMgdXNlIHNldEltbWVkaWF0ZSgpIG9yIHNpbWlsYXIpLlxuICpcbiAqIFRoaXMgaXMgbmVjZXNzYXJ5IHRvIGludGVyb3BlcmF0ZSB3aXRoIEluZGV4ZWREQiB3aGljaCB3aWxsIGF1dG9tYXRpY2FsbHlcbiAqIGNvbW1pdCB0cmFuc2FjdGlvbnMgaWYgY29udHJvbCBpcyByZXR1cm5lZCB0byB0aGUgZXZlbnQgbG9vcCB3aXRob3V0XG4gKiBzeW5jaHJvbm91c2x5IGluaXRpYXRpbmcgYW5vdGhlciBvcGVyYXRpb24gb24gdGhlIHRyYW5zYWN0aW9uLlxuICpcbiAqIE5PVEU6IC50aGVuKCkgYW5kIC5jYXRjaCgpIG9ubHkgYWxsb3cgYSBzaW5nbGUgY29uc3VtZXIsIHVubGlrZSBub3JtYWxcbiAqIFByb21pc2VzLlxuICovIGNsYXNzIFBlcnNpc3RlbmNlUHJvbWlzZSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICAvLyBOT1RFOiBuZXh0L2NhdGNoQ2FsbGJhY2sgd2lsbCBhbHdheXMgcG9pbnQgdG8gb3VyIG93biB3cmFwcGVyIGZ1bmN0aW9ucyxcbiAgICAgICAgLy8gbm90IHRoZSB1c2VyJ3MgcmF3IG5leHQoKSBvciBjYXRjaCgpIGNhbGxiYWNrcy5cbiAgICAgICAgdGhpcy5uZXh0Q2FsbGJhY2sgPSBudWxsLCB0aGlzLmNhdGNoQ2FsbGJhY2sgPSBudWxsLCBcbiAgICAgICAgLy8gV2hlbiB0aGUgb3BlcmF0aW9uIHJlc29sdmVzLCB3ZSdsbCBzZXQgcmVzdWx0IG9yIGVycm9yIGFuZCBtYXJrIGlzRG9uZS5cbiAgICAgICAgdGhpcy5yZXN1bHQgPSB2b2lkIDAsIHRoaXMuZXJyb3IgPSB2b2lkIDAsIHRoaXMuaXNEb25lID0gITEsIFxuICAgICAgICAvLyBTZXQgdG8gdHJ1ZSB3aGVuIC50aGVuKCkgb3IgLmNhdGNoKCkgYXJlIGNhbGxlZCBhbmQgcHJldmVudHMgYWRkaXRpb25hbFxuICAgICAgICAvLyBjaGFpbmluZy5cbiAgICAgICAgdGhpcy5jYWxsYmFja0F0dGFjaGVkID0gITEsIGUoKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc0RvbmUgPSAhMCwgdGhpcy5yZXN1bHQgPSBlLCB0aGlzLm5leHRDYWxsYmFjayAmJiBcbiAgICAgICAgICAgIC8vIHZhbHVlIHNob3VsZCBiZSBkZWZpbmVkIHVubGVzcyBUIGlzIFZvaWQsIGJ1dCB3ZSBjYW4ndCBleHByZXNzXG4gICAgICAgICAgICAvLyB0aGF0IGluIHRoZSB0eXBlIHN5c3RlbS5cbiAgICAgICAgICAgIHRoaXMubmV4dENhbGxiYWNrKGUpO1xuICAgICAgICB9KSwgKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc0RvbmUgPSAhMCwgdGhpcy5lcnJvciA9IGUsIHRoaXMuY2F0Y2hDYWxsYmFjayAmJiB0aGlzLmNhdGNoQ2FsbGJhY2soZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY2F0Y2goZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5uZXh0KHZvaWQgMCwgZSk7XG4gICAgfVxuICAgIG5leHQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsYmFja0F0dGFjaGVkICYmIGZhaWwoKSwgdGhpcy5jYWxsYmFja0F0dGFjaGVkID0gITAsIHRoaXMuaXNEb25lID8gdGhpcy5lcnJvciA/IHRoaXMud3JhcEZhaWx1cmUodCwgdGhpcy5lcnJvcikgOiB0aGlzLndyYXBTdWNjZXNzKGUsIHRoaXMucmVzdWx0KSA6IG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKChuLCByKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHRDYWxsYmFjayA9IHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcFN1Y2Nlc3MoZSwgdCkubmV4dChuLCByKTtcbiAgICAgICAgICAgIH0sIHRoaXMuY2F0Y2hDYWxsYmFjayA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMud3JhcEZhaWx1cmUodCwgZSkubmV4dChuLCByKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgdG9Qcm9taXNlKCkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKChlLCB0KSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5leHQoZSwgdCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgd3JhcFVzZXJGdW5jdGlvbihlKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBQZXJzaXN0ZW5jZVByb21pc2UgPyB0IDogUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdyYXBTdWNjZXNzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUgPyB0aGlzLndyYXBVc2VyRnVuY3Rpb24oKCgpID0+IGUodCkpKSA6IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHQpO1xuICAgIH1cbiAgICB3cmFwRmFpbHVyZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBlID8gdGhpcy53cmFwVXNlckZ1bmN0aW9uKCgoKSA9PiBlKHQpKSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVqZWN0KHQpO1xuICAgIH1cbiAgICBzdGF0aWMgcmVzb2x2ZShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgdChlKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzdGF0aWMgcmVqZWN0KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBuKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHN0YXRpYyB3YWl0Rm9yKFxuICAgIC8vIEFjY2VwdCBhbGwgUHJvbWlzZSB0eXBlcyBpbiB3YWl0Rm9yKCkuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgbGV0IHIgPSAwLCBpID0gMCwgcyA9ICExO1xuICAgICAgICAgICAgZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICArK3IsIGUubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICArK2ksIHMgJiYgaSA9PT0gciAmJiB0KCk7XG4gICAgICAgICAgICAgICAgfSksIChlID0+IG4oZSkpKTtcbiAgICAgICAgICAgIH0pKSwgcyA9ICEwLCBpID09PSByICYmIHQoKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHaXZlbiBhbiBhcnJheSBvZiBwcmVkaWNhdGUgZnVuY3Rpb25zIHRoYXQgYXN5bmNocm9ub3VzbHkgZXZhbHVhdGUgdG8gYVxuICAgICAqIGJvb2xlYW4sIGltcGxlbWVudHMgYSBzaG9ydC1jaXJjdWl0aW5nIGBvcmAgYmV0d2VlbiB0aGUgcmVzdWx0cy4gUHJlZGljYXRlc1xuICAgICAqIHdpbGwgYmUgZXZhbHVhdGVkIHVudGlsIG9uZSBvZiB0aGVtIHJldHVybnMgYHRydWVgLCB0aGVuIHN0b3AuIFRoZSBmaW5hbFxuICAgICAqIHJlc3VsdCB3aWxsIGJlIHdoZXRoZXIgYW55IG9mIHRoZW0gcmV0dXJuZWQgYHRydWVgLlxuICAgICAqLyAgICBzdGF0aWMgb3IoZSkge1xuICAgICAgICBsZXQgdCA9IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCExKTtcbiAgICAgICAgZm9yIChjb25zdCBuIG9mIGUpIHQgPSB0Lm5leHQoKGUgPT4gZSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKGUpIDogbigpKSk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICBzdGF0aWMgZm9yRWFjaChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIG4ucHVzaCh0LmNhbGwodGhpcywgZSwgcikpO1xuICAgICAgICB9KSksIHRoaXMud2FpdEZvcihuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uY3VycmVudGx5IG1hcCBhbGwgYXJyYXkgZWxlbWVudHMgdGhyb3VnaCBhc3luY2hyb25vdXMgZnVuY3Rpb24uXG4gICAgICovICAgIHN0YXRpYyBtYXBBcnJheShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IGUubGVuZ3RoLCBzID0gbmV3IEFycmF5KGkpO1xuICAgICAgICAgICAgbGV0IG8gPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgXyA9IDA7IF8gPCBpOyBfKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhID0gXztcbiAgICAgICAgICAgICAgICB0KGVbYV0pLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzW2FdID0gZSwgKytvLCBvID09PSBpICYmIG4ocyk7XG4gICAgICAgICAgICAgICAgfSksIChlID0+IHIoZSkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBbiBhbHRlcm5hdGl2ZSB0byByZWN1cnNpdmUgUGVyc2lzdGVuY2VQcm9taXNlIGNhbGxzLCB0aGF0IGF2b2lkc1xuICAgICAqIHBvdGVudGlhbCBtZW1vcnkgcHJvYmxlbXMgZnJvbSB1bmJvdW5kZWQgY2hhaW5zIG9mIHByb21pc2VzLlxuICAgICAqXG4gICAgICogVGhlIGBhY3Rpb25gIHdpbGwgYmUgY2FsbGVkIHJlcGVhdGVkbHkgd2hpbGUgYGNvbmRpdGlvbmAgaXMgdHJ1ZS5cbiAgICAgKi8gICAgc3RhdGljIGRvV2hpbGUoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHByb2Nlc3MgPSAoKSA9PiB7XG4gICAgICAgICAgICAgICAgITAgPT09IGUoKSA/IHQoKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHByb2Nlc3MoKTtcbiAgICAgICAgICAgICAgICB9KSwgcikgOiBuKCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcHJvY2VzcygpO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gUmVmZXJlbmNlcyB0byBgd2luZG93YCBhcmUgZ3VhcmRlZCBieSBTaW1wbGVEYi5pc0F2YWlsYWJsZSgpXG4vKiBlc2xpbnQtZGlzYWJsZSBuby1yZXN0cmljdGVkLWdsb2JhbHMgKi8gY29uc3QgTCA9IFwiU2ltcGxlRGJcIjtcblxuLyoqXG4gKiBUaGUgbWF4aW11bSBudW1iZXIgb2YgcmV0cnkgYXR0ZW1wdHMgZm9yIGFuIEluZGV4ZWREYiB0cmFuc2FjdGlvbiB0aGF0IGZhaWxzXG4gKiB3aXRoIGEgRE9NRXhjZXB0aW9uLlxuICovXG4vKipcbiAqIFdyYXBzIGFuIElEQlRyYW5zYWN0aW9uIGFuZCBleHBvc2VzIGEgc3RvcmUoKSBtZXRob2QgdG8gZ2V0IGEgaGFuZGxlIHRvIGFcbiAqIHNwZWNpZmljIG9iamVjdCBzdG9yZS5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1NpbXBsZURiVHJhbnNhY3Rpb24ge1xuICAgIHN0YXRpYyBvcGVuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1NpbXBsZURiVHJhbnNhY3Rpb24odCwgZS50cmFuc2FjdGlvbihyLCBuKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcih0LCBlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuYWN0aW9uID0gZSwgdGhpcy50cmFuc2FjdGlvbiA9IHQsIHRoaXMuYWJvcnRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgYFByb21pc2VgIHRoYXQgcmVzb2x2ZXMgd2l0aCB0aGUgcmVzdWx0IG9mIHRoZSBJbmRleGVkRGIgdHJhbnNhY3Rpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLm0gPSBuZXcgX19QUklWQVRFX0RlZmVycmVkLCB0aGlzLnRyYW5zYWN0aW9uLm9uY29tcGxldGUgPSAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm0ucmVzb2x2ZSgpO1xuICAgICAgICB9LCB0aGlzLnRyYW5zYWN0aW9uLm9uYWJvcnQgPSAoKSA9PiB7XG4gICAgICAgICAgICB0LmVycm9yID8gdGhpcy5tLnJlamVjdChuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSwgdC5lcnJvcikpIDogdGhpcy5tLnJlc29sdmUoKTtcbiAgICAgICAgfSwgdGhpcy50cmFuc2FjdGlvbi5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2NoZWNrRm9yQW5kUmVwb3J0aU9TRXJyb3IodC50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgdGhpcy5tLnJlamVjdChuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSwgbikpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICBnZXQgcCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubS5wcm9taXNlO1xuICAgIH1cbiAgICBhYm9ydChlKSB7XG4gICAgICAgIGUgJiYgdGhpcy5tLnJlamVjdChlKSwgdGhpcy5hYm9ydGVkIHx8IChfX1BSSVZBVEVfbG9nRGVidWcoTCwgXCJBYm9ydGluZyB0cmFuc2FjdGlvbjpcIiwgZSA/IGUubWVzc2FnZSA6IFwiQ2xpZW50LWluaXRpYXRlZCBhYm9ydFwiKSwgXG4gICAgICAgIHRoaXMuYWJvcnRlZCA9ICEwLCB0aGlzLnRyYW5zYWN0aW9uLmFib3J0KCkpO1xuICAgIH1cbiAgICBTKCkge1xuICAgICAgICAvLyBJZiB0aGUgYnJvd3NlciBzdXBwb3J0cyBWMyBJbmRleGVkREIsIHdlIGludm9rZSBjb21taXQoKSBleHBsaWNpdGx5IHRvXG4gICAgICAgIC8vIHNwZWVkIHVwIGluZGV4IERCIHByb2Nlc3NpbmcgaWYgdGhlIGV2ZW50IGxvb3AgcmVtYWlucyBibG9ja3MuXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLnRyYW5zYWN0aW9uO1xuICAgICAgICB0aGlzLmFib3J0ZWQgfHwgXCJmdW5jdGlvblwiICE9IHR5cGVvZiBlLmNvbW1pdCB8fCBlLmNvbW1pdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgU2ltcGxlRGJTdG9yZTxLZXlUeXBlLCBWYWx1ZVR5cGU+IGZvciB0aGUgc3BlY2lmaWVkIHN0b3JlLiBBbGxcbiAgICAgKiBvcGVyYXRpb25zIHBlcmZvcm1lZCBvbiB0aGUgU2ltcGxlRGJTdG9yZSBoYXBwZW4gd2l0aGluIHRoZSBjb250ZXh0IG9mIHRoaXNcbiAgICAgKiB0cmFuc2FjdGlvbiBhbmQgaXQgY2Fubm90IGJlIHVzZWQgYW55bW9yZSBvbmNlIHRoZSB0cmFuc2FjdGlvbiBpc1xuICAgICAqIGNvbXBsZXRlZC5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB3ZSBjYW4ndCBhY3R1YWxseSBlbmZvcmNlIHRoYXQgdGhlIEtleVR5cGUgYW5kIFZhbHVlVHlwZSBhcmVcbiAgICAgKiBjb3JyZWN0LCBidXQgdGhleSBhbGxvdyB0eXBlIHNhZmV0eSB0aHJvdWdoIHRoZSByZXN0IG9mIHRoZSBjb25zdW1pbmcgY29kZS5cbiAgICAgKi8gICAgc3RvcmUoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy50cmFuc2FjdGlvbi5vYmplY3RTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2ltcGxlRGJTdG9yZSh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSB3cmFwcGVyIGFyb3VuZCBJbmRleGVkRGIgd2l0aCBhIHNpbXBsaWZpZWQgaW50ZXJmYWNlIHRoYXQgdXNlc1xuICogUHJvbWlzZS1saWtlIHJldHVybiB2YWx1ZXMgdG8gY2hhaW4gb3BlcmF0aW9ucy4gUmVhbCBwcm9taXNlcyBjYW5ub3QgYmUgdXNlZFxuICogc2luY2UgLnRoZW4oKSBjb250aW51YXRpb25zIGFyZSBleGVjdXRlZCBhc3luY2hyb25vdXNseSAoZS5nLiB2aWFcbiAqIC5zZXRJbW1lZGlhdGUpLCB3aGljaCB3b3VsZCBjYXVzZSBJbmRleGVkREIgdG8gZW5kIHRoZSB0cmFuc2FjdGlvbi5cbiAqIFNlZSBQZXJzaXN0ZW5jZVByb21pc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2ltcGxlRGIge1xuICAgIC8qKiBEZWxldGVzIHRoZSBzcGVjaWZpZWQgZGF0YWJhc2UuICovXG4gICAgc3RhdGljIGRlbGV0ZShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nRGVidWcoTCwgXCJSZW1vdmluZyBkYXRhYmFzZTpcIiwgZSksIF9fUFJJVkFURV93cmFwUmVxdWVzdCh3aW5kb3cuaW5kZXhlZERCLmRlbGV0ZURhdGFiYXNlKGUpKS50b1Byb21pc2UoKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgdHJ1ZSBpZiBJbmRleGVkREIgaXMgYXZhaWxhYmxlIGluIHRoZSBjdXJyZW50IGVudmlyb25tZW50LiAqLyAgICBzdGF0aWMgRCgpIHtcbiAgICAgICAgaWYgKCFpc0luZGV4ZWREQkF2YWlsYWJsZSgpKSByZXR1cm4gITE7XG4gICAgICAgIGlmIChfX1BSSVZBVEVfU2ltcGxlRGIudigpKSByZXR1cm4gITA7XG4gICAgICAgIC8vIFdlIGV4dGVuc2l2ZWx5IHVzZSBpbmRleGVkIGFycmF5IHZhbHVlcyBhbmQgY29tcG91bmQga2V5cyxcbiAgICAgICAgLy8gd2hpY2ggSUUgYW5kIEVkZ2UgZG8gbm90IHN1cHBvcnQuIEhvd2V2ZXIsIHRoZXkgc3RpbGwgaGF2ZSBpbmRleGVkREJcbiAgICAgICAgLy8gZGVmaW5lZCBvbiB0aGUgd2luZG93LCBzbyB3ZSBuZWVkIHRvIGNoZWNrIGZvciB0aGVtIGhlcmUgYW5kIG1ha2Ugc3VyZVxuICAgICAgICAvLyB0byByZXR1cm4gdGhhdCBwZXJzaXN0ZW5jZSBpcyBub3QgZW5hYmxlZCBmb3IgdGhvc2UgYnJvd3NlcnMuXG4gICAgICAgIC8vIEZvciB0cmFja2luZyBzdXBwb3J0IG9mIHRoaXMgZmVhdHVyZSwgc2VlIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1pY3Jvc29mdC5jb20vZW4tdXMvbWljcm9zb2Z0LWVkZ2UvcGxhdGZvcm0vc3RhdHVzL2luZGV4ZWRkYmFycmF5c2FuZG11bHRpZW50cnlzdXBwb3J0L1xuICAgICAgICAvLyBDaGVjayB0aGUgVUEgc3RyaW5nIHRvIGZpbmQgb3V0IHRoZSBicm93c2VyLlxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBnZXRVQSgpLCB0ID0gX19QUklWQVRFX1NpbXBsZURiLkMoZSksIG4gPSAwIDwgdCAmJiB0IDwgMTAsIHIgPSBfX1BSSVZBVEVfZ2V0QW5kcm9pZFZlcnNpb24oZSksIGkgPSAwIDwgciAmJiByIDwgNC41O1xuICAgICAgICAvLyBJRSAxMFxuICAgICAgICAvLyB1YSA9ICdNb3ppbGxhLzUuMCAoY29tcGF0aWJsZTsgTVNJRSAxMC4wOyBXaW5kb3dzIE5UIDYuMjsgVHJpZGVudC82LjApJztcbiAgICAgICAgLy8gSUUgMTFcbiAgICAgICAgLy8gdWEgPSAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgNi4zOyBUcmlkZW50LzcuMDsgcnY6MTEuMCkgbGlrZSBHZWNrbyc7XG4gICAgICAgIC8vIEVkZ2VcbiAgICAgICAgLy8gdWEgPSAnTW96aWxsYS81LjAgKFdpbmRvd3MgTlQgMTAuMDsgV09XNjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsXG4gICAgICAgIC8vIGxpa2UgR2Vja28pIENocm9tZS8zOS4wLjIxNzEuNzEgU2FmYXJpLzUzNy4zNiBFZGdlLzEyLjAnO1xuICAgICAgICAvLyBpT1MgU2FmYXJpOiBEaXNhYmxlIGZvciB1c2VycyBydW5uaW5nIGlPUyB2ZXJzaW9uIDwgMTAuXG4gICAgICAgICAgICAgICAgcmV0dXJuICEoZS5pbmRleE9mKFwiTVNJRSBcIikgPiAwIHx8IGUuaW5kZXhPZihcIlRyaWRlbnQvXCIpID4gMCB8fCBlLmluZGV4T2YoXCJFZGdlL1wiKSA+IDAgfHwgbiB8fCBpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoZSBiYWNraW5nIEluZGV4ZWREQiBzdG9yZSBpcyB0aGUgTm9kZSBJbmRleGVkREJTaGltXG4gICAgICogKHNlZSBodHRwczovL2dpdGh1Yi5jb20vYXhlbWNsaW9uL0luZGV4ZWREQlNoaW0pLlxuICAgICAqLyAgICBzdGF0aWMgdigpIHtcbiAgICAgICAgdmFyIGU7XG4gICAgICAgIHJldHVybiBcInVuZGVmaW5lZFwiICE9IHR5cGVvZiBwcm9jZXNzICYmIFwiWUVTXCIgPT09IChudWxsID09PSAoZSA9IHByb2Nlc3MuX19QUklWQVRFX2VudikgfHwgdm9pZCAwID09PSBlID8gdm9pZCAwIDogZS5GKTtcbiAgICB9XG4gICAgLyoqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZyb20gYSB0cmFuc2FjdGlvbi4gKi8gICAgc3RhdGljIE0oZSwgdCkge1xuICAgICAgICByZXR1cm4gZS5zdG9yZSh0KTtcbiAgICB9XG4gICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgIC8qKiBQYXJzZSBVc2VyIEFnZW50IHRvIGRldGVybWluZSBpT1MgdmVyc2lvbi4gUmV0dXJucyAtMSBpZiBub3QgZm91bmQuICovXG4gICAgc3RhdGljIEMoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5tYXRjaCgvaSg/OnBob25lfHBhZHxwb2QpIG9zIChbXFxkX10rKS9pKSwgbiA9IHQgPyB0WzFdLnNwbGl0KFwiX1wiKS5zbGljZSgwLCAyKS5qb2luKFwiLlwiKSA6IFwiLTFcIjtcbiAgICAgICAgcmV0dXJuIE51bWJlcihuKTtcbiAgICB9XG4gICAgLypcbiAgICAgKiBDcmVhdGVzIGEgbmV3IFNpbXBsZURiIHdyYXBwZXIgZm9yIEluZGV4ZWREYiBkYXRhYmFzZSBgbmFtZWAuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgYHZlcnNpb25gIG11c3Qgbm90IGJlIGEgZG93bmdyYWRlLiBJbmRleGVkREIgZG9lcyBub3Qgc3VwcG9ydFxuICAgICAqIGRvd25ncmFkaW5nIHRoZSBzY2hlbWEgdmVyc2lvbi4gV2UgY3VycmVudGx5IGRvIG5vdCBzdXBwb3J0IGFueSB3YXkgdG8gZG9cbiAgICAgKiB2ZXJzaW9uaW5nIG91dHNpZGUgb2YgSW5kZXhlZERCJ3MgdmVyc2lvbmluZyBtZWNoYW5pc20sIGFzIG9ubHlcbiAgICAgKiB2ZXJzaW9uLXVwZ3JhZGUgdHJhbnNhY3Rpb25zIGFyZSBhbGxvd2VkIHRvIGRvIHRoaW5ncyBsaWtlIGNyZWF0ZVxuICAgICAqIG9iamVjdHN0b3Jlcy5cbiAgICAgKi8gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLm5hbWUgPSBlLCB0aGlzLnZlcnNpb24gPSB0LCB0aGlzLk8gPSBuO1xuICAgICAgICAvLyBOT1RFOiBBY2NvcmRpbmcgdG8gaHR0cHM6Ly9idWdzLndlYmtpdC5vcmcvc2hvd19idWcuY2dpP2lkPTE5NzA1MCwgdGhlXG4gICAgICAgIC8vIGJ1ZyB3ZSdyZSBjaGVja2luZyBmb3Igc2hvdWxkIGV4aXN0IGluIGlPUyA+PSAxMi4yIGFuZCA8IDEzLCBidXQgZm9yXG4gICAgICAgIC8vIHdoYXRldmVyIHJlYXNvbiBpdCdzIG11Y2ggaGFyZGVyIHRvIGhpdCBhZnRlciAxMi4yIHNvIHdlIG9ubHkgcHJvYWN0aXZlbHlcbiAgICAgICAgLy8gbG9nIG9uIDEyLjIuXG4gICAgICAgIDEyLjIgPT09IF9fUFJJVkFURV9TaW1wbGVEYi5DKGdldFVBKCkpICYmIF9fUFJJVkFURV9sb2dFcnJvcihcIkZpcmVzdG9yZSBwZXJzaXN0ZW5jZSBzdWZmZXJzIGZyb20gYSBidWcgaW4gaU9TIDEyLjIgU2FmYXJpIHRoYXQgbWF5IGNhdXNlIHlvdXIgYXBwIHRvIHN0b3Agd29ya2luZy4gU2VlIGh0dHBzOi8vc3RhY2tvdmVyZmxvdy5jb20vcS81NjQ5NjI5Ni8xMTA5MTUgZm9yIGRldGFpbHMgYW5kIGEgcG90ZW50aWFsIHdvcmthcm91bmQuXCIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBPcGVucyB0aGUgc3BlY2lmaWVkIGRhdGFiYXNlLCBjcmVhdGluZyBvciB1cGdyYWRpbmcgaXQgaWYgbmVjZXNzYXJ5LlxuICAgICAqLyAgICBhc3luYyBOKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIgfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhMLCBcIk9wZW5pbmcgZGF0YWJhc2U6XCIsIHRoaXMubmFtZSksIHRoaXMuZGIgPSBhd2FpdCBuZXcgUHJvbWlzZSgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8obWlrZWxlaGVuKTogSW52ZXN0aWdhdGUgYnJvd3NlciBjb21wYXRpYmlsaXR5LlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0luZGV4ZWREQl9BUEkvVXNpbmdfSW5kZXhlZERCXG4gICAgICAgICAgICAvLyBzdWdnZXN0cyBJRTkgYW5kIG9sZGVyIFdlYktpdCBicm93c2VycyBoYW5kbGUgdXBncmFkZVxuICAgICAgICAgICAgLy8gZGlmZmVyZW50bHkuIFRoZXkgZXhwZWN0IHNldFZlcnNpb24sIGFzIGRlc2NyaWJlZCBoZXJlOlxuICAgICAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0lEQlZlcnNpb25DaGFuZ2VSZXF1ZXN0L3NldFZlcnNpb25cbiAgICAgICAgICAgIGNvbnN0IHIgPSBpbmRleGVkREIub3Blbih0aGlzLm5hbWUsIHRoaXMudmVyc2lvbik7XG4gICAgICAgICAgICByLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBlLnRhcmdldC5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgdChuKTtcbiAgICAgICAgICAgIH0sIHIub25ibG9ja2VkID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgIG4obmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUsIFwiQ2Fubm90IHVwZ3JhZGUgSW5kZXhlZERCIHNjaGVtYSB3aGlsZSBhbm90aGVyIHRhYiBpcyBvcGVuLiBDbG9zZSBhbGwgdGFicyB0aGF0IGFjY2VzcyBGaXJlc3RvcmUgYW5kIHJlbG9hZCB0aGlzIHBhZ2UgdG8gcHJvY2VlZC5cIikpO1xuICAgICAgICAgICAgfSwgci5vbmVycm9yID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHQudGFyZ2V0LmVycm9yO1xuICAgICAgICAgICAgICAgIFwiVmVyc2lvbkVycm9yXCIgPT09IHIubmFtZSA/IG4obmV3IEZpcmVzdG9yZUVycm9yKEMuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJBIG5ld2VyIHZlcnNpb24gb2YgdGhlIEZpcmVzdG9yZSBTREsgd2FzIHByZXZpb3VzbHkgdXNlZCBhbmQgc28gdGhlIHBlcnNpc3RlZCBkYXRhIGlzIG5vdCBjb21wYXRpYmxlIHdpdGggdGhlIHZlcnNpb24gb2YgdGhlIFNESyB5b3UgYXJlIG5vdyB1c2luZy4gVGhlIFNESyB3aWxsIG9wZXJhdGUgd2l0aCBwZXJzaXN0ZW5jZSBkaXNhYmxlZC4gSWYgeW91IG5lZWQgcGVyc2lzdGVuY2UsIHBsZWFzZSByZS11cGdyYWRlIHRvIGEgbmV3ZXIgdmVyc2lvbiBvZiB0aGUgU0RLIG9yIGVsc2UgY2xlYXIgdGhlIHBlcnNpc3RlZCBJbmRleGVkREIgZGF0YSBmb3IgeW91ciBhcHAgdG8gc3RhcnQgZnJlc2guXCIpKSA6IFwiSW52YWxpZFN0YXRlRXJyb3JcIiA9PT0gci5uYW1lID8gbihuZXcgRmlyZXN0b3JlRXJyb3IoQy5GQUlMRURfUFJFQ09ORElUSU9OLCBcIlVuYWJsZSB0byBvcGVuIGFuIEluZGV4ZWREQiBjb25uZWN0aW9uLiBUaGlzIGNvdWxkIGJlIGR1ZSB0byBydW5uaW5nIGluIGEgcHJpdmF0ZSBicm93c2luZyBzZXNzaW9uIG9uIGEgYnJvd3NlciB3aG9zZSBwcml2YXRlIGJyb3dzaW5nIHNlc3Npb25zIGRvIG5vdCBzdXBwb3J0IEluZGV4ZWREQjogXCIgKyByKSkgOiBuKG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlLCByKSk7XG4gICAgICAgICAgICB9LCByLm9udXBncmFkZW5lZWRlZCA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhMLCAnRGF0YWJhc2UgXCInICsgdGhpcy5uYW1lICsgJ1wiIHJlcXVpcmVzIHVwZ3JhZGUgZnJvbSB2ZXJzaW9uOicsIGUub2xkVmVyc2lvbik7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICB0aGlzLk8uQih0LCByLnRyYW5zYWN0aW9uLCBlLm9sZFZlcnNpb24sIHRoaXMudmVyc2lvbikubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoTCwgXCJEYXRhYmFzZSB1cGdyYWRlIHRvIHZlcnNpb24gXCIgKyB0aGlzLnZlcnNpb24gKyBcIiBjb21wbGV0ZVwiKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkpLCB0aGlzLkwgJiYgKHRoaXMuZGIub252ZXJzaW9uY2hhbmdlID0gZSA9PiB0aGlzLkwoZSkpLCB0aGlzLmRiO1xuICAgIH1cbiAgICBrKGUpIHtcbiAgICAgICAgdGhpcy5MID0gZSwgdGhpcy5kYiAmJiAodGhpcy5kYi5vbnZlcnNpb25jaGFuZ2UgPSB0ID0+IGUodCkpO1xuICAgIH1cbiAgICBhc3luYyBydW5UcmFuc2FjdGlvbihlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBcInJlYWRvbmx5XCIgPT09IHQ7XG4gICAgICAgIGxldCBzID0gMDtcbiAgICAgICAgZm9yICg7Oykge1xuICAgICAgICAgICAgKytzO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLmRiID0gYXdhaXQgdGhpcy5OKGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfU2ltcGxlRGJUcmFuc2FjdGlvbi5vcGVuKHRoaXMuZGIsIGUsIGkgPyBcInJlYWRvbmx5XCIgOiBcInJlYWR3cml0ZVwiLCBuKSwgcyA9IHIodCkubmV4dCgoZSA9PiAodC5TKCksIFxuICAgICAgICAgICAgICAgIGUpKSkuY2F0Y2goKGUgPT4gKFxuICAgICAgICAgICAgICAgIC8vIEFib3J0IHRoZSB0cmFuc2FjdGlvbiBpZiB0aGVyZSB3YXMgYW4gZXJyb3IuXG4gICAgICAgICAgICAgICAgdC5hYm9ydChlKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlamVjdChlKSkpKS50b1Byb21pc2UoKTtcbiAgICAgICAgICAgICAgICAvLyBBcyBub3RlZCBhYm92ZSwgZXJyb3JzIGFyZSBwcm9wYWdhdGVkIGJ5IGFib3J0aW5nIHRoZSB0cmFuc2FjdGlvbi4gU29cbiAgICAgICAgICAgICAgICAvLyB3ZSBzd2FsbG93IGFueSBlcnJvciBoZXJlIHRvIGF2b2lkIHRoZSBicm93c2VyIGxvZ2dpbmcgaXQgYXMgdW5oYW5kbGVkLlxuICAgICAgICAgICAgICAgIHJldHVybiBzLmNhdGNoKCgoKSA9PiB7fSkpLCBcbiAgICAgICAgICAgICAgICAvLyBXYWl0IGZvciB0aGUgdHJhbnNhY3Rpb24gdG8gY29tcGxldGUgKGkuZS4gSW5kZXhlZERiJ3Mgb25zdWNjZXNzIGV2ZW50IHRvXG4gICAgICAgICAgICAgICAgLy8gZmlyZSksIGJ1dCBzdGlsbCByZXR1cm4gdGhlIG9yaWdpbmFsIHRyYW5zYWN0aW9uRm5SZXN1bHQgYmFjayB0byB0aGVcbiAgICAgICAgICAgICAgICAvLyBjYWxsZXIuXG4gICAgICAgICAgICAgICAgYXdhaXQgdC5wLCBzO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLCBuID0gXCJGaXJlYmFzZUVycm9yXCIgIT09IHQubmFtZSAmJiBzIDwgMztcbiAgICAgICAgICAgICAgICAvLyBUT0RPKHNjaG1pZHQtc2ViYXN0aWFuKTogV2UgY291bGQgcHJvYmFibHkgYmUgc21hcnRlciBhYm91dCB0aGlzIGFuZFxuICAgICAgICAgICAgICAgIC8vIG5vdCByZXRyeSBleGNlcHRpb25zIHRoYXQgYXJlIGxpa2VseSB1bnJlY292ZXJhYmxlIChzdWNoIGFzIHF1b3RhXG4gICAgICAgICAgICAgICAgLy8gZXhjZWVkZWQgZXJyb3JzKS5cbiAgICAgICAgICAgICAgICAvLyBOb3RlOiBXZSBjYW5ub3QgdXNlIGFuIGluc3RhbmNlb2YgY2hlY2sgZm9yIEZpcmVzdG9yZUV4Y2VwdGlvbiwgc2luY2UgdGhlXG4gICAgICAgICAgICAgICAgLy8gZXhjZXB0aW9uIGlzIHdyYXBwZWQgaW4gYSBnZW5lcmljIGVycm9yIGJ5IG91ciBhc3luYy9hd2FpdCBoYW5kbGluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9sb2dEZWJ1ZyhMLCBcIlRyYW5zYWN0aW9uIGZhaWxlZCB3aXRoIGVycm9yOlwiLCB0Lm1lc3NhZ2UsIFwiUmV0cnlpbmc6XCIsIG4pLCBcbiAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCksICFuKSByZXR1cm4gUHJvbWlzZS5yZWplY3QodCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2xvc2UoKSB7XG4gICAgICAgIHRoaXMuZGIgJiYgdGhpcy5kYi5jbG9zZSgpLCB0aGlzLmRiID0gdm9pZCAwO1xuICAgIH1cbn1cblxuLyoqIFBhcnNlIFVzZXIgQWdlbnQgdG8gZGV0ZXJtaW5lIEFuZHJvaWQgdmVyc2lvbi4gUmV0dXJucyAtMSBpZiBub3QgZm91bmQuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRBbmRyb2lkVmVyc2lvbihlKSB7XG4gICAgY29uc3QgdCA9IGUubWF0Y2goL0FuZHJvaWQgKFtcXGQuXSspL2kpLCBuID0gdCA/IHRbMV0uc3BsaXQoXCIuXCIpLnNsaWNlKDAsIDIpLmpvaW4oXCIuXCIpIDogXCItMVwiO1xuICAgIHJldHVybiBOdW1iZXIobik7XG59XG5cbi8qKlxuICogQSBjb250cm9sbGVyIGZvciBpdGVyYXRpbmcgb3ZlciBhIGtleSByYW5nZSBvciBpbmRleC4gSXQgYWxsb3dzIGFuIGl0ZXJhdGVcbiAqIGNhbGxiYWNrIHRvIGRlbGV0ZSB0aGUgY3VycmVudGx5LXJlZmVyZW5jZWQgb2JqZWN0LCBvciBqdW1wIHRvIGEgbmV3IGtleVxuICogd2l0aGluIHRoZSBrZXkgcmFuZ2Ugb3IgaW5kZXguXG4gKi8gY2xhc3MgX19QUklWQVRFX0l0ZXJhdGlvbkNvbnRyb2xsZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5xID0gZSwgdGhpcy4kID0gITEsIHRoaXMuVSA9IG51bGw7XG4gICAgfVxuICAgIGdldCBpc0RvbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiQ7XG4gICAgfVxuICAgIGdldCBLKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5VO1xuICAgIH1cbiAgICBzZXQgY3Vyc29yKGUpIHtcbiAgICAgICAgdGhpcy5xID0gZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBmdW5jdGlvbiBjYW4gYmUgY2FsbGVkIHRvIHN0b3AgaXRlcmF0aW9uIGF0IGFueSBwb2ludC5cbiAgICAgKi8gICAgZG9uZSgpIHtcbiAgICAgICAgdGhpcy4kID0gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgZnVuY3Rpb24gY2FuIGJlIGNhbGxlZCB0byBza2lwIHRvIHRoYXQgbmV4dCBrZXksIHdoaWNoIGNvdWxkIGJlXG4gICAgICogYW4gaW5kZXggb3IgYSBwcmltYXJ5IGtleS5cbiAgICAgKi8gICAgVyhlKSB7XG4gICAgICAgIHRoaXMuVSA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZSB0aGUgY3VycmVudCBjdXJzb3IgdmFsdWUgZnJvbSB0aGUgb2JqZWN0IHN0b3JlLlxuICAgICAqXG4gICAgICogTk9URTogWW91IENBTk5PVCBkbyB0aGlzIHdpdGggYSBrZXlzT25seSBxdWVyeS5cbiAgICAgKi8gICAgZGVsZXRlKCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyYXBSZXF1ZXN0KHRoaXMucS5kZWxldGUoKSk7XG4gICAgfVxufVxuXG4vKiogQW4gZXJyb3IgdGhhdCB3cmFwcyBleGNlcHRpb25zIHRoYXQgdGhyb3duIGR1cmluZyBJbmRleGVkREIgZXhlY3V0aW9uLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvciBleHRlbmRzIEZpcmVzdG9yZUVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKEMuVU5BVkFJTEFCTEUsIGBJbmRleGVkREIgdHJhbnNhY3Rpb24gJyR7ZX0nIGZhaWxlZDogJHt0fWApLCB0aGlzLm5hbWUgPSBcIkluZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3JcIjtcbiAgICB9XG59XG5cbi8qKiBWZXJpZmllcyB3aGV0aGVyIGBlYCBpcyBhbiBJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUpIHtcbiAgICAvLyBVc2UgbmFtZSBlcXVhbGl0eSwgYXMgaW5zdGFuY2VvZiBjaGVja3Mgb24gZXJyb3JzIGRvbid0IHdvcmsgd2l0aCBlcnJvcnNcbiAgICAvLyB0aGF0IHdyYXAgb3RoZXIgZXJyb3JzLlxuICAgIHJldHVybiBcIkluZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3JcIiA9PT0gZS5uYW1lO1xufVxuXG4vKipcbiAqIEEgd3JhcHBlciBhcm91bmQgYW4gSURCT2JqZWN0U3RvcmUgcHJvdmlkaW5nIGFuIEFQSSB0aGF0OlxuICpcbiAqIDEpIEhhcyBnZW5lcmljIEtleVR5cGUgLyBWYWx1ZVR5cGUgcGFyYW1ldGVycyB0byBwcm92aWRlIHN0cm9uZ2x5LXR5cGVkXG4gKiBtZXRob2RzIGZvciBhY3RpbmcgYWdhaW5zdCB0aGUgb2JqZWN0IHN0b3JlLlxuICogMikgRGVhbHMgd2l0aCBJbmRleGVkREIncyBvbnN1Y2Nlc3MgLyBvbmVycm9yIGV2ZW50IGNhbGxiYWNrcywgbWFraW5nIGV2ZXJ5XG4gKiBtZXRob2QgcmV0dXJuIGEgUGVyc2lzdGVuY2VQcm9taXNlIGluc3RlYWQuXG4gKiAzKSBQcm92aWRlcyBhIGhpZ2hlci1sZXZlbCBBUEkgdG8gYXZvaWQgbmVlZGluZyB0byBkbyBleGNlc3NpdmUgd3JhcHBpbmcgb2ZcbiAqIGludGVybWVkaWF0ZSBJbmRleGVkREIgdHlwZXMgKElEQkN1cnNvcldpdGhWYWx1ZSwgZXRjLilcbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2ltcGxlRGJTdG9yZSB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLnN0b3JlID0gZTtcbiAgICB9XG4gICAgcHV0KGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHQgPyAoX19QUklWQVRFX2xvZ0RlYnVnKEwsIFwiUFVUXCIsIHRoaXMuc3RvcmUubmFtZSwgZSwgdCksIG4gPSB0aGlzLnN0b3JlLnB1dCh0LCBlKSkgOiAoX19QUklWQVRFX2xvZ0RlYnVnKEwsIFwiUFVUXCIsIHRoaXMuc3RvcmUubmFtZSwgXCI8YXV0by1rZXk+XCIsIGUpLCBcbiAgICAgICAgbiA9IHRoaXMuc3RvcmUucHV0KGUpKSwgX19QUklWQVRFX3dyYXBSZXF1ZXN0KG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IHZhbHVlIGludG8gYW4gT2JqZWN0IFN0b3JlIGFuZCByZXR1cm5zIHRoZSBuZXcga2V5LiBTaW1pbGFyIHRvXG4gICAgICogSW5kZXhlZERiJ3MgYGFkZCgpYCwgdGhpcyBtZXRob2Qgd2lsbCBmYWlsIG9uIHByaW1hcnkga2V5IGNvbGxpc2lvbnMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBUaGUgb2JqZWN0IHRvIHdyaXRlLlxuICAgICAqIEByZXR1cm5zIFRoZSBrZXkgb2YgdGhlIHZhbHVlIHRvIGFkZC5cbiAgICAgKi8gICAgYWRkKGUpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKEwsIFwiQUREXCIsIHRoaXMuc3RvcmUubmFtZSwgZSwgZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QodGhpcy5zdG9yZS5hZGQoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBvYmplY3Qgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSBmcm9tIHRoZSBzcGVjaWZpZWQgc3RvcmUsIG9yIG51bGxcbiAgICAgKiBpZiBubyBvYmplY3QgZXhpc3RzIHdpdGggdGhlIHNwZWNpZmllZCBrZXkuXG4gICAgICpcbiAgICAgKiBAa2V5IFRoZSBrZXkgb2YgdGhlIG9iamVjdCB0byBnZXQuXG4gICAgICogQHJldHVybnMgVGhlIG9iamVjdCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IG9yIG51bGwgaWYgbm8gb2JqZWN0IGV4aXN0cy5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgLy8gV2UncmUgZG9pbmcgYW4gdW5zYWZlIGNhc3QgdG8gVmFsdWVUeXBlLlxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyYXBSZXF1ZXN0KHRoaXMuc3RvcmUuZ2V0KGUpKS5uZXh0KCh0ID0+IChcbiAgICAgICAgLy8gTm9ybWFsaXplIG5vbmV4aXN0ZW5jZSB0byBudWxsLlxuICAgICAgICB2b2lkIDAgPT09IHQgJiYgKHQgPSBudWxsKSwgX19QUklWQVRFX2xvZ0RlYnVnKEwsIFwiR0VUXCIsIHRoaXMuc3RvcmUubmFtZSwgZSwgdCksIFxuICAgICAgICB0KSkpO1xuICAgIH1cbiAgICBkZWxldGUoZSkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoTCwgXCJERUxFVEVcIiwgdGhpcy5zdG9yZS5uYW1lLCBlKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cmFwUmVxdWVzdCh0aGlzLnN0b3JlLmRlbGV0ZShlKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIElmIHdlIGV2ZXIgbmVlZCBtb3JlIG9mIHRoZSBjb3VudCB2YXJpYW50cywgd2UgY2FuIGFkZCBvdmVybG9hZHMuIEZvciBub3csXG4gICAgICogYWxsIHdlIG5lZWQgaXMgdG8gY291bnQgZXZlcnl0aGluZyBpbiBhIHN0b3JlLlxuICAgICAqXG4gICAgICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHJvd3MgaW4gdGhlIHN0b3JlLlxuICAgICAqLyAgICBjb3VudCgpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKEwsIFwiQ09VTlRcIiwgdGhpcy5zdG9yZS5uYW1lKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cmFwUmVxdWVzdCh0aGlzLnN0b3JlLmNvdW50KCkpO1xuICAgIH1cbiAgICBHKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMub3B0aW9ucyhlLCB0KSwgciA9IG4uaW5kZXggPyB0aGlzLnN0b3JlLmluZGV4KG4uaW5kZXgpIDogdGhpcy5zdG9yZTtcbiAgICAgICAgLy8gVXNlIGBnZXRBbGwoKWAgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgSW5kZXhlZERCIHYzLCBhcyBpdCBpcyByb3VnaGx5XG4gICAgICAgIC8vIDIwJSBmYXN0ZXIuXG4gICAgICAgICAgICAgICAgaWYgKFwiZnVuY3Rpb25cIiA9PSB0eXBlb2Ygci5nZXRBbGwpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSByLmdldEFsbChuLnJhbmdlKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGUub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBuKGUudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgICAgICB9LCBlLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0KGUudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5jdXJzb3IobiksIHQgPSBbXTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmooZSwgKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdC5wdXNoKG4pO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb2FkcyB0aGUgZmlyc3QgYGNvdW50YCBlbGVtZW50cyBmcm9tIHRoZSBwcm92aWRlZCBpbmRleCByYW5nZS4gTG9hZHMgYWxsXG4gICAgICogZWxlbWVudHMgaWYgbm8gbGltaXQgaXMgcHJvdmlkZWQuXG4gICAgICovICAgIEgoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5zdG9yZS5nZXRBbGwoZSwgbnVsbCA9PT0gdCA/IHZvaWQgMCA6IHQpO1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIG4ub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIHQoZS50YXJnZXQuZXJyb3IpO1xuICAgICAgICAgICAgfSwgbi5vbnN1Y2Nlc3MgPSB0ID0+IHtcbiAgICAgICAgICAgICAgICBlKHQudGFyZ2V0LnJlc3VsdCk7XG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIEooZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoTCwgXCJERUxFVEUgQUxMXCIsIHRoaXMuc3RvcmUubmFtZSk7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLm9wdGlvbnMoZSwgdCk7XG4gICAgICAgIG4uWSA9ICExO1xuICAgICAgICBjb25zdCByID0gdGhpcy5jdXJzb3Iobik7XG4gICAgICAgIHJldHVybiB0aGlzLmoociwgKChlLCB0LCBuKSA9PiBuLmRlbGV0ZSgpKSk7XG4gICAgfVxuICAgIFooZSwgdCkge1xuICAgICAgICBsZXQgbjtcbiAgICAgICAgdCA/IG4gPSBlIDogKG4gPSB7fSwgdCA9IGUpO1xuICAgICAgICBjb25zdCByID0gdGhpcy5jdXJzb3Iobik7XG4gICAgICAgIHJldHVybiB0aGlzLmoociwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYSBzdG9yZSwgYnV0IHdhaXRzIGZvciB0aGUgZ2l2ZW4gY2FsbGJhY2sgdG8gY29tcGxldGUgZm9yXG4gICAgICogZWFjaCBlbnRyeSBiZWZvcmUgaXRlcmF0aW5nIHRoZSBuZXh0IGVudHJ5LiBUaGlzIGFsbG93cyB0aGUgY2FsbGJhY2sgdG8gZG9cbiAgICAgKiBhc3luY2hyb25vdXMgd29yayB0byBkZXRlcm1pbmUgaWYgdGhpcyBpdGVyYXRpb24gc2hvdWxkIGNvbnRpbnVlLlxuICAgICAqXG4gICAgICogVGhlIHByb3ZpZGVkIGNhbGxiYWNrIHNob3VsZCByZXR1cm4gYHRydWVgIHRvIGNvbnRpbnVlIGl0ZXJhdGlvbiwgYW5kXG4gICAgICogYGZhbHNlYCBvdGhlcndpc2UuXG4gICAgICovICAgIFgoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jdXJzb3Ioe30pO1xuICAgICAgICByZXR1cm4gbmV3IFBlcnNpc3RlbmNlUHJvbWlzZSgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIHQub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2hlY2tGb3JBbmRSZXBvcnRpT1NFcnJvcihlLnRhcmdldC5lcnJvcik7XG4gICAgICAgICAgICAgICAgcih0KTtcbiAgICAgICAgICAgIH0sIHQub25zdWNjZXNzID0gdCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHQudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICByID8gZShyLnByaW1hcnlLZXksIHIudmFsdWUpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlID8gci5jb250aW51ZSgpIDogbigpO1xuICAgICAgICAgICAgICAgIH0pKSA6IG4oKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgaihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgcmV0dXJuIG5ldyBQZXJzaXN0ZW5jZVByb21pc2UoKChyLCBpKSA9PiB7XG4gICAgICAgICAgICBlLm9uZXJyb3IgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBpKGUudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgIH0sIGUub25zdWNjZXNzID0gZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoIWkpIHJldHVybiB2b2lkIHIoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gbmV3IF9fUFJJVkFURV9JdGVyYXRpb25Db250cm9sbGVyKGkpLCBvID0gdChpLnByaW1hcnlLZXksIGkudmFsdWUsIHMpO1xuICAgICAgICAgICAgICAgIGlmIChvIGluc3RhbmNlb2YgUGVyc2lzdGVuY2VQcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBvLmNhdGNoKChlID0+IChzLmRvbmUoKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlamVjdChlKSkpKTtcbiAgICAgICAgICAgICAgICAgICAgbi5wdXNoKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBzLmlzRG9uZSA/IHIoKSA6IG51bGwgPT09IHMuSyA/IGkuY29udGludWUoKSA6IGkuY29udGludWUocy5LKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihuKSkpO1xuICAgIH1cbiAgICBvcHRpb25zKGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUgJiYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBuID0gZSA6IHQgPSBlKSwge1xuICAgICAgICAgICAgaW5kZXg6IG4sXG4gICAgICAgICAgICByYW5nZTogdFxuICAgICAgICB9O1xuICAgIH1cbiAgICBjdXJzb3IoZSkge1xuICAgICAgICBsZXQgdCA9IFwibmV4dFwiO1xuICAgICAgICBpZiAoZS5yZXZlcnNlICYmICh0ID0gXCJwcmV2XCIpLCBlLmluZGV4KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5zdG9yZS5pbmRleChlLmluZGV4KTtcbiAgICAgICAgICAgIHJldHVybiBlLlkgPyBuLm9wZW5LZXlDdXJzb3IoZS5yYW5nZSwgdCkgOiBuLm9wZW5DdXJzb3IoZS5yYW5nZSwgdCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuc3RvcmUub3BlbkN1cnNvcihlLnJhbmdlLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogV3JhcHMgYW4gSURCUmVxdWVzdCBpbiBhIFBlcnNpc3RlbmNlUHJvbWlzZSwgdXNpbmcgdGhlIG9uc3VjY2VzcyAvIG9uZXJyb3JcbiAqIGhhbmRsZXJzIHRvIHJlc29sdmUgLyByZWplY3QgdGhlIFBlcnNpc3RlbmNlUHJvbWlzZSBhcyBhcHByb3ByaWF0ZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfd3JhcFJlcXVlc3QoZSkge1xuICAgIHJldHVybiBuZXcgUGVyc2lzdGVuY2VQcm9taXNlKCgodCwgbikgPT4ge1xuICAgICAgICBlLm9uc3VjY2VzcyA9IGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IGUudGFyZ2V0LnJlc3VsdDtcbiAgICAgICAgICAgIHQobik7XG4gICAgICAgIH0sIGUub25lcnJvciA9IGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9jaGVja0ZvckFuZFJlcG9ydGlPU0Vycm9yKGUudGFyZ2V0LmVycm9yKTtcbiAgICAgICAgICAgIG4odCk7XG4gICAgICAgIH07XG4gICAgfSkpO1xufVxuXG4vLyBHdWFyZCBzbyB3ZSBvbmx5IHJlcG9ydCB0aGUgZXJyb3Igb25jZS5cbmxldCBrID0gITE7XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jaGVja0ZvckFuZFJlcG9ydGlPU0Vycm9yKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX1NpbXBsZURiLkMoZ2V0VUEoKSk7XG4gICAgaWYgKHQgPj0gMTIuMiAmJiB0IDwgMTMpIHtcbiAgICAgICAgY29uc3QgdCA9IFwiQW4gaW50ZXJuYWwgZXJyb3Igd2FzIGVuY291bnRlcmVkIGluIHRoZSBJbmRleGVkIERhdGFiYXNlIHNlcnZlclwiO1xuICAgICAgICBpZiAoZS5tZXNzYWdlLmluZGV4T2YodCkgPj0gMCkge1xuICAgICAgICAgICAgLy8gV3JhcCBlcnJvciBpbiBhIG1vcmUgZGVzY3JpcHRpdmUgb25lLlxuICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBGaXJlc3RvcmVFcnJvcihcImludGVybmFsXCIsIGBJT1NfSU5ERVhFRERCX0JVRzE6IEluZGV4ZWREYiBoYXMgdGhyb3duICcke3R9Jy4gVGhpcyBpcyBsaWtlbHkgZHVlIHRvIGFuIHVuYXZvaWRhYmxlIGJ1ZyBpbiBpT1MuIFNlZSBodHRwczovL3N0YWNrb3ZlcmZsb3cuY29tL3EvNTY0OTYyOTYvMTEwOTE1IGZvciBkZXRhaWxzIGFuZCBhIHBvdGVudGlhbCB3b3JrYXJvdW5kLmApO1xuICAgICAgICAgICAgcmV0dXJuIGsgfHwgKGsgPSAhMCwgXG4gICAgICAgICAgICAvLyBUaHJvdyBhIGdsb2JhbCBleGNlcHRpb24gb3V0c2lkZSBvZiB0aGlzIHByb21pc2UgY2hhaW4sIGZvciB0aGUgdXNlciB0b1xuICAgICAgICAgICAgLy8gcG90ZW50aWFsbHkgY2F0Y2guXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgIH0pLCAwKSksIGU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGU7XG59XG5cbmNvbnN0IHEgPSBcIkluZGV4QmFja2ZpbGxlclwiO1xuXG4vKiogSG93IGxvbmcgd2Ugd2FpdCB0byB0cnkgcnVubmluZyBpbmRleCBiYWNrZmlsbCBhZnRlciBTREsgaW5pdGlhbGl6YXRpb24uICovXG4vKiogVGhpcyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgdGhlIHNjaGVkdWxpbmcgb2YgSW5kZXggQmFja2ZpbGxlci4gKi9cbmNsYXNzIF9fUFJJVkFURV9JbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gZSwgdGhpcy5lZSA9IHQsIHRoaXMudGFzayA9IG51bGw7XG4gICAgfVxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLnRlKDE1ZTMpO1xuICAgIH1cbiAgICBzdG9wKCkge1xuICAgICAgICB0aGlzLnRhc2sgJiYgKHRoaXMudGFzay5jYW5jZWwoKSwgdGhpcy50YXNrID0gbnVsbCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy50YXNrO1xuICAgIH1cbiAgICB0ZShlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhxLCBgU2NoZWR1bGVkIGluICR7ZX1tc2ApLCB0aGlzLnRhc2sgPSB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFmdGVyRGVsYXkoXCJpbmRleF9iYWNrZmlsbFwiIC8qIFRpbWVySWQuSW5kZXhCYWNrZmlsbCAqLyAsIGUsIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnRhc2sgPSBudWxsO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgdGhpcy5lZS5uZSgpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhxLCBgRG9jdW1lbnRzIHdyaXR0ZW46ICR7ZX1gKTtcbiAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUpID8gX19QUklWQVRFX2xvZ0RlYnVnKHEsIFwiSWdub3JpbmcgSW5kZXhlZERCIGVycm9yIGR1cmluZyBpbmRleCBiYWNrZmlsbDogXCIsIGUpIDogYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMudGUoNmU0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqIEltcGxlbWVudHMgdGhlIHN0ZXBzIGZvciBiYWNrZmlsbGluZyBpbmRleGVzLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhCYWNrZmlsbGVyIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBMb2NhbFN0b3JlIHByb3ZpZGVzIGFjY2VzcyB0byBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRWaWV3LlxuICAgICAqIFRoZXNlIHByb3BlcnRpZXMgd2lsbCB1cGRhdGUgd2hlbiB0aGUgdXNlciBjaGFuZ2VzLiBDb25zZXF1ZW50bHksXG4gICAgICogbWFraW5nIGEgbG9jYWwgY29weSBvZiBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRWaWV3IHdpbGwgcmVxdWlyZVxuICAgICAqIHVwZGF0ZXMgb3ZlciB0aW1lLiBUaGUgc2ltcGxlciBzb2x1dGlvbiBpcyB0byByZWx5IG9uIExvY2FsU3RvcmUgdG8gaGF2ZVxuICAgICAqIGFuIHVwLXRvLWRhdGUgcmVmZXJlbmNlcyB0byBJbmRleE1hbmFnZXIgYW5kIExvY2FsRG9jdW1lbnRTdG9yZS5cbiAgICAgKi9cbiAgICBlLCB0KSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMucGVyc2lzdGVuY2UgPSB0O1xuICAgIH1cbiAgICBhc3luYyBuZShlID0gNTApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJCYWNrZmlsbCBJbmRleGVzXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4gdGhpcy5yZSh0LCBlKSkpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGluZGV4IGVudHJpZXMgdW50aWwgdGhlIGNhcCBpcyByZWFjaGVkLiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHByb2Nlc3NlZC4gKi8gICAgcmUoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IFNldDtcbiAgICAgICAgbGV0IHIgPSB0LCBpID0gITA7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZG9XaGlsZSgoKCkgPT4gITAgPT09IGkgJiYgciA+IDApLCAoKCkgPT4gdGhpcy5sb2NhbFN0b3JlLmluZGV4TWFuYWdlci5nZXROZXh0Q29sbGVjdGlvbkdyb3VwVG9VcGRhdGUoZSkubmV4dCgodCA9PiB7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gdCAmJiAhbi5oYXModCkpIHJldHVybiBfX1BSSVZBVEVfbG9nRGVidWcocSwgYFByb2Nlc3NpbmcgY29sbGVjdGlvbjogJHt0fWApLCBcbiAgICAgICAgICAgIHRoaXMuaWUoZSwgdCwgcikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgciAtPSBlLCBuLmFkZCh0KTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIGkgPSAhMTtcbiAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gdCAtIHIpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogV3JpdGVzIGVudHJpZXMgZm9yIHRoZSBwcm92aWRlZCBjb2xsZWN0aW9uIGdyb3VwLiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgZG9jdW1lbnRzIHByb2Nlc3NlZC5cbiAgICAgKi8gICAgaWUoZSwgdCwgbikge1xuICAgICAgICAvLyBVc2UgdGhlIGVhcmxpZXN0IG9mZnNldCBvZiBhbGwgZmllbGQgaW5kZXhlcyB0byBxdWVyeSB0aGUgbG9jYWwgY2FjaGUuXG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsU3RvcmUuaW5kZXhNYW5hZ2VyLmdldE1pbk9mZnNldEZyb21Db2xsZWN0aW9uR3JvdXAoZSwgdCkubmV4dCgociA9PiB0aGlzLmxvY2FsU3RvcmUubG9jYWxEb2N1bWVudHMuZ2V0TmV4dERvY3VtZW50cyhlLCB0LCByLCBuKS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuLmNoYW5nZXM7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2NhbFN0b3JlLmluZGV4TWFuYWdlci51cGRhdGVJbmRleEVudHJpZXMoZSwgaSkubmV4dCgoKCkgPT4gdGhpcy5zZShyLCBuKSkpLm5leHQoKG4gPT4gKF9fUFJJVkFURV9sb2dEZWJ1ZyhxLCBgVXBkYXRpbmcgb2Zmc2V0OiAke259YCksIFxuICAgICAgICAgICAgdGhpcy5sb2NhbFN0b3JlLmluZGV4TWFuYWdlci51cGRhdGVDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbikpKSkubmV4dCgoKCkgPT4gaS5zaXplKSk7XG4gICAgICAgIH0pKSkpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgbmV4dCBvZmZzZXQgYmFzZWQgb24gdGhlIHByb3ZpZGVkIGRvY3VtZW50cy4gKi8gICAgc2UoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IGU7XG4gICAgICAgIHJldHVybiB0LmNoYW5nZXMuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRGcm9tRG9jdW1lbnQodCk7XG4gICAgICAgICAgICBfX1BSSVZBVEVfaW5kZXhPZmZzZXRDb21wYXJhdG9yKHIsIG4pID4gMCAmJiAobiA9IHIpO1xuICAgICAgICB9KSksIG5ldyBJbmRleE9mZnNldChuLnJlYWRUaW1lLCBuLmRvY3VtZW50S2V5LCBNYXRoLm1heCh0LmJhdGNoSWQsIGUubGFyZ2VzdEJhdGNoSWQpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIGBMaXN0ZW5TZXF1ZW5jZWAgaXMgYSBtb25vdG9uaWMgc2VxdWVuY2UuIEl0IGlzIGluaXRpYWxpemVkIHdpdGggYSBtaW5pbXVtIHZhbHVlIHRvXG4gKiBleGNlZWQuIEFsbCBzdWJzZXF1ZW50IGNhbGxzIHRvIG5leHQgd2lsbCByZXR1cm4gaW5jcmVhc2luZyB2YWx1ZXMuIElmIHByb3ZpZGVkIHdpdGggYVxuICogYFNlcXVlbmNlTnVtYmVyU3luY2VyYCwgaXQgd2lsbCBhZGRpdGlvbmFsbHkgYnVtcCBpdHMgbmV4dCB2YWx1ZSB3aGVuIHRvbGQgb2YgYSBuZXcgdmFsdWUsIGFzXG4gKiB3ZWxsIGFzIHdyaXRlIG91dCBzZXF1ZW5jZSBudW1iZXJzIHRoYXQgaXQgcHJvZHVjZXMgdmlhIGBuZXh0KClgLlxuICovIGNsYXNzIF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnByZXZpb3VzVmFsdWUgPSBlLCB0ICYmICh0LnNlcXVlbmNlTnVtYmVySGFuZGxlciA9IGUgPT4gdGhpcy5vZShlKSwgdGhpcy5fZSA9IGUgPT4gdC53cml0ZVNlcXVlbmNlTnVtYmVyKGUpKTtcbiAgICB9XG4gICAgb2UoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmV2aW91c1ZhbHVlID0gTWF0aC5tYXgoZSwgdGhpcy5wcmV2aW91c1ZhbHVlKSwgdGhpcy5wcmV2aW91c1ZhbHVlO1xuICAgIH1cbiAgICBuZXh0KCkge1xuICAgICAgICBjb25zdCBlID0gKyt0aGlzLnByZXZpb3VzVmFsdWU7XG4gICAgICAgIHJldHVybiB0aGlzLl9lICYmIHRoaXMuX2UoZSksIGU7XG4gICAgfVxufVxuXG5fX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUgPSAtMTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBTZW50aW5lbCB2YWx1ZSB0aGF0IHNvcnRzIGJlZm9yZSBhbnkgTXV0YXRpb24gQmF0Y2ggSUQuICovXG5jb25zdCBRID0gLTE7XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIGEgdmFyaWFibGUgaXMgZWl0aGVyIHVuZGVmaW5lZCBvciBudWxsLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZChlKSB7XG4gICAgcmV0dXJuIG51bGwgPT0gZTtcbn1cblxuLyoqIFJldHVybnMgd2hldGhlciB0aGUgdmFsdWUgcmVwcmVzZW50cyAtMC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKGUpIHtcbiAgICAvLyBEZXRlY3QgaWYgdGhlIHZhbHVlIGlzIC0wLjAuIEJhc2VkIG9uIHBvbHlmaWxsIGZyb21cbiAgICAvLyBodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9KYXZhU2NyaXB0L1JlZmVyZW5jZS9HbG9iYWxfT2JqZWN0cy9PYmplY3QvaXNcbiAgICByZXR1cm4gMCA9PT0gZSAmJiAxIC8gZSA9PSAtMSAvIDA7XG59XG5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIGEgdmFsdWUgaXMgYW4gaW50ZWdlciBhbmQgaW4gdGhlIHNhZmUgaW50ZWdlciByYW5nZVxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIHRlc3QgZm9yIGJlaW5nIGFuIGludGVnZXIgYW5kIGluIHRoZSBzYWZlIHJhbmdlXG4gKi8gZnVuY3Rpb24gaXNTYWZlSW50ZWdlcihlKSB7XG4gICAgcmV0dXJuIFwibnVtYmVyXCIgPT0gdHlwZW9mIGUgJiYgTnVtYmVyLmlzSW50ZWdlcihlKSAmJiAhX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKGUpICYmIGUgPD0gTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgJiYgZSA+PSBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgJCA9IFwiXHUwMDAxXCI7XG5cbi8qKlxuICogRW5jb2RlcyBhIHJlc291cmNlIHBhdGggaW50byBhIEluZGV4ZWREYi1jb21wYXRpYmxlIHN0cmluZyBmb3JtLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKGUpIHtcbiAgICBsZXQgdCA9IFwiXCI7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB0Lmxlbmd0aCA+IDAgJiYgKHQgPSBfX1BSSVZBVEVfZW5jb2RlU2VwYXJhdG9yKHQpKSwgXG4gICAgdCA9IF9fUFJJVkFURV9lbmNvZGVTZWdtZW50KGUuZ2V0KG4pLCB0KTtcbiAgICByZXR1cm4gX19QUklWQVRFX2VuY29kZVNlcGFyYXRvcih0KTtcbn1cblxuLyoqIEVuY29kZXMgYSBzaW5nbGUgc2VnbWVudCBvZiBhIHJlc291cmNlIHBhdGggaW50byB0aGUgZ2l2ZW4gcmVzdWx0ICovIGZ1bmN0aW9uIF9fUFJJVkFURV9lbmNvZGVTZWdtZW50KGUsIHQpIHtcbiAgICBsZXQgbiA9IHQ7XG4gICAgY29uc3QgciA9IGUubGVuZ3RoO1xuICAgIGZvciAobGV0IHQgPSAwOyB0IDwgcjsgdCsrKSB7XG4gICAgICAgIGNvbnN0IHIgPSBlLmNoYXJBdCh0KTtcbiAgICAgICAgc3dpdGNoIChyKSB7XG4gICAgICAgICAgY2FzZSBcIlxcMFwiOlxuICAgICAgICAgICAgbiArPSBcIlx1MDAwMVx1MDAxMFwiO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlICQ6XG4gICAgICAgICAgICBuICs9IFwiXHUwMDAxXHUwMDExXCI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICBuICs9IHI7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG47XG59XG5cbi8qKiBFbmNvZGVzIGEgcGF0aCBzZXBhcmF0b3IgaW50byB0aGUgZ2l2ZW4gcmVzdWx0ICovIGZ1bmN0aW9uIF9fUFJJVkFURV9lbmNvZGVTZXBhcmF0b3IoZSkge1xuICAgIHJldHVybiBlICsgJCArIFwiXHUwMDAxXCI7XG59XG5cbi8qKlxuICogRGVjb2RlcyB0aGUgZ2l2ZW4gSW5kZXhlZERiLWNvbXBhdGlibGUgc3RyaW5nIGZvcm0gb2YgYSByZXNvdXJjZSBwYXRoIGludG9cbiAqIGEgUmVzb3VyY2VQYXRoIGluc3RhbmNlLiBOb3RlIHRoYXQgdGhpcyBtZXRob2QgaXMgbm90IHN1aXRhYmxlIGZvciB1c2Ugd2l0aFxuICogZGVjb2RpbmcgcmVzb3VyY2UgbmFtZXMgZnJvbSB0aGUgc2VydmVyOyB0aG9zZSBhcmUgT25lIFBsYXRmb3JtIGZvcm1hdFxuICogc3RyaW5ncy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKGUpIHtcbiAgICAvLyBFdmVudCB0aGUgZW1wdHkgcGF0aCBtdXN0IGVuY29kZSBhcyBhIHBhdGggb2YgYXQgbGVhc3QgbGVuZ3RoIDIuIEEgcGF0aFxuICAgIC8vIHdpdGggZXhhY3RseSAyIG11c3QgYmUgdGhlIGVtcHR5IHBhdGguXG4gICAgY29uc3QgdCA9IGUubGVuZ3RoO1xuICAgIGlmIChfX1BSSVZBVEVfaGFyZEFzc2VydCh0ID49IDIpLCAyID09PSB0KSByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQoZS5jaGFyQXQoMCkgPT09ICQgJiYgXCJcdTAwMDFcIiA9PT0gZS5jaGFyQXQoMSkpLCBcbiAgICBSZXNvdXJjZVBhdGguZW1wdHlQYXRoKCk7XG4gICAgLy8gRXNjYXBlIGNoYXJhY3RlcnMgY2Fubm90IGV4aXN0IHBhc3QgdGhlIHNlY29uZC10by1sYXN0IHBvc2l0aW9uIGluIHRoZVxuICAgIC8vIHNvdXJjZSB2YWx1ZS5cbiAgICAgICAgY29uc3QgX19QUklWQVRFX2xhc3RSZWFzb25hYmxlRXNjYXBlSW5kZXggPSB0IC0gMiwgbiA9IFtdO1xuICAgIGxldCByID0gXCJcIjtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHQ7ICkge1xuICAgICAgICAvLyBUaGUgbGFzdCB0d28gY2hhcmFjdGVycyBvZiBhIHZhbGlkIGVuY29kZWQgcGF0aCBtdXN0IGJlIGEgc2VwYXJhdG9yLCBzb1xuICAgICAgICAvLyB0aGVyZSBtdXN0IGJlIGFuIGVuZCB0byB0aGlzIHNlZ21lbnQuXG4gICAgICAgIGNvbnN0IHQgPSBlLmluZGV4T2YoJCwgaSk7XG4gICAgICAgICh0IDwgMCB8fCB0ID4gX19QUklWQVRFX2xhc3RSZWFzb25hYmxlRXNjYXBlSW5kZXgpICYmIGZhaWwoKTtcbiAgICAgICAgc3dpdGNoIChlLmNoYXJBdCh0ICsgMSkpIHtcbiAgICAgICAgICBjYXNlIFwiXHUwMDAxXCI6XG4gICAgICAgICAgICBjb25zdCBzID0gZS5zdWJzdHJpbmcoaSwgdCk7XG4gICAgICAgICAgICBsZXQgbztcbiAgICAgICAgICAgIDAgPT09IHIubGVuZ3RoID8gXG4gICAgICAgICAgICAvLyBBdm9pZCBjb3B5aW5nIGZvciB0aGUgY29tbW9uIGNhc2Ugb2YgYSBzZWdtZW50IHRoYXQgZXhjbHVkZXMgXFwwXG4gICAgICAgICAgICAvLyBhbmQgXFwwMDFcbiAgICAgICAgICAgIG8gPSBzIDogKHIgKz0gcywgbyA9IHIsIHIgPSBcIlwiKSwgbi5wdXNoKG8pO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiXHUwMDEwXCI6XG4gICAgICAgICAgICByICs9IGUuc3Vic3RyaW5nKGksIHQpLCByICs9IFwiXFwwXCI7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCJcdTAwMTFcIjpcbiAgICAgICAgICAgIC8vIFRoZSBlc2NhcGUgY2hhcmFjdGVyIGNhbiBiZSB1c2VkIGluIHRoZSBvdXRwdXQgdG8gZW5jb2RlIGl0c2VsZi5cbiAgICAgICAgICAgIHIgKz0gZS5zdWJzdHJpbmcoaSwgdCArIDEpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgZmFpbCgpO1xuICAgICAgICB9XG4gICAgICAgIGkgPSB0ICsgMjtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBSZXNvdXJjZVBhdGgobik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IFUgPSBcInJlbW90ZURvY3VtZW50c1wiLCBLID0gXCJvd25lclwiLCBXID0gXCJvd25lclwiLCBHID0gXCJtdXRhdGlvblF1ZXVlc1wiLCB6ID0gXCJ1c2VySWRcIiwgaiA9IFwibXV0YXRpb25zXCIsIEggPSBcImJhdGNoSWRcIiwgSiA9IFwidXNlck11dGF0aW9uc0luZGV4XCIsIFkgPSBbIFwidXNlcklkXCIsIFwiYmF0Y2hJZFwiIF07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE5hbWUgb2YgdGhlIEluZGV4ZWREYiBvYmplY3Qgc3RvcmUuXG4gKlxuICogTm90ZSB0aGF0IHRoZSBuYW1lICdvd25lcicgaXMgY2hvc2VuIHRvIGVuc3VyZSBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSB3aXRoXG4gKiBvbGRlciBjbGllbnRzIHRoYXQgb25seSBzdXBwb3J0ZWQgc2luZ2xlIGxvY2tlZCBhY2Nlc3MgdG8gdGhlIHBlcnNpc3RlbmNlXG4gKiBsYXllci5cbiAqL1xuLyoqXG4gKiBDcmVhdGVzIGEgW3VzZXJJZCwgZW5jb2RlZFBhdGhdIGtleSBmb3IgdXNlIGluIHRoZSBEYkRvY3VtZW50TXV0YXRpb25zXG4gKiBpbmRleCB0byBpdGVyYXRlIG92ZXIgYWxsIGF0IGRvY3VtZW50IG11dGF0aW9ucyBmb3IgYSBnaXZlbiBwYXRoIG9yIGxvd2VyLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aChlLCB0KSB7XG4gICAgcmV0dXJuIFsgZSwgX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0KSBdO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBmdWxsIGluZGV4IGtleSBvZiBbdXNlcklkLCBlbmNvZGVkUGF0aCwgYmF0Y2hJZF0gZm9yIGluc2VydGluZ1xuICogYW5kIGRlbGV0aW5nIGludG8gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnMgaW5kZXguXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvbktleShlLCB0LCBuKSB7XG4gICAgcmV0dXJuIFsgZSwgX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0KSwgbiBdO1xufVxuXG4vKipcbiAqIEJlY2F1c2Ugd2Ugc3RvcmUgYWxsIHRoZSB1c2VmdWwgaW5mb3JtYXRpb24gZm9yIHRoaXMgc3RvcmUgaW4gdGhlIGtleSxcbiAqIHRoZXJlIGlzIG5vIHVzZWZ1bCBpbmZvcm1hdGlvbiB0byBzdG9yZSBhcyB0aGUgdmFsdWUuIFRoZSByYXcgKHVuZW5jb2RlZClcbiAqIHBhdGggY2Fubm90IGJlIHN0b3JlZCBiZWNhdXNlIEluZGV4ZWREYiBkb2Vzbid0IHN0b3JlIHByb3RvdHlwZVxuICogaW5mb3JtYXRpb24uXG4gKi8gY29uc3QgWiA9IHt9LCBYID0gXCJkb2N1bWVudE11dGF0aW9uc1wiLCBlZSA9IFwicmVtb3RlRG9jdW1lbnRzVjE0XCIsIHRlID0gWyBcInByZWZpeFBhdGhcIiwgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJyZWFkVGltZVwiLCBcImRvY3VtZW50SWRcIiBdLCBuZSA9IFwiZG9jdW1lbnRLZXlJbmRleFwiLCByZSA9IFsgXCJwcmVmaXhQYXRoXCIsIFwiY29sbGVjdGlvbkdyb3VwXCIsIFwiZG9jdW1lbnRJZFwiIF0sIGllID0gXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLCBzZSA9IFsgXCJjb2xsZWN0aW9uR3JvdXBcIiwgXCJyZWFkVGltZVwiLCBcInByZWZpeFBhdGhcIiwgXCJkb2N1bWVudElkXCIgXSwgb2UgPSBcInJlbW90ZURvY3VtZW50R2xvYmFsXCIsIF9lID0gXCJyZW1vdGVEb2N1bWVudEdsb2JhbEtleVwiLCBhZSA9IFwidGFyZ2V0c1wiLCB1ZSA9IFwicXVlcnlUYXJnZXRzSW5kZXhcIiwgY2UgPSBbIFwiY2Fub25pY2FsSWRcIiwgXCJ0YXJnZXRJZFwiIF0sIGxlID0gXCJ0YXJnZXREb2N1bWVudHNcIiwgaGUgPSBbIFwidGFyZ2V0SWRcIiwgXCJwYXRoXCIgXSwgUGUgPSBcImRvY3VtZW50VGFyZ2V0c0luZGV4XCIsIFRlID0gWyBcInBhdGhcIiwgXCJ0YXJnZXRJZFwiIF0sIEllID0gXCJ0YXJnZXRHbG9iYWxLZXlcIiwgRWUgPSBcInRhcmdldEdsb2JhbFwiLCBkZSA9IFwiY29sbGVjdGlvblBhcmVudHNcIiwgQWUgPSBbIFwiY29sbGVjdGlvbklkXCIsIFwicGFyZW50XCIgXSwgUmUgPSBcImNsaWVudE1ldGFkYXRhXCIsIFZlID0gXCJjbGllbnRJZFwiLCBtZSA9IFwiYnVuZGxlc1wiLCBmZSA9IFwiYnVuZGxlSWRcIiwgZ2UgPSBcIm5hbWVkUXVlcmllc1wiLCBwZSA9IFwibmFtZVwiLCB5ZSA9IFwiaW5kZXhDb25maWd1cmF0aW9uXCIsIHdlID0gXCJpbmRleElkXCIsIFNlID0gXCJjb2xsZWN0aW9uR3JvdXBJbmRleFwiLCBiZSA9IFwiY29sbGVjdGlvbkdyb3VwXCIsIERlID0gXCJpbmRleFN0YXRlXCIsIHZlID0gWyBcImluZGV4SWRcIiwgXCJ1aWRcIiBdLCBDZSA9IFwic2VxdWVuY2VOdW1iZXJJbmRleFwiLCBGZSA9IFsgXCJ1aWRcIiwgXCJzZXF1ZW5jZU51bWJlclwiIF0sIE1lID0gXCJpbmRleEVudHJpZXNcIiwgeGUgPSBbIFwiaW5kZXhJZFwiLCBcInVpZFwiLCBcImFycmF5VmFsdWVcIiwgXCJkaXJlY3Rpb25hbFZhbHVlXCIsIFwib3JkZXJlZERvY3VtZW50S2V5XCIsIFwiZG9jdW1lbnRLZXlcIiBdLCBPZSA9IFwiZG9jdW1lbnRLZXlJbmRleFwiLCBOZSA9IFsgXCJpbmRleElkXCIsIFwidWlkXCIsIFwib3JkZXJlZERvY3VtZW50S2V5XCIgXSwgQmUgPSBcImRvY3VtZW50T3ZlcmxheXNcIiwgTGUgPSBbIFwidXNlcklkXCIsIFwiY29sbGVjdGlvblBhdGhcIiwgXCJkb2N1bWVudElkXCIgXSwga2UgPSBcImNvbGxlY3Rpb25QYXRoT3ZlcmxheUluZGV4XCIsIHFlID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25QYXRoXCIsIFwibGFyZ2VzdEJhdGNoSWRcIiBdLCBRZSA9IFwiY29sbGVjdGlvbkdyb3VwT3ZlcmxheUluZGV4XCIsICRlID0gWyBcInVzZXJJZFwiLCBcImNvbGxlY3Rpb25Hcm91cFwiLCBcImxhcmdlc3RCYXRjaElkXCIgXSwgVWUgPSBcImdsb2JhbHNcIiwgS2UgPSBcIm5hbWVcIiwgV2UgPSBbIC4uLlsgLi4uWyAuLi5bIC4uLlsgRywgaiwgWCwgVSwgYWUsIEssIEVlLCBsZSBdLCBSZSBdLCBvZSBdLCBkZSBdLCBtZSwgZ2UgXSwgR2UgPSBbIC4uLldlLCBCZSBdLCB6ZSA9IFsgRywgaiwgWCwgZWUsIGFlLCBLLCBFZSwgbGUsIFJlLCBvZSwgZGUsIG1lLCBnZSwgQmUgXSwgamUgPSB6ZSwgSGUgPSBbIC4uLmplLCB5ZSwgRGUsIE1lIF0sIEplID0gSGUsIFllID0gWyAuLi5IZSwgVWUgXTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbiBleHRlbmRzIFBlcnNpc3RlbmNlVHJhbnNhY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy51ZSA9IGUsIHRoaXMuY3VycmVudFNlcXVlbmNlTnVtYmVyID0gdDtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRTdG9yZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9TaW1wbGVEYi5NKG4udWUsIHQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfb2JqZWN0U2l6ZShlKSB7XG4gICAgbGV0IHQgPSAwO1xuICAgIGZvciAoY29uc3QgbiBpbiBlKSBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSwgbikgJiYgdCsrO1xuICAgIHJldHVybiB0O1xufVxuXG5mdW5jdGlvbiBmb3JFYWNoKGUsIHQpIHtcbiAgICBmb3IgKGNvbnN0IG4gaW4gZSkgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIG4pICYmIHQobiwgZVtuXSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9tYXBUb0FycmF5KGUsIHQpIHtcbiAgICBjb25zdCBuID0gW107XG4gICAgZm9yIChjb25zdCByIGluIGUpIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLCByKSAmJiBuLnB1c2godChlW3JdLCByLCBlKSk7XG4gICAgcmV0dXJuIG47XG59XG5cbmZ1bmN0aW9uIGlzRW1wdHkoZSkge1xuICAgIGZvciAoY29uc3QgdCBpbiBlKSBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsIHQpKSByZXR1cm4gITE7XG4gICAgcmV0dXJuICEwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gQW4gaW1tdXRhYmxlIHNvcnRlZCBtYXAgaW1wbGVtZW50YXRpb24sIGJhc2VkIG9uIGEgTGVmdC1sZWFuaW5nIFJlZC1CbGFja1xuLy8gdHJlZS5cbmNsYXNzIFNvcnRlZE1hcCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmNvbXBhcmF0b3IgPSBlLCB0aGlzLnJvb3QgPSB0IHx8IExMUkJOb2RlLkVNUFRZO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgbWFwLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5L3ZhbHVlIGFkZGVkIG9yIHJlcGxhY2VkLlxuICAgIGluc2VydChlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvciwgdGhpcy5yb290Lmluc2VydChlLCB0LCB0aGlzLmNvbXBhcmF0b3IpLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuQkxBQ0ssIG51bGwsIG51bGwpKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIG1hcCwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLlxuICAgIHJlbW92ZShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvciwgdGhpcy5yb290LnJlbW92ZShlLCB0aGlzLmNvbXBhcmF0b3IpLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuQkxBQ0ssIG51bGwsIG51bGwpKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG5vZGUgd2l0aCB0aGUgZ2l2ZW4ga2V5LCBvciBudWxsLlxuICAgIGdldChlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5yb290O1xuICAgICAgICBmb3IgKDshdC5pc0VtcHR5KCk7ICkge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuY29tcGFyYXRvcihlLCB0LmtleSk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gbikgcmV0dXJuIHQudmFsdWU7XG4gICAgICAgICAgICBuIDwgMCA/IHQgPSB0LmxlZnQgOiBuID4gMCAmJiAodCA9IHQucmlnaHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBpbmRleCBvZiB0aGUgZWxlbWVudCBpbiB0aGlzIHNvcnRlZCBtYXAsIG9yIC0xIGlmIGl0IGRvZXNuJ3RcbiAgICAvLyBleGlzdC5cbiAgICBpbmRleE9mKGUpIHtcbiAgICAgICAgLy8gTnVtYmVyIG9mIG5vZGVzIHRoYXQgd2VyZSBwcnVuZWQgd2hlbiBkZXNjZW5kaW5nIHJpZ2h0XG4gICAgICAgIGxldCB0ID0gMCwgbiA9IHRoaXMucm9vdDtcbiAgICAgICAgZm9yICg7IW4uaXNFbXB0eSgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNvbXBhcmF0b3IoZSwgbi5rZXkpO1xuICAgICAgICAgICAgaWYgKDAgPT09IHIpIHJldHVybiB0ICsgbi5sZWZ0LnNpemU7XG4gICAgICAgICAgICByIDwgMCA/IG4gPSBuLmxlZnQgOiAoXG4gICAgICAgICAgICAvLyBDb3VudCBhbGwgbm9kZXMgbGVmdCBvZiB0aGUgbm9kZSBwbHVzIHRoZSBub2RlIGl0c2VsZlxuICAgICAgICAgICAgdCArPSBuLmxlZnQuc2l6ZSArIDEsIG4gPSBuLnJpZ2h0KTtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb2RlIG5vdCBmb3VuZFxuICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5pc0VtcHR5KCk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIHRvdGFsIG51bWJlciBvZiBub2RlcyBpbiB0aGUgbWFwLlxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290LnNpemU7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1pbmltdW0ga2V5IGluIHRoZSBtYXAuXG4gICAgbWluS2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Lm1pbktleSgpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIHRoZSBtYXhpbXVtIGtleSBpbiB0aGUgbWFwLlxuICAgIG1heEtleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdC5tYXhLZXkoKTtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRoZSBtYXAgaW4ga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvblxuICAgIC8vIGZvciBlYWNoIGtleS92YWx1ZSBwYWlyLiBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC5cbiAgICAvLyBSZXR1cm5zIHRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXlcbiAgICAvLyB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24uXG4gICAgaW5vcmRlclRyYXZlcnNhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QuaW5vcmRlclRyYXZlcnNhbChlKTtcbiAgICB9XG4gICAgZm9yRWFjaChlKSB7XG4gICAgICAgIHRoaXMuaW5vcmRlclRyYXZlcnNhbCgoKHQsIG4pID0+IChlKHQsIG4pLCAhMSkpKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5vcmRlclRyYXZlcnNhbCgoKHQsIG4pID0+IChlLnB1c2goYCR7dH06JHtufWApLCAhMSkpKSwgYHske2Uuam9pbihcIiwgXCIpfX1gO1xuICAgIH1cbiAgICAvLyBUcmF2ZXJzZXMgdGhlIG1hcCBpbiByZXZlcnNlIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb25cbiAgICAvLyBmdW5jdGlvbiBmb3IgZWFjaCBrZXkvdmFsdWUgcGFpci4gSWYgYWN0aW9uIHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzXG4gICAgLy8gYWJvcnRlZC5cbiAgICAvLyBSZXR1cm5zIHRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXlcbiAgICAvLyB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24uXG4gICAgcmV2ZXJzZVRyYXZlcnNhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3QucmV2ZXJzZVRyYXZlcnNhbChlKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhbiBpdGVyYXRvciBvdmVyIHRoZSBTb3J0ZWRNYXAuXG4gICAgZ2V0SXRlcmF0b3IoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290LCBudWxsLCB0aGlzLmNvbXBhcmF0b3IsICExKTtcbiAgICB9XG4gICAgZ2V0SXRlcmF0b3JGcm9tKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3QsIGUsIHRoaXMuY29tcGFyYXRvciwgITEpO1xuICAgIH1cbiAgICBnZXRSZXZlcnNlSXRlcmF0b3IoKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290LCBudWxsLCB0aGlzLmNvbXBhcmF0b3IsICEwKTtcbiAgICB9XG4gICAgZ2V0UmV2ZXJzZUl0ZXJhdG9yRnJvbShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290LCBlLCB0aGlzLmNvbXBhcmF0b3IsICEwKTtcbiAgICB9XG59XG5cbiAvLyBlbmQgU29ydGVkTWFwXG4vLyBBbiBpdGVyYXRvciBvdmVyIGFuIExMUkJOb2RlLlxuY2xhc3MgU29ydGVkTWFwSXRlcmF0b3Ige1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5pc1JldmVyc2UgPSByLCB0aGlzLm5vZGVTdGFjayA9IFtdO1xuICAgICAgICBsZXQgaSA9IDE7XG4gICAgICAgIGZvciAoOyFlLmlzRW1wdHkoKTsgKSBpZiAoaSA9IHQgPyBuKGUua2V5LCB0KSA6IDEsIFxuICAgICAgICAvLyBmbGlwIHRoZSBjb21wYXJpc29uIGlmIHdlJ3JlIGdvaW5nIGluIHJldmVyc2VcbiAgICAgICAgdCAmJiByICYmIChpICo9IC0xKSwgaSA8IDApIFxuICAgICAgICAvLyBUaGlzIG5vZGUgaXMgbGVzcyB0aGFuIG91ciBzdGFydCBrZXkuIGlnbm9yZSBpdFxuICAgICAgICBlID0gdGhpcy5pc1JldmVyc2UgPyBlLmxlZnQgOiBlLnJpZ2h0OyBlbHNlIHtcbiAgICAgICAgICAgIGlmICgwID09PSBpKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGV4YWN0bHkgZXF1YWwgdG8gb3VyIHN0YXJ0IGtleS4gUHVzaCBpdCBvbiB0aGUgc3RhY2ssXG4gICAgICAgICAgICAgICAgLy8gYnV0IHN0b3AgaXRlcmF0aW5nO1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZVN0YWNrLnB1c2goZSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZ3JlYXRlciB0aGFuIG91ciBzdGFydCBrZXksIGFkZCBpdCB0byB0aGUgc3RhY2sgYW5kIG1vdmVcbiAgICAgICAgICAgIC8vIHRvIHRoZSBuZXh0IG9uZVxuICAgICAgICAgICAgdGhpcy5ub2RlU3RhY2sucHVzaChlKSwgZSA9IHRoaXMuaXNSZXZlcnNlID8gZS5yaWdodCA6IGUubGVmdDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXROZXh0KCkge1xuICAgICAgICBsZXQgZSA9IHRoaXMubm9kZVN0YWNrLnBvcCgpO1xuICAgICAgICBjb25zdCB0ID0ge1xuICAgICAgICAgICAga2V5OiBlLmtleSxcbiAgICAgICAgICAgIHZhbHVlOiBlLnZhbHVlXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0aGlzLmlzUmV2ZXJzZSkgZm9yIChlID0gZS5sZWZ0OyAhZS5pc0VtcHR5KCk7ICkgdGhpcy5ub2RlU3RhY2sucHVzaChlKSwgZSA9IGUucmlnaHQ7IGVsc2UgZm9yIChlID0gZS5yaWdodDsgIWUuaXNFbXB0eSgpOyApIHRoaXMubm9kZVN0YWNrLnB1c2goZSksIFxuICAgICAgICBlID0gZS5sZWZ0O1xuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgaGFzTmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZVN0YWNrLmxlbmd0aCA+IDA7XG4gICAgfVxuICAgIHBlZWsoKSB7XG4gICAgICAgIGlmICgwID09PSB0aGlzLm5vZGVTdGFjay5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5ub2RlU3RhY2tbdGhpcy5ub2RlU3RhY2subGVuZ3RoIC0gMV07XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBrZXk6IGUua2V5LFxuICAgICAgICAgICAgdmFsdWU6IGUudmFsdWVcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbiAvLyBlbmQgU29ydGVkTWFwSXRlcmF0b3Jcbi8vIFJlcHJlc2VudHMgYSBub2RlIGluIGEgTGVmdC1sZWFuaW5nIFJlZC1CbGFjayB0cmVlLlxuY2xhc3MgTExSQk5vZGUge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlLCB0aGlzLnZhbHVlID0gdCwgdGhpcy5jb2xvciA9IG51bGwgIT0gbiA/IG4gOiBMTFJCTm9kZS5SRUQsIHRoaXMubGVmdCA9IG51bGwgIT0gciA/IHIgOiBMTFJCTm9kZS5FTVBUWSwgXG4gICAgICAgIHRoaXMucmlnaHQgPSBudWxsICE9IGkgPyBpIDogTExSQk5vZGUuRU1QVFksIHRoaXMuc2l6ZSA9IHRoaXMubGVmdC5zaXplICsgMSArIHRoaXMucmlnaHQuc2l6ZTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIGN1cnJlbnQgbm9kZSwgb3B0aW9uYWxseSByZXBsYWNpbmcgcGllY2VzIG9mIGl0LlxuICAgIGNvcHkoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICByZXR1cm4gbmV3IExMUkJOb2RlKG51bGwgIT0gZSA/IGUgOiB0aGlzLmtleSwgbnVsbCAhPSB0ID8gdCA6IHRoaXMudmFsdWUsIG51bGwgIT0gbiA/IG4gOiB0aGlzLmNvbG9yLCBudWxsICE9IHIgPyByIDogdGhpcy5sZWZ0LCBudWxsICE9IGkgPyBpIDogdGhpcy5yaWdodCk7XG4gICAgfVxuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLy8gVHJhdmVyc2VzIHRoZSB0cmVlIGluIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb25cbiAgICAvLyBmb3IgZWFjaCBub2RlLiBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC5cbiAgICAvLyBSZXR1cm5zIHRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXlcbiAgICAvLyB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24uXG4gICAgaW5vcmRlclRyYXZlcnNhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlZnQuaW5vcmRlclRyYXZlcnNhbChlKSB8fCBlKHRoaXMua2V5LCB0aGlzLnZhbHVlKSB8fCB0aGlzLnJpZ2h0Lmlub3JkZXJUcmF2ZXJzYWwoZSk7XG4gICAgfVxuICAgIC8vIFRyYXZlcnNlcyB0aGUgdHJlZSBpbiByZXZlcnNlIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb25cbiAgICAvLyBmdW5jdGlvbiBmb3IgZWFjaCBub2RlLiBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC5cbiAgICAvLyBSZXR1cm5zIHRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXlcbiAgICAvLyB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24uXG4gICAgcmV2ZXJzZVRyYXZlcnNhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJpZ2h0LnJldmVyc2VUcmF2ZXJzYWwoZSkgfHwgZSh0aGlzLmtleSwgdGhpcy52YWx1ZSkgfHwgdGhpcy5sZWZ0LnJldmVyc2VUcmF2ZXJzYWwoZSk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1pbmltdW0gbm9kZSBpbiB0aGUgdHJlZS5cbiAgICBtaW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxlZnQuaXNFbXB0eSgpID8gdGhpcyA6IHRoaXMubGVmdC5taW4oKTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyB0aGUgbWF4aW11bSBrZXkgaW4gdGhlIHRyZWUuXG4gICAgbWluS2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5taW4oKS5rZXk7XG4gICAgfVxuICAgIC8vIFJldHVybnMgdGhlIG1heGltdW0ga2V5IGluIHRoZSB0cmVlLlxuICAgIG1heEtleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmlnaHQuaXNFbXB0eSgpID8gdGhpcy5rZXkgOiB0aGlzLnJpZ2h0Lm1heEtleSgpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIG5ldyB0cmVlLCB3aXRoIHRoZSBrZXkvdmFsdWUgYWRkZWQuXG4gICAgaW5zZXJ0KGUsIHQsIG4pIHtcbiAgICAgICAgbGV0IHIgPSB0aGlzO1xuICAgICAgICBjb25zdCBpID0gbihlLCByLmtleSk7XG4gICAgICAgIHJldHVybiByID0gaSA8IDAgPyByLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgci5sZWZ0Lmluc2VydChlLCB0LCBuKSwgbnVsbCkgOiAwID09PSBpID8gci5jb3B5KG51bGwsIHQsIG51bGwsIG51bGwsIG51bGwpIDogci5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIHIucmlnaHQuaW5zZXJ0KGUsIHQsIG4pKSwgXG4gICAgICAgIHIuZml4VXAoKTtcbiAgICB9XG4gICAgcmVtb3ZlTWluKCkge1xuICAgICAgICBpZiAodGhpcy5sZWZ0LmlzRW1wdHkoKSkgcmV0dXJuIExMUkJOb2RlLkVNUFRZO1xuICAgICAgICBsZXQgZSA9IHRoaXM7XG4gICAgICAgIHJldHVybiBlLmxlZnQuaXNSZWQoKSB8fCBlLmxlZnQubGVmdC5pc1JlZCgpIHx8IChlID0gZS5tb3ZlUmVkTGVmdCgpKSwgZSA9IGUuY29weShudWxsLCBudWxsLCBudWxsLCBlLmxlZnQucmVtb3ZlTWluKCksIG51bGwpLCBcbiAgICAgICAgZS5maXhVcCgpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIG5ldyB0cmVlLCB3aXRoIHRoZSBzcGVjaWZpZWQgaXRlbSByZW1vdmVkLlxuICAgIHJlbW92ZShlLCB0KSB7XG4gICAgICAgIGxldCBuLCByID0gdGhpcztcbiAgICAgICAgaWYgKHQoZSwgci5rZXkpIDwgMCkgci5sZWZ0LmlzRW1wdHkoKSB8fCByLmxlZnQuaXNSZWQoKSB8fCByLmxlZnQubGVmdC5pc1JlZCgpIHx8IChyID0gci5tb3ZlUmVkTGVmdCgpKSwgXG4gICAgICAgIHIgPSByLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgci5sZWZ0LnJlbW92ZShlLCB0KSwgbnVsbCk7IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHIubGVmdC5pc1JlZCgpICYmIChyID0gci5yb3RhdGVSaWdodCgpKSwgci5yaWdodC5pc0VtcHR5KCkgfHwgci5yaWdodC5pc1JlZCgpIHx8IHIucmlnaHQubGVmdC5pc1JlZCgpIHx8IChyID0gci5tb3ZlUmVkUmlnaHQoKSksIFxuICAgICAgICAgICAgMCA9PT0gdChlLCByLmtleSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoci5yaWdodC5pc0VtcHR5KCkpIHJldHVybiBMTFJCTm9kZS5FTVBUWTtcbiAgICAgICAgICAgICAgICBuID0gci5yaWdodC5taW4oKSwgciA9IHIuY29weShuLmtleSwgbi52YWx1ZSwgbnVsbCwgbnVsbCwgci5yaWdodC5yZW1vdmVNaW4oKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByID0gci5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIHIucmlnaHQucmVtb3ZlKGUsIHQpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gci5maXhVcCgpO1xuICAgIH1cbiAgICBpc1JlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3I7XG4gICAgfVxuICAgIC8vIFJldHVybnMgbmV3IHRyZWUgYWZ0ZXIgcGVyZm9ybWluZyBhbnkgbmVlZGVkIHJvdGF0aW9ucy5cbiAgICBmaXhVcCgpIHtcbiAgICAgICAgbGV0IGUgPSB0aGlzO1xuICAgICAgICByZXR1cm4gZS5yaWdodC5pc1JlZCgpICYmICFlLmxlZnQuaXNSZWQoKSAmJiAoZSA9IGUucm90YXRlTGVmdCgpKSwgZS5sZWZ0LmlzUmVkKCkgJiYgZS5sZWZ0LmxlZnQuaXNSZWQoKSAmJiAoZSA9IGUucm90YXRlUmlnaHQoKSksIFxuICAgICAgICBlLmxlZnQuaXNSZWQoKSAmJiBlLnJpZ2h0LmlzUmVkKCkgJiYgKGUgPSBlLmNvbG9yRmxpcCgpKSwgZTtcbiAgICB9XG4gICAgbW92ZVJlZExlZnQoKSB7XG4gICAgICAgIGxldCBlID0gdGhpcy5jb2xvckZsaXAoKTtcbiAgICAgICAgcmV0dXJuIGUucmlnaHQubGVmdC5pc1JlZCgpICYmIChlID0gZS5jb3B5KG51bGwsIG51bGwsIG51bGwsIG51bGwsIGUucmlnaHQucm90YXRlUmlnaHQoKSksIFxuICAgICAgICBlID0gZS5yb3RhdGVMZWZ0KCksIGUgPSBlLmNvbG9yRmxpcCgpKSwgZTtcbiAgICB9XG4gICAgbW92ZVJlZFJpZ2h0KCkge1xuICAgICAgICBsZXQgZSA9IHRoaXMuY29sb3JGbGlwKCk7XG4gICAgICAgIHJldHVybiBlLmxlZnQubGVmdC5pc1JlZCgpICYmIChlID0gZS5yb3RhdGVSaWdodCgpLCBlID0gZS5jb2xvckZsaXAoKSksIGU7XG4gICAgfVxuICAgIHJvdGF0ZUxlZnQoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuUkVELCBudWxsLCB0aGlzLnJpZ2h0LmxlZnQpO1xuICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5jb3B5KG51bGwsIG51bGwsIHRoaXMuY29sb3IsIGUsIG51bGwpO1xuICAgIH1cbiAgICByb3RhdGVSaWdodCgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5SRUQsIHRoaXMubGVmdC5yaWdodCwgbnVsbCk7XG4gICAgICAgIHJldHVybiB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCB0aGlzLmNvbG9yLCBudWxsLCBlKTtcbiAgICB9XG4gICAgY29sb3JGbGlwKCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5sZWZ0LmNvcHkobnVsbCwgbnVsbCwgIXRoaXMubGVmdC5jb2xvciwgbnVsbCwgbnVsbCksIHQgPSB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgIXRoaXMucmlnaHQuY29sb3IsIG51bGwsIG51bGwpO1xuICAgICAgICByZXR1cm4gdGhpcy5jb3B5KG51bGwsIG51bGwsICF0aGlzLmNvbG9yLCBlLCB0KTtcbiAgICB9XG4gICAgLy8gRm9yIHRlc3RpbmcuXG4gICAgY2hlY2tNYXhEZXB0aCgpIHtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuY2hlY2soKTtcbiAgICAgICAgcmV0dXJuIE1hdGgucG93KDIsIGUpIDw9IHRoaXMuc2l6ZSArIDE7XG4gICAgfVxuICAgIC8vIEluIGEgYmFsYW5jZWQgUkIgdHJlZSwgdGhlIGJsYWNrLWRlcHRoIChudW1iZXIgb2YgYmxhY2sgbm9kZXMpIGZyb20gcm9vdCB0b1xuICAgIC8vIGxlYXZlcyBpcyBlcXVhbCBvbiBib3RoIHNpZGVzLiAgVGhpcyBmdW5jdGlvbiB2ZXJpZmllcyB0aGF0IG9yIGFzc2VydHMuXG4gICAgY2hlY2soKSB7XG4gICAgICAgIGlmICh0aGlzLmlzUmVkKCkgJiYgdGhpcy5sZWZ0LmlzUmVkKCkpIHRocm93IGZhaWwoKTtcbiAgICAgICAgaWYgKHRoaXMucmlnaHQuaXNSZWQoKSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5sZWZ0LmNoZWNrKCk7XG4gICAgICAgIGlmIChlICE9PSB0aGlzLnJpZ2h0LmNoZWNrKCkpIHRocm93IGZhaWwoKTtcbiAgICAgICAgcmV0dXJuIGUgKyAodGhpcy5pc1JlZCgpID8gMCA6IDEpO1xuICAgIH1cbn1cblxuIC8vIGVuZCBMTFJCTm9kZVxuLy8gRW1wdHkgbm9kZSBpcyBzaGFyZWQgYmV0d2VlbiBhbGwgTExSQiB0cmVlcy5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5MTFJCTm9kZS5FTVBUWSA9IG51bGwsIExMUkJOb2RlLlJFRCA9ICEwLCBMTFJCTm9kZS5CTEFDSyA9ICExO1xuXG4vLyBlbmQgTExSQkVtcHR5Tm9kZVxuTExSQk5vZGUuRU1QVFkgPSBuZXcgXG4vLyBSZXByZXNlbnRzIGFuIGVtcHR5IG5vZGUgKGEgbGVhZiBub2RlIGluIHRoZSBSZWQtQmxhY2sgVHJlZSkuXG5jbGFzcyBMTFJCRW1wdHlOb2RlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5zaXplID0gMDtcbiAgICB9XG4gICAgZ2V0IGtleSgpIHtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbiAgICBnZXQgdmFsdWUoKSB7XG4gICAgICAgIHRocm93IGZhaWwoKTtcbiAgICB9XG4gICAgZ2V0IGNvbG9yKCkge1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIGdldCBsZWZ0KCkge1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxuICAgIGdldCByaWdodCgpIHtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbiAgICAvLyBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLlxuICAgIGNvcHkoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQuXG4gICAgaW5zZXJ0KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShlLCB0KTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBhIGNvcHkgb2YgdGhlIHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkgcmVtb3ZlZC5cbiAgICByZW1vdmUoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICBpbm9yZGVyVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICByZXZlcnNlVHJhdmVyc2FsKGUpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBtYXhLZXkoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBpc1JlZCgpIHtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvLyBGb3IgdGVzdGluZy5cbiAgICBjaGVja01heERlcHRoKCkge1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIGNoZWNrKCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBTb3J0ZWRTZXQgaXMgYW4gaW1tdXRhYmxlIChjb3B5LW9uLXdyaXRlKSBjb2xsZWN0aW9uIHRoYXQgaG9sZHMgZWxlbWVudHNcbiAqIGluIG9yZGVyIHNwZWNpZmllZCBieSB0aGUgcHJvdmlkZWQgY29tcGFyYXRvci5cbiAqXG4gKiBOT1RFOiBpZiBwcm92aWRlZCBjb21wYXJhdG9yIHJldHVybnMgMCBmb3IgdHdvIGVsZW1lbnRzLCB3ZSBjb25zaWRlciB0aGVtIHRvXG4gKiBiZSBlcXVhbCFcbiAqL1xuY2xhc3MgU29ydGVkU2V0IHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuY29tcGFyYXRvciA9IGUsIHRoaXMuZGF0YSA9IG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgaGFzKGUpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuZGF0YS5nZXQoZSk7XG4gICAgfVxuICAgIGZpcnN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLm1pbktleSgpO1xuICAgIH1cbiAgICBsYXN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLm1heEtleSgpO1xuICAgIH1cbiAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5zaXplO1xuICAgIH1cbiAgICBpbmRleE9mKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGF0YS5pbmRleE9mKGUpO1xuICAgIH1cbiAgICAvKiogSXRlcmF0ZXMgZWxlbWVudHMgaW4gb3JkZXIgZGVmaW5lZCBieSBcImNvbXBhcmF0b3JcIiAqLyAgICBmb3JFYWNoKGUpIHtcbiAgICAgICAgdGhpcy5kYXRhLmlub3JkZXJUcmF2ZXJzYWwoKCh0LCBuKSA9PiAoZSh0KSwgITEpKSk7XG4gICAgfVxuICAgIC8qKiBJdGVyYXRlcyBvdmVyIGBlbGVtYHMgc3VjaCB0aGF0OiByYW5nZVswXSAmbHQ7PSBlbGVtICZsdDsgcmFuZ2VbMV0uICovICAgIGZvckVhY2hJblJhbmdlKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20oZVswXSk7XG4gICAgICAgIGZvciAoO24uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBuLmdldE5leHQoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBhcmF0b3Ioci5rZXksIGVbMV0pID49IDApIHJldHVybjtcbiAgICAgICAgICAgIHQoci5rZXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEl0ZXJhdGVzIG92ZXIgYGVsZW1gcyBzdWNoIHRoYXQ6IHN0YXJ0ICZsdDs9IGVsZW0gdW50aWwgZmFsc2UgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIGZvckVhY2hXaGlsZShlLCB0KSB7XG4gICAgICAgIGxldCBuO1xuICAgICAgICBmb3IgKG4gPSB2b2lkIDAgIT09IHQgPyB0aGlzLmRhdGEuZ2V0SXRlcmF0b3JGcm9tKHQpIDogdGhpcy5kYXRhLmdldEl0ZXJhdG9yKCk7IG4uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGlmICghZShuLmdldE5leHQoKS5rZXkpKSByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEZpbmRzIHRoZSBsZWFzdCBlbGVtZW50IGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byBgZWxlbWAuICovICAgIGZpcnN0QWZ0ZXJPckVxdWFsKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZGF0YS5nZXRJdGVyYXRvckZyb20oZSk7XG4gICAgICAgIHJldHVybiB0Lmhhc05leHQoKSA/IHQuZ2V0TmV4dCgpLmtleSA6IG51bGw7XG4gICAgfVxuICAgIGdldEl0ZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gbmV3IFNvcnRlZFNldEl0ZXJhdG9yKHRoaXMuZGF0YS5nZXRJdGVyYXRvcigpKTtcbiAgICB9XG4gICAgZ2V0SXRlcmF0b3JGcm9tKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRTZXRJdGVyYXRvcih0aGlzLmRhdGEuZ2V0SXRlcmF0b3JGcm9tKGUpKTtcbiAgICB9XG4gICAgLyoqIEluc2VydHMgb3IgdXBkYXRlcyBhbiBlbGVtZW50ICovICAgIGFkZChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvcHkodGhpcy5kYXRhLnJlbW92ZShlKS5pbnNlcnQoZSwgITApKTtcbiAgICB9XG4gICAgLyoqIERlbGV0ZXMgYW4gZWxlbWVudCAqLyAgICBkZWxldGUoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXMoZSkgPyB0aGlzLmNvcHkodGhpcy5kYXRhLnJlbW92ZShlKSkgOiB0aGlzO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgdW5pb25XaXRoKGUpIHtcbiAgICAgICAgbGV0IHQgPSB0aGlzO1xuICAgICAgICAvLyBNYWtlIHN1cmUgYHJlc3VsdGAgYWx3YXlzIHJlZmVycyB0byB0aGUgbGFyZ2VyIG9uZSBvZiB0aGUgdHdvIHNldHMuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuc2l6ZSA8IGUuc2l6ZSAmJiAodCA9IGUsIGUgPSB0aGlzKSwgZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHQgPSB0LmFkZChlKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIFNvcnRlZFNldCkpIHJldHVybiAhMTtcbiAgICAgICAgaWYgKHRoaXMuc2l6ZSAhPT0gZS5zaXplKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRhdGEuZ2V0SXRlcmF0b3IoKSwgbiA9IGUuZGF0YS5nZXRJdGVyYXRvcigpO1xuICAgICAgICBmb3IgKDt0Lmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5nZXROZXh0KCkua2V5LCByID0gbi5nZXROZXh0KCkua2V5O1xuICAgICAgICAgICAgaWYgKDAgIT09IHRoaXMuY29tcGFyYXRvcihlLCByKSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgdG9BcnJheSgpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGUucHVzaCh0KTtcbiAgICAgICAgfSkpLCBlO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5mb3JFYWNoKCh0ID0+IGUucHVzaCh0KSkpLCBcIlNvcnRlZFNldChcIiArIGUudG9TdHJpbmcoKSArIFwiKVwiO1xuICAgIH1cbiAgICBjb3B5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBTb3J0ZWRTZXQodGhpcy5jb21wYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIHQuZGF0YSA9IGUsIHQ7XG4gICAgfVxufVxuXG5jbGFzcyBTb3J0ZWRTZXRJdGVyYXRvciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLml0ZXIgPSBlO1xuICAgIH1cbiAgICBnZXROZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pdGVyLmdldE5leHQoKS5rZXk7XG4gICAgfVxuICAgIGhhc05leHQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLml0ZXIuaGFzTmV4dCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb21wYXJlcyB0d28gc29ydGVkIHNldHMgZm9yIGVxdWFsaXR5IHVzaW5nIHRoZWlyIG5hdHVyYWwgb3JkZXJpbmcuIFRoZVxuICogbWV0aG9kIGNvbXB1dGVzIHRoZSBpbnRlcnNlY3Rpb24gYW5kIGludm9rZXMgYG9uQWRkYCBmb3IgZXZlcnkgZWxlbWVudCB0aGF0XG4gKiBpcyBpbiBgYWZ0ZXJgIGJ1dCBub3QgYGJlZm9yZWAuIGBvblJlbW92ZWAgaXMgaW52b2tlZCBmb3IgZXZlcnkgZWxlbWVudCBpblxuICogYGJlZm9yZWAgYnV0IG1pc3NpbmcgZnJvbSBgYWZ0ZXJgLlxuICpcbiAqIFRoZSBtZXRob2QgY3JlYXRlcyBhIGNvcHkgb2YgYm90aCBgYmVmb3JlYCBhbmQgYGFmdGVyYCBhbmQgcnVucyBpbiBPKG4gbG9nXG4gKiBuKSwgd2hlcmUgbiBpcyB0aGUgc2l6ZSBvZiB0aGUgdHdvIGxpc3RzLlxuICpcbiAqIEBwYXJhbSBiZWZvcmUgLSBUaGUgZWxlbWVudHMgdGhhdCBleGlzdCBpbiB0aGUgb3JpZ2luYWwgc2V0LlxuICogQHBhcmFtIGFmdGVyIC0gVGhlIGVsZW1lbnRzIHRvIGRpZmYgYWdhaW5zdCB0aGUgb3JpZ2luYWwgc2V0LlxuICogQHBhcmFtIGNvbXBhcmF0b3IgLSBUaGUgY29tcGFyYXRvciBmb3IgdGhlIGVsZW1lbnRzIGluIGJlZm9yZSBhbmQgYWZ0ZXIuXG4gKiBAcGFyYW0gb25BZGQgLSBBIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IGlzIHBhcnQgb2YgYFxuICogYWZ0ZXJgIGJ1dCBub3QgYGJlZm9yZWAuXG4gKiBAcGFyYW0gb25SZW1vdmUgLSBBIGZ1bmN0aW9uIHRvIGludm9rZSBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IGlzIHBhcnQgb2ZcbiAqIGBiZWZvcmVgIGJ1dCBub3QgYGFmdGVyYC5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBuZXh0IGVsZW1lbnQgZnJvbSB0aGUgaXRlcmF0b3Igb3IgYHVuZGVmaW5lZGAgaWYgbm9uZSBhdmFpbGFibGUuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9hZHZhbmNlSXRlcmF0b3IoZSkge1xuICAgIHJldHVybiBlLmhhc05leHQoKSA/IGUuZ2V0TmV4dCgpIDogdm9pZCAwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBQcm92aWRlcyBhIHNldCBvZiBmaWVsZHMgdGhhdCBjYW4gYmUgdXNlZCB0byBwYXJ0aWFsbHkgcGF0Y2ggYSBkb2N1bWVudC5cbiAqIEZpZWxkTWFzayBpcyB1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGggT2JqZWN0VmFsdWUuXG4gKiBFeGFtcGxlczpcbiAqICAgZm9vIC0gT3ZlcndyaXRlcyBmb28gZW50aXJlbHkgd2l0aCB0aGUgcHJvdmlkZWQgdmFsdWUuIElmIGZvbyBpcyBub3RcbiAqICAgICAgICAgcHJlc2VudCBpbiB0aGUgY29tcGFuaW9uIE9iamVjdFZhbHVlLCB0aGUgZmllbGQgaXMgZGVsZXRlZC5cbiAqICAgZm9vLmJhciAtIE92ZXJ3cml0ZXMgb25seSB0aGUgZmllbGQgYmFyIG9mIHRoZSBvYmplY3QgZm9vLlxuICogICAgICAgICAgICAgSWYgZm9vIGlzIG5vdCBhbiBvYmplY3QsIGZvbyBpcyByZXBsYWNlZCB3aXRoIGFuIG9iamVjdFxuICogICAgICAgICAgICAgY29udGFpbmluZyBmb29cbiAqLyBjbGFzcyBGaWVsZE1hc2sge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5maWVsZHMgPSBlLCBcbiAgICAgICAgLy8gVE9ETyhkaW1vbmQpOiB2YWxpZGF0aW9uIG9mIEZpZWxkTWFza1xuICAgICAgICAvLyBTb3J0IHRoZSBmaWVsZCBtYXNrIHRvIHN1cHBvcnQgYEZpZWxkTWFzay5pc0VxdWFsKClgIGFuZCBhc3NlcnQgYmVsb3cuXG4gICAgICAgIGUuc29ydChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWFzayhbXSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBuZXcgRmllbGRNYXNrIG9iamVjdCB0aGF0IGlzIHRoZSByZXN1bHQgb2YgYWRkaW5nIGFsbCB0aGUgZ2l2ZW5cbiAgICAgKiBmaWVsZHMgcGF0aHMgdG8gdGhpcyBmaWVsZCBtYXNrLlxuICAgICAqLyAgICB1bmlvbldpdGgoZSkge1xuICAgICAgICBsZXQgdCA9IG5ldyBTb3J0ZWRTZXQoRmllbGRQYXRoJDEuY29tcGFyYXRvcik7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLmZpZWxkcykgdCA9IHQuYWRkKGUpO1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgZSkgdCA9IHQuYWRkKG4pO1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWFzayh0LnRvQXJyYXkoKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZlcmlmaWVzIHRoYXQgYGZpZWxkUGF0aGAgaXMgaW5jbHVkZWQgYnkgYXQgbGVhc3Qgb25lIGZpZWxkIGluIHRoaXMgZmllbGRcbiAgICAgKiBtYXNrLlxuICAgICAqXG4gICAgICogVGhpcyBpcyBhbiBPKG4pIG9wZXJhdGlvbiwgd2hlcmUgYG5gIGlzIHRoZSBzaXplIG9mIHRoZSBmaWVsZCBtYXNrLlxuICAgICAqLyAgICBjb3ZlcnMoZSkge1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgdGhpcy5maWVsZHMpIGlmICh0LmlzUHJlZml4T2YoZSkpIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9hcnJheUVxdWFscyh0aGlzLmZpZWxkcywgZS5maWVsZHMsICgoZSwgdCkgPT4gZS5pc0VxdWFsKHQpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBlcnJvciBlbmNvdW50ZXJlZCB3aGlsZSBkZWNvZGluZyBiYXNlNjQgc3RyaW5nLlxuICovIGNsYXNzIF9fUFJJVkFURV9CYXNlNjREZWNvZGVFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKSwgdGhpcy5uYW1lID0gXCJCYXNlNjREZWNvZGVFcnJvclwiO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBDb252ZXJ0cyBhIEJhc2U2NCBlbmNvZGVkIHN0cmluZyB0byBhIGJpbmFyeSBzdHJpbmcuICovXG4vKiogVHJ1ZSBpZiBhbmQgb25seSBpZiB0aGUgQmFzZTY0IGNvbnZlcnNpb24gZnVuY3Rpb25zIGFyZSBhdmFpbGFibGUuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfaXNCYXNlNjRBdmFpbGFibGUoKSB7XG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGF0b2I7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEltbXV0YWJsZSBjbGFzcyB0aGF0IHJlcHJlc2VudHMgYSBcInByb3RvXCIgYnl0ZSBzdHJpbmcuXG4gKlxuICogUHJvdG8gYnl0ZSBzdHJpbmdzIGNhbiBlaXRoZXIgYmUgQmFzZTY0LWVuY29kZWQgc3RyaW5ncyBvciBVaW50OEFycmF5cyB3aGVuXG4gKiBzZW50IG9uIHRoZSB3aXJlLiBUaGlzIGNsYXNzIGFic3RyYWN0cyBhd2F5IHRoaXMgZGlmZmVyZW50aWF0aW9uIGJ5IGhvbGRpbmdcbiAqIHRoZSBwcm90byBieXRlIHN0cmluZyBpbiBhIGNvbW1vbiBjbGFzcyB0aGF0IG11c3QgYmUgY29udmVydGVkIGludG8gYSBzdHJpbmdcbiAqIGJlZm9yZSBiZWluZyBzZW50IGFzIGEgcHJvdG8uXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBCeXRlU3RyaW5nIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuYmluYXJ5U3RyaW5nID0gZTtcbiAgICB9XG4gICAgc3RhdGljIGZyb21CYXNlNjRTdHJpbmcoZSkge1xuICAgICAgICBjb25zdCB0ID0gZnVuY3Rpb24gX19QUklWQVRFX2RlY29kZUJhc2U2NChlKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhdG9iKGUpO1xuICAgICAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIC8vIENoZWNrIHRoYXQgYERPTUV4Y2VwdGlvbmAgaXMgZGVmaW5lZCBiZWZvcmUgdXNpbmcgaXQgdG8gYXZvaWRcbiAgICAgICAgICAgICAgICAvLyBcIlJlZmVyZW5jZUVycm9yOiBQcm9wZXJ0eSAnRE9NRXhjZXB0aW9uJyBkb2Vzbid0IGV4aXN0XCIgaW4gcmVhY3QtbmF0aXZlLlxuICAgICAgICAgICAgICAgIC8vIChodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtanMtc2RrL2lzc3Vlcy83MTE1KVxuICAgICAgICAgICAgICAgIHRocm93IFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIERPTUV4Y2VwdGlvbiAmJiBlIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uID8gbmV3IF9fUFJJVkFURV9CYXNlNjREZWNvZGVFcnJvcihcIkludmFsaWQgYmFzZTY0IHN0cmluZzogXCIgKyBlKSA6IGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLyoqIENvbnZlcnRzIGEgYmluYXJ5IHN0cmluZyB0byBhIEJhc2U2NCBlbmNvZGVkIHN0cmluZy4gKi8gKGUpO1xuICAgICAgICByZXR1cm4gbmV3IEJ5dGVTdHJpbmcodCk7XG4gICAgfVxuICAgIHN0YXRpYyBmcm9tVWludDhBcnJheShlKSB7XG4gICAgICAgIC8vIFRPRE8oaW5kZXhpbmcpOyBSZW1vdmUgdGhlIGNvcHkgb2YgdGhlIGJ5dGUgc3RyaW5nIGhlcmUgYXMgdGhpcyBtZXRob2RcbiAgICAgICAgLy8gaXMgZnJlcXVlbnRseSBjYWxsZWQgZHVyaW5nIGluZGV4aW5nLlxuICAgICAgICBjb25zdCB0ID0gXG4gICAgICAgIC8qKlxuICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgYW4gVWludDhhcnJheSB0byBhIGJpbmFyeSBzdHJpbmcuXG4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2JpbmFyeVN0cmluZ0Zyb21VaW50OEFycmF5KGUpIHtcbiAgICAgICAgICAgIGxldCB0ID0gXCJcIjtcbiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGg7ICsrbikgdCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGVbbl0pO1xuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gY29udmVydCBhIGJpbmFyeSBzdHJpbmcgdG8gYW4gVWludDhBcnJheS5cbiAqLyAoZSk7XG4gICAgICAgIHJldHVybiBuZXcgQnl0ZVN0cmluZyh0KTtcbiAgICB9XG4gICAgW1N5bWJvbC5pdGVyYXRvcl0oKSB7XG4gICAgICAgIGxldCBlID0gMDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIG5leHQ6ICgpID0+IGUgPCB0aGlzLmJpbmFyeVN0cmluZy5sZW5ndGggPyB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHRoaXMuYmluYXJ5U3RyaW5nLmNoYXJDb2RlQXQoZSsrKSxcbiAgICAgICAgICAgICAgICBkb25lOiAhMVxuICAgICAgICAgICAgfSA6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogdm9pZCAwLFxuICAgICAgICAgICAgICAgIGRvbmU6ICEwXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfVxuICAgIHRvQmFzZTY0KCkge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2VuY29kZUJhc2U2NChlKSB7XG4gICAgICAgICAgICByZXR1cm4gYnRvYShlKTtcbiAgICAgICAgfSh0aGlzLmJpbmFyeVN0cmluZyk7XG4gICAgfVxuICAgIHRvVWludDhBcnJheSgpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV91aW50OEFycmF5RnJvbUJpbmFyeVN0cmluZyhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IFVpbnQ4QXJyYXkoZS5sZW5ndGgpO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgbisrKSB0W25dID0gZS5jaGFyQ29kZUF0KG4pO1xuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgLy8gQSBSZWdFeHAgbWF0Y2hpbmcgSVNPIDg2MDEgVVRDIHRpbWVzdGFtcHMgd2l0aCBvcHRpb25hbCBmcmFjdGlvbi5cbiAgICAgICAgKHRoaXMuYmluYXJ5U3RyaW5nKTtcbiAgICB9XG4gICAgYXBwcm94aW1hdGVCeXRlU2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIDIgKiB0aGlzLmJpbmFyeVN0cmluZy5sZW5ndGg7XG4gICAgfVxuICAgIGNvbXBhcmVUbyhlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcih0aGlzLmJpbmFyeVN0cmluZywgZS5iaW5hcnlTdHJpbmcpO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYmluYXJ5U3RyaW5nID09PSBlLmJpbmFyeVN0cmluZztcbiAgICB9XG59XG5cbkJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcgPSBuZXcgQnl0ZVN0cmluZyhcIlwiKTtcblxuY29uc3QgWmUgPSBuZXcgUmVnRXhwKC9eXFxkezR9LVxcZFxcZC1cXGRcXGRUXFxkXFxkOlxcZFxcZDpcXGRcXGQoPzpcXC4oXFxkKykpP1okLyk7XG5cbi8qKlxuICogQ29udmVydHMgdGhlIHBvc3NpYmxlIFByb3RvIHZhbHVlcyBmb3IgYSB0aW1lc3RhbXAgdmFsdWUgaW50byBhIFwic2Vjb25kcyBhbmRcbiAqIG5hbm9zXCIgcmVwcmVzZW50YXRpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlKSB7XG4gICAgLy8gVGhlIGpzb24gaW50ZXJmYWNlIChmb3IgdGhlIGJyb3dzZXIpIHdpbGwgcmV0dXJuIGFuIGlzbyB0aW1lc3RhbXAgc3RyaW5nLFxuICAgIC8vIHdoaWxlIHRoZSBwcm90byBqcyBsaWJyYXJ5IChmb3Igbm9kZSkgd2lsbCByZXR1cm4gYVxuICAgIC8vIGdvb2dsZS5wcm90b2J1Zi5UaW1lc3RhbXAgaW5zdGFuY2UuXG4gICAgaWYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZSksIFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHtcbiAgICAgICAgLy8gVGhlIGRhdGUgc3RyaW5nIGNhbiBoYXZlIGhpZ2hlciBwcmVjaXNpb24gKG5hbm9zKSB0aGFuIHRoZSBEYXRlIGNsYXNzXG4gICAgICAgIC8vIChtaWxsaXMpLCBzbyB3ZSBkbyBzb21lIGN1c3RvbSBwYXJzaW5nIGhlcmUuXG4gICAgICAgIC8vIFBhcnNlIHRoZSBuYW5vcyByaWdodCBvdXQgb2YgdGhlIHN0cmluZy5cbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICBjb25zdCBuID0gWmUuZXhlYyhlKTtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhbiksIG5bMV0pIHtcbiAgICAgICAgICAgIC8vIFBhZCB0aGUgZnJhY3Rpb24gb3V0IHRvIDkgZGlnaXRzIChuYW5vcykuXG4gICAgICAgICAgICBsZXQgZSA9IG5bMV07XG4gICAgICAgICAgICBlID0gKGUgKyBcIjAwMDAwMDAwMFwiKS5zdWJzdHIoMCwgOSksIHQgPSBOdW1iZXIoZSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUGFyc2UgdGhlIGRhdGUgdG8gZ2V0IHRoZSBzZWNvbmRzLlxuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuZXcgRGF0ZShlKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHNlY29uZHM6IE1hdGguZmxvb3Ioci5nZXRUaW1lKCkgLyAxZTMpLFxuICAgICAgICAgICAgbmFub3M6IHRcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2Vjb25kczogX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLnNlY29uZHMpLFxuICAgICAgICBuYW5vczogX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLm5hbm9zKVxuICAgIH07XG59XG5cbi8qKlxuICogQ29udmVydHMgdGhlIHBvc3NpYmxlIFByb3RvIHR5cGVzIGZvciBudW1iZXJzIGludG8gYSBKYXZhU2NyaXB0IG51bWJlci5cbiAqIFJldHVybnMgMCBpZiB0aGUgdmFsdWUgaXMgbm90IG51bWVyaWMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlKSB7XG4gICAgLy8gVE9ETyhiam9ybmljayk6IEhhbmRsZSBpbnQ2NCBncmVhdGVyIHRoYW4gNTMgYml0cy5cbiAgICByZXR1cm4gXCJudW1iZXJcIiA9PSB0eXBlb2YgZSA/IGUgOiBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gTnVtYmVyKGUpIDogMDtcbn1cblxuLyoqIENvbnZlcnRzIHRoZSBwb3NzaWJsZSBQcm90byB0eXBlcyBmb3IgQmxvYnMgaW50byBhIEJ5dGVTdHJpbmcuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUpIHtcbiAgICByZXR1cm4gXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSA/IEJ5dGVTdHJpbmcuZnJvbUJhc2U2NFN0cmluZyhlKSA6IEJ5dGVTdHJpbmcuZnJvbVVpbnQ4QXJyYXkoZSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBsb2NhbGx5LWFwcGxpZWQgU2VydmVyVGltZXN0YW1wLlxuICpcbiAqIFNlcnZlciBUaW1lc3RhbXBzIGFyZSBiYWNrZWQgYnkgTWFwVmFsdWVzIHRoYXQgY29udGFpbiBhbiBpbnRlcm5hbCBmaWVsZFxuICogYF9fdHlwZV9fYCB3aXRoIGEgdmFsdWUgb2YgYHNlcnZlcl90aW1lc3RhbXBgLiBUaGUgcHJldmlvdXMgdmFsdWUgYW5kIGxvY2FsXG4gKiB3cml0ZSB0aW1lIGFyZSBzdG9yZWQgaW4gaXRzIGBfX3ByZXZpb3VzX3ZhbHVlX19gIGFuZCBgX19sb2NhbF93cml0ZV90aW1lX19gXG4gKiBmaWVsZHMgcmVzcGVjdGl2ZWx5LlxuICpcbiAqIE5vdGVzOlxuICogLSBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZSBpbnN0YW5jZXMgYXJlIGNyZWF0ZWQgYXMgdGhlIHJlc3VsdCBvZiBhcHBseWluZyBhXG4gKiAgIHRyYW5zZm9ybS4gVGhleSBjYW4gb25seSBleGlzdCBpbiB0aGUgbG9jYWwgdmlldyBvZiBhIGRvY3VtZW50LiBUaGVyZWZvcmVcbiAqICAgdGhleSBkbyBub3QgbmVlZCB0byBiZSBwYXJzZWQgb3Igc2VyaWFsaXplZC5cbiAqIC0gV2hlbiBldmFsdWF0ZWQgbG9jYWxseSAoZS5nLiBmb3Igc25hcHNob3QuZGF0YSgpKSwgdGhleSBieSBkZWZhdWx0XG4gKiAgIGV2YWx1YXRlIHRvIGBudWxsYC4gVGhpcyBiZWhhdmlvciBjYW4gYmUgY29uZmlndXJlZCBieSBwYXNzaW5nIGN1c3RvbVxuICogICBGaWVsZFZhbHVlT3B0aW9ucyB0byB2YWx1ZSgpLlxuICogLSBXaXRoIHJlc3BlY3QgdG8gb3RoZXIgU2VydmVyVGltZXN0YW1wVmFsdWVzLCB0aGV5IHNvcnQgYnkgdGhlaXJcbiAqICAgbG9jYWxXcml0ZVRpbWUuXG4gKi8gY29uc3QgWGUgPSBcInNlcnZlcl90aW1lc3RhbXBcIiwgZXQgPSBcIl9fdHlwZV9fXCIsIHR0ID0gXCJfX3ByZXZpb3VzX3ZhbHVlX19cIiwgbnQgPSBcIl9fbG9jYWxfd3JpdGVfdGltZV9fXCI7XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcChlKSB7XG4gICAgdmFyIHQsIG47XG4gICAgcmV0dXJuIChudWxsID09PSAobiA9ICgobnVsbCA9PT0gKHQgPSBudWxsID09IGUgPyB2b2lkIDAgOiBlLm1hcFZhbHVlKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0LmZpZWxkcykgfHwge30pW2V0XSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5zdHJpbmdWYWx1ZSkgPT09IFhlO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgU2VydmVyVGltZXN0YW1wIHByb3RvIHZhbHVlICh1c2luZyB0aGUgaW50ZXJuYWwgZm9ybWF0KS5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQgYmVmb3JlIHRoaXMgU2VydmVyVGltZXN0YW1wIHdhcyBzZXQuXG4gKlxuICogUHJlc2VydmluZyB0aGUgcHJldmlvdXMgdmFsdWVzIGFsbG93cyB0aGUgdXNlciB0byBkaXNwbGF5IHRoZSBsYXN0IHJlc29sZWRcbiAqIHZhbHVlIHVudGlsIHRoZSBiYWNrZW5kIHJlc3BvbmRzIHdpdGggdGhlIHRpbWVzdGFtcC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSkge1xuICAgIGNvbnN0IHQgPSBlLm1hcFZhbHVlLmZpZWxkc1t0dF07XG4gICAgcmV0dXJuIF9fUFJJVkFURV9pc1NlcnZlclRpbWVzdGFtcCh0KSA/IF9fUFJJVkFURV9nZXRQcmV2aW91c1ZhbHVlKHQpIDogdDtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBsb2NhbCB0aW1lIGF0IHdoaWNoIHRoaXMgdGltZXN0YW1wIHdhcyBmaXJzdCBzZXQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlLm1hcFZhbHVlLmZpZWxkc1tudF0udGltZXN0YW1wVmFsdWUpO1xuICAgIHJldHVybiBuZXcgVGltZXN0YW1wKHQuc2Vjb25kcywgdC5uYW5vcyk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIERhdGFiYXNlSW5mbyB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyBhIERhdGFiYXNlSW5mbyB1c2luZyB0aGUgcHJvdmlkZWQgaG9zdCwgZGF0YWJhc2VJZCBhbmRcbiAgICAgKiBwZXJzaXN0ZW5jZUtleS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYXRhYmFzZUlkIC0gVGhlIGRhdGFiYXNlIHRvIHVzZS5cbiAgICAgKiBAcGFyYW0gYXBwSWQgLSBUaGUgRmlyZWJhc2UgQXBwIElkLlxuICAgICAqIEBwYXJhbSBwZXJzaXN0ZW5jZUtleSAtIEEgdW5pcXVlIGlkZW50aWZpZXIgZm9yIHRoaXMgRmlyZXN0b3JlJ3MgbG9jYWxcbiAgICAgKiBzdG9yYWdlICh1c2VkIGluIGNvbmp1bmN0aW9uIHdpdGggdGhlIGRhdGFiYXNlSWQpLlxuICAgICAqIEBwYXJhbSBob3N0IC0gVGhlIEZpcmVzdG9yZSBiYWNrZW5kIGhvc3QgdG8gY29ubmVjdCB0by5cbiAgICAgKiBAcGFyYW0gc3NsIC0gV2hldGhlciB0byB1c2UgU1NMIHdoZW4gY29ubmVjdGluZy5cbiAgICAgKiBAcGFyYW0gZm9yY2VMb25nUG9sbGluZyAtIFdoZXRoZXIgdG8gdXNlIHRoZSBmb3JjZUxvbmdQb2xsaW5nIG9wdGlvblxuICAgICAqIHdoZW4gdXNpbmcgV2ViQ2hhbm5lbCBhcyB0aGUgbmV0d29yayB0cmFuc3BvcnQuXG4gICAgICogQHBhcmFtIGF1dG9EZXRlY3RMb25nUG9sbGluZyAtIFdoZXRoZXIgdG8gdXNlIHRoZSBkZXRlY3RCdWZmZXJpbmdQcm94eVxuICAgICAqIG9wdGlvbiB3aGVuIHVzaW5nIFdlYkNoYW5uZWwgYXMgdGhlIG5ldHdvcmsgdHJhbnNwb3J0LlxuICAgICAqIEBwYXJhbSBsb25nUG9sbGluZ09wdGlvbnMgT3B0aW9ucyB0aGF0IGNvbmZpZ3VyZSBsb25nLXBvbGxpbmcuXG4gICAgICogQHBhcmFtIHVzZUZldGNoU3RyZWFtcyBXaGV0aGVyIHRvIHVzZSB0aGUgRmV0Y2ggQVBJIGluc3RlYWQgb2ZcbiAgICAgKiBYTUxIVFRQUmVxdWVzdFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMsIG8sIF8sIGEpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUlkID0gZSwgdGhpcy5hcHBJZCA9IHQsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBuLCB0aGlzLmhvc3QgPSByLCB0aGlzLnNzbCA9IGksIFxuICAgICAgICB0aGlzLmZvcmNlTG9uZ1BvbGxpbmcgPSBzLCB0aGlzLmF1dG9EZXRlY3RMb25nUG9sbGluZyA9IG8sIHRoaXMubG9uZ1BvbGxpbmdPcHRpb25zID0gXywgXG4gICAgICAgIHRoaXMudXNlRmV0Y2hTdHJlYW1zID0gYTtcbiAgICB9XG59XG5cbi8qKiBUaGUgZGVmYXVsdCBkYXRhYmFzZSBuYW1lIGZvciBhIHByb2plY3QuICovIGNvbnN0IHJ0ID0gXCIoZGVmYXVsdClcIjtcblxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBkYXRhYmFzZSBJRCBhIEZpcmVzdG9yZSBjbGllbnQgaXMgYXNzb2NpYXRlZCB3aXRoLlxuICogQGludGVybmFsXG4gKi8gY2xhc3MgRGF0YWJhc2VJZCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnByb2plY3RJZCA9IGUsIHRoaXMuZGF0YWJhc2UgPSB0IHx8IHJ0O1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YWJhc2VJZChcIlwiLCBcIlwiKTtcbiAgICB9XG4gICAgZ2V0IGlzRGVmYXVsdERhdGFiYXNlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kYXRhYmFzZSA9PT0gcnQ7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIERhdGFiYXNlSWQgJiYgZS5wcm9qZWN0SWQgPT09IHRoaXMucHJvamVjdElkICYmIGUuZGF0YWJhc2UgPT09IHRoaXMuZGF0YWJhc2U7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgaXQgPSBcIl9fdHlwZV9fXCIsIHN0ID0gXCJfX21heF9fXCIsIG90ID0ge1xuICAgIG1hcFZhbHVlOiB7XG4gICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgX190eXBlX186IHtcbiAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogc3RcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0sIF90ID0gXCJfX3ZlY3Rvcl9fXCIsIGF0ID0gXCJ2YWx1ZVwiLCB1dCA9IHtcbiAgICBudWxsVmFsdWU6IFwiTlVMTF9WQUxVRVwiXG59O1xuXG4vKiogRXh0cmFjdHMgdGhlIGJhY2tlbmQncyB0eXBlIG9yZGVyIGZvciB0aGUgcHJvdmlkZWQgdmFsdWUuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdHlwZU9yZGVyKGUpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiBlID8gMCAvKiBUeXBlT3JkZXIuTnVsbFZhbHVlICovIDogXCJib29sZWFuVmFsdWVcIiBpbiBlID8gMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDogXCJpbnRlZ2VyVmFsdWVcIiBpbiBlIHx8IFwiZG91YmxlVmFsdWVcIiBpbiBlID8gMiAvKiBUeXBlT3JkZXIuTnVtYmVyVmFsdWUgKi8gOiBcInRpbWVzdGFtcFZhbHVlXCIgaW4gZSA/IDMgLyogVHlwZU9yZGVyLlRpbWVzdGFtcFZhbHVlICovIDogXCJzdHJpbmdWYWx1ZVwiIGluIGUgPyA1IC8qIFR5cGVPcmRlci5TdHJpbmdWYWx1ZSAqLyA6IFwiYnl0ZXNWYWx1ZVwiIGluIGUgPyA2IC8qIFR5cGVPcmRlci5CbG9iVmFsdWUgKi8gOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gZSA/IDcgLyogVHlwZU9yZGVyLlJlZlZhbHVlICovIDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gZSA/IDggLyogVHlwZU9yZGVyLkdlb1BvaW50VmFsdWUgKi8gOiBcImFycmF5VmFsdWVcIiBpbiBlID8gOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6IFwibWFwVmFsdWVcIiBpbiBlID8gX19QUklWQVRFX2lzU2VydmVyVGltZXN0YW1wKGUpID8gNCAvKiBUeXBlT3JkZXIuU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOiBfX1BSSVZBVEVfaXNNYXhWYWx1ZShlKSA/IDkwMDcxOTkyNTQ3NDA5OTEgLyogVHlwZU9yZGVyLk1heFZhbHVlICovIDogX19QUklWQVRFX2lzVmVjdG9yVmFsdWUoZSkgPyAxMCAvKiBUeXBlT3JkZXIuVmVjdG9yVmFsdWUgKi8gOiAxMSAvKiBUeXBlT3JkZXIuT2JqZWN0VmFsdWUgKi8gOiBmYWlsKCk7XG59XG5cbi8qKiBUZXN0cyBgbGVmdGAgYW5kIGByaWdodGAgZm9yIGVxdWFsaXR5IGJhc2VkIG9uIHRoZSBiYWNrZW5kIHNlbWFudGljcy4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlRXF1YWxzKGUsIHQpIHtcbiAgICBpZiAoZSA9PT0gdCkgcmV0dXJuICEwO1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdHlwZU9yZGVyKGUpO1xuICAgIGlmIChuICE9PSBfX1BSSVZBVEVfdHlwZU9yZGVyKHQpKSByZXR1cm4gITE7XG4gICAgc3dpdGNoIChuKSB7XG4gICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDkwMDcxOTkyNTQ3NDA5OTEgLyogVHlwZU9yZGVyLk1heFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuICEwO1xuXG4gICAgICBjYXNlIDEgLyogVHlwZU9yZGVyLkJvb2xlYW5WYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBlLmJvb2xlYW5WYWx1ZSA9PT0gdC5ib29sZWFuVmFsdWU7XG5cbiAgICAgIGNhc2UgNCAvKiBUeXBlT3JkZXIuU2VydmVyVGltZXN0YW1wVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKGUpLmlzRXF1YWwoX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKHQpKTtcblxuICAgICAgY2FzZSAzIC8qIFR5cGVPcmRlci5UaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfdGltZXN0YW1wRXF1YWxzKGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlLnRpbWVzdGFtcFZhbHVlICYmIFwic3RyaW5nXCIgPT0gdHlwZW9mIHQudGltZXN0YW1wVmFsdWUgJiYgZS50aW1lc3RhbXBWYWx1ZS5sZW5ndGggPT09IHQudGltZXN0YW1wVmFsdWUubGVuZ3RoKSBcbiAgICAgICAgICAgIC8vIFVzZSBzdHJpbmcgZXF1YWxpdHkgZm9yIElTTyA4NjAxIHRpbWVzdGFtcHNcbiAgICAgICAgICAgIHJldHVybiBlLnRpbWVzdGFtcFZhbHVlID09PSB0LnRpbWVzdGFtcFZhbHVlO1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9ub3JtYWxpemVUaW1lc3RhbXAoZS50aW1lc3RhbXBWYWx1ZSksIHIgPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKHQudGltZXN0YW1wVmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG4uc2Vjb25kcyA9PT0gci5zZWNvbmRzICYmIG4ubmFub3MgPT09IHIubmFub3M7XG4gICAgICAgIH0oZSwgdCk7XG5cbiAgICAgIGNhc2UgNSAvKiBUeXBlT3JkZXIuU3RyaW5nVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZS5zdHJpbmdWYWx1ZSA9PT0gdC5zdHJpbmdWYWx1ZTtcblxuICAgICAgY2FzZSA2IC8qIFR5cGVPcmRlci5CbG9iVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2Jsb2JFcXVhbHMoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUuYnl0ZXNWYWx1ZSkuaXNFcXVhbChfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyh0LmJ5dGVzVmFsdWUpKTtcbiAgICAgICAgfShlLCB0KTtcblxuICAgICAgY2FzZSA3IC8qIFR5cGVPcmRlci5SZWZWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBlLnJlZmVyZW5jZVZhbHVlID09PSB0LnJlZmVyZW5jZVZhbHVlO1xuXG4gICAgICBjYXNlIDggLyogVHlwZU9yZGVyLkdlb1BvaW50VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2dlb1BvaW50RXF1YWxzKGUsIHQpIHtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuZ2VvUG9pbnRWYWx1ZS5sYXRpdHVkZSkgPT09IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5nZW9Qb2ludFZhbHVlLmxhdGl0dWRlKSAmJiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuZ2VvUG9pbnRWYWx1ZS5sb25naXR1ZGUpID09PSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKHQuZ2VvUG9pbnRWYWx1ZS5sb25naXR1ZGUpO1xuICAgICAgICB9KGUsIHQpO1xuXG4gICAgICBjYXNlIDIgLyogVHlwZU9yZGVyLk51bWJlclZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9udW1iZXJFcXVhbHMoZSwgdCkge1xuICAgICAgICAgICAgaWYgKFwiaW50ZWdlclZhbHVlXCIgaW4gZSAmJiBcImludGVnZXJWYWx1ZVwiIGluIHQpIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuaW50ZWdlclZhbHVlKSA9PT0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0LmludGVnZXJWYWx1ZSk7XG4gICAgICAgICAgICBpZiAoXCJkb3VibGVWYWx1ZVwiIGluIGUgJiYgXCJkb3VibGVWYWx1ZVwiIGluIHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmRvdWJsZVZhbHVlKSwgciA9IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5kb3VibGVWYWx1ZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gPT09IHIgPyBfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8obikgPT09IF9fUFJJVkFURV9pc05lZ2F0aXZlWmVybyhyKSA6IGlzTmFOKG4pICYmIGlzTmFOKHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICB9KGUsIHQpO1xuXG4gICAgICBjYXNlIDkgLyogVHlwZU9yZGVyLkFycmF5VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX2FycmF5RXF1YWxzKGUuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10sIHQuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW10sIF9fUFJJVkFURV92YWx1ZUVxdWFscyk7XG5cbiAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLlZlY3RvclZhbHVlICovIDpcbiAgICAgIGNhc2UgMTEgLyogVHlwZU9yZGVyLk9iamVjdFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9vYmplY3RFcXVhbHMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IGUubWFwVmFsdWUuZmllbGRzIHx8IHt9LCByID0gdC5tYXBWYWx1ZS5maWVsZHMgfHwge307XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX29iamVjdFNpemUobikgIT09IF9fUFJJVkFURV9vYmplY3RTaXplKHIpKSByZXR1cm4gITE7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgaW4gbikgaWYgKG4uaGFzT3duUHJvcGVydHkoZSkgJiYgKHZvaWQgMCA9PT0gcltlXSB8fCAhX19QUklWQVRFX3ZhbHVlRXF1YWxzKG5bZV0sIHJbZV0pKSkgcmV0dXJuICExO1xuICAgICAgICAgICAgcmV0dXJuICEwO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIEFycmF5VmFsdWUgY29udGFpbnMgdGhlIHNwZWNpZmllZCBlbGVtZW50LiAqLyAoZSwgdCk7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYXJyYXlWYWx1ZUNvbnRhaW5zKGUsIHQpIHtcbiAgICByZXR1cm4gdm9pZCAwICE9PSAoZS52YWx1ZXMgfHwgW10pLmZpbmQoKGUgPT4gX19QUklWQVRFX3ZhbHVlRXF1YWxzKGUsIHQpKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWx1ZUNvbXBhcmUoZSwgdCkge1xuICAgIGlmIChlID09PSB0KSByZXR1cm4gMDtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX3R5cGVPcmRlcihlKSwgciA9IF9fUFJJVkFURV90eXBlT3JkZXIodCk7XG4gICAgaWYgKG4gIT09IHIpIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuLCByKTtcbiAgICBzd2l0Y2ggKG4pIHtcbiAgICAgIGNhc2UgMCAvKiBUeXBlT3JkZXIuTnVsbFZhbHVlICovIDpcbiAgICAgIGNhc2UgOTAwNzE5OTI1NDc0MDk5MSAvKiBUeXBlT3JkZXIuTWF4VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gMDtcblxuICAgICAgY2FzZSAxIC8qIFR5cGVPcmRlci5Cb29sZWFuVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5ib29sZWFuVmFsdWUsIHQuYm9vbGVhblZhbHVlKTtcblxuICAgICAgY2FzZSAyIC8qIFR5cGVPcmRlci5OdW1iZXJWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZU51bWJlcnMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5pbnRlZ2VyVmFsdWUgfHwgZS5kb3VibGVWYWx1ZSksIHIgPSBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKHQuaW50ZWdlclZhbHVlIHx8IHQuZG91YmxlVmFsdWUpO1xuICAgICAgICAgICAgcmV0dXJuIG4gPCByID8gLTEgOiBuID4gciA/IDEgOiBuID09PSByID8gMCA6IFxuICAgICAgICAgICAgLy8gb25lIG9yIGJvdGggYXJlIE5hTi5cbiAgICAgICAgICAgIGlzTmFOKG4pID8gaXNOYU4ocikgPyAwIDogLTEgOiAxO1xuICAgICAgICB9KGUsIHQpO1xuXG4gICAgICBjYXNlIDMgLyogVHlwZU9yZGVyLlRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wYXJlVGltZXN0YW1wcyhlLnRpbWVzdGFtcFZhbHVlLCB0LnRpbWVzdGFtcFZhbHVlKTtcblxuICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfY29tcGFyZVRpbWVzdGFtcHMoX19QUklWQVRFX2dldExvY2FsV3JpdGVUaW1lKGUpLCBfX1BSSVZBVEVfZ2V0TG9jYWxXcml0ZVRpbWUodCkpO1xuXG4gICAgICBjYXNlIDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wYXJlVXRmOFN0cmluZ3MoZS5zdHJpbmdWYWx1ZSwgdC5zdHJpbmdWYWx1ZSk7XG5cbiAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlQmxvYnMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZUJ5dGVTdHJpbmcodCk7XG4gICAgICAgICAgICByZXR1cm4gbi5jb21wYXJlVG8ocik7XG4gICAgICAgIH0oZS5ieXRlc1ZhbHVlLCB0LmJ5dGVzVmFsdWUpO1xuXG4gICAgICBjYXNlIDcgLyogVHlwZU9yZGVyLlJlZlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlUmVmZXJlbmNlcyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5zcGxpdChcIi9cIiksIHIgPSB0LnNwbGl0KFwiL1wiKTtcbiAgICAgICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgbi5sZW5ndGggJiYgZSA8IHIubGVuZ3RoOyBlKyspIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IobltlXSwgcltlXSk7XG4gICAgICAgICAgICAgICAgaWYgKDAgIT09IHQpIHJldHVybiB0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4ubGVuZ3RoLCByLmxlbmd0aCk7XG4gICAgICAgIH0oZS5yZWZlcmVuY2VWYWx1ZSwgdC5yZWZlcmVuY2VWYWx1ZSk7XG5cbiAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUdlb1BvaW50cyhlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmxhdGl0dWRlKSwgX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcih0LmxhdGl0dWRlKSk7XG4gICAgICAgICAgICBpZiAoMCAhPT0gbikgcmV0dXJuIG47XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmxvbmdpdHVkZSksIF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIodC5sb25naXR1ZGUpKTtcbiAgICAgICAgfShlLmdlb1BvaW50VmFsdWUsIHQuZ2VvUG9pbnRWYWx1ZSk7XG5cbiAgICAgIGNhc2UgOSAvKiBUeXBlT3JkZXIuQXJyYXlWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfY29tcGFyZUFycmF5cyhlLmFycmF5VmFsdWUsIHQuYXJyYXlWYWx1ZSk7XG5cbiAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLlZlY3RvclZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wYXJlVmVjdG9ycyhlLCB0KSB7XG4gICAgICAgICAgICB2YXIgbiwgciwgaSwgcztcbiAgICAgICAgICAgIGNvbnN0IG8gPSBlLmZpZWxkcyB8fCB7fSwgXyA9IHQuZmllbGRzIHx8IHt9LCBhID0gbnVsbCA9PT0gKG4gPSBvW2F0XSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5hcnJheVZhbHVlLCB1ID0gbnVsbCA9PT0gKHIgPSBfW2F0XSkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5hcnJheVZhbHVlLCBjID0gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoKG51bGwgPT09IChpID0gbnVsbCA9PSBhID8gdm9pZCAwIDogYS52YWx1ZXMpIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkubGVuZ3RoKSB8fCAwLCAobnVsbCA9PT0gKHMgPSBudWxsID09IHUgPyB2b2lkIDAgOiB1LnZhbHVlcykgfHwgdm9pZCAwID09PSBzID8gdm9pZCAwIDogcy5sZW5ndGgpIHx8IDApO1xuICAgICAgICAgICAgaWYgKDAgIT09IGMpIHJldHVybiBjO1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jb21wYXJlQXJyYXlzKGEsIHUpO1xuICAgICAgICB9KGUubWFwVmFsdWUsIHQubWFwVmFsdWUpO1xuXG4gICAgICBjYXNlIDExIC8qIFR5cGVPcmRlci5PYmplY3RWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZU1hcHMoZSwgdCkge1xuICAgICAgICAgICAgaWYgKGUgPT09IG90Lm1hcFZhbHVlICYmIHQgPT09IG90Lm1hcFZhbHVlKSByZXR1cm4gMDtcbiAgICAgICAgICAgIGlmIChlID09PSBvdC5tYXBWYWx1ZSkgcmV0dXJuIDE7XG4gICAgICAgICAgICBpZiAodCA9PT0gb3QubWFwVmFsdWUpIHJldHVybiAtMTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmZpZWxkcyB8fCB7fSwgciA9IE9iamVjdC5rZXlzKG4pLCBpID0gdC5maWVsZHMgfHwge30sIHMgPSBPYmplY3Qua2V5cyhpKTtcbiAgICAgICAgICAgIC8vIEV2ZW4gdGhvdWdoIE1hcFZhbHVlcyBhcmUgbGlrZWx5IHNvcnRlZCBjb3JyZWN0bHkgYmFzZWQgb24gdGhlaXIgaW5zZXJ0aW9uXG4gICAgICAgICAgICAvLyBvcmRlciAoZS5nLiB3aGVuIHJlY2VpdmVkIGZyb20gdGhlIGJhY2tlbmQpLCBsb2NhbCBtb2RpZmljYXRpb25zIGNhbiBicmluZ1xuICAgICAgICAgICAgLy8gZWxlbWVudHMgb3V0IG9mIG9yZGVyLiBXZSBuZWVkIHRvIHJlLXNvcnQgdGhlIGVsZW1lbnRzIHRvIGVuc3VyZSB0aGF0XG4gICAgICAgICAgICAvLyBjYW5vbmljYWwgSURzIGFyZSBpbmRlcGVuZGVudCBvZiBpbnNlcnRpb24gb3JkZXIuXG4gICAgICAgICAgICByLnNvcnQoKSwgcy5zb3J0KCk7XG4gICAgICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHIubGVuZ3RoICYmIGUgPCBzLmxlbmd0aDsgKytlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9jb21wYXJlVXRmOFN0cmluZ3MocltlXSwgc1tlXSk7XG4gICAgICAgICAgICAgICAgaWYgKDAgIT09IHQpIHJldHVybiB0O1xuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKG5bcltlXV0sIGlbc1tlXV0pO1xuICAgICAgICAgICAgICAgIGlmICgwICE9PSBvKSByZXR1cm4gbztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihyLmxlbmd0aCwgcy5sZW5ndGgpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogR2VuZXJhdGVzIHRoZSBjYW5vbmljYWwgSUQgZm9yIHRoZSBwcm92aWRlZCBmaWVsZCB2YWx1ZSAoYXMgdXNlZCBpbiBUYXJnZXRcbiAqIHNlcmlhbGl6YXRpb24pLlxuICovIChlLm1hcFZhbHVlLCB0Lm1hcFZhbHVlKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVUaW1lc3RhbXBzKGUsIHQpIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgZSAmJiBcInN0cmluZ1wiID09IHR5cGVvZiB0ICYmIGUubGVuZ3RoID09PSB0Lmxlbmd0aCkgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUsIHQpO1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpLCByID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcCh0KSwgaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4uc2Vjb25kcywgci5zZWNvbmRzKTtcbiAgICByZXR1cm4gMCAhPT0gaSA/IGkgOiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuLm5hbm9zLCByLm5hbm9zKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVBcnJheXMoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBlLnZhbHVlcyB8fCBbXSwgciA9IHQudmFsdWVzIHx8IFtdO1xuICAgIGZvciAobGV0IGUgPSAwOyBlIDwgbi5sZW5ndGggJiYgZSA8IHIubGVuZ3RoOyArK2UpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV92YWx1ZUNvbXBhcmUobltlXSwgcltlXSk7XG4gICAgICAgIGlmICh0KSByZXR1cm4gdDtcbiAgICB9XG4gICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4ubGVuZ3RoLCByLmxlbmd0aCk7XG59XG5cbmZ1bmN0aW9uIGNhbm9uaWNhbElkKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2Nhbm9uaWZ5VmFsdWUoZSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVZhbHVlKGUpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiBlID8gXCJudWxsXCIgOiBcImJvb2xlYW5WYWx1ZVwiIGluIGUgPyBcIlwiICsgZS5ib29sZWFuVmFsdWUgOiBcImludGVnZXJWYWx1ZVwiIGluIGUgPyBcIlwiICsgZS5pbnRlZ2VyVmFsdWUgOiBcImRvdWJsZVZhbHVlXCIgaW4gZSA/IFwiXCIgKyBlLmRvdWJsZVZhbHVlIDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlUaW1lc3RhbXAoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25vcm1hbGl6ZVRpbWVzdGFtcChlKTtcbiAgICAgICAgcmV0dXJuIGB0aW1lKCR7dC5zZWNvbmRzfSwke3QubmFub3N9KWA7XG4gICAgfShlLnRpbWVzdGFtcFZhbHVlKSA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8gZS5zdHJpbmdWYWx1ZSA6IFwiYnl0ZXNWYWx1ZVwiIGluIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlCeXRlU3RyaW5nKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUpLnRvQmFzZTY0KCk7XG4gICAgfShlLmJ5dGVzVmFsdWUpIDogXCJyZWZlcmVuY2VWYWx1ZVwiIGluIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlSZWZlcmVuY2UoZSkge1xuICAgICAgICByZXR1cm4gRG9jdW1lbnRLZXkuZnJvbU5hbWUoZSkudG9TdHJpbmcoKTtcbiAgICB9KGUucmVmZXJlbmNlVmFsdWUpIDogXCJnZW9Qb2ludFZhbHVlXCIgaW4gZSA/IGZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeUdlb1BvaW50KGUpIHtcbiAgICAgICAgcmV0dXJuIGBnZW8oJHtlLmxhdGl0dWRlfSwke2UubG9uZ2l0dWRlfSlgO1xuICAgIH0oZS5nZW9Qb2ludFZhbHVlKSA6IFwiYXJyYXlWYWx1ZVwiIGluIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlBcnJheShlKSB7XG4gICAgICAgIGxldCB0ID0gXCJbXCIsIG4gPSAhMDtcbiAgICAgICAgZm9yIChjb25zdCByIG9mIGUudmFsdWVzIHx8IFtdKSBuID8gbiA9ICExIDogdCArPSBcIixcIiwgdCArPSBfX1BSSVZBVEVfY2Fub25pZnlWYWx1ZShyKTtcbiAgICAgICAgcmV0dXJuIHQgKyBcIl1cIjtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIGFuIGFwcHJveGltYXRlIChhbmQgd2lsZGx5IGluYWNjdXJhdGUpIGluLW1lbW9yeSBzaXplIGZvciB0aGUgZmllbGRcbiAqIHZhbHVlLlxuICpcbiAqIFRoZSBtZW1vcnkgc2l6ZSB0YWtlcyBpbnRvIGFjY291bnQgb25seSB0aGUgYWN0dWFsIHVzZXIgZGF0YSBhcyBpdCByZXNpZGVzXG4gKiBpbiBtZW1vcnkgYW5kIGlnbm9yZXMgb2JqZWN0IG92ZXJoZWFkLlxuICovIChlLmFycmF5VmFsdWUpIDogXCJtYXBWYWx1ZVwiIGluIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlNYXAoZSkge1xuICAgICAgICAvLyBJdGVyYXRpb24gb3JkZXIgaW4gSmF2YVNjcmlwdCBpcyBub3QgZ3VhcmFudGVlZC4gVG8gZW5zdXJlIHRoYXQgd2UgZ2VuZXJhdGVcbiAgICAgICAgLy8gbWF0Y2hpbmcgY2Fub25pY2FsIElEcyBmb3IgaWRlbnRpY2FsIG1hcHMsIHdlIG5lZWQgdG8gc29ydCB0aGUga2V5cy5cbiAgICAgICAgY29uc3QgdCA9IE9iamVjdC5rZXlzKGUuZmllbGRzIHx8IHt9KS5zb3J0KCk7XG4gICAgICAgIGxldCBuID0gXCJ7XCIsIHIgPSAhMDtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIHQpIHIgPyByID0gITEgOiBuICs9IFwiLFwiLCBuICs9IGAke2l9OiR7X19QUklWQVRFX2Nhbm9uaWZ5VmFsdWUoZS5maWVsZHNbaV0pfWA7XG4gICAgICAgIHJldHVybiBuICsgXCJ9XCI7XG4gICAgfShlLm1hcFZhbHVlKSA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2VzdGltYXRlQnl0ZVNpemUoZSkge1xuICAgIHN3aXRjaCAoX19QUklWQVRFX3R5cGVPcmRlcihlKSkge1xuICAgICAgY2FzZSAwIC8qIFR5cGVPcmRlci5OdWxsVmFsdWUgKi8gOlxuICAgICAgY2FzZSAxIC8qIFR5cGVPcmRlci5Cb29sZWFuVmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gNDtcblxuICAgICAgY2FzZSAyIC8qIFR5cGVPcmRlci5OdW1iZXJWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiA4O1xuXG4gICAgICBjYXNlIDMgLyogVHlwZU9yZGVyLlRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgIGNhc2UgOCAvKiBUeXBlT3JkZXIuR2VvUG9pbnRWYWx1ZSAqLyA6XG4gICAgICAgIC8vIEdlb1BvaW50cyBhcmUgbWFkZSB1cCBvZiB0d28gZGlzdGluY3QgbnVtYmVycyAobGF0aXR1ZGUgKyBsb25naXR1ZGUpXG4gICAgICAgIHJldHVybiAxNjtcblxuICAgICAgY2FzZSA0IC8qIFR5cGVPcmRlci5TZXJ2ZXJUaW1lc3RhbXBWYWx1ZSAqLyA6XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0UHJldmlvdXNWYWx1ZShlKTtcbiAgICAgICAgcmV0dXJuIHQgPyAxNiArIF9fUFJJVkFURV9lc3RpbWF0ZUJ5dGVTaXplKHQpIDogMTY7XG5cbiAgICAgIGNhc2UgNSAvKiBUeXBlT3JkZXIuU3RyaW5nVmFsdWUgKi8gOlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9EYXRhX3N0cnVjdHVyZXM6XG4gICAgICAgIC8vIFwiSmF2YVNjcmlwdCdzIFN0cmluZyB0eXBlIGlzIFsuLi5dIGEgc2V0IG9mIGVsZW1lbnRzIG9mIDE2LWJpdCB1bnNpZ25lZFxuICAgICAgICAvLyBpbnRlZ2VyIHZhbHVlc1wiXG4gICAgICAgIHJldHVybiAyICogZS5zdHJpbmdWYWx1ZS5sZW5ndGg7XG5cbiAgICAgIGNhc2UgNiAvKiBUeXBlT3JkZXIuQmxvYlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUuYnl0ZXNWYWx1ZSkuYXBwcm94aW1hdGVCeXRlU2l6ZSgpO1xuXG4gICAgICBjYXNlIDcgLyogVHlwZU9yZGVyLlJlZlZhbHVlICovIDpcbiAgICAgICAgcmV0dXJuIGUucmVmZXJlbmNlVmFsdWUubGVuZ3RoO1xuXG4gICAgICBjYXNlIDkgLyogVHlwZU9yZGVyLkFycmF5VmFsdWUgKi8gOlxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2VzdGltYXRlQXJyYXlCeXRlU2l6ZShlKSB7XG4gICAgICAgICAgICByZXR1cm4gKGUudmFsdWVzIHx8IFtdKS5yZWR1Y2UoKChlLCB0KSA9PiBlICsgX19QUklWQVRFX2VzdGltYXRlQnl0ZVNpemUodCkpLCAwKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJucyBhIHJlZmVyZW5jZSB2YWx1ZSBmb3IgdGhlIHByb3ZpZGVkIGRhdGFiYXNlIGFuZCBrZXkuICovIChlLmFycmF5VmFsdWUpO1xuXG4gICAgICBjYXNlIDEwIC8qIFR5cGVPcmRlci5WZWN0b3JWYWx1ZSAqLyA6XG4gICAgICBjYXNlIDExIC8qIFR5cGVPcmRlci5PYmplY3RWYWx1ZSAqLyA6XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZXN0aW1hdGVNYXBCeXRlU2l6ZShlKSB7XG4gICAgICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgICAgICByZXR1cm4gZm9yRWFjaChlLmZpZWxkcywgKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdCArPSBlLmxlbmd0aCArIF9fUFJJVkFURV9lc3RpbWF0ZUJ5dGVTaXplKG4pO1xuICAgICAgICAgICAgfSkpLCB0O1xuICAgICAgICB9KGUubWFwVmFsdWUpO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVmVmFsdWUoZSwgdCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlZmVyZW5jZVZhbHVlOiBgcHJvamVjdHMvJHtlLnByb2plY3RJZH0vZGF0YWJhc2VzLyR7ZS5kYXRhYmFzZX0vZG9jdW1lbnRzLyR7dC5wYXRoLmNhbm9uaWNhbFN0cmluZygpfWBcbiAgICB9O1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYW4gSW50ZWdlclZhbHVlIC4gKi8gZnVuY3Rpb24gaXNJbnRlZ2VyKGUpIHtcbiAgICByZXR1cm4gISFlICYmIFwiaW50ZWdlclZhbHVlXCIgaW4gZTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGEgRG91YmxlVmFsdWUuICovXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYW4gQXJyYXlWYWx1ZS4gKi9cbmZ1bmN0aW9uIGlzQXJyYXkoZSkge1xuICAgIHJldHVybiAhIWUgJiYgXCJhcnJheVZhbHVlXCIgaW4gZTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiBgdmFsdWVgIGlzIGEgTnVsbFZhbHVlLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNOdWxsVmFsdWUoZSkge1xuICAgIHJldHVybiAhIWUgJiYgXCJudWxsVmFsdWVcIiBpbiBlO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgTmFOLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNOYW5WYWx1ZShlKSB7XG4gICAgcmV0dXJuICEhZSAmJiBcImRvdWJsZVZhbHVlXCIgaW4gZSAmJiBpc05hTihOdW1iZXIoZS5kb3VibGVWYWx1ZSkpO1xufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIGB2YWx1ZWAgaXMgYSBNYXBWYWx1ZS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2lzTWFwVmFsdWUoZSkge1xuICAgIHJldHVybiAhIWUgJiYgXCJtYXBWYWx1ZVwiIGluIGU7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBhIFZldG9yVmFsdWUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc1ZlY3RvclZhbHVlKGUpIHtcbiAgICB2YXIgdCwgbjtcbiAgICByZXR1cm4gKG51bGwgPT09IChuID0gKChudWxsID09PSAodCA9IG51bGwgPT0gZSA/IHZvaWQgMCA6IGUubWFwVmFsdWUpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuZmllbGRzKSB8fCB7fSlbaXRdKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLnN0cmluZ1ZhbHVlKSA9PT0gX3Q7XG59XG5cbi8qKiBDcmVhdGVzIGEgZGVlcCBjb3B5IG9mIGBzb3VyY2VgLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGVlcENsb25lKGUpIHtcbiAgICBpZiAoZS5nZW9Qb2ludFZhbHVlKSByZXR1cm4ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiBPYmplY3QuYXNzaWduKHt9LCBlLmdlb1BvaW50VmFsdWUpXG4gICAgfTtcbiAgICBpZiAoZS50aW1lc3RhbXBWYWx1ZSAmJiBcIm9iamVjdFwiID09IHR5cGVvZiBlLnRpbWVzdGFtcFZhbHVlKSByZXR1cm4ge1xuICAgICAgICB0aW1lc3RhbXBWYWx1ZTogT2JqZWN0LmFzc2lnbih7fSwgZS50aW1lc3RhbXBWYWx1ZSlcbiAgICB9O1xuICAgIGlmIChlLm1hcFZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczoge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIGZvckVhY2goZS5tYXBWYWx1ZS5maWVsZHMsICgoZSwgbikgPT4gdC5tYXBWYWx1ZS5maWVsZHNbZV0gPSBfX1BSSVZBVEVfZGVlcENsb25lKG4pKSksIFxuICAgICAgICB0O1xuICAgIH1cbiAgICBpZiAoZS5hcnJheVZhbHVlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICAgICAgdmFsdWVzOiBbXVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBmb3IgKGxldCBuID0gMDsgbiA8IChlLmFycmF5VmFsdWUudmFsdWVzIHx8IFtdKS5sZW5ndGg7ICsrbikgdC5hcnJheVZhbHVlLnZhbHVlc1tuXSA9IF9fUFJJVkFURV9kZWVwQ2xvbmUoZS5hcnJheVZhbHVlLnZhbHVlc1tuXSk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgZSk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIFZhbHVlIHJlcHJlc2VudHMgdGhlIGNhbm9uaWNhbCB7QGxpbmsgI01BWF9WQUxVRX0gLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNNYXhWYWx1ZShlKSB7XG4gICAgcmV0dXJuICgoKGUubWFwVmFsdWUgfHwge30pLmZpZWxkcyB8fCB7fSkuX190eXBlX18gfHwge30pLnN0cmluZ1ZhbHVlID09PSBzdDtcbn1cblxuY29uc3QgY3QgPSB7XG4gICAgbWFwVmFsdWU6IHtcbiAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICBbaXRdOiB7XG4gICAgICAgICAgICAgICAgc3RyaW5nVmFsdWU6IF90XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgW2F0XToge1xuICAgICAgICAgICAgICAgIGFycmF5VmFsdWU6IHt9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuXG4vKiogUmV0dXJucyB0aGUgbG93ZXN0IHZhbHVlIGZvciB0aGUgZ2l2ZW4gdmFsdWUgdHlwZSAoaW5jbHVzaXZlKS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbHVlc0dldExvd2VyQm91bmQoZSkge1xuICAgIHJldHVybiBcIm51bGxWYWx1ZVwiIGluIGUgPyB1dCA6IFwiYm9vbGVhblZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYm9vbGVhblZhbHVlOiAhMVxuICAgIH0gOiBcImludGVnZXJWYWx1ZVwiIGluIGUgfHwgXCJkb3VibGVWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICB9IDogXCJ0aW1lc3RhbXBWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICBzZWNvbmRzOiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUlxuICAgICAgICB9XG4gICAgfSA6IFwic3RyaW5nVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBzdHJpbmdWYWx1ZTogXCJcIlxuICAgIH0gOiBcImJ5dGVzVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBieXRlc1ZhbHVlOiBcIlwiXG4gICAgfSA6IFwicmVmZXJlbmNlVmFsdWVcIiBpbiBlID8gX19QUklWQVRFX3JlZlZhbHVlKERhdGFiYXNlSWQuZW1wdHkoKSwgRG9jdW1lbnRLZXkuZW1wdHkoKSkgOiBcImdlb1BvaW50VmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBnZW9Qb2ludFZhbHVlOiB7XG4gICAgICAgICAgICBsYXRpdHVkZTogLTkwLFxuICAgICAgICAgICAgbG9uZ2l0dWRlOiAtMTgwXG4gICAgICAgIH1cbiAgICB9IDogXCJhcnJheVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYXJyYXlWYWx1ZToge31cbiAgICB9IDogXCJtYXBWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfaXNWZWN0b3JWYWx1ZShlKSA/IGN0IDoge1xuICAgICAgICBtYXBWYWx1ZToge31cbiAgICB9IDogZmFpbCgpO1xufVxuXG4vKiogUmV0dXJucyB0aGUgbGFyZ2VzdCB2YWx1ZSBmb3IgdGhlIGdpdmVuIHZhbHVlIHR5cGUgKGV4Y2x1c2l2ZSkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV92YWx1ZXNHZXRVcHBlckJvdW5kKGUpIHtcbiAgICByZXR1cm4gXCJudWxsVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBib29sZWFuVmFsdWU6ICExXG4gICAgfSA6IFwiYm9vbGVhblZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgIH0gOiBcImludGVnZXJWYWx1ZVwiIGluIGUgfHwgXCJkb3VibGVWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIHRpbWVzdGFtcFZhbHVlOiB7XG4gICAgICAgICAgICBzZWNvbmRzOiBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUlxuICAgICAgICB9XG4gICAgfSA6IFwidGltZXN0YW1wVmFsdWVcIiBpbiBlID8ge1xuICAgICAgICBzdHJpbmdWYWx1ZTogXCJcIlxuICAgIH0gOiBcInN0cmluZ1ZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgYnl0ZXNWYWx1ZTogXCJcIlxuICAgIH0gOiBcImJ5dGVzVmFsdWVcIiBpbiBlID8gX19QUklWQVRFX3JlZlZhbHVlKERhdGFiYXNlSWQuZW1wdHkoKSwgRG9jdW1lbnRLZXkuZW1wdHkoKSkgOiBcInJlZmVyZW5jZVZhbHVlXCIgaW4gZSA/IHtcbiAgICAgICAgZ2VvUG9pbnRWYWx1ZToge1xuICAgICAgICAgICAgbGF0aXR1ZGU6IC05MCxcbiAgICAgICAgICAgIGxvbmdpdHVkZTogLTE4MFxuICAgICAgICB9XG4gICAgfSA6IFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUgPyB7XG4gICAgICAgIGFycmF5VmFsdWU6IHt9XG4gICAgfSA6IFwiYXJyYXlWYWx1ZVwiIGluIGUgPyBjdCA6IFwibWFwVmFsdWVcIiBpbiBlID8gX19QUklWQVRFX2lzVmVjdG9yVmFsdWUoZSkgPyB7XG4gICAgICAgIG1hcFZhbHVlOiB7fVxuICAgIH0gOiBvdCA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2xvd2VyQm91bmRDb21wYXJlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShlLnZhbHVlLCB0LnZhbHVlKTtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiBlLmluY2x1c2l2ZSAmJiAhdC5pbmNsdXNpdmUgPyAtMSA6ICFlLmluY2x1c2l2ZSAmJiB0LmluY2x1c2l2ZSA/IDEgOiAwO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdXBwZXJCb3VuZENvbXBhcmUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfdmFsdWVDb21wYXJlKGUudmFsdWUsIHQudmFsdWUpO1xuICAgIHJldHVybiAwICE9PSBuID8gbiA6IGUuaW5jbHVzaXZlICYmICF0LmluY2x1c2l2ZSA/IDEgOiAhZS5pbmNsdXNpdmUgJiYgdC5pbmNsdXNpdmUgPyAtMSA6IDA7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIE9iamVjdFZhbHVlIHJlcHJlc2VudHMgYSBNYXBWYWx1ZSBpbiB0aGUgRmlyZXN0b3JlIFByb3RvIGFuZCBvZmZlcnMgdGhlXG4gKiBhYmlsaXR5IHRvIGFkZCBhbmQgcmVtb3ZlIGZpZWxkcyAodmlhIHRoZSBPYmplY3RWYWx1ZUJ1aWxkZXIpLlxuICovIGNsYXNzIE9iamVjdFZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMudmFsdWUgPSBlO1xuICAgIH1cbiAgICBzdGF0aWMgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICAgICAgbWFwVmFsdWU6IHt9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBhdCB0aGUgZ2l2ZW4gcGF0aCBvciBudWxsLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggLSB0aGUgcGF0aCB0byBzZWFyY2hcbiAgICAgKiBAcmV0dXJucyBUaGUgdmFsdWUgYXQgdGhlIHBhdGggb3IgbnVsbCBpZiB0aGUgcGF0aCBpcyBub3Qgc2V0LlxuICAgICAqLyAgICBmaWVsZChlKSB7XG4gICAgICAgIGlmIChlLmlzRW1wdHkoKSkgcmV0dXJuIHRoaXMudmFsdWU7XG4gICAgICAgIHtcbiAgICAgICAgICAgIGxldCB0ID0gdGhpcy52YWx1ZTtcbiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGggLSAxOyArK24pIGlmICh0ID0gKHQubWFwVmFsdWUuZmllbGRzIHx8IHt9KVtlLmdldChuKV0sIFxuICAgICAgICAgICAgIV9fUFJJVkFURV9pc01hcFZhbHVlKHQpKSByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIHJldHVybiB0ID0gKHQubWFwVmFsdWUuZmllbGRzIHx8IHt9KVtlLmxhc3RTZWdtZW50KCldLCB0IHx8IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgZmllbGQgdG8gdGhlIHByb3ZpZGVkIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggLSBUaGUgZmllbGQgcGF0aCB0byBzZXQuXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIHNldC5cbiAgICAgKi8gICAgc2V0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5nZXRGaWVsZHNNYXAoZS5wb3BMYXN0KCkpW2UubGFzdFNlZ21lbnQoKV0gPSBfX1BSSVZBVEVfZGVlcENsb25lKHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBwcm92aWRlZCBmaWVsZHMgdG8gdGhlIHByb3ZpZGVkIHZhbHVlcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkYXRhIC0gQSBtYXAgb2YgZmllbGRzIHRvIHZhbHVlcyAob3IgbnVsbCBmb3IgZGVsZXRlcykuXG4gICAgICovICAgIHNldEFsbChlKSB7XG4gICAgICAgIGxldCB0ID0gRmllbGRQYXRoJDEuZW1wdHlQYXRoKCksIG4gPSB7fSwgciA9IFtdO1xuICAgICAgICBlLmZvckVhY2goKChlLCBpKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXQuaXNJbW1lZGlhdGVQYXJlbnRPZihpKSkge1xuICAgICAgICAgICAgICAgIC8vIEluc2VydCB0aGUgYWNjdW11bGF0ZWQgY2hhbmdlcyBhdCB0aGlzIHBhcmVudCBsb2NhdGlvblxuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmdldEZpZWxkc01hcCh0KTtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGx5Q2hhbmdlcyhlLCBuLCByKSwgbiA9IHt9LCByID0gW10sIHQgPSBpLnBvcExhc3QoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUgPyBuW2kubGFzdFNlZ21lbnQoKV0gPSBfX1BSSVZBVEVfZGVlcENsb25lKGUpIDogci5wdXNoKGkubGFzdFNlZ21lbnQoKSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgY29uc3QgaSA9IHRoaXMuZ2V0RmllbGRzTWFwKHQpO1xuICAgICAgICB0aGlzLmFwcGx5Q2hhbmdlcyhpLCBuLCByKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgZmllbGQgYXQgdGhlIHNwZWNpZmllZCBwYXRoLiBJZiB0aGVyZSBpcyBubyBmaWVsZCBhdCB0aGVcbiAgICAgKiBzcGVjaWZpZWQgcGF0aCwgbm90aGluZyBpcyBjaGFuZ2VkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggLSBUaGUgZmllbGQgcGF0aCB0byByZW1vdmUuXG4gICAgICovICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmZpZWxkKGUucG9wTGFzdCgpKTtcbiAgICAgICAgX19QUklWQVRFX2lzTWFwVmFsdWUodCkgJiYgdC5tYXBWYWx1ZS5maWVsZHMgJiYgZGVsZXRlIHQubWFwVmFsdWUuZmllbGRzW2UubGFzdFNlZ21lbnQoKV07XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ZhbHVlRXF1YWxzKHRoaXMudmFsdWUsIGUudmFsdWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBtYXAgdGhhdCBjb250YWlucyB0aGUgbGVhZiBlbGVtZW50IG9mIGBwYXRoYC4gSWYgdGhlIHBhcmVudFxuICAgICAqIGVudHJ5IGRvZXMgbm90IHlldCBleGlzdCwgb3IgaWYgaXQgaXMgbm90IGEgbWFwLCBhIG5ldyBtYXAgd2lsbCBiZSBjcmVhdGVkLlxuICAgICAqLyAgICBnZXRGaWVsZHNNYXAoZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMudmFsdWU7XG4gICAgICAgIHQubWFwVmFsdWUuZmllbGRzIHx8ICh0Lm1hcFZhbHVlID0ge1xuICAgICAgICAgICAgZmllbGRzOiB7fVxuICAgICAgICB9KTtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgKytuKSB7XG4gICAgICAgICAgICBsZXQgciA9IHQubWFwVmFsdWUuZmllbGRzW2UuZ2V0KG4pXTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9pc01hcFZhbHVlKHIpICYmIHIubWFwVmFsdWUuZmllbGRzIHx8IChyID0ge1xuICAgICAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkczoge31cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCB0Lm1hcFZhbHVlLmZpZWxkc1tlLmdldChuKV0gPSByKSwgdCA9IHI7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHQubWFwVmFsdWUuZmllbGRzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNb2RpZmllcyBgZmllbGRzTWFwYCBieSBhZGRpbmcsIHJlcGxhY2luZyBvciBkZWxldGluZyB0aGUgc3BlY2lmaWVkXG4gICAgICogZW50cmllcy5cbiAgICAgKi8gICAgYXBwbHlDaGFuZ2VzKGUsIHQsIG4pIHtcbiAgICAgICAgZm9yRWFjaCh0LCAoKHQsIG4pID0+IGVbdF0gPSBuKSk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBuKSBkZWxldGUgZVt0XTtcbiAgICB9XG4gICAgY2xvbmUoKSB7XG4gICAgICAgIHJldHVybiBuZXcgT2JqZWN0VmFsdWUoX19QUklWQVRFX2RlZXBDbG9uZSh0aGlzLnZhbHVlKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIFJldHVybnMgYSBGaWVsZE1hc2sgYnVpbHQgZnJvbSBhbGwgZmllbGRzIGluIGEgTWFwVmFsdWUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2V4dHJhY3RGaWVsZE1hc2soZSkge1xuICAgIGNvbnN0IHQgPSBbXTtcbiAgICByZXR1cm4gZm9yRWFjaChlLmZpZWxkcywgKChlLCBuKSA9PiB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgRmllbGRQYXRoJDEoWyBlIF0pO1xuICAgICAgICBpZiAoX19QUklWQVRFX2lzTWFwVmFsdWUobikpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfZXh0cmFjdEZpZWxkTWFzayhuLm1hcFZhbHVlKS5maWVsZHM7XG4gICAgICAgICAgICBpZiAoMCA9PT0gZS5sZW5ndGgpIFxuICAgICAgICAgICAgLy8gUHJlc2VydmUgdGhlIGVtcHR5IG1hcCBieSBhZGRpbmcgaXQgdG8gdGhlIEZpZWxkTWFzay5cbiAgICAgICAgICAgIHQucHVzaChyKTsgZWxzZSBcbiAgICAgICAgICAgIC8vIEZvciBuZXN0ZWQgYW5kIG5vbi1lbXB0eSBPYmplY3RWYWx1ZXMsIGFkZCB0aGUgRmllbGRQYXRoIG9mIHRoZVxuICAgICAgICAgICAgLy8gbGVhZiBub2Rlcy5cbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBlKSB0LnB1c2goci5jaGlsZChuKSk7XG4gICAgICAgIH0gZWxzZSBcbiAgICAgICAgLy8gRm9yIG5lc3RlZCBhbmQgbm9uLWVtcHR5IE9iamVjdFZhbHVlcywgYWRkIHRoZSBGaWVsZFBhdGggb2YgdGhlIGxlYWZcbiAgICAgICAgLy8gbm9kZXMuXG4gICAgICAgIHQucHVzaChyKTtcbiAgICB9KSksIG5ldyBGaWVsZE1hc2sodCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBkb2N1bWVudCBpbiBGaXJlc3RvcmUgd2l0aCBhIGtleSwgdmVyc2lvbiwgZGF0YSBhbmQgd2hldGhlciBpdFxuICogaGFzIGxvY2FsIG11dGF0aW9ucyBhcHBsaWVkIHRvIGl0LlxuICpcbiAqIERvY3VtZW50cyBjYW4gdHJhbnNpdGlvbiBiZXR3ZWVuIHN0YXRlcyB2aWEgYGNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQoKWAsXG4gKiBgY29udmVydFRvTm9Eb2N1bWVudCgpYCBhbmQgYGNvbnZlcnRUb1Vua25vd25Eb2N1bWVudCgpYC4gSWYgYSBkb2N1bWVudCBkb2VzXG4gKiBub3QgdHJhbnNpdGlvbiB0byBvbmUgb2YgdGhlc2Ugc3RhdGVzIGV2ZW4gYWZ0ZXIgYWxsIG11dGF0aW9ucyBoYXZlIGJlZW5cbiAqIGFwcGxpZWQsIGBpc1ZhbGlkRG9jdW1lbnQoKWAgcmV0dXJucyBmYWxzZSBhbmQgdGhlIGRvY3VtZW50IHNob3VsZCBiZSByZW1vdmVkXG4gKiBmcm9tIGFsbCB2aWV3cy5cbiAqLyBjbGFzcyBNdXRhYmxlRG9jdW1lbnQge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMsIG8pIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlLCB0aGlzLmRvY3VtZW50VHlwZSA9IHQsIHRoaXMudmVyc2lvbiA9IG4sIHRoaXMucmVhZFRpbWUgPSByLCB0aGlzLmNyZWF0ZVRpbWUgPSBpLCBcbiAgICAgICAgdGhpcy5kYXRhID0gcywgdGhpcy5kb2N1bWVudFN0YXRlID0gbztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGRvY3VtZW50IHdpdGggbm8ga25vd24gdmVyc2lvbiBvciBkYXRhLCBidXQgd2hpY2ggY2FuIHNlcnZlIGFzXG4gICAgICogYmFzZSBkb2N1bWVudCBmb3IgbXV0YXRpb25zLlxuICAgICAqLyAgICBzdGF0aWMgbmV3SW52YWxpZERvY3VtZW50KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBNdXRhYmxlRG9jdW1lbnQoZSwgMCAvKiBEb2N1bWVudFR5cGUuSU5WQUxJRCAqLyAsIFxuICAgICAgICAvKiB2ZXJzaW9uICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXG4gICAgICAgIC8qIHJlYWRUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXG4gICAgICAgIC8qIGNyZWF0ZVRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBPYmplY3RWYWx1ZS5lbXB0eSgpLCAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBkb2N1bWVudCB0aGF0IGlzIGtub3duIHRvIGV4aXN0IHdpdGggdGhlIGdpdmVuIGRhdGEgYXQgdGhlXG4gICAgICogZ2l2ZW4gdmVyc2lvbi5cbiAgICAgKi8gICAgc3RhdGljIG5ld0ZvdW5kRG9jdW1lbnQoZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gbmV3IE11dGFibGVEb2N1bWVudChlLCAxIC8qIERvY3VtZW50VHlwZS5GT1VORF9ET0NVTUVOVCAqLyAsIFxuICAgICAgICAvKiB2ZXJzaW9uICovIHQsIFxuICAgICAgICAvKiByZWFkVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiBjcmVhdGVUaW1lICovIG4sIHIsIDAgLyogRG9jdW1lbnRTdGF0ZS5TWU5DRUQgKi8pO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyBkb2N1bWVudCB0aGF0IGlzIGtub3duIHRvIG5vdCBleGlzdCBhdCB0aGUgZ2l2ZW4gdmVyc2lvbi4gKi8gICAgc3RhdGljIG5ld05vRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IE11dGFibGVEb2N1bWVudChlLCAyIC8qIERvY3VtZW50VHlwZS5OT19ET0NVTUVOVCAqLyAsIFxuICAgICAgICAvKiB2ZXJzaW9uICovIHQsIFxuICAgICAgICAvKiByZWFkVGltZSAqLyBTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiBjcmVhdGVUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgT2JqZWN0VmFsdWUuZW1wdHkoKSwgMCAvKiBEb2N1bWVudFN0YXRlLlNZTkNFRCAqLyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgZG9jdW1lbnQgdGhhdCBpcyBrbm93biB0byBleGlzdCBhdCB0aGUgZ2l2ZW4gdmVyc2lvbiBidXRcbiAgICAgKiB3aG9zZSBkYXRhIGlzIG5vdCBrbm93biAoZS5nLiBhIGRvY3VtZW50IHRoYXQgd2FzIHVwZGF0ZWQgd2l0aG91dCBhIGtub3duXG4gICAgICogYmFzZSBkb2N1bWVudCkuXG4gICAgICovICAgIHN0YXRpYyBuZXdVbmtub3duRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IE11dGFibGVEb2N1bWVudChlLCAzIC8qIERvY3VtZW50VHlwZS5VTktOT1dOX0RPQ1VNRU5UICovICwgXG4gICAgICAgIC8qIHZlcnNpb24gKi8gdCwgXG4gICAgICAgIC8qIHJlYWRUaW1lICovIFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXG4gICAgICAgIC8qIGNyZWF0ZVRpbWUgKi8gU25hcHNob3RWZXJzaW9uLm1pbigpLCBPYmplY3RWYWx1ZS5lbXB0eSgpLCAyIC8qIERvY3VtZW50U3RhdGUuSEFTX0NPTU1JVFRFRF9NVVRBVElPTlMgKi8pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDaGFuZ2VzIHRoZSBkb2N1bWVudCB0eXBlIHRvIGluZGljYXRlIHRoYXQgaXQgZXhpc3RzIGFuZCB0aGF0IGl0cyB2ZXJzaW9uXG4gICAgICogYW5kIGRhdGEgYXJlIGtub3duLlxuICAgICAqLyAgICBjb252ZXJ0VG9Gb3VuZERvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgLy8gSWYgYSBkb2N1bWVudCBpcyBzd2l0Y2hpbmcgc3RhdGUgZnJvbSBiZWluZyBhbiBpbnZhbGlkIG9yIGRlbGV0ZWRcbiAgICAgICAgLy8gZG9jdW1lbnQgdG8gYSB2YWxpZCAoRk9VTkRfRE9DVU1FTlQpIGRvY3VtZW50LCBlaXRoZXIgZHVlIHRvIHJlY2VpdmluZyBhblxuICAgICAgICAvLyB1cGRhdGUgZnJvbSBXYXRjaCBvciBkdWUgdG8gYXBwbHlpbmcgYSBsb2NhbCBzZXQgbXV0YXRpb24gb24gdG9wXG4gICAgICAgIC8vIG9mIGEgZGVsZXRlZCBkb2N1bWVudCwgb3VyIGJlc3QgZ3Vlc3MgYWJvdXQgaXRzIGNyZWF0ZVRpbWUgd291bGQgYmUgdGhlXG4gICAgICAgIC8vIHZlcnNpb24gYXQgd2hpY2ggdGhlIGRvY3VtZW50IHRyYW5zaXRpb25lZCB0byBhIEZPVU5EX0RPQ1VNRU5ULlxuICAgICAgICByZXR1cm4gIXRoaXMuY3JlYXRlVGltZS5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkgfHwgMiAvKiBEb2N1bWVudFR5cGUuTk9fRE9DVU1FTlQgKi8gIT09IHRoaXMuZG9jdW1lbnRUeXBlICYmIDAgLyogRG9jdW1lbnRUeXBlLklOVkFMSUQgKi8gIT09IHRoaXMuZG9jdW1lbnRUeXBlIHx8ICh0aGlzLmNyZWF0ZVRpbWUgPSBlKSwgXG4gICAgICAgIHRoaXMudmVyc2lvbiA9IGUsIHRoaXMuZG9jdW1lbnRUeXBlID0gMSAvKiBEb2N1bWVudFR5cGUuRk9VTkRfRE9DVU1FTlQgKi8gLCB0aGlzLmRhdGEgPSB0LCBcbiAgICAgICAgdGhpcy5kb2N1bWVudFN0YXRlID0gMCAvKiBEb2N1bWVudFN0YXRlLlNZTkNFRCAqLyAsIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGRvY3VtZW50IHR5cGUgdG8gaW5kaWNhdGUgdGhhdCBpdCBkb2Vzbid0IGV4aXN0IGF0IHRoZSBnaXZlblxuICAgICAqIHZlcnNpb24uXG4gICAgICovICAgIGNvbnZlcnRUb05vRG9jdW1lbnQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy52ZXJzaW9uID0gZSwgdGhpcy5kb2N1bWVudFR5cGUgPSAyIC8qIERvY3VtZW50VHlwZS5OT19ET0NVTUVOVCAqLyAsIFxuICAgICAgICB0aGlzLmRhdGEgPSBPYmplY3RWYWx1ZS5lbXB0eSgpLCB0aGlzLmRvY3VtZW50U3RhdGUgPSAwIC8qIERvY3VtZW50U3RhdGUuU1lOQ0VEICovICwgXG4gICAgICAgIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENoYW5nZXMgdGhlIGRvY3VtZW50IHR5cGUgdG8gaW5kaWNhdGUgdGhhdCBpdCBleGlzdHMgYXQgYSBnaXZlbiB2ZXJzaW9uIGJ1dFxuICAgICAqIHRoYXQgaXRzIGRhdGEgaXMgbm90IGtub3duIChlLmcuIGEgZG9jdW1lbnQgdGhhdCB3YXMgdXBkYXRlZCB3aXRob3V0IGEga25vd25cbiAgICAgKiBiYXNlIGRvY3VtZW50KS5cbiAgICAgKi8gICAgY29udmVydFRvVW5rbm93bkRvY3VtZW50KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmVyc2lvbiA9IGUsIHRoaXMuZG9jdW1lbnRUeXBlID0gMyAvKiBEb2N1bWVudFR5cGUuVU5LTk9XTl9ET0NVTUVOVCAqLyAsIFxuICAgICAgICB0aGlzLmRhdGEgPSBPYmplY3RWYWx1ZS5lbXB0eSgpLCB0aGlzLmRvY3VtZW50U3RhdGUgPSAyIC8qIERvY3VtZW50U3RhdGUuSEFTX0NPTU1JVFRFRF9NVVRBVElPTlMgKi8gLCBcbiAgICAgICAgdGhpcztcbiAgICB9XG4gICAgc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kb2N1bWVudFN0YXRlID0gMiAvKiBEb2N1bWVudFN0YXRlLkhBU19DT01NSVRURURfTVVUQVRJT05TICovICwgdGhpcztcbiAgICB9XG4gICAgc2V0SGFzTG9jYWxNdXRhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50U3RhdGUgPSAxIC8qIERvY3VtZW50U3RhdGUuSEFTX0xPQ0FMX01VVEFUSU9OUyAqLyAsIHRoaXMudmVyc2lvbiA9IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgXG4gICAgICAgIHRoaXM7XG4gICAgfVxuICAgIHNldFJlYWRUaW1lKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVhZFRpbWUgPSBlLCB0aGlzO1xuICAgIH1cbiAgICBnZXQgaGFzTG9jYWxNdXRhdGlvbnMoKSB7XG4gICAgICAgIHJldHVybiAxIC8qIERvY3VtZW50U3RhdGUuSEFTX0xPQ0FMX01VVEFUSU9OUyAqLyA9PT0gdGhpcy5kb2N1bWVudFN0YXRlO1xuICAgIH1cbiAgICBnZXQgaGFzQ29tbWl0dGVkTXV0YXRpb25zKCkge1xuICAgICAgICByZXR1cm4gMiAvKiBEb2N1bWVudFN0YXRlLkhBU19DT01NSVRURURfTVVUQVRJT05TICovID09PSB0aGlzLmRvY3VtZW50U3RhdGU7XG4gICAgfVxuICAgIGdldCBoYXNQZW5kaW5nV3JpdGVzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYXNMb2NhbE11dGF0aW9ucyB8fCB0aGlzLmhhc0NvbW1pdHRlZE11dGF0aW9ucztcbiAgICB9XG4gICAgaXNWYWxpZERvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gMCAvKiBEb2N1bWVudFR5cGUuSU5WQUxJRCAqLyAhPT0gdGhpcy5kb2N1bWVudFR5cGU7XG4gICAgfVxuICAgIGlzRm91bmREb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDEgLyogRG9jdW1lbnRUeXBlLkZPVU5EX0RPQ1VNRU5UICovID09PSB0aGlzLmRvY3VtZW50VHlwZTtcbiAgICB9XG4gICAgaXNOb0RvY3VtZW50KCkge1xuICAgICAgICByZXR1cm4gMiAvKiBEb2N1bWVudFR5cGUuTk9fRE9DVU1FTlQgKi8gPT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc1Vua25vd25Eb2N1bWVudCgpIHtcbiAgICAgICAgcmV0dXJuIDMgLyogRG9jdW1lbnRUeXBlLlVOS05PV05fRE9DVU1FTlQgKi8gPT09IHRoaXMuZG9jdW1lbnRUeXBlO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBNdXRhYmxlRG9jdW1lbnQgJiYgdGhpcy5rZXkuaXNFcXVhbChlLmtleSkgJiYgdGhpcy52ZXJzaW9uLmlzRXF1YWwoZS52ZXJzaW9uKSAmJiB0aGlzLmRvY3VtZW50VHlwZSA9PT0gZS5kb2N1bWVudFR5cGUgJiYgdGhpcy5kb2N1bWVudFN0YXRlID09PSBlLmRvY3VtZW50U3RhdGUgJiYgdGhpcy5kYXRhLmlzRXF1YWwoZS5kYXRhKTtcbiAgICB9XG4gICAgbXV0YWJsZUNvcHkoKSB7XG4gICAgICAgIHJldHVybiBuZXcgTXV0YWJsZURvY3VtZW50KHRoaXMua2V5LCB0aGlzLmRvY3VtZW50VHlwZSwgdGhpcy52ZXJzaW9uLCB0aGlzLnJlYWRUaW1lLCB0aGlzLmNyZWF0ZVRpbWUsIHRoaXMuZGF0YS5jbG9uZSgpLCB0aGlzLmRvY3VtZW50U3RhdGUpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIGBEb2N1bWVudCgke3RoaXMua2V5fSwgJHt0aGlzLnZlcnNpb259LCAke0pTT04uc3RyaW5naWZ5KHRoaXMuZGF0YS52YWx1ZSl9LCB7Y3JlYXRlVGltZTogJHt0aGlzLmNyZWF0ZVRpbWV9fSksIHtkb2N1bWVudFR5cGU6ICR7dGhpcy5kb2N1bWVudFR5cGV9fSksIHtkb2N1bWVudFN0YXRlOiAke3RoaXMuZG9jdW1lbnRTdGF0ZX19KWA7XG4gICAgfVxufVxuXG4vKipcbiAqIENvbXBhcmVzIHRoZSB2YWx1ZSBmb3IgZmllbGQgYGZpZWxkYCBpbiB0aGUgcHJvdmlkZWQgZG9jdW1lbnRzLiBUaHJvd3MgaWZcbiAqIHRoZSBmaWVsZCBkb2VzIG5vdCBleGlzdCBpbiBib3RoIGRvY3VtZW50cy5cbiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUmVwcmVzZW50cyBhIGJvdW5kIG9mIGEgcXVlcnkuXG4gKlxuICogVGhlIGJvdW5kIGlzIHNwZWNpZmllZCB3aXRoIHRoZSBnaXZlbiBjb21wb25lbnRzIHJlcHJlc2VudGluZyBhIHBvc2l0aW9uIGFuZFxuICogd2hldGhlciBpdCdzIGp1c3QgYmVmb3JlIG9yIGp1c3QgYWZ0ZXIgdGhlIHBvc2l0aW9uIChyZWxhdGl2ZSB0byB3aGF0ZXZlciB0aGVcbiAqIHF1ZXJ5IG9yZGVyIGlzKS5cbiAqXG4gKiBUaGUgcG9zaXRpb24gcmVwcmVzZW50cyBhIGxvZ2ljYWwgaW5kZXggcG9zaXRpb24gZm9yIGEgcXVlcnkuIEl0J3MgYSBwcmVmaXhcbiAqIG9mIHZhbHVlcyBmb3IgdGhlIChwb3RlbnRpYWxseSBpbXBsaWNpdCkgb3JkZXIgYnkgY2xhdXNlcyBvZiBhIHF1ZXJ5LlxuICpcbiAqIEJvdW5kIHByb3ZpZGVzIGEgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIHdoZXRoZXIgYSBkb2N1bWVudCBjb21lcyBiZWZvcmUgb3JcbiAqIGFmdGVyIGEgYm91bmQuIFRoaXMgaXMgaW5mbHVlbmNlZCBieSB3aGV0aGVyIHRoZSBwb3NpdGlvbiBpcyBqdXN0IGJlZm9yZSBvclxuICoganVzdCBhZnRlciB0aGUgcHJvdmlkZWQgdmFsdWVzLlxuICovXG5jbGFzcyBCb3VuZCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gZSwgdGhpcy5pbmNsdXNpdmUgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2JvdW5kQ29tcGFyZVRvRG9jdW1lbnQoZSwgdCwgbikge1xuICAgIGxldCByID0gMDtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGUucG9zaXRpb24ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcyA9IHRbaV0sIG8gPSBlLnBvc2l0aW9uW2ldO1xuICAgICAgICBpZiAocy5maWVsZC5pc0tleUZpZWxkKCkpIHIgPSBEb2N1bWVudEtleS5jb21wYXJhdG9yKERvY3VtZW50S2V5LmZyb21OYW1lKG8ucmVmZXJlbmNlVmFsdWUpLCBuLmtleSk7IGVsc2Uge1xuICAgICAgICAgICAgciA9IF9fUFJJVkFURV92YWx1ZUNvbXBhcmUobywgbi5kYXRhLmZpZWxkKHMuZmllbGQpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi8gPT09IHMuZGlyICYmIChyICo9IC0xKSwgMCAhPT0gcikgYnJlYWs7XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBhIGRvY3VtZW50IHNvcnRzIGFmdGVyIGEgYm91bmQgdXNpbmcgdGhlIHByb3ZpZGVkIHNvcnRcbiAqIG9yZGVyLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9ib3VuZEVxdWFscyhlLCB0KSB7XG4gICAgaWYgKG51bGwgPT09IGUpIHJldHVybiBudWxsID09PSB0O1xuICAgIGlmIChudWxsID09PSB0KSByZXR1cm4gITE7XG4gICAgaWYgKGUuaW5jbHVzaXZlICE9PSB0LmluY2x1c2l2ZSB8fCBlLnBvc2l0aW9uLmxlbmd0aCAhPT0gdC5wb3NpdGlvbi5sZW5ndGgpIHJldHVybiAhMTtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUucG9zaXRpb24ubGVuZ3RoOyBuKyspIHtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZS5wb3NpdGlvbltuXSwgdC5wb3NpdGlvbltuXSkpIHJldHVybiAhMTtcbiAgICB9XG4gICAgcmV0dXJuICEwO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBvcmRlcmluZyBvbiBhIGZpZWxkLCBpbiBzb21lIERpcmVjdGlvbi4gRGlyZWN0aW9uIGRlZmF1bHRzIHRvIEFTQ0VORElORy5cbiAqLyBjbGFzcyBPcmRlckJ5IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0ID0gXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovKSB7XG4gICAgICAgIHRoaXMuZmllbGQgPSBlLCB0aGlzLmRpciA9IHQ7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfb3JkZXJCeUVxdWFscyhlLCB0KSB7XG4gICAgcmV0dXJuIGUuZGlyID09PSB0LmRpciAmJiBlLmZpZWxkLmlzRXF1YWwodC5maWVsZCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIEZpbHRlciB7fVxuXG5jbGFzcyBGaWVsZEZpbHRlciBleHRlbmRzIEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpZWxkID0gZSwgdGhpcy5vcCA9IHQsIHRoaXMudmFsdWUgPSBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZmlsdGVyIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGUoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gZS5pc0tleUZpZWxkKCkgPyBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IHQgfHwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gPT09IHQgPyB0aGlzLmNyZWF0ZUtleUZpZWxkSW5GaWx0ZXIoZSwgdCwgbikgOiBuZXcgX19QUklWQVRFX0tleUZpZWxkRmlsdGVyKGUsIHQsIG4pIDogXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovID09PSB0ID8gbmV3IF9fUFJJVkFURV9BcnJheUNvbnRhaW5zRmlsdGVyKGUsIG4pIDogXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSB0ID8gbmV3IF9fUFJJVkFURV9JbkZpbHRlcihlLCBuKSA6IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSB0ID8gbmV3IF9fUFJJVkFURV9Ob3RJbkZpbHRlcihlLCBuKSA6IFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovID09PSB0ID8gbmV3IF9fUFJJVkFURV9BcnJheUNvbnRhaW5zQW55RmlsdGVyKGUsIG4pIDogbmV3IEZpZWxkRmlsdGVyKGUsIHQsIG4pO1xuICAgIH1cbiAgICBzdGF0aWMgY3JlYXRlS2V5RmllbGRJbkZpbHRlcihlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IHQgPyBuZXcgX19QUklWQVRFX0tleUZpZWxkSW5GaWx0ZXIoZSwgbikgOiBuZXcgX19QUklWQVRFX0tleUZpZWxkTm90SW5GaWx0ZXIoZSwgbik7XG4gICAgfVxuICAgIG1hdGNoZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5kYXRhLmZpZWxkKHRoaXMuZmllbGQpO1xuICAgICAgICAvLyBUeXBlcyBkbyBub3QgaGF2ZSB0byBtYXRjaCBpbiBOT1RfRVFVQUwgZmlsdGVycy5cbiAgICAgICAgICAgICAgICByZXR1cm4gXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA9PT0gdGhpcy5vcCA/IG51bGwgIT09IHQgJiYgdGhpcy5tYXRjaGVzQ29tcGFyaXNvbihfX1BSSVZBVEVfdmFsdWVDb21wYXJlKHQsIHRoaXMudmFsdWUpKSA6IG51bGwgIT09IHQgJiYgX19QUklWQVRFX3R5cGVPcmRlcih0aGlzLnZhbHVlKSA9PT0gX19QUklWQVRFX3R5cGVPcmRlcih0KSAmJiB0aGlzLm1hdGNoZXNDb21wYXJpc29uKF9fUFJJVkFURV92YWx1ZUNvbXBhcmUodCwgdGhpcy52YWx1ZSkpO1xuICAgICAgICAvLyBPbmx5IGNvbXBhcmUgdHlwZXMgd2l0aCBtYXRjaGluZyBiYWNrZW5kIG9yZGVyIChzdWNoIGFzIGRvdWJsZSBhbmQgaW50KS5cbiAgICAgICAgfVxuICAgIG1hdGNoZXNDb21wYXJpc29uKGUpIHtcbiAgICAgICAgc3dpdGNoICh0aGlzLm9wKSB7XG4gICAgICAgICAgY2FzZSBcIjxcIiAvKiBPcGVyYXRvci5MRVNTX1RIQU4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIGUgPCAwO1xuXG4gICAgICAgICAgY2FzZSBcIjw9XCIgLyogT3BlcmF0b3IuTEVTU19USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICAgIHJldHVybiBlIDw9IDA7XG5cbiAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gMCA9PT0gZTtcblxuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gMCAhPT0gZTtcblxuICAgICAgICAgIGNhc2UgXCI+XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOICovIDpcbiAgICAgICAgICAgIHJldHVybiBlID4gMDtcblxuICAgICAgICAgIGNhc2UgXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gZSA+PSAwO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaXNJbmVxdWFsaXR5KCkge1xuICAgICAgICByZXR1cm4gWyBcIjxcIiAvKiBPcGVyYXRvci5MRVNTX1RIQU4gKi8gLCBcIjw9XCIgLyogT3BlcmF0b3IuTEVTU19USEFOX09SX0VRVUFMICovICwgXCI+XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOICovICwgXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyAsIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyBdLmluZGV4T2YodGhpcy5vcCkgPj0gMDtcbiAgICB9XG4gICAgZ2V0RmxhdHRlbmVkRmlsdGVycygpIHtcbiAgICAgICAgcmV0dXJuIFsgdGhpcyBdO1xuICAgIH1cbiAgICBnZXRGaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gWyB0aGlzIF07XG4gICAgfVxufVxuXG5jbGFzcyBDb21wb3NpdGVGaWx0ZXIgZXh0ZW5kcyBGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maWx0ZXJzID0gZSwgdGhpcy5vcCA9IHQsIHRoaXMuY2UgPSBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgZmlsdGVyIGJhc2VkIG9uIHRoZSBwcm92aWRlZCBhcmd1bWVudHMuXG4gICAgICovICAgIHN0YXRpYyBjcmVhdGUoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IENvbXBvc2l0ZUZpbHRlcihlLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbih0aGlzKSA/IHZvaWQgMCA9PT0gdGhpcy5maWx0ZXJzLmZpbmQoKHQgPT4gIXQubWF0Y2hlcyhlKSkpIDogdm9pZCAwICE9PSB0aGlzLmZpbHRlcnMuZmluZCgodCA9PiB0Lm1hdGNoZXMoZSkpKTtcbiAgICB9XG4gICAgZ2V0RmxhdHRlbmVkRmlsdGVycygpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuY2UgfHwgKHRoaXMuY2UgPSB0aGlzLmZpbHRlcnMucmVkdWNlKCgoZSwgdCkgPT4gZS5jb25jYXQodC5nZXRGbGF0dGVuZWRGaWx0ZXJzKCkpKSwgW10pKSwgXG4gICAgICAgIHRoaXMuY2U7XG4gICAgfVxuICAgIC8vIFJldHVybnMgYSBtdXRhYmxlIGNvcHkgb2YgYHRoaXMuZmlsdGVyc2BcbiAgICBnZXRGaWx0ZXJzKCkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbihbXSwgdGhpcy5maWx0ZXJzKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKGUpIHtcbiAgICByZXR1cm4gXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8gPT09IGUub3A7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Rpc2p1bmN0aW9uKGUpIHtcbiAgICByZXR1cm4gXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovID09PSBlLm9wO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGZpbHRlciBpcyBhIGNvbmp1bmN0aW9uIG9mIGZpZWxkIGZpbHRlcnMgb25seS4gUmV0dXJucyBmYWxzZSBvdGhlcndpc2UuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdENvbmp1bmN0aW9uKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdChlKSAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbihlKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBmaWx0ZXIgZG9lcyBub3QgY29udGFpbiBhbnkgY29tcG9zaXRlIGZpbHRlcnMuIFJldHVybnMgZmFsc2Ugb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0ZsYXQoZSkge1xuICAgIGZvciAoY29uc3QgdCBvZiBlLmZpbHRlcnMpIGlmICh0IGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSByZXR1cm4gITE7XG4gICAgcmV0dXJuICEwO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlGaWx0ZXIoZSkge1xuICAgIGlmIChlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIpIFxuICAgIC8vIFRPRE8oYi8yOTE4MzE2NSk6IFRlY2huaWNhbGx5LCB0aGlzIHdvbid0IGJlIHVuaXF1ZSBpZiB0d28gdmFsdWVzIGhhdmVcbiAgICAvLyB0aGUgc2FtZSBkZXNjcmlwdGlvbiwgc3VjaCBhcyB0aGUgaW50IDMgYW5kIHRoZSBzdHJpbmcgXCIzXCIuIFNvIHdlIHNob3VsZFxuICAgIC8vIGFkZCB0aGUgdHlwZXMgaW4gaGVyZSBzb21laG93LCB0b28uXG4gICAgcmV0dXJuIGUuZmllbGQuY2Fub25pY2FsU3RyaW5nKCkgKyBlLm9wLnRvU3RyaW5nKCkgKyBjYW5vbmljYWxJZChlLnZhbHVlKTtcbiAgICBpZiAoX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdENvbmp1bmN0aW9uKGUpKSBcbiAgICAvLyBPbGRlciBTREsgdmVyc2lvbnMgdXNlIGFuIGltcGxpY2l0IEFORCBvcGVyYXRpb24gYmV0d2VlbiB0aGVpciBmaWx0ZXJzLlxuICAgIC8vIEluIHRoZSBuZXcgU0RLIHZlcnNpb25zLCB0aGUgZGV2ZWxvcGVyIG1heSB1c2UgYW4gZXhwbGljaXQgQU5EIGZpbHRlci5cbiAgICAvLyBUbyBzdGF5IGNvbnNpc3RlbnQgd2l0aCB0aGUgb2xkIHVzYWdlcywgd2UgYWRkIGEgc3BlY2lhbCBjYXNlIHRvIGVuc3VyZVxuICAgIC8vIHRoZSBjYW5vbmljYWwgSUQgZm9yIHRoZXNlIHR3byBhcmUgdGhlIHNhbWUuIEZvciBleGFtcGxlOlxuICAgIC8vIGBjb2wud2hlcmVFcXVhbHMoXCJhXCIsIDEpLndoZXJlRXF1YWxzKFwiYlwiLCAyKWAgc2hvdWxkIGhhdmUgdGhlIHNhbWVcbiAgICAvLyBjYW5vbmljYWwgSUQgYXMgYGNvbC53aGVyZShhbmQoZXF1YWxzKFwiYVwiLDEpLCBlcXVhbHMoXCJiXCIsMikpKWAuXG4gICAgcmV0dXJuIGUuZmlsdGVycy5tYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5RmlsdGVyKGUpKSkuam9pbihcIixcIik7XG4gICAge1xuICAgICAgICAvLyBmaWx0ZXIgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXJcbiAgICAgICAgY29uc3QgdCA9IGUuZmlsdGVycy5tYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5RmlsdGVyKGUpKSkuam9pbihcIixcIik7XG4gICAgICAgIHJldHVybiBgJHtlLm9wfSgke3R9KWA7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmlsdGVyRXF1YWxzKGUsIHQpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkRmlsdGVyRXF1YWxzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHQgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciAmJiBlLm9wID09PSB0Lm9wICYmIGUuZmllbGQuaXNFcXVhbCh0LmZpZWxkKSAmJiBfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZS52YWx1ZSwgdC52YWx1ZSk7XG4gICAgfShlLCB0KSA6IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVyRXF1YWxzKGUsIHQpIHtcbiAgICAgICAgaWYgKHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgJiYgZS5vcCA9PT0gdC5vcCAmJiBlLmZpbHRlcnMubGVuZ3RoID09PSB0LmZpbHRlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICByZXR1cm4gZS5maWx0ZXJzLnJlZHVjZSgoKGUsIG4sIHIpID0+IGUgJiYgX19QUklWQVRFX2ZpbHRlckVxdWFscyhuLCB0LmZpbHRlcnNbcl0pKSwgITApO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMTtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIGEgbmV3IGNvbXBvc2l0ZSBmaWx0ZXIgdGhhdCBjb250YWlucyBhbGwgZmlsdGVyIGZyb21cbiAqIGBjb21wb3NpdGVGaWx0ZXJgIHBsdXMgYWxsIHRoZSBnaXZlbiBmaWx0ZXJzIGluIGBvdGhlckZpbHRlcnNgLlxuICovIChlLCB0KSA6IHZvaWQgZmFpbCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVyV2l0aEFkZGVkRmlsdGVycyhlLCB0KSB7XG4gICAgY29uc3QgbiA9IGUuZmlsdGVycy5jb25jYXQodCk7XG4gICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUobiwgZS5vcCk7XG59XG5cbi8qKiBSZXR1cm5zIGEgZGVidWcgZGVzY3JpcHRpb24gZm9yIGBmaWx0ZXJgLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5RmlsdGVyKGUpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX3N0cmluZ2lmeUZpZWxkRmlsdGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIGAke2UuZmllbGQuY2Fub25pY2FsU3RyaW5nKCl9ICR7ZS5vcH0gJHtjYW5vbmljYWxJZChlLnZhbHVlKX1gO1xuICAgIH1cbiAgICAvKiogRmlsdGVyIHRoYXQgbWF0Y2hlcyBvbiBrZXkgZmllbGRzIChpLmUuICdfX25hbWVfXycpLiAqLyAoZSkgOiBlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX3N0cmluZ2lmeUNvbXBvc2l0ZUZpbHRlcihlKSB7XG4gICAgICAgIHJldHVybiBlLm9wLnRvU3RyaW5nKCkgKyBcIiB7XCIgKyBlLmdldEZpbHRlcnMoKS5tYXAoX19QUklWQVRFX3N0cmluZ2lmeUZpbHRlcikuam9pbihcIiAsXCIpICsgXCJ9XCI7XG4gICAgfShlKSA6IFwiRmlsdGVyXCI7XG59XG5cbmNsYXNzIF9fUFJJVkFURV9LZXlGaWVsZEZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKGUsIHQsIG4pLCB0aGlzLmtleSA9IERvY3VtZW50S2V5LmZyb21OYW1lKG4ucmVmZXJlbmNlVmFsdWUpO1xuICAgIH1cbiAgICBtYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHRoaXMua2V5KTtcbiAgICAgICAgcmV0dXJuIHRoaXMubWF0Y2hlc0NvbXBhcmlzb24odCk7XG4gICAgfVxufVxuXG4vKiogRmlsdGVyIHRoYXQgbWF0Y2hlcyBvbiBrZXkgZmllbGRzIHdpdGhpbiBhbiBhcnJheS4gKi8gY2xhc3MgX19QUklWQVRFX0tleUZpZWxkSW5GaWx0ZXIgZXh0ZW5kcyBGaWVsZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCB0KSwgdGhpcy5rZXlzID0gX19QUklWQVRFX2V4dHJhY3REb2N1bWVudEtleXNGcm9tQXJyYXlWYWx1ZShcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtleXMuc29tZSgodCA9PiB0LmlzRXF1YWwoZS5rZXkpKSk7XG4gICAgfVxufVxuXG4vKiogRmlsdGVyIHRoYXQgbWF0Y2hlcyBvbiBrZXkgZmllbGRzIG5vdCBwcmVzZW50IHdpdGhpbiBhbiBhcnJheS4gKi8gY2xhc3MgX19QUklWQVRFX0tleUZpZWxkTm90SW5GaWx0ZXIgZXh0ZW5kcyBGaWVsZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyAsIHQpLCB0aGlzLmtleXMgPSBfX1BSSVZBVEVfZXh0cmFjdERvY3VtZW50S2V5c0Zyb21BcnJheVZhbHVlKFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovICwgdCk7XG4gICAgfVxuICAgIG1hdGNoZXMoZSkge1xuICAgICAgICByZXR1cm4gIXRoaXMua2V5cy5zb21lKCh0ID0+IHQuaXNFcXVhbChlLmtleSkpKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9leHRyYWN0RG9jdW1lbnRLZXlzRnJvbUFycmF5VmFsdWUoZSwgdCkge1xuICAgIHZhciBuO1xuICAgIHJldHVybiAoKG51bGwgPT09IChuID0gdC5hcnJheVZhbHVlKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLnZhbHVlcykgfHwgW10pLm1hcCgoZSA9PiBEb2N1bWVudEtleS5mcm9tTmFtZShlLnJlZmVyZW5jZVZhbHVlKSkpO1xufVxuXG4vKiogQSBGaWx0ZXIgdGhhdCBpbXBsZW1lbnRzIHRoZSBhcnJheS1jb250YWlucyBvcGVyYXRvci4gKi8gY2xhc3MgX19QUklWQVRFX0FycmF5Q29udGFpbnNGaWx0ZXIgZXh0ZW5kcyBGaWVsZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiBpc0FycmF5KHQpICYmIF9fUFJJVkFURV9hcnJheVZhbHVlQ29udGFpbnModC5hcnJheVZhbHVlLCB0aGlzLnZhbHVlKTtcbiAgICB9XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIElOIG9wZXJhdG9yLiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5GaWx0ZXIgZXh0ZW5kcyBGaWVsZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmRhdGEuZmllbGQodGhpcy5maWVsZCk7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0ICYmIF9fUFJJVkFURV9hcnJheVZhbHVlQ29udGFpbnModGhpcy52YWx1ZS5hcnJheVZhbHVlLCB0KTtcbiAgICB9XG59XG5cbi8qKiBBIEZpbHRlciB0aGF0IGltcGxlbWVudHMgdGhlIG5vdC1pbiBvcGVyYXRvci4gKi8gY2xhc3MgX19QUklWQVRFX05vdEluRmlsdGVyIGV4dGVuZHMgRmllbGRGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoZSwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gLCB0KTtcbiAgICB9XG4gICAgbWF0Y2hlcyhlKSB7XG4gICAgICAgIGlmIChfX1BSSVZBVEVfYXJyYXlWYWx1ZUNvbnRhaW5zKHRoaXMudmFsdWUuYXJyYXlWYWx1ZSwge1xuICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICB9KSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCB0ID0gZS5kYXRhLmZpZWxkKHRoaXMuZmllbGQpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdCAmJiAhX19QUklWQVRFX2FycmF5VmFsdWVDb250YWlucyh0aGlzLnZhbHVlLmFycmF5VmFsdWUsIHQpO1xuICAgIH1cbn1cblxuLyoqIEEgRmlsdGVyIHRoYXQgaW1wbGVtZW50cyB0aGUgYXJyYXktY29udGFpbnMtYW55IG9wZXJhdG9yLiAqLyBjbGFzcyBfX1BSSVZBVEVfQXJyYXlDb250YWluc0FueUZpbHRlciBleHRlbmRzIEZpZWxkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovICwgdCk7XG4gICAgfVxuICAgIG1hdGNoZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5kYXRhLmZpZWxkKHRoaXMuZmllbGQpO1xuICAgICAgICByZXR1cm4gISghaXNBcnJheSh0KSB8fCAhdC5hcnJheVZhbHVlLnZhbHVlcykgJiYgdC5hcnJheVZhbHVlLnZhbHVlcy5zb21lKChlID0+IF9fUFJJVkFURV9hcnJheVZhbHVlQ29udGFpbnModGhpcy52YWx1ZS5hcnJheVZhbHVlLCBlKSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmdcbmNsYXNzIF9fUFJJVkFURV9UYXJnZXRJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0ID0gbnVsbCwgbiA9IFtdLCByID0gW10sIGkgPSBudWxsLCBzID0gbnVsbCwgbyA9IG51bGwpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gZSwgdGhpcy5jb2xsZWN0aW9uR3JvdXAgPSB0LCB0aGlzLm9yZGVyQnkgPSBuLCB0aGlzLmZpbHRlcnMgPSByLCB0aGlzLmxpbWl0ID0gaSwgXG4gICAgICAgIHRoaXMuc3RhcnRBdCA9IHMsIHRoaXMuZW5kQXQgPSBvLCB0aGlzLmxlID0gbnVsbDtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhbGl6ZXMgYSBUYXJnZXQgd2l0aCBhIHBhdGggYW5kIG9wdGlvbmFsIGFkZGl0aW9uYWwgcXVlcnkgY29uc3RyYWludHMuXG4gKiBQYXRoIG11c3QgY3VycmVudGx5IGJlIGVtcHR5IGlmIHRoaXMgaXMgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5LlxuICpcbiAqIE5PVEU6IHlvdSBzaG91bGQgYWx3YXlzIGNvbnN0cnVjdCBgVGFyZ2V0YCBmcm9tIGBRdWVyeS50b1RhcmdldGAgaW5zdGVhZCBvZlxuICogdXNpbmcgdGhpcyBmYWN0b3J5IG1ldGhvZCwgYmVjYXVzZSBgUXVlcnlgIHByb3ZpZGVzIGFuIGltcGxpY2l0IGBvcmRlckJ5YFxuICogcHJvcGVydHkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld1RhcmdldChlLCB0ID0gbnVsbCwgbiA9IFtdLCByID0gW10sIGkgPSBudWxsLCBzID0gbnVsbCwgbyA9IG51bGwpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9UYXJnZXRJbXBsKGUsIHQsIG4sIHIsIGksIHMsIG8pO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGlmIChudWxsID09PSB0LmxlKSB7XG4gICAgICAgIGxldCBlID0gdC5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgICAgICBudWxsICE9PSB0LmNvbGxlY3Rpb25Hcm91cCAmJiAoZSArPSBcInxjZzpcIiArIHQuY29sbGVjdGlvbkdyb3VwKSwgZSArPSBcInxmOlwiLCBlICs9IHQuZmlsdGVycy5tYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5RmlsdGVyKGUpKSkuam9pbihcIixcIiksIFxuICAgICAgICBlICs9IFwifG9iOlwiLCBlICs9IHQub3JkZXJCeS5tYXAoKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX2Nhbm9uaWZ5T3JkZXJCeShlKSB7XG4gICAgICAgICAgICAvLyBUT0RPKGIvMjkxODMxNjUpOiBNYWtlIHRoaXMgY29sbGlzaW9uIHJvYnVzdC5cbiAgICAgICAgICAgIHJldHVybiBlLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpICsgZS5kaXI7XG4gICAgICAgIH0oZSkpKS5qb2luKFwiLFwiKSwgX19QUklWQVRFX2lzTnVsbE9yVW5kZWZpbmVkKHQubGltaXQpIHx8IChlICs9IFwifGw6XCIsIGUgKz0gdC5saW1pdCksIFxuICAgICAgICB0LnN0YXJ0QXQgJiYgKGUgKz0gXCJ8bGI6XCIsIGUgKz0gdC5zdGFydEF0LmluY2x1c2l2ZSA/IFwiYjpcIiA6IFwiYTpcIiwgZSArPSB0LnN0YXJ0QXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBcbiAgICAgICAgdC5lbmRBdCAmJiAoZSArPSBcInx1YjpcIiwgZSArPSB0LmVuZEF0LmluY2x1c2l2ZSA/IFwiYTpcIiA6IFwiYjpcIiwgZSArPSB0LmVuZEF0LnBvc2l0aW9uLm1hcCgoZSA9PiBjYW5vbmljYWxJZChlKSkpLmpvaW4oXCIsXCIpKSwgXG4gICAgICAgIHQubGUgPSBlO1xuICAgIH1cbiAgICByZXR1cm4gdC5sZTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEVxdWFscyhlLCB0KSB7XG4gICAgaWYgKGUubGltaXQgIT09IHQubGltaXQpIHJldHVybiAhMTtcbiAgICBpZiAoZS5vcmRlckJ5Lmxlbmd0aCAhPT0gdC5vcmRlckJ5Lmxlbmd0aCkgcmV0dXJuICExO1xuICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5vcmRlckJ5Lmxlbmd0aDsgbisrKSBpZiAoIV9fUFJJVkFURV9vcmRlckJ5RXF1YWxzKGUub3JkZXJCeVtuXSwgdC5vcmRlckJ5W25dKSkgcmV0dXJuICExO1xuICAgIGlmIChlLmZpbHRlcnMubGVuZ3RoICE9PSB0LmZpbHRlcnMubGVuZ3RoKSByZXR1cm4gITE7XG4gICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmZpbHRlcnMubGVuZ3RoOyBuKyspIGlmICghX19QUklWQVRFX2ZpbHRlckVxdWFscyhlLmZpbHRlcnNbbl0sIHQuZmlsdGVyc1tuXSkpIHJldHVybiAhMTtcbiAgICByZXR1cm4gZS5jb2xsZWN0aW9uR3JvdXAgPT09IHQuY29sbGVjdGlvbkdyb3VwICYmICghIWUucGF0aC5pc0VxdWFsKHQucGF0aCkgJiYgKCEhX19QUklWQVRFX2JvdW5kRXF1YWxzKGUuc3RhcnRBdCwgdC5zdGFydEF0KSAmJiBfX1BSSVZBVEVfYm91bmRFcXVhbHMoZS5lbmRBdCwgdC5lbmRBdCkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldElzRG9jdW1lbnRUYXJnZXQoZSkge1xuICAgIHJldHVybiBEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGUucGF0aCkgJiYgbnVsbCA9PT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgMCA9PT0gZS5maWx0ZXJzLmxlbmd0aDtcbn1cblxuLyoqIFJldHVybnMgdGhlIGZpZWxkIGZpbHRlcnMgdGhhdCB0YXJnZXQgdGhlIGdpdmVuIGZpZWxkIHBhdGguICovIGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXRGaWVsZEZpbHRlcnNGb3JQYXRoKGUsIHQpIHtcbiAgICByZXR1cm4gZS5maWx0ZXJzLmZpbHRlcigoZSA9PiBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgJiYgZS5maWVsZC5pc0VxdWFsKHQpKSk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgdmFsdWVzIHRoYXQgYXJlIHVzZWQgaW4gQVJSQVlfQ09OVEFJTlMgb3IgQVJSQVlfQ09OVEFJTlNfQU5ZXG4gKiBmaWx0ZXJzLiBSZXR1cm5zIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gc3VjaCBmaWx0ZXJzLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIHRvIHVzZSBhcyB0aGUgbG93ZXIgYm91bmQgZm9yIGFzY2VuZGluZyBpbmRleCBzZWdtZW50IGF0XG4gKiB0aGUgcHJvdmlkZWQgYGZpZWxkUGF0aGAgKG9yIHRoZSB1cHBlciBib3VuZCBmb3IgYW4gZGVzY2VuZGluZyBzZWdtZW50KS5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldEFzY2VuZGluZ0JvdW5kKGUsIHQsIG4pIHtcbiAgICBsZXQgciA9IHV0LCBpID0gITA7XG4gICAgLy8gUHJvY2VzcyBhbGwgZmlsdGVycyB0byBmaW5kIGEgdmFsdWUgZm9yIHRoZSBjdXJyZW50IGZpZWxkIHNlZ21lbnRcbiAgICBmb3IgKGNvbnN0IG4gb2YgX19QUklWQVRFX3RhcmdldEdldEZpZWxkRmlsdGVyc0ZvclBhdGgoZSwgdCkpIHtcbiAgICAgICAgbGV0IGUgPSB1dCwgdCA9ICEwO1xuICAgICAgICBzd2l0Y2ggKG4ub3ApIHtcbiAgICAgICAgICBjYXNlIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLyA6XG4gICAgICAgICAgY2FzZSBcIjw9XCIgLyogT3BlcmF0b3IuTEVTU19USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICAgIGUgPSBfX1BSSVZBVEVfdmFsdWVzR2V0TG93ZXJCb3VuZChuLnZhbHVlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICBjYXNlIFwiPj1cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU5fT1JfRVFVQUwgKi8gOlxuICAgICAgICAgICAgZSA9IG4udmFsdWU7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCI+XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOICovIDpcbiAgICAgICAgICAgIGUgPSBuLnZhbHVlLCB0ID0gITE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICBlID0gdXQ7XG4gLy8gUmVtYWluaW5nIGZpbHRlcnMgY2Fubm90IGJlIHVzZWQgYXMgbG93ZXIgYm91bmRzLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgX19QUklWQVRFX2xvd2VyQm91bmRDb21wYXJlKHtcbiAgICAgICAgICAgIHZhbHVlOiByLFxuICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgIH0sIHtcbiAgICAgICAgICAgIHZhbHVlOiBlLFxuICAgICAgICAgICAgaW5jbHVzaXZlOiB0XG4gICAgICAgIH0pIDwgMCAmJiAociA9IGUsIGkgPSB0KTtcbiAgICB9XG4gICAgLy8gSWYgdGhlcmUgaXMgYW4gYWRkaXRpb25hbCBib3VuZCwgY29tcGFyZSB0aGUgdmFsdWVzIGFnYWluc3QgdGhlIGV4aXN0aW5nXG4gICAgLy8gcmFuZ2UgdG8gc2VlIGlmIHdlIGNhbiBuYXJyb3cgdGhlIHNjb3BlLlxuICAgICAgICBpZiAobnVsbCAhPT0gbikgZm9yIChsZXQgcyA9IDA7IHMgPCBlLm9yZGVyQnkubGVuZ3RoOyArK3MpIHtcbiAgICAgICAgaWYgKGUub3JkZXJCeVtzXS5maWVsZC5pc0VxdWFsKHQpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbi5wb3NpdGlvbltzXTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9sb3dlckJvdW5kQ29tcGFyZSh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IHIsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgICAgICAgICB9LCB7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGUsXG4gICAgICAgICAgICAgICAgaW5jbHVzaXZlOiBuLmluY2x1c2l2ZVxuICAgICAgICAgICAgfSkgPCAwICYmIChyID0gZSwgaSA9IG4uaW5jbHVzaXZlKTtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiByLFxuICAgICAgICBpbmNsdXNpdmU6IGlcbiAgICB9O1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIHZhbHVlIHRvIHVzZSBhcyB0aGUgdXBwZXIgYm91bmQgZm9yIGFzY2VuZGluZyBpbmRleCBzZWdtZW50IGF0XG4gKiB0aGUgcHJvdmlkZWQgYGZpZWxkUGF0aGAgKG9yIHRoZSBsb3dlciBib3VuZCBmb3IgYSBkZXNjZW5kaW5nIHNlZ21lbnQpLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXREZXNjZW5kaW5nQm91bmQoZSwgdCwgbikge1xuICAgIGxldCByID0gb3QsIGkgPSAhMDtcbiAgICAvLyBQcm9jZXNzIGFsbCBmaWx0ZXJzIHRvIGZpbmQgYSB2YWx1ZSBmb3IgdGhlIGN1cnJlbnQgZmllbGQgc2VnbWVudFxuICAgIGZvciAoY29uc3QgbiBvZiBfX1BSSVZBVEVfdGFyZ2V0R2V0RmllbGRGaWx0ZXJzRm9yUGF0aChlLCB0KSkge1xuICAgICAgICBsZXQgZSA9IG90LCB0ID0gITA7XG4gICAgICAgIHN3aXRjaCAobi5vcCkge1xuICAgICAgICAgIGNhc2UgXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLyA6XG4gICAgICAgICAgY2FzZSBcIj5cIiAvKiBPcGVyYXRvci5HUkVBVEVSX1RIQU4gKi8gOlxuICAgICAgICAgICAgZSA9IF9fUFJJVkFURV92YWx1ZXNHZXRVcHBlckJvdW5kKG4udmFsdWUpLCB0ID0gITE7XG4gICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgIGNhc2UgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovIDpcbiAgICAgICAgICBjYXNlIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA6XG4gICAgICAgICAgY2FzZSBcIjw9XCIgLyogT3BlcmF0b3IuTEVTU19USEFOX09SX0VRVUFMICovIDpcbiAgICAgICAgICAgIGUgPSBuLnZhbHVlO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLyA6XG4gICAgICAgICAgICBlID0gbi52YWx1ZSwgdCA9ICExO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gOlxuICAgICAgICAgIGNhc2UgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gOlxuICAgICAgICAgICAgZSA9IG90O1xuIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGNhbm5vdCBiZSB1c2VkIGFzIHVwcGVyIGJvdW5kcy5cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgIF9fUFJJVkFURV91cHBlckJvdW5kQ29tcGFyZSh7XG4gICAgICAgICAgICB2YWx1ZTogcixcbiAgICAgICAgICAgIGluY2x1c2l2ZTogaVxuICAgICAgICB9LCB7XG4gICAgICAgICAgICB2YWx1ZTogZSxcbiAgICAgICAgICAgIGluY2x1c2l2ZTogdFxuICAgICAgICB9KSA+IDAgJiYgKHIgPSBlLCBpID0gdCk7XG4gICAgfVxuICAgIC8vIElmIHRoZXJlIGlzIGFuIGFkZGl0aW9uYWwgYm91bmQsIGNvbXBhcmUgdGhlIHZhbHVlcyBhZ2FpbnN0IHRoZSBleGlzdGluZ1xuICAgIC8vIHJhbmdlIHRvIHNlZSBpZiB3ZSBjYW4gbmFycm93IHRoZSBzY29wZS5cbiAgICAgICAgaWYgKG51bGwgIT09IG4pIGZvciAobGV0IHMgPSAwOyBzIDwgZS5vcmRlckJ5Lmxlbmd0aDsgKytzKSB7XG4gICAgICAgIGlmIChlLm9yZGVyQnlbc10uZmllbGQuaXNFcXVhbCh0KSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IG4ucG9zaXRpb25bc107XG4gICAgICAgICAgICBfX1BSSVZBVEVfdXBwZXJCb3VuZENvbXBhcmUoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiByLFxuICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogaVxuICAgICAgICAgICAgfSwge1xuICAgICAgICAgICAgICAgIHZhbHVlOiBlLFxuICAgICAgICAgICAgICAgIGluY2x1c2l2ZTogbi5pbmNsdXNpdmVcbiAgICAgICAgICAgIH0pID4gMCAmJiAociA9IGUsIGkgPSBuLmluY2x1c2l2ZSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICB2YWx1ZTogcixcbiAgICAgICAgaW5jbHVzaXZlOiBpXG4gICAgfTtcbn1cblxuLyoqIFJldHVybnMgdGhlIG51bWJlciBvZiBzZWdtZW50cyBvZiBhIHBlcmZlY3QgaW5kZXggZm9yIHRoaXMgdGFyZ2V0LiAqL1xuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUXVlcnkgZW5jYXBzdWxhdGVzIGFsbCB0aGUgcXVlcnkgYXR0cmlidXRlcyB3ZSBzdXBwb3J0IGluIHRoZSBTREsuIEl0IGNhblxuICogYmUgcnVuIGFnYWluc3QgdGhlIExvY2FsU3RvcmUsIGFzIHdlbGwgYXMgYmUgY29udmVydGVkIHRvIGEgYFRhcmdldGAgdG9cbiAqIHF1ZXJ5IHRoZSBSZW1vdGVTdG9yZSByZXN1bHRzLlxuICpcbiAqIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9RdWVyeUltcGwge1xuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIGEgUXVlcnkgd2l0aCBhIHBhdGggYW5kIG9wdGlvbmFsIGFkZGl0aW9uYWwgcXVlcnkgY29uc3RyYWludHMuXG4gICAgICogUGF0aCBtdXN0IGN1cnJlbnRseSBiZSBlbXB0eSBpZiB0aGlzIGlzIGEgY29sbGVjdGlvbiBncm91cCBxdWVyeS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0ID0gbnVsbCwgbiA9IFtdLCByID0gW10sIGkgPSBudWxsLCBzID0gXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovICwgbyA9IG51bGwsIF8gPSBudWxsKSB7XG4gICAgICAgIHRoaXMucGF0aCA9IGUsIHRoaXMuY29sbGVjdGlvbkdyb3VwID0gdCwgdGhpcy5leHBsaWNpdE9yZGVyQnkgPSBuLCB0aGlzLmZpbHRlcnMgPSByLCBcbiAgICAgICAgdGhpcy5saW1pdCA9IGksIHRoaXMubGltaXRUeXBlID0gcywgdGhpcy5zdGFydEF0ID0gbywgdGhpcy5lbmRBdCA9IF8sIHRoaXMuaGUgPSBudWxsLCBcbiAgICAgICAgLy8gVGhlIGNvcnJlc3BvbmRpbmcgYFRhcmdldGAgb2YgdGhpcyBgUXVlcnlgIGluc3RhbmNlLCBmb3IgdXNlIHdpdGhcbiAgICAgICAgLy8gbm9uLWFnZ3JlZ2F0ZSBxdWVyaWVzLlxuICAgICAgICB0aGlzLlBlID0gbnVsbCwgXG4gICAgICAgIC8vIFRoZSBjb3JyZXNwb25kaW5nIGBUYXJnZXRgIG9mIHRoaXMgYFF1ZXJ5YCBpbnN0YW5jZSwgZm9yIHVzZSB3aXRoXG4gICAgICAgIC8vIGFnZ3JlZ2F0ZSBxdWVyaWVzLiBVbmxpa2UgdGFyZ2V0cyBmb3Igbm9uLWFnZ3JlZ2F0ZSBxdWVyaWVzLFxuICAgICAgICAvLyBhZ2dyZWdhdGUgcXVlcnkgdGFyZ2V0cyBkbyBub3QgY29udGFpbiBub3JtYWxpemVkIG9yZGVyLWJ5cywgdGhleSBvbmx5XG4gICAgICAgIC8vIGNvbnRhaW4gZXhwbGljaXQgb3JkZXItYnlzLlxuICAgICAgICB0aGlzLlRlID0gbnVsbCwgdGhpcy5zdGFydEF0LCB0aGlzLmVuZEF0O1xuICAgIH1cbn1cblxuLyoqIENyZWF0ZXMgYSBuZXcgUXVlcnkgaW5zdGFuY2Ugd2l0aCB0aGUgb3B0aW9ucyBwcm92aWRlZC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5KGUsIHQsIG4sIHIsIGksIHMsIG8sIF8pIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZSwgdCwgbiwgciwgaSwgcywgbywgXyk7XG59XG5cbi8qKiBDcmVhdGVzIGEgbmV3IFF1ZXJ5IGZvciBhIHF1ZXJ5IHRoYXQgbWF0Y2hlcyBhbGwgZG9jdW1lbnRzIGF0IGBwYXRoYCAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlGb3JQYXRoKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZSk7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGNvbnZlcnQgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5IGludG8gYSBjb2xsZWN0aW9uIHF1ZXJ5IGF0IGFcbiAqIHNwZWNpZmljIHBhdGguIFRoaXMgaXMgdXNlZCB3aGVuIGV4ZWN1dGluZyBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJpZXMsIHNpbmNlXG4gKiB3ZSBoYXZlIHRvIHNwbGl0IHRoZSBxdWVyeSBpbnRvIGEgc2V0IG9mIGNvbGxlY3Rpb24gcXVlcmllcyBhdCBtdWx0aXBsZVxuICogcGF0aHMuXG4gKi9cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoaXMgcXVlcnkgZG9lcyBub3Qgc3BlY2lmeSBhbnkgcXVlcnkgY29uc3RyYWludHMgdGhhdFxuICogY291bGQgcmVtb3ZlIHJlc3VsdHMuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXNBbGxEb2N1bWVudHMoZSkge1xuICAgIHJldHVybiAwID09PSBlLmZpbHRlcnMubGVuZ3RoICYmIG51bGwgPT09IGUubGltaXQgJiYgbnVsbCA9PSBlLnN0YXJ0QXQgJiYgbnVsbCA9PSBlLmVuZEF0ICYmICgwID09PSBlLmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggfHwgMSA9PT0gZS5leHBsaWNpdE9yZGVyQnkubGVuZ3RoICYmIGUuZXhwbGljaXRPcmRlckJ5WzBdLmZpZWxkLmlzS2V5RmllbGQoKSk7XG59XG5cbi8vIFJldHVybnMgdGhlIHNvcnRlZCBzZXQgb2YgaW5lcXVhbGl0eSBmaWx0ZXIgZmllbGRzIHVzZWQgaW4gdGhpcyBxdWVyeS5cbi8qKlxuICogUmV0dXJucyB3aGV0aGVyIHRoZSBxdWVyeSBtYXRjaGVzIGEgY29sbGVjdGlvbiBncm91cCByYXRoZXIgdGhhbiBhIHNwZWNpZmljXG4gKiBjb2xsZWN0aW9uLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfaXNDb2xsZWN0aW9uR3JvdXBRdWVyeShlKSB7XG4gICAgcmV0dXJuIG51bGwgIT09IGUuY29sbGVjdGlvbkdyb3VwO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIG5vcm1hbGl6ZWQgb3JkZXItYnkgY29uc3RyYWludCB0aGF0IGlzIHVzZWQgdG8gZXhlY3V0ZSB0aGUgUXVlcnksXG4gKiB3aGljaCBjYW4gYmUgZGlmZmVyZW50IGZyb20gdGhlIG9yZGVyLWJ5IGNvbnN0cmFpbnRzIHRoZSB1c2VyIHByb3ZpZGVkIChlLmcuXG4gKiB0aGUgU0RLIGFuZCBiYWNrZW5kIGFsd2F5cyBvcmRlcnMgYnkgYF9fbmFtZV9fYCkuIFRoZSBub3JtYWxpemVkIG9yZGVyLWJ5XG4gKiBpbmNsdWRlcyBpbXBsaWNpdCBvcmRlci1ieXMgaW4gYWRkaXRpb24gdG8gdGhlIGV4cGxpY2l0IHVzZXIgcHJvdmlkZWRcbiAqIG9yZGVyLWJ5cy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlOb3JtYWxpemVkT3JkZXJCeShlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgaWYgKG51bGwgPT09IHQuaGUpIHtcbiAgICAgICAgdC5oZSA9IFtdO1xuICAgICAgICBjb25zdCBlID0gbmV3IFNldDtcbiAgICAgICAgLy8gQW55IGV4cGxpY2l0IG9yZGVyIGJ5IGZpZWxkcyBzaG91bGQgYmUgYWRkZWQgYXMgaXMuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHQuZXhwbGljaXRPcmRlckJ5KSB0LmhlLnB1c2gobiksIGUuYWRkKG4uZmllbGQuY2Fub25pY2FsU3RyaW5nKCkpO1xuICAgICAgICAvLyBUaGUgb3JkZXIgb2YgdGhlIGltcGxpY2l0IG9yZGVyaW5nIGFsd2F5cyBtYXRjaGVzIHRoZSBsYXN0IGV4cGxpY2l0IG9yZGVyIGJ5LlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSB0LmV4cGxpY2l0T3JkZXJCeS5sZW5ndGggPiAwID8gdC5leHBsaWNpdE9yZGVyQnlbdC5leHBsaWNpdE9yZGVyQnkubGVuZ3RoIC0gMV0uZGlyIDogXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovICwgciA9IGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRJbmVxdWFsaXR5RmlsdGVyRmllbGRzKGUpIHtcbiAgICAgICAgICAgIGxldCB0ID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICAgICAgICAgIHJldHVybiBlLmZpbHRlcnMuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgZS5nZXRGbGF0dGVuZWRGaWx0ZXJzKCkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGUuaXNJbmVxdWFsaXR5KCkgJiYgKHQgPSB0LmFkZChlLmZpZWxkKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfSkpLCB0O1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQ3JlYXRlcyBhIG5ldyBRdWVyeSBmb3IgYSBjb2xsZWN0aW9uIGdyb3VwIHF1ZXJ5IHRoYXQgbWF0Y2hlcyBhbGwgZG9jdW1lbnRzXG4gKiB3aXRoaW4gdGhlIHByb3ZpZGVkIGNvbGxlY3Rpb24gZ3JvdXAuXG4gKi8gKHQpO1xuICAgICAgICAvLyBBbnkgaW5lcXVhbGl0eSBmaWVsZHMgbm90IGV4cGxpY2l0bHkgb3JkZXJlZCBzaG91bGQgYmUgaW1wbGljaXRseSBvcmRlcmVkIGluIGEgbGV4aWNvZ3JhcGhpY2FsXG4gICAgICAgIC8vIG9yZGVyLiBXaGVuIHRoZXJlIGFyZSBtdWx0aXBsZSBpbmVxdWFsaXR5IGZpbHRlcnMgb24gdGhlIHNhbWUgZmllbGQsIHRoZSBmaWVsZCBzaG91bGQgYmUgYWRkZWRcbiAgICAgICAgLy8gb25seSBvbmNlLlxuICAgICAgICAvLyBOb3RlOiBgU29ydGVkU2V0PEZpZWxkUGF0aD5gIHNvcnRzIHRoZSBrZXkgZmllbGQgYmVmb3JlIG90aGVyIGZpZWxkcy4gSG93ZXZlciwgd2Ugd2FudCB0aGUga2V5XG4gICAgICAgIC8vIGZpZWxkIHRvIGJlIHNvcnRlZCBsYXN0LlxuICAgICAgICAgICAgICAgIHIuZm9yRWFjaCgociA9PiB7XG4gICAgICAgICAgICBlLmhhcyhyLmNhbm9uaWNhbFN0cmluZygpKSB8fCByLmlzS2V5RmllbGQoKSB8fCB0LmhlLnB1c2gobmV3IE9yZGVyQnkociwgbikpO1xuICAgICAgICB9KSksIFxuICAgICAgICAvLyBBZGQgdGhlIGRvY3VtZW50IGtleSBmaWVsZCB0byB0aGUgbGFzdCBpZiBpdCBpcyBub3QgZXhwbGljaXRseSBvcmRlcmVkLlxuICAgICAgICBlLmhhcyhGaWVsZFBhdGgkMS5rZXlGaWVsZCgpLmNhbm9uaWNhbFN0cmluZygpKSB8fCB0LmhlLnB1c2gobmV3IE9yZGVyQnkoRmllbGRQYXRoJDEua2V5RmllbGQoKSwgbikpO1xuICAgIH1cbiAgICByZXR1cm4gdC5oZTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyB0aGlzIGBRdWVyeWAgaW5zdGFuY2UgdG8gaXRzIGNvcnJlc3BvbmRpbmcgYFRhcmdldGAgcmVwcmVzZW50YXRpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LlBlIHx8ICh0LlBlID0gX19QUklWQVRFX19xdWVyeVRvVGFyZ2V0KHQsIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpKSksIFxuICAgIHQuUGU7XG59XG5cbi8qKlxuICogQ29udmVydHMgdGhpcyBgUXVlcnlgIGluc3RhbmNlIHRvIGl0cyBjb3JyZXNwb25kaW5nIGBUYXJnZXRgIHJlcHJlc2VudGF0aW9uLFxuICogZm9yIHVzZSB3aXRoaW4gYW4gYWdncmVnYXRlIHF1ZXJ5LiBVbmxpa2UgdGFyZ2V0cyBmb3Igbm9uLWFnZ3JlZ2F0ZSBxdWVyaWVzLFxuICogYWdncmVnYXRlIHF1ZXJ5IHRhcmdldHMgZG8gbm90IGNvbnRhaW4gbm9ybWFsaXplZCBvcmRlci1ieXMsIHRoZXkgb25seVxuICogY29udGFpbiBleHBsaWNpdCBvcmRlci1ieXMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3F1ZXJ5VG9BZ2dyZWdhdGVUYXJnZXQoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LlRlIHx8IChcbiAgICAvLyBEbyBub3QgaW5jbHVkZSBpbXBsaWNpdCBvcmRlci1ieXMgZm9yIGFnZ3JlZ2F0ZSBxdWVyaWVzLlxuICAgIHQuVGUgPSBfX1BSSVZBVEVfX3F1ZXJ5VG9UYXJnZXQodCwgZS5leHBsaWNpdE9yZGVyQnkpKSwgdC5UZTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX19xdWVyeVRvVGFyZ2V0KGUsIHQpIHtcbiAgICBpZiAoXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovID09PSBlLmxpbWl0VHlwZSkgcmV0dXJuIF9fUFJJVkFURV9uZXdUYXJnZXQoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgdCwgZS5maWx0ZXJzLCBlLmxpbWl0LCBlLnN0YXJ0QXQsIGUuZW5kQXQpO1xuICAgIHtcbiAgICAgICAgLy8gRmxpcCB0aGUgb3JkZXJCeSBkaXJlY3Rpb25zIHNpbmNlIHdlIHdhbnQgdGhlIGxhc3QgcmVzdWx0c1xuICAgICAgICB0ID0gdC5tYXAoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgdCA9IFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovID09PSBlLmRpciA/IFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLyA6IFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBPcmRlckJ5KGUuZmllbGQsIHQpO1xuICAgICAgICB9KSk7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gc3dhcCB0aGUgY3Vyc29ycyB0byBtYXRjaCB0aGUgbm93LWZsaXBwZWQgcXVlcnkgb3JkZXJpbmcuXG4gICAgICAgIGNvbnN0IG4gPSBlLmVuZEF0ID8gbmV3IEJvdW5kKGUuZW5kQXQucG9zaXRpb24sIGUuZW5kQXQuaW5jbHVzaXZlKSA6IG51bGwsIHIgPSBlLnN0YXJ0QXQgPyBuZXcgQm91bmQoZS5zdGFydEF0LnBvc2l0aW9uLCBlLnN0YXJ0QXQuaW5jbHVzaXZlKSA6IG51bGw7XG4gICAgICAgIC8vIE5vdyByZXR1cm4gYXMgYSBMaW1pdFR5cGUuRmlyc3QgcXVlcnkuXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbmV3VGFyZ2V0KGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIHQsIGUuZmlsdGVycywgZS5saW1pdCwgbiwgcik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlXaXRoQWRkZWRGaWx0ZXIoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBlLmZpbHRlcnMuY29uY2F0KFsgdCBdKTtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgbiwgZS5saW1pdCwgZS5saW1pdFR5cGUsIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhMaW1pdChlLCB0LCBuKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUXVlcnlJbXBsKGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIGUuZXhwbGljaXRPcmRlckJ5LnNsaWNlKCksIGUuZmlsdGVycy5zbGljZSgpLCB0LCBuLCBlLnN0YXJ0QXQsIGUuZW5kQXQpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlFcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KGUpLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KSkgJiYgZS5saW1pdFR5cGUgPT09IHQubGltaXRUeXBlO1xufVxuXG4vLyBUT0RPKGIvMjkxODMxNjUpOiBUaGlzIGlzIHVzZWQgdG8gZ2V0IGEgdW5pcXVlIHN0cmluZyBmcm9tIGEgcXVlcnkgdG8sIGZvclxuLy8gZXhhbXBsZSwgdXNlIGFzIGEgZGljdGlvbmFyeSBrZXksIGJ1dCB0aGUgaW1wbGVtZW50YXRpb24gaXMgc3ViamVjdCB0b1xuLy8gY29sbGlzaW9ucy4gTWFrZSBpdCBjb2xsaXNpb24tZnJlZS5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYW5vbmlmeVF1ZXJ5KGUpIHtcbiAgICByZXR1cm4gYCR7X19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KGUpKX18bHQ6JHtlLmxpbWl0VHlwZX1gO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkoZSkge1xuICAgIHJldHVybiBgUXVlcnkodGFyZ2V0PSR7ZnVuY3Rpb24gX19QUklWQVRFX3N0cmluZ2lmeVRhcmdldChlKSB7XG4gICAgICAgIGxldCB0ID0gZS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgKHQgKz0gXCIgY29sbGVjdGlvbkdyb3VwPVwiICsgZS5jb2xsZWN0aW9uR3JvdXApLCBcbiAgICAgICAgZS5maWx0ZXJzLmxlbmd0aCA+IDAgJiYgKHQgKz0gYCwgZmlsdGVyczogWyR7ZS5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfc3RyaW5naWZ5RmlsdGVyKGUpKSkuam9pbihcIiwgXCIpfV1gKSwgXG4gICAgICAgIF9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZChlLmxpbWl0KSB8fCAodCArPSBcIiwgbGltaXQ6IFwiICsgZS5saW1pdCksIGUub3JkZXJCeS5sZW5ndGggPiAwICYmICh0ICs9IGAsIG9yZGVyQnk6IFske2Uub3JkZXJCeS5tYXAoKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX3N0cmluZ2lmeU9yZGVyQnkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGAke2UuZmllbGQuY2Fub25pY2FsU3RyaW5nKCl9ICgke2UuZGlyfSlgO1xuICAgICAgICB9KGUpKSkuam9pbihcIiwgXCIpfV1gKSwgZS5zdGFydEF0ICYmICh0ICs9IFwiLCBzdGFydEF0OiBcIiwgdCArPSBlLnN0YXJ0QXQuaW5jbHVzaXZlID8gXCJiOlwiIDogXCJhOlwiLCBcbiAgICAgICAgdCArPSBlLnN0YXJ0QXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBlLmVuZEF0ICYmICh0ICs9IFwiLCBlbmRBdDogXCIsIFxuICAgICAgICB0ICs9IGUuZW5kQXQuaW5jbHVzaXZlID8gXCJhOlwiIDogXCJiOlwiLCB0ICs9IGUuZW5kQXQucG9zaXRpb24ubWFwKChlID0+IGNhbm9uaWNhbElkKGUpKSkuam9pbihcIixcIikpLCBcbiAgICAgICAgYFRhcmdldCgke3R9KWA7XG4gICAgfShfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChlKSl9OyBsaW1pdFR5cGU9JHtlLmxpbWl0VHlwZX0pYDtcbn1cblxuLyoqIFJldHVybnMgd2hldGhlciBgZG9jYCBtYXRjaGVzIHRoZSBjb25zdHJhaW50cyBvZiBgcXVlcnlgLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzKGUsIHQpIHtcbiAgICByZXR1cm4gdC5pc0ZvdW5kRG9jdW1lbnQoKSAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzUGF0aEFuZENvbGxlY3Rpb25Hcm91cChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LmtleS5wYXRoO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gZS5jb2xsZWN0aW9uR3JvdXAgPyB0LmtleS5oYXNDb2xsZWN0aW9uSWQoZS5jb2xsZWN0aW9uR3JvdXApICYmIGUucGF0aC5pc1ByZWZpeE9mKG4pIDogRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShlLnBhdGgpID8gZS5wYXRoLmlzRXF1YWwobikgOiBlLnBhdGguaXNJbW1lZGlhdGVQYXJlbnRPZihuKTtcbiAgICB9XG4gICAgLyoqXG4gKiBBIGRvY3VtZW50IG11c3QgaGF2ZSBhIHZhbHVlIGZvciBldmVyeSBvcmRlcmluZyBjbGF1c2UgaW4gb3JkZXIgdG8gc2hvdyB1cFxuICogaW4gdGhlIHJlc3VsdHMuXG4gKi8gKGUsIHQpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXNPcmRlckJ5KGUsIHQpIHtcbiAgICAgICAgLy8gV2UgbXVzdCB1c2UgYHF1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoKWAgdG8gZ2V0IHRoZSBsaXN0IG9mIGFsbCBvcmRlckJ5cyAoYm90aCBpbXBsaWNpdCBhbmQgZXhwbGljaXQpLlxuICAgICAgICAvLyBOb3RlIHRoYXQgZm9yIE9SIHF1ZXJpZXMsIG9yZGVyQnkgYXBwbGllcyB0byBhbGwgZGlzanVuY3Rpb24gdGVybXMgYW5kIGltcGxpY2l0IG9yZGVyQnlzIG11c3RcbiAgICAgICAgLy8gYmUgdGFrZW4gaW50byBhY2NvdW50LiBGb3IgZXhhbXBsZSwgdGhlIHF1ZXJ5IFwiYSA+IDEgfHwgYj09MVwiIGhhcyBhbiBpbXBsaWNpdCBcIm9yZGVyQnkgYVwiIGR1ZVxuICAgICAgICAvLyB0byB0aGUgaW5lcXVhbGl0eSwgYW5kIGlzIGV2YWx1YXRlZCBhcyBcImEgPiAxIG9yZGVyQnkgYSB8fCBiPT0xIG9yZGVyQnkgYVwiLlxuICAgICAgICAvLyBBIGRvY3VtZW50IHdpdGggY29udGVudCBvZiB7YjoxfSBtYXRjaGVzIHRoZSBmaWx0ZXJzLCBidXQgZG9lcyBub3QgbWF0Y2ggdGhlIG9yZGVyQnkgYmVjYXVzZVxuICAgICAgICAvLyBpdCdzIG1pc3NpbmcgdGhlIGZpZWxkICdhJy5cbiAgICAgICAgZm9yIChjb25zdCBuIG9mIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpKSBcbiAgICAgICAgLy8gb3JkZXItYnkga2V5IGFsd2F5cyBtYXRjaGVzXG4gICAgICAgIGlmICghbi5maWVsZC5pc0tleUZpZWxkKCkgJiYgbnVsbCA9PT0gdC5kYXRhLmZpZWxkKG4uZmllbGQpKSByZXR1cm4gITE7XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9KGUsIHQpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXNGaWx0ZXJzKGUsIHQpIHtcbiAgICAgICAgZm9yIChjb25zdCBuIG9mIGUuZmlsdGVycykgaWYgKCFuLm1hdGNoZXModCkpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICAvKiogTWFrZXMgc3VyZSBhIGRvY3VtZW50IGlzIHdpdGhpbiB0aGUgYm91bmRzLCBpZiBwcm92aWRlZC4gKi8gKGUsIHQpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeU1hdGNoZXNCb3VuZHMoZSwgdCkge1xuICAgICAgICBpZiAoZS5zdGFydEF0ICYmICFcbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgYSBkb2N1bWVudCBzb3J0cyBiZWZvcmUgYSBib3VuZCB1c2luZyB0aGUgcHJvdmlkZWQgc29ydFxuICogb3JkZXIuXG4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2JvdW5kU29ydHNCZWZvcmVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2JvdW5kQ29tcGFyZVRvRG9jdW1lbnQoZSwgdCwgbik7XG4gICAgICAgICAgICByZXR1cm4gZS5pbmNsdXNpdmUgPyByIDw9IDAgOiByIDwgMDtcbiAgICAgICAgfShlLnN0YXJ0QXQsIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpLCB0KSkgcmV0dXJuICExO1xuICAgICAgICBpZiAoZS5lbmRBdCAmJiAhZnVuY3Rpb24gX19QUklWQVRFX2JvdW5kU29ydHNBZnRlckRvY3VtZW50KGUsIHQsIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfYm91bmRDb21wYXJlVG9Eb2N1bWVudChlLCB0LCBuKTtcbiAgICAgICAgICAgIHJldHVybiBlLmluY2x1c2l2ZSA/IHIgPj0gMCA6IHIgPiAwO1xuICAgICAgICB9KGUuZW5kQXQsIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpLCB0KSkgcmV0dXJuICExO1xuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIC8qKlxuICogUmV0dXJucyB0aGUgY29sbGVjdGlvbiBncm91cCB0aGF0IHRoaXMgcXVlcnkgdGFyZ2V0cy5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGluIHRoZSBXZWIgU0RLIHRvIGZhY2lsaXRhdGUgbXVsdGktdGFiXG4gKiBzeW5jaHJvbml6YXRpb24gZm9yIHF1ZXJ5IHJlc3VsdHMuXG4gKi8gKGUsIHQpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcXVlcnlDb2xsZWN0aW9uR3JvdXAoZSkge1xuICAgIHJldHVybiBlLmNvbGxlY3Rpb25Hcm91cCB8fCAoZS5wYXRoLmxlbmd0aCAlIDIgPT0gMSA/IGUucGF0aC5sYXN0U2VnbWVudCgpIDogZS5wYXRoLmdldChlLnBhdGgubGVuZ3RoIC0gMikpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBuZXcgY29tcGFyYXRvciBmdW5jdGlvbiB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXBhcmUgdHdvIGRvY3VtZW50c1xuICogYmFzZWQgb24gdGhlIFF1ZXJ5J3Mgb3JkZXJpbmcgY29uc3RyYWludC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlDb21wYXJhdG9yKGUpIHtcbiAgICByZXR1cm4gKHQsIG4pID0+IHtcbiAgICAgICAgbGV0IHIgPSAhMTtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIF9fUFJJVkFURV9xdWVyeU5vcm1hbGl6ZWRPcmRlckJ5KGUpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX2NvbXBhcmVEb2NzKGksIHQsIG4pO1xuICAgICAgICAgICAgaWYgKDAgIT09IGUpIHJldHVybiBlO1xuICAgICAgICAgICAgciA9IHIgfHwgaS5maWVsZC5pc0tleUZpZWxkKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVEb2NzKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gZS5maWVsZC5pc0tleUZpZWxkKCkgPyBEb2N1bWVudEtleS5jb21wYXJhdG9yKHQua2V5LCBuLmtleSkgOiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZURvY3VtZW50c0J5RmllbGQoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gdC5kYXRhLmZpZWxkKGUpLCBpID0gbi5kYXRhLmZpZWxkKGUpO1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gciAmJiBudWxsICE9PSBpID8gX19QUklWQVRFX3ZhbHVlQ29tcGFyZShyLCBpKSA6IGZhaWwoKTtcbiAgICB9KGUuZmllbGQsIHQsIG4pO1xuICAgIHN3aXRjaCAoZS5kaXIpIHtcbiAgICAgIGNhc2UgXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovIDpcbiAgICAgICAgcmV0dXJuIHI7XG5cbiAgICAgIGNhc2UgXCJkZXNjXCIgLyogRGlyZWN0aW9uLkRFU0NFTkRJTkcgKi8gOlxuICAgICAgICByZXR1cm4gLTEgKiByO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBtYXAgaW1wbGVtZW50YXRpb24gdGhhdCB1c2VzIG9iamVjdHMgYXMga2V5cy4gT2JqZWN0cyBtdXN0IGhhdmUgYW5cbiAqIGFzc29jaWF0ZWQgZXF1YWxzIGZ1bmN0aW9uIGFuZCBtdXN0IGJlIGltbXV0YWJsZS4gRW50cmllcyBpbiB0aGUgbWFwIGFyZVxuICogc3RvcmVkIHRvZ2V0aGVyIHdpdGggdGhlIGtleSBiZWluZyBwcm9kdWNlZCBmcm9tIHRoZSBtYXBLZXlGbi4gVGhpcyBtYXBcbiAqIGF1dG9tYXRpY2FsbHkgaGFuZGxlcyBjb2xsaXNpb25zIG9mIGtleXMuXG4gKi8gY2xhc3MgT2JqZWN0TWFwIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMubWFwS2V5Rm4gPSBlLCB0aGlzLmVxdWFsc0ZuID0gdCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgaW5uZXIgbWFwIGZvciBhIGtleS92YWx1ZSBwYWlyLiBEdWUgdG8gdGhlIHBvc3NpYmlsaXR5IG9mIGNvbGxpc2lvbnMgd2VcbiAgICAgICAgICoga2VlcCBhIGxpc3Qgb2YgZW50cmllcyB0aGF0IHdlIGRvIGEgbGluZWFyIHNlYXJjaCB0aHJvdWdoIHRvIGZpbmQgYW4gYWN0dWFsXG4gICAgICAgICAqIG1hdGNoLiBOb3RlIHRoYXQgY29sbGlzaW9ucyBzaG91bGQgYmUgcmFyZSwgc28gd2Ugc3RpbGwgZXhwZWN0IG5lYXJcbiAgICAgICAgICogY29uc3RhbnQgdGltZSBsb29rdXBzIGluIHByYWN0aWNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5pbm5lciA9IHt9LCBcbiAgICAgICAgLyoqIFRoZSBudW1iZXIgb2YgZW50cmllcyBzdG9yZWQgaW4gdGhlIG1hcCAqL1xuICAgICAgICB0aGlzLmlubmVyU2l6ZSA9IDA7XG4gICAgfVxuICAgIC8qKiBHZXQgYSB2YWx1ZSBmb3IgdGhpcyBrZXksIG9yIHVuZGVmaW5lZCBpZiBpdCBkb2VzIG5vdCBleGlzdC4gKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMubWFwS2V5Rm4oZSksIG4gPSB0aGlzLmlubmVyW3RdO1xuICAgICAgICBpZiAodm9pZCAwICE9PSBuKSBmb3IgKGNvbnN0IFt0LCByXSBvZiBuKSBpZiAodGhpcy5lcXVhbHNGbih0LCBlKSkgcmV0dXJuIHI7XG4gICAgfVxuICAgIGhhcyhlKSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHRoaXMuZ2V0KGUpO1xuICAgIH1cbiAgICAvKiogUHV0IHRoaXMga2V5IGFuZCB2YWx1ZSBpbiB0aGUgbWFwLiAqLyAgICBzZXQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5tYXBLZXlGbihlKSwgciA9IHRoaXMuaW5uZXJbbl07XG4gICAgICAgIGlmICh2b2lkIDAgPT09IHIpIHJldHVybiB0aGlzLmlubmVyW25dID0gWyBbIGUsIHQgXSBdLCB2b2lkIHRoaXMuaW5uZXJTaXplKys7XG4gICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgci5sZW5ndGg7IG4rKykgaWYgKHRoaXMuZXF1YWxzRm4ocltuXVswXSwgZSkpIFxuICAgICAgICAvLyBUaGlzIGlzIHVwZGF0aW5nIGFuIGV4aXN0aW5nIGVudHJ5IGFuZCBkb2VzIG5vdCBpbmNyZWFzZSBgaW5uZXJTaXplYC5cbiAgICAgICAgcmV0dXJuIHZvaWQgKHJbbl0gPSBbIGUsIHQgXSk7XG4gICAgICAgIHIucHVzaChbIGUsIHQgXSksIHRoaXMuaW5uZXJTaXplKys7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZSB0aGlzIGtleSBmcm9tIHRoZSBtYXAuIFJldHVybnMgYSBib29sZWFuIGlmIGFueXRoaW5nIHdhcyBkZWxldGVkLlxuICAgICAqLyAgICBkZWxldGUoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5tYXBLZXlGbihlKSwgbiA9IHRoaXMuaW5uZXJbdF07XG4gICAgICAgIGlmICh2b2lkIDAgPT09IG4pIHJldHVybiAhMTtcbiAgICAgICAgZm9yIChsZXQgciA9IDA7IHIgPCBuLmxlbmd0aDsgcisrKSBpZiAodGhpcy5lcXVhbHNGbihuW3JdWzBdLCBlKSkgcmV0dXJuIDEgPT09IG4ubGVuZ3RoID8gZGVsZXRlIHRoaXMuaW5uZXJbdF0gOiBuLnNwbGljZShyLCAxKSwgXG4gICAgICAgIHRoaXMuaW5uZXJTaXplLS0sICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGZvckVhY2goZSkge1xuICAgICAgICBmb3JFYWNoKHRoaXMuaW5uZXIsICgodCwgbikgPT4ge1xuICAgICAgICAgICAgZm9yIChjb25zdCBbdCwgcl0gb2YgbikgZSh0LCByKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gaXNFbXB0eSh0aGlzLmlubmVyKTtcbiAgICB9XG4gICAgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5uZXJTaXplO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgbHQgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCkge1xuICAgIHJldHVybiBsdDtcbn1cblxuY29uc3QgaHQgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuXG5mdW5jdGlvbiBkb2N1bWVudE1hcCguLi5lKSB7XG4gICAgbGV0IHQgPSBodDtcbiAgICBmb3IgKGNvbnN0IG4gb2YgZSkgdCA9IHQuaW5zZXJ0KG4ua2V5LCBuKTtcbiAgICByZXR1cm4gdDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbnZlcnRPdmVybGF5ZWREb2N1bWVudE1hcFRvRG9jdW1lbnRNYXAoZSkge1xuICAgIGxldCB0ID0gaHQ7XG4gICAgcmV0dXJuIGUuZm9yRWFjaCgoKGUsIG4pID0+IHQgPSB0Lmluc2VydChlLCBuLm92ZXJsYXllZERvY3VtZW50KSkpLCB0O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9uZXdNdXRhdGlvbk1hcCgpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9uZXdEb2N1bWVudEtleU1hcCgpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdE1hcCgoZSA9PiBlLnRvU3RyaW5nKCkpLCAoKGUsIHQpID0+IGUuaXNFcXVhbCh0KSkpO1xufVxuXG5jb25zdCBQdCA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG5cbmNvbnN0IFR0ID0gbmV3IFNvcnRlZFNldChEb2N1bWVudEtleS5jb21wYXJhdG9yKTtcblxuZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KC4uLmUpIHtcbiAgICBsZXQgdCA9IFR0O1xuICAgIGZvciAoY29uc3QgbiBvZiBlKSB0ID0gdC5hZGQobik7XG4gICAgcmV0dXJuIHQ7XG59XG5cbmNvbnN0IEl0ID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcik7XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRJZFNldCgpIHtcbiAgICByZXR1cm4gSXQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYW4gRG91YmxlVmFsdWUgZm9yIGB2YWx1ZWAgdGhhdCBpcyBlbmNvZGVkIGJhc2VkIHRoZSBzZXJpYWxpemVyJ3NcbiAqIGB1c2VQcm90bzNKc29uYCBzZXR0aW5nLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV90b0RvdWJsZShlLCB0KSB7XG4gICAgaWYgKGUudXNlUHJvdG8zSnNvbikge1xuICAgICAgICBpZiAoaXNOYU4odCkpIHJldHVybiB7XG4gICAgICAgICAgICBkb3VibGVWYWx1ZTogXCJOYU5cIlxuICAgICAgICB9O1xuICAgICAgICBpZiAodCA9PT0gMSAvIDApIHJldHVybiB7XG4gICAgICAgICAgICBkb3VibGVWYWx1ZTogXCJJbmZpbml0eVwiXG4gICAgICAgIH07XG4gICAgICAgIGlmICh0ID09PSAtMSAvIDApIHJldHVybiB7XG4gICAgICAgICAgICBkb3VibGVWYWx1ZTogXCItSW5maW5pdHlcIlxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBkb3VibGVWYWx1ZTogX19QUklWQVRFX2lzTmVnYXRpdmVaZXJvKHQpID8gXCItMFwiIDogdFxuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhbiBJbnRlZ2VyVmFsdWUgZm9yIGB2YWx1ZWAuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RvSW50ZWdlcihlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW50ZWdlclZhbHVlOiBcIlwiICsgZVxuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHZhbHVlIGZvciBhIG51bWJlciB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGludG8gYSBwcm90by5cbiAqIFRoZSByZXR1cm4gdmFsdWUgaXMgYW4gSW50ZWdlclZhbHVlIGlmIGl0IGNhbiBzYWZlbHkgcmVwcmVzZW50IHRoZSB2YWx1ZSxcbiAqIG90aGVyd2lzZSBhIERvdWJsZVZhbHVlIGlzIHJldHVybmVkLlxuICovIGZ1bmN0aW9uIHRvTnVtYmVyKGUsIHQpIHtcbiAgICByZXR1cm4gaXNTYWZlSW50ZWdlcih0KSA/IF9fUFJJVkFURV90b0ludGVnZXIodCkgOiBfX1BSSVZBVEVfdG9Eb3VibGUoZSwgdCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogVXNlZCB0byByZXByZXNlbnQgYSBmaWVsZCB0cmFuc2Zvcm0gb24gYSBtdXRhdGlvbi4gKi8gY2xhc3MgVHJhbnNmb3JtT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLy8gTWFrZSBzdXJlIHRoYXQgdGhlIHN0cnVjdHVyYWwgdHlwZSBvZiBgVHJhbnNmb3JtT3BlcmF0aW9uYCBpcyB1bmlxdWUuXG4gICAgICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzU0NTFcbiAgICAgICAgdGhpcy5fID0gdm9pZCAwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDb21wdXRlcyB0aGUgbG9jYWwgdHJhbnNmb3JtIHJlc3VsdCBhZ2FpbnN0IHRoZSBwcm92aWRlZCBgcHJldmlvdXNWYWx1ZWAsXG4gKiBvcHRpb25hbGx5IHVzaW5nIHRoZSBwcm92aWRlZCBsb2NhbFdyaXRlVGltZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlUcmFuc2Zvcm1PcGVyYXRpb25Ub0xvY2FsVmlldyhlLCB0LCBuKSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wVHJhbnNmb3JtID8gZnVuY3Rpb24gc2VydmVyVGltZXN0YW1wJDEoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0ge1xuICAgICAgICAgICAgZmllbGRzOiB7XG4gICAgICAgICAgICAgICAgW2V0XToge1xuICAgICAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogWGVcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFtudF06IHtcbiAgICAgICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlY29uZHM6IGUuc2Vjb25kcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIG5hbm9zOiBlLm5hbm9zZWNvbmRzXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIC8vIFdlIHNob3VsZCBhdm9pZCBzdG9yaW5nIGRlZXBseSBuZXN0ZWQgc2VydmVyIHRpbWVzdGFtcCBtYXAgdmFsdWVzXG4gICAgICAgIC8vIGJlY2F1c2Ugd2UgbmV2ZXIgdXNlIHRoZSBpbnRlcm1lZGlhdGUgXCJwcmV2aW91cyB2YWx1ZXNcIi5cbiAgICAgICAgLy8gRm9yIGV4YW1wbGU6XG4gICAgICAgIC8vIHByZXZpb3VzOiA0MkwsIGFkZDogdDEsIHJlc3VsdDogdDEgLT4gNDJMXG4gICAgICAgIC8vIHByZXZpb3VzOiB0MSwgIGFkZDogdDIsIHJlc3VsdDogdDIgLT4gNDJMIChOT1QgdDIgLT4gdDEgLT4gNDJMKVxuICAgICAgICAvLyBwcmV2aW91czogdDIsICBhZGQ6IHQzLCByZXN1bHQ6IHQzIC0+IDQyTCAoTk9UIHQzIC0+IHQyIC0+IHQxIC0+IDQyTClcbiAgICAgICAgLy8gYGdldFByZXZpb3VzVmFsdWVgIHJlY3Vyc2l2ZWx5IHRyYXZlcnNlcyBzZXJ2ZXIgdGltZXN0YW1wcyB0byBmaW5kIHRoZVxuICAgICAgICAvLyBsZWFzdCByZWNlbnQgVmFsdWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHQgJiYgX19QUklWQVRFX2lzU2VydmVyVGltZXN0YW1wKHQpICYmICh0ID0gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUodCkpLCBcbiAgICAgICAgdCAmJiAobi5maWVsZHNbdHRdID0gdCksIHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiBuXG4gICAgICAgIH07XG4gICAgfShuLCB0KSA6IGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbiA/IF9fUFJJVkFURV9hcHBseUFycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24oZSwgdCkgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uID8gX19QUklWQVRFX2FwcGx5QXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24oZSwgdCkgOiBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlOdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uVG9Mb2NhbFZpZXcoZSwgdCkge1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IFNpbmNlIEphdmFTY3JpcHQncyBpbnRlZ2VyIGFyaXRobWV0aWMgaXMgbGltaXRlZCB0byA1MyBiaXRcbiAgICAgICAgLy8gcHJlY2lzaW9uIGFuZCByZXNvbHZlcyBvdmVyZmxvd3MgYnkgcmVkdWNpbmcgcHJlY2lzaW9uLCB3ZSBkbyBub3RcbiAgICAgICAgLy8gbWFudWFsbHkgY2FwIG92ZXJmbG93cyBhdCAyXjYzLlxuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2NvbXB1dGVUcmFuc2Zvcm1PcGVyYXRpb25CYXNlVmFsdWUoZSwgdCksIHIgPSBhc051bWJlcihuKSArIGFzTnVtYmVyKGUuSWUpO1xuICAgICAgICByZXR1cm4gaXNJbnRlZ2VyKG4pICYmIGlzSW50ZWdlcihlLkllKSA/IF9fUFJJVkFURV90b0ludGVnZXIocikgOiBfX1BSSVZBVEVfdG9Eb3VibGUoZS5zZXJpYWxpemVyLCByKTtcbiAgICB9KGUsIHQpO1xufVxuXG4vKipcbiAqIENvbXB1dGVzIGEgZmluYWwgdHJhbnNmb3JtIHJlc3VsdCBhZnRlciB0aGUgdHJhbnNmb3JtIGhhcyBiZWVuIGFja25vd2xlZGdlZFxuICogYnkgdGhlIHNlcnZlciwgcG90ZW50aWFsbHkgdXNpbmcgdGhlIHNlcnZlci1wcm92aWRlZCB0cmFuc2Zvcm1SZXN1bHQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5VHJhbnNmb3JtT3BlcmF0aW9uVG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgLy8gVGhlIHNlcnZlciBqdXN0IHNlbmRzIG51bGwgYXMgdGhlIHRyYW5zZm9ybSByZXN1bHQgZm9yIGFycmF5IG9wZXJhdGlvbnMsXG4gICAgLy8gc28gd2UgaGF2ZSB0byBjYWxjdWxhdGUgYSByZXN1bHQgdGhlIHNhbWUgYXMgd2UgZG8gZm9yIGxvY2FsXG4gICAgLy8gYXBwbGljYXRpb25zLlxuICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfYXBwbHlBcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbiA/IF9fUFJJVkFURV9hcHBseUFycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIDogbjtcbn1cblxuLyoqXG4gKiBJZiB0aGlzIHRyYW5zZm9ybSBvcGVyYXRpb24gaXMgbm90IGlkZW1wb3RlbnQsIHJldHVybnMgdGhlIGJhc2UgdmFsdWUgdG9cbiAqIHBlcnNpc3QgZm9yIHRoaXMgdHJhbnNmb3JtLiBJZiBhIGJhc2UgdmFsdWUgaXMgcmV0dXJuZWQsIHRoZSB0cmFuc2Zvcm1cbiAqIG9wZXJhdGlvbiBpcyBhbHdheXMgYXBwbGllZCB0byB0aGlzIGJhc2UgdmFsdWUsIGV2ZW4gaWYgZG9jdW1lbnQgaGFzXG4gKiBhbHJlYWR5IGJlZW4gdXBkYXRlZC5cbiAqXG4gKiBCYXNlIHZhbHVlcyBwcm92aWRlIGNvbnNpc3RlbnQgYmVoYXZpb3IgZm9yIG5vbi1pZGVtcG90ZW50IHRyYW5zZm9ybXMgYW5kXG4gKiBhbGxvdyB1cyB0byByZXR1cm4gdGhlIHNhbWUgbGF0ZW5jeS1jb21wZW5zYXRlZCB2YWx1ZSBldmVuIGlmIHRoZSBiYWNrZW5kXG4gKiBoYXMgYWxyZWFkeSBhcHBsaWVkIHRoZSB0cmFuc2Zvcm0gb3BlcmF0aW9uLiBUaGUgYmFzZSB2YWx1ZSBpcyBudWxsIGZvclxuICogaWRlbXBvdGVudCB0cmFuc2Zvcm1zLCBhcyB0aGV5IGNhbiBiZSByZS1wbGF5ZWQgZXZlbiBpZiB0aGUgYmFja2VuZCBoYXNcbiAqIGFscmVhZHkgYXBwbGllZCB0aGVtLlxuICpcbiAqIEByZXR1cm5zIGEgYmFzZSB2YWx1ZSB0byBzdG9yZSBhbG9uZyB3aXRoIHRoZSBtdXRhdGlvbiwgb3IgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgdHJhbnNmb3Jtcy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcHV0ZVRyYW5zZm9ybU9wZXJhdGlvbkJhc2VWYWx1ZShlLCB0KSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbiA/IFxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgYHZhbHVlYCBpcyBlaXRoZXIgYW4gSW50ZWdlclZhbHVlIG9yIGEgRG91YmxlVmFsdWUuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2lzTnVtYmVyKGUpIHtcbiAgICAgICAgcmV0dXJuIGlzSW50ZWdlcihlKSB8fCBmdW5jdGlvbiBfX1BSSVZBVEVfaXNEb3VibGUoZSkge1xuICAgICAgICAgICAgcmV0dXJuICEhZSAmJiBcImRvdWJsZVZhbHVlXCIgaW4gZTtcbiAgICAgICAgfShlKTtcbiAgICB9KHQpID8gdCA6IHtcbiAgICAgICAgaW50ZWdlclZhbHVlOiAwXG4gICAgfSA6IG51bGw7XG59XG5cbi8qKiBUcmFuc2Zvcm1zIGEgdmFsdWUgaW50byBhIHNlcnZlci1nZW5lcmF0ZWQgdGltZXN0YW1wLiAqL1xuY2xhc3MgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSBleHRlbmRzIFRyYW5zZm9ybU9wZXJhdGlvbiB7fVxuXG4vKiogVHJhbnNmb3JtcyBhbiBhcnJheSB2YWx1ZSB2aWEgYSB1bmlvbiBvcGVyYXRpb24uICovIGNsYXNzIF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuZWxlbWVudHMgPSBlO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5QXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9jb2VyY2VkRmllbGRWYWx1ZXNBcnJheSh0KTtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZS5lbGVtZW50cykgbi5zb21lKChlID0+IF9fUFJJVkFURV92YWx1ZUVxdWFscyhlLCB0KSkpIHx8IG4ucHVzaCh0KTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKiBUcmFuc2Zvcm1zIGFuIGFycmF5IHZhbHVlIHZpYSBhIHJlbW92ZSBvcGVyYXRpb24uICovIGNsYXNzIF9fUFJJVkFURV9BcnJheVJlbW92ZVRyYW5zZm9ybU9wZXJhdGlvbiBleHRlbmRzIFRyYW5zZm9ybU9wZXJhdGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmVsZW1lbnRzID0gZTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseUFycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKGUsIHQpIHtcbiAgICBsZXQgbiA9IF9fUFJJVkFURV9jb2VyY2VkRmllbGRWYWx1ZXNBcnJheSh0KTtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZS5lbGVtZW50cykgbiA9IG4uZmlsdGVyKChlID0+ICFfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZSwgdCkpKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBhcnJheVZhbHVlOiB7XG4gICAgICAgICAgICB2YWx1ZXM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbi8qKlxuICogSW1wbGVtZW50cyB0aGUgYmFja2VuZCBzZW1hbnRpY3MgZm9yIGxvY2FsbHkgY29tcHV0ZWQgTlVNRVJJQ19BREQgKGluY3JlbWVudClcbiAqIHRyYW5zZm9ybXMuIENvbnZlcnRzIGFsbCBmaWVsZCB2YWx1ZXMgdG8gaW50ZWdlcnMgb3IgZG91YmxlcywgYnV0IHVubGlrZSB0aGVcbiAqIGJhY2tlbmQgZG9lcyBub3QgY2FwIGludGVnZXIgdmFsdWVzIGF0IDJeNjMuIEluc3RlYWQsIEphdmFTY3JpcHQgbnVtYmVyXG4gKiBhcml0aG1ldGljIGlzIHVzZWQgYW5kIHByZWNpc2lvbiBsb3NzIGNhbiBvY2N1ciBmb3IgdmFsdWVzIGdyZWF0ZXIgdGhhbiAyXjUzLlxuICovIGNsYXNzIF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uIGV4dGVuZHMgVHJhbnNmb3JtT3BlcmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuc2VyaWFsaXplciA9IGUsIHRoaXMuSWUgPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gYXNOdW1iZXIoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUuaW50ZWdlclZhbHVlIHx8IGUuZG91YmxlVmFsdWUpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29lcmNlZEZpZWxkVmFsdWVzQXJyYXkoZSkge1xuICAgIHJldHVybiBpc0FycmF5KGUpICYmIGUuYXJyYXlWYWx1ZS52YWx1ZXMgPyBlLmFycmF5VmFsdWUudmFsdWVzLnNsaWNlKCkgOiBbXTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBBIGZpZWxkIHBhdGggYW5kIHRoZSBUcmFuc2Zvcm1PcGVyYXRpb24gdG8gcGVyZm9ybSB1cG9uIGl0LiAqLyBjbGFzcyBGaWVsZFRyYW5zZm9ybSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmZpZWxkID0gZSwgdGhpcy50cmFuc2Zvcm0gPSB0O1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkVHJhbnNmb3JtRXF1YWxzKGUsIHQpIHtcbiAgICByZXR1cm4gZS5maWVsZC5pc0VxdWFsKHQuZmllbGQpICYmIGZ1bmN0aW9uIF9fUFJJVkFURV90cmFuc2Zvcm1PcGVyYXRpb25FcXVhbHMoZSwgdCkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uICYmIHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbiB8fCBlIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uICYmIHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfYXJyYXlFcXVhbHMoZS5lbGVtZW50cywgdC5lbGVtZW50cywgX19QUklWQVRFX3ZhbHVlRXF1YWxzKSA6IGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbiAmJiB0IGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRUcmFuc2Zvcm1PcGVyYXRpb24gPyBfX1BSSVZBVEVfdmFsdWVFcXVhbHMoZS5JZSwgdC5JZSkgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSAmJiB0IGluc3RhbmNlb2YgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybTtcbiAgICB9KGUudHJhbnNmb3JtLCB0LnRyYW5zZm9ybSk7XG59XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHN1Y2Nlc3NmdWxseSBhcHBseWluZyBhIG11dGF0aW9uIHRvIHRoZSBiYWNrZW5kLiAqL1xuY2xhc3MgTXV0YXRpb25SZXN1bHQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSB2ZXJzaW9uIGF0IHdoaWNoIHRoZSBtdXRhdGlvbiB3YXMgY29tbWl0dGVkOlxuICAgICAqXG4gICAgICogLSBGb3IgbW9zdCBvcGVyYXRpb25zLCB0aGlzIGlzIHRoZSB1cGRhdGVUaW1lIGluIHRoZSBXcml0ZVJlc3VsdC5cbiAgICAgKiAtIEZvciBkZWxldGVzLCB0aGUgY29tbWl0VGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSAoYmVjYXVzZSBkZWxldGVzIGFyZVxuICAgICAqICAgbm90IHN0b3JlZCBhbmQgaGF2ZSBubyB1cGRhdGVUaW1lKS5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCB0aGVzZSB2ZXJzaW9ucyBjYW4gYmUgZGlmZmVyZW50OiBOby1vcCB3cml0ZXMgd2lsbCBub3QgY2hhbmdlXG4gICAgICogdGhlIHVwZGF0ZVRpbWUgZXZlbiB0aG91Z2ggdGhlIGNvbW1pdFRpbWUgYWR2YW5jZXMuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIHJlc3VsdGluZyBmaWVsZHMgcmV0dXJuZWQgZnJvbSB0aGUgYmFja2VuZCBhZnRlciBhIG11dGF0aW9uXG4gICAgICogY29udGFpbmluZyBmaWVsZCB0cmFuc2Zvcm1zIGhhcyBiZWVuIGNvbW1pdHRlZC4gQ29udGFpbnMgb25lIEZpZWxkVmFsdWVcbiAgICAgKiBmb3IgZWFjaCBGaWVsZFRyYW5zZm9ybSB0aGF0IHdhcyBpbiB0aGUgbXV0YXRpb24uXG4gICAgICpcbiAgICAgKiBXaWxsIGJlIGVtcHR5IGlmIHRoZSBtdXRhdGlvbiBkaWQgbm90IGNvbnRhaW4gYW55IGZpZWxkIHRyYW5zZm9ybXMuXG4gICAgICovXG4gICAgdCkge1xuICAgICAgICB0aGlzLnZlcnNpb24gPSBlLCB0aGlzLnRyYW5zZm9ybVJlc3VsdHMgPSB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBFbmNvZGVzIGEgcHJlY29uZGl0aW9uIGZvciBhIG11dGF0aW9uLiBUaGlzIGZvbGxvd3MgdGhlIG1vZGVsIHRoYXQgdGhlXG4gKiBiYWNrZW5kIGFjY2VwdHMgd2l0aCB0aGUgc3BlY2lhbCBjYXNlIG9mIGFuIGV4cGxpY2l0IFwiZW1wdHlcIiBwcmVjb25kaXRpb25cbiAqIChtZWFuaW5nIG5vIHByZWNvbmRpdGlvbikuXG4gKi8gY2xhc3MgUHJlY29uZGl0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMudXBkYXRlVGltZSA9IGUsIHRoaXMuZXhpc3RzID0gdDtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgZW1wdHkgUHJlY29uZGl0aW9uLiAqLyAgICBzdGF0aWMgbm9uZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmVjb25kaXRpb247XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IFByZWNvbmRpdGlvbiB3aXRoIGFuIGV4aXN0cyBmbGFnLiAqLyAgICBzdGF0aWMgZXhpc3RzKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcmVjb25kaXRpb24odm9pZCAwLCBlKTtcbiAgICB9XG4gICAgLyoqIENyZWF0ZXMgYSBuZXcgUHJlY29uZGl0aW9uIGJhc2VkIG9uIGEgdmVyc2lvbiBhIGRvY3VtZW50IGV4aXN0cyBhdC4gKi8gICAgc3RhdGljIHVwZGF0ZVRpbWUoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFByZWNvbmRpdGlvbihlKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgd2hldGhlciB0aGlzIFByZWNvbmRpdGlvbiBpcyBlbXB0eS4gKi8gICAgZ2V0IGlzTm9uZSgpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCA9PT0gdGhpcy51cGRhdGVUaW1lICYmIHZvaWQgMCA9PT0gdGhpcy5leGlzdHM7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5leGlzdHMgPT09IGUuZXhpc3RzICYmICh0aGlzLnVwZGF0ZVRpbWUgPyAhIWUudXBkYXRlVGltZSAmJiB0aGlzLnVwZGF0ZVRpbWUuaXNFcXVhbChlLnVwZGF0ZVRpbWUpIDogIWUudXBkYXRlVGltZSk7XG4gICAgfVxufVxuXG4vKiogUmV0dXJucyB0cnVlIGlmIHRoZSBwcmVjb25kaXRpb25zIGlzIHZhbGlkIGZvciB0aGUgZ2l2ZW4gZG9jdW1lbnQuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wcmVjb25kaXRpb25Jc1ZhbGlkRm9yRG9jdW1lbnQoZSwgdCkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IGUudXBkYXRlVGltZSA/IHQuaXNGb3VuZERvY3VtZW50KCkgJiYgdC52ZXJzaW9uLmlzRXF1YWwoZS51cGRhdGVUaW1lKSA6IHZvaWQgMCA9PT0gZS5leGlzdHMgfHwgZS5leGlzdHMgPT09IHQuaXNGb3VuZERvY3VtZW50KCk7XG59XG5cbi8qKlxuICogQSBtdXRhdGlvbiBkZXNjcmliZXMgYSBzZWxmLWNvbnRhaW5lZCBjaGFuZ2UgdG8gYSBkb2N1bWVudC4gTXV0YXRpb25zIGNhblxuICogY3JlYXRlLCByZXBsYWNlLCBkZWxldGUsIGFuZCB1cGRhdGUgc3Vic2V0cyBvZiBkb2N1bWVudHMuXG4gKlxuICogTXV0YXRpb25zIG5vdCBvbmx5IGFjdCBvbiB0aGUgdmFsdWUgb2YgdGhlIGRvY3VtZW50IGJ1dCBhbHNvIGl0cyB2ZXJzaW9uLlxuICpcbiAqIEZvciBsb2NhbCBtdXRhdGlvbnMgKG11dGF0aW9ucyB0aGF0IGhhdmVuJ3QgYmVlbiBjb21taXR0ZWQgeWV0KSwgd2UgcHJlc2VydmVcbiAqIHRoZSBleGlzdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gRm9yIERlbGV0ZSBtdXRhdGlvbnMsIHdlXG4gKiByZXNldCB0aGUgdmVyc2lvbiB0byAwLlxuICpcbiAqIEhlcmUncyB0aGUgZXhwZWN0ZWQgdHJhbnNpdGlvbiB0YWJsZS5cbiAqXG4gKiBNVVRBVElPTiAgICAgICAgICAgQVBQTElFRCBUTyAgICAgICAgICAgIFJFU1VMVFMgSU5cbiAqXG4gKiBTZXRNdXRhdGlvbiAgICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogU2V0TXV0YXRpb24gICAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBEb2N1bWVudCh2MClcbiAqIFNldE11dGF0aW9uICAgICAgICBJbnZhbGlkRG9jdW1lbnQodjApICAgRG9jdW1lbnQodjApXG4gKiBQYXRjaE11dGF0aW9uICAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIERvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIE5vRG9jdW1lbnQodjMpICAgICAgICBOb0RvY3VtZW50KHYzKVxuICogUGF0Y2hNdXRhdGlvbiAgICAgIEludmFsaWREb2N1bWVudCh2MCkgICBVbmtub3duRG9jdW1lbnQodjMpXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgRG9jdW1lbnQodjMpICAgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgTm9Eb2N1bWVudCh2MykgICAgICAgIE5vRG9jdW1lbnQodjApXG4gKiBEZWxldGVNdXRhdGlvbiAgICAgSW52YWxpZERvY3VtZW50KHYwKSAgIE5vRG9jdW1lbnQodjApXG4gKlxuICogRm9yIGFja25vd2xlZGdlZCBtdXRhdGlvbnMsIHdlIHVzZSB0aGUgdXBkYXRlVGltZSBvZiB0aGUgV3JpdGVSZXNwb25zZSBhc1xuICogdGhlIHJlc3VsdGluZyB2ZXJzaW9uIGZvciBTZXQgYW5kIFBhdGNoIG11dGF0aW9ucy4gQXMgZGVsZXRlcyBoYXZlIG5vXG4gKiBleHBsaWNpdCB1cGRhdGUgdGltZSwgd2UgdXNlIHRoZSBjb21taXRUaW1lIG9mIHRoZSBXcml0ZVJlc3BvbnNlIGZvclxuICogRGVsZXRlIG11dGF0aW9ucy5cbiAqXG4gKiBJZiBhIG11dGF0aW9uIGlzIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZCBidXQgZmFpbHMgdGhlIHByZWNvbmRpdGlvbiBjaGVja1xuICogbG9jYWxseSwgd2UgdHJhbnNpdGlvbiB0byBhbiBgVW5rbm93bkRvY3VtZW50YCBhbmQgcmVseSBvbiBXYXRjaCB0byBzZW5kIHVzXG4gKiB0aGUgdXBkYXRlZCB2ZXJzaW9uLlxuICpcbiAqIEZpZWxkIHRyYW5zZm9ybXMgYXJlIHVzZWQgb25seSB3aXRoIFBhdGNoIGFuZCBTZXQgTXV0YXRpb25zLiBXZSB1c2UgdGhlXG4gKiBgdXBkYXRlVHJhbnNmb3Jtc2AgbWVzc2FnZSB0byBzdG9yZSB0cmFuc2Zvcm1zLCByYXRoZXIgdGhhbiB0aGUgYHRyYW5zZm9ybXNgc1xuICogbWVzc2FnZXMuXG4gKlxuICogIyMgU3ViY2xhc3NpbmcgTm90ZXNcbiAqXG4gKiBFdmVyeSB0eXBlIG9mIG11dGF0aW9uIG5lZWRzIHRvIGltcGxlbWVudCBpdHMgb3duIGFwcGx5VG9SZW1vdGVEb2N1bWVudCgpIGFuZFxuICogYXBwbHlUb0xvY2FsVmlldygpIHRvIGltcGxlbWVudCB0aGUgYWN0dWFsIGJlaGF2aW9yIG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvblxuICogdG8gc29tZSBzb3VyY2UgZG9jdW1lbnQgKHNlZSBgc2V0TXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoKWAgZm9yIGFuXG4gKiBleGFtcGxlKS5cbiAqLyBjbGFzcyBNdXRhdGlvbiB7fVxuXG4vKipcbiAqIEEgdXRpbGl0eSBtZXRob2QgdG8gY2FsY3VsYXRlIGEgYE11dGF0aW9uYCByZXByZXNlbnRpbmcgdGhlIG92ZXJsYXkgZnJvbSB0aGVcbiAqIGZpbmFsIHN0YXRlIG9mIHRoZSBkb2N1bWVudCwgYW5kIGEgYEZpZWxkTWFza2AgcmVwcmVzZW50aW5nIHRoZSBmaWVsZHMgdGhhdFxuICogYXJlIG11dGF0ZWQgYnkgdGhlIGxvY2FsIG11dGF0aW9ucy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY2FsY3VsYXRlT3ZlcmxheU11dGF0aW9uKGUsIHQpIHtcbiAgICBpZiAoIWUuaGFzTG9jYWxNdXRhdGlvbnMgfHwgdCAmJiAwID09PSB0LmZpZWxkcy5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgIC8vIG1hc2sgaXMgbnVsbCB3aGVuIHNldHMgb3IgZGVsZXRlcyBhcmUgYXBwbGllZCB0byB0aGUgY3VycmVudCBkb2N1bWVudC5cbiAgICAgICAgaWYgKG51bGwgPT09IHQpIHJldHVybiBlLmlzTm9Eb2N1bWVudCgpID8gbmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLmtleSwgUHJlY29uZGl0aW9uLm5vbmUoKSkgOiBuZXcgX19QUklWQVRFX1NldE11dGF0aW9uKGUua2V5LCBlLmRhdGEsIFByZWNvbmRpdGlvbi5ub25lKCkpO1xuICAgIHtcbiAgICAgICAgY29uc3QgbiA9IGUuZGF0YSwgciA9IE9iamVjdFZhbHVlLmVtcHR5KCk7XG4gICAgICAgIGxldCBpID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICAgICAgZm9yIChsZXQgZSBvZiB0LmZpZWxkcykgaWYgKCFpLmhhcyhlKSkge1xuICAgICAgICAgICAgbGV0IHQgPSBuLmZpZWxkKGUpO1xuICAgICAgICAgICAgLy8gSWYgd2UgYXJlIGRlbGV0aW5nIGEgbmVzdGVkIGZpZWxkLCB3ZSB0YWtlIHRoZSBpbW1lZGlhdGUgcGFyZW50IGFzXG4gICAgICAgICAgICAvLyB0aGUgbWFzayB1c2VkIHRvIGNvbnN0cnVjdCB0aGUgcmVzdWx0aW5nIG11dGF0aW9uLlxuICAgICAgICAgICAgLy8gSnVzdGlmaWNhdGlvbjogTmVzdGVkIGZpZWxkcyBjYW4gY3JlYXRlIHBhcmVudCBmaWVsZHMgaW1wbGljaXRseS4gSWZcbiAgICAgICAgICAgIC8vIG9ubHkgYSBsZWFmIGVudHJ5IGlzIGRlbGV0ZWQgaW4gbGF0ZXIgbXV0YXRpb25zLCB0aGUgcGFyZW50IGZpZWxkXG4gICAgICAgICAgICAvLyBzaG91bGQgc3RpbGwgcmVtYWluLCBidXQgd2UgbWF5IGhhdmUgbG9zdCB0aGlzIGluZm9ybWF0aW9uLlxuICAgICAgICAgICAgLy8gQ29uc2lkZXIgbXV0YXRpb24gKGZvby5iYXIgMSksIHRoZW4gbXV0YXRpb24gKGZvby5iYXIgZGVsZXRlKCkpLlxuICAgICAgICAgICAgLy8gVGhpcyBsZWF2ZXMgdGhlIGZpbmFsIHJlc3VsdCAoZm9vLCB7fSkuIERlc3BpdGUgdGhlIGZhY3QgdGhhdCBgZG9jYFxuICAgICAgICAgICAgLy8gaGFzIHRoZSBjb3JyZWN0IHJlc3VsdCwgYGZvb2AgaXMgbm90IGluIGBtYXNrYCwgYW5kIHRoZSByZXN1bHRpbmdcbiAgICAgICAgICAgIC8vIG11dGF0aW9uIHdvdWxkIG1pc3MgYGZvb2AuXG4gICAgICAgICAgICAgICAgICAgICAgICBudWxsID09PSB0ICYmIGUubGVuZ3RoID4gMSAmJiAoZSA9IGUucG9wTGFzdCgpLCB0ID0gbi5maWVsZChlKSksIG51bGwgPT09IHQgPyByLmRlbGV0ZShlKSA6IHIuc2V0KGUsIHQpLCBcbiAgICAgICAgICAgIGkgPSBpLmFkZChlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUua2V5LCByLCBuZXcgRmllbGRNYXNrKGkudG9BcnJheSgpKSwgUHJlY29uZGl0aW9uLm5vbmUoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEFwcGxpZXMgdGhpcyBtdXRhdGlvbiB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQgZm9yIHRoZSBwdXJwb3NlcyBvZiBjb21wdXRpbmcgYVxuICogbmV3IHJlbW90ZSBkb2N1bWVudC4gSWYgdGhlIGlucHV0IGRvY3VtZW50IGRvZXNuJ3QgbWF0Y2ggdGhlIGV4cGVjdGVkIHN0YXRlXG4gKiAoZS5nLiBpdCBpcyBpbnZhbGlkIG9yIG91dGRhdGVkKSwgdGhlIGRvY3VtZW50IHR5cGUgbWF5IHRyYW5zaXRpb24gdG9cbiAqIHVua25vd24uXG4gKlxuICogQHBhcmFtIG11dGF0aW9uIC0gVGhlIG11dGF0aW9uIHRvIGFwcGx5LlxuICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIG11dGF0ZS4gVGhlIGlucHV0IGRvY3VtZW50IGNhbiBiZSBhblxuICogICAgIGludmFsaWQgZG9jdW1lbnQgaWYgdGhlIGNsaWVudCBoYXMgbm8ga25vd2xlZGdlIG9mIHRoZSBwcmUtbXV0YXRpb24gc3RhdGVcbiAqICAgICBvZiB0aGUgZG9jdW1lbnQuXG4gKiBAcGFyYW0gbXV0YXRpb25SZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBtdXRhdGlvbiBmcm9tIHRoZSBiYWNrZW5kLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXRNdXRhdGlvbiA/IGZ1bmN0aW9uIF9fUFJJVkFURV9zZXRNdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgICAgIC8vIFVubGlrZSBzZXRNdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcsIGlmIHdlJ3JlIGFwcGx5aW5nIGEgbXV0YXRpb24gdG8gYVxuICAgICAgICAvLyByZW1vdGUgZG9jdW1lbnQgdGhlIHNlcnZlciBoYXMgYWNjZXB0ZWQgdGhlIG11dGF0aW9uIHNvIHRoZSBwcmVjb25kaXRpb25cbiAgICAgICAgLy8gbXVzdCBoYXZlIGhlbGQuXG4gICAgICAgIGNvbnN0IHIgPSBlLnZhbHVlLmNsb25lKCksIGkgPSBfX1BSSVZBVEVfc2VydmVyVHJhbnNmb3JtUmVzdWx0cyhlLmZpZWxkVHJhbnNmb3JtcywgdCwgbi50cmFuc2Zvcm1SZXN1bHRzKTtcbiAgICAgICAgci5zZXRBbGwoaSksIHQuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIHIpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0oZSwgdCwgbikgOiBlIGluc3RhbmNlb2YgX19QUklWQVRFX1BhdGNoTXV0YXRpb24gPyBmdW5jdGlvbiBfX1BSSVZBVEVfcGF0Y2hNdXRhdGlvbkFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0LCBuKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX3ByZWNvbmRpdGlvbklzVmFsaWRGb3JEb2N1bWVudChlLnByZWNvbmRpdGlvbiwgdCkpIFxuICAgICAgICAvLyBTaW5jZSB0aGUgbXV0YXRpb24gd2FzIG5vdCByZWplY3RlZCwgd2Uga25vdyB0aGF0IHRoZSBwcmVjb25kaXRpb25cbiAgICAgICAgLy8gbWF0Y2hlZCBvbiB0aGUgYmFja2VuZC4gV2UgdGhlcmVmb3JlIG11c3Qgbm90IGhhdmUgdGhlIGV4cGVjdGVkIHZlcnNpb25cbiAgICAgICAgLy8gb2YgdGhlIGRvY3VtZW50IGluIG91ciBjYWNoZSBhbmQgY29udmVydCB0byBhbiBVbmtub3duRG9jdW1lbnQgd2l0aCBhXG4gICAgICAgIC8vIGtub3duIHVwZGF0ZVRpbWUuXG4gICAgICAgIHJldHVybiB2b2lkIHQuY29udmVydFRvVW5rbm93bkRvY3VtZW50KG4udmVyc2lvbik7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfc2VydmVyVHJhbnNmb3JtUmVzdWx0cyhlLmZpZWxkVHJhbnNmb3JtcywgdCwgbi50cmFuc2Zvcm1SZXN1bHRzKSwgaSA9IHQuZGF0YTtcbiAgICAgICAgaS5zZXRBbGwoX19QUklWQVRFX2dldFBhdGNoKGUpKSwgaS5zZXRBbGwociksIHQuY29udmVydFRvRm91bmREb2N1bWVudChuLnZlcnNpb24sIGkpLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpO1xuICAgIH0oZSwgdCwgbikgOiBmdW5jdGlvbiBfX1BSSVZBVEVfZGVsZXRlTXV0YXRpb25BcHBseVRvUmVtb3RlRG9jdW1lbnQoZSwgdCwgbikge1xuICAgICAgICAvLyBVbmxpa2UgYXBwbHlUb0xvY2FsVmlldywgaWYgd2UncmUgYXBwbHlpbmcgYSBtdXRhdGlvbiB0byBhIHJlbW90ZVxuICAgICAgICAvLyBkb2N1bWVudCB0aGUgc2VydmVyIGhhcyBhY2NlcHRlZCB0aGUgbXV0YXRpb24gc28gdGhlIHByZWNvbmRpdGlvbiBtdXN0XG4gICAgICAgIC8vIGhhdmUgaGVsZC5cbiAgICAgICAgdC5jb252ZXJ0VG9Ob0RvY3VtZW50KG4udmVyc2lvbikuc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCk7XG4gICAgfSgwLCB0LCBuKTtcbn1cblxuLyoqXG4gKiBBcHBsaWVzIHRoaXMgbXV0YXRpb24gdG8gdGhlIGdpdmVuIGRvY3VtZW50IGZvciB0aGUgcHVycG9zZXMgb2YgY29tcHV0aW5nXG4gKiB0aGUgbmV3IGxvY2FsIHZpZXcgb2YgYSBkb2N1bWVudC4gSWYgdGhlIGlucHV0IGRvY3VtZW50IGRvZXNuJ3QgbWF0Y2ggdGhlXG4gKiBleHBlY3RlZCBzdGF0ZSwgdGhlIGRvY3VtZW50IGlzIG5vdCBtb2RpZmllZC5cbiAqXG4gKiBAcGFyYW0gbXV0YXRpb24gLSBUaGUgbXV0YXRpb24gdG8gYXBwbHkuXG4gKiBAcGFyYW0gZG9jdW1lbnQgLSBUaGUgZG9jdW1lbnQgdG8gbXV0YXRlLiBUaGUgaW5wdXQgZG9jdW1lbnQgY2FuIGJlIGFuXG4gKiAgICAgaW52YWxpZCBkb2N1bWVudCBpZiB0aGUgY2xpZW50IGhhcyBubyBrbm93bGVkZ2Ugb2YgdGhlIHByZS1tdXRhdGlvbiBzdGF0ZVxuICogICAgIG9mIHRoZSBkb2N1bWVudC5cbiAqIEBwYXJhbSBwcmV2aW91c01hc2sgLSBUaGUgZmllbGRzIHRoYXQgaGF2ZSBiZWVuIHVwZGF0ZWQgYmVmb3JlIGFwcGx5aW5nIHRoaXMgbXV0YXRpb24uXG4gKiBAcGFyYW0gbG9jYWxXcml0ZVRpbWUgLSBBIHRpbWVzdGFtcCBpbmRpY2F0aW5nIHRoZSBsb2NhbCB3cml0ZSB0aW1lIG9mIHRoZVxuICogICAgIGJhdGNoIHRoaXMgbXV0YXRpb24gaXMgYSBwYXJ0IG9mLlxuICogQHJldHVybnMgQSBgRmllbGRNYXNrYCByZXByZXNlbnRpbmcgdGhlIGZpZWxkcyB0aGF0IGFyZSBjaGFuZ2VkIGJ5IGFwcGx5aW5nIHRoaXMgbXV0YXRpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhlLCB0LCBuLCByKSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfU2V0TXV0YXRpb24gPyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0TXV0YXRpb25BcHBseVRvTG9jYWxWaWV3KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfcHJlY29uZGl0aW9uSXNWYWxpZEZvckRvY3VtZW50KGUucHJlY29uZGl0aW9uLCB0KSkgXG4gICAgICAgIC8vIFRoZSBtdXRhdGlvbiBmYWlsZWQgdG8gYXBwbHkgKGUuZy4gYSBkb2N1bWVudCBJRCBjcmVhdGVkIHdpdGggYWRkKClcbiAgICAgICAgLy8gY2F1c2VkIGEgbmFtZSBjb2xsaXNpb24pLlxuICAgICAgICByZXR1cm4gbjtcbiAgICAgICAgY29uc3QgaSA9IGUudmFsdWUuY2xvbmUoKSwgcyA9IF9fUFJJVkFURV9sb2NhbFRyYW5zZm9ybVJlc3VsdHMoZS5maWVsZFRyYW5zZm9ybXMsIHIsIHQpO1xuICAgICAgICByZXR1cm4gaS5zZXRBbGwocyksIHQuY29udmVydFRvRm91bmREb2N1bWVudCh0LnZlcnNpb24sIGkpLnNldEhhc0xvY2FsTXV0YXRpb25zKCksIFxuICAgICAgICBudWxsO1xuIC8vIFNldE11dGF0aW9uIG92ZXJ3cml0ZXMgYWxsIGZpZWxkcy5cbiAgICAgICAgfVxuICAgIC8qKlxuICogQSBtdXRhdGlvbiB0aGF0IG1vZGlmaWVzIGZpZWxkcyBvZiB0aGUgZG9jdW1lbnQgYXQgdGhlIGdpdmVuIGtleSB3aXRoIHRoZVxuICogZ2l2ZW4gdmFsdWVzLiBUaGUgdmFsdWVzIGFyZSBhcHBsaWVkIHRocm91Z2ggYSBmaWVsZCBtYXNrOlxuICpcbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiBib3RoIHRoZSBtYXNrIGFuZCB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZyBmaWVsZFxuICogICAgaXMgdXBkYXRlZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiBuZWl0aGVyIHRoZSBtYXNrIG5vciB0aGUgdmFsdWVzLCB0aGUgY29ycmVzcG9uZGluZ1xuICogICAgZmllbGQgaXMgdW5tb2RpZmllZC5cbiAqICAqIFdoZW4gYSBmaWVsZCBpcyBpbiB0aGUgbWFzayBidXQgbm90IGluIHRoZSB2YWx1ZXMsIHRoZSBjb3JyZXNwb25kaW5nIGZpZWxkXG4gKiAgICBpcyBkZWxldGVkLlxuICogICogV2hlbiBhIGZpZWxkIGlzIG5vdCBpbiB0aGUgbWFzayBidXQgaXMgaW4gdGhlIHZhbHVlcywgdGhlIHZhbHVlcyBtYXAgaXNcbiAqICAgIGlnbm9yZWQuXG4gKi8gKGUsIHQsIG4sIHIpIDogZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9QYXRjaE11dGF0aW9uID8gZnVuY3Rpb24gX19QUklWQVRFX3BhdGNoTXV0YXRpb25BcHBseVRvTG9jYWxWaWV3KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgaWYgKCFfX1BSSVZBVEVfcHJlY29uZGl0aW9uSXNWYWxpZEZvckRvY3VtZW50KGUucHJlY29uZGl0aW9uLCB0KSkgcmV0dXJuIG47XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbG9jYWxUcmFuc2Zvcm1SZXN1bHRzKGUuZmllbGRUcmFuc2Zvcm1zLCByLCB0KSwgcyA9IHQuZGF0YTtcbiAgICAgICAgaWYgKHMuc2V0QWxsKF9fUFJJVkFURV9nZXRQYXRjaChlKSksIHMuc2V0QWxsKGkpLCB0LmNvbnZlcnRUb0ZvdW5kRG9jdW1lbnQodC52ZXJzaW9uLCBzKS5zZXRIYXNMb2NhbE11dGF0aW9ucygpLCBcbiAgICAgICAgbnVsbCA9PT0gbikgcmV0dXJuIG51bGw7XG4gICAgICAgIHJldHVybiBuLnVuaW9uV2l0aChlLmZpZWxkTWFzay5maWVsZHMpLnVuaW9uV2l0aChlLmZpZWxkVHJhbnNmb3Jtcy5tYXAoKGUgPT4gZS5maWVsZCkpKTtcbiAgICB9XG4gICAgLyoqXG4gKiBSZXR1cm5zIGEgRmllbGRQYXRoL1ZhbHVlIG1hcCB3aXRoIHRoZSBjb250ZW50IG9mIHRoZSBQYXRjaE11dGF0aW9uLlxuICovIChlLCB0LCBuLCByKSA6IGZ1bmN0aW9uIF9fUFJJVkFURV9kZWxldGVNdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcoZSwgdCwgbikge1xuICAgICAgICBpZiAoX19QUklWQVRFX3ByZWNvbmRpdGlvbklzVmFsaWRGb3JEb2N1bWVudChlLnByZWNvbmRpdGlvbiwgdCkpIHJldHVybiB0LmNvbnZlcnRUb05vRG9jdW1lbnQodC52ZXJzaW9uKS5zZXRIYXNMb2NhbE11dGF0aW9ucygpLCBcbiAgICAgICAgbnVsbDtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxuICAgIC8qKlxuICogQSBtdXRhdGlvbiB0aGF0IHZlcmlmaWVzIHRoZSBleGlzdGVuY2Ugb2YgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkgd2l0aFxuICogdGhlIHByb3ZpZGVkIHByZWNvbmRpdGlvbi5cbiAqXG4gKiBUaGUgYHZlcmlmeWAgb3BlcmF0aW9uIGlzIG9ubHkgdXNlZCBpbiBUcmFuc2FjdGlvbnMsIGFuZCB0aGlzIGNsYXNzIHNlcnZlc1xuICogcHJpbWFyaWx5IHRvIGZhY2lsaXRhdGUgc2VyaWFsaXphdGlvbiBpbnRvIHByb3Rvcy5cbiAqLyAoZSwgdCwgbik7XG59XG5cbi8qKlxuICogSWYgdGhpcyBtdXRhdGlvbiBpcyBub3QgaWRlbXBvdGVudCwgcmV0dXJucyB0aGUgYmFzZSB2YWx1ZSB0byBwZXJzaXN0IHdpdGhcbiAqIHRoaXMgbXV0YXRpb24uIElmIGEgYmFzZSB2YWx1ZSBpcyByZXR1cm5lZCwgdGhlIG11dGF0aW9uIGlzIGFsd2F5cyBhcHBsaWVkXG4gKiB0byB0aGlzIGJhc2UgdmFsdWUsIGV2ZW4gaWYgZG9jdW1lbnQgaGFzIGFscmVhZHkgYmVlbiB1cGRhdGVkLlxuICpcbiAqIFRoZSBiYXNlIHZhbHVlIGlzIGEgc3BhcnNlIG9iamVjdCB0aGF0IGNvbnNpc3RzIG9mIG9ubHkgdGhlIGRvY3VtZW50XG4gKiBmaWVsZHMgZm9yIHdoaWNoIHRoaXMgbXV0YXRpb24gY29udGFpbnMgYSBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1hdGlvblxuICogKGUuZy4gYSBudW1lcmljIGluY3JlbWVudCkuIFRoZSBwcm92aWRlZCB2YWx1ZSBndWFyYW50ZWVzIGNvbnNpc3RlbnRcbiAqIGJlaGF2aW9yIGZvciBub24taWRlbXBvdGVudCB0cmFuc2Zvcm1zIGFuZCBhbGxvdyB1cyB0byByZXR1cm4gdGhlIHNhbWVcbiAqIGxhdGVuY3ktY29tcGVuc2F0ZWQgdmFsdWUgZXZlbiBpZiB0aGUgYmFja2VuZCBoYXMgYWxyZWFkeSBhcHBsaWVkIHRoZVxuICogbXV0YXRpb24uIFRoZSBiYXNlIHZhbHVlIGlzIG51bGwgZm9yIGlkZW1wb3RlbnQgbXV0YXRpb25zLCBhcyB0aGV5IGNhbiBiZVxuICogcmUtcGxheWVkIGV2ZW4gaWYgdGhlIGJhY2tlbmQgaGFzIGFscmVhZHkgYXBwbGllZCB0aGVtLlxuICpcbiAqIEByZXR1cm5zIGEgYmFzZSB2YWx1ZSB0byBzdG9yZSBhbG9uZyB3aXRoIHRoZSBtdXRhdGlvbiwgb3IgbnVsbCBmb3JcbiAqIGlkZW1wb3RlbnQgbXV0YXRpb25zLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvbkV4dHJhY3RCYXNlVmFsdWUoZSwgdCkge1xuICAgIGxldCBuID0gbnVsbDtcbiAgICBmb3IgKGNvbnN0IHIgb2YgZS5maWVsZFRyYW5zZm9ybXMpIHtcbiAgICAgICAgY29uc3QgZSA9IHQuZGF0YS5maWVsZChyLmZpZWxkKSwgaSA9IF9fUFJJVkFURV9jb21wdXRlVHJhbnNmb3JtT3BlcmF0aW9uQmFzZVZhbHVlKHIudHJhbnNmb3JtLCBlIHx8IG51bGwpO1xuICAgICAgICBudWxsICE9IGkgJiYgKG51bGwgPT09IG4gJiYgKG4gPSBPYmplY3RWYWx1ZS5lbXB0eSgpKSwgbi5zZXQoci5maWVsZCwgaSkpO1xuICAgIH1cbiAgICByZXR1cm4gbiB8fCBudWxsO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25FcXVhbHMoZSwgdCkge1xuICAgIHJldHVybiBlLnR5cGUgPT09IHQudHlwZSAmJiAoISFlLmtleS5pc0VxdWFsKHQua2V5KSAmJiAoISFlLnByZWNvbmRpdGlvbi5pc0VxdWFsKHQucHJlY29uZGl0aW9uKSAmJiAoISFmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRUcmFuc2Zvcm1zQXJlRXF1YWwoZSwgdCkge1xuICAgICAgICByZXR1cm4gdm9pZCAwID09PSBlICYmIHZvaWQgMCA9PT0gdCB8fCAhKCFlIHx8ICF0KSAmJiBfX1BSSVZBVEVfYXJyYXlFcXVhbHMoZSwgdCwgKChlLCB0KSA9PiBfX1BSSVZBVEVfZmllbGRUcmFuc2Zvcm1FcXVhbHMoZSwgdCkpKTtcbiAgICB9KGUuZmllbGRUcmFuc2Zvcm1zLCB0LmZpZWxkVHJhbnNmb3JtcykgJiYgKDAgLyogTXV0YXRpb25UeXBlLlNldCAqLyA9PT0gZS50eXBlID8gZS52YWx1ZS5pc0VxdWFsKHQudmFsdWUpIDogMSAvKiBNdXRhdGlvblR5cGUuUGF0Y2ggKi8gIT09IGUudHlwZSB8fCBlLmRhdGEuaXNFcXVhbCh0LmRhdGEpICYmIGUuZmllbGRNYXNrLmlzRXF1YWwodC5maWVsZE1hc2spKSkpKTtcbn1cblxuLyoqXG4gKiBBIG11dGF0aW9uIHRoYXQgY3JlYXRlcyBvciByZXBsYWNlcyB0aGUgZG9jdW1lbnQgYXQgdGhlIGdpdmVuIGtleSB3aXRoIHRoZVxuICogb2JqZWN0IHZhbHVlIGNvbnRlbnRzLlxuICovIGNsYXNzIF9fUFJJVkFURV9TZXRNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSBlLCB0aGlzLnZhbHVlID0gdCwgdGhpcy5wcmVjb25kaXRpb24gPSBuLCB0aGlzLmZpZWxkVHJhbnNmb3JtcyA9IHIsIFxuICAgICAgICB0aGlzLnR5cGUgPSAwIC8qIE11dGF0aW9uVHlwZS5TZXQgKi87XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpID0gW10pIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5rZXkgPSBlLCB0aGlzLmRhdGEgPSB0LCB0aGlzLmZpZWxkTWFzayA9IG4sIHRoaXMucHJlY29uZGl0aW9uID0gciwgXG4gICAgICAgIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gaSwgdGhpcy50eXBlID0gMSAvKiBNdXRhdGlvblR5cGUuUGF0Y2ggKi87XG4gICAgfVxuICAgIGdldEZpZWxkTWFzaygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmllbGRNYXNrO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFBhdGNoKGUpIHtcbiAgICBjb25zdCB0ID0gbmV3IE1hcDtcbiAgICByZXR1cm4gZS5maWVsZE1hc2suZmllbGRzLmZvckVhY2goKG4gPT4ge1xuICAgICAgICBpZiAoIW4uaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICBjb25zdCByID0gZS5kYXRhLmZpZWxkKG4pO1xuICAgICAgICAgICAgdC5zZXQobiwgcik7XG4gICAgICAgIH1cbiAgICB9KSksIHQ7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGxpc3Qgb2YgXCJ0cmFuc2Zvcm0gcmVzdWx0c1wiIChhIHRyYW5zZm9ybSByZXN1bHQgaXMgYSBmaWVsZCB2YWx1ZVxuICogcmVwcmVzZW50aW5nIHRoZSByZXN1bHQgb2YgYXBwbHlpbmcgYSB0cmFuc2Zvcm0pIGZvciB1c2UgYWZ0ZXIgYSBtdXRhdGlvblxuICogY29udGFpbmluZyB0cmFuc2Zvcm1zIGhhcyBiZWVuIGFja25vd2xlZGdlZCBieSB0aGUgc2VydmVyLlxuICpcbiAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBUaGUgZmllbGQgdHJhbnNmb3JtcyB0byBhcHBseSB0aGUgcmVzdWx0IHRvLlxuICogQHBhcmFtIG11dGFibGVEb2N1bWVudCAtIFRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBkb2N1bWVudCBhZnRlciBhcHBseWluZyBhbGxcbiAqIHByZXZpb3VzIG11dGF0aW9ucy5cbiAqIEBwYXJhbSBzZXJ2ZXJUcmFuc2Zvcm1SZXN1bHRzIC0gVGhlIHRyYW5zZm9ybSByZXN1bHRzIHJlY2VpdmVkIGJ5IHRoZSBzZXJ2ZXIuXG4gKiBAcmV0dXJucyBUaGUgdHJhbnNmb3JtIHJlc3VsdHMgbGlzdC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2VydmVyVHJhbnNmb3JtUmVzdWx0cyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IG5ldyBNYXA7XG4gICAgX19QUklWQVRFX2hhcmRBc3NlcnQoZS5sZW5ndGggPT09IG4ubGVuZ3RoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG4ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgcyA9IGVbaV0sIG8gPSBzLnRyYW5zZm9ybSwgXyA9IHQuZGF0YS5maWVsZChzLmZpZWxkKTtcbiAgICAgICAgci5zZXQocy5maWVsZCwgX19QUklWQVRFX2FwcGx5VHJhbnNmb3JtT3BlcmF0aW9uVG9SZW1vdGVEb2N1bWVudChvLCBfLCBuW2ldKSk7XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBsaXN0IG9mIFwidHJhbnNmb3JtIHJlc3VsdHNcIiAoYSB0cmFuc2Zvcm0gcmVzdWx0IGlzIGEgZmllbGQgdmFsdWVcbiAqIHJlcHJlc2VudGluZyB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGEgdHJhbnNmb3JtKSBmb3IgdXNlIHdoZW4gYXBwbHlpbmcgYVxuICogdHJhbnNmb3JtIGxvY2FsbHkuXG4gKlxuICogQHBhcmFtIGZpZWxkVHJhbnNmb3JtcyAtIFRoZSBmaWVsZCB0cmFuc2Zvcm1zIHRvIGFwcGx5IHRoZSByZXN1bHQgdG8uXG4gKiBAcGFyYW0gbG9jYWxXcml0ZVRpbWUgLSBUaGUgbG9jYWwgdGltZSBvZiB0aGUgbXV0YXRpb24gKHVzZWQgdG9cbiAqICAgICBnZW5lcmF0ZSBTZXJ2ZXJUaW1lc3RhbXBWYWx1ZXMpLlxuICogQHBhcmFtIG11dGFibGVEb2N1bWVudCAtIFRoZSBkb2N1bWVudCB0byBhcHBseSB0cmFuc2Zvcm1zIG9uLlxuICogQHJldHVybnMgVGhlIHRyYW5zZm9ybSByZXN1bHRzIGxpc3QuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsVHJhbnNmb3JtUmVzdWx0cyhlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IG5ldyBNYXA7XG4gICAgZm9yIChjb25zdCBpIG9mIGUpIHtcbiAgICAgICAgY29uc3QgZSA9IGkudHJhbnNmb3JtLCBzID0gbi5kYXRhLmZpZWxkKGkuZmllbGQpO1xuICAgICAgICByLnNldChpLmZpZWxkLCBfX1BSSVZBVEVfYXBwbHlUcmFuc2Zvcm1PcGVyYXRpb25Ub0xvY2FsVmlldyhlLCBzLCB0KSk7XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG4vKiogQSBtdXRhdGlvbiB0aGF0IGRlbGV0ZXMgdGhlIGRvY3VtZW50IGF0IHRoZSBnaXZlbiBrZXkuICovIGNsYXNzIF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gZSwgdGhpcy5wcmVjb25kaXRpb24gPSB0LCB0aGlzLnR5cGUgPSAyIC8qIE11dGF0aW9uVHlwZS5EZWxldGUgKi8gLCBcbiAgICAgICAgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBbXTtcbiAgICB9XG4gICAgZ2V0RmllbGRNYXNrKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9WZXJpZnlNdXRhdGlvbiBleHRlbmRzIE11dGF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMua2V5ID0gZSwgdGhpcy5wcmVjb25kaXRpb24gPSB0LCB0aGlzLnR5cGUgPSAzIC8qIE11dGF0aW9uVHlwZS5WZXJpZnkgKi8gLCBcbiAgICAgICAgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBbXTtcbiAgICB9XG4gICAgZ2V0RmllbGRNYXNrKCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYmF0Y2ggb2YgbXV0YXRpb25zIHRoYXQgd2lsbCBiZSBzZW50IGFzIG9uZSB1bml0IHRvIHRoZSBiYWNrZW5kLlxuICovIGNsYXNzIE11dGF0aW9uQmF0Y2gge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBiYXRjaElkIC0gVGhlIHVuaXF1ZSBJRCBvZiB0aGlzIG11dGF0aW9uIGJhdGNoLlxuICAgICAqIEBwYXJhbSBsb2NhbFdyaXRlVGltZSAtIFRoZSBvcmlnaW5hbCB3cml0ZSB0aW1lIG9mIHRoaXMgbXV0YXRpb24uXG4gICAgICogQHBhcmFtIGJhc2VNdXRhdGlvbnMgLSBNdXRhdGlvbnMgdGhhdCBhcmUgdXNlZCB0byBwb3B1bGF0ZSB0aGUgYmFzZVxuICAgICAqIHZhbHVlcyB3aGVuIHRoaXMgbXV0YXRpb24gaXMgYXBwbGllZCBsb2NhbGx5LiBUaGlzIGNhbiBiZSB1c2VkIHRvIGxvY2FsbHlcbiAgICAgKiBvdmVyd3JpdGUgdmFsdWVzIHRoYXQgYXJlIHBlcnNpc3RlZCBpbiB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlLiBCYXNlXG4gICAgICogbXV0YXRpb25zIGFyZSBuZXZlciBzZW50IHRvIHRoZSBiYWNrZW5kLlxuICAgICAqIEBwYXJhbSBtdXRhdGlvbnMgLSBUaGUgdXNlci1wcm92aWRlZCBtdXRhdGlvbnMgaW4gdGhpcyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgKiBVc2VyLXByb3ZpZGVkIG11dGF0aW9ucyBhcmUgYXBwbGllZCBib3RoIGxvY2FsbHkgYW5kIHJlbW90ZWx5IG9uIHRoZVxuICAgICAqIGJhY2tlbmQuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLmJhdGNoSWQgPSBlLCB0aGlzLmxvY2FsV3JpdGVUaW1lID0gdCwgdGhpcy5iYXNlTXV0YXRpb25zID0gbiwgdGhpcy5tdXRhdGlvbnMgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIGFsbCB0aGUgbXV0YXRpb25zIGluIHRoaXMgTXV0YXRpb25CYXRjaCB0byB0aGUgc3BlY2lmaWVkIGRvY3VtZW50XG4gICAgICogdG8gY29tcHV0ZSB0aGUgc3RhdGUgb2YgdGhlIHJlbW90ZSBkb2N1bWVudFxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIGFwcGx5IG11dGF0aW9ucyB0by5cbiAgICAgKiBAcGFyYW0gYmF0Y2hSZXN1bHQgLSBUaGUgcmVzdWx0IG9mIGFwcGx5aW5nIHRoZSBNdXRhdGlvbkJhdGNoIHRvIHRoZVxuICAgICAqIGJhY2tlbmQuXG4gICAgICovICAgIGFwcGx5VG9SZW1vdGVEb2N1bWVudChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0Lm11dGF0aW9uUmVzdWx0cztcbiAgICAgICAgZm9yIChsZXQgdCA9IDA7IHQgPCB0aGlzLm11dGF0aW9ucy5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMubXV0YXRpb25zW3RdO1xuICAgICAgICAgICAgaWYgKHIua2V5LmlzRXF1YWwoZS5rZXkpKSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX211dGF0aW9uQXBwbHlUb1JlbW90ZURvY3VtZW50KHIsIGUsIG5bdF0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbXB1dGVzIHRoZSBsb2NhbCB2aWV3IG9mIGEgZG9jdW1lbnQgZ2l2ZW4gYWxsIHRoZSBtdXRhdGlvbnMgaW4gdGhpc1xuICAgICAqIGJhdGNoLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50IC0gVGhlIGRvY3VtZW50IHRvIGFwcGx5IG11dGF0aW9ucyB0by5cbiAgICAgKiBAcGFyYW0gbXV0YXRlZEZpZWxkcyAtIEZpZWxkcyB0aGF0IGhhdmUgYmVlbiB1cGRhdGVkIGJlZm9yZSBhcHBseWluZyB0aGlzIG11dGF0aW9uIGJhdGNoLlxuICAgICAqIEByZXR1cm5zIEEgYEZpZWxkTWFza2AgcmVwcmVzZW50aW5nIGFsbCB0aGUgZmllbGRzIHRoYXQgYXJlIG11dGF0ZWQuXG4gICAgICovICAgIGFwcGx5VG9Mb2NhbFZpZXcoZSwgdCkge1xuICAgICAgICAvLyBGaXJzdCwgYXBwbHkgdGhlIGJhc2Ugc3RhdGUuIFRoaXMgYWxsb3dzIHVzIHRvIGFwcGx5IG5vbi1pZGVtcG90ZW50XG4gICAgICAgIC8vIHRyYW5zZm9ybSBhZ2FpbnN0IGEgY29uc2lzdGVudCBzZXQgb2YgdmFsdWVzLlxuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5iYXNlTXV0YXRpb25zKSBuLmtleS5pc0VxdWFsKGUua2V5KSAmJiAodCA9IF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcobiwgZSwgdCwgdGhpcy5sb2NhbFdyaXRlVGltZSkpO1xuICAgICAgICAvLyBTZWNvbmQsIGFwcGx5IGFsbCB1c2VyLXByb3ZpZGVkIG11dGF0aW9ucy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5tdXRhdGlvbnMpIG4ua2V5LmlzRXF1YWwoZS5rZXkpICYmICh0ID0gX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhuLCBlLCB0LCB0aGlzLmxvY2FsV3JpdGVUaW1lKSk7XG4gICAgICAgIHJldHVybiB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb21wdXRlcyB0aGUgbG9jYWwgdmlldyBmb3IgYWxsIHByb3ZpZGVkIGRvY3VtZW50cyBnaXZlbiB0aGUgbXV0YXRpb25zIGluXG4gICAgICogdGhpcyBiYXRjaC4gUmV0dXJucyBhIGBEb2N1bWVudEtleWAgdG8gYE11dGF0aW9uYCBtYXAgd2hpY2ggY2FuIGJlIHVzZWQgdG9cbiAgICAgKiByZXBsYWNlIGFsbCB0aGUgbXV0YXRpb24gYXBwbGljYXRpb25zLlxuICAgICAqLyAgICBhcHBseVRvTG9jYWxEb2N1bWVudFNldChlLCB0KSB7XG4gICAgICAgIC8vIFRPRE8obXJzY2htaWR0KTogVGhpcyBpbXBsZW1lbnRhdGlvbiBpcyBPKG5eMikuIElmIHdlIGFwcGx5IHRoZSBtdXRhdGlvbnNcbiAgICAgICAgLy8gZGlyZWN0bHkgKGFzIGRvbmUgaW4gYGFwcGx5VG9Mb2NhbFZpZXcoKWApLCB3ZSBjYW4gcmVkdWNlIHRoZSBjb21wbGV4aXR5XG4gICAgICAgIC8vIHRvIE8obikuXG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbmV3TXV0YXRpb25NYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMubXV0YXRpb25zLmZvckVhY2goKHIgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IGUuZ2V0KHIua2V5KSwgcyA9IGkub3ZlcmxheWVkRG9jdW1lbnQ7XG4gICAgICAgICAgICAvLyBUT0RPKG11dGFibGVkb2N1bWVudHMpOiBUaGlzIG1ldGhvZCBzaG91bGQgdGFrZSBhIE11dGFibGVEb2N1bWVudE1hcFxuICAgICAgICAgICAgLy8gYW5kIHdlIHNob3VsZCByZW1vdmUgdGhpcyBjYXN0LlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG8gPSB0aGlzLmFwcGx5VG9Mb2NhbFZpZXcocywgaS5tdXRhdGVkRmllbGRzKTtcbiAgICAgICAgICAgIC8vIFNldCBtdXRhdGVkRmllbGRzIHRvIG51bGwgaWYgdGhlIGRvY3VtZW50IGlzIG9ubHkgZnJvbSBsb2NhbCBtdXRhdGlvbnMuXG4gICAgICAgICAgICAvLyBUaGlzIGNyZWF0ZXMgYSBTZXQgb3IgRGVsZXRlIG11dGF0aW9uLCBpbnN0ZWFkIG9mIHRyeWluZyB0byBjcmVhdGUgYVxuICAgICAgICAgICAgLy8gcGF0Y2ggbXV0YXRpb24gYXMgdGhlIG92ZXJsYXkuXG4gICAgICAgICAgICAgICAgICAgICAgICBvID0gdC5oYXMoci5rZXkpID8gbnVsbCA6IG87XG4gICAgICAgICAgICBjb25zdCBfID0gX19QUklWQVRFX2NhbGN1bGF0ZU92ZXJsYXlNdXRhdGlvbihzLCBvKTtcbiAgICAgICAgICAgIG51bGwgIT09IF8gJiYgbi5zZXQoci5rZXksIF8pLCBzLmlzVmFsaWREb2N1bWVudCgpIHx8IHMuY29udmVydFRvTm9Eb2N1bWVudChTbmFwc2hvdFZlcnNpb24ubWluKCkpO1xuICAgICAgICB9KSksIG47XG4gICAgfVxuICAgIGtleXMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9ucy5yZWR1Y2UoKChlLCB0KSA9PiBlLmFkZCh0LmtleSkpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5iYXRjaElkID09PSBlLmJhdGNoSWQgJiYgX19QUklWQVRFX2FycmF5RXF1YWxzKHRoaXMubXV0YXRpb25zLCBlLm11dGF0aW9ucywgKChlLCB0KSA9PiBfX1BSSVZBVEVfbXV0YXRpb25FcXVhbHMoZSwgdCkpKSAmJiBfX1BSSVZBVEVfYXJyYXlFcXVhbHModGhpcy5iYXNlTXV0YXRpb25zLCBlLmJhc2VNdXRhdGlvbnMsICgoZSwgdCkgPT4gX19QUklWQVRFX211dGF0aW9uRXF1YWxzKGUsIHQpKSk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBhcHBseWluZyBhIG11dGF0aW9uIGJhdGNoIHRvIHRoZSBiYWNrZW5kLiAqLyBjbGFzcyBNdXRhdGlvbkJhdGNoUmVzdWx0IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCBcbiAgICAvKipcbiAgICAgKiBBIHByZS1jb21wdXRlZCBtYXBwaW5nIGZyb20gZWFjaCBtdXRhdGVkIGRvY3VtZW50IHRvIHRoZSByZXN1bHRpbmdcbiAgICAgKiB2ZXJzaW9uLlxuICAgICAqL1xuICAgIHIpIHtcbiAgICAgICAgdGhpcy5iYXRjaCA9IGUsIHRoaXMuY29tbWl0VmVyc2lvbiA9IHQsIHRoaXMubXV0YXRpb25SZXN1bHRzID0gbiwgdGhpcy5kb2NWZXJzaW9ucyA9IHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgTXV0YXRpb25CYXRjaFJlc3VsdCBmb3IgdGhlIGdpdmVuIGJhdGNoIGFuZCByZXN1bHRzLiBUaGVyZVxuICAgICAqIG11c3QgYmUgb25lIHJlc3VsdCBmb3IgZWFjaCBtdXRhdGlvbiBpbiB0aGUgYmF0Y2guIFRoaXMgc3RhdGljIGZhY3RvcnlcbiAgICAgKiBjYWNoZXMgYSBkb2N1bWVudD0mZ3Q7dmVyc2lvbiBtYXBwaW5nIChkb2NWZXJzaW9ucykuXG4gICAgICovICAgIHN0YXRpYyBmcm9tKGUsIHQsIG4pIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoZS5tdXRhdGlvbnMubGVuZ3RoID09PSBuLmxlbmd0aCk7XG4gICAgICAgIGxldCByID0gZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50VmVyc2lvbk1hcCgpIHtcbiAgICAgICAgICAgIHJldHVybiBQdDtcbiAgICAgICAgfSgpO1xuICAgICAgICBjb25zdCBpID0gZS5tdXRhdGlvbnM7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgaS5sZW5ndGg7IGUrKykgciA9IHIuaW5zZXJ0KGlbZV0ua2V5LCBuW2VdLnZlcnNpb24pO1xuICAgICAgICByZXR1cm4gbmV3IE11dGF0aW9uQmF0Y2hSZXN1bHQoZSwgdCwgbiwgcik7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRhdGlvbiBvZiBhbiBvdmVybGF5IGNvbXB1dGVkIGJ5IEZpcmVzdG9yZS5cbiAqXG4gKiBIb2xkcyBpbmZvcm1hdGlvbiBhYm91dCBhIG11dGF0aW9uIGFuZCB0aGUgbGFyZ2VzdCBiYXRjaCBpZCBpbiBGaXJlc3RvcmUgd2hlblxuICogdGhlIG11dGF0aW9uIHdhcyBjcmVhdGVkLlxuICovIGNsYXNzIE92ZXJsYXkge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5sYXJnZXN0QmF0Y2hJZCA9IGUsIHRoaXMubXV0YXRpb24gPSB0O1xuICAgIH1cbiAgICBnZXRLZXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9uLmtleTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSBlICYmIHRoaXMubXV0YXRpb24gPT09IGUubXV0YXRpb247XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICByZXR1cm4gYE92ZXJsYXl7XFxuICAgICAgbGFyZ2VzdEJhdGNoSWQ6ICR7dGhpcy5sYXJnZXN0QmF0Y2hJZH0sXFxuICAgICAgbXV0YXRpb246ICR7dGhpcy5tdXRhdGlvbi50b1N0cmluZygpfVxcbiAgICB9YDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENvbmNyZXRlIGltcGxlbWVudGF0aW9uIG9mIHRoZSBBZ2dyZWdhdGUgdHlwZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQWdncmVnYXRlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICB0aGlzLmFsaWFzID0gZSwgdGhpcy5hZ2dyZWdhdGVUeXBlID0gdCwgdGhpcy5maWVsZFBhdGggPSBuO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgRXhpc3RlbmNlRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuY291bnQgPSBlLCB0aGlzLnVuY2hhbmdlZE5hbWVzID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEVycm9yIENvZGVzIGRlc2NyaWJpbmcgdGhlIGRpZmZlcmVudCB3YXlzIEdSUEMgY2FuIGZhaWwuIFRoZXNlIGFyZSBjb3BpZWRcbiAqIGRpcmVjdGx5IGZyb20gR1JQQydzIHNvdXJjZXMgaGVyZTpcbiAqXG4gKiBodHRwczovL2dpdGh1Yi5jb20vZ3JwYy9ncnBjL2Jsb2IvYmNlZWM5NGVhNGZjNWYwMDg1ZDgxMjM1ZDhlMWMwNjc5OGRjMzQxYS9pbmNsdWRlL2dycGMlMkIlMkIvaW1wbC9jb2RlZ2VuL3N0YXR1c19jb2RlX2VudW0uaFxuICpcbiAqIEltcG9ydGFudCEgVGhlIG5hbWVzIG9mIHRoZXNlIGlkZW50aWZpZXJzIG1hdHRlciBiZWNhdXNlIHRoZSBzdHJpbmcgZm9ybXNcbiAqIGFyZSB1c2VkIGZvciByZXZlcnNlIGxvb2t1cHMgZnJvbSB0aGUgd2ViY2hhbm5lbCBzdHJlYW0uIERvIE5PVCBjaGFuZ2UgdGhlXG4gKiBuYW1lcyBvZiB0aGVzZSBpZGVudGlmaWVycyBvciBjaGFuZ2UgdGhpcyBpbnRvIGEgY29uc3QgZW51bS5cbiAqLyB2YXIgRXQsIGR0O1xuXG4vKipcbiAqIERldGVybWluZXMgd2hldGhlciBhbiBlcnJvciBjb2RlIHJlcHJlc2VudHMgYSBwZXJtYW5lbnQgZXJyb3Igd2hlbiByZWNlaXZlZFxuICogaW4gcmVzcG9uc2UgdG8gYSBub24td3JpdGUgb3BlcmF0aW9uLlxuICpcbiAqIFNlZSBpc1Blcm1hbmVudFdyaXRlRXJyb3IgZm9yIGNsYXNzaWZ5aW5nIHdyaXRlIGVycm9ycy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2lzUGVybWFuZW50RXJyb3IoZSkge1xuICAgIHN3aXRjaCAoZSkge1xuICAgICAgY2FzZSBDLk9LOlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuXG4gICAgICBjYXNlIEMuQ0FOQ0VMTEVEOlxuICAgICAgY2FzZSBDLlVOS05PV046XG4gICAgICBjYXNlIEMuREVBRExJTkVfRVhDRUVERUQ6XG4gICAgICBjYXNlIEMuUkVTT1VSQ0VfRVhIQVVTVEVEOlxuICAgICAgY2FzZSBDLklOVEVSTkFMOlxuICAgICAgY2FzZSBDLlVOQVZBSUxBQkxFOlxuIC8vIFVuYXV0aGVudGljYXRlZCBtZWFucyBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIG91ciB0b2tlbiBhbmQgd2UgbmVlZFxuICAgICAgICAvLyB0byByZXRyeSB3aXRoIG5ldyBjcmVkZW50aWFscyB3aGljaCB3aWxsIGhhcHBlbiBhdXRvbWF0aWNhbGx5LlxuICAgICAgICAgICAgICBjYXNlIEMuVU5BVVRIRU5USUNBVEVEOlxuICAgICAgICByZXR1cm4gITE7XG5cbiAgICAgIGNhc2UgQy5JTlZBTElEX0FSR1VNRU5UOlxuICAgICAgY2FzZSBDLk5PVF9GT1VORDpcbiAgICAgIGNhc2UgQy5BTFJFQURZX0VYSVNUUzpcbiAgICAgIGNhc2UgQy5QRVJNSVNTSU9OX0RFTklFRDpcbiAgICAgIGNhc2UgQy5GQUlMRURfUFJFQ09ORElUSU9OOlxuIC8vIEFib3J0ZWQgbWlnaHQgYmUgcmV0cmllZCBpbiBzb21lIHNjZW5hcmlvcywgYnV0IHRoYXQgaXMgZGVwZW5kZW50IG9uXG4gICAgICAgIC8vIHRoZSBjb250ZXh0IGFuZCBzaG91bGQgaGFuZGxlZCBpbmRpdmlkdWFsbHkgYnkgdGhlIGNhbGxpbmcgY29kZS5cbiAgICAgICAgLy8gU2VlIGh0dHBzOi8vY2xvdWQuZ29vZ2xlLmNvbS9hcGlzL2Rlc2lnbi9lcnJvcnMuXG4gICAgICAgICAgICAgIGNhc2UgQy5BQk9SVEVEOlxuICAgICAgY2FzZSBDLk9VVF9PRl9SQU5HRTpcbiAgICAgIGNhc2UgQy5VTklNUExFTUVOVEVEOlxuICAgICAgY2FzZSBDLkRBVEFfTE9TUzpcbiAgICAgICAgcmV0dXJuICEwO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHdoZXRoZXIgYW4gZXJyb3IgY29kZSByZXByZXNlbnRzIGEgcGVybWFuZW50IGVycm9yIHdoZW4gcmVjZWl2ZWRcbiAqIGluIHJlc3BvbnNlIHRvIGEgd3JpdGUgb3BlcmF0aW9uLlxuICpcbiAqIFdyaXRlIG9wZXJhdGlvbnMgbXVzdCBiZSBoYW5kbGVkIHNwZWNpYWxseSBiZWNhdXNlIGFzIG9mIGIvMTE5NDM3NzY0LCBBQk9SVEVEXG4gKiBlcnJvcnMgb24gdGhlIHdyaXRlIHN0cmVhbSBzaG91bGQgYmUgcmV0cmllZCB0b28gKGV2ZW4gdGhvdWdoIEFCT1JURUQgZXJyb3JzXG4gKiBhcmUgbm90IGdlbmVyYWxseSByZXRyeWFibGUpLlxuICpcbiAqIE5vdGUgdGhhdCBkdXJpbmcgdGhlIGluaXRpYWwgaGFuZHNoYWtlIG9uIHRoZSB3cml0ZSBzdHJlYW0gYW4gQUJPUlRFRCBlcnJvclxuICogc2lnbmFscyB0aGF0IHdlIHNob3VsZCBkaXNjYXJkIG91ciBzdHJlYW0gdG9rZW4gKGkuZS4gaXQgaXMgcGVybWFuZW50KS4gVGhpc1xuICogbWVhbnMgYSBoYW5kc2hha2UgZXJyb3Igc2hvdWxkIGJlIGNsYXNzaWZpZWQgd2l0aCBpc1Blcm1hbmVudEVycm9yLCBhYm92ZS5cbiAqL1xuLyoqXG4gKiBNYXBzIGFuIGVycm9yIENvZGUgZnJvbSBHUlBDIHN0YXR1cyBjb2RlIG51bWJlciwgbGlrZSAwLCAxLCBvciAxNC4gVGhlc2VcbiAqIGFyZSBub3QgdGhlIHNhbWUgYXMgSFRUUCBzdGF0dXMgY29kZXMuXG4gKlxuICogQHJldHVybnMgVGhlIENvZGUgZXF1aXZhbGVudCB0byB0aGUgZ2l2ZW4gR1JQQyBzdGF0dXMgY29kZS4gRmFpbHMgaWYgdGhlcmVcbiAqICAgICBpcyBubyBtYXRjaC5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX21hcENvZGVGcm9tUnBjQ29kZShlKSB7XG4gICAgaWYgKHZvaWQgMCA9PT0gZSkgXG4gICAgLy8gVGhpcyBzaG91bGRuJ3Qgbm9ybWFsbHkgaGFwcGVuLCBidXQgaW4gY2VydGFpbiBlcnJvciBjYXNlcyAobGlrZSB0cnlpbmdcbiAgICAvLyB0byBzZW5kIGludmFsaWQgcHJvdG8gbWVzc2FnZXMpIHdlIG1heSBnZXQgYW4gZXJyb3Igd2l0aCBubyBHUlBDIGNvZGUuXG4gICAgcmV0dXJuIF9fUFJJVkFURV9sb2dFcnJvcihcIkdSUEMgZXJyb3IgaGFzIG5vIC5jb2RlXCIpLCBDLlVOS05PV047XG4gICAgc3dpdGNoIChlKSB7XG4gICAgICBjYXNlIEV0Lk9LOlxuICAgICAgICByZXR1cm4gQy5PSztcblxuICAgICAgY2FzZSBFdC5DQU5DRUxMRUQ6XG4gICAgICAgIHJldHVybiBDLkNBTkNFTExFRDtcblxuICAgICAgY2FzZSBFdC5VTktOT1dOOlxuICAgICAgICByZXR1cm4gQy5VTktOT1dOO1xuXG4gICAgICBjYXNlIEV0LkRFQURMSU5FX0VYQ0VFREVEOlxuICAgICAgICByZXR1cm4gQy5ERUFETElORV9FWENFRURFRDtcblxuICAgICAgY2FzZSBFdC5SRVNPVVJDRV9FWEhBVVNURUQ6XG4gICAgICAgIHJldHVybiBDLlJFU09VUkNFX0VYSEFVU1RFRDtcblxuICAgICAgY2FzZSBFdC5JTlRFUk5BTDpcbiAgICAgICAgcmV0dXJuIEMuSU5URVJOQUw7XG5cbiAgICAgIGNhc2UgRXQuVU5BVkFJTEFCTEU6XG4gICAgICAgIHJldHVybiBDLlVOQVZBSUxBQkxFO1xuXG4gICAgICBjYXNlIEV0LlVOQVVUSEVOVElDQVRFRDpcbiAgICAgICAgcmV0dXJuIEMuVU5BVVRIRU5USUNBVEVEO1xuXG4gICAgICBjYXNlIEV0LklOVkFMSURfQVJHVU1FTlQ6XG4gICAgICAgIHJldHVybiBDLklOVkFMSURfQVJHVU1FTlQ7XG5cbiAgICAgIGNhc2UgRXQuTk9UX0ZPVU5EOlxuICAgICAgICByZXR1cm4gQy5OT1RfRk9VTkQ7XG5cbiAgICAgIGNhc2UgRXQuQUxSRUFEWV9FWElTVFM6XG4gICAgICAgIHJldHVybiBDLkFMUkVBRFlfRVhJU1RTO1xuXG4gICAgICBjYXNlIEV0LlBFUk1JU1NJT05fREVOSUVEOlxuICAgICAgICByZXR1cm4gQy5QRVJNSVNTSU9OX0RFTklFRDtcblxuICAgICAgY2FzZSBFdC5GQUlMRURfUFJFQ09ORElUSU9OOlxuICAgICAgICByZXR1cm4gQy5GQUlMRURfUFJFQ09ORElUSU9OO1xuXG4gICAgICBjYXNlIEV0LkFCT1JURUQ6XG4gICAgICAgIHJldHVybiBDLkFCT1JURUQ7XG5cbiAgICAgIGNhc2UgRXQuT1VUX09GX1JBTkdFOlxuICAgICAgICByZXR1cm4gQy5PVVRfT0ZfUkFOR0U7XG5cbiAgICAgIGNhc2UgRXQuVU5JTVBMRU1FTlRFRDpcbiAgICAgICAgcmV0dXJuIEMuVU5JTVBMRU1FTlRFRDtcblxuICAgICAgY2FzZSBFdC5EQVRBX0xPU1M6XG4gICAgICAgIHJldHVybiBDLkRBVEFfTE9TUztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ29udmVydHMgYW4gSFRUUCByZXNwb25zZSdzIGVycm9yIHN0YXR1cyB0byB0aGUgZXF1aXZhbGVudCBlcnJvciBjb2RlLlxuICpcbiAqIEBwYXJhbSBzdGF0dXMgLSBBbiBIVFRQIGVycm9yIHJlc3BvbnNlIHN0YXR1cyAoXCJGQUlMRURfUFJFQ09ORElUSU9OXCIsXG4gKiBcIlVOS05PV05cIiwgZXRjLilcbiAqIEByZXR1cm5zIFRoZSBlcXVpdmFsZW50IENvZGUuIE5vbi1tYXRjaGluZyByZXNwb25zZXMgYXJlIG1hcHBlZCB0b1xuICogICAgIENvZGUuVU5LTk9XTi5cbiAqLyAoZHQgPSBFdCB8fCAoRXQgPSB7fSkpW2R0Lk9LID0gMF0gPSBcIk9LXCIsIGR0W2R0LkNBTkNFTExFRCA9IDFdID0gXCJDQU5DRUxMRURcIiwgXG5kdFtkdC5VTktOT1dOID0gMl0gPSBcIlVOS05PV05cIiwgZHRbZHQuSU5WQUxJRF9BUkdVTUVOVCA9IDNdID0gXCJJTlZBTElEX0FSR1VNRU5UXCIsIFxuZHRbZHQuREVBRExJTkVfRVhDRUVERUQgPSA0XSA9IFwiREVBRExJTkVfRVhDRUVERURcIiwgZHRbZHQuTk9UX0ZPVU5EID0gNV0gPSBcIk5PVF9GT1VORFwiLCBcbmR0W2R0LkFMUkVBRFlfRVhJU1RTID0gNl0gPSBcIkFMUkVBRFlfRVhJU1RTXCIsIGR0W2R0LlBFUk1JU1NJT05fREVOSUVEID0gN10gPSBcIlBFUk1JU1NJT05fREVOSUVEXCIsIFxuZHRbZHQuVU5BVVRIRU5USUNBVEVEID0gMTZdID0gXCJVTkFVVEhFTlRJQ0FURURcIiwgZHRbZHQuUkVTT1VSQ0VfRVhIQVVTVEVEID0gOF0gPSBcIlJFU09VUkNFX0VYSEFVU1RFRFwiLCBcbmR0W2R0LkZBSUxFRF9QUkVDT05ESVRJT04gPSA5XSA9IFwiRkFJTEVEX1BSRUNPTkRJVElPTlwiLCBkdFtkdC5BQk9SVEVEID0gMTBdID0gXCJBQk9SVEVEXCIsIFxuZHRbZHQuT1VUX09GX1JBTkdFID0gMTFdID0gXCJPVVRfT0ZfUkFOR0VcIiwgZHRbZHQuVU5JTVBMRU1FTlRFRCA9IDEyXSA9IFwiVU5JTVBMRU1FTlRFRFwiLCBcbmR0W2R0LklOVEVSTkFMID0gMTNdID0gXCJJTlRFUk5BTFwiLCBkdFtkdC5VTkFWQUlMQUJMRSA9IDE0XSA9IFwiVU5BVkFJTEFCTEVcIiwgZHRbZHQuREFUQV9MT1NTID0gMTVdID0gXCJEQVRBX0xPU1NcIjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIGdsb2JhbCwgc2luZ2xldG9uIGluc3RhbmNlIG9mIFRlc3RpbmdIb29rc1NwaS5cbiAqXG4gKiBUaGlzIHZhcmlhYmxlIHdpbGwgYmUgYG51bGxgIGluIGFsbCBjYXNlcyBfZXhjZXB0XyB3aGVuIHJ1bm5pbmcgZnJvbVxuICogaW50ZWdyYXRpb24gdGVzdHMgdGhhdCBoYXZlIHJlZ2lzdGVyZWQgY2FsbGJhY2tzIHRvIGJlIG5vdGlmaWVkIG9mIGV2ZW50c1xuICogdGhhdCBoYXBwZW4gZHVyaW5nIHRoZSB0ZXN0IGV4ZWN1dGlvbi5cbiAqL1xubGV0IEF0ID0gbnVsbDtcblxuLyoqXG4gKiBTZXRzIHRoZSB2YWx1ZSBvZiB0aGUgYHRlc3RpbmdIb29rc1NwaWAgb2JqZWN0LlxuICogQHBhcmFtIGluc3RhbmNlIHRoZSBpbnN0YW5jZSB0byBzZXQuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBSdCA9IG5ldyBJbnRlZ2VyKFsgNDI5NDk2NzI5NSwgNDI5NDk2NzI5NSBdLCAwKTtcblxuLy8gSGFzaCBhIHN0cmluZyB1c2luZyBtZDUgaGFzaGluZyBhbGdvcml0aG0uXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0TWQ1SGFzaFZhbHVlKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld1RleHRFbmNvZGVyKCkuZW5jb2RlKGUpLCBuID0gbmV3IE1kNTtcbiAgICByZXR1cm4gbi51cGRhdGUodCksIG5ldyBVaW50OEFycmF5KG4uZGlnZXN0KCkpO1xufVxuXG4vLyBJbnRlcnByZXQgdGhlIDE2IGJ5dGVzIGFycmF5IGFzIHR3byA2NC1iaXQgdW5zaWduZWQgaW50ZWdlcnMsIGVuY29kZWQgdXNpbmdcbi8vIDLigJlzIGNvbXBsZW1lbnQgdXNpbmcgbGl0dGxlIGVuZGlhbi5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXQ2NEJpdFVpbnRzKGUpIHtcbiAgICBjb25zdCB0ID0gbmV3IERhdGFWaWV3KGUuYnVmZmVyKSwgbiA9IHQuZ2V0VWludDMyKDAsIC8qIGxpdHRsZUVuZGlhbj0gKi8gITApLCByID0gdC5nZXRVaW50MzIoNCwgLyogbGl0dGxlRW5kaWFuPSAqLyAhMCksIGkgPSB0LmdldFVpbnQzMig4LCAvKiBsaXR0bGVFbmRpYW49ICovICEwKSwgcyA9IHQuZ2V0VWludDMyKDEyLCAvKiBsaXR0bGVFbmRpYW49ICovICEwKTtcbiAgICByZXR1cm4gWyBuZXcgSW50ZWdlcihbIG4sIHIgXSwgMCksIG5ldyBJbnRlZ2VyKFsgaSwgcyBdLCAwKSBdO1xufVxuXG5jbGFzcyBCbG9vbUZpbHRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICBpZiAodGhpcy5iaXRtYXAgPSBlLCB0aGlzLnBhZGRpbmcgPSB0LCB0aGlzLmhhc2hDb3VudCA9IG4sIHQgPCAwIHx8IHQgPj0gOCkgdGhyb3cgbmV3IF9fUFJJVkFURV9CbG9vbUZpbHRlckVycm9yKGBJbnZhbGlkIHBhZGRpbmc6ICR7dH1gKTtcbiAgICAgICAgaWYgKG4gPCAwKSB0aHJvdyBuZXcgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IoYEludmFsaWQgaGFzaCBjb3VudDogJHtufWApO1xuICAgICAgICBpZiAoZS5sZW5ndGggPiAwICYmIDAgPT09IHRoaXMuaGFzaENvdW50KSBcbiAgICAgICAgLy8gT25seSBlbXB0eSBibG9vbSBmaWx0ZXIgY2FuIGhhdmUgMCBoYXNoIGNvdW50LlxuICAgICAgICB0aHJvdyBuZXcgX19QUklWQVRFX0Jsb29tRmlsdGVyRXJyb3IoYEludmFsaWQgaGFzaCBjb3VudDogJHtufWApO1xuICAgICAgICBpZiAoMCA9PT0gZS5sZW5ndGggJiYgMCAhPT0gdCkgXG4gICAgICAgIC8vIEVtcHR5IGJsb29tIGZpbHRlciBzaG91bGQgaGF2ZSAwIHBhZGRpbmcuXG4gICAgICAgIHRocm93IG5ldyBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvcihgSW52YWxpZCBwYWRkaW5nIHdoZW4gYml0bWFwIGxlbmd0aCBpcyAwOiAke3R9YCk7XG4gICAgICAgIHRoaXMuRWUgPSA4ICogZS5sZW5ndGggLSB0LCBcbiAgICAgICAgLy8gU2V0IHRoZSBiaXQgY291bnQgaW4gSW50ZWdlciB0byBhdm9pZCByZXBldGl0aW9uIGluIG1pZ2h0Q29udGFpbigpLlxuICAgICAgICB0aGlzLmRlID0gSW50ZWdlci5mcm9tTnVtYmVyKHRoaXMuRWUpO1xuICAgIH1cbiAgICAvLyBDYWxjdWxhdGUgdGhlIGl0aCBoYXNoIHZhbHVlIGJhc2VkIG9uIHRoZSBoYXNoZWQgNjRiaXQgaW50ZWdlcnMsXG4gICAgLy8gYW5kIGNhbGN1bGF0ZSBpdHMgY29ycmVzcG9uZGluZyBiaXQgaW5kZXggaW4gdGhlIGJpdG1hcCB0byBiZSBjaGVja2VkLlxuICAgIEFlKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIGhhc2hlZCB2YWx1ZSBoKGkpID0gaDEgKyAoaSAqIGgyKS5cbiAgICAgICAgbGV0IHIgPSBlLmFkZCh0Lm11bHRpcGx5KEludGVnZXIuZnJvbU51bWJlcihuKSkpO1xuICAgICAgICAvLyBXcmFwIGlmIGhhc2ggdmFsdWUgb3ZlcmZsb3cgNjRiaXQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIDEgPT09IHIuY29tcGFyZShSdCkgJiYgKHIgPSBuZXcgSW50ZWdlcihbIHIuZ2V0Qml0cygwKSwgci5nZXRCaXRzKDEpIF0sIDApKSwgXG4gICAgICAgIHIubW9kdWxvKHRoaXMuZGUpLnRvTnVtYmVyKCk7XG4gICAgfVxuICAgIC8vIFJldHVybiB3aGV0aGVyIHRoZSBiaXQgb24gdGhlIGdpdmVuIGluZGV4IGluIHRoZSBiaXRtYXAgaXMgc2V0IHRvIDEuXG4gICAgUmUoZSkge1xuICAgICAgICByZXR1cm4gISEodGhpcy5iaXRtYXBbTWF0aC5mbG9vcihlIC8gOCldICYgMSA8PCBlICUgOCk7XG4gICAgfVxuICAgIG1pZ2h0Q29udGFpbihlKSB7XG4gICAgICAgIC8vIEVtcHR5IGJpdG1hcCBzaG91bGQgYWx3YXlzIHJldHVybiBmYWxzZSBvbiBtZW1iZXJzaGlwIGNoZWNrLlxuICAgICAgICBpZiAoMCA9PT0gdGhpcy5FZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2dldE1kNUhhc2hWYWx1ZShlKSwgW24sIHJdID0gX19QUklWQVRFX2dldDY0Qml0VWludHModCk7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgdGhpcy5oYXNoQ291bnQ7IGUrKykge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuQWUobiwgciwgZSk7XG4gICAgICAgICAgICBpZiAoIXRoaXMuUmUodCkpIHJldHVybiAhMTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITA7XG4gICAgfVxuICAgIC8qKiBDcmVhdGUgYmxvb20gZmlsdGVyIGZvciB0ZXN0aW5nIHB1cnBvc2VzIG9ubHkuICovICAgIHN0YXRpYyBjcmVhdGUoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gZSAlIDggPT0gMCA/IDAgOiA4IC0gZSAlIDgsIGkgPSBuZXcgVWludDhBcnJheShNYXRoLmNlaWwoZSAvIDgpKSwgcyA9IG5ldyBCbG9vbUZpbHRlcihpLCByLCB0KTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoZSA9PiBzLmluc2VydChlKSkpLCBzO1xuICAgIH1cbiAgICBpbnNlcnQoZSkge1xuICAgICAgICBpZiAoMCA9PT0gdGhpcy5FZSkgcmV0dXJuO1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2dldE1kNUhhc2hWYWx1ZShlKSwgW24sIHJdID0gX19QUklWQVRFX2dldDY0Qml0VWludHModCk7XG4gICAgICAgIGZvciAobGV0IGUgPSAwOyBlIDwgdGhpcy5oYXNoQ291bnQ7IGUrKykge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuQWUobiwgciwgZSk7XG4gICAgICAgICAgICB0aGlzLlZlKHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIFZlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IE1hdGguZmxvb3IoZSAvIDgpLCBuID0gZSAlIDg7XG4gICAgICAgIHRoaXMuYml0bWFwW3RdIHw9IDEgPDwgbjtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9CbG9vbUZpbHRlckVycm9yIGV4dGVuZHMgRXJyb3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlciguLi5hcmd1bWVudHMpLCB0aGlzLm5hbWUgPSBcIkJsb29tRmlsdGVyRXJyb3JcIjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGV2ZW50IGZyb20gdGhlIFJlbW90ZVN0b3JlLiBJdCBpcyBzcGxpdCBpbnRvIHRhcmdldENoYW5nZXMgKGNoYW5nZXMgdG8gdGhlXG4gKiBzdGF0ZSBvciB0aGUgc2V0IG9mIGRvY3VtZW50cyBpbiBvdXIgd2F0Y2hlZCB0YXJnZXRzKSBhbmQgZG9jdW1lbnRVcGRhdGVzXG4gKiAoY2hhbmdlcyB0byB0aGUgYWN0dWFsIGRvY3VtZW50cykuXG4gKi8gY2xhc3MgUmVtb3RlRXZlbnQge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBzbmFwc2hvdCB2ZXJzaW9uIHRoaXMgZXZlbnQgYnJpbmdzIHVzIHVwIHRvLCBvciBNSU4gaWYgbm90IHNldC5cbiAgICAgKi9cbiAgICBlLCBcbiAgICAvKipcbiAgICAgKiBBIG1hcCBmcm9tIHRhcmdldCB0byBjaGFuZ2VzIHRvIHRoZSB0YXJnZXQuIFNlZSBUYXJnZXRDaGFuZ2UuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogQSBtYXAgb2YgdGFyZ2V0cyB0aGF0IGlzIGtub3duIHRvIGJlIGluY29uc2lzdGVudCwgYW5kIHRoZSBwdXJwb3NlIGZvclxuICAgICAqIHJlLWxpc3RlbmluZy4gTGlzdGVucyBmb3IgdGhlc2UgdGFyZ2V0cyBzaG91bGQgYmUgcmUtZXN0YWJsaXNoZWQgd2l0aG91dFxuICAgICAqIHJlc3VtZSB0b2tlbnMuXG4gICAgICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogQSBzZXQgb2Ygd2hpY2ggZG9jdW1lbnRzIGhhdmUgY2hhbmdlZCBvciBiZWVuIGRlbGV0ZWQsIGFsb25nIHdpdGggdGhlXG4gICAgICogZG9jJ3MgbmV3IHZhbHVlcyAoaWYgbm90IGRlbGV0ZWQpLlxuICAgICAqL1xuICAgIHIsIFxuICAgIC8qKlxuICAgICAqIEEgc2V0IG9mIHdoaWNoIGRvY3VtZW50IHVwZGF0ZXMgYXJlIGR1ZSBvbmx5IHRvIGxpbWJvIHJlc29sdXRpb24gdGFyZ2V0cy5cbiAgICAgKi9cbiAgICBpKSB7XG4gICAgICAgIHRoaXMuc25hcHNob3RWZXJzaW9uID0gZSwgdGhpcy50YXJnZXRDaGFuZ2VzID0gdCwgdGhpcy50YXJnZXRNaXNtYXRjaGVzID0gbiwgdGhpcy5kb2N1bWVudFVwZGF0ZXMgPSByLCBcbiAgICAgICAgdGhpcy5yZXNvbHZlZExpbWJvRG9jdW1lbnRzID0gaTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSEFDSzogVmlld3MgcmVxdWlyZSBSZW1vdGVFdmVudHMgaW4gb3JkZXIgdG8gZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIHZpZXcgaXNcbiAgICAgKiBDVVJSRU5ULCBidXQgc2Vjb25kYXJ5IHRhYnMgZG9uJ3QgcmVjZWl2ZSByZW1vdGUgZXZlbnRzLiBTbyB0aGlzIG1ldGhvZCBpc1xuICAgICAqIHVzZWQgdG8gY3JlYXRlIGEgc3ludGhlc2l6ZWQgUmVtb3RlRXZlbnQgdGhhdCBjYW4gYmUgdXNlZCB0byBhcHBseSBhXG4gICAgICogQ1VSUkVOVCBzdGF0dXMgY2hhbmdlIHRvIGEgVmlldywgZm9yIHF1ZXJpZXMgZXhlY3V0ZWQgaW4gYSBkaWZmZXJlbnQgdGFiLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHlcbiAgICBzdGF0aWMgY3JlYXRlU3ludGhlc2l6ZWRSZW1vdGVFdmVudEZvckN1cnJlbnRDaGFuZ2UoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gbmV3IE1hcDtcbiAgICAgICAgcmV0dXJuIHIuc2V0KGUsIFRhcmdldENoYW5nZS5jcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UoZSwgdCwgbikpLCBcbiAgICAgICAgbmV3IFJlbW90ZUV2ZW50KFNuYXBzaG90VmVyc2lvbi5taW4oKSwgciwgbmV3IFNvcnRlZE1hcChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciksIF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIFRhcmdldENoYW5nZSBzcGVjaWZpZXMgdGhlIHNldCBvZiBjaGFuZ2VzIGZvciBhIHNwZWNpZmljIHRhcmdldCBhcyBwYXJ0IG9mXG4gKiBhIFJlbW90ZUV2ZW50LiBUaGVzZSBjaGFuZ2VzIHRyYWNrIHdoaWNoIGRvY3VtZW50cyBhcmUgYWRkZWQsIG1vZGlmaWVkIG9yXG4gKiByZW1vdmVkLCBhcyB3ZWxsIGFzIHRoZSB0YXJnZXQncyByZXN1bWUgdG9rZW4gYW5kIHdoZXRoZXIgdGhlIHRhcmdldCBpc1xuICogbWFya2VkIENVUlJFTlQuXG4gKiBUaGUgYWN0dWFsIGNoYW5nZXMgKnRvKiBkb2N1bWVudHMgYXJlIG5vdCBwYXJ0IG9mIHRoZSBUYXJnZXRDaGFuZ2Ugc2luY2VcbiAqIGRvY3VtZW50cyBtYXkgYmUgcGFydCBvZiBtdWx0aXBsZSB0YXJnZXRzLlxuICovIGNsYXNzIFRhcmdldENoYW5nZSB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqXG4gICAgICogQW4gb3BhcXVlLCBzZXJ2ZXItYXNzaWduZWQgdG9rZW4gdGhhdCBhbGxvd3Mgd2F0Y2hpbmcgYSBxdWVyeSB0byBiZSByZXN1bWVkXG4gICAgICogYWZ0ZXIgZGlzY29ubmVjdGluZyB3aXRob3V0IHJldHJhbnNtaXR0aW5nIGFsbCB0aGUgZGF0YSB0aGF0IG1hdGNoZXMgdGhlXG4gICAgICogcXVlcnkuIFRoZSByZXN1bWUgdG9rZW4gZXNzZW50aWFsbHkgaWRlbnRpZmllcyBhIHBvaW50IGluIHRpbWUgZnJvbSB3aGljaFxuICAgICAqIHRoZSBzZXJ2ZXIgc2hvdWxkIHJlc3VtZSBzZW5kaW5nIHJlc3VsdHMuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIFwiY3VycmVudFwiIChzeW5jZWQpIHN0YXR1cyBvZiB0aGlzIHRhcmdldC4gTm90ZSB0aGF0IFwiY3VycmVudFwiXG4gICAgICogaGFzIHNwZWNpYWwgbWVhbmluZyBpbiB0aGUgUlBDIHByb3RvY29sIHRoYXQgaW1wbGllcyB0aGF0IGEgdGFyZ2V0IGlzXG4gICAgICogYm90aCB1cC10by1kYXRlIGFuZCBjb25zaXN0ZW50IHdpdGggdGhlIHJlc3Qgb2YgdGhlIHdhdGNoIHN0cmVhbS5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2V0IG9mIGRvY3VtZW50cyB0aGF0IHdlcmUgbmV3bHkgYXNzaWduZWQgdG8gdGhpcyB0YXJnZXQgYXMgcGFydCBvZlxuICAgICAqIHRoaXMgcmVtb3RlIGV2ZW50LlxuICAgICAqL1xuICAgIG4sIFxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgd2VyZSBhbHJlYWR5IGFzc2lnbmVkIHRvIHRoaXMgdGFyZ2V0IGJ1dCByZWNlaXZlZFxuICAgICAqIGFuIHVwZGF0ZSBkdXJpbmcgdGhpcyByZW1vdGUgZXZlbnQuXG4gICAgICovXG4gICAgciwgXG4gICAgLyoqXG4gICAgICogVGhlIHNldCBvZiBkb2N1bWVudHMgdGhhdCB3ZXJlIHJlbW92ZWQgZnJvbSB0aGlzIHRhcmdldCBhcyBwYXJ0IG9mIHRoaXNcbiAgICAgKiByZW1vdGUgZXZlbnQuXG4gICAgICovXG4gICAgaSkge1xuICAgICAgICB0aGlzLnJlc3VtZVRva2VuID0gZSwgdGhpcy5jdXJyZW50ID0gdCwgdGhpcy5hZGRlZERvY3VtZW50cyA9IG4sIHRoaXMubW9kaWZpZWREb2N1bWVudHMgPSByLCBcbiAgICAgICAgdGhpcy5yZW1vdmVkRG9jdW1lbnRzID0gaTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhpcyBtZXRob2QgaXMgdXNlZCB0byBjcmVhdGUgYSBzeW50aGVzaXplZCBUYXJnZXRDaGFuZ2VzIHRoYXQgY2FuIGJlIHVzZWQgdG9cbiAgICAgKiBhcHBseSBhIENVUlJFTlQgc3RhdHVzIGNoYW5nZSB0byBhIFZpZXcgKGZvciBxdWVyaWVzIGV4ZWN1dGVkIGluIGEgZGlmZmVyZW50XG4gICAgICogdGFiKSBvciBmb3IgbmV3IHF1ZXJpZXMgKHRvIHJhaXNlIHNuYXBzaG90cyB3aXRoIGNvcnJlY3QgQ1VSUkVOVCBzdGF0dXMpLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlU3ludGhlc2l6ZWRUYXJnZXRDaGFuZ2VGb3JDdXJyZW50Q2hhbmdlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXRDaGFuZ2UobiwgdCwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGEgY2hhbmdlZCBkb2N1bWVudCBhbmQgYSBsaXN0IG9mIHRhcmdldCBpZHMgdG8gd2hpY2ggdGhpcyBjaGFuZ2VcbiAqIGFwcGxpZXMuXG4gKlxuICogSWYgZG9jdW1lbnQgaGFzIGJlZW4gZGVsZXRlZCBOb0RvY3VtZW50IHdpbGwgYmUgcHJvdmlkZWQuXG4gKi8gY2xhc3MgX19QUklWQVRFX0RvY3VtZW50V2F0Y2hDaGFuZ2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgbmV3IGRvY3VtZW50IGFwcGxpZXMgdG8gYWxsIG9mIHRoZXNlIHRhcmdldHMuICovXG4gICAgZSwgXG4gICAgLyoqIFRoZSBuZXcgZG9jdW1lbnQgaXMgcmVtb3ZlZCBmcm9tIGFsbCBvZiB0aGVzZSB0YXJnZXRzLiAqL1xuICAgIHQsIFxuICAgIC8qKiBUaGUga2V5IG9mIHRoZSBkb2N1bWVudCBmb3IgdGhpcyBjaGFuZ2UuICovXG4gICAgbiwgXG4gICAgLyoqXG4gICAgICogVGhlIG5ldyBkb2N1bWVudCBvciBOb0RvY3VtZW50IGlmIGl0IHdhcyBkZWxldGVkLiBJcyBudWxsIGlmIHRoZVxuICAgICAqIGRvY3VtZW50IHdlbnQgb3V0IG9mIHZpZXcgd2l0aG91dCB0aGUgc2VydmVyIHNlbmRpbmcgYSBuZXcgZG9jdW1lbnQuXG4gICAgICovXG4gICAgcikge1xuICAgICAgICB0aGlzLm1lID0gZSwgdGhpcy5yZW1vdmVkVGFyZ2V0SWRzID0gdCwgdGhpcy5rZXkgPSBuLCB0aGlzLmZlID0gcjtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9FeGlzdGVuY2VGaWx0ZXJDaGFuZ2Uge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IGUsIHRoaXMuZ2UgPSB0O1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX1dhdGNoVGFyZ2V0Q2hhbmdlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogV2hhdCBraW5kIG9mIGNoYW5nZSBvY2N1cnJlZCB0byB0aGUgd2F0Y2ggdGFyZ2V0LiAqL1xuICAgIGUsIFxuICAgIC8qKiBUaGUgdGFyZ2V0IElEcyB0aGF0IHdlcmUgYWRkZWQvcmVtb3ZlZC9zZXQuICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogQW4gb3BhcXVlLCBzZXJ2ZXItYXNzaWduZWQgdG9rZW4gdGhhdCBhbGxvd3Mgd2F0Y2hpbmcgYSB0YXJnZXQgdG8gYmVcbiAgICAgKiByZXN1bWVkIGFmdGVyIGRpc2Nvbm5lY3Rpbmcgd2l0aG91dCByZXRyYW5zbWl0dGluZyBhbGwgdGhlIGRhdGEgdGhhdFxuICAgICAqIG1hdGNoZXMgdGhlIHRhcmdldC4gVGhlIHJlc3VtZSB0b2tlbiBlc3NlbnRpYWxseSBpZGVudGlmaWVzIGEgcG9pbnQgaW5cbiAgICAgKiB0aW1lIGZyb20gd2hpY2ggdGhlIHNlcnZlciBzaG91bGQgcmVzdW1lIHNlbmRpbmcgcmVzdWx0cy5cbiAgICAgKi9cbiAgICBuID0gQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklOR1xuICAgIC8qKiBBbiBSUEMgZXJyb3IgaW5kaWNhdGluZyB3aHkgdGhlIHdhdGNoIGZhaWxlZC4gKi8gLCByID0gbnVsbCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gZSwgdGhpcy50YXJnZXRJZHMgPSB0LCB0aGlzLnJlc3VtZVRva2VuID0gbiwgdGhpcy5jYXVzZSA9IHI7XG4gICAgfVxufVxuXG4vKiogVHJhY2tzIHRoZSBpbnRlcm5hbCBzdGF0ZSBvZiBhIFdhdGNoIHRhcmdldC4gKi8gY2xhc3MgX19QUklWQVRFX1RhcmdldFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFRoZSBudW1iZXIgb2YgcGVuZGluZyByZXNwb25zZXMgKGFkZHMgb3IgcmVtb3ZlcykgdGhhdCB3ZSBhcmUgd2FpdGluZyBvbi5cbiAgICAgICAgICogV2Ugb25seSBjb25zaWRlciB0YXJnZXRzIGFjdGl2ZSB0aGF0IGhhdmUgbm8gcGVuZGluZyByZXNwb25zZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBlID0gMCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgZG9jdW1lbnQgY2hhbmdlcyBzaW5jZSB0aGUgbGFzdCByYWlzZWQgc25hcHNob3QuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZXNlIGNoYW5nZXMgYXJlIGNvbnRpbnVvdXNseSB1cGRhdGVkIGFzIHdlIHJlY2VpdmUgZG9jdW1lbnQgdXBkYXRlcyBhbmRcbiAgICAgICAgICogYWx3YXlzIHJlZmxlY3QgdGhlIGN1cnJlbnQgc2V0IG9mIGNoYW5nZXMgYWdhaW5zdCB0aGUgbGFzdCBpc3N1ZWQgc25hcHNob3QuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnllID0gX19QUklWQVRFX3NuYXBzaG90Q2hhbmdlc01hcCgpLCBcbiAgICAgICAgLyoqIFNlZSBwdWJsaWMgZ2V0dGVycyBmb3IgZXhwbGFuYXRpb25zIG9mIHRoZXNlIGZpZWxkcy4gKi9cbiAgICAgICAgdGhpcy53ZSA9IEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcsIHRoaXMuU2UgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBXaGV0aGVyIHRoaXMgdGFyZ2V0IHN0YXRlIHNob3VsZCBiZSBpbmNsdWRlZCBpbiB0aGUgbmV4dCBzbmFwc2hvdC4gV2VcbiAgICAgICAgICogaW5pdGlhbGl6ZSB0byB0cnVlIHNvIHRoYXQgbmV3bHktYWRkZWQgdGFyZ2V0cyBhcmUgaW5jbHVkZWQgaW4gdGhlIG5leHRcbiAgICAgICAgICogUmVtb3RlRXZlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmJlID0gITA7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdoZXRoZXIgdGhpcyB0YXJnZXQgaGFzIGJlZW4gbWFya2VkICdjdXJyZW50Jy5cbiAgICAgKlxuICAgICAqICdDdXJyZW50JyBoYXMgc3BlY2lhbCBtZWFuaW5nIGluIHRoZSBSUEMgcHJvdG9jb2w6IEl0IGltcGxpZXMgdGhhdCB0aGVcbiAgICAgKiBXYXRjaCBiYWNrZW5kIGhhcyBzZW50IHVzIGFsbCBjaGFuZ2VzIHVwIHRvIHRoZSBwb2ludCBhdCB3aGljaCB0aGUgdGFyZ2V0XG4gICAgICogd2FzIGFkZGVkIGFuZCB0aGF0IHRoZSB0YXJnZXQgaXMgY29uc2lzdGVudCB3aXRoIHRoZSByZXN0IG9mIHRoZSB3YXRjaFxuICAgICAqIHN0cmVhbS5cbiAgICAgKi8gICAgZ2V0IGN1cnJlbnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlNlO1xuICAgIH1cbiAgICAvKiogVGhlIGxhc3QgcmVzdW1lIHRva2VuIHNlbnQgdG8gdXMgZm9yIHRoaXMgdGFyZ2V0LiAqLyAgICBnZXQgcmVzdW1lVG9rZW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLndlO1xuICAgIH1cbiAgICAvKiogV2hldGhlciB0aGlzIHRhcmdldCBoYXMgcGVuZGluZyB0YXJnZXQgYWRkcyBvciB0YXJnZXQgcmVtb3Zlcy4gKi8gICAgZ2V0IERlKCkge1xuICAgICAgICByZXR1cm4gMCAhPT0gdGhpcy5wZTtcbiAgICB9XG4gICAgLyoqIFdoZXRoZXIgd2UgaGF2ZSBtb2RpZmllZCBhbnkgc3RhdGUgdGhhdCBzaG91bGQgdHJpZ2dlciBhIHNuYXBzaG90LiAqLyAgICBnZXQgdmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmJlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBsaWVzIHRoZSByZXN1bWUgdG9rZW4gdG8gdGhlIFRhcmdldENoYW5nZSwgYnV0IG9ubHkgd2hlbiBpdCBoYXMgYSBuZXdcbiAgICAgKiB2YWx1ZS4gRW1wdHkgcmVzdW1lVG9rZW5zIGFyZSBkaXNjYXJkZWQuXG4gICAgICovICAgIENlKGUpIHtcbiAgICAgICAgZS5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwICYmICh0aGlzLmJlID0gITAsIHRoaXMud2UgPSBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHRhcmdldCBjaGFuZ2UgZnJvbSB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy5cbiAgICAgKlxuICAgICAqIFRvIHJlc2V0IHRoZSBkb2N1bWVudCBjaGFuZ2VzIGFmdGVyIHJhaXNpbmcgdGhpcyBzbmFwc2hvdCwgY2FsbFxuICAgICAqIGBjbGVhclBlbmRpbmdDaGFuZ2VzKClgLlxuICAgICAqLyAgICBGZSgpIHtcbiAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgdCA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBuID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLnllLmZvckVhY2goKChyLCBpKSA9PiB7XG4gICAgICAgICAgICBzd2l0Y2ggKGkpIHtcbiAgICAgICAgICAgICAgY2FzZSAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gOlxuICAgICAgICAgICAgICAgIGUgPSBlLmFkZChyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA6XG4gICAgICAgICAgICAgICAgdCA9IHQuYWRkKHIpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgIG4gPSBuLmFkZChyKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBuZXcgVGFyZ2V0Q2hhbmdlKHRoaXMud2UsIHRoaXMuU2UsIGUsIHQsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGRvY3VtZW50IGNoYW5nZXMgYW5kIHNldHMgYGhhc1BlbmRpbmdDaGFuZ2VzYCB0byBmYWxzZS5cbiAgICAgKi8gICAgTWUoKSB7XG4gICAgICAgIHRoaXMuYmUgPSAhMSwgdGhpcy55ZSA9IF9fUFJJVkFURV9zbmFwc2hvdENoYW5nZXNNYXAoKTtcbiAgICB9XG4gICAgeGUoZSwgdCkge1xuICAgICAgICB0aGlzLmJlID0gITAsIHRoaXMueWUgPSB0aGlzLnllLmluc2VydChlLCB0KTtcbiAgICB9XG4gICAgT2UoZSkge1xuICAgICAgICB0aGlzLmJlID0gITAsIHRoaXMueWUgPSB0aGlzLnllLnJlbW92ZShlKTtcbiAgICB9XG4gICAgTmUoKSB7XG4gICAgICAgIHRoaXMucGUgKz0gMTtcbiAgICB9XG4gICAgQmUoKSB7XG4gICAgICAgIHRoaXMucGUgLT0gMSwgX19QUklWQVRFX2hhcmRBc3NlcnQodGhpcy5wZSA+PSAwKTtcbiAgICB9XG4gICAgTGUoKSB7XG4gICAgICAgIHRoaXMuYmUgPSAhMCwgdGhpcy5TZSA9ICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGhlbHBlciBjbGFzcyB0byBhY2N1bXVsYXRlIHdhdGNoIGNoYW5nZXMgaW50byBhIFJlbW90ZUV2ZW50LlxuICovXG5jbGFzcyBfX1BSSVZBVEVfV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2UgPSBlLCBcbiAgICAgICAgLyoqIFRoZSBpbnRlcm5hbCBzdGF0ZSBvZiBhbGwgdHJhY2tlZCB0YXJnZXRzLiAqL1xuICAgICAgICB0aGlzLnFlID0gbmV3IE1hcCwgXG4gICAgICAgIC8qKiBLZWVwcyB0cmFjayBvZiB0aGUgZG9jdW1lbnRzIHRvIHVwZGF0ZSBzaW5jZSB0aGUgbGFzdCByYWlzZWQgc25hcHNob3QuICovXG4gICAgICAgIHRoaXMuUWUgPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIHRoaXMuJGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRNYXAoKSwgXG4gICAgICAgIC8qKiBBIG1hcHBpbmcgb2YgZG9jdW1lbnQga2V5cyB0byB0aGVpciBzZXQgb2YgdGFyZ2V0IElEcy4gKi9cbiAgICAgICAgdGhpcy5VZSA9IF9fUFJJVkFURV9kb2N1bWVudFRhcmdldE1hcCgpLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgbWFwIG9mIHRhcmdldHMgd2l0aCBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuIFRoZXNlIHRhcmdldHMgYXJlXG4gICAgICAgICAqIGtub3duIHRvIGJlIGluY29uc2lzdGVudCBhbmQgdGhlaXIgbGlzdGVucyBuZWVkcyB0byBiZSByZS1lc3RhYmxpc2hlZCBieVxuICAgICAgICAgKiBSZW1vdGVTdG9yZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuS2UgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHJvY2Vzc2VzIGFuZCBhZGRzIHRoZSBEb2N1bWVudFdhdGNoQ2hhbmdlIHRvIHRoZSBjdXJyZW50IHNldCBvZiBjaGFuZ2VzLlxuICAgICAqLyAgICBXZShlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLm1lKSBlLmZlICYmIGUuZmUuaXNGb3VuZERvY3VtZW50KCkgPyB0aGlzLkdlKHQsIGUuZmUpIDogdGhpcy56ZSh0LCBlLmtleSwgZS5mZSk7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLnJlbW92ZWRUYXJnZXRJZHMpIHRoaXMuemUodCwgZS5rZXksIGUuZmUpO1xuICAgIH1cbiAgICAvKiogUHJvY2Vzc2VzIGFuZCBhZGRzIHRoZSBXYXRjaFRhcmdldENoYW5nZSB0byB0aGUgY3VycmVudCBzZXQgb2YgY2hhbmdlcy4gKi8gICAgamUoZSkge1xuICAgICAgICB0aGlzLmZvckVhY2hUYXJnZXQoZSwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IHRoaXMuSGUodCk7XG4gICAgICAgICAgICBzd2l0Y2ggKGUuc3RhdGUpIHtcbiAgICAgICAgICAgICAgY2FzZSAwIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuTm9DaGFuZ2UgKi8gOlxuICAgICAgICAgICAgICAgIHRoaXMuSmUodCkgJiYgbi5DZShlLnJlc3VtZVRva2VuKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDEgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLkJlKCksIG4uRGUgfHwgXG4gICAgICAgICAgICAgICAgLy8gV2UgaGF2ZSBhIGZyZXNobHkgYWRkZWQgdGFyZ2V0LCBzbyB3ZSBuZWVkIHRvIHJlc2V0IGFueSBzdGF0ZVxuICAgICAgICAgICAgICAgIC8vIHRoYXQgd2UgaGFkIHByZXZpb3VzbHkuIFRoaXMgY2FuIGhhcHBlbiBlLmcuIHdoZW4gcmVtb3ZlIGFuZCBhZGRcbiAgICAgICAgICAgICAgICAvLyBiYWNrIGEgdGFyZ2V0IGZvciBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuXG4gICAgICAgICAgICAgICAgbi5NZSgpLCBuLkNlKGUucmVzdW1lVG9rZW4pO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8ga2VlcCB0cmFjayBvZiByZW1vdmVkIHRhcmdldHMgdG8gd2UgY2FuIHBvc3QtZmlsdGVyIGFuZFxuICAgICAgICAgICAgICAgIC8vIHJlbW92ZSBhbnkgdGFyZ2V0IGNoYW5nZXMuXG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBkZWNyZW1lbnQgdGhlIG51bWJlciBvZiBwZW5kaW5nIGFja3MgbmVlZGVkIGZyb20gd2F0Y2hcbiAgICAgICAgICAgICAgICAvLyBmb3IgdGhpcyB0YXJnZXRJZC5cbiAgICAgICAgICAgICAgICBuLkJlKCksIG4uRGUgfHwgdGhpcy5yZW1vdmVUYXJnZXQodCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgY2FzZSAzIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQ3VycmVudCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5KZSh0KSAmJiAobi5MZSgpLCBuLkNlKGUucmVzdW1lVG9rZW4pKTtcbiAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICBjYXNlIDQgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5SZXNldCAqLyA6XG4gICAgICAgICAgICAgICAgdGhpcy5KZSh0KSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gUmVzZXQgdGhlIHRhcmdldCBhbmQgc3ludGhlc2l6ZXMgcmVtb3ZlcyBmb3IgYWxsIGV4aXN0aW5nXG4gICAgICAgICAgICAgICAgLy8gZG9jdW1lbnRzLiBUaGUgYmFja2VuZCB3aWxsIHJlLWFkZCBhbnkgZG9jdW1lbnRzIHRoYXQgc3RpbGxcbiAgICAgICAgICAgICAgICAvLyBtYXRjaCB0aGUgdGFyZ2V0IGJlZm9yZSBpdCBzZW5kcyB0aGUgbmV4dCBnbG9iYWwgc25hcHNob3QuXG4gICAgICAgICAgICAgICAgdGhpcy5ZZSh0KSwgbi5DZShlLnJlc3VtZVRva2VuKSk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhbGwgdGFyZ2V0SWRzIHRoYXQgdGhlIHdhdGNoIGNoYW5nZSBhcHBsaWVzIHRvOiBlaXRoZXIgdGhlXG4gICAgICogdGFyZ2V0SWRzIGV4cGxpY2l0bHkgbGlzdGVkIGluIHRoZSBjaGFuZ2Ugb3IgdGhlIHRhcmdldElkcyBvZiBhbGwgY3VycmVudGx5XG4gICAgICogYWN0aXZlIHRhcmdldHMuXG4gICAgICovICAgIGZvckVhY2hUYXJnZXQoZSwgdCkge1xuICAgICAgICBlLnRhcmdldElkcy5sZW5ndGggPiAwID8gZS50YXJnZXRJZHMuZm9yRWFjaCh0KSA6IHRoaXMucWUuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgIHRoaXMuSmUobikgJiYgdChuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBIYW5kbGVzIGV4aXN0ZW5jZSBmaWx0ZXJzIGFuZCBzeW50aGVzaXplcyBkZWxldGVzIGZvciBmaWx0ZXIgbWlzbWF0Y2hlcy5cbiAgICAgKiBUYXJnZXRzIHRoYXQgYXJlIGludmFsaWRhdGVkIGJ5IGZpbHRlciBtaXNtYXRjaGVzIGFyZSBhZGRlZCB0b1xuICAgICAqIGBwZW5kaW5nVGFyZ2V0UmVzZXRzYC5cbiAgICAgKi8gICAgWmUoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS50YXJnZXRJZCwgbiA9IGUuZ2UuY291bnQsIHIgPSB0aGlzLlhlKHQpO1xuICAgICAgICBpZiAocikge1xuICAgICAgICAgICAgY29uc3QgaSA9IHIudGFyZ2V0O1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV90YXJnZXRJc0RvY3VtZW50VGFyZ2V0KGkpKSBpZiAoMCA9PT0gbikge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBleGlzdGVuY2UgZmlsdGVyIHRvbGQgdXMgdGhlIGRvY3VtZW50IGRvZXMgbm90IGV4aXN0LiBXZSBkZWR1Y2VcbiAgICAgICAgICAgICAgICAvLyB0aGF0IHRoaXMgZG9jdW1lbnQgZG9lcyBub3QgZXhpc3QgYW5kIGFwcGx5IGEgZGVsZXRlZCBkb2N1bWVudCB0b1xuICAgICAgICAgICAgICAgIC8vIG91ciB1cGRhdGVzLiBXaXRob3V0IGFwcGx5aW5nIHRoaXMgZGVsZXRlZCBkb2N1bWVudCB0aGVyZSBtaWdodCBiZVxuICAgICAgICAgICAgICAgIC8vIGFub3RoZXIgcXVlcnkgdGhhdCB3aWxsIHJhaXNlIHRoaXMgZG9jdW1lbnQgYXMgcGFydCBvZiBhIHNuYXBzaG90XG4gICAgICAgICAgICAgICAgLy8gdW50aWwgaXQgaXMgcmVzb2x2ZWQsIGVzc2VudGlhbGx5IGV4cG9zaW5nIGluY29uc2lzdGVuY3kgYmV0d2VlblxuICAgICAgICAgICAgICAgIC8vIHF1ZXJpZXMuXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBEb2N1bWVudEtleShpLnBhdGgpO1xuICAgICAgICAgICAgICAgIHRoaXMuemUodCwgZSwgTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQoZSwgU25hcHNob3RWZXJzaW9uLm1pbigpKSk7XG4gICAgICAgICAgICB9IGVsc2UgX19QUklWQVRFX2hhcmRBc3NlcnQoMSA9PT0gbik7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmV0KHQpO1xuICAgICAgICAgICAgICAgIC8vIEV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guIE1hcmsgdGhlIGRvY3VtZW50cyBhcyBiZWluZyBpbiBsaW1ibywgYW5kXG4gICAgICAgICAgICAgICAgLy8gcmFpc2UgYSBzbmFwc2hvdCB3aXRoIGBpc0Zyb21DYWNoZTp0cnVlYC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHIgIT09IG4pIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQXBwbHkgYmxvb20gZmlsdGVyIHRvIGlkZW50aWZ5IGFuZCBtYXJrIHJlbW92ZWQgZG9jdW1lbnRzLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdGhpcy50dChlKSwgaSA9IG4gPyB0aGlzLm50KG4sIGUsIHIpIDogMSAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlNraXBwZWQgKi87XG4gICAgICAgICAgICAgICAgICAgIGlmICgwIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuU3VjY2VzcyAqLyAhPT0gaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgYmxvb20gZmlsdGVyIGFwcGxpY2F0aW9uIGZhaWxzLCB3ZSByZXNldCB0aGUgbWFwcGluZyBhbmRcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHRyaWdnZXIgcmUtcnVuIG9mIHRoZSBxdWVyeS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuWWUodCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gMiAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLkZhbHNlUG9zaXRpdmUgKi8gPT09IGkgPyBcIlRhcmdldFB1cnBvc2VFeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEJsb29tXCIgLyogVGFyZ2V0UHVycG9zZS5FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaEJsb29tICovIDogXCJUYXJnZXRQdXJwb3NlRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2hcIiAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoICovO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5LZSA9IHRoaXMuS2UuaW5zZXJ0KHQsIGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIG51bGwgPT0gQXQgfHwgQXQucnQoZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoSW5mb0ZvclRlc3RpbmdIb29rcyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcywgbywgXywgYSwgdSwgYztcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGwgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxDYWNoZUNvdW50OiBlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4aXN0ZW5jZUZpbHRlckNvdW50OiB0LmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGFiYXNlSWQ6IG4uZGF0YWJhc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvamVjdElkOiBuLnByb2plY3RJZFxuICAgICAgICAgICAgICAgICAgICAgICAgfSwgaCA9IHQudW5jaGFuZ2VkTmFtZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBoICYmIChsLmJsb29tRmlsdGVyID0ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGxpZWQ6IDAgLyogQmxvb21GaWx0ZXJBcHBsaWNhdGlvblN0YXR1cy5TdWNjZXNzICovID09PSBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhhc2hDb3VudDogbnVsbCAhPT0gKHMgPSBudWxsID09IGggPyB2b2lkIDAgOiBoLmhhc2hDb3VudCkgJiYgdm9pZCAwICE9PSBzID8gcyA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYml0bWFwTGVuZ3RoOiBudWxsICE9PSAoYSA9IG51bGwgPT09IChfID0gbnVsbCA9PT0gKG8gPSBudWxsID09IGggPyB2b2lkIDAgOiBoLmJpdHMpIHx8IHZvaWQgMCA9PT0gbyA/IHZvaWQgMCA6IG8uYml0bWFwKSB8fCB2b2lkIDAgPT09IF8gPyB2b2lkIDAgOiBfLmxlbmd0aCkgJiYgdm9pZCAwICE9PSBhID8gYSA6IDAsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFkZGluZzogbnVsbCAhPT0gKGMgPSBudWxsID09PSAodSA9IG51bGwgPT0gaCA/IHZvaWQgMCA6IGguYml0cykgfHwgdm9pZCAwID09PSB1ID8gdm9pZCAwIDogdS5wYWRkaW5nKSAmJiB2b2lkIDAgIT09IGMgPyBjIDogMCxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtaWdodENvbnRhaW46IGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09ICh0ID0gbnVsbCA9PSByID8gdm9pZCAwIDogci5taWdodENvbnRhaW4oZSkpICYmIHZvaWQgMCAhPT0gdCAmJiB0O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKHIsIGUuZ2UsIHRoaXMua2UuaXQoKSwgbiwgaSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZSB0aGUgYmxvb20gZmlsdGVyIGZyb20gdGhlIFwidW5jaGFuZ2VkX25hbWVzXCIgZmllbGQgb2YgYW4gZXhpc3RlbmNlXG4gICAgICogZmlsdGVyLlxuICAgICAqLyAgICB0dChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmdlLnVuY2hhbmdlZE5hbWVzO1xuICAgICAgICBpZiAoIXQgfHwgIXQuYml0cykgcmV0dXJuIG51bGw7XG4gICAgICAgIGNvbnN0IHtiaXRzOiB7Yml0bWFwOiBuID0gXCJcIiwgcGFkZGluZzogciA9IDB9LCBoYXNoQ291bnQ6IGkgPSAwfSA9IHQ7XG4gICAgICAgIGxldCBzLCBvO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcyA9IF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKG4pLnRvVWludDhBcnJheSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9CYXNlNjREZWNvZGVFcnJvcikgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKFwiRGVjb2RpbmcgdGhlIGJhc2U2NCBibG9vbSBmaWx0ZXIgaW4gZXhpc3RlbmNlIGZpbHRlciBmYWlsZWQgKFwiICsgZS5tZXNzYWdlICsgXCIpOyBpZ25vcmluZyB0aGUgYmxvb20gZmlsdGVyIGFuZCBmYWxsaW5nIGJhY2sgdG8gZnVsbCByZS1xdWVyeS5cIiksIFxuICAgICAgICAgICAgbnVsbDtcbiAgICAgICAgICAgIHRocm93IGU7XG4gICAgICAgIH1cbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIEJsb29tRmlsdGVyIHRocm93cyBlcnJvciBpZiB0aGUgaW5wdXRzIGFyZSBpbnZhbGlkLlxuICAgICAgICAgICAgbyA9IG5ldyBCbG9vbUZpbHRlcihzLCByLCBpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQmxvb21GaWx0ZXJFcnJvciA/IFwiQmxvb21GaWx0ZXIgZXJyb3I6IFwiIDogXCJBcHBseWluZyBibG9vbSBmaWx0ZXIgZmFpbGVkOiBcIiwgZSksIFxuICAgICAgICAgICAgbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gMCA9PT0gby5FZSA/IG51bGwgOiBvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBcHBseSBibG9vbSBmaWx0ZXIgdG8gcmVtb3ZlIHRoZSBkZWxldGVkIGRvY3VtZW50cywgYW5kIHJldHVybiB0aGVcbiAgICAgKiBhcHBsaWNhdGlvbiBzdGF0dXMuXG4gICAgICovICAgIG50KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHQuZ2UuY291bnQgPT09IG4gLSB0aGlzLnN0KGUsIHQudGFyZ2V0SWQpID8gMCAvKiBCbG9vbUZpbHRlckFwcGxpY2F0aW9uU3RhdHVzLlN1Y2Nlc3MgKi8gOiAyIC8qIEJsb29tRmlsdGVyQXBwbGljYXRpb25TdGF0dXMuRmFsc2VQb3NpdGl2ZSAqLztcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmlsdGVyIG91dCByZW1vdmVkIGRvY3VtZW50cyBiYXNlZCBvbiBibG9vbSBmaWx0ZXIgbWVtYmVyc2hpcCByZXN1bHQgYW5kXG4gICAgICogcmV0dXJuIG51bWJlciBvZiBkb2N1bWVudHMgcmVtb3ZlZC5cbiAgICAgKi8gICAgc3QoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5rZS5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KHQpO1xuICAgICAgICBsZXQgciA9IDA7XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMua2UuaXQoKSwgcyA9IGBwcm9qZWN0cy8ke2kucHJvamVjdElkfS9kYXRhYmFzZXMvJHtpLmRhdGFiYXNlfS9kb2N1bWVudHMvJHtuLnBhdGguY2Fub25pY2FsU3RyaW5nKCl9YDtcbiAgICAgICAgICAgIGUubWlnaHRDb250YWluKHMpIHx8ICh0aGlzLnplKHQsIG4sIC8qdXBkYXRlZERvY3VtZW50PSovIG51bGwpLCByKyspO1xuICAgICAgICB9KSksIHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIHRoZSBjdXJyZW50bHkgYWNjdW11bGF0ZWQgc3RhdGUgaW50byBhIHJlbW90ZSBldmVudCBhdCB0aGVcbiAgICAgKiBwcm92aWRlZCBzbmFwc2hvdCB2ZXJzaW9uLiBSZXNldHMgdGhlIGFjY3VtdWxhdGVkIGNoYW5nZXMgYmVmb3JlIHJldHVybmluZy5cbiAgICAgKi8gICAgb3QoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IE1hcDtcbiAgICAgICAgdGhpcy5xZS5mb3JFYWNoKCgobiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuWGUocik7XG4gICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgIGlmIChuLmN1cnJlbnQgJiYgX19QUklWQVRFX3RhcmdldElzRG9jdW1lbnRUYXJnZXQoaS50YXJnZXQpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIERvY3VtZW50IHF1ZXJpZXMgZm9yIGRvY3VtZW50IHRoYXQgZG9uJ3QgZXhpc3QgY2FuIHByb2R1Y2UgYW4gZW1wdHlcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVzdWx0IHNldC4gVG8gdXBkYXRlIG91ciBsb2NhbCBjYWNoZSwgd2Ugc3ludGhlc2l6ZSBhIGRvY3VtZW50XG4gICAgICAgICAgICAgICAgICAgIC8vIGRlbGV0ZSBpZiB3ZSBoYXZlIG5vdCBwcmV2aW91c2x5IHJlY2VpdmVkIHRoZSBkb2N1bWVudCBmb3IgdGhpc1xuICAgICAgICAgICAgICAgICAgICAvLyB0YXJnZXQuIFRoaXMgcmVzb2x2ZXMgdGhlIGxpbWJvIHN0YXRlIG9mIHRoZSBkb2N1bWVudCwgcmVtb3ZpbmcgaXRcbiAgICAgICAgICAgICAgICAgICAgLy8gZnJvbSBsaW1ib0RvY3VtZW50UmVmcy5cbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyhkaW1vbmQpOiBJZGVhbGx5IHdlIHdvdWxkIGhhdmUgYW4gZXhwbGljaXQgbG9va3VwIHRhcmdldFxuICAgICAgICAgICAgICAgICAgICAvLyBpbnN0ZWFkIHJlc3VsdGluZyBpbiBhbiBleHBsaWNpdCBkZWxldGUgbWVzc2FnZSBhbmQgd2UgY291bGRcbiAgICAgICAgICAgICAgICAgICAgLy8gcmVtb3ZlIHRoaXMgc3BlY2lhbCBsb2dpYy5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBEb2N1bWVudEtleShpLnRhcmdldC5wYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdCh0KS5oYXMocikgfHwgdGhpcy51dChyLCB0KSB8fCB0aGlzLnplKHIsIHQsIE11dGFibGVEb2N1bWVudC5uZXdOb0RvY3VtZW50KHQsIGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgbi52ZSAmJiAodC5zZXQociwgbi5GZSgpKSwgbi5NZSgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpO1xuICAgICAgICBsZXQgbiA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAvLyBXZSBleHRyYWN0IHRoZSBzZXQgb2YgbGltYm8tb25seSBkb2N1bWVudCB1cGRhdGVzIGFzIHRoZSBHQyBsb2dpY1xuICAgICAgICAvLyBzcGVjaWFsLWNhc2VzIGRvY3VtZW50cyB0aGF0IGRvIG5vdCBhcHBlYXIgaW4gdGhlIHRhcmdldCBjYWNoZS5cbiAgICAgICAgXG4gICAgICAgIC8vIFRPRE8oZ3NvbHRpcyk6IEV4cGFuZCBvbiB0aGlzIGNvbW1lbnQgb25jZSBHQyBpcyBhdmFpbGFibGUgaW4gdGhlIEpTXG4gICAgICAgIC8vIGNsaWVudC5cbiAgICAgICAgICAgICAgICB0aGlzLlVlLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBsZXQgciA9ICEwO1xuICAgICAgICAgICAgdC5mb3JFYWNoV2hpbGUoKGUgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLlhlKGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiAhdCB8fCBcIlRhcmdldFB1cnBvc2VMaW1ib1Jlc29sdXRpb25cIiAvKiBUYXJnZXRQdXJwb3NlLkxpbWJvUmVzb2x1dGlvbiAqLyA9PT0gdC5wdXJwb3NlIHx8IChyID0gITEsIFxuICAgICAgICAgICAgICAgICExKTtcbiAgICAgICAgICAgIH0pKSwgciAmJiAobiA9IG4uYWRkKGUpKTtcbiAgICAgICAgfSkpLCB0aGlzLlFlLmZvckVhY2goKCh0LCBuKSA9PiBuLnNldFJlYWRUaW1lKGUpKSk7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgUmVtb3RlRXZlbnQoZSwgdCwgdGhpcy5LZSwgdGhpcy5RZSwgbik7XG4gICAgICAgIHJldHVybiB0aGlzLlFlID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpLCB0aGlzLiRlID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0TWFwKCksIFxuICAgICAgICB0aGlzLlVlID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0TWFwKCksIHRoaXMuS2UgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSwgXG4gICAgICAgIHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgdGhlIHByb3ZpZGVkIGRvY3VtZW50IHRvIHRoZSBpbnRlcm5hbCBsaXN0IG9mIGRvY3VtZW50IHVwZGF0ZXMgYW5kXG4gICAgICogaXRzIGRvY3VtZW50IGtleSB0byB0aGUgZ2l2ZW4gdGFyZ2V0J3MgbWFwcGluZy5cbiAgICAgKi9cbiAgICAvLyBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICAgIEdlKGUsIHQpIHtcbiAgICAgICAgaWYgKCF0aGlzLkplKGUpKSByZXR1cm47XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnV0KGUsIHQua2V5KSA/IDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLztcbiAgICAgICAgdGhpcy5IZShlKS54ZSh0LmtleSwgbiksIHRoaXMuUWUgPSB0aGlzLlFlLmluc2VydCh0LmtleSwgdCksIHRoaXMuJGUgPSB0aGlzLiRlLmluc2VydCh0LmtleSwgdGhpcy5fdCh0LmtleSkuYWRkKGUpKSwgXG4gICAgICAgIHRoaXMuVWUgPSB0aGlzLlVlLmluc2VydCh0LmtleSwgdGhpcy5jdCh0LmtleSkuYWRkKGUpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgZnJvbSB0aGUgdGFyZ2V0IG1hcHBpbmcuIElmIHRoZVxuICAgICAqIGRvY3VtZW50IG5vIGxvbmdlciBtYXRjaGVzIHRoZSB0YXJnZXQsIGJ1dCB0aGUgZG9jdW1lbnQncyBzdGF0ZSBpcyBzdGlsbFxuICAgICAqIGtub3duIChlLmcuIHdlIGtub3cgdGhhdCB0aGUgZG9jdW1lbnQgd2FzIGRlbGV0ZWQgb3Igd2UgcmVjZWl2ZWQgdGhlIGNoYW5nZVxuICAgICAqIHRoYXQgY2F1c2VkIHRoZSBmaWx0ZXIgbWlzbWF0Y2gpLCB0aGUgbmV3IGRvY3VtZW50IGNhbiBiZSBwcm92aWRlZFxuICAgICAqIHRvIHVwZGF0ZSB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlLlxuICAgICAqL1xuICAgIC8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4gICAgemUoZSwgdCwgbikge1xuICAgICAgICBpZiAoIXRoaXMuSmUoZSkpIHJldHVybjtcbiAgICAgICAgY29uc3QgciA9IHRoaXMuSGUoZSk7XG4gICAgICAgIHRoaXMudXQoZSwgdCkgPyByLnhlKHQsIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovKSA6IFxuICAgICAgICAvLyBUaGUgZG9jdW1lbnQgbWF5IGhhdmUgZW50ZXJlZCBhbmQgbGVmdCB0aGUgdGFyZ2V0IGJlZm9yZSB3ZSByYWlzZWQgYVxuICAgICAgICAvLyBzbmFwc2hvdCwgc28gd2UgY2FuIGp1c3QgaWdub3JlIHRoZSBjaGFuZ2UuXG4gICAgICAgIHIuT2UodCksIHRoaXMuVWUgPSB0aGlzLlVlLmluc2VydCh0LCB0aGlzLmN0KHQpLmRlbGV0ZShlKSksIHRoaXMuVWUgPSB0aGlzLlVlLmluc2VydCh0LCB0aGlzLmN0KHQpLmFkZChlKSksIFxuICAgICAgICBuICYmICh0aGlzLlFlID0gdGhpcy5RZS5pbnNlcnQodCwgbikpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXQoZSkge1xuICAgICAgICB0aGlzLnFlLmRlbGV0ZShlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgY3VycmVudCBjb3VudCBvZiBkb2N1bWVudHMgaW4gdGhlIHRhcmdldC4gVGhpcyBpbmNsdWRlcyBib3RoXG4gICAgICogdGhlIG51bWJlciBvZiBkb2N1bWVudHMgdGhhdCB0aGUgTG9jYWxTdG9yZSBjb25zaWRlcnMgdG8gYmUgcGFydCBvZiB0aGVcbiAgICAgKiB0YXJnZXQgYXMgd2VsbCBhcyBhbnkgYWNjdW11bGF0ZWQgY2hhbmdlcy5cbiAgICAgKi8gICAgZXQoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5IZShlKS5GZSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5rZS5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0KGUpLnNpemUgKyB0LmFkZGVkRG9jdW1lbnRzLnNpemUgLSB0LnJlbW92ZWREb2N1bWVudHMuc2l6ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSW5jcmVtZW50IHRoZSBudW1iZXIgb2YgYWNrcyBuZWVkZWQgZnJvbSB3YXRjaCBiZWZvcmUgd2UgY2FuIGNvbnNpZGVyIHRoZVxuICAgICAqIHNlcnZlciB0byBiZSAnaW4tc3luYycgd2l0aCB0aGUgY2xpZW50J3MgYWN0aXZlIHRhcmdldHMuXG4gICAgICovICAgIE5lKGUpIHtcbiAgICAgICAgdGhpcy5IZShlKS5OZSgpO1xuICAgIH1cbiAgICBIZShlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5xZS5nZXQoZSk7XG4gICAgICAgIHJldHVybiB0IHx8ICh0ID0gbmV3IF9fUFJJVkFURV9UYXJnZXRTdGF0ZSwgdGhpcy5xZS5zZXQoZSwgdCkpLCB0O1xuICAgIH1cbiAgICBjdChlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5VZS5nZXQoZSk7XG4gICAgICAgIHJldHVybiB0IHx8ICh0ID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciksIHRoaXMuVWUgPSB0aGlzLlVlLmluc2VydChlLCB0KSksIFxuICAgICAgICB0O1xuICAgIH1cbiAgICBfdChlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy4kZS5nZXQoZSk7XG4gICAgICAgIHJldHVybiB0IHx8ICh0ID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciksIHRoaXMuJGUgPSB0aGlzLiRlLmluc2VydChlLCB0KSksIFxuICAgICAgICB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWZXJpZmllcyB0aGF0IHRoZSB1c2VyIGlzIHN0aWxsIGludGVyZXN0ZWQgaW4gdGhpcyB0YXJnZXQgKGJ5IGNhbGxpbmdcbiAgICAgKiBgZ2V0VGFyZ2V0RGF0YUZvclRhcmdldCgpYCkgYW5kIHRoYXQgd2UgYXJlIG5vdCB3YWl0aW5nIGZvciBwZW5kaW5nIEFERHNcbiAgICAgKiBmcm9tIHdhdGNoLlxuICAgICAqLyAgICBKZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBudWxsICE9PSB0aGlzLlhlKGUpO1xuICAgICAgICByZXR1cm4gdCB8fCBfX1BSSVZBVEVfbG9nRGVidWcoXCJXYXRjaENoYW5nZUFnZ3JlZ2F0b3JcIiwgXCJEZXRlY3RlZCBpbmFjdGl2ZSB0YXJnZXRcIiwgZSksIFxuICAgICAgICB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBUYXJnZXREYXRhIGZvciBhbiBhY3RpdmUgdGFyZ2V0IChpLmUuIGEgdGFyZ2V0IHRoYXQgdGhlIHVzZXJcbiAgICAgKiBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoYXQgaGFzIG5vIG91dHN0YW5kaW5nIHRhcmdldCBjaGFuZ2UgcmVxdWVzdHMpLlxuICAgICAqLyAgICBYZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnFlLmdldChlKTtcbiAgICAgICAgcmV0dXJuIHQgJiYgdC5EZSA/IG51bGwgOiB0aGlzLmtlLmx0KGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIHN0YXRlIG9mIGEgV2F0Y2ggdGFyZ2V0IHRvIGl0cyBpbml0aWFsIHN0YXRlIChlLmcuIHNldHNcbiAgICAgKiAnY3VycmVudCcgdG8gZmFsc2UsIGNsZWFycyB0aGUgcmVzdW1lIHRva2VuIGFuZCByZW1vdmVzIGl0cyB0YXJnZXQgbWFwcGluZ1xuICAgICAqIGZyb20gYWxsIGRvY3VtZW50cykuXG4gICAgICovICAgIFllKGUpIHtcbiAgICAgICAgdGhpcy5xZS5zZXQoZSwgbmV3IF9fUFJJVkFURV9UYXJnZXRTdGF0ZSk7XG4gICAgICAgIHRoaXMua2UuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldChlKS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIHRoaXMuemUoZSwgdCwgLyp1cGRhdGVkRG9jdW1lbnQ9Ki8gbnVsbCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRoZSBMb2NhbFN0b3JlIGNvbnNpZGVycyB0aGUgZG9jdW1lbnQgdG8gYmUgcGFydCBvZiB0aGVcbiAgICAgKiBzcGVjaWZpZWQgdGFyZ2V0LlxuICAgICAqLyAgICB1dChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmtlLmdldFJlbW90ZUtleXNGb3JUYXJnZXQoZSkuaGFzKHQpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0TWFwKCkge1xuICAgIHJldHVybiBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfc25hcHNob3RDaGFuZ2VzTWFwKCkge1xuICAgIHJldHVybiBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xufVxuXG5jb25zdCBWdCA9ICgoKSA9PiB7XG4gICAgY29uc3QgZSA9IHtcbiAgICAgICAgYXNjOiBcIkFTQ0VORElOR1wiLFxuICAgICAgICBkZXNjOiBcIkRFU0NFTkRJTkdcIlxuICAgIH07XG4gICAgcmV0dXJuIGU7XG59KSgpLCBtdCA9ICgoKSA9PiB7XG4gICAgY29uc3QgZSA9IHtcbiAgICAgICAgXCI8XCI6IFwiTEVTU19USEFOXCIsXG4gICAgICAgIFwiPD1cIjogXCJMRVNTX1RIQU5fT1JfRVFVQUxcIixcbiAgICAgICAgXCI+XCI6IFwiR1JFQVRFUl9USEFOXCIsXG4gICAgICAgIFwiPj1cIjogXCJHUkVBVEVSX1RIQU5fT1JfRVFVQUxcIixcbiAgICAgICAgXCI9PVwiOiBcIkVRVUFMXCIsXG4gICAgICAgIFwiIT1cIjogXCJOT1RfRVFVQUxcIixcbiAgICAgICAgXCJhcnJheS1jb250YWluc1wiOiBcIkFSUkFZX0NPTlRBSU5TXCIsXG4gICAgICAgIGluOiBcIklOXCIsXG4gICAgICAgIFwibm90LWluXCI6IFwiTk9UX0lOXCIsXG4gICAgICAgIFwiYXJyYXktY29udGFpbnMtYW55XCI6IFwiQVJSQVlfQ09OVEFJTlNfQU5ZXCJcbiAgICB9O1xuICAgIHJldHVybiBlO1xufSkoKSwgZnQgPSAoKCkgPT4ge1xuICAgIGNvbnN0IGUgPSB7XG4gICAgICAgIGFuZDogXCJBTkRcIixcbiAgICAgICAgb3I6IFwiT1JcIlxuICAgIH07XG4gICAgcmV0dXJuIGU7XG59KSgpO1xuXG4vKipcbiAqIFRoaXMgY2xhc3MgZ2VuZXJhdGVzIEpzb25PYmplY3QgdmFsdWVzIGZvciB0aGUgRGF0YXN0b3JlIEFQSSBzdWl0YWJsZSBmb3JcbiAqIHNlbmRpbmcgdG8gZWl0aGVyIEdSUEMgc3R1YiBtZXRob2RzIG9yIHZpYSB0aGUgSlNPTi9IVFRQIFJFU1QgQVBJLlxuICpcbiAqIFRoZSBzZXJpYWxpemVyIHN1cHBvcnRzIGJvdGggUHJvdG9idWYuanMgYW5kIFByb3RvMyBKU09OIGZvcm1hdHMuIEJ5XG4gKiBzZXR0aW5nIGB1c2VQcm90bzNKc29uYCB0byB0cnVlLCB0aGUgc2VyaWFsaXplciB3aWxsIHVzZSB0aGUgUHJvdG8zIEpTT05cbiAqIGZvcm1hdC5cbiAqXG4gKiBGb3IgYSBkZXNjcmlwdGlvbiBvZiB0aGUgUHJvdG8zIEpTT04gZm9ybWF0IGNoZWNrXG4gKiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9wcm90b2NvbC1idWZmZXJzL2RvY3MvcHJvdG8zI2pzb25cbiAqXG4gKiBUT0RPKGtsaW10KTogV2UgY2FuIHJlbW92ZSB0aGUgZGF0YWJhc2VJZCBhcmd1bWVudCBpZiB3ZSBrZWVwIHRoZSBmdWxsXG4gKiByZXNvdXJjZSBuYW1lIGluIGRvY3VtZW50cy5cbiAqL1xuY2xhc3MgSnNvblByb3RvU2VyaWFsaXplciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmRhdGFiYXNlSWQgPSBlLCB0aGlzLnVzZVByb3RvM0pzb24gPSB0O1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgdmFsdWUgZm9yIGEgbnVtYmVyIChvciBudWxsKSB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGludG9cbiAqIGEgZ29vZ2xlLnByb3RvYnVmLkludDMyVmFsdWUgcHJvdG8uXG4gKiBETyBOT1QgVVNFIFRISVMgRk9SIEFOWVRISU5HIEVMU0UuXG4gKiBUaGlzIG1ldGhvZCBjaGVhdHMuIEl0J3MgdHlwZWQgYXMgcmV0dXJuaW5nIFwibnVtYmVyXCIgYmVjYXVzZSB0aGF0J3Mgd2hhdFxuICogb3VyIGdlbmVyYXRlZCBwcm90byBpbnRlcmZhY2VzIHNheSBJbnQzMlZhbHVlIG11c3QgYmUuIEJ1dCBHUlBDIGFjdHVhbGx5XG4gKiBleHBlY3RzIGEgeyB2YWx1ZTogPG51bWJlcj4gfSBzdHJ1Y3QuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0ludDMyUHJvdG8oZSwgdCkge1xuICAgIHJldHVybiBlLnVzZVByb3RvM0pzb24gfHwgX19QUklWQVRFX2lzTnVsbE9yVW5kZWZpbmVkKHQpID8gdCA6IHtcbiAgICAgICAgdmFsdWU6IHRcbiAgICB9O1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBudW1iZXIgKG9yIG51bGwpIGZyb20gYSBnb29nbGUucHJvdG9idWYuSW50MzJWYWx1ZSBwcm90by5cbiAqL1xuLyoqXG4gKiBSZXR1cm5zIGEgdmFsdWUgZm9yIGEgRGF0ZSB0aGF0J3MgYXBwcm9wcmlhdGUgdG8gcHV0IGludG8gYSBwcm90by5cbiAqL1xuZnVuY3Rpb24gdG9UaW1lc3RhbXAoZSwgdCkge1xuICAgIGlmIChlLnVzZVByb3RvM0pzb24pIHtcbiAgICAgICAgcmV0dXJuIGAke25ldyBEYXRlKDFlMyAqIHQuc2Vjb25kcykudG9JU09TdHJpbmcoKS5yZXBsYWNlKC9cXC5cXGQqLywgXCJcIikucmVwbGFjZShcIlpcIiwgXCJcIil9LiR7KFwiMDAwMDAwMDAwXCIgKyB0Lm5hbm9zZWNvbmRzKS5zbGljZSgtOSl9WmA7XG4gICAgfVxuICAgIHJldHVybiB7XG4gICAgICAgIHNlY29uZHM6IFwiXCIgKyB0LnNlY29uZHMsXG4gICAgICAgIG5hbm9zOiB0Lm5hbm9zZWNvbmRzXG4gICAgfTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgdmFsdWUgZm9yIGJ5dGVzIHRoYXQncyBhcHByb3ByaWF0ZSB0byBwdXQgaW4gYSBwcm90by5cbiAqXG4gKiBWaXNpYmxlIGZvciB0ZXN0aW5nLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9CeXRlcyhlLCB0KSB7XG4gICAgcmV0dXJuIGUudXNlUHJvdG8zSnNvbiA/IHQudG9CYXNlNjQoKSA6IHQudG9VaW50OEFycmF5KCk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIEJ5dGVTdHJpbmcgYmFzZWQgb24gdGhlIHByb3RvIHN0cmluZyB2YWx1ZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9WZXJzaW9uKGUsIHQpIHtcbiAgICByZXR1cm4gdG9UaW1lc3RhbXAoZSwgdC50b1RpbWVzdGFtcCgpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21WZXJzaW9uKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQoISFlKSwgU25hcHNob3RWZXJzaW9uLmZyb21UaW1lc3RhbXAoZnVuY3Rpb24gZnJvbVRpbWVzdGFtcChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpO1xuICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh0LnNlY29uZHMsIHQubmFub3MpO1xuICAgIH0oZSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9SZXNvdXJjZU5hbWUoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdG9SZXNvdXJjZVBhdGgoZSwgdCkuY2Fub25pY2FsU3RyaW5nKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b1Jlc291cmNlUGF0aChlLCB0KSB7XG4gICAgY29uc3QgbiA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mdWxseVF1YWxpZmllZFByZWZpeFBhdGgoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFJlc291cmNlUGF0aChbIFwicHJvamVjdHNcIiwgZS5wcm9qZWN0SWQsIFwiZGF0YWJhc2VzXCIsIGUuZGF0YWJhc2UgXSk7XG4gICAgfShlKS5jaGlsZChcImRvY3VtZW50c1wiKTtcbiAgICByZXR1cm4gdm9pZCAwID09PSB0ID8gbiA6IG4uY2hpbGQodCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUmVzb3VyY2VOYW1lKGUpIHtcbiAgICBjb25zdCB0ID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZSk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KF9fUFJJVkFURV9pc1ZhbGlkUmVzb3VyY2VOYW1lKHQpKSwgdDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvTmFtZShlLCB0KSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV90b1Jlc291cmNlTmFtZShlLmRhdGFiYXNlSWQsIHQucGF0aCk7XG59XG5cbmZ1bmN0aW9uIGZyb21OYW1lKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2Zyb21SZXNvdXJjZU5hbWUodCk7XG4gICAgaWYgKG4uZ2V0KDEpICE9PSBlLmRhdGFiYXNlSWQucHJvamVjdElkKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIlRyaWVkIHRvIGRlc2VyaWFsaXplIGtleSBmcm9tIGRpZmZlcmVudCBwcm9qZWN0OiBcIiArIG4uZ2V0KDEpICsgXCIgdnMgXCIgKyBlLmRhdGFiYXNlSWQucHJvamVjdElkKTtcbiAgICBpZiAobi5nZXQoMykgIT09IGUuZGF0YWJhc2VJZC5kYXRhYmFzZSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJUcmllZCB0byBkZXNlcmlhbGl6ZSBrZXkgZnJvbSBkaWZmZXJlbnQgZGF0YWJhc2U6IFwiICsgbi5nZXQoMykgKyBcIiB2cyBcIiArIGUuZGF0YWJhc2VJZC5kYXRhYmFzZSk7XG4gICAgcmV0dXJuIG5ldyBEb2N1bWVudEtleShfX1BSSVZBVEVfZXh0cmFjdExvY2FsUGF0aEZyb21SZXNvdXJjZU5hbWUobikpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9RdWVyeVBhdGgoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfdG9SZXNvdXJjZU5hbWUoZS5kYXRhYmFzZUlkLCB0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21RdWVyeVBhdGgoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbVJlc291cmNlTmFtZShlKTtcbiAgICAvLyBJbiB2MWJldGExIHF1ZXJpZXMgZm9yIGNvbGxlY3Rpb25zIGF0IHRoZSByb290IGRpZCBub3QgaGF2ZSBhIHRyYWlsaW5nXG4gICAgLy8gXCIvZG9jdW1lbnRzXCIuIEluIHYxIGFsbCByZXNvdXJjZSBwYXRocyBjb250YWluIFwiL2RvY3VtZW50c1wiLiBQcmVzZXJ2ZSB0aGVcbiAgICAvLyBhYmlsaXR5IHRvIHJlYWQgdGhlIHYxYmV0YTEgZm9ybSBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIHF1ZXJpZXMgcGVyc2lzdGVkXG4gICAgLy8gaW4gdGhlIGxvY2FsIHRhcmdldCBjYWNoZS5cbiAgICAgICAgcmV0dXJuIDQgPT09IHQubGVuZ3RoID8gUmVzb3VyY2VQYXRoLmVtcHR5UGF0aCgpIDogX19QUklWQVRFX2V4dHJhY3RMb2NhbFBhdGhGcm9tUmVzb3VyY2VOYW1lKHQpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZ2V0RW5jb2RlZERhdGFiYXNlSWQoZSkge1xuICAgIHJldHVybiBuZXcgUmVzb3VyY2VQYXRoKFsgXCJwcm9qZWN0c1wiLCBlLmRhdGFiYXNlSWQucHJvamVjdElkLCBcImRhdGFiYXNlc1wiLCBlLmRhdGFiYXNlSWQuZGF0YWJhc2UgXSkuY2Fub25pY2FsU3RyaW5nKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9leHRyYWN0TG9jYWxQYXRoRnJvbVJlc291cmNlTmFtZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUubGVuZ3RoID4gNCAmJiBcImRvY3VtZW50c1wiID09PSBlLmdldCg0KSksIGUucG9wRmlyc3QoNSk7XG59XG5cbi8qKiBDcmVhdGVzIGEgRG9jdW1lbnQgcHJvdG8gZnJvbSBrZXkgYW5kIGZpZWxkcyAoYnV0IG5vIGNyZWF0ZS91cGRhdGUgdGltZSkgKi8gZnVuY3Rpb24gX19QUklWQVRFX3RvTXV0YXRpb25Eb2N1bWVudChlLCB0LCBuKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogX19QUklWQVRFX3RvTmFtZShlLCB0KSxcbiAgICAgICAgZmllbGRzOiBuLnZhbHVlLm1hcFZhbHVlLmZpZWxkc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRG9jdW1lbnQoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBmcm9tTmFtZShlLCB0Lm5hbWUpLCBpID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQudXBkYXRlVGltZSksIHMgPSB0LmNyZWF0ZVRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5jcmVhdGVUaW1lKSA6IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgbyA9IG5ldyBPYmplY3RWYWx1ZSh7XG4gICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICBmaWVsZHM6IHQuZmllbGRzXG4gICAgICAgIH1cbiAgICB9KSwgXyA9IE11dGFibGVEb2N1bWVudC5uZXdGb3VuZERvY3VtZW50KHIsIGksIHMsIG8pO1xuICAgIHJldHVybiBuICYmIF8uc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCksIG4gPyBfLnNldEhhc0NvbW1pdHRlZE11dGF0aW9ucygpIDogXztcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21CYXRjaEdldERvY3VtZW50c1Jlc3BvbnNlKGUsIHQpIHtcbiAgICByZXR1cm4gXCJmb3VuZFwiIGluIHQgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUZvdW5kKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoISF0LmZvdW5kKSwgdC5mb3VuZC5uYW1lLCB0LmZvdW5kLnVwZGF0ZVRpbWU7XG4gICAgICAgIGNvbnN0IG4gPSBmcm9tTmFtZShlLCB0LmZvdW5kLm5hbWUpLCByID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQuZm91bmQudXBkYXRlVGltZSksIGkgPSB0LmZvdW5kLmNyZWF0ZVRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5mb3VuZC5jcmVhdGVUaW1lKSA6IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgcyA9IG5ldyBPYmplY3RWYWx1ZSh7XG4gICAgICAgICAgICBtYXBWYWx1ZToge1xuICAgICAgICAgICAgICAgIGZpZWxkczogdC5mb3VuZC5maWVsZHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBNdXRhYmxlRG9jdW1lbnQubmV3Rm91bmREb2N1bWVudChuLCByLCBpLCBzKTtcbiAgICB9KGUsIHQpIDogXCJtaXNzaW5nXCIgaW4gdCA/IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tTWlzc2luZyhlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhdC5taXNzaW5nKSwgX19QUklWQVRFX2hhcmRBc3NlcnQoISF0LnJlYWRUaW1lKTtcbiAgICAgICAgY29uc3QgbiA9IGZyb21OYW1lKGUsIHQubWlzc2luZyksIHIgPSBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5yZWFkVGltZSk7XG4gICAgICAgIHJldHVybiBNdXRhYmxlRG9jdW1lbnQubmV3Tm9Eb2N1bWVudChuLCByKTtcbiAgICB9KGUsIHQpIDogZmFpbCgpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdhdGNoQ2hhbmdlKGUsIHQpIHtcbiAgICBsZXQgbjtcbiAgICBpZiAoXCJ0YXJnZXRDaGFuZ2VcIiBpbiB0KSB7XG4gICAgICAgIHQudGFyZ2V0Q2hhbmdlO1xuICAgICAgICAvLyBwcm90bzMgZGVmYXVsdCB2YWx1ZSBpcyB1bnNldCBpbiBKU09OICh1bmRlZmluZWQpLCBzbyB1c2UgJ05PX0NIQU5HRSdcbiAgICAgICAgLy8gaWYgdW5zZXRcbiAgICAgICAgY29uc3QgciA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZShlKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJOT19DSEFOR0VcIiA9PT0gZSA/IDAgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5Ob0NoYW5nZSAqLyA6IFwiQUREXCIgPT09IGUgPyAxIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuQWRkZWQgKi8gOiBcIlJFTU9WRVwiID09PSBlID8gMiAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlbW92ZWQgKi8gOiBcIkNVUlJFTlRcIiA9PT0gZSA/IDMgLyogV2F0Y2hUYXJnZXRDaGFuZ2VTdGF0ZS5DdXJyZW50ICovIDogXCJSRVNFVFwiID09PSBlID8gNCAvKiBXYXRjaFRhcmdldENoYW5nZVN0YXRlLlJlc2V0ICovIDogZmFpbCgpO1xuICAgICAgICB9KHQudGFyZ2V0Q2hhbmdlLnRhcmdldENoYW5nZVR5cGUgfHwgXCJOT19DSEFOR0VcIiksIGkgPSB0LnRhcmdldENoYW5nZS50YXJnZXRJZHMgfHwgW10sIHMgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUJ5dGVzKGUsIHQpIHtcbiAgICAgICAgICAgIHJldHVybiBlLnVzZVByb3RvM0pzb24gPyAoX19QUklWQVRFX2hhcmRBc3NlcnQodm9pZCAwID09PSB0IHx8IFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpLCBcbiAgICAgICAgICAgIEJ5dGVTdHJpbmcuZnJvbUJhc2U2NFN0cmluZyh0IHx8IFwiXCIpKSA6IChfX1BSSVZBVEVfaGFyZEFzc2VydCh2b2lkIDAgPT09IHQgfHwgXG4gICAgICAgICAgICAvLyBDaGVjayBpZiB0aGUgdmFsdWUgaXMgYW4gaW5zdGFuY2Ugb2YgYm90aCBCdWZmZXIgYW5kIFVpbnQ4QXJyYXksXG4gICAgICAgICAgICAvLyBkZXNwaXRlIHRoZSBmYWN0IHRoYXQgQnVmZmVyIGV4dGVuZHMgVWludDhBcnJheS4gSW4gc29tZVxuICAgICAgICAgICAgLy8gZW52aXJvbm1lbnRzLCBzdWNoIGFzIGpzZG9tLCB0aGUgcHJvdG90eXBlIGNoYWluIG9mIEJ1ZmZlclxuICAgICAgICAgICAgLy8gZG9lcyBub3QgaW5kaWNhdGUgdGhhdCBpdCBleHRlbmRzIFVpbnQ4QXJyYXkuXG4gICAgICAgICAgICB0IGluc3RhbmNlb2YgQnVmZmVyIHx8IHQgaW5zdGFuY2VvZiBVaW50OEFycmF5KSwgQnl0ZVN0cmluZy5mcm9tVWludDhBcnJheSh0IHx8IG5ldyBVaW50OEFycmF5KSk7XG4gICAgICAgIH0oZSwgdC50YXJnZXRDaGFuZ2UucmVzdW1lVG9rZW4pLCBvID0gdC50YXJnZXRDaGFuZ2UuY2F1c2UsIF8gPSBvICYmIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUnBjU3RhdHVzKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB2b2lkIDAgPT09IGUuY29kZSA/IEMuVU5LTk9XTiA6IF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY0NvZGUoZS5jb2RlKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRmlyZXN0b3JlRXJyb3IodCwgZS5tZXNzYWdlIHx8IFwiXCIpO1xuICAgICAgICB9KG8pO1xuICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9XYXRjaFRhcmdldENoYW5nZShyLCBpLCBzLCBfIHx8IG51bGwpO1xuICAgIH0gZWxzZSBpZiAoXCJkb2N1bWVudENoYW5nZVwiIGluIHQpIHtcbiAgICAgICAgdC5kb2N1bWVudENoYW5nZTtcbiAgICAgICAgY29uc3QgciA9IHQuZG9jdW1lbnRDaGFuZ2U7XG4gICAgICAgIHIuZG9jdW1lbnQsIHIuZG9jdW1lbnQubmFtZSwgci5kb2N1bWVudC51cGRhdGVUaW1lO1xuICAgICAgICBjb25zdCBpID0gZnJvbU5hbWUoZSwgci5kb2N1bWVudC5uYW1lKSwgcyA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbihyLmRvY3VtZW50LnVwZGF0ZVRpbWUpLCBvID0gci5kb2N1bWVudC5jcmVhdGVUaW1lID8gX19QUklWQVRFX2Zyb21WZXJzaW9uKHIuZG9jdW1lbnQuY3JlYXRlVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCksIF8gPSBuZXcgT2JqZWN0VmFsdWUoe1xuICAgICAgICAgICAgbWFwVmFsdWU6IHtcbiAgICAgICAgICAgICAgICBmaWVsZHM6IHIuZG9jdW1lbnQuZmllbGRzXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pLCBhID0gTXV0YWJsZURvY3VtZW50Lm5ld0ZvdW5kRG9jdW1lbnQoaSwgcywgbywgXyksIHUgPSByLnRhcmdldElkcyB8fCBbXSwgYyA9IHIucmVtb3ZlZFRhcmdldElkcyB8fCBbXTtcbiAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfRG9jdW1lbnRXYXRjaENoYW5nZSh1LCBjLCBhLmtleSwgYSk7XG4gICAgfSBlbHNlIGlmIChcImRvY3VtZW50RGVsZXRlXCIgaW4gdCkge1xuICAgICAgICB0LmRvY3VtZW50RGVsZXRlO1xuICAgICAgICBjb25zdCByID0gdC5kb2N1bWVudERlbGV0ZTtcbiAgICAgICAgci5kb2N1bWVudDtcbiAgICAgICAgY29uc3QgaSA9IGZyb21OYW1lKGUsIHIuZG9jdW1lbnQpLCBzID0gci5yZWFkVGltZSA/IF9fUFJJVkFURV9mcm9tVmVyc2lvbihyLnJlYWRUaW1lKSA6IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgbyA9IE11dGFibGVEb2N1bWVudC5uZXdOb0RvY3VtZW50KGksIHMpLCBfID0gci5yZW1vdmVkVGFyZ2V0SWRzIHx8IFtdO1xuICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9Eb2N1bWVudFdhdGNoQ2hhbmdlKFtdLCBfLCBvLmtleSwgbyk7XG4gICAgfSBlbHNlIGlmIChcImRvY3VtZW50UmVtb3ZlXCIgaW4gdCkge1xuICAgICAgICB0LmRvY3VtZW50UmVtb3ZlO1xuICAgICAgICBjb25zdCByID0gdC5kb2N1bWVudFJlbW92ZTtcbiAgICAgICAgci5kb2N1bWVudDtcbiAgICAgICAgY29uc3QgaSA9IGZyb21OYW1lKGUsIHIuZG9jdW1lbnQpLCBzID0gci5yZW1vdmVkVGFyZ2V0SWRzIHx8IFtdO1xuICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9Eb2N1bWVudFdhdGNoQ2hhbmdlKFtdLCBzLCBpLCBudWxsKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoIShcImZpbHRlclwiIGluIHQpKSByZXR1cm4gZmFpbCgpO1xuICAgICAgICB7XG4gICAgICAgICAgICB0LmZpbHRlcjtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmZpbHRlcjtcbiAgICAgICAgICAgIGUudGFyZ2V0SWQ7XG4gICAgICAgICAgICBjb25zdCB7Y291bnQ6IHIgPSAwLCB1bmNoYW5nZWROYW1lczogaX0gPSBlLCBzID0gbmV3IEV4aXN0ZW5jZUZpbHRlcihyLCBpKSwgbyA9IGUudGFyZ2V0SWQ7XG4gICAgICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9FeGlzdGVuY2VGaWx0ZXJDaGFuZ2Uobywgcyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG47XG59XG5cbmZ1bmN0aW9uIHRvTXV0YXRpb24oZSwgdCkge1xuICAgIGxldCBuO1xuICAgIGlmICh0IGluc3RhbmNlb2YgX19QUklWQVRFX1NldE11dGF0aW9uKSBuID0ge1xuICAgICAgICB1cGRhdGU6IF9fUFJJVkFURV90b011dGF0aW9uRG9jdW1lbnQoZSwgdC5rZXksIHQudmFsdWUpXG4gICAgfTsgZWxzZSBpZiAodCBpbnN0YW5jZW9mIF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbikgbiA9IHtcbiAgICAgICAgZGVsZXRlOiBfX1BSSVZBVEVfdG9OYW1lKGUsIHQua2V5KVxuICAgIH07IGVsc2UgaWYgKHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbikgbiA9IHtcbiAgICAgICAgdXBkYXRlOiBfX1BSSVZBVEVfdG9NdXRhdGlvbkRvY3VtZW50KGUsIHQua2V5LCB0LmRhdGEpLFxuICAgICAgICB1cGRhdGVNYXNrOiBfX1BSSVZBVEVfdG9Eb2N1bWVudE1hc2sodC5maWVsZE1hc2spXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGlmICghKHQgaW5zdGFuY2VvZiBfX1BSSVZBVEVfVmVyaWZ5TXV0YXRpb24pKSByZXR1cm4gZmFpbCgpO1xuICAgICAgICBuID0ge1xuICAgICAgICAgICAgdmVyaWZ5OiBfX1BSSVZBVEVfdG9OYW1lKGUsIHQua2V5KVxuICAgICAgICB9O1xuICAgIH1cbiAgICByZXR1cm4gdC5maWVsZFRyYW5zZm9ybXMubGVuZ3RoID4gMCAmJiAobi51cGRhdGVUcmFuc2Zvcm1zID0gdC5maWVsZFRyYW5zZm9ybXMubWFwKChlID0+IGZ1bmN0aW9uIF9fUFJJVkFURV90b0ZpZWxkVHJhbnNmb3JtKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQudHJhbnNmb3JtO1xuICAgICAgICBpZiAobiBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBUcmFuc2Zvcm0pIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZFBhdGg6IHQuZmllbGQuY2Fub25pY2FsU3RyaW5nKCksXG4gICAgICAgICAgICBzZXRUb1NlcnZlclZhbHVlOiBcIlJFUVVFU1RfVElNRVwiXG4gICAgICAgIH07XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgX19QUklWQVRFX0FycmF5VW5pb25UcmFuc2Zvcm1PcGVyYXRpb24pIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZFBhdGg6IHQuZmllbGQuY2Fub25pY2FsU3RyaW5nKCksXG4gICAgICAgICAgICBhcHBlbmRNaXNzaW5nRWxlbWVudHM6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IG4uZWxlbWVudHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlSZW1vdmVUcmFuc2Zvcm1PcGVyYXRpb24pIHJldHVybiB7XG4gICAgICAgICAgICBmaWVsZFBhdGg6IHQuZmllbGQuY2Fub25pY2FsU3RyaW5nKCksXG4gICAgICAgICAgICByZW1vdmVBbGxGcm9tQXJyYXk6IHtcbiAgICAgICAgICAgICAgICB2YWx1ZXM6IG4uZWxlbWVudHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgaWYgKG4gaW5zdGFuY2VvZiBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbikgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkUGF0aDogdC5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSxcbiAgICAgICAgICAgIGluY3JlbWVudDogbi5JZVxuICAgICAgICB9O1xuICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgfSgwLCBlKSkpKSwgdC5wcmVjb25kaXRpb24uaXNOb25lIHx8IChuLmN1cnJlbnREb2N1bWVudCA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b1ByZWNvbmRpdGlvbihlLCB0KSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IHQudXBkYXRlVGltZSA/IHtcbiAgICAgICAgICAgIHVwZGF0ZVRpbWU6IF9fUFJJVkFURV90b1ZlcnNpb24oZSwgdC51cGRhdGVUaW1lKVxuICAgICAgICB9IDogdm9pZCAwICE9PSB0LmV4aXN0cyA/IHtcbiAgICAgICAgICAgIGV4aXN0czogdC5leGlzdHNcbiAgICAgICAgfSA6IGZhaWwoKTtcbiAgICB9KGUsIHQucHJlY29uZGl0aW9uKSksIG47XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tTXV0YXRpb24oZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmN1cnJlbnREb2N1bWVudCA/IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tUHJlY29uZGl0aW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gZS51cGRhdGVUaW1lID8gUHJlY29uZGl0aW9uLnVwZGF0ZVRpbWUoX19QUklWQVRFX2Zyb21WZXJzaW9uKGUudXBkYXRlVGltZSkpIDogdm9pZCAwICE9PSBlLmV4aXN0cyA/IFByZWNvbmRpdGlvbi5leGlzdHMoZS5leGlzdHMpIDogUHJlY29uZGl0aW9uLm5vbmUoKTtcbiAgICB9KHQuY3VycmVudERvY3VtZW50KSA6IFByZWNvbmRpdGlvbi5ub25lKCksIHIgPSB0LnVwZGF0ZVRyYW5zZm9ybXMgPyB0LnVwZGF0ZVRyYW5zZm9ybXMubWFwKCh0ID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRmllbGRUcmFuc2Zvcm0oZSwgdCkge1xuICAgICAgICBsZXQgbiA9IG51bGw7XG4gICAgICAgIGlmIChcInNldFRvU2VydmVyVmFsdWVcIiBpbiB0KSBfX1BSSVZBVEVfaGFyZEFzc2VydChcIlJFUVVFU1RfVElNRVwiID09PSB0LnNldFRvU2VydmVyVmFsdWUpLCBcbiAgICAgICAgbiA9IG5ldyBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wVHJhbnNmb3JtOyBlbHNlIGlmIChcImFwcGVuZE1pc3NpbmdFbGVtZW50c1wiIGluIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmFwcGVuZE1pc3NpbmdFbGVtZW50cy52YWx1ZXMgfHwgW107XG4gICAgICAgICAgICBuID0gbmV3IF9fUFJJVkFURV9BcnJheVVuaW9uVHJhbnNmb3JtT3BlcmF0aW9uKGUpO1xuICAgICAgICB9IGVsc2UgaWYgKFwicmVtb3ZlQWxsRnJvbUFycmF5XCIgaW4gdCkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQucmVtb3ZlQWxsRnJvbUFycmF5LnZhbHVlcyB8fCBbXTtcbiAgICAgICAgICAgIG4gPSBuZXcgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKGUpO1xuICAgICAgICB9IGVsc2UgXCJpbmNyZW1lbnRcIiBpbiB0ID8gbiA9IG5ldyBfX1BSSVZBVEVfTnVtZXJpY0luY3JlbWVudFRyYW5zZm9ybU9wZXJhdGlvbihlLCB0LmluY3JlbWVudCkgOiBmYWlsKCk7XG4gICAgICAgIGNvbnN0IHIgPSBGaWVsZFBhdGgkMS5mcm9tU2VydmVyRm9ybWF0KHQuZmllbGRQYXRoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFRyYW5zZm9ybShyLCBuKTtcbiAgICB9KGUsIHQpKSkgOiBbXTtcbiAgICBpZiAodC51cGRhdGUpIHtcbiAgICAgICAgdC51cGRhdGUubmFtZTtcbiAgICAgICAgY29uc3QgaSA9IGZyb21OYW1lKGUsIHQudXBkYXRlLm5hbWUpLCBzID0gbmV3IE9iamVjdFZhbHVlKHtcbiAgICAgICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICAgICAgZmllbGRzOiB0LnVwZGF0ZS5maWVsZHNcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmICh0LnVwZGF0ZU1hc2spIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURvY3VtZW50TWFzayhlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUuZmllbGRQYXRocyB8fCBbXTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEZpZWxkTWFzayh0Lm1hcCgoZSA9PiBGaWVsZFBhdGgkMS5mcm9tU2VydmVyRm9ybWF0KGUpKSkpO1xuICAgICAgICAgICAgfSh0LnVwZGF0ZU1hc2spO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUGF0Y2hNdXRhdGlvbihpLCBzLCBlLCBuLCByKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9TZXRNdXRhdGlvbihpLCBzLCBuLCByKTtcbiAgICB9XG4gICAgaWYgKHQuZGVsZXRlKSB7XG4gICAgICAgIGNvbnN0IHIgPSBmcm9tTmFtZShlLCB0LmRlbGV0ZSk7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0RlbGV0ZU11dGF0aW9uKHIsIG4pO1xuICAgIH1cbiAgICBpZiAodC52ZXJpZnkpIHtcbiAgICAgICAgY29uc3QgciA9IGZyb21OYW1lKGUsIHQudmVyaWZ5KTtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfVmVyaWZ5TXV0YXRpb24ociwgbik7XG4gICAgfVxuICAgIHJldHVybiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tV3JpdGVSZXN1bHRzKGUsIHQpIHtcbiAgICByZXR1cm4gZSAmJiBlLmxlbmd0aCA+IDAgPyAoX19QUklWQVRFX2hhcmRBc3NlcnQodm9pZCAwICE9PSB0KSwgZS5tYXAoKGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Xcml0ZVJlc3VsdChlLCB0KSB7XG4gICAgICAgIC8vIE5PVEU6IERlbGV0ZXMgZG9uJ3QgaGF2ZSBhbiB1cGRhdGVUaW1lLlxuICAgICAgICBsZXQgbiA9IGUudXBkYXRlVGltZSA/IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLnVwZGF0ZVRpbWUpIDogX19QUklWQVRFX2Zyb21WZXJzaW9uKHQpO1xuICAgICAgICByZXR1cm4gbi5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkgJiYgKFxuICAgICAgICAvLyBUaGUgRmlyZXN0b3JlIEVtdWxhdG9yIGN1cnJlbnRseSByZXR1cm5zIGFuIHVwZGF0ZSB0aW1lIG9mIDAgZm9yXG4gICAgICAgIC8vIGRlbGV0ZXMgb2Ygbm9uLWV4aXN0aW5nIGRvY3VtZW50cyAocmF0aGVyIHRoYW4gbnVsbCkuIFRoaXMgYnJlYWtzIHRoZVxuICAgICAgICAvLyB0ZXN0IFwiZ2V0IGRlbGV0ZWQgZG9jIHdoaWxlIG9mZmxpbmUgd2l0aCBzb3VyY2U9Y2FjaGVcIiBhcyBOb0RvY3VtZW50c1xuICAgICAgICAvLyB3aXRoIHZlcnNpb24gMCBhcmUgZmlsdGVyZWQgYnkgSW5kZXhlZERiJ3MgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAgICAgICAgLy8gVE9ETygjMjE0OSk6IFJlbW92ZSB0aGlzIHdoZW4gRW11bGF0b3IgaXMgZml4ZWRcbiAgICAgICAgbiA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbih0KSksIG5ldyBNdXRhdGlvblJlc3VsdChuLCBlLnRyYW5zZm9ybVJlc3VsdHMgfHwgW10pO1xuICAgIH0oZSwgdCkpKSkgOiBbXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRG9jdW1lbnRzVGFyZ2V0KGUsIHQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBkb2N1bWVudHM6IFsgX19QUklWQVRFX3RvUXVlcnlQYXRoKGUsIHQucGF0aCkgXVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b1F1ZXJ5VGFyZ2V0KGUsIHQpIHtcbiAgICAvLyBEaXNzZWN0IHRoZSBwYXRoIGludG8gcGFyZW50LCBjb2xsZWN0aW9uSWQsIGFuZCBvcHRpb25hbCBrZXkgZmlsdGVyLlxuICAgIGNvbnN0IG4gPSB7XG4gICAgICAgIHN0cnVjdHVyZWRRdWVyeToge31cbiAgICB9LCByID0gdC5wYXRoO1xuICAgIGxldCBpO1xuICAgIG51bGwgIT09IHQuY29sbGVjdGlvbkdyb3VwID8gKGkgPSByLCBuLnN0cnVjdHVyZWRRdWVyeS5mcm9tID0gWyB7XG4gICAgICAgIGNvbGxlY3Rpb25JZDogdC5jb2xsZWN0aW9uR3JvdXAsXG4gICAgICAgIGFsbERlc2NlbmRhbnRzOiAhMFxuICAgIH0gXSkgOiAoaSA9IHIucG9wTGFzdCgpLCBuLnN0cnVjdHVyZWRRdWVyeS5mcm9tID0gWyB7XG4gICAgICAgIGNvbGxlY3Rpb25JZDogci5sYXN0U2VnbWVudCgpXG4gICAgfSBdKSwgbi5wYXJlbnQgPSBfX1BSSVZBVEVfdG9RdWVyeVBhdGgoZSwgaSk7XG4gICAgY29uc3QgcyA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b0ZpbHRlcnMoZSkge1xuICAgICAgICBpZiAoMCA9PT0gZS5sZW5ndGgpIHJldHVybjtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV90b0ZpbHRlcihDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKGUsIFwiYW5kXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuQU5EICovKSk7XG4gICAgfSh0LmZpbHRlcnMpO1xuICAgIHMgJiYgKG4uc3RydWN0dXJlZFF1ZXJ5LndoZXJlID0gcyk7XG4gICAgY29uc3QgbyA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b09yZGVyKGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSByZXR1cm47XG4gICAgICAgIHJldHVybiBlLm1hcCgoZSA9PiBcbiAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfdG9Qcm9wZXJ0eU9yZGVyKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICBkaXJlY3Rpb246IF9fUFJJVkFURV90b0RpcmVjdGlvbihlLmRpcilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0oZSkpKTtcbiAgICB9KHQub3JkZXJCeSk7XG4gICAgbyAmJiAobi5zdHJ1Y3R1cmVkUXVlcnkub3JkZXJCeSA9IG8pO1xuICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfdG9JbnQzMlByb3RvKGUsIHQubGltaXQpO1xuICAgIHJldHVybiBudWxsICE9PSBfICYmIChuLnN0cnVjdHVyZWRRdWVyeS5saW1pdCA9IF8pLCB0LnN0YXJ0QXQgJiYgKG4uc3RydWN0dXJlZFF1ZXJ5LnN0YXJ0QXQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9TdGFydEF0Q3Vyc29yKGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJlZm9yZTogZS5pbmNsdXNpdmUsXG4gICAgICAgICAgICB2YWx1ZXM6IGUucG9zaXRpb25cbiAgICAgICAgfTtcbiAgICB9KHQuc3RhcnRBdCkpLCB0LmVuZEF0ICYmIChuLnN0cnVjdHVyZWRRdWVyeS5lbmRBdCA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b0VuZEF0Q3Vyc29yKGUpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGJlZm9yZTogIWUuaW5jbHVzaXZlLFxuICAgICAgICAgICAgdmFsdWVzOiBlLnBvc2l0aW9uXG4gICAgICAgIH07XG4gICAgfSh0LmVuZEF0KSksIHtcbiAgICAgICAgaHQ6IG4sXG4gICAgICAgIHBhcmVudDogaVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b1J1bkFnZ3JlZ2F0aW9uUXVlcnlSZXF1ZXN0KGUsIHQsIG4sIHIpIHtcbiAgICBjb25zdCB7aHQ6IGksIHBhcmVudDogc30gPSBfX1BSSVZBVEVfdG9RdWVyeVRhcmdldChlLCB0KSwgbyA9IHt9LCBfID0gW107XG4gICAgbGV0IGEgPSAwO1xuICAgIHJldHVybiBuLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAvLyBNYXAgYWxsIGNsaWVudC1zaWRlIGFsaWFzZXMgdG8gYSB1bmlxdWUgc2hvcnQtZm9ybVxuICAgICAgICAvLyBhbGlhcy4gVGhpcyBhdm9pZHMgaXNzdWVzIHdpdGggY2xpZW50LXNpZGUgYWxpYXNlcyB0aGF0XG4gICAgICAgIC8vIGV4Y2VlZCB0aGUgMTUwMC1ieXRlIHN0cmluZyBzaXplIGxpbWl0LlxuICAgICAgICBjb25zdCB0ID0gciA/IGUuYWxpYXMgOiBcImFnZ3JlZ2F0ZV9cIiArIGErKztcbiAgICAgICAgb1t0XSA9IGUuYWxpYXMsIFwiY291bnRcIiA9PT0gZS5hZ2dyZWdhdGVUeXBlID8gXy5wdXNoKHtcbiAgICAgICAgICAgIGFsaWFzOiB0LFxuICAgICAgICAgICAgY291bnQ6IHt9XG4gICAgICAgIH0pIDogXCJhdmdcIiA9PT0gZS5hZ2dyZWdhdGVUeXBlID8gXy5wdXNoKHtcbiAgICAgICAgICAgIGFsaWFzOiB0LFxuICAgICAgICAgICAgYXZnOiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkUGF0aClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkgOiBcInN1bVwiID09PSBlLmFnZ3JlZ2F0ZVR5cGUgJiYgXy5wdXNoKHtcbiAgICAgICAgICAgIGFsaWFzOiB0LFxuICAgICAgICAgICAgc3VtOiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkUGF0aClcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSkpLCB7XG4gICAgICAgIHJlcXVlc3Q6IHtcbiAgICAgICAgICAgIHN0cnVjdHVyZWRBZ2dyZWdhdGlvblF1ZXJ5OiB7XG4gICAgICAgICAgICAgICAgYWdncmVnYXRpb25zOiBfLFxuICAgICAgICAgICAgICAgIHN0cnVjdHVyZWRRdWVyeTogaS5zdHJ1Y3R1cmVkUXVlcnlcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYXJlbnQ6IGkucGFyZW50XG4gICAgICAgIH0sXG4gICAgICAgIFB0OiBvLFxuICAgICAgICBwYXJlbnQ6IHNcbiAgICB9O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29udmVydFF1ZXJ5VGFyZ2V0VG9RdWVyeShlKSB7XG4gICAgbGV0IHQgPSBfX1BSSVZBVEVfZnJvbVF1ZXJ5UGF0aChlLnBhcmVudCk7XG4gICAgY29uc3QgbiA9IGUuc3RydWN0dXJlZFF1ZXJ5LCByID0gbi5mcm9tID8gbi5mcm9tLmxlbmd0aCA6IDA7XG4gICAgbGV0IGkgPSBudWxsO1xuICAgIGlmIChyID4gMCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgxID09PSByKTtcbiAgICAgICAgY29uc3QgZSA9IG4uZnJvbVswXTtcbiAgICAgICAgZS5hbGxEZXNjZW5kYW50cyA/IGkgPSBlLmNvbGxlY3Rpb25JZCA6IHQgPSB0LmNoaWxkKGUuY29sbGVjdGlvbklkKTtcbiAgICB9XG4gICAgbGV0IHMgPSBbXTtcbiAgICBuLndoZXJlICYmIChzID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWx0ZXJzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tRmlsdGVyKGUpO1xuICAgICAgICBpZiAodCBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0Q29uanVuY3Rpb24odCkpIHJldHVybiB0LmdldEZpbHRlcnMoKTtcbiAgICAgICAgcmV0dXJuIFsgdCBdO1xuICAgIH0obi53aGVyZSkpO1xuICAgIGxldCBvID0gW107XG4gICAgbi5vcmRlckJ5ICYmIChvID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21PcmRlcihlKSB7XG4gICAgICAgIHJldHVybiBlLm1hcCgoZSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVByb3BlcnR5T3JkZXIoZSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBPcmRlckJ5KF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUuZmllbGQpLCBcbiAgICAgICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGlyZWN0aW9uKGUpIHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgXCJBU0NFTkRJTkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiYXNjXCIgLyogRGlyZWN0aW9uLkFTQ0VORElORyAqLztcblxuICAgICAgICAgICAgICAgICAgY2FzZSBcIkRFU0NFTkRJTkdcIjpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiZGVzY1wiIC8qIERpcmVjdGlvbi5ERVNDRU5ESU5HICovO1xuXG4gICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICAgICAgKGUuZGlyZWN0aW9uKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gdmlzaWJsZSBmb3IgdGVzdGluZ1xuICAgICAgICAoZSkpKTtcbiAgICB9KG4ub3JkZXJCeSkpO1xuICAgIGxldCBfID0gbnVsbDtcbiAgICBuLmxpbWl0ICYmIChfID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21JbnQzMlByb3RvKGUpIHtcbiAgICAgICAgbGV0IHQ7XG4gICAgICAgIHJldHVybiB0ID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgZSA/IGUudmFsdWUgOiBlLCBfX1BSSVZBVEVfaXNOdWxsT3JVbmRlZmluZWQodCkgPyBudWxsIDogdDtcbiAgICB9KG4ubGltaXQpKTtcbiAgICBsZXQgYSA9IG51bGw7XG4gICAgbi5zdGFydEF0ICYmIChhID0gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21TdGFydEF0Q3Vyc29yKGUpIHtcbiAgICAgICAgY29uc3QgdCA9ICEhZS5iZWZvcmUsIG4gPSBlLnZhbHVlcyB8fCBbXTtcbiAgICAgICAgcmV0dXJuIG5ldyBCb3VuZChuLCB0KTtcbiAgICB9KG4uc3RhcnRBdCkpO1xuICAgIGxldCB1ID0gbnVsbDtcbiAgICByZXR1cm4gbi5lbmRBdCAmJiAodSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRW5kQXRDdXJzb3IoZSkge1xuICAgICAgICBjb25zdCB0ID0gIWUuYmVmb3JlLCBuID0gZS52YWx1ZXMgfHwgW107XG4gICAgICAgIHJldHVybiBuZXcgQm91bmQobiwgdCk7XG4gICAgfVxuICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAobi5lbmRBdCkpLCBfX1BSSVZBVEVfbmV3UXVlcnkodCwgaSwgbywgcywgXywgXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovICwgYSwgdSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0xpc3RlblJlcXVlc3RMYWJlbHMoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdG9MYWJlbChlKSB7XG4gICAgICAgIHN3aXRjaCAoZSkge1xuICAgICAgICAgIGNhc2UgXCJUYXJnZXRQdXJwb3NlTGlzdGVuXCIgLyogVGFyZ2V0UHVycG9zZS5MaXN0ZW4gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG5cbiAgICAgICAgICBjYXNlIFwiVGFyZ2V0UHVycG9zZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoXCIgLyogVGFyZ2V0UHVycG9zZS5FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaCAqLyA6XG4gICAgICAgICAgICByZXR1cm4gXCJleGlzdGVuY2UtZmlsdGVyLW1pc21hdGNoXCI7XG5cbiAgICAgICAgICBjYXNlIFwiVGFyZ2V0UHVycG9zZUV4aXN0ZW5jZUZpbHRlck1pc21hdGNoQmxvb21cIiAvKiBUYXJnZXRQdXJwb3NlLkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoQmxvb20gKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFwiZXhpc3RlbmNlLWZpbHRlci1taXNtYXRjaC1ibG9vbVwiO1xuXG4gICAgICAgICAgY2FzZSBcIlRhcmdldFB1cnBvc2VMaW1ib1Jlc29sdXRpb25cIiAvKiBUYXJnZXRQdXJwb3NlLkxpbWJvUmVzb2x1dGlvbiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gXCJsaW1iby1kb2N1bWVudFwiO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9KHQucHVycG9zZSk7XG4gICAgcmV0dXJuIG51bGwgPT0gbiA/IG51bGwgOiB7XG4gICAgICAgIFwiZ29vZy1saXN0ZW4tdGFnc1wiOiBuXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWx0ZXIoZSkge1xuICAgIHJldHVybiB2b2lkIDAgIT09IGUudW5hcnlGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVVuYXJ5RmlsdGVyKGUpIHtcbiAgICAgICAgc3dpdGNoIChlLnVuYXJ5RmlsdGVyLm9wKSB7XG4gICAgICAgICAgY2FzZSBcIklTX05BTlwiOlxuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZSh0LCBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gLCB7XG4gICAgICAgICAgICAgICAgZG91YmxlVmFsdWU6IE5hTlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjYXNlIFwiSVNfTlVMTFwiOlxuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShuLCBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi8gLCB7XG4gICAgICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjYXNlIFwiSVNfTk9UX05BTlwiOlxuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9mcm9tRmllbGRQYXRoUmVmZXJlbmNlKGUudW5hcnlGaWx0ZXIuZmllbGQpO1xuICAgICAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShyLCBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovICwge1xuICAgICAgICAgICAgICAgIGRvdWJsZVZhbHVlOiBOYU5cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY2FzZSBcIklTX05PVF9OVUxMXCI6XG4gICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2Zyb21GaWVsZFBhdGhSZWZlcmVuY2UoZS51bmFyeUZpbHRlci5maWVsZCk7XG4gICAgICAgICAgICByZXR1cm4gRmllbGRGaWx0ZXIuY3JlYXRlKGksIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gLCB7XG4gICAgICAgICAgICAgICAgbnVsbFZhbHVlOiBcIk5VTExfVkFMVUVcIlxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgfVxuICAgIH0oZSkgOiB2b2lkIDAgIT09IGUuZmllbGRGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUZpZWxkRmlsdGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIEZpZWxkRmlsdGVyLmNyZWF0ZShfX1BSSVZBVEVfZnJvbUZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkRmlsdGVyLmZpZWxkKSwgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21PcGVyYXRvck5hbWUoZSkge1xuICAgICAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgICAgIGNhc2UgXCJFUVVBTFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIj09XCIgLyogT3BlcmF0b3IuRVFVQUwgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIk5PVF9FUVVBTFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJHUkVBVEVSX1RIQU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI+XCIgLyogT3BlcmF0b3IuR1JFQVRFUl9USEFOICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJHUkVBVEVSX1RIQU5fT1JfRVFVQUxcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCI+PVwiIC8qIE9wZXJhdG9yLkdSRUFURVJfVEhBTl9PUl9FUVVBTCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiTEVTU19USEFOXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPFwiIC8qIE9wZXJhdG9yLkxFU1NfVEhBTiAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiTEVTU19USEFOX09SX0VRVUFMXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiPD1cIiAvKiBPcGVyYXRvci5MRVNTX1RIQU5fT1JfRVFVQUwgKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkFSUkFZX0NPTlRBSU5TXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiSU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJpblwiIC8qIE9wZXJhdG9yLklOICovO1xuXG4gICAgICAgICAgICAgIGNhc2UgXCJOT1RfSU5cIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi87XG5cbiAgICAgICAgICAgICAgY2FzZSBcIkFSUkFZX0NPTlRBSU5TX0FOWVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLztcblxuICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIHJldHVybiBmYWlsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oZS5maWVsZEZpbHRlci5vcCksIGUuZmllbGRGaWx0ZXIudmFsdWUpO1xuICAgIH0oZSkgOiB2b2lkIDAgIT09IGUuY29tcG9zaXRlRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Db21wb3NpdGVGaWx0ZXIoZSkge1xuICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShlLmNvbXBvc2l0ZUZpbHRlci5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfZnJvbUZpbHRlcihlKSkpLCBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUNvbXBvc2l0ZU9wZXJhdG9yTmFtZShlKSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgY2FzZSBcIkFORFwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLztcblxuICAgICAgICAgICAgICBjYXNlIFwiT1JcIjpcbiAgICAgICAgICAgICAgICByZXR1cm4gXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovO1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfShlLmNvbXBvc2l0ZUZpbHRlci5vcCkpO1xuICAgIH0oZSkgOiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0RpcmVjdGlvbihlKSB7XG4gICAgcmV0dXJuIFZ0W2VdO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9PcGVyYXRvck5hbWUoZSkge1xuICAgIHJldHVybiBtdFtlXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvQ29tcG9zaXRlT3BlcmF0b3JOYW1lKGUpIHtcbiAgICByZXR1cm4gZnRbZV07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZmllbGRQYXRoOiBlLmNhbm9uaWNhbFN0cmluZygpXG4gICAgfTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Zyb21GaWVsZFBhdGhSZWZlcmVuY2UoZSkge1xuICAgIHJldHVybiBGaWVsZFBhdGgkMS5mcm9tU2VydmVyRm9ybWF0KGUuZmllbGRQYXRoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRmlsdGVyKGUpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX3RvVW5hcnlPckZpZWxkRmlsdGVyKGUpIHtcbiAgICAgICAgaWYgKFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA9PT0gZS5vcCkge1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9pc05hblZhbHVlKGUudmFsdWUpKSByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVuYXJ5RmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZpZWxkOiBfX1BSSVZBVEVfdG9GaWVsZFBhdGhSZWZlcmVuY2UoZS5maWVsZCksXG4gICAgICAgICAgICAgICAgICAgIG9wOiBcIklTX05BTlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfaXNOdWxsVmFsdWUoZS52YWx1ZSkpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTlVMTFwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSBlbHNlIGlmIChcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovID09PSBlLm9wKSB7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzTmFuVmFsdWUoZS52YWx1ZSkpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTk9UX05BTlwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGlmIChfX1BSSVZBVEVfaXNOdWxsVmFsdWUoZS52YWx1ZSkpIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdW5hcnlGaWx0ZXI6IHtcbiAgICAgICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICAgICAgb3A6IFwiSVNfTk9UX05VTExcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGZpZWxkRmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgZmllbGQ6IF9fUFJJVkFURV90b0ZpZWxkUGF0aFJlZmVyZW5jZShlLmZpZWxkKSxcbiAgICAgICAgICAgICAgICBvcDogX19QUklWQVRFX3RvT3BlcmF0b3JOYW1lKGUub3ApLFxuICAgICAgICAgICAgICAgIHZhbHVlOiBlLnZhbHVlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfShlKSA6IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgPyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9Db21wb3NpdGVGaWx0ZXIoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5nZXRGaWx0ZXJzKCkubWFwKChlID0+IF9fUFJJVkFURV90b0ZpbHRlcihlKSkpO1xuICAgICAgICBpZiAoMSA9PT0gdC5sZW5ndGgpIHJldHVybiB0WzBdO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY29tcG9zaXRlRmlsdGVyOiB7XG4gICAgICAgICAgICAgICAgb3A6IF9fUFJJVkFURV90b0NvbXBvc2l0ZU9wZXJhdG9yTmFtZShlLm9wKSxcbiAgICAgICAgICAgICAgICBmaWx0ZXJzOiB0XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfShlKSA6IGZhaWwoKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRG9jdW1lbnRNYXNrKGUpIHtcbiAgICBjb25zdCB0ID0gW107XG4gICAgcmV0dXJuIGUuZmllbGRzLmZvckVhY2goKGUgPT4gdC5wdXNoKGUuY2Fub25pY2FsU3RyaW5nKCkpKSksIHtcbiAgICAgICAgZmllbGRQYXRoczogdFxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9pc1ZhbGlkUmVzb3VyY2VOYW1lKGUpIHtcbiAgICAvLyBSZXNvdXJjZSBuYW1lcyBoYXZlIGF0IGxlYXN0IDQgY29tcG9uZW50cyAocHJvamVjdCBJRCwgZGF0YWJhc2UgSUQpXG4gICAgcmV0dXJuIGUubGVuZ3RoID49IDQgJiYgXCJwcm9qZWN0c1wiID09PSBlLmdldCgwKSAmJiBcImRhdGFiYXNlc1wiID09PSBlLmdldCgyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW1tdXRhYmxlIHNldCBvZiBtZXRhZGF0YSB0aGF0IHRoZSBsb2NhbCBzdG9yZSB0cmFja3MgZm9yIGVhY2ggdGFyZ2V0LlxuICovIGNsYXNzIFRhcmdldERhdGEge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdGFyZ2V0IGJlaW5nIGxpc3RlbmVkIHRvLiAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSB0YXJnZXQgSUQgdG8gd2hpY2ggdGhlIHRhcmdldCBjb3JyZXNwb25kczsgQXNzaWduZWQgYnkgdGhlXG4gICAgICogTG9jYWxTdG9yZSBmb3IgdXNlciBsaXN0ZW5zIGFuZCBieSB0aGUgU3luY0VuZ2luZSBmb3IgbGltYm8gd2F0Y2hlcy5cbiAgICAgKi9cbiAgICB0LCBcbiAgICAvKiogVGhlIHB1cnBvc2Ugb2YgdGhlIHRhcmdldC4gKi9cbiAgICBuLCBcbiAgICAvKipcbiAgICAgKiBUaGUgc2VxdWVuY2UgbnVtYmVyIG9mIHRoZSBsYXN0IHRyYW5zYWN0aW9uIGR1cmluZyB3aGljaCB0aGlzIHRhcmdldCBkYXRhXG4gICAgICogd2FzIG1vZGlmaWVkLlxuICAgICAqL1xuICAgIHIsIFxuICAgIC8qKiBUaGUgbGF0ZXN0IHNuYXBzaG90IHZlcnNpb24gc2VlbiBmb3IgdGhpcyB0YXJnZXQuICovXG4gICAgaSA9IFNuYXBzaG90VmVyc2lvbi5taW4oKVxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIHNuYXBzaG90IHZlcnNpb24gYXQgd2hpY2ggdGhlIGFzc29jaWF0ZWQgdmlld1xuICAgICAqIGNvbnRhaW5lZCBubyBsaW1ibyBkb2N1bWVudHMuXG4gICAgICovICwgcyA9IFNuYXBzaG90VmVyc2lvbi5taW4oKVxuICAgIC8qKlxuICAgICAqIEFuIG9wYXF1ZSwgc2VydmVyLWFzc2lnbmVkIHRva2VuIHRoYXQgYWxsb3dzIHdhdGNoaW5nIGEgdGFyZ2V0IHRvIGJlXG4gICAgICogcmVzdW1lZCBhZnRlciBkaXNjb25uZWN0aW5nIHdpdGhvdXQgcmV0cmFuc21pdHRpbmcgYWxsIHRoZSBkYXRhIHRoYXRcbiAgICAgKiBtYXRjaGVzIHRoZSB0YXJnZXQuIFRoZSByZXN1bWUgdG9rZW4gZXNzZW50aWFsbHkgaWRlbnRpZmllcyBhIHBvaW50IGluXG4gICAgICogdGltZSBmcm9tIHdoaWNoIHRoZSBzZXJ2ZXIgc2hvdWxkIHJlc3VtZSBzZW5kaW5nIHJlc3VsdHMuXG4gICAgICovICwgbyA9IEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkdcbiAgICAvKipcbiAgICAgKiBUaGUgbnVtYmVyIG9mIGRvY3VtZW50cyB0aGF0IGxhc3QgbWF0Y2hlZCB0aGUgcXVlcnkgYXQgdGhlIHJlc3VtZSB0b2tlbiBvclxuICAgICAqIHJlYWQgdGltZS4gRG9jdW1lbnRzIGFyZSBjb3VudGVkIG9ubHkgd2hlbiBtYWtpbmcgYSBsaXN0ZW4gcmVxdWVzdCB3aXRoXG4gICAgICogcmVzdW1lIHRva2VuIG9yIHJlYWQgdGltZSwgb3RoZXJ3aXNlLCBrZWVwIGl0IG51bGwuXG4gICAgICovICwgXyA9IG51bGwpIHtcbiAgICAgICAgdGhpcy50YXJnZXQgPSBlLCB0aGlzLnRhcmdldElkID0gdCwgdGhpcy5wdXJwb3NlID0gbiwgdGhpcy5zZXF1ZW5jZU51bWJlciA9IHIsIHRoaXMuc25hcHNob3RWZXJzaW9uID0gaSwgXG4gICAgICAgIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiA9IHMsIHRoaXMucmVzdW1lVG9rZW4gPSBvLCB0aGlzLmV4cGVjdGVkQ291bnQgPSBfO1xuICAgIH1cbiAgICAvKiogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgc2VxdWVuY2UgbnVtYmVyLiAqLyAgICB3aXRoU2VxdWVuY2VOdW1iZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldERhdGEodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgZSwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIHRoaXMubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiwgdGhpcy5yZXN1bWVUb2tlbiwgdGhpcy5leHBlY3RlZENvdW50KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgcmVzdW1lIHRva2VuIGFuZFxuICAgICAqIHNuYXBzaG90IHZlcnNpb24uXG4gICAgICovICAgIHdpdGhSZXN1bWVUb2tlbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgVGFyZ2V0RGF0YSh0aGlzLnRhcmdldCwgdGhpcy50YXJnZXRJZCwgdGhpcy5wdXJwb3NlLCB0aGlzLnNlcXVlbmNlTnVtYmVyLCB0LCB0aGlzLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24sIGUsIFxuICAgICAgICAvKiBleHBlY3RlZENvdW50PSAqLyBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgZGF0YSBpbnN0YW5jZSB3aXRoIGFuIHVwZGF0ZWQgZXhwZWN0ZWQgY291bnQuXG4gICAgICovICAgIHdpdGhFeHBlY3RlZENvdW50KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBUYXJnZXREYXRhKHRoaXMudGFyZ2V0LCB0aGlzLnRhcmdldElkLCB0aGlzLnB1cnBvc2UsIHRoaXMuc2VxdWVuY2VOdW1iZXIsIHRoaXMuc25hcHNob3RWZXJzaW9uLCB0aGlzLmxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24sIHRoaXMucmVzdW1lVG9rZW4sIGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDcmVhdGVzIGEgbmV3IHRhcmdldCBkYXRhIGluc3RhbmNlIHdpdGggYW4gdXBkYXRlZCBsYXN0IGxpbWJvIGZyZWVcbiAgICAgKiBzbmFwc2hvdCB2ZXJzaW9uIG51bWJlci5cbiAgICAgKi8gICAgd2l0aExhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24oZSkge1xuICAgICAgICByZXR1cm4gbmV3IFRhcmdldERhdGEodGhpcy50YXJnZXQsIHRoaXMudGFyZ2V0SWQsIHRoaXMucHVycG9zZSwgdGhpcy5zZXF1ZW5jZU51bWJlciwgdGhpcy5zbmFwc2hvdFZlcnNpb24sIGUsIHRoaXMucmVzdW1lVG9rZW4sIHRoaXMuZXhwZWN0ZWRDb3VudCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFNlcmlhbGl6ZXIgZm9yIHZhbHVlcyBzdG9yZWQgaW4gdGhlIExvY2FsU3RvcmUuICovIGNsYXNzIF9fUFJJVkFURV9Mb2NhbFNlcmlhbGl6ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5UdCA9IGU7XG4gICAgfVxufVxuXG4vKiogRGVjb2RlcyBhIHJlbW90ZSBkb2N1bWVudCBmcm9tIHN0b3JhZ2UgbG9jYWxseSB0byBhIERvY3VtZW50LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiUmVtb3RlRG9jdW1lbnQoZSwgdCkge1xuICAgIGxldCBuO1xuICAgIGlmICh0LmRvY3VtZW50KSBuID0gX19QUklWQVRFX2Zyb21Eb2N1bWVudChlLlR0LCB0LmRvY3VtZW50LCAhIXQuaGFzQ29tbWl0dGVkTXV0YXRpb25zKTsgZWxzZSBpZiAodC5ub0RvY3VtZW50KSB7XG4gICAgICAgIGNvbnN0IGUgPSBEb2N1bWVudEtleS5mcm9tU2VnbWVudHModC5ub0RvY3VtZW50LnBhdGgpLCByID0gX19QUklWQVRFX2Zyb21EYlRpbWVzdGFtcCh0Lm5vRG9jdW1lbnQucmVhZFRpbWUpO1xuICAgICAgICBuID0gTXV0YWJsZURvY3VtZW50Lm5ld05vRG9jdW1lbnQoZSwgciksIHQuaGFzQ29tbWl0dGVkTXV0YXRpb25zICYmIG4uc2V0SGFzQ29tbWl0dGVkTXV0YXRpb25zKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKCF0LnVua25vd25Eb2N1bWVudCkgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAge1xuICAgICAgICAgICAgY29uc3QgZSA9IERvY3VtZW50S2V5LmZyb21TZWdtZW50cyh0LnVua25vd25Eb2N1bWVudC5wYXRoKSwgciA9IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAodC51bmtub3duRG9jdW1lbnQudmVyc2lvbik7XG4gICAgICAgICAgICBuID0gTXV0YWJsZURvY3VtZW50Lm5ld1Vua25vd25Eb2N1bWVudChlLCByKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdC5yZWFkVGltZSAmJiBuLnNldFJlYWRUaW1lKGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXBLZXkoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IFRpbWVzdGFtcChlWzBdLCBlWzFdKTtcbiAgICAgICAgcmV0dXJuIFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKHQpO1xuICAgIH0odC5yZWFkVGltZSkpLCBuO1xufVxuXG4vKiogRW5jb2RlcyBhIGRvY3VtZW50IGZvciBzdG9yYWdlIGxvY2FsbHkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV90b0RiUmVtb3RlRG9jdW1lbnQoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmtleSwgciA9IHtcbiAgICAgICAgcHJlZml4UGF0aDogbi5nZXRDb2xsZWN0aW9uUGF0aCgpLnBvcExhc3QoKS50b0FycmF5KCksXG4gICAgICAgIGNvbGxlY3Rpb25Hcm91cDogbi5jb2xsZWN0aW9uR3JvdXAsXG4gICAgICAgIGRvY3VtZW50SWQ6IG4ucGF0aC5sYXN0U2VnbWVudCgpLFxuICAgICAgICByZWFkVGltZTogX19QUklWQVRFX3RvRGJUaW1lc3RhbXBLZXkodC5yZWFkVGltZSksXG4gICAgICAgIGhhc0NvbW1pdHRlZE11dGF0aW9uczogdC5oYXNDb21taXR0ZWRNdXRhdGlvbnNcbiAgICB9O1xuICAgIGlmICh0LmlzRm91bmREb2N1bWVudCgpKSByLmRvY3VtZW50ID0gZnVuY3Rpb24gX19QUklWQVRFX3RvRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbmFtZTogX19QUklWQVRFX3RvTmFtZShlLCB0LmtleSksXG4gICAgICAgICAgICBmaWVsZHM6IHQuZGF0YS52YWx1ZS5tYXBWYWx1ZS5maWVsZHMsXG4gICAgICAgICAgICB1cGRhdGVUaW1lOiB0b1RpbWVzdGFtcChlLCB0LnZlcnNpb24udG9UaW1lc3RhbXAoKSksXG4gICAgICAgICAgICBjcmVhdGVUaW1lOiB0b1RpbWVzdGFtcChlLCB0LmNyZWF0ZVRpbWUudG9UaW1lc3RhbXAoKSlcbiAgICAgICAgfTtcbiAgICB9KGUuVHQsIHQpOyBlbHNlIGlmICh0LmlzTm9Eb2N1bWVudCgpKSByLm5vRG9jdW1lbnQgPSB7XG4gICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgIHJlYWRUaW1lOiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcCh0LnZlcnNpb24pXG4gICAgfTsgZWxzZSB7XG4gICAgICAgIGlmICghdC5pc1Vua25vd25Eb2N1bWVudCgpKSByZXR1cm4gZmFpbCgpO1xuICAgICAgICByLnVua25vd25Eb2N1bWVudCA9IHtcbiAgICAgICAgICAgIHBhdGg6IG4ucGF0aC50b0FycmF5KCksXG4gICAgICAgICAgICB2ZXJzaW9uOiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcCh0LnZlcnNpb24pXG4gICAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiByO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleShlKSB7XG4gICAgY29uc3QgdCA9IGUudG9UaW1lc3RhbXAoKTtcbiAgICByZXR1cm4gWyB0LnNlY29uZHMsIHQubmFub3NlY29uZHMgXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRGJUaW1lc3RhbXAoZSkge1xuICAgIGNvbnN0IHQgPSBlLnRvVGltZXN0YW1wKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2Vjb25kczogdC5zZWNvbmRzLFxuICAgICAgICBuYW5vc2Vjb25kczogdC5uYW5vc2Vjb25kc1xuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZSkge1xuICAgIGNvbnN0IHQgPSBuZXcgVGltZXN0YW1wKGUuc2Vjb25kcywgZS5uYW5vc2Vjb25kcyk7XG4gICAgcmV0dXJuIFNuYXBzaG90VmVyc2lvbi5mcm9tVGltZXN0YW1wKHQpO1xufVxuXG4vKiogRW5jb2RlcyBhIGJhdGNoIG9mIG11dGF0aW9ucyBpbnRvIGEgRGJNdXRhdGlvbkJhdGNoIGZvciBsb2NhbCBzdG9yYWdlLiAqL1xuLyoqIERlY29kZXMgYSBEYk11dGF0aW9uQmF0Y2ggaW50byBhIE11dGF0aW9uQmF0Y2ggKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICBjb25zdCBuID0gKHQuYmFzZU11dGF0aW9ucyB8fCBbXSkubWFwKCh0ID0+IF9fUFJJVkFURV9mcm9tTXV0YXRpb24oZS5UdCwgdCkpKTtcbiAgICAvLyBTcXVhc2ggb2xkIHRyYW5zZm9ybSBtdXRhdGlvbnMgaW50byBleGlzdGluZyBwYXRjaCBvciBzZXQgbXV0YXRpb25zLlxuICAgIC8vIFRoZSByZXBsYWNlbWVudCBvZiByZXByZXNlbnRpbmcgYHRyYW5zZm9ybXNgIHdpdGggYHVwZGF0ZV90cmFuc2Zvcm1zYFxuICAgIC8vIG9uIHRoZSBTREsgbWVhbnMgdGhhdCBvbGQgYHRyYW5zZm9ybWAgbXV0YXRpb25zIHN0b3JlZCBpbiBJbmRleGVkREIgbmVlZFxuICAgIC8vIHRvIGJlIHVwZGF0ZWQgdG8gYHVwZGF0ZV90cmFuc2Zvcm1zYC5cbiAgICAvLyBUT0RPKGIvMTc0NjA4Mzc0KTogUmVtb3ZlIHRoaXMgY29kZSBvbmNlIHdlIHBlcmZvcm0gYSBzY2hlbWEgbWlncmF0aW9uLlxuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHQubXV0YXRpb25zLmxlbmd0aCAtIDE7ICsrZSkge1xuICAgICAgICBjb25zdCBuID0gdC5tdXRhdGlvbnNbZV07XG4gICAgICAgIGlmIChlICsgMSA8IHQubXV0YXRpb25zLmxlbmd0aCAmJiB2b2lkIDAgIT09IHQubXV0YXRpb25zW2UgKyAxXS50cmFuc2Zvcm0pIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0Lm11dGF0aW9uc1tlICsgMV07XG4gICAgICAgICAgICBuLnVwZGF0ZVRyYW5zZm9ybXMgPSByLnRyYW5zZm9ybS5maWVsZFRyYW5zZm9ybXMsIHQubXV0YXRpb25zLnNwbGljZShlICsgMSwgMSksIFxuICAgICAgICAgICAgKytlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IHIgPSB0Lm11dGF0aW9ucy5tYXAoKHQgPT4gX19QUklWQVRFX2Zyb21NdXRhdGlvbihlLlR0LCB0KSkpLCBpID0gVGltZXN0YW1wLmZyb21NaWxsaXModC5sb2NhbFdyaXRlVGltZU1zKTtcbiAgICByZXR1cm4gbmV3IE11dGF0aW9uQmF0Y2godC5iYXRjaElkLCBpLCBuLCByKTtcbn1cblxuLyoqIERlY29kZXMgYSBEYlRhcmdldCBpbnRvIFRhcmdldERhdGEgKi8gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYlRhcmdldChlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZS5yZWFkVGltZSksIG4gPSB2b2lkIDAgIT09IGUubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbiA/IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZS5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uKSA6IFNuYXBzaG90VmVyc2lvbi5taW4oKTtcbiAgICBsZXQgcjtcbiAgICByZXR1cm4gciA9IFxuICAgIC8qKlxuICogQSBoZWxwZXIgZnVuY3Rpb24gZm9yIGZpZ3VyaW5nIG91dCB3aGF0IGtpbmQgb2YgcXVlcnkgaGFzIGJlZW4gc3RvcmVkLlxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2lzRG9jdW1lbnRRdWVyeShlKSB7XG4gICAgICAgIHJldHVybiB2b2lkIDAgIT09IGUuZG9jdW1lbnRzO1xuICAgIH1cbiAgICAvKiogRW5jb2RlcyBhIERiQnVuZGxlIHRvIGEgQnVuZGxlTWV0YWRhdGEgb2JqZWN0LiAqLyAoZS5xdWVyeSkgPyBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURvY3VtZW50c1RhcmdldChlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydCgxID09PSBlLmRvY3VtZW50cy5sZW5ndGgpLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChfX1BSSVZBVEVfbmV3UXVlcnlGb3JQYXRoKF9fUFJJVkFURV9mcm9tUXVlcnlQYXRoKGUuZG9jdW1lbnRzWzBdKSkpO1xuICAgIH0oZS5xdWVyeSkgOiBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KF9fUFJJVkFURV9jb252ZXJ0UXVlcnlUYXJnZXRUb1F1ZXJ5KGUpKTtcbiAgICB9KGUucXVlcnkpLCBuZXcgVGFyZ2V0RGF0YShyLCBlLnRhcmdldElkLCBcIlRhcmdldFB1cnBvc2VMaXN0ZW5cIiAvKiBUYXJnZXRQdXJwb3NlLkxpc3RlbiAqLyAsIGUubGFzdExpc3RlblNlcXVlbmNlTnVtYmVyLCB0LCBuLCBCeXRlU3RyaW5nLmZyb21CYXNlNjRTdHJpbmcoZS5yZXN1bWVUb2tlbikpO1xufVxuXG4vKiogRW5jb2RlcyBUYXJnZXREYXRhIGludG8gYSBEYlRhcmdldCBmb3Igc3RvcmFnZSBsb2NhbGx5LiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYlRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKHQuc25hcHNob3RWZXJzaW9uKSwgciA9IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKHQubGFzdExpbWJvRnJlZVNuYXBzaG90VmVyc2lvbik7XG4gICAgbGV0IGk7XG4gICAgaSA9IF9fUFJJVkFURV90YXJnZXRJc0RvY3VtZW50VGFyZ2V0KHQudGFyZ2V0KSA/IF9fUFJJVkFURV90b0RvY3VtZW50c1RhcmdldChlLlR0LCB0LnRhcmdldCkgOiBfX1BSSVZBVEVfdG9RdWVyeVRhcmdldChlLlR0LCB0LnRhcmdldCkuaHQ7XG4gICAgLy8gV2UgY2FuJ3Qgc3RvcmUgdGhlIHJlc3VtZVRva2VuIGFzIGEgQnl0ZVN0cmluZyBpbiBJbmRleGVkRGIsIHNvIHdlXG4gICAgLy8gY29udmVydCBpdCB0byBhIGJhc2U2NCBzdHJpbmcgZm9yIHN0b3JhZ2UuXG4gICAgICAgIGNvbnN0IHMgPSB0LnJlc3VtZVRva2VuLnRvQmFzZTY0KCk7XG4gICAgLy8gbGFzdExpc3RlblNlcXVlbmNlTnVtYmVyIGlzIGFsd2F5cyAwIHVudGlsIHdlIGRvIHJlYWwgR0MuXG4gICAgICAgIHJldHVybiB7XG4gICAgICAgIHRhcmdldElkOiB0LnRhcmdldElkLFxuICAgICAgICBjYW5vbmljYWxJZDogX19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KHQudGFyZ2V0KSxcbiAgICAgICAgcmVhZFRpbWU6IG4sXG4gICAgICAgIHJlc3VtZVRva2VuOiBzLFxuICAgICAgICBsYXN0TGlzdGVuU2VxdWVuY2VOdW1iZXI6IHQuc2VxdWVuY2VOdW1iZXIsXG4gICAgICAgIGxhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb246IHIsXG4gICAgICAgIHF1ZXJ5OiBpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBFbmNvZGVzIGEgYEJ1bmRsZWRRdWVyeWAgZnJvbSBidW5kbGUgcHJvdG8gdG8gYSBRdWVyeSBvYmplY3QuXG4gKlxuICogVGhpcyByZWNvbnN0cnVjdHMgdGhlIG9yaWdpbmFsIHF1ZXJ5IHVzZWQgdG8gYnVpbGQgdGhlIGJ1bmRsZSBiZWluZyBsb2FkZWQsXG4gKiBpbmNsdWRpbmcgZmVhdHVyZXMgZXhpc3RzIG9ubHkgaW4gU0RLcyAoZm9yIGV4YW1wbGU6IGxpbWl0LXRvLWxhc3QpLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeShlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jb252ZXJ0UXVlcnlUYXJnZXRUb1F1ZXJ5KHtcbiAgICAgICAgcGFyZW50OiBlLnBhcmVudCxcbiAgICAgICAgc3RydWN0dXJlZFF1ZXJ5OiBlLnN0cnVjdHVyZWRRdWVyeVxuICAgIH0pO1xuICAgIHJldHVybiBcIkxBU1RcIiA9PT0gZS5saW1pdFR5cGUgPyBfX1BSSVZBVEVfcXVlcnlXaXRoTGltaXQodCwgdC5saW1pdCwgXCJMXCIgLyogTGltaXRUeXBlLkxhc3QgKi8pIDogdDtcbn1cblxuLyoqIEVuY29kZXMgYSBOYW1lZFF1ZXJ5IHByb3RvIG9iamVjdCB0byBhIE5hbWVkUXVlcnkgbW9kZWwgb2JqZWN0LiAqL1xuLyoqIEVuY29kZXMgYSBEYkRvY3VtZW50T3ZlcmxheSBvYmplY3QgdG8gYW4gT3ZlcmxheSBtb2RlbCBvYmplY3QuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiRG9jdW1lbnRPdmVybGF5KGUsIHQpIHtcbiAgICByZXR1cm4gbmV3IE92ZXJsYXkodC5sYXJnZXN0QmF0Y2hJZCwgX19QUklWQVRFX2Zyb21NdXRhdGlvbihlLlR0LCB0Lm92ZXJsYXlNdXRhdGlvbikpO1xufVxuXG4vKiogRGVjb2RlcyBhbiBPdmVybGF5IG1vZGVsIG9iamVjdCBpbnRvIGEgRGJEb2N1bWVudE92ZXJsYXkgb2JqZWN0LiAqL1xuLyoqXG4gKiBSZXR1cm5zIHRoZSBEYkRvY3VtZW50T3ZlcmxheUtleSBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiB1c2VyIGFuZFxuICogZG9jdW1lbnQga2V5LlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkRvY3VtZW50T3ZlcmxheUtleShlLCB0KSB7XG4gICAgY29uc3QgbiA9IHQucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgIHJldHVybiBbIGUsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodC5wYXRoLnBvcExhc3QoKSksIG4gXTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RvRGJJbmRleFN0YXRlKGUsIHQsIG4sIHIpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBpbmRleElkOiBlLFxuICAgICAgICB1aWQ6IHQsXG4gICAgICAgIHNlcXVlbmNlTnVtYmVyOiBuLFxuICAgICAgICByZWFkVGltZTogX19QUklWQVRFX3RvRGJUaW1lc3RhbXAoci5yZWFkVGltZSksXG4gICAgICAgIGRvY3VtZW50S2V5OiBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHIuZG9jdW1lbnRLZXkucGF0aCksXG4gICAgICAgIGxhcmdlc3RCYXRjaElkOiByLmxhcmdlc3RCYXRjaElkXG4gICAgfTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYkJ1bmRsZUNhY2hlIHtcbiAgICBnZXRCdW5kbGVNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfYnVuZGxlc1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmIChlKSByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2Zyb21EYkJ1bmRsZShlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGUuYnVuZGxlSWQsXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IF9fUFJJVkFURV9mcm9tRGJUaW1lc3RhbXAoZS5jcmVhdGVUaW1lKSxcbiAgICAgICAgICAgICAgICAgICAgdmVyc2lvbjogZS52ZXJzaW9uXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKiBFbmNvZGVzIGEgQnVuZGxlTWV0YWRhdGEgdG8gYSBEYkJ1bmRsZS4gKi8gKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNhdmVCdW5kbGVNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfYnVuZGxlc1N0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkJ1bmRsZShlKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGJ1bmRsZUlkOiBlLmlkLFxuICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLmNyZWF0ZVRpbWUpKSxcbiAgICAgICAgICAgICAgICB2ZXJzaW9uOiBlLnZlcnNpb25cbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgLyoqIEVuY29kZXMgYSBEYk5hbWVkUXVlcnkgdG8gYSBOYW1lZFF1ZXJ5LiAqLyAodCkpO1xuICAgIH1cbiAgICBnZXROYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9uYW1lZFF1ZXJpZXNTdG9yZShlKS5nZXQodCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpZiAoZSkgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9mcm9tRGJOYW1lZFF1ZXJ5KGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICBuYW1lOiBlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIHF1ZXJ5OiBfX1BSSVZBVEVfZnJvbUJ1bmRsZWRRdWVyeShlLmJ1bmRsZWRRdWVyeSksXG4gICAgICAgICAgICAgICAgICAgIHJlYWRUaW1lOiBfX1BSSVZBVEVfZnJvbURiVGltZXN0YW1wKGUucmVhZFRpbWUpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKiBFbmNvZGVzIGEgTmFtZWRRdWVyeSBmcm9tIGEgYnVuZGxlIHByb3RvIHRvIGEgRGJOYW1lZFF1ZXJ5LiAqLyAoZSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2F2ZU5hbWVkUXVlcnkoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX25hbWVkUXVlcmllc1N0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYk5hbWVkUXVlcnkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBlLm5hbWUsXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IF9fUFJJVkFURV90b0RiVGltZXN0YW1wKF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLnJlYWRUaW1lKSksXG4gICAgICAgICAgICAgICAgYnVuZGxlZFF1ZXJ5OiBlLmJ1bmRsZWRRdWVyeVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgYnVuZGxlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2J1bmRsZXNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBtZSk7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBuYW1lZFF1ZXJpZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uYW1lZFF1ZXJpZXNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBnZSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIERvY3VtZW50T3ZlcmxheUNhY2hlIHVzaW5nIEluZGV4ZWREYi5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiRG9jdW1lbnRPdmVybGF5Q2FjaGUge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIGRvY3VtZW50IHNlcmlhbGl6ZXIuXG4gICAgICogQHBhcmFtIHVzZXJJZCAtIFRoZSB1c2VySWQgZm9yIHdoaWNoIHdlIGFyZSBhY2Nlc3Npbmcgb3ZlcmxheXMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBlLCB0aGlzLnVzZXJJZCA9IHQ7XG4gICAgfVxuICAgIHN0YXRpYyBJdChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnVpZCB8fCBcIlwiO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJEb2N1bWVudE92ZXJsYXlDYWNoZShlLCBuKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheShlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkuZ2V0KF9fUFJJVkFURV90b0RiRG9jdW1lbnRPdmVybGF5S2V5KHRoaXMudXNlcklkLCB0KSkubmV4dCgoZSA9PiBlID8gX19QUklWQVRFX2Zyb21EYkRvY3VtZW50T3ZlcmxheSh0aGlzLnNlcmlhbGl6ZXIsIGUpIDogbnVsbCkpO1xuICAgIH1cbiAgICBnZXRPdmVybGF5cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKHQgPT4gdGhpcy5nZXRPdmVybGF5KGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgbnVsbCAhPT0gZSAmJiBuLnNldCh0LCBlKTtcbiAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBzYXZlT3ZlcmxheXMoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKChuLCBpKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gbmV3IE92ZXJsYXkodCwgaSk7XG4gICAgICAgICAgICByLnB1c2godGhpcy5FdChlLCBzKSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3Iocik7XG4gICAgfVxuICAgIHJlbW92ZU92ZXJsYXlzRm9yQmF0Y2hJZChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgU2V0O1xuICAgICAgICAvLyBHZXQgdGhlIHNldCBvZiB1bmlxdWUgY29sbGVjdGlvbiBwYXRocy5cbiAgICAgICAgICAgICAgICB0LmZvckVhY2goKGUgPT4gci5hZGQoX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLmdldENvbGxlY3Rpb25QYXRoKCkpKSkpO1xuICAgICAgICBjb25zdCBpID0gW107XG4gICAgICAgIHJldHVybiByLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIHQsIG4gXSwgWyB0aGlzLnVzZXJJZCwgdCwgbiArIDEgXSwgXG4gICAgICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCk7XG4gICAgICAgICAgICBpLnB1c2goX19QUklWQVRFX2RvY3VtZW50T3ZlcmxheVN0b3JlKGUpLkooa2UsIHIpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCksIGkgPSBfX1BSSVZBVEVfZW5jb2RlUmVzb3VyY2VQYXRoKHQpLCBzID0gSURCS2V5UmFuZ2UuYm91bmQoWyB0aGlzLnVzZXJJZCwgaSwgbiBdLCBbIHRoaXMudXNlcklkLCBpLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kb2N1bWVudE92ZXJsYXlTdG9yZShlKS5HKGtlLCBzKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IF9fUFJJVkFURV9mcm9tRGJEb2N1bWVudE92ZXJsYXkodGhpcy5zZXJpYWxpemVyLCB0KTtcbiAgICAgICAgICAgICAgICByLnNldChlLmdldEtleSgpLCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCk7XG4gICAgICAgIGxldCBzO1xuICAgICAgICAvLyBXZSB3YW50IGJhdGNoIElEcyBsYXJnZXIgdGhhbiBgc2luY2VCYXRjaElkYCwgYW5kIHNvIHRoZSBsb3dlciBib3VuZFxuICAgICAgICAvLyBpcyBub3QgaW5jbHVzaXZlLlxuICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBJREJLZXlSYW5nZS5ib3VuZChbIHRoaXMudXNlcklkLCB0LCBuIF0sIFsgdGhpcy51c2VySWQsIHQsIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITApO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50T3ZlcmxheVN0b3JlKGUpLlooe1xuICAgICAgICAgICAgaW5kZXg6IFFlLFxuICAgICAgICAgICAgcmFuZ2U6IG9cbiAgICAgICAgfSwgKChlLCB0LCBuKSA9PiB7XG4gICAgICAgICAgICAvLyBXZSBkbyBub3Qgd2FudCB0byByZXR1cm4gcGFydGlhbCBiYXRjaCBvdmVybGF5cywgZXZlbiBpZiB0aGUgc2l6ZVxuICAgICAgICAgICAgLy8gb2YgdGhlIHJlc3VsdCBzZXQgZXhjZWVkcyB0aGUgZ2l2ZW4gYGNvdW50YCBhcmd1bWVudC4gVGhlcmVmb3JlLCB3ZVxuICAgICAgICAgICAgLy8gY29udGludWUgdG8gYWdncmVnYXRlIHJlc3VsdHMgZXZlbiBhZnRlciB0aGUgcmVzdWx0IHNpemUgZXhjZWVkc1xuICAgICAgICAgICAgLy8gYGNvdW50YCBpZiB0aGVyZSBhcmUgbW9yZSBvdmVybGF5cyBmcm9tIHRoZSBgY3VycmVudEJhdGNoSWRgLlxuICAgICAgICAgICAgY29uc3QgbyA9IF9fUFJJVkFURV9mcm9tRGJEb2N1bWVudE92ZXJsYXkodGhpcy5zZXJpYWxpemVyLCB0KTtcbiAgICAgICAgICAgIGkuc2l6ZSgpIDwgciB8fCBvLmxhcmdlc3RCYXRjaElkID09PSBzID8gKGkuc2V0KG8uZ2V0S2V5KCksIG8pLCBzID0gby5sYXJnZXN0QmF0Y2hJZCkgOiBuLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgRXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50T3ZlcmxheVN0b3JlKGUpLnB1dChmdW5jdGlvbiBfX1BSSVZBVEVfdG9EYkRvY3VtZW50T3ZlcmxheShlLCB0LCBuKSB7XG4gICAgICAgICAgICBjb25zdCBbciwgaSwgc10gPSBfX1BSSVZBVEVfdG9EYkRvY3VtZW50T3ZlcmxheUtleSh0LCBuLm11dGF0aW9uLmtleSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHVzZXJJZDogdCxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uUGF0aDogaSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudElkOiBzLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25Hcm91cDogbi5tdXRhdGlvbi5rZXkuZ2V0Q29sbGVjdGlvbkdyb3VwKCksXG4gICAgICAgICAgICAgICAgbGFyZ2VzdEJhdGNoSWQ6IG4ubGFyZ2VzdEJhdGNoSWQsXG4gICAgICAgICAgICAgICAgb3ZlcmxheU11dGF0aW9uOiB0b011dGF0aW9uKGUuVHQsIG4ubXV0YXRpb24pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHRoaXMuc2VyaWFsaXplciwgdGhpcy51c2VySWQsIHQpKTtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBkb2N1bWVudCBvdmVybGF5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRPdmVybGF5U3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgQmUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyNCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiR2xvYmFsc0NhY2hlIHtcbiAgICBkdChlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgVWUpO1xuICAgIH1cbiAgICBnZXRTZXNzaW9uVG9rZW4oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5kdChlKS5nZXQoXCJzZXNzaW9uVG9rZW5cIikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbnVsbCA9PSBlID8gdm9pZCAwIDogZS52YWx1ZTtcbiAgICAgICAgICAgIHJldHVybiB0ID8gQnl0ZVN0cmluZy5mcm9tVWludDhBcnJheSh0KSA6IEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkc7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgc2V0U2Vzc2lvblRva2VuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZHQoZSkucHV0KHtcbiAgICAgICAgICAgIG5hbWU6IFwic2Vzc2lvblRva2VuXCIsXG4gICAgICAgICAgICB2YWx1ZTogdC50b1VpbnQ4QXJyYXkoKVxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIxIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBOb3RlOiBUaGlzIGNvZGUgaXMgY29waWVkIGZyb20gdGhlIGJhY2tlbmQuIENvZGUgdGhhdCBpcyBub3QgdXNlZCBieVxuLy8gRmlyZXN0b3JlIHdhcyByZW1vdmVkLlxuLyoqIEZpcmVzdG9yZSBpbmRleCB2YWx1ZSB3cml0ZXIuICAqL1xuY2xhc3MgX19QUklWQVRFX0ZpcmVzdG9yZUluZGV4VmFsdWVXcml0ZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge31cbiAgICAvLyBUaGUgd3JpdGUgbWV0aG9kcyBiZWxvdyBzaG9ydC1jaXJjdWl0IHdyaXRpbmcgdGVybWluYXRvcnMgZm9yIHZhbHVlc1xuICAgIC8vIGNvbnRhaW5pbmcgYSAodGVybWluYXRpbmcpIHRydW5jYXRlZCB2YWx1ZS5cbiAgICAvLyBBcyBhbiBleGFtcGxlLCBjb25zaWRlciB0aGUgcmVzdWx0aW5nIGVuY29kaW5nIGZvcjpcbiAgICAvLyBbXCJiYXJcIiwgWzIsIFwiZm9vXCJdXSAtPiAoU1RSSU5HLCBcImJhclwiLCBURVJNLCBBUlJBWSwgTlVNQkVSLCAyLCBTVFJJTkcsIFwiZm9vXCIsIFRFUk0sIFRFUk0sIFRFUk0pXG4gICAgLy8gW1wiYmFyXCIsIFsyLCB0cnVuY2F0ZWQoXCJmb29cIildXSAtPiAoU1RSSU5HLCBcImJhclwiLCBURVJNLCBBUlJBWSwgTlVNQkVSLCAyLCBTVFJJTkcsIFwiZm9vXCIsIFRSVU5DKVxuICAgIC8vIFtcImJhclwiLCB0cnVuY2F0ZWQoW1wiZm9vXCJdKV0gLT4gKFNUUklORywgXCJiYXJcIiwgVEVSTSwgQVJSQVkuIFNUUklORywgXCJmb29cIiwgVEVSTSwgVFJVTkMpXG4gICAgLyoqIFdyaXRlcyBhbiBpbmRleCB2YWx1ZS4gICovXG4gICAgQXQoZSwgdCkge1xuICAgICAgICB0aGlzLlJ0KGUsIHQpLCBcbiAgICAgICAgLy8gV3JpdGUgc2VwYXJhdG9yIHRvIHNwbGl0IGluZGV4IHZhbHVlc1xuICAgICAgICAvLyAoc2VlIGdvL2ZpcmVzdG9yZS1zdG9yYWdlLWZvcm1hdCNlbmNvZGluZ3MpLlxuICAgICAgICB0LlZ0KCk7XG4gICAgfVxuICAgIFJ0KGUsIHQpIHtcbiAgICAgICAgaWYgKFwibnVsbFZhbHVlXCIgaW4gZSkgdGhpcy5mdCh0LCA1KTsgZWxzZSBpZiAoXCJib29sZWFuVmFsdWVcIiBpbiBlKSB0aGlzLmZ0KHQsIDEwKSwgXG4gICAgICAgIHQuZ3QoZS5ib29sZWFuVmFsdWUgPyAxIDogMCk7IGVsc2UgaWYgKFwiaW50ZWdlclZhbHVlXCIgaW4gZSkgdGhpcy5mdCh0LCAxNSksIHQuZ3QoX19QUklWQVRFX25vcm1hbGl6ZU51bWJlcihlLmludGVnZXJWYWx1ZSkpOyBlbHNlIGlmIChcImRvdWJsZVZhbHVlXCIgaW4gZSkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5kb3VibGVWYWx1ZSk7XG4gICAgICAgICAgICBpc05hTihuKSA/IHRoaXMuZnQodCwgMTMpIDogKHRoaXMuZnQodCwgMTUpLCBfX1BSSVZBVEVfaXNOZWdhdGl2ZVplcm8obikgPyBcbiAgICAgICAgICAgIC8vIC0wLjAsIDAgYW5kIDAuMCBhcmUgYWxsIGNvbnNpZGVyZWQgdGhlIHNhbWVcbiAgICAgICAgICAgIHQuZ3QoMCkgOiB0Lmd0KG4pKTtcbiAgICAgICAgfSBlbHNlIGlmIChcInRpbWVzdGFtcFZhbHVlXCIgaW4gZSkge1xuICAgICAgICAgICAgbGV0IG4gPSBlLnRpbWVzdGFtcFZhbHVlO1xuICAgICAgICAgICAgdGhpcy5mdCh0LCAyMCksIFwic3RyaW5nXCIgPT0gdHlwZW9mIG4gJiYgKG4gPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKG4pKSwgdC55dChgJHtuLnNlY29uZHMgfHwgXCJcIn1gKSwgXG4gICAgICAgICAgICB0Lmd0KG4ubmFub3MgfHwgMCk7XG4gICAgICAgIH0gZWxzZSBpZiAoXCJzdHJpbmdWYWx1ZVwiIGluIGUpIHRoaXMud3QoZS5zdHJpbmdWYWx1ZSwgdCksIHRoaXMuU3QodCk7IGVsc2UgaWYgKFwiYnl0ZXNWYWx1ZVwiIGluIGUpIHRoaXMuZnQodCwgMzApLCBcbiAgICAgICAgdC5idChfX1BSSVZBVEVfbm9ybWFsaXplQnl0ZVN0cmluZyhlLmJ5dGVzVmFsdWUpKSwgdGhpcy5TdCh0KTsgZWxzZSBpZiAoXCJyZWZlcmVuY2VWYWx1ZVwiIGluIGUpIHRoaXMuRHQoZS5yZWZlcmVuY2VWYWx1ZSwgdCk7IGVsc2UgaWYgKFwiZ2VvUG9pbnRWYWx1ZVwiIGluIGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmdlb1BvaW50VmFsdWU7XG4gICAgICAgICAgICB0aGlzLmZ0KHQsIDQ1KSwgdC5ndChuLmxhdGl0dWRlIHx8IDApLCB0Lmd0KG4ubG9uZ2l0dWRlIHx8IDApO1xuICAgICAgICB9IGVsc2UgXCJtYXBWYWx1ZVwiIGluIGUgPyBfX1BSSVZBVEVfaXNNYXhWYWx1ZShlKSA/IHRoaXMuZnQodCwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIpIDogX19QUklWQVRFX2lzVmVjdG9yVmFsdWUoZSkgPyB0aGlzLnZ0KGUubWFwVmFsdWUsIHQpIDogKHRoaXMuQ3QoZS5tYXBWYWx1ZSwgdCksIFxuICAgICAgICB0aGlzLlN0KHQpKSA6IFwiYXJyYXlWYWx1ZVwiIGluIGUgPyAodGhpcy5GdChlLmFycmF5VmFsdWUsIHQpLCB0aGlzLlN0KHQpKSA6IGZhaWwoKTtcbiAgICB9XG4gICAgd3QoZSwgdCkge1xuICAgICAgICB0aGlzLmZ0KHQsIDI1KSwgdGhpcy5NdChlLCB0KTtcbiAgICB9XG4gICAgTXQoZSwgdCkge1xuICAgICAgICB0Lnl0KGUpO1xuICAgIH1cbiAgICBDdChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBlLmZpZWxkcyB8fCB7fTtcbiAgICAgICAgdGhpcy5mdCh0LCA1NSk7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBPYmplY3Qua2V5cyhuKSkgdGhpcy53dChlLCB0KSwgdGhpcy5SdChuW2VdLCB0KTtcbiAgICB9XG4gICAgdnQoZSwgdCkge1xuICAgICAgICB2YXIgbiwgcjtcbiAgICAgICAgY29uc3QgaSA9IGUuZmllbGRzIHx8IHt9O1xuICAgICAgICB0aGlzLmZ0KHQsIDUzKTtcbiAgICAgICAgLy8gVmVjdG9ycyBzb3J0IGZpcnN0IGJ5IGxlbmd0aFxuICAgICAgICBjb25zdCBzID0gYXQsIG8gPSAobnVsbCA9PT0gKHIgPSBudWxsID09PSAobiA9IGlbc10uYXJyYXlWYWx1ZSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi52YWx1ZXMpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIubGVuZ3RoKSB8fCAwO1xuICAgICAgICB0aGlzLmZ0KHQsIDE1KSwgdC5ndChfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKG8pKSwgXG4gICAgICAgIC8vIFZlY3RvcnMgdGhlbiBzb3J0IGJ5IHBvc2l0aW9uIHZhbHVlXG4gICAgICAgIHRoaXMud3QocywgdCksIHRoaXMuUnQoaVtzXSwgdCk7XG4gICAgfVxuICAgIEZ0KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IGUudmFsdWVzIHx8IFtdO1xuICAgICAgICB0aGlzLmZ0KHQsIDUwKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIG4pIHRoaXMuUnQoZSwgdCk7XG4gICAgfVxuICAgIER0KGUsIHQpIHtcbiAgICAgICAgdGhpcy5mdCh0LCAzNyk7XG4gICAgICAgIERvY3VtZW50S2V5LmZyb21OYW1lKGUpLnBhdGguZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmZ0KHQsIDYwKSwgdGhpcy5NdChlLCB0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBmdChlLCB0KSB7XG4gICAgICAgIGUuZ3QodCk7XG4gICAgfVxuICAgIFN0KGUpIHtcbiAgICAgICAgLy8gV2hpbGUgdGhlIFNESyBkb2VzIG5vdCBpbXBsZW1lbnQgdHJ1bmNhdGlvbiwgdGhlIHRydW5jYXRpb24gbWFya2VyIGlzXG4gICAgICAgIC8vIHVzZWQgdG8gdGVybWluYXRlIGFsbCB2YXJpYWJsZSBsZW5ndGggdmFsdWVzICh3aGljaCBhcmUgc3RyaW5ncywgYnl0ZXMsXG4gICAgICAgIC8vIHJlZmVyZW5jZXMsIGFycmF5cyBhbmQgbWFwcykuXG4gICAgICAgIGUuZ3QoMik7XG4gICAgfVxufVxuXG5fX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlci54dCA9IG5ldyBfX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlcjtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyB8IGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIHwgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3MgfCBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBUaGVzZSBjb25zdGFudHMgYXJlIHRha2VuIGZyb20gdGhlIGJhY2tlbmQuICovXG5jb25zdCBndCA9IDI1NTtcblxuLyoqXG4gKiBDb3VudHMgdGhlIG51bWJlciBvZiB6ZXJvcyBpbiBhIGJ5dGUuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX251bWJlck9mTGVhZGluZ1plcm9zSW5CeXRlKGUpIHtcbiAgICBpZiAoMCA9PT0gZSkgcmV0dXJuIDg7XG4gICAgbGV0IHQgPSAwO1xuICAgIHJldHVybiBlID4+IDQgfHwgKFxuICAgIC8vIFRlc3QgaWYgdGhlIGZpcnN0IGZvdXIgYml0cyBhcmUgemVyby5cbiAgICB0ICs9IDQsIGUgPDw9IDQpLCBlID4+IDYgfHwgKFxuICAgIC8vIFRlc3QgaWYgdGhlIGZpcnN0IHR3byAob3IgbmV4dCB0d28pIGJpdHMgYXJlIHplcm8uXG4gICAgdCArPSAyLCBlIDw8PSAyKSwgZSA+PiA3IHx8IChcbiAgICAvLyBUZXN0IGlmIHRoZSByZW1haW5pbmcgYml0IGlzIHplcm8uXG4gICAgdCArPSAxKSwgdDtcbn1cblxuLyoqIENvdW50cyB0aGUgbnVtYmVyIG9mIGxlYWRpbmcgemVyb3MgaW4gdGhlIGdpdmVuIGJ5dGUgYXJyYXkuICovXG4vKipcbiAqIFJldHVybnMgdGhlIG51bWJlciBvZiBieXRlcyByZXF1aXJlZCB0byBzdG9yZSBcInZhbHVlXCIuIExlYWRpbmcgemVybyBieXRlc1xuICogYXJlIHNraXBwZWQuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV91bnNpZ25lZE51bUxlbmd0aChlKSB7XG4gICAgLy8gVGhpcyBpcyBqdXN0IHRoZSBudW1iZXIgb2YgYnl0ZXMgZm9yIHRoZSB1bnNpZ25lZCByZXByZXNlbnRhdGlvbiBvZiB0aGUgbnVtYmVyLlxuICAgIGNvbnN0IHQgPSA2NCAtIGZ1bmN0aW9uIF9fUFJJVkFURV9udW1iZXJPZkxlYWRpbmdaZXJvcyhlKSB7XG4gICAgICAgIGxldCB0ID0gMDtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCA4OyArK24pIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbnVtYmVyT2ZMZWFkaW5nWmVyb3NJbkJ5dGUoMjU1ICYgZVtuXSk7XG4gICAgICAgICAgICBpZiAodCArPSByLCA4ICE9PSByKSBicmVhaztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9KGUpO1xuICAgIHJldHVybiBNYXRoLmNlaWwodCAvIDgpO1xufVxuXG4vKipcbiAqIE9yZGVyZWRDb2RlV3JpdGVyIGlzIGEgbWluaW1hbC1hbGxvY2F0aW9uIGltcGxlbWVudGF0aW9uIG9mIHRoZSB3cml0aW5nXG4gKiBiZWhhdmlvciBkZWZpbmVkIGJ5IHRoZSBiYWNrZW5kLlxuICpcbiAqIFRoZSBjb2RlIGlzIHBvcnRlZCBmcm9tIGl0cyBKYXZhIGNvdW50ZXJwYXJ0LlxuICovIGNsYXNzIF9fUFJJVkFURV9PcmRlcmVkQ29kZVdyaXRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoMTAyNCksIHRoaXMucG9zaXRpb24gPSAwO1xuICAgIH1cbiAgICBPdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlW1N5bWJvbC5pdGVyYXRvcl0oKTtcbiAgICAgICAgbGV0IG4gPSB0Lm5leHQoKTtcbiAgICAgICAgZm9yICg7IW4uZG9uZTsgKSB0aGlzLk50KG4udmFsdWUpLCBuID0gdC5uZXh0KCk7XG4gICAgICAgIHRoaXMuQnQoKTtcbiAgICB9XG4gICAgTHQoZSkge1xuICAgICAgICBjb25zdCB0ID0gZVtTeW1ib2wuaXRlcmF0b3JdKCk7XG4gICAgICAgIGxldCBuID0gdC5uZXh0KCk7XG4gICAgICAgIGZvciAoOyFuLmRvbmU7ICkgdGhpcy5rdChuLnZhbHVlKSwgbiA9IHQubmV4dCgpO1xuICAgICAgICB0aGlzLnF0KCk7XG4gICAgfVxuICAgIC8qKiBXcml0ZXMgdXRmOCBieXRlcyBpbnRvIHRoaXMgYnl0ZSBzZXF1ZW5jZSwgYXNjZW5kaW5nLiAqLyAgICBRdChlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgaWYgKGUgPCAxMjgpIHRoaXMuTnQoZSk7IGVsc2UgaWYgKGUgPCAyMDQ4KSB0aGlzLk50KDk2MCB8IGUgPj4+IDYpLCB0aGlzLk50KDEyOCB8IDYzICYgZSk7IGVsc2UgaWYgKHQgPCBcIlxcdWQ4MDBcIiB8fCBcIlxcdWRiZmZcIiA8IHQpIHRoaXMuTnQoNDgwIHwgZSA+Pj4gMTIpLCBcbiAgICAgICAgICAgIHRoaXMuTnQoMTI4IHwgNjMgJiBlID4+PiA2KSwgdGhpcy5OdCgxMjggfCA2MyAmIGUpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdC5jb2RlUG9pbnRBdCgwKTtcbiAgICAgICAgICAgICAgICB0aGlzLk50KDI0MCB8IGUgPj4+IDE4KSwgdGhpcy5OdCgxMjggfCA2MyAmIGUgPj4+IDEyKSwgdGhpcy5OdCgxMjggfCA2MyAmIGUgPj4+IDYpLCBcbiAgICAgICAgICAgICAgICB0aGlzLk50KDEyOCB8IDYzICYgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5CdCgpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIHV0ZjggYnl0ZXMgaW50byB0aGlzIGJ5dGUgc2VxdWVuY2UsIGRlc2NlbmRpbmcgKi8gICAgJHQoZSkge1xuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IHQuY2hhckNvZGVBdCgwKTtcbiAgICAgICAgICAgIGlmIChlIDwgMTI4KSB0aGlzLmt0KGUpOyBlbHNlIGlmIChlIDwgMjA0OCkgdGhpcy5rdCg5NjAgfCBlID4+PiA2KSwgdGhpcy5rdCgxMjggfCA2MyAmIGUpOyBlbHNlIGlmICh0IDwgXCJcXHVkODAwXCIgfHwgXCJcXHVkYmZmXCIgPCB0KSB0aGlzLmt0KDQ4MCB8IGUgPj4+IDEyKSwgXG4gICAgICAgICAgICB0aGlzLmt0KDEyOCB8IDYzICYgZSA+Pj4gNiksIHRoaXMua3QoMTI4IHwgNjMgJiBlKTsgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHQuY29kZVBvaW50QXQoMCk7XG4gICAgICAgICAgICAgICAgdGhpcy5rdCgyNDAgfCBlID4+PiAxOCksIHRoaXMua3QoMTI4IHwgNjMgJiBlID4+PiAxMiksIHRoaXMua3QoMTI4IHwgNjMgJiBlID4+PiA2KSwgXG4gICAgICAgICAgICAgICAgdGhpcy5rdCgxMjggfCA2MyAmIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMucXQoKTtcbiAgICB9XG4gICAgVXQoZSkge1xuICAgICAgICAvLyBWYWx1ZXMgYXJlIGVuY29kZWQgd2l0aCBhIHNpbmdsZSBieXRlIGxlbmd0aCBwcmVmaXgsIGZvbGxvd2VkIGJ5IHRoZVxuICAgICAgICAvLyBhY3R1YWwgdmFsdWUgaW4gYmlnLWVuZGlhbiBmb3JtYXQgd2l0aCBsZWFkaW5nIDAgYnl0ZXMgZHJvcHBlZC5cbiAgICAgICAgY29uc3QgdCA9IHRoaXMuS3QoZSksIG4gPSBfX1BSSVZBVEVfdW5zaWduZWROdW1MZW5ndGgodCk7XG4gICAgICAgIHRoaXMuV3QoMSArIG4pLCB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gMjU1ICYgbjtcbiAgICAgICAgLy8gV3JpdGUgdGhlIGxlbmd0aFxuICAgICAgICBmb3IgKGxldCBlID0gdC5sZW5ndGggLSBuOyBlIDwgdC5sZW5ndGg7ICsrZSkgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IDI1NSAmIHRbZV07XG4gICAgfVxuICAgIEd0KGUpIHtcbiAgICAgICAgLy8gVmFsdWVzIGFyZSBlbmNvZGVkIHdpdGggYSBzaW5nbGUgYnl0ZSBsZW5ndGggcHJlZml4LCBmb2xsb3dlZCBieSB0aGVcbiAgICAgICAgLy8gaW52ZXJ0ZWQgdmFsdWUgaW4gYmlnLWVuZGlhbiBmb3JtYXQgd2l0aCBsZWFkaW5nIDAgYnl0ZXMgZHJvcHBlZC5cbiAgICAgICAgY29uc3QgdCA9IHRoaXMuS3QoZSksIG4gPSBfX1BSSVZBVEVfdW5zaWduZWROdW1MZW5ndGgodCk7XG4gICAgICAgIHRoaXMuV3QoMSArIG4pLCB0aGlzLmJ1ZmZlclt0aGlzLnBvc2l0aW9uKytdID0gfigyNTUgJiBuKTtcbiAgICAgICAgLy8gV3JpdGUgdGhlIGxlbmd0aFxuICAgICAgICBmb3IgKGxldCBlID0gdC5sZW5ndGggLSBuOyBlIDwgdC5sZW5ndGg7ICsrZSkgdGhpcy5idWZmZXJbdGhpcy5wb3NpdGlvbisrXSA9IH4oMjU1ICYgdFtlXSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyB0aGUgXCJpbmZpbml0eVwiIGJ5dGUgc2VxdWVuY2UgdGhhdCBzb3J0cyBhZnRlciBhbGwgb3RoZXIgYnl0ZVxuICAgICAqIHNlcXVlbmNlcyB3cml0dGVuIGluIGFzY2VuZGluZyBvcmRlci5cbiAgICAgKi8gICAgenQoKSB7XG4gICAgICAgIHRoaXMuanQoZ3QpLCB0aGlzLmp0KDI1NSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyB0aGUgXCJpbmZpbml0eVwiIGJ5dGUgc2VxdWVuY2UgdGhhdCBzb3J0cyBiZWZvcmUgYWxsIG90aGVyIGJ5dGVcbiAgICAgKiBzZXF1ZW5jZXMgd3JpdHRlbiBpbiBkZXNjZW5kaW5nIG9yZGVyLlxuICAgICAqLyAgICBIdCgpIHtcbiAgICAgICAgdGhpcy5KdChndCksIHRoaXMuSnQoMjU1KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBidWZmZXIgc3VjaCB0aGF0IGl0IGlzIHRoZSBzYW1lIGFzIHdoZW4gaXQgd2FzIG5ld2x5XG4gICAgICogY29uc3RydWN0ZWQuXG4gICAgICovICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLnBvc2l0aW9uID0gMDtcbiAgICB9XG4gICAgc2VlZChlKSB7XG4gICAgICAgIHRoaXMuV3QoZS5sZW5ndGgpLCB0aGlzLmJ1ZmZlci5zZXQoZSwgdGhpcy5wb3NpdGlvbiksIHRoaXMucG9zaXRpb24gKz0gZS5sZW5ndGg7XG4gICAgfVxuICAgIC8qKiBNYWtlcyBhIGNvcHkgb2YgdGhlIGVuY29kZWQgYnl0ZXMgaW4gdGhpcyBidWZmZXIuICAqLyAgICBZdCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLnNsaWNlKDAsIHRoaXMucG9zaXRpb24pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIGB2YWxgIGludG8gYW4gZW5jb2Rpbmcgc28gdGhhdCB0aGUgb3JkZXIgbWF0Y2hlcyB0aGUgSUVFRSA3NTRcbiAgICAgKiBmbG9hdGluZy1wb2ludCBjb21wYXJpc29uIHJlc3VsdHMgd2l0aCB0aGUgZm9sbG93aW5nIGV4Y2VwdGlvbnM6XG4gICAgICogICAtMC4wIDwgMC4wXG4gICAgICogICBhbGwgbm9uLU5hTiA8IE5hTlxuICAgICAqICAgTmFOID0gTmFOXG4gICAgICovICAgIEt0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFxuICAgICAgICAvKiogQ29udmVydHMgYSBKYXZhU2NyaXB0IG51bWJlciB0byBhIGJ5dGUgYXJyYXkgKHVzaW5nIGJpZyBlbmRpYW4gZW5jb2RpbmcpLiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZG91YmxlVG9Mb25nQml0cyhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IERhdGFWaWV3KG5ldyBBcnJheUJ1ZmZlcig4KSk7XG4gICAgICAgICAgICByZXR1cm4gdC5zZXRGbG9hdDY0KDAsIGUsIC8qIGxpdHRsZUVuZGlhbj0gKi8gITEpLCBuZXcgVWludDhBcnJheSh0LmJ1ZmZlcik7XG4gICAgICAgIH0oZSksIG4gPSAhISgxMjggJiB0WzBdKTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGZpcnN0IGJpdCBpcyBzZXQuIFdlIHVzZSBhIGJpdCBtYXNrIHNpbmNlIHZhbHVlWzBdIGlzXG4gICAgICAgIC8vIGVuY29kZWQgYXMgYSBudW1iZXIgZnJvbSAwIHRvIDI1NS5cbiAgICAgICAgICAgICAgICAvLyBSZXZlcnQgdGhlIHR3byBjb21wbGVtZW50IHRvIGdldCBuYXR1cmFsIG9yZGVyaW5nXG4gICAgICAgIHRbMF0gXj0gbiA/IDI1NSA6IDEyODtcbiAgICAgICAgZm9yIChsZXQgZSA9IDE7IGUgPCB0Lmxlbmd0aDsgKytlKSB0W2VdIF49IG4gPyAyNTUgOiAwO1xuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqIFdyaXRlcyBhIHNpbmdsZSBieXRlIGFzY2VuZGluZyB0byB0aGUgYnVmZmVyLiAqLyAgICBOdChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSAyNTUgJiBlO1xuICAgICAgICAwID09PSB0ID8gKHRoaXMuanQoMCksIHRoaXMuanQoMjU1KSkgOiB0ID09PSBndCA/ICh0aGlzLmp0KGd0KSwgdGhpcy5qdCgwKSkgOiB0aGlzLmp0KHQpO1xuICAgIH1cbiAgICAvKiogV3JpdGVzIGEgc2luZ2xlIGJ5dGUgZGVzY2VuZGluZyB0byB0aGUgYnVmZmVyLiAgKi8gICAga3QoZSkge1xuICAgICAgICBjb25zdCB0ID0gMjU1ICYgZTtcbiAgICAgICAgMCA9PT0gdCA/ICh0aGlzLkp0KDApLCB0aGlzLkp0KDI1NSkpIDogdCA9PT0gZ3QgPyAodGhpcy5KdChndCksIHRoaXMuSnQoMCkpIDogdGhpcy5KdChlKTtcbiAgICB9XG4gICAgQnQoKSB7XG4gICAgICAgIHRoaXMuanQoMCksIHRoaXMuanQoMSk7XG4gICAgfVxuICAgIHF0KCkge1xuICAgICAgICB0aGlzLkp0KDApLCB0aGlzLkp0KDEpO1xuICAgIH1cbiAgICBqdChlKSB7XG4gICAgICAgIHRoaXMuV3QoMSksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSBlO1xuICAgIH1cbiAgICBKdChlKSB7XG4gICAgICAgIHRoaXMuV3QoMSksIHRoaXMuYnVmZmVyW3RoaXMucG9zaXRpb24rK10gPSB+ZTtcbiAgICB9XG4gICAgV3QoZSkge1xuICAgICAgICBjb25zdCB0ID0gZSArIHRoaXMucG9zaXRpb247XG4gICAgICAgIGlmICh0IDw9IHRoaXMuYnVmZmVyLmxlbmd0aCkgcmV0dXJuO1xuICAgICAgICAvLyBUcnkgZG91YmxpbmcuXG4gICAgICAgICAgICAgICAgbGV0IG4gPSAyICogdGhpcy5idWZmZXIubGVuZ3RoO1xuICAgICAgICAvLyBTdGlsbCBub3QgYmlnIGVub3VnaD8gSnVzdCBhbGxvY2F0ZSB0aGUgcmlnaHQgc2l6ZS5cbiAgICAgICAgICAgICAgICBuIDwgdCAmJiAobiA9IHQpO1xuICAgICAgICAvLyBDcmVhdGUgdGhlIG5ldyBidWZmZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBVaW50OEFycmF5KG4pO1xuICAgICAgICByLnNldCh0aGlzLmJ1ZmZlciksIC8vIGNvcHkgb2xkIGRhdGFcbiAgICAgICAgdGhpcy5idWZmZXIgPSByO1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX0FzY2VuZGluZ0luZGV4Qnl0ZUVuY29kZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5adCA9IGU7XG4gICAgfVxuICAgIGJ0KGUpIHtcbiAgICAgICAgdGhpcy5adC5PdChlKTtcbiAgICB9XG4gICAgeXQoZSkge1xuICAgICAgICB0aGlzLlp0LlF0KGUpO1xuICAgIH1cbiAgICBndChlKSB7XG4gICAgICAgIHRoaXMuWnQuVXQoZSk7XG4gICAgfVxuICAgIFZ0KCkge1xuICAgICAgICB0aGlzLlp0Lnp0KCk7XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfRGVzY2VuZGluZ0luZGV4Qnl0ZUVuY29kZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5adCA9IGU7XG4gICAgfVxuICAgIGJ0KGUpIHtcbiAgICAgICAgdGhpcy5adC5MdChlKTtcbiAgICB9XG4gICAgeXQoZSkge1xuICAgICAgICB0aGlzLlp0LiR0KGUpO1xuICAgIH1cbiAgICBndChlKSB7XG4gICAgICAgIHRoaXMuWnQuR3QoZSk7XG4gICAgfVxuICAgIFZ0KCkge1xuICAgICAgICB0aGlzLlp0Lkh0KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEltcGxlbWVudHMgYERpcmVjdGlvbmFsSW5kZXhCeXRlRW5jb2RlcmAgdXNpbmcgYE9yZGVyZWRDb2RlV3JpdGVyYCBmb3IgdGhlXG4gKiBhY3R1YWwgZW5jb2RpbmcuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlp0ID0gbmV3IF9fUFJJVkFURV9PcmRlcmVkQ29kZVdyaXRlciwgdGhpcy5YdCA9IG5ldyBfX1BSSVZBVEVfQXNjZW5kaW5nSW5kZXhCeXRlRW5jb2Rlcih0aGlzLlp0KSwgXG4gICAgICAgIHRoaXMuZW4gPSBuZXcgX19QUklWQVRFX0Rlc2NlbmRpbmdJbmRleEJ5dGVFbmNvZGVyKHRoaXMuWnQpO1xuICAgIH1cbiAgICBzZWVkKGUpIHtcbiAgICAgICAgdGhpcy5adC5zZWVkKGUpO1xuICAgIH1cbiAgICB0bihlKSB7XG4gICAgICAgIHJldHVybiAwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8gPT09IGUgPyB0aGlzLlh0IDogdGhpcy5lbjtcbiAgICB9XG4gICAgWXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlp0Lll0KCk7XG4gICAgfVxuICAgIHJlc2V0KCkge1xuICAgICAgICB0aGlzLlp0LnJlc2V0KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIFJlcHJlc2VudHMgYW4gaW5kZXggZW50cnkgc2F2ZWQgYnkgdGhlIFNESyBpbiBwZXJzaXN0ZWQgc3RvcmFnZS4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4RW50cnkge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5pbmRleElkID0gZSwgdGhpcy5kb2N1bWVudEtleSA9IHQsIHRoaXMuYXJyYXlWYWx1ZSA9IG4sIHRoaXMuZGlyZWN0aW9uYWxWYWx1ZSA9IHI7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gSW5kZXhFbnRyeSBlbnRyeSB0aGF0IHNvcnRzIGltbWVkaWF0ZWx5IGFmdGVyIHRoZSBjdXJyZW50XG4gICAgICogZGlyZWN0aW9uYWwgdmFsdWUuXG4gICAgICovICAgIG5uKCkge1xuICAgICAgICBjb25zdCBlID0gdGhpcy5kaXJlY3Rpb25hbFZhbHVlLmxlbmd0aCwgdCA9IDAgPT09IGUgfHwgMjU1ID09PSB0aGlzLmRpcmVjdGlvbmFsVmFsdWVbZSAtIDFdID8gZSArIDEgOiBlLCBuID0gbmV3IFVpbnQ4QXJyYXkodCk7XG4gICAgICAgIHJldHVybiBuLnNldCh0aGlzLmRpcmVjdGlvbmFsVmFsdWUsIDApLCB0ICE9PSBlID8gbi5zZXQoWyAwIF0sIHRoaXMuZGlyZWN0aW9uYWxWYWx1ZS5sZW5ndGgpIDogKytuW24ubGVuZ3RoIC0gMV0sIFxuICAgICAgICBuZXcgX19QUklWQVRFX0luZGV4RW50cnkodGhpcy5pbmRleElkLCB0aGlzLmRvY3VtZW50S2V5LCB0aGlzLmFycmF5VmFsdWUsIG4pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2luZGV4RW50cnlDb21wYXJhdG9yKGUsIHQpIHtcbiAgICBsZXQgbiA9IGUuaW5kZXhJZCAtIHQuaW5kZXhJZDtcbiAgICByZXR1cm4gMCAhPT0gbiA/IG4gOiAobiA9IF9fUFJJVkFURV9jb21wYXJlQnl0ZUFycmF5cyhlLmFycmF5VmFsdWUsIHQuYXJyYXlWYWx1ZSksIFxuICAgIDAgIT09IG4gPyBuIDogKG4gPSBfX1BSSVZBVEVfY29tcGFyZUJ5dGVBcnJheXMoZS5kaXJlY3Rpb25hbFZhbHVlLCB0LmRpcmVjdGlvbmFsVmFsdWUpLCBcbiAgICAwICE9PSBuID8gbiA6IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5kb2N1bWVudEtleSwgdC5kb2N1bWVudEtleSkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXBhcmVCeXRlQXJyYXlzKGUsIHQpIHtcbiAgICBmb3IgKGxldCBuID0gMDsgbiA8IGUubGVuZ3RoICYmIG4gPCB0Lmxlbmd0aDsgKytuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBlW25dIC0gdFtuXTtcbiAgICAgICAgaWYgKDAgIT09IHIpIHJldHVybiByO1xuICAgIH1cbiAgICByZXR1cm4gZS5sZW5ndGggLSB0Lmxlbmd0aDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBsaWdodCBxdWVyeSBwbGFubmVyIGZvciBGaXJlc3RvcmUuXG4gKlxuICogVGhpcyBjbGFzcyBtYXRjaGVzIGEgYEZpZWxkSW5kZXhgIGFnYWluc3QgYSBGaXJlc3RvcmUgUXVlcnkgYFRhcmdldGAuIEl0XG4gKiBkZXRlcm1pbmVzIHdoZXRoZXIgYSBnaXZlbiBpbmRleCBjYW4gYmUgdXNlZCB0byBzZXJ2ZSB0aGUgc3BlY2lmaWVkIHRhcmdldC5cbiAqXG4gKiBUaGUgZm9sbG93aW5nIHRhYmxlIHNob3djYXNlcyBzb21lIHBvc3NpYmxlIGluZGV4IGNvbmZpZ3VyYXRpb25zOlxuICpcbiAqIFF1ZXJ5ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8IEluZGV4XG4gKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogd2hlcmUoJ2EnLCAnPT0nLCAnYScpLndoZXJlKCdiJywgJz09JywgJ2InKSAgICAgICAgIHwgYSBBU0MsIGIgREVTQ1xuICogd2hlcmUoJ2EnLCAnPT0nLCAnYScpLndoZXJlKCdiJywgJz09JywgJ2InKSAgICAgICAgIHwgYSBBU0NcbiAqIHdoZXJlKCdhJywgJz09JywgJ2EnKS53aGVyZSgnYicsICc9PScsICdiJykgICAgICAgICB8IGIgREVTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnKSAgICAgICAgICAgICAgICAgIHwgYSBBU0NcbiAqIHdoZXJlKCdhJywgJz49JywgJ2EnKS5vcmRlckJ5KCdhJywgJ2Rlc2MnKSAgICAgICAgICB8IGEgREVTQ1xuICogd2hlcmUoJ2EnLCAnPj0nLCAnYScpLm9yZGVyQnkoJ2EnKS5vcmRlckJ5KCdiJykgICAgIHwgYSBBU0MsIGIgQVNDXG4gKiB3aGVyZSgnYScsICc+PScsICdhJykub3JkZXJCeSgnYScpLm9yZGVyQnkoJ2InKSAgICAgfCBhIEFTQ1xuICogd2hlcmUoJ2EnLCAnYXJyYXktY29udGFpbnMnLCAnYScpLm9yZGVyQnkoJ2InKSAgICAgIHwgYSBDT05UQUlOUywgYiBBU0NFTkRJTkdcbiAqIHdoZXJlKCdhJywgJ2FycmF5LWNvbnRhaW5zJywgJ2EnKS5vcmRlckJ5KCdiJykgICAgICB8IGEgQ09OVEFJTlNcbiAqLyBjbGFzcyBfX1BSSVZBVEVfVGFyZ2V0SW5kZXhNYXRjaGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIC8vIFRoZSBpbmVxdWFsaXR5IGZpbHRlcnMgb2YgdGhlIHRhcmdldCAoaWYgaXQgZXhpc3RzKS5cbiAgICAgICAgLy8gTm90ZTogVGhlIHNvcnQgb24gRmllbGRGaWx0ZXJzIGlzIG5vdCByZXF1aXJlZC4gVXNpbmcgU29ydGVkU2V0IGhlcmUganVzdCB0byB1dGlsaXplIHRoZSBjdXN0b21cbiAgICAgICAgLy8gY29tcGFyYXRvci5cbiAgICAgICAgdGhpcy5ybiA9IG5ldyBTb3J0ZWRTZXQoKChlLCB0KSA9PiBGaWVsZFBhdGgkMS5jb21wYXJhdG9yKGUuZmllbGQsIHQuZmllbGQpKSksIHRoaXMuY29sbGVjdGlvbklkID0gbnVsbCAhPSBlLmNvbGxlY3Rpb25Hcm91cCA/IGUuY29sbGVjdGlvbkdyb3VwIDogZS5wYXRoLmxhc3RTZWdtZW50KCksIFxuICAgICAgICB0aGlzLnNuID0gZS5vcmRlckJ5LCB0aGlzLl9uID0gW107XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiBlLmZpbHRlcnMpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0O1xuICAgICAgICAgICAgZS5pc0luZXF1YWxpdHkoKSA/IHRoaXMucm4gPSB0aGlzLnJuLmFkZChlKSA6IHRoaXMuX24ucHVzaChlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgYW4oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJuLnNpemUgPiAxO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhlIGluZGV4IGNhbiBiZSB1c2VkIHRvIHNlcnZlIHRoZSBUYXJnZXRJbmRleE1hdGNoZXInc1xuICAgICAqIHRhcmdldC5cbiAgICAgKlxuICAgICAqIEFuIGluZGV4IGlzIGNvbnNpZGVyZWQgY2FwYWJsZSBvZiBzZXJ2aW5nIHRoZSB0YXJnZXQgd2hlbjpcbiAgICAgKiAtIFRoZSB0YXJnZXQgdXNlcyBhbGwgaW5kZXggc2VnbWVudHMgZm9yIGl0cyBmaWx0ZXJzIGFuZCBvcmRlckJ5IGNsYXVzZXMuXG4gICAgICogICBUaGUgdGFyZ2V0IGNhbiBoYXZlIGFkZGl0aW9uYWwgZmlsdGVyIGFuZCBvcmRlckJ5IGNsYXVzZXMsIGJ1dCBub3RcbiAgICAgKiAgIGZld2VyLlxuICAgICAqIC0gSWYgYW4gQXJyYXlDb250YWlucy9BcnJheUNvbnRhaW5zQW55ZmlsdGVyIGlzIHVzZWQsIHRoZSBpbmRleCBtdXN0IGFsc29cbiAgICAgKiAgIGhhdmUgYSBjb3JyZXNwb25kaW5nIGBDT05UQUlOU2Agc2VnbWVudC5cbiAgICAgKiAtIEFsbCBkaXJlY3Rpb25hbCBpbmRleCBzZWdtZW50cyBjYW4gYmUgbWFwcGVkIHRvIHRoZSB0YXJnZXQgYXMgYSBzZXJpZXMgb2ZcbiAgICAgKiAgIGVxdWFsaXR5IGZpbHRlcnMsIGEgc2luZ2xlIGluZXF1YWxpdHkgZmlsdGVyIGFuZCBhIHNlcmllcyBvZiBvcmRlckJ5XG4gICAgICogICBjbGF1c2VzLlxuICAgICAqIC0gVGhlIHNlZ21lbnRzIHRoYXQgcmVwcmVzZW50IHRoZSBlcXVhbGl0eSBmaWx0ZXJzIG1heSBhcHBlYXIgb3V0IG9mIG9yZGVyLlxuICAgICAqIC0gVGhlIG9wdGlvbmFsIHNlZ21lbnQgZm9yIHRoZSBpbmVxdWFsaXR5IGZpbHRlciBtdXN0IGFwcGVhciBhZnRlciBhbGxcbiAgICAgKiAgIGVxdWFsaXR5IHNlZ21lbnRzLlxuICAgICAqIC0gVGhlIHNlZ21lbnRzIHRoYXQgcmVwcmVzZW50IHRoYXQgb3JkZXJCeSBjbGF1c2Ugb2YgdGhlIHRhcmdldCBtdXN0IGFwcGVhclxuICAgICAqICAgaW4gb3JkZXIgYWZ0ZXIgYWxsIGVxdWFsaXR5IGFuZCBpbmVxdWFsaXR5IHNlZ21lbnRzLiBTaW5nbGUgb3JkZXJCeVxuICAgICAqICAgY2xhdXNlcyBjYW5ub3QgYmUgc2tpcHBlZCwgYnV0IGEgY29udGludW91cyBvcmRlckJ5IHN1ZmZpeCBtYXkgYmVcbiAgICAgKiAgIG9taXR0ZWQuXG4gICAgICovICAgIHVuKGUpIHtcbiAgICAgICAgaWYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUuY29sbGVjdGlvbkdyb3VwID09PSB0aGlzLmNvbGxlY3Rpb25JZCksIHRoaXMuYW4pIFxuICAgICAgICAvLyBPbmx5IHNpbmdsZSBpbmVxdWFsaXR5IGlzIHN1cHBvcnRlZCBmb3Igbm93LlxuICAgICAgICAvLyBUT0RPKEFkZCBzdXBwb3J0IGZvciBtdWx0aXBsZSBpbmVxdWFsaXR5IHF1ZXJ5KTogYi8yOTg0NDEwNDNcbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBhcnJheSBlbGVtZW50LCBmaW5kIGEgbWF0Y2hpbmcgZmlsdGVyLlxuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZmllbGRJbmRleEdldEFycmF5U2VnbWVudChlKTtcbiAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCAmJiAhdGhpcy5jbih0KSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpO1xuICAgICAgICBsZXQgciA9IG5ldyBTZXQsIGkgPSAwLCBzID0gMDtcbiAgICAgICAgLy8gUHJvY2VzcyBhbGwgZXF1YWxpdGllcyBmaXJzdC4gRXF1YWxpdGllcyBjYW4gYXBwZWFyIG91dCBvZiBvcmRlci5cbiAgICAgICAgZm9yICg7aSA8IG4ubGVuZ3RoICYmIHRoaXMuY24obltpXSk7ICsraSkgciA9IHIuYWRkKG5baV0uZmllbGRQYXRoLmNhbm9uaWNhbFN0cmluZygpKTtcbiAgICAgICAgLy8gSWYgd2UgYWxyZWFkeSBoYXZlIHByb2Nlc3NlZCBhbGwgc2VnbWVudHMsIGFsbCBzZWdtZW50cyBhcmUgdXNlZCB0byBzZXJ2ZVxuICAgICAgICAvLyB0aGUgZXF1YWxpdHkgZmlsdGVycyBhbmQgd2UgZG8gbm90IG5lZWQgdG8gbWFwIGFueSBzZWdtZW50cyB0byB0aGVcbiAgICAgICAgLy8gdGFyZ2V0J3MgaW5lcXVhbGl0eSBhbmQgb3JkZXJCeSBjbGF1c2VzLlxuICAgICAgICAgICAgICAgIGlmIChpID09PSBuLmxlbmd0aCkgcmV0dXJuICEwO1xuICAgICAgICBpZiAodGhpcy5ybi5zaXplID4gMCkge1xuICAgICAgICAgICAgLy8gT25seSBhIHNpbmdsZSBpbmVxdWFsaXR5IGlzIGN1cnJlbnRseSBzdXBwb3J0ZWQuIEdldCB0aGUgb25seSBlbnRyeSBpbiB0aGUgc2V0LlxuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMucm4uZ2V0SXRlcmF0b3IoKS5nZXROZXh0KCk7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBpcyBhbiBpbmVxdWFsaXR5IGZpbHRlciBhbmQgdGhlIGZpZWxkIHdhcyBub3QgaW4gb25lIG9mIHRoZVxuICAgICAgICAgICAgLy8gZXF1YWxpdHkgZmlsdGVycyBhYm92ZSwgdGhlIG5leHQgc2VnbWVudCBtdXN0IG1hdGNoIGJvdGggdGhlIGZpbHRlclxuICAgICAgICAgICAgLy8gYW5kIHRoZSBmaXJzdCBvcmRlckJ5IGNsYXVzZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghci5oYXMoZS5maWVsZC5jYW5vbmljYWxTdHJpbmcoKSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbltpXTtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMubG4oZSwgdCkgfHwgIXRoaXMuaG4odGhpcy5zbltzKytdLCB0KSkgcmV0dXJuICExO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKytpO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFsbCByZW1haW5pbmcgc2VnbWVudHMgbmVlZCB0byByZXByZXNlbnQgdGhlIHByZWZpeCBvZiB0aGUgdGFyZ2V0J3NcbiAgICAgICAgLy8gb3JkZXJCeS5cbiAgICAgICAgICAgICAgICBmb3IgKDtpIDwgbi5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgY29uc3QgZSA9IG5baV07XG4gICAgICAgICAgICBpZiAocyA+PSB0aGlzLnNuLmxlbmd0aCB8fCAhdGhpcy5obih0aGlzLnNuW3MrK10sIGUpKSByZXR1cm4gITE7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgZnVsbCBtYXRjaGVkIGZpZWxkIGluZGV4IGZvciB0aGlzIHRhcmdldC4gQ3VycmVudGx5IG11bHRpcGxlXG4gICAgICogaW5lcXVhbGl0eSBxdWVyeSBpcyBub3Qgc3VwcG9ydGVkIHNvIGZ1bmN0aW9uIHJldHVybnMgbnVsbC5cbiAgICAgKi8gICAgUG4oKSB7XG4gICAgICAgIGlmICh0aGlzLmFuKSByZXR1cm4gbnVsbDtcbiAgICAgICAgLy8gV2Ugd2FudCB0byBtYWtlIHN1cmUgb25seSBvbmUgc2VnbWVudCBjcmVhdGVkIGZvciBvbmUgZmllbGQuIEZvciBleGFtcGxlLFxuICAgICAgICAvLyBpbiBjYXNlIGxpa2UgYSA9PSAzIGFuZCBhID4gMiwgSW5kZXgge2EgQVNDRU5ESU5HfSB3aWxsIG9ubHkgYmUgY3JlYXRlZFxuICAgICAgICAvLyBvbmNlLlxuICAgICAgICAgICAgICAgIGxldCBlID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKTtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IG4gb2YgdGhpcy5fbikge1xuICAgICAgICAgICAgaWYgKG4uZmllbGQuaXNLZXlGaWVsZCgpKSBjb250aW51ZTtcbiAgICAgICAgICAgIGlmIChcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IG4ub3AgfHwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gPT09IG4ub3ApIHQucHVzaChuZXcgSW5kZXhTZWdtZW50KG4uZmllbGQsIDIgLyogSW5kZXhLaW5kLkNPTlRBSU5TICovKSk7IGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChlLmhhcyhuLmZpZWxkKSkgY29udGludWU7XG4gICAgICAgICAgICAgICAgZSA9IGUuYWRkKG4uZmllbGQpLCB0LnB1c2gobmV3IEluZGV4U2VnbWVudChuLmZpZWxkLCAwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBOb3RlOiBXZSBkbyBub3QgZXhwbGljaXRseSBjaGVjayBgdGhpcy5pbmVxdWFsaXR5RmlsdGVyYCBidXQgcmF0aGVyIHJlbHlcbiAgICAgICAgLy8gb24gdGhlIHRhcmdldCBkZWZpbmluZyBhbiBhcHByb3ByaWF0ZSBcIm9yZGVyIGJ5XCIgdG8gZW5zdXJlIHRoYXQgdGhlXG4gICAgICAgIC8vIHJlcXVpcmVkIGluZGV4IHNlZ21lbnQgaXMgYWRkZWQuIFRoZSBxdWVyeSBlbmdpbmUgd291bGQgcmVqZWN0IGEgcXVlcnlcbiAgICAgICAgLy8gd2l0aCBhbiBpbmVxdWFsaXR5IGZpbHRlciB0aGF0IGxhY2tzIHRoZSByZXF1aXJlZCBvcmRlci1ieSBjbGF1c2UuXG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHRoaXMuc24pIFxuICAgICAgICAvLyBTdG9wIGFkZGluZyBtb3JlIHNlZ21lbnRzIGlmIHdlIHNlZSBhIG9yZGVyLWJ5IG9uIGtleS4gVHlwaWNhbGx5IHRoaXNcbiAgICAgICAgLy8gaXMgdGhlIGRlZmF1bHQgaW1wbGljaXQgb3JkZXItYnkgd2hpY2ggaXMgY292ZXJlZCBpbiB0aGUgaW5kZXhfZW50cnlcbiAgICAgICAgLy8gdGFibGUgYXMgYSBzZXBhcmF0ZSBjb2x1bW4uIElmIGl0IGlzIG5vdCB0aGUgZGVmYXVsdCBvcmRlci1ieSwgdGhlXG4gICAgICAgIC8vIGdlbmVyYXRlZCBpbmRleCB3aWxsIGJlIG1pc3Npbmcgc29tZSBzZWdtZW50cyBvcHRpbWl6ZWQgZm9yIG9yZGVyLWJ5cyxcbiAgICAgICAgLy8gd2hpY2ggaXMgcHJvYmFibHkgZmluZS5cbiAgICAgICAgbi5maWVsZC5pc0tleUZpZWxkKCkgfHwgZS5oYXMobi5maWVsZCkgfHwgKGUgPSBlLmFkZChuLmZpZWxkKSwgdC5wdXNoKG5ldyBJbmRleFNlZ21lbnQobi5maWVsZCwgXCJhc2NcIiAvKiBEaXJlY3Rpb24uQVNDRU5ESU5HICovID09PSBuLmRpciA/IDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA6IDEgLyogSW5kZXhLaW5kLkRFU0NFTkRJTkcgKi8pKSk7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRJbmRleChGaWVsZEluZGV4LlVOS05PV05fSUQsIHRoaXMuY29sbGVjdGlvbklkLCB0LCBJbmRleFN0YXRlLmVtcHR5KCkpO1xuICAgIH1cbiAgICBjbihlKSB7XG4gICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLl9uKSBpZiAodGhpcy5sbih0LCBlKSkgcmV0dXJuICEwO1xuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGxuKGUsIHQpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSB8fCAhZS5maWVsZC5pc0VxdWFsKHQuZmllbGRQYXRoKSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCBuID0gXCJhcnJheS1jb250YWluc1wiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TICovID09PSBlLm9wIHx8IFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovID09PSBlLm9wO1xuICAgICAgICByZXR1cm4gMiAvKiBJbmRleEtpbmQuQ09OVEFJTlMgKi8gPT09IHQua2luZCA9PT0gbjtcbiAgICB9XG4gICAgaG4oZSwgdCkge1xuICAgICAgICByZXR1cm4gISFlLmZpZWxkLmlzRXF1YWwodC5maWVsZFBhdGgpICYmICgwIC8qIEluZGV4S2luZC5BU0NFTkRJTkcgKi8gPT09IHQua2luZCAmJiBcImFzY1wiIC8qIERpcmVjdGlvbi5BU0NFTkRJTkcgKi8gPT09IGUuZGlyIHx8IDEgLyogSW5kZXhLaW5kLkRFU0NFTkRJTkcgKi8gPT09IHQua2luZCAmJiBcImRlc2NcIiAvKiBEaXJlY3Rpb24uREVTQ0VORElORyAqLyA9PT0gZS5kaXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUHJvdmlkZXMgdXRpbGl0eSBmdW5jdGlvbnMgdGhhdCBoZWxwIHdpdGggYm9vbGVhbiBsb2dpYyB0cmFuc2Zvcm1hdGlvbnMgbmVlZGVkIGZvciBoYW5kbGluZ1xuICogY29tcGxleCBmaWx0ZXJzIHVzZWQgaW4gcXVlcmllcy5cbiAqL1xuLyoqXG4gKiBUaGUgYGluYCBmaWx0ZXIgaXMgb25seSBhIHN5bnRhY3RpYyBzdWdhciBvdmVyIGEgZGlzanVuY3Rpb24gb2YgZXF1YWxpdGllcy4gRm9yIGluc3RhbmNlOiBgYSBpblxuICogWzEsMiwzXWAgaXMgaW4gZmFjdCBgYT09MSB8fCBhPT0yIHx8IGE9PTNgLiBUaGlzIG1ldGhvZCBleHBhbmRzIGFueSBgaW5gIGZpbHRlciBpbiB0aGUgZ2l2ZW5cbiAqIGlucHV0IGludG8gYSBkaXNqdW5jdGlvbiBvZiBlcXVhbGl0eSBmaWx0ZXJzIGFuZCByZXR1cm5zIHRoZSBleHBhbmRlZCBmaWx0ZXIuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NvbXB1dGVJbkV4cGFuc2lvbihlKSB7XG4gICAgdmFyIHQsIG47XG4gICAgaWYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciB8fCBlIGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyKSB7XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgX19QUklWQVRFX0luRmlsdGVyKSB7XG4gICAgICAgICAgICBjb25zdCByID0gKG51bGwgPT09IChuID0gbnVsbCA9PT0gKHQgPSBlLnZhbHVlLmFycmF5VmFsdWUpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQudmFsdWVzKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLm1hcCgodCA9PiBGaWVsZEZpbHRlci5jcmVhdGUoZS5maWVsZCwgXCI9PVwiIC8qIE9wZXJhdG9yLkVRVUFMICovICwgdCkpKSkgfHwgW107XG4gICAgICAgICAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShyLCBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8pO1xuICAgICAgICB9XG4gICAgICAgIC8vIFdlIGhhdmUgcmVhY2hlZCBvdGhlciBraW5kcyBvZiBmaWVsZCBmaWx0ZXJzLlxuICAgICAgICByZXR1cm4gZTtcbiAgICB9XG4gICAgLy8gV2UgaGF2ZSBhIGNvbXBvc2l0ZSBmaWx0ZXIuXG4gICAgICAgIGNvbnN0IHIgPSBlLmZpbHRlcnMubWFwKChlID0+IF9fUFJJVkFURV9jb21wdXRlSW5FeHBhbnNpb24oZSkpKTtcbiAgICByZXR1cm4gQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZShyLCBlLm9wKTtcbn1cblxuLyoqXG4gKiBHaXZlbiBhIGNvbXBvc2l0ZSBmaWx0ZXIsIHJldHVybnMgdGhlIGxpc3Qgb2YgdGVybXMgaW4gaXRzIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtLlxuICpcbiAqIDxwPkVhY2ggZWxlbWVudCBpbiB0aGUgcmV0dXJuIHZhbHVlIGlzIG9uZSB0ZXJtIG9mIHRoZSByZXN1bHRpbmcgRE5GLiBGb3IgaW5zdGFuY2U6IEZvciB0aGVcbiAqIGlucHV0OiAoQSB8fCBCKSAmJiBDLCB0aGUgRE5GIGZvcm0gaXM6IChBICYmIEMpIHx8IChCICYmIEMpLCBhbmQgdGhlIHJldHVybiB2YWx1ZSBpcyBhIGxpc3RcbiAqIHdpdGggdHdvIGVsZW1lbnRzOiBhIGNvbXBvc2l0ZSBmaWx0ZXIgdGhhdCBwZXJmb3JtcyAoQSAmJiBDKSwgYW5kIGEgY29tcG9zaXRlIGZpbHRlciB0aGF0XG4gKiBwZXJmb3JtcyAoQiAmJiBDKS5cbiAqXG4gKiBAcGFyYW0gZmlsdGVyIHRoZSBjb21wb3NpdGUgZmlsdGVyIHRvIGNhbGN1bGF0ZSBETkYgdHJhbnNmb3JtIGZvci5cbiAqIEByZXR1cm4gdGhlIHRlcm1zIGluIHRoZSBETkYgdHJhbnNmb3JtLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXREbmZUZXJtcyhlKSB7XG4gICAgaWYgKDAgPT09IGUuZ2V0RmlsdGVycygpLmxlbmd0aCkgcmV0dXJuIFtdO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY29tcHV0ZURpc3RyaWJ1dGVkTm9ybWFsRm9ybShfX1BSSVZBVEVfY29tcHV0ZUluRXhwYW5zaW9uKGUpKTtcbiAgICByZXR1cm4gX19QUklWQVRFX2hhcmRBc3NlcnQoX19QUklWQVRFX2lzRGlzanVuY3RpdmVOb3JtYWxGb3JtKHQpKSwgX19QUklWQVRFX2lzU2luZ2xlRmllbGRGaWx0ZXIodCkgfHwgX19QUklWQVRFX2lzRmxhdENvbmp1bmN0aW9uKHQpID8gWyB0IF0gOiB0LmdldEZpbHRlcnMoKTtcbn1cblxuLyoqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIGEgc2luZ2xlIGZpZWxkIGZpbHRlci4gZS5nLiAoYSA9PSAxMCkuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc1NpbmdsZUZpZWxkRmlsdGVyKGUpIHtcbiAgICByZXR1cm4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gZmlsdGVyIGlzIHRoZSBjb25qdW5jdGlvbiBvZiBvbmUgb3IgbW9yZSBmaWVsZCBmaWx0ZXJzLiBlLmcuIChhID09IDEwXG4gKiAmJiBiID09IDIwKVxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9pc0ZsYXRDb25qdW5jdGlvbihlKSB7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgJiYgX19QUklWQVRFX2NvbXBvc2l0ZUZpbHRlcklzRmxhdENvbmp1bmN0aW9uKGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciBvciBub3QgdGhlIGdpdmVuIGZpbHRlciBpcyBpbiBkaXNqdW5jdGl2ZSBub3JtYWwgZm9ybSAoRE5GKS5cbiAqXG4gKiA8cD5JbiBib29sZWFuIGxvZ2ljLCBhIGRpc2p1bmN0aXZlIG5vcm1hbCBmb3JtIChETkYpIGlzIGEgY2Fub25pY2FsIG5vcm1hbCBmb3JtIG9mIGEgbG9naWNhbFxuICogZm9ybXVsYSBjb25zaXN0aW5nIG9mIGEgZGlzanVuY3Rpb24gb2YgY29uanVuY3Rpb25zOyBpdCBjYW4gYWxzbyBiZSBkZXNjcmliZWQgYXMgYW4gT1Igb2YgQU5Ecy5cbiAqXG4gKiA8cD5Gb3IgbW9yZSBpbmZvLCB2aXNpdDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRGlzanVuY3RpdmVfbm9ybWFsX2Zvcm1cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaXNEaXNqdW5jdGl2ZU5vcm1hbEZvcm0oZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfaXNTaW5nbGVGaWVsZEZpbHRlcihlKSB8fCBfX1BSSVZBVEVfaXNGbGF0Q29uanVuY3Rpb24oZSkgfHwgXG4gICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIGZpbHRlciBpcyB0aGUgZGlzanVuY3Rpb24gb2Ygb25lIG9yIG1vcmUgXCJmbGF0IGNvbmp1bmN0aW9uc1wiIGFuZFxuICogZmllbGQgZmlsdGVycy4gZS5nLiAoYSA9PSAxMCkgfHwgKGI9PTIwICYmIGM9PTMwKVxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2lzRGlzanVuY3Rpb25PZkZpZWxkRmlsdGVyc0FuZEZsYXRDb25qdW5jdGlvbnMoZSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNEaXNqdW5jdGlvbihlKSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGUuZ2V0RmlsdGVycygpKSBpZiAoIV9fUFJJVkFURV9pc1NpbmdsZUZpZWxkRmlsdGVyKHQpICYmICFfX1BSSVZBVEVfaXNGbGF0Q29uanVuY3Rpb24odCkpIHJldHVybiAhMTtcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITE7XG4gICAgfShlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NvbXB1dGVEaXN0cmlidXRlZE5vcm1hbEZvcm0oZSkge1xuICAgIGlmIChfX1BSSVZBVEVfaGFyZEFzc2VydChlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgfHwgZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIGUgaW5zdGFuY2VvZiBGaWVsZEZpbHRlcikgcmV0dXJuIGU7XG4gICAgaWYgKDEgPT09IGUuZmlsdGVycy5sZW5ndGgpIHJldHVybiBfX1BSSVZBVEVfY29tcHV0ZURpc3RyaWJ1dGVkTm9ybWFsRm9ybShlLmZpbHRlcnNbMF0pO1xuICAgIC8vIENvbXB1dGUgRE5GIGZvciBlYWNoIG9mIHRoZSBzdWJmaWx0ZXJzIGZpcnN0XG4gICAgICAgIGNvbnN0IHQgPSBlLmZpbHRlcnMubWFwKChlID0+IF9fUFJJVkFURV9jb21wdXRlRGlzdHJpYnV0ZWROb3JtYWxGb3JtKGUpKSk7XG4gICAgbGV0IG4gPSBDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKHQsIGUub3ApO1xuICAgIHJldHVybiBuID0gX19QUklWQVRFX2FwcGx5QXNzb2NpYXRpb24obiksIF9fUFJJVkFURV9pc0Rpc2p1bmN0aXZlTm9ybWFsRm9ybShuKSA/IG4gOiAoX19QUklWQVRFX2hhcmRBc3NlcnQobiBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Nvbmp1bmN0aW9uKG4pKSwgX19QUklWQVRFX2hhcmRBc3NlcnQobi5maWx0ZXJzLmxlbmd0aCA+IDEpLCBcbiAgICBuLmZpbHRlcnMucmVkdWNlKCgoZSwgdCkgPT4gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uKGUsIHQpKSkpO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgdCkge1xuICAgIGxldCBuO1xuICAgIHJldHVybiBfX1BSSVZBVEVfaGFyZEFzc2VydChlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIgfHwgZSBpbnN0YW5jZW9mIENvbXBvc2l0ZUZpbHRlciksIFxuICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KHQgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciB8fCB0IGluc3RhbmNlb2YgQ29tcG9zaXRlRmlsdGVyKSwgXG4gICAgLy8gRmllbGRGaWx0ZXIgRmllbGRGaWx0ZXJcbiAgICBuID0gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRGaWx0ZXJzKGUsIHQpIHtcbiAgICAgICAgLy8gQ29uanVuY3Rpb24gZGlzdHJpYnV0aW9uIGZvciB0d28gZmllbGQgZmlsdGVycyBpcyB0aGUgY29uanVuY3Rpb24gb2YgdGhlbS5cbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUoWyBlLCB0IF0sIFwiYW5kXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuQU5EICovKTtcbiAgICB9KGUsIHQpIDogX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRBbmRDb21wb3NpdGVGaWx0ZXJzKGUsIHQpIDogdCBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyID8gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRBbmRDb21wb3NpdGVGaWx0ZXJzKHQsIGUpIDogZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uQ29tcG9zaXRlRmlsdGVycyhlLCB0KSB7XG4gICAgICAgIC8vIFRoZXJlIGFyZSBmb3VyIGNhc2VzOlxuICAgICAgICAvLyAoQSAmIEIpICYgKEMgJiBEKSAtLT4gKEEgJiBCICYgQyAmIEQpXG4gICAgICAgIC8vIChBICYgQikgJiAoQyB8IEQpIC0tPiAoQSAmIEIgJiBDKSB8IChBICYgQiAmIEQpXG4gICAgICAgIC8vIChBIHwgQikgJiAoQyAmIEQpIC0tPiAoQyAmIEQgJiBBKSB8IChDICYgRCAmIEIpXG4gICAgICAgIC8vIChBIHwgQikgJiAoQyB8IEQpIC0tPiAoQSAmIEMpIHwgKEEgJiBEKSB8IChCICYgQykgfCAoQiAmIEQpXG4gICAgICAgIC8vIENhc2UgMSBpcyBhIG1lcmdlLlxuICAgICAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoZS5maWx0ZXJzLmxlbmd0aCA+IDAgJiYgdC5maWx0ZXJzLmxlbmd0aCA+IDApLCBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbihlKSAmJiBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbih0KSkgcmV0dXJuIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJXaXRoQWRkZWRGaWx0ZXJzKGUsIHQuZ2V0RmlsdGVycygpKTtcbiAgICAgICAgLy8gQ2FzZSAyLDMsNCBhbGwgaGF2ZSBhdCBsZWFzdCBvbmUgc2lkZSAobGhzIG9yIHJocykgdGhhdCBpcyBhIGRpc2p1bmN0aW9uLiBJbiBhbGwgdGhyZWUgY2FzZXNcbiAgICAgICAgLy8gd2Ugc2hvdWxkIHRha2UgZWFjaCBlbGVtZW50IG9mIHRoZSBkaXNqdW5jdGlvbiBhbmQgZGlzdHJpYnV0ZSBpdCBvdmVyIHRoZSBvdGhlciBzaWRlLCBhbmRcbiAgICAgICAgLy8gcmV0dXJuIHRoZSBkaXNqdW5jdGlvbiBvZiB0aGUgZGlzdHJpYnV0aW9uIHJlc3VsdHMuXG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJJc0Rpc2p1bmN0aW9uKGUpID8gZSA6IHQsIHIgPSBfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNEaXNqdW5jdGlvbihlKSA/IHQgOiBlLCBpID0gbi5maWx0ZXJzLm1hcCgoZSA9PiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgcikpKTtcbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUoaSwgXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovKTtcbiAgICB9KGUsIHQpLCBfX1BSSVZBVEVfYXBwbHlBc3NvY2lhdGlvbihuKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RGlzdHJpYnV0aW9uRmllbGRBbmRDb21wb3NpdGVGaWx0ZXJzKGUsIHQpIHtcbiAgICAvLyBUaGVyZSBhcmUgdHdvIGNhc2VzOlxuICAgIC8vIEEgJiAoQiAmIEMpIC0tPiAoQSAmIEIgJiBDKVxuICAgIC8vIEEgJiAoQiB8IEMpIC0tPiAoQSAmIEIpIHwgKEEgJiBDKVxuICAgIGlmIChfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNDb25qdW5jdGlvbih0KSkgXG4gICAgLy8gQ2FzZSAxXG4gICAgcmV0dXJuIF9fUFJJVkFURV9jb21wb3NpdGVGaWx0ZXJXaXRoQWRkZWRGaWx0ZXJzKHQsIGUuZ2V0RmlsdGVycygpKTtcbiAgICB7XG4gICAgICAgIC8vIENhc2UgMlxuICAgICAgICBjb25zdCBuID0gdC5maWx0ZXJzLm1hcCgodCA9PiBfX1BSSVZBVEVfYXBwbHlEaXN0cmlidXRpb24oZSwgdCkpKTtcbiAgICAgICAgcmV0dXJuIENvbXBvc2l0ZUZpbHRlci5jcmVhdGUobiwgXCJvclwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLk9SICovKTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyB0aGUgYXNzb2NpYXRpdml0eSBwcm9wZXJ0eSB0byB0aGUgZ2l2ZW4gZmlsdGVyIGFuZCByZXR1cm5zIHRoZSByZXN1bHRpbmcgZmlsdGVyLlxuICpcbiAqIDx1bD5cbiAqICAgPGxpPkEgfCAoQiB8IEMpID09IChBIHwgQikgfCBDID09IChBIHwgQiB8IEMpXG4gKiAgIDxsaT5BICYgKEIgJiBDKSA9PSAoQSAmIEIpICYgQyA9PSAoQSAmIEIgJiBDKVxuICogPC91bD5cbiAqXG4gKiA8cD5Gb3IgbW9yZSBpbmZvLCB2aXNpdDogaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQXNzb2NpYXRpdmVfcHJvcGVydHkjUHJvcG9zaXRpb25hbF9sb2dpY1xuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseUFzc29jaWF0aW9uKGUpIHtcbiAgICBpZiAoX19QUklWQVRFX2hhcmRBc3NlcnQoZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyIHx8IGUgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIpLCBcbiAgICBlIGluc3RhbmNlb2YgRmllbGRGaWx0ZXIpIHJldHVybiBlO1xuICAgIGNvbnN0IHQgPSBlLmdldEZpbHRlcnMoKTtcbiAgICAvLyBJZiB0aGUgY29tcG9zaXRlIGZpbHRlciBvbmx5IGNvbnRhaW5zIDEgZmlsdGVyLCBhcHBseSBhc3NvY2lhdGl2aXR5IHRvIGl0LlxuICAgICAgICBpZiAoMSA9PT0gdC5sZW5ndGgpIHJldHVybiBfX1BSSVZBVEVfYXBwbHlBc3NvY2lhdGlvbih0WzBdKTtcbiAgICAvLyBBc3NvY2lhdGl2aXR5IGFwcGxpZWQgdG8gYSBmbGF0IGNvbXBvc2l0ZSBmaWx0ZXIgcmVzdWx0cyBpcyBpdHNlbGYuXG4gICAgICAgIGlmIChfX1BSSVZBVEVfY29tcG9zaXRlRmlsdGVySXNGbGF0KGUpKSByZXR1cm4gZTtcbiAgICAvLyBGaXJzdCBhcHBseSBhc3NvY2lhdGl2aXR5IHRvIGFsbCBzdWJmaWx0ZXJzLiBUaGlzIHdpbGwgaW4gdHVybiByZWN1cnNpdmVseSBhcHBseVxuICAgIC8vIGFzc29jaWF0aXZpdHkgdG8gYWxsIG5lc3RlZCBjb21wb3NpdGUgZmlsdGVycyBhbmQgZmllbGQgZmlsdGVycy5cbiAgICAgICAgY29uc3QgbiA9IHQubWFwKChlID0+IF9fUFJJVkFURV9hcHBseUFzc29jaWF0aW9uKGUpKSksIHIgPSBbXTtcbiAgICAvLyBGb3IgY29tcG9zaXRlIHN1YmZpbHRlcnMgdGhhdCBwZXJmb3JtIHRoZSBzYW1lIGtpbmQgb2YgbG9naWNhbCBvcGVyYXRpb24gYXMgYGNvbXBvc2l0ZUZpbHRlcmBcbiAgICAvLyB0YWtlIG91dCB0aGVpciBmaWx0ZXJzIGFuZCBhZGQgdGhlbSB0byBgY29tcG9zaXRlRmlsdGVyYC4gRm9yIGV4YW1wbGU6XG4gICAgLy8gY29tcG9zaXRlRmlsdGVyID0gKEEgfCAoQiB8IEMgfCBEKSlcbiAgICAvLyBjb21wb3NpdGVTdWJmaWx0ZXIgPSAoQiB8IEMgfCBEKVxuICAgIC8vIFJlc3VsdDogKEEgfCBCIHwgQyB8IEQpXG4gICAgLy8gTm90ZSB0aGF0IHRoZSBgY29tcG9zaXRlU3ViZmlsdGVyYCBoYXMgYmVlbiBlbGltaW5hdGVkLCBhbmQgaXRzIGZpbHRlcnMgKEIsIEMsIEQpIGhhdmUgYmVlblxuICAgIC8vIGFkZGVkIHRvIHRoZSB0b3AtbGV2ZWwgXCJjb21wb3NpdGVGaWx0ZXJcIi5cbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgodCA9PiB7XG4gICAgICAgIHQgaW5zdGFuY2VvZiBGaWVsZEZpbHRlciA/IHIucHVzaCh0KSA6IHQgaW5zdGFuY2VvZiBDb21wb3NpdGVGaWx0ZXIgJiYgKHQub3AgPT09IGUub3AgPyBcbiAgICAgICAgLy8gY29tcG9zaXRlRmlsdGVyOiAoQSB8IChCIHwgQykpXG4gICAgICAgIC8vIGNvbXBvc2l0ZVN1YmZpbHRlcjogKEIgfCBDKVxuICAgICAgICAvLyBSZXN1bHQ6IChBIHwgQiB8IEMpXG4gICAgICAgIHIucHVzaCguLi50LmZpbHRlcnMpIDogXG4gICAgICAgIC8vIGNvbXBvc2l0ZUZpbHRlcjogKEEgfCAoQiAmIEMpKVxuICAgICAgICAvLyBjb21wb3NpdGVTdWJmaWx0ZXI6IChCICYgQylcbiAgICAgICAgLy8gUmVzdWx0OiAoQSB8IChCICYgQykpXG4gICAgICAgIHIucHVzaCh0KSk7XG4gICAgfSkpLCAxID09PSByLmxlbmd0aCA/IHJbMF0gOiBDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKHIsIGUub3ApO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbi1tZW1vcnkgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlJbmRleE1hbmFnZXIge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlRuID0gbmV3IF9fUFJJVkFURV9NZW1vcnlDb2xsZWN0aW9uUGFyZW50SW5kZXg7XG4gICAgfVxuICAgIGFkZFRvQ29sbGVjdGlvblBhcmVudEluZGV4KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVG4uYWRkKHQpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRDb2xsZWN0aW9uUGFyZW50cyhlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLlRuLmdldEVudHJpZXModCkpO1xuICAgIH1cbiAgICBhZGRGaWVsZEluZGV4KGUsIHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGRlbGV0ZUZpZWxkSW5kZXgoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZGVsZXRlQWxsRmllbGRJbmRleGVzKGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGNyZWF0ZVRhcmdldEluZGV4ZXMoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQoZSwgdCkge1xuICAgICAgICAvLyBGaWVsZCBpbmRpY2VzIGFyZSBub3Qgc3VwcG9ydGVkIHdpdGggbWVtb3J5IHBlcnNpc3RlbmNlLlxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgfVxuICAgIGdldEluZGV4VHlwZShlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgwIC8qIEluZGV4VHlwZS5OT05FICovKTtcbiAgICB9XG4gICAgZ2V0RmllbGRJbmRleGVzKGUsIHQpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKFtdKTtcbiAgICB9XG4gICAgZ2V0TmV4dENvbGxlY3Rpb25Hcm91cFRvVXBkYXRlKGUpIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoSW5kZXhPZmZzZXQubWluKCkpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXRGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKEluZGV4T2Zmc2V0Lm1pbigpKTtcbiAgICB9XG4gICAgdXBkYXRlQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gRmllbGQgaW5kaWNlcyBhcmUgbm90IHN1cHBvcnRlZCB3aXRoIG1lbW9yeSBwZXJzaXN0ZW5jZS5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHVwZGF0ZUluZGV4RW50cmllcyhlLCB0KSB7XG4gICAgICAgIC8vIEZpZWxkIGluZGljZXMgYXJlIG5vdCBzdXBwb3J0ZWQgd2l0aCBtZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbnRlcm5hbCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgY29sbGVjdGlvbi1wYXJlbnQgaW5kZXggZXhwb3NlZCBieSBNZW1vcnlJbmRleE1hbmFnZXIuXG4gKiBBbHNvIHVzZWQgZm9yIGluLW1lbW9yeSBjYWNoaW5nIGJ5IEluZGV4ZWREYkluZGV4TWFuYWdlciBhbmQgaW5pdGlhbCBpbmRleCBwb3B1bGF0aW9uXG4gKiBpbiBpbmRleGVkZGJfc2NoZW1hLnRzXG4gKi8gY2xhc3MgX19QUklWQVRFX01lbW9yeUNvbGxlY3Rpb25QYXJlbnRJbmRleCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuaW5kZXggPSB7fTtcbiAgICB9XG4gICAgLy8gUmV0dXJucyBmYWxzZSBpZiB0aGUgZW50cnkgYWxyZWFkeSBleGlzdGVkLlxuICAgIGFkZChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmxhc3RTZWdtZW50KCksIG4gPSBlLnBvcExhc3QoKSwgciA9IHRoaXMuaW5kZXhbdF0gfHwgbmV3IFNvcnRlZFNldChSZXNvdXJjZVBhdGguY29tcGFyYXRvciksIGkgPSAhci5oYXMobik7XG4gICAgICAgIHJldHVybiB0aGlzLmluZGV4W3RdID0gci5hZGQobiksIGk7XG4gICAgfVxuICAgIGhhcyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLmxhc3RTZWdtZW50KCksIG4gPSBlLnBvcExhc3QoKSwgciA9IHRoaXMuaW5kZXhbdF07XG4gICAgICAgIHJldHVybiByICYmIHIuaGFzKG4pO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKGUpIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmluZGV4W2VdIHx8IG5ldyBTb3J0ZWRTZXQoUmVzb3VyY2VQYXRoLmNvbXBhcmF0b3IpKS50b0FycmF5KCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBwdCA9IFwiSW5kZXhlZERiSW5kZXhNYW5hZ2VyXCIsIHl0ID0gbmV3IFVpbnQ4QXJyYXkoMCk7XG5cbi8qKlxuICogQSBwZXJzaXN0ZWQgaW1wbGVtZW50YXRpb24gb2YgSW5kZXhNYW5hZ2VyLlxuICpcbiAqIFBPUlRJTkcgTk9URTogVW5saWtlIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdlYiBTREsgZG9lcyBub3QgbWVtb2l6ZSBpbmRleFxuICogZGF0YSBhcyBpdCBzdXBwb3J0cyBtdWx0aS10YWIgYWNjZXNzLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiSW5kZXhNYW5hZ2VyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQW4gaW4tbWVtb3J5IGNvcHkgb2YgdGhlIGluZGV4IGVudHJpZXMgd2UndmUgYWxyZWFkeSB3cml0dGVuIHNpbmNlIHRoZSBTREtcbiAgICAgICAgICogbGF1bmNoZWQuIFVzZWQgdG8gYXZvaWQgcmUtd3JpdGluZyB0aGUgc2FtZSBlbnRyeSByZXBlYXRlZGx5LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGlzIGlzICpOT1QqIGEgY29tcGxldGUgY2FjaGUgb2Ygd2hhdCdzIGluIHBlcnNpc3RlbmNlIGFuZCBzbyBjYW4gbmV2ZXIgYmVcbiAgICAgICAgICogdXNlZCB0byBzYXRpc2Z5IHJlYWRzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5JbiA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5Q29sbGVjdGlvblBhcmVudEluZGV4LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHMgZnJvbSBhIHRhcmdldCB0byBpdHMgZXF1aXZhbGVudCBsaXN0IG9mIHN1Yi10YXJnZXRzLiBFYWNoIHN1Yi10YXJnZXRcbiAgICAgICAgICogY29udGFpbnMgb25seSBvbmUgdGVybSBmcm9tIHRoZSB0YXJnZXQncyBkaXNqdW5jdGl2ZSBub3JtYWwgZm9ybSAoRE5GKS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuRW4gPSBuZXcgT2JqZWN0TWFwKChlID0+IF9fUFJJVkFURV9jYW5vbmlmeVRhcmdldChlKSksICgoZSwgdCkgPT4gX19QUklWQVRFX3RhcmdldEVxdWFscyhlLCB0KSkpLCBcbiAgICAgICAgdGhpcy51aWQgPSBlLnVpZCB8fCBcIlwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIGEgbmV3IGVudHJ5IHRvIHRoZSBjb2xsZWN0aW9uIHBhcmVudCBpbmRleC5cbiAgICAgKlxuICAgICAqIFJlcGVhdGVkIGNhbGxzIGZvciB0aGUgc2FtZSBjb2xsZWN0aW9uUGF0aCBzaG91bGQgYmUgYXZvaWRlZCB3aXRoaW4gYVxuICAgICAqIHRyYW5zYWN0aW9uIGFzIEluZGV4ZWREYkluZGV4TWFuYWdlciBvbmx5IGNhY2hlcyB3cml0ZXMgb25jZSBhIHRyYW5zYWN0aW9uXG4gICAgICogaGFzIGJlZW4gY29tbWl0dGVkLlxuICAgICAqLyAgICBhZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCB0KSB7XG4gICAgICAgIGlmICghdGhpcy5Jbi5oYXModCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0Lmxhc3RTZWdtZW50KCksIHIgPSB0LnBvcExhc3QoKTtcbiAgICAgICAgICAgIGUuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEFkZCB0aGUgY29sbGVjdGlvbiB0byB0aGUgaW4gbWVtb3J5IGNhY2hlIG9ubHkgaWYgdGhlIHRyYW5zYWN0aW9uIHdhc1xuICAgICAgICAgICAgICAgIC8vIHN1Y2Nlc3NmdWxseSBjb21taXR0ZWQuXG4gICAgICAgICAgICAgICAgdGhpcy5Jbi5hZGQodCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBjb25zdCBpID0ge1xuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25JZDogbixcbiAgICAgICAgICAgICAgICBwYXJlbnQ6IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgocilcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2NvbGxlY3Rpb25QYXJlbnRzU3RvcmUoZSkucHV0KGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRDb2xsZWN0aW9uUGFyZW50cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdCwgXCJcIiBdLCBbIF9fUFJJVkFURV9pbW1lZGlhdGVTdWNjZXNzb3IodCksIFwiXCIgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NvbGxlY3Rpb25QYXJlbnRzU3RvcmUoZSkuRyhyKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBlKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBjb2xsZWN0aW9uSWQgZ3VhcmQgc2hvdWxkbid0IGJlIG5lY2Vzc2FyeSAoYW5kIGlzbid0IGFzIGxvbmdcbiAgICAgICAgICAgICAgICAvLyBhcyB3ZSdyZSBydW5uaW5nIGluIGEgcmVhbCBicm93c2VyKSwgYnV0IHRoZXJlJ3MgYSBidWcgaW5cbiAgICAgICAgICAgICAgICAvLyBpbmRleGVkZGJzaGltIHRoYXQgYnJlYWtzIG91ciByYW5nZSBpbiBvdXIgdGVzdHMgcnVubmluZyBpbiBub2RlOlxuICAgICAgICAgICAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9heGVtY2xpb24vSW5kZXhlZERCU2hpbS9pc3N1ZXMvMzM0XG4gICAgICAgICAgICAgICAgaWYgKHIuY29sbGVjdGlvbklkICE9PSB0KSBicmVhaztcbiAgICAgICAgICAgICAgICBuLnB1c2goX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChyLnBhcmVudCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgYWRkRmllbGRJbmRleChlLCB0KSB7XG4gICAgICAgIC8vIFRPRE8oaW5kZXhpbmcpOiBWZXJpZnkgdGhhdCB0aGUgYXV0by1pbmNyZW1lbnRpbmcgaW5kZXggSUQgd29ya3MgaW5cbiAgICAgICAgLy8gU2FmYXJpICYgRmlyZWZveC5cbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9pbmRleENvbmZpZ3VyYXRpb25TdG9yZShlKSwgciA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b0RiSW5kZXhDb25maWd1cmF0aW9uKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaW5kZXhJZDogZS5pbmRleElkLFxuICAgICAgICAgICAgICAgIGNvbGxlY3Rpb25Hcm91cDogZS5jb2xsZWN0aW9uR3JvdXAsXG4gICAgICAgICAgICAgICAgZmllbGRzOiBlLmZpZWxkcy5tYXAoKGUgPT4gWyBlLmZpZWxkUGF0aC5jYW5vbmljYWxTdHJpbmcoKSwgZS5raW5kIF0pKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfSh0KTtcbiAgICAgICAgZGVsZXRlIHIuaW5kZXhJZDtcbiAgICAgICAgLy8gYGluZGV4SWRgIGlzIGF1dG8tcG9wdWxhdGVkIGJ5IEluZGV4ZWREYlxuICAgICAgICBjb25zdCBpID0gbi5hZGQocik7XG4gICAgICAgIGlmICh0LmluZGV4U3RhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgbi5wdXQoX19QUklWQVRFX3RvRGJJbmRleFN0YXRlKGUsIHRoaXMudWlkLCB0LmluZGV4U3RhdGUuc2VxdWVuY2VOdW1iZXIsIHQuaW5kZXhTdGF0ZS5vZmZzZXQpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaS5uZXh0KCk7XG4gICAgfVxuICAgIGRlbGV0ZUZpZWxkSW5kZXgoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpLCByID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKSwgaSA9IF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIG4uZGVsZXRlKHQuaW5kZXhJZCkubmV4dCgoKCkgPT4gci5kZWxldGUoSURCS2V5UmFuZ2UuYm91bmQoWyB0LmluZGV4SWQgXSwgWyB0LmluZGV4SWQgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKSkpKS5uZXh0KCgoKSA9PiBpLmRlbGV0ZShJREJLZXlSYW5nZS5ib3VuZChbIHQuaW5kZXhJZCBdLCBbIHQuaW5kZXhJZCArIDEgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApKSkpO1xuICAgIH1cbiAgICBkZWxldGVBbGxGaWVsZEluZGV4ZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpLCBuID0gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpLCByID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIHQuSigpLm5leHQoKCgpID0+IG4uSigpKSkubmV4dCgoKCkgPT4gci5KKCkpKTtcbiAgICB9XG4gICAgY3JlYXRlVGFyZ2V0SW5kZXhlcyhlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0aGlzLmRuKHQpLCAodCA9PiB0aGlzLmdldEluZGV4VHlwZShlLCB0KS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgIGlmICgwIC8qIEluZGV4VHlwZS5OT05FICovID09PSBuIHx8IDEgLyogSW5kZXhUeXBlLlBBUlRJQUwgKi8gPT09IG4pIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9UYXJnZXRJbmRleE1hdGNoZXIodCkuUG4oKTtcbiAgICAgICAgICAgICAgICBpZiAobnVsbCAhPSBuKSByZXR1cm4gdGhpcy5hZGRGaWVsZEluZGV4KGUsIG4pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdUYXJnZXQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpO1xuICAgICAgICBsZXQgciA9ICEwO1xuICAgICAgICBjb25zdCBpID0gbmV3IE1hcDtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMuZG4odCksICh0ID0+IHRoaXMuQW4oZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICByICYmIChyID0gISFlKSwgaS5zZXQodCwgZSk7XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChyKSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKGksICgoaSwgcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcocHQsIGBVc2luZyBpbmRleCAke2Z1bmN0aW9uIF9fUFJJVkFURV9maWVsZEluZGV4VG9TdHJpbmcoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGBpZD0ke2UuaW5kZXhJZH18Y2c9JHtlLmNvbGxlY3Rpb25Hcm91cH18Zj0ke2UuZmllbGRzLm1hcCgoZSA9PiBgJHtlLmZpZWxkUGF0aH06JHtlLmtpbmR9YCkpLmpvaW4oXCIsXCIpfWA7XG4gICAgICAgICAgICAgICAgICAgIH0oaSl9IHRvIGV4ZWN1dGUgJHtfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQodCl9YCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0R2V0QXJyYXlWYWx1ZXMoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9maWVsZEluZGV4R2V0QXJyYXlTZWdtZW50KHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCA9PT0gbikgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgX19QUklWQVRFX3RhcmdldEdldEZpZWxkRmlsdGVyc0ZvclBhdGgoZSwgbi5maWVsZFBhdGgpKSBzd2l0Y2ggKHQub3ApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHQudmFsdWUuYXJyYXlWYWx1ZS52YWx1ZXMgfHwgW107XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBbIHQudmFsdWUgXTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1haW5pbmcgZmlsdGVycyBhcmUgbm90IGFycmF5IGZpbHRlcnMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAvKipcbiAqIFJldHVybnMgdGhlIGxpc3Qgb2YgdmFsdWVzIHRoYXQgYXJlIHVzZWQgaW4gIT0gb3IgTk9UX0lOIGZpbHRlcnMuIFJldHVybnNcbiAqIGBudWxsYCBpZiB0aGVyZSBhcmUgbm8gc3VjaCBmaWx0ZXJzLlxuICovIChzLCBpKSwgXyA9IGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXROb3RJblZhbHVlcyhlLCB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gbmV3IE1hcDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHModCkpIGZvciAoY29uc3QgdCBvZiBfX1BSSVZBVEVfdGFyZ2V0R2V0RmllbGRGaWx0ZXJzRm9yUGF0aChlLCByLmZpZWxkUGF0aCkpIHN3aXRjaCAodC5vcCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwiPT1cIiAvKiBPcGVyYXRvci5FUVVBTCAqLyA6XG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJpblwiIC8qIE9wZXJhdG9yLklOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBFbmNvZGUgZXF1YWxpdHkgcHJlZml4LCB3aGljaCBpcyBlbmNvZGVkIGluIHRoZSBpbmRleCB2YWx1ZSBiZWZvcmVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyB0aGUgaW5lcXVhbGl0eSAoZS5nLiBgYSA9PSAnYScgJiYgYiAhPSAnYidgIGlzIGVuY29kZWQgdG9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBgdmFsdWUgIT0gJ2FiJ2ApLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG4uc2V0KHIuZmllbGRQYXRoLmNhbm9uaWNhbFN0cmluZygpLCB0LnZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcblxuICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcIiE9XCIgLyogT3BlcmF0b3IuTk9UX0VRVUFMICovIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RJbi9Ob3RFcXVhbCBpcyBhbHdheXMgYSBzdWZmaXguIFRoZXJlIGNhbm5vdCBiZSBhbnkgcmVtYWluaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VnbWVudHMgYW5kIGhlbmNlIHdlIGNhbiByZXR1cm4gZWFybHkgaGVyZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5zZXQoci5maWVsZFBhdGguY2Fub25pY2FsU3RyaW5nKCksIHQudmFsdWUpLCBBcnJheS5mcm9tKG4udmFsdWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlbWFpbmluZyBmaWx0ZXJzIGNhbm5vdCBiZSB1c2VkIGFzIG5vdEluIGJvdW5kcy5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhIGxvd2VyIGJvdW5kIG9mIGZpZWxkIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIGFzIGEgc3RhcnRpbmcgcG9pbnQgdG9cbiAqIHNjYW4gdGhlIGluZGV4IGRlZmluZWQgYnkgYGZpZWxkSW5kZXhgLiBSZXR1cm5zIGBNSU5fVkFMVUVgIGlmIG5vIGxvd2VyIGJvdW5kXG4gKiBleGlzdHMuXG4gKi8gKHMsIGkpLCBhID0gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldExvd2VyQm91bmQoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIHNlZ21lbnQsIHJldHJpZXZlIGEgbG93ZXIgYm91bmQgaWYgdGhlcmUgaXMgYSBzdWl0YWJsZSBmaWx0ZXIgb3JcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHN0YXJ0QXQuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGkgb2YgX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLyA9PT0gaS5raW5kID8gX19QUklWQVRFX3RhcmdldEdldEFzY2VuZGluZ0JvdW5kKGUsIGkuZmllbGRQYXRoLCBlLnN0YXJ0QXQpIDogX19QUklWQVRFX3RhcmdldEdldERlc2NlbmRpbmdCb3VuZChlLCBpLmZpZWxkUGF0aCwgZS5zdGFydEF0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLnB1c2godC52YWx1ZSksIHIgJiYgKHIgPSB0LmluY2x1c2l2ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEJvdW5kKG4sIHIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhbiB1cHBlciBib3VuZCBvZiBmaWVsZCB2YWx1ZXMgdGhhdCBjYW4gYmUgdXNlZCBhcyBhbiBlbmRpbmcgcG9pbnRcbiAqIHdoZW4gc2Nhbm5pbmcgdGhlIGluZGV4IGRlZmluZWQgYnkgYGZpZWxkSW5kZXhgLiBSZXR1cm5zIGBNQVhfVkFMVUVgIGlmIG5vXG4gKiB1cHBlciBib3VuZCBleGlzdHMuXG4gKi8gKHMsIGkpLCB1ID0gZnVuY3Rpb24gX19QUklWQVRFX3RhcmdldEdldFVwcGVyQm91bmQoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHIgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIEZvciBlYWNoIHNlZ21lbnQsIHJldHJpZXZlIGFuIHVwcGVyIGJvdW5kIGlmIHRoZXJlIGlzIGEgc3VpdGFibGUgZmlsdGVyIG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlbmRBdC5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHModCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovID09PSBpLmtpbmQgPyBfX1BSSVZBVEVfdGFyZ2V0R2V0RGVzY2VuZGluZ0JvdW5kKGUsIGkuZmllbGRQYXRoLCBlLmVuZEF0KSA6IF9fUFJJVkFURV90YXJnZXRHZXRBc2NlbmRpbmdCb3VuZChlLCBpLmZpZWxkUGF0aCwgZS5lbmRBdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5wdXNoKHQudmFsdWUpLCByICYmIChyID0gdC5pbmNsdXNpdmUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBCb3VuZChuLCByKTtcbiAgICAgICAgICAgICAgICAgICAgfShzLCBpKSwgYyA9IHRoaXMuUm4oaSwgcywgYSksIGwgPSB0aGlzLlJuKGksIHMsIHUpLCBoID0gdGhpcy5WbihpLCBzLCBfKSwgUCA9IHRoaXMubW4oaS5pbmRleElkLCBvLCBjLCBhLmluY2x1c2l2ZSwgbCwgdS5pbmNsdXNpdmUsIGgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2goUCwgKGkgPT4gbi5IKGksIHQubGltaXQpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKHQuZG9jdW1lbnRLZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuaGFzKG4pIHx8IChlID0gZS5hZGQobiksIHIucHVzaChuKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiByKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZG4oZSkge1xuICAgICAgICBsZXQgdCA9IHRoaXMuRW4uZ2V0KGUpO1xuICAgICAgICBpZiAodCkgcmV0dXJuIHQ7XG4gICAgICAgIGlmICgwID09PSBlLmZpbHRlcnMubGVuZ3RoKSB0ID0gWyBlIF07IGVsc2Uge1xuICAgICAgICAgICAgdCA9IF9fUFJJVkFURV9nZXREbmZUZXJtcyhDb21wb3NpdGVGaWx0ZXIuY3JlYXRlKGUuZmlsdGVycywgXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8pKS5tYXAoKHQgPT4gX19QUklWQVRFX25ld1RhcmdldChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCBlLm9yZGVyQnksIHQuZ2V0RmlsdGVycygpLCBlLmxpbWl0LCBlLnN0YXJ0QXQsIGUuZW5kQXQpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuRW4uc2V0KGUsIHQpLCB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIGEga2V5IHJhbmdlIHF1ZXJ5IG9uIGBEYkluZGV4RW50cnlTdG9yZWAgdGhhdCB1bmlvbnMgYWxsXG4gICAgICogYm91bmRzLlxuICAgICAqLyAgICBtbihlLCB0LCBuLCByLCBpLCBzLCBvKSB7XG4gICAgICAgIC8vIFRoZSBudW1iZXIgb2YgdG90YWwgaW5kZXggc2NhbnMgd2UgdW5pb24gdG9nZXRoZXIuIFRoaXMgaXMgc2ltaWxhciB0byBhXG4gICAgICAgIC8vIGRpc3RyaWJ1dGVkIG5vcm1hbCBmb3JtLCBidXQgYWRhcHRlZCBmb3IgYXJyYXkgdmFsdWVzLiBXZSBjcmVhdGUgYSBzaW5nbGVcbiAgICAgICAgLy8gaW5kZXggcmFuZ2UgcGVyIHZhbHVlIGluIGFuIEFSUkFZX0NPTlRBSU5TIG9yIEFSUkFZX0NPTlRBSU5TX0FOWSBmaWx0ZXJcbiAgICAgICAgLy8gY29tYmluZWQgd2l0aCB0aGUgdmFsdWVzIGZyb20gdGhlIHF1ZXJ5IGJvdW5kcy5cbiAgICAgICAgY29uc3QgXyA9IChudWxsICE9IHQgPyB0Lmxlbmd0aCA6IDEpICogTWF0aC5tYXgobi5sZW5ndGgsIGkubGVuZ3RoKSwgYSA9IF8gLyAobnVsbCAhPSB0ID8gdC5sZW5ndGggOiAxKSwgdSA9IFtdO1xuICAgICAgICBmb3IgKGxldCBjID0gMDsgYyA8IF87ICsrYykge1xuICAgICAgICAgICAgY29uc3QgXyA9IHQgPyB0aGlzLmZuKHRbYyAvIGFdKSA6IHl0LCBsID0gdGhpcy5nbihlLCBfLCBuW2MgJSBhXSwgciksIGggPSB0aGlzLnBuKGUsIF8sIGlbYyAlIGFdLCBzKSwgUCA9IG8ubWFwKCh0ID0+IHRoaXMuZ24oZSwgXywgdCwgXG4gICAgICAgICAgICAvKiBpbmNsdXNpdmU9ICovICEwKSkpO1xuICAgICAgICAgICAgdS5wdXNoKC4uLnRoaXMuY3JlYXRlUmFuZ2UobCwgaCwgUCkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB1O1xuICAgIH1cbiAgICAvKiogR2VuZXJhdGVzIHRoZSBsb3dlciBib3VuZCBmb3IgYGFycmF5VmFsdWVgIGFuZCBgZGlyZWN0aW9uYWxWYWx1ZWAuICovICAgIGduKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeShlLCBEb2N1bWVudEtleS5lbXB0eSgpLCB0LCBuKTtcbiAgICAgICAgcmV0dXJuIHIgPyBpIDogaS5ubigpO1xuICAgIH1cbiAgICAvKiogR2VuZXJhdGVzIHRoZSB1cHBlciBib3VuZCBmb3IgYGFycmF5VmFsdWVgIGFuZCBgZGlyZWN0aW9uYWxWYWx1ZWAuICovICAgIHBuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeShlLCBEb2N1bWVudEtleS5lbXB0eSgpLCB0LCBuKTtcbiAgICAgICAgcmV0dXJuIHIgPyBpLm5uKCkgOiBpO1xuICAgIH1cbiAgICBBbihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX1RhcmdldEluZGV4TWF0Y2hlcih0KSwgciA9IG51bGwgIT0gdC5jb2xsZWN0aW9uR3JvdXAgPyB0LmNvbGxlY3Rpb25Hcm91cCA6IHQucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWVsZEluZGV4ZXMoZSwgcikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAvLyBSZXR1cm4gdGhlIGluZGV4IHdpdGggdGhlIG1vc3QgbnVtYmVyIG9mIHNlZ21lbnRzLlxuICAgICAgICAgICAgbGV0IHQgPSBudWxsO1xuICAgICAgICAgICAgZm9yIChjb25zdCByIG9mIGUpIHtcbiAgICAgICAgICAgICAgICBuLnVuKHIpICYmICghdCB8fCByLmZpZWxkcy5sZW5ndGggPiB0LmZpZWxkcy5sZW5ndGgpICYmICh0ID0gcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRJbmRleFR5cGUoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IDIgLyogSW5kZXhUeXBlLkZVTEwgKi87XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLmRuKHQpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2gociwgKHQgPT4gdGhpcy5BbihlLCB0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGUgPyAwIC8qIEluZGV4VHlwZS5OT05FICovICE9PSBuICYmIGUuZmllbGRzLmxlbmd0aCA8IGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRHZXRTZWdtZW50Q291bnQoZSkge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gbmV3IFNvcnRlZFNldChGaWVsZFBhdGgkMS5jb21wYXJhdG9yKSwgbiA9ICExO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiBlLmZpbHRlcnMpIGZvciAoY29uc3QgZSBvZiByLmdldEZsYXR0ZW5lZEZpbHRlcnMoKSkgXG4gICAgICAgICAgICAgICAgLy8gX19uYW1lX18gaXMgbm90IGFuIGV4cGxpY2l0IHNlZ21lbnQgb2YgYW55IGluZGV4LCBzbyB3ZSBkb24ndCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgLy8gY291bnQgaXQuXG4gICAgICAgICAgICAgICAgZS5maWVsZC5pc0tleUZpZWxkKCkgfHwgKFxuICAgICAgICAgICAgICAgIC8vIEFSUkFZX0NPTlRBSU5TIG9yIEFSUkFZX0NPTlRBSU5TX0FOWSBmaWx0ZXJzIG11c3QgYmUgY291bnRlZCBzZXBhcmF0ZWx5LlxuICAgICAgICAgICAgICAgIC8vIEZvciBpbnN0YW5jZSwgaXQgaXMgcG9zc2libGUgdG8gaGF2ZSBhbiBpbmRleCBmb3IgXCJhIEFSUkFZIGEgQVNDXCIuIEV2ZW5cbiAgICAgICAgICAgICAgICAvLyB0aG91Z2ggdGhlc2UgYXJlIG9uIHRoZSBzYW1lIGZpZWxkLCB0aGV5IHNob3VsZCBiZSBjb3VudGVkIGFzIHR3b1xuICAgICAgICAgICAgICAgIC8vIHNlcGFyYXRlIHNlZ21lbnRzIGluIGFuIGluZGV4LlxuICAgICAgICAgICAgICAgIFwiYXJyYXktY29udGFpbnNcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOUyAqLyA9PT0gZS5vcCB8fCBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyA9PT0gZS5vcCA/IG4gPSAhMCA6IHQgPSB0LmFkZChlLmZpZWxkKSk7XG4gICAgICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIGUub3JkZXJCeSkgXG4gICAgICAgICAgICAgICAgLy8gX19uYW1lX18gaXMgbm90IGFuIGV4cGxpY2l0IHNlZ21lbnQgb2YgYW55IGluZGV4LCBzbyB3ZSBkb24ndCBuZWVkIHRvXG4gICAgICAgICAgICAgICAgLy8gY291bnQgaXQuXG4gICAgICAgICAgICAgICAgbi5maWVsZC5pc0tleUZpZWxkKCkgfHwgKHQgPSB0LmFkZChuLmZpZWxkKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuc2l6ZSArIChuID8gMSA6IDApO1xuICAgICAgICAgICAgfSh0KSAmJiAobiA9IDEgLyogSW5kZXhUeXBlLlBBUlRJQUwgKi8pIDogbiA9IDAgLyogSW5kZXhUeXBlLk5PTkUgKi87XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IFxuICAgICAgICAvLyBPUiBxdWVyaWVzIGhhdmUgbW9yZSB0aGFuIG9uZSBzdWItdGFyZ2V0IChvbmUgc3ViLXRhcmdldCBwZXIgRE5GIHRlcm0pLiBXZSBjdXJyZW50bHkgY29uc2lkZXJcbiAgICAgICAgLy8gT1IgcXVlcmllcyB0aGF0IGhhdmUgYSBgbGltaXRgIHRvIGhhdmUgYSBwYXJ0aWFsIGluZGV4LiBGb3Igc3VjaCBxdWVyaWVzIHdlIHBlcmZvcm0gc29ydGluZ1xuICAgICAgICAvLyBhbmQgYXBwbHkgdGhlIGxpbWl0IGluIG1lbW9yeSBhcyBhIHBvc3QtcHJvY2Vzc2luZyBzdGVwLlxuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfdGFyZ2V0SGFzTGltaXQoZSkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGwgIT09IGUubGltaXQ7XG4gICAgICAgIH0odCkgJiYgci5sZW5ndGggPiAxICYmIDIgLyogSW5kZXhUeXBlLkZVTEwgKi8gPT09IG4gPyAxIC8qIEluZGV4VHlwZS5QQVJUSUFMICovIDogbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBieXRlIGVuY29kZWQgZm9ybSBvZiB0aGUgZGlyZWN0aW9uYWwgdmFsdWVzIGluIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKiBSZXR1cm5zIGBudWxsYCBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgaGF2ZSBhbGwgZmllbGRzIHNwZWNpZmllZCBpbiB0aGVcbiAgICAgKiBpbmRleC5cbiAgICAgKi8gICAgeW4oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9JbmRleEJ5dGVFbmNvZGVyO1xuICAgICAgICBmb3IgKGNvbnN0IHIgb2YgX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdC5kYXRhLmZpZWxkKHIuZmllbGRQYXRoKTtcbiAgICAgICAgICAgIGlmIChudWxsID09IGUpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgY29uc3QgaSA9IG4udG4oci5raW5kKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLnh0LkF0KGUsIGkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuLll0KCk7XG4gICAgfVxuICAgIC8qKiBFbmNvZGVzIGEgc2luZ2xlIHZhbHVlIHRvIHRoZSBhc2NlbmRpbmcgaW5kZXggZm9ybWF0LiAqLyAgICBmbihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXI7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlci54dC5BdChlLCB0LnRuKDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLykpLCBcbiAgICAgICAgdC5ZdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGVuY29kZWQgZm9ybSBvZiB0aGUgZG9jdW1lbnQga2V5IHRoYXQgc29ydHMgYmFzZWQgb24gdGhlIGtleVxuICAgICAqIG9yZGVyaW5nIG9mIHRoZSBmaWVsZCBpbmRleC5cbiAgICAgKi8gICAgd24oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9JbmRleEJ5dGVFbmNvZGVyO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX0ZpcmVzdG9yZUluZGV4VmFsdWVXcml0ZXIueHQuQXQoX19QUklWQVRFX3JlZlZhbHVlKHRoaXMuZGF0YWJhc2VJZCwgdCksIG4udG4oZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXRLZXlPcmRlcihlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2ZpZWxkSW5kZXhHZXREaXJlY3Rpb25hbFNlZ21lbnRzKGUpO1xuICAgICAgICAgICAgcmV0dXJuIDAgPT09IHQubGVuZ3RoID8gMCAvKiBJbmRleEtpbmQuQVNDRU5ESU5HICovIDogdFt0Lmxlbmd0aCAtIDFdLmtpbmQ7XG4gICAgICAgIH0oZSkpKSwgbi5ZdCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHRoZSBnaXZlbiBmaWVsZCB2YWx1ZXMgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uIGluIGB0YXJnZXRgLlxuICAgICAqIEZvciBJTiBxdWVyaWVzLCBhIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBWbihlLCB0LCBuKSB7XG4gICAgICAgIGlmIChudWxsID09PSBuKSByZXR1cm4gW107XG4gICAgICAgIGxldCByID0gW107XG4gICAgICAgIHIucHVzaChuZXcgX19QUklWQVRFX0luZGV4Qnl0ZUVuY29kZXIpO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIGZvciAoY29uc3QgcyBvZiBfX1BSSVZBVEVfZmllbGRJbmRleEdldERpcmVjdGlvbmFsU2VnbWVudHMoZSkpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuW2krK107XG4gICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgcikgaWYgKHRoaXMuU24odCwgcy5maWVsZFBhdGgpICYmIGlzQXJyYXkoZSkpIHIgPSB0aGlzLmJuKHIsIHMsIGUpOyBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbi50bihzLmtpbmQpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9GaXJlc3RvcmVJbmRleFZhbHVlV3JpdGVyLnh0LkF0KGUsIHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLkRuKHIpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbmNvZGVzIHRoZSBnaXZlbiBib3VuZHMgYWNjb3JkaW5nIHRvIHRoZSBzcGVjaWZpY2F0aW9uIGluIGB0YXJnZXRgLiBGb3IgSU5cbiAgICAgKiBxdWVyaWVzLCBhIGxpc3Qgb2YgcG9zc2libGUgdmFsdWVzIGlzIHJldHVybmVkLlxuICAgICAqLyAgICBSbihlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlZuKGUsIHQsIG4ucG9zaXRpb24pO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgYnl0ZSByZXByZXNlbnRhdGlvbiBmb3IgdGhlIHByb3ZpZGVkIGVuY29kZXJzLiAqLyAgICBEbihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLmxlbmd0aDsgKytuKSB0W25dID0gZVtuXS5ZdCgpO1xuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIHNlcGFyYXRlIGVuY29kZXIgZm9yIGVhY2ggZWxlbWVudCBvZiBhbiBhcnJheS5cbiAgICAgKlxuICAgICAqIFRoZSBtZXRob2QgYXBwZW5kcyBlYWNoIHZhbHVlIHRvIGFsbCBleGlzdGluZyBlbmNvZGVycyAoZS5nLiBmaWx0ZXIoXCJhXCIsXG4gICAgICogXCI9PVwiLCBcImExXCIpLmZpbHRlcihcImJcIiwgXCJpblwiLCBbXCJiMVwiLCBcImIyXCJdKSBiZWNvbWVzIFtcImExLGIxXCIsIFwiYTEsYjJcIl0pLiBBXG4gICAgICogbGlzdCBvZiBuZXcgZW5jb2RlcnMgaXMgcmV0dXJuZWQuXG4gICAgICovICAgIGJuKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IFsgLi4uZSBdLCBpID0gW107XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiBuLmFycmF5VmFsdWUudmFsdWVzIHx8IFtdKSBmb3IgKGNvbnN0IG4gb2Ygcikge1xuICAgICAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfSW5kZXhCeXRlRW5jb2RlcjtcbiAgICAgICAgICAgIHIuc2VlZChuLll0KCkpLCBfX1BSSVZBVEVfRmlyZXN0b3JlSW5kZXhWYWx1ZVdyaXRlci54dC5BdChlLCByLnRuKHQua2luZCkpLCBpLnB1c2gocik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGk7XG4gICAgfVxuICAgIFNuKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuICEhZS5maWx0ZXJzLmZpbmQoKGUgPT4gZSBpbnN0YW5jZW9mIEZpZWxkRmlsdGVyICYmIGUuZmllbGQuaXNFcXVhbCh0KSAmJiAoXCJpblwiIC8qIE9wZXJhdG9yLklOICovID09PSBlLm9wIHx8IFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovID09PSBlLm9wKSkpO1xuICAgIH1cbiAgICBnZXRGaWVsZEluZGV4ZXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpLCByID0gX19QUklWQVRFX2luZGV4U3RhdGVTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuICh0ID8gbi5HKFNlLCBJREJLZXlSYW5nZS5ib3VuZCh0LCB0KSkgOiBuLkcoKSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2goZSwgKGUgPT4gci5nZXQoWyBlLmluZGV4SWQsIHRoaXMudWlkIF0pLm5leHQoKG4gPT4ge1xuICAgICAgICAgICAgICAgIHQucHVzaChmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbURiSW5kZXhDb25maWd1cmF0aW9uKGUsIHQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IHQgPyBuZXcgSW5kZXhTdGF0ZSh0LnNlcXVlbmNlTnVtYmVyLCBuZXcgSW5kZXhPZmZzZXQoX19QUklWQVRFX2Zyb21EYlRpbWVzdGFtcCh0LnJlYWRUaW1lKSwgbmV3IERvY3VtZW50S2V5KF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgodC5kb2N1bWVudEtleSkpLCB0Lmxhcmdlc3RCYXRjaElkKSkgOiBJbmRleFN0YXRlLmVtcHR5KCksIHIgPSBlLmZpZWxkcy5tYXAoKChbZSwgdF0pID0+IG5ldyBJbmRleFNlZ21lbnQoRmllbGRQYXRoJDEuZnJvbVNlcnZlckZvcm1hdChlKSwgdCkpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBGaWVsZEluZGV4KGUuaW5kZXhJZCwgZS5jb2xsZWN0aW9uR3JvdXAsIHIsIG4pO1xuICAgICAgICAgICAgICAgIH0oZSwgbikpO1xuICAgICAgICAgICAgfSkpKSkubmV4dCgoKCkgPT4gdCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldE5leHRDb2xsZWN0aW9uR3JvdXBUb1VwZGF0ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEZpZWxkSW5kZXhlcyhlKS5uZXh0KChlID0+IDAgPT09IGUubGVuZ3RoID8gbnVsbCA6IChlLnNvcnQoKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5pbmRleFN0YXRlLnNlcXVlbmNlTnVtYmVyIC0gdC5pbmRleFN0YXRlLnNlcXVlbmNlTnVtYmVyO1xuICAgICAgICAgICAgcmV0dXJuIDAgIT09IG4gPyBuIDogX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jb2xsZWN0aW9uR3JvdXAsIHQuY29sbGVjdGlvbkdyb3VwKTtcbiAgICAgICAgfSkpLCBlWzBdLmNvbGxlY3Rpb25Hcm91cCkpKTtcbiAgICB9XG4gICAgdXBkYXRlQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9pbmRleENvbmZpZ3VyYXRpb25TdG9yZShlKSwgaSA9IF9fUFJJVkFURV9pbmRleFN0YXRlU3RvcmUoZSk7XG4gICAgICAgIHJldHVybiB0aGlzLnZuKGUpLm5leHQoKGUgPT4gci5HKFNlLCBJREJLZXlSYW5nZS5ib3VuZCh0LCB0KSkubmV4dCgodCA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiBpLnB1dChfX1BSSVZBVEVfdG9EYkluZGV4U3RhdGUodC5pbmRleElkLCB0aGlzLnVpZCwgZSwgbikpKSkpKSkpO1xuICAgIH1cbiAgICB1cGRhdGVJbmRleEVudHJpZXMoZSwgdCkge1xuICAgICAgICAvLyBQb3J0aW5nIE5vdGU6IGBnZXRGaWVsZEluZGV4ZXMoKWAgb24gV2ViIGRvZXMgbm90IGNhY2hlIGluZGV4IGxvb2t1cHMgYXNcbiAgICAgICAgLy8gaXQgY291bGQgYmUgdXNlZCBhY3Jvc3MgZGlmZmVyZW50IEluZGV4ZWREQiB0cmFuc2FjdGlvbnMuIEFzIGFueSBjYWNoZWRcbiAgICAgICAgLy8gZGF0YSBtaWdodCBiZSBpbnZhbGlkYXRlZCBieSBvdGhlciBtdWx0aS10YWIgY2xpZW50cywgd2UgY2FuIG9ubHkgdHJ1c3RcbiAgICAgICAgLy8gZGF0YSB3aXRoaW4gYSBzaW5nbGUgSW5kZXhlZERCIHRyYW5zYWN0aW9uLiBXZSB0aGVyZWZvcmUgYWRkIGEgY2FjaGVcbiAgICAgICAgLy8gaGVyZS5cbiAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAoKHQsIHIpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBuLmdldCh0LmNvbGxlY3Rpb25Hcm91cCk7XG4gICAgICAgICAgICByZXR1cm4gKGkgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShpKSA6IHRoaXMuZ2V0RmllbGRJbmRleGVzKGUsIHQuY29sbGVjdGlvbkdyb3VwKSkubmV4dCgoaSA9PiAobi5zZXQodC5jb2xsZWN0aW9uR3JvdXAsIGkpLCBcbiAgICAgICAgICAgIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKGksIChuID0+IHRoaXMuQ24oZSwgdCwgbikubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IHRoaXMuRm4ociwgbik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuaXNFcXVhbChpKSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCkgOiB0aGlzLk1uKGUsIHIsIG4sIHQsIGkpO1xuICAgICAgICAgICAgfSkpKSkpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgeG4oZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpLnB1dCh7XG4gICAgICAgICAgICBpbmRleElkOiByLmluZGV4SWQsXG4gICAgICAgICAgICB1aWQ6IHRoaXMudWlkLFxuICAgICAgICAgICAgYXJyYXlWYWx1ZTogci5hcnJheVZhbHVlLFxuICAgICAgICAgICAgZGlyZWN0aW9uYWxWYWx1ZTogci5kaXJlY3Rpb25hbFZhbHVlLFxuICAgICAgICAgICAgb3JkZXJlZERvY3VtZW50S2V5OiB0aGlzLnduKG4sIHQua2V5KSxcbiAgICAgICAgICAgIGRvY3VtZW50S2V5OiB0LmtleS5wYXRoLnRvQXJyYXkoKVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgT24oZSwgdCwgbiwgcikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2luZGV4RW50cmllc1N0b3JlKGUpLmRlbGV0ZShbIHIuaW5kZXhJZCwgdGhpcy51aWQsIHIuYXJyYXlWYWx1ZSwgci5kaXJlY3Rpb25hbFZhbHVlLCB0aGlzLnduKG4sIHQua2V5KSwgdC5rZXkucGF0aC50b0FycmF5KCkgXSk7XG4gICAgfVxuICAgIENuKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9pbmRleEVudHJpZXNTdG9yZShlKTtcbiAgICAgICAgbGV0IGkgPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiByLlooe1xuICAgICAgICAgICAgaW5kZXg6IE9lLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLm9ubHkoWyBuLmluZGV4SWQsIHRoaXMudWlkLCB0aGlzLnduKG4sIHQpIF0pXG4gICAgICAgIH0sICgoZSwgcikgPT4ge1xuICAgICAgICAgICAgaSA9IGkuYWRkKG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeShuLmluZGV4SWQsIHQsIHIuYXJyYXlWYWx1ZSwgci5kaXJlY3Rpb25hbFZhbHVlKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIHRoZSBpbmRleCBlbnRyaWVzIGZvciB0aGUgZ2l2ZW4gZG9jdW1lbnQuICovICAgIEZuKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvcik7XG4gICAgICAgIGNvbnN0IHIgPSB0aGlzLnluKHQsIGUpO1xuICAgICAgICBpZiAobnVsbCA9PSByKSByZXR1cm4gbjtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9maWVsZEluZGV4R2V0QXJyYXlTZWdtZW50KHQpO1xuICAgICAgICBpZiAobnVsbCAhPSBpKSB7XG4gICAgICAgICAgICBjb25zdCBzID0gZS5kYXRhLmZpZWxkKGkuZmllbGRQYXRoKTtcbiAgICAgICAgICAgIGlmIChpc0FycmF5KHMpKSBmb3IgKGNvbnN0IGkgb2Ygcy5hcnJheVZhbHVlLnZhbHVlcyB8fCBbXSkgbiA9IG4uYWRkKG5ldyBfX1BSSVZBVEVfSW5kZXhFbnRyeSh0LmluZGV4SWQsIGUua2V5LCB0aGlzLmZuKGkpLCByKSk7XG4gICAgICAgIH0gZWxzZSBuID0gbi5hZGQobmV3IF9fUFJJVkFURV9JbmRleEVudHJ5KHQuaW5kZXhJZCwgZS5rZXksIHl0LCByKSk7XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHRoZSBpbmRleCBlbnRyaWVzIGZvciB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgYnkgZGVsZXRpbmcgZW50cmllc1xuICAgICAqIHRoYXQgYXJlIG5vIGxvbmdlciByZWZlcmVuY2VkIGluIGBuZXdFbnRyaWVzYCBhbmQgYWRkaW5nIGFsbCBuZXdseSBhZGRlZFxuICAgICAqIGVudHJpZXMuXG4gICAgICovICAgIE1uKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKHB0LCBcIlVwZGF0aW5nIGluZGV4IGVudHJpZXMgZm9yIGRvY3VtZW50ICclcydcIiwgdC5rZXkpO1xuICAgICAgICBjb25zdCBzID0gW107XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZGlmZlNvcnRlZFNldHMoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICAgICAgY29uc3QgcyA9IGUuZ2V0SXRlcmF0b3IoKSwgbyA9IHQuZ2V0SXRlcmF0b3IoKTtcbiAgICAgICAgICAgIGxldCBfID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihzKSwgYSA9IF9fUFJJVkFURV9hZHZhbmNlSXRlcmF0b3Iobyk7XG4gICAgICAgICAgICAvLyBXYWxrIHRocm91Z2ggdGhlIHR3byBzZXRzIGF0IHRoZSBzYW1lIHRpbWUsIHVzaW5nIHRoZSBvcmRlcmluZyBkZWZpbmVkIGJ5XG4gICAgICAgICAgICAvLyBgY29tcGFyYXRvcmAuXG4gICAgICAgICAgICBmb3IgKDtfIHx8IGE7ICkge1xuICAgICAgICAgICAgICAgIGxldCBlID0gITEsIHQgPSAhMTtcbiAgICAgICAgICAgICAgICBpZiAoXyAmJiBhKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBuKF8sIGEpO1xuICAgICAgICAgICAgICAgICAgICByIDwgMCA/IFxuICAgICAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgcmVtb3ZlZCBpZiB0aGUgbmV4dCBlbGVtZW50IGluIG91ciBvcmRlcmVkXG4gICAgICAgICAgICAgICAgICAgIC8vIHdhbGt0aHJvdWdoIGlzIG9ubHkgaW4gYGJlZm9yZWAuXG4gICAgICAgICAgICAgICAgICAgIHQgPSAhMCA6IHIgPiAwICYmIChcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnQgd2FzIGFkZGVkIGlmIHRoZSBuZXh0IGVsZW1lbnQgaW4gb3VyIG9yZGVyZWQgd2Fsa3Rocm91Z2hcbiAgICAgICAgICAgICAgICAgICAgLy8gaXMgb25seSBpbiBgYWZ0ZXJgLlxuICAgICAgICAgICAgICAgICAgICBlID0gITApO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBudWxsICE9IF8gPyB0ID0gITAgOiBlID0gITA7XG4gICAgICAgICAgICAgICAgZSA/IChyKGEpLCBhID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihvKSkgOiB0ID8gKGkoXyksIF8gPSBfX1BSSVZBVEVfYWR2YW5jZUl0ZXJhdG9yKHMpKSA6IChfID0gX19QUklWQVRFX2FkdmFuY2VJdGVyYXRvcihzKSwgXG4gICAgICAgICAgICAgICAgYSA9IF9fUFJJVkFURV9hZHZhbmNlSXRlcmF0b3IobykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KHIsIGksIF9fUFJJVkFURV9pbmRleEVudHJ5Q29tcGFyYXRvciwgKFxuICAgICAgICAvKiBvbkFkZD0gKi8gciA9PiB7XG4gICAgICAgICAgICBzLnB1c2godGhpcy54bihlLCB0LCBuLCByKSk7XG4gICAgICAgIH0pLCAoXG4gICAgICAgIC8qIG9uUmVtb3ZlPSAqLyByID0+IHtcbiAgICAgICAgICAgIHMucHVzaCh0aGlzLk9uKGUsIHQsIG4sIHIpKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihzKTtcbiAgICB9XG4gICAgdm4oZSkge1xuICAgICAgICBsZXQgdCA9IDE7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpLlooe1xuICAgICAgICAgICAgaW5kZXg6IENlLFxuICAgICAgICAgICAgcmV2ZXJzZTogITAsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2UudXBwZXJCb3VuZChbIHRoaXMudWlkLCBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiBdKVxuICAgICAgICB9LCAoKGUsIG4sIHIpID0+IHtcbiAgICAgICAgICAgIHIuZG9uZSgpLCB0ID0gbi5zZXF1ZW5jZU51bWJlciArIDE7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBuZXcgc2V0IG9mIElEQiByYW5nZXMgdGhhdCBzcGxpdHMgdGhlIGV4aXN0aW5nIHJhbmdlIGFuZCBleGNsdWRlc1xuICAgICAqIGFueSB2YWx1ZXMgdGhhdCBtYXRjaCB0aGUgYG5vdEluVmFsdWVgIGZyb20gdGhlc2UgcmFuZ2VzLiBBcyBhbiBleGFtcGxlLFxuICAgICAqICdbZm9vID4gMiAmJiBmb28gIT0gM11gIGJlY29tZXMgIGBbZm9vID4gMiAmJiA8IDMsIGZvbyA+IDNdYC5cbiAgICAgKi8gICAgY3JlYXRlUmFuZ2UoZSwgdCwgbikge1xuICAgICAgICAvLyBUaGUgbm90SW4gdmFsdWVzIG5lZWQgdG8gYmUgc29ydGVkIGFuZCB1bmlxdWUgc28gdGhhdCB3ZSBjYW4gcmV0dXJuIGFcbiAgICAgICAgLy8gc29ydGVkIHNldCBvZiBub24tb3ZlcmxhcHBpbmcgcmFuZ2VzLlxuICAgICAgICBuID0gbi5zb3J0KCgoZSwgdCkgPT4gX19QUklWQVRFX2luZGV4RW50cnlDb21wYXJhdG9yKGUsIHQpKSkuZmlsdGVyKCgoZSwgdCwgbikgPT4gIXQgfHwgMCAhPT0gX19QUklWQVRFX2luZGV4RW50cnlDb21wYXJhdG9yKGUsIG5bdCAtIDFdKSkpO1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHIucHVzaChlKTtcbiAgICAgICAgZm9yIChjb25zdCBpIG9mIG4pIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoaSwgZSksIHMgPSBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoaSwgdCk7XG4gICAgICAgICAgICBpZiAoMCA9PT0gbikgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgaXMgdGhlIGxvd2VyIGJvdW5kLiBXZSB0aGVyZWZvcmUgbmVlZCB0byByYWlzZSB0aGUgYm91bmRcbiAgICAgICAgICAgIC8vIHRvIHRoZSBuZXh0IHZhbHVlLlxuICAgICAgICAgICAgclswXSA9IGUubm4oKTsgZWxzZSBpZiAobiA+IDAgJiYgcyA8IDApIFxuICAgICAgICAgICAgLy8gYG5vdEluVmFsdWVgIGlzIGluIHRoZSBtaWRkbGUgb2YgdGhlIHJhbmdlXG4gICAgICAgICAgICByLnB1c2goaSksIHIucHVzaChpLm5uKCkpOyBlbHNlIGlmIChzID4gMCkgXG4gICAgICAgICAgICAvLyBgbm90SW5WYWx1ZWAgKGFuZCBhbGwgZm9sbG93aW5nIHZhbHVlcykgYXJlIG91dCBvZiB0aGUgcmFuZ2VcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHIucHVzaCh0KTtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHIubGVuZ3RoOyBlICs9IDIpIHtcbiAgICAgICAgICAgIC8vIElmIHdlIGVuY291bnRlciB0d28gYm91bmRzIHRoYXQgd2lsbCBjcmVhdGUgYW4gdW5tYXRjaGFibGUga2V5IHJhbmdlLFxuICAgICAgICAgICAgLy8gdGhlbiB3ZSByZXR1cm4gYW4gZW1wdHkgc2V0IG9mIGtleSByYW5nZXMuXG4gICAgICAgICAgICBpZiAodGhpcy5ObihyW2VdLCByW2UgKyAxXSkpIHJldHVybiBbXTtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBbIHJbZV0uaW5kZXhJZCwgdGhpcy51aWQsIHJbZV0uYXJyYXlWYWx1ZSwgcltlXS5kaXJlY3Rpb25hbFZhbHVlLCB5dCwgW10gXSwgbiA9IFsgcltlICsgMV0uaW5kZXhJZCwgdGhpcy51aWQsIHJbZSArIDFdLmFycmF5VmFsdWUsIHJbZSArIDFdLmRpcmVjdGlvbmFsVmFsdWUsIHl0LCBbXSBdO1xuICAgICAgICAgICAgaS5wdXNoKElEQktleVJhbmdlLmJvdW5kKHQsIG4pKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaTtcbiAgICB9XG4gICAgTm4oZSwgdCkge1xuICAgICAgICAvLyBJZiBsb3dlciBib3VuZCBpcyBncmVhdGVyIHRoYW4gdGhlIHVwcGVyIGJvdW5kLCB0aGVuIHRoZSBrZXlcbiAgICAgICAgLy8gcmFuZ2UgY2FuIG5ldmVyIGJlIG1hdGNoZWQuXG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfaW5kZXhFbnRyeUNvbXBhcmF0b3IoZSwgdCkgPiAwO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXRGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RmllbGRJbmRleGVzKGUsIHQpLm5leHQoX19QUklWQVRFX2dldE1pbk9mZnNldEZyb21GaWVsZEluZGV4ZXMpO1xuICAgIH1cbiAgICBnZXRNaW5PZmZzZXQoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm1hcEFycmF5KHRoaXMuZG4odCksICh0ID0+IHRoaXMuQW4oZSwgdCkubmV4dCgoZSA9PiBlIHx8IGZhaWwoKSkpKSkubmV4dChfX1BSSVZBVEVfZ2V0TWluT2Zmc2V0RnJvbUZpZWxkSW5kZXhlcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgY29sbGVjdGlvblBhcmVudHNcbiAqIGRvY3VtZW50IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jb2xsZWN0aW9uUGFyZW50c1N0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIGRlKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGluZGV4IGVudHJ5IG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhFbnRyaWVzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgTWUpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgaW5kZXggY29uZmlndXJhdGlvbiBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2luZGV4Q29uZmlndXJhdGlvblN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIHllKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGluZGV4IHN0YXRlIG9iamVjdCBzdG9yZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhTdGF0ZVN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIERlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldE1pbk9mZnNldEZyb21GaWVsZEluZGV4ZXMoZSkge1xuICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KDAgIT09IGUubGVuZ3RoKTtcbiAgICBsZXQgdCA9IGVbMF0uaW5kZXhTdGF0ZS5vZmZzZXQsIG4gPSB0Lmxhcmdlc3RCYXRjaElkO1xuICAgIGZvciAobGV0IHIgPSAxOyByIDwgZS5sZW5ndGg7IHIrKykge1xuICAgICAgICBjb25zdCBpID0gZVtyXS5pbmRleFN0YXRlLm9mZnNldDtcbiAgICAgICAgX19QUklWQVRFX2luZGV4T2Zmc2V0Q29tcGFyYXRvcihpLCB0KSA8IDAgJiYgKHQgPSBpKSwgbiA8IGkubGFyZ2VzdEJhdGNoSWQgJiYgKG4gPSBpLmxhcmdlc3RCYXRjaElkKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBJbmRleE9mZnNldCh0LnJlYWRUaW1lLCB0LmRvY3VtZW50S2V5LCBuKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTggR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3Qgd3QgPSB7XG4gICAgZGlkUnVuOiAhMSxcbiAgICBzZXF1ZW5jZU51bWJlcnNDb2xsZWN0ZWQ6IDAsXG4gICAgdGFyZ2V0c1JlbW92ZWQ6IDAsXG4gICAgZG9jdW1lbnRzUmVtb3ZlZDogMFxufSwgU3QgPSA0MTk0MzA0MDtcblxuY2xhc3MgTHJ1UGFyYW1zIHtcbiAgICBzdGF0aWMgd2l0aENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTHJ1UGFyYW1zKGUsIExydVBhcmFtcy5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSwgTHJ1UGFyYW1zLkRFRkFVTFRfTUFYX1NFUVVFTkNFX05VTUJFUlNfVE9fQ09MTEVDVCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8vIFdoZW4gd2UgYXR0ZW1wdCB0byBjb2xsZWN0LCB3ZSB3aWxsIG9ubHkgZG8gc28gaWYgdGhlIGNhY2hlIHNpemUgaXMgZ3JlYXRlciB0aGFuIHRoaXNcbiAgICAvLyB0aHJlc2hvbGQuIFBhc3NpbmcgYENPTExFQ1RJT05fRElTQUJMRURgIGhlcmUgd2lsbCBjYXVzZSBjb2xsZWN0aW9uIHRvIGFsd2F5cyBiZSBza2lwcGVkLlxuICAgIGUsIFxuICAgIC8vIFRoZSBwZXJjZW50YWdlIG9mIHNlcXVlbmNlIG51bWJlcnMgdGhhdCB3ZSB3aWxsIGF0dGVtcHQgdG8gY29sbGVjdFxuICAgIHQsIFxuICAgIC8vIEEgY2FwIG9uIHRoZSB0b3RhbCBudW1iZXIgb2Ygc2VxdWVuY2UgbnVtYmVycyB0aGF0IHdpbGwgYmUgY29sbGVjdGVkLiBUaGlzIHByZXZlbnRzXG4gICAgLy8gdXMgZnJvbSBjb2xsZWN0aW5nIGEgaHVnZSBudW1iZXIgb2Ygc2VxdWVuY2UgbnVtYmVycyBpZiB0aGUgY2FjaGUgaGFzIGdyb3duIHZlcnkgbGFyZ2UuXG4gICAgbikge1xuICAgICAgICB0aGlzLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgPSBlLCB0aGlzLnBlcmNlbnRpbGVUb0NvbGxlY3QgPSB0LCB0aGlzLm1heGltdW1TZXF1ZW5jZU51bWJlcnNUb0NvbGxlY3QgPSBuO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRGVsZXRlIGEgbXV0YXRpb24gYmF0Y2ggYW5kIHRoZSBhc3NvY2lhdGVkIGRvY3VtZW50IG11dGF0aW9ucy5cbiAqIEByZXR1cm5zIEEgUGVyc2lzdGVuY2VQcm9taXNlIG9mIHRoZSBkb2N1bWVudCBtdXRhdGlvbnMgdGhhdCB3ZXJlIHJlbW92ZWQuXG4gKi9cbmZ1bmN0aW9uIHJlbW92ZU11dGF0aW9uQmF0Y2goZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBlLnN0b3JlKGopLCBpID0gZS5zdG9yZShYKSwgcyA9IFtdLCBvID0gSURCS2V5UmFuZ2Uub25seShuLmJhdGNoSWQpO1xuICAgIGxldCBfID0gMDtcbiAgICBjb25zdCBhID0gci5aKHtcbiAgICAgICAgcmFuZ2U6IG9cbiAgICB9LCAoKGUsIHQsIG4pID0+IChfKyssIG4uZGVsZXRlKCkpKSk7XG4gICAgcy5wdXNoKGEubmV4dCgoKCkgPT4ge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgxID09PSBfKTtcbiAgICB9KSkpO1xuICAgIGNvbnN0IHUgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGUgb2Ygbi5tdXRhdGlvbnMpIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9uZXdEYkRvY3VtZW50TXV0YXRpb25LZXkodCwgZS5rZXkucGF0aCwgbi5iYXRjaElkKTtcbiAgICAgICAgcy5wdXNoKGkuZGVsZXRlKHIpKSwgdS5wdXNoKGUua2V5KTtcbiAgICB9XG4gICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHMpLm5leHQoKCgpID0+IHUpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGFuIGFwcHJveGltYXRlIHNpemUgZm9yIHRoZSBnaXZlbiBkb2N1bWVudC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUoZSkge1xuICAgIGlmICghZSkgcmV0dXJuIDA7XG4gICAgbGV0IHQ7XG4gICAgaWYgKGUuZG9jdW1lbnQpIHQgPSBlLmRvY3VtZW50OyBlbHNlIGlmIChlLnVua25vd25Eb2N1bWVudCkgdCA9IGUudW5rbm93bkRvY3VtZW50OyBlbHNlIHtcbiAgICAgICAgaWYgKCFlLm5vRG9jdW1lbnQpIHRocm93IGZhaWwoKTtcbiAgICAgICAgdCA9IGUubm9Eb2N1bWVudDtcbiAgICB9XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHQpLmxlbmd0aDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBBIG11dGF0aW9uIHF1ZXVlIGZvciBhIHNwZWNpZmljIHVzZXIsIGJhY2tlZCBieSBJbmRleGVkREIuICovIExydVBhcmFtcy5ERUZBVUxUX0NPTExFQ1RJT05fUEVSQ0VOVElMRSA9IDEwLCBcbkxydVBhcmFtcy5ERUZBVUxUX01BWF9TRVFVRU5DRV9OVU1CRVJTX1RPX0NPTExFQ1QgPSAxZTMsIExydVBhcmFtcy5ERUZBVUxUID0gbmV3IExydVBhcmFtcyhTdCwgTHJ1UGFyYW1zLkRFRkFVTFRfQ09MTEVDVElPTl9QRVJDRU5USUxFLCBMcnVQYXJhbXMuREVGQVVMVF9NQVhfU0VRVUVOQ0VfTlVNQkVSU19UT19DT0xMRUNUKSwgXG5McnVQYXJhbXMuRElTQUJMRUQgPSBuZXcgTHJ1UGFyYW1zKC0xLCAwLCAwKTtcblxuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYk11dGF0aW9uUXVldWUge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBub3JtYWxpemVkIHVzZXJJZCAoZS5nLiBudWxsIFVJRCA9PiBcIlwiIHVzZXJJZCkgdXNlZCB0byBzdG9yZSAvXG4gICAgICogcmV0cmlldmUgbXV0YXRpb25zLlxuICAgICAqL1xuICAgIGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy51c2VySWQgPSBlLCB0aGlzLnNlcmlhbGl6ZXIgPSB0LCB0aGlzLmluZGV4TWFuYWdlciA9IG4sIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSByLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIENhY2hlcyB0aGUgZG9jdW1lbnQga2V5cyBmb3IgcGVuZGluZyBtdXRhdGlvbiBiYXRjaGVzLiBJZiB0aGUgbXV0YXRpb25cbiAgICAgICAgICogaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIEluZGV4ZWREYiwgdGhlIGNhY2hlZCB2YWx1ZSBtYXkgY29udGludWUgdG9cbiAgICAgICAgICogYmUgdXNlZCB0byByZXRyaWV2ZSB0aGUgYmF0Y2gncyBkb2N1bWVudCBrZXlzLiBUbyByZW1vdmUgYSBjYWNoZWQgdmFsdWVcbiAgICAgICAgICogbG9jYWxseSwgYHJlbW92ZUNhY2hlZE11dGF0aW9uS2V5cygpYCBzaG91bGQgYmUgaW52b2tlZCBlaXRoZXIgZGlyZWN0bHlcbiAgICAgICAgICogb3IgdGhyb3VnaCBgcmVtb3ZlTXV0YXRpb25CYXRjaGVzKClgLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXaXRoIG11bHRpLXRhYiwgd2hlbiB0aGUgcHJpbWFyeSBjbGllbnQgYWNrbm93bGVkZ2VzIG9yIHJlamVjdHMgYSBtdXRhdGlvbixcbiAgICAgICAgICogdGhpcyBjYWNoZSBpcyB1c2VkIGJ5IHNlY29uZGFyeSBjbGllbnRzIHRvIGludmFsaWRhdGUgdGhlIGxvY2FsXG4gICAgICAgICAqIHZpZXcgb2YgdGhlIGRvY3VtZW50cyB0aGF0IHdlcmUgcHJldmlvdXNseSBhZmZlY3RlZCBieSB0aGUgbXV0YXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5LlxuICAgICAgICB0aGlzLkJuID0ge307XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgbXV0YXRpb24gcXVldWUgZm9yIHRoZSBnaXZlbiB1c2VyLlxuICAgICAqIEBwYXJhbSB1c2VyIC0gVGhlIHVzZXIgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIG11dGF0aW9uIHF1ZXVlLlxuICAgICAqIEBwYXJhbSBzZXJpYWxpemVyIC0gVGhlIHNlcmlhbGl6ZXIgdG8gdXNlIHdoZW4gcGVyc2lzdGluZyB0byBJbmRleGVkRGIuXG4gICAgICovICAgIHN0YXRpYyBJdChlLCB0LCBuLCByKSB7XG4gICAgICAgIC8vIFRPRE8obWNnKTogRmlndXJlIG91dCB3aGF0IGNvbnN0cmFpbnRzIHRoZXJlIGFyZSBvbiB1c2VySURzXG4gICAgICAgIC8vIEluIHBhcnRpY3VsYXIsIGFyZSB0aGVyZSBhbnkgcmVzZXJ2ZWQgY2hhcmFjdGVycz8gYXJlIGVtcHR5IGlkcyBhbGxvd2VkP1xuICAgICAgICAvLyBGb3IgdGhlIG1vbWVudCBzdG9yZSB0aGVzZSB0b2dldGhlciBpbiB0aGUgc2FtZSBtdXRhdGlvbnMgdGFibGUgYXNzdW1pbmdcbiAgICAgICAgLy8gdGhhdCBlbXB0eSB1c2VySURzIGFyZW4ndCBhbGxvd2VkLlxuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChcIlwiICE9PSBlLnVpZCk7XG4gICAgICAgIGNvbnN0IGkgPSBlLmlzQXV0aGVudGljYXRlZCgpID8gZS51aWQgOiBcIlwiO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJNdXRhdGlvblF1ZXVlKGksIHQsIG4sIHIpO1xuICAgIH1cbiAgICBjaGVja0VtcHR5KGUpIHtcbiAgICAgICAgbGV0IHQgPSAhMDtcbiAgICAgICAgY29uc3QgbiA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdLCBbIHRoaXMudXNlcklkLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkgXSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogSixcbiAgICAgICAgICAgIHJhbmdlOiBuXG4gICAgICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICAgICAgdCA9ICExLCByLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQpKTtcbiAgICB9XG4gICAgYWRkTXV0YXRpb25CYXRjaChlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKSwgcyA9IF9fUFJJVkFURV9tdXRhdGlvbnNTdG9yZShlKTtcbiAgICAgICAgLy8gVGhlIEluZGV4ZWREYiBpbXBsZW1lbnRhdGlvbiBpbiBDaHJvbWUgKGFuZCBGaXJlZm94KSBkb2VzIG5vdCBoYW5kbGVcbiAgICAgICAgLy8gY29tcG91bmQgaW5kaWNlcyB0aGF0IGluY2x1ZGUgYXV0by1nZW5lcmF0ZWQga2V5cyBjb3JyZWN0bHkuIFRvIGVuc3VyZVxuICAgICAgICAvLyB0aGF0IHRoZSBpbmRleCBlbnRyeSBpcyBhZGRlZCBjb3JyZWN0bHkgaW4gYWxsIGJyb3dzZXJzLCB3ZSBwZXJmb3JtIHR3b1xuICAgICAgICAvLyB3cml0ZXM6IFRoZSBmaXJzdCB3cml0ZSBpcyB1c2VkIHRvIHJldHJpZXZlIHRoZSBuZXh0IGF1dG8tZ2VuZXJhdGVkIEJhdGNoXG4gICAgICAgIC8vIElELCBhbmQgdGhlIHNlY29uZCB3cml0ZSBwb3B1bGF0ZXMgdGhlIGluZGV4IGFuZCBzdG9yZXMgdGhlIGFjdHVhbFxuICAgICAgICAvLyBtdXRhdGlvbiBiYXRjaC5cbiAgICAgICAgLy8gU2VlOiBodHRwczovL2J1Z3MuY2hyb21pdW0ub3JnL3AvY2hyb21pdW0vaXNzdWVzL2RldGFpbD9pZD03MDE5NzJcbiAgICAgICAgLy8gV2Ugd3JpdGUgYW4gZW1wdHkgb2JqZWN0IHRvIG9idGFpbiBrZXlcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHMuYWRkKHt9KS5uZXh0KChvID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwibnVtYmVyXCIgPT0gdHlwZW9mIG8pO1xuICAgICAgICAgICAgY29uc3QgXyA9IG5ldyBNdXRhdGlvbkJhdGNoKG8sIHQsIG4sIHIpLCBhID0gZnVuY3Rpb24gX19QUklWQVRFX3RvRGJNdXRhdGlvbkJhdGNoKGUsIHQsIG4pIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gbi5iYXNlTXV0YXRpb25zLm1hcCgodCA9PiB0b011dGF0aW9uKGUuVHQsIHQpKSksIGkgPSBuLm11dGF0aW9ucy5tYXAoKHQgPT4gdG9NdXRhdGlvbihlLlR0LCB0KSkpO1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICAgIHVzZXJJZDogdCxcbiAgICAgICAgICAgICAgICAgICAgYmF0Y2hJZDogbi5iYXRjaElkLFxuICAgICAgICAgICAgICAgICAgICBsb2NhbFdyaXRlVGltZU1zOiBuLmxvY2FsV3JpdGVUaW1lLnRvTWlsbGlzKCksXG4gICAgICAgICAgICAgICAgICAgIGJhc2VNdXRhdGlvbnM6IHIsXG4gICAgICAgICAgICAgICAgICAgIG11dGF0aW9uczogaVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICB9KHRoaXMuc2VyaWFsaXplciwgdGhpcy51c2VySWQsIF8pLCB1ID0gW107XG4gICAgICAgICAgICBsZXQgYyA9IG5ldyBTb3J0ZWRTZXQoKChlLCB0KSA9PiBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLmNhbm9uaWNhbFN0cmluZygpLCB0LmNhbm9uaWNhbFN0cmluZygpKSkpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvbktleSh0aGlzLnVzZXJJZCwgZS5rZXkucGF0aCwgbyk7XG4gICAgICAgICAgICAgICAgYyA9IGMuYWRkKGUua2V5LnBhdGgucG9wTGFzdCgpKSwgdS5wdXNoKHMucHV0KGEpKSwgdS5wdXNoKGkucHV0KHQsIFopKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBjLmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgICAgIHUucHVzaCh0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCB0KSk7XG4gICAgICAgICAgICB9KSksIGUuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuQm5bb10gPSBfLmtleXMoKTtcbiAgICAgICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IodSkubmV4dCgoKCkgPT4gXykpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGxvb2t1cE11dGF0aW9uQmF0Y2goZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IGUgPyAoX19QUklWQVRFX2hhcmRBc3NlcnQoZS51c2VySWQgPT09IHRoaXMudXNlcklkKSwgXG4gICAgICAgIF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgZSkpIDogbnVsbCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSBkb2N1bWVudCBrZXlzIGZvciB0aGUgbXV0YXRpb24gYmF0Y2ggd2l0aCB0aGUgZ2l2ZW4gYmF0Y2hJZC5cbiAgICAgKiBGb3IgcHJpbWFyeSBjbGllbnRzLCB0aGlzIG1ldGhvZCByZXR1cm5zIGBudWxsYCBhZnRlclxuICAgICAqIGByZW1vdmVNdXRhdGlvbkJhdGNoZXMoKWAgaGFzIGJlZW4gY2FsbGVkLiBTZWNvbmRhcnkgY2xpZW50cyByZXR1cm4gYVxuICAgICAqIGNhY2hlZCByZXN1bHQgdW50aWwgYHJlbW92ZUNhY2hlZE11dGF0aW9uS2V5cygpYCBpcyBpbnZva2VkLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgTG4oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Cblt0XSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuQm5bdF0pIDogdGhpcy5sb29rdXBNdXRhdGlvbkJhdGNoKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuID0gZS5rZXlzKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuQm5bdF0gPSBuLCBuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0TmV4dE11dGF0aW9uQmF0Y2hBZnRlckJhdGNoSWQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdCArIDEsIHIgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKFsgdGhpcy51c2VySWQsIG4gXSk7XG4gICAgICAgIGxldCBpID0gbnVsbDtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvbnNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBKLFxuICAgICAgICAgICAgcmFuZ2U6IHJcbiAgICAgICAgfSwgKChlLCB0LCByKSA9PiB7XG4gICAgICAgICAgICB0LnVzZXJJZCA9PT0gdGhpcy51c2VySWQgJiYgKF9fUFJJVkFURV9oYXJkQXNzZXJ0KHQuYmF0Y2hJZCA+PSBuKSwgaSA9IF9fUFJJVkFURV9mcm9tRGJNdXRhdGlvbkJhdGNoKHRoaXMuc2VyaWFsaXplciwgdCkpLCBcbiAgICAgICAgICAgIHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gaSkpO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0VW5hY2tub3dsZWRnZWRCYXRjaElkKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IElEQktleVJhbmdlLnVwcGVyQm91bmQoWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICBsZXQgbiA9IFE7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogSixcbiAgICAgICAgICAgIHJhbmdlOiB0LFxuICAgICAgICAgICAgcmV2ZXJzZTogITBcbiAgICAgICAgfSwgKChlLCB0LCByKSA9PiB7XG4gICAgICAgICAgICBuID0gdC5iYXRjaElkLCByLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IElEQktleVJhbmdlLmJvdW5kKFsgdGhpcy51c2VySWQsIFEgXSwgWyB0aGlzLnVzZXJJZCwgTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIF0pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLkcoSiwgdCkubmV4dCgoZSA9PiBlLm1hcCgoZSA9PiBfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpKSkpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXkoZSwgdCkge1xuICAgICAgICAvLyBTY2FuIHRoZSBkb2N1bWVudC1tdXRhdGlvbiBpbmRleCBzdGFydGluZyB3aXRoIGEgcHJlZml4IHN0YXJ0aW5nIHdpdGhcbiAgICAgICAgLy8gdGhlIGdpdmVuIGRvY3VtZW50S2V5LlxuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld0RiRG9jdW1lbnRNdXRhdGlvblByZWZpeEZvclBhdGgodGhpcy51c2VySWQsIHQucGF0aCksIHIgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKG4pLCBpID0gW107XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIHJhbmdlOiByXG4gICAgICAgIH0sICgobiwgciwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgW28sIF8sIGFdID0gbiwgdSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoXyk7XG4gICAgICAgICAgICAvLyBPbmx5IGNvbnNpZGVyIHJvd3MgbWF0Y2hpbmcgZXhhY3RseSB0aGUgc3BlY2lmaWMga2V5IG9mXG4gICAgICAgICAgICAvLyBpbnRlcmVzdC4gTm90ZSB0aGF0IGJlY2F1c2Ugd2Ugb3JkZXIgYnkgcGF0aCBmaXJzdCwgYW5kIHdlXG4gICAgICAgICAgICAvLyBvcmRlciB0ZXJtaW5hdG9ycyBiZWZvcmUgcGF0aCBzZXBhcmF0b3JzLCB3ZSdsbCBlbmNvdW50ZXIgYWxsXG4gICAgICAgICAgICAvLyB0aGUgaW5kZXggcm93cyBmb3IgZG9jdW1lbnRLZXkgY29udGlndW91c2x5LiBJbiBwYXJ0aWN1bGFyLCBhbGxcbiAgICAgICAgICAgIC8vIHRoZSByb3dzIGZvciBkb2N1bWVudEtleSB3aWxsIG9jY3VyIGJlZm9yZSBhbnkgcm93cyBmb3JcbiAgICAgICAgICAgIC8vIGRvY3VtZW50cyBuZXN0ZWQgaW4gYSBzdWJjb2xsZWN0aW9uIGJlbmVhdGggZG9jdW1lbnRLZXkgc28gd2VcbiAgICAgICAgICAgIC8vIGNhbiBzdG9wIGFzIHNvb24gYXMgd2UgaGl0IGFueSBzdWNoIHJvdy5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChvID09PSB0aGlzLnVzZXJJZCAmJiB0LnBhdGguaXNFcXVhbCh1KSkgXG4gICAgICAgICAgICAvLyBMb29rIHVwIHRoZSBtdXRhdGlvbiBiYXRjaCBpbiB0aGUgc3RvcmUuXG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLmdldChhKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIWUpIHRocm93IGZhaWwoKTtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChlLnVzZXJJZCA9PT0gdGhpcy51c2VySWQpLCBpLnB1c2goX19QUklWQVRFX2Zyb21EYk11dGF0aW9uQmF0Y2godGhpcy5zZXJpYWxpemVyLCBlKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICBzLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICAgICAgY29uc3QgciA9IFtdO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0aGlzLnVzZXJJZCwgdC5wYXRoKSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQoaSksIG8gPSBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgICAgICByYW5nZTogc1xuICAgICAgICAgICAgfSwgKChlLCByLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3MsIG8sIF9dID0gZSwgYSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgobyk7XG4gICAgICAgICAgICAgICAgLy8gT25seSBjb25zaWRlciByb3dzIG1hdGNoaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmljIGtleSBvZlxuICAgICAgICAgICAgICAgIC8vIGludGVyZXN0LiBOb3RlIHRoYXQgYmVjYXVzZSB3ZSBvcmRlciBieSBwYXRoIGZpcnN0LCBhbmQgd2VcbiAgICAgICAgICAgICAgICAvLyBvcmRlciB0ZXJtaW5hdG9ycyBiZWZvcmUgcGF0aCBzZXBhcmF0b3JzLCB3ZSdsbCBlbmNvdW50ZXIgYWxsXG4gICAgICAgICAgICAgICAgLy8gdGhlIGluZGV4IHJvd3MgZm9yIGRvY3VtZW50S2V5IGNvbnRpZ3VvdXNseS4gSW4gcGFydGljdWxhciwgYWxsXG4gICAgICAgICAgICAgICAgLy8gdGhlIHJvd3MgZm9yIGRvY3VtZW50S2V5IHdpbGwgb2NjdXIgYmVmb3JlIGFueSByb3dzIGZvclxuICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50cyBuZXN0ZWQgaW4gYSBzdWJjb2xsZWN0aW9uIGJlbmVhdGggZG9jdW1lbnRLZXkgc28gd2VcbiAgICAgICAgICAgICAgICAvLyBjYW4gc3RvcCBhcyBzb29uIGFzIHdlIGhpdCBhbnkgc3VjaCByb3cuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHMgPT09IHRoaXMudXNlcklkICYmIHQucGF0aC5pc0VxdWFsKGEpID8gbiA9IG4uYWRkKF8pIDogaS5kb25lKCk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICByLnB1c2gobyk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikubmV4dCgoKCkgPT4gdGhpcy5rbihlLCBuKSkpO1xuICAgIH1cbiAgICBnZXRBbGxNdXRhdGlvbkJhdGNoZXNBZmZlY3RpbmdRdWVyeShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LnBhdGgsIHIgPSBuLmxlbmd0aCArIDEsIGkgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0aGlzLnVzZXJJZCwgbiksIHMgPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKGkpO1xuICAgICAgICAvLyBDb2xsZWN0IHVwIHVuaXF1ZSBiYXRjaElEcyBlbmNvdW50ZXJlZCBkdXJpbmcgYSBzY2FuIG9mIHRoZSBpbmRleC4gVXNlIGFcbiAgICAgICAgLy8gU29ydGVkU2V0IHRvIGFjY3VtdWxhdGUgYmF0Y2ggSURzIHNvIHRoZXkgY2FuIGJlIHRyYXZlcnNlZCBpbiBvcmRlciBpbiBhXG4gICAgICAgIC8vIHNjYW4gb2YgdGhlIG1haW4gdGFibGUuXG4gICAgICAgIGxldCBvID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRNdXRhdGlvbnNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIHJhbmdlOiBzXG4gICAgICAgIH0sICgoZSwgdCwgaSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgW3MsIF8sIGFdID0gZSwgdSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoXyk7XG4gICAgICAgICAgICBzID09PSB0aGlzLnVzZXJJZCAmJiBuLmlzUHJlZml4T2YodSkgPyBcbiAgICAgICAgICAgIC8vIFJvd3Mgd2l0aCBkb2N1bWVudCBrZXlzIG1vcmUgdGhhbiBvbmUgc2VnbWVudCBsb25nZXIgdGhhbiB0aGVcbiAgICAgICAgICAgIC8vIHF1ZXJ5IHBhdGggY2FuJ3QgYmUgbWF0Y2hlcy4gRm9yIGV4YW1wbGUsIGEgcXVlcnkgb24gJ3Jvb21zJ1xuICAgICAgICAgICAgLy8gY2FuJ3QgbWF0Y2ggdGhlIGRvY3VtZW50IC9yb29tcy9hYmMvbWVzc2FnZXMveHl4LlxuICAgICAgICAgICAgLy8gVE9ETyhtY2cpOiB3ZSdsbCBuZWVkIGEgZGlmZmVyZW50IHNjYW5uZXIgd2hlbiB3ZSBpbXBsZW1lbnRcbiAgICAgICAgICAgIC8vIGFuY2VzdG9yIHF1ZXJpZXMuXG4gICAgICAgICAgICB1Lmxlbmd0aCA9PT0gciAmJiAobyA9IG8uYWRkKGEpKSA6IGkuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdGhpcy5rbihlLCBvKSkpO1xuICAgIH1cbiAgICBrbihlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBbXSwgciA9IFtdO1xuICAgICAgICAvLyBUT0RPKHJvY2t3b29kKTogSW1wbGVtZW50IHRoaXMgdXNpbmcgaXRlcmF0ZS5cbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICByLnB1c2goX19QUklWQVRFX211dGF0aW9uc1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBpZiAobnVsbCA9PT0gZSkgdGhyb3cgZmFpbCgpO1xuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KGUudXNlcklkID09PSB0aGlzLnVzZXJJZCksIG4ucHVzaChfX1BSSVZBVEVfZnJvbURiTXV0YXRpb25CYXRjaCh0aGlzLnNlcmlhbGl6ZXIsIGUpKTtcbiAgICAgICAgICAgIH0pKSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IocikubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICByZW1vdmVNdXRhdGlvbkJhdGNoKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHJlbW92ZU11dGF0aW9uQmF0Y2goZS51ZSwgdGhpcy51c2VySWQsIHQpLm5leHQoKG4gPT4gKGUuYWRkT25Db21taXR0ZWRMaXN0ZW5lcigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5xbih0LmJhdGNoSWQpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKG4sICh0ID0+IHRoaXMucmVmZXJlbmNlRGVsZWdhdGUubWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkpKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIHRoZSBjYWNoZWQga2V5cyBmb3IgYSBtdXRhdGlvbiBiYXRjaC4gVGhpcyBtZXRob2Qgc2hvdWxkIGJlXG4gICAgICogY2FsbGVkIGJ5IHNlY29uZGFyeSBjbGllbnRzIGFmdGVyIHRoZXkgcHJvY2VzcyBtdXRhdGlvbiB1cGRhdGVzLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgbWV0aG9kIGRvZXMgbm90IGhhdmUgdG8gYmUgY2FsbGVkIGZyb20gcHJpbWFyeSBjbGllbnRzIGFzXG4gICAgICogdGhlIGNvcnJlc3BvbmRpbmcgY2FjaGUgZW50cmllcyBhcmUgY2xlYXJlZCB3aGVuIGFuIGFja25vd2xlZGdlZCBvclxuICAgICAqIHJlamVjdGVkIGJhdGNoIGlzIHJlbW92ZWQgZnJvbSB0aGUgbXV0YXRpb24gcXVldWUuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seVxuICAgIHFuKGUpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuQm5bZV07XG4gICAgfVxuICAgIHBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hlY2tFbXB0eShlKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICghdCkgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgICAgICAvLyBWZXJpZnkgdGhhdCB0aGVyZSBhcmUgbm8gZW50cmllcyBpbiB0aGUgZG9jdW1lbnRNdXRhdGlvbnMgaW5kZXggaWZcbiAgICAgICAgICAgIC8vIHRoZSBxdWV1ZSBpcyBlbXB0eS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5sb3dlckJvdW5kKFxuICAgICAgICAgICAgLyoqXG4gKiBDcmVhdGVzIGEgW3VzZXJJZF0ga2V5IGZvciB1c2UgaW4gdGhlIERiRG9jdW1lbnRNdXRhdGlvbnMgaW5kZXggdG8gaXRlcmF0ZVxuICogb3ZlciBhbGwgb2YgYSB1c2VyJ3MgZG9jdW1lbnQgbXV0YXRpb25zLlxuICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yVXNlcihlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFsgZSBdO1xuICAgICAgICAgICAgfSh0aGlzLnVzZXJJZCkpLCByID0gW107XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSkuWih7XG4gICAgICAgICAgICAgICAgcmFuZ2U6IG5cbiAgICAgICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChlWzBdID09PSB0aGlzLnVzZXJJZCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChlWzFdKTtcbiAgICAgICAgICAgICAgICAgICAgci5wdXNoKHQpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBuLmRvbmUoKTtcbiAgICAgICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoMCA9PT0gci5sZW5ndGgpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlQ29udGFpbnNLZXkoZSwgdGhpcy51c2VySWQsIHQpO1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLXRhYiBvbmx5IChzdGF0ZSBpcyBoZWxkIGluIG1lbW9yeSBpbiBvdGhlciBjbGllbnRzKS5cbiAgICAvKiogUmV0dXJucyB0aGUgbXV0YXRpb24gcXVldWUncyBtZXRhZGF0YSBmcm9tIEluZGV4ZWREYi4gKi9cbiAgICBRbihlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZXNTdG9yZShlKS5nZXQodGhpcy51c2VySWQpLm5leHQoKGUgPT4gZSB8fCB7XG4gICAgICAgICAgICB1c2VySWQ6IHRoaXMudXNlcklkLFxuICAgICAgICAgICAgbGFzdEFja25vd2xlZGdlZEJhdGNoSWQ6IFEsXG4gICAgICAgICAgICBsYXN0U3RyZWFtVG9rZW46IFwiXCJcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBtdXRhdGlvbiBxdWV1ZSBmb3IgdGhlIGdpdmVuIHVzZXIgY29udGFpbnMgYSBwZW5kaW5nXG4gKiAgICAgICAgIG11dGF0aW9uIGZvciB0aGUgZ2l2ZW4ga2V5LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlQ29udGFpbnNLZXkoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3RGJEb2N1bWVudE11dGF0aW9uUHJlZml4Rm9yUGF0aCh0LCBuLnBhdGgpLCBpID0gclsxXSwgcyA9IElEQktleVJhbmdlLmxvd2VyQm91bmQocik7XG4gICAgbGV0IG8gPSAhMTtcbiAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSkuWih7XG4gICAgICAgIHJhbmdlOiBzLFxuICAgICAgICBZOiAhMFxuICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICBjb25zdCBbcywgXywgLypiYXRjaElEKi8gYV0gPSBlO1xuICAgICAgICBzID09PSB0ICYmIF8gPT09IGkgJiYgKG8gPSAhMCksIHIuZG9uZSgpO1xuICAgIH0pKS5uZXh0KCgoKSA9PiBvKSk7XG59XG5cbi8qKiBSZXR1cm5zIHRydWUgaWYgYW55IG11dGF0aW9uIHF1ZXVlIGNvbnRhaW5zIHRoZSBnaXZlbiBkb2N1bWVudC4gKi9cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvbnMgb2JqZWN0IHN0b3JlLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbXV0YXRpb25zU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgaik7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvblF1ZXVlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2RvY3VtZW50TXV0YXRpb25zU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgWCk7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBtdXRhdGlvblF1ZXVlcyBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX211dGF0aW9uUXVldWVzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgRyk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogT2Zmc2V0IHRvIGVuc3VyZSBub24tb3ZlcmxhcHBpbmcgdGFyZ2V0IGlkcy4gKi9cbi8qKlxuICogR2VuZXJhdGVzIG1vbm90b25pY2FsbHkgaW5jcmVhc2luZyB0YXJnZXQgSURzIGZvciBzZW5kaW5nIHRhcmdldHMgdG8gdGhlXG4gKiB3YXRjaCBzdHJlYW0uXG4gKlxuICogVGhlIGNsaWVudCBjb25zdHJ1Y3RzIHR3byBnZW5lcmF0b3JzLCBvbmUgZm9yIHRoZSB0YXJnZXQgY2FjaGUsIGFuZCBvbmUgZm9yXG4gKiBmb3IgdGhlIHN5bmMgZW5naW5lICh0byBnZW5lcmF0ZSBsaW1ibyBkb2N1bWVudHMgdGFyZ2V0cykuIFRoZXNlXG4gKiBnZW5lcmF0b3JzIHByb2R1Y2Ugbm9uLW92ZXJsYXBwaW5nIElEcyAoYnkgdXNpbmcgZXZlbiBhbmQgb2RkIElEc1xuICogcmVzcGVjdGl2ZWx5KS5cbiAqXG4gKiBCeSBzZXBhcmF0aW5nIHRoZSB0YXJnZXQgSUQgc3BhY2UsIHRoZSBxdWVyeSBjYWNoZSBjYW4gZ2VuZXJhdGUgdGFyZ2V0IElEc1xuICogdGhhdCBwZXJzaXN0IGFjcm9zcyBjbGllbnQgcmVzdGFydHMsIHdoaWxlIHN5bmMgZW5naW5lIGNhbiBpbmRlcGVuZGVudGx5XG4gKiBnZW5lcmF0ZSBpbi1tZW1vcnkgdGFyZ2V0IElEcyB0aGF0IGFyZSB0cmFuc2llbnQgYW5kIGNhbiBiZSByZXVzZWQgYWZ0ZXIgYVxuICogcmVzdGFydC5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1RhcmdldElkR2VuZXJhdG9yIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuJG4gPSBlO1xuICAgIH1cbiAgICBuZXh0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kbiArPSAyLCB0aGlzLiRuO1xuICAgIH1cbiAgICBzdGF0aWMgVW4oKSB7XG4gICAgICAgIC8vIFRoZSB0YXJnZXQgY2FjaGUgZ2VuZXJhdG9yIG11c3QgcmV0dXJuICcyJyBpbiBpdHMgZmlyc3QgY2FsbCB0byBgbmV4dCgpYFxuICAgICAgICAvLyBhcyB0aGVyZSBpcyBubyBkaWZmZXJlbnRpYXRpb24gaW4gdGhlIHByb3RvY29sIGxheWVyIGJldHdlZW4gYW4gdW5zZXRcbiAgICAgICAgLy8gbnVtYmVyIGFuZCB0aGUgbnVtYmVyICcwJy4gSWYgd2Ugd2VyZSB0byBzZW50IGEgdGFyZ2V0IHdpdGggdGFyZ2V0IElEXG4gICAgICAgIC8vICcwJywgdGhlIGJhY2tlbmQgd291bGQgY29uc2lkZXIgaXQgdW5zZXQgYW5kIHJlcGxhY2UgaXQgd2l0aCBpdHMgb3duIElELlxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvcigwKTtcbiAgICB9XG4gICAgc3RhdGljIEtuKCkge1xuICAgICAgICAvLyBTeW5jIGVuZ2luZSBhc3NpZ25zIHRhcmdldCBJRHMgZm9yIGxpbWJvIGRvY3VtZW50IGRldGVjdGlvbi5cbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3IoLTEpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlRhcmdldENhY2hlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMucmVmZXJlbmNlRGVsZWdhdGUgPSBlLCB0aGlzLnNlcmlhbGl6ZXIgPSB0O1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IFdlIGRvbid0IGNhY2hlIGdsb2JhbCBtZXRhZGF0YSBmb3IgdGhlIHRhcmdldCBjYWNoZSwgc2luY2VcbiAgICAvLyBzb21lIG9mIGl0IChpbiBwYXJ0aWN1bGFyIGBoaWdoZXN0VGFyZ2V0SWRgKSBjYW4gYmUgbW9kaWZpZWQgYnkgc2Vjb25kYXJ5XG4gICAgLy8gdGFicy4gV2UgY291bGQgcGVyaGFwcyBiZSBtb3JlIGdyYW51bGFyIChhbmQgZS5nLiBzdGlsbCBjYWNoZVxuICAgIC8vIGBsYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uYCBpbiBtZW1vcnkpIGJ1dCBmb3Igc2ltcGxpY2l0eSB3ZSBjdXJyZW50bHkgZ29cbiAgICAvLyB0byBJbmRleGVkRGIgd2hlbmV2ZXIgd2UgbmVlZCB0byByZWFkIG1ldGFkYXRhLiBXZSBjYW4gcmV2aXNpdCBpZiBpdCB0dXJuc1xuICAgIC8vIG91dCB0byBoYXZlIGEgbWVhbmluZ2Z1bCBwZXJmb3JtYW5jZSBpbXBhY3QuXG4gICAgYWxsb2NhdGVUYXJnZXRJZChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlduKGUpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3IodC5oaWdoZXN0VGFyZ2V0SWQpO1xuICAgICAgICAgICAgcmV0dXJuIHQuaGlnaGVzdFRhcmdldElkID0gbi5uZXh0KCksIHRoaXMuR24oZSwgdCkubmV4dCgoKCkgPT4gdC5oaWdoZXN0VGFyZ2V0SWQpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBnZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuV24oZSkubmV4dCgoZSA9PiBTbmFwc2hvdFZlcnNpb24uZnJvbVRpbWVzdGFtcChuZXcgVGltZXN0YW1wKGUubGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbi5zZWNvbmRzLCBlLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24ubmFub3NlY29uZHMpKSkpO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0U2VxdWVuY2VOdW1iZXIoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5XbihlKS5uZXh0KChlID0+IGUuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyKSk7XG4gICAgfVxuICAgIHNldFRhcmdldHNNZXRhZGF0YShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlduKGUpLm5leHQoKHIgPT4gKHIuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyID0gdCwgbiAmJiAoci5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gbi50b1RpbWVzdGFtcCgpKSwgXG4gICAgICAgIHQgPiByLmhpZ2hlc3RMaXN0ZW5TZXF1ZW5jZU51bWJlciAmJiAoci5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgPSB0KSwgdGhpcy5HbihlLCByKSkpKTtcbiAgICB9XG4gICAgYWRkVGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnpuKGUsIHQpLm5leHQoKCgpID0+IHRoaXMuV24oZSkubmV4dCgobiA9PiAobi50YXJnZXRDb3VudCArPSAxLCB0aGlzLmpuKHQsIG4pLCBcbiAgICAgICAgdGhpcy5HbihlLCBuKSkpKSkpO1xuICAgIH1cbiAgICB1cGRhdGVUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuem4oZSwgdCk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0LnRhcmdldElkKS5uZXh0KCgoKSA9PiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpLmRlbGV0ZSh0LnRhcmdldElkKSkpLm5leHQoKCgpID0+IHRoaXMuV24oZSkpKS5uZXh0KCh0ID0+IChfX1BSSVZBVEVfaGFyZEFzc2VydCh0LnRhcmdldENvdW50ID4gMCksIFxuICAgICAgICB0LnRhcmdldENvdW50IC09IDEsIHRoaXMuR24oZSwgdCkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERyb3BzIGFueSB0YXJnZXRzIHdpdGggc2VxdWVuY2UgbnVtYmVyIGxlc3MgdGhhbiBvciBlcXVhbCB0byB0aGUgdXBwZXIgYm91bmQsIGV4Y2VwdGluZyB0aG9zZVxuICAgICAqIHByZXNlbnQgaW4gYGFjdGl2ZVRhcmdldElkc2AuIERvY3VtZW50IGFzc29jaWF0aW9ucyBmb3IgdGhlIHJlbW92ZWQgdGFyZ2V0cyBhcmUgYWxzbyByZW1vdmVkLlxuICAgICAqIFJldHVybnMgdGhlIG51bWJlciBvZiB0YXJnZXRzIHJlbW92ZWQuXG4gICAgICovICAgIHJlbW92ZVRhcmdldHMoZSwgdCwgbikge1xuICAgICAgICBsZXQgciA9IDA7XG4gICAgICAgIGNvbnN0IGkgPSBbXTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV90YXJnZXRzU3RvcmUoZSkuWigoKHMsIG8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfZnJvbURiVGFyZ2V0KG8pO1xuICAgICAgICAgICAgXy5zZXF1ZW5jZU51bWJlciA8PSB0ICYmIG51bGwgPT09IG4uZ2V0KF8udGFyZ2V0SWQpICYmIChyKyssIGkucHVzaCh0aGlzLnJlbW92ZVRhcmdldERhdGEoZSwgXykpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKGkpKSkubmV4dCgoKCkgPT4gcikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIHByb3ZpZGVkIGZ1bmN0aW9uIHdpdGggZWFjaCBgVGFyZ2V0RGF0YWAgdGhhdCB3ZSBoYXZlIGNhY2hlZC5cbiAgICAgKi8gICAgZm9yRWFjaFRhcmdldChlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpLlooKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2Zyb21EYlRhcmdldChuKTtcbiAgICAgICAgICAgIHQocik7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgV24oZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2dsb2JhbFRhcmdldFN0b3JlKGUpLmdldChJZSkubmV4dCgoZSA9PiAoX19QUklWQVRFX2hhcmRBc3NlcnQobnVsbCAhPT0gZSksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICBHbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZ2xvYmFsVGFyZ2V0U3RvcmUoZSkucHV0KEllLCB0KTtcbiAgICB9XG4gICAgem4oZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5wdXQoX19QUklWQVRFX3RvRGJUYXJnZXQodGhpcy5zZXJpYWxpemVyLCB0KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEluLXBsYWNlIHVwZGF0ZXMgdGhlIHByb3ZpZGVkIG1ldGFkYXRhIHRvIGFjY291bnQgZm9yIHZhbHVlcyBpbiB0aGUgZ2l2ZW5cbiAgICAgKiBUYXJnZXREYXRhLiBTYXZpbmcgaXMgZG9uZSBzZXBhcmF0ZWx5LiBSZXR1cm5zIHRydWUgaWYgdGhlcmUgd2VyZSBhbnlcbiAgICAgKiBjaGFuZ2VzIHRvIHRoZSBtZXRhZGF0YS5cbiAgICAgKi8gICAgam4oZSwgdCkge1xuICAgICAgICBsZXQgbiA9ICExO1xuICAgICAgICByZXR1cm4gZS50YXJnZXRJZCA+IHQuaGlnaGVzdFRhcmdldElkICYmICh0LmhpZ2hlc3RUYXJnZXRJZCA9IGUudGFyZ2V0SWQsIG4gPSAhMCksIFxuICAgICAgICBlLnNlcXVlbmNlTnVtYmVyID4gdC5oaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXIgJiYgKHQuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyID0gZS5zZXF1ZW5jZU51bWJlciwgXG4gICAgICAgIG4gPSAhMCksIG47XG4gICAgfVxuICAgIGdldFRhcmdldENvdW50KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuV24oZSkubmV4dCgoZSA9PiBlLnRhcmdldENvdW50KSk7XG4gICAgfVxuICAgIGdldFRhcmdldERhdGEoZSwgdCkge1xuICAgICAgICAvLyBJdGVyYXRpbmcgYnkgdGhlIGNhbm9uaWNhbElkIG1heSB5aWVsZCBtb3JlIHRoYW4gb25lIHJlc3VsdCBiZWNhdXNlXG4gICAgICAgIC8vIGNhbm9uaWNhbElkIHZhbHVlcyBhcmUgbm90IHJlcXVpcmVkIHRvIGJlIHVuaXF1ZSBwZXIgdGFyZ2V0LiBUaGlzIHF1ZXJ5XG4gICAgICAgIC8vIGRlcGVuZHMgb24gdGhlIHF1ZXJ5VGFyZ2V0cyBpbmRleCB0byBiZSBlZmZpY2llbnQuXG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQodCksIHIgPSBJREJLZXlSYW5nZS5ib3VuZChbIG4sIE51bWJlci5ORUdBVElWRV9JTkZJTklUWSBdLCBbIG4sIE51bWJlci5QT1NJVElWRV9JTkZJTklUWSBdKTtcbiAgICAgICAgbGV0IGkgPSBudWxsO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3RhcmdldHNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIHJhbmdlOiByLFxuICAgICAgICAgICAgaW5kZXg6IHVlXG4gICAgICAgIH0sICgoZSwgbiwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9mcm9tRGJUYXJnZXQobik7XG4gICAgICAgICAgICAvLyBBZnRlciBmaW5kaW5nIGEgcG90ZW50aWFsIG1hdGNoLCBjaGVjayB0aGF0IHRoZSB0YXJnZXQgaXNcbiAgICAgICAgICAgIC8vIGFjdHVhbGx5IGVxdWFsIHRvIHRoZSByZXF1ZXN0ZWQgdGFyZ2V0LlxuICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX3RhcmdldEVxdWFscyh0LCBzLnRhcmdldCkgJiYgKGkgPSBzLCByLmRvbmUoKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGFkZE1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIHJldmVyc2UgaW5kZXggKGRvY3VtZW50c1RhcmdldHMpIGlzIG1haW50YWluZWQgYnlcbiAgICAgICAgLy8gSW5kZXhlZERiLlxuICAgICAgICBjb25zdCByID0gW10sIGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0LnBhdGgpO1xuICAgICAgICAgICAgci5wdXNoKGkucHV0KHtcbiAgICAgICAgICAgICAgICB0YXJnZXRJZDogbixcbiAgICAgICAgICAgICAgICBwYXRoOiBzXG4gICAgICAgICAgICB9KSksIHIucHVzaCh0aGlzLnJlZmVyZW5jZURlbGVnYXRlLmFkZFJlZmVyZW5jZShlLCBuLCB0KSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3Iocik7XG4gICAgfVxuICAgIHJlbW92ZU1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIHJldmVyc2UgaW5kZXggKGRvY3VtZW50c1RhcmdldHMpIGlzIG1haW50YWluZWQgYnlcbiAgICAgICAgLy8gSW5kZXhlZERiLlxuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2RvY3VtZW50VGFyZ2V0U3RvcmUoZSk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LCAodCA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aCh0LnBhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKFsgci5kZWxldGUoWyBuLCBpIF0pLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVJlZmVyZW5jZShlLCBuLCB0KSBdKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdCBdLCBbIHQgKyAxIF0sIFxuICAgICAgICAvKmxvd2VyT3Blbj0qLyAhMSwgXG4gICAgICAgIC8qdXBwZXJPcGVuPSovICEwKTtcbiAgICAgICAgcmV0dXJuIG4uZGVsZXRlKHIpO1xuICAgIH1cbiAgICBnZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBJREJLZXlSYW5nZS5ib3VuZChbIHQgXSwgWyB0ICsgMSBdLCBcbiAgICAgICAgLypsb3dlck9wZW49Ki8gITEsIFxuICAgICAgICAvKnVwcGVyT3Blbj0qLyAhMCksIHIgPSBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKTtcbiAgICAgICAgbGV0IGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgcmV0dXJuIHIuWih7XG4gICAgICAgICAgICByYW5nZTogbixcbiAgICAgICAgICAgIFk6ICEwXG4gICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgoZVsxXSksIHMgPSBuZXcgRG9jdW1lbnRLZXkocik7XG4gICAgICAgICAgICBpID0gaS5hZGQocyk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpKSk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgodC5wYXRoKSwgciA9IElEQktleVJhbmdlLmJvdW5kKFsgbiBdLCBbIF9fUFJJVkFURV9pbW1lZGlhdGVTdWNjZXNzb3IobikgXSwgXG4gICAgICAgIC8qbG93ZXJPcGVuPSovICExLCBcbiAgICAgICAgLyp1cHBlck9wZW49Ki8gITApO1xuICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBQZSxcbiAgICAgICAgICAgIFk6ICEwLFxuICAgICAgICAgICAgcmFuZ2U6IHJcbiAgICAgICAgfSwgKChbZSwgdF0sIG4sIHIpID0+IHtcbiAgICAgICAgICAgIC8vIEhhdmluZyBhIHNlbnRpbmVsIHJvdyBmb3IgYSBkb2N1bWVudCBkb2VzIG5vdCBjb3VudCBhcyBjb250YWluaW5nIHRoYXQgZG9jdW1lbnQ7XG4gICAgICAgICAgICAvLyBGb3IgdGhlIHRhcmdldCBjYWNoZSwgY29udGFpbmluZyB0aGUgZG9jdW1lbnQgbWVhbnMgdGhlIGRvY3VtZW50IGlzIHBhcnQgb2Ygc29tZVxuICAgICAgICAgICAgLy8gdGFyZ2V0LlxuICAgICAgICAgICAgMCAhPT0gZSAmJiAoaSsrLCByLmRvbmUoKSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBpID4gMCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhIFRhcmdldERhdGEgZW50cnkgYnkgdGFyZ2V0IElELlxuICAgICAqXG4gICAgICogQHBhcmFtIHRhcmdldElkIC0gVGhlIHRhcmdldCBJRCBvZiB0aGUgVGFyZ2V0RGF0YSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgVGFyZ2V0RGF0YSBlbnRyeSwgb3IgbnVsbCBpZiB0aGUgY2FjaGUgaGFzIG5vIGVudHJ5IGZvclxuICAgICAqIHRoZSB0YXJnZXQuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBsdChlLCB0KSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdGFyZ2V0c1N0b3JlKGUpLmdldCh0KS5uZXh0KChlID0+IGUgPyBfX1BSSVZBVEVfZnJvbURiVGFyZ2V0KGUpIDogbnVsbCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIHF1ZXJpZXMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV90YXJnZXRzU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgYWUpO1xufVxuXG4vKipcbiAqIEhlbHBlciB0byBnZXQgYSB0eXBlZCBTaW1wbGVEYlN0b3JlIGZvciB0aGUgdGFyZ2V0IGdsb2JhbHMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9nbG9iYWxUYXJnZXRTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBFZSk7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBkb2N1bWVudCB0YXJnZXQgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9kb2N1bWVudFRhcmdldFN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2dldFN0b3JlKGUsIGxlKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgYnQgPSBcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgRHQgPSAxMDQ4NTc2O1xuXG5mdW5jdGlvbiBfX1BSSVZBVEVfYnVmZmVyRW50cnlDb21wYXJhdG9yKFtlLCB0XSwgW24sIHJdKSB7XG4gICAgY29uc3QgaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUsIG4pO1xuICAgIHJldHVybiAwID09PSBpID8gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IodCwgcikgOiBpO1xufVxuXG4vKipcbiAqIFVzZWQgdG8gY2FsY3VsYXRlIHRoZSBudGggc2VxdWVuY2UgbnVtYmVyLiBLZWVwcyBhIHJvbGxpbmcgYnVmZmVyIG9mIHRoZVxuICogbG93ZXN0IG4gdmFsdWVzIHBhc3NlZCB0byBgYWRkRWxlbWVudGAsIGFuZCBmaW5hbGx5IHJlcG9ydHMgdGhlIGxhcmdlc3Qgb2ZcbiAqIHRoZW0gaW4gYG1heFZhbHVlYC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUm9sbGluZ1NlcXVlbmNlTnVtYmVyQnVmZmVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuSG4gPSBlLCB0aGlzLmJ1ZmZlciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX2J1ZmZlckVudHJ5Q29tcGFyYXRvciksIHRoaXMuSm4gPSAwO1xuICAgIH1cbiAgICBZbigpIHtcbiAgICAgICAgcmV0dXJuICsrdGhpcy5KbjtcbiAgICB9XG4gICAgWm4oZSkge1xuICAgICAgICBjb25zdCB0ID0gWyBlLCB0aGlzLlluKCkgXTtcbiAgICAgICAgaWYgKHRoaXMuYnVmZmVyLnNpemUgPCB0aGlzLkhuKSB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLmFkZCh0KTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gdGhpcy5idWZmZXIubGFzdCgpO1xuICAgICAgICAgICAgX19QUklWQVRFX2J1ZmZlckVudHJ5Q29tcGFyYXRvcih0LCBlKSA8IDAgJiYgKHRoaXMuYnVmZmVyID0gdGhpcy5idWZmZXIuZGVsZXRlKGUpLmFkZCh0KSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0IG1heFZhbHVlKCkge1xuICAgICAgICAvLyBHdWFyYW50ZWVkIHRvIGJlIG5vbi1lbXB0eS4gSWYgd2UgZGVjaWRlIHdlIGFyZSBub3QgY29sbGVjdGluZyBhbnlcbiAgICAgICAgLy8gc2VxdWVuY2UgbnVtYmVycywgbnRoU2VxdWVuY2VOdW1iZXIgYmVsb3cgc2hvcnQtY2lyY3VpdHMuIElmIHdlIGhhdmVcbiAgICAgICAgLy8gZGVjaWRlZCB0aGF0IHdlIGFyZSBjb2xsZWN0aW5nIG4gc2VxdWVuY2UgbnVtYmVycywgaXQncyBiZWNhdXNlIG4gaXMgc29tZVxuICAgICAgICAvLyBwZXJjZW50YWdlIG9mIHRoZSBleGlzdGluZyBzZXF1ZW5jZSBudW1iZXJzLiBUaGF0IG1lYW5zIHdlIHNob3VsZCBuZXZlclxuICAgICAgICAvLyBiZSBpbiBhIHNpdHVhdGlvbiB3aGVyZSB3ZSBhcmUgY29sbGVjdGluZyBzZXF1ZW5jZSBudW1iZXJzIGJ1dCBkb24ndFxuICAgICAgICAvLyBhY3R1YWxseSBoYXZlIGFueS5cbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLmxhc3QoKVswXTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyBpcyByZXNwb25zaWJsZSBmb3IgdGhlIHNjaGVkdWxpbmcgb2YgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbi4gSXQgaGFuZGxlcyBjaGVja2luZ1xuICogd2hldGhlciBvciBub3QgR0MgaXMgZW5hYmxlZCwgYXMgd2VsbCBhcyB3aGljaCBkZWxheSB0byB1c2UgYmVmb3JlIHRoZSBuZXh0IHJ1bi5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTHJ1U2NoZWR1bGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IGUsIHRoaXMuYXN5bmNRdWV1ZSA9IHQsIHRoaXMubG9jYWxTdG9yZSA9IG4sIHRoaXMuWG4gPSBudWxsO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgLTEgIT09IHRoaXMuZ2FyYmFnZUNvbGxlY3Rvci5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCAmJiB0aGlzLmVyKDZlNCk7XG4gICAgfVxuICAgIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuWG4gJiYgKHRoaXMuWG4uY2FuY2VsKCksIHRoaXMuWG4gPSBudWxsKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9PSB0aGlzLlhuO1xuICAgIH1cbiAgICBlcihlKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhidCwgYEdhcmJhZ2UgY29sbGVjdGlvbiBzY2hlZHVsZWQgaW4gJHtlfW1zYCksIHRoaXMuWG4gPSB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFmdGVyRGVsYXkoXCJscnVfZ2FyYmFnZV9jb2xsZWN0aW9uXCIgLyogVGltZXJJZC5McnVHYXJiYWdlQ29sbGVjdGlvbiAqLyAsIGUsIChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLlhuID0gbnVsbDtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgYXdhaXQgdGhpcy5sb2NhbFN0b3JlLmNvbGxlY3RHYXJiYWdlKHRoaXMuZ2FyYmFnZUNvbGxlY3Rvcik7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSA/IF9fUFJJVkFURV9sb2dEZWJ1ZyhidCwgXCJJZ25vcmluZyBJbmRleGVkREIgZXJyb3IgZHVyaW5nIGdhcmJhZ2UgY29sbGVjdGlvbjogXCIsIGUpIDogYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGF3YWl0IHRoaXMuZXIoM2U1KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbXBsZW1lbnRzIHRoZSBzdGVwcyBmb3IgTFJVIGdhcmJhZ2UgY29sbGVjdGlvbi5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTHJ1R2FyYmFnZUNvbGxlY3RvckltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy50ciA9IGUsIHRoaXMucGFyYW1zID0gdDtcbiAgICB9XG4gICAgY2FsY3VsYXRlVGFyZ2V0Q291bnQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ci5ucihlKS5uZXh0KChlID0+IE1hdGguZmxvb3IodCAvIDEwMCAqIGUpKSk7XG4gICAgfVxuICAgIG50aFNlcXVlbmNlTnVtYmVyKGUsIHQpIHtcbiAgICAgICAgaWYgKDAgPT09IHQpIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUpO1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9Sb2xsaW5nU2VxdWVuY2VOdW1iZXJCdWZmZXIodCk7XG4gICAgICAgIHJldHVybiB0aGlzLnRyLmZvckVhY2hUYXJnZXQoZSwgKGUgPT4gbi5abihlLnNlcXVlbmNlTnVtYmVyKSkpLm5leHQoKCgpID0+IHRoaXMudHIucnIoZSwgKGUgPT4gbi5abihlKSkpKSkubmV4dCgoKCkgPT4gbi5tYXhWYWx1ZSkpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXRzKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHIucmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKTtcbiAgICB9XG4gICAgcmVtb3ZlT3JwaGFuZWREb2N1bWVudHMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy50ci5yZW1vdmVPcnBoYW5lZERvY3VtZW50cyhlLCB0KTtcbiAgICB9XG4gICAgY29sbGVjdChlLCB0KSB7XG4gICAgICAgIHJldHVybiAtMSA9PT0gdGhpcy5wYXJhbXMuY2FjaGVTaXplQ29sbGVjdGlvblRocmVzaG9sZCA/IChfX1BSSVZBVEVfbG9nRGVidWcoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIFwiR2FyYmFnZSBjb2xsZWN0aW9uIHNraXBwZWQ7IGRpc2FibGVkXCIpLCBcbiAgICAgICAgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUod3QpKSA6IHRoaXMuZ2V0Q2FjaGVTaXplKGUpLm5leHQoKG4gPT4gbiA8IHRoaXMucGFyYW1zLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGQgPyAoX19QUklWQVRFX2xvZ0RlYnVnKFwiTHJ1R2FyYmFnZUNvbGxlY3RvclwiLCBgR2FyYmFnZSBjb2xsZWN0aW9uIHNraXBwZWQ7IENhY2hlIHNpemUgJHtufSBpcyBsb3dlciB0aGFuIHRocmVzaG9sZCAke3RoaXMucGFyYW1zLmNhY2hlU2l6ZUNvbGxlY3Rpb25UaHJlc2hvbGR9YCksIFxuICAgICAgICB3dCkgOiB0aGlzLmlyKGUsIHQpKSk7XG4gICAgfVxuICAgIGdldENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRyLmdldENhY2hlU2l6ZShlKTtcbiAgICB9XG4gICAgaXIoZSwgdCkge1xuICAgICAgICBsZXQgbiwgciwgaSwgcywgbywgXywgdTtcbiAgICAgICAgY29uc3QgYyA9IERhdGUubm93KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZVRhcmdldENvdW50KGUsIHRoaXMucGFyYW1zLnBlcmNlbnRpbGVUb0NvbGxlY3QpLm5leHQoKHQgPT4gKFxuICAgICAgICAvLyBDYXAgYXQgdGhlIGNvbmZpZ3VyZWQgbWF4XG4gICAgICAgIHQgPiB0aGlzLnBhcmFtcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0ID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhcIkxydUdhcmJhZ2VDb2xsZWN0b3JcIiwgYENhcHBpbmcgc2VxdWVuY2UgbnVtYmVycyB0byBjb2xsZWN0IGRvd24gdG8gdGhlIG1heGltdW0gb2YgJHt0aGlzLnBhcmFtcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0fSBmcm9tICR7dH1gKSwgXG4gICAgICAgIHIgPSB0aGlzLnBhcmFtcy5tYXhpbXVtU2VxdWVuY2VOdW1iZXJzVG9Db2xsZWN0KSA6IHIgPSB0LCBzID0gRGF0ZS5ub3coKSwgdGhpcy5udGhTZXF1ZW5jZU51bWJlcihlLCByKSkpKS5uZXh0KChyID0+IChuID0gciwgXG4gICAgICAgIG8gPSBEYXRlLm5vdygpLCB0aGlzLnJlbW92ZVRhcmdldHMoZSwgbiwgdCkpKSkubmV4dCgodCA9PiAoaSA9IHQsIF8gPSBEYXRlLm5vdygpLCBcbiAgICAgICAgdGhpcy5yZW1vdmVPcnBoYW5lZERvY3VtZW50cyhlLCBuKSkpKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGlmICh1ID0gRGF0ZS5ub3coKSwgX19QUklWQVRFX2dldExvZ0xldmVsKCkgPD0gTG9nTGV2ZWwuREVCVUcpIHtcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJMcnVHYXJiYWdlQ29sbGVjdG9yXCIsIGBMUlUgR2FyYmFnZSBDb2xsZWN0aW9uXFxuXFx0Q291bnRlZCB0YXJnZXRzIGluICR7cyAtIGN9bXNcXG5cXHREZXRlcm1pbmVkIGxlYXN0IHJlY2VudGx5IHVzZWQgJHtyfSBpbiBgICsgKG8gLSBzKSArIFwibXNcXG5cIiArIGBcXHRSZW1vdmVkICR7aX0gdGFyZ2V0cyBpbiBgICsgKF8gLSBvKSArIFwibXNcXG5cIiArIGBcXHRSZW1vdmVkICR7ZX0gZG9jdW1lbnRzIGluIGAgKyAodSAtIF8pICsgXCJtc1xcblwiICsgYFRvdGFsIER1cmF0aW9uOiAke3UgLSBjfW1zYCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoe1xuICAgICAgICAgICAgICAgIGRpZFJ1bjogITAsXG4gICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXJzQ29sbGVjdGVkOiByLFxuICAgICAgICAgICAgICAgIHRhcmdldHNSZW1vdmVkOiBpLFxuICAgICAgICAgICAgICAgIGRvY3VtZW50c1JlbW92ZWQ6IGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3THJ1R2FyYmFnZUNvbGxlY3RvcihlLCB0KSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTHJ1R2FyYmFnZUNvbGxlY3RvckltcGwoZSwgdCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogUHJvdmlkZXMgTFJVIGZ1bmN0aW9uYWxpdHkgZm9yIEluZGV4ZWREQiBwZXJzaXN0ZW5jZS4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYkxydURlbGVnYXRlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLmRiID0gZSwgdGhpcy5nYXJiYWdlQ29sbGVjdG9yID0gX19QUklWQVRFX25ld0xydUdhcmJhZ2VDb2xsZWN0b3IodGhpcywgdCk7XG4gICAgfVxuICAgIG5yKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuc3IoZSk7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFRhcmdldENhY2hlKCkuZ2V0VGFyZ2V0Q291bnQoZSkubmV4dCgoZSA9PiB0Lm5leHQoKHQgPT4gZSArIHQpKSkpO1xuICAgIH1cbiAgICBzcihlKSB7XG4gICAgICAgIGxldCB0ID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXMucnIoZSwgKGUgPT4ge1xuICAgICAgICAgICAgdCsrO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gdCkpO1xuICAgIH1cbiAgICBmb3JFYWNoVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS5mb3JFYWNoVGFyZ2V0KGUsIHQpO1xuICAgIH1cbiAgICBycihlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9yKGUsICgoZSwgbikgPT4gdChuKSkpO1xuICAgIH1cbiAgICBhZGRSZWZlcmVuY2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyaXRlU2VudGluZWxLZXkoZSwgbik7XG4gICAgfVxuICAgIHJlbW92ZVJlZmVyZW5jZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfd3JpdGVTZW50aW5lbEtleShlLCBuKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFRhcmdldENhY2hlKCkucmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKTtcbiAgICB9XG4gICAgbWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3dyaXRlU2VudGluZWxLZXkoZSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiBhbnl0aGluZyB3b3VsZCBwcmV2ZW50IHRoaXMgZG9jdW1lbnQgZnJvbSBiZWluZyBnYXJiYWdlXG4gICAgICogY29sbGVjdGVkLCBnaXZlbiB0aGF0IHRoZSBkb2N1bWVudCBpbiBxdWVzdGlvbiBpcyBub3QgcHJlc2VudCBpbiBhbnlcbiAgICAgKiB0YXJnZXRzIGFuZCBoYXMgYSBzZXF1ZW5jZSBudW1iZXIgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHRoZSB1cHBlciBib3VuZCBmb3JcbiAgICAgKiB0aGUgY29sbGVjdGlvbiBydW4uXG4gICAgICovICAgIGFyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlc0NvbnRhaW5LZXkoZSwgdCkge1xuICAgICAgICAgICAgbGV0IG4gPSAhMTtcbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbXV0YXRpb25RdWV1ZXNTdG9yZShlKS5YKChyID0+IF9fUFJJVkFURV9tdXRhdGlvblF1ZXVlQ29udGFpbnNLZXkoZSwgciwgdCkubmV4dCgoZSA9PiAoZSAmJiAobiA9ICEwKSwgXG4gICAgICAgICAgICBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSghZSkpKSkpKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgICAgIH0oZSwgdCk7XG4gICAgfVxuICAgIHJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuZGIuZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpLm5ld0NoYW5nZUJ1ZmZlcigpLCByID0gW107XG4gICAgICAgIGxldCBpID0gMDtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3IoZSwgKChzLCBvKSA9PiB7XG4gICAgICAgICAgICBpZiAobyA8PSB0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMuYXIoZSwgcykubmV4dCgodCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdCkgXG4gICAgICAgICAgICAgICAgICAgIC8vIE91ciBzaXplIGFjY291bnRpbmcgcmVxdWlyZXMgdXMgdG8gcmVhZCBhbGwgZG9jdW1lbnRzIGJlZm9yZVxuICAgICAgICAgICAgICAgICAgICAvLyByZW1vdmluZyB0aGVtLlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gaSsrLCBuLmdldEVudHJ5KGUsIHMpLm5leHQoKCgpID0+IChuLnJlbW92ZUVudHJ5KHMsIFNuYXBzaG90VmVyc2lvbi5taW4oKSksIFxuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKS5kZWxldGUoZnVuY3Rpb24gX19QUklWQVRFX3NlbnRpbmVsS2V5JDEoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFsgMCwgX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLnBhdGgpIF07XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBAcmV0dXJucyBBIHZhbHVlIHN1aXRhYmxlIGZvciB3cml0aW5nIGEgc2VudGluZWwgcm93IGluIHRoZSB0YXJnZXQtZG9jdW1lbnRcbiAqIHN0b3JlLlxuICovIChzKSkpKSk7XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgICAgIHIucHVzaCh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHIpKSkubmV4dCgoKCkgPT4gbi5hcHBseShlKSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQud2l0aFNlcXVlbmNlTnVtYmVyKGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGIuZ2V0VGFyZ2V0Q2FjaGUoKS51cGRhdGVUYXJnZXREYXRhKGUsIG4pO1xuICAgIH1cbiAgICB1cGRhdGVMaW1ib0RvY3VtZW50KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV93cml0ZVNlbnRpbmVsS2V5KGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsIHByb3ZpZGVkIGZ1bmN0aW9uIGZvciBlYWNoIGRvY3VtZW50IGluIHRoZSBjYWNoZSB0aGF0IGlzICdvcnBoYW5lZCcuIE9ycGhhbmVkXG4gICAgICogbWVhbnMgbm90IGEgcGFydCBvZiBhbnkgdGFyZ2V0LCBzbyB0aGUgb25seSBlbnRyeSBpbiB0aGUgdGFyZ2V0LWRvY3VtZW50IGluZGV4IGZvclxuICAgICAqIHRoYXQgZG9jdW1lbnQgd2lsbCBiZSB0aGUgc2VudGluZWwgcm93ICh0YXJnZXRJZCAwKSwgd2hpY2ggd2lsbCBhbHNvIGhhdmUgdGhlIHNlcXVlbmNlXG4gICAgICogbnVtYmVyIGZvciB0aGUgbGFzdCB0aW1lIHRoZSBkb2N1bWVudCB3YXMgYWNjZXNzZWQuXG4gICAgICovICAgIF9yKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kb2N1bWVudFRhcmdldFN0b3JlKGUpO1xuICAgICAgICBsZXQgciwgaSA9IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZTtcbiAgICAgICAgcmV0dXJuIG4uWih7XG4gICAgICAgICAgICBpbmRleDogUGVcbiAgICAgICAgfSwgKChbZSwgbl0sIHtwYXRoOiBzLCBzZXF1ZW5jZU51bWJlcjogb30pID0+IHtcbiAgICAgICAgICAgIDAgPT09IGUgPyAoXG4gICAgICAgICAgICAvLyBpZiBuZXh0VG9SZXBvcnQgaXMgdmFsaWQsIHJlcG9ydCBpdCwgdGhpcyBpcyBhIG5ldyBrZXkgc28gdGhlXG4gICAgICAgICAgICAvLyBsYXN0IG9uZSBtdXN0IG5vdCBiZSBhIG1lbWJlciBvZiBhbnkgdGFyZ2V0cy5cbiAgICAgICAgICAgIGkgIT09IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZSAmJiB0KG5ldyBEb2N1bWVudEtleShfX1BSSVZBVEVfZGVjb2RlUmVzb3VyY2VQYXRoKHIpKSwgaSksIFxuICAgICAgICAgICAgLy8gc2V0IG5leHRUb1JlcG9ydCB0byBiZSB0aGlzIHNlcXVlbmNlIG51bWJlci4gSXQncyB0aGUgbmV4dCBvbmUgd2VcbiAgICAgICAgICAgIC8vIG1pZ2h0IHJlcG9ydCwgaWYgd2UgZG9uJ3QgZmluZCBhbnkgdGFyZ2V0cyBmb3IgdGhpcyBkb2N1bWVudC5cbiAgICAgICAgICAgIC8vIE5vdGUgdGhhdCB0aGUgc2VxdWVuY2UgbnVtYmVyIG11c3QgYmUgZGVmaW5lZCB3aGVuIHRoZSB0YXJnZXRJZFxuICAgICAgICAgICAgLy8gaXMgMC5cbiAgICAgICAgICAgIGkgPSBvLCByID0gcykgOiBcbiAgICAgICAgICAgIC8vIHNldCBuZXh0VG9SZXBvcnQgdG8gYmUgaW52YWxpZCwgd2Uga25vdyB3ZSBkb24ndCBuZWVkIHRvIHJlcG9ydFxuICAgICAgICAgICAgLy8gdGhpcyBvbmUgc2luY2Ugd2UgZm91bmQgYSB0YXJnZXQgZm9yIGl0LlxuICAgICAgICAgICAgaSA9IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIC8vIFNpbmNlIHdlIHJlcG9ydCBzZXF1ZW5jZSBudW1iZXJzIGFmdGVyIGdldHRpbmcgdG8gdGhlIG5leHQga2V5LCB3ZVxuICAgICAgICAgICAgLy8gbmVlZCB0byBjaGVjayBpZiB0aGUgbGFzdCBrZXkgd2UgaXRlcmF0ZWQgb3ZlciB3YXMgYW4gb3JwaGFuZWRcbiAgICAgICAgICAgIC8vIGRvY3VtZW50IGFuZCByZXBvcnQgaXQuXG4gICAgICAgICAgICBpICE9PSBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUgJiYgdChuZXcgRG9jdW1lbnRLZXkoX19QUklWQVRFX2RlY29kZVJlc291cmNlUGF0aChyKSksIGkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRiLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5nZXRTaXplKGUpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3dyaXRlU2VudGluZWxLZXkoZSwgdCkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZG9jdW1lbnRUYXJnZXRTdG9yZShlKS5wdXQoZnVuY3Rpb24gX19QUklWQVRFX3NlbnRpbmVsUm93KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRhcmdldElkOiAwLFxuICAgICAgICAgICAgcGF0aDogX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLnBhdGgpLFxuICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IHRcbiAgICAgICAgfTtcbiAgICB9KHQsIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBidWZmZXIgb2YgZW50cmllcyB0byBiZSB3cml0dGVuIHRvIGEgUmVtb3RlRG9jdW1lbnRDYWNoZS5cbiAqIEl0IGNhbiBiZSB1c2VkIHRvIGJhdGNoIHVwIGEgc2V0IG9mIGNoYW5nZXMgdG8gYmUgd3JpdHRlbiB0byB0aGUgY2FjaGUsIGJ1dFxuICogYWRkaXRpb25hbGx5IHN1cHBvcnRzIHJlYWRpbmcgZW50cmllcyBiYWNrIHdpdGggdGhlIGBnZXRFbnRyeSgpYCBtZXRob2QsXG4gKiBmYWxsaW5nIGJhY2sgdG8gdGhlIHVuZGVybHlpbmcgUmVtb3RlRG9jdW1lbnRDYWNoZSBpZiBubyBlbnRyeSBpc1xuICogYnVmZmVyZWQuXG4gKlxuICogRW50cmllcyBhZGRlZCB0byB0aGUgY2FjaGUgKm11c3QqIGJlIHJlYWQgZmlyc3QuIFRoaXMgaXMgdG8gZmFjaWxpdGF0ZVxuICogY2FsY3VsYXRpbmcgdGhlIHNpemUgZGVsdGEgb2YgdGhlIHBlbmRpbmcgY2hhbmdlcy5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IFRoaXMgY2xhc3Mgd2FzIGltcGxlbWVudGVkIHRoZW4gcmVtb3ZlZCBmcm9tIG90aGVyIHBsYXRmb3Jtcy5cbiAqIElmIGJ5dGUtY291bnRpbmcgZW5kcyB1cCBiZWluZyBuZWVkZWQgb24gdGhlIG90aGVyIHBsYXRmb3JtcywgY29uc2lkZXJcbiAqIHBvcnRpbmcgdGhpcyBjbGFzcyBhcyBwYXJ0IG9mIHRoYXQgaW1wbGVtZW50YXRpb24gd29yay5cbiAqLyBjbGFzcyBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8vIEEgbWFwcGluZyBvZiBkb2N1bWVudCBrZXkgdG8gdGhlIG5ldyBjYWNoZSBlbnRyeSB0aGF0IHNob3VsZCBiZSB3cml0dGVuLlxuICAgICAgICB0aGlzLmNoYW5nZXMgPSBuZXcgT2JqZWN0TWFwKChlID0+IGUudG9TdHJpbmcoKSksICgoZSwgdCkgPT4gZS5pc0VxdWFsKHQpKSksIHRoaXMuY2hhbmdlc0FwcGxpZWQgPSAhMTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVmZmVycyBhIGBSZW1vdGVEb2N1bWVudENhY2hlLmFkZEVudHJ5KClgIGNhbGwuXG4gICAgICpcbiAgICAgKiBZb3UgY2FuIG9ubHkgbW9kaWZ5IGRvY3VtZW50cyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCB2aWFcbiAgICAgKiBgZ2V0RW50cnkoKS9nZXRFbnRyaWVzKClgIChlbmZvcmNlZCB2aWEgSW5kZXhlZERicyBgYXBwbHkoKWApLlxuICAgICAqLyAgICBhZGRFbnRyeShlKSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXMuc2V0KGUua2V5LCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQnVmZmVycyBhIGBSZW1vdGVEb2N1bWVudENhY2hlLnJlbW92ZUVudHJ5KClgIGNhbGwuXG4gICAgICpcbiAgICAgKiBZb3UgY2FuIG9ubHkgcmVtb3ZlIGRvY3VtZW50cyB0aGF0IGhhdmUgYWxyZWFkeSBiZWVuIHJldHJpZXZlZCB2aWFcbiAgICAgKiBgZ2V0RW50cnkoKS9nZXRFbnRyaWVzKClgIChlbmZvcmNlZCB2aWEgSW5kZXhlZERicyBgYXBwbHkoKWApLlxuICAgICAqLyAgICByZW1vdmVFbnRyeShlLCB0KSB7XG4gICAgICAgIHRoaXMuYXNzZXJ0Tm90QXBwbGllZCgpLCB0aGlzLmNoYW5nZXMuc2V0KGUsIE11dGFibGVEb2N1bWVudC5uZXdJbnZhbGlkRG9jdW1lbnQoZSkuc2V0UmVhZFRpbWUodCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBMb29rcyB1cCBhbiBlbnRyeSBpbiB0aGUgY2FjaGUuIFRoZSBidWZmZXJlZCBjaGFuZ2VzIHdpbGwgZmlyc3QgYmUgY2hlY2tlZCxcbiAgICAgKiBhbmQgaWYgbm8gYnVmZmVyZWQgY2hhbmdlIGFwcGxpZXMsIHRoaXMgd2lsbCBmb3J3YXJkIHRvXG4gICAgICogYFJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0RW50cnkoKWAuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gdHJhbnNhY3Rpb24gLSBUaGUgdHJhbnNhY3Rpb24gaW4gd2hpY2ggdG8gcGVyZm9ybSBhbnkgcGVyc2lzdGVuY2VcbiAgICAgKiAgICAgb3BlcmF0aW9ucy5cbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXkgLSBUaGUga2V5IG9mIHRoZSBlbnRyeSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSBjYWNoZWQgZG9jdW1lbnQgb3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZiB3ZSBoYXZlIG5vdGhpbmdcbiAgICAgKiBjYWNoZWQuXG4gICAgICovICAgIGdldEVudHJ5KGUsIHQpIHtcbiAgICAgICAgdGhpcy5hc3NlcnROb3RBcHBsaWVkKCk7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmNoYW5nZXMuZ2V0KHQpO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSBuID8gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobikgOiB0aGlzLmdldEZyb21DYWNoZShlLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgc2V2ZXJhbCBlbnRyaWVzIGluIHRoZSBjYWNoZSwgZm9yd2FyZGluZyB0b1xuICAgICAqIGBSZW1vdGVEb2N1bWVudENhY2hlLmdldEVudHJ5KClgLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uIC0gVGhlIHRyYW5zYWN0aW9uIGluIHdoaWNoIHRvIHBlcmZvcm0gYW55IHBlcnNpc3RlbmNlXG4gICAgICogICAgIG9wZXJhdGlvbnMuXG4gICAgICogQHBhcmFtIGRvY3VtZW50S2V5cyAtIFRoZSBrZXlzIG9mIHRoZSBlbnRyaWVzIHRvIGxvb2sgdXAuXG4gICAgICogQHJldHVybnMgQSBtYXAgb2YgY2FjaGVkIGRvY3VtZW50cywgaW5kZXhlZCBieSBrZXkuIElmIGFuIGVudHJ5IGNhbm5vdCBiZVxuICAgICAqICAgICBmb3VuZCwgdGhlIGNvcnJlc3BvbmRpbmcga2V5IHdpbGwgYmUgbWFwcGVkIHRvIGFuIGludmFsaWQgZG9jdW1lbnQuXG4gICAgICovICAgIGdldEVudHJpZXMoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRBbGxGcm9tQ2FjaGUoZSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYnVmZmVyZWQgY2hhbmdlcyB0byB0aGUgdW5kZXJseWluZyBSZW1vdGVEb2N1bWVudENhY2hlLCB1c2luZ1xuICAgICAqIHRoZSBwcm92aWRlZCB0cmFuc2FjdGlvbi5cbiAgICAgKi8gICAgYXBwbHkoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5hc3NlcnROb3RBcHBsaWVkKCksIHRoaXMuY2hhbmdlc0FwcGxpZWQgPSAhMCwgdGhpcy5hcHBseUNoYW5nZXMoZSk7XG4gICAgfVxuICAgIC8qKiBIZWxwZXIgdG8gYXNzZXJ0IHRoaXMuY2hhbmdlcyBpcyBub3QgbnVsbCAgKi8gICAgYXNzZXJ0Tm90QXBwbGllZCgpIHt9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBSZW1vdGVEb2N1bWVudENhY2hlIGZvciBJbmRleGVkRGIuIFRvIGNvbnN0cnVjdCwgaW52b2tlXG4gKiBgbmV3SW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSgpYC5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZUltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gZTtcbiAgICB9XG4gICAgc2V0SW5kZXhNYW5hZ2VyKGUpIHtcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIHRoZSBzdXBwbGllZCBlbnRyaWVzIHRvIHRoZSBjYWNoZS5cbiAgICAgKlxuICAgICAqIEFsbCBjYWxscyBvZiBgYWRkRW50cnlgIGFyZSByZXF1aXJlZCB0byBnbyB0aHJvdWdoIHRoZSBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlclxuICAgICAqIHJldHVybmVkIGJ5IGBuZXdDaGFuZ2VCdWZmZXIoKWAgdG8gZW5zdXJlIHByb3BlciBhY2NvdW50aW5nIG9mIG1ldGFkYXRhLlxuICAgICAqLyAgICBhZGRFbnRyeShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkucHV0KG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgZG9jdW1lbnQgZnJvbSB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYHJlbW92ZUVudHJ5YCAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYCB0byBlbnN1cmUgcHJvcGVyIGFjY291bnRpbmcgb2YgbWV0YWRhdGEuXG4gICAgICovICAgIHJlbW92ZUVudHJ5KGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKS5kZWxldGUoXG4gICAgICAgIC8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIHZpYSB0aGUgcHJpbWFyeSBrZXkgb2ZcbiAqIHRoZSBEYlJlbW90ZURvY3VtZW50IG9iamVjdCBzdG9yZS5cbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZGJSZWFkVGltZUtleShlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5wYXRoLnRvQXJyYXkoKTtcbiAgICAgICAgICAgIHJldHVybiBbIFxuICAgICAgICAgICAgLyogcHJlZml4IHBhdGggKi8gbi5zbGljZSgwLCBuLmxlbmd0aCAtIDIpLCBcbiAgICAgICAgICAgIC8qIGNvbGxlY3Rpb24gaWQgKi8gbltuLmxlbmd0aCAtIDJdLCBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleSh0KSwgXG4gICAgICAgICAgICAvKiBkb2N1bWVudCBpZCAqLyBuW24ubGVuZ3RoIC0gMV0gXTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIFJldHVybnMgYSBrZXkgdGhhdCBjYW4gYmUgdXNlZCBmb3IgZG9jdW1lbnQgbG9va3VwcyBvbiB0aGVcbiAqIGBEYlJlbW90ZURvY3VtZW50RG9jdW1lbnRDb2xsZWN0aW9uR3JvdXBJbmRleGAgaW5kZXguXG4gKi8gKHQsIG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgY3VycmVudCBjYWNoZSBzaXplLlxuICAgICAqXG4gICAgICogQ2FsbGVycyB0byBgYWRkRW50cnkoKWAgYW5kIGByZW1vdmVFbnRyeSgpYCAqbXVzdCogY2FsbCB0aGlzIGFmdGVyd2FyZHMgdG8gdXBkYXRlIHRoZVxuICAgICAqIGNhY2hlJ3MgbWV0YWRhdGEuXG4gICAgICovICAgIHVwZGF0ZU1ldGFkYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0TWV0YWRhdGEoZSkubmV4dCgobiA9PiAobi5ieXRlU2l6ZSArPSB0LCB0aGlzLnVyKGUsIG4pKSkpO1xuICAgIH1cbiAgICBnZXRFbnRyeShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudCh0KTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKS5aKHtcbiAgICAgICAgICAgIGluZGV4OiBuZSxcbiAgICAgICAgICAgIHJhbmdlOiBJREJLZXlSYW5nZS5vbmx5KF9fUFJJVkFURV9kYktleSh0KSlcbiAgICAgICAgfSwgKChlLCByKSA9PiB7XG4gICAgICAgICAgICBuID0gdGhpcy5jcih0LCByKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTG9va3MgdXAgYW4gZW50cnkgaW4gdGhlIGNhY2hlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50S2V5IC0gVGhlIGtleSBvZiB0aGUgZW50cnkgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBUaGUgY2FjaGVkIGRvY3VtZW50IGVudHJ5IGFuZCBpdHMgc2l6ZS5cbiAgICAgKi8gICAgbHIoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IHtcbiAgICAgICAgICAgIHNpemU6IDAsXG4gICAgICAgICAgICBkb2N1bWVudDogTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudCh0KVxuICAgICAgICB9O1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgaW5kZXg6IG5lLFxuICAgICAgICAgICAgcmFuZ2U6IElEQktleVJhbmdlLm9ubHkoX19QUklWQVRFX2RiS2V5KHQpKVxuICAgICAgICB9LCAoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIG4gPSB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnQ6IHRoaXMuY3IodCwgciksXG4gICAgICAgICAgICAgICAgc2l6ZTogX19QUklWQVRFX2RiRG9jdW1lbnRTaXplKHIpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBnZXRFbnRyaWVzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgICAgIHJldHVybiB0aGlzLmhyKGUsIHQsICgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3IoZSwgdCk7XG4gICAgICAgICAgICBuID0gbi5pbnNlcnQoZSwgcik7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiBuKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIExvb2tzIHVwIHNldmVyYWwgZW50cmllcyBpbiB0aGUgY2FjaGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jdW1lbnRLZXlzIC0gVGhlIHNldCBvZiBrZXlzIGVudHJpZXMgdG8gbG9vayB1cC5cbiAgICAgKiBAcmV0dXJucyBBIG1hcCBvZiBkb2N1bWVudHMgaW5kZXhlZCBieSBrZXkgYW5kIGEgbWFwIG9mIHNpemVzIGluZGV4ZWQgYnlcbiAgICAgKiAgICAga2V5ICh6ZXJvIGlmIHRoZSBkb2N1bWVudCBkb2VzIG5vdCBleGlzdCkuXG4gICAgICovICAgIFByKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCksIHIgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gdGhpcy5ocihlLCB0LCAoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSB0aGlzLmNyKGUsIHQpO1xuICAgICAgICAgICAgbiA9IG4uaW5zZXJ0KGUsIGkpLCByID0gci5pbnNlcnQoZSwgX19QUklWQVRFX2RiRG9jdW1lbnRTaXplKHQpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+ICh7XG4gICAgICAgICAgICBkb2N1bWVudHM6IG4sXG4gICAgICAgICAgICBUcjogclxuICAgICAgICB9KSkpO1xuICAgIH1cbiAgICBocihlLCB0LCBuKSB7XG4gICAgICAgIGlmICh0LmlzRW1wdHkoKSkgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgICAgIGxldCByID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfZGJLZXlDb21wYXJhdG9yKTtcbiAgICAgICAgdC5mb3JFYWNoKChlID0+IHIgPSByLmFkZChlKSkpO1xuICAgICAgICBjb25zdCBpID0gSURCS2V5UmFuZ2UuYm91bmQoX19QUklWQVRFX2RiS2V5KHIuZmlyc3QoKSksIF9fUFJJVkFURV9kYktleShyLmxhc3QoKSkpLCBzID0gci5nZXRJdGVyYXRvcigpO1xuICAgICAgICBsZXQgbyA9IHMuZ2V0TmV4dCgpO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLlooe1xuICAgICAgICAgICAgaW5kZXg6IG5lLFxuICAgICAgICAgICAgcmFuZ2U6IGlcbiAgICAgICAgfSwgKChlLCB0LCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKFsgLi4udC5wcmVmaXhQYXRoLCB0LmNvbGxlY3Rpb25Hcm91cCwgdC5kb2N1bWVudElkIF0pO1xuICAgICAgICAgICAgLy8gR28gdGhyb3VnaCBrZXlzIG5vdCBmb3VuZCBpbiBjYWNoZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO28gJiYgX19QUklWQVRFX2RiS2V5Q29tcGFyYXRvcihvLCBpKSA8IDA7ICkgbihvLCBudWxsKSwgbyA9IHMuZ2V0TmV4dCgpO1xuICAgICAgICAgICAgbyAmJiBvLmlzRXF1YWwoaSkgJiYgKFxuICAgICAgICAgICAgLy8gS2V5IGZvdW5kIGluIGNhY2hlLlxuICAgICAgICAgICAgbihvLCB0KSwgbyA9IHMuaGFzTmV4dCgpID8gcy5nZXROZXh0KCkgOiBudWxsKSwgXG4gICAgICAgICAgICAvLyBTa2lwIHRvIHRoZSBuZXh0IGtleSAoaWYgdGhlcmUgaXMgb25lKS5cbiAgICAgICAgICAgIG8gPyByLlcoX19QUklWQVRFX2RiS2V5KG8pKSA6IHIuZG9uZSgpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGhlIHJlc3Qgb2YgdGhlIGtleXMgYXJlIG5vdCBpbiB0aGUgY2FjaGUuIE9uZSBjYXNlIHdoZXJlIGBpdGVyYXRlYFxuICAgICAgICAgICAgLy8gYWJvdmUgd29uJ3QgZ28gdGhyb3VnaCB0aGVtIGlzIHdoZW4gdGhlIGNhY2hlIGlzIGVtcHR5LlxuICAgICAgICAgICAgZm9yICg7bzsgKSBuKG8sIG51bGwpLCBvID0gcy5oYXNOZXh0KCkgPyBzLmdldE5leHQoKSA6IG51bGw7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeShlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSB0LnBhdGgsIG8gPSBbIHMucG9wTGFzdCgpLnRvQXJyYXkoKSwgcy5sYXN0U2VnbWVudCgpLCBfX1BSSVZBVEVfdG9EYlRpbWVzdGFtcEtleShuLnJlYWRUaW1lKSwgbi5kb2N1bWVudEtleS5wYXRoLmlzRW1wdHkoKSA/IFwiXCIgOiBuLmRvY3VtZW50S2V5LnBhdGgubGFzdFNlZ21lbnQoKSBdLCBfID0gWyBzLnBvcExhc3QoKS50b0FycmF5KCksIHMubGFzdFNlZ21lbnQoKSwgWyBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiwgTnVtYmVyLk1BWF9TQUZFX0lOVEVHRVIgXSwgXCJcIiBdO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3JlbW90ZURvY3VtZW50c1N0b3JlKGUpLkcoSURCS2V5UmFuZ2UuYm91bmQobywgXywgITApKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIG51bGwgPT0gaSB8fCBpLmluY3JlbWVudERvY3VtZW50UmVhZENvdW50KGUubGVuZ3RoKTtcbiAgICAgICAgICAgIGxldCBuID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBpIG9mIGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5jcihEb2N1bWVudEtleS5mcm9tU2VnbWVudHMoaS5wcmVmaXhQYXRoLmNvbmNhdChpLmNvbGxlY3Rpb25Hcm91cCwgaS5kb2N1bWVudElkKSksIGkpO1xuICAgICAgICAgICAgICAgIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgKF9fUFJJVkFURV9xdWVyeU1hdGNoZXModCwgZSkgfHwgci5oYXMoZS5rZXkpKSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gRWl0aGVyIHRoZSBkb2N1bWVudCBtYXRjaGVzIHRoZSBnaXZlbiBxdWVyeSwgb3IgaXQgaXMgbXV0YXRlZC5cbiAgICAgICAgICAgICAgICBuID0gbi5pbnNlcnQoZS5rZXksIGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGdldEFsbEZyb21Db2xsZWN0aW9uR3JvdXAoZSwgdCwgbiwgcikge1xuICAgICAgICBsZXQgaSA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKTtcbiAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9kYkNvbGxlY3Rpb25Hcm91cEtleSh0LCBuKSwgbyA9IF9fUFJJVkFURV9kYkNvbGxlY3Rpb25Hcm91cEtleSh0LCBJbmRleE9mZnNldC5tYXgoKSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVtb3RlRG9jdW1lbnRzU3RvcmUoZSkuWih7XG4gICAgICAgICAgICBpbmRleDogaWUsXG4gICAgICAgICAgICByYW5nZTogSURCS2V5UmFuZ2UuYm91bmQocywgbywgITApXG4gICAgICAgIH0sICgoZSwgdCwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuY3IoRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKHQucHJlZml4UGF0aC5jb25jYXQodC5jb2xsZWN0aW9uR3JvdXAsIHQuZG9jdW1lbnRJZCkpLCB0KTtcbiAgICAgICAgICAgIGkgPSBpLmluc2VydChzLmtleSwgcyksIGkuc2l6ZSA9PT0gciAmJiBuLmRvbmUoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkpKTtcbiAgICB9XG4gICAgbmV3Q2hhbmdlQnVmZmVyKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIodGhpcywgISFlICYmIGUudHJhY2tSZW1vdmFscyk7XG4gICAgfVxuICAgIGdldFNpemUoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRNZXRhZGF0YShlKS5uZXh0KChlID0+IGUuYnl0ZVNpemUpKTtcbiAgICB9XG4gICAgZ2V0TWV0YWRhdGEoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50R2xvYmFsU3RvcmUoZSkuZ2V0KF9lKS5uZXh0KChlID0+IChfX1BSSVZBVEVfaGFyZEFzc2VydCghIWUpLCBcbiAgICAgICAgZSkpKTtcbiAgICB9XG4gICAgdXIoZSwgdCkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50R2xvYmFsU3RvcmUoZSkucHV0KF9lLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGVjb2RlcyBgZGJSZW1vdGVEb2NgIGFuZCByZXR1cm5zIHRoZSBkb2N1bWVudCAob3IgYW4gaW52YWxpZCBkb2N1bWVudCBpZlxuICAgICAqIHRoZSBkb2N1bWVudCBjb3JyZXNwb25kcyB0byB0aGUgZm9ybWF0IHVzZWQgZm9yIHNlbnRpbmVsIGRlbGV0ZXMpLlxuICAgICAqLyAgICBjcihlLCB0KSB7XG4gICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX2Zyb21EYlJlbW90ZURvY3VtZW50KHRoaXMuc2VyaWFsaXplciwgdCk7XG4gICAgICAgICAgICAvLyBXaGV0aGVyIHRoZSBkb2N1bWVudCBpcyBhIHNlbnRpbmVsIHJlbW92YWwgYW5kIHNob3VsZCBvbmx5IGJlIHVzZWQgaW4gdGhlXG4gICAgICAgICAgICAvLyBgZ2V0TmV3RG9jdW1lbnRDaGFuZ2VzKClgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlLmlzTm9Eb2N1bWVudCgpICYmIGUudmVyc2lvbi5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkpKSByZXR1cm4gZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudChlKTtcbiAgICB9XG59XG5cbi8qKiBDcmVhdGVzIGEgbmV3IEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlSW1wbChlKTtcbn1cblxuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXRhaWxzIG9mIGFkZGluZyBhbmQgdXBkYXRpbmcgZG9jdW1lbnRzIGluIHRoZSBJbmRleGVkRGJSZW1vdGVEb2N1bWVudENhY2hlLlxuICpcbiAqIFVubGlrZSB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIsIHRoZSBJbmRleGVkRGIgaW1wbGVtZW50YXRpb24gY29tcHV0ZXMgdGhlIHNpemVcbiAqIGRlbHRhIGZvciBhbGwgc3VibWl0dGVkIGNoYW5nZXMuIFRoaXMgYXZvaWRzIGhhdmluZyB0byByZS1yZWFkIGFsbCBkb2N1bWVudHMgZnJvbSBJbmRleGVkRGJcbiAqIHdoZW4gd2UgYXBwbHkgdGhlIGNoYW5nZXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyIGV4dGVuZHMgUmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudENhY2hlIC0gVGhlIEluZGV4ZWREYlJlbW90ZURvY3VtZW50Q2FjaGUgdG8gYXBwbHkgdGhlIGNoYW5nZXMgdG8uXG4gICAgICogQHBhcmFtIHRyYWNrUmVtb3ZhbHMgLSBXaGV0aGVyIHRvIGNyZWF0ZSBzZW50aW5lbCBkZWxldGVzIHRoYXQgY2FuIGJlIHRyYWNrZWQgYnlcbiAgICAgKiBgZ2V0TmV3RG9jdW1lbnRDaGFuZ2VzKClgLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5JciA9IGUsIHRoaXMudHJhY2tSZW1vdmFscyA9IHQsIFxuICAgICAgICAvLyBBIG1hcCBvZiBkb2N1bWVudCBzaXplcyBhbmQgcmVhZCB0aW1lcyBwcmlvciB0byBhcHBseWluZyB0aGUgY2hhbmdlcyBpblxuICAgICAgICAvLyB0aGlzIGJ1ZmZlci5cbiAgICAgICAgdGhpcy5FciA9IG5ldyBPYmplY3RNYXAoKGUgPT4gZS50b1N0cmluZygpKSwgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKTtcbiAgICB9XG4gICAgYXBwbHlDaGFuZ2VzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICBsZXQgbiA9IDAsIHIgPSBuZXcgU29ydGVkU2V0KCgoZSwgdCkgPT4gX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IoZS5jYW5vbmljYWxTdHJpbmcoKSwgdC5jYW5vbmljYWxTdHJpbmcoKSkpKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hhbmdlcy5mb3JFYWNoKCgoaSwgcykgPT4ge1xuICAgICAgICAgICAgY29uc3QgbyA9IHRoaXMuRXIuZ2V0KGkpO1xuICAgICAgICAgICAgaWYgKHQucHVzaCh0aGlzLklyLnJlbW92ZUVudHJ5KGUsIGksIG8ucmVhZFRpbWUpKSwgcy5pc1ZhbGlkRG9jdW1lbnQoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfdG9EYlJlbW90ZURvY3VtZW50KHRoaXMuSXIuc2VyaWFsaXplciwgcyk7XG4gICAgICAgICAgICAgICAgciA9IHIuYWRkKGkucGF0aC5wb3BMYXN0KCkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBfX1BSSVZBVEVfZGJEb2N1bWVudFNpemUoXyk7XG4gICAgICAgICAgICAgICAgbiArPSBhIC0gby5zaXplLCB0LnB1c2godGhpcy5Jci5hZGRFbnRyeShlLCBpLCBfKSk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKG4gLT0gby5zaXplLCB0aGlzLnRyYWNrUmVtb3ZhbHMpIHtcbiAgICAgICAgICAgICAgICAvLyBJbiBvcmRlciB0byB0cmFjayByZW1vdmFscywgd2Ugc3RvcmUgYSBcInNlbnRpbmVsIGRlbGV0ZVwiIGluIHRoZVxuICAgICAgICAgICAgICAgIC8vIFJlbW90ZURvY3VtZW50Q2FjaGUuIFRoaXMgZW50cnkgaXMgcmVwcmVzZW50ZWQgYnkgYSBOb0RvY3VtZW50XG4gICAgICAgICAgICAgICAgLy8gd2l0aCBhIHZlcnNpb24gb2YgMCBhbmQgaWdub3JlZCBieSBgbWF5YmVEZWNvZGVEb2N1bWVudCgpYCBidXRcbiAgICAgICAgICAgICAgICAvLyBwcmVzZXJ2ZWQgaW4gYGdldE5ld0RvY3VtZW50Q2hhbmdlcygpYC5cbiAgICAgICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX3RvRGJSZW1vdGVEb2N1bWVudCh0aGlzLklyLnNlcmlhbGl6ZXIsIHMuY29udmVydFRvTm9Eb2N1bWVudChTbmFwc2hvdFZlcnNpb24ubWluKCkpKTtcbiAgICAgICAgICAgICAgICB0LnB1c2godGhpcy5Jci5hZGRFbnRyeShlLCBpLCBuKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKSwgci5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIHQucHVzaCh0aGlzLklyLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCBuKSk7XG4gICAgICAgIH0pKSwgdC5wdXNoKHRoaXMuSXIudXBkYXRlTWV0YWRhdGEoZSwgbikpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcih0KTtcbiAgICB9XG4gICAgZ2V0RnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBzaXplIG9mIGV2ZXJ5dGhpbmcgd2UgbG9hZCBmcm9tIHRoZSBjYWNoZSBzbyB3ZSBjYW4gY29tcHV0ZSBhIGRlbHRhIGxhdGVyLlxuICAgICAgICByZXR1cm4gdGhpcy5Jci5scihlLCB0KS5uZXh0KChlID0+ICh0aGlzLkVyLnNldCh0LCB7XG4gICAgICAgICAgICBzaXplOiBlLnNpemUsXG4gICAgICAgICAgICByZWFkVGltZTogZS5kb2N1bWVudC5yZWFkVGltZVxuICAgICAgICB9KSwgZS5kb2N1bWVudCkpKTtcbiAgICB9XG4gICAgZ2V0QWxsRnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgLy8gUmVjb3JkIHRoZSBzaXplIG9mIGV2ZXJ5dGhpbmcgd2UgbG9hZCBmcm9tIHRoZSBjYWNoZSBzbyB3ZSBjYW4gY29tcHV0ZVxuICAgICAgICAvLyBhIGRlbHRhIGxhdGVyLlxuICAgICAgICByZXR1cm4gdGhpcy5Jci5QcihlLCB0KS5uZXh0KCgoe2RvY3VtZW50czogZSwgVHI6IHR9KSA9PiAoXG4gICAgICAgIC8vIE5vdGU6IGBnZXRBbGxGcm9tQ2FjaGVgIHJldHVybnMgdHdvIG1hcHMgaW5zdGVhZCBvZiBhIHNpbmdsZSBtYXAgZnJvbVxuICAgICAgICAvLyBrZXlzIHRvIGBEb2N1bWVudFNpemVFbnRyeWBzLiBUaGlzIGlzIHRvIGFsbG93IHJldHVybmluZyB0aGVcbiAgICAgICAgLy8gYE11dGFibGVEb2N1bWVudE1hcGAgZGlyZWN0bHksIHdpdGhvdXQgYSBjb252ZXJzaW9uLlxuICAgICAgICB0LmZvckVhY2goKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICB0aGlzLkVyLnNldCh0LCB7XG4gICAgICAgICAgICAgICAgc2l6ZTogbixcbiAgICAgICAgICAgICAgICByZWFkVGltZTogZS5nZXQodCkucmVhZFRpbWVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KSksIGUpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRHbG9iYWxTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBvZSk7XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSByZW1vdGVEb2N1bWVudHMgb2JqZWN0IHN0b3JlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVEb2N1bWVudHNTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBlZSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGtleSB0aGF0IGNhbiBiZSB1c2VkIGZvciBkb2N1bWVudCBsb29rdXBzIG9uIHRoZVxuICogYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudEtleUluZGV4YCBpbmRleC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGJLZXkoZSkge1xuICAgIGNvbnN0IHQgPSBlLnBhdGgudG9BcnJheSgpO1xuICAgIHJldHVybiBbIFxuICAgIC8qIHByZWZpeCBwYXRoICovIHQuc2xpY2UoMCwgdC5sZW5ndGggLSAyKSwgXG4gICAgLyogY29sbGVjdGlvbiBpZCAqLyB0W3QubGVuZ3RoIC0gMl0sIFxuICAgIC8qIGRvY3VtZW50IGlkICovIHRbdC5sZW5ndGggLSAxXSBdO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZGJDb2xsZWN0aW9uR3JvdXBLZXkoZSwgdCkge1xuICAgIGNvbnN0IG4gPSB0LmRvY3VtZW50S2V5LnBhdGgudG9BcnJheSgpO1xuICAgIHJldHVybiBbIFxuICAgIC8qIGNvbGxlY3Rpb24gaWQgKi8gZSwgX19QUklWQVRFX3RvRGJUaW1lc3RhbXBLZXkodC5yZWFkVGltZSksIFxuICAgIC8qIHByZWZpeCBwYXRoICovIG4uc2xpY2UoMCwgbi5sZW5ndGggLSAyKSwgXG4gICAgLyogZG9jdW1lbnQgaWQgKi8gbi5sZW5ndGggPiAwID8gbltuLmxlbmd0aCAtIDFdIDogXCJcIiBdO1xufVxuXG4vKipcbiAqIENvbXBhcmF0b3IgdGhhdCBjb21wYXJlcyBkb2N1bWVudCBrZXlzIGFjY29yZGluZyB0byB0aGUgcHJpbWFyeSBrZXkgc29ydGluZ1xuICogdXNlZCBieSB0aGUgYERiUmVtb3RlRG9jdW1lbnREb2N1bWVudGAgc3RvcmUgKGJ5IHByZWZpeCBwYXRoLCBjb2xsZWN0aW9uIGlkXG4gKiBhbmQgdGhlbiBkb2N1bWVudCBJRCkuXG4gKlxuICogVmlzaWJsZSBmb3IgdGVzdGluZy5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZGJLZXlDb21wYXJhdG9yKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZS5wYXRoLnRvQXJyYXkoKSwgciA9IHQucGF0aC50b0FycmF5KCk7XG4gICAgLy8gVGhlIG9yZGVyaW5nIGlzIGJhc2VkIG9uIGh0dHBzOi8vY2hyb21pdW0uZ29vZ2xlc291cmNlLmNvbS9jaHJvbWl1bS9ibGluay8rL2ZlNWMyMWZlZjk0ZGFlNzFjMWMzMzQ0Nzc1YjhkOGE3ZjdlNmQ5ZWMvU291cmNlL21vZHVsZXMvaW5kZXhlZGRiL0lEQktleS5jcHAjNzRcbiAgICBsZXQgaSA9IDA7XG4gICAgZm9yIChsZXQgZSA9IDA7IGUgPCBuLmxlbmd0aCAtIDIgJiYgZSA8IHIubGVuZ3RoIC0gMjsgKytlKSBpZiAoaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG5bZV0sIHJbZV0pLCBcbiAgICBpKSByZXR1cm4gaTtcbiAgICByZXR1cm4gaSA9IF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKG4ubGVuZ3RoLCByLmxlbmd0aCksIGkgfHwgKGkgPSBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihuW24ubGVuZ3RoIC0gMl0sIHJbci5sZW5ndGggLSAyXSksIFxuICAgIGkgfHwgX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IobltuLmxlbmd0aCAtIDFdLCByW3IubGVuZ3RoIC0gMV0pKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogU2NoZW1hIFZlcnNpb24gZm9yIHRoZSBXZWIgY2xpZW50OlxuICogMS4gIEluaXRpYWwgdmVyc2lvbiBpbmNsdWRpbmcgTXV0YXRpb24gUXVldWUsIFF1ZXJ5IENhY2hlLCBhbmQgUmVtb3RlXG4gKiAgICAgRG9jdW1lbnQgQ2FjaGVcbiAqIDIuICBVc2VkIHRvIGVuc3VyZSBhIHRhcmdldEdsb2JhbCBvYmplY3QgZXhpc3RzIGFuZCBhZGQgdGFyZ2V0Q291bnQgdG8gaXQuIE5vXG4gKiAgICAgbG9uZ2VyIHJlcXVpcmVkIGJlY2F1c2UgbWlncmF0aW9uIDMgdW5jb25kaXRpb25hbGx5IGNsZWFycyBpdC5cbiAqIDMuICBEcm9wcGVkIGFuZCByZS1jcmVhdGVkIFF1ZXJ5IENhY2hlIHRvIGRlYWwgd2l0aCBjYWNoZSBjb3JydXB0aW9uIHJlbGF0ZWRcbiAqICAgICB0byBsaW1ibyByZXNvbHV0aW9uLiBBZGRyZXNzZXNcbiAqICAgICBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtaW9zLXNkay9pc3N1ZXMvMTU0OFxuICogNC4gIE11bHRpLVRhYiBTdXBwb3J0LlxuICogNS4gIFJlbW92YWwgb2YgaGVsZCB3cml0ZSBhY2tzLlxuICogNi4gIENyZWF0ZSBkb2N1bWVudCBnbG9iYWwgZm9yIHRyYWNraW5nIGRvY3VtZW50IGNhY2hlIHNpemUuXG4gKiA3LiAgRW5zdXJlIGV2ZXJ5IGNhY2hlZCBkb2N1bWVudCBoYXMgYSBzZW50aW5lbCByb3cgd2l0aCBhIHNlcXVlbmNlIG51bWJlci5cbiAqIDguICBBZGQgY29sbGVjdGlvbi1wYXJlbnQgaW5kZXggZm9yIENvbGxlY3Rpb24gR3JvdXAgcXVlcmllcy5cbiAqIDkuICBDaGFuZ2UgUmVtb3RlRG9jdW1lbnRDaGFuZ2VzIHN0b3JlIHRvIGJlIGtleWVkIGJ5IHJlYWRUaW1lIHJhdGhlciB0aGFuXG4gKiAgICAgYW4gYXV0by1pbmNyZW1lbnRpbmcgSUQuIFRoaXMgaXMgcmVxdWlyZWQgZm9yIEluZGV4LUZyZWUgcXVlcmllcy5cbiAqIDEwLiBSZXdyaXRlIHRoZSBjYW5vbmljYWwgSURzIHRvIHRoZSBleHBsaWNpdCBQcm90b2J1Zi1iYXNlZCBmb3JtYXQuXG4gKiAxMS4gQWRkIGJ1bmRsZXMgYW5kIG5hbWVkX3F1ZXJpZXMgZm9yIGJ1bmRsZSBzdXBwb3J0LlxuICogMTIuIEFkZCBkb2N1bWVudCBvdmVybGF5cy5cbiAqIDEzLiBSZXdyaXRlIHRoZSBrZXlzIG9mIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUgdG8gYWxsb3cgZm9yIGVmZmljaWVudFxuICogICAgIGRvY3VtZW50IGxvb2t1cCB2aWEgYGdldEFsbCgpYC5cbiAqIDE0LiBBZGQgb3ZlcmxheXMuXG4gKiAxNS4gQWRkIGluZGV4aW5nIHN1cHBvcnQuXG4gKiAxNi4gUGFyc2UgdGltZXN0YW1wIHN0cmluZ3MgYmVmb3JlIGNyZWF0aW5nIGluZGV4IGVudHJpZXMuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSBsb2NhbCB2aWV3IChvdmVybGF5KSBvZiBhIGRvY3VtZW50LCBhbmQgdGhlIGZpZWxkcyB0aGF0IGFyZVxuICogbG9jYWxseSBtdXRhdGVkLlxuICovXG5jbGFzcyBPdmVybGF5ZWREb2N1bWVudCB7XG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGZpZWxkcyB0aGF0IGFyZSBsb2NhbGx5IG11dGF0ZWQgYnkgcGF0Y2ggbXV0YXRpb25zLlxuICAgICAqXG4gICAgICogSWYgdGhlIG92ZXJsYXllZFx0ZG9jdW1lbnQgaXMgZnJvbSBzZXQgb3IgZGVsZXRlIG11dGF0aW9ucywgdGhpcyBpcyBgbnVsbGAuXG4gICAgICogSWYgdGhlcmUgaXMgbm8gb3ZlcmxheSAobXV0YXRpb24pIGZvciB0aGUgZG9jdW1lbnQsIHRoaXMgaXMgYW4gZW1wdHkgYEZpZWxkTWFza2AuXG4gICAgICovXG4gICAgdCkge1xuICAgICAgICB0aGlzLm92ZXJsYXllZERvY3VtZW50ID0gZSwgdGhpcy5tdXRhdGVkRmllbGRzID0gdDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgcmVhZG9ubHkgdmlldyBvZiB0aGUgbG9jYWwgc3RhdGUgb2YgYWxsIGRvY3VtZW50cyB3ZSdyZSB0cmFja2luZyAoaS5lLiB3ZVxuICogaGF2ZSBhIGNhY2hlZCB2ZXJzaW9uIGluIHJlbW90ZURvY3VtZW50Q2FjaGUgb3IgbG9jYWwgbXV0YXRpb25zIGZvciB0aGVcbiAqIGRvY3VtZW50KS4gVGhlIHZpZXcgaXMgY29tcHV0ZWQgYnkgYXBwbHlpbmcgdGhlIG11dGF0aW9ucyBpbiB0aGVcbiAqIE11dGF0aW9uUXVldWUgdG8gdGhlIFJlbW90ZURvY3VtZW50Q2FjaGUuXG4gKi8gY2xhc3MgTG9jYWxEb2N1bWVudHNWaWV3IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZSA9IGUsIHRoaXMubXV0YXRpb25RdWV1ZSA9IHQsIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUgPSBuLCBcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSByO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXQgdGhlIGxvY2FsIHZpZXcgb2YgdGhlIGRvY3VtZW50IGlkZW50aWZpZWQgYnkgYGtleWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBMb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudCBvciBudWxsIGlmIHdlIGRvbid0IGhhdmUgYW55IGNhY2hlZFxuICAgICAqIHN0YXRlIGZvciBpdC5cbiAgICAgKi8gICAgZ2V0RG9jdW1lbnQoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IG51bGw7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlLmdldE92ZXJsYXkoZSwgdCkubmV4dCgociA9PiAobiA9IHIsIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyeShlLCB0KSkpKS5uZXh0KChlID0+IChudWxsICE9PSBuICYmIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcobi5tdXRhdGlvbiwgZSwgRmllbGRNYXNrLmVtcHR5KCksIFRpbWVzdGFtcC5ub3coKSksIFxuICAgICAgICBlKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBsb2NhbCB2aWV3IG9mIHRoZSBkb2N1bWVudHMgaWRlbnRpZmllZCBieSBga2V5c2AuXG4gICAgICpcbiAgICAgKiBJZiB3ZSBkb24ndCBoYXZlIGNhY2hlZCBzdGF0ZSBmb3IgYSBkb2N1bWVudCBpbiBga2V5c2AsIGEgTm9Eb2N1bWVudCB3aWxsXG4gICAgICogYmUgc3RvcmVkIGZvciB0aGF0IGtleSBpbiB0aGUgcmVzdWx0aW5nIHNldC5cbiAgICAgKi8gICAgZ2V0RG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyaWVzKGUsIHQpLm5leHQoKHQgPT4gdGhpcy5nZXRMb2NhbFZpZXdPZkRvY3VtZW50cyhlLCB0LCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkubmV4dCgoKCkgPT4gdCkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNpbWlsYXIgdG8gYGdldERvY3VtZW50c2AsIGJ1dCBjcmVhdGVzIHRoZSBsb2NhbCB2aWV3IGZyb20gdGhlIGdpdmVuXG4gICAgICogYGJhc2VEb2NzYCB3aXRob3V0IHJldHJpZXZpbmcgZG9jdW1lbnRzIGZyb20gdGhlIGxvY2FsIHN0b3JlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uIC0gVGhlIHRyYW5zYWN0aW9uIHRoaXMgb3BlcmF0aW9uIGlzIHNjb3BlZCB0by5cbiAgICAgKiBAcGFyYW0gZG9jcyAtIFRoZSBkb2N1bWVudHMgdG8gYXBwbHkgbG9jYWwgbXV0YXRpb25zIHRvIGdldCB0aGUgbG9jYWwgdmlld3MuXG4gICAgICogQHBhcmFtIGV4aXN0ZW5jZVN0YXRlQ2hhbmdlZCAtIFRoZSBzZXQgb2YgZG9jdW1lbnQga2V5cyB3aG9zZSBleGlzdGVuY2Ugc3RhdGVcbiAgICAgKiAgIGlzIGNoYW5nZWQuIFRoaXMgaXMgdXNlZnVsIHRvIGRldGVybWluZSBpZiBzb21lIGRvY3VtZW50cyBvdmVybGF5IG5lZWRzXG4gICAgICogICB0byBiZSByZWNhbGN1bGF0ZWQuXG4gICAgICovICAgIGdldExvY2FsVmlld09mRG9jdW1lbnRzKGUsIHQsIG4gPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9wdWxhdGVPdmVybGF5cyhlLCByLCB0KS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyhlLCB0LCByLCBuKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGxldCB0ID0gZG9jdW1lbnRNYXAoKTtcbiAgICAgICAgICAgIHJldHVybiBlLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdCA9IHQuaW5zZXJ0KGUsIG4ub3ZlcmxheWVkRG9jdW1lbnQpO1xuICAgICAgICAgICAgfSkpLCB0O1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyB0aGUgb3ZlcmxheWVkIGRvY3VtZW50cyBmb3IgdGhlIGdpdmVuIGRvY3VtZW50IG1hcCwgd2hpY2ggd2lsbCBpbmNsdWRlXG4gICAgICogdGhlIGxvY2FsIHZpZXcgb2YgdGhvc2UgZG9jdW1lbnRzIGFuZCBhIGBGaWVsZE1hc2tgIGluZGljYXRpbmcgd2hpY2ggZmllbGRzXG4gICAgICogYXJlIG11dGF0ZWQgbG9jYWxseSwgYG51bGxgIGlmIG92ZXJsYXkgaXMgYSBTZXQgb3IgRGVsZXRlIG11dGF0aW9uLlxuICAgICAqLyAgICBnZXRPdmVybGF5ZWREb2N1bWVudHMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucG9wdWxhdGVPdmVybGF5cyhlLCBuLCB0KS5uZXh0KCgoKSA9PiB0aGlzLmNvbXB1dGVWaWV3cyhlLCB0LCBuLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyB0aGUgb3ZlcmxheXMgZm9yIHtAY29kZSBkb2NzfSBhbmQgYWRkcyB0aGVtIHRvIHByb3ZpZGVkIG92ZXJsYXkgbWFwXG4gICAgICogaWYgdGhlIG1hcCBkb2VzIG5vdCBhbHJlYWR5IGNvbnRhaW4gYW4gZW50cnkgZm9yIHRoZSBnaXZlbiBkb2N1bWVudCBrZXkuXG4gICAgICovICAgIHBvcHVsYXRlT3ZlcmxheXMoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gW107XG4gICAgICAgIHJldHVybiBuLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdC5oYXMoZSkgfHwgci5wdXNoKGUpO1xuICAgICAgICB9KSksIHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheXMoZSwgcikubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBlLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgdC5zZXQoZSwgbik7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tcHV0ZXMgdGhlIGxvY2FsIHZpZXcgZm9yIHRoZSBnaXZlbiBkb2N1bWVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZG9jcyAtIFRoZSBkb2N1bWVudHMgdG8gY29tcHV0ZSB2aWV3cyBmb3IuIEl0IGFsc28gaGFzIHRoZSBiYXNlXG4gICAgICogICB2ZXJzaW9uIG9mIHRoZSBkb2N1bWVudHMuXG4gICAgICogQHBhcmFtIG92ZXJsYXlzIC0gVGhlIG92ZXJsYXlzIHRoYXQgbmVlZCB0byBiZSBhcHBsaWVkIHRvIHRoZSBnaXZlbiBiYXNlXG4gICAgICogICB2ZXJzaW9uIG9mIHRoZSBkb2N1bWVudHMuXG4gICAgICogQHBhcmFtIGV4aXN0ZW5jZVN0YXRlQ2hhbmdlZCAtIEEgc2V0IG9mIGRvY3VtZW50cyB3aG9zZSBleGlzdGVuY2Ugc3RhdGVzXG4gICAgICogICBtaWdodCBoYXZlIGNoYW5nZWQuIFRoaXMgaXMgdXNlZCB0byBkZXRlcm1pbmUgaWYgd2UgbmVlZCB0byByZS1jYWxjdWxhdGVcbiAgICAgKiAgIG92ZXJsYXlzIGZyb20gbXV0YXRpb24gcXVldWVzLlxuICAgICAqIEByZXR1cm4gQSBtYXAgcmVwcmVzZW50cyB0aGUgbG9jYWwgZG9jdW1lbnRzIHZpZXcuXG4gICAgICovICAgIGNvbXB1dGVWaWV3cyhlLCB0LCBuLCByKSB7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpO1xuICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCksIG8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3T3ZlcmxheWVkRG9jdW1lbnRNYXAoKSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX25ld0RvY3VtZW50S2V5TWFwKCk7XG4gICAgICAgIH0oKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSBuLmdldCh0LmtleSk7XG4gICAgICAgICAgICAvLyBSZWNhbGN1bGF0ZSBhbiBvdmVybGF5IGlmIHRoZSBkb2N1bWVudCdzIGV4aXN0ZW5jZSBzdGF0ZSBjaGFuZ2VkIGR1ZSB0b1xuICAgICAgICAgICAgLy8gYSByZW1vdGUgZXZlbnQgKmFuZCogdGhlIG92ZXJsYXkgaXMgYSBQYXRjaE11dGF0aW9uLiBUaGlzIGlzIGJlY2F1c2VcbiAgICAgICAgICAgIC8vIGRvY3VtZW50IGV4aXN0ZW5jZSBzdGF0ZSBjYW4gY2hhbmdlIGlmIHNvbWUgcGF0Y2ggbXV0YXRpb24nc1xuICAgICAgICAgICAgLy8gcHJlY29uZGl0aW9ucyBhcmUgbWV0LlxuICAgICAgICAgICAgLy8gTk9URTogd2UgcmVjYWxjdWxhdGUgd2hlbiBgb3ZlcmxheWAgaXMgdW5kZWZpbmVkIGFzIHdlbGwsIGJlY2F1c2UgdGhlcmVcbiAgICAgICAgICAgIC8vIG1pZ2h0IGJlIGEgcGF0Y2ggbXV0YXRpb24gd2hvc2UgcHJlY29uZGl0aW9uIGRvZXMgbm90IG1hdGNoIGJlZm9yZSB0aGVcbiAgICAgICAgICAgIC8vIGNoYW5nZSAoaGVuY2Ugb3ZlcmxheSBpcyB1bmRlZmluZWQpLCBidXQgd291bGQgbm93IG1hdGNoLlxuICAgICAgICAgICAgICAgICAgICAgICAgci5oYXModC5rZXkpICYmICh2b2lkIDAgPT09IG8gfHwgby5tdXRhdGlvbiBpbnN0YW5jZW9mIF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKSA/IGkgPSBpLmluc2VydCh0LmtleSwgdCkgOiB2b2lkIDAgIT09IG8gPyAocy5zZXQodC5rZXksIG8ubXV0YXRpb24uZ2V0RmllbGRNYXNrKCkpLCBcbiAgICAgICAgICAgIF9fUFJJVkFURV9tdXRhdGlvbkFwcGx5VG9Mb2NhbFZpZXcoby5tdXRhdGlvbiwgdCwgby5tdXRhdGlvbi5nZXRGaWVsZE1hc2soKSwgVGltZXN0YW1wLm5vdygpKSkgOiBcbiAgICAgICAgICAgIC8vIG5vIG92ZXJsYXkgZXhpc3RzXG4gICAgICAgICAgICAvLyBVc2luZyBFTVBUWSB0byBpbmRpY2F0ZSB0aGVyZSBpcyBubyBvdmVybGF5IGZvciB0aGUgZG9jdW1lbnQuXG4gICAgICAgICAgICBzLnNldCh0LmtleSwgRmllbGRNYXNrLmVtcHR5KCkpO1xuICAgICAgICB9KSksIHRoaXMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXMoZSwgaSkubmV4dCgoZSA9PiAoZS5mb3JFYWNoKCgoZSwgdCkgPT4gcy5zZXQoZSwgdCkpKSwgXG4gICAgICAgIHQuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIHZhciBuO1xuICAgICAgICAgICAgcmV0dXJuIG8uc2V0KGUsIG5ldyBPdmVybGF5ZWREb2N1bWVudCh0LCBudWxsICE9PSAobiA9IHMuZ2V0KGUpKSAmJiB2b2lkIDAgIT09IG4gPyBuIDogbnVsbCkpO1xuICAgICAgICB9KSksIG8pKSk7XG4gICAgfVxuICAgIHJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9uZXdEb2N1bWVudEtleU1hcCgpO1xuICAgICAgICAvLyBBIHJldmVyc2UgbG9va3VwIG1hcCBmcm9tIGJhdGNoIGlkIHRvIHRoZSBkb2N1bWVudHMgd2l0aGluIHRoYXQgYmF0Y2guXG4gICAgICAgICAgICAgICAgbGV0IHIgPSBuZXcgU29ydGVkTWFwKCgoZSwgdCkgPT4gZSAtIHQpKSwgaSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlLmdldEFsbE11dGF0aW9uQmF0Y2hlc0FmZmVjdGluZ0RvY3VtZW50S2V5cyhlLCB0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBlKSBpLmtleXMoKS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gdC5nZXQoZSk7XG4gICAgICAgICAgICAgICAgaWYgKG51bGwgPT09IHMpIHJldHVybjtcbiAgICAgICAgICAgICAgICBsZXQgbyA9IG4uZ2V0KGUpIHx8IEZpZWxkTWFzay5lbXB0eSgpO1xuICAgICAgICAgICAgICAgIG8gPSBpLmFwcGx5VG9Mb2NhbFZpZXcocywgbyksIG4uc2V0KGUsIG8pO1xuICAgICAgICAgICAgICAgIGNvbnN0IF8gPSAoci5nZXQoaS5iYXRjaElkKSB8fCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSkuYWRkKGUpO1xuICAgICAgICAgICAgICAgIHIgPSByLmluc2VydChpLmJhdGNoSWQsIF8pO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcyA9IFtdLCBvID0gci5nZXRSZXZlcnNlSXRlcmF0b3IoKTtcbiAgICAgICAgICAgIC8vIEl0ZXJhdGUgaW4gZGVzY2VuZGluZyBvcmRlciBvZiBiYXRjaCBJRHMsIGFuZCBza2lwIGRvY3VtZW50cyB0aGF0IGFyZVxuICAgICAgICAgICAgLy8gYWxyZWFkeSBzYXZlZC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoO28uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gby5nZXROZXh0KCksIF8gPSByLmtleSwgYSA9IHIudmFsdWUsIHUgPSBfX1BSSVZBVEVfbmV3TXV0YXRpb25NYXAoKTtcbiAgICAgICAgICAgICAgICBhLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWkuaGFzKGUpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2NhbGN1bGF0ZU92ZXJsYXlNdXRhdGlvbih0LmdldChlKSwgbi5nZXQoZSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPT0gciAmJiB1LnNldChlLCByKSwgaSA9IGkuYWRkKGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkpLCBzLnB1c2godGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZS5zYXZlT3ZlcmxheXMoZSwgXywgdSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHMpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWNhbGN1bGF0ZXMgb3ZlcmxheXMgYnkgcmVhZGluZyB0aGUgZG9jdW1lbnRzIGZyb20gcmVtb3RlIGRvY3VtZW50IGNhY2hlXG4gICAgICogZmlyc3QsIGFuZCBzYXZlcyB0aGVtIGFmdGVyIHRoZXkgYXJlIGNhbGN1bGF0ZWQuXG4gICAgICovICAgIHJlY2FsY3VsYXRlQW5kU2F2ZU92ZXJsYXlzRm9yRG9jdW1lbnRLZXlzKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZS5nZXRFbnRyaWVzKGUsIHQpLm5leHQoKHQgPT4gdGhpcy5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5cyhlLCB0KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHZpZXcgb2YgYWxsIGRvY3VtZW50cy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB0cmFuc2FjdGlvbiAtIFRoZSBwZXJzaXN0ZW5jZSB0cmFuc2FjdGlvbi5cbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkgdG8gbWF0Y2ggZG9jdW1lbnRzIGFnYWluc3QuXG4gICAgICogQHBhcmFtIG9mZnNldCAtIFJlYWQgdGltZSBhbmQga2V5IHRvIHN0YXJ0IHNjYW5uaW5nIGJ5IChleGNsdXNpdmUpLlxuICAgICAqIEBwYXJhbSBjb250ZXh0IC0gQSBvcHRpb25hbCB0cmFja2VyIHRvIGtlZXAgYSByZWNvcmQgb2YgaW1wb3J0YW50IGRldGFpbHNcbiAgICAgKiAgIGR1cmluZyBkYXRhYmFzZSBsb2NhbCBxdWVyeSBleGVjdXRpb24uXG4gICAgICovICAgIGdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgdCwgbiwgcikge1xuICAgICAgICAvKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgcXVlcnkgbWF0Y2hlcyBhIHNpbmdsZSBkb2N1bWVudCBieSBwYXRoIChyYXRoZXIgdGhhbiBhXG4gKiBjb2xsZWN0aW9uKS5cbiAqL1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2lzRG9jdW1lbnRRdWVyeSQxKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGUucGF0aCkgJiYgbnVsbCA9PT0gZS5jb2xsZWN0aW9uR3JvdXAgJiYgMCA9PT0gZS5maWx0ZXJzLmxlbmd0aDtcbiAgICAgICAgfSh0KSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdEb2N1bWVudFF1ZXJ5KGUsIHQucGF0aCkgOiBfX1BSSVZBVEVfaXNDb2xsZWN0aW9uR3JvdXBRdWVyeSh0KSA/IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uR3JvdXBRdWVyeShlLCB0LCBuLCByKSA6IHRoaXMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uUXVlcnkoZSwgdCwgbiwgcik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGEgY29sbGVjdGlvbiBncm91cCwgcmV0dXJucyB0aGUgbmV4dCBkb2N1bWVudHMgdGhhdCBmb2xsb3cgdGhlIHByb3ZpZGVkIG9mZnNldCwgYWxvbmdcbiAgICAgKiB3aXRoIGFuIHVwZGF0ZWQgYmF0Y2ggSUQuXG4gICAgICpcbiAgICAgKiA8cD5UaGUgZG9jdW1lbnRzIHJldHVybmVkIGJ5IHRoaXMgbWV0aG9kIGFyZSBvcmRlcmVkIGJ5IHJlbW90ZSB2ZXJzaW9uIGZyb20gdGhlIHByb3ZpZGVkXG4gICAgICogb2Zmc2V0LiBJZiB0aGVyZSBhcmUgbm8gbW9yZSByZW1vdGUgZG9jdW1lbnRzIGFmdGVyIHRoZSBwcm92aWRlZCBvZmZzZXQsIGRvY3VtZW50cyB3aXRoXG4gICAgICogbXV0YXRpb25zIGluIG9yZGVyIG9mIGJhdGNoIGlkIGZyb20gdGhlIG9mZnNldCBhcmUgcmV0dXJuZWQuIFNpbmNlIGFsbCBkb2N1bWVudHMgaW4gYSBiYXRjaCBhcmVcbiAgICAgKiByZXR1cm5lZCB0b2dldGhlciwgdGhlIHRvdGFsIG51bWJlciBvZiBkb2N1bWVudHMgcmV0dXJuZWQgY2FuIGV4Y2VlZCB7QGNvZGUgY291bnR9LlxuICAgICAqXG4gICAgICogQHBhcmFtIHRyYW5zYWN0aW9uXG4gICAgICogQHBhcmFtIGNvbGxlY3Rpb25Hcm91cCBUaGUgY29sbGVjdGlvbiBncm91cCBmb3IgdGhlIGRvY3VtZW50cy5cbiAgICAgKiBAcGFyYW0gb2Zmc2V0IFRoZSBvZmZzZXQgdG8gaW5kZXggaW50by5cbiAgICAgKiBAcGFyYW0gY291bnQgVGhlIG51bWJlciBvZiBkb2N1bWVudHMgdG8gcmV0dXJuXG4gICAgICogQHJldHVybiBBIExvY2FsV3JpdGVSZXN1bHQgd2l0aCB0aGUgZG9jdW1lbnRzIHRoYXQgZm9sbG93IHRoZSBwcm92aWRlZCBvZmZzZXQgYW5kIHRoZSBsYXN0IHByb2Nlc3NlZCBiYXRjaCBpZC5cbiAgICAgKi8gICAgZ2V0TmV4dERvY3VtZW50cyhlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0QWxsRnJvbUNvbGxlY3Rpb25Hcm91cChlLCB0LCBuLCByKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSByIC0gaS5zaXplID4gMCA/IHRoaXMuZG9jdW1lbnRPdmVybGF5Q2FjaGUuZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbi5sYXJnZXN0QmF0Y2hJZCwgciAtIGkuc2l6ZSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpKTtcbiAgICAgICAgICAgIC8vIFRoZSBjYWxsc2l0ZSB3aWxsIHVzZSB0aGUgbGFyZ2VzdCBiYXRjaCBJRCB0b2dldGhlciB3aXRoIHRoZSBsYXRlc3QgcmVhZCB0aW1lIHRvIGNyZWF0ZVxuICAgICAgICAgICAgLy8gYSBuZXcgaW5kZXggb2Zmc2V0LiBTaW5jZSB3ZSBvbmx5IHByb2Nlc3MgYmF0Y2ggSURzIGlmIGFsbCByZW1vdGUgZG9jdW1lbnRzIGhhdmUgYmVlbiByZWFkLFxuICAgICAgICAgICAgLy8gbm8gb3ZlcmxheSB3aWxsIGluY3JlYXNlIHRoZSBvdmVyYWxsIHJlYWQgdGltZS4gVGhpcyBpcyB3aHkgd2Ugb25seSBuZWVkIHRvIHNwZWNpYWwgY2FzZVxuICAgICAgICAgICAgLy8gdGhlIGJhdGNoIGlkLlxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG8gPSBOLCBfID0gaTtcbiAgICAgICAgICAgIHJldHVybiBzLm5leHQoKHQgPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKCh0LCBuKSA9PiAobyA8IG4ubGFyZ2VzdEJhdGNoSWQgJiYgKG8gPSBuLmxhcmdlc3RCYXRjaElkKSwgXG4gICAgICAgICAgICBpLmdldCh0KSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCkgOiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUuZ2V0RW50cnkoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgXyA9IF8uaW5zZXJ0KHQsIGUpO1xuICAgICAgICAgICAgfSkpKSkpLm5leHQoKCgpID0+IHRoaXMucG9wdWxhdGVPdmVybGF5cyhlLCB0LCBpKSkpLm5leHQoKCgpID0+IHRoaXMuY29tcHV0ZVZpZXdzKGUsIF8sIHQsIF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSkpLm5leHQoKGUgPT4gKHtcbiAgICAgICAgICAgICAgICBiYXRjaElkOiBvLFxuICAgICAgICAgICAgICAgIGNoYW5nZXM6IF9fUFJJVkFURV9jb252ZXJ0T3ZlcmxheWVkRG9jdW1lbnRNYXBUb0RvY3VtZW50TWFwKGUpXG4gICAgICAgICAgICB9KSkpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdEb2N1bWVudFF1ZXJ5KGUsIHQpIHtcbiAgICAgICAgLy8gSnVzdCBkbyBhIHNpbXBsZSBkb2N1bWVudCBsb29rdXAuXG4gICAgICAgIHJldHVybiB0aGlzLmdldERvY3VtZW50KGUsIG5ldyBEb2N1bWVudEtleSh0KSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBsZXQgdCA9IGRvY3VtZW50TWFwKCk7XG4gICAgICAgICAgICByZXR1cm4gZS5pc0ZvdW5kRG9jdW1lbnQoKSAmJiAodCA9IHQuaW5zZXJ0KGUua2V5LCBlKSksIHQ7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRzTWF0Y2hpbmdDb2xsZWN0aW9uR3JvdXBRdWVyeShlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSB0LmNvbGxlY3Rpb25Hcm91cDtcbiAgICAgICAgbGV0IHMgPSBkb2N1bWVudE1hcCgpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE1hbmFnZXIuZ2V0Q29sbGVjdGlvblBhcmVudHMoZSwgaSkubmV4dCgobyA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChvLCAobyA9PiB7XG4gICAgICAgICAgICBjb25zdCBfID0gZnVuY3Rpb24gX19QUklWQVRFX2FzQ29sbGVjdGlvblF1ZXJ5QXRQYXRoKGUsIHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwodCwgXG4gICAgICAgICAgICAgICAgLypjb2xsZWN0aW9uR3JvdXA9Ki8gbnVsbCwgZS5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgZS5maWx0ZXJzLnNsaWNlKCksIGUubGltaXQsIGUubGltaXRUeXBlLCBlLnN0YXJ0QXQsIGUuZW5kQXQpO1xuICAgICAgICAgICAgfSh0LCBvLmNoaWxkKGkpKTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldERvY3VtZW50c01hdGNoaW5nQ29sbGVjdGlvblF1ZXJ5KGUsIF8sIG4sIHIpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgIGUuZm9yRWFjaCgoKGUsIHQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcyA9IHMuaW5zZXJ0KGUsIHQpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHMpKSkpO1xuICAgIH1cbiAgICBnZXREb2N1bWVudHNNYXRjaGluZ0NvbGxlY3Rpb25RdWVyeShlLCB0LCBuLCByKSB7XG4gICAgICAgIC8vIFF1ZXJ5IHRoZSByZW1vdGUgZG9jdW1lbnRzIGFuZCBvdmVybGF5IG11dGF0aW9ucy5cbiAgICAgICAgbGV0IGk7XG4gICAgICAgIHJldHVybiB0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlLmdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbihlLCB0LnBhdGgsIG4ubGFyZ2VzdEJhdGNoSWQpLm5leHQoKHMgPT4gKGkgPSBzLCBcbiAgICAgICAgdGhpcy5yZW1vdGVEb2N1bWVudENhY2hlLmdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgdCwgbiwgaSwgcikpKSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAvLyBBcyBkb2N1bWVudHMgbWlnaHQgbWF0Y2ggdGhlIHF1ZXJ5IGJlY2F1c2Ugb2YgdGhlaXIgb3ZlcmxheSB3ZSBuZWVkIHRvXG4gICAgICAgICAgICAvLyBpbmNsdWRlIGRvY3VtZW50cyBmb3IgYWxsIG92ZXJsYXlzIGluIHRoZSBpbml0aWFsIGRvY3VtZW50IHNldC5cbiAgICAgICAgICAgIGkuZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gbi5nZXRLZXkoKTtcbiAgICAgICAgICAgICAgICBudWxsID09PSBlLmdldChyKSAmJiAoZSA9IGUuaW5zZXJ0KHIsIE11dGFibGVEb2N1bWVudC5uZXdJbnZhbGlkRG9jdW1lbnQocikpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIC8vIEFwcGx5IHRoZSBvdmVybGF5cyBhbmQgbWF0Y2ggYWdhaW5zdCB0aGUgcXVlcnkuXG4gICAgICAgICAgICBsZXQgbiA9IGRvY3VtZW50TWFwKCk7XG4gICAgICAgICAgICByZXR1cm4gZS5mb3JFYWNoKCgoZSwgcikgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBpLmdldChlKTtcbiAgICAgICAgICAgICAgICB2b2lkIDAgIT09IHMgJiYgX19QUklWQVRFX211dGF0aW9uQXBwbHlUb0xvY2FsVmlldyhzLm11dGF0aW9uLCByLCBGaWVsZE1hc2suZW1wdHkoKSwgVGltZXN0YW1wLm5vdygpKSwgXG4gICAgICAgICAgICAgICAgLy8gRmluYWxseSwgaW5zZXJ0IHRoZSBkb2N1bWVudHMgdGhhdCBzdGlsbCBtYXRjaCB0aGUgcXVlcnlcbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzKHQsIHIpICYmIChuID0gbi5pbnNlcnQoZSwgcikpO1xuICAgICAgICAgICAgfSkpLCBuO1xuICAgICAgICB9KSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5QnVuZGxlQ2FjaGUge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gZSwgdGhpcy5kciA9IG5ldyBNYXAsIHRoaXMuQXIgPSBuZXcgTWFwO1xuICAgIH1cbiAgICBnZXRCdW5kbGVNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLmRyLmdldCh0KSk7XG4gICAgfVxuICAgIHNhdmVCdW5kbGVNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRyLnNldCh0LmlkLCBcbiAgICAgICAgLyoqIERlY29kZXMgYSBCdW5kbGVNZXRhZGF0YSBwcm90byBpbnRvIGEgQnVuZGxlTWV0YWRhdGEgb2JqZWN0LiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbUJ1bmRsZU1ldGFkYXRhKGUpIHtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgaWQ6IGUuaWQsXG4gICAgICAgICAgICAgICAgdmVyc2lvbjogZS52ZXJzaW9uLFxuICAgICAgICAgICAgICAgIGNyZWF0ZVRpbWU6IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLmNyZWF0ZVRpbWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHQpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TmFtZWRRdWVyeShlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLkFyLmdldCh0KSk7XG4gICAgfVxuICAgIHNhdmVOYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuQXIuc2V0KHQubmFtZSwgZnVuY3Rpb24gX19QUklWQVRFX2Zyb21Qcm90b05hbWVkUXVlcnkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBuYW1lOiBlLm5hbWUsXG4gICAgICAgICAgICAgICAgcXVlcnk6IF9fUFJJVkFURV9mcm9tQnVuZGxlZFF1ZXJ5KGUuYnVuZGxlZFF1ZXJ5KSxcbiAgICAgICAgICAgICAgICByZWFkVGltZTogX19QUklWQVRFX2Zyb21WZXJzaW9uKGUucmVhZFRpbWUpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KHQpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBpbXBsZW1lbnRhdGlvbiBvZiBEb2N1bWVudE92ZXJsYXlDYWNoZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5RG9jdW1lbnRPdmVybGF5Q2FjaGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBBIG1hcCBzb3J0ZWQgYnkgRG9jdW1lbnRLZXksIHdob3NlIHZhbHVlIGlzIGEgcGFpciBvZiB0aGUgbGFyZ2VzdCBiYXRjaCBpZFxuICAgICAgICAvLyBmb3IgdGhlIG92ZXJsYXkgYW5kIHRoZSBvdmVybGF5IGl0c2VsZi5cbiAgICAgICAgdGhpcy5vdmVybGF5cyA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvciksIHRoaXMuUnIgPSBuZXcgTWFwO1xuICAgIH1cbiAgICBnZXRPdmVybGF5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMub3ZlcmxheXMuZ2V0KHQpKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX25ld092ZXJsYXlNYXAoKTtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQsICh0ID0+IHRoaXMuZ2V0T3ZlcmxheShlLCB0KS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgIG51bGwgIT09IGUgJiYgbi5zZXQodCwgZSk7XG4gICAgICAgIH0pKSkpLm5leHQoKCgpID0+IG4pKTtcbiAgICB9XG4gICAgc2F2ZU92ZXJsYXlzKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIHIpID0+IHtcbiAgICAgICAgICAgIHRoaXMuRXQoZSwgdCwgcik7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IHRoaXMuUnIuZ2V0KG4pO1xuICAgICAgICByZXR1cm4gdm9pZCAwICE9PSByICYmIChyLmZvckVhY2goKGUgPT4gdGhpcy5vdmVybGF5cyA9IHRoaXMub3ZlcmxheXMucmVtb3ZlKGUpKSksIFxuICAgICAgICB0aGlzLlJyLmRlbGV0ZShuKSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldE92ZXJsYXlzRm9yQ29sbGVjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpLCBpID0gdC5sZW5ndGggKyAxLCBzID0gbmV3IERvY3VtZW50S2V5KHQuY2hpbGQoXCJcIikpLCBvID0gdGhpcy5vdmVybGF5cy5nZXRJdGVyYXRvckZyb20ocyk7XG4gICAgICAgIGZvciAoO28uaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBvLmdldE5leHQoKS52YWx1ZSwgcyA9IGUuZ2V0S2V5KCk7XG4gICAgICAgICAgICBpZiAoIXQuaXNQcmVmaXhPZihzLnBhdGgpKSBicmVhaztcbiAgICAgICAgICAgIC8vIERvY3VtZW50cyBmcm9tIHN1Yi1jb2xsZWN0aW9uc1xuICAgICAgICAgICAgICAgICAgICAgICAgcy5wYXRoLmxlbmd0aCA9PT0gaSAmJiAoZS5sYXJnZXN0QmF0Y2hJZCA+IG4gJiYgci5zZXQoZS5nZXRLZXkoKSwgZSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShyKTtcbiAgICB9XG4gICAgZ2V0T3ZlcmxheXNGb3JDb2xsZWN0aW9uR3JvdXAoZSwgdCwgbiwgcikge1xuICAgICAgICBsZXQgaSA9IG5ldyBTb3J0ZWRNYXAoKChlLCB0KSA9PiBlIC0gdCkpO1xuICAgICAgICBjb25zdCBzID0gdGhpcy5vdmVybGF5cy5nZXRJdGVyYXRvcigpO1xuICAgICAgICBmb3IgKDtzLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gcy5nZXROZXh0KCkudmFsdWU7XG4gICAgICAgICAgICBpZiAoZS5nZXRLZXkoKS5nZXRDb2xsZWN0aW9uR3JvdXAoKSA9PT0gdCAmJiBlLmxhcmdlc3RCYXRjaElkID4gbikge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gaS5nZXQoZS5sYXJnZXN0QmF0Y2hJZCk7XG4gICAgICAgICAgICAgICAgbnVsbCA9PT0gdCAmJiAodCA9IF9fUFJJVkFURV9uZXdPdmVybGF5TWFwKCksIGkgPSBpLmluc2VydChlLmxhcmdlc3RCYXRjaElkLCB0KSksIFxuICAgICAgICAgICAgICAgIHQuc2V0KGUuZ2V0S2V5KCksIGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG8gPSBfX1BSSVZBVEVfbmV3T3ZlcmxheU1hcCgpLCBfID0gaS5nZXRJdGVyYXRvcigpO1xuICAgICAgICBmb3IgKDtfLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBpZiAoXy5nZXROZXh0KCkudmFsdWUuZm9yRWFjaCgoKGUsIHQpID0+IG8uc2V0KGUsIHQpKSksIG8uc2l6ZSgpID49IHIpIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShvKTtcbiAgICB9XG4gICAgRXQoZSwgdCwgbikge1xuICAgICAgICAvLyBSZW1vdmUgdGhlIGFzc29jaWF0aW9uIG9mIHRoZSBvdmVybGF5IHRvIGl0cyBiYXRjaCBpZC5cbiAgICAgICAgY29uc3QgciA9IHRoaXMub3ZlcmxheXMuZ2V0KG4ua2V5KTtcbiAgICAgICAgaWYgKG51bGwgIT09IHIpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLlJyLmdldChyLmxhcmdlc3RCYXRjaElkKS5kZWxldGUobi5rZXkpO1xuICAgICAgICAgICAgdGhpcy5Sci5zZXQoci5sYXJnZXN0QmF0Y2hJZCwgZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vdmVybGF5cyA9IHRoaXMub3ZlcmxheXMuaW5zZXJ0KG4ua2V5LCBuZXcgT3ZlcmxheSh0LCBuKSk7XG4gICAgICAgIC8vIENyZWF0ZSB0aGUgYXNzb2NpYXRpb24gb2YgdGhpcyBvdmVybGF5IHRvIHRoZSBnaXZlbiBsYXJnZXN0QmF0Y2hJZC5cbiAgICAgICAgbGV0IGkgPSB0aGlzLlJyLmdldCh0KTtcbiAgICAgICAgdm9pZCAwID09PSBpICYmIChpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIHRoaXMuUnIuc2V0KHQsIGkpKSwgdGhpcy5Sci5zZXQodCwgaS5hZGQobi5rZXkpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDI0IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlHbG9iYWxzQ2FjaGUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLnNlc3Npb25Ub2tlbiA9IEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkc7XG4gICAgfVxuICAgIGdldFNlc3Npb25Ub2tlbihlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLnNlc3Npb25Ub2tlbik7XG4gICAgfVxuICAgIHNldFNlc3Npb25Ub2tlbihlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlc3Npb25Ub2tlbiA9IHQsIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNvbGxlY3Rpb24gb2YgcmVmZXJlbmNlcyB0byBhIGRvY3VtZW50IGZyb20gc29tZSBraW5kIG9mIG51bWJlcmVkIGVudGl0eVxuICogKGVpdGhlciBhIHRhcmdldCBJRCBvciBiYXRjaCBJRCkuIEFzIHJlZmVyZW5jZXMgYXJlIGFkZGVkIHRvIG9yIHJlbW92ZWQgZnJvbVxuICogdGhlIHNldCBjb3JyZXNwb25kaW5nIGV2ZW50cyBhcmUgZW1pdHRlZCB0byBhIHJlZ2lzdGVyZWQgZ2FyYmFnZSBjb2xsZWN0b3IuXG4gKlxuICogRWFjaCByZWZlcmVuY2UgaXMgcmVwcmVzZW50ZWQgYnkgYSBEb2N1bWVudFJlZmVyZW5jZSBvYmplY3QuIEVhY2ggb2YgdGhlbVxuICogY29udGFpbnMgZW5vdWdoIGluZm9ybWF0aW9uIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IHRoZSByZWZlcmVuY2UuIFRoZXkgYXJlIGFsbFxuICogc3RvcmVkIHByaW1hcmlseSBpbiBhIHNldCBzb3J0ZWQgYnkga2V5LiBBIGRvY3VtZW50IGlzIGNvbnNpZGVyZWQgZ2FyYmFnZSBpZlxuICogdGhlcmUncyBubyByZWZlcmVuY2VzIGluIHRoYXQgc2V0ICh0aGlzIGNhbiBiZSBlZmZpY2llbnRseSBjaGVja2VkIHRoYW5rcyB0b1xuICogc29ydGluZyBieSBrZXkpLlxuICpcbiAqIFJlZmVyZW5jZVNldCBhbHNvIGtlZXBzIGEgc2Vjb25kYXJ5IHNldCB0aGF0IGNvbnRhaW5zIHJlZmVyZW5jZXMgc29ydGVkIGJ5XG4gKiBJRHMuIFRoaXMgb25lIGlzIHVzZWQgdG8gZWZmaWNpZW50bHkgaW1wbGVtZW50IHJlbW92YWwgb2YgYWxsIHJlZmVyZW5jZXMgYnlcbiAqIHNvbWUgdGFyZ2V0IElELlxuICovIGNsYXNzIF9fUFJJVkFURV9SZWZlcmVuY2VTZXQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IGtleS5cbiAgICAgICAgdGhpcy5WciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX0RvY1JlZmVyZW5jZS5tciksIFxuICAgICAgICAvLyBBIHNldCBvZiBvdXRzdGFuZGluZyByZWZlcmVuY2VzIHRvIGEgZG9jdW1lbnQgc29ydGVkIGJ5IHRhcmdldCBpZC5cbiAgICAgICAgdGhpcy5nciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX0RvY1JlZmVyZW5jZS5wcik7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHRydWUgaWYgdGhlIHJlZmVyZW5jZSBzZXQgY29udGFpbnMgbm8gcmVmZXJlbmNlcy4gKi8gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuVnIuaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKiogQWRkcyBhIHJlZmVyZW5jZSB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5IGZvciB0aGUgZ2l2ZW4gSUQuICovICAgIGFkZFJlZmVyZW5jZShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShlLCB0KTtcbiAgICAgICAgdGhpcy5WciA9IHRoaXMuVnIuYWRkKG4pLCB0aGlzLmdyID0gdGhpcy5nci5hZGQobik7XG4gICAgfVxuICAgIC8qKiBBZGQgcmVmZXJlbmNlcyB0byB0aGUgZ2l2ZW4gZG9jdW1lbnQga2V5cyBmb3IgdGhlIGdpdmVuIElELiAqLyAgICB5cihlLCB0KSB7XG4gICAgICAgIGUuZm9yRWFjaCgoZSA9PiB0aGlzLmFkZFJlZmVyZW5jZShlLCB0KSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZW1vdmVzIGEgcmVmZXJlbmNlIHRvIHRoZSBnaXZlbiBkb2N1bWVudCBrZXkgZm9yIHRoZSBnaXZlblxuICAgICAqIElELlxuICAgICAqLyAgICByZW1vdmVSZWZlcmVuY2UoZSwgdCkge1xuICAgICAgICB0aGlzLndyKG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKGUsIHQpKTtcbiAgICB9XG4gICAgU3IoZSwgdCkge1xuICAgICAgICBlLmZvckVhY2goKGUgPT4gdGhpcy5yZW1vdmVSZWZlcmVuY2UoZSwgdCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2xlYXJzIGFsbCByZWZlcmVuY2VzIHdpdGggYSBnaXZlbiBJRC4gQ2FsbHMgcmVtb3ZlUmVmKCkgZm9yIGVhY2gga2V5XG4gICAgICogcmVtb3ZlZC5cbiAgICAgKi8gICAgYnIoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IERvY3VtZW50S2V5KG5ldyBSZXNvdXJjZVBhdGgoW10pKSwgbiA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQsIGUpLCByID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgZSArIDEpLCBpID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmdyLmZvckVhY2hJblJhbmdlKFsgbiwgciBdLCAoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLndyKGUpLCBpLnB1c2goZS5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIERyKCkge1xuICAgICAgICB0aGlzLlZyLmZvckVhY2goKGUgPT4gdGhpcy53cihlKSkpO1xuICAgIH1cbiAgICB3cihlKSB7XG4gICAgICAgIHRoaXMuVnIgPSB0aGlzLlZyLmRlbGV0ZShlKSwgdGhpcy5nciA9IHRoaXMuZ3IuZGVsZXRlKGUpO1xuICAgIH1cbiAgICB2cihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgRG9jdW1lbnRLZXkobmV3IFJlc291cmNlUGF0aChbXSkpLCBuID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgZSksIHIgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LCBlICsgMSk7XG4gICAgICAgIGxldCBpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIHJldHVybiB0aGlzLmdyLmZvckVhY2hJblJhbmdlKFsgbiwgciBdLCAoZSA9PiB7XG4gICAgICAgICAgICBpID0gaS5hZGQoZS5rZXkpO1xuICAgICAgICB9KSksIGk7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKGUsIDApLCBuID0gdGhpcy5Wci5maXJzdEFmdGVyT3JFcXVhbCh0KTtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IG4gJiYgZS5pc0VxdWFsKG4ua2V5KTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9Eb2NSZWZlcmVuY2Uge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5rZXkgPSBlLCB0aGlzLkNyID0gdDtcbiAgICB9XG4gICAgLyoqIENvbXBhcmUgYnkga2V5IHRoZW4gYnkgSUQgKi8gICAgc3RhdGljIG1yKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHQua2V5KSB8fCBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcihlLkNyLCB0LkNyKTtcbiAgICB9XG4gICAgLyoqIENvbXBhcmUgYnkgSUQgdGhlbiBieSBrZXkgKi8gICAgc3RhdGljIHByKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKGUuQ3IsIHQuQ3IpIHx8IERvY3VtZW50S2V5LmNvbXBhcmF0b3IoZS5rZXksIHQua2V5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNsYXNzIF9fUFJJVkFURV9NZW1vcnlNdXRhdGlvblF1ZXVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuaW5kZXhNYW5hZ2VyID0gZSwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSA9IHQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIHNldCBvZiBhbGwgbXV0YXRpb25zIHRoYXQgaGF2ZSBiZWVuIHNlbnQgYnV0IG5vdCB5ZXQgYmVlbiBhcHBsaWVkIHRvXG4gICAgICAgICAqIHRoZSBiYWNrZW5kLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tdXRhdGlvblF1ZXVlID0gW10sIFxuICAgICAgICAvKiogTmV4dCB2YWx1ZSB0byB1c2Ugd2hlbiBhc3NpZ25pbmcgc2VxdWVudGlhbCBJRHMgdG8gZWFjaCBtdXRhdGlvbiBiYXRjaC4gKi9cbiAgICAgICAgdGhpcy5GciA9IDEsIFxuICAgICAgICAvKiogQW4gb3JkZXJlZCBtYXBwaW5nIGJldHdlZW4gZG9jdW1lbnRzIGFuZCB0aGUgbXV0YXRpb25zIGJhdGNoIElEcy4gKi9cbiAgICAgICAgdGhpcy5NciA9IG5ldyBTb3J0ZWRTZXQoX19QUklWQVRFX0RvY1JlZmVyZW5jZS5tcik7XG4gICAgfVxuICAgIGNoZWNrRW1wdHkoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoMCA9PT0gdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCk7XG4gICAgfVxuICAgIGFkZE11dGF0aW9uQmF0Y2goZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gdGhpcy5GcjtcbiAgICAgICAgdGhpcy5GcisrLCB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoID4gMCAmJiB0aGlzLm11dGF0aW9uUXVldWVbdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCAtIDFdO1xuICAgICAgICBjb25zdCBzID0gbmV3IE11dGF0aW9uQmF0Y2goaSwgdCwgbiwgcik7XG4gICAgICAgIHRoaXMubXV0YXRpb25RdWV1ZS5wdXNoKHMpO1xuICAgICAgICAvLyBUcmFjayByZWZlcmVuY2VzIGJ5IGRvY3VtZW50IGtleSBhbmQgaW5kZXggY29sbGVjdGlvbiBwYXJlbnRzLlxuICAgICAgICBmb3IgKGNvbnN0IHQgb2YgcikgdGhpcy5NciA9IHRoaXMuTXIuYWRkKG5ldyBfX1BSSVZBVEVfRG9jUmVmZXJlbmNlKHQua2V5LCBpKSksIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCB0LmtleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShzKTtcbiAgICB9XG4gICAgbG9va3VwTXV0YXRpb25CYXRjaChlLCB0KSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLk9yKHQpKTtcbiAgICB9XG4gICAgZ2V0TmV4dE11dGF0aW9uQmF0Y2hBZnRlckJhdGNoSWQoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdCArIDEsIHIgPSB0aGlzLk5yKG4pLCBpID0gciA8IDAgPyAwIDogcjtcbiAgICAgICAgLy8gVGhlIHJlcXVlc3RlZCBiYXRjaElkIG1heSBzdGlsbCBiZSBvdXQgb2YgcmFuZ2Ugc28gbm9ybWFsaXplIGl0IHRvIHRoZVxuICAgICAgICAvLyBzdGFydCBvZiB0aGUgcXVldWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGggPiBpID8gdGhpcy5tdXRhdGlvblF1ZXVlW2ldIDogbnVsbCk7XG4gICAgfVxuICAgIGdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQoKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgwID09PSB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoID8gUSA6IHRoaXMuRnIgLSAxKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzKGUpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMubXV0YXRpb25RdWV1ZS5zbGljZSgpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UodCwgMCksIHIgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpLCBpID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLk1yLmZvckVhY2hJblJhbmdlKFsgbiwgciBdLCAoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5PcihlLkNyKTtcbiAgICAgICAgICAgIGkucHVzaCh0KTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShpKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nRG9jdW1lbnRLZXlzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2UoZSwgMCksIHIgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShlLCBOdW1iZXIuUE9TSVRJVkVfSU5GSU5JVFkpO1xuICAgICAgICAgICAgdGhpcy5Nci5mb3JFYWNoSW5SYW5nZShbIHQsIHIgXSwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIG4gPSBuLmFkZChlLkNyKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLkJyKG4pKTtcbiAgICB9XG4gICAgZ2V0QWxsTXV0YXRpb25CYXRjaGVzQWZmZWN0aW5nUXVlcnkoZSwgdCkge1xuICAgICAgICAvLyBVc2UgdGhlIHF1ZXJ5IHBhdGggYXMgYSBwcmVmaXggZm9yIHRlc3RpbmcgaWYgYSBkb2N1bWVudCBtYXRjaGVzIHRoZVxuICAgICAgICAvLyBxdWVyeS5cbiAgICAgICAgY29uc3QgbiA9IHQucGF0aCwgciA9IG4ubGVuZ3RoICsgMTtcbiAgICAgICAgLy8gQ29uc3RydWN0IGEgZG9jdW1lbnQgcmVmZXJlbmNlIGZvciBhY3R1YWxseSBzY2FubmluZyB0aGUgaW5kZXguIFVubGlrZVxuICAgICAgICAvLyB0aGUgcHJlZml4IHRoZSBkb2N1bWVudCBrZXkgaW4gdGhpcyByZWZlcmVuY2UgbXVzdCBoYXZlIGFuIGV2ZW4gbnVtYmVyIG9mXG4gICAgICAgIC8vIHNlZ21lbnRzLiBUaGUgZW1wdHkgc2VnbWVudCBjYW4gYmUgdXNlZCBhIHN1ZmZpeCBvZiB0aGUgcXVlcnkgcGF0aFxuICAgICAgICAvLyBiZWNhdXNlIGl0IHByZWNlZGVzIGFsbCBvdGhlciBzZWdtZW50cyBpbiBhbiBvcmRlcmVkIHRyYXZlcnNhbC5cbiAgICAgICAgbGV0IGkgPSBuO1xuICAgICAgICBEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGkpIHx8IChpID0gaS5jaGlsZChcIlwiKSk7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZShuZXcgRG9jdW1lbnRLZXkoaSksIDApO1xuICAgICAgICAvLyBGaW5kIHVuaXF1ZSBiYXRjaElEcyByZWZlcmVuY2VkIGJ5IGFsbCBkb2N1bWVudHMgcG90ZW50aWFsbHkgbWF0Y2hpbmcgdGhlXG4gICAgICAgIC8vIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIGxldCBvID0gbmV3IFNvcnRlZFNldChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcik7XG4gICAgICAgIHJldHVybiB0aGlzLk1yLmZvckVhY2hXaGlsZSgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5rZXkucGF0aDtcbiAgICAgICAgICAgIHJldHVybiAhIW4uaXNQcmVmaXhPZih0KSAmJiAoXG4gICAgICAgICAgICAvLyBSb3dzIHdpdGggZG9jdW1lbnQga2V5cyBtb3JlIHRoYW4gb25lIHNlZ21lbnQgbG9uZ2VyIHRoYW4gdGhlIHF1ZXJ5XG4gICAgICAgICAgICAvLyBwYXRoIGNhbid0IGJlIG1hdGNoZXMuIEZvciBleGFtcGxlLCBhIHF1ZXJ5IG9uICdyb29tcycgY2FuJ3QgbWF0Y2hcbiAgICAgICAgICAgIC8vIHRoZSBkb2N1bWVudCAvcm9vbXMvYWJjL21lc3NhZ2VzL3h5eC5cbiAgICAgICAgICAgIC8vIFRPRE8obWNnKTogd2UnbGwgbmVlZCBhIGRpZmZlcmVudCBzY2FubmVyIHdoZW4gd2UgaW1wbGVtZW50XG4gICAgICAgICAgICAvLyBhbmNlc3RvciBxdWVyaWVzLlxuICAgICAgICAgICAgdC5sZW5ndGggPT09IHIgJiYgKG8gPSBvLmFkZChlLkNyKSksICEwKTtcbiAgICAgICAgfSksIHMpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLkJyKG8pKTtcbiAgICB9XG4gICAgQnIoZSkge1xuICAgICAgICAvLyBDb25zdHJ1Y3QgYW4gYXJyYXkgb2YgbWF0Y2hpbmcgYmF0Y2hlcywgc29ydGVkIGJ5IGJhdGNoSUQgdG8gZW5zdXJlIHRoYXRcbiAgICAgICAgLy8gbXVsdGlwbGUgbXV0YXRpb25zIGFmZmVjdGluZyB0aGUgc2FtZSBkb2N1bWVudCBrZXkgYXJlIGFwcGxpZWQgaW4gb3JkZXIuXG4gICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5PcihlKTtcbiAgICAgICAgICAgIG51bGwgIT09IG4gJiYgdC5wdXNoKG4pO1xuICAgICAgICB9KSksIHQ7XG4gICAgfVxuICAgIHJlbW92ZU11dGF0aW9uQmF0Y2goZSwgdCkge1xuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCgwID09PSB0aGlzLkxyKHQuYmF0Y2hJZCwgXCJyZW1vdmVkXCIpKSwgdGhpcy5tdXRhdGlvblF1ZXVlLnNoaWZ0KCk7XG4gICAgICAgIGxldCBuID0gdGhpcy5NcjtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHQubXV0YXRpb25zLCAociA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gbmV3IF9fUFJJVkFURV9Eb2NSZWZlcmVuY2Uoci5rZXksIHQuYmF0Y2hJZCk7XG4gICAgICAgICAgICByZXR1cm4gbiA9IG4uZGVsZXRlKGkpLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLm1hcmtQb3RlbnRpYWxseU9ycGhhbmVkKGUsIHIua2V5KTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuTXIgPSBuO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHFuKGUpIHtcbiAgICAgICAgLy8gTm8tb3Agc2luY2UgdGhlIG1lbW9yeSBtdXRhdGlvbiBxdWV1ZSBkb2VzIG5vdCBtYWludGFpbiBhIHNlcGFyYXRlIGNhY2hlLlxuICAgIH1cbiAgICBjb250YWluc0tleShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RvY1JlZmVyZW5jZSh0LCAwKSwgciA9IHRoaXMuTXIuZmlyc3RBZnRlck9yRXF1YWwobik7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0LmlzRXF1YWwociAmJiByLmtleSkpO1xuICAgIH1cbiAgICBwZXJmb3JtQ29uc2lzdGVuY3lDaGVjayhlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm11dGF0aW9uUXVldWUubGVuZ3RoLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5kcyB0aGUgaW5kZXggb2YgdGhlIGdpdmVuIGJhdGNoSWQgaW4gdGhlIG11dGF0aW9uIHF1ZXVlIGFuZCBhc3NlcnRzIHRoYXRcbiAgICAgKiB0aGUgcmVzdWx0aW5nIGluZGV4IGlzIHdpdGhpbiB0aGUgYm91bmRzIG9mIHRoZSBxdWV1ZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBiYXRjaElkIC0gVGhlIGJhdGNoSWQgdG8gc2VhcmNoIGZvclxuICAgICAqIEBwYXJhbSBhY3Rpb24gLSBBIGRlc2NyaXB0aW9uIG9mIHdoYXQgdGhlIGNhbGxlciBpcyBkb2luZywgcGhyYXNlZCBpbiBwYXNzaXZlXG4gICAgICogZm9ybSAoZS5nLiBcImFja25vd2xlZGdlZFwiIGluIGEgcm91dGluZSB0aGF0IGFja25vd2xlZGdlcyBiYXRjaGVzKS5cbiAgICAgKi8gICAgTHIoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5OcihlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmluZHMgdGhlIGluZGV4IG9mIHRoZSBnaXZlbiBiYXRjaElkIGluIHRoZSBtdXRhdGlvbiBxdWV1ZS4gVGhpcyBvcGVyYXRpb25cbiAgICAgKiBpcyBPKDEpLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIGNvbXB1dGVkIGluZGV4IG9mIHRoZSBiYXRjaCB3aXRoIHRoZSBnaXZlbiBiYXRjaElkLCBiYXNlZCBvblxuICAgICAqIHRoZSBzdGF0ZSBvZiB0aGUgcXVldWUuIE5vdGUgdGhpcyBpbmRleCBjYW4gYmUgbmVnYXRpdmUgaWYgdGhlIHJlcXVlc3RlZFxuICAgICAqIGJhdGNoSWQgaGFzIGFscmVhZHkgYmVlbiByZW1vdmVkIGZyb20gdGhlIHF1ZXVlIG9yIHBhc3QgdGhlIGVuZCBvZiB0aGVcbiAgICAgKiBxdWV1ZSBpZiB0aGUgYmF0Y2hJZCBpcyBsYXJnZXIgdGhhbiB0aGUgbGFzdCBhZGRlZCBiYXRjaC5cbiAgICAgKi8gICAgTnIoZSkge1xuICAgICAgICBpZiAoMCA9PT0gdGhpcy5tdXRhdGlvblF1ZXVlLmxlbmd0aCkgXG4gICAgICAgIC8vIEFzIGFuIGluZGV4IHRoaXMgaXMgcGFzdCB0aGUgZW5kIG9mIHRoZSBxdWV1ZVxuICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgLy8gRXhhbWluZSB0aGUgZnJvbnQgb2YgdGhlIHF1ZXVlIHRvIGZpZ3VyZSBvdXQgdGhlIGRpZmZlcmVuY2UgYmV0d2VlbiB0aGVcbiAgICAgICAgLy8gYmF0Y2hJZCBhbmQgaW5kZXhlcyBpbiB0aGUgYXJyYXkuIE5vdGUgdGhhdCBzaW5jZSB0aGUgcXVldWUgaXMgb3JkZXJlZFxuICAgICAgICAvLyBieSBiYXRjaElkLCBpZiB0aGUgZmlyc3QgYmF0Y2ggaGFzIGEgbGFyZ2VyIGJhdGNoSWQgdGhlbiB0aGUgcmVxdWVzdGVkXG4gICAgICAgIC8vIGJhdGNoSWQgZG9lc24ndCBleGlzdCBpbiB0aGUgcXVldWUuXG4gICAgICAgICAgICAgICAgcmV0dXJuIGUgLSB0aGlzLm11dGF0aW9uUXVldWVbMF0uYmF0Y2hJZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSB2ZXJzaW9uIG9mIGxvb2t1cE11dGF0aW9uQmF0Y2ggdGhhdCBkb2Vzbid0IHJldHVybiBhIHByb21pc2UsIHRoaXMgbWFrZXNcbiAgICAgKiBvdGhlciBmdW5jdGlvbnMgdGhhdCB1c2VzIHRoaXMgY29kZSBlYXNpZXIgdG8gcmVhZCBhbmQgbW9yZSBlZmZpY2llbnQuXG4gICAgICovICAgIE9yKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuTnIoZSk7XG4gICAgICAgIGlmICh0IDwgMCB8fCB0ID49IHRoaXMubXV0YXRpb25RdWV1ZS5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgICByZXR1cm4gdGhpcy5tdXRhdGlvblF1ZXVlW3RdO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIHNtYWxsZXN0IHZhbHVlIHJlcHJlc2VudGFibGUgYnkgYSA2NC1iaXQgc2lnbmVkIGludGVnZXIgKGxvbmcpLlxuICovXG4vKipcbiAqIFRoZSBtZW1vcnktb25seSBSZW1vdGVEb2N1bWVudENhY2hlIGZvciBJbmRleGVkRGIuIFRvIGNvbnN0cnVjdCwgaW52b2tlXG4gKiBgbmV3TWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZSgpYC5cbiAqL1xuY2xhc3MgX19QUklWQVRFX01lbW9yeVJlbW90ZURvY3VtZW50Q2FjaGVJbXBsIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gc2l6ZXIgLSBVc2VkIHRvIGFzc2VzcyB0aGUgc2l6ZSBvZiBhIGRvY3VtZW50LiBGb3IgZWFnZXIgR0MsIHRoaXMgaXNcbiAgICAgKiBleHBlY3RlZCB0byBqdXN0IHJldHVybiAwIHRvIGF2b2lkIHVubmVjZXNzYXJpbHkgZG9pbmcgdGhlIHdvcmsgb2ZcbiAgICAgKiBjYWxjdWxhdGluZyB0aGUgc2l6ZS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua3IgPSBlLCBcbiAgICAgICAgLyoqIFVuZGVybHlpbmcgY2FjaGUgb2YgZG9jdW1lbnRzIGFuZCB0aGVpciByZWFkIHRpbWVzLiAqL1xuICAgICAgICB0aGlzLmRvY3MgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZG9jdW1lbnRFbnRyeU1hcCgpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuICAgICAgICB9KCksIFxuICAgICAgICAvKiogU2l6ZSBvZiBhbGwgY2FjaGVkIGRvY3VtZW50cy4gKi9cbiAgICAgICAgdGhpcy5zaXplID0gMDtcbiAgICB9XG4gICAgc2V0SW5kZXhNYW5hZ2VyKGUpIHtcbiAgICAgICAgdGhpcy5pbmRleE1hbmFnZXIgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGRzIHRoZSBzdXBwbGllZCBlbnRyeSB0byB0aGUgY2FjaGUgYW5kIHVwZGF0ZXMgdGhlIGNhY2hlIHNpemUgYXMgYXBwcm9wcmlhdGUuXG4gICAgICpcbiAgICAgKiBBbGwgY2FsbHMgb2YgYGFkZEVudHJ5YCAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYC5cbiAgICAgKi8gICAgYWRkRW50cnkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC5rZXksIHIgPSB0aGlzLmRvY3MuZ2V0KG4pLCBpID0gciA/IHIuc2l6ZSA6IDAsIHMgPSB0aGlzLmtyKHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5kb2NzID0gdGhpcy5kb2NzLmluc2VydChuLCB7XG4gICAgICAgICAgICBkb2N1bWVudDogdC5tdXRhYmxlQ29weSgpLFxuICAgICAgICAgICAgc2l6ZTogc1xuICAgICAgICB9KSwgdGhpcy5zaXplICs9IHMgLSBpLCB0aGlzLmluZGV4TWFuYWdlci5hZGRUb0NvbGxlY3Rpb25QYXJlbnRJbmRleChlLCBuLnBhdGgucG9wTGFzdCgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyB0aGUgc3BlY2lmaWVkIGVudHJ5IGZyb20gdGhlIGNhY2hlIGFuZCB1cGRhdGVzIHRoZSBjYWNoZSBzaXplIGFzIGFwcHJvcHJpYXRlLlxuICAgICAqXG4gICAgICogQWxsIGNhbGxzIG9mIGByZW1vdmVFbnRyeWAgYXJlIHJlcXVpcmVkIHRvIGdvIHRocm91Z2ggdGhlIFJlbW90ZURvY3VtZW50Q2hhbmdlQnVmZmVyXG4gICAgICogcmV0dXJuZWQgYnkgYG5ld0NoYW5nZUJ1ZmZlcigpYC5cbiAgICAgKi8gICAgcmVtb3ZlRW50cnkoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5kb2NzLmdldChlKTtcbiAgICAgICAgdCAmJiAodGhpcy5kb2NzID0gdGhpcy5kb2NzLnJlbW92ZShlKSwgdGhpcy5zaXplIC09IHQuc2l6ZSk7XG4gICAgfVxuICAgIGdldEVudHJ5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMuZG9jcy5nZXQodCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShuID8gbi5kb2N1bWVudC5tdXRhYmxlQ29weSgpIDogTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudCh0KSk7XG4gICAgfVxuICAgIGdldEVudHJpZXMoZSwgdCkge1xuICAgICAgICBsZXQgbiA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5kb2NzLmdldChlKTtcbiAgICAgICAgICAgIG4gPSBuLmluc2VydChlLCB0ID8gdC5kb2N1bWVudC5tdXRhYmxlQ29weSgpIDogTXV0YWJsZURvY3VtZW50Lm5ld0ludmFsaWREb2N1bWVudChlKSk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobik7XG4gICAgfVxuICAgIGdldERvY3VtZW50c01hdGNoaW5nUXVlcnkoZSwgdCwgbiwgcikge1xuICAgICAgICBsZXQgaSA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKTtcbiAgICAgICAgLy8gRG9jdW1lbnRzIGFyZSBvcmRlcmVkIGJ5IGtleSwgc28gd2UgY2FuIHVzZSBhIHByZWZpeCBzY2FuIHRvIG5hcnJvdyBkb3duXG4gICAgICAgIC8vIHRoZSBkb2N1bWVudHMgd2UgbmVlZCB0byBtYXRjaCB0aGUgcXVlcnkgYWdhaW5zdC5cbiAgICAgICAgICAgICAgICBjb25zdCBzID0gdC5wYXRoLCBvID0gbmV3IERvY3VtZW50S2V5KHMuY2hpbGQoXCJfX2lkLTkyMjMzNzIwMzY4NTQ3NzU4MDhfX1wiKSksIF8gPSB0aGlzLmRvY3MuZ2V0SXRlcmF0b3JGcm9tKG8pO1xuICAgICAgICAvLyBEb2N1bWVudCBrZXlzIGFyZSBvcmRlcmVkIGZpcnN0IGJ5IG51bWVyaWMgdmFsdWUgKFwiX19pZDxMb25nPl9fXCIpLFxuICAgICAgICAvLyB0aGVuIGxleGljb2dyYXBoaWNhbGx5IGJ5IHN0cmluZyB2YWx1ZS4gU3RhcnQgdGhlIGl0ZXJhdG9yIGF0IHRoZSBtaW5pbXVtXG4gICAgICAgIC8vIHBvc3NpYmxlIERvY3VtZW50IGtleSB2YWx1ZS5cbiAgICAgICAgICAgICAgICBmb3IgKDtfLmhhc05leHQoKTsgKSB7XG4gICAgICAgICAgICBjb25zdCB7a2V5OiBlLCB2YWx1ZToge2RvY3VtZW50OiBvfX0gPSBfLmdldE5leHQoKTtcbiAgICAgICAgICAgIGlmICghcy5pc1ByZWZpeE9mKGUucGF0aCkpIGJyZWFrO1xuICAgICAgICAgICAgZS5wYXRoLmxlbmd0aCA+IHMubGVuZ3RoICsgMSB8fCAoX19QUklWQVRFX2luZGV4T2Zmc2V0Q29tcGFyYXRvcihfX1BSSVZBVEVfbmV3SW5kZXhPZmZzZXRGcm9tRG9jdW1lbnQobyksIG4pIDw9IDAgfHwgKHIuaGFzKG8ua2V5KSB8fCBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzKHQsIG8pKSAmJiAoaSA9IGkuaW5zZXJ0KG8ua2V5LCBvLm11dGFibGVDb3B5KCkpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKGkpO1xuICAgIH1cbiAgICBnZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgLy8gVGhpcyBtZXRob2Qgc2hvdWxkIG9ubHkgYmUgY2FsbGVkIGZyb20gdGhlIEluZGV4QmFja2ZpbGxlciBpZiBwZXJzaXN0ZW5jZVxuICAgICAgICAvLyBpcyBlbmFibGVkLlxuICAgICAgICBmYWlsKCk7XG4gICAgfVxuICAgIHFyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMuZG9jcywgKGUgPT4gdChlKSkpO1xuICAgIH1cbiAgICBuZXdDaGFuZ2VCdWZmZXIoZSkge1xuICAgICAgICAvLyBgdHJhY2tSZW1vdmFsc2AgaXMgaWdub3JlcyBzaW5jZSB0aGUgTWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZSBrZWVwc1xuICAgICAgICAvLyBhIHNlcGFyYXRlIGNoYW5nZWxvZyBhbmQgZG9lcyBub3QgbmVlZCBzcGVjaWFsIGhhbmRsaW5nIGZvciByZW1vdmFscy5cbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIodGhpcyk7XG4gICAgfVxuICAgIGdldFNpemUoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5zaXplKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBtZW1vcnktb25seSBSZW1vdGVEb2N1bWVudENhY2hlLlxuICpcbiAqIEBwYXJhbSBzaXplciAtIFVzZWQgdG8gYXNzZXNzIHRoZSBzaXplIG9mIGEgZG9jdW1lbnQuIEZvciBlYWdlciBHQywgdGhpcyBpc1xuICogZXhwZWN0ZWQgdG8ganVzdCByZXR1cm4gMCB0byBhdm9pZCB1bm5lY2Vzc2FyaWx5IGRvaW5nIHRoZSB3b3JrIG9mXG4gKiBjYWxjdWxhdGluZyB0aGUgc2l6ZS5cbiAqL1xuLyoqXG4gKiBIYW5kbGVzIHRoZSBkZXRhaWxzIG9mIGFkZGluZyBhbmQgdXBkYXRpbmcgZG9jdW1lbnRzIGluIHRoZSBNZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5UmVtb3RlRG9jdW1lbnRDaGFuZ2VCdWZmZXIgZXh0ZW5kcyBSZW1vdGVEb2N1bWVudENoYW5nZUJ1ZmZlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLklyID0gZTtcbiAgICB9XG4gICAgYXBwbHlDaGFuZ2VzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5jaGFuZ2VzLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICByLmlzVmFsaWREb2N1bWVudCgpID8gdC5wdXNoKHRoaXMuSXIuYWRkRW50cnkoZSwgcikpIDogdGhpcy5Jci5yZW1vdmVFbnRyeShuKTtcbiAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcih0KTtcbiAgICB9XG4gICAgZ2V0RnJvbUNhY2hlKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSXIuZ2V0RW50cnkoZSwgdCk7XG4gICAgfVxuICAgIGdldEFsbEZyb21DYWNoZShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLklyLmdldEVudHJpZXMoZSwgdCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5VGFyZ2V0Q2FjaGUge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogTWFwcyBhIHRhcmdldCB0byB0aGUgZGF0YSBhYm91dCB0aGF0IHRhcmdldFxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5RciA9IG5ldyBPYmplY3RNYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5VGFyZ2V0KGUpKSwgX19QUklWQVRFX3RhcmdldEVxdWFscyksIFxuICAgICAgICAvKiogVGhlIGxhc3QgcmVjZWl2ZWQgc25hcHNob3QgdmVyc2lvbi4gKi9cbiAgICAgICAgdGhpcy5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gU25hcHNob3RWZXJzaW9uLm1pbigpLCBcbiAgICAgICAgLyoqIFRoZSBoaWdoZXN0IG51bWJlcmVkIHRhcmdldCBJRCBlbmNvdW50ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5oaWdoZXN0VGFyZ2V0SWQgPSAwLCBcbiAgICAgICAgLyoqIFRoZSBoaWdoZXN0IHNlcXVlbmNlIG51bWJlciBlbmNvdW50ZXJlZC4gKi9cbiAgICAgICAgdGhpcy4kciA9IDAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBvcmRlcmVkIGJpZGlyZWN0aW9uYWwgbWFwcGluZyBiZXR3ZWVuIGRvY3VtZW50cyBhbmQgdGhlIHJlbW90ZSB0YXJnZXRcbiAgICAgICAgICogSURzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5VciA9IG5ldyBfX1BSSVZBVEVfUmVmZXJlbmNlU2V0LCB0aGlzLnRhcmdldENvdW50ID0gMCwgdGhpcy5LciA9IF9fUFJJVkFURV9UYXJnZXRJZEdlbmVyYXRvci5VbigpO1xuICAgIH1cbiAgICBmb3JFYWNoVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUXIuZm9yRWFjaCgoKGUsIG4pID0+IHQobikpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZ2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLmxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24pO1xuICAgIH1cbiAgICBnZXRIaWdoZXN0U2VxdWVuY2VOdW1iZXIoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy4kcik7XG4gICAgfVxuICAgIGFsbG9jYXRlVGFyZ2V0SWQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oaWdoZXN0VGFyZ2V0SWQgPSB0aGlzLktyLm5leHQoKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy5oaWdoZXN0VGFyZ2V0SWQpO1xuICAgIH1cbiAgICBzZXRUYXJnZXRzTWV0YWRhdGEoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbiAmJiAodGhpcy5sYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uID0gbiksIHQgPiB0aGlzLiRyICYmICh0aGlzLiRyID0gdCksIFxuICAgICAgICBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICB6bihlKSB7XG4gICAgICAgIHRoaXMuUXIuc2V0KGUudGFyZ2V0LCBlKTtcbiAgICAgICAgY29uc3QgdCA9IGUudGFyZ2V0SWQ7XG4gICAgICAgIHQgPiB0aGlzLmhpZ2hlc3RUYXJnZXRJZCAmJiAodGhpcy5LciA9IG5ldyBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3IodCksIHRoaXMuaGlnaGVzdFRhcmdldElkID0gdCksIFxuICAgICAgICBlLnNlcXVlbmNlTnVtYmVyID4gdGhpcy4kciAmJiAodGhpcy4kciA9IGUuc2VxdWVuY2VOdW1iZXIpO1xuICAgIH1cbiAgICBhZGRUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuem4odCksIHRoaXMudGFyZ2V0Q291bnQgKz0gMSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlVGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnpuKHQpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVUYXJnZXREYXRhKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuUXIuZGVsZXRlKHQudGFyZ2V0KSwgdGhpcy5Vci5icih0LnRhcmdldElkKSwgdGhpcy50YXJnZXRDb3VudCAtPSAxLCBcbiAgICAgICAgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0cyhlLCB0LCBuKSB7XG4gICAgICAgIGxldCByID0gMDtcbiAgICAgICAgY29uc3QgaSA9IFtdO1xuICAgICAgICByZXR1cm4gdGhpcy5Rci5mb3JFYWNoKCgocywgbykgPT4ge1xuICAgICAgICAgICAgby5zZXF1ZW5jZU51bWJlciA8PSB0ICYmIG51bGwgPT09IG4uZ2V0KG8udGFyZ2V0SWQpICYmICh0aGlzLlFyLmRlbGV0ZShzKSwgaS5wdXNoKHRoaXMucmVtb3ZlTWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgby50YXJnZXRJZCkpLCBcbiAgICAgICAgICAgIHIrKyk7XG4gICAgICAgIH0pKSwgUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSkubmV4dCgoKCkgPT4gcikpO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDb3VudChlKSB7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSh0aGlzLnRhcmdldENvdW50KTtcbiAgICB9XG4gICAgZ2V0VGFyZ2V0RGF0YShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLlFyLmdldCh0KSB8fCBudWxsO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobik7XG4gICAgfVxuICAgIGFkZE1hdGNoaW5nS2V5cyhlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLlVyLnlyKHQsIG4pLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXMoZSwgdCwgbikge1xuICAgICAgICB0aGlzLlVyLlNyKHQsIG4pO1xuICAgICAgICBjb25zdCByID0gdGhpcy5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZSwgaSA9IFtdO1xuICAgICAgICByZXR1cm4gciAmJiB0LmZvckVhY2goKHQgPT4ge1xuICAgICAgICAgICAgaS5wdXNoKHIubWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkpO1xuICAgICAgICB9KSksIFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKGkpO1xuICAgIH1cbiAgICByZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLlVyLmJyKHQpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBnZXRNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLlVyLnZyKHQpO1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobik7XG4gICAgfVxuICAgIGNvbnRhaW5zS2V5KGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuVXIuY29udGFpbnNLZXkodCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBtZW1vcnktYmFja2VkIGluc3RhbmNlIG9mIFBlcnNpc3RlbmNlLiBEYXRhIGlzIHN0b3JlZCBvbmx5IGluIFJBTSBhbmRcbiAqIG5vdCBwZXJzaXN0ZWQgYWNyb3NzIHNlc3Npb25zLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5UGVyc2lzdGVuY2Uge1xuICAgIC8qKlxuICAgICAqIFRoZSBjb25zdHJ1Y3RvciBhY2NlcHRzIGEgZmFjdG9yeSBmb3IgY3JlYXRpbmcgYSByZWZlcmVuY2UgZGVsZWdhdGUuIFRoaXNcbiAgICAgKiBhbGxvd3MgYm90aCB0aGUgZGVsZWdhdGUgYW5kIHRoaXMgaW5zdGFuY2UgdG8gaGF2ZSBzdHJvbmcgcmVmZXJlbmNlcyB0b1xuICAgICAqIGVhY2ggb3RoZXIgd2l0aG91dCBoYXZpbmcgbnVsbGFibGUgZmllbGRzIHRoYXQgd291bGQgdGhlbiBuZWVkIHRvIGJlXG4gICAgICogY2hlY2tlZCBvciBhc3NlcnRlZCBvbiBldmVyeSBhY2Nlc3MuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLldyID0ge30sIHRoaXMub3ZlcmxheXMgPSB7fSwgdGhpcy5HciA9IG5ldyBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UoMCksIHRoaXMuenIgPSAhMSwgXG4gICAgICAgIHRoaXMuenIgPSAhMCwgdGhpcy5qciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5R2xvYmFsc0NhY2hlLCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gZSh0aGlzKSwgXG4gICAgICAgIHRoaXMuSHIgPSBuZXcgX19QUklWQVRFX01lbW9yeVRhcmdldENhY2hlKHRoaXMpO1xuICAgICAgICB0aGlzLmluZGV4TWFuYWdlciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5SW5kZXhNYW5hZ2VyLCB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3TWVtb3J5UmVtb3RlRG9jdW1lbnRDYWNoZShlKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlSZW1vdGVEb2N1bWVudENhY2hlSW1wbChlKTtcbiAgICAgICAgfSgoZSA9PiB0aGlzLnJlZmVyZW5jZURlbGVnYXRlLkpyKGUpKSksIHRoaXMuc2VyaWFsaXplciA9IG5ldyBfX1BSSVZBVEVfTG9jYWxTZXJpYWxpemVyKHQpLCBcbiAgICAgICAgdGhpcy5ZciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5QnVuZGxlQ2FjaGUodGhpcy5zZXJpYWxpemVyKTtcbiAgICB9XG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIC8vIE5vIGR1cmFibGUgc3RhdGUgdG8gZW5zdXJlIGlzIGNsb3NlZCBvbiBzaHV0ZG93bi5cbiAgICAgICAgcmV0dXJuIHRoaXMuenIgPSAhMSwgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIGdldCBzdGFydGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy56cjtcbiAgICB9XG4gICAgc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICBzZXROZXR3b3JrRW5hYmxlZCgpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGdldEluZGV4TWFuYWdlcihlKSB7XG4gICAgICAgIC8vIFdlIGRvIG5vdCBjdXJyZW50bHkgc3VwcG9ydCBpbmRpY2VzIGZvciBtZW1vcnkgcGVyc2lzdGVuY2UsIHNvIHdlIGNhblxuICAgICAgICAvLyByZXR1cm4gdGhlIHNhbWUgc2hhcmVkIGluc3RhbmNlIG9mIHRoZSBtZW1vcnkgaW5kZXggbWFuYWdlci5cbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhNYW5hZ2VyO1xuICAgIH1cbiAgICBnZXREb2N1bWVudE92ZXJsYXlDYWNoZShlKSB7XG4gICAgICAgIGxldCB0ID0gdGhpcy5vdmVybGF5c1tlLnRvS2V5KCldO1xuICAgICAgICByZXR1cm4gdCB8fCAodCA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5RG9jdW1lbnRPdmVybGF5Q2FjaGUsIHRoaXMub3ZlcmxheXNbZS50b0tleSgpXSA9IHQpLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgZ2V0TXV0YXRpb25RdWV1ZShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gdGhpcy5XcltlLnRvS2V5KCldO1xuICAgICAgICByZXR1cm4gbiB8fCAobiA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5TXV0YXRpb25RdWV1ZSh0LCB0aGlzLnJlZmVyZW5jZURlbGVnYXRlKSwgdGhpcy5XcltlLnRvS2V5KCldID0gbiksIFxuICAgICAgICBuO1xuICAgIH1cbiAgICBnZXRHbG9iYWxzQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmpyO1xuICAgIH1cbiAgICBnZXRUYXJnZXRDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSHI7XG4gICAgfVxuICAgIGdldFJlbW90ZURvY3VtZW50Q2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGU7XG4gICAgfVxuICAgIGdldEJ1bmRsZUNhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ZcjtcbiAgICB9XG4gICAgcnVuVHJhbnNhY3Rpb24oZSwgdCwgbikge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoXCJNZW1vcnlQZXJzaXN0ZW5jZVwiLCBcIlN0YXJ0aW5nIHRyYW5zYWN0aW9uOlwiLCBlKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfTWVtb3J5VHJhbnNhY3Rpb24odGhpcy5Hci5uZXh0KCkpO1xuICAgICAgICByZXR1cm4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5acigpLCBuKHIpLm5leHQoKGUgPT4gdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZS5YcihyKS5uZXh0KCgoKSA9PiBlKSkpKS50b1Byb21pc2UoKS50aGVuKChlID0+IChyLnJhaXNlT25Db21taXR0ZWRFdmVudCgpLCBcbiAgICAgICAgZSkpKTtcbiAgICB9XG4gICAgZWkoZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm9yKE9iamVjdC52YWx1ZXModGhpcy5XcikubWFwKChuID0+ICgpID0+IG4uY29udGFpbnNLZXkoZSwgdCkpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1lbW9yeSBwZXJzaXN0ZW5jZSBpcyBub3QgYWN0dWFsbHkgdHJhbnNhY3Rpb25hbCwgYnV0IGZ1dHVyZSBpbXBsZW1lbnRhdGlvbnNcbiAqIG1heSBoYXZlIHRyYW5zYWN0aW9uLXNjb3BlZCBzdGF0ZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTWVtb3J5VHJhbnNhY3Rpb24gZXh0ZW5kcyBQZXJzaXN0ZW5jZVRyYW5zYWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuY3VycmVudFNlcXVlbmNlTnVtYmVyID0gZTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlFYWdlckRlbGVnYXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSBlLCBcbiAgICAgICAgLyoqIFRyYWNrcyBhbGwgZG9jdW1lbnRzIHRoYXQgYXJlIGFjdGl2ZSBpbiBRdWVyeSB2aWV3cy4gKi9cbiAgICAgICAgdGhpcy50aSA9IG5ldyBfX1BSSVZBVEVfUmVmZXJlbmNlU2V0LCBcbiAgICAgICAgLyoqIFRoZSBsaXN0IG9mIGRvY3VtZW50cyB0aGF0IGFyZSBwb3RlbnRpYWxseSBHQ2VkIGFmdGVyIGVhY2ggdHJhbnNhY3Rpb24uICovXG4gICAgICAgIHRoaXMubmkgPSBudWxsO1xuICAgIH1cbiAgICBzdGF0aWMgcmkoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlFYWdlckRlbGVnYXRlKGUpO1xuICAgIH1cbiAgICBnZXQgaWkoKSB7XG4gICAgICAgIGlmICh0aGlzLm5pKSByZXR1cm4gdGhpcy5uaTtcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbiAgICBhZGRSZWZlcmVuY2UoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy50aS5hZGRSZWZlcmVuY2UobiwgdCksIHRoaXMuaWkuZGVsZXRlKG4udG9TdHJpbmcoKSksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVJlZmVyZW5jZShlLCB0LCBuKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRpLnJlbW92ZVJlZmVyZW5jZShuLCB0KSwgdGhpcy5paS5hZGQobi50b1N0cmluZygpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgbWFya1BvdGVudGlhbGx5T3JwaGFuZWQoZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5paS5hZGQodC50b1N0cmluZygpKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlVGFyZ2V0KGUsIHQpIHtcbiAgICAgICAgdGhpcy50aS5icih0LnRhcmdldElkKS5mb3JFYWNoKChlID0+IHRoaXMuaWkuYWRkKGUudG9TdHJpbmcoKSkpKTtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKTtcbiAgICAgICAgcmV0dXJuIG4uZ2V0TWF0Y2hpbmdLZXlzRm9yVGFyZ2V0SWQoZSwgdC50YXJnZXRJZCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBlLmZvckVhY2goKGUgPT4gdGhpcy5paS5hZGQoZS50b1N0cmluZygpKSkpO1xuICAgICAgICB9KSkubmV4dCgoKCkgPT4gbi5yZW1vdmVUYXJnZXREYXRhKGUsIHQpKSk7XG4gICAgfVxuICAgIFpyKCkge1xuICAgICAgICB0aGlzLm5pID0gbmV3IFNldDtcbiAgICB9XG4gICAgWHIoZSkge1xuICAgICAgICAvLyBSZW1vdmUgbmV3bHkgb3JwaGFuZWQgZG9jdW1lbnRzLlxuICAgICAgICBjb25zdCB0ID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCkubmV3Q2hhbmdlQnVmZmVyKCk7XG4gICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0aGlzLmlpLCAobiA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gRG9jdW1lbnRLZXkuZnJvbVBhdGgobik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zaShlLCByKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBlIHx8IHQucmVtb3ZlRW50cnkociwgU25hcHNob3RWZXJzaW9uLm1pbigpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+ICh0aGlzLm5pID0gbnVsbCwgdC5hcHBseShlKSkpKTtcbiAgICB9XG4gICAgdXBkYXRlTGltYm9Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNpKGUsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZSA/IHRoaXMuaWkuZGVsZXRlKHQudG9TdHJpbmcoKSkgOiB0aGlzLmlpLmFkZCh0LnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIEpyKGUpIHtcbiAgICAgICAgLy8gRm9yIGVhZ2VyIEdDLCB3ZSBkb24ndCBjYXJlIGFib3V0IHRoZSBkb2N1bWVudCBzaXplLCB0aGVyZSBhcmUgbm8gc2l6ZSB0aHJlc2hvbGRzLlxuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgc2koZSwgdCkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLm9yKFsgKCkgPT4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUodGhpcy50aS5jb250YWluc0tleSh0KSksICgpID0+IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5jb250YWluc0tleShlLCB0KSwgKCkgPT4gdGhpcy5wZXJzaXN0ZW5jZS5laShlLCB0KSBdKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlMcnVEZWxlZ2F0ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICB0aGlzLnBlcnNpc3RlbmNlID0gZSwgdGhpcy5vaSA9IG5ldyBPYmplY3RNYXAoKGUgPT4gX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChlLnBhdGgpKSwgKChlLCB0KSA9PiBlLmlzRXF1YWwodCkpKSwgXG4gICAgICAgIHRoaXMuZ2FyYmFnZUNvbGxlY3RvciA9IF9fUFJJVkFURV9uZXdMcnVHYXJiYWdlQ29sbGVjdG9yKHRoaXMsIHQpO1xuICAgIH1cbiAgICBzdGF0aWMgcmkoZSwgdCkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMcnVEZWxlZ2F0ZShlLCB0KTtcbiAgICB9XG4gICAgLy8gTm8tb3BzLCBwcmVzZW50IHNvIG1lbW9yeSBwZXJzaXN0ZW5jZSBkb2Vzbid0IGhhdmUgdG8gY2FyZSB3aGljaCBkZWxlZ2F0ZVxuICAgIC8vIGl0IGhhcy5cbiAgICBacigpIHt9XG4gICAgWHIoZSkge1xuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgZm9yRWFjaFRhcmdldChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFRhcmdldENhY2hlKCkuZm9yRWFjaFRhcmdldChlLCB0KTtcbiAgICB9XG4gICAgbnIoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5zcihlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5nZXRUYXJnZXRDb3VudChlKS5uZXh0KChlID0+IHQubmV4dCgodCA9PiBlICsgdCkpKSk7XG4gICAgfVxuICAgIHNyKGUpIHtcbiAgICAgICAgbGV0IHQgPSAwO1xuICAgICAgICByZXR1cm4gdGhpcy5ycihlLCAoZSA9PiB7XG4gICAgICAgICAgICB0Kys7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB0KSk7XG4gICAgfVxuICAgIHJyKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5mb3JFYWNoKHRoaXMub2ksICgobiwgcikgPT4gdGhpcy5hcihlLCBuLCByKS5uZXh0KChlID0+IGUgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogdChyKSkpKSk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldHMoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gdGhpcy5wZXJzaXN0ZW5jZS5nZXRUYXJnZXRDYWNoZSgpLnJlbW92ZVRhcmdldHMoZSwgdCwgbik7XG4gICAgfVxuICAgIHJlbW92ZU9ycGhhbmVkRG9jdW1lbnRzKGUsIHQpIHtcbiAgICAgICAgbGV0IG4gPSAwO1xuICAgICAgICBjb25zdCByID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCksIGkgPSByLm5ld0NoYW5nZUJ1ZmZlcigpO1xuICAgICAgICByZXR1cm4gci5xcihlLCAociA9PiB0aGlzLmFyKGUsIHIsIHQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgZSB8fCAobisrLCBpLnJlbW92ZUVudHJ5KHIsIFNuYXBzaG90VmVyc2lvbi5taW4oKSkpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBpLmFwcGx5KGUpKSkubmV4dCgoKCkgPT4gbikpO1xuICAgIH1cbiAgICBtYXJrUG90ZW50aWFsbHlPcnBoYW5lZChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9pLnNldCh0LCBlLmN1cnJlbnRTZXF1ZW5jZU51bWJlciksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIHJlbW92ZVRhcmdldChlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0LndpdGhTZXF1ZW5jZU51bWJlcihlLmN1cnJlbnRTZXF1ZW5jZU51bWJlcik7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFRhcmdldENhY2hlKCkudXBkYXRlVGFyZ2V0RGF0YShlLCBuKTtcbiAgICB9XG4gICAgYWRkUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2kuc2V0KG4sIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgcmVtb3ZlUmVmZXJlbmNlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub2kuc2V0KG4sIGUuY3VycmVudFNlcXVlbmNlTnVtYmVyKSwgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICB9XG4gICAgdXBkYXRlTGltYm9Eb2N1bWVudChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9pLnNldCh0LCBlLmN1cnJlbnRTZXF1ZW5jZU51bWJlciksIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIEpyKGUpIHtcbiAgICAgICAgbGV0IHQgPSBlLmtleS50b1N0cmluZygpLmxlbmd0aDtcbiAgICAgICAgcmV0dXJuIGUuaXNGb3VuZERvY3VtZW50KCkgJiYgKHQgKz0gX19QUklWQVRFX2VzdGltYXRlQnl0ZVNpemUoZS5kYXRhLnZhbHVlKSksIHQ7XG4gICAgfVxuICAgIGFyKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5vcihbICgpID0+IHRoaXMucGVyc2lzdGVuY2UuZWkoZSwgdCksICgpID0+IHRoaXMucGVyc2lzdGVuY2UuZ2V0VGFyZ2V0Q2FjaGUoKS5jb250YWluc0tleShlLCB0KSwgKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMub2kuZ2V0KHQpO1xuICAgICAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHZvaWQgMCAhPT0gZSAmJiBlID4gbik7XG4gICAgICAgIH0gXSk7XG4gICAgfVxuICAgIGdldENhY2hlU2l6ZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLmdldFJlbW90ZURvY3VtZW50Q2FjaGUoKS5nZXRTaXplKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKiBQZXJmb3JtcyBkYXRhYmFzZSBjcmVhdGlvbiBhbmQgc2NoZW1hIHVwZ3JhZGVzLiAqLyBjbGFzcyBfX1BSSVZBVEVfU2NoZW1hQ29udmVydGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBlcmZvcm1zIGRhdGFiYXNlIGNyZWF0aW9uIGFuZCBzY2hlbWEgdXBncmFkZXMuXG4gICAgICpcbiAgICAgKiBOb3RlIHRoYXQgaW4gcHJvZHVjdGlvbiwgdGhpcyBtZXRob2QgaXMgb25seSBldmVyIHVzZWQgdG8gdXBncmFkZSB0aGUgc2NoZW1hXG4gICAgICogdG8gU0NIRU1BX1ZFUlNJT04uIERpZmZlcmVudCB2YWx1ZXMgb2YgdG9WZXJzaW9uIGFyZSBvbmx5IHVzZWQgZm9yIHRlc3RpbmdcbiAgICAgKiBhbmQgbG9jYWwgZmVhdHVyZSBkZXZlbG9wbWVudC5cbiAgICAgKi8gICAgQihlLCB0LCBuLCByKSB7XG4gICAgICAgIGNvbnN0IGkgPSBuZXcgX19QUklWQVRFX1NpbXBsZURiVHJhbnNhY3Rpb24oXCJjcmVhdGVPclVwZ3JhZGVcIiwgdCk7XG4gICAgICAgIG4gPCAxICYmIHIgPj0gMSAmJiAoIWZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVQcmltYXJ5Q2xpZW50U3RvcmUoZSkge1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShLKTtcbiAgICAgICAgfShlKSwgZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZU11dGF0aW9uUXVldWUoZSkge1xuICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShHLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogelxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5jcmVhdGVPYmplY3RTdG9yZShqLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogSCxcbiAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB0LmNyZWF0ZUluZGV4KEosIFksIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICEwXG4gICAgICAgICAgICB9KSwgZS5jcmVhdGVPYmplY3RTdG9yZShYKTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIFVwZ3JhZGUgZnVuY3Rpb24gdG8gbWlncmF0ZSB0aGUgJ211dGF0aW9ucycgc3RvcmUgZnJvbSBWMSB0byBWMy4gTG9hZHNcbiAqIGFuZCByZXdyaXRlcyBhbGwgZGF0YS5cbiAqLyAoZSksIF9fUFJJVkFURV9jcmVhdGVRdWVyeUNhY2hlKGUpLCBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlTGVnYWN5UmVtb3RlRG9jdW1lbnRDYWNoZShlKSB7XG4gICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKFUpO1xuICAgICAgICB9KGUpKTtcbiAgICAgICAgLy8gTWlncmF0aW9uIDIgdG8gcG9wdWxhdGUgdGhlIHRhcmdldEdsb2JhbCBvYmplY3Qgbm8gbG9uZ2VyIG5lZWRlZCBzaW5jZVxuICAgICAgICAvLyBtaWdyYXRpb24gMyB1bmNvbmRpdGlvbmFsbHkgY2xlYXJzIGl0LlxuICAgICAgICAgICAgICAgIGxldCBzID0gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgcmV0dXJuIG4gPCAzICYmIHIgPj0gMyAmJiAoXG4gICAgICAgIC8vIEJyYW5kIG5ldyBjbGllbnRzIGRvbid0IG5lZWQgdG8gZHJvcCBhbmQgcmVjcmVhdGUtLW9ubHkgY2xpZW50cyB0aGF0XG4gICAgICAgIC8vIHBvdGVudGlhbGx5IGhhdmUgY29ycnVwdCBkYXRhLlxuICAgICAgICAwICE9PSBuICYmICghZnVuY3Rpb24gX19QUklWQVRFX2Ryb3BRdWVyeUNhY2hlKGUpIHtcbiAgICAgICAgICAgIGUuZGVsZXRlT2JqZWN0U3RvcmUobGUpLCBlLmRlbGV0ZU9iamVjdFN0b3JlKGFlKSwgZS5kZWxldGVPYmplY3RTdG9yZShFZSk7XG4gICAgICAgIH0oZSksIF9fUFJJVkFURV9jcmVhdGVRdWVyeUNhY2hlKGUpKSwgcyA9IHMubmV4dCgoKCkgPT4gXG4gICAgICAgIC8qKlxuICogQ3JlYXRlcyB0aGUgdGFyZ2V0IGdsb2JhbCBzaW5nbGV0b24gcm93LlxuICpcbiAqIEBwYXJhbSB0eG4gLSBUaGUgdmVyc2lvbiB1cGdyYWRlIHRyYW5zYWN0aW9uIGZvciBpbmRleGVkZGJcbiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfd3JpdGVFbXB0eVRhcmdldEdsb2JhbEVudHJ5KGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKEVlKSwgbiA9IHtcbiAgICAgICAgICAgICAgICBoaWdoZXN0VGFyZ2V0SWQ6IDAsXG4gICAgICAgICAgICAgICAgaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyOiAwLFxuICAgICAgICAgICAgICAgIGxhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb246IFNuYXBzaG90VmVyc2lvbi5taW4oKS50b1RpbWVzdGFtcCgpLFxuICAgICAgICAgICAgICAgIHRhcmdldENvdW50OiAwXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHQucHV0KEllLCBuKTtcbiAgICAgICAgfShpKSkpKSwgbiA8IDQgJiYgciA+PSA0ICYmICgwICE9PSBuICYmIChcbiAgICAgICAgLy8gU2NoZW1hIHZlcnNpb24gMyB1c2VzIGF1dG8tZ2VuZXJhdGVkIGtleXMgdG8gZ2VuZXJhdGUgZ2xvYmFsbHkgdW5pcXVlXG4gICAgICAgIC8vIG11dGF0aW9uIGJhdGNoIElEcyAodGhpcyB3YXMgcHJldmlvdXNseSBlbnN1cmVkIGludGVybmFsbHkgYnkgdGhlXG4gICAgICAgIC8vIGNsaWVudCkuIFRvIG1pZ3JhdGUgdG8gdGhlIG5ldyBzY2hlbWEsIHdlIGhhdmUgdG8gcmVhZCBhbGwgbXV0YXRpb25zXG4gICAgICAgIC8vIGFuZCB3cml0ZSB0aGVtIGJhY2sgb3V0LiBXZSBwcmVzZXJ2ZSB0aGUgZXhpc3RpbmcgYmF0Y2ggSURzIHRvIGd1YXJhbnRlZVxuICAgICAgICAvLyBjb25zaXN0ZW5jeSB3aXRoIG90aGVyIG9iamVjdCBzdG9yZXMuIEFueSBmdXJ0aGVyIG11dGF0aW9uIGJhdGNoIElEcyB3aWxsXG4gICAgICAgIC8vIGJlIGF1dG8tZ2VuZXJhdGVkLlxuICAgICAgICBzID0gcy5uZXh0KCgoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfdXBncmFkZU11dGF0aW9uQmF0Y2hTY2hlbWFBbmRNaWdyYXRlRGF0YShlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5zdG9yZShqKTtcbiAgICAgICAgICAgIHJldHVybiBuLkcoKS5uZXh0KChuID0+IHtcbiAgICAgICAgICAgICAgICBlLmRlbGV0ZU9iamVjdFN0b3JlKGopO1xuICAgICAgICAgICAgICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUoaiwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBILFxuICAgICAgICAgICAgICAgICAgICBhdXRvSW5jcmVtZW50OiAhMFxuICAgICAgICAgICAgICAgIH0pLmNyZWF0ZUluZGV4KEosIFksIHtcbiAgICAgICAgICAgICAgICAgICAgdW5pcXVlOiAhMFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSB0LnN0b3JlKGopLCBpID0gbi5tYXAoKGUgPT4gci5wdXQoZSkpKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IoaSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0oZSwgaSkpKSksIHMgPSBzLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgICFmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlQ2xpZW50TWV0YWRhdGFTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShSZSwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBWZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfShlKTtcbiAgICAgICAgfSkpKSwgbiA8IDUgJiYgciA+PSA1ICYmIChzID0gcy5uZXh0KCgoKSA9PiB0aGlzLl9pKGkpKSkpLCBuIDwgNiAmJiByID49IDYgJiYgKHMgPSBzLm5leHQoKCgpID0+IChmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlRG9jdW1lbnRHbG9iYWxTdG9yZShlKSB7XG4gICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKG9lKTtcbiAgICAgICAgfShlKSwgdGhpcy5haShpKSkpKSksIG4gPCA3ICYmIHIgPj0gNyAmJiAocyA9IHMubmV4dCgoKCkgPT4gdGhpcy51aShpKSkpKSwgbiA8IDggJiYgciA+PSA4ICYmIChzID0gcy5uZXh0KCgoKSA9PiB0aGlzLmNpKGUsIGkpKSkpLCBcbiAgICAgICAgbiA8IDkgJiYgciA+PSA5ICYmIChzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBNdWx0aS1UYWIgdXNlZCB0byBtYW5hZ2UgaXRzIG93biBjaGFuZ2Vsb2csIGJ1dCB0aGlzIGhhcyBiZWVuIG1vdmVkXG4gICAgICAgICAgICAvLyB0byB0aGUgRGJSZW1vdGVEb2N1bWVudCBvYmplY3Qgc3RvcmUgaXRzZWxmLiBTaW5jZSB0aGUgcHJldmlvdXMgY2hhbmdlXG4gICAgICAgICAgICAvLyBsb2cgb25seSBjb250YWluZWQgdHJhbnNpZW50IGRhdGEsIHdlIGNhbiBkcm9wIGl0cyBvYmplY3Qgc3RvcmUuXG4gICAgICAgICAgICAhZnVuY3Rpb24gX19QUklWQVRFX2Ryb3BSZW1vdGVEb2N1bWVudENoYW5nZXNTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5vYmplY3RTdG9yZU5hbWVzLmNvbnRhaW5zKFwicmVtb3RlRG9jdW1lbnRDaGFuZ2VzXCIpICYmIGUuZGVsZXRlT2JqZWN0U3RvcmUoXCJyZW1vdGVEb2N1bWVudENoYW5nZXNcIik7XG4gICAgICAgICAgICB9KGUpO1xuICAgICAgICAgICAgLy8gTm90ZTogU2NoZW1hIHZlcnNpb24gOSB1c2VkIHRvIGNyZWF0ZSBhIHJlYWQgdGltZSBpbmRleCBmb3IgdGhlXG4gICAgICAgICAgICAvLyBSZW1vdGVEb2N1bWVudENhY2hlLiBUaGlzIGlzIG5vdyBkb25lIHdpdGggc2NoZW1hIHZlcnNpb24gMTMuXG4gICAgICAgICAgICAgICAgfSkpKSwgbiA8IDEwICYmIHIgPj0gMTAgJiYgKHMgPSBzLm5leHQoKCgpID0+IHRoaXMubGkoaSkpKSksIG4gPCAxMSAmJiByID49IDExICYmIChzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUJ1bmRsZXNTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShtZSwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBmZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfShlKSwgZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZU5hbWVkUXVlcmllc1N0b3JlKGUpIHtcbiAgICAgICAgICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKGdlLCB7XG4gICAgICAgICAgICAgICAgICAgIGtleVBhdGg6IHBlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KGUpO1xuICAgICAgICB9KSkpLCBuIDwgMTIgJiYgciA+PSAxMiAmJiAocyA9IHMubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgIWZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVEb2N1bWVudE92ZXJsYXlTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IGUuY3JlYXRlT2JqZWN0U3RvcmUoQmUsIHtcbiAgICAgICAgICAgICAgICAgICAga2V5UGF0aDogTGVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0LmNyZWF0ZUluZGV4KGtlLCBxZSwge1xuICAgICAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICAgICAgfSksIHQuY3JlYXRlSW5kZXgoUWUsICRlLCB7XG4gICAgICAgICAgICAgICAgICAgIHVuaXF1ZTogITFcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0oZSk7XG4gICAgICAgIH0pKSksIG4gPCAxMyAmJiByID49IDEzICYmIChzID0gcy5uZXh0KCgoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlUmVtb3RlRG9jdW1lbnRDYWNoZShlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS5jcmVhdGVPYmplY3RTdG9yZShlZSwge1xuICAgICAgICAgICAgICAgIGtleVBhdGg6IHRlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHQuY3JlYXRlSW5kZXgobmUsIHJlKSwgdC5jcmVhdGVJbmRleChpZSwgc2UpO1xuICAgICAgICB9KGUpKSkubmV4dCgoKCkgPT4gdGhpcy5oaShlLCBpKSkpLm5leHQoKCgpID0+IGUuZGVsZXRlT2JqZWN0U3RvcmUoVSkpKSksIG4gPCAxNCAmJiByID49IDE0ICYmIChzID0gcy5uZXh0KCgoKSA9PiB0aGlzLlBpKGUsIGkpKSkpLCBcbiAgICAgICAgbiA8IDE1ICYmIHIgPj0gMTUgJiYgKHMgPSBzLm5leHQoKCgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9jcmVhdGVGaWVsZEluZGV4KGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNyZWF0ZU9iamVjdFN0b3JlKHllLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogd2UsXG4gICAgICAgICAgICAgICAgYXV0b0luY3JlbWVudDogITBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdC5jcmVhdGVJbmRleChTZSwgYmUsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLmNyZWF0ZU9iamVjdFN0b3JlKERlLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogdmVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbi5jcmVhdGVJbmRleChDZSwgRmUsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBlLmNyZWF0ZU9iamVjdFN0b3JlKE1lLCB7XG4gICAgICAgICAgICAgICAga2V5UGF0aDogeGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgci5jcmVhdGVJbmRleChPZSwgTmUsIHtcbiAgICAgICAgICAgICAgICB1bmlxdWU6ICExXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfShlKSkpKSwgbiA8IDE2ICYmIHIgPj0gMTYgJiYgKFxuICAgICAgICAvLyBDbGVhciB0aGUgb2JqZWN0IHN0b3JlcyB0byByZW1vdmUgcG9zc2libHkgY29ycnVwdGVkIGluZGV4IGVudHJpZXNcbiAgICAgICAgcyA9IHMubmV4dCgoKCkgPT4ge1xuICAgICAgICAgICAgdC5vYmplY3RTdG9yZShEZSkuY2xlYXIoKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIHQub2JqZWN0U3RvcmUoTWUpLmNsZWFyKCk7XG4gICAgICAgIH0pKSksIG4gPCAxNyAmJiByID49IDE3ICYmIChzID0gcy5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICAhZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZUdsb2JhbHNTdG9yZShlKSB7XG4gICAgICAgICAgICAgICAgZS5jcmVhdGVPYmplY3RTdG9yZShVZSwge1xuICAgICAgICAgICAgICAgICAgICBrZXlQYXRoOiBLZVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfShlKTtcbiAgICAgICAgfSkpKSwgcztcbiAgICB9XG4gICAgYWkoZSkge1xuICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgIHJldHVybiBlLnN0b3JlKFUpLlooKChlLCBuKSA9PiB7XG4gICAgICAgICAgICB0ICs9IF9fUFJJVkFURV9kYkRvY3VtZW50U2l6ZShuKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB7XG4gICAgICAgICAgICAgICAgYnl0ZVNpemU6IHRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gZS5zdG9yZShvZSkucHV0KF9lLCBuKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBfaShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKEcpLCBuID0gZS5zdG9yZShqKTtcbiAgICAgICAgcmV0dXJuIHQuRygpLm5leHQoKHQgPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IElEQktleVJhbmdlLmJvdW5kKFsgdC51c2VySWQsIFEgXSwgWyB0LnVzZXJJZCwgdC5sYXN0QWNrbm93bGVkZ2VkQmF0Y2hJZCBdKTtcbiAgICAgICAgICAgIHJldHVybiBuLkcoSiwgcikubmV4dCgobiA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChuLCAobiA9PiB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQobi51c2VySWQgPT09IHQudXNlcklkKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2Zyb21EYk11dGF0aW9uQmF0Y2godGhpcy5zZXJpYWxpemVyLCBuKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVtb3ZlTXV0YXRpb25CYXRjaChlLCB0LnVzZXJJZCwgcikubmV4dCgoKCkgPT4ge30pKTtcbiAgICAgICAgICAgIH0pKSkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5zdXJlcyB0aGF0IGV2ZXJ5IGRvY3VtZW50IGluIHRoZSByZW1vdGUgZG9jdW1lbnQgY2FjaGUgaGFzIGEgY29ycmVzcG9uZGluZyBzZW50aW5lbCByb3dcbiAgICAgKiB3aXRoIGEgc2VxdWVuY2UgbnVtYmVyLiBNaXNzaW5nIHJvd3MgYXJlIGdpdmVuIHRoZSBtb3N0IHJlY2VudGx5IHVzZWQgc2VxdWVuY2UgbnVtYmVyLlxuICAgICAqLyAgICB1aShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBlLnN0b3JlKGxlKSwgbiA9IGUuc3RvcmUoVSk7XG4gICAgICAgIHJldHVybiBlLnN0b3JlKEVlKS5nZXQoSWUpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIG4uWigoKG4sIGkpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gbmV3IFJlc291cmNlUGF0aChuKSwgbyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9zZW50aW5lbEtleShlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbIDAsIF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgoZSkgXTtcbiAgICAgICAgICAgICAgICB9KHMpO1xuICAgICAgICAgICAgICAgIHIucHVzaCh0LmdldChvKS5uZXh0KChuID0+IG4gPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpIDogKG4gPT4gdC5wdXQoe1xuICAgICAgICAgICAgICAgICAgICB0YXJnZXRJZDogMCxcbiAgICAgICAgICAgICAgICAgICAgcGF0aDogX19QUklWQVRFX2VuY29kZVJlc291cmNlUGF0aChuKSxcbiAgICAgICAgICAgICAgICAgICAgc2VxdWVuY2VOdW1iZXI6IGUuaGlnaGVzdExpc3RlblNlcXVlbmNlTnVtYmVyXG4gICAgICAgICAgICAgICAgfSkpKHMpKSkpO1xuICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHIpKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgY2koZSwgdCkge1xuICAgICAgICAvLyBDcmVhdGUgdGhlIGluZGV4LlxuICAgICAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKGRlLCB7XG4gICAgICAgICAgICBrZXlQYXRoOiBBZVxuICAgICAgICB9KTtcbiAgICAgICAgY29uc3QgbiA9IHQuc3RvcmUoZGUpLCByID0gbmV3IF9fUFJJVkFURV9NZW1vcnlDb2xsZWN0aW9uUGFyZW50SW5kZXgsIGFkZEVudHJ5ID0gZSA9PiB7XG4gICAgICAgICAgICBpZiAoci5hZGQoZSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZS5sYXN0U2VnbWVudCgpLCByID0gZS5wb3BMYXN0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucHV0KHtcbiAgICAgICAgICAgICAgICAgICAgY29sbGVjdGlvbklkOiB0LFxuICAgICAgICAgICAgICAgICAgICBwYXJlbnQ6IF9fUFJJVkFURV9lbmNvZGVSZXNvdXJjZVBhdGgocilcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgLy8gSGVscGVyIHRvIGFkZCBhbiBpbmRleCBlbnRyeSBpZmYgd2UgaGF2ZW4ndCBhbHJlYWR5IHdyaXR0ZW4gaXQuXG4gICAgICAgICAgICAgICAgLy8gSW5kZXggZXhpc3RpbmcgcmVtb3RlIGRvY3VtZW50cy5cbiAgICAgICAgcmV0dXJuIHQuc3RvcmUoVSkuWih7XG4gICAgICAgICAgICBZOiAhMFxuICAgICAgICB9LCAoKGUsIHQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgUmVzb3VyY2VQYXRoKGUpO1xuICAgICAgICAgICAgcmV0dXJuIGFkZEVudHJ5KG4ucG9wTGFzdCgpKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHQuc3RvcmUoWCkuWih7XG4gICAgICAgICAgICBZOiAhMFxuICAgICAgICB9LCAoKFtlLCB0LCBuXSwgcikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9kZWNvZGVSZXNvdXJjZVBhdGgodCk7XG4gICAgICAgICAgICByZXR1cm4gYWRkRW50cnkoaS5wb3BMYXN0KCkpO1xuICAgICAgICB9KSkpKTtcbiAgICB9XG4gICAgbGkoZSkge1xuICAgICAgICBjb25zdCB0ID0gZS5zdG9yZShhZSk7XG4gICAgICAgIHJldHVybiB0LlooKChlLCBuKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2Zyb21EYlRhcmdldChuKSwgaSA9IF9fUFJJVkFURV90b0RiVGFyZ2V0KHRoaXMuc2VyaWFsaXplciwgcik7XG4gICAgICAgICAgICByZXR1cm4gdC5wdXQoaSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgaGkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdC5zdG9yZShVKSwgciA9IFtdO1xuICAgICAgICByZXR1cm4gbi5aKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IHQuc3RvcmUoZWUpLCBzID0gZnVuY3Rpb24gX19QUklWQVRFX2V4dHJhY3RLZXkoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlLmRvY3VtZW50ID8gbmV3IERvY3VtZW50S2V5KFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKGUuZG9jdW1lbnQubmFtZSkucG9wRmlyc3QoNSkpIDogZS5ub0RvY3VtZW50ID8gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKGUubm9Eb2N1bWVudC5wYXRoKSA6IGUudW5rbm93bkRvY3VtZW50ID8gRG9jdW1lbnRLZXkuZnJvbVNlZ21lbnRzKGUudW5rbm93bkRvY3VtZW50LnBhdGgpIDogZmFpbCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKG4pLnBhdGgudG9BcnJheSgpLCBvID0ge1xuICAgICAgICAgICAgICAgIHByZWZpeFBhdGg6IHMuc2xpY2UoMCwgcy5sZW5ndGggLSAyKSxcbiAgICAgICAgICAgICAgICBjb2xsZWN0aW9uR3JvdXA6IHNbcy5sZW5ndGggLSAyXSxcbiAgICAgICAgICAgICAgICBkb2N1bWVudElkOiBzW3MubGVuZ3RoIC0gMV0sXG4gICAgICAgICAgICAgICAgcmVhZFRpbWU6IG4ucmVhZFRpbWUgfHwgWyAwLCAwIF0sXG4gICAgICAgICAgICAgICAgdW5rbm93bkRvY3VtZW50OiBuLnVua25vd25Eb2N1bWVudCxcbiAgICAgICAgICAgICAgICBub0RvY3VtZW50OiBuLm5vRG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQ6IG4uZG9jdW1lbnQsXG4gICAgICAgICAgICAgICAgaGFzQ29tbWl0dGVkTXV0YXRpb25zOiAhIW4uaGFzQ29tbWl0dGVkTXV0YXRpb25zXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgci5wdXNoKGkucHV0KG8pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IFBlcnNpc3RlbmNlUHJvbWlzZS53YWl0Rm9yKHIpKSk7XG4gICAgfVxuICAgIFBpKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHQuc3RvcmUoaiksIHIgPSBfX1BSSVZBVEVfbmV3SW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSh0aGlzLnNlcmlhbGl6ZXIpLCBpID0gbmV3IF9fUFJJVkFURV9NZW1vcnlQZXJzaXN0ZW5jZShfX1BSSVZBVEVfTWVtb3J5RWFnZXJEZWxlZ2F0ZS5yaSwgdGhpcy5zZXJpYWxpemVyLlR0KTtcbiAgICAgICAgcmV0dXJuIG4uRygpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBNYXA7XG4gICAgICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICB2YXIgdDtcbiAgICAgICAgICAgICAgICBsZXQgciA9IG51bGwgIT09ICh0ID0gbi5nZXQoZS51c2VySWQpKSAmJiB2b2lkIDAgIT09IHQgPyB0IDogX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2Zyb21EYk11dGF0aW9uQmF0Y2godGhpcy5zZXJpYWxpemVyLCBlKS5rZXlzKCkuZm9yRWFjaCgoZSA9PiByID0gci5hZGQoZSkpKSwgXG4gICAgICAgICAgICAgICAgbi5zZXQoZS51c2VySWQsIHIpO1xuICAgICAgICAgICAgfSkpLCBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChuLCAoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzID0gbmV3IFVzZXIobiksIG8gPSBfX1BSSVZBVEVfSW5kZXhlZERiRG9jdW1lbnRPdmVybGF5Q2FjaGUuSXQodGhpcy5zZXJpYWxpemVyLCBzKSwgXyA9IGkuZ2V0SW5kZXhNYW5hZ2VyKHMpLCBhID0gX19QUklWQVRFX0luZGV4ZWREYk11dGF0aW9uUXVldWUuSXQocywgdGhpcy5zZXJpYWxpemVyLCBfLCBpLnJlZmVyZW5jZURlbGVnYXRlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IExvY2FsRG9jdW1lbnRzVmlldyhyLCBhLCBvLCBfKS5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5c0ZvckRvY3VtZW50S2V5cyhuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uKHQsIF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZSksIGUpLm5leHQoKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NyZWF0ZVF1ZXJ5Q2FjaGUoZSkge1xuICAgIGUuY3JlYXRlT2JqZWN0U3RvcmUobGUsIHtcbiAgICAgICAga2V5UGF0aDogaGVcbiAgICB9KS5jcmVhdGVJbmRleChQZSwgVGUsIHtcbiAgICAgICAgdW5pcXVlOiAhMFxuICAgIH0pO1xuICAgIC8vIE5PVEU6IFRoaXMgaXMgdW5pcXVlIG9ubHkgYmVjYXVzZSB0aGUgVGFyZ2V0SWQgaXMgdGhlIHN1ZmZpeC5cbiAgICBlLmNyZWF0ZU9iamVjdFN0b3JlKGFlLCB7XG4gICAgICAgIGtleVBhdGg6IFwidGFyZ2V0SWRcIlxuICAgIH0pLmNyZWF0ZUluZGV4KHVlLCBjZSwge1xuICAgICAgICB1bmlxdWU6ICEwXG4gICAgfSksIGUuY3JlYXRlT2JqZWN0U3RvcmUoRWUpO1xufVxuXG5jb25zdCB2dCA9IFwiSW5kZXhlZERiUGVyc2lzdGVuY2VcIiwgQ3QgPSAxOGU1LCBGdCA9IDVlMywgTXQgPSBcIkZhaWxlZCB0byBvYnRhaW4gZXhjbHVzaXZlIGFjY2VzcyB0byB0aGUgcGVyc2lzdGVuY2UgbGF5ZXIuIFRvIGFsbG93IHNoYXJlZCBhY2Nlc3MsIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24gaGFzIHRvIGJlIGVuYWJsZWQgaW4gYWxsIHRhYnMuIElmIHlvdSBhcmUgdXNpbmcgYGV4cGVyaW1lbnRhbEZvcmNlT3duaW5nVGFiOnRydWVgLCBtYWtlIHN1cmUgdGhhdCBvbmx5IG9uZSB0YWIgaGFzIHBlcnNpc3RlbmNlIGVuYWJsZWQgYXQgYW55IGdpdmVuIHRpbWUuXCIsIHh0ID0gXCJtYWluXCI7XG5cbi8qKlxuICogT2xkZXN0IGFjY2VwdGFibGUgYWdlIGluIG1pbGxpc2Vjb25kcyBmb3IgY2xpZW50IG1ldGFkYXRhIGJlZm9yZSB0aGUgY2xpZW50XG4gKiBpcyBjb25zaWRlcmVkIGluYWN0aXZlIGFuZCBpdHMgYXNzb2NpYXRlZCBkYXRhIGlzIGdhcmJhZ2UgY29sbGVjdGVkLlxuICovXG4vKipcbiAqIEFuIEluZGV4ZWREQi1iYWNrZWQgaW5zdGFuY2Ugb2YgUGVyc2lzdGVuY2UuIERhdGEgaXMgc3RvcmVkIHBlcnNpc3RlbnRseVxuICogYWNyb3NzIHNlc3Npb25zLlxuICpcbiAqIE9uIFdlYiBvbmx5LCB0aGUgRmlyZXN0b3JlIFNES3Mgc3VwcG9ydCBzaGFyZWQgYWNjZXNzIHRvIGl0cyBwZXJzaXN0ZW5jZVxuICogbGF5ZXIuIFRoaXMgYWxsb3dzIG11bHRpcGxlIGJyb3dzZXIgdGFicyB0byByZWFkIGFuZCB3cml0ZSB0byBJbmRleGVkRGIgYW5kXG4gKiB0byBzeW5jaHJvbml6ZSBzdGF0ZSBldmVuIHdpdGhvdXQgbmV0d29yayBjb25uZWN0aXZpdHkuIFNoYXJlZCBhY2Nlc3MgaXNcbiAqIGN1cnJlbnRseSBvcHRpb25hbCBhbmQgbm90IGVuYWJsZWQgdW5sZXNzIGFsbCBjbGllbnRzIGludm9rZVxuICogYGVuYWJsZVBlcnNpc3RlbmNlKClgIHdpdGggYHtzeW5jaHJvbml6ZVRhYnM6dHJ1ZX1gLlxuICpcbiAqIEluIG11bHRpLXRhYiBtb2RlLCBpZiBtdWx0aXBsZSBjbGllbnRzIGFyZSBhY3RpdmUgYXQgdGhlIHNhbWUgdGltZSwgdGhlIFNES1xuICogd2lsbCBkZXNpZ25hdGUgb25lIGNsaWVudCBhcyB0aGUg4oCccHJpbWFyeSBjbGllbnTigJ0uIEFuIGVmZm9ydCBpcyBtYWRlIHRvIHBpY2tcbiAqIGEgdmlzaWJsZSwgbmV0d29yay1jb25uZWN0ZWQgYW5kIGFjdGl2ZSBjbGllbnQsIGFuZCB0aGlzIGNsaWVudCBpc1xuICogcmVzcG9uc2libGUgZm9yIGxldHRpbmcgb3RoZXIgY2xpZW50cyBrbm93IGFib3V0IGl0cyBwcmVzZW5jZS4gVGhlIHByaW1hcnlcbiAqIGNsaWVudCB3cml0ZXMgYSB1bmlxdWUgY2xpZW50LWdlbmVyYXRlZCBpZGVudGlmaWVyICh0aGUgY2xpZW50IElEKSB0b1xuICogSW5kZXhlZERi4oCZcyDigJxvd25lcuKAnSBzdG9yZSBldmVyeSA0IHNlY29uZHMuIElmIHRoZSBwcmltYXJ5IGNsaWVudCBmYWlscyB0b1xuICogdXBkYXRlIHRoaXMgZW50cnksIGFub3RoZXIgY2xpZW50IGNhbiBhY3F1aXJlIHRoZSBsZWFzZSBhbmQgdGFrZSBvdmVyIGFzXG4gKiBwcmltYXJ5LlxuICpcbiAqIFNvbWUgcGVyc2lzdGVuY2Ugb3BlcmF0aW9ucyBpbiB0aGUgU0RLIGFyZSBkZXNpZ25hdGVkIGFzIHByaW1hcnktY2xpZW50IG9ubHlcbiAqIG9wZXJhdGlvbnMuIFRoaXMgaW5jbHVkZXMgdGhlIGFja25vd2xlZGdtZW50IG9mIG11dGF0aW9ucyBhbmQgYWxsIHVwZGF0ZXMgb2ZcbiAqIHJlbW90ZSBkb2N1bWVudHMuIFRoZSBlZmZlY3RzIG9mIHRoZXNlIG9wZXJhdGlvbnMgYXJlIHdyaXR0ZW4gdG8gcGVyc2lzdGVuY2VcbiAqIGFuZCB0aGVuIGJyb2FkY2FzdCB0byBvdGhlciB0YWJzIHZpYSBMb2NhbFN0b3JhZ2UgKHNlZVxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWApLCB3aGljaCB0aGVuIHJlZnJlc2ggdGhlaXIgc3RhdGUgZnJvbVxuICogcGVyc2lzdGVuY2UuXG4gKlxuICogU2ltaWxhcmx5LCB0aGUgcHJpbWFyeSBjbGllbnQgbGlzdGVucyB0byBub3RpZmljYXRpb25zIHNlbnQgYnkgc2Vjb25kYXJ5XG4gKiBjbGllbnRzIHRvIGRpc2NvdmVyIHBlcnNpc3RlbmNlIGNoYW5nZXMgd3JpdHRlbiBieSBzZWNvbmRhcnkgY2xpZW50cywgc3VjaCBhc1xuICogdGhlIGFkZGl0aW9uIG9mIG5ldyBtdXRhdGlvbnMgYW5kIHF1ZXJ5IHRhcmdldHMuXG4gKlxuICogSWYgbXVsdGktdGFiIGlzIG5vdCBlbmFibGVkIGFuZCBhbm90aGVyIHRhYiBhbHJlYWR5IG9idGFpbmVkIHRoZSBwcmltYXJ5XG4gKiBsZWFzZSwgSW5kZXhlZERiUGVyc2lzdGVuY2UgZW50ZXJzIGEgZmFpbGVkIHN0YXRlIGFuZCBhbGwgc3Vic2VxdWVudFxuICogb3BlcmF0aW9ucyB3aWxsIGF1dG9tYXRpY2FsbHkgZmFpbC5cbiAqXG4gKiBBZGRpdGlvbmFsbHksIHRoZXJlIGlzIGFuIG9wdGltaXphdGlvbiBzbyB0aGF0IHdoZW4gYSB0YWIgaXMgY2xvc2VkLCB0aGVcbiAqIHByaW1hcnkgbGVhc2UgaXMgcmVsZWFzZWQgaW1tZWRpYXRlbHkgKHRoaXMgaXMgZXNwZWNpYWxseSBpbXBvcnRhbnQgdG8gbWFrZVxuICogc3VyZSB0aGF0IGEgcmVmcmVzaGVkIHRhYiBpcyBhYmxlIHRvIGltbWVkaWF0ZWx5IHJlLWFjcXVpcmUgdGhlIHByaW1hcnlcbiAqIGxlYXNlKS4gVW5mb3J0dW5hdGVseSwgSW5kZXhlZERCIGNhbm5vdCBiZSByZWxpYWJseSB1c2VkIGluIHdpbmRvdy51bmxvYWRcbiAqIHNpbmNlIGl0IGlzIGFuIGFzeW5jaHJvbm91cyBBUEkuIFNvIGluIGFkZGl0aW9uIHRvIGF0dGVtcHRpbmcgdG8gZ2l2ZSB1cCB0aGVcbiAqIGxlYXNlLCB0aGUgbGVhc2Vob2xkZXIgd3JpdGVzIGl0cyBjbGllbnQgSUQgdG8gYSBcInpvbWJpZWRDbGllbnRcIiBlbnRyeSBpblxuICogTG9jYWxTdG9yYWdlIHdoaWNoIGFjdHMgYXMgYW4gaW5kaWNhdG9yIHRoYXQgYW5vdGhlciB0YWIgc2hvdWxkIGdvIGFoZWFkIGFuZFxuICogdGFrZSB0aGUgcHJpbWFyeSBsZWFzZSBpbW1lZGlhdGVseSByZWdhcmRsZXNzIG9mIHRoZSBjdXJyZW50IGxlYXNlIHRpbWVzdGFtcC5cbiAqXG4gKiBUT0RPKGIvMTE0MjI2MjM0KTogUmVtb3ZlIGBzeW5jaHJvbml6ZVRhYnNgIHNlY3Rpb24gd2hlbiBtdWx0aS10YWIgaXMgbm9cbiAqIGxvbmdlciBvcHRpb25hbC5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0luZGV4ZWREYlBlcnNpc3RlbmNlIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBXaGV0aGVyIHRvIHN5bmNocm9uaXplIHRoZSBpbi1tZW1vcnkgc3RhdGUgb2YgbXVsdGlwbGUgdGFicyBhbmQgc2hhcmVcbiAgICAgKiBhY2Nlc3MgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gICAgICovXG4gICAgZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSwgXG4gICAgLyoqXG4gICAgICogSWYgc2V0IHRvIHRydWUsIGZvcmNlZnVsbHkgb2J0YWlucyBkYXRhYmFzZSBhY2Nlc3MuIEV4aXN0aW5nIHRhYnMgd2lsbFxuICAgICAqIG5vIGxvbmdlciBiZSBhYmxlIHRvIGFjY2VzcyBJbmRleGVkREIuXG4gICAgICovXG4gICAgdSwgYyA9IDE3KSB7XG4gICAgICAgIGlmICh0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uID0gZSwgdGhpcy5wZXJzaXN0ZW5jZUtleSA9IHQsIHRoaXMuY2xpZW50SWQgPSBuLCBcbiAgICAgICAgdGhpcy5UaSA9IGksIHRoaXMud2luZG93ID0gcywgdGhpcy5kb2N1bWVudCA9IG8sIHRoaXMuSWkgPSBhLCB0aGlzLkVpID0gdSwgdGhpcy5kaSA9IGMsIFxuICAgICAgICB0aGlzLkdyID0gbnVsbCwgdGhpcy56ciA9ICExLCB0aGlzLmlzUHJpbWFyeSA9ICExLCB0aGlzLm5ldHdvcmtFbmFibGVkID0gITAsIFxuICAgICAgICAvKiogT3VyIHdpbmRvdy51bmxvYWQgaGFuZGxlciwgaWYgcmVnaXN0ZXJlZC4gKi9cbiAgICAgICAgdGhpcy5BaSA9IG51bGwsIHRoaXMuaW5Gb3JlZ3JvdW5kID0gITEsIFxuICAgICAgICAvKiogT3VyICd2aXNpYmlsaXR5Y2hhbmdlJyBsaXN0ZW5lciBpZiByZWdpc3RlcmVkLiAqL1xuICAgICAgICB0aGlzLlJpID0gbnVsbCwgXG4gICAgICAgIC8qKiBUaGUgY2xpZW50IG1ldGFkYXRhIHJlZnJlc2ggdGFzay4gKi9cbiAgICAgICAgdGhpcy5WaSA9IG51bGwsIFxuICAgICAgICAvKiogVGhlIGxhc3QgdGltZSB3ZSBnYXJiYWdlIGNvbGxlY3RlZCB0aGUgY2xpZW50IG1ldGFkYXRhIG9iamVjdCBzdG9yZS4gKi9cbiAgICAgICAgdGhpcy5taSA9IE51bWJlci5ORUdBVElWRV9JTkZJTklUWSwgXG4gICAgICAgIC8qKiBBIGxpc3RlbmVyIHRvIG5vdGlmeSBvbiBwcmltYXJ5IHN0YXRlIGNoYW5nZXMuICovXG4gICAgICAgIHRoaXMuZmkgPSBlID0+IFByb21pc2UucmVzb2x2ZSgpLCAhX19QUklWQVRFX0luZGV4ZWREYlBlcnNpc3RlbmNlLkQoKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuVU5JTVBMRU1FTlRFRCwgXCJUaGlzIHBsYXRmb3JtIGlzIGVpdGhlciBtaXNzaW5nIEluZGV4ZWREQiBvciBpcyBrbm93biB0byBoYXZlIGFuIGluY29tcGxldGUgaW1wbGVtZW50YXRpb24uIE9mZmxpbmUgcGVyc2lzdGVuY2UgaGFzIGJlZW4gZGlzYWJsZWQuXCIpO1xuICAgICAgICB0aGlzLnJlZmVyZW5jZURlbGVnYXRlID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJMcnVEZWxlZ2F0ZUltcGwodGhpcywgciksIHRoaXMuZ2kgPSB0ICsgeHQsIFxuICAgICAgICB0aGlzLnNlcmlhbGl6ZXIgPSBuZXcgX19QUklWQVRFX0xvY2FsU2VyaWFsaXplcihfKSwgdGhpcy5waSA9IG5ldyBfX1BSSVZBVEVfU2ltcGxlRGIodGhpcy5naSwgdGhpcy5kaSwgbmV3IF9fUFJJVkFURV9TY2hlbWFDb252ZXJ0ZXIodGhpcy5zZXJpYWxpemVyKSksIFxuICAgICAgICB0aGlzLmpyID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJHbG9iYWxzQ2FjaGUsIHRoaXMuSHIgPSBuZXcgX19QUklWQVRFX0luZGV4ZWREYlRhcmdldENhY2hlKHRoaXMucmVmZXJlbmNlRGVsZWdhdGUsIHRoaXMuc2VyaWFsaXplciksIFxuICAgICAgICB0aGlzLnJlbW90ZURvY3VtZW50Q2FjaGUgPSBfX1BSSVZBVEVfbmV3SW5kZXhlZERiUmVtb3RlRG9jdW1lbnRDYWNoZSh0aGlzLnNlcmlhbGl6ZXIpLCBcbiAgICAgICAgdGhpcy5ZciA9IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiQnVuZGxlQ2FjaGUsIHRoaXMud2luZG93ICYmIHRoaXMud2luZG93LmxvY2FsU3RvcmFnZSA/IHRoaXMueWkgPSB0aGlzLndpbmRvdy5sb2NhbFN0b3JhZ2UgOiAodGhpcy55aSA9IG51bGwsIFxuICAgICAgICAhMSA9PT0gdSAmJiBfX1BSSVZBVEVfbG9nRXJyb3IodnQsIFwiTG9jYWxTdG9yYWdlIGlzIHVuYXZhaWxhYmxlLiBBcyBhIHJlc3VsdCwgcGVyc2lzdGVuY2UgbWF5IG5vdCB3b3JrIHJlbGlhYmx5LiBJbiBwYXJ0aWN1bGFyIGVuYWJsZVBlcnNpc3RlbmNlKCkgY291bGQgZmFpbCBpbW1lZGlhdGVseSBhZnRlciByZWZyZXNoaW5nIHRoZSBwYWdlLlwiKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEF0dGVtcHQgdG8gc3RhcnQgSW5kZXhlZERiIHBlcnNpc3RlbmNlLlxuICAgICAqXG4gICAgICogQHJldHVybnMgV2hldGhlciBwZXJzaXN0ZW5jZSB3YXMgZW5hYmxlZC5cbiAgICAgKi8gICAgc3RhcnQoKSB7XG4gICAgICAgIC8vIE5PVEU6IFRoaXMgaXMgZXhwZWN0ZWQgdG8gZmFpbCBzb21ldGltZXMgKGluIHRoZSBjYXNlIG9mIGFub3RoZXIgdGFiXG4gICAgICAgIC8vIGFscmVhZHkgaGF2aW5nIHRoZSBwZXJzaXN0ZW5jZSBsb2NrKSwgc28gaXQncyB0aGUgZmlyc3QgdGhpbmcgd2Ugc2hvdWxkXG4gICAgICAgIC8vIGRvLlxuICAgICAgICByZXR1cm4gdGhpcy53aSgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIGlmICghdGhpcy5pc1ByaW1hcnkgJiYgIXRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pIFxuICAgICAgICAgICAgLy8gRmFpbCBgc3RhcnQoKWAgaWYgYHN5bmNocm9uaXplVGFic2AgaXMgZGlzYWJsZWQgYW5kIHdlIGNhbm5vdFxuICAgICAgICAgICAgLy8gb2J0YWluIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuRkFJTEVEX1BSRUNPTkRJVElPTiwgTXQpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuU2koKSwgdGhpcy5iaSgpLCB0aGlzLkRpKCksIHRoaXMucnVuVHJhbnNhY3Rpb24oXCJnZXRIaWdoZXN0TGlzdGVuU2VxdWVuY2VOdW1iZXJcIiwgXCJyZWFkb25seVwiLCAoZSA9PiB0aGlzLkhyLmdldEhpZ2hlc3RTZXF1ZW5jZU51bWJlcihlKSkpO1xuICAgICAgICB9KSkudGhlbigoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLkdyID0gbmV3IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZShlLCB0aGlzLklpKTtcbiAgICAgICAgfSkpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuenIgPSAhMDtcbiAgICAgICAgfSkpLmNhdGNoKChlID0+ICh0aGlzLnBpICYmIHRoaXMucGkuY2xvc2UoKSwgUHJvbWlzZS5yZWplY3QoZSkpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVycyBhIGxpc3RlbmVyIHRoYXQgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgcHJpbWFyeSBzdGF0ZSBvZiB0aGVcbiAgICAgKiBpbnN0YW5jZSBjaGFuZ2VzLiBVcG9uIHJlZ2lzdGVyaW5nLCB0aGlzIGxpc3RlbmVyIGlzIGludm9rZWQgaW1tZWRpYXRlbHlcbiAgICAgKiB3aXRoIHRoZSBjdXJyZW50IHByaW1hcnkgc3RhdGUuXG4gICAgICpcbiAgICAgKiBQT1JUSU5HIE5PVEU6IFRoaXMgaXMgb25seSB1c2VkIGZvciBXZWIgbXVsdGktdGFiLlxuICAgICAqLyAgICBDaShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpID0gYXN5bmMgdCA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zdGFydGVkKSByZXR1cm4gZSh0KTtcbiAgICAgICAgfSwgZSh0aGlzLmlzUHJpbWFyeSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVycyBhIGxpc3RlbmVyIHRoYXQgZ2V0cyBjYWxsZWQgd2hlbiB0aGUgZGF0YWJhc2UgcmVjZWl2ZXMgYVxuICAgICAqIHZlcnNpb24gY2hhbmdlIGV2ZW50IGluZGljYXRpbmcgdGhhdCBpdCBoYXMgZGVsZXRlZC5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIHNldERhdGFiYXNlRGVsZXRlZExpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5waS5rKChhc3luYyB0ID0+IHtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIGFuIGF0dGVtcHQgaXMgbWFkZSB0byBkZWxldGUgSW5kZXhlZERCLlxuICAgICAgICAgICAgbnVsbCA9PT0gdC5uZXdWZXJzaW9uICYmIGF3YWl0IGUoKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGp1c3RzIHRoZSBjdXJyZW50IG5ldHdvcmsgc3RhdGUgaW4gdGhlIGNsaWVudCdzIG1ldGFkYXRhLCBwb3RlbnRpYWxseVxuICAgICAqIGFmZmVjdGluZyB0aGUgcHJpbWFyeSBsZWFzZS5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIHNldE5ldHdvcmtFbmFibGVkKGUpIHtcbiAgICAgICAgdGhpcy5uZXR3b3JrRW5hYmxlZCAhPT0gZSAmJiAodGhpcy5uZXR3b3JrRW5hYmxlZCA9IGUsIFxuICAgICAgICAvLyBTY2hlZHVsZSBhIHByaW1hcnkgbGVhc2UgcmVmcmVzaCBmb3IgaW1tZWRpYXRlIGV4ZWN1dGlvbi4gVGhlIGV2ZW50dWFsXG4gICAgICAgIC8vIGxlYXNlIHVwZGF0ZSB3aWxsIGJlIHByb3BhZ2F0ZWQgdmlhIGBwcmltYXJ5U3RhdGVMaXN0ZW5lcmAuXG4gICAgICAgIHRoaXMuVGkuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5zdGFydGVkICYmIGF3YWl0IHRoaXMud2koKTtcbiAgICAgICAgfSkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgY2xpZW50IG1ldGFkYXRhIGluIEluZGV4ZWREYiBhbmQgYXR0ZW1wdHMgdG8gZWl0aGVyIG9idGFpbiBvclxuICAgICAqIGV4dGVuZCB0aGUgcHJpbWFyeSBsZWFzZSBmb3IgdGhlIGxvY2FsIGNsaWVudC4gQXN5bmNocm9ub3VzbHkgbm90aWZpZXMgdGhlXG4gICAgICogcHJpbWFyeSBzdGF0ZSBsaXN0ZW5lciBpZiB0aGUgY2xpZW50IGVpdGhlciBuZXdseSBvYnRhaW5lZCBvciByZWxlYXNlZCBpdHNcbiAgICAgKiBwcmltYXJ5IGxlYXNlLlxuICAgICAqLyAgICB3aSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucnVuVHJhbnNhY3Rpb24oXCJ1cGRhdGVDbGllbnRNZXRhZGF0YUFuZFRyeUJlY29tZVByaW1hcnlcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gX19QUklWQVRFX2NsaWVudE1ldGFkYXRhU3RvcmUoZSkucHV0KHtcbiAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpLFxuICAgICAgICAgICAgbmV0d29ya0VuYWJsZWQ6IHRoaXMubmV0d29ya0VuYWJsZWQsXG4gICAgICAgICAgICBpbkZvcmVncm91bmQ6IHRoaXMuaW5Gb3JlZ3JvdW5kXG4gICAgICAgIH0pLm5leHQoKCgpID0+IHtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzUHJpbWFyeSkgcmV0dXJuIHRoaXMuRmkoZSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgZSB8fCAodGhpcy5pc1ByaW1hcnkgPSAhMSwgdGhpcy5UaS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmZpKCExKSkpKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IHRoaXMuTWkoZSkpKS5uZXh0KCh0ID0+IHRoaXMuaXNQcmltYXJ5ICYmICF0ID8gdGhpcy54aShlKS5uZXh0KCgoKSA9PiAhMSkpIDogISF0ICYmIHRoaXMuT2koZSkubmV4dCgoKCkgPT4gITApKSkpKSkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgaWYgKF9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSkpIFxuICAgICAgICAgICAgLy8gUHJvY2VlZCB3aXRoIHRoZSBleGlzdGluZyBzdGF0ZS4gQW55IHN1YnNlcXVlbnQgYWNjZXNzIHRvXG4gICAgICAgICAgICAvLyBJbmRleGVkREIgd2lsbCB2ZXJpZnkgdGhlIGxlYXNlLlxuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1Zyh2dCwgXCJGYWlsZWQgdG8gZXh0ZW5kIG93bmVyIGxlYXNlOiBcIiwgZSksIHRoaXMuaXNQcmltYXJ5O1xuICAgICAgICAgICAgaWYgKCF0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uKSB0aHJvdyBlO1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1Zyh2dCwgXCJSZWxlYXNpbmcgb3duZXIgbGVhc2UgYWZ0ZXIgZXJyb3IgZHVyaW5nIGxlYXNlIHJlZnJlc2hcIiwgZSksIFxuICAgICAgICAgICAgLyogaXNQcmltYXJ5PSAqLyAhMTtcbiAgICAgICAgfSkpLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnkgIT09IGUgJiYgdGhpcy5UaS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmZpKGUpKSksIHRoaXMuaXNQcmltYXJ5ID0gZTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBGaShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLmdldChXKS5uZXh0KChlID0+IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHRoaXMuTmkoZSkpKSk7XG4gICAgfVxuICAgIEJpKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9jbGllbnRNZXRhZGF0YVN0b3JlKGUpLmRlbGV0ZSh0aGlzLmNsaWVudElkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGdhcmJhZ2UgY29sbGVjdGlvbiB0aHJlc2hvbGQgaGFzIHBhc3NlZCwgcHJ1bmVzIHRoZVxuICAgICAqIFJlbW90ZURvY3VtZW50Q2hhbmdlcyBhbmQgdGhlIENsaWVudE1ldGFkYXRhIHN0b3JlIGJhc2VkIG9uIHRoZSBsYXN0IHVwZGF0ZVxuICAgICAqIHRpbWUgb2YgYWxsIGNsaWVudHMuXG4gICAgICovICAgIGFzeW5jIExpKCkge1xuICAgICAgICBpZiAodGhpcy5pc1ByaW1hcnkgJiYgIXRoaXMua2kodGhpcy5taSwgQ3QpKSB7XG4gICAgICAgICAgICB0aGlzLm1pID0gRGF0ZS5ub3coKTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBhd2FpdCB0aGlzLnJ1blRyYW5zYWN0aW9uKFwibWF5YmVHYXJiYWdlQ29sbGVjdE11bHRpQ2xpZW50U3RhdGVcIiwgXCJyZWFkd3JpdGUtcHJpbWFyeVwiLCAoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9nZXRTdG9yZShlLCBSZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQuRygpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBuID0gdGhpcy5xaShlLCBDdCksIHIgPSBlLmZpbHRlcigoZSA9PiAtMSA9PT0gbi5pbmRleE9mKGUpKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIERlbGV0ZSBtZXRhZGF0YSBmb3IgY2xpZW50cyB0aGF0IGFyZSBubyBsb25nZXIgY29uc2lkZXJlZCBhY3RpdmUuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaChyLCAoZSA9PiB0LmRlbGV0ZShlLmNsaWVudElkKSkpLm5leHQoKCgpID0+IHIpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSkuY2F0Y2goKCgpID0+IFtdKSk7XG4gICAgICAgICAgICAvLyBEZWxldGUgcG90ZW50aWFsIGxlZnRvdmVyIGVudHJpZXMgdGhhdCBtYXkgY29udGludWUgdG8gbWFyayB0aGVcbiAgICAgICAgICAgIC8vIGluYWN0aXZlIGNsaWVudHMgYXMgem9tYmllZCBpbiBMb2NhbFN0b3JhZ2UuXG4gICAgICAgICAgICAvLyBJZGVhbGx5IHdlJ2QgZGVsZXRlIHRoZSBJbmRleGVkRGIgYW5kIExvY2FsU3RvcmFnZSB6b21iaWUgZW50cmllcyBmb3JcbiAgICAgICAgICAgIC8vIHRoZSBjbGllbnQgYXRvbWljYWxseSwgYnV0IHdlIGNhbid0LiBTbyB3ZSBvcHQgdG8gZGVsZXRlIHRoZSBJbmRleGVkRGJcbiAgICAgICAgICAgIC8vIGVudHJpZXMgZmlyc3QgdG8gYXZvaWQgcG90ZW50aWFsbHkgcmV2aXZpbmcgYSB6b21iaWVkIGNsaWVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnlpKSBmb3IgKGNvbnN0IHQgb2YgZSkgdGhpcy55aS5yZW1vdmVJdGVtKHRoaXMuUWkodC5jbGllbnRJZCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNjaGVkdWxlcyBhIHJlY3VycmluZyB0aW1lciB0byB1cGRhdGUgdGhlIGNsaWVudCBtZXRhZGF0YSBhbmQgdG8gZWl0aGVyXG4gICAgICogZXh0ZW5kIG9yIGFjcXVpcmUgdGhlIHByaW1hcnkgbGVhc2UgaWYgdGhlIGNsaWVudCBpcyBlbGlnaWJsZS5cbiAgICAgKi8gICAgRGkoKSB7XG4gICAgICAgIHRoaXMuVmkgPSB0aGlzLlRpLmVucXVldWVBZnRlckRlbGF5KFwiY2xpZW50X21ldGFkYXRhX3JlZnJlc2hcIiAvKiBUaW1lcklkLkNsaWVudE1ldGFkYXRhUmVmcmVzaCAqLyAsIDRlMywgKCgpID0+IHRoaXMud2koKS50aGVuKCgoKSA9PiB0aGlzLkxpKCkpKS50aGVuKCgoKSA9PiB0aGlzLkRpKCkpKSkpO1xuICAgIH1cbiAgICAvKiogQ2hlY2tzIHdoZXRoZXIgYGNsaWVudGAgaXMgdGhlIGxvY2FsIGNsaWVudC4gKi8gICAgTmkoZSkge1xuICAgICAgICByZXR1cm4gISFlICYmIGUub3duZXJJZCA9PT0gdGhpcy5jbGllbnRJZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXZhbHVhdGUgdGhlIHN0YXRlIG9mIGFsbCBhY3RpdmUgY2xpZW50cyBhbmQgZGV0ZXJtaW5lIHdoZXRoZXIgdGhlIGxvY2FsXG4gICAgICogY2xpZW50IGlzIG9yIGNhbiBhY3QgYXMgdGhlIGhvbGRlciBvZiB0aGUgcHJpbWFyeSBsZWFzZS4gUmV0dXJucyB3aGV0aGVyXG4gICAgICogdGhlIGNsaWVudCBpcyBlbGlnaWJsZSBmb3IgdGhlIGxlYXNlLCBidXQgZG9lcyBub3QgYWN0dWFsbHkgYWNxdWlyZSBpdC5cbiAgICAgKiBNYXkgcmV0dXJuICdmYWxzZScgZXZlbiBpZiB0aGVyZSBpcyBubyBhY3RpdmUgbGVhc2Vob2xkZXIgYW5kIGFub3RoZXJcbiAgICAgKiAoZm9yZWdyb3VuZCkgY2xpZW50IHNob3VsZCBiZWNvbWUgbGVhc2Vob2xkZXIgaW5zdGVhZC5cbiAgICAgKi8gICAgTWkoZSkge1xuICAgICAgICBpZiAodGhpcy5FaSkgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKCEwKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltYXJ5Q2xpZW50U3RvcmUoZSkuZ2V0KFcpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgLy8gQSBjbGllbnQgaXMgZWxpZ2libGUgZm9yIHRoZSBwcmltYXJ5IGxlYXNlIGlmOlxuICAgICAgICAgICAgLy8gLSBpdHMgbmV0d29yayBpcyBlbmFibGVkIGFuZCB0aGUgY2xpZW50J3MgdGFiIGlzIGluIHRoZSBmb3JlZ3JvdW5kLlxuICAgICAgICAgICAgLy8gLSBpdHMgbmV0d29yayBpcyBlbmFibGVkIGFuZCBubyBvdGhlciBjbGllbnQncyB0YWIgaXMgaW4gdGhlXG4gICAgICAgICAgICAvLyAgIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIGV2ZXJ5IGNsaWVudHMgbmV0d29yayBpcyBkaXNhYmxlZCBhbmQgdGhlIGNsaWVudCdzIHRhYiBpcyBpbiB0aGVcbiAgICAgICAgICAgIC8vICAgZm9yZWdyb3VuZC5cbiAgICAgICAgICAgIC8vIC0gZXZlcnkgY2xpZW50cyBuZXR3b3JrIGlzIGRpc2FibGVkIGFuZCBubyBvdGhlciBjbGllbnQncyB0YWIgaXMgaW5cbiAgICAgICAgICAgIC8vICAgdGhlIGZvcmVncm91bmQuXG4gICAgICAgICAgICAvLyAtIHRoZSBgZm9yY2VPd25pbmdUYWJgIHNldHRpbmcgd2FzIHBhc3NlZCBpbi5cbiAgICAgICAgICAgIGlmIChudWxsICE9PSB0ICYmIHRoaXMua2kodC5sZWFzZVRpbWVzdGFtcE1zLCBGdCkgJiYgIXRoaXMuJGkodC5vd25lcklkKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLk5pKHQpICYmIHRoaXMubmV0d29ya0VuYWJsZWQpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuTmkodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCF0LmFsbG93VGFiU3luY2hyb25pemF0aW9uKSBcbiAgICAgICAgICAgICAgICAgICAgLy8gRmFpbCB0aGUgYGNhbkFjdEFzUHJpbWFyeWAgY2hlY2sgaWYgdGhlIGN1cnJlbnQgbGVhc2Vob2xkZXIgaGFzXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vdCBvcHRlZCBpbnRvIG11bHRpLXRhYiBzeW5jaHJvbml6YXRpb24uIElmIHRoaXMgaGFwcGVucyBhdFxuICAgICAgICAgICAgICAgICAgICAvLyBjbGllbnQgc3RhcnR1cCwgd2UgcmVqZWN0IHRoZSBQcm9taXNlIHJldHVybmVkIGJ5XG4gICAgICAgICAgICAgICAgICAgIC8vIGBlbmFibGVQZXJzaXN0ZW5jZSgpYCBhbmQgdGhlIHVzZXIgY2FuIGNvbnRpbnVlIHRvIHVzZSBGaXJlc3RvcmVcbiAgICAgICAgICAgICAgICAgICAgLy8gd2l0aCBpbi1tZW1vcnkgcGVyc2lzdGVuY2UuXG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgZmFpbHMgZHVyaW5nIGEgbGVhc2UgcmVmcmVzaCwgd2Ugd2lsbCBpbnN0ZWFkIGJsb2NrIHRoZVxuICAgICAgICAgICAgICAgICAgICAvLyBBc3luY1F1ZXVlIGZyb20gZXhlY3V0aW5nIGZ1cnRoZXIgb3BlcmF0aW9ucy4gTm90ZSB0aGF0IHRoaXMgaXNcbiAgICAgICAgICAgICAgICAgICAgLy8gYWNjZXB0YWJsZSBzaW5jZSBtaXhpbmcgJiBtYXRjaGluZyBkaWZmZXJlbnQgYHN5bmNocm9uaXplVGFic2BcbiAgICAgICAgICAgICAgICAgICAgLy8gc2V0dGluZ3MgaXMgbm90IHN1cHBvcnRlZC5cbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyhiLzExNDIyNjIzNCk6IFJlbW92ZSB0aGlzIGNoZWNrIHdoZW4gYHN5bmNocm9uaXplVGFic2AgY2FuXG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGxvbmdlciBiZSB0dXJuZWQgb2ZmLlxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5GQUlMRURfUFJFQ09ORElUSU9OLCBNdCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAhMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gISghdGhpcy5uZXR3b3JrRW5hYmxlZCB8fCAhdGhpcy5pbkZvcmVncm91bmQpIHx8IF9fUFJJVkFURV9jbGllbnRNZXRhZGF0YVN0b3JlKGUpLkcoKS5uZXh0KChlID0+IHZvaWQgMCA9PT0gdGhpcy5xaShlLCBGdCkuZmluZCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2xpZW50SWQgIT09IGUuY2xpZW50SWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9ICF0aGlzLm5ldHdvcmtFbmFibGVkICYmIGUubmV0d29ya0VuYWJsZWQsIG4gPSAhdGhpcy5pbkZvcmVncm91bmQgJiYgZS5pbkZvcmVncm91bmQsIHIgPSB0aGlzLm5ldHdvcmtFbmFibGVkID09PSBlLm5ldHdvcmtFbmFibGVkO1xuICAgICAgICAgICAgICAgICAgICBpZiAodCB8fCBuICYmIHIpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuICExO1xuICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgIH0pKS5uZXh0KChlID0+ICh0aGlzLmlzUHJpbWFyeSAhPT0gZSAmJiBfX1BSSVZBVEVfbG9nRGVidWcodnQsIGBDbGllbnQgJHtlID8gXCJpc1wiIDogXCJpcyBub3RcIn0gZWxpZ2libGUgZm9yIGEgcHJpbWFyeSBsZWFzZS5gKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIGFzeW5jIHNodXRkb3duKCkge1xuICAgICAgICAvLyBUaGUgc2h1dGRvd24oKSBvcGVyYXRpb25zIGFyZSBpZGVtcG90ZW50IGFuZCBjYW4gYmUgY2FsbGVkIGV2ZW4gd2hlblxuICAgICAgICAvLyBzdGFydCgpIGFib3J0ZWQgKGUuZy4gYmVjYXVzZSBpdCBjb3VsZG4ndCBhY3F1aXJlIHRoZSBwZXJzaXN0ZW5jZSBsZWFzZSkuXG4gICAgICAgIHRoaXMuenIgPSAhMSwgdGhpcy5VaSgpLCB0aGlzLlZpICYmICh0aGlzLlZpLmNhbmNlbCgpLCB0aGlzLlZpID0gbnVsbCksIHRoaXMuS2koKSwgXG4gICAgICAgIHRoaXMuV2koKSwgXG4gICAgICAgIC8vIFVzZSBgU2ltcGxlRGIucnVuVHJhbnNhY3Rpb25gIGRpcmVjdGx5IHRvIGF2b2lkIGZhaWxpbmcgaWYgYW5vdGhlciB0YWJcbiAgICAgICAgLy8gaGFzIG9idGFpbmVkIHRoZSBwcmltYXJ5IGxlYXNlLlxuICAgICAgICBhd2FpdCB0aGlzLnBpLnJ1blRyYW5zYWN0aW9uKFwic2h1dGRvd25cIiwgXCJyZWFkd3JpdGVcIiwgWyBLLCBSZSBdLCAoZSA9PiB7XG4gICAgICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9JbmRleGVkRGJUcmFuc2FjdGlvbihlLCBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMueGkodCkubmV4dCgoKCkgPT4gdGhpcy5CaSh0KSkpO1xuICAgICAgICB9KSksIHRoaXMucGkuY2xvc2UoKSwgXG4gICAgICAgIC8vIFJlbW92ZSB0aGUgZW50cnkgbWFya2luZyB0aGUgY2xpZW50IGFzIHpvbWJpZWQgZnJvbSBMb2NhbFN0b3JhZ2Ugc2luY2VcbiAgICAgICAgLy8gd2Ugc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgaXRzIG1ldGFkYXRhIGZyb20gSW5kZXhlZERiLlxuICAgICAgICB0aGlzLkdpKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgY2xpZW50cyB0aGF0IGFyZSBub3Qgem9tYmllZCBhbmQgaGF2ZSBhbiB1cGRhdGVUaW1lIHdpdGhpbiB0aGVcbiAgICAgKiBwcm92aWRlZCB0aHJlc2hvbGQuXG4gICAgICovICAgIHFpKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIGUuZmlsdGVyKChlID0+IHRoaXMua2koZS51cGRhdGVUaW1lTXMsIHQpICYmICF0aGlzLiRpKGUuY2xpZW50SWQpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIElEcyBvZiB0aGUgY2xpZW50cyB0aGF0IGFyZSBjdXJyZW50bHkgYWN0aXZlLiBJZiBtdWx0aS10YWJcbiAgICAgKiBpcyBub3Qgc3VwcG9ydGVkLCByZXR1cm5zIGFuIGFycmF5IHRoYXQgb25seSBjb250YWlucyB0aGUgbG9jYWwgY2xpZW50J3NcbiAgICAgKiBJRC5cbiAgICAgKlxuICAgICAqIFBPUlRJTkcgTk9URTogVGhpcyBpcyBvbmx5IHVzZWQgZm9yIFdlYiBtdWx0aS10YWIuXG4gICAgICovICAgIHppKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ydW5UcmFuc2FjdGlvbihcImdldEFjdGl2ZUNsaWVudHNcIiwgXCJyZWFkb25seVwiLCAoZSA9PiBfX1BSSVZBVEVfY2xpZW50TWV0YWRhdGFTdG9yZShlKS5HKCkubmV4dCgoZSA9PiB0aGlzLnFpKGUsIEN0KS5tYXAoKGUgPT4gZS5jbGllbnRJZCkpKSkpKTtcbiAgICB9XG4gICAgZ2V0IHN0YXJ0ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnpyO1xuICAgIH1cbiAgICBnZXRHbG9iYWxzQ2FjaGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmpyO1xuICAgIH1cbiAgICBnZXRNdXRhdGlvblF1ZXVlKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9JbmRleGVkRGJNdXRhdGlvblF1ZXVlLkl0KGUsIHRoaXMuc2VyaWFsaXplciwgdCwgdGhpcy5yZWZlcmVuY2VEZWxlZ2F0ZSk7XG4gICAgfVxuICAgIGdldFRhcmdldENhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5IcjtcbiAgICB9XG4gICAgZ2V0UmVtb3RlRG9jdW1lbnRDYWNoZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmVtb3RlRG9jdW1lbnRDYWNoZTtcbiAgICB9XG4gICAgZ2V0SW5kZXhNYW5hZ2VyKGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiSW5kZXhNYW5hZ2VyKGUsIHRoaXMuc2VyaWFsaXplci5UdC5kYXRhYmFzZUlkKTtcbiAgICB9XG4gICAgZ2V0RG9jdW1lbnRPdmVybGF5Q2FjaGUoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX0luZGV4ZWREYkRvY3VtZW50T3ZlcmxheUNhY2hlLkl0KHRoaXMuc2VyaWFsaXplciwgZSk7XG4gICAgfVxuICAgIGdldEJ1bmRsZUNhY2hlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ZcjtcbiAgICB9XG4gICAgcnVuVHJhbnNhY3Rpb24oZSwgdCwgbikge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcodnQsIFwiU3RhcnRpbmcgdHJhbnNhY3Rpb246XCIsIGUpO1xuICAgICAgICBjb25zdCByID0gXCJyZWFkb25seVwiID09PSB0ID8gXCJyZWFkb25seVwiIDogXCJyZWFkd3JpdGVcIiwgaSA9IFxuICAgICAgICAvKiogUmV0dXJucyB0aGUgb2JqZWN0IHN0b3JlcyBmb3IgdGhlIHByb3ZpZGVkIHNjaGVtYS4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2dldE9iamVjdFN0b3JlcyhlKSB7XG4gICAgICAgICAgICByZXR1cm4gMTcgPT09IGUgPyBZZSA6IDE2ID09PSBlID8gSmUgOiAxNSA9PT0gZSA/IEhlIDogMTQgPT09IGUgPyBqZSA6IDEzID09PSBlID8gemUgOiAxMiA9PT0gZSA/IEdlIDogMTEgPT09IGUgPyBXZSA6IHZvaWQgZmFpbCgpO1xuICAgICAgICB9KHRoaXMuZGkpO1xuICAgICAgICBsZXQgcztcbiAgICAgICAgLy8gRG8gYWxsIHRyYW5zYWN0aW9ucyBhcyByZWFkd3JpdGUgYWdhaW5zdCBhbGwgb2JqZWN0IHN0b3Jlcywgc2luY2Ugd2VcbiAgICAgICAgLy8gYXJlIHRoZSBvbmx5IHJlYWRlci93cml0ZXIuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMucGkucnVuVHJhbnNhY3Rpb24oZSwgciwgaSwgKHIgPT4gKHMgPSBuZXcgX19QUklWQVRFX0luZGV4ZWREYlRyYW5zYWN0aW9uKHIsIHRoaXMuR3IgPyB0aGlzLkdyLm5leHQoKSA6IF9fUFJJVkFURV9MaXN0ZW5TZXF1ZW5jZS5hZSksIFxuICAgICAgICBcInJlYWR3cml0ZS1wcmltYXJ5XCIgPT09IHQgPyB0aGlzLkZpKHMpLm5leHQoKGUgPT4gISFlIHx8IHRoaXMuTWkocykpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgIGlmICghdCkgdGhyb3cgX19QUklWQVRFX2xvZ0Vycm9yKGBGYWlsZWQgdG8gb2J0YWluIHByaW1hcnkgbGVhc2UgZm9yIGFjdGlvbiAnJHtlfScuYCksIFxuICAgICAgICAgICAgdGhpcy5pc1ByaW1hcnkgPSAhMSwgdGhpcy5UaS5lbnF1ZXVlUmV0cnlhYmxlKCgoKSA9PiB0aGlzLmZpKCExKSkpLCBuZXcgRmlyZXN0b3JlRXJyb3IoQy5GQUlMRURfUFJFQ09ORElUSU9OLCBCKTtcbiAgICAgICAgICAgIHJldHVybiBuKHMpO1xuICAgICAgICB9KSkubmV4dCgoZSA9PiB0aGlzLk9pKHMpLm5leHQoKCgpID0+IGUpKSkpIDogdGhpcy5qaShzKS5uZXh0KCgoKSA9PiBuKHMpKSkpKSkudGhlbigoZSA9PiAocy5yYWlzZU9uQ29tbWl0dGVkRXZlbnQoKSwgXG4gICAgICAgIGUpKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFZlcmlmaWVzIHRoYXQgdGhlIGN1cnJlbnQgdGFiIGlzIHRoZSBwcmltYXJ5IGxlYXNlaG9sZGVyIG9yIGFsdGVybmF0aXZlbHlcbiAgICAgKiB0aGF0IHRoZSBsZWFzZWhvbGRlciBoYXMgb3B0ZWQgaW50byBtdWx0aS10YWIgc3luY2hyb25pemF0aW9uLlxuICAgICAqL1xuICAgIC8vIFRPRE8oYi8xMTQyMjYyMzQpOiBSZW1vdmUgdGhpcyBjaGVjayB3aGVuIGBzeW5jaHJvbml6ZVRhYnNgIGNhbiBubyBsb25nZXJcbiAgICAvLyBiZSB0dXJuZWQgb2ZmLlxuICAgIGppKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltYXJ5Q2xpZW50U3RvcmUoZSkuZ2V0KFcpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IGUgJiYgdGhpcy5raShlLmxlYXNlVGltZXN0YW1wTXMsIEZ0KSAmJiAhdGhpcy4kaShlLm93bmVySWQpICYmICF0aGlzLk5pKGUpICYmICEodGhpcy5FaSB8fCB0aGlzLmFsbG93VGFiU3luY2hyb25pemF0aW9uICYmIGUuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24pKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5GQUlMRURfUFJFQ09ORElUSU9OLCBNdCk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogT2J0YWlucyBvciBleHRlbmRzIHRoZSBuZXcgcHJpbWFyeSBsZWFzZSBmb3IgdGhlIGxvY2FsIGNsaWVudC4gVGhpc1xuICAgICAqIG1ldGhvZCBkb2VzIG5vdCB2ZXJpZnkgdGhhdCB0aGUgY2xpZW50IGlzIGVsaWdpYmxlIGZvciB0aGlzIGxlYXNlLlxuICAgICAqLyAgICBPaShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7XG4gICAgICAgICAgICBvd25lcklkOiB0aGlzLmNsaWVudElkLFxuICAgICAgICAgICAgYWxsb3dUYWJTeW5jaHJvbml6YXRpb246IHRoaXMuYWxsb3dUYWJTeW5jaHJvbml6YXRpb24sXG4gICAgICAgICAgICBsZWFzZVRpbWVzdGFtcE1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpLnB1dChXLCB0KTtcbiAgICB9XG4gICAgc3RhdGljIEQoKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfU2ltcGxlRGIuRCgpO1xuICAgIH1cbiAgICAvKiogQ2hlY2tzIHRoZSBwcmltYXJ5IGxlYXNlIGFuZCByZW1vdmVzIGl0IGlmIHdlIGFyZSB0aGUgY3VycmVudCBwcmltYXJ5LiAqLyAgICB4aShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfcHJpbWFyeUNsaWVudFN0b3JlKGUpO1xuICAgICAgICByZXR1cm4gdC5nZXQoVykubmV4dCgoZSA9PiB0aGlzLk5pKGUpID8gKF9fUFJJVkFURV9sb2dEZWJ1Zyh2dCwgXCJSZWxlYXNpbmcgcHJpbWFyeSBsZWFzZS5cIiksIFxuICAgICAgICB0LmRlbGV0ZShXKSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpKSk7XG4gICAgfVxuICAgIC8qKiBWZXJpZmllcyB0aGF0IGB1cGRhdGVUaW1lTXNgIGlzIHdpdGhpbiBgbWF4QWdlTXNgLiAqLyAgICBraShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBEYXRlLm5vdygpO1xuICAgICAgICByZXR1cm4gIShlIDwgbiAtIHQpICYmICghKGUgPiBuKSB8fCAoX19QUklWQVRFX2xvZ0Vycm9yKGBEZXRlY3RlZCBhbiB1cGRhdGUgdGltZSB0aGF0IGlzIGluIHRoZSBmdXR1cmU6ICR7ZX0gPiAke259YCksIFxuICAgICAgICAhMSkpO1xuICAgIH1cbiAgICBTaSgpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy5kb2N1bWVudCAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIHRoaXMuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciAmJiAodGhpcy5SaSA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuVGkuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gKHRoaXMuaW5Gb3JlZ3JvdW5kID0gXCJ2aXNpYmxlXCIgPT09IHRoaXMuZG9jdW1lbnQudmlzaWJpbGl0eVN0YXRlLCBcbiAgICAgICAgICAgIHRoaXMud2koKSkpKTtcbiAgICAgICAgfSwgdGhpcy5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCB0aGlzLlJpKSwgdGhpcy5pbkZvcmVncm91bmQgPSBcInZpc2libGVcIiA9PT0gdGhpcy5kb2N1bWVudC52aXNpYmlsaXR5U3RhdGUpO1xuICAgIH1cbiAgICBLaSgpIHtcbiAgICAgICAgdGhpcy5SaSAmJiAodGhpcy5kb2N1bWVudC5yZW1vdmVFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCB0aGlzLlJpKSwgdGhpcy5SaSA9IG51bGwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBdHRhY2hlcyBhIHdpbmRvdy51bmxvYWQgaGFuZGxlciB0aGF0IHdpbGwgc3luY2hyb25vdXNseSB3cml0ZSBvdXJcbiAgICAgKiBjbGllbnRJZCB0byBhIFwiem9tYmllIGNsaWVudCBpZFwiIGxvY2F0aW9uIGluIExvY2FsU3RvcmFnZS4gVGhpcyBjYW4gYmUgdXNlZFxuICAgICAqIGJ5IHRhYnMgdHJ5aW5nIHRvIGFjcXVpcmUgdGhlIHByaW1hcnkgbGVhc2UgdG8gZGV0ZXJtaW5lIHRoYXQgdGhlIGxlYXNlXG4gICAgICogaXMgbm8gbG9uZ2VyIHZhbGlkIGV2ZW4gaWYgdGhlIHRpbWVzdGFtcCBpcyByZWNlbnQuIFRoaXMgaXMgcGFydGljdWxhcmx5XG4gICAgICogaW1wb3J0YW50IGZvciB0aGUgcmVmcmVzaCBjYXNlIChzbyB0aGUgdGFiIGNvcnJlY3RseSByZS1hY3F1aXJlcyB0aGVcbiAgICAgKiBwcmltYXJ5IGxlYXNlKS4gTG9jYWxTdG9yYWdlIGlzIHVzZWQgZm9yIHRoaXMgcmF0aGVyIHRoYW4gSW5kZXhlZERiIGJlY2F1c2VcbiAgICAgKiBpdCBpcyBhIHN5bmNocm9ub3VzIEFQSSBhbmQgc28gY2FuIGJlIHVzZWQgcmVsaWFibHkgZnJvbSAgYW4gdW5sb2FkXG4gICAgICogaGFuZGxlci5cbiAgICAgKi8gICAgYmkoKSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIChudWxsID09PSAoZSA9IHRoaXMud2luZG93KSB8fCB2b2lkIDAgPT09IGUgPyB2b2lkIDAgOiBlLmFkZEV2ZW50TGlzdGVuZXIpICYmICh0aGlzLkFpID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8gTm90ZTogSW4gdGhlb3J5LCB0aGlzIHNob3VsZCBiZSBzY2hlZHVsZWQgb24gdGhlIEFzeW5jUXVldWUgc2luY2UgaXRcbiAgICAgICAgICAgIC8vIGFjY2Vzc2VzIGludGVybmFsIHN0YXRlLiBXZSBleGVjdXRlIHRoaXMgY29kZSBkaXJlY3RseSBkdXJpbmcgc2h1dGRvd25cbiAgICAgICAgICAgIC8vIHRvIG1ha2Ugc3VyZSBpdCBnZXRzIGEgY2hhbmNlIHRvIHJ1bi5cbiAgICAgICAgICAgIHRoaXMuVWkoKTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSAvKD86VmVyc2lvbnxNb2JpbGUpXFwvMVs0NTZdLztcbiAgICAgICAgICAgIGlzU2FmYXJpKCkgJiYgKG5hdmlnYXRvci5hcHBWZXJzaW9uLm1hdGNoKGUpIHx8IG5hdmlnYXRvci51c2VyQWdlbnQubWF0Y2goZSkpICYmIFxuICAgICAgICAgICAgLy8gT24gU2FmYXJpIDE0LCAxNSwgYW5kIDE2LCB3ZSBkbyBub3QgcnVuIGFueSBjbGVhbnVwIGFjdGlvbnMgYXMgaXQgbWlnaHRcbiAgICAgICAgICAgIC8vIHRyaWdnZXIgYSBidWcgdGhhdCBwcmV2ZW50cyBTYWZhcmkgZnJvbSByZS1vcGVuaW5nIEluZGV4ZWREQiBkdXJpbmdcbiAgICAgICAgICAgIC8vIHRoZSBuZXh0IHBhZ2UgbG9hZC5cbiAgICAgICAgICAgIC8vIFNlZSBodHRwczovL2J1Z3Mud2Via2l0Lm9yZy9zaG93X2J1Zy5jZ2k/aWQ9MjI2NTQ3XG4gICAgICAgICAgICB0aGlzLlRpLmVudGVyUmVzdHJpY3RlZE1vZGUoLyogcHVyZ2VFeGlzdGluZ1Rhc2tzPSAqLyAhMCksIHRoaXMuVGkuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gdGhpcy5zaHV0ZG93bigpKSk7XG4gICAgICAgIH0sIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwYWdlaGlkZVwiLCB0aGlzLkFpKSk7XG4gICAgfVxuICAgIFdpKCkge1xuICAgICAgICB0aGlzLkFpICYmICh0aGlzLndpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKFwicGFnZWhpZGVcIiwgdGhpcy5BaSksIHRoaXMuQWkgPSBudWxsKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIGEgY2xpZW50IGlzIFwiem9tYmllZFwiIGJhc2VkIG9uIGl0cyBMb2NhbFN0b3JhZ2UgZW50cnkuXG4gICAgICogQ2xpZW50cyBiZWNvbWUgem9tYmllZCB3aGVuIHRoZWlyIHRhYiBjbG9zZXMgd2l0aG91dCBydW5uaW5nIGFsbCBvZiB0aGVcbiAgICAgKiBjbGVhbnVwIGxvZ2ljIGluIGBzaHV0ZG93bigpYC5cbiAgICAgKi8gICAgJGkoZSkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBudWxsICE9PSAobnVsbCA9PT0gKHQgPSB0aGlzLnlpKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0LmdldEl0ZW0odGhpcy5RaShlKSkpO1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1Zyh2dCwgYENsaWVudCAnJHtlfScgJHtuID8gXCJpc1wiIDogXCJpcyBub3RcIn0gem9tYmllZCBpbiBMb2NhbFN0b3JhZ2VgKSwgXG4gICAgICAgICAgICBuO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBHcmFjZWZ1bGx5IGhhbmRsZSBpZiBMb2NhbFN0b3JhZ2UgaXNuJ3Qgd29ya2luZy5cbiAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfbG9nRXJyb3IodnQsIFwiRmFpbGVkIHRvIGdldCB6b21iaWVkIGNsaWVudCBpZC5cIiwgZSksICExO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlY29yZCBjbGllbnQgYXMgem9tYmllZCAoYSBjbGllbnQgdGhhdCBoYWQgaXRzIHRhYiBjbG9zZWQpLiBab21iaWVkXG4gICAgICogY2xpZW50cyBhcmUgaWdub3JlZCBkdXJpbmcgcHJpbWFyeSB0YWIgc2VsZWN0aW9uLlxuICAgICAqLyAgICBVaSgpIHtcbiAgICAgICAgaWYgKHRoaXMueWkpIHRyeSB7XG4gICAgICAgICAgICB0aGlzLnlpLnNldEl0ZW0odGhpcy5RaSh0aGlzLmNsaWVudElkKSwgU3RyaW5nKERhdGUubm93KCkpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gR3JhY2VmdWxseSBoYW5kbGUgaWYgTG9jYWxTdG9yYWdlIGlzbid0IGF2YWlsYWJsZSAvIHdvcmtpbmcuXG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRXJyb3IoXCJGYWlsZWQgdG8gc2V0IHpvbWJpZSBjbGllbnQgaWQuXCIsIGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBSZW1vdmVzIHRoZSB6b21iaWVkIGNsaWVudCBlbnRyeSBpZiBpdCBleGlzdHMuICovICAgIEdpKCkge1xuICAgICAgICBpZiAodGhpcy55aSkgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMueWkucmVtb3ZlSXRlbSh0aGlzLlFpKHRoaXMuY2xpZW50SWQpKTtcbiAgICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgICAgLy8gSWdub3JlXG4gICAgICAgIH1cbiAgICB9XG4gICAgUWkoZSkge1xuICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV96b21iaWVfJHt0aGlzLnBlcnNpc3RlbmNlS2V5fV8ke2V9YDtcbiAgICB9XG59XG5cbi8qKlxuICogSGVscGVyIHRvIGdldCBhIHR5cGVkIFNpbXBsZURiU3RvcmUgZm9yIHRoZSBwcmltYXJ5IGNsaWVudCBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ByaW1hcnlDbGllbnRTdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9nZXRTdG9yZShlLCBLKTtcbn1cblxuLyoqXG4gKiBIZWxwZXIgdG8gZ2V0IGEgdHlwZWQgU2ltcGxlRGJTdG9yZSBmb3IgdGhlIGNsaWVudCBtZXRhZGF0YSBvYmplY3Qgc3RvcmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2NsaWVudE1ldGFkYXRhU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZ2V0U3RvcmUoZSwgUmUpO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlcyBhIHN0cmluZyB1c2VkIGFzIGEgcHJlZml4IHdoZW4gc3RvcmluZyBkYXRhIGluIEluZGV4ZWREQiBhbmRcbiAqIExvY2FsU3RvcmFnZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5kZXhlZERiU3RvcmFnZVByZWZpeChlLCB0KSB7XG4gICAgLy8gVXNlIHR3byBkaWZmZXJlbnQgcHJlZml4IGZvcm1hdHM6XG4gICAgLy8gICAqIGZpcmVzdG9yZSAvIHBlcnNpc3RlbmNlS2V5IC8gcHJvamVjdElEIC4gZGF0YWJhc2VJRCAvIC4uLlxuICAgIC8vICAgKiBmaXJlc3RvcmUgLyBwZXJzaXN0ZW5jZUtleSAvIHByb2plY3RJRCAvIC4uLlxuICAgIC8vIHByb2plY3RJRHMgYXJlIEROUy1jb21wYXRpYmxlIG5hbWVzIGFuZCBjYW5ub3QgY29udGFpbiBkb3RzXG4gICAgLy8gc28gdGhlcmUncyBubyBkYW5nZXIgb2YgY29sbGlzaW9ucy5cbiAgICBsZXQgbiA9IGUucHJvamVjdElkO1xuICAgIHJldHVybiBlLmlzRGVmYXVsdERhdGFiYXNlIHx8IChuICs9IFwiLlwiICsgZS5kYXRhYmFzZSksIFwiZmlyZXN0b3JlL1wiICsgdCArIFwiL1wiICsgbiArIFwiL1wiO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHNldCBvZiBjaGFuZ2VzIHRvIHdoYXQgZG9jdW1lbnRzIGFyZSBjdXJyZW50bHkgaW4gdmlldyBhbmQgb3V0IG9mIHZpZXcgZm9yXG4gKiBhIGdpdmVuIHF1ZXJ5LiBUaGVzZSBjaGFuZ2VzIGFyZSBzZW50IHRvIHRoZSBMb2NhbFN0b3JlIGJ5IHRoZSBWaWV3ICh2aWFcbiAqIHRoZSBTeW5jRW5naW5lKSBhbmQgYXJlIHVzZWQgdG8gcGluIC8gdW5waW4gZG9jdW1lbnRzIGFzIGFwcHJvcHJpYXRlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfTG9jYWxWaWV3Q2hhbmdlcyB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgcikge1xuICAgICAgICB0aGlzLnRhcmdldElkID0gZSwgdGhpcy5mcm9tQ2FjaGUgPSB0LCB0aGlzLkhpID0gbiwgdGhpcy5KaSA9IHI7XG4gICAgfVxuICAgIHN0YXRpYyBZaShlLCB0KSB7XG4gICAgICAgIGxldCBuID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIHIgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQuZG9jQ2hhbmdlcykgc3dpdGNoIChlLnR5cGUpIHtcbiAgICAgICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgICAgICBuID0gbi5hZGQoZS5kb2Mua2V5KTtcbiAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgICAgICByID0gci5hZGQoZS5kb2Mua2V5KTtcbiAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9Mb2NhbFZpZXdDaGFuZ2VzKGUsIHQuZnJvbUNhY2hlLCBuLCByKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgdHJhY2tlciB0byBrZWVwIGEgcmVjb3JkIG9mIGltcG9ydGFudCBkZXRhaWxzIGR1cmluZyBkYXRhYmFzZSBsb2NhbCBxdWVyeVxuICogZXhlY3V0aW9uLlxuICovIGNsYXNzIFF1ZXJ5Q29udGV4dCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDb3VudHMgdGhlIG51bWJlciBvZiBkb2N1bWVudHMgcGFzc2VkIHRocm91Z2ggZHVyaW5nIGxvY2FsIHF1ZXJ5IGV4ZWN1dGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuX2RvY3VtZW50UmVhZENvdW50ID0gMDtcbiAgICB9XG4gICAgZ2V0IGRvY3VtZW50UmVhZENvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZG9jdW1lbnRSZWFkQ291bnQ7XG4gICAgfVxuICAgIGluY3JlbWVudERvY3VtZW50UmVhZENvdW50KGUpIHtcbiAgICAgICAgdGhpcy5fZG9jdW1lbnRSZWFkQ291bnQgKz0gZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBGaXJlc3RvcmUgcXVlcnkgZW5naW5lLlxuICpcbiAqIEZpcmVzdG9yZSBxdWVyaWVzIGNhbiBiZSBleGVjdXRlZCBpbiB0aHJlZSBtb2Rlcy4gVGhlIFF1ZXJ5IEVuZ2luZSBkZXRlcm1pbmVzXG4gKiB3aGF0IG1vZGUgdG8gdXNlIGJhc2VkIG9uIHdoYXQgZGF0YSBpcyBwZXJzaXN0ZWQuIFRoZSBtb2RlIG9ubHkgZGV0ZXJtaW5lc1xuICogdGhlIHJ1bnRpbWUgY29tcGxleGl0eSBvZiB0aGUgcXVlcnkgLSB0aGUgcmVzdWx0IHNldCBpcyBlcXVpdmFsZW50IGFjcm9zcyBhbGxcbiAqIGltcGxlbWVudGF0aW9ucy5cbiAqXG4gKiBUaGUgUXVlcnkgZW5naW5lIHdpbGwgdXNlIGluZGV4ZWQtYmFzZWQgZXhlY3V0aW9uIGlmIGEgdXNlciBoYXMgY29uZmlndXJlZFxuICogYW55IGluZGV4IHRoYXQgY2FuIGJlIHVzZWQgdG8gZXhlY3V0ZSBxdWVyeSAodmlhIGBzZXRJbmRleENvbmZpZ3VyYXRpb24oKWApLlxuICogT3RoZXJ3aXNlLCB0aGUgZW5naW5lIHdpbGwgdHJ5IHRvIG9wdGltaXplIHRoZSBxdWVyeSBieSByZS11c2luZyBhIHByZXZpb3VzbHlcbiAqIHBlcnNpc3RlZCBxdWVyeSByZXN1bHQuIElmIHRoYXQgaXMgbm90IHBvc3NpYmxlLCB0aGUgcXVlcnkgd2lsbCBiZSBleGVjdXRlZFxuICogdmlhIGEgZnVsbCBjb2xsZWN0aW9uIHNjYW4uXG4gKlxuICogSW5kZXgtYmFzZWQgZXhlY3V0aW9uIGlzIHRoZSBkZWZhdWx0IHdoZW4gYXZhaWxhYmxlLiBUaGUgcXVlcnkgZW5naW5lXG4gKiBzdXBwb3J0cyBwYXJ0aWFsIGluZGV4ZWQgZXhlY3V0aW9uIGFuZCBtZXJnZXMgdGhlIHJlc3VsdCBmcm9tIHRoZSBpbmRleFxuICogbG9va3VwIHdpdGggZG9jdW1lbnRzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gaW5kZXhlZC4gVGhlIGluZGV4IGV2YWx1YXRpb25cbiAqIG1hdGNoZXMgdGhlIGJhY2tlbmQncyBmb3JtYXQgYW5kIGFzIHN1Y2gsIHRoZSBTREsgY2FuIHVzZSBpbmRleGluZyBmb3IgYWxsXG4gKiBxdWVyaWVzIHRoYXQgdGhlIGJhY2tlbmQgc3VwcG9ydHMuXG4gKlxuICogSWYgbm8gaW5kZXggZXhpc3RzLCB0aGUgcXVlcnkgZW5naW5lIHRyaWVzIHRvIHRha2UgYWR2YW50YWdlIG9mIHRoZSB0YXJnZXRcbiAqIGRvY3VtZW50IG1hcHBpbmcgaW4gdGhlIFRhcmdldENhY2hlLiBUaGVzZSBtYXBwaW5ncyBleGlzdHMgZm9yIGFsbCBxdWVyaWVzXG4gKiB0aGF0IGhhdmUgYmVlbiBzeW5jZWQgd2l0aCB0aGUgYmFja2VuZCBhdCBsZWFzdCBvbmNlIGFuZCBhbGxvdyB0aGUgcXVlcnlcbiAqIGVuZ2luZSB0byBvbmx5IHJlYWQgZG9jdW1lbnRzIHRoYXQgcHJldmlvdXNseSBtYXRjaGVkIGEgcXVlcnkgcGx1cyBhbnlcbiAqIGRvY3VtZW50cyB0aGF0IHdlcmUgZWRpdGVkIGFmdGVyIHRoZSBxdWVyeSB3YXMgbGFzdCBsaXN0ZW5lZCB0by5cbiAqXG4gKiBUaGVyZSBhcmUgc29tZSBjYXNlcyB3aGVuIHRoaXMgb3B0aW1pemF0aW9uIGlzIG5vdCBndWFyYW50ZWVkIHRvIHByb2R1Y2VcbiAqIHRoZSBzYW1lIHJlc3VsdHMgYXMgZnVsbCBjb2xsZWN0aW9uIHNjYW5zLiBJbiB0aGVzZSBjYXNlcywgcXVlcnlcbiAqIHByb2Nlc3NpbmcgZmFsbHMgYmFjayB0byBmdWxsIHNjYW5zLiBUaGVzZSBjYXNlcyBhcmU6XG4gKlxuICogLSBMaW1pdCBxdWVyaWVzIHdoZXJlIGEgZG9jdW1lbnQgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSBwcmV2aW91c2x5IG5vIGxvbmdlclxuICogICBtYXRjaGVzIHRoZSBxdWVyeS5cbiAqXG4gKiAtIExpbWl0IHF1ZXJpZXMgd2hlcmUgYSBkb2N1bWVudCBlZGl0IG1heSBjYXVzZSB0aGUgZG9jdW1lbnQgdG8gc29ydCBiZWxvd1xuICogICBhbm90aGVyIGRvY3VtZW50IHRoYXQgaXMgaW4gdGhlIGxvY2FsIGNhY2hlLlxuICpcbiAqIC0gUXVlcmllcyB0aGF0IGhhdmUgbmV2ZXIgYmVlbiBDVVJSRU5UIG9yIGZyZWUgb2YgbGltYm8gZG9jdW1lbnRzLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfUXVlcnlFbmdpbmUge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLlppID0gITEsIHRoaXMuWGkgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTREsgb25seSBkZWNpZGVzIHdoZXRoZXIgaXQgc2hvdWxkIGNyZWF0ZSBpbmRleCB3aGVuIGNvbGxlY3Rpb24gc2l6ZSBpc1xuICAgICAgICAgKiBsYXJnZXIgdGhhbiB0aGlzLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lcyA9IDEwMCwgdGhpcy50cyA9IFxuICAgICAgICAvKipcbiAqIFRoaXMgY29zdCByZXByZXNlbnRzIHRoZSBldmFsdWF0aW9uIHJlc3VsdCBvZlxuICogKChbaW5kZXgsIGRvY0tleV0gKyBbZG9jS2V5LCBkb2NDb250ZW50XSkgcGVyIGRvY3VtZW50IGluIHRoZSByZXN1bHQgc2V0KVxuICogLyAoW2RvY0tleSwgZG9jQ29udGVudF0gcGVyIGRvY3VtZW50cyBpbiBmdWxsIGNvbGxlY3Rpb24gc2NhbikgY29taW5nIGZyb21cbiAqIGV4cGVyaW1lbnQgW2VudGVyIFBSIGV4cGVyaW1lbnQgVVJMIGhlcmVdLlxuICovXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXREZWZhdWx0UmVsYXRpdmVJbmRleFJlYWRDb3N0UGVyRG9jdW1lbnQoKSB7XG4gICAgICAgICAgICAvLyBUaGVzZSB2YWx1ZXMgd2VyZSBkZXJpdmVkIGZyb20gYW4gZXhwZXJpbWVudCB3aGVyZSBzZXZlcmFsIG1lbWJlcnMgb2YgdGhlXG4gICAgICAgICAgICAvLyBGaXJlc3RvcmUgU0RLIHRlYW0gcmFuIGEgcGVyZm9ybWFuY2UgdGVzdCBpbiB2YXJpb3VzIGVudmlyb25tZW50cy5cbiAgICAgICAgICAgIC8vIEdvb2dsZXJzIGNhbiBzZWUgYi8yOTkyODQyODcgZm9yIGRldGFpbHMuXG4gICAgICAgICAgICByZXR1cm4gaXNTYWZhcmkoKSA/IDggOiBfX1BSSVZBVEVfZ2V0QW5kcm9pZFZlcnNpb24oZ2V0VUEoKSkgPiAwID8gNiA6IDQ7XG4gICAgICAgIH0oKTtcbiAgICB9XG4gICAgLyoqIFNldHMgdGhlIGRvY3VtZW50IHZpZXcgdG8gcXVlcnkgYWdhaW5zdC4gKi8gICAgaW5pdGlhbGl6ZShlLCB0KSB7XG4gICAgICAgIHRoaXMubnMgPSBlLCB0aGlzLmluZGV4TWFuYWdlciA9IHQsIHRoaXMuWmkgPSAhMDtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYWxsIGxvY2FsIGRvY3VtZW50cyBtYXRjaGluZyB0aGUgc3BlY2lmaWVkIHF1ZXJ5LiAqLyAgICBnZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4sIHIpIHtcbiAgICAgICAgLy8gU3RvcmVzIHRoZSByZXN1bHQgZnJvbSBleGVjdXRpbmcgdGhlIHF1ZXJ5OyB1c2luZyB0aGlzIG9iamVjdCBpcyBtb3JlXG4gICAgICAgIC8vIGNvbnZlbmllbnQgdGhhbiBwYXNzaW5nIHRoZSByZXN1bHQgYmV0d2VlbiBzdGVwcyBvZiB0aGUgcGVyc2lzdGVuY2VcbiAgICAgICAgLy8gdHJhbnNhY3Rpb24gYW5kIGltcHJvdmVzIHJlYWRhYmlsaXR5IGNvbXBhcmF0aXZlbHkuXG4gICAgICAgIGNvbnN0IGkgPSB7XG4gICAgICAgICAgICByZXN1bHQ6IG51bGxcbiAgICAgICAgfTtcbiAgICAgICAgcmV0dXJuIHRoaXMucnMoZSwgdCkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICBpLnJlc3VsdCA9IGU7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoIWkucmVzdWx0KSByZXR1cm4gdGhpcy5zcyhlLCB0LCByLCBuKS5uZXh0KChlID0+IHtcbiAgICAgICAgICAgICAgICBpLnJlc3VsdCA9IGU7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKS5uZXh0KCgoKSA9PiB7XG4gICAgICAgICAgICBpZiAoaS5yZXN1bHQpIHJldHVybjtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBuZXcgUXVlcnlDb250ZXh0O1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3MoZSwgdCwgbikubmV4dCgociA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGkucmVzdWx0ID0gciwgdGhpcy5YaSkgcmV0dXJuIHRoaXMudXMoZSwgdCwgbiwgci5zaXplKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpLm5leHQoKCgpID0+IGkucmVzdWx0KSk7XG4gICAgfVxuICAgIHVzKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIG4uZG9jdW1lbnRSZWFkQ291bnQgPCB0aGlzLmVzID8gKF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlF1ZXJ5RW5naW5lXCIsIFwiU0RLIHdpbGwgbm90IGNyZWF0ZSBjYWNoZSBpbmRleGVzIGZvciBxdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpLCBcInNpbmNlIGl0IG9ubHkgY3JlYXRlcyBjYWNoZSBpbmRleGVzIGZvciBjb2xsZWN0aW9uIGNvbnRhaW5zXCIsIFwibW9yZSB0aGFuIG9yIGVxdWFsIHRvXCIsIHRoaXMuZXMsIFwiZG9jdW1lbnRzXCIpLCBcbiAgICAgICAgUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKSkgOiAoX19QUklWQVRFX2dldExvZ0xldmVsKCkgPD0gTG9nTGV2ZWwuREVCVUcgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiUXVlcnlFbmdpbmVcIiwgXCJRdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpLCBcInNjYW5zXCIsIG4uZG9jdW1lbnRSZWFkQ291bnQsIFwibG9jYWwgZG9jdW1lbnRzIGFuZCByZXR1cm5zXCIsIHIsIFwiZG9jdW1lbnRzIGFzIHJlc3VsdHMuXCIpLCBcbiAgICAgICAgbi5kb2N1bWVudFJlYWRDb3VudCA+IHRoaXMudHMgKiByID8gKF9fUFJJVkFURV9nZXRMb2dMZXZlbCgpIDw9IExvZ0xldmVsLkRFQlVHICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhcIlF1ZXJ5RW5naW5lXCIsIFwiVGhlIFNESyBkZWNpZGVzIHRvIGNyZWF0ZSBjYWNoZSBpbmRleGVzIGZvciBxdWVyeTpcIiwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpLCBcImFzIHVzaW5nIGNhY2hlIGluZGV4ZXMgbWF5IGhlbHAgaW1wcm92ZSBwZXJmb3JtYW5jZS5cIiksIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlci5jcmVhdGVUYXJnZXRJbmRleGVzKGUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKSkgOiBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZSgpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYW4gaW5kZXhlZCBxdWVyeSB0aGF0IGV2YWx1YXRlcyB0aGUgcXVlcnkgYmFzZWQgb24gYSBjb2xsZWN0aW9uJ3NcbiAgICAgKiBwZXJzaXN0ZWQgaW5kZXggdmFsdWVzLiBSZXR1cm5zIGBudWxsYCBpZiBhbiBpbmRleCBpcyBub3QgYXZhaWxhYmxlLlxuICAgICAqLyAgICBycyhlLCB0KSB7XG4gICAgICAgIGlmIChfX1BSSVZBVEVfcXVlcnlNYXRjaGVzQWxsRG9jdW1lbnRzKHQpKSBcbiAgICAgICAgLy8gUXVlcmllcyB0aGF0IG1hdGNoIGFsbCBkb2N1bWVudHMgZG9uJ3QgYmVuZWZpdCBmcm9tIHVzaW5nXG4gICAgICAgIC8vIGtleS1iYXNlZCBsb29rdXBzLiBJdCBpcyBtb3JlIGVmZmljaWVudCB0byBzY2FuIGFsbCBkb2N1bWVudHMgaW4gYVxuICAgICAgICAvLyBjb2xsZWN0aW9uLCByYXRoZXIgdGhhbiB0byBwZXJmb3JtIGluZGl2aWR1YWwgbG9va3Vwcy5cbiAgICAgICAgcmV0dXJuIFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKG51bGwpO1xuICAgICAgICBsZXQgbiA9IF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleE1hbmFnZXIuZ2V0SW5kZXhUeXBlKGUsIG4pLm5leHQoKHIgPT4gMCAvKiBJbmRleFR5cGUuTk9ORSAqLyA9PT0gciA/IG51bGwgOiAobnVsbCAhPT0gdC5saW1pdCAmJiAxIC8qIEluZGV4VHlwZS5QQVJUSUFMICovID09PSByICYmIChcbiAgICAgICAgLy8gV2UgY2Fubm90IGFwcGx5IGEgbGltaXQgZm9yIHRhcmdldHMgdGhhdCBhcmUgc2VydmVkIHVzaW5nIGEgcGFydGlhbFxuICAgICAgICAvLyBpbmRleC4gSWYgYSBwYXJ0aWFsIGluZGV4IHdpbGwgYmUgdXNlZCB0byBzZXJ2ZSB0aGUgdGFyZ2V0LCB0aGVcbiAgICAgICAgLy8gcXVlcnkgbWF5IHJldHVybiBhIHN1cGVyc2V0IG9mIGRvY3VtZW50cyB0aGF0IG1hdGNoIHRoZSB0YXJnZXRcbiAgICAgICAgLy8gKGUuZy4gaWYgdGhlIGluZGV4IGRvZXNuJ3QgaW5jbHVkZSBhbGwgdGhlIHRhcmdldCdzIGZpbHRlcnMpLCBvclxuICAgICAgICAvLyBtYXkgcmV0dXJuIHRoZSBjb3JyZWN0IHNldCBvZiBkb2N1bWVudHMgaW4gdGhlIHdyb25nIG9yZGVyIChlLmcuIGlmXG4gICAgICAgIC8vIHRoZSBpbmRleCBkb2Vzbid0IGluY2x1ZGUgYSBzZWdtZW50IGZvciBvbmUgb2YgdGhlIG9yZGVyQnlzKS5cbiAgICAgICAgLy8gVGhlcmVmb3JlLCBhIGxpbWl0IHNob3VsZCBub3QgYmUgYXBwbGllZCBpbiBzdWNoIGNhc2VzLlxuICAgICAgICB0ID0gX19QUklWQVRFX3F1ZXJ5V2l0aExpbWl0KHQsIG51bGwsIFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyksIG4gPSBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldCh0KSksIFxuICAgICAgICB0aGlzLmluZGV4TWFuYWdlci5nZXREb2N1bWVudHNNYXRjaGluZ1RhcmdldChlLCBuKS5uZXh0KChyID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoLi4ucik7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5ucy5nZXREb2N1bWVudHMoZSwgaSkubmV4dCgociA9PiB0aGlzLmluZGV4TWFuYWdlci5nZXRNaW5PZmZzZXQoZSwgbikubmV4dCgobiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcyA9IHRoaXMuY3ModCwgcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMubHModCwgcywgaSwgbi5yZWFkVGltZSkgPyB0aGlzLnJzKGUsIF9fUFJJVkFURV9xdWVyeVdpdGhMaW1pdCh0LCBudWxsLCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8pKSA6IHRoaXMuaHMoZSwgcywgdCwgbik7XG4gICAgICAgICAgICB9KSkpKTtcbiAgICAgICAgfSkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIHF1ZXJ5IGJhc2VkIG9uIHRoZSB0YXJnZXQncyBwZXJzaXN0ZWQgcXVlcnkgbWFwcGluZy4gUmV0dXJuc1xuICAgICAqIGBudWxsYCBpZiB0aGUgbWFwcGluZyBpcyBub3QgYXZhaWxhYmxlIG9yIGNhbm5vdCBiZSB1c2VkLlxuICAgICAqLyAgICBzcyhlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcXVlcnlNYXRjaGVzQWxsRG9jdW1lbnRzKHQpIHx8IHIuaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpID8gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCkgOiB0aGlzLm5zLmdldERvY3VtZW50cyhlLCBuKS5uZXh0KChpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHMgPSB0aGlzLmNzKHQsIGkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubHModCwgcywgbiwgcikgPyBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShudWxsKSA6IChfX1BSSVZBVEVfZ2V0TG9nTGV2ZWwoKSA8PSBMb2dMZXZlbC5ERUJVRyAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJRdWVyeUVuZ2luZVwiLCBcIlJlLXVzaW5nIHByZXZpb3VzIHJlc3VsdCBmcm9tICVzIHRvIGV4ZWN1dGUgcXVlcnk6ICVzXCIsIHIudG9TdHJpbmcoKSwgX19QUklWQVRFX3N0cmluZ2lmeVF1ZXJ5KHQpKSwgXG4gICAgICAgICAgICB0aGlzLmhzKGUsIHMsIHQsIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldFN1Y2Nlc3NvckZyb21SZWFkVGltZShyLCBOKSkubmV4dCgoZSA9PiBlKSkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIC8vIFF1ZXJpZXMgdGhhdCBoYXZlIG5ldmVyIHNlZW4gYSBzbmFwc2hvdCB3aXRob3V0IGxpbWJvIGZyZWUgZG9jdW1lbnRzXG4gICAgICAgIC8vIHNob3VsZCBhbHNvIGJlIHJ1biBhcyBhIGZ1bGwgY29sbGVjdGlvbiBzY2FuLlxuICAgICAgICB9XG4gICAgLyoqIEFwcGxpZXMgdGhlIHF1ZXJ5IGZpbHRlciBhbmQgc29ydGluZyB0byB0aGUgcHJvdmlkZWQgZG9jdW1lbnRzLiAgKi8gICAgY3MoZSwgdCkge1xuICAgICAgICAvLyBTb3J0IHRoZSBkb2N1bWVudHMgYW5kIHJlLWFwcGx5IHRoZSBxdWVyeSBmaWx0ZXIgc2luY2UgcHJldmlvdXNseVxuICAgICAgICAvLyBtYXRjaGluZyBkb2N1bWVudHMgZG8gbm90IG5lY2Vzc2FyaWx5IHN0aWxsIG1hdGNoIHRoZSBxdWVyeS5cbiAgICAgICAgbGV0IG4gPSBuZXcgU29ydGVkU2V0KF9fUFJJVkFURV9uZXdRdWVyeUNvbXBhcmF0b3IoZSkpO1xuICAgICAgICByZXR1cm4gdC5mb3JFYWNoKCgodCwgcikgPT4ge1xuICAgICAgICAgICAgX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyhlLCByKSAmJiAobiA9IG4uYWRkKHIpKTtcbiAgICAgICAgfSkpLCBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZXRlcm1pbmVzIGlmIGEgbGltaXQgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgZnJvbSBjYWNoZSwgbWFraW5nIGl0XG4gICAgICogaW5lbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBleGVjdXRpb24uXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnkgLSBUaGUgcXVlcnkuXG4gICAgICogQHBhcmFtIHNvcnRlZFByZXZpb3VzUmVzdWx0cyAtIFRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaGVkIHRoZSBxdWVyeSB3aGVuIGl0XG4gICAgICogd2FzIGxhc3Qgc3luY2hyb25pemVkLCBzb3J0ZWQgYnkgdGhlIHF1ZXJ5J3MgY29tcGFyYXRvci5cbiAgICAgKiBAcGFyYW0gcmVtb3RlS2V5cyAtIFRoZSBkb2N1bWVudCBrZXlzIHRoYXQgbWF0Y2hlZCB0aGUgcXVlcnkgYXQgdGhlIGxhc3RcbiAgICAgKiBzbmFwc2hvdC5cbiAgICAgKiBAcGFyYW0gbGltYm9GcmVlU25hcHNob3RWZXJzaW9uIC0gVGhlIHZlcnNpb24gb2YgdGhlIHNuYXBzaG90IHdoZW4gdGhlXG4gICAgICogcXVlcnkgd2FzIGxhc3Qgc3luY2hyb25pemVkLlxuICAgICAqLyAgICBscyhlLCB0LCBuLCByKSB7XG4gICAgICAgIGlmIChudWxsID09PSBlLmxpbWl0KSBcbiAgICAgICAgLy8gUXVlcmllcyB3aXRob3V0IGxpbWl0cyBkbyBub3QgbmVlZCB0byBiZSByZWZpbGxlZC5cbiAgICAgICAgcmV0dXJuICExO1xuICAgICAgICBpZiAobi5zaXplICE9PSB0LnNpemUpIFxuICAgICAgICAvLyBUaGUgcXVlcnkgbmVlZHMgdG8gYmUgcmVmaWxsZWQgaWYgYSBwcmV2aW91c2x5IG1hdGNoaW5nIGRvY3VtZW50IG5vXG4gICAgICAgIC8vIGxvbmdlciBtYXRjaGVzLlxuICAgICAgICByZXR1cm4gITA7XG4gICAgICAgIC8vIExpbWl0IHF1ZXJpZXMgYXJlIG5vdCBlbGlnaWJsZSBmb3IgaW5kZXgtZnJlZSBxdWVyeSBleGVjdXRpb24gaWYgdGhlcmUgaXNcbiAgICAgICAgLy8gYSBwb3RlbnRpYWwgdGhhdCBhbiBvbGRlciBkb2N1bWVudCBmcm9tIGNhY2hlIG5vdyBzb3J0cyBiZWZvcmUgYSBkb2N1bWVudFxuICAgICAgICAvLyB0aGF0IHdhcyBwcmV2aW91c2x5IHBhcnQgb2YgdGhlIGxpbWl0LiBUaGlzLCBob3dldmVyLCBjYW4gb25seSBoYXBwZW4gaWZcbiAgICAgICAgLy8gdGhlIGRvY3VtZW50IGF0IHRoZSBlZGdlIG9mIHRoZSBsaW1pdCBnb2VzIG91dCBvZiBsaW1pdC5cbiAgICAgICAgLy8gSWYgYSBkb2N1bWVudCB0aGF0IGlzIG5vdCB0aGUgbGltaXQgYm91bmRhcnkgc29ydHMgZGlmZmVyZW50bHksXG4gICAgICAgIC8vIHRoZSBib3VuZGFyeSBvZiB0aGUgbGltaXQgaXRzZWxmIGRpZCBub3QgY2hhbmdlIGFuZCBkb2N1bWVudHMgZnJvbSBjYWNoZVxuICAgICAgICAvLyB3aWxsIGNvbnRpbnVlIHRvIGJlIFwicmVqZWN0ZWRcIiBieSB0aGlzIGJvdW5kYXJ5LiBUaGVyZWZvcmUsIHdlIGNhbiBpZ25vcmVcbiAgICAgICAgLy8gYW55IG1vZGlmaWNhdGlvbnMgdGhhdCBkb24ndCBhZmZlY3QgdGhlIGxhc3QgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gZS5saW1pdFR5cGUgPyB0Lmxhc3QoKSA6IHQuZmlyc3QoKTtcbiAgICAgICAgcmV0dXJuICEhaSAmJiAoaS5oYXNQZW5kaW5nV3JpdGVzIHx8IGkudmVyc2lvbi5jb21wYXJlVG8ocikgPiAwKTtcbiAgICB9XG4gICAgX3MoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2dldExvZ0xldmVsKCkgPD0gTG9nTGV2ZWwuREVCVUcgJiYgX19QUklWQVRFX2xvZ0RlYnVnKFwiUXVlcnlFbmdpbmVcIiwgXCJVc2luZyBmdWxsIGNvbGxlY3Rpb24gc2NhbiB0byBleGVjdXRlIHF1ZXJ5OlwiLCBfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkodCkpLCBcbiAgICAgICAgdGhpcy5ucy5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIEluZGV4T2Zmc2V0Lm1pbigpLCBuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29tYmluZXMgdGhlIHJlc3VsdHMgZnJvbSBhbiBpbmRleGVkIGV4ZWN1dGlvbiB3aXRoIHRoZSByZW1haW5pbmcgZG9jdW1lbnRzXG4gICAgICogdGhhdCBoYXZlIG5vdCB5ZXQgYmVlbiBpbmRleGVkLlxuICAgICAqLyAgICBocyhlLCB0LCBuLCByKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIGFsbCByZXN1bHRzIGZvciBkb2N1bWVudHMgdGhhdCB3ZXJlIHVwZGF0ZWQgc2luY2UgdGhlIG9mZnNldC5cbiAgICAgICAgcmV0dXJuIHRoaXMubnMuZ2V0RG9jdW1lbnRzTWF0Y2hpbmdRdWVyeShlLCBuLCByKS5uZXh0KChlID0+IChcbiAgICAgICAgLy8gTWVyZ2Ugd2l0aCBleGlzdGluZyByZXN1bHRzXG4gICAgICAgIHQuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlID0gZS5pbnNlcnQodC5rZXksIHQpO1xuICAgICAgICB9KSksIGUpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBPdCA9IFwiTG9jYWxTdG9yZVwiLCBOdCA9IDNlODtcblxuLyoqXG4gKiBUaGUgbWF4aW11bSB0aW1lIHRvIGxlYXZlIGEgcmVzdW1lIHRva2VuIGJ1ZmZlcmVkIHdpdGhvdXQgd3JpdGluZyBpdCBvdXQuXG4gKiBUaGlzIHZhbHVlIGlzIGFyYml0cmFyeTogaXQncyBsb25nIGVub3VnaCB0byBhdm9pZCBzZXZlcmFsIHdyaXRlc1xuICogKHBvc3NpYmx5IGluZGVmaW5pdGVseSBpZiB1cGRhdGVzIGNvbWUgbW9yZSBmcmVxdWVudGx5IHRoYW4gdGhpcykgYnV0XG4gKiBzaG9ydCBlbm91Z2ggdGhhdCByZXN0YXJ0aW5nIGFmdGVyIGNyYXNoaW5nIHdpbGwgc3RpbGwgaGF2ZSBhIHByZXR0eVxuICogcmVjZW50IHJlc3VtZSB0b2tlbi5cbiAqL1xuLyoqXG4gKiBJbXBsZW1lbnRzIGBMb2NhbFN0b3JlYCBpbnRlcmZhY2UuXG4gKlxuICogTm90ZTogc29tZSBmaWVsZCBkZWZpbmVkIGluIHRoaXMgY2xhc3MgbWlnaHQgaGF2ZSBwdWJsaWMgYWNjZXNzIGxldmVsLCBidXRcbiAqIHRoZSBjbGFzcyBpcyBub3QgZXhwb3J0ZWQgc28gdGhleSBhcmUgb25seSBhY2Nlc3NpYmxlIGZyb20gdGhpcyBtb2R1bGUuXG4gKiBUaGlzIGlzIHVzZWZ1bCB0byBpbXBsZW1lbnQgb3B0aW9uYWwgZmVhdHVyZXMgKGxpa2UgYnVuZGxlcykgaW4gZnJlZVxuICogZnVuY3Rpb25zLCBzdWNoIHRoYXQgdGhleSBhcmUgdHJlZS1zaGFrZWFibGUuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9Mb2NhbFN0b3JlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIE1hbmFnZXMgb3VyIGluLW1lbW9yeSBvciBkdXJhYmxlIHBlcnNpc3RlbmNlLiAqL1xuICAgIGUsIHQsIG4sIHIpIHtcbiAgICAgICAgdGhpcy5wZXJzaXN0ZW5jZSA9IGUsIHRoaXMuUHMgPSB0LCB0aGlzLnNlcmlhbGl6ZXIgPSByLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIE1hcHMgYSB0YXJnZXRJRCB0byBkYXRhIGFib3V0IGl0cyB0YXJnZXQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogV2UgYXJlIHVzaW5nIGFuIGltbXV0YWJsZSBkYXRhIHN0cnVjdHVyZSBvbiBXZWIgdG8gbWFrZSByZS1ydW5zXG4gICAgICAgICAqIG9mIGBhcHBseVJlbW90ZUV2ZW50KClgIGlkZW1wb3RlbnQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLlRzID0gbmV3IFNvcnRlZE1hcChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciksIFxuICAgICAgICAvKiogTWFwcyBhIHRhcmdldCB0byBpdHMgdGFyZ2V0SUQuICovXG4gICAgICAgIC8vIFRPRE8od3VhbmR5KTogRXZhbHVhdGUgaWYgVGFyZ2V0SWQgY2FuIGJlIHBhcnQgb2YgVGFyZ2V0LlxuICAgICAgICB0aGlzLklzID0gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlUYXJnZXQoZSkpLCBfX1BSSVZBVEVfdGFyZ2V0RXF1YWxzKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHBlciBjb2xsZWN0aW9uIGdyb3VwIGluZGV4IG9mIHRoZSBsYXN0IHJlYWQgdGltZSBwcm9jZXNzZWQgYnlcbiAgICAgICAgICogYGdldE5ld0RvY3VtZW50Q2hhbmdlcygpYC5cbiAgICAgICAgICpcbiAgICAgICAgICogUE9SVElORyBOT1RFOiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgbXVsdGktdGFiIHN5bmNocm9uaXphdGlvbi5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuRXMgPSBuZXcgTWFwLCB0aGlzLmRzID0gZS5nZXRSZW1vdGVEb2N1bWVudENhY2hlKCksIHRoaXMuSHIgPSBlLmdldFRhcmdldENhY2hlKCksIFxuICAgICAgICB0aGlzLllyID0gZS5nZXRCdW5kbGVDYWNoZSgpLCB0aGlzLkFzKG4pO1xuICAgIH1cbiAgICBBcyhlKSB7XG4gICAgICAgIC8vIFRPRE8oaW5kZXhpbmcpOiBBZGQgc3BlYyB0ZXN0cyB0aGF0IHRlc3QgdGhlc2UgY29tcG9uZW50cyBjaGFuZ2UgYWZ0ZXIgYVxuICAgICAgICAvLyB1c2VyIGNoYW5nZVxuICAgICAgICB0aGlzLmRvY3VtZW50T3ZlcmxheUNhY2hlID0gdGhpcy5wZXJzaXN0ZW5jZS5nZXREb2N1bWVudE92ZXJsYXlDYWNoZShlKSwgdGhpcy5pbmRleE1hbmFnZXIgPSB0aGlzLnBlcnNpc3RlbmNlLmdldEluZGV4TWFuYWdlcihlKSwgXG4gICAgICAgIHRoaXMubXV0YXRpb25RdWV1ZSA9IHRoaXMucGVyc2lzdGVuY2UuZ2V0TXV0YXRpb25RdWV1ZShlLCB0aGlzLmluZGV4TWFuYWdlciksIHRoaXMubG9jYWxEb2N1bWVudHMgPSBuZXcgTG9jYWxEb2N1bWVudHNWaWV3KHRoaXMuZHMsIHRoaXMubXV0YXRpb25RdWV1ZSwgdGhpcy5kb2N1bWVudE92ZXJsYXlDYWNoZSwgdGhpcy5pbmRleE1hbmFnZXIpLCBcbiAgICAgICAgdGhpcy5kcy5zZXRJbmRleE1hbmFnZXIodGhpcy5pbmRleE1hbmFnZXIpLCB0aGlzLlBzLmluaXRpYWxpemUodGhpcy5sb2NhbERvY3VtZW50cywgdGhpcy5pbmRleE1hbmFnZXIpO1xuICAgIH1cbiAgICBjb2xsZWN0R2FyYmFnZShlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQ29sbGVjdCBnYXJiYWdlXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKHQgPT4gZS5jb2xsZWN0KHQsIHRoaXMuVHMpKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3TG9jYWxTdG9yZShcbi8qKiBNYW5hZ2VzIG91ciBpbi1tZW1vcnkgb3IgZHVyYWJsZSBwZXJzaXN0ZW5jZS4gKi9cbmUsIHQsIG4sIHIpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9Mb2NhbFN0b3JlSW1wbChlLCB0LCBuLCByKTtcbn1cblxuLyoqXG4gKiBUZWxscyB0aGUgTG9jYWxTdG9yZSB0aGF0IHRoZSBjdXJyZW50bHkgYXV0aGVudGljYXRlZCB1c2VyIGhhcyBjaGFuZ2VkLlxuICpcbiAqIEluIHJlc3BvbnNlIHRoZSBsb2NhbCBzdG9yZSBzd2l0Y2hlcyB0aGUgbXV0YXRpb24gcXVldWUgdG8gdGhlIG5ldyB1c2VyIGFuZFxuICogcmV0dXJucyBhbnkgcmVzdWx0aW5nIGRvY3VtZW50IGNoYW5nZXMuXG4gKi9cbi8vIFBPUlRJTkcgTk9URTogQW5kcm9pZCBhbmQgaU9TIG9ubHkgcmV0dXJuIHRoZSBkb2N1bWVudHMgYWZmZWN0ZWQgYnkgdGhlXG4vLyBjaGFuZ2UuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUhhbmRsZVVzZXJDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiBhd2FpdCBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiSGFuZGxlIHVzZXIgY2hhbmdlXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4ge1xuICAgICAgICAvLyBTd2FwIG91dCB0aGUgbXV0YXRpb24gcXVldWUsIGdyYWJiaW5nIHRoZSBwZW5kaW5nIG11dGF0aW9uIGJhdGNoZXNcbiAgICAgICAgLy8gYmVmb3JlIGFuZCBhZnRlci5cbiAgICAgICAgbGV0IHI7XG4gICAgICAgIHJldHVybiBuLm11dGF0aW9uUXVldWUuZ2V0QWxsTXV0YXRpb25CYXRjaGVzKGUpLm5leHQoKGkgPT4gKHIgPSBpLCBuLkFzKHQpLCBuLm11dGF0aW9uUXVldWUuZ2V0QWxsTXV0YXRpb25CYXRjaGVzKGUpKSkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgY29uc3QgaSA9IFtdLCBzID0gW107XG4gICAgICAgICAgICAvLyBVbmlvbiB0aGUgb2xkL25ldyBjaGFuZ2VkIGtleXMuXG4gICAgICAgICAgICBsZXQgbyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIHtcbiAgICAgICAgICAgICAgICBpLnB1c2goZS5iYXRjaElkKTtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IHQgb2YgZS5tdXRhdGlvbnMpIG8gPSBvLmFkZCh0LmtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdCkge1xuICAgICAgICAgICAgICAgIHMucHVzaChlLmJhdGNoSWQpO1xuICAgICAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiBlLm11dGF0aW9ucykgbyA9IG8uYWRkKHQua2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFJldHVybiB0aGUgc2V0IG9mIGFsbCAocG90ZW50aWFsbHkpIGNoYW5nZWQgZG9jdW1lbnRzIGFuZCB0aGUgbGlzdFxuICAgICAgICAgICAgLy8gb2YgbXV0YXRpb24gYmF0Y2ggSURzIHRoYXQgd2VyZSBhZmZlY3RlZCBieSBjaGFuZ2UuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5sb2NhbERvY3VtZW50cy5nZXREb2N1bWVudHMoZSwgbykubmV4dCgoZSA9PiAoe1xuICAgICAgICAgICAgICAgIFJzOiBlLFxuICAgICAgICAgICAgICAgIHJlbW92ZWRCYXRjaElkczogaSxcbiAgICAgICAgICAgICAgICBhZGRlZEJhdGNoSWRzOiBzXG4gICAgICAgICAgICB9KSkpO1xuICAgICAgICB9KSk7XG4gICAgfSkpO1xufVxuXG4vKiBBY2NlcHRzIGxvY2FsbHkgZ2VuZXJhdGVkIE11dGF0aW9ucyBhbmQgY29tbWl0IHRoZW0gdG8gc3RvcmFnZS4gKi9cbi8qKlxuICogQWNrbm93bGVkZ2VzIHRoZSBnaXZlbiBiYXRjaC5cbiAqXG4gKiBPbiB0aGUgaGFwcHkgcGF0aCB3aGVuIGEgYmF0Y2ggaXMgYWNrbm93bGVkZ2VkLCB0aGUgbG9jYWwgc3RvcmUgd2lsbFxuICpcbiAqICArIHJlbW92ZSB0aGUgYmF0Y2ggZnJvbSB0aGUgbXV0YXRpb24gcXVldWU7XG4gKiAgKyBhcHBseSB0aGUgY2hhbmdlcyB0byB0aGUgcmVtb3RlIGRvY3VtZW50IGNhY2hlO1xuICogICsgcmVjYWxjdWxhdGUgdGhlIGxhdGVuY3kgY29tcGVuc2F0ZWQgdmlldyBpbXBsaWVkIGJ5IHRob3NlIGNoYW5nZXMgKHRoZXJlXG4gKiAgICBtYXkgYmUgbXV0YXRpb25zIGluIHRoZSBxdWV1ZSB0aGF0IGFmZmVjdCB0aGUgZG9jdW1lbnRzIGJ1dCBoYXZlbid0IGJlZW5cbiAqICAgIGFja25vd2xlZGdlZCB5ZXQpOyBhbmRcbiAqICArIGdpdmUgdGhlIGNoYW5nZWQgZG9jdW1lbnRzIGJhY2sgdGhlIHN5bmMgZW5naW5lXG4gKlxuICogQHJldHVybnMgVGhlIHJlc3VsdGluZyAobW9kaWZpZWQpIGRvY3VtZW50cy5cbiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVBY2tub3dsZWRnZUJhdGNoKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkFja25vd2xlZGdlIGJhdGNoXCIsIFwicmVhZHdyaXRlLXByaW1hcnlcIiwgKGUgPT4ge1xuICAgICAgICBjb25zdCByID0gdC5iYXRjaC5rZXlzKCksIGkgPSBuLmRzLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgICAgICB0cmFja1JlbW92YWxzOiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9hcHBseVdyaXRlVG9SZW1vdGVEb2N1bWVudHMoZSwgdCwgbiwgcikge1xuICAgICAgICAgICAgY29uc3QgaSA9IG4uYmF0Y2gsIHMgPSBpLmtleXMoKTtcbiAgICAgICAgICAgIGxldCBvID0gUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICAgIHJldHVybiBzLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIG8gPSBvLm5leHQoKCgpID0+IHIuZ2V0RW50cnkodCwgZSkpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IG4uZG9jVmVyc2lvbnMuZ2V0KGUpO1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChudWxsICE9PSBzKSwgdC52ZXJzaW9uLmNvbXBhcmVUbyhzKSA8IDAgJiYgKGkuYXBwbHlUb1JlbW90ZURvY3VtZW50KHQsIG4pLCBcbiAgICAgICAgICAgICAgICAgICAgdC5pc1ZhbGlkRG9jdW1lbnQoKSAmJiAoXG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIHVzZSB0aGUgY29tbWl0VmVyc2lvbiBhcyB0aGUgcmVhZFRpbWUgcmF0aGVyIHRoYW4gdGhlXG4gICAgICAgICAgICAgICAgICAgIC8vIGRvY3VtZW50J3MgdXBkYXRlVGltZSBzaW5jZSB0aGUgdXBkYXRlVGltZSBpcyBub3QgYWR2YW5jZWRcbiAgICAgICAgICAgICAgICAgICAgLy8gZm9yIHVwZGF0ZXMgdGhhdCBkbyBub3QgbW9kaWZ5IHRoZSB1bmRlcmx5aW5nIGRvY3VtZW50LlxuICAgICAgICAgICAgICAgICAgICB0LnNldFJlYWRUaW1lKG4uY29tbWl0VmVyc2lvbiksIHIuYWRkRW50cnkodCkpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSksIG8ubmV4dCgoKCkgPT4gZS5tdXRhdGlvblF1ZXVlLnJlbW92ZU11dGF0aW9uQmF0Y2godCwgaSkpKTtcbiAgICAgICAgfVxuICAgICAgICAvKiogUmV0dXJucyB0aGUgbG9jYWwgdmlldyBvZiB0aGUgZG9jdW1lbnRzIGFmZmVjdGVkIGJ5IGEgbXV0YXRpb24gYmF0Y2guICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIChuLCBlLCB0LCBpKS5uZXh0KCgoKSA9PiBpLmFwcGx5KGUpKSkubmV4dCgoKCkgPT4gbi5tdXRhdGlvblF1ZXVlLnBlcmZvcm1Db25zaXN0ZW5jeUNoZWNrKGUpKSkubmV4dCgoKCkgPT4gbi5kb2N1bWVudE92ZXJsYXlDYWNoZS5yZW1vdmVPdmVybGF5c0ZvckJhdGNoSWQoZSwgciwgdC5iYXRjaC5iYXRjaElkKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMucmVjYWxjdWxhdGVBbmRTYXZlT3ZlcmxheXNGb3JEb2N1bWVudEtleXMoZSwgZnVuY3Rpb24gX19QUklWQVRFX2dldEtleXNXaXRoVHJhbnNmb3JtUmVzdWx0cyhlKSB7XG4gICAgICAgICAgICBsZXQgdCA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgZm9yIChsZXQgbiA9IDA7IG4gPCBlLm11dGF0aW9uUmVzdWx0cy5sZW5ndGg7ICsrbikge1xuICAgICAgICAgICAgICAgIGUubXV0YXRpb25SZXN1bHRzW25dLnRyYW5zZm9ybVJlc3VsdHMubGVuZ3RoID4gMCAmJiAodCA9IHQuYWRkKGUuYmF0Y2gubXV0YXRpb25zW25dLmtleSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZW1vdmVzIG11dGF0aW9ucyBmcm9tIHRoZSBNdXRhdGlvblF1ZXVlIGZvciB0aGUgc3BlY2lmaWVkIGJhdGNoO1xuICogTG9jYWxEb2N1bWVudHMgd2lsbCBiZSByZWNhbGN1bGF0ZWQuXG4gKlxuICogQHJldHVybnMgVGhlIHJlc3VsdGluZyBtb2RpZmllZCBkb2N1bWVudHMuXG4gKi8gKHQpKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKGUsIHIpKSk7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIGxhc3QgY29uc2lzdGVudCBzbmFwc2hvdCBwcm9jZXNzZWQgKHVzZWQgYnkgdGhlIFJlbW90ZVN0b3JlIHRvXG4gKiBkZXRlcm1pbmUgd2hldGhlciB0byBidWZmZXIgaW5jb21pbmcgc25hcHNob3RzIGZyb20gdGhlIGJhY2tlbmQpLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24oZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IGxhc3QgcmVtb3RlIHNuYXBzaG90IHZlcnNpb25cIiwgXCJyZWFkb25seVwiLCAoZSA9PiB0LkhyLmdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24oZSkpKTtcbn1cblxuLyoqXG4gKiBVcGRhdGVzIHRoZSBcImdyb3VuZC1zdGF0ZVwiIChyZW1vdGUpIGRvY3VtZW50cy4gV2UgYXNzdW1lIHRoYXQgdGhlIHJlbW90ZVxuICogZXZlbnQgcmVmbGVjdHMgYW55IHdyaXRlIGJhdGNoZXMgdGhhdCBoYXZlIGJlZW4gYWNrbm93bGVkZ2VkIG9yIHJlamVjdGVkXG4gKiAoaS5lLiB3ZSBkbyBub3QgcmUtYXBwbHkgbG9jYWwgbXV0YXRpb25zIHRvIHVwZGF0ZXMgZnJvbSB0aGlzIGV2ZW50KS5cbiAqXG4gKiBMb2NhbERvY3VtZW50cyBhcmUgcmUtY2FsY3VsYXRlZCBpZiB0aGVyZSBhcmUgcmVtYWluaW5nIG11dGF0aW9ucyBpbiB0aGVcbiAqIHF1ZXVlLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQXBwbHlSZW1vdGVFdmVudFRvTG9jYWxDYWNoZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSB0LnNuYXBzaG90VmVyc2lvbjtcbiAgICBsZXQgaSA9IG4uVHM7XG4gICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJBcHBseSByZW1vdGUgZXZlbnRcIiwgXCJyZWFkd3JpdGUtcHJpbWFyeVwiLCAoZSA9PiB7XG4gICAgICAgIGNvbnN0IHMgPSBuLmRzLm5ld0NoYW5nZUJ1ZmZlcih7XG4gICAgICAgICAgICB0cmFja1JlbW92YWxzOiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gUmVzZXQgbmV3VGFyZ2V0RGF0YUJ5VGFyZ2V0TWFwIGluIGNhc2UgdGhpcyB0cmFuc2FjdGlvbiBnZXRzIHJlLXJ1bi5cbiAgICAgICAgICAgICAgICBpID0gbi5UcztcbiAgICAgICAgY29uc3QgbyA9IFtdO1xuICAgICAgICB0LnRhcmdldENoYW5nZXMuZm9yRWFjaCgoKHMsIF8pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGEgPSBpLmdldChfKTtcbiAgICAgICAgICAgIGlmICghYSkgcmV0dXJuO1xuICAgICAgICAgICAgLy8gT25seSB1cGRhdGUgdGhlIHJlbW90ZSBrZXlzIGlmIHRoZSB0YXJnZXQgaXMgc3RpbGwgYWN0aXZlLiBUaGlzXG4gICAgICAgICAgICAvLyBlbnN1cmVzIHRoYXQgd2UgY2FuIHBlcnNpc3QgdGhlIHVwZGF0ZWQgdGFyZ2V0IGRhdGEgYWxvbmcgd2l0aFxuICAgICAgICAgICAgLy8gdGhlIHVwZGF0ZWQgYXNzaWdubWVudC5cbiAgICAgICAgICAgICAgICAgICAgICAgIG8ucHVzaChuLkhyLnJlbW92ZU1hdGNoaW5nS2V5cyhlLCBzLnJlbW92ZWREb2N1bWVudHMsIF8pLm5leHQoKCgpID0+IG4uSHIuYWRkTWF0Y2hpbmdLZXlzKGUsIHMuYWRkZWREb2N1bWVudHMsIF8pKSkpO1xuICAgICAgICAgICAgbGV0IHUgPSBhLndpdGhTZXF1ZW5jZU51bWJlcihlLmN1cnJlbnRTZXF1ZW5jZU51bWJlcik7XG4gICAgICAgICAgICBudWxsICE9PSB0LnRhcmdldE1pc21hdGNoZXMuZ2V0KF8pID8gdSA9IHUud2l0aFJlc3VtZVRva2VuKEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcsIFNuYXBzaG90VmVyc2lvbi5taW4oKSkud2l0aExhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24oU25hcHNob3RWZXJzaW9uLm1pbigpKSA6IHMucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCAmJiAodSA9IHUud2l0aFJlc3VtZVRva2VuKHMucmVzdW1lVG9rZW4sIHIpKSwgXG4gICAgICAgICAgICBpID0gaS5pbnNlcnQoXywgdSksIFxuICAgICAgICAgICAgLy8gVXBkYXRlIHRoZSB0YXJnZXQgZGF0YSBpZiB0aGVyZSBhcmUgdGFyZ2V0IGNoYW5nZXMgKG9yIGlmXG4gICAgICAgICAgICAvLyBzdWZmaWNpZW50IHRpbWUgaGFzIHBhc3NlZCBzaW5jZSB0aGUgbGFzdCB1cGRhdGUpLlxuICAgICAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIG5ld1RhcmdldERhdGEgc2hvdWxkIGJlIHBlcnNpc3RlZCBkdXJpbmcgYW4gdXBkYXRlIG9mXG4gKiBhbiBhY3RpdmUgdGFyZ2V0LiBUYXJnZXREYXRhIHNob3VsZCBhbHdheXMgYmUgcGVyc2lzdGVkIHdoZW4gYSB0YXJnZXQgaXNcbiAqIGJlaW5nIHJlbGVhc2VkIGFuZCBzaG91bGQgbm90IGNhbGwgdGhpcyBmdW5jdGlvbi5cbiAqXG4gKiBXaGlsZSB0aGUgdGFyZ2V0IGlzIGFjdGl2ZSwgVGFyZ2V0RGF0YSB1cGRhdGVzIGNhbiBiZSBvbWl0dGVkIHdoZW4gbm90aGluZ1xuICogYWJvdXQgdGhlIHRhcmdldCBoYXMgY2hhbmdlZCBleGNlcHQgbWV0YWRhdGEgbGlrZSB0aGUgcmVzdW1lIHRva2VuIG9yXG4gKiBzbmFwc2hvdCB2ZXJzaW9uLiBPY2Nhc2lvbmFsbHkgaXQncyB3b3J0aCB0aGUgZXh0cmEgd3JpdGUgdG8gcHJldmVudCB0aGVzZVxuICogdmFsdWVzIGZyb20gZ2V0dGluZyB0b28gc3RhbGUgYWZ0ZXIgYSBjcmFzaCwgYnV0IHRoaXMgZG9lc24ndCBoYXZlIHRvIGJlXG4gKiB0b28gZnJlcXVlbnQuXG4gKi9cbiAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9zaG91bGRQZXJzaXN0VGFyZ2V0RGF0YShlLCB0LCBuKSB7XG4gICAgICAgICAgICAgICAgLy8gQWx3YXlzIHBlcnNpc3QgdGFyZ2V0IGRhdGEgaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIGEgcmVzdW1lIHRva2VuLlxuICAgICAgICAgICAgICAgIGlmICgwID09PSBlLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSkgcmV0dXJuICEwO1xuICAgICAgICAgICAgICAgIC8vIERvbid0IGFsbG93IHJlc3VtZSB0b2tlbiBjaGFuZ2VzIHRvIGJlIGJ1ZmZlcmVkIGluZGVmaW5pdGVseS4gVGhpc1xuICAgICAgICAgICAgICAgIC8vIGFsbG93cyB1cyB0byBiZSByZWFzb25hYmx5IHVwLXRvLWRhdGUgYWZ0ZXIgYSBjcmFzaCBhbmQgYXZvaWRzIG5lZWRpbmdcbiAgICAgICAgICAgICAgICAvLyB0byBsb29wIG92ZXIgYWxsIGFjdGl2ZSBxdWVyaWVzIG9uIHNodXRkb3duLiBFc3BlY2lhbGx5IGluIHRoZSBicm93c2VyXG4gICAgICAgICAgICAgICAgLy8gd2UgbWF5IG5vdCBnZXQgdGltZSB0byBkbyBhbnl0aGluZyBpbnRlcmVzdGluZyB3aGlsZSB0aGUgY3VycmVudCB0YWIgaXNcbiAgICAgICAgICAgICAgICAvLyBjbG9zaW5nLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gdC5zbmFwc2hvdFZlcnNpb24udG9NaWNyb3NlY29uZHMoKSAtIGUuc25hcHNob3RWZXJzaW9uLnRvTWljcm9zZWNvbmRzKCk7XG4gICAgICAgICAgICAgICAgaWYgKHIgPj0gTnQpIHJldHVybiAhMDtcbiAgICAgICAgICAgICAgICAvLyBPdGhlcndpc2UgaWYgdGhlIG9ubHkgdGhpbmcgdGhhdCBoYXMgY2hhbmdlZCBhYm91dCBhIHRhcmdldCBpcyBpdHMgcmVzdW1lXG4gICAgICAgICAgICAgICAgLy8gdG9rZW4gaXQncyBub3Qgd29ydGggcGVyc2lzdGluZy4gTm90ZSB0aGF0IHRoZSBSZW1vdGVTdG9yZSBrZWVwcyBhblxuICAgICAgICAgICAgICAgIC8vIGluLW1lbW9yeSB2aWV3IG9mIHRoZSBjdXJyZW50bHkgYWN0aXZlIHRhcmdldHMgd2hpY2ggaW5jbHVkZXMgdGhlIGN1cnJlbnRcbiAgICAgICAgICAgICAgICAvLyByZXN1bWUgdG9rZW4sIHNvIHN0cmVhbSBmYWlsdXJlIG9yIHVzZXIgY2hhbmdlcyB3aWxsIHN0aWxsIHVzZSBhblxuICAgICAgICAgICAgICAgIC8vIHVwLXRvLWRhdGUgcmVzdW1lIHRva2VuIHJlZ2FyZGxlc3Mgb2Ygd2hhdCB3ZSBkbyBoZXJlLlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gbi5hZGRlZERvY3VtZW50cy5zaXplICsgbi5tb2RpZmllZERvY3VtZW50cy5zaXplICsgbi5yZW1vdmVkRG9jdW1lbnRzLnNpemU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGkgPiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBOb3RpZmllcyBsb2NhbCBzdG9yZSBvZiB0aGUgY2hhbmdlZCB2aWV3cyB0byBsb2NhbGx5IHBpbiBkb2N1bWVudHMuXG4gKi8gKGEsIHUsIHMpICYmIG8ucHVzaChuLkhyLnVwZGF0ZVRhcmdldERhdGEoZSwgdSkpO1xuICAgICAgICB9KSk7XG4gICAgICAgIGxldCBfID0gX19QUklWQVRFX211dGFibGVEb2N1bWVudE1hcCgpLCBhID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIC8vIEhBQ0s6IFRoZSBvbmx5IHJlYXNvbiB3ZSBhbGxvdyBhIG51bGwgc25hcHNob3QgdmVyc2lvbiBpcyBzbyB0aGF0IHdlXG4gICAgICAgIC8vIGNhbiBzeW50aGVzaXplIHJlbW90ZSBldmVudHMgd2hlbiB3ZSBnZXQgcGVybWlzc2lvbiBkZW5pZWQgZXJyb3JzIHdoaWxlXG4gICAgICAgIC8vIHRyeWluZyB0byByZXNvbHZlIHRoZSBzdGF0ZSBvZiBhIGxvY2FsbHkgY2FjaGVkIGRvY3VtZW50IHRoYXQgaXMgaW5cbiAgICAgICAgLy8gbGltYm8uXG4gICAgICAgIGlmICh0LmRvY3VtZW50VXBkYXRlcy5mb3JFYWNoKChyID0+IHtcbiAgICAgICAgICAgIHQucmVzb2x2ZWRMaW1ib0RvY3VtZW50cy5oYXMocikgJiYgby5wdXNoKG4ucGVyc2lzdGVuY2UucmVmZXJlbmNlRGVsZWdhdGUudXBkYXRlTGltYm9Eb2N1bWVudChlLCByKSk7XG4gICAgICAgIH0pKSwgXG4gICAgICAgIC8vIEVhY2ggbG9vcCBpdGVyYXRpb24gb25seSBhZmZlY3RzIGl0cyBcIm93blwiIGRvYywgc28gaXQncyBzYWZlIHRvIGdldCBhbGxcbiAgICAgICAgLy8gdGhlIHJlbW90ZSBkb2N1bWVudHMgaW4gYWR2YW5jZSBpbiBhIHNpbmdsZSBjYWxsLlxuICAgICAgICBvLnB1c2goX19QUklWQVRFX3BvcHVsYXRlRG9jdW1lbnRDaGFuZ2VCdWZmZXIoZSwgcywgdC5kb2N1bWVudFVwZGF0ZXMpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgXyA9IGUuVnMsIGEgPSBlLmZzO1xuICAgICAgICB9KSkpLCAhci5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBuLkhyLmdldExhc3RSZW1vdGVTbmFwc2hvdFZlcnNpb24oZSkubmV4dCgodCA9PiBuLkhyLnNldFRhcmdldHNNZXRhZGF0YShlLCBlLmN1cnJlbnRTZXF1ZW5jZU51bWJlciwgcikpKTtcbiAgICAgICAgICAgIG8ucHVzaCh0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUGVyc2lzdGVuY2VQcm9taXNlLndhaXRGb3IobykubmV4dCgoKCkgPT4gcy5hcHBseShlKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0TG9jYWxWaWV3T2ZEb2N1bWVudHMoZSwgXywgYSkpKS5uZXh0KCgoKSA9PiBfKSk7XG4gICAgfSkpLnRoZW4oKGUgPT4gKG4uVHMgPSBpLCBlKSkpO1xufVxuXG4vKipcbiAqIFBvcHVsYXRlcyBkb2N1bWVudCBjaGFuZ2UgYnVmZmVyIHdpdGggZG9jdW1lbnRzIGZyb20gYmFja2VuZCBvciBhIGJ1bmRsZS5cbiAqIFJldHVybnMgdGhlIGRvY3VtZW50IGNoYW5nZXMgcmVzdWx0aW5nIGZyb20gYXBwbHlpbmcgdGhvc2UgZG9jdW1lbnRzLCBhbmRcbiAqIGFsc28gYSBzZXQgb2YgZG9jdW1lbnRzIHdob3NlIGV4aXN0ZW5jZSBzdGF0ZSBhcmUgY2hhbmdlZCBhcyBhIHJlc3VsdC5cbiAqXG4gKiBAcGFyYW0gdHhuIC0gVHJhbnNhY3Rpb24gdG8gdXNlIHRvIHJlYWQgZXhpc3RpbmcgZG9jdW1lbnRzIGZyb20gc3RvcmFnZS5cbiAqIEBwYXJhbSBkb2N1bWVudEJ1ZmZlciAtIERvY3VtZW50IGJ1ZmZlciB0byBjb2xsZWN0IHRoZSByZXN1bHRlZCBjaGFuZ2VzIHRvIGJlXG4gKiAgICAgICAgYXBwbGllZCB0byBzdG9yYWdlLlxuICogQHBhcmFtIGRvY3VtZW50cyAtIERvY3VtZW50cyB0byBiZSBhcHBsaWVkLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wb3B1bGF0ZURvY3VtZW50Q2hhbmdlQnVmZmVyKGUsIHQsIG4pIHtcbiAgICBsZXQgciA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBpID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgcmV0dXJuIG4uZm9yRWFjaCgoZSA9PiByID0gci5hZGQoZSkpKSwgdC5nZXRFbnRyaWVzKGUsIHIpLm5leHQoKGUgPT4ge1xuICAgICAgICBsZXQgciA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKTtcbiAgICAgICAgcmV0dXJuIG4uZm9yRWFjaCgoKG4sIHMpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG8gPSBlLmdldChuKTtcbiAgICAgICAgICAgIC8vIENoZWNrIGlmIHNlZSBpZiB0aGVyZSBpcyBhIGV4aXN0ZW5jZSBzdGF0ZSBjaGFuZ2UgZm9yIHRoaXMgZG9jdW1lbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICBzLmlzRm91bmREb2N1bWVudCgpICE9PSBvLmlzRm91bmREb2N1bWVudCgpICYmIChpID0gaS5hZGQobikpLCBcbiAgICAgICAgICAgIC8vIE5vdGU6IFRoZSBvcmRlciBvZiB0aGUgc3RlcHMgYmVsb3cgaXMgaW1wb3J0YW50LCBzaW5jZSB3ZSB3YW50XG4gICAgICAgICAgICAvLyB0byBlbnN1cmUgdGhhdCByZWplY3RlZCBsaW1ibyByZXNvbHV0aW9ucyAod2hpY2ggZmFicmljYXRlXG4gICAgICAgICAgICAvLyBOb0RvY3VtZW50cyB3aXRoIFNuYXBzaG90VmVyc2lvbi5taW4oKSkgbmV2ZXIgYWRkIGRvY3VtZW50cyB0b1xuICAgICAgICAgICAgLy8gY2FjaGUuXG4gICAgICAgICAgICBzLmlzTm9Eb2N1bWVudCgpICYmIHMudmVyc2lvbi5pc0VxdWFsKFNuYXBzaG90VmVyc2lvbi5taW4oKSkgPyAoXG4gICAgICAgICAgICAvLyBOb0RvY3VtZW50cyB3aXRoIFNuYXBzaG90VmVyc2lvbi5taW4oKSBhcmUgdXNlZCBpbiBtYW51ZmFjdHVyZWRcbiAgICAgICAgICAgIC8vIGV2ZW50cy4gV2UgcmVtb3ZlIHRoZXNlIGRvY3VtZW50cyBmcm9tIGNhY2hlIHNpbmNlIHdlIGxvc3RcbiAgICAgICAgICAgIC8vIGFjY2Vzcy5cbiAgICAgICAgICAgIHQucmVtb3ZlRW50cnkobiwgcy5yZWFkVGltZSksIHIgPSByLmluc2VydChuLCBzKSkgOiAhby5pc1ZhbGlkRG9jdW1lbnQoKSB8fCBzLnZlcnNpb24uY29tcGFyZVRvKG8udmVyc2lvbikgPiAwIHx8IDAgPT09IHMudmVyc2lvbi5jb21wYXJlVG8oby52ZXJzaW9uKSAmJiBvLmhhc1BlbmRpbmdXcml0ZXMgPyAodC5hZGRFbnRyeShzKSwgXG4gICAgICAgICAgICByID0gci5pbnNlcnQobiwgcykpIDogX19QUklWQVRFX2xvZ0RlYnVnKE90LCBcIklnbm9yaW5nIG91dGRhdGVkIHdhdGNoIHVwZGF0ZSBmb3IgXCIsIG4sIFwiLiBDdXJyZW50IHZlcnNpb246XCIsIG8udmVyc2lvbiwgXCIgV2F0Y2ggdmVyc2lvbjpcIiwgcy52ZXJzaW9uKTtcbiAgICAgICAgfSkpLCB7XG4gICAgICAgICAgICBWczogcixcbiAgICAgICAgICAgIGZzOiBpXG4gICAgICAgIH07XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIEdldHMgdGhlIG11dGF0aW9uIGJhdGNoIGFmdGVyIHRoZSBwYXNzZWQgaW4gYmF0Y2hJZCBpbiB0aGUgbXV0YXRpb24gcXVldWVcbiAqIG9yIG51bGwgaWYgZW1wdHkuXG4gKiBAcGFyYW0gYWZ0ZXJCYXRjaElkIC0gSWYgcHJvdmlkZWQsIHRoZSBiYXRjaCB0byBzZWFyY2ggYWZ0ZXIuXG4gKiBAcmV0dXJucyBUaGUgbmV4dCBtdXRhdGlvbiBvciBudWxsIGlmIHRoZXJlIHdhc24ndCBvbmUuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TmV4dE11dGF0aW9uQmF0Y2goZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5leHQgbXV0YXRpb24gYmF0Y2hcIiwgXCJyZWFkb25seVwiLCAoZSA9PiAodm9pZCAwID09PSB0ICYmICh0ID0gUSksIFxuICAgIG4ubXV0YXRpb25RdWV1ZS5nZXROZXh0TXV0YXRpb25CYXRjaEFmdGVyQmF0Y2hJZChlLCB0KSkpKTtcbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgY3VycmVudCB2YWx1ZSBvZiBhIERvY3VtZW50IHdpdGggYSBnaXZlbiBrZXkgb3IgbnVsbCBpZiBub3RcbiAqIGZvdW5kIC0gdXNlZCBmb3IgdGVzdGluZy5cbiAqL1xuLyoqXG4gKiBBc3NpZ25zIHRoZSBnaXZlbiB0YXJnZXQgYW4gaW50ZXJuYWwgSUQgc28gdGhhdCBpdHMgcmVzdWx0cyBjYW4gYmUgcGlubmVkIHNvXG4gKiB0aGV5IGRvbid0IGdldCBHQydkLiBBIHRhcmdldCBtdXN0IGJlIGFsbG9jYXRlZCBpbiB0aGUgbG9jYWwgc3RvcmUgYmVmb3JlXG4gKiB0aGUgc3RvcmUgY2FuIGJlIHVzZWQgdG8gbWFuYWdlIGl0cyB2aWV3LlxuICpcbiAqIEFsbG9jYXRpbmcgYW4gYWxyZWFkeSBhbGxvY2F0ZWQgYFRhcmdldGAgd2lsbCByZXR1cm4gdGhlIGV4aXN0aW5nIGBUYXJnZXREYXRhYFxuICogZm9yIHRoYXQgYFRhcmdldGAuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQWxsb2NhdGUgdGFyZ2V0XCIsIFwicmVhZHdyaXRlXCIsIChlID0+IHtcbiAgICAgICAgbGV0IHI7XG4gICAgICAgIHJldHVybiBuLkhyLmdldFRhcmdldERhdGEoZSwgdCkubmV4dCgoaSA9PiBpID8gKFxuICAgICAgICAvLyBUaGlzIHRhcmdldCBoYXMgYmVlbiBsaXN0ZW5lZCB0byBwcmV2aW91c2x5LCBzbyByZXVzZSB0aGVcbiAgICAgICAgLy8gcHJldmlvdXMgdGFyZ2V0SUQuXG4gICAgICAgIC8vIFRPRE8obWNnKTogZnJlc2hlbiBsYXN0IGFjY2Vzc2VkIGRhdGU/XG4gICAgICAgIHIgPSBpLCBQZXJzaXN0ZW5jZVByb21pc2UucmVzb2x2ZShyKSkgOiBuLkhyLmFsbG9jYXRlVGFyZ2V0SWQoZSkubmV4dCgoaSA9PiAociA9IG5ldyBUYXJnZXREYXRhKHQsIGksIFwiVGFyZ2V0UHVycG9zZUxpc3RlblwiIC8qIFRhcmdldFB1cnBvc2UuTGlzdGVuICovICwgZS5jdXJyZW50U2VxdWVuY2VOdW1iZXIpLCBcbiAgICAgICAgbi5Ici5hZGRUYXJnZXREYXRhKGUsIHIpLm5leHQoKCgpID0+IHIpKSkpKSkpO1xuICAgIH0pKS50aGVuKChlID0+IHtcbiAgICAgICAgLy8gSWYgTXVsdGktVGFiIGlzIGVuYWJsZWQsIHRoZSBleGlzdGluZyB0YXJnZXQgZGF0YSBtYXkgYmUgbmV3ZXIgdGhhblxuICAgICAgICAvLyB0aGUgaW4tbWVtb3J5IGRhdGFcbiAgICAgICAgY29uc3QgciA9IG4uVHMuZ2V0KGUudGFyZ2V0SWQpO1xuICAgICAgICByZXR1cm4gKG51bGwgPT09IHIgfHwgZS5zbmFwc2hvdFZlcnNpb24uY29tcGFyZVRvKHIuc25hcHNob3RWZXJzaW9uKSA+IDApICYmIChuLlRzID0gbi5Ucy5pbnNlcnQoZS50YXJnZXRJZCwgZSksIFxuICAgICAgICBuLklzLnNldCh0LCBlLnRhcmdldElkKSksIGU7XG4gICAgfSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdGhlIFRhcmdldERhdGEgYXMgc2VlbiBieSB0aGUgTG9jYWxTdG9yZSwgaW5jbHVkaW5nIHVwZGF0ZXMgdGhhdCBtYXlcbiAqIGhhdmUgbm90IHlldCBiZWVuIHBlcnNpc3RlZCB0byB0aGUgVGFyZ2V0Q2FjaGUuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmcuXG4vKipcbiAqIFVucGlucyBhbGwgdGhlIGRvY3VtZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHRhcmdldC4gSWZcbiAqIGBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YWAgaXMgc2V0IHRvIGZhbHNlIGFuZCBFYWdlciBHQyBlbmFibGVkLCB0aGUgbWV0aG9kXG4gKiBkaXJlY3RseSByZW1vdmVzIHRoZSBhc3NvY2lhdGVkIHRhcmdldCBkYXRhIGZyb20gdGhlIHRhcmdldCBjYWNoZS5cbiAqXG4gKiBSZWxlYXNpbmcgYSBub24tZXhpc3RpbmcgYFRhcmdldGAgaXMgYSBuby1vcC5cbiAqL1xuLy8gUE9SVElORyBOT1RFOiBga2VlcFBlcnNpc3RlZFRhcmdldERhdGFgIGlzIG11bHRpLXRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgaSA9IHIuVHMuZ2V0KHQpLCBzID0gbiA/IFwicmVhZHdyaXRlXCIgOiBcInJlYWR3cml0ZS1wcmltYXJ5XCI7XG4gICAgdHJ5IHtcbiAgICAgICAgbiB8fCBhd2FpdCByLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiUmVsZWFzZSB0YXJnZXRcIiwgcywgKGUgPT4gci5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZS5yZW1vdmVUYXJnZXQoZSwgaSkpKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmICghX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgdGhyb3cgZTtcbiAgICAgICAgLy8gQWxsIGByZWxlYXNlVGFyZ2V0YCBkb2VzIGlzIHJlY29yZCB0aGUgZmluYWwgbWV0YWRhdGEgc3RhdGUgZm9yIHRoZVxuICAgICAgICAvLyB0YXJnZXQsIGJ1dCB3ZSd2ZSBiZWVuIHJlY29yZGluZyB0aGlzIHBlcmlvZGljYWxseSBkdXJpbmcgdGFyZ2V0XG4gICAgICAgIC8vIGFjdGl2aXR5LiBJZiB3ZSBsb3NlIHRoaXMgd3JpdGUgdGhpcyBjb3VsZCBjYXVzZSBhIHZlcnkgc2xpZ2h0XG4gICAgICAgIC8vIGRpZmZlcmVuY2UgaW4gdGhlIG9yZGVyIG9mIHRhcmdldCBkZWxldGlvbiBkdXJpbmcgR0MsIGJ1dCB3ZVxuICAgICAgICAvLyBkb24ndCBkZWZpbmUgZXhhY3QgTFJVIHNlbWFudGljcyBzbyB0aGlzIGlzIGFjY2VwdGFibGUuXG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhPdCwgYEZhaWxlZCB0byB1cGRhdGUgc2VxdWVuY2UgbnVtYmVycyBmb3IgdGFyZ2V0ICR7dH06ICR7ZX1gKTtcbiAgICB9XG4gICAgci5UcyA9IHIuVHMucmVtb3ZlKHQpLCByLklzLmRlbGV0ZShpLnRhcmdldCk7XG59XG5cbi8qKlxuICogUnVucyB0aGUgc3BlY2lmaWVkIHF1ZXJ5IGFnYWluc3QgdGhlIGxvY2FsIHN0b3JlIGFuZCByZXR1cm5zIHRoZSByZXN1bHRzLFxuICogcG90ZW50aWFsbHkgdGFraW5nIGFkdmFudGFnZSBvZiBxdWVyeSBkYXRhIGZyb20gcHJldmlvdXMgZXhlY3V0aW9ucyAoc3VjaFxuICogYXMgdGhlIHNldCBvZiByZW1vdGUga2V5cykuXG4gKlxuICogQHBhcmFtIHVzZVByZXZpb3VzUmVzdWx0cyAtIFdoZXRoZXIgcmVzdWx0cyBmcm9tIHByZXZpb3VzIGV4ZWN1dGlvbnMgY2FuXG4gKiBiZSB1c2VkIHRvIG9wdGltaXplIHRoaXMgcXVlcnkgZXhlY3V0aW9uLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlRXhlY3V0ZVF1ZXJ5KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBsZXQgaSA9IFNuYXBzaG90VmVyc2lvbi5taW4oKSwgcyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgIHJldHVybiByLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiRXhlY3V0ZSBxdWVyeVwiLCBcInJlYWR3cml0ZVwiLCAoLy8gVXNlIHJlYWR3cml0ZSBpbnN0ZWFkIG9mIHJlYWRvbmx5IHNvIGluZGV4ZXMgY2FuIGJlIGNyZWF0ZWRcbiAgICAvLyBVc2UgcmVhZHdyaXRlIGluc3RlYWQgb2YgcmVhZG9ubHkgc28gaW5kZXhlcyBjYW4gYmUgY3JlYXRlZFxuICAgIGUgPT4gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRUYXJnZXREYXRhKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIGkgPSByLklzLmdldChuKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gaSA/IFBlcnNpc3RlbmNlUHJvbWlzZS5yZXNvbHZlKHIuVHMuZ2V0KGkpKSA6IHIuSHIuZ2V0VGFyZ2V0RGF0YSh0LCBuKTtcbiAgICB9KHIsIGUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKS5uZXh0KCh0ID0+IHtcbiAgICAgICAgaWYgKHQpIHJldHVybiBpID0gdC5sYXN0TGltYm9GcmVlU25hcHNob3RWZXJzaW9uLCByLkhyLmdldE1hdGNoaW5nS2V5c0ZvclRhcmdldElkKGUsIHQudGFyZ2V0SWQpLm5leHQoKGUgPT4ge1xuICAgICAgICAgICAgcyA9IGU7XG4gICAgICAgIH0pKTtcbiAgICB9KSkubmV4dCgoKCkgPT4gci5Qcy5nZXREb2N1bWVudHNNYXRjaGluZ1F1ZXJ5KGUsIHQsIG4gPyBpIDogU25hcHNob3RWZXJzaW9uLm1pbigpLCBuID8gcyA6IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpKSkpLm5leHQoKGUgPT4gKF9fUFJJVkFURV9zZXRNYXhSZWFkVGltZShyLCBfX1BSSVZBVEVfcXVlcnlDb2xsZWN0aW9uR3JvdXAodCksIGUpLCBcbiAgICB7XG4gICAgICAgIGRvY3VtZW50czogZSxcbiAgICAgICAgZ3M6IHNcbiAgICB9KSkpKSk7XG59XG5cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldENhY2hlZFRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KG4uSHIpLCBpID0gbi5Ucy5nZXQodCk7XG4gICAgcmV0dXJuIGkgPyBQcm9taXNlLnJlc29sdmUoaS50YXJnZXQpIDogbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCB0YXJnZXQgZGF0YVwiLCBcInJlYWRvbmx5XCIsIChlID0+IHIubHQoZSwgdCkubmV4dCgoZSA9PiBlID8gZS50YXJnZXQgOiBudWxsKSkpKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBzZXQgb2YgZG9jdW1lbnRzIHRoYXQgaGF2ZSBiZWVuIHVwZGF0ZWQgc2luY2UgdGhlIGxhc3QgY2FsbC5cbiAqIElmIHRoaXMgaXMgdGhlIGZpcnN0IGNhbGwsIHJldHVybnMgdGhlIHNldCBvZiBjaGFuZ2VzIHNpbmNlIGNsaWVudFxuICogaW5pdGlhbGl6YXRpb24uIEZ1cnRoZXIgaW52b2NhdGlvbnMgd2lsbCByZXR1cm4gZG9jdW1lbnQgdGhhdCBoYXZlIGNoYW5nZWRcbiAqIHNpbmNlIHRoZSBwcmlvciBjYWxsLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXdEb2N1bWVudENoYW5nZXMoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gbi5Fcy5nZXQodCkgfHwgU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgIC8vIEdldCB0aGUgY3VycmVudCBtYXhpbXVtIHJlYWQgdGltZSBmb3IgdGhlIGNvbGxlY3Rpb24uIFRoaXMgc2hvdWxkIGFsd2F5c1xuICAgIC8vIGV4aXN0LCBidXQgdG8gcmVkdWNlIHRoZSBjaGFuY2UgZm9yIHJlZ3Jlc3Npb25zIHdlIGRlZmF1bHQgdG9cbiAgICAvLyBTbmFwc2hvdFZlcnNpb24uTWluKClcbiAgICAvLyBUT0RPKGluZGV4aW5nKTogQ29uc2lkZXIgcmVtb3ZpbmcgdGhlIGRlZmF1bHQgdmFsdWUuXG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiR2V0IG5ldyBkb2N1bWVudCBjaGFuZ2VzXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gbi5kcy5nZXRBbGxGcm9tQ29sbGVjdGlvbkdyb3VwKGUsIHQsIF9fUFJJVkFURV9uZXdJbmRleE9mZnNldFN1Y2Nlc3NvckZyb21SZWFkVGltZShyLCBOKSwgXG4gICAgLyogbGltaXQ9ICovIE51bWJlci5NQVhfU0FGRV9JTlRFR0VSKSkpLnRoZW4oKGUgPT4gKF9fUFJJVkFURV9zZXRNYXhSZWFkVGltZShuLCB0LCBlKSwgXG4gICAgZSkpKTtcbn1cblxuLyoqIFNldHMgdGhlIGNvbGxlY3Rpb24gZ3JvdXAncyBtYXhpbXVtIHJlYWQgdGltZSBmcm9tIHRoZSBnaXZlbiBkb2N1bWVudHMuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gX19QUklWQVRFX3NldE1heFJlYWRUaW1lKGUsIHQsIG4pIHtcbiAgICBsZXQgciA9IGUuRXMuZ2V0KHQpIHx8IFNuYXBzaG90VmVyc2lvbi5taW4oKTtcbiAgICBuLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgIHQucmVhZFRpbWUuY29tcGFyZVRvKHIpID4gMCAmJiAociA9IHQucmVhZFRpbWUpO1xuICAgIH0pKSwgZS5Fcy5zZXQodCwgcik7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB0YXJnZXQgdXNpbmcgdGhlIGdpdmVuIGJ1bmRsZSBuYW1lLCB3aGljaCB3aWxsIGJlIHVzZWQgdG9cbiAqIGhvbGQgdGhlIGtleXMgb2YgYWxsIGRvY3VtZW50cyBmcm9tIHRoZSBidW5kbGUgaW4gcXVlcnktZG9jdW1lbnQgbWFwcGluZ3MuXG4gKiBUaGlzIGVuc3VyZXMgdGhhdCB0aGUgbG9hZGVkIGRvY3VtZW50cyBkbyBub3QgZ2V0IGdhcmJhZ2UgY29sbGVjdGVkXG4gKiByaWdodCBhd2F5LlxuICovXG4vKipcbiAqIEFwcGxpZXMgdGhlIGRvY3VtZW50cyBmcm9tIGEgYnVuZGxlIHRvIHRoZSBcImdyb3VuZC1zdGF0ZVwiIChyZW1vdGUpXG4gKiBkb2N1bWVudHMuXG4gKlxuICogTG9jYWxEb2N1bWVudHMgYXJlIHJlLWNhbGN1bGF0ZWQgaWYgdGhlcmUgYXJlIHJlbWFpbmluZyBtdXRhdGlvbnMgaW4gdGhlXG4gKiBxdWV1ZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVBcHBseUJ1bmRsZWREb2N1bWVudHMoZSwgdCwgbiwgcikge1xuICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCBzID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCksIG8gPSBfX1BSSVZBVEVfbXV0YWJsZURvY3VtZW50TWFwKCk7XG4gICAgZm9yIChjb25zdCBlIG9mIG4pIHtcbiAgICAgICAgY29uc3QgbiA9IHQucHMoZS5tZXRhZGF0YS5uYW1lKTtcbiAgICAgICAgZS5kb2N1bWVudCAmJiAocyA9IHMuYWRkKG4pKTtcbiAgICAgICAgY29uc3QgciA9IHQueXMoZSk7XG4gICAgICAgIHIuc2V0UmVhZFRpbWUodC53cyhlLm1ldGFkYXRhLnJlYWRUaW1lKSksIG8gPSBvLmluc2VydChuLCByKTtcbiAgICB9XG4gICAgY29uc3QgXyA9IGkuZHMubmV3Q2hhbmdlQnVmZmVyKHtcbiAgICAgICAgdHJhY2tSZW1vdmFsczogITBcbiAgICB9KSwgYSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQoaSwgZnVuY3Rpb24gX19QUklWQVRFX3VtYnJlbGxhVGFyZ2V0KGUpIHtcbiAgICAgICAgLy8gSXQgaXMgT0sgdGhhdCB0aGUgcGF0aCB1c2VkIGZvciB0aGUgcXVlcnkgaXMgbm90IHZhbGlkLCBiZWNhdXNlIHRoaXMgd2lsbFxuICAgICAgICAvLyBub3QgYmUgcmVhZCBhbmQgcXVlcmllZC5cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgoUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoYF9fYnVuZGxlX18vZG9jcy8ke2V9YCkpKTtcbiAgICB9KHIpKTtcbiAgICAvLyBBbGxvY2F0ZXMgYSB0YXJnZXQgdG8gaG9sZCBhbGwgZG9jdW1lbnQga2V5cyBmcm9tIHRoZSBidW5kbGUsIHN1Y2ggdGhhdFxuICAgIC8vIHRoZXkgd2lsbCBub3QgZ2V0IGdhcmJhZ2UgY29sbGVjdGVkIHJpZ2h0IGF3YXkuXG4gICAgICAgIHJldHVybiBpLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQXBwbHkgYnVuZGxlIGRvY3VtZW50c1wiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBfX1BSSVZBVEVfcG9wdWxhdGVEb2N1bWVudENoYW5nZUJ1ZmZlcihlLCBfLCBvKS5uZXh0KCh0ID0+IChfLmFwcGx5KGUpLCBcbiAgICB0KSkpLm5leHQoKHQgPT4gaS5Ici5yZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCBhLnRhcmdldElkKS5uZXh0KCgoKSA9PiBpLkhyLmFkZE1hdGNoaW5nS2V5cyhlLCBzLCBhLnRhcmdldElkKSkpLm5leHQoKCgpID0+IGkubG9jYWxEb2N1bWVudHMuZ2V0TG9jYWxWaWV3T2ZEb2N1bWVudHMoZSwgdC5WcywgdC5mcykpKS5uZXh0KCgoKSA9PiB0LlZzKSkpKSkpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBwcm9taXNlIG9mIGEgYm9vbGVhbiB0byBpbmRpY2F0ZSBpZiB0aGUgZ2l2ZW4gYnVuZGxlIGhhcyBhbHJlYWR5XG4gKiBiZWVuIGxvYWRlZCBhbmQgdGhlIGNyZWF0ZSB0aW1lIGlzIG5ld2VyIHRoYW4gdGhlIGN1cnJlbnQgbG9hZGluZyBidW5kbGUuXG4gKi9cbi8qKlxuICogU2F2ZXMgdGhlIGdpdmVuIGBOYW1lZFF1ZXJ5YCB0byBsb2NhbCBwZXJzaXN0ZW5jZS5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVTYXZlTmFtZWRRdWVyeShlLCB0LCBuID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkpIHtcbiAgICAvLyBBbGxvY2F0ZSBhIHRhcmdldCBmb3IgdGhlIG5hbWVkIHF1ZXJ5IHN1Y2ggdGhhdCBpdCBjYW4gYmUgcmVzdW1lZFxuICAgIC8vIGZyb20gYXNzb2NpYXRlZCByZWFkIHRpbWUgaWYgdXNlcnMgdXNlIGl0IHRvIGxpc3Rlbi5cbiAgICAvLyBOT1RFOiB0aGlzIGFsc28gbWVhbnMgaWYgbm8gY29ycmVzcG9uZGluZyB0YXJnZXQgZXhpc3RzLCB0aGUgbmV3IHRhcmdldFxuICAgIC8vIHdpbGwgcmVtYWluIGFjdGl2ZSBhbmQgd2lsbCBub3QgZ2V0IGNvbGxlY3RlZCwgdW5sZXNzIHVzZXJzIGhhcHBlbiB0b1xuICAgIC8vIHVubGlzdGVuIHRoZSBxdWVyeSBzb21laG93LlxuICAgIGNvbnN0IHIgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFsbG9jYXRlVGFyZ2V0KGUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KF9fUFJJVkFURV9mcm9tQnVuZGxlZFF1ZXJ5KHQuYnVuZGxlZFF1ZXJ5KSkpLCBpID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gaS5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIlNhdmUgbmFtZWQgcXVlcnlcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4ge1xuICAgICAgICBjb25zdCBzID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQucmVhZFRpbWUpO1xuICAgICAgICAvLyBTaW1wbHkgc2F2ZSB0aGUgcXVlcnkgaXRzZWxmIGlmIGl0IGlzIG9sZGVyIHRoYW4gd2hhdCB0aGUgU0RLIGFscmVhZHlcbiAgICAgICAgLy8gaGFzLlxuICAgICAgICAgICAgICAgIGlmIChyLnNuYXBzaG90VmVyc2lvbi5jb21wYXJlVG8ocykgPj0gMCkgcmV0dXJuIGkuWXIuc2F2ZU5hbWVkUXVlcnkoZSwgdCk7XG4gICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyB0YXJnZXQgZGF0YSBiZWNhdXNlIHRoZSBxdWVyeSBmcm9tIHRoZSBidW5kbGUgaXMgbmV3ZXIuXG4gICAgICAgICAgICAgICAgY29uc3QgbyA9IHIud2l0aFJlc3VtZVRva2VuKEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcsIHMpO1xuICAgICAgICByZXR1cm4gaS5UcyA9IGkuVHMuaW5zZXJ0KG8udGFyZ2V0SWQsIG8pLCBpLkhyLnVwZGF0ZVRhcmdldERhdGEoZSwgbykubmV4dCgoKCkgPT4gaS5Ici5yZW1vdmVNYXRjaGluZ0tleXNGb3JUYXJnZXRJZChlLCByLnRhcmdldElkKSkpLm5leHQoKCgpID0+IGkuSHIuYWRkTWF0Y2hpbmdLZXlzKGUsIG4sIHIudGFyZ2V0SWQpKSkubmV4dCgoKCkgPT4gaS5Zci5zYXZlTmFtZWRRdWVyeShlLCB0KSkpO1xuICAgIH0pKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTkgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRoZSBmb3JtYXQgb2YgdGhlIExvY2FsU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgdGhlIGNsaWVudCBzdGF0ZSBpczpcbi8vICAgICBmaXJlc3RvcmVfY2xpZW50c188cGVyc2lzdGVuY2VfcHJlZml4Pl88aW5zdGFuY2Vfa2V5PlxuY29uc3QgQnQgPSBcImZpcmVzdG9yZV9jbGllbnRzXCI7XG5cbi8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgYSBjbGllbnQgc3RhdGUgaW4gV2ViU3RvcmFnZSAqLyBmdW5jdGlvbiBjcmVhdGVXZWJTdG9yYWdlQ2xpZW50U3RhdGVLZXkoZSwgdCkge1xuICAgIHJldHVybiBgJHtCdH1fJHtlfV8ke3R9YDtcbn1cblxuLy8gVGhlIGZvcm1hdCBvZiB0aGUgV2ViU3RvcmFnZSBrZXkgdGhhdCBzdG9yZXMgdGhlIG11dGF0aW9uIHN0YXRlIGlzOlxuLy8gICAgIGZpcmVzdG9yZV9tdXRhdGlvbnNfPHBlcnNpc3RlbmNlX3ByZWZpeD5fPGJhdGNoX2lkPlxuLy8gICAgIChmb3IgdW5hdXRoZW50aWNhdGVkIHVzZXJzKVxuLy8gb3I6IGZpcmVzdG9yZV9tdXRhdGlvbnNfPHBlcnNpc3RlbmNlX3ByZWZpeD5fPGJhdGNoX2lkPl88dXNlcl91aWQ+XG5cbi8vICd1c2VyX3VpZCcgaXMgbGFzdCB0byBhdm9pZCBuZWVkaW5nIHRvIGVzY2FwZSAnXycgY2hhcmFjdGVycyB0aGF0IGl0IG1pZ2h0XG4vLyBjb250YWluLlxuY29uc3QgTHQgPSBcImZpcmVzdG9yZV9tdXRhdGlvbnNcIjtcblxuLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciBhIG11dGF0aW9uIGJhdGNoIGluIFdlYlN0b3JhZ2UgKi8gZnVuY3Rpb24gY3JlYXRlV2ViU3RvcmFnZU11dGF0aW9uQmF0Y2hLZXkoZSwgdCwgbikge1xuICAgIGxldCByID0gYCR7THR9XyR7ZX1fJHtufWA7XG4gICAgcmV0dXJuIHQuaXNBdXRoZW50aWNhdGVkKCkgJiYgKHIgKz0gYF8ke3QudWlkfWApLCByO1xufVxuXG4vLyBUaGUgZm9ybWF0IG9mIHRoZSBXZWJTdG9yYWdlIGtleSB0aGF0IHN0b3JlcyBhIHF1ZXJ5IHRhcmdldCdzIG1ldGFkYXRhIGlzOlxuLy8gICAgIGZpcmVzdG9yZV90YXJnZXRzXzxwZXJzaXN0ZW5jZV9wcmVmaXg+Xzx0YXJnZXRfaWQ+XG5jb25zdCBrdCA9IFwiZmlyZXN0b3JlX3RhcmdldHNcIjtcblxuLyoqIEFzc2VtYmxlcyB0aGUga2V5IGZvciBhIHF1ZXJ5IHN0YXRlIGluIFdlYlN0b3JhZ2UgKi8gZnVuY3Rpb24gY3JlYXRlV2ViU3RvcmFnZVF1ZXJ5VGFyZ2V0TWV0YWRhdGFLZXkoZSwgdCkge1xuICAgIHJldHVybiBgJHtrdH1fJHtlfV8ke3R9YDtcbn1cblxuLy8gVGhlIFdlYlN0b3JhZ2UgcHJlZml4IHRoYXQgc3RvcmVzIHRoZSBwcmltYXJ5IHRhYidzIG9ubGluZSBzdGF0ZS4gVGhlXG4vLyBmb3JtYXQgb2YgdGhlIGtleSBpczpcbi8vICAgICBmaXJlc3RvcmVfb25saW5lX3N0YXRlXzxwZXJzaXN0ZW5jZV9wcmVmaXg+XG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgcXQgPSBcIlNoYXJlZENsaWVudFN0YXRlXCI7XG5cbi8qKlxuICogSG9sZHMgdGhlIHN0YXRlIG9mIGEgbXV0YXRpb24gYmF0Y2gsIGluY2x1ZGluZyBpdHMgdXNlciBJRCwgYmF0Y2ggSUQgYW5kXG4gKiB3aGV0aGVyIHRoZSBiYXRjaCBpcyAncGVuZGluZycsICdhY2tub3dsZWRnZWQnIG9yICdyZWplY3RlZCcuXG4gKi9cbi8vIFZpc2libGUgZm9yIHRlc3RpbmdcbmNsYXNzIF9fUFJJVkFURV9NdXRhdGlvbk1ldGFkYXRhIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMudXNlciA9IGUsIHRoaXMuYmF0Y2hJZCA9IHQsIHRoaXMuc3RhdGUgPSBuLCB0aGlzLmVycm9yID0gcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgTXV0YXRpb25NZXRhZGF0YSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIFNzKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IEpTT04ucGFyc2Uobik7XG4gICAgICAgIGxldCBpLCBzID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgciAmJiAtMSAhPT0gWyBcInBlbmRpbmdcIiwgXCJhY2tub3dsZWRnZWRcIiwgXCJyZWplY3RlZFwiIF0uaW5kZXhPZihyLnN0YXRlKSAmJiAodm9pZCAwID09PSByLmVycm9yIHx8IFwib2JqZWN0XCIgPT0gdHlwZW9mIHIuZXJyb3IpO1xuICAgICAgICByZXR1cm4gcyAmJiByLmVycm9yICYmIChzID0gXCJzdHJpbmdcIiA9PSB0eXBlb2Ygci5lcnJvci5tZXNzYWdlICYmIFwic3RyaW5nXCIgPT0gdHlwZW9mIHIuZXJyb3IuY29kZSwgXG4gICAgICAgIHMgJiYgKGkgPSBuZXcgRmlyZXN0b3JlRXJyb3Ioci5lcnJvci5jb2RlLCByLmVycm9yLm1lc3NhZ2UpKSksIHMgPyBuZXcgX19QUklWQVRFX011dGF0aW9uTWV0YWRhdGEoZSwgdCwgci5zdGF0ZSwgaSkgOiAoX19QUklWQVRFX2xvZ0Vycm9yKHF0LCBgRmFpbGVkIHRvIHBhcnNlIG11dGF0aW9uIHN0YXRlIGZvciBJRCAnJHt0fSc6ICR7bn1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbiAgICBicygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yICYmIChlLmVycm9yID0ge1xuICAgICAgICAgICAgY29kZTogdGhpcy5lcnJvci5jb2RlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5lcnJvci5tZXNzYWdlXG4gICAgICAgIH0pLCBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogSG9sZHMgdGhlIHN0YXRlIG9mIGEgcXVlcnkgdGFyZ2V0LCBpbmNsdWRpbmcgaXRzIHRhcmdldCBJRCBhbmQgd2hldGhlciB0aGVcbiAqIHRhcmdldCBpcyAnbm90LWN1cnJlbnQnLCAnY3VycmVudCcgb3IgJ3JlamVjdGVkJy5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZ1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy50YXJnZXRJZCA9IGUsIHRoaXMuc3RhdGUgPSB0LCB0aGlzLmVycm9yID0gbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUXVlcnlUYXJnZXRNZXRhZGF0YSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIFNzKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UodCk7XG4gICAgICAgIGxldCByLCBpID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgbiAmJiAtMSAhPT0gWyBcIm5vdC1jdXJyZW50XCIsIFwiY3VycmVudFwiLCBcInJlamVjdGVkXCIgXS5pbmRleE9mKG4uc3RhdGUpICYmICh2b2lkIDAgPT09IG4uZXJyb3IgfHwgXCJvYmplY3RcIiA9PSB0eXBlb2Ygbi5lcnJvcik7XG4gICAgICAgIHJldHVybiBpICYmIG4uZXJyb3IgJiYgKGkgPSBcInN0cmluZ1wiID09IHR5cGVvZiBuLmVycm9yLm1lc3NhZ2UgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2Ygbi5lcnJvci5jb2RlLCBcbiAgICAgICAgaSAmJiAociA9IG5ldyBGaXJlc3RvcmVFcnJvcihuLmVycm9yLmNvZGUsIG4uZXJyb3IubWVzc2FnZSkpKSwgaSA/IG5ldyBfX1BSSVZBVEVfUXVlcnlUYXJnZXRNZXRhZGF0YShlLCBuLnN0YXRlLCByKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IocXQsIGBGYWlsZWQgdG8gcGFyc2UgdGFyZ2V0IHN0YXRlIGZvciBJRCAnJHtlfSc6ICR7dH1gKSwgXG4gICAgICAgIG51bGwpO1xuICAgIH1cbiAgICBicygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIHN0YXRlOiB0aGlzLnN0YXRlLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLmVycm9yICYmIChlLmVycm9yID0ge1xuICAgICAgICAgICAgY29kZTogdGhpcy5lcnJvci5jb2RlLFxuICAgICAgICAgICAgbWVzc2FnZTogdGhpcy5lcnJvci5tZXNzYWdlXG4gICAgICAgIH0pLCBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhpcyBjbGFzcyByZXByZXNlbnRzIHRoZSBpbW11dGFibGUgQ2xpZW50U3RhdGUgZm9yIGEgY2xpZW50IHJlYWQgZnJvbVxuICogV2ViU3RvcmFnZSwgY29udGFpbmluZyB0aGUgbGlzdCBvZiBhY3RpdmUgcXVlcnkgdGFyZ2V0cy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUmVtb3RlQ2xpZW50U3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IGUsIHRoaXMuYWN0aXZlVGFyZ2V0SWRzID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgUmVtb3RlQ2xpZW50U3RhdGUgZnJvbSB0aGUgSlNPTiByZXByZXNlbnRhdGlvbiBpbiBXZWJTdG9yYWdlLlxuICAgICAqIExvZ3MgYSB3YXJuaW5nIGFuZCByZXR1cm5zIG51bGwgaWYgdGhlIGZvcm1hdCBvZiB0aGUgZGF0YSBpcyBub3QgdmFsaWQuXG4gICAgICovICAgIHN0YXRpYyBTcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBKU09OLnBhcnNlKHQpO1xuICAgICAgICBsZXQgciA9IFwib2JqZWN0XCIgPT0gdHlwZW9mIG4gJiYgbi5hY3RpdmVUYXJnZXRJZHMgaW5zdGFuY2VvZiBBcnJheSwgaSA9IF9fUFJJVkFURV90YXJnZXRJZFNldCgpO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgciAmJiBlIDwgbi5hY3RpdmVUYXJnZXRJZHMubGVuZ3RoOyArK2UpIHIgPSBpc1NhZmVJbnRlZ2VyKG4uYWN0aXZlVGFyZ2V0SWRzW2VdKSwgXG4gICAgICAgIGkgPSBpLmFkZChuLmFjdGl2ZVRhcmdldElkc1tlXSk7XG4gICAgICAgIHJldHVybiByID8gbmV3IF9fUFJJVkFURV9SZW1vdGVDbGllbnRTdGF0ZShlLCBpKSA6IChfX1BSSVZBVEVfbG9nRXJyb3IocXQsIGBGYWlsZWQgdG8gcGFyc2UgY2xpZW50IGRhdGEgZm9yIGluc3RhbmNlICcke2V9JzogJHt0fWApLCBcbiAgICAgICAgbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIFRoaXMgY2xhc3MgcmVwcmVzZW50cyB0aGUgb25saW5lIHN0YXRlIGZvciBhbGwgY2xpZW50cyBwYXJ0aWNpcGF0aW5nIGluXG4gKiBtdWx0aS10YWIuIFRoZSBvbmxpbmUgc3RhdGUgaXMgb25seSB3cml0dGVuIHRvIGJ5IHRoZSBwcmltYXJ5IGNsaWVudCwgYW5kXG4gKiB1c2VkIGluIHNlY29uZGFyeSBjbGllbnRzIHRvIHVwZGF0ZSB0aGVpciBxdWVyeSB2aWV3cy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2hhcmVkT25saW5lU3RhdGUge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5jbGllbnRJZCA9IGUsIHRoaXMub25saW5lU3RhdGUgPSB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBTaGFyZWRPbmxpbmVTdGF0ZSBmcm9tIGl0cyBKU09OIHJlcHJlc2VudGF0aW9uIGluIFdlYlN0b3JhZ2UuXG4gICAgICogTG9ncyBhIHdhcm5pbmcgYW5kIHJldHVybnMgbnVsbCBpZiB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhIGlzIG5vdCB2YWxpZC5cbiAgICAgKi8gICAgc3RhdGljIFNzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IEpTT04ucGFyc2UoZSk7XG4gICAgICAgIHJldHVybiBcIm9iamVjdFwiID09IHR5cGVvZiB0ICYmIC0xICE9PSBbIFwiVW5rbm93blwiLCBcIk9ubGluZVwiLCBcIk9mZmxpbmVcIiBdLmluZGV4T2YodC5vbmxpbmVTdGF0ZSkgJiYgXCJzdHJpbmdcIiA9PSB0eXBlb2YgdC5jbGllbnRJZCA/IG5ldyBfX1BSSVZBVEVfU2hhcmVkT25saW5lU3RhdGUodC5jbGllbnRJZCwgdC5vbmxpbmVTdGF0ZSkgOiAoX19QUklWQVRFX2xvZ0Vycm9yKHF0LCBgRmFpbGVkIHRvIHBhcnNlIG9ubGluZSBzdGF0ZTogJHtlfWApLCBcbiAgICAgICAgbnVsbCk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1ldGFkYXRhIHN0YXRlIG9mIHRoZSBsb2NhbCBjbGllbnQuIFVubGlrZSBgUmVtb3RlQ2xpZW50U3RhdGVgLCB0aGlzIGNsYXNzIGlzXG4gKiBtdXRhYmxlIGFuZCBrZWVwcyB0cmFjayBvZiBhbGwgcGVuZGluZyBtdXRhdGlvbnMsIHdoaWNoIGFsbG93cyB1cyB0b1xuICogdXBkYXRlIHRoZSByYW5nZSBvZiBwZW5kaW5nIG11dGF0aW9uIGJhdGNoIElEcyBhcyBuZXcgbXV0YXRpb25zIGFyZSBhZGRlZCBvclxuICogcmVtb3ZlZC5cbiAqXG4gKiBUaGUgZGF0YSBpbiBgTG9jYWxDbGllbnRTdGF0ZWAgaXMgbm90IHJlYWQgZnJvbSBXZWJTdG9yYWdlIGFuZCBpbnN0ZWFkXG4gKiB1cGRhdGVkIHZpYSBpdHMgaW5zdGFuY2UgbWV0aG9kcy4gVGhlIHVwZGF0ZWQgc3RhdGUgY2FuIGJlIHNlcmlhbGl6ZWQgdmlhXG4gKiBgdG9XZWJTdG9yYWdlSlNPTigpYC5cbiAqL1xuLy8gVmlzaWJsZSBmb3IgdGVzdGluZy5cbmNsYXNzIF9fUFJJVkFURV9Mb2NhbENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5hY3RpdmVUYXJnZXRJZHMgPSBfX1BSSVZBVEVfdGFyZ2V0SWRTZXQoKTtcbiAgICB9XG4gICAgRHMoZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmFkZChlKTtcbiAgICB9XG4gICAgdnMoZSkge1xuICAgICAgICB0aGlzLmFjdGl2ZVRhcmdldElkcyA9IHRoaXMuYWN0aXZlVGFyZ2V0SWRzLmRlbGV0ZShlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29udmVydHMgdGhpcyBlbnRyeSBpbnRvIGEgSlNPTi1lbmNvZGVkIGZvcm1hdCB3ZSBjYW4gdXNlIGZvciBXZWJTdG9yYWdlLlxuICAgICAqIERvZXMgbm90IGVuY29kZSBgY2xpZW50SWRgIGFzIGl0IGlzIHBhcnQgb2YgdGhlIGtleSBpbiBXZWJTdG9yYWdlLlxuICAgICAqLyAgICBicygpIHtcbiAgICAgICAgY29uc3QgZSA9IHtcbiAgICAgICAgICAgIGFjdGl2ZVRhcmdldElkczogdGhpcy5hY3RpdmVUYXJnZXRJZHMudG9BcnJheSgpLFxuICAgICAgICAgICAgdXBkYXRlVGltZU1zOiBEYXRlLm5vdygpXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShlKTtcbiAgICB9XG59XG5cbi8qKlxuICogYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgdXNlcyBXZWJTdG9yYWdlICh3aW5kb3cubG9jYWxTdG9yYWdlKSBhcyB0aGVcbiAqIGJhY2tpbmcgc3RvcmUgZm9yIHRoZSBTaGFyZWRDbGllbnRTdGF0ZS4gSXQga2VlcHMgdHJhY2sgb2YgYWxsIGFjdGl2ZVxuICogY2xpZW50cyBhbmQgc3VwcG9ydHMgbW9kaWZpY2F0aW9ucyBvZiB0aGUgbG9jYWwgY2xpZW50J3MgZGF0YS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfV2ViU3RvcmFnZVNoYXJlZENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMud2luZG93ID0gZSwgdGhpcy5UaSA9IHQsIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBuLCB0aGlzLkNzID0gciwgdGhpcy5zeW5jRW5naW5lID0gbnVsbCwgXG4gICAgICAgIHRoaXMub25saW5lU3RhdGVIYW5kbGVyID0gbnVsbCwgdGhpcy5zZXF1ZW5jZU51bWJlckhhbmRsZXIgPSBudWxsLCB0aGlzLkZzID0gdGhpcy5Ncy5iaW5kKHRoaXMpLCBcbiAgICAgICAgdGhpcy54cyA9IG5ldyBTb3J0ZWRNYXAoX19QUklWQVRFX3ByaW1pdGl2ZUNvbXBhcmF0b3IpLCB0aGlzLnN0YXJ0ZWQgPSAhMSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBDYXB0dXJlcyBXZWJTdG9yYWdlIGV2ZW50cyB0aGF0IG9jY3VyIGJlZm9yZSBgc3RhcnQoKWAgaXMgY2FsbGVkLiBUaGVzZVxuICAgICAgICAgKiBldmVudHMgYXJlIHJlcGxheWVkIG9uY2UgYFdlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZWAgaXMgc3RhcnRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuT3MgPSBbXTtcbiAgICAgICAgLy8gRXNjYXBlIHRoZSBzcGVjaWFsIGNoYXJhY3RlcnMgbWVudGlvbmVkIGhlcmU6XG4gICAgICAgIC8vIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvR3VpZGUvUmVndWxhcl9FeHByZXNzaW9uc1xuICAgICAgICBjb25zdCBzID0gbi5yZXBsYWNlKC9bLiorP14ke30oKXxbXFxdXFxcXF0vZywgXCJcXFxcJCZcIik7XG4gICAgICAgIHRoaXMuc3RvcmFnZSA9IHRoaXMud2luZG93LmxvY2FsU3RvcmFnZSwgdGhpcy5jdXJyZW50VXNlciA9IGksIHRoaXMuTnMgPSBjcmVhdGVXZWJTdG9yYWdlQ2xpZW50U3RhdGVLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgdGhpcy5DcyksIFxuICAgICAgICB0aGlzLkJzID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIGN1cnJlbnQgc2VxdWVuY2UgbnVtYmVyLiAqL1xuICAgICAgICBmdW5jdGlvbiBjcmVhdGVXZWJTdG9yYWdlU2VxdWVuY2VOdW1iZXJLZXkoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGBmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXyR7ZX1gO1xuICAgICAgICB9KHRoaXMucGVyc2lzdGVuY2VLZXkpLCB0aGlzLnhzID0gdGhpcy54cy5pbnNlcnQodGhpcy5DcywgbmV3IF9fUFJJVkFURV9Mb2NhbENsaWVudFN0YXRlKSwgXG4gICAgICAgIHRoaXMuTHMgPSBuZXcgUmVnRXhwKGBeJHtCdH1fJHtzfV8oW15fXSopJGApLCB0aGlzLmtzID0gbmV3IFJlZ0V4cChgXiR7THR9XyR7c31fKFxcXFxkKykoPzpfKC4qKSk/JGApLCBcbiAgICAgICAgdGhpcy5xcyA9IG5ldyBSZWdFeHAoYF4ke2t0fV8ke3N9XyhcXFxcZCspJGApLCB0aGlzLlFzID0gXG4gICAgICAgIC8qKiBBc3NlbWJsZXMgdGhlIGtleSBmb3IgdGhlIG9ubGluZSBzdGF0ZSBvZiB0aGUgcHJpbWFyeSB0YWIuICovXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVdlYlN0b3JhZ2VPbmxpbmVTdGF0ZUtleShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9vbmxpbmVfc3RhdGVfJHtlfWA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gVGhlIFdlYlN0b3JhZ2UgcHJlZml4IHRoYXQgcGxheXMgYXMgYSBldmVudCB0byBpbmRpY2F0ZSB0aGUgcmVtb3RlIGRvY3VtZW50c1xuICAgICAgICAvLyBtaWdodCBoYXZlIGNoYW5nZWQgZHVlIHRvIHNvbWUgc2Vjb25kYXJ5IHRhYnMgbG9hZGluZyBhIGJ1bmRsZS5cbiAgICAgICAgLy8gZm9ybWF0IG9mIHRoZSBrZXkgaXM6XG4gICAgICAgIC8vICAgICBmaXJlc3RvcmVfYnVuZGxlX2xvYWRlZF92Ml88cGVyc2lzdGVuY2VLZXk+XG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIGVuZGluZyB3aXRoIFwidjJcIiBzdG9yZXMgdGhlIGxpc3Qgb2YgbW9kaWZpZWQgY29sbGVjdGlvbiBncm91cHMuXG4gICAgICAgICh0aGlzLnBlcnNpc3RlbmNlS2V5KSwgdGhpcy4kcyA9IGZ1bmN0aW9uIGNyZWF0ZUJ1bmRsZUxvYWRlZEtleShlKSB7XG4gICAgICAgICAgICByZXR1cm4gYGZpcmVzdG9yZV9idW5kbGVfbG9hZGVkX3YyXyR7ZX1gO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBXZWJTdG9yYWdlIGtleSBwcmVmaXggZm9yIHRoZSBrZXkgdGhhdCBzdG9yZXMgdGhlIGxhc3Qgc2VxdWVuY2UgbnVtYmVyIGFsbG9jYXRlZC4gVGhlIGtleVxuICAgICAgICAvLyBsb29rcyBsaWtlICdmaXJlc3RvcmVfc2VxdWVuY2VfbnVtYmVyXzxwZXJzaXN0ZW5jZV9wcmVmaXg+Jy5cbiAgICAgICAgKHRoaXMucGVyc2lzdGVuY2VLZXkpLCBcbiAgICAgICAgLy8gUmF0aGVyIHRoYW4gYWRkaW5nIHRoZSBzdG9yYWdlIG9ic2VydmVyIGR1cmluZyBzdGFydCgpLCB3ZSBhZGQgdGhlXG4gICAgICAgIC8vIHN0b3JhZ2Ugb2JzZXJ2ZXIgZHVyaW5nIGluaXRpYWxpemF0aW9uLiBUaGlzIGVuc3VyZXMgdGhhdCB3ZSBjb2xsZWN0XG4gICAgICAgIC8vIGV2ZW50cyBiZWZvcmUgb3RoZXIgY29tcG9uZW50cyBwb3B1bGF0ZSB0aGVpciBpbml0aWFsIHN0YXRlIChkdXJpbmcgdGhlaXJcbiAgICAgICAgLy8gcmVzcGVjdGl2ZSBzdGFydCgpIGNhbGxzKS4gT3RoZXJ3aXNlLCB3ZSBtaWdodCBmb3IgZXhhbXBsZSBtaXNzIGFcbiAgICAgICAgLy8gbXV0YXRpb24gdGhhdCBpcyBhZGRlZCBhZnRlciBMb2NhbFN0b3JlJ3Mgc3RhcnQoKSBwcm9jZXNzZWQgdGhlIGV4aXN0aW5nXG4gICAgICAgIC8vIG11dGF0aW9ucyBidXQgYmVmb3JlIHdlIG9ic2VydmUgV2ViU3RvcmFnZSBldmVudHMuXG4gICAgICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJzdG9yYWdlXCIsIHRoaXMuRnMpO1xuICAgIH1cbiAgICAvKiogUmV0dXJucyAndHJ1ZScgaWYgV2ViU3RvcmFnZSBpcyBhdmFpbGFibGUgaW4gdGhlIGN1cnJlbnQgZW52aXJvbm1lbnQuICovICAgIHN0YXRpYyBEKGUpIHtcbiAgICAgICAgcmV0dXJuICEoIWUgfHwgIWUubG9jYWxTdG9yYWdlKTtcbiAgICB9XG4gICAgYXN5bmMgc3RhcnQoKSB7XG4gICAgICAgIC8vIFJldHJpZXZlIHRoZSBsaXN0IG9mIGV4aXN0aW5nIGNsaWVudHMgdG8gYmFja2ZpbGwgdGhlIGRhdGEgaW5cbiAgICAgICAgLy8gU2hhcmVkQ2xpZW50U3RhdGUuXG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCB0aGlzLnN5bmNFbmdpbmUuemkoKTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIGUpIHtcbiAgICAgICAgICAgIGlmICh0ID09PSB0aGlzLkNzKSBjb250aW51ZTtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLmdldEl0ZW0oY3JlYXRlV2ViU3RvcmFnZUNsaWVudFN0YXRlS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIHQpKTtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9SZW1vdGVDbGllbnRTdGF0ZS5Tcyh0LCBlKTtcbiAgICAgICAgICAgICAgICBuICYmICh0aGlzLnhzID0gdGhpcy54cy5pbnNlcnQobi5jbGllbnRJZCwgbikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuVXMoKTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYW4gZXhpc3Rpbmcgb25saW5lIHN0YXRlIGFuZCBjYWxsIHRoZSBjYWxsYmFjayBoYW5kbGVyXG4gICAgICAgIC8vIGlmIGFwcGxpY2FibGUuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbSh0aGlzLlFzKTtcbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLktzKHQpO1xuICAgICAgICAgICAgZSAmJiB0aGlzLldzKGUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLk9zKSB0aGlzLk1zKGUpO1xuICAgICAgICB0aGlzLk9zID0gW10sIFxuICAgICAgICAvLyBSZWdpc3RlciBhIHdpbmRvdyB1bmxvYWQgaG9vayB0byByZW1vdmUgdGhlIGNsaWVudCBtZXRhZGF0YSBlbnRyeSBmcm9tXG4gICAgICAgIC8vIFdlYlN0b3JhZ2UgZXZlbiBpZiBgc2h1dGRvd24oKWAgd2FzIG5vdCBjYWxsZWQuXG4gICAgICAgIHRoaXMud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJwYWdlaGlkZVwiLCAoKCkgPT4gdGhpcy5zaHV0ZG93bigpKSksIHRoaXMuc3RhcnRlZCA9ICEwO1xuICAgIH1cbiAgICB3cml0ZVNlcXVlbmNlTnVtYmVyKGUpIHtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHRoaXMuQnMsIEpTT04uc3RyaW5naWZ5KGUpKTtcbiAgICB9XG4gICAgZ2V0QWxsQWN0aXZlUXVlcnlUYXJnZXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5Hcyh0aGlzLnhzKTtcbiAgICB9XG4gICAgaXNBY3RpdmVRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIGxldCB0ID0gITE7XG4gICAgICAgIHJldHVybiB0aGlzLnhzLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICByLmFjdGl2ZVRhcmdldElkcy5oYXMoZSkgJiYgKHQgPSAhMCk7XG4gICAgICAgIH0pKSwgdDtcbiAgICB9XG4gICAgYWRkUGVuZGluZ011dGF0aW9uKGUpIHtcbiAgICAgICAgdGhpcy56cyhlLCBcInBlbmRpbmdcIik7XG4gICAgfVxuICAgIHVwZGF0ZU11dGF0aW9uU3RhdGUoZSwgdCwgbikge1xuICAgICAgICB0aGlzLnpzKGUsIHQsIG4pLCBcbiAgICAgICAgLy8gT25jZSBhIGZpbmFsIG11dGF0aW9uIHJlc3VsdCBpcyBvYnNlcnZlZCBieSBvdGhlciBjbGllbnRzLCB0aGV5IG5vIGxvbmdlclxuICAgICAgICAvLyBhY2Nlc3MgdGhlIG11dGF0aW9uJ3MgbWV0YWRhdGEgZW50cnkuIFNpbmNlIFdlYlN0b3JhZ2UgcmVwbGF5cyBldmVudHNcbiAgICAgICAgLy8gaW4gb3JkZXIsIGl0IGlzIHNhZmUgdG8gZGVsZXRlIHRoZSBlbnRyeSByaWdodCBhZnRlciB1cGRhdGluZyBpdC5cbiAgICAgICAgdGhpcy5qcyhlKTtcbiAgICB9XG4gICAgYWRkTG9jYWxRdWVyeVRhcmdldChlLCB0ID0gITApIHtcbiAgICAgICAgbGV0IG4gPSBcIm5vdC1jdXJyZW50XCI7XG4gICAgICAgIC8vIExvb2t1cCBhbiBleGlzdGluZyBxdWVyeSBzdGF0ZSBpZiB0aGUgdGFyZ2V0IElEIHdhcyBhbHJlYWR5IHJlZ2lzdGVyZWRcbiAgICAgICAgLy8gYnkgYW5vdGhlciB0YWJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0FjdGl2ZVF1ZXJ5VGFyZ2V0KGUpKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gdGhpcy5zdG9yYWdlLmdldEl0ZW0oY3JlYXRlV2ViU3RvcmFnZVF1ZXJ5VGFyZ2V0TWV0YWRhdGFLZXkodGhpcy5wZXJzaXN0ZW5jZUtleSwgZSkpO1xuICAgICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX1F1ZXJ5VGFyZ2V0TWV0YWRhdGEuU3MoZSwgdCk7XG4gICAgICAgICAgICAgICAgciAmJiAobiA9IHIuc3RhdGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIElmIHRoZSBxdWVyeSBpcyBsaXN0ZW5pbmcgdG8gY2FjaGUgb25seSwgdGhlIHRhcmdldCBJRCBzaG91bGQgbm90IGJlIHJlZ2lzdGVyZWQgd2l0aCB0aGVcbiAgICAgICAgLy8gbG9jYWwgRmlyZXN0b3JlIGNsaWVudCBhcyBhbiBhY3RpdmUgd2F0Y2ggdGFyZ2V0LlxuICAgICAgICAgICAgICAgIHJldHVybiB0ICYmIHRoaXMuSHMuRHMoZSksIHRoaXMuVXMoKSwgbjtcbiAgICB9XG4gICAgcmVtb3ZlTG9jYWxRdWVyeVRhcmdldChlKSB7XG4gICAgICAgIHRoaXMuSHMudnMoZSksIHRoaXMuVXMoKTtcbiAgICB9XG4gICAgaXNMb2NhbFF1ZXJ5VGFyZ2V0KGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuSHMuYWN0aXZlVGFyZ2V0SWRzLmhhcyhlKTtcbiAgICB9XG4gICAgY2xlYXJRdWVyeVN0YXRlKGUpIHtcbiAgICAgICAgdGhpcy5yZW1vdmVJdGVtKGNyZWF0ZVdlYlN0b3JhZ2VRdWVyeVRhcmdldE1ldGFkYXRhS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIGUpKTtcbiAgICB9XG4gICAgdXBkYXRlUXVlcnlTdGF0ZShlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuSnMoZSwgdCwgbik7XG4gICAgfVxuICAgIGhhbmRsZVVzZXJDaGFuZ2UoZSwgdCwgbikge1xuICAgICAgICB0LmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgdGhpcy5qcyhlKTtcbiAgICAgICAgfSkpLCB0aGlzLmN1cnJlbnRVc2VyID0gZSwgbi5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMuYWRkUGVuZGluZ011dGF0aW9uKGUpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNldE9ubGluZVN0YXRlKGUpIHtcbiAgICAgICAgdGhpcy5ZcyhlKTtcbiAgICB9XG4gICAgbm90aWZ5QnVuZGxlTG9hZGVkKGUpIHtcbiAgICAgICAgdGhpcy5acyhlKTtcbiAgICB9XG4gICAgc2h1dGRvd24oKSB7XG4gICAgICAgIHRoaXMuc3RhcnRlZCAmJiAodGhpcy53aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN0b3JhZ2VcIiwgdGhpcy5GcyksIHRoaXMucmVtb3ZlSXRlbSh0aGlzLk5zKSwgXG4gICAgICAgIHRoaXMuc3RhcnRlZCA9ICExKTtcbiAgICB9XG4gICAgZ2V0SXRlbShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLnN0b3JhZ2UuZ2V0SXRlbShlKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1ZyhxdCwgXCJSRUFEXCIsIGUsIHQpLCB0O1xuICAgIH1cbiAgICBzZXRJdGVtKGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKHF0LCBcIlNFVFwiLCBlLCB0KSwgdGhpcy5zdG9yYWdlLnNldEl0ZW0oZSwgdCk7XG4gICAgfVxuICAgIHJlbW92ZUl0ZW0oZSkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcocXQsIFwiUkVNT1ZFXCIsIGUpLCB0aGlzLnN0b3JhZ2UucmVtb3ZlSXRlbShlKTtcbiAgICB9XG4gICAgTXMoZSkge1xuICAgICAgICAvLyBOb3RlOiBUaGUgZnVuY3Rpb24gaXMgdHlwZWQgdG8gdGFrZSBFdmVudCB0byBiZSBpbnRlcmZhY2UtY29tcGF0aWJsZSB3aXRoXG4gICAgICAgIC8vIGBXaW5kb3cuYWRkRXZlbnRMaXN0ZW5lcmAuXG4gICAgICAgIGNvbnN0IHQgPSBlO1xuICAgICAgICBpZiAodC5zdG9yYWdlQXJlYSA9PT0gdGhpcy5zdG9yYWdlKSB7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2xvZ0RlYnVnKHF0LCBcIkVWRU5UXCIsIHQua2V5LCB0Lm5ld1ZhbHVlKSwgdC5rZXkgPT09IHRoaXMuTnMpIHJldHVybiB2b2lkIF9fUFJJVkFURV9sb2dFcnJvcihcIlJlY2VpdmVkIFdlYlN0b3JhZ2Ugbm90aWZpY2F0aW9uIGZvciBsb2NhbCBjaGFuZ2UuIEFub3RoZXIgY2xpZW50IG1pZ2h0IGhhdmUgZ2FyYmFnZS1jb2xsZWN0ZWQgb3VyIHN0YXRlXCIpO1xuICAgICAgICAgICAgdGhpcy5UaS5lbnF1ZXVlUmV0cnlhYmxlKChhc3luYyAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc3RhcnRlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCAhPT0gdC5rZXkpIGlmICh0aGlzLkxzLnRlc3QodC5rZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAobnVsbCA9PSB0Lm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuWHModC5rZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmVvKGUsIG51bGwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLm5vKHQua2V5LCB0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuIHRoaXMuZW8oZS5jbGllbnRJZCwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodGhpcy5rcy50ZXN0KHQua2V5KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IHQubmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5ybyh0LmtleSwgdC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGUpIHJldHVybiB0aGlzLmlvKGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMucXMudGVzdCh0LmtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChudWxsICE9PSB0Lm5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMuc28odC5rZXksIHQubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlKSByZXR1cm4gdGhpcy5vbyhlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0LmtleSA9PT0gdGhpcy5Rcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT09IHQubmV3VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gdGhpcy5Lcyh0Lm5ld1ZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkgcmV0dXJuIHRoaXMuV3MoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5rZXkgPT09IHRoaXMuQnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZnJvbVdlYlN0b3JhZ2VTZXF1ZW5jZU51bWJlcihlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHQgPSBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWU7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG51bGwgIT0gZSkgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IEpTT04ucGFyc2UoZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KFwibnVtYmVyXCIgPT0gdHlwZW9mIG4pLCB0ID0gbjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcihxdCwgXCJGYWlsZWQgdG8gcmVhZCBzZXF1ZW5jZSBudW1iZXIgZnJvbSBXZWJTdG9yYWdlXCIsIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIC8qKlxuICogYE1lbW9yeVNoYXJlZENsaWVudFN0YXRlYCBpcyBhIHNpbXBsZSBpbXBsZW1lbnRhdGlvbiBvZiBTaGFyZWRDbGllbnRTdGF0ZSBmb3JcbiAqIGNsaWVudHMgdXNpbmcgbWVtb3J5IHBlcnNpc3RlbmNlLiBUaGUgc3RhdGUgaW4gdGhpcyBjbGFzcyByZW1haW5zIGZ1bGx5XG4gKiBpc29sYXRlZCBhbmQgbm8gc3luY2hyb25pemF0aW9uIGlzIHBlcmZvcm1lZC5cbiAqLyAodC5uZXdWYWx1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBlICE9PSBfX1BSSVZBVEVfTGlzdGVuU2VxdWVuY2UuYWUgJiYgdGhpcy5zZXF1ZW5jZU51bWJlckhhbmRsZXIoZSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodC5rZXkgPT09IHRoaXMuJHMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLl9vKHQubmV3VmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoZS5tYXAoKGUgPT4gdGhpcy5zeW5jRW5naW5lLmFvKGUpKSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSBlbHNlIHRoaXMuT3MucHVzaCh0KTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgSHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnhzLmdldCh0aGlzLkNzKTtcbiAgICB9XG4gICAgVXMoKSB7XG4gICAgICAgIHRoaXMuc2V0SXRlbSh0aGlzLk5zLCB0aGlzLkhzLmJzKCkpO1xuICAgIH1cbiAgICB6cyhlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX011dGF0aW9uTWV0YWRhdGEodGhpcy5jdXJyZW50VXNlciwgZSwgdCwgbiksIGkgPSBjcmVhdGVXZWJTdG9yYWdlTXV0YXRpb25CYXRjaEtleSh0aGlzLnBlcnNpc3RlbmNlS2V5LCB0aGlzLmN1cnJlbnRVc2VyLCBlKTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKGksIHIuYnMoKSk7XG4gICAgfVxuICAgIGpzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGNyZWF0ZVdlYlN0b3JhZ2VNdXRhdGlvbkJhdGNoS2V5KHRoaXMucGVyc2lzdGVuY2VLZXksIHRoaXMuY3VycmVudFVzZXIsIGUpO1xuICAgICAgICB0aGlzLnJlbW92ZUl0ZW0odCk7XG4gICAgfVxuICAgIFlzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHtcbiAgICAgICAgICAgIGNsaWVudElkOiB0aGlzLkNzLFxuICAgICAgICAgICAgb25saW5lU3RhdGU6IGVcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zdG9yYWdlLnNldEl0ZW0odGhpcy5RcywgSlNPTi5zdHJpbmdpZnkodCkpO1xuICAgIH1cbiAgICBKcyhlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBjcmVhdGVXZWJTdG9yYWdlUXVlcnlUYXJnZXRNZXRhZGF0YUtleSh0aGlzLnBlcnNpc3RlbmNlS2V5LCBlKSwgaSA9IG5ldyBfX1BSSVZBVEVfUXVlcnlUYXJnZXRNZXRhZGF0YShlLCB0LCBuKTtcbiAgICAgICAgdGhpcy5zZXRJdGVtKHIsIGkuYnMoKSk7XG4gICAgfVxuICAgIFpzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IEpTT04uc3RyaW5naWZ5KEFycmF5LmZyb20oZSkpO1xuICAgICAgICB0aGlzLnNldEl0ZW0odGhpcy4kcywgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIGNsaWVudCBzdGF0ZSBrZXkgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyBudWxsIGlmIHRoZSBrZXkgZG9lcyBub3RcbiAgICAgKiBtYXRjaCB0aGUgZXhwZWN0ZWQga2V5IGZvcm1hdC5cbiAgICAgKi8gICAgWHMoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5Mcy5leGVjKGUpO1xuICAgICAgICByZXR1cm4gdCA/IHRbMV0gOiBudWxsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYSBjbGllbnQgc3RhdGUgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlIGNvdWxkIG5vdFxuICAgICAqIGJlIHBhcnNlZC5cbiAgICAgKi8gICAgbm8oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5YcyhlKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9SZW1vdGVDbGllbnRTdGF0ZS5TcyhuLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGFyc2VzIGEgbXV0YXRpb24gYmF0Y2ggc3RhdGUgaW4gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlXG4gICAgICogY291bGQgbm90IGJlIHBhcnNlZC5cbiAgICAgKi8gICAgcm8oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gdGhpcy5rcy5leGVjKGUpLCByID0gTnVtYmVyKG5bMV0pLCBpID0gdm9pZCAwICE9PSBuWzJdID8gblsyXSA6IG51bGw7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfTXV0YXRpb25NZXRhZGF0YS5TcyhuZXcgVXNlcihpKSwgciwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFBhcnNlcyBhIHF1ZXJ5IHRhcmdldCBzdGF0ZSBmcm9tIFdlYlN0b3JhZ2UuIFJldHVybnMgJ251bGwnIGlmIHRoZSB2YWx1ZVxuICAgICAqIGNvdWxkIG5vdCBiZSBwYXJzZWQuXG4gICAgICovICAgIHNvKGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IHRoaXMucXMuZXhlYyhlKSwgciA9IE51bWJlcihuWzFdKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9RdWVyeVRhcmdldE1ldGFkYXRhLlNzKHIsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQYXJzZXMgYW4gb25saW5lIHN0YXRlIGZyb20gV2ViU3RvcmFnZS4gUmV0dXJucyAnbnVsbCcgaWYgdGhlIHZhbHVlXG4gICAgICogY291bGQgbm90IGJlIHBhcnNlZC5cbiAgICAgKi8gICAgS3MoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX1NoYXJlZE9ubGluZVN0YXRlLlNzKGUpO1xuICAgIH1cbiAgICBfbyhlKSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKGUpO1xuICAgIH1cbiAgICBhc3luYyBpbyhlKSB7XG4gICAgICAgIGlmIChlLnVzZXIudWlkID09PSB0aGlzLmN1cnJlbnRVc2VyLnVpZCkgcmV0dXJuIHRoaXMuc3luY0VuZ2luZS51byhlLmJhdGNoSWQsIGUuc3RhdGUsIGUuZXJyb3IpO1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcocXQsIGBJZ25vcmluZyBtdXRhdGlvbiBmb3Igbm9uLWFjdGl2ZSB1c2VyICR7ZS51c2VyLnVpZH1gKTtcbiAgICB9XG4gICAgb28oZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zeW5jRW5naW5lLmNvKGUudGFyZ2V0SWQsIGUuc3RhdGUsIGUuZXJyb3IpO1xuICAgIH1cbiAgICBlbyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0ID8gdGhpcy54cy5pbnNlcnQoZSwgdCkgOiB0aGlzLnhzLnJlbW92ZShlKSwgciA9IHRoaXMuR3ModGhpcy54cyksIGkgPSB0aGlzLkdzKG4pLCBzID0gW10sIG8gPSBbXTtcbiAgICAgICAgcmV0dXJuIGkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICByLmhhcyhlKSB8fCBzLnB1c2goZSk7XG4gICAgICAgIH0pKSwgci5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIGkuaGFzKGUpIHx8IG8ucHVzaChlKTtcbiAgICAgICAgfSkpLCB0aGlzLnN5bmNFbmdpbmUubG8ocywgbykudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy54cyA9IG47XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgV3MoZSkge1xuICAgICAgICAvLyBXZSBjaGVjayB3aGV0aGVyIHRoZSBjbGllbnQgdGhhdCB3cm90ZSB0aGlzIG9ubGluZSBzdGF0ZSBpcyBzdGlsbCBhY3RpdmVcbiAgICAgICAgLy8gYnkgY29tcGFyaW5nIGl0cyBjbGllbnQgSUQgdG8gdGhlIGxpc3Qgb2YgY2xpZW50cyBrZXB0IGFjdGl2ZSBpblxuICAgICAgICAvLyBJbmRleGVkRGIuIElmIGEgY2xpZW50IGRvZXMgbm90IHVwZGF0ZSB0aGVpciBJbmRleGVkRGIgY2xpZW50IHN0YXRlXG4gICAgICAgIC8vIHdpdGhpbiA1IHNlY29uZHMsIGl0IGlzIGNvbnNpZGVyZWQgaW5hY3RpdmUgYW5kIHdlIGRvbid0IGVtaXQgYW4gb25saW5lXG4gICAgICAgIC8vIHN0YXRlIGV2ZW50LlxuICAgICAgICB0aGlzLnhzLmdldChlLmNsaWVudElkKSAmJiB0aGlzLm9ubGluZVN0YXRlSGFuZGxlcihlLm9ubGluZVN0YXRlKTtcbiAgICB9XG4gICAgR3MoZSkge1xuICAgICAgICBsZXQgdCA9IF9fUFJJVkFURV90YXJnZXRJZFNldCgpO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKCgoZSwgbikgPT4ge1xuICAgICAgICAgICAgdCA9IHQudW5pb25XaXRoKG4uYWN0aXZlVGFyZ2V0SWRzKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbn1cblxuY2xhc3MgX19QUklWQVRFX01lbW9yeVNoYXJlZENsaWVudFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5obyA9IG5ldyBfX1BSSVZBVEVfTG9jYWxDbGllbnRTdGF0ZSwgdGhpcy5QbyA9IHt9LCB0aGlzLm9ubGluZVN0YXRlSGFuZGxlciA9IG51bGwsIFxuICAgICAgICB0aGlzLnNlcXVlbmNlTnVtYmVySGFuZGxlciA9IG51bGw7XG4gICAgfVxuICAgIGFkZFBlbmRpbmdNdXRhdGlvbihlKSB7XG4gICAgICAgIC8vIE5vIG9wLlxuICAgIH1cbiAgICB1cGRhdGVNdXRhdGlvblN0YXRlKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIGFkZExvY2FsUXVlcnlUYXJnZXQoZSwgdCA9ICEwKSB7XG4gICAgICAgIHJldHVybiB0ICYmIHRoaXMuaG8uRHMoZSksIHRoaXMuUG9bZV0gfHwgXCJub3QtY3VycmVudFwiO1xuICAgIH1cbiAgICB1cGRhdGVRdWVyeVN0YXRlKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5Qb1tlXSA9IHQ7XG4gICAgfVxuICAgIHJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICB0aGlzLmhvLnZzKGUpO1xuICAgIH1cbiAgICBpc0xvY2FsUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oby5hY3RpdmVUYXJnZXRJZHMuaGFzKGUpO1xuICAgIH1cbiAgICBjbGVhclF1ZXJ5U3RhdGUoZSkge1xuICAgICAgICBkZWxldGUgdGhpcy5Qb1tlXTtcbiAgICB9XG4gICAgZ2V0QWxsQWN0aXZlUXVlcnlUYXJnZXRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oby5hY3RpdmVUYXJnZXRJZHM7XG4gICAgfVxuICAgIGlzQWN0aXZlUXVlcnlUYXJnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5oby5hY3RpdmVUYXJnZXRJZHMuaGFzKGUpO1xuICAgIH1cbiAgICBzdGFydCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaG8gPSBuZXcgX19QUklWQVRFX0xvY2FsQ2xpZW50U3RhdGUsIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIH1cbiAgICBoYW5kbGVVc2VyQ2hhbmdlKGUsIHQsIG4pIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIHNldE9ubGluZVN0YXRlKGUpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxuICAgIHNodXRkb3duKCkge31cbiAgICB3cml0ZVNlcXVlbmNlTnVtYmVyKGUpIHt9XG4gICAgbm90aWZ5QnVuZGxlTG9hZGVkKGUpIHtcbiAgICAgICAgLy8gTm8gb3AuXG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfTm9vcENvbm5lY3Rpdml0eU1vbml0b3Ige1xuICAgIFRvKGUpIHtcbiAgICAgICAgLy8gTm8tb3AuXG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICAvLyBOby1vcC5cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBSZWZlcmVuY2VzIHRvIGB3aW5kb3dgIGFyZSBndWFyZGVkIGJ5IEJyb3dzZXJDb25uZWN0aXZpdHlNb25pdG9yLmlzQXZhaWxhYmxlKClcbi8qIGVzbGludC1kaXNhYmxlIG5vLXJlc3RyaWN0ZWQtZ2xvYmFscyAqLyBjb25zdCBRdCA9IFwiQ29ubmVjdGl2aXR5TW9uaXRvclwiO1xuXG4vKipcbiAqIEJyb3dzZXIgaW1wbGVtZW50YXRpb24gb2YgQ29ubmVjdGl2aXR5TW9uaXRvci5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQnJvd3NlckNvbm5lY3Rpdml0eU1vbml0b3Ige1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLklvID0gKCkgPT4gdGhpcy5FbygpLCB0aGlzLkFvID0gKCkgPT4gdGhpcy5SbygpLCB0aGlzLlZvID0gW10sIHRoaXMubW8oKTtcbiAgICB9XG4gICAgVG8oZSkge1xuICAgICAgICB0aGlzLlZvLnB1c2goZSk7XG4gICAgfVxuICAgIHNodXRkb3duKCkge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihcIm9ubGluZVwiLCB0aGlzLklvKSwgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJvZmZsaW5lXCIsIHRoaXMuQW8pO1xuICAgIH1cbiAgICBtbygpIHtcbiAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJvbmxpbmVcIiwgdGhpcy5JbyksIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwib2ZmbGluZVwiLCB0aGlzLkFvKTtcbiAgICB9XG4gICAgRW8oKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhRdCwgXCJOZXR3b3JrIGNvbm5lY3Rpdml0eSBjaGFuZ2VkOiBBVkFJTEFCTEVcIik7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0aGlzLlZvKSBlKDAgLyogTmV0d29ya1N0YXR1cy5BVkFJTEFCTEUgKi8pO1xuICAgIH1cbiAgICBSbygpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFF0LCBcIk5ldHdvcmsgY29ubmVjdGl2aXR5IGNoYW5nZWQ6IFVOQVZBSUxBQkxFXCIpO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdGhpcy5WbykgZSgxIC8qIE5ldHdvcmtTdGF0dXMuVU5BVkFJTEFCTEUgKi8pO1xuICAgIH1cbiAgICAvLyBUT0RPKGNoZW5icmlhbik6IENvbnNpZGVyIHBhc3NpbmcgaW4gd2luZG93IGVpdGhlciBpbnRvIHRoaXMgY29tcG9uZW50IG9yXG4gICAgLy8gaGVyZSBmb3IgdGVzdGluZyB2aWEgRmFrZVdpbmRvdy5cbiAgICAvKiogQ2hlY2tzIHRoYXQgYWxsIHVzZWQgYXR0cmlidXRlcyBvZiB3aW5kb3cgYXJlIGF2YWlsYWJsZS4gKi9cbiAgICBzdGF0aWMgRCgpIHtcbiAgICAgICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHdpbmRvdyAmJiB2b2lkIDAgIT09IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyICYmIHZvaWQgMCAhPT0gd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXI7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGUgdmFsdWUgcmV0dXJuZWQgZnJvbSB0aGUgbW9zdCByZWNlbnQgaW52b2NhdGlvbiBvZlxuICogYGdlbmVyYXRlVW5pcXVlRGVidWdJZCgpYCwgb3IgbnVsbCBpZiBpdCBoYXMgbmV2ZXIgYmVlbiBpbnZva2VkLlxuICovIGxldCAkdCA9IG51bGw7XG5cbi8qKlxuICogR2VuZXJhdGVzIGFuZCByZXR1cm5zIGFuIGluaXRpYWwgdmFsdWUgZm9yIGBsYXN0VW5pcXVlRGVidWdJZGAuXG4gKlxuICogVGhlIHJldHVybmVkIHZhbHVlIGlzIHJhbmRvbWx5IHNlbGVjdGVkIGZyb20gYSByYW5nZSBvZiBpbnRlZ2VycyB0aGF0IGFyZVxuICogcmVwcmVzZW50ZWQgYXMgOCBoZXhhZGVjaW1hbCBkaWdpdHMuIFRoaXMgbWVhbnMgdGhhdCAod2l0aGluIHJlYXNvbikgYW55XG4gKiBudW1iZXJzIGdlbmVyYXRlZCBieSBpbmNyZW1lbnRpbmcgdGhlIHJldHVybmVkIG51bWJlciBieSAxIHdpbGwgYWxzbyBiZVxuICogcmVwcmVzZW50ZWQgYnkgOCBoZXhhZGVjaW1hbCBkaWdpdHMuIFRoaXMgbGVhZHMgdG8gYWxsIFwiSURzXCIgaGF2aW5nIHRoZSBzYW1lXG4gKiBsZW5ndGggd2hlbiBjb252ZXJ0ZWQgdG8gYSBoZXhhZGVjaW1hbCBzdHJpbmcsIG1ha2luZyByZWFkaW5nIGxvZ3MgY29udGFpbmluZ1xuICogdGhlc2UgSURzIGVhc2llciB0byBmb2xsb3cuIEFuZCBzaW5jZSB0aGUgcmV0dXJuIHZhbHVlIGlzIHJhbmRvbWx5IHNlbGVjdGVkXG4gKiBpdCB3aWxsIGhlbHAgdG8gZGlmZmVyZW50aWF0ZSBiZXR3ZWVuIGxvZ3MgZnJvbSBkaWZmZXJlbnQgZXhlY3V0aW9ucy5cbiAqL1xuLyoqXG4gKiBHZW5lcmF0ZXMgYW5kIHJldHVybnMgYSB1bmlxdWUgSUQgYXMgYSBoZXhhZGVjaW1hbCBzdHJpbmcuXG4gKlxuICogVGhlIHJldHVybmVkIElEIGlzIGludGVuZGVkIHRvIGJlIHVzZWQgaW4gZGVidWcgbG9nZ2luZyBtZXNzYWdlcyB0byBoZWxwXG4gKiBjb3JyZWxhdGUgbG9nIG1lc3NhZ2VzIHRoYXQgbWF5IGJlIHNwYXRpYWxseSBzZXBhcmF0ZWQgaW4gdGhlIGxvZ3MsIGJ1dFxuICogbG9naWNhbGx5IHJlbGF0ZWQuIEZvciBleGFtcGxlLCBhIG5ldHdvcmsgY29ubmVjdGlvbiBjb3VsZCBpbmNsdWRlIHRoZSBzYW1lXG4gKiBcImRlYnVnIElEXCIgc3RyaW5nIGluIGFsbCBvZiBpdHMgbG9nIG1lc3NhZ2VzIHRvIGhlbHAgdHJhY2UgYSBzcGVjaWZpY1xuICogY29ubmVjdGlvbiBvdmVyIHRpbWUuXG4gKlxuICogQHJldHVybiB0aGUgMTAtY2hhcmFjdGVyIGdlbmVyYXRlZCBJRCAoZS5nLiBcIjB4YTFiMmMzZDRcIikuXG4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZW5lcmF0ZVVuaXF1ZURlYnVnSWQoKSB7XG4gICAgcmV0dXJuIG51bGwgPT09ICR0ID8gJHQgPSBmdW5jdGlvbiBfX1BSSVZBVEVfZ2VuZXJhdGVJbml0aWFsVW5pcXVlRGVidWdJZCgpIHtcbiAgICAgICAgcmV0dXJuIDI2ODQzNTQ1NiArIE1hdGgucm91bmQoMjE0NzQ4MzY0OCAqIE1hdGgucmFuZG9tKCkpO1xuICAgIH0oKSA6ICR0KyssIFwiMHhcIiArICR0LnRvU3RyaW5nKDE2KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgVXQgPSBcIlJlc3RDb25uZWN0aW9uXCIsIEt0ID0ge1xuICAgIEJhdGNoR2V0RG9jdW1lbnRzOiBcImJhdGNoR2V0XCIsXG4gICAgQ29tbWl0OiBcImNvbW1pdFwiLFxuICAgIFJ1blF1ZXJ5OiBcInJ1blF1ZXJ5XCIsXG4gICAgUnVuQWdncmVnYXRpb25RdWVyeTogXCJydW5BZ2dyZWdhdGlvblF1ZXJ5XCJcbn07XG5cbi8qKlxuICogTWFwcyBSUEMgbmFtZXMgdG8gdGhlIGNvcnJlc3BvbmRpbmcgUkVTVCBlbmRwb2ludCBuYW1lLlxuICpcbiAqIFdlIHVzZSBhcnJheSBub3RhdGlvbiB0byBhdm9pZCBtYW5nbGluZy5cbiAqL1xuLyoqXG4gKiBCYXNlIGNsYXNzIGZvciBhbGwgUmVzdC1iYXNlZCBjb25uZWN0aW9ucyB0byB0aGUgYmFja2VuZCAoV2ViQ2hhbm5lbCBhbmRcbiAqIEhUVFApLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfUmVzdENvbm5lY3Rpb24ge1xuICAgIGdldCBmbygpIHtcbiAgICAgICAgLy8gQm90aCBgaW52b2tlUlBDKClgIGFuZCBgaW52b2tlU3RyZWFtaW5nUlBDKClgIHVzZSB0aGVpciBgcGF0aGAgYXJndW1lbnRzIHRvIGRldGVybWluZVxuICAgICAgICAvLyB3aGVyZSB0byBydW4gdGhlIHF1ZXJ5LCBhbmQgZXhwZWN0IHRoZSBgcmVxdWVzdGAgdG8gTk9UIHNwZWNpZnkgdGhlIFwicGF0aFwiLlxuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5kYXRhYmFzZUluZm8gPSBlLCB0aGlzLmRhdGFiYXNlSWQgPSBlLmRhdGFiYXNlSWQ7XG4gICAgICAgIGNvbnN0IHQgPSBlLnNzbCA/IFwiaHR0cHNcIiA6IFwiaHR0cFwiLCBuID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZGF0YWJhc2VJZC5wcm9qZWN0SWQpLCByID0gZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMuZGF0YWJhc2VJZC5kYXRhYmFzZSk7XG4gICAgICAgIHRoaXMucG8gPSB0ICsgXCI6Ly9cIiArIGUuaG9zdCwgdGhpcy55byA9IGBwcm9qZWN0cy8ke259L2RhdGFiYXNlcy8ke3J9YCwgdGhpcy53byA9IHRoaXMuZGF0YWJhc2VJZC5kYXRhYmFzZSA9PT0gcnQgPyBgcHJvamVjdF9pZD0ke259YCA6IGBwcm9qZWN0X2lkPSR7bn0mZGF0YWJhc2VfaWQ9JHtyfWA7XG4gICAgfVxuICAgIFNvKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgY29uc3QgcyA9IF9fUFJJVkFURV9nZW5lcmF0ZVVuaXF1ZURlYnVnSWQoKSwgbyA9IHRoaXMuYm8oZSwgdC50b1VyaUVuY29kZWRTdHJpbmcoKSk7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhVdCwgYFNlbmRpbmcgUlBDICcke2V9JyAke3N9OmAsIG8sIG4pO1xuICAgICAgICBjb25zdCBfID0ge1xuICAgICAgICAgICAgXCJnb29nbGUtY2xvdWQtcmVzb3VyY2UtcHJlZml4XCI6IHRoaXMueW8sXG4gICAgICAgICAgICBcIngtZ29vZy1yZXF1ZXN0LXBhcmFtc1wiOiB0aGlzLndvXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiB0aGlzLkRvKF8sIHIsIGkpLCB0aGlzLnZvKGUsIG8sIF8sIG4pLnRoZW4oKHQgPT4gKF9fUFJJVkFURV9sb2dEZWJ1ZyhVdCwgYFJlY2VpdmVkIFJQQyAnJHtlfScgJHtzfTogYCwgdCksIFxuICAgICAgICB0KSksICh0ID0+IHtcbiAgICAgICAgICAgIHRocm93IF9fUFJJVkFURV9sb2dXYXJuKFV0LCBgUlBDICcke2V9JyAke3N9IGZhaWxlZCB3aXRoIGVycm9yOiBgLCB0LCBcInVybDogXCIsIG8sIFwicmVxdWVzdDpcIiwgbiksIFxuICAgICAgICAgICAgdDtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBDbyhlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgICAgIC8vIFRoZSBSRVNUIEFQSSBhdXRvbWF0aWNhbGx5IGFnZ3JlZ2F0ZXMgYWxsIG9mIHRoZSBzdHJlYW1lZCByZXN1bHRzLCBzbyB3ZVxuICAgICAgICAvLyBjYW4ganVzdCB1c2UgdGhlIG5vcm1hbCBpbnZva2UoKSBtZXRob2QuXG4gICAgICAgIHJldHVybiB0aGlzLlNvKGUsIHQsIG4sIHIsIGkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBNb2RpZmllcyB0aGUgaGVhZGVycyBmb3IgYSByZXF1ZXN0LCBhZGRpbmcgYW55IGF1dGhvcml6YXRpb24gdG9rZW4gaWZcbiAgICAgKiBwcmVzZW50IGFuZCBhbnkgYWRkaXRpb25hbCBoZWFkZXJzIGZvciB0aGUgcmVxdWVzdC5cbiAgICAgKi8gICAgRG8oZSwgdCwgbikge1xuICAgICAgICBlW1wiWC1Hb29nLUFwaS1DbGllbnRcIl0gPSBcbiAgICAgICAgLy8gU0RLX1ZFUlNJT04gaXMgdXBkYXRlZCB0byBkaWZmZXJlbnQgdmFsdWUgYXQgcnVudGltZSBkZXBlbmRpbmcgb24gdGhlIGVudHJ5IHBvaW50LFxuICAgICAgICAvLyBzbyB3ZSBuZWVkIHRvIGdldCBpdHMgdmFsdWUgd2hlbiB3ZSBuZWVkIGl0IGluIGEgZnVuY3Rpb24uXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9nZXRHb29nQXBpQ2xpZW50VmFsdWUoKSB7XG4gICAgICAgICAgICByZXR1cm4gXCJnbC1qcy8gZmlyZS9cIiArIEQ7XG4gICAgICAgIH0oKSwgXG4gICAgICAgIC8vIENvbnRlbnQtVHlwZTogdGV4dC9wbGFpbiB3aWxsIGF2b2lkIHByZWZsaWdodCByZXF1ZXN0cyB3aGljaCBtaWdodFxuICAgICAgICAvLyBtZXNzIHdpdGggQ09SUyBhbmQgcmVkaXJlY3RzIGJ5IHByb3hpZXMuIElmIHdlIGFkZCBjdXN0b20gaGVhZGVyc1xuICAgICAgICAvLyB3ZSB3aWxsIG5lZWQgdG8gY2hhbmdlIHRoaXMgY29kZSB0byBwb3RlbnRpYWxseSB1c2UgdGhlICRodHRwT3ZlcndyaXRlXG4gICAgICAgIC8vIHBhcmFtZXRlciBzdXBwb3J0ZWQgYnkgRVNGIHRvIGF2b2lkIHRyaWdnZXJpbmcgcHJlZmxpZ2h0IHJlcXVlc3RzLlxuICAgICAgICBlW1wiQ29udGVudC1UeXBlXCJdID0gXCJ0ZXh0L3BsYWluXCIsIHRoaXMuZGF0YWJhc2VJbmZvLmFwcElkICYmIChlW1wiWC1GaXJlYmFzZS1HTVBJRFwiXSA9IHRoaXMuZGF0YWJhc2VJbmZvLmFwcElkKSwgXG4gICAgICAgIHQgJiYgdC5oZWFkZXJzLmZvckVhY2goKCh0LCBuKSA9PiBlW25dID0gdCkpLCBuICYmIG4uaGVhZGVycy5mb3JFYWNoKCgodCwgbikgPT4gZVtuXSA9IHQpKTtcbiAgICB9XG4gICAgYm8oZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gS3RbZV07XG4gICAgICAgIHJldHVybiBgJHt0aGlzLnBvfS92MS8ke3R9OiR7bn1gO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbG9zZXMgYW5kIGNsZWFucyB1cCBhbnkgcmVzb3VyY2VzIGFzc29jaWF0ZWQgd2l0aCB0aGUgY29ubmVjdGlvbi4gVGhpc1xuICAgICAqIGltcGxlbWVudGF0aW9uIGlzIGEgbm8tb3AgYmVjYXVzZSB0aGVyZSBhcmUgbm8gcmVzb3VyY2VzIGFzc29jaWF0ZWRcbiAgICAgKiB3aXRoIHRoZSBSZXN0Q29ubmVjdGlvbiB0aGF0IG5lZWQgdG8gYmUgY2xlYW5lZCB1cC5cbiAgICAgKi8gICAgdGVybWluYXRlKCkge1xuICAgICAgICAvLyBOby1vcFxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogUHJvdmlkZXMgYSBzaW1wbGUgaGVscGVyIGNsYXNzIHRoYXQgaW1wbGVtZW50cyB0aGUgU3RyZWFtIGludGVyZmFjZSB0b1xuICogYnJpZGdlIHRvIG90aGVyIGltcGxlbWVudGF0aW9ucyB0aGF0IGFyZSBzdHJlYW1zIGJ1dCBkbyBub3QgaW1wbGVtZW50IHRoZVxuICogaW50ZXJmYWNlLiBUaGUgc3RyZWFtIGNhbGxiYWNrcyBhcmUgaW52b2tlZCB3aXRoIHRoZSBjYWxsT24uLi4gbWV0aG9kcy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU3RyZWFtQnJpZGdlIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuRm8gPSBlLkZvLCB0aGlzLk1vID0gZS5NbztcbiAgICB9XG4gICAgeG8oZSkge1xuICAgICAgICB0aGlzLk9vID0gZTtcbiAgICB9XG4gICAgTm8oZSkge1xuICAgICAgICB0aGlzLkJvID0gZTtcbiAgICB9XG4gICAgTG8oZSkge1xuICAgICAgICB0aGlzLmtvID0gZTtcbiAgICB9XG4gICAgb25NZXNzYWdlKGUpIHtcbiAgICAgICAgdGhpcy5xbyA9IGU7XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICB0aGlzLk1vKCk7XG4gICAgfVxuICAgIHNlbmQoZSkge1xuICAgICAgICB0aGlzLkZvKGUpO1xuICAgIH1cbiAgICBRbygpIHtcbiAgICAgICAgdGhpcy5PbygpO1xuICAgIH1cbiAgICAkbygpIHtcbiAgICAgICAgdGhpcy5CbygpO1xuICAgIH1cbiAgICBVbyhlKSB7XG4gICAgICAgIHRoaXMua28oZSk7XG4gICAgfVxuICAgIEtvKGUpIHtcbiAgICAgICAgdGhpcy5xbyhlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IFd0ID0gXCJXZWJDaGFubmVsQ29ubmVjdGlvblwiO1xuXG5jbGFzcyBfX1BSSVZBVEVfV2ViQ2hhbm5lbENvbm5lY3Rpb24gZXh0ZW5kcyBfX1BSSVZBVEVfUmVzdENvbm5lY3Rpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoZSksIHRoaXMuZm9yY2VMb25nUG9sbGluZyA9IGUuZm9yY2VMb25nUG9sbGluZywgdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSBlLmF1dG9EZXRlY3RMb25nUG9sbGluZywgXG4gICAgICAgIHRoaXMudXNlRmV0Y2hTdHJlYW1zID0gZS51c2VGZXRjaFN0cmVhbXMsIHRoaXMubG9uZ1BvbGxpbmdPcHRpb25zID0gZS5sb25nUG9sbGluZ09wdGlvbnM7XG4gICAgfVxuICAgIHZvKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9nZW5lcmF0ZVVuaXF1ZURlYnVnSWQoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKCgocywgbykgPT4ge1xuICAgICAgICAgICAgY29uc3QgXyA9IG5ldyBYaHJJbztcbiAgICAgICAgICAgIF8uc2V0V2l0aENyZWRlbnRpYWxzKCEwKSwgXy5saXN0ZW5PbmNlKEV2ZW50VHlwZS5DT01QTEVURSwgKCgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKF8uZ2V0TGFzdEVycm9yQ29kZSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgY2FzZSBFcnJvckNvZGUuTk9fRVJST1I6XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gXy5nZXRSZXNwb25zZUpzb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYFhIUiBmb3IgUlBDICcke2V9JyAke2l9IHJlY2VpdmVkOmAsIEpTT04uc3RyaW5naWZ5KHQpKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBzKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5USU1FT1VUOlxuICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFd0LCBgUlBDICcke2V9JyAke2l9IHRpbWVkIG91dGApLCBvKG5ldyBGaXJlc3RvcmVFcnJvcihDLkRFQURMSU5FX0VYQ0VFREVELCBcIlJlcXVlc3QgdGltZSBvdXRcIikpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICAgICAgICAgICAgICBjYXNlIEVycm9yQ29kZS5IVFRQX0VSUk9SOlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IF8uZ2V0U3RhdHVzKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoX19QUklWQVRFX2xvZ0RlYnVnKFd0LCBgUlBDICcke2V9JyAke2l9IGZhaWxlZCB3aXRoIHN0YXR1czpgLCBuLCBcInJlc3BvbnNlIHRleHQ6XCIsIF8uZ2V0UmVzcG9uc2VUZXh0KCkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgIG4gPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGUgPSBfLmdldFJlc3BvbnNlSnNvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEFycmF5LmlzQXJyYXkoZSkgJiYgKGUgPSBlWzBdKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gbnVsbCA9PSBlID8gdm9pZCAwIDogZS5lcnJvcjtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodCAmJiB0LnN0YXR1cyAmJiB0Lm1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZSA9IGZ1bmN0aW9uIF9fUFJJVkFURV9tYXBDb2RlRnJvbUh0dHBSZXNwb25zZUVycm9yU3RhdHVzKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBlLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXy9nLCBcIi1cIik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhDKS5pbmRleE9mKHQpID49IDAgPyB0IDogQy5VTktOT1dOO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KHQuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbyhuZXcgRmlyZXN0b3JlRXJyb3IoZSwgdC5tZXNzYWdlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIG8obmV3IEZpcmVzdG9yZUVycm9yKEMuVU5LTk9XTiwgXCJTZXJ2ZXIgcmVzcG9uZGVkIHdpdGggc3RhdHVzIFwiICsgXy5nZXRTdGF0dXMoKSkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgd2UgcmVjZWl2ZWQgYW4gSFRUUF9FUlJPUiBidXQgdGhlcmUncyBubyBzdGF0dXMgY29kZSxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGl0J3MgbW9zdCBwcm9iYWJseSBhIGNvbm5lY3Rpb24gaXNzdWVcbiAgICAgICAgICAgICAgICAgICAgICAgIG8obmV3IEZpcmVzdG9yZUVycm9yKEMuVU5BVkFJTEFCTEUsIFwiQ29ubmVjdGlvbiBmYWlsZWQuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuXG4gICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgIGZhaWwoKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYFJQQyAnJHtlfScgJHtpfSBjb21wbGV0ZWQuYCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgYSA9IEpTT04uc3RyaW5naWZ5KHIpO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKFd0LCBgUlBDICcke2V9JyAke2l9IHNlbmRpbmcgcmVxdWVzdDpgLCByKSwgXy5zZW5kKHQsIFwiUE9TVFwiLCBhLCBuLCAxNSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgV28oZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX2dlbmVyYXRlVW5pcXVlRGVidWdJZCgpLCBpID0gWyB0aGlzLnBvLCBcIi9cIiwgXCJnb29nbGUuZmlyZXN0b3JlLnYxLkZpcmVzdG9yZVwiLCBcIi9cIiwgZSwgXCIvY2hhbm5lbFwiIF0sIHMgPSBjcmVhdGVXZWJDaGFubmVsVHJhbnNwb3J0KCksIG8gPSBnZXRTdGF0RXZlbnRUYXJnZXQoKSwgXyA9IHtcbiAgICAgICAgICAgIC8vIFJlcXVpcmVkIGZvciBiYWNrZW5kIHN0aWNraW5lc3MsIHJvdXRpbmcgYmVoYXZpb3IgaXMgYmFzZWQgb24gdGhpc1xuICAgICAgICAgICAgLy8gcGFyYW1ldGVyLlxuICAgICAgICAgICAgaHR0cFNlc3Npb25JZFBhcmFtOiBcImdzZXNzaW9uaWRcIixcbiAgICAgICAgICAgIGluaXRNZXNzYWdlSGVhZGVyczoge30sXG4gICAgICAgICAgICBtZXNzYWdlVXJsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBwYXJhbSBpcyB1c2VkIHRvIGltcHJvdmUgcm91dGluZyBhbmQgcHJvamVjdCBpc29sYXRpb24gYnkgdGhlXG4gICAgICAgICAgICAgICAgLy8gYmFja2VuZCBhbmQgbXVzdCBiZSBpbmNsdWRlZCBpbiBldmVyeSByZXF1ZXN0LlxuICAgICAgICAgICAgICAgIGRhdGFiYXNlOiBgcHJvamVjdHMvJHt0aGlzLmRhdGFiYXNlSWQucHJvamVjdElkfS9kYXRhYmFzZXMvJHt0aGlzLmRhdGFiYXNlSWQuZGF0YWJhc2V9YFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHNlbmRSYXdKc29uOiAhMCxcbiAgICAgICAgICAgIHN1cHBvcnRzQ3Jvc3NEb21haW5YaHI6ICEwLFxuICAgICAgICAgICAgaW50ZXJuYWxDaGFubmVsUGFyYW1zOiB7XG4gICAgICAgICAgICAgICAgLy8gT3ZlcnJpZGUgdGhlIGRlZmF1bHQgdGltZW91dCAocmFuZG9taXplZCBiZXR3ZWVuIDEwLTIwIHNlY29uZHMpIHNpbmNlXG4gICAgICAgICAgICAgICAgLy8gYSBsYXJnZSB3cml0ZSBiYXRjaCBvbiBhIHNsb3cgaW50ZXJuZXQgY29ubmVjdGlvbiBtYXkgdGFrZSBhIGxvbmdcbiAgICAgICAgICAgICAgICAvLyB0aW1lIHRvIHNlbmQgdG8gdGhlIGJhY2tlbmQuIFJhdGhlciB0aGFuIGhhdmUgV2ViQ2hhbm5lbCBpbXBvc2UgYVxuICAgICAgICAgICAgICAgIC8vIHRpZ2h0IHRpbWVvdXQgd2hpY2ggY291bGQgbGVhZCB0byBpbmZpbml0ZSB0aW1lb3V0cyBhbmQgcmV0cmllcywgd2VcbiAgICAgICAgICAgICAgICAvLyBzZXQgaXQgdmVyeSBsYXJnZSAoNS0xMCBtaW51dGVzKSBhbmQgcmVseSBvbiB0aGUgYnJvd3NlcidzIGJ1aWx0aW5cbiAgICAgICAgICAgICAgICAvLyB0aW1lb3V0cyB0byBraWNrIGluIGlmIHRoZSByZXF1ZXN0IGlzbid0IHdvcmtpbmcuXG4gICAgICAgICAgICAgICAgZm9yd2FyZENoYW5uZWxSZXF1ZXN0VGltZW91dE1zOiA2ZTVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JjZUxvbmdQb2xsaW5nOiB0aGlzLmZvcmNlTG9uZ1BvbGxpbmcsXG4gICAgICAgICAgICBkZXRlY3RCdWZmZXJpbmdQcm94eTogdGhpcy5hdXRvRGV0ZWN0TG9uZ1BvbGxpbmdcbiAgICAgICAgfSwgYSA9IHRoaXMubG9uZ1BvbGxpbmdPcHRpb25zLnRpbWVvdXRTZWNvbmRzO1xuICAgICAgICB2b2lkIDAgIT09IGEgJiYgKF8ubG9uZ1BvbGxpbmdUaW1lb3V0ID0gTWF0aC5yb3VuZCgxZTMgKiBhKSksIHRoaXMudXNlRmV0Y2hTdHJlYW1zICYmIChfLnVzZUZldGNoU3RyZWFtcyA9ICEwKSwgXG4gICAgICAgIHRoaXMuRG8oXy5pbml0TWVzc2FnZUhlYWRlcnMsIHQsIG4pLCBcbiAgICAgICAgLy8gU2VuZGluZyB0aGUgY3VzdG9tIGhlYWRlcnMgd2UganVzdCBhZGRlZCB0byByZXF1ZXN0LmluaXRNZXNzYWdlSGVhZGVyc1xuICAgICAgICAvLyAoQXV0aG9yaXphdGlvbiwgZXRjLikgd2lsbCB0cmlnZ2VyIHRoZSBicm93c2VyIHRvIG1ha2UgYSBDT1JTIHByZWZsaWdodFxuICAgICAgICAvLyByZXF1ZXN0IGJlY2F1c2UgdGhlIFhIUiB3aWxsIG5vIGxvbmdlciBtZWV0IHRoZSBjcml0ZXJpYSBmb3IgYSBcInNpbXBsZVwiXG4gICAgICAgIC8vIENPUlMgcmVxdWVzdDpcbiAgICAgICAgLy8gaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRUUC9DT1JTI1NpbXBsZV9yZXF1ZXN0c1xuICAgICAgICAvLyBUaGVyZWZvcmUgdG8gYXZvaWQgdGhlIENPUlMgcHJlZmxpZ2h0IHJlcXVlc3QgKGFuIGV4dHJhIG5ldHdvcmtcbiAgICAgICAgLy8gcm91bmR0cmlwKSwgd2UgdXNlIHRoZSBlbmNvZGVJbml0TWVzc2FnZUhlYWRlcnMgb3B0aW9uIHRvIHNwZWNpZnkgdGhhdFxuICAgICAgICAvLyB0aGUgaGVhZGVycyBzaG91bGQgaW5zdGVhZCBiZSBlbmNvZGVkIGluIHRoZSByZXF1ZXN0J3MgUE9TVCBwYXlsb2FkLFxuICAgICAgICAvLyB3aGljaCBpcyByZWNvZ25pemVkIGJ5IHRoZSB3ZWJjaGFubmVsIGJhY2tlbmQuXG4gICAgICAgIF8uZW5jb2RlSW5pdE1lc3NhZ2VIZWFkZXJzID0gITA7XG4gICAgICAgIGNvbnN0IHUgPSBpLmpvaW4oXCJcIik7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYENyZWF0aW5nIFJQQyAnJHtlfScgc3RyZWFtICR7cn06ICR7dX1gLCBfKTtcbiAgICAgICAgY29uc3QgYyA9IHMuY3JlYXRlV2ViQ2hhbm5lbCh1LCBfKTtcbiAgICAgICAgLy8gV2ViQ2hhbm5lbCBzdXBwb3J0cyBzZW5kaW5nIHRoZSBmaXJzdCBtZXNzYWdlIHdpdGggdGhlIGhhbmRzaGFrZSAtIHNhdmluZ1xuICAgICAgICAvLyBhIG5ldHdvcmsgcm91bmQgdHJpcC4gSG93ZXZlciwgaXQgd2lsbCBoYXZlIHRvIGNhbGwgc2VuZCBpbiB0aGUgc2FtZVxuICAgICAgICAvLyBKUyBldmVudCBsb29wIGFzIG9wZW4uIEluIG9yZGVyIHRvIGVuZm9yY2UgdGhpcywgd2UgZGVsYXkgYWN0dWFsbHlcbiAgICAgICAgLy8gb3BlbmluZyB0aGUgV2ViQ2hhbm5lbCB1bnRpbCBzZW5kIGlzIGNhbGxlZC4gV2hldGhlciB3ZSBoYXZlIGNhbGxlZFxuICAgICAgICAvLyBvcGVuIGlzIHRyYWNrZWQgd2l0aCB0aGlzIHZhcmlhYmxlLlxuICAgICAgICAgICAgICAgIGxldCBsID0gITEsIGggPSAhMTtcbiAgICAgICAgLy8gQSBmbGFnIHRvIGRldGVybWluZSB3aGV0aGVyIHRoZSBzdHJlYW0gd2FzIGNsb3NlZCAoYnkgdXMgb3IgdGhyb3VnaCBhblxuICAgICAgICAvLyBlcnJvci9jbG9zZSBldmVudCkgdG8gYXZvaWQgZGVsaXZlcmluZyBtdWx0aXBsZSBjbG9zZSBldmVudHMgb3Igc2VuZGluZ1xuICAgICAgICAvLyBvbiBhIGNsb3NlZCBzdHJlYW1cbiAgICAgICAgICAgICAgICBjb25zdCBQID0gbmV3IF9fUFJJVkFURV9TdHJlYW1CcmlkZ2Uoe1xuICAgICAgICAgICAgRm86IHQgPT4ge1xuICAgICAgICAgICAgICAgIGggPyBfX1BSSVZBVEVfbG9nRGVidWcoV3QsIGBOb3Qgc2VuZGluZyBiZWNhdXNlIFJQQyAnJHtlfScgc3RyZWFtICR7cn0gaXMgY2xvc2VkOmAsIHQpIDogKGwgfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYE9wZW5pbmcgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQuYCksIFxuICAgICAgICAgICAgICAgIGMub3BlbigpLCBsID0gITApLCBfX1BSSVZBVEVfbG9nRGVidWcoV3QsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHNlbmRpbmc6YCwgdCksIFxuICAgICAgICAgICAgICAgIGMuc2VuZCh0KSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgTW86ICgpID0+IGMuY2xvc2UoKVxuICAgICAgICB9KSwgX19QUklWQVRFX3VuZ3VhcmRlZEV2ZW50TGlzdGVuID0gKGUsIHQsIG4pID0+IHtcbiAgICAgICAgICAgIC8vIFRPRE8oZGltb25kKTogY2xvc3VyZSB0eXBpbmcgc2VlbXMgYnJva2VuIGJlY2F1c2UgV2ViQ2hhbm5lbCBkb2VzXG4gICAgICAgICAgICAvLyBub3QgaW1wbGVtZW50IGdvb2cuZXZlbnRzLkxpc3RlbmFibGVcbiAgICAgICAgICAgIGUubGlzdGVuKHQsIChlID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICBuKGUpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgZTtcbiAgICAgICAgICAgICAgICAgICAgfSksIDApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfTtcbiAgICAgICAgLy8gQ2xvc3VyZSBldmVudHMgYXJlIGd1YXJkZWQgYW5kIGV4Y2VwdGlvbnMgYXJlIHN3YWxsb3dlZCwgc28gY2F0Y2ggYW55XG4gICAgICAgIC8vIGV4Y2VwdGlvbiBhbmQgcmV0aHJvdyB1c2luZyBhIHNldFRpbWVvdXQgc28gdGhleSBiZWNvbWUgdmlzaWJsZSBhZ2Fpbi5cbiAgICAgICAgLy8gTm90ZSB0aGF0IGV2ZW50dWFsbHkgdGhpcyBmdW5jdGlvbiBjb3VsZCBnbyBhd2F5IGlmIHdlIGFyZSBjb25maWRlbnRcbiAgICAgICAgLy8gZW5vdWdoIHRoZSBjb2RlIGlzIGV4Y2VwdGlvbiBmcmVlLlxuICAgICAgICAgICAgICAgIHJldHVybiBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4oYywgV2ViQ2hhbm5lbC5FdmVudFR5cGUuT1BFTiwgKCgpID0+IHtcbiAgICAgICAgICAgIGggfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYFJQQyAnJHtlfScgc3RyZWFtICR7cn0gdHJhbnNwb3J0IG9wZW5lZC5gKSwgUC5RbygpKTtcbiAgICAgICAgfSkpLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4oYywgV2ViQ2hhbm5lbC5FdmVudFR5cGUuQ0xPU0UsICgoKSA9PiB7XG4gICAgICAgICAgICBoIHx8IChoID0gITAsIF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYFJQQyAnJHtlfScgc3RyZWFtICR7cn0gdHJhbnNwb3J0IGNsb3NlZGApLCBcbiAgICAgICAgICAgIFAuVW8oKSk7XG4gICAgICAgIH0pKSwgX19QUklWQVRFX3VuZ3VhcmRlZEV2ZW50TGlzdGVuKGMsIFdlYkNoYW5uZWwuRXZlbnRUeXBlLkVSUk9SLCAodCA9PiB7XG4gICAgICAgICAgICBoIHx8IChoID0gITAsIF9fUFJJVkFURV9sb2dXYXJuKFd0LCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSB0cmFuc3BvcnQgZXJyb3JlZDpgLCB0KSwgXG4gICAgICAgICAgICBQLlVvKG5ldyBGaXJlc3RvcmVFcnJvcihDLlVOQVZBSUxBQkxFLCBcIlRoZSBvcGVyYXRpb24gY291bGQgbm90IGJlIGNvbXBsZXRlZFwiKSkpO1xuICAgICAgICB9KSksIF9fUFJJVkFURV91bmd1YXJkZWRFdmVudExpc3RlbihjLCBXZWJDaGFubmVsLkV2ZW50VHlwZS5NRVNTQUdFLCAodCA9PiB7XG4gICAgICAgICAgICB2YXIgbjtcbiAgICAgICAgICAgIGlmICghaCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSB0LmRhdGFbMF07XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoISFpKTtcbiAgICAgICAgICAgICAgICAvLyBUT0RPKGIvMzUxNDM4OTEpOiBUaGVyZSBpcyBhIGJ1ZyBpbiBPbmUgUGxhdGZvcm0gdGhhdCBjYXVzZWQgZXJyb3JzXG4gICAgICAgICAgICAgICAgLy8gKGFuZCBvbmx5IGVycm9ycykgdG8gYmUgd3JhcHBlZCBpbiBhbiBleHRyYSBhcnJheS4gVG8gYmUgZm9yd2FyZFxuICAgICAgICAgICAgICAgIC8vIGNvbXBhdGlibGUgd2l0aCB0aGUgYnVnIHdlIG5lZWQgdG8gY2hlY2sgZWl0aGVyIGNvbmRpdGlvbi4gVGhlIGxhdHRlclxuICAgICAgICAgICAgICAgIC8vIGNhbiBiZSByZW1vdmVkIG9uY2UgdGhlIGZpeCBoYXMgYmVlbiByb2xsZWQgb3V0LlxuICAgICAgICAgICAgICAgIC8vIFVzZSBhbnkgYmVjYXVzZSBtc2dEYXRhLmVycm9yIGlzIG5vdCB0eXBlZC5cbiAgICAgICAgICAgICAgICBjb25zdCBzID0gaSwgbyA9IChudWxsID09IHMgPyB2b2lkIDAgOiBzLmVycm9yKSB8fCAobnVsbCA9PT0gKG4gPSBzWzBdKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLmVycm9yKTtcbiAgICAgICAgICAgICAgICBpZiAobykge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoV3QsIGBSUEMgJyR7ZX0nIHN0cmVhbSAke3J9IHJlY2VpdmVkIGVycm9yOmAsIG8pO1xuICAgICAgICAgICAgICAgICAgICAvLyBlcnJvci5zdGF0dXMgd2lsbCBiZSBhIHN0cmluZyBsaWtlICdPSycgb3IgJ05PVF9GT1VORCcuXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHQgPSBvLnN0YXR1cztcbiAgICAgICAgICAgICAgICAgICAgbGV0IG4gPSBcbiAgICAgICAgICAgICAgICAgICAgLyoqXG4gKiBNYXBzIGFuIGVycm9yIENvZGUgZnJvbSBhIEdSUEMgc3RhdHVzIGlkZW50aWZpZXIgbGlrZSAnTk9UX0ZPVU5EJy5cbiAqXG4gKiBAcmV0dXJucyBUaGUgQ29kZSBlcXVpdmFsZW50IHRvIHRoZSBnaXZlbiBzdGF0dXMgc3RyaW5nIG9yIHVuZGVmaW5lZCBpZlxuICogICAgIHRoZXJlIGlzIG5vIG1hdGNoLlxuICovXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY1N0YXR1cyhlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBsb29rdXAgYnkgc3RyaW5nXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IEV0W2VdO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gdCkgcmV0dXJuIF9fUFJJVkFURV9tYXBDb2RlRnJvbVJwY0NvZGUodCk7XG4gICAgICAgICAgICAgICAgICAgIH0odCksIGkgPSBvLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIHZvaWQgMCA9PT0gbiAmJiAobiA9IEMuSU5URVJOQUwsIGkgPSBcIlVua25vd24gZXJyb3Igc3RhdHVzOiBcIiArIHQgKyBcIiB3aXRoIG1lc3NhZ2UgXCIgKyBvLm1lc3NhZ2UpLCBcbiAgICAgICAgICAgICAgICAgICAgLy8gTWFyayBjbG9zZWQgc28gbm8gZnVydGhlciBldmVudHMgYXJlIHByb3BhZ2F0ZWRcbiAgICAgICAgICAgICAgICAgICAgaCA9ICEwLCBQLlVvKG5ldyBGaXJlc3RvcmVFcnJvcihuLCBpKSksIGMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgX19QUklWQVRFX2xvZ0RlYnVnKFd0LCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSByZWNlaXZlZDpgLCBpKSwgUC5LbyhpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBfX1BSSVZBVEVfdW5ndWFyZGVkRXZlbnRMaXN0ZW4obywgRXZlbnQuU1RBVF9FVkVOVCwgKHQgPT4ge1xuICAgICAgICAgICAgdC5zdGF0ID09PSBTdGF0LlBST1hZID8gX19QUklWQVRFX2xvZ0RlYnVnKFd0LCBgUlBDICcke2V9JyBzdHJlYW0gJHtyfSBkZXRlY3RlZCBidWZmZXJpbmcgcHJveHlgKSA6IHQuc3RhdCA9PT0gU3RhdC5OT1BST1hZICYmIF9fUFJJVkFURV9sb2dEZWJ1ZyhXdCwgYFJQQyAnJHtlfScgc3RyZWFtICR7cn0gZGV0ZWN0ZWQgbm8gYnVmZmVyaW5nIHByb3h5YCk7XG4gICAgICAgIH0pKSwgc2V0VGltZW91dCgoKCkgPT4ge1xuICAgICAgICAgICAgLy8gVGVjaG5pY2FsbHkgd2UgY291bGQvc2hvdWxkIHdhaXQgZm9yIHRoZSBXZWJDaGFubmVsIG9wZW5lZCBldmVudCxcbiAgICAgICAgICAgIC8vIGJ1dCBiZWNhdXNlIHdlIHdhbnQgdG8gc2VuZCB0aGUgZmlyc3QgbWVzc2FnZSB3aXRoIHRoZSBXZWJDaGFubmVsXG4gICAgICAgICAgICAvLyBoYW5kc2hha2Ugd2UgcHJldGVuZCB0aGUgY2hhbm5lbCBvcGVuZWQgaGVyZSAoYXN5bmNocm9ub3VzbHkpLCBhbmRcbiAgICAgICAgICAgIC8vIHRoZW4gZGVsYXkgdGhlIGFjdHVhbCBvcGVuIHVudGlsIHRoZSBmaXJzdCBtZXNzYWdlIGlzIHNlbnQuXG4gICAgICAgICAgICBQLiRvKCk7XG4gICAgICAgIH0pLCAwKSwgUDtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogSW5pdGlhbGl6ZXMgdGhlIFdlYkNoYW5uZWxDb25uZWN0aW9uIGZvciB0aGUgYnJvd3Nlci4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogVGhlIFBsYXRmb3JtJ3MgJ3dpbmRvdycgaW1wbGVtZW50YXRpb24gb3IgbnVsbCBpZiBub3QgYXZhaWxhYmxlLiAqL1xuZnVuY3Rpb24gX19QUklWQVRFX2dldFdpbmRvdygpIHtcbiAgICAvLyBgd2luZG93YCBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgZS5nLiBpbiBSZWFjdE5hdGl2ZSBhbmQgV2ViV29ya2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIHdpbmRvdyA/IHdpbmRvdyA6IG51bGw7XG59XG5cbi8qKiBUaGUgUGxhdGZvcm0ncyAnZG9jdW1lbnQnIGltcGxlbWVudGF0aW9uIG9yIG51bGwgaWYgbm90IGF2YWlsYWJsZS4gKi8gZnVuY3Rpb24gZ2V0RG9jdW1lbnQoKSB7XG4gICAgLy8gYGRvY3VtZW50YCBpcyBub3QgYWx3YXlzIGF2YWlsYWJsZSwgZS5nLiBpbiBSZWFjdE5hdGl2ZSBhbmQgV2ViV29ya2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVzdHJpY3RlZC1nbG9iYWxzXG4gICAgcmV0dXJuIFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIGRvY3VtZW50ID8gZG9jdW1lbnQgOiBudWxsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcihlKSB7XG4gICAgcmV0dXJuIG5ldyBKc29uUHJvdG9TZXJpYWxpemVyKGUsIC8qIHVzZVByb3RvM0pzb249ICovICEwKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBoZWxwZXIgZm9yIHJ1bm5pbmcgZGVsYXllZCB0YXNrcyBmb2xsb3dpbmcgYW4gZXhwb25lbnRpYWwgYmFja29mZiBjdXJ2ZVxuICogYmV0d2VlbiBhdHRlbXB0cy5cbiAqXG4gKiBFYWNoIGRlbGF5IGlzIG1hZGUgdXAgb2YgYSBcImJhc2VcIiBkZWxheSB3aGljaCBmb2xsb3dzIHRoZSBleHBvbmVudGlhbFxuICogYmFja29mZiBjdXJ2ZSwgYW5kIGEgKy8tIDUwJSBcImppdHRlclwiIHRoYXQgaXMgY2FsY3VsYXRlZCBhbmQgYWRkZWQgdG8gdGhlXG4gKiBiYXNlIGRlbGF5LiBUaGlzIHByZXZlbnRzIGNsaWVudHMgZnJvbSBhY2NpZGVudGFsbHkgc3luY2hyb25pemluZyB0aGVpclxuICogZGVsYXlzIGNhdXNpbmcgc3Bpa2VzIG9mIGxvYWQgdG8gdGhlIGJhY2tlbmQuXG4gKi9cbmNsYXNzIF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKlxuICAgICAqIFRoZSBBc3luY1F1ZXVlIHRvIHJ1biBiYWNrb2ZmIG9wZXJhdGlvbnMgb24uXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqXG4gICAgICogVGhlIElEIHRvIHVzZSB3aGVuIHNjaGVkdWxpbmcgYmFja29mZiBvcGVyYXRpb25zIG9uIHRoZSBBc3luY1F1ZXVlLlxuICAgICAqL1xuICAgIHQsIFxuICAgIC8qKlxuICAgICAqIFRoZSBpbml0aWFsIGRlbGF5ICh1c2VkIGFzIHRoZSBiYXNlIGRlbGF5IG9uIHRoZSBmaXJzdCByZXRyeSBhdHRlbXB0KS5cbiAgICAgKiBOb3RlIHRoYXQgaml0dGVyIHdpbGwgc3RpbGwgYmUgYXBwbGllZCwgc28gdGhlIGFjdHVhbCBkZWxheSBjb3VsZCBiZSBhc1xuICAgICAqIGxpdHRsZSBhcyAwLjUqaW5pdGlhbERlbGF5TXMuXG4gICAgICovXG4gICAgbiA9IDFlM1xuICAgIC8qKlxuICAgICAqIFRoZSBtdWx0aXBsaWVyIHRvIHVzZSB0byBkZXRlcm1pbmUgdGhlIGV4dGVuZGVkIGJhc2UgZGVsYXkgYWZ0ZXIgZWFjaFxuICAgICAqIGF0dGVtcHQuXG4gICAgICovICwgciA9IDEuNVxuICAgIC8qKlxuICAgICAqIFRoZSBtYXhpbXVtIGJhc2UgZGVsYXkgYWZ0ZXIgd2hpY2ggbm8gZnVydGhlciBiYWNrb2ZmIGlzIHBlcmZvcm1lZC5cbiAgICAgKiBOb3RlIHRoYXQgaml0dGVyIHdpbGwgc3RpbGwgYmUgYXBwbGllZCwgc28gdGhlIGFjdHVhbCBkZWxheSBjb3VsZCBiZSBhc1xuICAgICAqIG11Y2ggYXMgMS41Km1heERlbGF5TXMuXG4gICAgICovICwgaSA9IDZlNCkge1xuICAgICAgICB0aGlzLlRpID0gZSwgdGhpcy50aW1lcklkID0gdCwgdGhpcy5HbyA9IG4sIHRoaXMuem8gPSByLCB0aGlzLmpvID0gaSwgdGhpcy5IbyA9IDAsIFxuICAgICAgICB0aGlzLkpvID0gbnVsbCwgXG4gICAgICAgIC8qKiBUaGUgbGFzdCBiYWNrb2ZmIGF0dGVtcHQsIGFzIGVwb2NoIG1pbGxpc2Vjb25kcy4gKi9cbiAgICAgICAgdGhpcy5ZbyA9IERhdGUubm93KCksIHRoaXMucmVzZXQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVzZXRzIHRoZSBiYWNrb2ZmIGRlbGF5LlxuICAgICAqXG4gICAgICogVGhlIHZlcnkgbmV4dCBiYWNrb2ZmQW5kV2FpdCgpIHdpbGwgaGF2ZSBubyBkZWxheS4gSWYgaXQgaXMgY2FsbGVkIGFnYWluXG4gICAgICogKGkuZS4gZHVlIHRvIGFuIGVycm9yKSwgaW5pdGlhbERlbGF5TXMgKHBsdXMgaml0dGVyKSB3aWxsIGJlIHVzZWQsIGFuZFxuICAgICAqIHN1YnNlcXVlbnQgb25lcyB3aWxsIGluY3JlYXNlIGFjY29yZGluZyB0byB0aGUgYmFja29mZkZhY3Rvci5cbiAgICAgKi8gICAgcmVzZXQoKSB7XG4gICAgICAgIHRoaXMuSG8gPSAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXNldHMgdGhlIGJhY2tvZmYgZGVsYXkgdG8gdGhlIG1heGltdW0gZGVsYXkgKGUuZy4gZm9yIHVzZSBhZnRlciBhXG4gICAgICogUkVTT1VSQ0VfRVhIQVVTVEVEIGVycm9yKS5cbiAgICAgKi8gICAgWm8oKSB7XG4gICAgICAgIHRoaXMuSG8gPSB0aGlzLmpvO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHJlc29sdmVzIGFmdGVyIGN1cnJlbnREZWxheU1zLCBhbmQgaW5jcmVhc2VzIHRoZVxuICAgICAqIGRlbGF5IGZvciBhbnkgc3Vic2VxdWVudCBhdHRlbXB0cy4gSWYgdGhlcmUgd2FzIGEgcGVuZGluZyBiYWNrb2ZmIG9wZXJhdGlvblxuICAgICAqIGFscmVhZHksIGl0IHdpbGwgYmUgY2FuY2VsZWQuXG4gICAgICovICAgIFhvKGUpIHtcbiAgICAgICAgLy8gQ2FuY2VsIGFueSBwZW5kaW5nIGJhY2tvZmYgb3BlcmF0aW9uLlxuICAgICAgICB0aGlzLmNhbmNlbCgpO1xuICAgICAgICAvLyBGaXJzdCBzY2hlZHVsZSB1c2luZyB0aGUgY3VycmVudCBiYXNlICh3aGljaCBtYXkgYmUgMCBhbmQgc2hvdWxkIGJlXG4gICAgICAgIC8vIGhvbm9yZWQgYXMgc3VjaCkuXG4gICAgICAgIGNvbnN0IHQgPSBNYXRoLmZsb29yKHRoaXMuSG8gKyB0aGlzLmVfKCkpLCBuID0gTWF0aC5tYXgoMCwgRGF0ZS5ub3coKSAtIHRoaXMuWW8pLCByID0gTWF0aC5tYXgoMCwgdCAtIG4pO1xuICAgICAgICAvLyBHdWFyZCBhZ2FpbnN0IGxhc3RBdHRlbXB0VGltZSBiZWluZyBpbiB0aGUgZnV0dXJlIGR1ZSB0byBhIGNsb2NrIGNoYW5nZS5cbiAgICAgICAgICAgICAgICByID4gMCAmJiBfX1BSSVZBVEVfbG9nRGVidWcoXCJFeHBvbmVudGlhbEJhY2tvZmZcIiwgYEJhY2tpbmcgb2ZmIGZvciAke3J9IG1zIChiYXNlIGRlbGF5OiAke3RoaXMuSG99IG1zLCBkZWxheSB3aXRoIGppdHRlcjogJHt0fSBtcywgbGFzdCBhdHRlbXB0OiAke259IG1zIGFnbylgKSwgXG4gICAgICAgIHRoaXMuSm8gPSB0aGlzLlRpLmVucXVldWVBZnRlckRlbGF5KHRoaXMudGltZXJJZCwgciwgKCgpID0+ICh0aGlzLllvID0gRGF0ZS5ub3coKSwgXG4gICAgICAgIGUoKSkpKSwgXG4gICAgICAgIC8vIEFwcGx5IGJhY2tvZmYgZmFjdG9yIHRvIGRldGVybWluZSBuZXh0IGRlbGF5IGFuZCBlbnN1cmUgaXQgaXMgd2l0aGluXG4gICAgICAgIC8vIGJvdW5kcy5cbiAgICAgICAgdGhpcy5IbyAqPSB0aGlzLnpvLCB0aGlzLkhvIDwgdGhpcy5HbyAmJiAodGhpcy5IbyA9IHRoaXMuR28pLCB0aGlzLkhvID4gdGhpcy5qbyAmJiAodGhpcy5IbyA9IHRoaXMuam8pO1xuICAgIH1cbiAgICB0XygpIHtcbiAgICAgICAgbnVsbCAhPT0gdGhpcy5KbyAmJiAodGhpcy5Kby5za2lwRGVsYXkoKSwgdGhpcy5KbyA9IG51bGwpO1xuICAgIH1cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuSm8gJiYgKHRoaXMuSm8uY2FuY2VsKCksIHRoaXMuSm8gPSBudWxsKTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSByYW5kb20gdmFsdWUgaW4gdGhlIHJhbmdlIFstY3VycmVudEJhc2VNcy8yLCBjdXJyZW50QmFzZU1zLzJdICovICAgIGVfKCkge1xuICAgICAgICByZXR1cm4gKE1hdGgucmFuZG9tKCkgLSAuNSkgKiB0aGlzLkhvO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgR3QgPSBcIlBlcnNpc3RlbnRTdHJlYW1cIjtcblxuLyoqIFRoZSB0aW1lIGEgc3RyZWFtIHN0YXlzIG9wZW4gYWZ0ZXIgaXQgaXMgbWFya2VkIGlkbGUuICovXG4vKipcbiAqIEEgUGVyc2lzdGVudFN0cmVhbSBpcyBhbiBhYnN0cmFjdCBiYXNlIGNsYXNzIHRoYXQgcmVwcmVzZW50cyBhIHN0cmVhbWluZyBSUENcbiAqIHRvIHRoZSBGaXJlc3RvcmUgYmFja2VuZC4gSXQncyBidWlsdCBvbiB0b3Agb2YgdGhlIGNvbm5lY3Rpb25zIG93biBzdXBwb3J0XG4gKiBmb3Igc3RyZWFtaW5nIFJQQ3MsIGFuZCBhZGRzIHNldmVyYWwgY3JpdGljYWwgZmVhdHVyZXMgZm9yIG91ciBjbGllbnRzOlxuICpcbiAqICAgLSBFeHBvbmVudGlhbCBiYWNrb2ZmIG9uIGZhaWx1cmVcbiAqICAgLSBBdXRoZW50aWNhdGlvbiB2aWEgQ3JlZGVudGlhbHNQcm92aWRlclxuICogICAtIERpc3BhdGNoaW5nIGFsbCBjYWxsYmFja3MgaW50byB0aGUgc2hhcmVkIHdvcmtlciBxdWV1ZVxuICogICAtIENsb3NpbmcgaWRsZSBzdHJlYW1zIGFmdGVyIDYwIHNlY29uZHMgb2YgaW5hY3Rpdml0eVxuICpcbiAqIFN1YmNsYXNzZXMgb2YgUGVyc2lzdGVudFN0cmVhbSBpbXBsZW1lbnQgc2VyaWFsaXphdGlvbiBvZiBtb2RlbHMgdG8gYW5kXG4gKiBmcm9tIHRoZSBKU09OIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBwcm90b2NvbCBidWZmZXJzIGZvciBhIHNwZWNpZmljXG4gKiBzdHJlYW1pbmcgUlBDLlxuICpcbiAqICMjIFN0YXJ0aW5nIGFuZCBTdG9wcGluZ1xuICpcbiAqIFN0cmVhbWluZyBSUENzIGFyZSBzdGF0ZWZ1bCBhbmQgbmVlZCB0byBiZSBzdGFydCgpZWQgYmVmb3JlIG1lc3NhZ2VzIGNhblxuICogYmUgc2VudCBhbmQgcmVjZWl2ZWQuIFRoZSBQZXJzaXN0ZW50U3RyZWFtIHdpbGwgY2FsbCB0aGUgb25PcGVuKCkgZnVuY3Rpb25cbiAqIG9mIHRoZSBsaXN0ZW5lciBvbmNlIHRoZSBzdHJlYW0gaXMgcmVhZHkgdG8gYWNjZXB0IHJlcXVlc3RzLlxuICpcbiAqIFNob3VsZCBhIHN0YXJ0KCkgZmFpbCwgUGVyc2lzdGVudFN0cmVhbSB3aWxsIGNhbGwgdGhlIHJlZ2lzdGVyZWQgb25DbG9zZSgpXG4gKiBsaXN0ZW5lciB3aXRoIGEgRmlyZXN0b3JlRXJyb3IgaW5kaWNhdGluZyB3aGF0IHdlbnQgd3JvbmcuXG4gKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIGNhbiBiZSBzdGFydGVkIGFuZCBzdG9wcGVkIHJlcGVhdGVkbHkuXG4gKlxuICogR2VuZXJpYyB0eXBlczpcbiAqICBTZW5kVHlwZTogVGhlIHR5cGUgb2YgdGhlIG91dGdvaW5nIG1lc3NhZ2Ugb2YgdGhlIHVuZGVybHlpbmdcbiAqICAgIGNvbm5lY3Rpb24gc3RyZWFtXG4gKiAgUmVjZWl2ZVR5cGU6IFRoZSB0eXBlIG9mIHRoZSBpbmNvbWluZyBtZXNzYWdlIG9mIHRoZSB1bmRlcmx5aW5nXG4gKiAgICBjb25uZWN0aW9uIHN0cmVhbVxuICogIExpc3RlbmVyVHlwZTogVGhlIHR5cGUgb2YgdGhlIGxpc3RlbmVyIHRoYXQgd2lsbCBiZSB1c2VkIGZvciBjYWxsYmFja3NcbiAqL1xuY2xhc3MgX19QUklWQVRFX1BlcnNpc3RlbnRTdHJlYW0ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMsIG8sIF8pIHtcbiAgICAgICAgdGhpcy5UaSA9IGUsIHRoaXMubl8gPSBuLCB0aGlzLnJfID0gciwgdGhpcy5jb25uZWN0aW9uID0gaSwgdGhpcy5hdXRoQ3JlZGVudGlhbHNQcm92aWRlciA9IHMsIFxuICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHNQcm92aWRlciA9IG8sIHRoaXMubGlzdGVuZXIgPSBfLCB0aGlzLnN0YXRlID0gMCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSW5pdGlhbCAqLyAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSBjbG9zZSBjb3VudCB0aGF0J3MgaW5jcmVtZW50ZWQgZXZlcnkgdGltZSB0aGUgc3RyZWFtIGlzIGNsb3NlZDsgdXNlZCBieVxuICAgICAgICAgKiBnZXRDbG9zZUd1YXJkZWREaXNwYXRjaGVyKCkgdG8gaW52YWxpZGF0ZSBjYWxsYmFja3MgdGhhdCBoYXBwZW4gYWZ0ZXJcbiAgICAgICAgICogY2xvc2UuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmlfID0gMCwgdGhpcy5zXyA9IG51bGwsIHRoaXMub18gPSBudWxsLCB0aGlzLnN0cmVhbSA9IG51bGwsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQ291bnQgb2YgcmVzcG9uc2UgbWVzc2FnZXMgcmVjZWl2ZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9fID0gMCwgdGhpcy5hXyA9IG5ldyBfX1BSSVZBVEVfRXhwb25lbnRpYWxCYWNrb2ZmKGUsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgc3RhcnQoKSBoYXMgYmVlbiBjYWxsZWQgYW5kIG5vIGVycm9yIGhhcyBvY2N1cnJlZC4gVHJ1ZVxuICAgICAqIGluZGljYXRlcyB0aGUgc3RyZWFtIGlzIG9wZW4gb3IgaW4gdGhlIHByb2Nlc3Mgb2Ygb3BlbmluZyAod2hpY2hcbiAgICAgKiBlbmNvbXBhc3NlcyByZXNwZWN0aW5nIGJhY2tvZmYsIGdldHRpbmcgYXV0aCB0b2tlbnMsIGFuZCBzdGFydGluZyB0aGVcbiAgICAgKiBhY3R1YWwgUlBDKS4gVXNlIGlzT3BlbigpIHRvIGRldGVybWluZSBpZiB0aGUgc3RyZWFtIGlzIG9wZW4gYW5kIHJlYWR5IGZvclxuICAgICAqIG91dGJvdW5kIHJlcXVlc3RzLlxuICAgICAqLyAgICB1XygpIHtcbiAgICAgICAgcmV0dXJuIDEgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLlN0YXJ0aW5nICovID09PSB0aGlzLnN0YXRlIHx8IDUgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkJhY2tvZmYgKi8gPT09IHRoaXMuc3RhdGUgfHwgdGhpcy5jXygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHVuZGVybHlpbmcgUlBDIGlzIG9wZW4gKHRoZSBvbk9wZW4oKSBsaXN0ZW5lciBoYXMgYmVlblxuICAgICAqIGNhbGxlZCkgYW5kIHRoZSBzdHJlYW0gaXMgcmVhZHkgZm9yIG91dGJvdW5kIHJlcXVlc3RzLlxuICAgICAqLyAgICBjXygpIHtcbiAgICAgICAgcmV0dXJuIDIgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLk9wZW4gKi8gPT09IHRoaXMuc3RhdGUgfHwgMyAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuSGVhbHRoeSAqLyA9PT0gdGhpcy5zdGF0ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RhcnRzIHRoZSBSUEMuIE9ubHkgYWxsb3dlZCBpZiBpc1N0YXJ0ZWQoKSByZXR1cm5zIGZhbHNlLiBUaGUgc3RyZWFtIGlzXG4gICAgICogbm90IGltbWVkaWF0ZWx5IHJlYWR5IGZvciB1c2U6IG9uT3BlbigpIHdpbGwgYmUgaW52b2tlZCB3aGVuIHRoZSBSUEMgaXNcbiAgICAgKiByZWFkeSBmb3Igb3V0Ym91bmQgcmVxdWVzdHMsIGF0IHdoaWNoIHBvaW50IGlzT3BlbigpIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICpcbiAgICAgKiBXaGVuIHN0YXJ0IHJldHVybnMsIGlzU3RhcnRlZCgpIHdpbGwgcmV0dXJuIHRydWUuXG4gICAgICovICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLl9fID0gMCwgNCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuRXJyb3IgKi8gIT09IHRoaXMuc3RhdGUgPyB0aGlzLmF1dGgoKSA6IHRoaXMubF8oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RvcHMgdGhlIFJQQy4gVGhpcyBjYWxsIGlzIGlkZW1wb3RlbnQgYW5kIGFsbG93ZWQgcmVnYXJkbGVzcyBvZiB0aGVcbiAgICAgKiBjdXJyZW50IGlzU3RhcnRlZCgpIHN0YXRlLlxuICAgICAqXG4gICAgICogV2hlbiBzdG9wIHJldHVybnMsIGlzU3RhcnRlZCgpIGFuZCBpc09wZW4oKSB3aWxsIGJvdGggcmV0dXJuIGZhbHNlLlxuICAgICAqLyAgICBhc3luYyBzdG9wKCkge1xuICAgICAgICB0aGlzLnVfKCkgJiYgYXdhaXQgdGhpcy5jbG9zZSgwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWZ0ZXIgYW4gZXJyb3IgdGhlIHN0cmVhbSB3aWxsIHVzdWFsbHkgYmFjayBvZmYgb24gdGhlIG5leHQgYXR0ZW1wdCB0b1xuICAgICAqIHN0YXJ0IGl0LiBJZiB0aGUgZXJyb3Igd2FycmFudHMgYW4gaW1tZWRpYXRlIHJlc3RhcnQgb2YgdGhlIHN0cmVhbSwgdGhlXG4gICAgICogc2VuZGVyIGNhbiB1c2UgdGhpcyB0byBpbmRpY2F0ZSB0aGF0IHRoZSByZWNlaXZlciBzaG91bGQgbm90IGJhY2sgb2ZmLlxuICAgICAqXG4gICAgICogRWFjaCBlcnJvciB3aWxsIGNhbGwgdGhlIG9uQ2xvc2UoKSBsaXN0ZW5lci4gVGhhdCBmdW5jdGlvbiBjYW4gZGVjaWRlIHRvXG4gICAgICogaW5oaWJpdCBiYWNrb2ZmIGlmIHJlcXVpcmVkLlxuICAgICAqLyAgICBoXygpIHtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDAgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkluaXRpYWwgKi8gLCB0aGlzLmFfLnJlc2V0KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE1hcmtzIHRoaXMgc3RyZWFtIGFzIGlkbGUuIElmIG5vIGZ1cnRoZXIgYWN0aW9ucyBhcmUgcGVyZm9ybWVkIG9uIHRoZVxuICAgICAqIHN0cmVhbSBmb3Igb25lIG1pbnV0ZSwgdGhlIHN0cmVhbSB3aWxsIGF1dG9tYXRpY2FsbHkgY2xvc2UgaXRzZWxmIGFuZFxuICAgICAqIG5vdGlmeSB0aGUgc3RyZWFtJ3Mgb25DbG9zZSgpIGhhbmRsZXIgd2l0aCBTdGF0dXMuT0suIFRoZSBzdHJlYW0gd2lsbCB0aGVuXG4gICAgICogYmUgaW4gYSAhaXNTdGFydGVkKCkgc3RhdGUsIHJlcXVpcmluZyB0aGUgY2FsbGVyIHRvIHN0YXJ0IHRoZSBzdHJlYW0gYWdhaW5cbiAgICAgKiBiZWZvcmUgZnVydGhlciB1c2UuXG4gICAgICpcbiAgICAgKiBPbmx5IHN0cmVhbXMgdGhhdCBhcmUgaW4gc3RhdGUgJ09wZW4nIGNhbiBiZSBtYXJrZWQgaWRsZSwgYXMgYWxsIG90aGVyXG4gICAgICogc3RhdGVzIGltcGx5IHBlbmRpbmcgbmV0d29yayBvcGVyYXRpb25zLlxuICAgICAqLyAgICBQXygpIHtcbiAgICAgICAgLy8gU3RhcnRzIHRoZSBpZGxlIHRpbWUgaWYgd2UgYXJlIGluIHN0YXRlICdPcGVuJyBhbmQgYXJlIG5vdCB5ZXQgYWxyZWFkeVxuICAgICAgICAvLyBydW5uaW5nIGEgdGltZXIgKGluIHdoaWNoIGNhc2UgdGhlIHByZXZpb3VzIGlkbGUgdGltZW91dCBzdGlsbCBhcHBsaWVzKS5cbiAgICAgICAgdGhpcy5jXygpICYmIG51bGwgPT09IHRoaXMuc18gJiYgKHRoaXMuc18gPSB0aGlzLlRpLmVucXVldWVBZnRlckRlbGF5KHRoaXMubl8sIDZlNCwgKCgpID0+IHRoaXMuVF8oKSkpKTtcbiAgICB9XG4gICAgLyoqIFNlbmRzIGEgbWVzc2FnZSB0byB0aGUgdW5kZXJseWluZyBzdHJlYW0uICovICAgIElfKGUpIHtcbiAgICAgICAgdGhpcy5FXygpLCB0aGlzLnN0cmVhbS5zZW5kKGUpO1xuICAgIH1cbiAgICAvKiogQ2FsbGVkIGJ5IHRoZSBpZGxlIHRpbWVyIHdoZW4gdGhlIHN0cmVhbSBzaG91bGQgY2xvc2UgZHVlIHRvIGluYWN0aXZpdHkuICovICAgIGFzeW5jIFRfKCkge1xuICAgICAgICBpZiAodGhpcy5jXygpKSBcbiAgICAgICAgLy8gV2hlbiB0aW1pbmcgb3V0IGFuIGlkbGUgc3RyZWFtIHRoZXJlJ3Mgbm8gcmVhc29uIHRvIGZvcmNlIHRoZSBzdHJlYW0gaW50byBiYWNrb2ZmIHdoZW5cbiAgICAgICAgLy8gaXQgcmVzdGFydHMgc28gc2V0IHRoZSBzdHJlYW0gc3RhdGUgdG8gSW5pdGlhbCBpbnN0ZWFkIG9mIEVycm9yLlxuICAgICAgICByZXR1cm4gdGhpcy5jbG9zZSgwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovKTtcbiAgICB9XG4gICAgLyoqIE1hcmtzIHRoZSBzdHJlYW0gYXMgYWN0aXZlIGFnYWluLiAqLyAgICBFXygpIHtcbiAgICAgICAgdGhpcy5zXyAmJiAodGhpcy5zXy5jYW5jZWwoKSwgdGhpcy5zXyA9IG51bGwpO1xuICAgIH1cbiAgICAvKiogQ2FuY2VscyB0aGUgaGVhbHRoIGNoZWNrIGRlbGF5ZWQgb3BlcmF0aW9uLiAqLyAgICBkXygpIHtcbiAgICAgICAgdGhpcy5vXyAmJiAodGhpcy5vXy5jYW5jZWwoKSwgdGhpcy5vXyA9IG51bGwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbG9zZXMgdGhlIHN0cmVhbSBhbmQgY2xlYW5zIHVwIGFzIG5lY2Vzc2FyeTpcbiAgICAgKlxuICAgICAqICogY2xvc2VzIHRoZSB1bmRlcmx5aW5nIEdSUEMgc3RyZWFtO1xuICAgICAqICogY2FsbHMgdGhlIG9uQ2xvc2UgaGFuZGxlciB3aXRoIHRoZSBnaXZlbiAnZXJyb3InO1xuICAgICAqICogc2V0cyBpbnRlcm5hbCBzdHJlYW0gc3RhdGUgdG8gJ2ZpbmFsU3RhdGUnO1xuICAgICAqICogYWRqdXN0cyB0aGUgYmFja29mZiB0aW1lciBiYXNlZCBvbiB0aGUgZXJyb3JcbiAgICAgKlxuICAgICAqIEEgbmV3IHN0cmVhbSBjYW4gYmUgb3BlbmVkIGJ5IGNhbGxpbmcgc3RhcnQoKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaW5hbFN0YXRlIC0gdGhlIGludGVuZGVkIHN0YXRlIG9mIHRoZSBzdHJlYW0gYWZ0ZXIgY2xvc2luZy5cbiAgICAgKiBAcGFyYW0gZXJyb3IgLSB0aGUgZXJyb3IgdGhlIGNvbm5lY3Rpb24gd2FzIGNsb3NlZCB3aXRoLlxuICAgICAqLyAgICBhc3luYyBjbG9zZShlLCB0KSB7XG4gICAgICAgIC8vIENhbmNlbCBhbnkgb3V0c3RhbmRpbmcgdGltZXJzICh0aGV5J3JlIGd1YXJhbnRlZWQgbm90IHRvIGV4ZWN1dGUpLlxuICAgICAgICB0aGlzLkVfKCksIHRoaXMuZF8oKSwgdGhpcy5hXy5jYW5jZWwoKSwgXG4gICAgICAgIC8vIEludmFsaWRhdGVzIGFueSBzdHJlYW0tcmVsYXRlZCBjYWxsYmFja3MgKGUuZy4gZnJvbSBhdXRoIG9yIHRoZVxuICAgICAgICAvLyB1bmRlcmx5aW5nIHN0cmVhbSksIGd1YXJhbnRlZWluZyB0aGV5IHdvbid0IGV4ZWN1dGUuXG4gICAgICAgIHRoaXMuaV8rKywgNCAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuRXJyb3IgKi8gIT09IGUgPyBcbiAgICAgICAgLy8gSWYgdGhpcyBpcyBhbiBpbnRlbnRpb25hbCBjbG9zZSBlbnN1cmUgd2UgZG9uJ3QgZGVsYXkgb3VyIG5leHQgY29ubmVjdGlvbiBhdHRlbXB0LlxuICAgICAgICB0aGlzLmFfLnJlc2V0KCkgOiB0ICYmIHQuY29kZSA9PT0gQy5SRVNPVVJDRV9FWEhBVVNURUQgPyAoXG4gICAgICAgIC8vIExvZyB0aGUgZXJyb3IuIChQcm9iYWJseSBlaXRoZXIgJ3F1b3RhIGV4Y2VlZGVkJyBvciAnbWF4IHF1ZXVlIGxlbmd0aCByZWFjaGVkJy4pXG4gICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcih0LnRvU3RyaW5nKCkpLCBfX1BSSVZBVEVfbG9nRXJyb3IoXCJVc2luZyBtYXhpbXVtIGJhY2tvZmYgZGVsYXkgdG8gcHJldmVudCBvdmVybG9hZGluZyB0aGUgYmFja2VuZC5cIiksIFxuICAgICAgICB0aGlzLmFfLlpvKCkpIDogdCAmJiB0LmNvZGUgPT09IEMuVU5BVVRIRU5USUNBVEVEICYmIDMgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkhlYWx0aHkgKi8gIT09IHRoaXMuc3RhdGUgJiYgKFxuICAgICAgICAvLyBcInVuYXV0aGVudGljYXRlZFwiIGVycm9yIG1lYW5zIHRoZSB0b2tlbiB3YXMgcmVqZWN0ZWQuIFRoaXMgc2hvdWxkIHJhcmVseVxuICAgICAgICAvLyBoYXBwZW4gc2luY2UgYm90aCBBdXRoIGFuZCBBcHBDaGVjayBlbnN1cmUgYSBzdWZmaWNpZW50IFRUTCB3aGVuIHdlXG4gICAgICAgIC8vIHJlcXVlc3QgYSB0b2tlbi4gSWYgYSB1c2VyIG1hbnVhbGx5IHJlc2V0cyB0aGVpciBzeXN0ZW0gY2xvY2sgdGhpcyBjYW5cbiAgICAgICAgLy8gZmFpbCwgaG93ZXZlci4gSW4gdGhpcyBjYXNlLCB3ZSBzaG91bGQgZ2V0IGEgQ29kZS5VTkFVVEhFTlRJQ0FURUQgZXJyb3JcbiAgICAgICAgLy8gYmVmb3JlIHdlIHJlY2VpdmVkIHRoZSBmaXJzdCBtZXNzYWdlIGFuZCB3ZSBuZWVkIHRvIGludmFsaWRhdGUgdGhlIHRva2VuXG4gICAgICAgIC8vIHRvIGVuc3VyZSB0aGF0IHdlIGZldGNoIGEgbmV3IHRva2VuLlxuICAgICAgICB0aGlzLmF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyLmludmFsaWRhdGVUb2tlbigpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHNQcm92aWRlci5pbnZhbGlkYXRlVG9rZW4oKSksIFxuICAgICAgICAvLyBDbGVhbiB1cCB0aGUgdW5kZXJseWluZyBzdHJlYW0gYmVjYXVzZSB3ZSBhcmUgbm8gbG9uZ2VyIGludGVyZXN0ZWQgaW4gZXZlbnRzLlxuICAgICAgICBudWxsICE9PSB0aGlzLnN0cmVhbSAmJiAodGhpcy5BXygpLCB0aGlzLnN0cmVhbS5jbG9zZSgpLCB0aGlzLnN0cmVhbSA9IG51bGwpLCBcbiAgICAgICAgLy8gVGhpcyBzdGF0ZSBtdXN0IGJlIGFzc2lnbmVkIGJlZm9yZSBjYWxsaW5nIG9uQ2xvc2UoKSB0byBhbGxvdyB0aGUgY2FsbGJhY2sgdG9cbiAgICAgICAgLy8gaW5oaWJpdCBiYWNrb2ZmIG9yIG90aGVyd2lzZSBtYW5pcHVsYXRlIHRoZSBzdGF0ZSBpbiBpdHMgbm9uLXN0YXJ0ZWQgc3RhdGUuXG4gICAgICAgIHRoaXMuc3RhdGUgPSBlLCBcbiAgICAgICAgLy8gTm90aWZ5IHRoZSBsaXN0ZW5lciB0aGF0IHRoZSBzdHJlYW0gY2xvc2VkLlxuICAgICAgICBhd2FpdCB0aGlzLmxpc3RlbmVyLkxvKHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYW4gYmUgb3ZlcnJpZGRlbiB0byBwZXJmb3JtIGFkZGl0aW9uYWwgY2xlYW51cCBiZWZvcmUgdGhlIHN0cmVhbSBpcyBjbG9zZWQuXG4gICAgICogQ2FsbGluZyBzdXBlci50ZWFyRG93bigpIGlzIG5vdCByZXF1aXJlZC5cbiAgICAgKi8gICAgQV8oKSB7fVxuICAgIGF1dGgoKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSAxIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5TdGFydGluZyAqLztcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuUl8odGhpcy5pXyksIHQgPSB0aGlzLmlfO1xuICAgICAgICAvLyBUT0RPKG1pa2VsZWhlbik6IEp1c3QgdXNlIGRpc3BhdGNoSWZOb3RDbG9zZWQsIGJ1dCBzZWUgVE9ETyBiZWxvdy5cbiAgICAgICAgICAgICAgICBQcm9taXNlLmFsbChbIHRoaXMuYXV0aENyZWRlbnRpYWxzUHJvdmlkZXIuZ2V0VG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzUHJvdmlkZXIuZ2V0VG9rZW4oKSBdKS50aGVuKCgoW2UsIG5dKSA9PiB7XG4gICAgICAgICAgICAvLyBTdHJlYW0gY2FuIGJlIHN0b3BwZWQgd2hpbGUgd2FpdGluZyBmb3IgYXV0aGVudGljYXRpb24uXG4gICAgICAgICAgICAvLyBUT0RPKG1pa2VsZWhlbik6IFdlIHJlYWxseSBzaG91bGQganVzdCB1c2UgZGlzcGF0Y2hJZk5vdENsb3NlZFxuICAgICAgICAgICAgLy8gYW5kIGxldCB0aGlzIGRpc3BhdGNoIG9udG8gdGhlIHF1ZXVlLCBidXQgdGhhdCBvcGVuZWQgYSBzcGVjIHRlc3QgY2FuXG4gICAgICAgICAgICAvLyBvZiB3b3JtcyB0aGF0IEkgZG9uJ3Qgd2FudCB0byBkZWFsIHdpdGggaW4gdGhpcyBQUi5cbiAgICAgICAgICAgIHRoaXMuaV8gPT09IHQgJiYgXG4gICAgICAgICAgICAvLyBOb3JtYWxseSB3ZSdkIGhhdmUgdG8gc2NoZWR1bGUgdGhlIGNhbGxiYWNrIG9uIHRoZSBBc3luY1F1ZXVlLlxuICAgICAgICAgICAgLy8gSG93ZXZlciwgdGhlIGZvbGxvd2luZyBjYWxscyBhcmUgc2FmZSB0byBiZSBjYWxsZWQgb3V0c2lkZSB0aGVcbiAgICAgICAgICAgIC8vIEFzeW5jUXVldWUgc2luY2UgdGhleSBkb24ndCBjaGFpbiBhc3luY2hyb25vdXMgY2FsbHNcbiAgICAgICAgICAgIHRoaXMuVl8oZSwgbik7XG4gICAgICAgIH0pLCAodCA9PiB7XG4gICAgICAgICAgICBlKCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBGaXJlc3RvcmVFcnJvcihDLlVOS05PV04sIFwiRmV0Y2hpbmcgYXV0aCB0b2tlbiBmYWlsZWQ6IFwiICsgdC5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5tXyhlKTtcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBWXyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLlJfKHRoaXMuaV8pO1xuICAgICAgICB0aGlzLnN0cmVhbSA9IHRoaXMuZl8oZSwgdCksIHRoaXMuc3RyZWFtLnhvKCgoKSA9PiB7XG4gICAgICAgICAgICBuKCgoKSA9PiB0aGlzLmxpc3RlbmVyLnhvKCkpKTtcbiAgICAgICAgfSkpLCB0aGlzLnN0cmVhbS5ObygoKCkgPT4ge1xuICAgICAgICAgICAgbigoKCkgPT4gKHRoaXMuc3RhdGUgPSAyIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5PcGVuICovICwgdGhpcy5vXyA9IHRoaXMuVGkuZW5xdWV1ZUFmdGVyRGVsYXkodGhpcy5yXywgMWU0LCAoKCkgPT4gKHRoaXMuY18oKSAmJiAodGhpcy5zdGF0ZSA9IDMgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkhlYWx0aHkgKi8pLCBcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZSgpKSkpLCB0aGlzLmxpc3RlbmVyLk5vKCkpKSk7XG4gICAgICAgIH0pKSwgdGhpcy5zdHJlYW0uTG8oKGUgPT4ge1xuICAgICAgICAgICAgbigoKCkgPT4gdGhpcy5tXyhlKSkpO1xuICAgICAgICB9KSksIHRoaXMuc3RyZWFtLm9uTWVzc2FnZSgoZSA9PiB7XG4gICAgICAgICAgICBuKCgoKSA9PiAxID09ICsrdGhpcy5fXyA/IHRoaXMuZ18oZSkgOiB0aGlzLm9uTmV4dChlKSkpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIGxfKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gNSAvKiBQZXJzaXN0ZW50U3RyZWFtU3RhdGUuQmFja29mZiAqLyAsIHRoaXMuYV8uWG8oKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuc3RhdGUgPSAwIC8qIFBlcnNpc3RlbnRTdHJlYW1TdGF0ZS5Jbml0aWFsICovICwgdGhpcy5zdGFydCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8vIFZpc2libGUgZm9yIHRlc3RzXG4gICAgbV8oZSkge1xuICAgICAgICAvLyBJbiB0aGVvcnkgdGhlIHN0cmVhbSBjb3VsZCBjbG9zZSBjbGVhbmx5LCBob3dldmVyLCBpbiBvdXIgY3VycmVudCBtb2RlbFxuICAgICAgICAvLyB3ZSBuZXZlciBleHBlY3QgdGhpcyB0byBoYXBwZW4gYmVjYXVzZSBpZiB3ZSBzdG9wIGEgc3RyZWFtIG91cnNlbHZlcyxcbiAgICAgICAgLy8gdGhpcyBjYWxsYmFjayB3aWxsIG5ldmVyIGJlIGNhbGxlZC4gVG8gcHJldmVudCBjYXNlcyB3aGVyZSB3ZSByZXRyeVxuICAgICAgICAvLyB3aXRob3V0IGEgYmFja29mZiBhY2NpZGVudGFsbHksIHdlIHNldCB0aGUgc3RyZWFtIHRvIGVycm9yIGluIGFsbCBjYXNlcy5cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9sb2dEZWJ1ZyhHdCwgYGNsb3NlIHdpdGggZXJyb3I6ICR7ZX1gKSwgdGhpcy5zdHJlYW0gPSBudWxsLCB0aGlzLmNsb3NlKDQgLyogUGVyc2lzdGVudFN0cmVhbVN0YXRlLkVycm9yICovICwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBcImRpc3BhdGNoZXJcIiBmdW5jdGlvbiB0aGF0IGRpc3BhdGNoZXMgb3BlcmF0aW9ucyBvbnRvIHRoZVxuICAgICAqIEFzeW5jUXVldWUgYnV0IG9ubHkgcnVucyB0aGVtIGlmIGNsb3NlQ291bnQgcmVtYWlucyB1bmNoYW5nZWQuIFRoaXMgYWxsb3dzXG4gICAgICogdXMgdG8gdHVybiBhdXRoIC8gc3RyZWFtIGNhbGxiYWNrcyBpbnRvIG5vLW9wcyBpZiB0aGUgc3RyZWFtIGlzIGNsb3NlZCAvXG4gICAgICogcmUtb3BlbmVkLCBldGMuXG4gICAgICovICAgIFJfKGUpIHtcbiAgICAgICAgcmV0dXJuIHQgPT4ge1xuICAgICAgICAgICAgdGhpcy5UaS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiB0aGlzLmlfID09PSBlID8gdCgpIDogKF9fUFJJVkFURV9sb2dEZWJ1ZyhHdCwgXCJzdHJlYW0gY2FsbGJhY2sgc2tpcHBlZCBieSBnZXRDbG9zZUd1YXJkZWREaXNwYXRjaGVyLlwiKSwgXG4gICAgICAgICAgICBQcm9taXNlLnJlc29sdmUoKSkpKTtcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBQZXJzaXN0ZW50U3RyZWFtIHRoYXQgaW1wbGVtZW50cyB0aGUgTGlzdGVuIFJQQy5cbiAqXG4gKiBPbmNlIHRoZSBMaXN0ZW4gc3RyZWFtIGhhcyBjYWxsZWQgdGhlIG9uT3BlbigpIGxpc3RlbmVyLCBhbnkgbnVtYmVyIG9mXG4gKiBsaXN0ZW4oKSBhbmQgdW5saXN0ZW4oKSBjYWxscyBjYW4gYmUgbWFkZSB0byBjb250cm9sIHdoYXQgY2hhbmdlcyB3aWxsIGJlXG4gKiBzZW50IGZyb20gdGhlIHNlcnZlciBmb3IgTGlzdGVuUmVzcG9uc2VzLlxuICovIGNsYXNzIF9fUFJJVkFURV9QZXJzaXN0ZW50TGlzdGVuU3RyZWFtIGV4dGVuZHMgX19QUklWQVRFX1BlcnNpc3RlbnRTdHJlYW0ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgc3VwZXIoZSwgXCJsaXN0ZW5fc3RyZWFtX2Nvbm5lY3Rpb25fYmFja29mZlwiIC8qIFRpbWVySWQuTGlzdGVuU3RyZWFtQ29ubmVjdGlvbkJhY2tvZmYgKi8gLCBcImxpc3Rlbl9zdHJlYW1faWRsZVwiIC8qIFRpbWVySWQuTGlzdGVuU3RyZWFtSWRsZSAqLyAsIFwiaGVhbHRoX2NoZWNrX3RpbWVvdXRcIiAvKiBUaW1lcklkLkhlYWx0aENoZWNrVGltZW91dCAqLyAsIHQsIG4sIHIsIHMpLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gaTtcbiAgICB9XG4gICAgZl8oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jb25uZWN0aW9uLldvKFwiTGlzdGVuXCIsIGUsIHQpO1xuICAgIH1cbiAgICBnXyhlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9uTmV4dChlKTtcbiAgICB9XG4gICAgb25OZXh0KGUpIHtcbiAgICAgICAgLy8gQSBzdWNjZXNzZnVsIHJlc3BvbnNlIG1lYW5zIHRoZSBzdHJlYW0gaXMgaGVhbHRoeVxuICAgICAgICB0aGlzLmFfLnJlc2V0KCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbVdhdGNoQ2hhbmdlKHRoaXMuc2VyaWFsaXplciwgZSksIG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfdmVyc2lvbkZyb21MaXN0ZW5SZXNwb25zZShlKSB7XG4gICAgICAgICAgICAvLyBXZSBoYXZlIG9ubHkgcmVhY2hlZCBhIGNvbnNpc3RlbnQgc25hcHNob3QgZm9yIHRoZSBlbnRpcmUgc3RyZWFtIGlmIHRoZXJlXG4gICAgICAgICAgICAvLyBpcyBhIHJlYWRfdGltZSBzZXQgYW5kIGl0IGFwcGxpZXMgdG8gYWxsIHRhcmdldHMgKGkuZS4gdGhlIGxpc3Qgb2ZcbiAgICAgICAgICAgIC8vIHRhcmdldHMgaXMgZW1wdHkpLiBUaGUgYmFja2VuZCBpcyBndWFyYW50ZWVkIHRvIHNlbmQgc3VjaCByZXNwb25zZXMuXG4gICAgICAgICAgICBpZiAoIShcInRhcmdldENoYW5nZVwiIGluIGUpKSByZXR1cm4gU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgICAgICAgICAgY29uc3QgdCA9IGUudGFyZ2V0Q2hhbmdlO1xuICAgICAgICAgICAgcmV0dXJuIHQudGFyZ2V0SWRzICYmIHQudGFyZ2V0SWRzLmxlbmd0aCA/IFNuYXBzaG90VmVyc2lvbi5taW4oKSA6IHQucmVhZFRpbWUgPyBfX1BSSVZBVEVfZnJvbVZlcnNpb24odC5yZWFkVGltZSkgOiBTbmFwc2hvdFZlcnNpb24ubWluKCk7XG4gICAgICAgIH0oZSk7XG4gICAgICAgIHJldHVybiB0aGlzLmxpc3RlbmVyLnBfKHQsIG4pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgaW50ZXJlc3QgaW4gdGhlIHJlc3VsdHMgb2YgdGhlIGdpdmVuIHRhcmdldC4gSWYgdGhlIHRhcmdldFxuICAgICAqIGluY2x1ZGVzIGEgcmVzdW1lVG9rZW4gaXQgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcmVxdWVzdC4gUmVzdWx0cyB0aGF0XG4gICAgICogYWZmZWN0IHRoZSB0YXJnZXQgd2lsbCBiZSBzdHJlYW1lZCBiYWNrIGFzIFdhdGNoQ2hhbmdlIG1lc3NhZ2VzIHRoYXRcbiAgICAgKiByZWZlcmVuY2UgdGhlIHRhcmdldElkLlxuICAgICAqLyAgICB5XyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB7fTtcbiAgICAgICAgdC5kYXRhYmFzZSA9IF9fUFJJVkFURV9nZXRFbmNvZGVkRGF0YWJhc2VJZCh0aGlzLnNlcmlhbGl6ZXIpLCB0LmFkZFRhcmdldCA9IGZ1bmN0aW9uIF9fUFJJVkFURV90b1RhcmdldChlLCB0KSB7XG4gICAgICAgICAgICBsZXQgbjtcbiAgICAgICAgICAgIGNvbnN0IHIgPSB0LnRhcmdldDtcbiAgICAgICAgICAgIGlmIChuID0gX19QUklWQVRFX3RhcmdldElzRG9jdW1lbnRUYXJnZXQocikgPyB7XG4gICAgICAgICAgICAgICAgZG9jdW1lbnRzOiBfX1BSSVZBVEVfdG9Eb2N1bWVudHNUYXJnZXQoZSwgcilcbiAgICAgICAgICAgIH0gOiB7XG4gICAgICAgICAgICAgICAgcXVlcnk6IF9fUFJJVkFURV90b1F1ZXJ5VGFyZ2V0KGUsIHIpLmh0XG4gICAgICAgICAgICB9LCBuLnRhcmdldElkID0gdC50YXJnZXRJZCwgdC5yZXN1bWVUb2tlbi5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgbi5yZXN1bWVUb2tlbiA9IF9fUFJJVkFURV90b0J5dGVzKGUsIHQucmVzdW1lVG9rZW4pO1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfdG9JbnQzMlByb3RvKGUsIHQuZXhwZWN0ZWRDb3VudCk7XG4gICAgICAgICAgICAgICAgbnVsbCAhPT0gciAmJiAobi5leHBlY3RlZENvdW50ID0gcik7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHQuc25hcHNob3RWZXJzaW9uLmNvbXBhcmVUbyhTbmFwc2hvdFZlcnNpb24ubWluKCkpID4gMCkge1xuICAgICAgICAgICAgICAgIC8vIFRPRE8od3VhbmR5KTogQ29uc2lkZXIgcmVtb3ZpbmcgYWJvdmUgY2hlY2sgYmVjYXVzZSBpdCBpcyBtb3N0IGxpa2VseSB0cnVlLlxuICAgICAgICAgICAgICAgIC8vIFJpZ2h0IG5vdywgbWFueSB0ZXN0cyBkZXBlbmQgb24gdGhpcyBiZWhhdmlvdXIgdGhvdWdoIChsZWF2aW5nIG1pbigpIG91dFxuICAgICAgICAgICAgICAgIC8vIG9mIHNlcmlhbGl6YXRpb24pLlxuICAgICAgICAgICAgICAgIG4ucmVhZFRpbWUgPSB0b1RpbWVzdGFtcChlLCB0LnNuYXBzaG90VmVyc2lvbi50b1RpbWVzdGFtcCgpKTtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3RvSW50MzJQcm90byhlLCB0LmV4cGVjdGVkQ291bnQpO1xuICAgICAgICAgICAgICAgIG51bGwgIT09IHIgJiYgKG4uZXhwZWN0ZWRDb3VudCA9IHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG47XG4gICAgICAgIH0odGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV90b0xpc3RlblJlcXVlc3RMYWJlbHModGhpcy5zZXJpYWxpemVyLCBlKTtcbiAgICAgICAgbiAmJiAodC5sYWJlbHMgPSBuKSwgdGhpcy5JXyh0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVW5yZWdpc3RlcnMgaW50ZXJlc3QgaW4gdGhlIHJlc3VsdHMgb2YgdGhlIHRhcmdldCBhc3NvY2lhdGVkIHdpdGggdGhlXG4gICAgICogZ2l2ZW4gdGFyZ2V0SWQuXG4gICAgICovICAgIHdfKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHt9O1xuICAgICAgICB0LmRhdGFiYXNlID0gX19QUklWQVRFX2dldEVuY29kZWREYXRhYmFzZUlkKHRoaXMuc2VyaWFsaXplciksIHQucmVtb3ZlVGFyZ2V0ID0gZSwgXG4gICAgICAgIHRoaXMuSV8odCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgU3RyZWFtIHRoYXQgaW1wbGVtZW50cyB0aGUgV3JpdGUgUlBDLlxuICpcbiAqIFRoZSBXcml0ZSBSUEMgcmVxdWlyZXMgdGhlIGNhbGxlciB0byBtYWludGFpbiBzcGVjaWFsIHN0cmVhbVRva2VuXG4gKiBzdGF0ZSBpbiBiZXR3ZWVuIGNhbGxzLCB0byBoZWxwIHRoZSBzZXJ2ZXIgdW5kZXJzdGFuZCB3aGljaCByZXNwb25zZXMgdGhlXG4gKiBjbGllbnQgaGFzIHByb2Nlc3NlZCBieSB0aGUgdGltZSB0aGUgbmV4dCByZXF1ZXN0IGlzIG1hZGUuIEV2ZXJ5IHJlc3BvbnNlXG4gKiB3aWxsIGNvbnRhaW4gYSBzdHJlYW1Ub2tlbjsgdGhpcyB2YWx1ZSBtdXN0IGJlIHBhc3NlZCB0byB0aGUgbmV4dFxuICogcmVxdWVzdC5cbiAqXG4gKiBBZnRlciBjYWxsaW5nIHN0YXJ0KCkgb24gdGhpcyBzdHJlYW0sIHRoZSBuZXh0IHJlcXVlc3QgbXVzdCBiZSBhIGhhbmRzaGFrZSxcbiAqIGNvbnRhaW5pbmcgd2hhdGV2ZXIgc3RyZWFtVG9rZW4gaXMgb24gaGFuZC4gT25jZSBhIHJlc3BvbnNlIHRvIHRoaXNcbiAqIHJlcXVlc3QgaXMgcmVjZWl2ZWQsIGFsbCBwZW5kaW5nIG11dGF0aW9ucyBtYXkgYmUgc3VibWl0dGVkLiBXaGVuXG4gKiBzdWJtaXR0aW5nIG11bHRpcGxlIGJhdGNoZXMgb2YgbXV0YXRpb25zIGF0IHRoZSBzYW1lIHRpbWUsIGl0J3NcbiAqIG9rYXkgdG8gdXNlIHRoZSBzYW1lIHN0cmVhbVRva2VuIGZvciB0aGUgY2FsbHMgdG8gd3JpdGVNdXRhdGlvbnMuXG4gKlxuICogVE9ETyhiLzMzMjcxMjM1KTogVXNlIHByb3RvIHR5cGVzXG4gKi8gY2xhc3MgX19QUklWQVRFX1BlcnNpc3RlbnRXcml0ZVN0cmVhbSBleHRlbmRzIF9fUFJJVkFURV9QZXJzaXN0ZW50U3RyZWFtIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgICAgIHN1cGVyKGUsIFwid3JpdGVfc3RyZWFtX2Nvbm5lY3Rpb25fYmFja29mZlwiIC8qIFRpbWVySWQuV3JpdGVTdHJlYW1Db25uZWN0aW9uQmFja29mZiAqLyAsIFwid3JpdGVfc3RyZWFtX2lkbGVcIiAvKiBUaW1lcklkLldyaXRlU3RyZWFtSWRsZSAqLyAsIFwiaGVhbHRoX2NoZWNrX3RpbWVvdXRcIiAvKiBUaW1lcklkLkhlYWx0aENoZWNrVGltZW91dCAqLyAsIHQsIG4sIHIsIHMpLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gaTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhY2tzIHdoZXRoZXIgb3Igbm90IGEgaGFuZHNoYWtlIGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSBleGNoYW5nZWQgYW5kXG4gICAgICogdGhlIHN0cmVhbSBpcyByZWFkeSB0byBhY2NlcHQgbXV0YXRpb25zLlxuICAgICAqLyAgICBnZXQgU18oKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9fID4gMDtcbiAgICB9XG4gICAgLy8gT3ZlcnJpZGUgb2YgUGVyc2lzdGVudFN0cmVhbS5zdGFydFxuICAgIHN0YXJ0KCkge1xuICAgICAgICB0aGlzLmxhc3RTdHJlYW1Ub2tlbiA9IHZvaWQgMCwgc3VwZXIuc3RhcnQoKTtcbiAgICB9XG4gICAgQV8oKSB7XG4gICAgICAgIHRoaXMuU18gJiYgdGhpcy5iXyhbXSk7XG4gICAgfVxuICAgIGZfKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29ubmVjdGlvbi5XbyhcIldyaXRlXCIsIGUsIHQpO1xuICAgIH1cbiAgICBnXyhlKSB7XG4gICAgICAgIC8vIEFsd2F5cyBjYXB0dXJlIHRoZSBsYXN0IHN0cmVhbSB0b2tlbi5cbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZS5zdHJlYW1Ub2tlbiksIHRoaXMubGFzdFN0cmVhbVRva2VuID0gZS5zdHJlYW1Ub2tlbiwgXG4gICAgICAgIC8vIFRoZSBmaXJzdCByZXNwb25zZSBpcyBhbHdheXMgdGhlIGhhbmRzaGFrZSByZXNwb25zZVxuICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydCghZS53cml0ZVJlc3VsdHMgfHwgMCA9PT0gZS53cml0ZVJlc3VsdHMubGVuZ3RoKSwgdGhpcy5saXN0ZW5lci5EXygpO1xuICAgIH1cbiAgICBvbk5leHQoZSkge1xuICAgICAgICAvLyBBbHdheXMgY2FwdHVyZSB0aGUgbGFzdCBzdHJlYW0gdG9rZW4uXG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KCEhZS5zdHJlYW1Ub2tlbiksIHRoaXMubGFzdFN0cmVhbVRva2VuID0gZS5zdHJlYW1Ub2tlbiwgXG4gICAgICAgIC8vIEEgc3VjY2Vzc2Z1bCBmaXJzdCB3cml0ZSByZXNwb25zZSBtZWFucyB0aGUgc3RyZWFtIGlzIGhlYWx0aHksXG4gICAgICAgIC8vIE5vdGUsIHRoYXQgd2UgY291bGQgY29uc2lkZXIgYSBzdWNjZXNzZnVsIGhhbmRzaGFrZSBoZWFsdGh5LCBob3dldmVyLFxuICAgICAgICAvLyB0aGUgd3JpdGUgaXRzZWxmIG1pZ2h0IGJlIGNhdXNpbmcgYW4gZXJyb3Igd2Ugd2FudCB0byBiYWNrIG9mZiBmcm9tLlxuICAgICAgICB0aGlzLmFfLnJlc2V0KCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZnJvbVdyaXRlUmVzdWx0cyhlLndyaXRlUmVzdWx0cywgZS5jb21taXRUaW1lKSwgbiA9IF9fUFJJVkFURV9mcm9tVmVyc2lvbihlLmNvbW1pdFRpbWUpO1xuICAgICAgICByZXR1cm4gdGhpcy5saXN0ZW5lci52XyhuLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VuZHMgYW4gaW5pdGlhbCBzdHJlYW1Ub2tlbiB0byB0aGUgc2VydmVyLCBwZXJmb3JtaW5nIHRoZSBoYW5kc2hha2VcbiAgICAgKiByZXF1aXJlZCB0byBtYWtlIHRoZSBTdHJlYW1pbmdXcml0ZSBSUEMgd29yay4gU3Vic2VxdWVudFxuICAgICAqIGNhbGxzIHNob3VsZCB3YWl0IHVudGlsIG9uSGFuZHNoYWtlQ29tcGxldGUgd2FzIGNhbGxlZC5cbiAgICAgKi8gICAgQ18oKSB7XG4gICAgICAgIC8vIFRPRE8oZGltb25kKTogU3VwcG9ydCBzdHJlYW0gcmVzdW1wdGlvbi4gV2UgaW50ZW50aW9uYWxseSBkbyBub3Qgc2V0IHRoZVxuICAgICAgICAvLyBzdHJlYW0gdG9rZW4gb24gdGhlIGhhbmRzaGFrZSwgaWdub3JpbmcgYW55IHN0cmVhbSB0b2tlbiB3ZSBtaWdodCBoYXZlLlxuICAgICAgICBjb25zdCBlID0ge307XG4gICAgICAgIGUuZGF0YWJhc2UgPSBfX1BSSVZBVEVfZ2V0RW5jb2RlZERhdGFiYXNlSWQodGhpcy5zZXJpYWxpemVyKSwgdGhpcy5JXyhlKTtcbiAgICB9XG4gICAgLyoqIFNlbmRzIGEgZ3JvdXAgb2YgbXV0YXRpb25zIHRvIHRoZSBGaXJlc3RvcmUgYmFja2VuZCB0byBhcHBseS4gKi8gICAgYl8oZSkge1xuICAgICAgICBjb25zdCB0ID0ge1xuICAgICAgICAgICAgc3RyZWFtVG9rZW46IHRoaXMubGFzdFN0cmVhbVRva2VuLFxuICAgICAgICAgICAgd3JpdGVzOiBlLm1hcCgoZSA9PiB0b011dGF0aW9uKHRoaXMuc2VyaWFsaXplciwgZSkpKVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLklfKHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRGF0YXN0b3JlIGFuZCBpdHMgcmVsYXRlZCBtZXRob2RzIGFyZSBhIHdyYXBwZXIgYXJvdW5kIHRoZSBleHRlcm5hbCBHb29nbGVcbiAqIENsb3VkIERhdGFzdG9yZSBncnBjIEFQSSwgd2hpY2ggcHJvdmlkZXMgYW4gaW50ZXJmYWNlIHRoYXQgaXMgbW9yZSBjb252ZW5pZW50XG4gKiBmb3IgdGhlIHJlc3Qgb2YgdGhlIGNsaWVudCBTREsgYXJjaGl0ZWN0dXJlIHRvIGNvbnN1bWUuXG4gKi8gY2xhc3MgRGF0YXN0b3JlIHt9XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgRGF0YXN0b3JlIHRoYXQgZXhwb3NlcyBhZGRpdGlvbmFsIHN0YXRlIGZvciBpbnRlcm5hbFxuICogY29uc3VtcHRpb24uXG4gKi8gY2xhc3MgX19QUklWQVRFX0RhdGFzdG9yZUltcGwgZXh0ZW5kcyBEYXRhc3RvcmUge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5hdXRoQ3JlZGVudGlhbHMgPSBlLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMgPSB0LCB0aGlzLmNvbm5lY3Rpb24gPSBuLCBcbiAgICAgICAgdGhpcy5zZXJpYWxpemVyID0gciwgdGhpcy5GXyA9ICExO1xuICAgIH1cbiAgICBNXygpIHtcbiAgICAgICAgaWYgKHRoaXMuRl8pIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIH1cbiAgICAvKiogSW52b2tlcyB0aGUgcHJvdmlkZWQgUlBDIHdpdGggYXV0aCBhbmQgQXBwQ2hlY2sgdG9rZW5zLiAqLyAgICBTbyhlLCB0LCBuLCByKSB7XG4gICAgICAgIHJldHVybiB0aGlzLk1fKCksIFByb21pc2UuYWxsKFsgdGhpcy5hdXRoQ3JlZGVudGlhbHMuZ2V0VG9rZW4oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLmdldFRva2VuKCkgXSkudGhlbigoKFtpLCBzXSkgPT4gdGhpcy5jb25uZWN0aW9uLlNvKGUsIF9fUFJJVkFURV90b1Jlc291cmNlUGF0aCh0LCBuKSwgciwgaSwgcykpKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aHJvdyBcIkZpcmViYXNlRXJyb3JcIiA9PT0gZS5uYW1lID8gKGUuY29kZSA9PT0gQy5VTkFVVEhFTlRJQ0FURUQgJiYgKHRoaXMuYXV0aENyZWRlbnRpYWxzLmludmFsaWRhdGVUb2tlbigpLCBcbiAgICAgICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSksIGUpIDogbmV3IEZpcmVzdG9yZUVycm9yKEMuVU5LTk9XTiwgZS50b1N0cmluZygpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKiogSW52b2tlcyB0aGUgcHJvdmlkZWQgUlBDIHdpdGggc3RyZWFtZWQgcmVzdWx0cyB3aXRoIGF1dGggYW5kIEFwcENoZWNrIHRva2Vucy4gKi8gICAgQ28oZSwgdCwgbiwgciwgaSkge1xuICAgICAgICByZXR1cm4gdGhpcy5NXygpLCBQcm9taXNlLmFsbChbIHRoaXMuYXV0aENyZWRlbnRpYWxzLmdldFRva2VuKCksIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscy5nZXRUb2tlbigpIF0pLnRoZW4oKChbcywgb10pID0+IHRoaXMuY29ubmVjdGlvbi5DbyhlLCBfX1BSSVZBVEVfdG9SZXNvdXJjZVBhdGgodCwgbiksIHIsIHMsIG8sIGkpKSkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgdGhyb3cgXCJGaXJlYmFzZUVycm9yXCIgPT09IGUubmFtZSA/IChlLmNvZGUgPT09IEMuVU5BVVRIRU5USUNBVEVEICYmICh0aGlzLmF1dGhDcmVkZW50aWFscy5pbnZhbGlkYXRlVG9rZW4oKSwgXG4gICAgICAgICAgICB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuaW52YWxpZGF0ZVRva2VuKCkpLCBlKSA6IG5ldyBGaXJlc3RvcmVFcnJvcihDLlVOS05PV04sIGUudG9TdHJpbmcoKSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgdGVybWluYXRlKCkge1xuICAgICAgICB0aGlzLkZfID0gITAsIHRoaXMuY29ubmVjdGlvbi50ZXJtaW5hdGUoKTtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JleHApOiBNYWtlIHN1cmUgdGhlcmUgaXMgb25seSBvbmUgRGF0YXN0b3JlIGluc3RhbmNlIHBlclxuLy8gZmlyZXN0b3JlLWV4cCBjbGllbnQuXG4vKipcbiAqIEEgY29tcG9uZW50IHVzZWQgYnkgdGhlIFJlbW90ZVN0b3JlIHRvIHRyYWNrIHRoZSBPbmxpbmVTdGF0ZSAodGhhdCBpcyxcbiAqIHdoZXRoZXIgb3Igbm90IHRoZSBjbGllbnQgYXMgYSB3aG9sZSBzaG91bGQgYmUgY29uc2lkZXJlZCB0byBiZSBvbmxpbmUgb3JcbiAqIG9mZmxpbmUpLCBpbXBsZW1lbnRpbmcgdGhlIGFwcHJvcHJpYXRlIGhldXJpc3RpY3MuXG4gKlxuICogSW4gcGFydGljdWxhciwgd2hlbiB0aGUgY2xpZW50IGlzIHRyeWluZyB0byBjb25uZWN0IHRvIHRoZSBiYWNrZW5kLCB3ZVxuICogYWxsb3cgdXAgdG8gTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUyB3aXRoaW4gT05MSU5FX1NUQVRFX1RJTUVPVVRfTVMgZm9yXG4gKiBhIGNvbm5lY3Rpb24gdG8gc3VjY2VlZC4gSWYgd2UgaGF2ZSB0b28gbWFueSBmYWlsdXJlcyBvciB0aGUgdGltZW91dCBlbGFwc2VzLFxuICogdGhlbiB3ZSBzZXQgdGhlIE9ubGluZVN0YXRlIHRvIE9mZmxpbmUsIGFuZCB0aGUgY2xpZW50IHdpbGwgYmVoYXZlIGFzIGlmXG4gKiBpdCBpcyBvZmZsaW5lIChnZXQoKXMgd2lsbCByZXR1cm4gY2FjaGVkIGRhdGEsIGV0Yy4pLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfT25saW5lU3RhdGVUcmFja2VyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHRoaXMuYXN5bmNRdWV1ZSA9IGUsIHRoaXMub25saW5lU3RhdGVIYW5kbGVyID0gdCwgXG4gICAgICAgIC8qKiBUaGUgY3VycmVudCBPbmxpbmVTdGF0ZS4gKi9cbiAgICAgICAgdGhpcy5zdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgY291bnQgb2YgY29uc2VjdXRpdmUgZmFpbHVyZXMgdG8gb3BlbiB0aGUgc3RyZWFtLiBJZiBpdCByZWFjaGVzIHRoZVxuICAgICAgICAgKiBtYXhpbXVtIGRlZmluZWQgYnkgTUFYX1dBVENIX1NUUkVBTV9GQUlMVVJFUywgd2UnbGwgc2V0IHRoZSBPbmxpbmVTdGF0ZSB0b1xuICAgICAgICAgKiBPZmZsaW5lLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy54XyA9IDAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogQSB0aW1lciB0aGF0IGVsYXBzZXMgYWZ0ZXIgT05MSU5FX1NUQVRFX1RJTUVPVVRfTVMsIGF0IHdoaWNoIHBvaW50IHdlXG4gICAgICAgICAqIHRyYW5zaXRpb24gZnJvbSBPbmxpbmVTdGF0ZS5Vbmtub3duIHRvIE9ubGluZVN0YXRlLk9mZmxpbmUgd2l0aG91dCB3YWl0aW5nXG4gICAgICAgICAqIGZvciB0aGUgc3RyZWFtIHRvIGFjdHVhbGx5IGZhaWwgKE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMgdGltZXMpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5PXyA9IG51bGwsIFxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciB0aGUgY2xpZW50IHNob3VsZCBsb2cgYSB3YXJuaW5nIG1lc3NhZ2UgaWYgaXQgZmFpbHMgdG8gY29ubmVjdCB0b1xuICAgICAgICAgKiB0aGUgYmFja2VuZCAoaW5pdGlhbGx5IHRydWUsIGNsZWFyZWQgYWZ0ZXIgYSBzdWNjZXNzZnVsIHN0cmVhbSwgb3IgaWYgd2UndmVcbiAgICAgICAgICogbG9nZ2VkIHRoZSBtZXNzYWdlIGFscmVhZHkpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5OXyA9ICEwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxsZWQgYnkgUmVtb3RlU3RvcmUgd2hlbiBhIHdhdGNoIHN0cmVhbSBpcyBzdGFydGVkIChpbmNsdWRpbmcgb24gZWFjaFxuICAgICAqIGJhY2tvZmYgYXR0ZW1wdCkuXG4gICAgICpcbiAgICAgKiBJZiB0aGlzIGlzIHRoZSBmaXJzdCBhdHRlbXB0LCBpdCBzZXRzIHRoZSBPbmxpbmVTdGF0ZSB0byBVbmtub3duIGFuZCBzdGFydHNcbiAgICAgKiB0aGUgb25saW5lU3RhdGVUaW1lci5cbiAgICAgKi8gICAgQl8oKSB7XG4gICAgICAgIDAgPT09IHRoaXMueF8gJiYgKHRoaXMuTF8oXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyksIHRoaXMuT18gPSB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFmdGVyRGVsYXkoXCJvbmxpbmVfc3RhdGVfdGltZW91dFwiIC8qIFRpbWVySWQuT25saW5lU3RhdGVUaW1lb3V0ICovICwgMWU0LCAoKCkgPT4gKHRoaXMuT18gPSBudWxsLCBcbiAgICAgICAgdGhpcy5rXyhcIkJhY2tlbmQgZGlkbid0IHJlc3BvbmQgd2l0aGluIDEwIHNlY29uZHMuXCIpLCB0aGlzLkxfKFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8pLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIG91ciBPbmxpbmVTdGF0ZSBhcyBhcHByb3ByaWF0ZSBhZnRlciB0aGUgd2F0Y2ggc3RyZWFtIHJlcG9ydHMgYVxuICAgICAqIGZhaWx1cmUuIFRoZSBmaXJzdCBmYWlsdXJlIG1vdmVzIHVzIHRvIHRoZSAnVW5rbm93bicgc3RhdGUuIFdlIHRoZW4gbWF5XG4gICAgICogYWxsb3cgbXVsdGlwbGUgZmFpbHVyZXMgKGJhc2VkIG9uIE1BWF9XQVRDSF9TVFJFQU1fRkFJTFVSRVMpIGJlZm9yZSB3ZVxuICAgICAqIGFjdHVhbGx5IHRyYW5zaXRpb24gdG8gdGhlICdPZmZsaW5lJyBzdGF0ZS5cbiAgICAgKi8gICAgcV8oZSkge1xuICAgICAgICBcIk9ubGluZVwiIC8qIE9ubGluZVN0YXRlLk9ubGluZSAqLyA9PT0gdGhpcy5zdGF0ZSA/IHRoaXMuTF8oXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLykgOiAodGhpcy54XysrLCBcbiAgICAgICAgdGhpcy54XyA+PSAxICYmICh0aGlzLlFfKCksIHRoaXMua18oYENvbm5lY3Rpb24gZmFpbGVkIDEgdGltZXMuIE1vc3QgcmVjZW50IGVycm9yOiAke2UudG9TdHJpbmcoKX1gKSwgXG4gICAgICAgIHRoaXMuTF8oXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLykpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhwbGljaXRseSBzZXRzIHRoZSBPbmxpbmVTdGF0ZSB0byB0aGUgc3BlY2lmaWVkIHN0YXRlLlxuICAgICAqXG4gICAgICogTm90ZSB0aGF0IHRoaXMgcmVzZXRzIG91ciB0aW1lcnMgLyBmYWlsdXJlIGNvdW50ZXJzLCBldGMuIHVzZWQgYnkgb3VyXG4gICAgICogT2ZmbGluZSBoZXVyaXN0aWNzLCBzbyBtdXN0IG5vdCBiZSB1c2VkIGluIHBsYWNlIG9mXG4gICAgICogaGFuZGxlV2F0Y2hTdHJlYW1TdGFydCgpIGFuZCBoYW5kbGVXYXRjaFN0cmVhbUZhaWx1cmUoKS5cbiAgICAgKi8gICAgc2V0KGUpIHtcbiAgICAgICAgdGhpcy5RXygpLCB0aGlzLnhfID0gMCwgXCJPbmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PbmxpbmUgKi8gPT09IGUgJiYgKFxuICAgICAgICAvLyBXZSd2ZSBjb25uZWN0ZWQgdG8gd2F0Y2ggYXQgbGVhc3Qgb25jZS4gRG9uJ3Qgd2FybiB0aGUgZGV2ZWxvcGVyXG4gICAgICAgIC8vIGFib3V0IGJlaW5nIG9mZmxpbmUgZ29pbmcgZm9yd2FyZC5cbiAgICAgICAgdGhpcy5OXyA9ICExKSwgdGhpcy5MXyhlKTtcbiAgICB9XG4gICAgTF8oZSkge1xuICAgICAgICBlICE9PSB0aGlzLnN0YXRlICYmICh0aGlzLnN0YXRlID0gZSwgdGhpcy5vbmxpbmVTdGF0ZUhhbmRsZXIoZSkpO1xuICAgIH1cbiAgICBrXyhlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBgQ291bGQgbm90IHJlYWNoIENsb3VkIEZpcmVzdG9yZSBiYWNrZW5kLiAke2V9XFxuVGhpcyB0eXBpY2FsbHkgaW5kaWNhdGVzIHRoYXQgeW91ciBkZXZpY2UgZG9lcyBub3QgaGF2ZSBhIGhlYWx0aHkgSW50ZXJuZXQgY29ubmVjdGlvbiBhdCB0aGUgbW9tZW50LiBUaGUgY2xpZW50IHdpbGwgb3BlcmF0ZSBpbiBvZmZsaW5lIG1vZGUgdW50aWwgaXQgaXMgYWJsZSB0byBzdWNjZXNzZnVsbHkgY29ubmVjdCB0byB0aGUgYmFja2VuZC5gO1xuICAgICAgICB0aGlzLk5fID8gKF9fUFJJVkFURV9sb2dFcnJvcih0KSwgdGhpcy5OXyA9ICExKSA6IF9fUFJJVkFURV9sb2dEZWJ1ZyhcIk9ubGluZVN0YXRlVHJhY2tlclwiLCB0KTtcbiAgICB9XG4gICAgUV8oKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMuT18gJiYgKHRoaXMuT18uY2FuY2VsKCksIHRoaXMuT18gPSBudWxsKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IHp0ID0gXCJSZW1vdGVTdG9yZVwiO1xuXG4vLyBUT0RPKGIvMzU4NTM0MDIpOiBOZWdvdGlhdGUgdGhpcyB3aXRoIHRoZSBzdHJlYW0uXG5jbGFzcyBfX1BSSVZBVEVfUmVtb3RlU3RvcmVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgbG9jYWwgc3RvcmUsIHVzZWQgdG8gZmlsbCB0aGUgd3JpdGUgcGlwZWxpbmUgd2l0aCBvdXRib3VuZCBtdXRhdGlvbnMuXG4gICAgICovXG4gICAgZSwgXG4gICAgLyoqIFRoZSBjbGllbnQtc2lkZSBwcm94eSBmb3IgaW50ZXJhY3Rpbmcgd2l0aCB0aGUgYmFja2VuZC4gKi9cbiAgICB0LCBuLCByLCBpKSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSA9IGUsIHRoaXMuZGF0YXN0b3JlID0gdCwgdGhpcy5hc3luY1F1ZXVlID0gbiwgdGhpcy5yZW1vdGVTeW5jZXIgPSB7fSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIGxpc3Qgb2YgdXAgdG8gTUFYX1BFTkRJTkdfV1JJVEVTIHdyaXRlcyB0aGF0IHdlIGhhdmUgZmV0Y2hlZCBmcm9tIHRoZVxuICAgICAgICAgKiBMb2NhbFN0b3JlIHZpYSBmaWxsV3JpdGVQaXBlbGluZSgpIGFuZCBoYXZlIG9yIHdpbGwgc2VuZCB0byB0aGUgd3JpdGVcbiAgICAgICAgICogc3RyZWFtLlxuICAgICAgICAgKlxuICAgICAgICAgKiBXaGVuZXZlciB3cml0ZVBpcGVsaW5lLmxlbmd0aCA+IDAgdGhlIFJlbW90ZVN0b3JlIHdpbGwgYXR0ZW1wdCB0byBzdGFydCBvclxuICAgICAgICAgKiByZXN0YXJ0IHRoZSB3cml0ZSBzdHJlYW0uIFdoZW4gdGhlIHN0cmVhbSBpcyBlc3RhYmxpc2hlZCB0aGUgd3JpdGVzIGluIHRoZVxuICAgICAgICAgKiBwaXBlbGluZSB3aWxsIGJlIHNlbnQgaW4gb3JkZXIuXG4gICAgICAgICAqXG4gICAgICAgICAqIFdyaXRlcyByZW1haW4gaW4gd3JpdGVQaXBlbGluZSB1bnRpbCB0aGV5IGFyZSBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmRcbiAgICAgICAgICogYW5kIHRodXMgd2lsbCBhdXRvbWF0aWNhbGx5IGJlIHJlLXNlbnQgaWYgdGhlIHN0cmVhbSBpcyBpbnRlcnJ1cHRlZCAvXG4gICAgICAgICAqIHJlc3RhcnRlZCBiZWZvcmUgdGhleSdyZSBhY2tub3dsZWRnZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFdyaXRlIHJlc3BvbnNlcyBmcm9tIHRoZSBiYWNrZW5kIGFyZSBsaW5rZWQgdG8gdGhlaXIgb3JpZ2luYXRpbmcgcmVxdWVzdFxuICAgICAgICAgKiBwdXJlbHkgYmFzZWQgb24gb3JkZXIsIGFuZCBzbyB3ZSBjYW4ganVzdCBzaGlmdCgpIHdyaXRlcyBmcm9tIHRoZSBmcm9udCBvZlxuICAgICAgICAgKiB0aGUgd3JpdGVQaXBlbGluZSBhcyB3ZSByZWNlaXZlIHJlc3BvbnNlcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuVV8gPSBbXSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIG1hcHBpbmcgb2Ygd2F0Y2hlZCB0YXJnZXRzIHRoYXQgdGhlIGNsaWVudCBjYXJlcyBhYm91dCB0cmFja2luZyBhbmQgdGhlXG4gICAgICAgICAqIHVzZXIgaGFzIGV4cGxpY2l0bHkgY2FsbGVkIGEgJ2xpc3RlbicgZm9yIHRoaXMgdGFyZ2V0LlxuICAgICAgICAgKlxuICAgICAgICAgKiBUaGVzZSB0YXJnZXRzIG1heSBvciBtYXkgbm90IGhhdmUgYmVlbiBzZW50IHRvIG9yIGFja25vd2xlZGdlZCBieSB0aGVcbiAgICAgICAgICogc2VydmVyLiBPbiByZS1lc3RhYmxpc2hpbmcgdGhlIGxpc3RlbiBzdHJlYW0sIHRoZXNlIHRhcmdldHMgc2hvdWxkIGJlIHNlbnRcbiAgICAgICAgICogdG8gdGhlIHNlcnZlci4gVGhlIHRhcmdldHMgcmVtb3ZlZCB3aXRoIHVubGlzdGVucyBhcmUgcmVtb3ZlZCBlYWdlcmx5XG4gICAgICAgICAqIHdpdGhvdXQgd2FpdGluZyBmb3IgY29uZmlybWF0aW9uIGZyb20gdGhlIGxpc3RlbiBzdHJlYW0uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLktfID0gbmV3IE1hcCwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHNldCBvZiByZWFzb25zIGZvciB3aHkgdGhlIFJlbW90ZVN0b3JlIG1heSBiZSBvZmZsaW5lLiBJZiBlbXB0eSwgdGhlXG4gICAgICAgICAqIFJlbW90ZVN0b3JlIG1heSBzdGFydCBpdHMgbmV0d29yayBjb25uZWN0aW9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuV18gPSBuZXcgU2V0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEV2ZW50IGhhbmRsZXJzIHRoYXQgZ2V0IGNhbGxlZCB3aGVuIHRoZSBuZXR3b3JrIGlzIGRpc2FibGVkIG9yIGVuYWJsZWQuXG4gICAgICAgICAqXG4gICAgICAgICAqIFBPUlRJTkcgTk9URTogVGhlc2UgZnVuY3Rpb25zIGFyZSB1c2VkIG9uIHRoZSBXZWIgY2xpZW50IHRvIGNyZWF0ZSB0aGVcbiAgICAgICAgICogdW5kZXJseWluZyBzdHJlYW1zICh0byBzdXBwb3J0IHRyZWUtc2hha2VhYmxlIHN0cmVhbXMpLiBPbiBBbmRyb2lkIGFuZCBpT1MsXG4gICAgICAgICAqIHRoZSBzdHJlYW1zIGFyZSBjcmVhdGVkIGR1cmluZyBjb25zdHJ1Y3Rpb24gb2YgUmVtb3RlU3RvcmUuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLkdfID0gW10sIHRoaXMuel8gPSBpLCB0aGlzLnpfLlRvKChlID0+IHtcbiAgICAgICAgICAgIG4uZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFBvcnRpbmcgTm90ZTogVW5saWtlIGlPUywgYHJlc3RhcnROZXR3b3JrKClgIGlzIGNhbGxlZCBldmVuIHdoZW4gdGhlXG4gICAgICAgICAgICAgICAgLy8gbmV0d29yayBiZWNvbWVzIHVucmVhY2hhYmxlIGFzIHdlIGRvbid0IGhhdmUgYW55IG90aGVyIHdheSB0byB0ZWFyXG4gICAgICAgICAgICAgICAgLy8gZG93biBvdXIgc3RyZWFtcy5cbiAgICAgICAgICAgICAgICBfX1BSSVZBVEVfY2FuVXNlTmV0d29yayh0aGlzKSAmJiAoX19QUklWQVRFX2xvZ0RlYnVnKHp0LCBcIlJlc3RhcnRpbmcgc3RyZWFtcyBmb3IgbmV0d29yayByZWFjaGFiaWxpdHkgY2hhbmdlLlwiKSwgXG4gICAgICAgICAgICAgICAgYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3Jlc3RhcnROZXR3b3JrKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICAgICAgICAgIHQuV18uYWRkKDQgLyogT2ZmbGluZUNhdXNlLkNvbm5lY3Rpdml0eUNoYW5nZSAqLyksIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKHQpLCBcbiAgICAgICAgICAgICAgICAgICAgdC5qXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyksIHQuV18uZGVsZXRlKDQgLyogT2ZmbGluZUNhdXNlLkNvbm5lY3Rpdml0eUNoYW5nZSAqLyksIFxuICAgICAgICAgICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZW5hYmxlTmV0d29ya0ludGVybmFsKHQpO1xuICAgICAgICAgICAgICAgIH0odGhpcykpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9KSksIHRoaXMual8gPSBuZXcgX19QUklWQVRFX09ubGluZVN0YXRlVHJhY2tlcihuLCByKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9lbmFibGVOZXR3b3JrSW50ZXJuYWwoZSkge1xuICAgIGlmIChfX1BSSVZBVEVfY2FuVXNlTmV0d29yayhlKSkgZm9yIChjb25zdCB0IG9mIGUuR18pIGF3YWl0IHQoLyogZW5hYmxlZD0gKi8gITApO1xufVxuXG4vKipcbiAqIFRlbXBvcmFyaWx5IGRpc2FibGVzIHRoZSBuZXR3b3JrLiBUaGUgbmV0d29yayBjYW4gYmUgcmUtZW5hYmxlZCB1c2luZ1xuICogZW5hYmxlTmV0d29yaygpLlxuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKGUpIHtcbiAgICBmb3IgKGNvbnN0IHQgb2YgZS5HXykgYXdhaXQgdCgvKiBlbmFibGVkPSAqLyAhMSk7XG59XG5cbi8qKlxuICogU3RhcnRzIG5ldyBsaXN0ZW4gZm9yIHRoZSBnaXZlbiB0YXJnZXQuIFVzZXMgcmVzdW1lIHRva2VuIGlmIHByb3ZpZGVkLiBJdFxuICogaXMgYSBuby1vcCBpZiB0aGUgdGFyZ2V0IG9mIGdpdmVuIGBUYXJnZXREYXRhYCBpcyBhbHJlYWR5IGJlaW5nIGxpc3RlbmVkIHRvLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVMaXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIG4uS18uaGFzKHQudGFyZ2V0SWQpIHx8IChcbiAgICAvLyBNYXJrIHRoaXMgYXMgc29tZXRoaW5nIHRoZSBjbGllbnQgaXMgY3VycmVudGx5IGxpc3RlbmluZyBmb3IuXG4gICAgbi5LXy5zZXQodC50YXJnZXRJZCwgdCksIF9fUFJJVkFURV9zaG91bGRTdGFydFdhdGNoU3RyZWFtKG4pID8gXG4gICAgLy8gVGhlIGxpc3RlbiB3aWxsIGJlIHNlbnQgaW4gb25XYXRjaFN0cmVhbU9wZW5cbiAgICBfX1BSSVZBVEVfc3RhcnRXYXRjaFN0cmVhbShuKSA6IF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShuKS5jXygpICYmIF9fUFJJVkFURV9zZW5kV2F0Y2hSZXF1ZXN0KG4sIHQpKTtcbn1cblxuLyoqXG4gKiBSZW1vdmVzIHRoZSBsaXN0ZW4gZnJvbSBzZXJ2ZXIuIEl0IGlzIGEgbm8tb3AgaWYgdGhlIGdpdmVuIHRhcmdldCBpZCBpc1xuICogbm90IGJlaW5nIGxpc3RlbmVkIHRvLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZVVubGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShuKTtcbiAgICBuLktfLmRlbGV0ZSh0KSwgci5jXygpICYmIF9fUFJJVkFURV9zZW5kVW53YXRjaFJlcXVlc3QobiwgdCksIDAgPT09IG4uS18uc2l6ZSAmJiAoci5jXygpID8gci5QXygpIDogX19QUklWQVRFX2NhblVzZU5ldHdvcmsobikgJiYgXG4gICAgLy8gUmV2ZXJ0IHRvIE9ubGluZVN0YXRlLlVua25vd24gaWYgdGhlIHdhdGNoIHN0cmVhbSBpcyBub3Qgb3BlbiBhbmQgd2VcbiAgICAvLyBoYXZlIG5vIGxpc3RlbmVycywgc2luY2Ugd2l0aG91dCBhbnkgbGlzdGVucyB0byBzZW5kIHdlIGNhbm5vdFxuICAgIC8vIGNvbmZpcm0gaWYgdGhlIHN0cmVhbSBpcyBoZWFsdGh5IGFuZCB1cGdyYWRlIHRvIE9ubGluZVN0YXRlLk9ubGluZS5cbiAgICBuLmpfLnNldChcIlVua25vd25cIiAvKiBPbmxpbmVTdGF0ZS5Vbmtub3duICovKSk7XG59XG5cbi8qKlxuICogV2UgbmVlZCB0byBpbmNyZW1lbnQgdGhlIGV4cGVjdGVkIG51bWJlciBvZiBwZW5kaW5nIHJlc3BvbnNlcyB3ZSdyZSBkdWVcbiAqIGZyb20gd2F0Y2ggc28gd2Ugd2FpdCBmb3IgdGhlIGFjayB0byBwcm9jZXNzIGFueSBtZXNzYWdlcyBmcm9tIHRoaXMgdGFyZ2V0LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zZW5kV2F0Y2hSZXF1ZXN0KGUsIHQpIHtcbiAgICBpZiAoZS5IXy5OZSh0LnRhcmdldElkKSwgdC5yZXN1bWVUb2tlbi5hcHByb3hpbWF0ZUJ5dGVTaXplKCkgPiAwIHx8IHQuc25hcHNob3RWZXJzaW9uLmNvbXBhcmVUbyhTbmFwc2hvdFZlcnNpb24ubWluKCkpID4gMCkge1xuICAgICAgICBjb25zdCBuID0gZS5yZW1vdGVTeW5jZXIuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCh0LnRhcmdldElkKS5zaXplO1xuICAgICAgICB0ID0gdC53aXRoRXhwZWN0ZWRDb3VudChuKTtcbiAgICB9XG4gICAgX19QUklWQVRFX2Vuc3VyZVdhdGNoU3RyZWFtKGUpLnlfKHQpO1xufVxuXG4vKipcbiAqIFdlIG5lZWQgdG8gaW5jcmVtZW50IHRoZSBleHBlY3RlZCBudW1iZXIgb2YgcGVuZGluZyByZXNwb25zZXMgd2UncmUgZHVlXG4gKiBmcm9tIHdhdGNoIHNvIHdlIHdhaXQgZm9yIHRoZSByZW1vdmFsIG9uIHRoZSBzZXJ2ZXIgYmVmb3JlIHdlIHByb2Nlc3MgYW55XG4gKiBtZXNzYWdlcyBmcm9tIHRoaXMgdGFyZ2V0LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zZW5kVW53YXRjaFJlcXVlc3QoZSwgdCkge1xuICAgIGUuSF8uTmUodCksIF9fUFJJVkFURV9lbnN1cmVXYXRjaFN0cmVhbShlKS53Xyh0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3N0YXJ0V2F0Y2hTdHJlYW0oZSkge1xuICAgIGUuSF8gPSBuZXcgX19QUklWQVRFX1dhdGNoQ2hhbmdlQWdncmVnYXRvcih7XG4gICAgICAgIGdldFJlbW90ZUtleXNGb3JUYXJnZXQ6IHQgPT4gZS5yZW1vdGVTeW5jZXIuZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCh0KSxcbiAgICAgICAgbHQ6IHQgPT4gZS5LXy5nZXQodCkgfHwgbnVsbCxcbiAgICAgICAgaXQ6ICgpID0+IGUuZGF0YXN0b3JlLnNlcmlhbGl6ZXIuZGF0YWJhc2VJZFxuICAgIH0pLCBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hTdHJlYW0oZSkuc3RhcnQoKSwgZS5qXy5CXygpO1xufVxuXG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGUgd2F0Y2ggc3RyZWFtIHNob3VsZCBiZSBzdGFydGVkIGJlY2F1c2UgaXQncyBuZWNlc3NhcnlcbiAqIGFuZCBoYXMgbm90IHlldCBiZWVuIHN0YXJ0ZWQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3Nob3VsZFN0YXJ0V2F0Y2hTdHJlYW0oZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfY2FuVXNlTmV0d29yayhlKSAmJiAhX19QUklWQVRFX2Vuc3VyZVdhdGNoU3RyZWFtKGUpLnVfKCkgJiYgZS5LXy5zaXplID4gMDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2NhblVzZU5ldHdvcmsoZSkge1xuICAgIHJldHVybiAwID09PSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLldfLnNpemU7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jbGVhblVwV2F0Y2hTdHJlYW1TdGF0ZShlKSB7XG4gICAgZS5IXyA9IHZvaWQgMDtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV2F0Y2hTdHJlYW1Db25uZWN0ZWQoZSkge1xuICAgIC8vIE1hcmsgdGhlIGNsaWVudCBhcyBvbmxpbmUgc2luY2Ugd2UgZ290IGEgXCJjb25uZWN0ZWRcIiBub3RpZmljYXRpb24uXG4gICAgZS5qXy5zZXQoXCJPbmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PbmxpbmUgKi8pO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbU9wZW4oZSkge1xuICAgIGUuS18uZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgX19QUklWQVRFX3NlbmRXYXRjaFJlcXVlc3QoZSwgdCk7XG4gICAgfSkpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbUNsb3NlKGUsIHQpIHtcbiAgICBfX1BSSVZBVEVfY2xlYW5VcFdhdGNoU3RyZWFtU3RhdGUoZSksIFxuICAgIC8vIElmIHdlIHN0aWxsIG5lZWQgdGhlIHdhdGNoIHN0cmVhbSwgcmV0cnkgdGhlIGNvbm5lY3Rpb24uXG4gICAgX19QUklWQVRFX3Nob3VsZFN0YXJ0V2F0Y2hTdHJlYW0oZSkgPyAoZS5qXy5xXyh0KSwgX19QUklWQVRFX3N0YXJ0V2F0Y2hTdHJlYW0oZSkpIDogXG4gICAgLy8gTm8gbmVlZCB0byByZXN0YXJ0IHdhdGNoIHN0cmVhbSBiZWNhdXNlIHRoZXJlIGFyZSBubyBhY3RpdmUgdGFyZ2V0cy5cbiAgICAvLyBUaGUgb25saW5lIHN0YXRlIGlzIHNldCB0byB1bmtub3duIGJlY2F1c2UgdGhlcmUgaXMgbm8gYWN0aXZlIGF0dGVtcHRcbiAgICAvLyBhdCBlc3RhYmxpc2hpbmcgYSBjb25uZWN0aW9uXG4gICAgZS5qXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9vbldhdGNoU3RyZWFtQ2hhbmdlKGUsIHQsIG4pIHtcbiAgICBpZiAoXG4gICAgLy8gTWFyayB0aGUgY2xpZW50IGFzIG9ubGluZSBzaW5jZSB3ZSBnb3QgYSBtZXNzYWdlIGZyb20gdGhlIHNlcnZlclxuICAgIGUual8uc2V0KFwiT25saW5lXCIgLyogT25saW5lU3RhdGUuT25saW5lICovKSwgdCBpbnN0YW5jZW9mIF9fUFJJVkFURV9XYXRjaFRhcmdldENoYW5nZSAmJiAyIC8qIFdhdGNoVGFyZ2V0Q2hhbmdlU3RhdGUuUmVtb3ZlZCAqLyA9PT0gdC5zdGF0ZSAmJiB0LmNhdXNlKSBcbiAgICAvLyBUaGVyZSB3YXMgYW4gZXJyb3Igb24gYSB0YXJnZXQsIGRvbid0IHdhaXQgZm9yIGEgY29uc2lzdGVudCBzbmFwc2hvdFxuICAgIC8vIHRvIHJhaXNlIGV2ZW50c1xuICAgIHRyeSB7XG4gICAgICAgIC8qKiBIYW5kbGVzIGFuIGVycm9yIG9uIGEgdGFyZ2V0ICovXG4gICAgICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9oYW5kbGVUYXJnZXRFcnJvcihlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdC5jYXVzZTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgciBvZiB0LnRhcmdldElkcykgXG4gICAgICAgICAgICAvLyBBIHdhdGNoZWQgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkuXG4gICAgICAgICAgICBlLktfLmhhcyhyKSAmJiAoYXdhaXQgZS5yZW1vdGVTeW5jZXIucmVqZWN0TGlzdGVuKHIsIG4pLCBlLktfLmRlbGV0ZShyKSwgZS5IXy5yZW1vdmVUYXJnZXQocikpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQXR0ZW1wdHMgdG8gZmlsbCBvdXIgd3JpdGUgcGlwZWxpbmUgd2l0aCB3cml0ZXMgZnJvbSB0aGUgTG9jYWxTdG9yZS5cbiAqXG4gKiBDYWxsZWQgaW50ZXJuYWxseSB0byBib290c3RyYXAgb3IgcmVmaWxsIHRoZSB3cml0ZSBwaXBlbGluZSBhbmQgYnlcbiAqIFN5bmNFbmdpbmUgd2hlbmV2ZXIgdGhlcmUgYXJlIG5ldyBtdXRhdGlvbnMgdG8gcHJvY2Vzcy5cbiAqXG4gKiBTdGFydHMgdGhlIHdyaXRlIHN0cmVhbSBpZiBuZWNlc3NhcnkuXG4gKi8gKGUsIHQpO1xuICAgIH0gY2F0Y2ggKG4pIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKHp0LCBcIkZhaWxlZCB0byByZW1vdmUgdGFyZ2V0cyAlczogJXMgXCIsIHQudGFyZ2V0SWRzLmpvaW4oXCIsXCIpLCBuKSwgXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya1VudGlsUmVjb3ZlcnkoZSwgbik7XG4gICAgfSBlbHNlIGlmICh0IGluc3RhbmNlb2YgX19QUklWQVRFX0RvY3VtZW50V2F0Y2hDaGFuZ2UgPyBlLkhfLldlKHQpIDogdCBpbnN0YW5jZW9mIF9fUFJJVkFURV9FeGlzdGVuY2VGaWx0ZXJDaGFuZ2UgPyBlLkhfLlplKHQpIDogZS5IXy5qZSh0KSwgXG4gICAgIW4uaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpKSB0cnkge1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVHZXRMYXN0UmVtb3RlU25hcHNob3RWZXJzaW9uKGUubG9jYWxTdG9yZSk7XG4gICAgICAgIG4uY29tcGFyZVRvKHQpID49IDAgJiYgXG4gICAgICAgIC8vIFdlIGhhdmUgcmVjZWl2ZWQgYSB0YXJnZXQgY2hhbmdlIHdpdGggYSBnbG9iYWwgc25hcHNob3QgaWYgdGhlIHNuYXBzaG90XG4gICAgICAgIC8vIHZlcnNpb24gaXMgbm90IGVxdWFsIHRvIFNuYXBzaG90VmVyc2lvbi5taW4oKS5cbiAgICAgICAgLyoqXG4gKiBUYWtlcyBhIGJhdGNoIG9mIGNoYW5nZXMgZnJvbSB0aGUgRGF0YXN0b3JlLCByZXBhY2thZ2VzIHRoZW0gYXMgYVxuICogUmVtb3RlRXZlbnQsIGFuZCBwYXNzZXMgdGhhdCBvbiB0byB0aGUgbGlzdGVuZXIsIHdoaWNoIGlzIHR5cGljYWxseSB0aGVcbiAqIFN5bmNFbmdpbmUuXG4gKi9cbiAgICAgICAgYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX3JhaXNlV2F0Y2hTbmFwc2hvdChlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gZS5IXy5vdCh0KTtcbiAgICAgICAgICAgIC8vIFVwZGF0ZSBpbi1tZW1vcnkgcmVzdW1lIHRva2Vucy4gTG9jYWxTdG9yZSB3aWxsIHVwZGF0ZSB0aGVcbiAgICAgICAgICAgIC8vIHBlcnNpc3RlbnQgdmlldyBvZiB0aGVzZSB3aGVuIGFwcGx5aW5nIHRoZSBjb21wbGV0ZWQgUmVtb3RlRXZlbnQuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi50YXJnZXRDaGFuZ2VzLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKG4ucmVzdW1lVG9rZW4uYXBwcm94aW1hdGVCeXRlU2l6ZSgpID4gMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gZS5LXy5nZXQocik7XG4gICAgICAgICAgICAgICAgICAgIC8vIEEgd2F0Y2hlZCB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuIHJlbW92ZWQgYWxyZWFkeS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpICYmIGUuS18uc2V0KHIsIGkud2l0aFJlc3VtZVRva2VuKG4ucmVzdW1lVG9rZW4sIHQpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KSksIFxuICAgICAgICAgICAgLy8gUmUtZXN0YWJsaXNoIGxpc3RlbnMgZm9yIHRoZSB0YXJnZXRzIHRoYXQgaGF2ZSBiZWVuIGludmFsaWRhdGVkIGJ5XG4gICAgICAgICAgICAvLyBleGlzdGVuY2UgZmlsdGVyIG1pc21hdGNoZXMuXG4gICAgICAgICAgICBuLnRhcmdldE1pc21hdGNoZXMuZm9yRWFjaCgoKHQsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByID0gZS5LXy5nZXQodCk7XG4gICAgICAgICAgICAgICAgaWYgKCFyKSBcbiAgICAgICAgICAgICAgICAvLyBBIHdhdGNoZWQgdGFyZ2V0IG1pZ2h0IGhhdmUgYmVlbiByZW1vdmVkIGFscmVhZHkuXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIC8vIENsZWFyIHRoZSByZXN1bWUgdG9rZW4gZm9yIHRoZSB0YXJnZXQsIHNpbmNlIHdlJ3JlIGluIGEga25vd24gbWlzbWF0Y2hcbiAgICAgICAgICAgICAgICAvLyBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZS5LXy5zZXQodCwgci53aXRoUmVzdW1lVG9rZW4oQnl0ZVN0cmluZy5FTVBUWV9CWVRFX1NUUklORywgci5zbmFwc2hvdFZlcnNpb24pKSwgXG4gICAgICAgICAgICAgICAgLy8gQ2F1c2UgYSBoYXJkIHJlc2V0IGJ5IHVud2F0Y2hpbmcgYW5kIHJld2F0Y2hpbmcgaW1tZWRpYXRlbHksIGJ1dFxuICAgICAgICAgICAgICAgIC8vIGRlbGliZXJhdGVseSBkb24ndCBzZW5kIGEgcmVzdW1lIHRva2VuIHNvIHRoYXQgd2UgZ2V0IGEgZnVsbCB1cGRhdGUuXG4gICAgICAgICAgICAgICAgX19QUklWQVRFX3NlbmRVbndhdGNoUmVxdWVzdChlLCB0KTtcbiAgICAgICAgICAgICAgICAvLyBNYXJrIHRoZSB0YXJnZXQgd2Ugc2VuZCBhcyBiZWluZyBvbiBiZWhhbGYgb2YgYW4gZXhpc3RlbmNlIGZpbHRlclxuICAgICAgICAgICAgICAgIC8vIG1pc21hdGNoLCBidXQgZG9uJ3QgYWN0dWFsbHkgcmV0YWluIHRoYXQgaW4gbGlzdGVuVGFyZ2V0cy4gVGhpcyBlbnN1cmVzXG4gICAgICAgICAgICAgICAgLy8gdGhhdCB3ZSBmbGFnIHRoZSBmaXJzdCByZS1saXN0ZW4gdGhpcyB3YXkgd2l0aG91dCBpbXBhY3RpbmcgZnV0dXJlXG4gICAgICAgICAgICAgICAgLy8gbGlzdGVucyBvZiB0aGlzIHRhcmdldCAodGhhdCBtaWdodCBoYXBwZW4gZS5nLiBvbiByZWNvbm5lY3QpLlxuICAgICAgICAgICAgICAgIGNvbnN0IGkgPSBuZXcgVGFyZ2V0RGF0YShyLnRhcmdldCwgdCwgbiwgci5zZXF1ZW5jZU51bWJlcik7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX3NlbmRXYXRjaFJlcXVlc3QoZSwgaSk7XG4gICAgICAgICAgICB9KSksIGUucmVtb3RlU3luY2VyLmFwcGx5UmVtb3RlRXZlbnQobik7XG4gICAgICAgIH0oZSwgbik7XG4gICAgfSBjYXRjaCAodCkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoenQsIFwiRmFpbGVkIHRvIHJhaXNlIHNuYXBzaG90OlwiLCB0KSwgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrVW50aWxSZWNvdmVyeShlLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVjb3ZlcnkgbG9naWMgZm9yIEluZGV4ZWREQiBlcnJvcnMgdGhhdCB0YWtlcyB0aGUgbmV0d29yayBvZmZsaW5lIHVudGlsXG4gKiBgb3BgIHN1Y2NlZWRzLiBSZXRyaWVzIGFyZSBzY2hlZHVsZWQgd2l0aCBiYWNrb2ZmIHVzaW5nXG4gKiBgZW5xdWV1ZVJldHJ5YWJsZSgpYC4gSWYgYG9wKClgIGlzIG5vdCBwcm92aWRlZCwgSW5kZXhlZERCIGFjY2VzcyBpc1xuICogdmFsaWRhdGVkIHZpYSBhIGdlbmVyaWMgb3BlcmF0aW9uLlxuICpcbiAqIFRoZSByZXR1cm5lZCBQcm9taXNlIGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaXMgZGlzYWJsZWQgYW5kIGJlZm9yZVxuICogYW55IHJldHJ5IGF0dGVtcHQuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrVW50aWxSZWNvdmVyeShlLCB0LCBuKSB7XG4gICAgaWYgKCFfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKHQpKSB0aHJvdyB0O1xuICAgIGUuV18uYWRkKDEgLyogT2ZmbGluZUNhdXNlLkluZGV4ZWREYkZhaWxlZCAqLyksIFxuICAgIC8vIERpc2FibGUgbmV0d29yayBhbmQgcmFpc2Ugb2ZmbGluZSBzbmFwc2hvdHNcbiAgICBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbChlKSwgZS5qXy5zZXQoXCJPZmZsaW5lXCIgLyogT25saW5lU3RhdGUuT2ZmbGluZSAqLyksIFxuICAgIG4gfHwgKFxuICAgIC8vIFVzZSBhIHNpbXBsZSByZWFkIG9wZXJhdGlvbiB0byBkZXRlcm1pbmUgaWYgSW5kZXhlZERCIHJlY292ZXJlZC5cbiAgICAvLyBJZGVhbGx5LCB3ZSB3b3VsZCBleHBvc2UgYSBoZWFsdGggY2hlY2sgZGlyZWN0bHkgb24gU2ltcGxlRGIsIGJ1dFxuICAgIC8vIFJlbW90ZVN0b3JlIG9ubHkgaGFzIGFjY2VzcyB0byBwZXJzaXN0ZW5jZSB0aHJvdWdoIExvY2FsU3RvcmUuXG4gICAgbiA9ICgpID0+IF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TGFzdFJlbW90ZVNuYXBzaG90VmVyc2lvbihlLmxvY2FsU3RvcmUpKSwgXG4gICAgLy8gUHJvYmUgSW5kZXhlZERCIHBlcmlvZGljYWxseSBhbmQgcmUtZW5hYmxlIG5ldHdvcmtcbiAgICBlLmFzeW5jUXVldWUuZW5xdWV1ZVJldHJ5YWJsZSgoYXN5bmMgKCkgPT4ge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoenQsIFwiUmV0cnlpbmcgSW5kZXhlZERCIGFjY2Vzc1wiKSwgYXdhaXQgbigpLCBlLldfLmRlbGV0ZSgxIC8qIE9mZmxpbmVDYXVzZS5JbmRleGVkRGJGYWlsZWQgKi8pLCBcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbChlKTtcbiAgICB9KSk7XG59XG5cbi8qKlxuICogRXhlY3V0ZXMgYG9wYC4gSWYgYG9wYCBmYWlscywgdGFrZXMgdGhlIG5ldHdvcmsgb2ZmbGluZSB1bnRpbCBgb3BgXG4gKiBzdWNjZWVkcy4gUmV0dXJucyBhZnRlciB0aGUgZmlyc3QgYXR0ZW1wdC5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZXhlY3V0ZVdpdGhSZWNvdmVyeShlLCB0KSB7XG4gICAgcmV0dXJuIHQoKS5jYXRjaCgobiA9PiBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtVbnRpbFJlY292ZXJ5KGUsIG4sIHQpKSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShlKSB7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIG4gPSBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0odCk7XG4gICAgbGV0IHIgPSB0LlVfLmxlbmd0aCA+IDAgPyB0LlVfW3QuVV8ubGVuZ3RoIC0gMV0uYmF0Y2hJZCA6IFE7XG4gICAgZm9yICg7X19QUklWQVRFX2NhbkFkZFRvV3JpdGVQaXBlbGluZSh0KTsgKSB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXh0TXV0YXRpb25CYXRjaCh0LmxvY2FsU3RvcmUsIHIpO1xuICAgICAgICBpZiAobnVsbCA9PT0gZSkge1xuICAgICAgICAgICAgMCA9PT0gdC5VXy5sZW5ndGggJiYgbi5QXygpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgciA9IGUuYmF0Y2hJZCwgX19QUklWQVRFX2FkZFRvV3JpdGVQaXBlbGluZSh0LCBlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya1VudGlsUmVjb3ZlcnkodCwgZSk7XG4gICAgfVxuICAgIF9fUFJJVkFURV9zaG91bGRTdGFydFdyaXRlU3RyZWFtKHQpICYmIF9fUFJJVkFURV9zdGFydFdyaXRlU3RyZWFtKHQpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB3ZSBjYW4gYWRkIHRvIHRoZSB3cml0ZSBwaXBlbGluZSAoaS5lLiB0aGUgbmV0d29yayBpc1xuICogZW5hYmxlZCBhbmQgdGhlIHdyaXRlIHBpcGVsaW5lIGlzIG5vdCBmdWxsKS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY2FuQWRkVG9Xcml0ZVBpcGVsaW5lKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2NhblVzZU5ldHdvcmsoZSkgJiYgZS5VXy5sZW5ndGggPCAxMDtcbn1cblxuLyoqXG4gKiBRdWV1ZXMgYWRkaXRpb25hbCB3cml0ZXMgdG8gYmUgc2VudCB0byB0aGUgd3JpdGUgc3RyZWFtLCBzZW5kaW5nIHRoZW1cbiAqIGltbWVkaWF0ZWx5IGlmIHRoZSB3cml0ZSBzdHJlYW0gaXMgZXN0YWJsaXNoZWQuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FkZFRvV3JpdGVQaXBlbGluZShlLCB0KSB7XG4gICAgZS5VXy5wdXNoKHQpO1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZW5zdXJlV3JpdGVTdHJlYW0oZSk7XG4gICAgbi5jXygpICYmIG4uU18gJiYgbi5iXyh0Lm11dGF0aW9ucyk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zaG91bGRTdGFydFdyaXRlU3RyZWFtKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2NhblVzZU5ldHdvcmsoZSkgJiYgIV9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKS51XygpICYmIGUuVV8ubGVuZ3RoID4gMDtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3N0YXJ0V3JpdGVTdHJlYW0oZSkge1xuICAgIF9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKS5zdGFydCgpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25Xcml0ZVN0cmVhbU9wZW4oZSkge1xuICAgIF9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKS5DXygpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfb25Xcml0ZUhhbmRzaGFrZUNvbXBsZXRlKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpO1xuICAgIC8vIFNlbmQgdGhlIHdyaXRlIHBpcGVsaW5lIG5vdyB0aGF0IHRoZSBzdHJlYW0gaXMgZXN0YWJsaXNoZWQuXG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlLlVfKSB0LmJfKG4ubXV0YXRpb25zKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uTXV0YXRpb25SZXN1bHQoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBlLlVfLnNoaWZ0KCksIGkgPSBNdXRhdGlvbkJhdGNoUmVzdWx0LmZyb20ociwgdCwgbik7XG4gICAgYXdhaXQgX19QUklWQVRFX2V4ZWN1dGVXaXRoUmVjb3ZlcnkoZSwgKCgpID0+IGUucmVtb3RlU3luY2VyLmFwcGx5U3VjY2Vzc2Z1bFdyaXRlKGkpKSksIFxuICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB3aXRoIHRoZSBjb21wbGV0aW9uIG9mIHRoaXMgbXV0YXRpb24gYW5vdGhlclxuICAgIC8vIHNsb3QgaGFzIGZyZWVkIHVwLlxuICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShlKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX29uV3JpdGVTdHJlYW1DbG9zZShlLCB0KSB7XG4gICAgLy8gSWYgdGhlIHdyaXRlIHN0cmVhbSBjbG9zZWQgYWZ0ZXIgdGhlIHdyaXRlIGhhbmRzaGFrZSBjb21wbGV0ZXMsIGEgd3JpdGVcbiAgICAvLyBvcGVyYXRpb24gZmFpbGVkIGFuZCB3ZSBmYWlsIHRoZSBwZW5kaW5nIG9wZXJhdGlvbi5cbiAgICB0ICYmIF9fUFJJVkFURV9lbnN1cmVXcml0ZVN0cmVhbShlKS5TXyAmJiBcbiAgICAvLyBUaGlzIGVycm9yIGFmZmVjdHMgdGhlIGFjdHVhbCB3cml0ZS5cbiAgICBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaGFuZGxlV3JpdGVFcnJvcihlLCB0KSB7XG4gICAgICAgIC8vIE9ubHkgaGFuZGxlIHBlcm1hbmVudCBlcnJvcnMgaGVyZS4gSWYgaXQncyB0cmFuc2llbnQsIGp1c3QgbGV0IHRoZSByZXRyeVxuICAgICAgICAvLyBsb2dpYyBraWNrIGluLlxuICAgICAgICBpZiAoZnVuY3Rpb24gX19QUklWQVRFX2lzUGVybWFuZW50V3JpdGVFcnJvcihlKSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2lzUGVybWFuZW50RXJyb3IoZSkgJiYgZSAhPT0gQy5BQk9SVEVEO1xuICAgICAgICB9KHQuY29kZSkpIHtcbiAgICAgICAgICAgIC8vIFRoaXMgd2FzIGEgcGVybWFuZW50IGVycm9yLCB0aGUgcmVxdWVzdCBpdHNlbGYgd2FzIHRoZSBwcm9ibGVtXG4gICAgICAgICAgICAvLyBzbyBpdCdzIG5vdCBnb2luZyB0byBzdWNjZWVkIGlmIHdlIHJlc2VuZCBpdC5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBlLlVfLnNoaWZ0KCk7XG4gICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2UgaXQncyBhbHNvIHVubGlrZWx5IHRoYXQgdGhlIHNlcnZlciBpdHNlbGYgaXMgbWVsdGluZ1xuICAgICAgICAgICAgLy8gZG93biAtLSB0aGlzIHdhcyBqdXN0IGEgYmFkIHJlcXVlc3Qgc28gaW5oaWJpdCBiYWNrb2ZmIG9uIHRoZSBuZXh0XG4gICAgICAgICAgICAvLyByZXN0YXJ0LlxuICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpLmhfKCksIGF3YWl0IF9fUFJJVkFURV9leGVjdXRlV2l0aFJlY292ZXJ5KGUsICgoKSA9PiBlLnJlbW90ZVN5bmNlci5yZWplY3RGYWlsZWRXcml0ZShuLmJhdGNoSWQsIHQpKSksIFxuICAgICAgICAgICAgLy8gSXQncyBwb3NzaWJsZSB0aGF0IHdpdGggdGhlIGNvbXBsZXRpb24gb2YgdGhpcyBtdXRhdGlvblxuICAgICAgICAgICAgLy8gYW5vdGhlciBzbG90IGhhcyBmcmVlZCB1cC5cbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShlKTtcbiAgICAgICAgfVxuICAgIH0oZSwgdCksIFxuICAgIC8vIFRoZSB3cml0ZSBzdHJlYW0gbWlnaHQgaGF2ZSBiZWVuIHN0YXJ0ZWQgYnkgcmVmaWxsaW5nIHRoZSB3cml0ZVxuICAgIC8vIHBpcGVsaW5lIGZvciBmYWlsZWQgd3JpdGVzXG4gICAgX19QUklWQVRFX3Nob3VsZFN0YXJ0V3JpdGVTdHJlYW0oZSkgJiYgX19QUklWQVRFX3N0YXJ0V3JpdGVTdHJlYW0oZSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9yZW1vdGVTdG9yZUhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIG4uYXN5bmNRdWV1ZS52ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCksIF9fUFJJVkFURV9sb2dEZWJ1Zyh6dCwgXCJSZW1vdGVTdG9yZSByZWNlaXZlZCBuZXcgY3JlZGVudGlhbHNcIik7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9jYW5Vc2VOZXR3b3JrKG4pO1xuICAgIC8vIFRlYXIgZG93biBhbmQgcmUtY3JlYXRlIG91ciBuZXR3b3JrIHN0cmVhbXMuIFRoaXMgd2lsbCBlbnN1cmUgd2UgZ2V0IGFcbiAgICAvLyBmcmVzaCBhdXRoIHRva2VuIGZvciB0aGUgbmV3IHVzZXIgYW5kIHJlLWZpbGwgdGhlIHdyaXRlIHBpcGVsaW5lIHdpdGhcbiAgICAvLyBuZXcgbXV0YXRpb25zIGZyb20gdGhlIExvY2FsU3RvcmUgKHNpbmNlIG11dGF0aW9ucyBhcmUgcGVyLXVzZXIpLlxuICAgICAgICBuLldfLmFkZCgzIC8qIE9mZmxpbmVDYXVzZS5DcmVkZW50aWFsQ2hhbmdlICovKSwgYXdhaXQgX19QUklWQVRFX2Rpc2FibGVOZXR3b3JrSW50ZXJuYWwobiksIFxuICAgIHIgJiYgXG4gICAgLy8gRG9uJ3Qgc2V0IHRoZSBuZXR3b3JrIHN0YXR1cyB0byBVbmtub3duIGlmIHdlIGFyZSBvZmZsaW5lLlxuICAgIG4ual8uc2V0KFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8pLCBhd2FpdCBuLnJlbW90ZVN5bmNlci5oYW5kbGVDcmVkZW50aWFsQ2hhbmdlKHQpLCBcbiAgICBuLldfLmRlbGV0ZSgzIC8qIE9mZmxpbmVDYXVzZS5DcmVkZW50aWFsQ2hhbmdlICovKSwgYXdhaXQgX19QUklWQVRFX2VuYWJsZU5ldHdvcmtJbnRlcm5hbChuKTtcbn1cblxuLyoqXG4gKiBUb2dnbGVzIHRoZSBuZXR3b3JrIHN0YXRlIHdoZW4gdGhlIGNsaWVudCBnYWlucyBvciBsb3NlcyBpdHMgcHJpbWFyeSBsZWFzZS5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVBcHBseVByaW1hcnlTdGF0ZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgdCA/IChuLldfLmRlbGV0ZSgyIC8qIE9mZmxpbmVDYXVzZS5Jc1NlY29uZGFyeSAqLyksIGF3YWl0IF9fUFJJVkFURV9lbmFibGVOZXR3b3JrSW50ZXJuYWwobikpIDogdCB8fCAobi5XXy5hZGQoMiAvKiBPZmZsaW5lQ2F1c2UuSXNTZWNvbmRhcnkgKi8pLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfZGlzYWJsZU5ldHdvcmtJbnRlcm5hbChuKSwgbi5qXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLykpO1xufVxuXG4vKipcbiAqIElmIG5vdCB5ZXQgaW5pdGlhbGl6ZWQsIHJlZ2lzdGVycyB0aGUgV2F0Y2hTdHJlYW0gYW5kIGl0cyBuZXR3b3JrIHN0YXRlXG4gKiBjYWxsYmFjayB3aXRoIGByZW1vdGVTdG9yZUltcGxgLiBSZXR1cm5zIHRoZSBleGlzdGluZyBzdHJlYW0gaWYgb25lIGlzXG4gKiBhbHJlYWR5IGF2YWlsYWJsZS5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IE9uIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdhdGNoU3RyZWFtIGdldHMgcmVnaXN0ZXJlZCBvbiBzdGFydHVwLlxuICogVGhpcyBpcyBub3QgZG9uZSBvbiBXZWIgdG8gYWxsb3cgaXQgdG8gYmUgdHJlZS1zaGFrZW4uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZVdhdGNoU3RyZWFtKGUpIHtcbiAgICByZXR1cm4gZS5KXyB8fCAoXG4gICAgLy8gQ3JlYXRlIHN0cmVhbSAoYnV0IG5vdGUgdGhhdCBpdCBpcyBub3Qgc3RhcnRlZCB5ZXQpLlxuICAgIGUuSl8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UGVyc2lzdGVudFdhdGNoU3RyZWFtKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgIHJldHVybiByLk1fKCksIG5ldyBfX1BSSVZBVEVfUGVyc2lzdGVudExpc3RlblN0cmVhbSh0LCByLmNvbm5lY3Rpb24sIHIuYXV0aENyZWRlbnRpYWxzLCByLmFwcENoZWNrQ3JlZGVudGlhbHMsIHIuc2VyaWFsaXplciwgbik7XG4gICAgfVxuICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE4IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIChlLmRhdGFzdG9yZSwgZS5hc3luY1F1ZXVlLCB7XG4gICAgICAgIHhvOiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbUNvbm5lY3RlZC5iaW5kKG51bGwsIGUpLFxuICAgICAgICBObzogX19QUklWQVRFX29uV2F0Y2hTdHJlYW1PcGVuLmJpbmQobnVsbCwgZSksXG4gICAgICAgIExvOiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbUNsb3NlLmJpbmQobnVsbCwgZSksXG4gICAgICAgIHBfOiBfX1BSSVZBVEVfb25XYXRjaFN0cmVhbUNoYW5nZS5iaW5kKG51bGwsIGUpXG4gICAgfSksIGUuR18ucHVzaCgoYXN5bmMgdCA9PiB7XG4gICAgICAgIHQgPyAoZS5KXy5oXygpLCBfX1BSSVZBVEVfc2hvdWxkU3RhcnRXYXRjaFN0cmVhbShlKSA/IF9fUFJJVkFURV9zdGFydFdhdGNoU3RyZWFtKGUpIDogZS5qXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLykpIDogKGF3YWl0IGUuSl8uc3RvcCgpLCBcbiAgICAgICAgX19QUklWQVRFX2NsZWFuVXBXYXRjaFN0cmVhbVN0YXRlKGUpKTtcbiAgICB9KSkpLCBlLkpfO1xufVxuXG4vKipcbiAqIElmIG5vdCB5ZXQgaW5pdGlhbGl6ZWQsIHJlZ2lzdGVycyB0aGUgV3JpdGVTdHJlYW0gYW5kIGl0cyBuZXR3b3JrIHN0YXRlXG4gKiBjYWxsYmFjayB3aXRoIGByZW1vdGVTdG9yZUltcGxgLiBSZXR1cm5zIHRoZSBleGlzdGluZyBzdHJlYW0gaWYgb25lIGlzXG4gKiBhbHJlYWR5IGF2YWlsYWJsZS5cbiAqXG4gKiBQT1JUSU5HIE5PVEU6IE9uIGlPUyBhbmQgQW5kcm9pZCwgdGhlIFdyaXRlU3RyZWFtIGdldHMgcmVnaXN0ZXJlZCBvbiBzdGFydHVwLlxuICogVGhpcyBpcyBub3QgZG9uZSBvbiBXZWIgdG8gYWxsb3cgaXQgdG8gYmUgdHJlZS1zaGFrZW4uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZVdyaXRlU3RyZWFtKGUpIHtcbiAgICByZXR1cm4gZS5ZXyB8fCAoXG4gICAgLy8gQ3JlYXRlIHN0cmVhbSAoYnV0IG5vdGUgdGhhdCBpdCBpcyBub3Qgc3RhcnRlZCB5ZXQpLlxuICAgIGUuWV8gPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UGVyc2lzdGVudFdyaXRlU3RyZWFtKGUsIHQsIG4pIHtcbiAgICAgICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgIHJldHVybiByLk1fKCksIG5ldyBfX1BSSVZBVEVfUGVyc2lzdGVudFdyaXRlU3RyZWFtKHQsIHIuY29ubmVjdGlvbiwgci5hdXRoQ3JlZGVudGlhbHMsIHIuYXBwQ2hlY2tDcmVkZW50aWFscywgci5zZXJpYWxpemVyLCBuKTtcbiAgICB9KGUuZGF0YXN0b3JlLCBlLmFzeW5jUXVldWUsIHtcbiAgICAgICAgeG86ICgpID0+IFByb21pc2UucmVzb2x2ZSgpLFxuICAgICAgICBObzogX19QUklWQVRFX29uV3JpdGVTdHJlYW1PcGVuLmJpbmQobnVsbCwgZSksXG4gICAgICAgIExvOiBfX1BSSVZBVEVfb25Xcml0ZVN0cmVhbUNsb3NlLmJpbmQobnVsbCwgZSksXG4gICAgICAgIERfOiBfX1BSSVZBVEVfb25Xcml0ZUhhbmRzaGFrZUNvbXBsZXRlLmJpbmQobnVsbCwgZSksXG4gICAgICAgIHZfOiBfX1BSSVZBVEVfb25NdXRhdGlvblJlc3VsdC5iaW5kKG51bGwsIGUpXG4gICAgfSksIGUuR18ucHVzaCgoYXN5bmMgdCA9PiB7XG4gICAgICAgIHQgPyAoZS5ZXy5oXygpLCBcbiAgICAgICAgLy8gVGhpcyB3aWxsIHN0YXJ0IHRoZSB3cml0ZSBzdHJlYW0gaWYgbmVjZXNzYXJ5LlxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoZSkpIDogKGF3YWl0IGUuWV8uc3RvcCgpLCBlLlVfLmxlbmd0aCA+IDAgJiYgKF9fUFJJVkFURV9sb2dEZWJ1Zyh6dCwgYFN0b3BwaW5nIHdyaXRlIHN0cmVhbSB3aXRoICR7ZS5VXy5sZW5ndGh9IHBlbmRpbmcgd3JpdGVzYCksIFxuICAgICAgICBlLlVfID0gW10pKTtcbiAgICB9KSkpLCBlLllfO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIGFuIG9wZXJhdGlvbiBzY2hlZHVsZWQgdG8gYmUgcnVuIGluIHRoZSBmdXR1cmUgb24gYW4gQXN5bmNRdWV1ZS5cbiAqXG4gKiBJdCBpcyBjcmVhdGVkIHZpYSBEZWxheWVkT3BlcmF0aW9uLmNyZWF0ZUFuZFNjaGVkdWxlKCkuXG4gKlxuICogU3VwcG9ydHMgY2FuY2VsbGF0aW9uICh2aWEgY2FuY2VsKCkpIGFuZCBlYXJseSBleGVjdXRpb24gKHZpYSBza2lwRGVsYXkoKSkuXG4gKlxuICogTm90ZTogV2UgaW1wbGVtZW50IGBQcm9taXNlTGlrZWAgaW5zdGVhZCBvZiBgUHJvbWlzZWAsIGFzIHRoZSBgUHJvbWlzZWAgdHlwZVxuICogaW4gbmV3ZXIgdmVyc2lvbnMgb2YgVHlwZVNjcmlwdCBkZWZpbmVzIGBmaW5hbGx5YCwgd2hpY2ggaXMgbm90IGF2YWlsYWJsZSBpblxuICogSUUuXG4gKi9cbmNsYXNzIERlbGF5ZWRPcGVyYXRpb24ge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlID0gZSwgdGhpcy50aW1lcklkID0gdCwgdGhpcy50YXJnZXRUaW1lTXMgPSBuLCB0aGlzLm9wID0gciwgdGhpcy5yZW1vdmFsQ2FsbGJhY2sgPSBpLCBcbiAgICAgICAgdGhpcy5kZWZlcnJlZCA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIHRoaXMudGhlbiA9IHRoaXMuZGVmZXJyZWQucHJvbWlzZS50aGVuLmJpbmQodGhpcy5kZWZlcnJlZC5wcm9taXNlKSwgXG4gICAgICAgIC8vIEl0J3Mgbm9ybWFsIGZvciB0aGUgZGVmZXJyZWQgcHJvbWlzZSB0byBiZSBjYW5jZWxlZCAoZHVlIHRvIGNhbmNlbGxhdGlvbilcbiAgICAgICAgLy8gYW5kIHNvIHdlIGF0dGFjaCBhIGR1bW15IGNhdGNoIGNhbGxiYWNrIHRvIGF2b2lkXG4gICAgICAgIC8vICdVbmhhbmRsZWRQcm9taXNlUmVqZWN0aW9uV2FybmluZycgbG9nIHNwYW0uXG4gICAgICAgIHRoaXMuZGVmZXJyZWQucHJvbWlzZS5jYXRjaCgoZSA9PiB7fSkpO1xuICAgIH1cbiAgICBnZXQgcHJvbWlzZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhbmQgcmV0dXJucyBhIERlbGF5ZWRPcGVyYXRpb24gdGhhdCBoYXMgYmVlbiBzY2hlZHVsZWQgdG8gYmVcbiAgICAgKiBleGVjdXRlZCBvbiB0aGUgcHJvdmlkZWQgYXN5bmNRdWV1ZSBhZnRlciB0aGUgcHJvdmlkZWQgZGVsYXlNcy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhc3luY1F1ZXVlIC0gVGhlIHF1ZXVlIHRvIHNjaGVkdWxlIHRoZSBvcGVyYXRpb24gb24uXG4gICAgICogQHBhcmFtIGlkIC0gQSBUaW1lciBJRCBpZGVudGlmeWluZyB0aGUgdHlwZSBvZiBvcGVyYXRpb24gdGhpcyBpcy5cbiAgICAgKiBAcGFyYW0gZGVsYXlNcyAtIFRoZSBkZWxheSAobXMpIGJlZm9yZSB0aGUgb3BlcmF0aW9uIHNob3VsZCBiZSBzY2hlZHVsZWQuXG4gICAgICogQHBhcmFtIG9wIC0gVGhlIG9wZXJhdGlvbiB0byBydW4uXG4gICAgICogQHBhcmFtIHJlbW92YWxDYWxsYmFjayAtIEEgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHN5bmNocm9ub3VzbHkgb25jZSB0aGVcbiAgICAgKiAgIG9wZXJhdGlvbiBpcyBleGVjdXRlZCBvciBjYW5jZWxlZCwgbm90aWZ5aW5nIHRoZSBBc3luY1F1ZXVlIHRvIHJlbW92ZSBpdFxuICAgICAqICAgZnJvbSBpdHMgZGVsYXllZE9wZXJhdGlvbnMgbGlzdC5cbiAgICAgKiAgIFBPUlRJTkcgTk9URTogVGhpcyBleGlzdHMgdG8gcHJldmVudCBtYWtpbmcgcmVtb3ZlRGVsYXllZE9wZXJhdGlvbigpIGFuZFxuICAgICAqICAgdGhlIERlbGF5ZWRPcGVyYXRpb24gY2xhc3MgcHVibGljLlxuICAgICAqLyAgICBzdGF0aWMgY3JlYXRlQW5kU2NoZWR1bGUoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gRGF0ZS5ub3coKSArIG4sIG8gPSBuZXcgRGVsYXllZE9wZXJhdGlvbihlLCB0LCBzLCByLCBpKTtcbiAgICAgICAgcmV0dXJuIG8uc3RhcnQobiksIG87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFN0YXJ0cyB0aGUgdGltZXIuIFRoaXMgaXMgY2FsbGVkIGltbWVkaWF0ZWx5IGFmdGVyIGNvbnN0cnVjdGlvbiBieVxuICAgICAqIGNyZWF0ZUFuZFNjaGVkdWxlKCkuXG4gICAgICovICAgIHN0YXJ0KGUpIHtcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IHNldFRpbWVvdXQoKCgpID0+IHRoaXMuaGFuZGxlRGVsYXlFbGFwc2VkKCkpLCBlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUXVldWVzIHRoZSBvcGVyYXRpb24gdG8gcnVuIGltbWVkaWF0ZWx5IChpZiBpdCBoYXNuJ3QgYWxyZWFkeSBiZWVuIHJ1biBvclxuICAgICAqIGNhbmNlbGVkKS5cbiAgICAgKi8gICAgc2tpcERlbGF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5oYW5kbGVEZWxheUVsYXBzZWQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FuY2VscyB0aGUgb3BlcmF0aW9uIGlmIGl0IGhhc24ndCBhbHJlYWR5IGJlZW4gZXhlY3V0ZWQgb3IgY2FuY2VsZWQuIFRoZVxuICAgICAqIHByb21pc2Ugd2lsbCBiZSByZWplY3RlZC5cbiAgICAgKlxuICAgICAqIEFzIGxvbmcgYXMgdGhlIG9wZXJhdGlvbiBoYXMgbm90IHlldCBiZWVuIHJ1biwgY2FsbGluZyBjYW5jZWwoKSBwcm92aWRlcyBhXG4gICAgICogZ3VhcmFudGVlIHRoYXQgdGhlIG9wZXJhdGlvbiB3aWxsIG5vdCBiZSBydW4uXG4gICAgICovICAgIGNhbmNlbChlKSB7XG4gICAgICAgIG51bGwgIT09IHRoaXMudGltZXJIYW5kbGUgJiYgKHRoaXMuY2xlYXJUaW1lb3V0KCksIHRoaXMuZGVmZXJyZWQucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihDLkNBTkNFTExFRCwgXCJPcGVyYXRpb24gY2FuY2VsbGVkXCIgKyAoZSA/IFwiOiBcIiArIGUgOiBcIlwiKSkpKTtcbiAgICB9XG4gICAgaGFuZGxlRGVsYXlFbGFwc2VkKCkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gbnVsbCAhPT0gdGhpcy50aW1lckhhbmRsZSA/ICh0aGlzLmNsZWFyVGltZW91dCgpLCBcbiAgICAgICAgdGhpcy5vcCgpLnRoZW4oKGUgPT4gdGhpcy5kZWZlcnJlZC5yZXNvbHZlKGUpKSkpIDogUHJvbWlzZS5yZXNvbHZlKCkpKTtcbiAgICB9XG4gICAgY2xlYXJUaW1lb3V0KCkge1xuICAgICAgICBudWxsICE9PSB0aGlzLnRpbWVySGFuZGxlICYmICh0aGlzLnJlbW92YWxDYWxsYmFjayh0aGlzKSwgY2xlYXJUaW1lb3V0KHRoaXMudGltZXJIYW5kbGUpLCBcbiAgICAgICAgdGhpcy50aW1lckhhbmRsZSA9IG51bGwpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgRmlyZXN0b3JlRXJyb3IgdGhhdCBjYW4gYmUgc3VyZmFjZWQgdG8gdGhlIHVzZXIgaWYgdGhlIHByb3ZpZGVkXG4gKiBlcnJvciBpcyBhbiBJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yLiBSZS10aHJvd3MgdGhlIGVycm9yIG90aGVyd2lzZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCB0KSB7XG4gICAgaWYgKF9fUFJJVkFURV9sb2dFcnJvcihcIkFzeW5jUXVldWVcIiwgYCR7dH06ICR7ZX1gKSwgX19QUklWQVRFX2lzSW5kZXhlZERiVHJhbnNhY3Rpb25FcnJvcihlKSkgcmV0dXJuIG5ldyBGaXJlc3RvcmVFcnJvcihDLlVOQVZBSUxBQkxFLCBgJHt0fTogJHtlfWApO1xuICAgIHRocm93IGU7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50U2V0IGlzIGFuIGltbXV0YWJsZSAoY29weS1vbi13cml0ZSkgY29sbGVjdGlvbiB0aGF0IGhvbGRzIGRvY3VtZW50c1xuICogaW4gb3JkZXIgc3BlY2lmaWVkIGJ5IHRoZSBwcm92aWRlZCBjb21wYXJhdG9yLiBXZSBhbHdheXMgYWRkIGEgZG9jdW1lbnQga2V5XG4gKiBjb21wYXJhdG9yIG9uIHRvcCBvZiB3aGF0IGlzIHByb3ZpZGVkIHRvIGd1YXJhbnRlZSBkb2N1bWVudCBlcXVhbGl0eSBiYXNlZCBvblxuICogdGhlIGtleS5cbiAqLyBjbGFzcyBEb2N1bWVudFNldCB7XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhbiBlbXB0eSBjb3B5IG9mIHRoZSBleGlzdGluZyBEb2N1bWVudFNldCwgdXNpbmcgdGhlIHNhbWVcbiAgICAgKiBjb21wYXJhdG9yLlxuICAgICAqL1xuICAgIHN0YXRpYyBlbXB0eVNldChlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRTZXQoZS5jb21wYXJhdG9yKTtcbiAgICB9XG4gICAgLyoqIFRoZSBkZWZhdWx0IG9yZGVyaW5nIGlzIGJ5IGtleSBpZiB0aGUgY29tcGFyYXRvciBpcyBvbWl0dGVkICovICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgLy8gV2UgYXJlIGFkZGluZyBkb2N1bWVudCBrZXkgY29tcGFyYXRvciB0byB0aGUgZW5kIGFzIGl0J3MgdGhlIG9ubHlcbiAgICAgICAgLy8gZ3VhcmFudGVlZCB1bmlxdWUgcHJvcGVydHkgb2YgYSBkb2N1bWVudC5cbiAgICAgICAgdGhpcy5jb21wYXJhdG9yID0gZSA/ICh0LCBuKSA9PiBlKHQsIG4pIHx8IERvY3VtZW50S2V5LmNvbXBhcmF0b3IodC5rZXksIG4ua2V5KSA6IChlLCB0KSA9PiBEb2N1bWVudEtleS5jb21wYXJhdG9yKGUua2V5LCB0LmtleSksIFxuICAgICAgICB0aGlzLmtleWVkTWFwID0gZG9jdW1lbnRNYXAoKSwgdGhpcy5zb3J0ZWRTZXQgPSBuZXcgU29ydGVkTWFwKHRoaXMuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIGhhcyhlKSB7XG4gICAgICAgIHJldHVybiBudWxsICE9IHRoaXMua2V5ZWRNYXAuZ2V0KGUpO1xuICAgIH1cbiAgICBnZXQoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5rZXllZE1hcC5nZXQoZSk7XG4gICAgfVxuICAgIGZpcnN0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQubWluS2V5KCk7XG4gICAgfVxuICAgIGxhc3QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNvcnRlZFNldC5tYXhLZXkoKTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc29ydGVkU2V0LmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgaW5kZXggb2YgdGhlIHByb3ZpZGVkIGtleSBpbiB0aGUgZG9jdW1lbnQgc2V0LCBvciAtMSBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBrZXkgaXMgbm90IHByZXNlbnQgaW4gdGhlIHNldDtcbiAgICAgKi8gICAgaW5kZXhPZihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmtleWVkTWFwLmdldChlKTtcbiAgICAgICAgcmV0dXJuIHQgPyB0aGlzLnNvcnRlZFNldC5pbmRleE9mKHQpIDogLTE7XG4gICAgfVxuICAgIGdldCBzaXplKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zb3J0ZWRTZXQuc2l6ZTtcbiAgICB9XG4gICAgLyoqIEl0ZXJhdGVzIGRvY3VtZW50cyBpbiBvcmRlciBkZWZpbmVkIGJ5IFwiY29tcGFyYXRvclwiICovICAgIGZvckVhY2goZSkge1xuICAgICAgICB0aGlzLnNvcnRlZFNldC5pbm9yZGVyVHJhdmVyc2FsKCgodCwgbikgPT4gKGUodCksICExKSkpO1xuICAgIH1cbiAgICAvKiogSW5zZXJ0cyBvciB1cGRhdGVzIGEgZG9jdW1lbnQgd2l0aCB0aGUgc2FtZSBrZXkgKi8gICAgYWRkKGUpIHtcbiAgICAgICAgLy8gRmlyc3QgcmVtb3ZlIHRoZSBlbGVtZW50IGlmIHdlIGhhdmUgaXQuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmRlbGV0ZShlLmtleSk7XG4gICAgICAgIHJldHVybiB0LmNvcHkodC5rZXllZE1hcC5pbnNlcnQoZS5rZXksIGUpLCB0LnNvcnRlZFNldC5pbnNlcnQoZSwgbnVsbCkpO1xuICAgIH1cbiAgICAvKiogRGVsZXRlcyBhIGRvY3VtZW50IHdpdGggYSBnaXZlbiBrZXkgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZ2V0KGUpO1xuICAgICAgICByZXR1cm4gdCA/IHRoaXMuY29weSh0aGlzLmtleWVkTWFwLnJlbW92ZShlKSwgdGhpcy5zb3J0ZWRTZXQucmVtb3ZlKHQpKSA6IHRoaXM7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgRG9jdW1lbnRTZXQpKSByZXR1cm4gITE7XG4gICAgICAgIGlmICh0aGlzLnNpemUgIT09IGUuc2l6ZSkgcmV0dXJuICExO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5zb3J0ZWRTZXQuZ2V0SXRlcmF0b3IoKSwgbiA9IGUuc29ydGVkU2V0LmdldEl0ZXJhdG9yKCk7XG4gICAgICAgIGZvciAoO3QuaGFzTmV4dCgpOyApIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0LmdldE5leHQoKS5rZXksIHIgPSBuLmdldE5leHQoKS5rZXk7XG4gICAgICAgICAgICBpZiAoIWUuaXNFcXVhbChyKSkgcmV0dXJuICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAhMDtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yRWFjaCgodCA9PiB7XG4gICAgICAgICAgICBlLnB1c2godC50b1N0cmluZygpKTtcbiAgICAgICAgfSkpLCAwID09PSBlLmxlbmd0aCA/IFwiRG9jdW1lbnRTZXQgKClcIiA6IFwiRG9jdW1lbnRTZXQgKFxcbiAgXCIgKyBlLmpvaW4oXCIgIFxcblwiKSArIFwiXFxuKVwiO1xuICAgIH1cbiAgICBjb3B5KGUsIHQpIHtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBEb2N1bWVudFNldDtcbiAgICAgICAgcmV0dXJuIG4uY29tcGFyYXRvciA9IHRoaXMuY29tcGFyYXRvciwgbi5rZXllZE1hcCA9IGUsIG4uc29ydGVkU2V0ID0gdCwgbjtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIERvY3VtZW50Q2hhbmdlU2V0IGtlZXBzIHRyYWNrIG9mIGEgc2V0IG9mIGNoYW5nZXMgdG8gZG9jcyBpbiBhIHF1ZXJ5LCBtZXJnaW5nXG4gKiBkdXBsaWNhdGUgZXZlbnRzIGZvciB0aGUgc2FtZSBkb2MuXG4gKi8gY2xhc3MgX19QUklWQVRFX0RvY3VtZW50Q2hhbmdlU2V0IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5aXyA9IG5ldyBTb3J0ZWRNYXAoRG9jdW1lbnRLZXkuY29tcGFyYXRvcik7XG4gICAgfVxuICAgIHRyYWNrKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZG9jLmtleSwgbiA9IHRoaXMuWl8uZ2V0KHQpO1xuICAgICAgICBuID8gXG4gICAgICAgIC8vIE1lcmdlIHRoZSBuZXcgY2hhbmdlIHdpdGggdGhlIGV4aXN0aW5nIGNoYW5nZS5cbiAgICAgICAgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovICE9PSBlLnR5cGUgJiYgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovID09PSBuLnR5cGUgPyB0aGlzLlpfID0gdGhpcy5aXy5pbnNlcnQodCwgZSkgOiAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gPT09IGUudHlwZSAmJiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAhPT0gbi50eXBlID8gdGhpcy5aXyA9IHRoaXMuWl8uaW5zZXJ0KHQsIHtcbiAgICAgICAgICAgIHR5cGU6IG4udHlwZSxcbiAgICAgICAgICAgIGRvYzogZS5kb2NcbiAgICAgICAgfSkgOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IGUudHlwZSAmJiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuWl8gPSB0aGlzLlpfLmluc2VydCh0LCB7XG4gICAgICAgICAgICB0eXBlOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBlLmRvY1xuICAgICAgICB9KSA6IDIgLyogQ2hhbmdlVHlwZS5Nb2RpZmllZCAqLyA9PT0gZS50eXBlICYmIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA9PT0gbi50eXBlID8gdGhpcy5aXyA9IHRoaXMuWl8uaW5zZXJ0KHQsIHtcbiAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICBkb2M6IGUuZG9jXG4gICAgICAgIH0pIDogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gPT09IGUudHlwZSAmJiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gPT09IG4udHlwZSA/IHRoaXMuWl8gPSB0aGlzLlpfLnJlbW92ZSh0KSA6IDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSBlLnR5cGUgJiYgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovID09PSBuLnR5cGUgPyB0aGlzLlpfID0gdGhpcy5aXy5pbnNlcnQodCwge1xuICAgICAgICAgICAgdHlwZTogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgZG9jOiBuLmRvY1xuICAgICAgICB9KSA6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA9PT0gZS50eXBlICYmIDEgLyogQ2hhbmdlVHlwZS5SZW1vdmVkICovID09PSBuLnR5cGUgPyB0aGlzLlpfID0gdGhpcy5aXy5pbnNlcnQodCwge1xuICAgICAgICAgICAgdHlwZTogMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovICxcbiAgICAgICAgICAgIGRvYzogZS5kb2NcbiAgICAgICAgfSkgOiBcbiAgICAgICAgLy8gVGhpcyBpbmNsdWRlcyB0aGVzZSBjYXNlcywgd2hpY2ggZG9uJ3QgbWFrZSBzZW5zZTpcbiAgICAgICAgLy8gQWRkZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPlJlbW92ZWRcbiAgICAgICAgLy8gTW9kaWZpZWQtPkFkZGVkXG4gICAgICAgIC8vIFJlbW92ZWQtPk1vZGlmaWVkXG4gICAgICAgIC8vIE1ldGFkYXRhLT5BZGRlZFxuICAgICAgICAvLyBSZW1vdmVkLT5NZXRhZGF0YVxuICAgICAgICBmYWlsKCkgOiB0aGlzLlpfID0gdGhpcy5aXy5pbnNlcnQodCwgZSk7XG4gICAgfVxuICAgIFhfKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLlpfLmlub3JkZXJUcmF2ZXJzYWwoKCh0LCBuKSA9PiB7XG4gICAgICAgICAgICBlLnB1c2gobik7XG4gICAgICAgIH0pKSwgZTtcbiAgICB9XG59XG5cbmNsYXNzIFZpZXdTbmFwc2hvdCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcywgbywgXywgYSkge1xuICAgICAgICB0aGlzLnF1ZXJ5ID0gZSwgdGhpcy5kb2NzID0gdCwgdGhpcy5vbGREb2NzID0gbiwgdGhpcy5kb2NDaGFuZ2VzID0gciwgdGhpcy5tdXRhdGVkS2V5cyA9IGksIFxuICAgICAgICB0aGlzLmZyb21DYWNoZSA9IHMsIHRoaXMuc3luY1N0YXRlQ2hhbmdlZCA9IG8sIHRoaXMuZXhjbHVkZXNNZXRhZGF0YUNoYW5nZXMgPSBfLCBcbiAgICAgICAgdGhpcy5oYXNDYWNoZWRSZXN1bHRzID0gYTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgYSB2aWV3IHNuYXBzaG90IGFzIGlmIGFsbCBkb2N1bWVudHMgaW4gdGhlIHNuYXBzaG90IHdlcmUgYWRkZWQuICovICAgIHN0YXRpYyBmcm9tSW5pdGlhbERvY3VtZW50cyhlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICBzLnB1c2goe1xuICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiBlXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSkpLCBuZXcgVmlld1NuYXBzaG90KGUsIHQsIERvY3VtZW50U2V0LmVtcHR5U2V0KHQpLCBzLCBuLCByLCBcbiAgICAgICAgLyogc3luY1N0YXRlQ2hhbmdlZD0gKi8gITAsIFxuICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsIGkpO1xuICAgIH1cbiAgICBnZXQgaGFzUGVuZGluZ1dyaXRlcygpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLm11dGF0ZWRLZXlzLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIGlmICghKHRoaXMuZnJvbUNhY2hlID09PSBlLmZyb21DYWNoZSAmJiB0aGlzLmhhc0NhY2hlZFJlc3VsdHMgPT09IGUuaGFzQ2FjaGVkUmVzdWx0cyAmJiB0aGlzLnN5bmNTdGF0ZUNoYW5nZWQgPT09IGUuc3luY1N0YXRlQ2hhbmdlZCAmJiB0aGlzLm11dGF0ZWRLZXlzLmlzRXF1YWwoZS5tdXRhdGVkS2V5cykgJiYgX19QUklWQVRFX3F1ZXJ5RXF1YWxzKHRoaXMucXVlcnksIGUucXVlcnkpICYmIHRoaXMuZG9jcy5pc0VxdWFsKGUuZG9jcykgJiYgdGhpcy5vbGREb2NzLmlzRXF1YWwoZS5vbGREb2NzKSkpIHJldHVybiAhMTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuZG9jQ2hhbmdlcywgbiA9IGUuZG9jQ2hhbmdlcztcbiAgICAgICAgaWYgKHQubGVuZ3RoICE9PSBuLmxlbmd0aCkgcmV0dXJuICExO1xuICAgICAgICBmb3IgKGxldCBlID0gMDsgZSA8IHQubGVuZ3RoOyBlKyspIGlmICh0W2VdLnR5cGUgIT09IG5bZV0udHlwZSB8fCAhdFtlXS5kb2MuaXNFcXVhbChuW2VdLmRvYykpIHJldHVybiAhMTtcbiAgICAgICAgcmV0dXJuICEwO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSG9sZHMgdGhlIGxpc3RlbmVycyBhbmQgdGhlIGxhc3QgcmVjZWl2ZWQgVmlld1NuYXBzaG90IGZvciBhIHF1ZXJ5IGJlaW5nXG4gKiB0cmFja2VkIGJ5IEV2ZW50TWFuYWdlci5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcnNJbmZvIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5lYSA9IHZvaWQgMCwgdGhpcy50YSA9IFtdO1xuICAgIH1cbiAgICAvLyBIZWxwZXIgbWV0aG9kcyB0aGF0IGNoZWNrcyBpZiB0aGUgcXVlcnkgaGFzIGxpc3RlbmVycyB0aGF0IGxpc3RlbmluZyB0byByZW1vdGUgc3RvcmVcbiAgICBuYSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudGEuc29tZSgoZSA9PiBlLnJhKCkpKTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9FdmVudE1hbmFnZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5xdWVyaWVzID0gX19QUklWQVRFX25ld1F1ZXJpZXNPYmplY3RNYXAoKSwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgdGhpcy5pYSA9IG5ldyBTZXQ7XG4gICAgfVxuICAgIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgIWZ1bmN0aW9uIF9fUFJJVkFURV9lcnJvckFsbFRhcmdldHMoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBuLnF1ZXJpZXM7XG4gICAgICAgICAgICAvLyBQcmV2ZW50IGZ1cnRoZXIgYWNjZXNzIGJ5IGNsZWFyaW5nIE9iamVjdE1hcC5cbiAgICAgICAgICAgIG4ucXVlcmllcyA9IF9fUFJJVkFURV9uZXdRdWVyaWVzT2JqZWN0TWFwKCksIHIuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2Ygbi50YSkgZS5vbkVycm9yKHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENhbGwgYWxsIGdsb2JhbCBzbmFwc2hvdCBsaXN0ZW5lcnMgdGhhdCBoYXZlIGJlZW4gc2V0LlxuICAgICAgICAodGhpcywgbmV3IEZpcmVzdG9yZUVycm9yKEMuQUJPUlRFRCwgXCJGaXJlc3RvcmUgc2h1dHRpbmcgZG93blwiKSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcmllc09iamVjdE1hcCgpIHtcbiAgICByZXR1cm4gbmV3IE9iamVjdE1hcCgoZSA9PiBfX1BSSVZBVEVfY2Fub25pZnlRdWVyeShlKSksIF9fUFJJVkFURV9xdWVyeUVxdWFscyk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9ldmVudE1hbmFnZXJMaXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCByID0gMyAvKiBMaXN0ZW5lclNldHVwQWN0aW9uLk5vQWN0aW9uUmVxdWlyZWQgKi87XG4gICAgY29uc3QgaSA9IHQucXVlcnk7XG4gICAgbGV0IHMgPSBuLnF1ZXJpZXMuZ2V0KGkpO1xuICAgIHMgPyAhcy5uYSgpICYmIHQucmEoKSAmJiAoXG4gICAgLy8gUXVlcnkgaGFzIGJlZW4gbGlzdGVuaW5nIHRvIGxvY2FsIGNhY2hlLCBhbmQgdHJpZXMgdG8gYWRkIGEgbmV3IGxpc3RlbmVyIHNvdXJjZWQgZnJvbSB3YXRjaC5cbiAgICByID0gMiAvKiBMaXN0ZW5lclNldHVwQWN0aW9uLlJlcXVpcmVXYXRjaENvbm5lY3Rpb25Pbmx5ICovKSA6IChzID0gbmV3IF9fUFJJVkFURV9RdWVyeUxpc3RlbmVyc0luZm8sIFxuICAgIHIgPSB0LnJhKCkgPyAwIC8qIExpc3RlbmVyU2V0dXBBY3Rpb24uSW5pdGlhbGl6ZUxvY2FsTGlzdGVuQW5kUmVxdWlyZVdhdGNoQ29ubmVjdGlvbiAqLyA6IDEgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5Jbml0aWFsaXplTG9jYWxMaXN0ZW5Pbmx5ICovKTtcbiAgICB0cnkge1xuICAgICAgICBzd2l0Y2ggKHIpIHtcbiAgICAgICAgICBjYXNlIDAgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5Jbml0aWFsaXplTG9jYWxMaXN0ZW5BbmRSZXF1aXJlV2F0Y2hDb25uZWN0aW9uICovIDpcbiAgICAgICAgICAgIHMuZWEgPSBhd2FpdCBuLm9uTGlzdGVuKGksIFxuICAgICAgICAgICAgLyoqIGVuYWJsZVJlbW90ZUxpc3Rlbj0gKi8gITApO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDEgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5Jbml0aWFsaXplTG9jYWxMaXN0ZW5Pbmx5ICovIDpcbiAgICAgICAgICAgIHMuZWEgPSBhd2FpdCBuLm9uTGlzdGVuKGksIFxuICAgICAgICAgICAgLyoqIGVuYWJsZVJlbW90ZUxpc3Rlbj0gKi8gITEpO1xuICAgICAgICAgICAgYnJlYWs7XG5cbiAgICAgICAgICBjYXNlIDIgLyogTGlzdGVuZXJTZXR1cEFjdGlvbi5SZXF1aXJlV2F0Y2hDb25uZWN0aW9uT25seSAqLyA6XG4gICAgICAgICAgICBhd2FpdCBuLm9uRmlyc3RSZW1vdGVTdG9yZUxpc3RlbihpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV93cmFwSW5Vc2VyRXJyb3JJZlJlY292ZXJhYmxlKGUsIGBJbml0aWFsaXphdGlvbiBvZiBxdWVyeSAnJHtfX1BSSVZBVEVfc3RyaW5naWZ5UXVlcnkodC5xdWVyeSl9JyBmYWlsZWRgKTtcbiAgICAgICAgcmV0dXJuIHZvaWQgdC5vbkVycm9yKG4pO1xuICAgIH1cbiAgICBpZiAobi5xdWVyaWVzLnNldChpLCBzKSwgcy50YS5wdXNoKHQpLCBcbiAgICAvLyBSdW4gZ2xvYmFsIHNuYXBzaG90IGxpc3RlbmVycyBpZiBhIGNvbnNpc3RlbnQgc25hcHNob3QgaGFzIGJlZW4gZW1pdHRlZC5cbiAgICB0LnNhKG4ub25saW5lU3RhdGUpLCBzLmVhKSB7XG4gICAgICAgIHQub2Eocy5lYSkgJiYgX19QUklWQVRFX3JhaXNlU25hcHNob3RzSW5TeW5jRXZlbnQobik7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyVW5saXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gdC5xdWVyeTtcbiAgICBsZXQgaSA9IDMgLyogTGlzdGVuZXJSZW1vdmFsQWN0aW9uLk5vQWN0aW9uUmVxdWlyZWQgKi87XG4gICAgY29uc3QgcyA9IG4ucXVlcmllcy5nZXQocik7XG4gICAgaWYgKHMpIHtcbiAgICAgICAgY29uc3QgZSA9IHMudGEuaW5kZXhPZih0KTtcbiAgICAgICAgZSA+PSAwICYmIChzLnRhLnNwbGljZShlLCAxKSwgMCA9PT0gcy50YS5sZW5ndGggPyBpID0gdC5yYSgpID8gMCAvKiBMaXN0ZW5lclJlbW92YWxBY3Rpb24uVGVybWluYXRlTG9jYWxMaXN0ZW5BbmRSZXF1aXJlV2F0Y2hEaXNjb25uZWN0aW9uICovIDogMSAvKiBMaXN0ZW5lclJlbW92YWxBY3Rpb24uVGVybWluYXRlTG9jYWxMaXN0ZW5Pbmx5ICovIDogIXMubmEoKSAmJiB0LnJhKCkgJiYgKFxuICAgICAgICAvLyBUaGUgcmVtb3ZlZCBsaXN0ZW5lciBpcyB0aGUgbGFzdCBvbmUgdGhhdCBzb3VyY2VkIGZyb20gd2F0Y2guXG4gICAgICAgIGkgPSAyIC8qIExpc3RlbmVyUmVtb3ZhbEFjdGlvbi5SZXF1aXJlV2F0Y2hEaXNjb25uZWN0aW9uT25seSAqLykpO1xuICAgIH1cbiAgICBzd2l0Y2ggKGkpIHtcbiAgICAgIGNhc2UgMCAvKiBMaXN0ZW5lclJlbW92YWxBY3Rpb24uVGVybWluYXRlTG9jYWxMaXN0ZW5BbmRSZXF1aXJlV2F0Y2hEaXNjb25uZWN0aW9uICovIDpcbiAgICAgICAgcmV0dXJuIG4ucXVlcmllcy5kZWxldGUociksIG4ub25Vbmxpc3RlbihyLCBcbiAgICAgICAgLyoqIGRpc2FibGVSZW1vdGVMaXN0ZW49ICovICEwKTtcblxuICAgICAgY2FzZSAxIC8qIExpc3RlbmVyUmVtb3ZhbEFjdGlvbi5UZXJtaW5hdGVMb2NhbExpc3Rlbk9ubHkgKi8gOlxuICAgICAgICByZXR1cm4gbi5xdWVyaWVzLmRlbGV0ZShyKSwgbi5vblVubGlzdGVuKHIsIFxuICAgICAgICAvKiogZGlzYWJsZVJlbW90ZUxpc3Rlbj0gKi8gITEpO1xuXG4gICAgICBjYXNlIDIgLyogTGlzdGVuZXJSZW1vdmFsQWN0aW9uLlJlcXVpcmVXYXRjaERpc2Nvbm5lY3Rpb25Pbmx5ICovIDpcbiAgICAgICAgcmV0dXJuIG4ub25MYXN0UmVtb3RlU3RvcmVVbmxpc3RlbihyKTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uV2F0Y2hDaGFuZ2UoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGxldCByID0gITE7XG4gICAgZm9yIChjb25zdCBlIG9mIHQpIHtcbiAgICAgICAgY29uc3QgdCA9IGUucXVlcnksIGkgPSBuLnF1ZXJpZXMuZ2V0KHQpO1xuICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgZm9yIChjb25zdCB0IG9mIGkudGEpIHQub2EoZSkgJiYgKHIgPSAhMCk7XG4gICAgICAgICAgICBpLmVhID0gZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByICYmIF9fUFJJVkFURV9yYWlzZVNuYXBzaG90c0luU3luY0V2ZW50KG4pO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyT25XYXRjaEVycm9yKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgaSA9IHIucXVlcmllcy5nZXQodCk7XG4gICAgaWYgKGkpIGZvciAoY29uc3QgZSBvZiBpLnRhKSBlLm9uRXJyb3Iobik7XG4gICAgLy8gUmVtb3ZlIGFsbCBsaXN0ZW5lcnMuIE5PVEU6IFdlIGRvbid0IG5lZWQgdG8gY2FsbCBzeW5jRW5naW5lLnVubGlzdGVuKClcbiAgICAvLyBhZnRlciBhbiBlcnJvci5cbiAgICAgICAgci5xdWVyaWVzLmRlbGV0ZSh0KTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3JhaXNlU25hcHNob3RzSW5TeW5jRXZlbnQoZSkge1xuICAgIGUuaWEuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgIGUubmV4dCgpO1xuICAgIH0pKTtcbn1cblxudmFyIGp0LCBIdDtcblxuLyoqIExpc3RlbiB0byBib3RoIGNhY2hlIGFuZCBzZXJ2ZXIgY2hhbmdlcyAqL1xuKEh0ID0ganQgfHwgKGp0ID0ge30pKS5fYSA9IFwiZGVmYXVsdFwiLCBcbi8qKiBMaXN0ZW4gdG8gY2hhbmdlcyBpbiBjYWNoZSBvbmx5ICovXG5IdC5DYWNoZSA9IFwiY2FjaGVcIjtcblxuLyoqXG4gKiBRdWVyeUxpc3RlbmVyIHRha2VzIGEgc2VyaWVzIG9mIGludGVybmFsIHZpZXcgc25hcHNob3RzIGFuZCBkZXRlcm1pbmVzXG4gKiB3aGVuIHRvIHJhaXNlIHRoZSBldmVudC5cbiAqXG4gKiBJdCB1c2VzIGFuIE9ic2VydmVyIHRvIGRpc3BhdGNoIGV2ZW50cy5cbiAqL1xuY2xhc3MgX19QUklWQVRFX1F1ZXJ5TGlzdGVuZXIge1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IGUsIHRoaXMuYWEgPSB0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEluaXRpYWwgc25hcHNob3RzIChlLmcuIGZyb20gY2FjaGUpIG1heSBub3QgYmUgcHJvcGFnYXRlZCB0byB0aGUgd3JhcHBlZFxuICAgICAgICAgKiBvYnNlcnZlci4gVGhpcyBmbGFnIGlzIHNldCB0byB0cnVlIG9uY2Ugd2UndmUgYWN0dWFsbHkgcmFpc2VkIGFuIGV2ZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51YSA9ICExLCB0aGlzLmNhID0gbnVsbCwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgdGhpcy5vcHRpb25zID0gbiB8fCB7fTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQXBwbGllcyB0aGUgbmV3IFZpZXdTbmFwc2hvdCB0byB0aGlzIGxpc3RlbmVyLCByYWlzaW5nIGEgdXNlci1mYWNpbmcgZXZlbnRcbiAgICAgKiBpZiBhcHBsaWNhYmxlIChkZXBlbmRpbmcgb24gd2hhdCBjaGFuZ2VkLCB3aGV0aGVyIHRoZSB1c2VyIGhhcyBvcHRlZCBpbnRvXG4gICAgICogbWV0YWRhdGEtb25seSBjaGFuZ2VzLCBldGMuKS4gUmV0dXJucyB0cnVlIGlmIGEgdXNlci1mYWNpbmcgZXZlbnQgd2FzXG4gICAgICogaW5kZWVkIHJhaXNlZC5cbiAgICAgKi8gICAgb2EoZSkge1xuICAgICAgICBpZiAoIXRoaXMub3B0aW9ucy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzKSB7XG4gICAgICAgICAgICAvLyBSZW1vdmUgdGhlIG1ldGFkYXRhIG9ubHkgY2hhbmdlcy5cbiAgICAgICAgICAgIGNvbnN0IHQgPSBbXTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBlLmRvY0NoYW5nZXMpIDMgLyogQ2hhbmdlVHlwZS5NZXRhZGF0YSAqLyAhPT0gbi50eXBlICYmIHQucHVzaChuKTtcbiAgICAgICAgICAgIGUgPSBuZXcgVmlld1NuYXBzaG90KGUucXVlcnksIGUuZG9jcywgZS5vbGREb2NzLCB0LCBlLm11dGF0ZWRLZXlzLCBlLmZyb21DYWNoZSwgZS5zeW5jU3RhdGVDaGFuZ2VkLCBcbiAgICAgICAgICAgIC8qIGV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzPSAqLyAhMCwgZS5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBsZXQgdCA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy51YSA/IHRoaXMubGEoZSkgJiYgKHRoaXMuYWEubmV4dChlKSwgdCA9ICEwKSA6IHRoaXMuaGEoZSwgdGhpcy5vbmxpbmVTdGF0ZSkgJiYgKHRoaXMuUGEoZSksIFxuICAgICAgICB0ID0gITApLCB0aGlzLmNhID0gZSwgdDtcbiAgICB9XG4gICAgb25FcnJvcihlKSB7XG4gICAgICAgIHRoaXMuYWEuZXJyb3IoZSk7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIHdoZXRoZXIgYSBzbmFwc2hvdCB3YXMgcmFpc2VkLiAqLyAgICBzYShlKSB7XG4gICAgICAgIHRoaXMub25saW5lU3RhdGUgPSBlO1xuICAgICAgICBsZXQgdCA9ICExO1xuICAgICAgICByZXR1cm4gdGhpcy5jYSAmJiAhdGhpcy51YSAmJiB0aGlzLmhhKHRoaXMuY2EsIGUpICYmICh0aGlzLlBhKHRoaXMuY2EpLCB0ID0gITApLCBcbiAgICAgICAgdDtcbiAgICB9XG4gICAgaGEoZSwgdCkge1xuICAgICAgICAvLyBBbHdheXMgcmFpc2UgdGhlIGZpcnN0IGV2ZW50IHdoZW4gd2UncmUgc3luY2VkXG4gICAgICAgIGlmICghZS5mcm9tQ2FjaGUpIHJldHVybiAhMDtcbiAgICAgICAgLy8gQWx3YXlzIHJhaXNlIGV2ZW50IGlmIGxpc3RlbmluZyB0byBjYWNoZVxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5yYSgpKSByZXR1cm4gITA7XG4gICAgICAgIC8vIE5PVEU6IFdlIGNvbnNpZGVyIE9ubGluZVN0YXRlLlVua25vd24gYXMgb25saW5lIChpdCBzaG91bGQgYmVjb21lIE9mZmxpbmVcbiAgICAgICAgLy8gb3IgT25saW5lIGlmIHdlIHdhaXQgbG9uZyBlbm91Z2gpLlxuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovICE9PSB0O1xuICAgICAgICAvLyBEb24ndCByYWlzZSB0aGUgZXZlbnQgaWYgd2UncmUgb25saW5lLCBhcmVuJ3Qgc3luY2VkIHlldCAoY2hlY2tlZFxuICAgICAgICAvLyBhYm92ZSkgYW5kIGFyZSB3YWl0aW5nIGZvciBhIHN5bmMuXG4gICAgICAgICAgICAgICAgcmV0dXJuICghdGhpcy5vcHRpb25zLlRhIHx8ICFuKSAmJiAoIWUuZG9jcy5pc0VtcHR5KCkgfHwgZS5oYXNDYWNoZWRSZXN1bHRzIHx8IFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8gPT09IHQpO1xuICAgICAgICAvLyBSYWlzZSBkYXRhIGZyb20gY2FjaGUgaWYgd2UgaGF2ZSBhbnkgZG9jdW1lbnRzLCBoYXZlIGNhY2hlZCByZXN1bHRzIGJlZm9yZSxcbiAgICAgICAgLy8gb3Igd2UgYXJlIG9mZmxpbmUuXG4gICAgICAgIH1cbiAgICBsYShlKSB7XG4gICAgICAgIC8vIFdlIGRvbid0IG5lZWQgdG8gaGFuZGxlIGluY2x1ZGVEb2N1bWVudE1ldGFkYXRhQ2hhbmdlcyBoZXJlIGJlY2F1c2VcbiAgICAgICAgLy8gdGhlIE1ldGFkYXRhIG9ubHkgY2hhbmdlcyBoYXZlIGFscmVhZHkgYmVlbiBzdHJpcHBlZCBvdXQgaWYgbmVlZGVkLlxuICAgICAgICAvLyBBdCB0aGlzIHBvaW50IHRoZSBvbmx5IGNoYW5nZXMgd2Ugd2lsbCBzZWUgYXJlIHRoZSBvbmVzIHdlIHNob3VsZFxuICAgICAgICAvLyBwcm9wYWdhdGUuXG4gICAgICAgIGlmIChlLmRvY0NoYW5nZXMubGVuZ3RoID4gMCkgcmV0dXJuICEwO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jYSAmJiB0aGlzLmNhLmhhc1BlbmRpbmdXcml0ZXMgIT09IGUuaGFzUGVuZGluZ1dyaXRlcztcbiAgICAgICAgcmV0dXJuICEoIWUuc3luY1N0YXRlQ2hhbmdlZCAmJiAhdCkgJiYgITAgPT09IHRoaXMub3B0aW9ucy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzO1xuICAgICAgICAvLyBHZW5lcmFsbHkgd2Ugc2hvdWxkIGhhdmUgaGl0IG9uZSBvZiB0aGUgY2FzZXMgYWJvdmUsIGJ1dCBpdCdzIHBvc3NpYmxlXG4gICAgICAgIC8vIHRvIGdldCBoZXJlIGlmIHRoZXJlIHdlcmUgb25seSBtZXRhZGF0YSBkb2NDaGFuZ2VzIGFuZCB0aGV5IGdvdFxuICAgICAgICAvLyBzdHJpcHBlZCBvdXQuXG4gICAgICAgIH1cbiAgICBQYShlKSB7XG4gICAgICAgIGUgPSBWaWV3U25hcHNob3QuZnJvbUluaXRpYWxEb2N1bWVudHMoZS5xdWVyeSwgZS5kb2NzLCBlLm11dGF0ZWRLZXlzLCBlLmZyb21DYWNoZSwgZS5oYXNDYWNoZWRSZXN1bHRzKSwgXG4gICAgICAgIHRoaXMudWEgPSAhMCwgdGhpcy5hYS5uZXh0KGUpO1xuICAgIH1cbiAgICByYSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9ucy5zb3VyY2UgIT09IGp0LkNhY2hlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBjb21wbGV0ZSBlbGVtZW50IGluIHRoZSBidW5kbGUgc3RyZWFtLCB0b2dldGhlciB3aXRoIHRoZSBieXRlIGxlbmd0aCBpdFxuICogb2NjdXBpZXMgaW4gdGhlIHN0cmVhbS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfU2l6ZWRCdW5kbGVFbGVtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlLCBcbiAgICAvLyBIb3cgbWFueSBieXRlcyB0aGlzIGVsZW1lbnQgdGFrZXMgdG8gc3RvcmUgaW4gdGhlIGJ1bmRsZS5cbiAgICB0KSB7XG4gICAgICAgIHRoaXMuSWEgPSBlLCB0aGlzLmJ5dGVMZW5ndGggPSB0O1xuICAgIH1cbiAgICBFYSgpIHtcbiAgICAgICAgcmV0dXJuIFwibWV0YWRhdGFcIiBpbiB0aGlzLklhO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogSGVscGVyIHRvIGNvbnZlcnQgb2JqZWN0cyBmcm9tIGJ1bmRsZXMgdG8gbW9kZWwgb2JqZWN0cyBpbiB0aGUgU0RLLlxuICovIGNsYXNzIF9fUFJJVkFURV9CdW5kbGVDb252ZXJ0ZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IGU7XG4gICAgfVxuICAgIHBzKGUpIHtcbiAgICAgICAgcmV0dXJuIGZyb21OYW1lKHRoaXMuc2VyaWFsaXplciwgZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbnZlcnRzIGEgQnVuZGxlRG9jdW1lbnQgdG8gYSBNdXRhYmxlRG9jdW1lbnQuXG4gICAgICovICAgIHlzKGUpIHtcbiAgICAgICAgcmV0dXJuIGUubWV0YWRhdGEuZXhpc3RzID8gX19QUklWQVRFX2Zyb21Eb2N1bWVudCh0aGlzLnNlcmlhbGl6ZXIsIGUuZG9jdW1lbnQsICExKSA6IE11dGFibGVEb2N1bWVudC5uZXdOb0RvY3VtZW50KHRoaXMucHMoZS5tZXRhZGF0YS5uYW1lKSwgdGhpcy53cyhlLm1ldGFkYXRhLnJlYWRUaW1lKSk7XG4gICAgfVxuICAgIHdzKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9mcm9tVmVyc2lvbihlKTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBjbGFzcyB0byBwcm9jZXNzIHRoZSBlbGVtZW50cyBmcm9tIGEgYnVuZGxlLCBsb2FkIHRoZW0gaW50byBsb2NhbFxuICogc3RvcmFnZSBhbmQgcHJvdmlkZSBwcm9ncmVzcyB1cGRhdGUgd2hpbGUgbG9hZGluZy5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfQnVuZGxlTG9hZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGEgPSBlLCB0aGlzLmxvY2FsU3RvcmUgPSB0LCB0aGlzLnNlcmlhbGl6ZXIgPSBuLCBcbiAgICAgICAgLyoqIEJhdGNoZWQgcXVlcmllcyB0byBiZSBzYXZlZCBpbnRvIHN0b3JhZ2UgKi9cbiAgICAgICAgdGhpcy5xdWVyaWVzID0gW10sIFxuICAgICAgICAvKiogQmF0Y2hlZCBkb2N1bWVudHMgdG8gYmUgc2F2ZWQgaW50byBzdG9yYWdlICovXG4gICAgICAgIHRoaXMuZG9jdW1lbnRzID0gW10sIFxuICAgICAgICAvKiogVGhlIGNvbGxlY3Rpb24gZ3JvdXBzIGFmZmVjdGVkIGJ5IHRoaXMgYnVuZGxlLiAqL1xuICAgICAgICB0aGlzLmNvbGxlY3Rpb25Hcm91cHMgPSBuZXcgU2V0LCB0aGlzLnByb2dyZXNzID0gX19QUklWQVRFX2J1bmRsZUluaXRpYWxQcm9ncmVzcyhlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQWRkcyBhbiBlbGVtZW50IGZyb20gdGhlIGJ1bmRsZSB0byB0aGUgbG9hZGVyLlxuICAgICAqXG4gICAgICogUmV0dXJucyBhIG5ldyBwcm9ncmVzcyBpZiBhZGRpbmcgdGhlIGVsZW1lbnQgbGVhZHMgdG8gYSBuZXcgcHJvZ3Jlc3MsXG4gICAgICogb3RoZXJ3aXNlIHJldHVybnMgbnVsbC5cbiAgICAgKi8gICAgQWEoZSkge1xuICAgICAgICB0aGlzLnByb2dyZXNzLmJ5dGVzTG9hZGVkICs9IGUuYnl0ZUxlbmd0aDtcbiAgICAgICAgbGV0IHQgPSB0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZDtcbiAgICAgICAgaWYgKGUuSWEubmFtZWRRdWVyeSkgdGhpcy5xdWVyaWVzLnB1c2goZS5JYS5uYW1lZFF1ZXJ5KTsgZWxzZSBpZiAoZS5JYS5kb2N1bWVudE1ldGFkYXRhKSB7XG4gICAgICAgICAgICB0aGlzLmRvY3VtZW50cy5wdXNoKHtcbiAgICAgICAgICAgICAgICBtZXRhZGF0YTogZS5JYS5kb2N1bWVudE1ldGFkYXRhXG4gICAgICAgICAgICB9KSwgZS5JYS5kb2N1bWVudE1ldGFkYXRhLmV4aXN0cyB8fCArK3Q7XG4gICAgICAgICAgICBjb25zdCBuID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZS5JYS5kb2N1bWVudE1ldGFkYXRhLm5hbWUpO1xuICAgICAgICAgICAgdGhpcy5jb2xsZWN0aW9uR3JvdXBzLmFkZChuLmdldChuLmxlbmd0aCAtIDIpKTtcbiAgICAgICAgfSBlbHNlIGUuSWEuZG9jdW1lbnQgJiYgKHRoaXMuZG9jdW1lbnRzW3RoaXMuZG9jdW1lbnRzLmxlbmd0aCAtIDFdLmRvY3VtZW50ID0gZS5JYS5kb2N1bWVudCwgXG4gICAgICAgICsrdCk7XG4gICAgICAgIHJldHVybiB0ICE9PSB0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZCA/ICh0aGlzLnByb2dyZXNzLmRvY3VtZW50c0xvYWRlZCA9IHQsIFxuICAgICAgICBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnByb2dyZXNzKSkgOiBudWxsO1xuICAgIH1cbiAgICBSYShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBuZXcgTWFwLCBuID0gbmV3IF9fUFJJVkFURV9CdW5kbGVDb252ZXJ0ZXJJbXBsKHRoaXMuc2VyaWFsaXplcik7XG4gICAgICAgIGZvciAoY29uc3QgciBvZiBlKSBpZiAoci5tZXRhZGF0YS5xdWVyaWVzKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gbi5wcyhyLm1ldGFkYXRhLm5hbWUpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuIG9mIHIubWV0YWRhdGEucXVlcmllcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHIgPSAodC5nZXQobikgfHwgX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkpLmFkZChlKTtcbiAgICAgICAgICAgICAgICB0LnNldChuLCByKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlIHRoZSBwcm9ncmVzcyB0byAnU3VjY2VzcycgYW5kIHJldHVybiB0aGUgdXBkYXRlZCBwcm9ncmVzcy5cbiAgICAgKi8gICAgYXN5bmMgY29tcGxldGUoKSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUFwcGx5QnVuZGxlZERvY3VtZW50cyh0aGlzLmxvY2FsU3RvcmUsIG5ldyBfX1BSSVZBVEVfQnVuZGxlQ29udmVydGVySW1wbCh0aGlzLnNlcmlhbGl6ZXIpLCB0aGlzLmRvY3VtZW50cywgdGhpcy5kYS5pZCksIHQgPSB0aGlzLlJhKHRoaXMuZG9jdW1lbnRzKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHRoaXMucXVlcmllcykgYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVTYXZlTmFtZWRRdWVyeSh0aGlzLmxvY2FsU3RvcmUsIGUsIHQuZ2V0KGUubmFtZSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5wcm9ncmVzcy50YXNrU3RhdGUgPSBcIlN1Y2Nlc3NcIiwge1xuICAgICAgICAgICAgcHJvZ3Jlc3M6IHRoaXMucHJvZ3Jlc3MsXG4gICAgICAgICAgICBWYTogdGhpcy5jb2xsZWN0aW9uR3JvdXBzLFxuICAgICAgICAgICAgbWE6IGVcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGBMb2FkQnVuZGxlVGFza1Byb2dyZXNzYCByZXByZXNlbnRpbmcgdGhlIGluaXRpYWwgcHJvZ3Jlc3Mgb2ZcbiAqIGxvYWRpbmcgYSBidW5kbGUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2J1bmRsZUluaXRpYWxQcm9ncmVzcyhlKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgdGFza1N0YXRlOiBcIlJ1bm5pbmdcIixcbiAgICAgICAgZG9jdW1lbnRzTG9hZGVkOiAwLFxuICAgICAgICBieXRlc0xvYWRlZDogMCxcbiAgICAgICAgdG90YWxEb2N1bWVudHM6IGUudG90YWxEb2N1bWVudHMsXG4gICAgICAgIHRvdGFsQnl0ZXM6IGUudG90YWxCeXRlc1xuICAgIH07XG59XG5cbi8qKlxuICogUmV0dXJucyBhIGBMb2FkQnVuZGxlVGFza1Byb2dyZXNzYCByZXByZXNlbnRpbmcgdGhlIHByb2dyZXNzIHRoYXQgdGhlIGxvYWRpbmdcbiAqIGhhcyBzdWNjZWVkZWQuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBfX1BSSVZBVEVfQWRkZWRMaW1ib0RvY3VtZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMua2V5ID0gZTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9SZW1vdmVkTGltYm9Eb2N1bWVudCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmtleSA9IGU7XG4gICAgfVxufVxuXG4vKipcbiAqIFZpZXcgaXMgcmVzcG9uc2libGUgZm9yIGNvbXB1dGluZyB0aGUgZmluYWwgbWVyZ2VkIHRydXRoIG9mIHdoYXQgZG9jcyBhcmUgaW5cbiAqIGEgcXVlcnkuIEl0IGdldHMgbm90aWZpZWQgb2YgbG9jYWwgYW5kIHJlbW90ZSBjaGFuZ2VzIHRvIGRvY3MsIGFuZCBhcHBsaWVzXG4gKiB0aGUgcXVlcnkgZmlsdGVycyBhbmQgbGltaXRzIHRvIGRldGVybWluZSB0aGUgbW9zdCBjb3JyZWN0IHBvc3NpYmxlIHJlc3VsdHMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1ZpZXcge1xuICAgIGNvbnN0cnVjdG9yKGUsIFxuICAgIC8qKiBEb2N1bWVudHMgaW5jbHVkZWQgaW4gdGhlIHJlbW90ZSB0YXJnZXQgKi9cbiAgICB0KSB7XG4gICAgICAgIHRoaXMucXVlcnkgPSBlLCB0aGlzLmZhID0gdCwgdGhpcy5nYSA9IG51bGwsIHRoaXMuaGFzQ2FjaGVkUmVzdWx0cyA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZmxhZyB3aGV0aGVyIHRoZSB2aWV3IGlzIGN1cnJlbnQgd2l0aCB0aGUgYmFja2VuZC4gQSB2aWV3IGlzIGNvbnNpZGVyZWRcbiAgICAgICAgICogY3VycmVudCBhZnRlciBpdCBoYXMgc2VlbiB0aGUgY3VycmVudCBmbGFnIGZyb20gdGhlIGJhY2tlbmQgYW5kIGRpZCBub3RcbiAgICAgICAgICogbG9zZSBjb25zaXN0ZW5jeSB3aXRoaW4gdGhlIHdhdGNoIHN0cmVhbSAoZS5nLiBiZWNhdXNlIG9mIGFuIGV4aXN0ZW5jZVxuICAgICAgICAgKiBmaWx0ZXIgbWlzbWF0Y2gpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jdXJyZW50ID0gITEsIFxuICAgICAgICAvKiogRG9jdW1lbnRzIGluIHRoZSB2aWV3IGJ1dCBub3QgaW4gdGhlIHJlbW90ZSB0YXJnZXQgKi9cbiAgICAgICAgdGhpcy5wYSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCBcbiAgICAgICAgLyoqIERvY3VtZW50IEtleXMgdGhhdCBoYXZlIGxvY2FsIGNoYW5nZXMgKi9cbiAgICAgICAgdGhpcy5tdXRhdGVkS2V5cyA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLCB0aGlzLnlhID0gX19QUklWQVRFX25ld1F1ZXJ5Q29tcGFyYXRvcihlKSwgXG4gICAgICAgIHRoaXMud2EgPSBuZXcgRG9jdW1lbnRTZXQodGhpcy55YSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBzZXQgb2YgcmVtb3RlIGRvY3VtZW50cyB0aGF0IHRoZSBzZXJ2ZXIgaGFzIHRvbGQgdXMgYmVsb25ncyB0byB0aGUgdGFyZ2V0IGFzc29jaWF0ZWQgd2l0aFxuICAgICAqIHRoaXMgdmlldy5cbiAgICAgKi8gICAgZ2V0IFNhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5mYTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSXRlcmF0ZXMgb3ZlciBhIHNldCBvZiBkb2MgY2hhbmdlcywgYXBwbGllcyB0aGUgcXVlcnkgbGltaXQsIGFuZCBjb21wdXRlc1xuICAgICAqIHdoYXQgdGhlIG5ldyByZXN1bHRzIHNob3VsZCBiZSwgd2hhdCB0aGUgY2hhbmdlcyB3ZXJlLCBhbmQgd2hldGhlciB3ZSBtYXlcbiAgICAgKiBuZWVkIHRvIGdvIGJhY2sgdG8gdGhlIGxvY2FsIGNhY2hlIGZvciBtb3JlIHJlc3VsdHMuIERvZXMgbm90IG1ha2UgYW55XG4gICAgICogY2hhbmdlcyB0byB0aGUgdmlldy5cbiAgICAgKiBAcGFyYW0gZG9jQ2hhbmdlcyAtIFRoZSBkb2MgY2hhbmdlcyB0byBhcHBseSB0byB0aGlzIHZpZXcuXG4gICAgICogQHBhcmFtIHByZXZpb3VzQ2hhbmdlcyAtIElmIHRoaXMgaXMgYmVpbmcgY2FsbGVkIHdpdGggYSByZWZpbGwsIHRoZW4gc3RhcnRcbiAgICAgKiAgICAgICAgd2l0aCB0aGlzIHNldCBvZiBkb2NzIGFuZCBjaGFuZ2VzIGluc3RlYWQgb2YgdGhlIGN1cnJlbnQgdmlldy5cbiAgICAgKiBAcmV0dXJucyBhIG5ldyBzZXQgb2YgZG9jcywgY2hhbmdlcywgYW5kIHJlZmlsbCBmbGFnLlxuICAgICAqLyAgICBiYShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0ID8gdC5EYSA6IG5ldyBfX1BSSVZBVEVfRG9jdW1lbnRDaGFuZ2VTZXQsIHIgPSB0ID8gdC53YSA6IHRoaXMud2E7XG4gICAgICAgIGxldCBpID0gdCA/IHQubXV0YXRlZEtleXMgOiB0aGlzLm11dGF0ZWRLZXlzLCBzID0gciwgbyA9ICExO1xuICAgICAgICAvLyBUcmFjayB0aGUgbGFzdCBkb2MgaW4gYSAoZnVsbCkgbGltaXQuIFRoaXMgaXMgbmVjZXNzYXJ5LCBiZWNhdXNlIHNvbWVcbiAgICAgICAgLy8gdXBkYXRlIChhIGRlbGV0ZSwgb3IgYW4gdXBkYXRlIG1vdmluZyBhIGRvYyBwYXN0IHRoZSBvbGQgbGltaXQpIG1pZ2h0XG4gICAgICAgIC8vIG1lYW4gdGhlcmUgaXMgc29tZSBvdGhlciBkb2N1bWVudCBpbiB0aGUgbG9jYWwgY2FjaGUgdGhhdCBlaXRoZXIgc2hvdWxkXG4gICAgICAgIC8vIGNvbWUgKDEpIGJldHdlZW4gdGhlIG9sZCBsYXN0IGxpbWl0IGRvYyBhbmQgdGhlIG5ldyBsYXN0IGRvY3VtZW50LCBpbiB0aGVcbiAgICAgICAgLy8gY2FzZSBvZiB1cGRhdGVzLCBvciAoMikgYWZ0ZXIgdGhlIG5ldyBsYXN0IGRvY3VtZW50LCBpbiB0aGUgY2FzZSBvZlxuICAgICAgICAvLyBkZWxldGVzLiBTbyB3ZSBrZWVwIHRoaXMgZG9jIGF0IHRoZSBvbGQgbGltaXQgdG8gY29tcGFyZSB0aGUgdXBkYXRlcyB0by5cbiAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgc2hvdWxkIG5ldmVyIGdldCB1c2VkIGluIGEgcmVmaWxsICh3aGVuIHByZXZpb3VzQ2hhbmdlcyBpc1xuICAgICAgICAvLyBzZXQpLCBiZWNhdXNlIHRoZXJlIHdpbGwgb25seSBiZSBhZGRzIC0tIG5vIGRlbGV0ZXMgb3IgdXBkYXRlcy5cbiAgICAgICAgY29uc3QgXyA9IFwiRlwiIC8qIExpbWl0VHlwZS5GaXJzdCAqLyA9PT0gdGhpcy5xdWVyeS5saW1pdFR5cGUgJiYgci5zaXplID09PSB0aGlzLnF1ZXJ5LmxpbWl0ID8gci5sYXN0KCkgOiBudWxsLCBhID0gXCJMXCIgLyogTGltaXRUeXBlLkxhc3QgKi8gPT09IHRoaXMucXVlcnkubGltaXRUeXBlICYmIHIuc2l6ZSA9PT0gdGhpcy5xdWVyeS5saW1pdCA/IHIuZmlyc3QoKSA6IG51bGw7XG4gICAgICAgIC8vIERyb3AgZG9jdW1lbnRzIG91dCB0byBtZWV0IGxpbWl0L2xpbWl0VG9MYXN0IHJlcXVpcmVtZW50LlxuICAgICAgICBpZiAoZS5pbm9yZGVyVHJhdmVyc2FsKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdSA9IHIuZ2V0KGUpLCBjID0gX19QUklWQVRFX3F1ZXJ5TWF0Y2hlcyh0aGlzLnF1ZXJ5LCB0KSA/IHQgOiBudWxsLCBsID0gISF1ICYmIHRoaXMubXV0YXRlZEtleXMuaGFzKHUua2V5KSwgaCA9ICEhYyAmJiAoYy5oYXNMb2NhbE11dGF0aW9ucyB8fCBcbiAgICAgICAgICAgIC8vIFdlIG9ubHkgY29uc2lkZXIgY29tbWl0dGVkIG11dGF0aW9ucyBmb3IgZG9jdW1lbnRzIHRoYXQgd2VyZVxuICAgICAgICAgICAgLy8gbXV0YXRlZCBkdXJpbmcgdGhlIGxpZmV0aW1lIG9mIHRoZSB2aWV3LlxuICAgICAgICAgICAgdGhpcy5tdXRhdGVkS2V5cy5oYXMoYy5rZXkpICYmIGMuaGFzQ29tbWl0dGVkTXV0YXRpb25zKTtcbiAgICAgICAgICAgIGxldCBQID0gITE7XG4gICAgICAgICAgICAvLyBDYWxjdWxhdGUgY2hhbmdlXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodSAmJiBjKSB7XG4gICAgICAgICAgICAgICAgdS5kYXRhLmlzRXF1YWwoYy5kYXRhKSA/IGwgIT09IGggJiYgKG4udHJhY2soe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAzIC8qIENoYW5nZVR5cGUuTWV0YWRhdGEgKi8gLFxuICAgICAgICAgICAgICAgICAgICBkb2M6IGNcbiAgICAgICAgICAgICAgICB9KSwgUCA9ICEwKSA6IHRoaXMudmEodSwgYykgfHwgKG4udHJhY2soe1xuICAgICAgICAgICAgICAgICAgICB0eXBlOiAyIC8qIENoYW5nZVR5cGUuTW9kaWZpZWQgKi8gLFxuICAgICAgICAgICAgICAgICAgICBkb2M6IGNcbiAgICAgICAgICAgICAgICB9KSwgUCA9ICEwLCAoXyAmJiB0aGlzLnlhKGMsIF8pID4gMCB8fCBhICYmIHRoaXMueWEoYywgYSkgPCAwKSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBkb2MgbW92ZWQgZnJvbSBpbnNpZGUgdGhlIGxpbWl0IHRvIG91dHNpZGUgdGhlIGxpbWl0LlxuICAgICAgICAgICAgICAgIC8vIFRoYXQgbWVhbnMgdGhlcmUgbWF5IGJlIHNvbWUgb3RoZXIgZG9jIGluIHRoZSBsb2NhbCBjYWNoZVxuICAgICAgICAgICAgICAgIC8vIHRoYXQgc2hvdWxkIGJlIGluY2x1ZGVkIGluc3RlYWQuXG4gICAgICAgICAgICAgICAgbyA9ICEwKSk7XG4gICAgICAgICAgICB9IGVsc2UgIXUgJiYgYyA/IChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogY1xuICAgICAgICAgICAgfSksIFAgPSAhMCkgOiB1ICYmICFjICYmIChuLnRyYWNrKHtcbiAgICAgICAgICAgICAgICB0eXBlOiAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAsXG4gICAgICAgICAgICAgICAgZG9jOiB1XG4gICAgICAgICAgICB9KSwgUCA9ICEwLCAoXyB8fCBhKSAmJiAoXG4gICAgICAgICAgICAvLyBBIGRvYyB3YXMgcmVtb3ZlZCBmcm9tIGEgZnVsbCBsaW1pdCBxdWVyeS4gV2UnbGwgbmVlZCB0b1xuICAgICAgICAgICAgLy8gcmVxdWVyeSBmcm9tIHRoZSBsb2NhbCBjYWNoZSB0byBzZWUgaWYgd2Uga25vdyBhYm91dCBzb21lIG90aGVyXG4gICAgICAgICAgICAvLyBkb2MgdGhhdCBzaG91bGQgYmUgaW4gdGhlIHJlc3VsdHMuXG4gICAgICAgICAgICBvID0gITApKTtcbiAgICAgICAgICAgIFAgJiYgKGMgPyAocyA9IHMuYWRkKGMpLCBpID0gaCA/IGkuYWRkKGUpIDogaS5kZWxldGUoZSkpIDogKHMgPSBzLmRlbGV0ZShlKSwgaSA9IGkuZGVsZXRlKGUpKSk7XG4gICAgICAgIH0pKSwgbnVsbCAhPT0gdGhpcy5xdWVyeS5saW1pdCkgZm9yICg7cy5zaXplID4gdGhpcy5xdWVyeS5saW1pdDsgKSB7XG4gICAgICAgICAgICBjb25zdCBlID0gXCJGXCIgLyogTGltaXRUeXBlLkZpcnN0ICovID09PSB0aGlzLnF1ZXJ5LmxpbWl0VHlwZSA/IHMubGFzdCgpIDogcy5maXJzdCgpO1xuICAgICAgICAgICAgcyA9IHMuZGVsZXRlKGUua2V5KSwgaSA9IGkuZGVsZXRlKGUua2V5KSwgbi50cmFjayh7XG4gICAgICAgICAgICAgICAgdHlwZTogMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gLFxuICAgICAgICAgICAgICAgIGRvYzogZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHdhOiBzLFxuICAgICAgICAgICAgRGE6IG4sXG4gICAgICAgICAgICBsczogbyxcbiAgICAgICAgICAgIG11dGF0ZWRLZXlzOiBpXG4gICAgICAgIH07XG4gICAgfVxuICAgIHZhKGUsIHQpIHtcbiAgICAgICAgLy8gV2Ugc3VwcHJlc3MgdGhlIGluaXRpYWwgY2hhbmdlIGV2ZW50IGZvciBkb2N1bWVudHMgdGhhdCB3ZXJlIG1vZGlmaWVkIGFzXG4gICAgICAgIC8vIHBhcnQgb2YgYSB3cml0ZSBhY2tub3dsZWRnbWVudCAoZS5nLiB3aGVuIHRoZSB2YWx1ZSBvZiBhIHNlcnZlciB0cmFuc2Zvcm1cbiAgICAgICAgLy8gaXMgYXBwbGllZCkgYXMgV2F0Y2ggd2lsbCBzZW5kIHVzIHRoZSBzYW1lIGRvY3VtZW50IGFnYWluLlxuICAgICAgICAvLyBCeSBzdXBwcmVzc2luZyB0aGUgZXZlbnQsIHdlIG9ubHkgcmFpc2UgdHdvIHVzZXIgdmlzaWJsZSBldmVudHMgKG9uZSB3aXRoXG4gICAgICAgIC8vIGBoYXNQZW5kaW5nV3JpdGVzYCBhbmQgdGhlIGZpbmFsIHN0YXRlIG9mIHRoZSBkb2N1bWVudCkgaW5zdGVhZCBvZiB0aHJlZVxuICAgICAgICAvLyAob25lIHdpdGggYGhhc1BlbmRpbmdXcml0ZXNgLCB0aGUgbW9kaWZpZWQgZG9jdW1lbnQgd2l0aFxuICAgICAgICAvLyBgaGFzUGVuZGluZ1dyaXRlc2AgYW5kIHRoZSBmaW5hbCBzdGF0ZSBvZiB0aGUgZG9jdW1lbnQpLlxuICAgICAgICByZXR1cm4gZS5oYXNMb2NhbE11dGF0aW9ucyAmJiB0Lmhhc0NvbW1pdHRlZE11dGF0aW9ucyAmJiAhdC5oYXNMb2NhbE11dGF0aW9ucztcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBkYXRlcyB0aGUgdmlldyB3aXRoIHRoZSBnaXZlbiBWaWV3RG9jdW1lbnRDaGFuZ2VzIGFuZCBvcHRpb25hbGx5IHVwZGF0ZXNcbiAgICAgKiBsaW1ibyBkb2NzIGFuZCBzeW5jIHN0YXRlIGZyb20gdGhlIHByb3ZpZGVkIHRhcmdldCBjaGFuZ2UuXG4gICAgICogQHBhcmFtIGRvY0NoYW5nZXMgLSBUaGUgc2V0IG9mIGNoYW5nZXMgdG8gbWFrZSB0byB0aGUgdmlldydzIGRvY3MuXG4gICAgICogQHBhcmFtIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQgLSBXaGV0aGVyIHRvIHVwZGF0ZSBsaW1ibyBkb2N1bWVudHMgYmFzZWQgb25cbiAgICAgKiAgICAgICAgdGhpcyBjaGFuZ2UuXG4gICAgICogQHBhcmFtIHRhcmdldENoYW5nZSAtIEEgdGFyZ2V0IGNoYW5nZSB0byBhcHBseSBmb3IgY29tcHV0aW5nIGxpbWJvIGRvY3MgYW5kXG4gICAgICogICAgICAgIHN5bmMgc3RhdGUuXG4gICAgICogQHBhcmFtIHRhcmdldElzUGVuZGluZ1Jlc2V0IC0gV2hldGhlciB0aGUgdGFyZ2V0IGlzIHBlbmRpbmcgdG8gcmVzZXQgZHVlIHRvXG4gICAgICogICAgICAgIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guIElmIG5vdCBleHBsaWNpdGx5IHNwZWNpZmllZCwgaXQgaXMgdHJlYXRlZFxuICAgICAqICAgICAgICBlcXVpdmFsZW50bHkgdG8gYGZhbHNlYC5cbiAgICAgKiBAcmV0dXJucyBBIG5ldyBWaWV3Q2hhbmdlIHdpdGggdGhlIGdpdmVuIGRvY3MsIGNoYW5nZXMsIGFuZCBzeW5jIHN0YXRlLlxuICAgICAqL1xuICAgIC8vIFBPUlRJTkcgTk9URTogVGhlIGlPUy9BbmRyb2lkIGNsaWVudHMgYWx3YXlzIGNvbXB1dGUgbGltYm8gZG9jdW1lbnQgY2hhbmdlcy5cbiAgICBhcHBseUNoYW5nZXMoZSwgdCwgbiwgcikge1xuICAgICAgICBjb25zdCBpID0gdGhpcy53YTtcbiAgICAgICAgdGhpcy53YSA9IGUud2EsIHRoaXMubXV0YXRlZEtleXMgPSBlLm11dGF0ZWRLZXlzO1xuICAgICAgICAvLyBTb3J0IGNoYW5nZXMgYmFzZWQgb24gdHlwZSBhbmQgcXVlcnkgY29tcGFyYXRvclxuICAgICAgICBjb25zdCBzID0gZS5EYS5YXygpO1xuICAgICAgICBzLnNvcnQoKChlLCB0KSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfY29tcGFyZUNoYW5nZVR5cGUoZSwgdCkge1xuICAgICAgICAgICAgY29uc3Qgb3JkZXIgPSBlID0+IHtcbiAgICAgICAgICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgIGNhc2UgMCAvKiBDaGFuZ2VUeXBlLkFkZGVkICovIDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDE7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgICAgICAgICAgICAgIGNhc2UgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovIDpcbiAgICAgICAgICAgICAgICAgICAgLy8gQSBtZXRhZGF0YSBjaGFuZ2UgaXMgY29udmVydGVkIHRvIGEgbW9kaWZpZWQgY2hhbmdlIGF0IHRoZSBwdWJsaWNcbiAgICAgICAgICAgICAgICAgICAgLy8gYXBpIGxheWVyLiAgU2luY2Ugd2Ugc29ydCBieSBkb2N1bWVudCBrZXkgYW5kIHRoZW4gY2hhbmdlIHR5cGUsXG4gICAgICAgICAgICAgICAgICAgIC8vIG1ldGFkYXRhIGFuZCBtb2RpZmllZCBjaGFuZ2VzIG11c3QgYmUgc29ydGVkIGVxdWl2YWxlbnRseS5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDI7XG5cbiAgICAgICAgICAgICAgICAgIGNhc2UgMSAvKiBDaGFuZ2VUeXBlLlJlbW92ZWQgKi8gOlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMDtcblxuICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIG9yZGVyKGUpIC0gb3JkZXIodCk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKGUudHlwZSwgdC50eXBlKSB8fCB0aGlzLnlhKGUuZG9jLCB0LmRvYykpKSwgdGhpcy5DYShuKSwgciA9IG51bGwgIT0gciAmJiByO1xuICAgICAgICBjb25zdCBvID0gdCAmJiAhciA/IHRoaXMuRmEoKSA6IFtdLCBfID0gMCA9PT0gdGhpcy5wYS5zaXplICYmIHRoaXMuY3VycmVudCAmJiAhciA/IDEgLyogU3luY1N0YXRlLlN5bmNlZCAqLyA6IDAgLyogU3luY1N0YXRlLkxvY2FsICovICwgYSA9IF8gIT09IHRoaXMuZ2E7XG4gICAgICAgIC8vIFdlIGFyZSBhdCBzeW5jZWQgc3RhdGUgaWYgdGhlcmUgaXMgbm8gbGltYm8gZG9jcyBhcmUgd2FpdGluZyB0byBiZSByZXNvbHZlZCwgdmlldyBpcyBjdXJyZW50XG4gICAgICAgIC8vIHdpdGggdGhlIGJhY2tlbmQsIGFuZCB0aGUgcXVlcnkgaXMgbm90IHBlbmRpbmcgdG8gcmVzZXQgZHVlIHRvIGV4aXN0ZW5jZSBmaWx0ZXIgbWlzbWF0Y2guXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ2EgPSBfLCAwICE9PSBzLmxlbmd0aCB8fCBhKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHNuYXBzaG90OiBuZXcgVmlld1NuYXBzaG90KHRoaXMucXVlcnksIGUud2EsIGksIHMsIGUubXV0YXRlZEtleXMsIDAgLyogU3luY1N0YXRlLkxvY2FsICovID09PSBfLCBhLCBcbiAgICAgICAgICAgICAgICAvKiBleGNsdWRlc01ldGFkYXRhQ2hhbmdlcz0gKi8gITEsICEhbiAmJiBuLnJlc3VtZVRva2VuLmFwcHJveGltYXRlQnl0ZVNpemUoKSA+IDApLFxuICAgICAgICAgICAgICAgIE1hOiBvXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIC8vIG5vIGNoYW5nZXNcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIE1hOiBvXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFwcGxpZXMgYW4gT25saW5lU3RhdGUgY2hhbmdlIHRvIHRoZSB2aWV3LCBwb3RlbnRpYWxseSBnZW5lcmF0aW5nIGFcbiAgICAgKiBWaWV3Q2hhbmdlIGlmIHRoZSB2aWV3J3Mgc3luY1N0YXRlIGNoYW5nZXMgYXMgYSByZXN1bHQuXG4gICAgICovICAgIHNhKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY3VycmVudCAmJiBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovID09PSBlID8gKFxuICAgICAgICAvLyBJZiB3ZSdyZSBvZmZsaW5lLCBzZXQgYGN1cnJlbnRgIHRvIGZhbHNlIGFuZCB0aGVuIGNhbGwgYXBwbHlDaGFuZ2VzKClcbiAgICAgICAgLy8gdG8gcmVmcmVzaCBvdXIgc3luY1N0YXRlIGFuZCBnZW5lcmF0ZSBhIFZpZXdDaGFuZ2UgYXMgYXBwcm9wcmlhdGUuIFdlXG4gICAgICAgIC8vIGFyZSBndWFyYW50ZWVkIHRvIGdldCBhIG5ldyBUYXJnZXRDaGFuZ2UgdGhhdCBzZXRzIGBjdXJyZW50YCBiYWNrIHRvXG4gICAgICAgIC8vIHRydWUgb25jZSB0aGUgY2xpZW50IGlzIGJhY2sgb25saW5lLlxuICAgICAgICB0aGlzLmN1cnJlbnQgPSAhMSwgdGhpcy5hcHBseUNoYW5nZXMoe1xuICAgICAgICAgICAgd2E6IHRoaXMud2EsXG4gICAgICAgICAgICBEYTogbmV3IF9fUFJJVkFURV9Eb2N1bWVudENoYW5nZVNldCxcbiAgICAgICAgICAgIG11dGF0ZWRLZXlzOiB0aGlzLm11dGF0ZWRLZXlzLFxuICAgICAgICAgICAgbHM6ICExXG4gICAgICAgIH0sIFxuICAgICAgICAvKiBsaW1ib1Jlc29sdXRpb25FbmFibGVkPSAqLyAhMSkpIDoge1xuICAgICAgICAgICAgTWE6IFtdXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGUgZG9jIGZvciB0aGUgZ2l2ZW4ga2V5IHNob3VsZCBiZSBpbiBsaW1iby5cbiAgICAgKi8gICAgeGEoZSkge1xuICAgICAgICAvLyBJZiB0aGUgcmVtb3RlIGVuZCBzYXlzIGl0J3MgcGFydCBvZiB0aGlzIHF1ZXJ5LCBpdCdzIG5vdCBpbiBsaW1iby5cbiAgICAgICAgcmV0dXJuICF0aGlzLmZhLmhhcyhlKSAmJiAoXG4gICAgICAgIC8vIFRoZSBsb2NhbCBzdG9yZSBkb2Vzbid0IHRoaW5rIGl0J3MgYSByZXN1bHQsIHNvIGl0IHNob3VsZG4ndCBiZSBpbiBsaW1iby5cbiAgICAgICAgISF0aGlzLndhLmhhcyhlKSAmJiAhdGhpcy53YS5nZXQoZSkuaGFzTG9jYWxNdXRhdGlvbnMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGVzIHN5bmNlZERvY3VtZW50cywgY3VycmVudCwgYW5kIGxpbWJvIGRvY3MgYmFzZWQgb24gdGhlIGdpdmVuIGNoYW5nZS5cbiAgICAgKiBSZXR1cm5zIHRoZSBsaXN0IG9mIGNoYW5nZXMgdG8gd2hpY2ggZG9jcyBhcmUgaW4gbGltYm8uXG4gICAgICovICAgIENhKGUpIHtcbiAgICAgICAgZSAmJiAoZS5hZGRlZERvY3VtZW50cy5mb3JFYWNoKChlID0+IHRoaXMuZmEgPSB0aGlzLmZhLmFkZChlKSkpLCBlLm1vZGlmaWVkRG9jdW1lbnRzLmZvckVhY2goKGUgPT4ge30pKSwgXG4gICAgICAgIGUucmVtb3ZlZERvY3VtZW50cy5mb3JFYWNoKChlID0+IHRoaXMuZmEgPSB0aGlzLmZhLmRlbGV0ZShlKSkpLCB0aGlzLmN1cnJlbnQgPSBlLmN1cnJlbnQpO1xuICAgIH1cbiAgICBGYSgpIHtcbiAgICAgICAgLy8gV2UgY2FuIG9ubHkgZGV0ZXJtaW5lIGxpbWJvIGRvY3VtZW50cyB3aGVuIHdlJ3JlIGluLXN5bmMgd2l0aCB0aGUgc2VydmVyLlxuICAgICAgICBpZiAoIXRoaXMuY3VycmVudCkgcmV0dXJuIFtdO1xuICAgICAgICAvLyBUT0RPKGtsaW10KTogRG8gdGhpcyBpbmNyZW1lbnRhbGx5IHNvIHRoYXQgaXQncyBub3QgcXVhZHJhdGljIHdoZW5cbiAgICAgICAgLy8gdXBkYXRpbmcgbWFueSBkb2N1bWVudHMuXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IHRoaXMucGE7XG4gICAgICAgIHRoaXMucGEgPSBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSwgdGhpcy53YS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMueGEoZS5rZXkpICYmICh0aGlzLnBhID0gdGhpcy5wYS5hZGQoZS5rZXkpKTtcbiAgICAgICAgfSkpO1xuICAgICAgICAvLyBEaWZmIHRoZSBuZXcgbGltYm8gZG9jcyB3aXRoIHRoZSBvbGQgbGltYm8gZG9jcy5cbiAgICAgICAgY29uc3QgdCA9IFtdO1xuICAgICAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgIHRoaXMucGEuaGFzKGUpIHx8IHQucHVzaChuZXcgX19QUklWQVRFX1JlbW92ZWRMaW1ib0RvY3VtZW50KGUpKTtcbiAgICAgICAgfSkpLCB0aGlzLnBhLmZvckVhY2goKG4gPT4ge1xuICAgICAgICAgICAgZS5oYXMobikgfHwgdC5wdXNoKG5ldyBfX1BSSVZBVEVfQWRkZWRMaW1ib0RvY3VtZW50KG4pKTtcbiAgICAgICAgfSkpLCB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBVcGRhdGUgdGhlIGluLW1lbW9yeSBzdGF0ZSBvZiB0aGUgY3VycmVudCB2aWV3IHdpdGggdGhlIHN0YXRlIHJlYWQgZnJvbVxuICAgICAqIHBlcnNpc3RlbmNlLlxuICAgICAqXG4gICAgICogV2UgdXBkYXRlIHRoZSBxdWVyeSB2aWV3IHdoZW5ldmVyIGEgY2xpZW50J3MgcHJpbWFyeSBzdGF0dXMgY2hhbmdlczpcbiAgICAgKiAtIFdoZW4gYSBjbGllbnQgdHJhbnNpdGlvbnMgZnJvbSBwcmltYXJ5IHRvIHNlY29uZGFyeSwgaXQgY2FuIG1pc3NcbiAgICAgKiAgIExvY2FsU3RvcmFnZSB1cGRhdGVzIGFuZCBpdHMgcXVlcnkgdmlld3MgbWF5IHRlbXBvcmFyaWx5IG5vdCBiZVxuICAgICAqICAgc3luY2hyb25pemVkIHdpdGggdGhlIHN0YXRlIG9uIGRpc2suXG4gICAgICogLSBGb3Igc2Vjb25kYXJ5IHRvIHByaW1hcnkgdHJhbnNpdGlvbnMsIHRoZSBjbGllbnQgbmVlZHMgdG8gdXBkYXRlIHRoZSBsaXN0XG4gICAgICogICBvZiBgc3luY2VkRG9jdW1lbnRzYCBzaW5jZSBzZWNvbmRhcnkgY2xpZW50cyB1cGRhdGUgdGhlaXIgcXVlcnkgdmlld3NcbiAgICAgKiAgIGJhc2VkIHB1cmVseSBvbiBzeW50aGVzaXplZCBSZW1vdGVFdmVudHMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcXVlcnlSZXN1bHQuZG9jdW1lbnRzIC0gVGhlIGRvY3VtZW50cyB0aGF0IG1hdGNoIHRoZSBxdWVyeSBhY2NvcmRpbmdcbiAgICAgKiB0byB0aGUgTG9jYWxTdG9yZS5cbiAgICAgKiBAcGFyYW0gcXVlcnlSZXN1bHQucmVtb3RlS2V5cyAtIFRoZSBrZXlzIG9mIHRoZSBkb2N1bWVudHMgdGhhdCBtYXRjaCB0aGVcbiAgICAgKiBxdWVyeSBhY2NvcmRpbmcgdG8gdGhlIGJhY2tlbmQuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgVmlld0NoYW5nZSB0aGF0IHJlc3VsdGVkIGZyb20gdGhpcyBzeW5jaHJvbml6YXRpb24uXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBPYShlKSB7XG4gICAgICAgIHRoaXMuZmEgPSBlLmdzLCB0aGlzLnBhID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmJhKGUuZG9jdW1lbnRzKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYXBwbHlDaGFuZ2VzKHQsIC8qIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQ9ICovICEwKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIHZpZXcgc25hcHNob3QgYXMgaWYgdGhpcyBxdWVyeSB3YXMganVzdCBsaXN0ZW5lZCB0by4gQ29udGFpbnNcbiAgICAgKiBhIGRvY3VtZW50IGFkZCBmb3IgZXZlcnkgZXhpc3RpbmcgZG9jdW1lbnQgYW5kIHRoZSBgZnJvbUNhY2hlYCBhbmRcbiAgICAgKiBgaGFzUGVuZGluZ1dyaXRlc2Agc3RhdHVzIG9mIHRoZSBhbHJlYWR5IGVzdGFibGlzaGVkIHZpZXcuXG4gICAgICovXG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS10YWIgb25seS5cbiAgICBOYSgpIHtcbiAgICAgICAgcmV0dXJuIFZpZXdTbmFwc2hvdC5mcm9tSW5pdGlhbERvY3VtZW50cyh0aGlzLnF1ZXJ5LCB0aGlzLndhLCB0aGlzLm11dGF0ZWRLZXlzLCAwIC8qIFN5bmNTdGF0ZS5Mb2NhbCAqLyA9PT0gdGhpcy5nYSwgdGhpcy5oYXNDYWNoZWRSZXN1bHRzKTtcbiAgICB9XG59XG5cbmNvbnN0IEp0ID0gXCJTeW5jRW5naW5lXCI7XG5cbi8qKlxuICogUXVlcnlWaWV3IGNvbnRhaW5zIGFsbCBvZiB0aGUgZGF0YSB0aGF0IFN5bmNFbmdpbmUgbmVlZHMgdG8ga2VlcCB0cmFjayBvZiBmb3JcbiAqIGEgcGFydGljdWxhciBxdWVyeS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfUXVlcnlWaWV3IHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKipcbiAgICAgKiBUaGUgcXVlcnkgaXRzZWxmLlxuICAgICAqL1xuICAgIGUsIFxuICAgIC8qKlxuICAgICAqIFRoZSB0YXJnZXQgbnVtYmVyIGNyZWF0ZWQgYnkgdGhlIGNsaWVudCB0aGF0IGlzIHVzZWQgaW4gdGhlIHdhdGNoXG4gICAgICogc3RyZWFtIHRvIGlkZW50aWZ5IHRoaXMgcXVlcnkuXG4gICAgICovXG4gICAgdCwgXG4gICAgLyoqXG4gICAgICogVGhlIHZpZXcgaXMgcmVzcG9uc2libGUgZm9yIGNvbXB1dGluZyB0aGUgZmluYWwgbWVyZ2VkIHRydXRoIG9mIHdoYXRcbiAgICAgKiBkb2NzIGFyZSBpbiB0aGUgcXVlcnkuIEl0IGdldHMgbm90aWZpZWQgb2YgbG9jYWwgYW5kIHJlbW90ZSBjaGFuZ2VzLFxuICAgICAqIGFuZCBhcHBsaWVzIHRoZSBxdWVyeSBmaWx0ZXJzIGFuZCBsaW1pdHMgdG8gZGV0ZXJtaW5lIHRoZSBtb3N0IGNvcnJlY3RcbiAgICAgKiBwb3NzaWJsZSByZXN1bHRzLlxuICAgICAqL1xuICAgIG4pIHtcbiAgICAgICAgdGhpcy5xdWVyeSA9IGUsIHRoaXMudGFyZ2V0SWQgPSB0LCB0aGlzLnZpZXcgPSBuO1xuICAgIH1cbn1cblxuLyoqIFRyYWNrcyBhIGxpbWJvIHJlc29sdXRpb24uICovIGNsYXNzIExpbWJvUmVzb2x1dGlvbiB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmtleSA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogU2V0IHRvIHRydWUgb25jZSB3ZSd2ZSByZWNlaXZlZCBhIGRvY3VtZW50LiBUaGlzIGlzIHVzZWQgaW5cbiAgICAgICAgICogZ2V0UmVtb3RlS2V5c0ZvclRhcmdldCgpIGFuZCB1bHRpbWF0ZWx5IHVzZWQgYnkgV2F0Y2hDaGFuZ2VBZ2dyZWdhdG9yIHRvXG4gICAgICAgICAqIGRlY2lkZSB3aGV0aGVyIGl0IG5lZWRzIHRvIG1hbnVmYWN0dXJlIGEgZGVsZXRlIGV2ZW50IGZvciB0aGUgdGFyZ2V0IG9uY2VcbiAgICAgICAgICogdGhlIHRhcmdldCBpcyBDVVJSRU5ULlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5CYSA9ICExO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBgU3luY0VuZ2luZWAgY29vcmRpbmF0aW5nIHdpdGggb3RoZXIgcGFydHMgb2YgU0RLLlxuICpcbiAqIFRoZSBwYXJ0cyBvZiBTeW5jRW5naW5lIHRoYXQgYWN0IGFzIGEgY2FsbGJhY2sgdG8gUmVtb3RlU3RvcmUgbmVlZCB0byBiZVxuICogcmVnaXN0ZXJlZCBpbmRpdmlkdWFsbHkuIFRoaXMgaXMgZG9uZSBpbiBgc3luY0VuZ2luZVdyaXRlKClgIGFuZFxuICogYHN5bmNFbmdpbmVMaXN0ZW4oKWAgKGFzIHdlbGwgYXMgYGFwcGx5UHJpbWFyeVN0YXRlKClgKSBhcyB0aGVzZSBtZXRob2RzXG4gKiBzZXJ2ZSBhcyBlbnRyeSBwb2ludHMgdG8gUmVtb3RlU3RvcmUncyBmdW5jdGlvbmFsaXR5LlxuICpcbiAqIE5vdGU6IHNvbWUgZmllbGQgZGVmaW5lZCBpbiB0aGlzIGNsYXNzIG1pZ2h0IGhhdmUgcHVibGljIGFjY2VzcyBsZXZlbCwgYnV0XG4gKiB0aGUgY2xhc3MgaXMgbm90IGV4cG9ydGVkIHNvIHRoZXkgYXJlIG9ubHkgYWNjZXNzaWJsZSBmcm9tIHRoaXMgbW9kdWxlLlxuICogVGhpcyBpcyB1c2VmdWwgdG8gaW1wbGVtZW50IG9wdGlvbmFsIGZlYXR1cmVzIChsaWtlIGJ1bmRsZXMpIGluIGZyZWVcbiAqIGZ1bmN0aW9ucywgc3VjaCB0aGF0IHRoZXkgYXJlIHRyZWUtc2hha2VhYmxlLlxuICovIGNsYXNzIF9fUFJJVkFURV9TeW5jRW5naW5lSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgXG4gICAgLy8gUE9SVElORyBOT1RFOiBNYW5hZ2VzIHN0YXRlIHN5bmNocm9uaXphdGlvbiBpbiBtdWx0aS10YWIgZW52aXJvbm1lbnRzLlxuICAgIHIsIGksIHMpIHtcbiAgICAgICAgdGhpcy5sb2NhbFN0b3JlID0gZSwgdGhpcy5yZW1vdGVTdG9yZSA9IHQsIHRoaXMuZXZlbnRNYW5hZ2VyID0gbiwgdGhpcy5zaGFyZWRDbGllbnRTdGF0ZSA9IHIsIFxuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gaSwgdGhpcy5tYXhDb25jdXJyZW50TGltYm9SZXNvbHV0aW9ucyA9IHMsIHRoaXMuTGEgPSB7fSwgdGhpcy5rYSA9IG5ldyBPYmplY3RNYXAoKGUgPT4gX19QUklWQVRFX2Nhbm9uaWZ5UXVlcnkoZSkpLCBfX1BSSVZBVEVfcXVlcnlFcXVhbHMpLCBcbiAgICAgICAgdGhpcy5xYSA9IG5ldyBNYXAsIFxuICAgICAgICAvKipcbiAgICAgICAgICogVGhlIGtleXMgb2YgZG9jdW1lbnRzIHRoYXQgYXJlIGluIGxpbWJvIGZvciB3aGljaCB3ZSBoYXZlbid0IHlldCBzdGFydGVkIGFcbiAgICAgICAgICogbGltYm8gcmVzb2x1dGlvbiBxdWVyeS4gVGhlIHN0cmluZ3MgaW4gdGhpcyBzZXQgYXJlIHRoZSByZXN1bHQgb2YgY2FsbGluZ1xuICAgICAgICAgKiBga2V5LnBhdGguY2Fub25pY2FsU3RyaW5nKClgIHdoZXJlIGBrZXlgIGlzIGEgYERvY3VtZW50S2V5YCBvYmplY3QuXG4gICAgICAgICAqXG4gICAgICAgICAqIFRoZSBgU2V0YCB0eXBlIHdhcyBjaG9zZW4gYmVjYXVzZSBpdCBwcm92aWRlcyBlZmZpY2llbnQgbG9va3VwIGFuZCByZW1vdmFsXG4gICAgICAgICAqIG9mIGFyYml0cmFyeSBlbGVtZW50cyBhbmQgaXQgYWxzbyBtYWludGFpbnMgaW5zZXJ0aW9uIG9yZGVyLCBwcm92aWRpbmcgdGhlXG4gICAgICAgICAqIGRlc2lyZWQgcXVldWUtbGlrZSBGSUZPIHNlbWFudGljcy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuUWEgPSBuZXcgU2V0LCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEtlZXBzIHRyYWNrIG9mIHRoZSB0YXJnZXQgSUQgZm9yIGVhY2ggZG9jdW1lbnQgdGhhdCBpcyBpbiBsaW1ibyB3aXRoIGFuXG4gICAgICAgICAqIGFjdGl2ZSB0YXJnZXQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLiRhID0gbmV3IFNvcnRlZE1hcChEb2N1bWVudEtleS5jb21wYXJhdG9yKSwgXG4gICAgICAgIC8qKlxuICAgICAgICAgKiBLZWVwcyB0cmFjayBvZiB0aGUgaW5mb3JtYXRpb24gYWJvdXQgYW4gYWN0aXZlIGxpbWJvIHJlc29sdXRpb24gZm9yIGVhY2hcbiAgICAgICAgICogYWN0aXZlIHRhcmdldCBJRCB0aGF0IHdhcyBzdGFydGVkIGZvciB0aGUgcHVycG9zZSBvZiBsaW1ibyByZXNvbHV0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5VYSA9IG5ldyBNYXAsIHRoaXMuS2EgPSBuZXcgX19QUklWQVRFX1JlZmVyZW5jZVNldCwgXG4gICAgICAgIC8qKiBTdG9yZXMgdXNlciBjb21wbGV0aW9uIGhhbmRsZXJzLCBpbmRleGVkIGJ5IFVzZXIgYW5kIEJhdGNoSWQuICovXG4gICAgICAgIHRoaXMuV2EgPSB7fSwgXG4gICAgICAgIC8qKiBTdG9yZXMgdXNlciBjYWxsYmFja3Mgd2FpdGluZyBmb3IgYWxsIHBlbmRpbmcgd3JpdGVzIHRvIGJlIGFja25vd2xlZGdlZC4gKi9cbiAgICAgICAgdGhpcy5HYSA9IG5ldyBNYXAsIHRoaXMuemEgPSBfX1BSSVZBVEVfVGFyZ2V0SWRHZW5lcmF0b3IuS24oKSwgdGhpcy5vbmxpbmVTdGF0ZSA9IFwiVW5rbm93blwiIC8qIE9ubGluZVN0YXRlLlVua25vd24gKi8gLCBcbiAgICAgICAgLy8gVGhlIHByaW1hcnkgc3RhdGUgaXMgc2V0IHRvIGB0cnVlYCBvciBgZmFsc2VgIGltbWVkaWF0ZWx5IGFmdGVyIEZpcmVzdG9yZVxuICAgICAgICAvLyBzdGFydHVwLiBJbiB0aGUgaW50ZXJpbSwgYSBjbGllbnQgc2hvdWxkIG9ubHkgYmUgY29uc2lkZXJlZCBwcmltYXJ5IGlmXG4gICAgICAgIC8vIGBpc1ByaW1hcnlgIGlzIHRydWUuXG4gICAgICAgIHRoaXMuamEgPSB2b2lkIDA7XG4gICAgfVxuICAgIGdldCBpc1ByaW1hcnlDbGllbnQoKSB7XG4gICAgICAgIHJldHVybiAhMCA9PT0gdGhpcy5qYTtcbiAgICB9XG59XG5cbi8qKlxuICogSW5pdGlhdGVzIHRoZSBuZXcgbGlzdGVuLCByZXNvbHZlcyBwcm9taXNlIHdoZW4gbGlzdGVuIGVucXVldWVkIHRvIHRoZVxuICogc2VydmVyLiBBbGwgdGhlIHN1YnNlcXVlbnQgdmlldyBzbmFwc2hvdHMgb3IgZXJyb3JzIGFyZSBzZW50IHRvIHRoZVxuICogc3Vic2NyaWJlZCBoYW5kbGVycy4gUmV0dXJucyB0aGUgaW5pdGlhbCBzbmFwc2hvdC5cbiAqL1xuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVMaXN0ZW4oZSwgdCwgbiA9ICEwKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9lbnN1cmVXYXRjaENhbGxiYWNrcyhlKTtcbiAgICBsZXQgaTtcbiAgICBjb25zdCBzID0gci5rYS5nZXQodCk7XG4gICAgcmV0dXJuIHMgPyAoXG4gICAgLy8gUE9SVElORyBOT1RFOiBXaXRoIE11bHRpLVRhYiBXZWIsIGl0IGlzIHBvc3NpYmxlIHRoYXQgYSBxdWVyeSB2aWV3XG4gICAgLy8gYWxyZWFkeSBleGlzdHMgd2hlbiBFdmVudE1hbmFnZXIgY2FsbHMgdXMgZm9yIHRoZSBmaXJzdCB0aW1lLiBUaGlzXG4gICAgLy8gaGFwcGVucyB3aGVuIHRoZSBwcmltYXJ5IHRhYiBpcyBhbHJlYWR5IGxpc3RlbmluZyB0byB0aGlzIHF1ZXJ5IG9uXG4gICAgLy8gYmVoYWxmIG9mIGFub3RoZXIgdGFiIGFuZCB0aGUgdXNlciBvZiB0aGUgcHJpbWFyeSBhbHNvIHN0YXJ0cyBsaXN0ZW5pbmdcbiAgICAvLyB0byB0aGUgcXVlcnkuIEV2ZW50TWFuYWdlciB3aWxsIG5vdCBoYXZlIGFuIGFzc2lnbmVkIHRhcmdldCBJRCBpbiB0aGlzXG4gICAgLy8gY2FzZSBhbmQgY2FsbHMgYGxpc3RlbmAgdG8gb2J0YWluIHRoaXMgSUQuXG4gICAgci5zaGFyZWRDbGllbnRTdGF0ZS5hZGRMb2NhbFF1ZXJ5VGFyZ2V0KHMudGFyZ2V0SWQpLCBpID0gcy52aWV3Lk5hKCkpIDogaSA9IGF3YWl0IF9fUFJJVkFURV9hbGxvY2F0ZVRhcmdldEFuZE1heWJlTGlzdGVuKHIsIHQsIG4sIFxuICAgIC8qKiBzaG91bGRJbml0aWFsaXplVmlldz0gKi8gITApLCBpO1xufVxuXG4vKiogUXVlcnkgaGFzIGJlZW4gbGlzdGVuaW5nIHRvIHRoZSBjYWNoZSwgYW5kIHRyaWVzIHRvIGluaXRpYXRlIHRoZSByZW1vdGUgc3RvcmUgbGlzdGVuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV90cmlnZ2VyUmVtb3RlU3RvcmVMaXN0ZW4oZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZW5zdXJlV2F0Y2hDYWxsYmFja3MoZSk7XG4gICAgYXdhaXQgX19QUklWQVRFX2FsbG9jYXRlVGFyZ2V0QW5kTWF5YmVMaXN0ZW4obiwgdCwgXG4gICAgLyoqIHNob3VsZExpc3RlblRvUmVtb3RlPSAqLyAhMCwgXG4gICAgLyoqIHNob3VsZEluaXRpYWxpemVWaWV3PSAqLyAhMSk7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9hbGxvY2F0ZVRhcmdldEFuZE1heWJlTGlzdGVuKGUsIHQsIG4sIHIpIHtcbiAgICBjb25zdCBpID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChlLmxvY2FsU3RvcmUsIF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KHQpKSwgcyA9IGkudGFyZ2V0SWQsIG8gPSBlLnNoYXJlZENsaWVudFN0YXRlLmFkZExvY2FsUXVlcnlUYXJnZXQocywgbik7XG4gICAgbGV0IF87XG4gICAgcmV0dXJuIHIgJiYgKF8gPSBhd2FpdCBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QoZSwgdCwgcywgXCJjdXJyZW50XCIgPT09IG8sIGkucmVzdW1lVG9rZW4pKSwgXG4gICAgZS5pc1ByaW1hcnlDbGllbnQgJiYgbiAmJiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVMaXN0ZW4oZS5yZW1vdGVTdG9yZSwgaSksIF87XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGEgdmlldyBmb3IgYSBwcmV2aW91c2x5IHVua25vd24gcXVlcnkgYW5kIGNvbXB1dGVzIGl0cyBpbml0aWFsXG4gKiBzbmFwc2hvdC5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW5pdGlhbGl6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QoZSwgdCwgbiwgciwgaSkge1xuICAgIC8vIFBPUlRJTkcgTk9URTogT24gV2ViIG9ubHksIHdlIGluamVjdCB0aGUgY29kZSB0aGF0IHJlZ2lzdGVycyBuZXcgTGltYm9cbiAgICAvLyB0YXJnZXRzIGJhc2VkIG9uIHZpZXcgY2hhbmdlcy4gVGhpcyBhbGxvd3MgdXMgdG8gb25seSBkZXBlbmQgb24gTGltYm9cbiAgICAvLyBjaGFuZ2VzIHdoZW4gdXNlciBjb2RlIGluY2x1ZGVzIHF1ZXJpZXMuXG4gICAgZS5IYSA9ICh0LCBuLCByKSA9PiBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfYXBwbHlEb2NDaGFuZ2VzKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgbGV0IGkgPSB0LnZpZXcuYmEobik7XG4gICAgICAgIGkubHMgJiYgKFxuICAgICAgICAvLyBUaGUgcXVlcnkgaGFzIGEgbGltaXQgYW5kIHNvbWUgZG9jcyB3ZXJlIHJlbW92ZWQsIHNvIHdlIG5lZWRcbiAgICAgICAgLy8gdG8gcmUtcnVuIHRoZSBxdWVyeSBhZ2FpbnN0IHRoZSBsb2NhbCBzdG9yZSB0byBtYWtlIHN1cmUgd2VcbiAgICAgICAgLy8gZGlkbid0IGxvc2UgYW55IGdvb2QgZG9jcyB0aGF0IGhhZCBiZWVuIHBhc3QgdGhlIGxpbWl0LlxuICAgICAgICBpID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVFeGVjdXRlUXVlcnkoZS5sb2NhbFN0b3JlLCB0LnF1ZXJ5LCBcbiAgICAgICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMSkudGhlbigoKHtkb2N1bWVudHM6IGV9KSA9PiB0LnZpZXcuYmEoZSwgaSkpKSk7XG4gICAgICAgIGNvbnN0IHMgPSByICYmIHIudGFyZ2V0Q2hhbmdlcy5nZXQodC50YXJnZXRJZCksIG8gPSByICYmIG51bGwgIT0gci50YXJnZXRNaXNtYXRjaGVzLmdldCh0LnRhcmdldElkKSwgXyA9IHQudmlldy5hcHBseUNoYW5nZXMoaSwgXG4gICAgICAgIC8qIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQ9ICovIGUuaXNQcmltYXJ5Q2xpZW50LCBzLCBvKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV91cGRhdGVUcmFja2VkTGltYm9zKGUsIHQudGFyZ2V0SWQsIF8uTWEpLCBfLnNuYXBzaG90O1xuICAgIH0oZSwgdCwgbiwgcik7XG4gICAgY29uc3QgcyA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlRXhlY3V0ZVF1ZXJ5KGUubG9jYWxTdG9yZSwgdCwgXG4gICAgLyogdXNlUHJldmlvdXNSZXN1bHRzPSAqLyAhMCksIG8gPSBuZXcgX19QUklWQVRFX1ZpZXcodCwgcy5ncyksIF8gPSBvLmJhKHMuZG9jdW1lbnRzKSwgYSA9IFRhcmdldENoYW5nZS5jcmVhdGVTeW50aGVzaXplZFRhcmdldENoYW5nZUZvckN1cnJlbnRDaGFuZ2UobiwgciAmJiBcIk9mZmxpbmVcIiAvKiBPbmxpbmVTdGF0ZS5PZmZsaW5lICovICE9PSBlLm9ubGluZVN0YXRlLCBpKSwgdSA9IG8uYXBwbHlDaGFuZ2VzKF8sIFxuICAgIC8qIGxpbWJvUmVzb2x1dGlvbkVuYWJsZWQ9ICovIGUuaXNQcmltYXJ5Q2xpZW50LCBhKTtcbiAgICBfX1BSSVZBVEVfdXBkYXRlVHJhY2tlZExpbWJvcyhlLCBuLCB1Lk1hKTtcbiAgICBjb25zdCBjID0gbmV3IF9fUFJJVkFURV9RdWVyeVZpZXcodCwgbiwgbyk7XG4gICAgcmV0dXJuIGUua2Euc2V0KHQsIGMpLCBlLnFhLmhhcyhuKSA/IGUucWEuZ2V0KG4pLnB1c2godCkgOiBlLnFhLnNldChuLCBbIHQgXSksIHUuc25hcHNob3Q7XG59XG5cbi8qKiBTdG9wcyBsaXN0ZW5pbmcgdG8gdGhlIHF1ZXJ5LiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZVVubGlzdGVuKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgaSA9IHIua2EuZ2V0KHQpLCBzID0gci5xYS5nZXQoaS50YXJnZXRJZCk7XG4gICAgaWYgKHMubGVuZ3RoID4gMSkgcmV0dXJuIHIucWEuc2V0KGkudGFyZ2V0SWQsIHMuZmlsdGVyKChlID0+ICFfX1BSSVZBVEVfcXVlcnlFcXVhbHMoZSwgdCkpKSksIFxuICAgIHZvaWQgci5rYS5kZWxldGUodCk7XG4gICAgLy8gTm8gb3RoZXIgcXVlcmllcyBhcmUgbWFwcGVkIHRvIHRoZSB0YXJnZXQsIGNsZWFuIHVwIHRoZSBxdWVyeSBhbmQgdGhlIHRhcmdldC5cbiAgICAgICAgaWYgKHIuaXNQcmltYXJ5Q2xpZW50KSB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gcmVtb3ZlIHRoZSBsb2NhbCBxdWVyeSB0YXJnZXQgZmlyc3QgdG8gYWxsb3cgdXMgdG8gdmVyaWZ5XG4gICAgICAgIC8vIHdoZXRoZXIgYW55IG90aGVyIGNsaWVudCBpcyBzdGlsbCBpbnRlcmVzdGVkIGluIHRoaXMgdGFyZ2V0LlxuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLnJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoaS50YXJnZXRJZCk7XG4gICAgICAgIHIuc2hhcmVkQ2xpZW50U3RhdGUuaXNBY3RpdmVRdWVyeVRhcmdldChpLnRhcmdldElkKSB8fCBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQoci5sb2NhbFN0b3JlLCBpLnRhcmdldElkLCBcbiAgICAgICAgLyprZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YT0qLyAhMSkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgci5zaGFyZWRDbGllbnRTdGF0ZS5jbGVhclF1ZXJ5U3RhdGUoaS50YXJnZXRJZCksIG4gJiYgX19QUklWQVRFX3JlbW90ZVN0b3JlVW5saXN0ZW4oci5yZW1vdGVTdG9yZSwgaS50YXJnZXRJZCksIFxuICAgICAgICAgICAgX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQociwgaS50YXJnZXRJZCk7XG4gICAgICAgIH0pKS5jYXRjaChfX1BSSVZBVEVfaWdub3JlSWZQcmltYXJ5TGVhc2VMb3NzKTtcbiAgICB9IGVsc2UgX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQociwgaS50YXJnZXRJZCksIGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlUmVsZWFzZVRhcmdldChyLmxvY2FsU3RvcmUsIGkudGFyZ2V0SWQsIFxuICAgIC8qa2VlcFBlcnNpc3RlZFRhcmdldERhdGE9Ki8gITApO1xufVxuXG4vKiogVW5saXN0ZW5zIHRvIHRoZSByZW1vdGUgc3RvcmUgd2hpbGUgc3RpbGwgbGlzdGVuaW5nIHRvIHRoZSBjYWNoZS4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3RyaWdnZXJSZW1vdGVTdG9yZVVubGlzdGVuKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IG4ua2EuZ2V0KHQpLCBpID0gbi5xYS5nZXQoci50YXJnZXRJZCk7XG4gICAgbi5pc1ByaW1hcnlDbGllbnQgJiYgMSA9PT0gaS5sZW5ndGggJiYgKFxuICAgIC8vIFBPUlRJTkcgTk9URTogVW5yZWdpc3RlciB0aGUgdGFyZ2V0IElEIHdpdGggbG9jYWwgRmlyZXN0b3JlIGNsaWVudCBhc1xuICAgIC8vIHdhdGNoIHRhcmdldC5cbiAgICBuLnNoYXJlZENsaWVudFN0YXRlLnJlbW92ZUxvY2FsUXVlcnlUYXJnZXQoci50YXJnZXRJZCksIF9fUFJJVkFURV9yZW1vdGVTdG9yZVVubGlzdGVuKG4ucmVtb3RlU3RvcmUsIHIudGFyZ2V0SWQpKTtcbn1cblxuLyoqXG4gKiBJbml0aWF0ZXMgdGhlIHdyaXRlIG9mIGxvY2FsIG11dGF0aW9uIGJhdGNoIHdoaWNoIGludm9sdmVzIGFkZGluZyB0aGVcbiAqIHdyaXRlcyB0byB0aGUgbXV0YXRpb24gcXVldWUsIG5vdGlmeWluZyB0aGUgcmVtb3RlIHN0b3JlIGFib3V0IG5ld1xuICogbXV0YXRpb25zIGFuZCByYWlzaW5nIGV2ZW50cyBmb3IgYW55IGNoYW5nZXMgdGhpcyB3cml0ZSBjYXVzZWQuXG4gKlxuICogVGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhpcyBjYWxsIGlzIHJlc29sdmVkIHdoZW4gdGhlIGFib3ZlIHN0ZXBzXG4gKiBoYXZlIGNvbXBsZXRlZCwgKm5vdCogd2hlbiB0aGUgd3JpdGUgd2FzIGFja2VkIGJ5IHRoZSBiYWNrZW5kLiBUaGVcbiAqIHVzZXJDYWxsYmFjayBpcyByZXNvbHZlZCBvbmNlIHRoZSB3cml0ZSB3YXMgYWNrZWQvcmVqZWN0ZWQgYnkgdGhlXG4gKiBiYWNrZW5kIChvciBmYWlsZWQgbG9jYWxseSBmb3IgYW55IG90aGVyIHJlYXNvbikuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVXcml0ZShlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9zeW5jRW5naW5lRW5zdXJlV3JpdGVDYWxsYmFja3MoZSk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlV3JpdGVMb2NhbGx5KGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gVGltZXN0YW1wLm5vdygpLCBpID0gdC5yZWR1Y2UoKChlLCB0KSA9PiBlLmFkZCh0LmtleSkpLCBfX1BSSVZBVEVfZG9jdW1lbnRLZXlTZXQoKSk7XG4gICAgICAgICAgICBsZXQgcywgbztcbiAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiTG9jYWxseSB3cml0ZSBtdXRhdGlvbnNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4ge1xuICAgICAgICAgICAgICAgIC8vIEZpZ3VyZSBvdXQgd2hpY2gga2V5cyBkbyBub3QgaGF2ZSBhIHJlbW90ZSB2ZXJzaW9uIGluIHRoZSBjYWNoZSwgdGhpc1xuICAgICAgICAgICAgICAgIC8vIGlzIG5lZWRlZCB0byBjcmVhdGUgdGhlIHJpZ2h0IG92ZXJsYXkgbXV0YXRpb246IGlmIG5vIHJlbW90ZSB2ZXJzaW9uXG4gICAgICAgICAgICAgICAgLy8gcHJlc2VudHMsIHdlIGRvIG5vdCBuZWVkIHRvIGNyZWF0ZSBvdmVybGF5cyBhcyBwYXRjaCBtdXRhdGlvbnMuXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhPdmVybGF5KTogSXMgdGhlcmUgYSBiZXR0ZXIgd2F5IHRvIGRldGVybWluZSB0aGlzPyBVc2luZyB0aGVcbiAgICAgICAgICAgICAgICAvLyAgZG9jdW1lbnQgdmVyc2lvbiBkb2VzIG5vdCB3b3JrIGJlY2F1c2UgbG9jYWwgbXV0YXRpb25zIHNldCB0aGVtIGJhY2tcbiAgICAgICAgICAgICAgICAvLyAgdG8gMC5cbiAgICAgICAgICAgICAgICBsZXQgXyA9IF9fUFJJVkFURV9tdXRhYmxlRG9jdW1lbnRNYXAoKSwgYSA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLmRzLmdldEVudHJpZXMoZSwgaSkubmV4dCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIF8gPSBlLCBfLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmlzVmFsaWREb2N1bWVudCgpIHx8IChhID0gYS5hZGQoZSkpO1xuICAgICAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0T3ZlcmxheWVkRG9jdW1lbnRzKGUsIF8pKSkubmV4dCgoaSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHMgPSBpO1xuICAgICAgICAgICAgICAgICAgICAvLyBGb3Igbm9uLWlkZW1wb3RlbnQgbXV0YXRpb25zIChzdWNoIGFzIGBGaWVsZFZhbHVlLmluY3JlbWVudCgpYCksXG4gICAgICAgICAgICAgICAgICAgIC8vIHdlIHJlY29yZCB0aGUgYmFzZSBzdGF0ZSBpbiBhIHNlcGFyYXRlIHBhdGNoIG11dGF0aW9uLiBUaGlzIGlzXG4gICAgICAgICAgICAgICAgICAgIC8vIGxhdGVyIHVzZWQgdG8gZ3VhcmFudGVlIGNvbnNpc3RlbnQgdmFsdWVzIGFuZCBwcmV2ZW50cyBmbGlja2VyXG4gICAgICAgICAgICAgICAgICAgIC8vIGV2ZW4gaWYgdGhlIGJhY2tlbmQgc2VuZHMgdXMgYW4gdXBkYXRlIHRoYXQgYWxyZWFkeSBpbmNsdWRlcyBvdXJcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNmb3JtLlxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX211dGF0aW9uRXh0cmFjdEJhc2VWYWx1ZShlLCBzLmdldChlLmtleSkub3ZlcmxheWVkRG9jdW1lbnQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgbnVsbCAhPSB0ICYmIFxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTk9URTogVGhlIGJhc2Ugc3RhdGUgc2hvdWxkIG9ubHkgYmUgYXBwbGllZCBpZiB0aGVyZSdzIHNvbWVcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4aXN0aW5nIGRvY3VtZW50IHRvIG92ZXJyaWRlLCBzbyB1c2UgYSBQcmVjb25kaXRpb24gb2ZcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGV4aXN0cz10cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICBvLnB1c2gobmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUua2V5LCB0LCBfX1BSSVZBVEVfZXh0cmFjdEZpZWxkTWFzayh0LnZhbHVlLm1hcFZhbHVlKSwgUHJlY29uZGl0aW9uLmV4aXN0cyghMCkpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbi5tdXRhdGlvblF1ZXVlLmFkZE11dGF0aW9uQmF0Y2goZSwgciwgbywgdCk7XG4gICAgICAgICAgICAgICAgfSkpLm5leHQoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvID0gdDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IHQuYXBwbHlUb0xvY2FsRG9jdW1lbnRTZXQocywgYSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuLmRvY3VtZW50T3ZlcmxheUNhY2hlLnNhdmVPdmVybGF5cyhlLCB0LmJhdGNoSWQsIHIpO1xuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH0pKS50aGVuKCgoKSA9PiAoe1xuICAgICAgICAgICAgICAgIGJhdGNoSWQ6IG8uYmF0Y2hJZCxcbiAgICAgICAgICAgICAgICBjaGFuZ2VzOiBfX1BSSVZBVEVfY29udmVydE92ZXJsYXllZERvY3VtZW50TWFwVG9Eb2N1bWVudE1hcChzKVxuICAgICAgICAgICAgfSkpKTtcbiAgICAgICAgfShyLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLmFkZFBlbmRpbmdNdXRhdGlvbihlLmJhdGNoSWQpLCBmdW5jdGlvbiBfX1BSSVZBVEVfYWRkTXV0YXRpb25DYWxsYmFjayhlLCB0LCBuKSB7XG4gICAgICAgICAgICBsZXQgciA9IGUuV2FbZS5jdXJyZW50VXNlci50b0tleSgpXTtcbiAgICAgICAgICAgIHIgfHwgKHIgPSBuZXcgU29ydGVkTWFwKF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKSk7XG4gICAgICAgICAgICByID0gci5pbnNlcnQodCwgbiksIGUuV2FbZS5jdXJyZW50VXNlci50b0tleSgpXSA9IHI7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZXNvbHZlcyBvciByZWplY3RzIHRoZSB1c2VyIGNhbGxiYWNrIGZvciB0aGUgZ2l2ZW4gYmF0Y2ggYW5kIHRoZW4gZGlzY2FyZHNcbiAqIGl0LlxuICovIChyLCBlLmJhdGNoSWQsIG4pLCBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUociwgZS5jaGFuZ2VzKSwgXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZShyLnJlbW90ZVN0b3JlKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIC8vIElmIHdlIGNhbid0IHBlcnNpc3QgdGhlIG11dGF0aW9uLCB3ZSByZWplY3QgdGhlIHVzZXIgY2FsbGJhY2sgYW5kXG4gICAgICAgIC8vIGRvbid0IHNlbmQgdGhlIG11dGF0aW9uLiBUaGUgdXNlciBjYW4gdGhlbiByZXRyeSB0aGUgd3JpdGUuXG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCBcIkZhaWxlZCB0byBwZXJzaXN0IHdyaXRlXCIpO1xuICAgICAgICBuLnJlamVjdCh0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQXBwbGllcyBvbmUgcmVtb3RlIGV2ZW50IHRvIHRoZSBzeW5jIGVuZ2luZSwgbm90aWZ5aW5nIGFueSB2aWV3cyBvZiB0aGVcbiAqIGNoYW5nZXMsIGFuZCByZWxlYXNpbmcgYW55IHBlbmRpbmcgbXV0YXRpb24gYmF0Y2hlcyB0aGF0IHdvdWxkIGJlY29tZVxuICogdmlzaWJsZSBiZWNhdXNlIG9mIHRoZSBzbmFwc2hvdCB2ZXJzaW9uIHRoZSByZW1vdGUgZXZlbnQgY29udGFpbnMuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVJlbW90ZUV2ZW50KGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICB0cnkge1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBcHBseVJlbW90ZUV2ZW50VG9Mb2NhbENhY2hlKG4ubG9jYWxTdG9yZSwgdCk7XG4gICAgICAgIC8vIFVwZGF0ZSBgcmVjZWl2ZWREb2N1bWVudGAgYXMgYXBwcm9wcmlhdGUgZm9yIGFueSBsaW1ibyB0YXJnZXRzLlxuICAgICAgICAgICAgICAgIHQudGFyZ2V0Q2hhbmdlcy5mb3JFYWNoKCgoZSwgdCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgciA9IG4uVWEuZ2V0KHQpO1xuICAgICAgICAgICAgciAmJiAoXG4gICAgICAgICAgICAvLyBTaW5jZSB0aGlzIGlzIGEgbGltYm8gcmVzb2x1dGlvbiBsb29rdXAsIGl0J3MgZm9yIGEgc2luZ2xlIGRvY3VtZW50XG4gICAgICAgICAgICAvLyBhbmQgaXQgY291bGQgYmUgYWRkZWQsIG1vZGlmaWVkLCBvciByZW1vdmVkLCBidXQgbm90IGEgY29tYmluYXRpb24uXG4gICAgICAgICAgICBfX1BSSVZBVEVfaGFyZEFzc2VydChlLmFkZGVkRG9jdW1lbnRzLnNpemUgKyBlLm1vZGlmaWVkRG9jdW1lbnRzLnNpemUgKyBlLnJlbW92ZWREb2N1bWVudHMuc2l6ZSA8PSAxKSwgXG4gICAgICAgICAgICBlLmFkZGVkRG9jdW1lbnRzLnNpemUgPiAwID8gci5CYSA9ICEwIDogZS5tb2RpZmllZERvY3VtZW50cy5zaXplID4gMCA/IF9fUFJJVkFURV9oYXJkQXNzZXJ0KHIuQmEpIDogZS5yZW1vdmVkRG9jdW1lbnRzLnNpemUgPiAwICYmIChfX1BSSVZBVEVfaGFyZEFzc2VydChyLkJhKSwgXG4gICAgICAgICAgICByLkJhID0gITEpKTtcbiAgICAgICAgfSkpLCBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUobiwgZSwgdCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfaWdub3JlSWZQcmltYXJ5TGVhc2VMb3NzKGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBcHBsaWVzIGFuIE9ubGluZVN0YXRlIGNoYW5nZSB0byB0aGUgc3luYyBlbmdpbmUgYW5kIG5vdGlmaWVzIGFueSB2aWV3cyBvZlxuICogdGhlIGNoYW5nZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5T25saW5lU3RhdGVDaGFuZ2UoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIC8vIElmIHdlIGFyZSB0aGUgc2Vjb25kYXJ5IGNsaWVudCwgd2UgZXhwbGljaXRseSBpZ25vcmUgdGhlIHJlbW90ZSBzdG9yZSdzXG4gICAgLy8gb25saW5lIHN0YXRlICh0aGUgbG9jYWwgY2xpZW50IG1heSBnbyBvZmZsaW5lLCBldmVuIHRob3VnaCB0aGUgcHJpbWFyeVxuICAgIC8vIHRhYiByZW1haW5zIG9ubGluZSkgYW5kIG9ubHkgYXBwbHkgdGhlIHByaW1hcnkgdGFiJ3Mgb25saW5lIHN0YXRlIGZyb21cbiAgICAvLyBTaGFyZWRDbGllbnRTdGF0ZS5cbiAgICAgICAgaWYgKHIuaXNQcmltYXJ5Q2xpZW50ICYmIDAgLyogT25saW5lU3RhdGVTb3VyY2UuUmVtb3RlU3RvcmUgKi8gPT09IG4gfHwgIXIuaXNQcmltYXJ5Q2xpZW50ICYmIDEgLyogT25saW5lU3RhdGVTb3VyY2UuU2hhcmVkQ2xpZW50U3RhdGUgKi8gPT09IG4pIHtcbiAgICAgICAgY29uc3QgZSA9IFtdO1xuICAgICAgICByLmthLmZvckVhY2goKChuLCByKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBpID0gci52aWV3LnNhKHQpO1xuICAgICAgICAgICAgaS5zbmFwc2hvdCAmJiBlLnB1c2goaS5zbmFwc2hvdCk7XG4gICAgICAgIH0pKSwgZnVuY3Rpb24gX19QUklWQVRFX2V2ZW50TWFuYWdlck9uT25saW5lU3RhdGVDaGFuZ2UoZSwgdCkge1xuICAgICAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICBuLm9ubGluZVN0YXRlID0gdDtcbiAgICAgICAgICAgIGxldCByID0gITE7XG4gICAgICAgICAgICBuLnF1ZXJpZXMuZm9yRWFjaCgoKGUsIG4pID0+IHtcbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2Ygbi50YSkgXG4gICAgICAgICAgICAgICAgLy8gUnVuIGdsb2JhbCBzbmFwc2hvdCBsaXN0ZW5lcnMgaWYgYSBjb25zaXN0ZW50IHNuYXBzaG90IGhhcyBiZWVuIGVtaXR0ZWQuXG4gICAgICAgICAgICAgICAgZS5zYSh0KSAmJiAociA9ICEwKTtcbiAgICAgICAgICAgIH0pKSwgciAmJiBfX1BSSVZBVEVfcmFpc2VTbmFwc2hvdHNJblN5bmNFdmVudChuKTtcbiAgICAgICAgfShyLmV2ZW50TWFuYWdlciwgdCksIGUubGVuZ3RoICYmIHIuTGEucF8oZSksIHIub25saW5lU3RhdGUgPSB0LCByLmlzUHJpbWFyeUNsaWVudCAmJiByLnNoYXJlZENsaWVudFN0YXRlLnNldE9ubGluZVN0YXRlKHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWplY3RzIHRoZSBsaXN0ZW4gZm9yIHRoZSBnaXZlbiB0YXJnZXRJRC4gVGhpcyBjYW4gYmUgdHJpZ2dlcmVkIGJ5IHRoZVxuICogYmFja2VuZCBmb3IgYW55IGFjdGl2ZSB0YXJnZXQuXG4gKlxuICogQHBhcmFtIHN5bmNFbmdpbmUgLSBUaGUgc3luYyBlbmdpbmUgaW1wbGVtZW50YXRpb24uXG4gKiBAcGFyYW0gdGFyZ2V0SWQgLSBUaGUgdGFyZ2V0SUQgY29ycmVzcG9uZHMgdG8gb25lIHByZXZpb3VzbHkgaW5pdGlhdGVkIGJ5IHRoZVxuICogdXNlciBhcyBwYXJ0IG9mIFRhcmdldERhdGEgcGFzc2VkIHRvIGxpc3RlbigpIG9uIFJlbW90ZVN0b3JlLlxuICogQHBhcmFtIGVyciAtIEEgZGVzY3JpcHRpb24gb2YgdGhlIGNvbmRpdGlvbiB0aGF0IGhhcyBmb3JjZWQgdGhlIHJlamVjdGlvbi5cbiAqIE5lYXJseSBhbHdheXMgdGhpcyB3aWxsIGJlIGFuIGluZGljYXRpb24gdGhhdCB0aGUgdXNlciBpcyBubyBsb25nZXJcbiAqIGF1dGhvcml6ZWQgdG8gc2VlIHRoZSBkYXRhIG1hdGNoaW5nIHRoZSB0YXJnZXQuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVSZWplY3RMaXN0ZW4oZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktdGFiIG9ubHkuXG4gICAgICAgIHIuc2hhcmVkQ2xpZW50U3RhdGUudXBkYXRlUXVlcnlTdGF0ZSh0LCBcInJlamVjdGVkXCIsIG4pO1xuICAgIGNvbnN0IGkgPSByLlVhLmdldCh0KSwgcyA9IGkgJiYgaS5rZXk7XG4gICAgaWYgKHMpIHtcbiAgICAgICAgLy8gVE9ETyhrbGltdCk6IFdlIHJlYWxseSBvbmx5IHNob3VsZCBkbyB0aGUgZm9sbG93aW5nIG9uIHBlcm1pc3Npb25cbiAgICAgICAgLy8gZGVuaWVkIGVycm9ycywgYnV0IHdlIGRvbid0IGhhdmUgdGhlIGNhdXNlIGNvZGUgaGVyZS5cbiAgICAgICAgLy8gSXQncyBhIGxpbWJvIGRvYy4gQ3JlYXRlIGEgc3ludGhldGljIGV2ZW50IHNheWluZyBpdCB3YXMgZGVsZXRlZC5cbiAgICAgICAgLy8gVGhpcyBpcyBraW5kIG9mIGEgaGFjay4gSWRlYWxseSwgd2Ugd291bGQgaGF2ZSBhIG1ldGhvZCBpbiB0aGUgbG9jYWxcbiAgICAgICAgLy8gc3RvcmUgdG8gcHVyZ2UgYSBkb2N1bWVudC4gSG93ZXZlciwgaXQgd291bGQgYmUgdHJpY2t5IHRvIGtlZXAgYWxsIG9mXG4gICAgICAgIC8vIHRoZSBsb2NhbCBzdG9yZSdzIGludmFyaWFudHMgd2l0aCBhbm90aGVyIG1ldGhvZC5cbiAgICAgICAgbGV0IGUgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuICAgICAgICAvLyBUT0RPKGIvMjE3MTg5MjE2KTogVGhpcyBsaW1ibyBkb2N1bWVudCBzaG91bGQgaWRlYWxseSBoYXZlIGEgcmVhZCB0aW1lLFxuICAgICAgICAvLyBzbyB0aGF0IGl0IGlzIHBpY2tlZCB1cCBieSBhbnkgcmVhZC10aW1lIGJhc2VkIHNjYW5zLiBUaGUgYmFja2VuZCxcbiAgICAgICAgLy8gaG93ZXZlciwgZG9lcyBub3Qgc2VuZCBhIHJlYWQgdGltZSBmb3IgdGFyZ2V0IHJlbW92YWxzLlxuICAgICAgICAgICAgICAgIGUgPSBlLmluc2VydChzLCBNdXRhYmxlRG9jdW1lbnQubmV3Tm9Eb2N1bWVudChzLCBTbmFwc2hvdFZlcnNpb24ubWluKCkpKTtcbiAgICAgICAgY29uc3QgbiA9IF9fUFJJVkFURV9kb2N1bWVudEtleVNldCgpLmFkZChzKSwgaSA9IG5ldyBSZW1vdGVFdmVudChTbmFwc2hvdFZlcnNpb24ubWluKCksIFxuICAgICAgICAvKiB0YXJnZXRDaGFuZ2VzPSAqLyBuZXcgTWFwLCBcbiAgICAgICAgLyogdGFyZ2V0TWlzbWF0Y2hlcz0gKi8gbmV3IFNvcnRlZE1hcChfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvciksIGUsIG4pO1xuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5UmVtb3RlRXZlbnQociwgaSksIFxuICAgICAgICAvLyBTaW5jZSB0aGlzIHF1ZXJ5IGZhaWxlZCwgd2Ugd29uJ3Qgd2FudCB0byBtYW51YWxseSB1bmxpc3RlbiB0byBpdC5cbiAgICAgICAgLy8gV2Ugb25seSByZW1vdmUgaXQgZnJvbSBib29ra2VlcGluZyBhZnRlciB3ZSBzdWNjZXNzZnVsbHkgYXBwbGllZCB0aGVcbiAgICAgICAgLy8gUmVtb3RlRXZlbnQuIElmIGBhcHBseVJlbW90ZUV2ZW50KClgIHRocm93cywgd2Ugd2FudCB0byByZS1saXN0ZW4gdG9cbiAgICAgICAgLy8gdGhpcyBxdWVyeSB3aGVuIHRoZSBSZW1vdGVTdG9yZSByZXN0YXJ0cyB0aGUgV2F0Y2ggc3RyZWFtLCB3aGljaCBzaG91bGRcbiAgICAgICAgLy8gcmUtdHJpZ2dlciB0aGUgdGFyZ2V0IGZhaWx1cmUuXG4gICAgICAgIHIuJGEgPSByLiRhLnJlbW92ZShzKSwgci5VYS5kZWxldGUodCksIF9fUFJJVkFURV9wdW1wRW5xdWV1ZWRMaW1ib1Jlc29sdXRpb25zKHIpO1xuICAgIH0gZWxzZSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQoci5sb2NhbFN0b3JlLCB0LCBcbiAgICAvKiBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YSAqLyAhMSkudGhlbigoKCkgPT4gX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQociwgdCwgbikpKS5jYXRjaChfX1BSSVZBVEVfaWdub3JlSWZQcmltYXJ5TGVhc2VMb3NzKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVN1Y2Nlc3NmdWxXcml0ZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSB0LmJhdGNoLmJhdGNoSWQ7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQWNrbm93bGVkZ2VCYXRjaChuLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgbWF5IG9yIG1heSBub3QgYmUgYWJsZSB0byBhcHBseSB0aGUgd3JpdGUgcmVzdWx0IGFuZFxuICAgICAgICAvLyByYWlzZSBldmVudHMgaW1tZWRpYXRlbHkgKGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSB3YXRjaGVyIGlzIGNhdWdodFxuICAgICAgICAvLyB1cCksIHNvIHdlIHJhaXNlIHVzZXIgY2FsbGJhY2tzIGZpcnN0IHNvIHRoYXQgdGhleSBjb25zaXN0ZW50bHkgaGFwcGVuXG4gICAgICAgIC8vIGJlZm9yZSBsaXN0ZW4gZXZlbnRzLlxuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9wcm9jZXNzVXNlckNhbGxiYWNrKG4sIHIsIC8qZXJyb3I9Ki8gbnVsbCksIF9fUFJJVkFURV90cmlnZ2VyUGVuZGluZ1dyaXRlc0NhbGxiYWNrcyhuLCByKSwgXG4gICAgICAgIG4uc2hhcmVkQ2xpZW50U3RhdGUudXBkYXRlTXV0YXRpb25TdGF0ZShyLCBcImFja25vd2xlZGdlZFwiKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKG4sIGUpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhlKTtcbiAgICB9XG59XG5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lUmVqZWN0RmFpbGVkV3JpdGUoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlamVjdEJhdGNoKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJSZWplY3QgYmF0Y2hcIiwgXCJyZWFkd3JpdGUtcHJpbWFyeVwiLCAoZSA9PiB7XG4gICAgICAgICAgICAgICAgbGV0IHI7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ubXV0YXRpb25RdWV1ZS5sb29rdXBNdXRhdGlvbkJhdGNoKGUsIHQpLm5leHQoKHQgPT4gKF9fUFJJVkFURV9oYXJkQXNzZXJ0KG51bGwgIT09IHQpLCBcbiAgICAgICAgICAgICAgICByID0gdC5rZXlzKCksIG4ubXV0YXRpb25RdWV1ZS5yZW1vdmVNdXRhdGlvbkJhdGNoKGUsIHQpKSkpLm5leHQoKCgpID0+IG4ubXV0YXRpb25RdWV1ZS5wZXJmb3JtQ29uc2lzdGVuY3lDaGVjayhlKSkpLm5leHQoKCgpID0+IG4uZG9jdW1lbnRPdmVybGF5Q2FjaGUucmVtb3ZlT3ZlcmxheXNGb3JCYXRjaElkKGUsIHIsIHQpKSkubmV4dCgoKCkgPT4gbi5sb2NhbERvY3VtZW50cy5yZWNhbGN1bGF0ZUFuZFNhdmVPdmVybGF5c0ZvckRvY3VtZW50S2V5cyhlLCByKSkpLm5leHQoKCgpID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKGUsIHIpKSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBSZXR1cm5zIHRoZSBsYXJnZXN0IChsYXRlc3QpIGJhdGNoIGlkIGluIG11dGF0aW9uIHF1ZXVlIHRoYXQgaXMgcGVuZGluZ1xuICogc2VydmVyIHJlc3BvbnNlLlxuICpcbiAqIFJldHVybnMgYEJBVENISURfVU5LTk9XTmAgaWYgdGhlIHF1ZXVlIGlzIGVtcHR5LlxuICovIChyLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICAvLyBUaGUgbG9jYWwgc3RvcmUgbWF5IG9yIG1heSBub3QgYmUgYWJsZSB0byBhcHBseSB0aGUgd3JpdGUgcmVzdWx0IGFuZFxuICAgICAgICAvLyByYWlzZSBldmVudHMgaW1tZWRpYXRlbHkgKGRlcGVuZGluZyBvbiB3aGV0aGVyIHRoZSB3YXRjaGVyIGlzIGNhdWdodCB1cCksXG4gICAgICAgIC8vIHNvIHdlIHJhaXNlIHVzZXIgY2FsbGJhY2tzIGZpcnN0IHNvIHRoYXQgdGhleSBjb25zaXN0ZW50bHkgaGFwcGVuIGJlZm9yZVxuICAgICAgICAvLyBsaXN0ZW4gZXZlbnRzLlxuICAgICAgICAgICAgICAgIF9fUFJJVkFURV9wcm9jZXNzVXNlckNhbGxiYWNrKHIsIHQsIG4pLCBfX1BSSVZBVEVfdHJpZ2dlclBlbmRpbmdXcml0ZXNDYWxsYmFja3MociwgdCksIFxuICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZU11dGF0aW9uU3RhdGUodCwgXCJyZWplY3RlZFwiLCBuKSwgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKHIsIGUpO1xuICAgIH0gY2F0Y2ggKG4pIHtcbiAgICAgICAgYXdhaXQgX19QUklWQVRFX2lnbm9yZUlmUHJpbWFyeUxlYXNlTG9zcyhuKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGEgdXNlciBjYWxsYmFjayB0aGF0IHJlc29sdmVzIHdoZW4gYWxsIHBlbmRpbmcgbXV0YXRpb25zIGF0IHRoZSBtb21lbnQgb2YgY2FsbGluZ1xuICogYXJlIGFja25vd2xlZGdlZCAuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVSZWdpc3RlclBlbmRpbmdXcml0ZXNDYWxsYmFjayhlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgX19QUklWQVRFX2NhblVzZU5ldHdvcmsobi5yZW1vdGVTdG9yZSkgfHwgX19QUklWQVRFX2xvZ0RlYnVnKEp0LCBcIlRoZSBuZXR3b3JrIGlzIGRpc2FibGVkLiBUaGUgdGFzayByZXR1cm5lZCBieSAnYXdhaXRQZW5kaW5nV3JpdGVzKCknIHdpbGwgbm90IGNvbXBsZXRlIHVudGlsIHRoZSBuZXR3b3JrIGlzIGVuYWJsZWQuXCIpO1xuICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGUgPSBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICByZXR1cm4gdC5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBoaWdoZXN0IHVuYWNrbm93bGVkZ2VkIGJhdGNoIGlkXCIsIFwicmVhZG9ubHlcIiwgKGUgPT4gdC5tdXRhdGlvblF1ZXVlLmdldEhpZ2hlc3RVbmFja25vd2xlZGdlZEJhdGNoSWQoZSkpKTtcbiAgICAgICAgfShuLmxvY2FsU3RvcmUpO1xuICAgICAgICBpZiAoZSA9PT0gUSkgXG4gICAgICAgIC8vIFRyaWdnZXIgdGhlIGNhbGxiYWNrIHJpZ2h0IGF3YXkgaWYgdGhlcmUgaXMgbm8gcGVuZGluZyB3cml0ZXMgYXQgdGhlIG1vbWVudC5cbiAgICAgICAgcmV0dXJuIHZvaWQgdC5yZXNvbHZlKCk7XG4gICAgICAgIGNvbnN0IHIgPSBuLkdhLmdldChlKSB8fCBbXTtcbiAgICAgICAgci5wdXNoKHQpLCBuLkdhLnNldChlLCByKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCBcIkluaXRpYWxpemF0aW9uIG9mIHdhaXRGb3JQZW5kaW5nV3JpdGVzKCkgb3BlcmF0aW9uIGZhaWxlZFwiKTtcbiAgICAgICAgdC5yZWplY3Qobik7XG4gICAgfVxufVxuXG4vKipcbiAqIFRyaWdnZXJzIHRoZSBjYWxsYmFja3MgdGhhdCBhcmUgd2FpdGluZyBmb3IgdGhpcyBiYXRjaCBpZCB0byBnZXQgYWNrbm93bGVkZ2VkIGJ5IHNlcnZlcixcbiAqIGlmIHRoZXJlIGFyZSBhbnkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3RyaWdnZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2tzKGUsIHQpIHtcbiAgICAoZS5HYS5nZXQodCkgfHwgW10pLmZvckVhY2goKGUgPT4ge1xuICAgICAgICBlLnJlc29sdmUoKTtcbiAgICB9KSksIGUuR2EuZGVsZXRlKHQpO1xufVxuXG4vKiogUmVqZWN0IGFsbCBvdXRzdGFuZGluZyBjYWxsYmFja3Mgd2FpdGluZyBmb3IgcGVuZGluZyB3cml0ZXMgdG8gY29tcGxldGUuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9wcm9jZXNzVXNlckNhbGxiYWNrKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBsZXQgaSA9IHIuV2Fbci5jdXJyZW50VXNlci50b0tleSgpXTtcbiAgICAvLyBOT1RFOiBNdXRhdGlvbnMgcmVzdG9yZWQgZnJvbSBwZXJzaXN0ZW5jZSB3b24ndCBoYXZlIGNhbGxiYWNrcywgc28gaXQnc1xuICAgIC8vIG9rYXkgZm9yIHRoZXJlIHRvIGJlIG5vIGNhbGxiYWNrIGZvciB0aGlzIElELlxuICAgICAgICBpZiAoaSkge1xuICAgICAgICBjb25zdCBlID0gaS5nZXQodCk7XG4gICAgICAgIGUgJiYgKG4gPyBlLnJlamVjdChuKSA6IGUucmVzb2x2ZSgpLCBpID0gaS5yZW1vdmUodCkpLCByLldhW3IuY3VycmVudFVzZXIudG9LZXkoKV0gPSBpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQoZSwgdCwgbiA9IG51bGwpIHtcbiAgICBlLnNoYXJlZENsaWVudFN0YXRlLnJlbW92ZUxvY2FsUXVlcnlUYXJnZXQodCk7XG4gICAgZm9yIChjb25zdCByIG9mIGUucWEuZ2V0KHQpKSBlLmthLmRlbGV0ZShyKSwgbiAmJiBlLkxhLkphKHIsIG4pO1xuICAgIGlmIChlLnFhLmRlbGV0ZSh0KSwgZS5pc1ByaW1hcnlDbGllbnQpIHtcbiAgICAgICAgZS5LYS5icih0KS5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGUuS2EuY29udGFpbnNLZXkodCkgfHwgXG4gICAgICAgICAgICAvLyBXZSByZW1vdmVkIHRoZSBsYXN0IHJlZmVyZW5jZSBmb3IgdGhpcyBrZXlcbiAgICAgICAgICAgIF9fUFJJVkFURV9yZW1vdmVMaW1ib1RhcmdldChlLCB0KTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3JlbW92ZUxpbWJvVGFyZ2V0KGUsIHQpIHtcbiAgICBlLlFhLmRlbGV0ZSh0LnBhdGguY2Fub25pY2FsU3RyaW5nKCkpO1xuICAgIC8vIEl0J3MgcG9zc2libGUgdGhhdCB0aGUgdGFyZ2V0IGFscmVhZHkgZ290IHJlbW92ZWQgYmVjYXVzZSB0aGUgcXVlcnkgZmFpbGVkLiBJbiB0aGF0IGNhc2UsXG4gICAgLy8gdGhlIGtleSB3b24ndCBleGlzdCBpbiBgbGltYm9UYXJnZXRzQnlLZXlgLiBPbmx5IGRvIHRoZSBjbGVhbnVwIGlmIHdlIHN0aWxsIGhhdmUgdGhlIHRhcmdldC5cbiAgICBjb25zdCBuID0gZS4kYS5nZXQodCk7XG4gICAgbnVsbCAhPT0gbiAmJiAoX19QUklWQVRFX3JlbW90ZVN0b3JlVW5saXN0ZW4oZS5yZW1vdGVTdG9yZSwgbiksIGUuJGEgPSBlLiRhLnJlbW92ZSh0KSwgXG4gICAgZS5VYS5kZWxldGUobiksIF9fUFJJVkFURV9wdW1wRW5xdWV1ZWRMaW1ib1Jlc29sdXRpb25zKGUpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3VwZGF0ZVRyYWNrZWRMaW1ib3MoZSwgdCwgbikge1xuICAgIGZvciAoY29uc3QgciBvZiBuKSBpZiAociBpbnN0YW5jZW9mIF9fUFJJVkFURV9BZGRlZExpbWJvRG9jdW1lbnQpIGUuS2EuYWRkUmVmZXJlbmNlKHIua2V5LCB0KSwgXG4gICAgX19QUklWQVRFX3RyYWNrTGltYm9DaGFuZ2UoZSwgcik7IGVsc2UgaWYgKHIgaW5zdGFuY2VvZiBfX1BSSVZBVEVfUmVtb3ZlZExpbWJvRG9jdW1lbnQpIHtcbiAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKEp0LCBcIkRvY3VtZW50IG5vIGxvbmdlciBpbiBsaW1ibzogXCIgKyByLmtleSksIGUuS2EucmVtb3ZlUmVmZXJlbmNlKHIua2V5LCB0KTtcbiAgICAgICAgZS5LYS5jb250YWluc0tleShyLmtleSkgfHwgXG4gICAgICAgIC8vIFdlIHJlbW92ZWQgdGhlIGxhc3QgcmVmZXJlbmNlIGZvciB0aGlzIGtleVxuICAgICAgICBfX1BSSVZBVEVfcmVtb3ZlTGltYm9UYXJnZXQoZSwgci5rZXkpO1xuICAgIH0gZWxzZSBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV90cmFja0xpbWJvQ2hhbmdlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gdC5rZXksIHIgPSBuLnBhdGguY2Fub25pY2FsU3RyaW5nKCk7XG4gICAgZS4kYS5nZXQobikgfHwgZS5RYS5oYXMocikgfHwgKF9fUFJJVkFURV9sb2dEZWJ1ZyhKdCwgXCJOZXcgZG9jdW1lbnQgaW4gbGltYm86IFwiICsgbiksIFxuICAgIGUuUWEuYWRkKHIpLCBfX1BSSVZBVEVfcHVtcEVucXVldWVkTGltYm9SZXNvbHV0aW9ucyhlKSk7XG59XG5cbi8qKlxuICogU3RhcnRzIGxpc3RlbnMgZm9yIGRvY3VtZW50cyBpbiBsaW1ibyB0aGF0IGFyZSBlbnF1ZXVlZCBmb3IgcmVzb2x1dGlvbixcbiAqIHN1YmplY3QgdG8gYSBtYXhpbXVtIG51bWJlciBvZiBjb25jdXJyZW50IHJlc29sdXRpb25zLlxuICpcbiAqIFdpdGhvdXQgYm91bmRpbmcgdGhlIG51bWJlciBvZiBjb25jdXJyZW50IHJlc29sdXRpb25zLCB0aGUgc2VydmVyIGNhbiBmYWlsXG4gKiB3aXRoIFwicmVzb3VyY2UgZXhoYXVzdGVkXCIgZXJyb3JzIHdoaWNoIGNhbiBsZWFkIHRvIHBhdGhvbG9naWNhbCBjbGllbnRcbiAqIGJlaGF2aW9yIGFzIHNlZW4gaW4gaHR0cHM6Ly9naXRodWIuY29tL2ZpcmViYXNlL2ZpcmViYXNlLWpzLXNkay9pc3N1ZXMvMjY4My5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcHVtcEVucXVldWVkTGltYm9SZXNvbHV0aW9ucyhlKSB7XG4gICAgZm9yICg7ZS5RYS5zaXplID4gMCAmJiBlLiRhLnNpemUgPCBlLm1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zOyApIHtcbiAgICAgICAgY29uc3QgdCA9IGUuUWEudmFsdWVzKCkubmV4dCgpLnZhbHVlO1xuICAgICAgICBlLlFhLmRlbGV0ZSh0KTtcbiAgICAgICAgY29uc3QgbiA9IG5ldyBEb2N1bWVudEtleShSZXNvdXJjZVBhdGguZnJvbVN0cmluZyh0KSksIHIgPSBlLnphLm5leHQoKTtcbiAgICAgICAgZS5VYS5zZXQociwgbmV3IExpbWJvUmVzb2x1dGlvbihuKSksIGUuJGEgPSBlLiRhLmluc2VydChuLCByKSwgX19QUklWQVRFX3JlbW90ZVN0b3JlTGlzdGVuKGUucmVtb3RlU3RvcmUsIG5ldyBUYXJnZXREYXRhKF9fUFJJVkFURV9xdWVyeVRvVGFyZ2V0KF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgobi5wYXRoKSksIHIsIFwiVGFyZ2V0UHVycG9zZUxpbWJvUmVzb2x1dGlvblwiIC8qIFRhcmdldFB1cnBvc2UuTGltYm9SZXNvbHV0aW9uICovICwgX19QUklWQVRFX0xpc3RlblNlcXVlbmNlLmFlKSk7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCBpID0gW10sIHMgPSBbXSwgbyA9IFtdO1xuICAgIHIua2EuaXNFbXB0eSgpIHx8IChyLmthLmZvckVhY2goKChlLCBfKSA9PiB7XG4gICAgICAgIG8ucHVzaChyLkhhKF8sIHQsIG4pLnRoZW4oKGUgPT4ge1xuICAgICAgICAgICAgdmFyIHQ7XG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgY2hhbmdlcywgb3Igd2UgYXJlIGhhbmRsaW5nIGEgZ2xvYmFsIHNuYXBzaG90LCBub3RpZnlcbiAgICAgICAgICAgIC8vIHNlY29uZGFyeSBjbGllbnRzIHRvIHVwZGF0ZSBxdWVyeSBzdGF0ZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgoZSB8fCBuKSAmJiByLmlzUHJpbWFyeUNsaWVudCkge1xuICAgICAgICAgICAgICAgIC8vIFF1ZXJ5IHN0YXRlIGlzIHNldCB0byBgY3VycmVudGAgaWY6XG4gICAgICAgICAgICAgICAgLy8gLSBUaGVyZSBpcyBhIHZpZXcgY2hhbmdlIGFuZCBpdCBpcyB1cC10by1kYXRlLCBvcixcbiAgICAgICAgICAgICAgICAvLyAtIFRoZXJlIGlzIGEgZ2xvYmFsIHNuYXBzaG90LCB0aGUgVGFyZ2V0IGlzIGN1cnJlbnQsIGFuZCBubyBjaGFuZ2VzIHRvIGJlIHJlc29sdmVkXG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGUgPyAhZS5mcm9tQ2FjaGUgOiBudWxsID09PSAodCA9IG51bGwgPT0gbiA/IHZvaWQgMCA6IG4udGFyZ2V0Q2hhbmdlcy5nZXQoXy50YXJnZXRJZCkpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY3VycmVudDtcbiAgICAgICAgICAgICAgICByLnNoYXJlZENsaWVudFN0YXRlLnVwZGF0ZVF1ZXJ5U3RhdGUoXy50YXJnZXRJZCwgaSA/IFwiY3VycmVudFwiIDogXCJub3QtY3VycmVudFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFVwZGF0ZSB2aWV3cyBpZiB0aGVyZSBhcmUgYWN0dWFsIGNoYW5nZXMuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICAgIGkucHVzaChlKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX0xvY2FsVmlld0NoYW5nZXMuWWkoXy50YXJnZXRJZCwgZSk7XG4gICAgICAgICAgICAgICAgcy5wdXNoKHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KSkpO1xuICAgIH0pKSwgYXdhaXQgUHJvbWlzZS5hbGwobyksIHIuTGEucF8oaSksIGF3YWl0IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlTm90aWZ5TG9jYWxWaWV3Q2hhbmdlcyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgYXdhaXQgbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIm5vdGlmeUxvY2FsVmlld0NoYW5nZXNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godCwgKHQgPT4gUGVyc2lzdGVuY2VQcm9taXNlLmZvckVhY2godC5IaSwgKHIgPT4gbi5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZS5hZGRSZWZlcmVuY2UoZSwgdC50YXJnZXRJZCwgcikpKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2UuZm9yRWFjaCh0LkppLCAociA9PiBuLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLnJlbW92ZVJlZmVyZW5jZShlLCB0LnRhcmdldElkLCByKSkpKSkpKSkpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBpZiAoIV9fUFJJVkFURV9pc0luZGV4ZWREYlRyYW5zYWN0aW9uRXJyb3IoZSkpIHRocm93IGU7XG4gICAgICAgICAgICAvLyBJZiBgbm90aWZ5TG9jYWxWaWV3Q2hhbmdlc2AgZmFpbHMsIHdlIGRpZCBub3QgYWR2YW5jZSB0aGUgc2VxdWVuY2VcbiAgICAgICAgICAgIC8vIG51bWJlciBmb3IgdGhlIGRvY3VtZW50cyB0aGF0IHdlcmUgaW5jbHVkZWQgaW4gdGhpcyB0cmFuc2FjdGlvbi5cbiAgICAgICAgICAgIC8vIFRoaXMgbWlnaHQgdHJpZ2dlciB0aGVtIHRvIGJlIGRlbGV0ZWQgZWFybGllciB0aGFuIHRoZXkgb3RoZXJ3aXNlXG4gICAgICAgICAgICAvLyB3b3VsZCBoYXZlLCBidXQgaXQgc2hvdWxkIG5vdCBpbnZhbGlkYXRlIHRoZSBpbnRlZ3JpdHkgb2YgdGhlIGRhdGEuXG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoT3QsIFwiRmFpbGVkIHRvIHVwZGF0ZSBzZXF1ZW5jZSBudW1iZXJzOiBcIiArIGUpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gZS50YXJnZXRJZDtcbiAgICAgICAgICAgIGlmICghZS5mcm9tQ2FjaGUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBlID0gbi5Ucy5nZXQodCksIHIgPSBlLnNuYXBzaG90VmVyc2lvbiwgaSA9IGUud2l0aExhc3RMaW1ib0ZyZWVTbmFwc2hvdFZlcnNpb24ocik7XG4gICAgICAgICAgICAgICAgLy8gQWR2YW5jZSB0aGUgbGFzdCBsaW1ibyBmcmVlIHNuYXBzaG90IHZlcnNpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbi5UcyA9IG4uVHMuaW5zZXJ0KHQsIGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfShyLmxvY2FsU3RvcmUsIHMpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVIYW5kbGVDcmVkZW50aWFsQ2hhbmdlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBpZiAoIW4uY3VycmVudFVzZXIuaXNFcXVhbCh0KSkge1xuICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoSnQsIFwiVXNlciBjaGFuZ2UuIE5ldyB1c2VyOlwiLCB0LnRvS2V5KCkpO1xuICAgICAgICBjb25zdCBlID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVIYW5kbGVVc2VyQ2hhbmdlKG4ubG9jYWxTdG9yZSwgdCk7XG4gICAgICAgIG4uY3VycmVudFVzZXIgPSB0LCBcbiAgICAgICAgLy8gRmFpbHMgdGFza3Mgd2FpdGluZyBmb3IgcGVuZGluZyB3cml0ZXMgcmVxdWVzdGVkIGJ5IHByZXZpb3VzIHVzZXIuXG4gICAgICAgIGZ1bmN0aW9uIF9fUFJJVkFURV9yZWplY3RPdXRzdGFuZGluZ1BlbmRpbmdXcml0ZXNDYWxsYmFja3MoZSwgdCkge1xuICAgICAgICAgICAgZS5HYS5mb3JFYWNoKChlID0+IHtcbiAgICAgICAgICAgICAgICBlLmZvckVhY2goKGUgPT4ge1xuICAgICAgICAgICAgICAgICAgICBlLnJlamVjdChuZXcgRmlyZXN0b3JlRXJyb3IoQy5DQU5DRUxMRUQsIHQpKTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9KSksIGUuR2EuY2xlYXIoKTtcbiAgICAgICAgfShuLCBcIid3YWl0Rm9yUGVuZGluZ1dyaXRlcycgcHJvbWlzZSBpcyByZWplY3RlZCBkdWUgdG8gYSB1c2VyIGNoYW5nZS5cIiksIFxuICAgICAgICAvLyBUT0RPKGIvMTE0MjI2NDE3KTogQ29uc2lkZXIgY2FsbGluZyB0aGlzIG9ubHkgaW4gdGhlIHByaW1hcnkgdGFiLlxuICAgICAgICBuLnNoYXJlZENsaWVudFN0YXRlLmhhbmRsZVVzZXJDaGFuZ2UodCwgZS5yZW1vdmVkQmF0Y2hJZHMsIGUuYWRkZWRCYXRjaElkcyksIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShuLCBlLlJzKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lR2V0UmVtb3RlS2V5c0ZvclRhcmdldChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBuLlVhLmdldCh0KTtcbiAgICBpZiAociAmJiByLkJhKSByZXR1cm4gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCkuYWRkKHIua2V5KTtcbiAgICB7XG4gICAgICAgIGxldCBlID0gX19QUklWQVRFX2RvY3VtZW50S2V5U2V0KCk7XG4gICAgICAgIGNvbnN0IHIgPSBuLnFhLmdldCh0KTtcbiAgICAgICAgaWYgKCFyKSByZXR1cm4gZTtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHIpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBuLmthLmdldCh0KTtcbiAgICAgICAgICAgIGUgPSBlLnVuaW9uV2l0aChyLnZpZXcuU2EpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWNvbmNpbGUgdGhlIGxpc3Qgb2Ygc3luY2VkIGRvY3VtZW50cyBpbiBhbiBleGlzdGluZyB2aWV3IHdpdGggdGhvc2VcbiAqIGZyb20gcGVyc2lzdGVuY2UuXG4gKi8gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNocm9uaXplVmlld0FuZENvbXB1dGVTbmFwc2hvdChlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSksIHIgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUV4ZWN1dGVRdWVyeShuLmxvY2FsU3RvcmUsIHQucXVlcnksIFxuICAgIC8qIHVzZVByZXZpb3VzUmVzdWx0cz0gKi8gITApLCBpID0gdC52aWV3Lk9hKHIpO1xuICAgIHJldHVybiBuLmlzUHJpbWFyeUNsaWVudCAmJiBfX1BSSVZBVEVfdXBkYXRlVHJhY2tlZExpbWJvcyhuLCB0LnRhcmdldElkLCBpLk1hKSwgXG4gICAgaTtcbn1cblxuLyoqXG4gKiBSZXRyaWV2ZXMgbmV3bHkgY2hhbmdlZCBkb2N1bWVudHMgZnJvbSByZW1vdGUgZG9jdW1lbnQgY2FjaGUgYW5kIHJhaXNlc1xuICogc25hcHNob3RzIGlmIG5lZWRlZC5cbiAqL1xuLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbmFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lU3luY2hyb25pemVXaXRoQ2hhbmdlZERvY3VtZW50cyhlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TmV3RG9jdW1lbnRDaGFuZ2VzKG4ubG9jYWxTdG9yZSwgdCkudGhlbigoZSA9PiBfX1BSSVZBVEVfc3luY0VuZ2luZUVtaXROZXdTbmFwc0FuZE5vdGlmeUxvY2FsU3RvcmUobiwgZSkpKTtcbn1cblxuLyoqIEFwcGxpZXMgYSBtdXRhdGlvbiBzdGF0ZSB0byBhbiBleGlzdGluZyBiYXRjaC4gICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseUJhdGNoU3RhdGUoZSwgdCwgbiwgcikge1xuICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCBzID0gYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVMb29rdXBNdXRhdGlvbkRvY3VtZW50cyhlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gX19QUklWQVRFX2RlYnVnQ2FzdChuLm11dGF0aW9uUXVldWUpO1xuICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkxvb2t1cCBtdXRhdGlvbiBkb2N1bWVudHNcIiwgXCJyZWFkb25seVwiLCAoZSA9PiByLkxuKGUsIHQpLm5leHQoKHQgPT4gdCA/IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnRzKGUsIHQpIDogUGVyc2lzdGVuY2VQcm9taXNlLnJlc29sdmUobnVsbCkpKSkpO1xuICAgIH1cbiAgICAvLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuICAgIChpLmxvY2FsU3RvcmUsIHQpO1xuICAgIG51bGwgIT09IHMgPyAoXCJwZW5kaW5nXCIgPT09IG4gPyBcbiAgICAvLyBJZiB3ZSBhcmUgdGhlIHByaW1hcnkgY2xpZW50LCB3ZSBuZWVkIHRvIHNlbmQgdGhpcyB3cml0ZSB0byB0aGVcbiAgICAvLyBiYWNrZW5kLiBTZWNvbmRhcnkgY2xpZW50cyB3aWxsIGlnbm9yZSB0aGVzZSB3cml0ZXMgc2luY2UgdGhlaXIgcmVtb3RlXG4gICAgLy8gY29ubmVjdGlvbiBpcyBkaXNhYmxlZC5cbiAgICBhd2FpdCBfX1BSSVZBVEVfZmlsbFdyaXRlUGlwZWxpbmUoaS5yZW1vdGVTdG9yZSkgOiBcImFja25vd2xlZGdlZFwiID09PSBuIHx8IFwicmVqZWN0ZWRcIiA9PT0gbiA/IChcbiAgICAvLyBOT1RFOiBCb3RoIHRoZXNlIG1ldGhvZHMgYXJlIG5vLW9wcyBmb3IgYmF0Y2hlcyB0aGF0IG9yaWdpbmF0ZWQgZnJvbVxuICAgIC8vIG90aGVyIGNsaWVudHMuXG4gICAgX19QUklWQVRFX3Byb2Nlc3NVc2VyQ2FsbGJhY2soaSwgdCwgciB8fCBudWxsKSwgX19QUklWQVRFX3RyaWdnZXJQZW5kaW5nV3JpdGVzQ2FsbGJhY2tzKGksIHQpLCBcbiAgICBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbW92ZUNhY2hlZE11dGF0aW9uQmF0Y2hNZXRhZGF0YShlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9kZWJ1Z0Nhc3QoX19QUklWQVRFX2RlYnVnQ2FzdChlKS5tdXRhdGlvblF1ZXVlKS5xbih0KTtcbiAgICB9XG4gICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAoaS5sb2NhbFN0b3JlLCB0KSkgOiBmYWlsKCksIGF3YWl0IF9fUFJJVkFURV9zeW5jRW5naW5lRW1pdE5ld1NuYXBzQW5kTm90aWZ5TG9jYWxTdG9yZShpLCBzKSkgOiBcbiAgICAvLyBBIHRocm90dGxlZCB0YWIgbWF5IG5vdCBoYXZlIHNlZW4gdGhlIG11dGF0aW9uIGJlZm9yZSBpdCB3YXMgY29tcGxldGVkXG4gICAgLy8gYW5kIHJlbW92ZWQgZnJvbSB0aGUgbXV0YXRpb24gcXVldWUsIGluIHdoaWNoIGNhc2Ugd2Ugd29uJ3QgaGF2ZSBjYWNoZWRcbiAgICAvLyB0aGUgYWZmZWN0ZWQgZG9jdW1lbnRzLiBJbiB0aGlzIGNhc2Ugd2UgY2FuIHNhZmVseSBpZ25vcmUgdGhlIHVwZGF0ZVxuICAgIC8vIHNpbmNlIHRoYXQgbWVhbnMgd2UgZGlkbid0IGFwcGx5IHRoZSBtdXRhdGlvbiBsb2NhbGx5IGF0IGFsbCAoaWYgd2VcbiAgICAvLyBoYWQsIHdlIHdvdWxkIGhhdmUgY2FjaGVkIHRoZSBhZmZlY3RlZCBkb2N1bWVudHMpLCBhbmQgc28gd2Ugd2lsbCBqdXN0XG4gICAgLy8gc2VlIGFueSByZXN1bHRpbmcgZG9jdW1lbnQgY2hhbmdlcyB2aWEgbm9ybWFsIHJlbW90ZSBkb2N1bWVudCB1cGRhdGVzXG4gICAgLy8gYXMgYXBwbGljYWJsZS5cbiAgICBfX1BSSVZBVEVfbG9nRGVidWcoSnQsIFwiQ2Fubm90IGFwcGx5IG11dGF0aW9uIGJhdGNoIHdpdGggaWQ6IFwiICsgdCk7XG59XG5cbi8qKiBBcHBsaWVzIGEgcXVlcnkgdGFyZ2V0IGNoYW5nZSBmcm9tIGEgZGlmZmVyZW50IHRhYi4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5UHJpbWFyeVN0YXRlKGUsIHQpIHtcbiAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICBpZiAoX19QUklWQVRFX2Vuc3VyZVdhdGNoQ2FsbGJhY2tzKG4pLCBfX1BSSVZBVEVfc3luY0VuZ2luZUVuc3VyZVdyaXRlQ2FsbGJhY2tzKG4pLCBcbiAgICAhMCA9PT0gdCAmJiAhMCAhPT0gbi5qYSkge1xuICAgICAgICAvLyBTZWNvbmRhcnkgdGFicyBvbmx5IG1haW50YWluIFZpZXdzIGZvciB0aGVpciBsb2NhbCBsaXN0ZW5lcnMgYW5kIHRoZVxuICAgICAgICAvLyBWaWV3cyBpbnRlcm5hbCBzdGF0ZSBtYXkgbm90IGJlIDEwMCUgcG9wdWxhdGVkIChpbiBwYXJ0aWN1bGFyXG4gICAgICAgIC8vIHNlY29uZGFyeSB0YWJzIGRvbid0IHRyYWNrIHN5bmNlZERvY3VtZW50cywgdGhlIHNldCBvZiBkb2N1bWVudHMgdGhlXG4gICAgICAgIC8vIHNlcnZlciBjb25zaWRlcnMgdG8gYmUgaW4gdGhlIHRhcmdldCkuIFNvIHdoZW4gYSBzZWNvbmRhcnkgYmVjb21lc1xuICAgICAgICAvLyBwcmltYXJ5LCB3ZSBuZWVkIHRvIG5lZWQgdG8gbWFrZSBzdXJlIHRoYXQgYWxsIHZpZXdzIGZvciBhbGwgdGFyZ2V0c1xuICAgICAgICAvLyBtYXRjaCB0aGUgc3RhdGUgb24gZGlzay5cbiAgICAgICAgY29uc3QgZSA9IG4uc2hhcmVkQ2xpZW50U3RhdGUuZ2V0QWxsQWN0aXZlUXVlcnlUYXJnZXRzKCksIHQgPSBhd2FpdCBfX1BSSVZBVEVfc3luY2hyb25pemVRdWVyeVZpZXdzQW5kUmFpc2VTbmFwc2hvdHMobiwgZS50b0FycmF5KCkpO1xuICAgICAgICBuLmphID0gITAsIGF3YWl0IF9fUFJJVkFURV9yZW1vdGVTdG9yZUFwcGx5UHJpbWFyeVN0YXRlKG4ucmVtb3RlU3RvcmUsICEwKTtcbiAgICAgICAgZm9yIChjb25zdCBlIG9mIHQpIF9fUFJJVkFURV9yZW1vdGVTdG9yZUxpc3RlbihuLnJlbW90ZVN0b3JlLCBlKTtcbiAgICB9IGVsc2UgaWYgKCExID09PSB0ICYmICExICE9PSBuLmphKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgbGV0IHQgPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgbi5xYS5mb3JFYWNoKCgociwgaSkgPT4ge1xuICAgICAgICAgICAgbi5zaGFyZWRDbGllbnRTdGF0ZS5pc0xvY2FsUXVlcnlUYXJnZXQoaSkgPyBlLnB1c2goaSkgOiB0ID0gdC50aGVuKCgoKSA9PiAoX19QUklWQVRFX3JlbW92ZUFuZENsZWFudXBUYXJnZXQobiwgaSksIFxuICAgICAgICAgICAgX19QUklWQVRFX2xvY2FsU3RvcmVSZWxlYXNlVGFyZ2V0KG4ubG9jYWxTdG9yZSwgaSwgXG4gICAgICAgICAgICAvKmtlZXBQZXJzaXN0ZWRUYXJnZXREYXRhPSovICEwKSkpKSwgX19QUklWQVRFX3JlbW90ZVN0b3JlVW5saXN0ZW4obi5yZW1vdGVTdG9yZSwgaSk7XG4gICAgICAgIH0pKSwgYXdhaXQgdCwgYXdhaXQgX19QUklWQVRFX3N5bmNocm9uaXplUXVlcnlWaWV3c0FuZFJhaXNlU25hcHNob3RzKG4sIGUpLCBcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNdWx0aS1UYWIgb25seS5cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX3Jlc2V0TGltYm9Eb2N1bWVudHMoZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgICAgICAgICB0LlVhLmZvckVhY2goKChlLCBuKSA9PiB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX3JlbW90ZVN0b3JlVW5saXN0ZW4odC5yZW1vdGVTdG9yZSwgbik7XG4gICAgICAgICAgICB9KSksIHQuS2EuRHIoKSwgdC5VYSA9IG5ldyBNYXAsIHQuJGEgPSBuZXcgU29ydGVkTWFwKERvY3VtZW50S2V5LmNvbXBhcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogUmVjb25jaWxlIHRoZSBxdWVyeSB2aWV3cyBvZiB0aGUgcHJvdmlkZWQgcXVlcnkgdGFyZ2V0cyB3aXRoIHRoZSBzdGF0ZSBmcm9tXG4gKiBwZXJzaXN0ZW5jZS4gUmFpc2VzIHNuYXBzaG90cyBmb3IgYW55IGNoYW5nZXMgdGhhdCBhZmZlY3QgdGhlIGxvY2FsXG4gKiBjbGllbnQgYW5kIHJldHVybnMgdGhlIHVwZGF0ZWQgc3RhdGUgb2YgYWxsIHRhcmdldCdzIHF1ZXJ5IGRhdGEuXG4gKlxuICogQHBhcmFtIHN5bmNFbmdpbmUgLSBUaGUgc3luYyBlbmdpbmUgaW1wbGVtZW50YXRpb25cbiAqIEBwYXJhbSB0YXJnZXRzIC0gdGhlIGxpc3Qgb2YgdGFyZ2V0cyB3aXRoIHZpZXdzIHRoYXQgbmVlZCB0byBiZSByZWNvbXB1dGVkXG4gKiBAcGFyYW0gdHJhbnNpdGlvblRvUHJpbWFyeSAtIGB0cnVlYCBpZmYgdGhlIHRhYiB0cmFuc2l0aW9ucyBmcm9tIGEgc2Vjb25kYXJ5XG4gKiB0YWIgdG8gYSBwcmltYXJ5IHRhYlxuICovXG4gICAgICAgIC8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG4gICAgICAgIChuKSwgbi5qYSA9ICExLCBhd2FpdCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVBcHBseVByaW1hcnlTdGF0ZShuLnJlbW90ZVN0b3JlLCAhMSk7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY2hyb25pemVRdWVyeVZpZXdzQW5kUmFpc2VTbmFwc2hvdHMoZSwgdCwgbikge1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCBpID0gW10sIHMgPSBbXTtcbiAgICBmb3IgKGNvbnN0IGUgb2YgdCkge1xuICAgICAgICBsZXQgdDtcbiAgICAgICAgY29uc3QgbiA9IHIucWEuZ2V0KGUpO1xuICAgICAgICBpZiAobiAmJiAwICE9PSBuLmxlbmd0aCkge1xuICAgICAgICAgICAgLy8gRm9yIHF1ZXJpZXMgdGhhdCBoYXZlIGEgbG9jYWwgVmlldywgd2UgZmV0Y2ggdGhlaXIgY3VycmVudCBzdGF0ZVxuICAgICAgICAgICAgLy8gZnJvbSBMb2NhbFN0b3JlIChhcyB0aGUgcmVzdW1lIHRva2VuIGFuZCB0aGUgc25hcHNob3QgdmVyc2lvblxuICAgICAgICAgICAgLy8gbWlnaHQgaGF2ZSBjaGFuZ2VkKSBhbmQgcmVjb25jaWxlIHRoZWlyIHZpZXdzIHdpdGggdGhlIHBlcnNpc3RlZFxuICAgICAgICAgICAgLy8gc3RhdGUgKHRoZSBsaXN0IG9mIHN5bmNlZERvY3VtZW50cyBtYXkgaGF2ZSBnb3R0ZW4gb3V0IG9mIHN5bmMpLlxuICAgICAgICAgICAgdCA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQoci5sb2NhbFN0b3JlLCBfX1BSSVZBVEVfcXVlcnlUb1RhcmdldChuWzBdKSk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGUgb2Ygbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHQgPSByLmthLmdldChlKSwgbiA9IGF3YWl0IF9fUFJJVkFURV9zeW5jaHJvbml6ZVZpZXdBbmRDb21wdXRlU25hcHNob3QociwgdCk7XG4gICAgICAgICAgICAgICAgbi5zbmFwc2hvdCAmJiBzLnB1c2gobi5zbmFwc2hvdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBGb3IgcXVlcmllcyB0aGF0IG5ldmVyIGV4ZWN1dGVkIG9uIHRoaXMgY2xpZW50LCB3ZSBuZWVkIHRvXG4gICAgICAgICAgICAvLyBhbGxvY2F0ZSB0aGUgdGFyZ2V0IGluIExvY2FsU3RvcmUgYW5kIGluaXRpYWxpemUgYSBuZXcgVmlldy5cbiAgICAgICAgICAgIGNvbnN0IG4gPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldENhY2hlZFRhcmdldChyLmxvY2FsU3RvcmUsIGUpO1xuICAgICAgICAgICAgdCA9IGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlQWxsb2NhdGVUYXJnZXQoci5sb2NhbFN0b3JlLCBuKSwgYXdhaXQgX19QUklWQVRFX2luaXRpYWxpemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KHIsIF9fUFJJVkFURV9zeW50aGVzaXplVGFyZ2V0VG9RdWVyeShuKSwgZSwgXG4gICAgICAgICAgICAvKmN1cnJlbnQ9Ki8gITEsIHQucmVzdW1lVG9rZW4pO1xuICAgICAgICB9XG4gICAgICAgIGkucHVzaCh0KTtcbiAgICB9XG4gICAgcmV0dXJuIHIuTGEucF8ocyksIGk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIGBRdWVyeWAgb2JqZWN0IGZyb20gdGhlIHNwZWNpZmllZCBgVGFyZ2V0YC4gVGhlcmUgaXMgbm8gd2F5IHRvXG4gKiBvYnRhaW4gdGhlIG9yaWdpbmFsIGBRdWVyeWAsIHNvIHdlIHN5bnRoZXNpemUgYSBgUXVlcnlgIGZyb20gdGhlIGBUYXJnZXRgXG4gKiBvYmplY3QuXG4gKlxuICogVGhlIHN5bnRoZXNpemVkIHJlc3VsdCBtaWdodCBiZSBkaWZmZXJlbnQgZnJvbSB0aGUgb3JpZ2luYWwgYFF1ZXJ5YCwgYnV0XG4gKiBzaW5jZSB0aGUgc3ludGhlc2l6ZWQgYFF1ZXJ5YCBzaG91bGQgcmV0dXJuIHRoZSBzYW1lIHJlc3VsdHMgYXMgdGhlXG4gKiBvcmlnaW5hbCBvbmUgKG9ubHkgdGhlIHByZXNlbnRhdGlvbiBvZiByZXN1bHRzIG1pZ2h0IGRpZmZlciksIHRoZSBwb3RlbnRpYWxcbiAqIGRpZmZlcmVuY2Ugd2lsbCBub3QgY2F1c2UgaXNzdWVzLlxuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gX19QUklWQVRFX3N5bnRoZXNpemVUYXJnZXRUb1F1ZXJ5KGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX25ld1F1ZXJ5KGUucGF0aCwgZS5jb2xsZWN0aW9uR3JvdXAsIGUub3JkZXJCeSwgZS5maWx0ZXJzLCBlLmxpbWl0LCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8gLCBlLnN0YXJ0QXQsIGUuZW5kQXQpO1xufVxuXG4vKiogUmV0dXJucyB0aGUgSURzIG9mIHRoZSBjbGllbnRzIHRoYXQgYXJlIGN1cnJlbnRseSBhY3RpdmUuICovXG4vLyBQT1JUSU5HIE5PVEU6IE11bHRpLVRhYiBvbmx5LlxuZnVuY3Rpb24gX19QUklWQVRFX3N5bmNFbmdpbmVHZXRBY3RpdmVDbGllbnRzKGUpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVHZXRBY3RpdmVDbGllbnRzKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9kZWJ1Z0Nhc3QoX19QUklWQVRFX2RlYnVnQ2FzdChlKS5wZXJzaXN0ZW5jZSkuemkoKTtcbiAgICB9KF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSkubG9jYWxTdG9yZSk7XG59XG5cbi8qKiBBcHBsaWVzIGEgcXVlcnkgdGFyZ2V0IGNoYW5nZSBmcm9tIGEgZGlmZmVyZW50IHRhYi4gKi9cbi8vIFBPUlRJTkcgTk9URTogTXVsdGktVGFiIG9ubHkuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5VGFyZ2V0U3RhdGUoZSwgdCwgbiwgcikge1xuICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIGlmIChpLmphKSBcbiAgICAvLyBJZiB3ZSByZWNlaXZlIGEgdGFyZ2V0IHN0YXRlIG5vdGlmaWNhdGlvbiB2aWEgV2ViU3RvcmFnZSwgd2UgYXJlXG4gICAgLy8gZWl0aGVyIGFscmVhZHkgc2Vjb25kYXJ5IG9yIGFub3RoZXIgdGFiIGhhcyB0YWtlbiB0aGUgcHJpbWFyeSBsZWFzZS5cbiAgICByZXR1cm4gdm9pZCBfX1BSSVZBVEVfbG9nRGVidWcoSnQsIFwiSWdub3JpbmcgdW5leHBlY3RlZCBxdWVyeSBzdGF0ZSBub3RpZmljYXRpb24uXCIpO1xuICAgIGNvbnN0IHMgPSBpLnFhLmdldCh0KTtcbiAgICBpZiAocyAmJiBzLmxlbmd0aCA+IDApIHN3aXRjaCAobikge1xuICAgICAgY2FzZSBcImN1cnJlbnRcIjpcbiAgICAgIGNhc2UgXCJub3QtY3VycmVudFwiOlxuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBlID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVHZXROZXdEb2N1bWVudENoYW5nZXMoaS5sb2NhbFN0b3JlLCBfX1BSSVZBVEVfcXVlcnlDb2xsZWN0aW9uR3JvdXAoc1swXSkpLCByID0gUmVtb3RlRXZlbnQuY3JlYXRlU3ludGhlc2l6ZWRSZW1vdGVFdmVudEZvckN1cnJlbnRDaGFuZ2UodCwgXCJjdXJyZW50XCIgPT09IG4sIEJ5dGVTdHJpbmcuRU1QVFlfQllURV9TVFJJTkcpO1xuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKGksIGUsIHIpO1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgY2FzZSBcInJlamVjdGVkXCI6XG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlUmVsZWFzZVRhcmdldChpLmxvY2FsU3RvcmUsIHQsIFxuICAgICAgICAvKiBrZWVwUGVyc2lzdGVkVGFyZ2V0RGF0YSAqLyAhMCksIF9fUFJJVkFURV9yZW1vdmVBbmRDbGVhbnVwVGFyZ2V0KGksIHQsIHIpO1xuICAgICAgICBicmVhaztcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqIEFkZHMgb3IgcmVtb3ZlcyBXYXRjaCB0YXJnZXRzIGZvciBxdWVyaWVzIGZyb20gZGlmZmVyZW50IHRhYnMuICovIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlBY3RpdmVUYXJnZXRzQ2hhbmdlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2Vuc3VyZVdhdGNoQ2FsbGJhY2tzKGUpO1xuICAgIGlmIChyLmphKSB7XG4gICAgICAgIGZvciAoY29uc3QgZSBvZiB0KSB7XG4gICAgICAgICAgICBpZiAoci5xYS5oYXMoZSkgJiYgci5zaGFyZWRDbGllbnRTdGF0ZS5pc0FjdGl2ZVF1ZXJ5VGFyZ2V0KGUpKSB7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKEp0LCBcIkFkZGluZyBhbiBhbHJlYWR5IGFjdGl2ZSB0YXJnZXQgXCIgKyBlKTtcbiAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHQgPSBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZUdldENhY2hlZFRhcmdldChyLmxvY2FsU3RvcmUsIGUpLCBuID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVBbGxvY2F0ZVRhcmdldChyLmxvY2FsU3RvcmUsIHQpO1xuICAgICAgICAgICAgYXdhaXQgX19QUklWQVRFX2luaXRpYWxpemVWaWV3QW5kQ29tcHV0ZVNuYXBzaG90KHIsIF9fUFJJVkFURV9zeW50aGVzaXplVGFyZ2V0VG9RdWVyeSh0KSwgbi50YXJnZXRJZCwgXG4gICAgICAgICAgICAvKmN1cnJlbnQ9Ki8gITEsIG4ucmVzdW1lVG9rZW4pLCBfX1BSSVZBVEVfcmVtb3RlU3RvcmVMaXN0ZW4oci5yZW1vdGVTdG9yZSwgbik7XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChjb25zdCBlIG9mIG4pIFxuICAgICAgICAvLyBDaGVjayB0aGF0IHRoZSB0YXJnZXQgaXMgc3RpbGwgYWN0aXZlIHNpbmNlIHRoZSB0YXJnZXQgbWlnaHQgaGF2ZSBiZWVuXG4gICAgICAgIC8vIHJlbW92ZWQgaWYgaXQgaGFzIGJlZW4gcmVqZWN0ZWQgYnkgdGhlIGJhY2tlbmQuXG4gICAgICAgIHIucWEuaGFzKGUpICYmIFxuICAgICAgICAvLyBSZWxlYXNlIHF1ZXJpZXMgdGhhdCBhcmUgc3RpbGwgYWN0aXZlLlxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfbG9jYWxTdG9yZVJlbGVhc2VUYXJnZXQoci5sb2NhbFN0b3JlLCBlLCBcbiAgICAgICAgLyoga2VlcFBlcnNpc3RlZFRhcmdldERhdGEgKi8gITEpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgIF9fUFJJVkFURV9yZW1vdGVTdG9yZVVubGlzdGVuKHIucmVtb3RlU3RvcmUsIGUpLCBfX1BSSVZBVEVfcmVtb3ZlQW5kQ2xlYW51cFRhcmdldChyLCBlKTtcbiAgICAgICAgfSkpLmNhdGNoKF9fUFJJVkFURV9pZ25vcmVJZlByaW1hcnlMZWFzZUxvc3MpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZVdhdGNoQ2FsbGJhY2tzKGUpIHtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICByZXR1cm4gdC5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIuYXBwbHlSZW1vdGVFdmVudCA9IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlSZW1vdGVFdmVudC5iaW5kKG51bGwsIHQpLCBcbiAgICB0LnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5nZXRSZW1vdGVLZXlzRm9yVGFyZ2V0ID0gX19QUklWQVRFX3N5bmNFbmdpbmVHZXRSZW1vdGVLZXlzRm9yVGFyZ2V0LmJpbmQobnVsbCwgdCksIFxuICAgIHQucmVtb3RlU3RvcmUucmVtb3RlU3luY2VyLnJlamVjdExpc3RlbiA9IF9fUFJJVkFURV9zeW5jRW5naW5lUmVqZWN0TGlzdGVuLmJpbmQobnVsbCwgdCksIFxuICAgIHQuTGEucF8gPSBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyT25XYXRjaENoYW5nZS5iaW5kKG51bGwsIHQuZXZlbnRNYW5hZ2VyKSwgdC5MYS5KYSA9IF9fUFJJVkFURV9ldmVudE1hbmFnZXJPbldhdGNoRXJyb3IuYmluZChudWxsLCB0LmV2ZW50TWFuYWdlciksIFxuICAgIHQ7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lRW5zdXJlV3JpdGVDYWxsYmFja3MoZSkge1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgIHJldHVybiB0LnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5hcHBseVN1Y2Nlc3NmdWxXcml0ZSA9IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlTdWNjZXNzZnVsV3JpdGUuYmluZChudWxsLCB0KSwgXG4gICAgdC5yZW1vdGVTdG9yZS5yZW1vdGVTeW5jZXIucmVqZWN0RmFpbGVkV3JpdGUgPSBfX1BSSVZBVEVfc3luY0VuZ2luZVJlamVjdEZhaWxlZFdyaXRlLmJpbmQobnVsbCwgdCksIFxuICAgIHQ7XG59XG5cbi8qKlxuICogTG9hZHMgYSBGaXJlc3RvcmUgYnVuZGxlIGludG8gdGhlIFNESy4gVGhlIHJldHVybmVkIHByb21pc2UgcmVzb2x2ZXMgd2hlblxuICogdGhlIGJ1bmRsZSBmaW5pc2hlZCBsb2FkaW5nLlxuICpcbiAqIEBwYXJhbSBzeW5jRW5naW5lIC0gU3luY0VuZ2luZSB0byB1c2UuXG4gKiBAcGFyYW0gYnVuZGxlUmVhZGVyIC0gQnVuZGxlIHRvIGxvYWQgaW50byB0aGUgU0RLLlxuICogQHBhcmFtIHRhc2sgLSBMb2FkQnVuZGxlVGFzayB1c2VkIHRvIHVwZGF0ZSB0aGUgbG9hZGluZyBwcm9ncmVzcyB0byBwdWJsaWMgQVBJLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9zeW5jRW5naW5lTG9hZEJ1bmRsZShlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSk7XG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1mbG9hdGluZy1wcm9taXNlc1xuICAgICAgICAoXG4gICAgLyoqIExvYWRzIGEgYnVuZGxlIGFuZCByZXR1cm5zIHRoZSBsaXN0IG9mIGFmZmVjdGVkIGNvbGxlY3Rpb24gZ3JvdXBzLiAqL1xuICAgIGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9sb2FkQnVuZGxlSW1wbChlLCB0LCBuKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByID0gYXdhaXQgdC5nZXRNZXRhZGF0YSgpO1xuICAgICAgICAgICAgaWYgKGF3YWl0IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlSGFzTmV3ZXJCdW5kbGUoZSwgdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0gX19QUklWQVRFX2Zyb21WZXJzaW9uKHQuY3JlYXRlVGltZSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4ucGVyc2lzdGVuY2UucnVuVHJhbnNhY3Rpb24oXCJoYXNOZXdlckJ1bmRsZVwiLCBcInJlYWRvbmx5XCIsIChlID0+IG4uWXIuZ2V0QnVuZGxlTWV0YWRhdGEoZSwgdC5pZCkpKS50aGVuKChlID0+ICEhZSAmJiBlLmNyZWF0ZVRpbWUuY29tcGFyZVRvKHIpID49IDApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogU2F2ZXMgdGhlIGdpdmVuIGBCdW5kbGVNZXRhZGF0YWAgdG8gbG9jYWwgcGVyc2lzdGVuY2UuXG4gKi8gKGUubG9jYWxTdG9yZSwgcikpIHJldHVybiBhd2FpdCB0LmNsb3NlKCksIG4uX2NvbXBsZXRlV2l0aChmdW5jdGlvbiBfX1BSSVZBVEVfYnVuZGxlU3VjY2Vzc1Byb2dyZXNzKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICAgICB0YXNrU3RhdGU6IFwiU3VjY2Vzc1wiLFxuICAgICAgICAgICAgICAgICAgICBkb2N1bWVudHNMb2FkZWQ6IGUudG90YWxEb2N1bWVudHMsXG4gICAgICAgICAgICAgICAgICAgIGJ5dGVzTG9hZGVkOiBlLnRvdGFsQnl0ZXMsXG4gICAgICAgICAgICAgICAgICAgIHRvdGFsRG9jdW1lbnRzOiBlLnRvdGFsRG9jdW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICB0b3RhbEJ5dGVzOiBlLnRvdGFsQnl0ZXNcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfShyKSksIFByb21pc2UucmVzb2x2ZShuZXcgU2V0KTtcbiAgICAgICAgICAgIG4uX3VwZGF0ZVByb2dyZXNzKF9fUFJJVkFURV9idW5kbGVJbml0aWFsUHJvZ3Jlc3MocikpO1xuICAgICAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfQnVuZGxlTG9hZGVyKHIsIGUubG9jYWxTdG9yZSwgdC5zZXJpYWxpemVyKTtcbiAgICAgICAgICAgIGxldCBzID0gYXdhaXQgdC5ZYSgpO1xuICAgICAgICAgICAgZm9yICg7czsgKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IGF3YWl0IGkuQWEocyk7XG4gICAgICAgICAgICAgICAgZSAmJiBuLl91cGRhdGVQcm9ncmVzcyhlKSwgcyA9IGF3YWl0IHQuWWEoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG8gPSBhd2FpdCBpLmNvbXBsZXRlKCk7XG4gICAgICAgICAgICByZXR1cm4gYXdhaXQgX19QUklWQVRFX3N5bmNFbmdpbmVFbWl0TmV3U25hcHNBbmROb3RpZnlMb2NhbFN0b3JlKGUsIG8ubWEsIFxuICAgICAgICAgICAgLyogcmVtb3RlRXZlbnQgKi8gdm9pZCAwKSwgXG4gICAgICAgICAgICAvLyBTYXZlIG1ldGFkYXRhLCBzbyBsb2FkaW5nIHRoZSBzYW1lIGJ1bmRsZSB3aWxsIHNraXAuXG4gICAgICAgICAgICBhd2FpdCBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVNhdmVCdW5kbGUoZSwgdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiU2F2ZSBidW5kbGVcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gbi5Zci5zYXZlQnVuZGxlTWV0YWRhdGEoZSwgdCkpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qKlxuICogUmV0dXJucyBhIHByb21pc2Ugb2YgYSBgTmFtZWRRdWVyeWAgYXNzb2NpYXRlZCB3aXRoIGdpdmVuIHF1ZXJ5IG5hbWUuIFByb21pc2VcbiAqIHJlc29sdmVzIHRvIHVuZGVmaW5lZCBpZiBubyBwZXJzaXN0ZWQgZGF0YSBjYW4gYmUgZm91bmQuXG4gKi8gKGUubG9jYWxTdG9yZSwgciksIG4uX2NvbXBsZXRlV2l0aChvLnByb2dyZXNzKSwgUHJvbWlzZS5yZXNvbHZlKG8uVmEpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX2xvZ1dhcm4oSnQsIGBMb2FkaW5nIGJ1bmRsZSBmYWlsZWQgd2l0aCAke2V9YCksIG4uX2ZhaWxXaXRoKGUpLCBcbiAgICAgICAgICAgIFByb21pc2UucmVzb2x2ZShuZXcgU2V0KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKlxuICogUHJvdmlkZXMgYWxsIGNvbXBvbmVudHMgbmVlZGVkIGZvciBGaXJlc3RvcmUgd2l0aCBpbi1tZW1vcnkgcGVyc2lzdGVuY2UuXG4gKiBVc2VzIEVhZ2VyR0MgZ2FyYmFnZSBjb2xsZWN0aW9uLlxuICovKShyLCB0LCBuKS50aGVuKChlID0+IHtcbiAgICAgICAgci5zaGFyZWRDbGllbnRTdGF0ZS5ub3RpZnlCdW5kbGVMb2FkZWQoZSk7XG4gICAgfSkpO1xufVxuXG5jbGFzcyBfX1BSSVZBVEVfTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5raW5kID0gXCJtZW1vcnlcIiwgdGhpcy5zeW5jaHJvbml6ZVRhYnMgPSAhMTtcbiAgICB9XG4gICAgYXN5bmMgaW5pdGlhbGl6ZShlKSB7XG4gICAgICAgIHRoaXMuc2VyaWFsaXplciA9IF9fUFJJVkFURV9uZXdTZXJpYWxpemVyKGUuZGF0YWJhc2VJbmZvLmRhdGFiYXNlSWQpLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlID0gdGhpcy5aYShlKSwgXG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2UgPSB0aGlzLlhhKGUpLCBhd2FpdCB0aGlzLnBlcnNpc3RlbmNlLnN0YXJ0KCksIHRoaXMubG9jYWxTdG9yZSA9IHRoaXMuZXUoZSksIFxuICAgICAgICB0aGlzLmdjU2NoZWR1bGVyID0gdGhpcy50dShlLCB0aGlzLmxvY2FsU3RvcmUpLCB0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlciA9IHRoaXMubnUoZSwgdGhpcy5sb2NhbFN0b3JlKTtcbiAgICB9XG4gICAgdHUoZSwgdCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgbnUoZSwgdCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZXUoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX25ld0xvY2FsU3RvcmUodGhpcy5wZXJzaXN0ZW5jZSwgbmV3IF9fUFJJVkFURV9RdWVyeUVuZ2luZSwgZS5pbml0aWFsVXNlciwgdGhpcy5zZXJpYWxpemVyKTtcbiAgICB9XG4gICAgWGEoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlQZXJzaXN0ZW5jZShfX1BSSVZBVEVfTWVtb3J5RWFnZXJEZWxlZ2F0ZS5yaSwgdGhpcy5zZXJpYWxpemVyKTtcbiAgICB9XG4gICAgWmEoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlTaGFyZWRDbGllbnRTdGF0ZTtcbiAgICB9XG4gICAgYXN5bmMgdGVybWluYXRlKCkge1xuICAgICAgICB2YXIgZSwgdDtcbiAgICAgICAgbnVsbCA9PT0gKGUgPSB0aGlzLmdjU2NoZWR1bGVyKSB8fCB2b2lkIDAgPT09IGUgfHwgZS5zdG9wKCksIG51bGwgPT09ICh0ID0gdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIpIHx8IHZvaWQgMCA9PT0gdCB8fCB0LnN0b3AoKSwgXG4gICAgICAgIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUuc2h1dGRvd24oKSwgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5zaHV0ZG93bigpO1xuICAgIH1cbn1cblxuX19QUklWQVRFX01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlci5wcm92aWRlciA9IHtcbiAgICBidWlsZDogKCkgPT4gbmV3IF9fUFJJVkFURV9NZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXJcbn07XG5cbmNsYXNzIF9fUFJJVkFURV9McnVHY01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlciBleHRlbmRzIF9fUFJJVkFURV9NZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5jYWNoZVNpemVCeXRlcyA9IGU7XG4gICAgfVxuICAgIHR1KGUsIHQpIHtcbiAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQodGhpcy5wZXJzaXN0ZW5jZS5yZWZlcmVuY2VEZWxlZ2F0ZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9NZW1vcnlMcnVEZWxlZ2F0ZSk7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLmdhcmJhZ2VDb2xsZWN0b3I7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0xydVNjaGVkdWxlcihuLCBlLmFzeW5jUXVldWUsIHQpO1xuICAgIH1cbiAgICBYYShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB2b2lkIDAgIT09IHRoaXMuY2FjaGVTaXplQnl0ZXMgPyBMcnVQYXJhbXMud2l0aENhY2hlU2l6ZSh0aGlzLmNhY2hlU2l6ZUJ5dGVzKSA6IExydVBhcmFtcy5ERUZBVUxUO1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlQZXJzaXN0ZW5jZSgoZSA9PiBfX1BSSVZBVEVfTWVtb3J5THJ1RGVsZWdhdGUucmkoZSwgdCkpLCB0aGlzLnNlcmlhbGl6ZXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhbGwgY29tcG9uZW50cyBuZWVkZWQgZm9yIEZpcmVzdG9yZSB3aXRoIEluZGV4ZWREQiBwZXJzaXN0ZW5jZS5cbiAqLyBjbGFzcyBfX1BSSVZBVEVfSW5kZXhlZERiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIGV4dGVuZHMgX19QUklWQVRFX01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnJ1ID0gZSwgdGhpcy5jYWNoZVNpemVCeXRlcyA9IHQsIHRoaXMuZm9yY2VPd25lcnNoaXAgPSBuLCB0aGlzLmtpbmQgPSBcInBlcnNpc3RlbnRcIiwgXG4gICAgICAgIHRoaXMuc3luY2hyb25pemVUYWJzID0gITE7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUoZSkge1xuICAgICAgICBhd2FpdCBzdXBlci5pbml0aWFsaXplKGUpLCBhd2FpdCB0aGlzLnJ1LmluaXRpYWxpemUodGhpcywgZSksIFxuICAgICAgICAvLyBFbnF1ZXVlIHdyaXRlcyBmcm9tIGEgcHJldmlvdXMgc2Vzc2lvblxuICAgICAgICBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUVuc3VyZVdyaXRlQ2FsbGJhY2tzKHRoaXMucnUuc3luY0VuZ2luZSksIGF3YWl0IF9fUFJJVkFURV9maWxsV3JpdGVQaXBlbGluZSh0aGlzLnJ1LnJlbW90ZVN0b3JlKSwgXG4gICAgICAgIC8vIE5PVEU6IFRoaXMgd2lsbCBpbW1lZGlhdGVseSBjYWxsIHRoZSBsaXN0ZW5lciwgc28gd2UgbWFrZSBzdXJlIHRvXG4gICAgICAgIC8vIHNldCBpdCBhZnRlciBsb2NhbFN0b3JlIC8gcmVtb3RlU3RvcmUgYXJlIHN0YXJ0ZWQuXG4gICAgICAgIGF3YWl0IHRoaXMucGVyc2lzdGVuY2UuQ2koKCgpID0+ICh0aGlzLmdjU2NoZWR1bGVyICYmICF0aGlzLmdjU2NoZWR1bGVyLnN0YXJ0ZWQgJiYgdGhpcy5nY1NjaGVkdWxlci5zdGFydCgpLCBcbiAgICAgICAgdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIgJiYgIXRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyLnN0YXJ0ZWQgJiYgdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIuc3RhcnQoKSwgXG4gICAgICAgIFByb21pc2UucmVzb2x2ZSgpKSkpO1xuICAgIH1cbiAgICBldShlKSB7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfbmV3TG9jYWxTdG9yZSh0aGlzLnBlcnNpc3RlbmNlLCBuZXcgX19QUklWQVRFX1F1ZXJ5RW5naW5lLCBlLmluaXRpYWxVc2VyLCB0aGlzLnNlcmlhbGl6ZXIpO1xuICAgIH1cbiAgICB0dShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnBlcnNpc3RlbmNlLnJlZmVyZW5jZURlbGVnYXRlLmdhcmJhZ2VDb2xsZWN0b3I7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0xydVNjaGVkdWxlcihuLCBlLmFzeW5jUXVldWUsIHQpO1xuICAgIH1cbiAgICBudShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0luZGV4QmFja2ZpbGxlcih0LCB0aGlzLnBlcnNpc3RlbmNlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfSW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyKGUuYXN5bmNRdWV1ZSwgbik7XG4gICAgfVxuICAgIFhhKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9pbmRleGVkRGJTdG9yYWdlUHJlZml4KGUuZGF0YWJhc2VJbmZvLmRhdGFiYXNlSWQsIGUuZGF0YWJhc2VJbmZvLnBlcnNpc3RlbmNlS2V5KSwgbiA9IHZvaWQgMCAhPT0gdGhpcy5jYWNoZVNpemVCeXRlcyA/IExydVBhcmFtcy53aXRoQ2FjaGVTaXplKHRoaXMuY2FjaGVTaXplQnl0ZXMpIDogTHJ1UGFyYW1zLkRFRkFVTFQ7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0luZGV4ZWREYlBlcnNpc3RlbmNlKHRoaXMuc3luY2hyb25pemVUYWJzLCB0LCBlLmNsaWVudElkLCBuLCBlLmFzeW5jUXVldWUsIF9fUFJJVkFURV9nZXRXaW5kb3coKSwgZ2V0RG9jdW1lbnQoKSwgdGhpcy5zZXJpYWxpemVyLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLCAhIXRoaXMuZm9yY2VPd25lcnNoaXApO1xuICAgIH1cbiAgICBaYShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX01lbW9yeVNoYXJlZENsaWVudFN0YXRlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhbGwgY29tcG9uZW50cyBuZWVkZWQgZm9yIEZpcmVzdG9yZSB3aXRoIG11bHRpLXRhYiBJbmRleGVkREJcbiAqIHBlcnNpc3RlbmNlLlxuICpcbiAqIEluIHRoZSBsZWdhY3kgY2xpZW50LCB0aGlzIHByb3ZpZGVyIGlzIHVzZWQgdG8gcHJvdmlkZSBib3RoIG11bHRpLXRhYiBhbmRcbiAqIG5vbi1tdWx0aS10YWIgcGVyc2lzdGVuY2Ugc2luY2Ugd2UgY2Fubm90IHRlbGwgYXQgYnVpbGQgdGltZSB3aGV0aGVyXG4gKiBgc3luY2hyb25pemVUYWJzYCB3aWxsIGJlIGVuYWJsZWQuXG4gKi8gY2xhc3MgX19QUklWQVRFX011bHRpVGFiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyIGV4dGVuZHMgX19QUklWQVRFX0luZGV4ZWREYk9mZmxpbmVDb21wb25lbnRQcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlLCB0LCAvKiBmb3JjZU93bmVyc2hpcD0gKi8gITEpLCB0aGlzLnJ1ID0gZSwgdGhpcy5jYWNoZVNpemVCeXRlcyA9IHQsIHRoaXMuc3luY2hyb25pemVUYWJzID0gITA7XG4gICAgfVxuICAgIGFzeW5jIGluaXRpYWxpemUoZSkge1xuICAgICAgICBhd2FpdCBzdXBlci5pbml0aWFsaXplKGUpO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5ydS5zeW5jRW5naW5lO1xuICAgICAgICB0aGlzLnNoYXJlZENsaWVudFN0YXRlIGluc3RhbmNlb2YgX19QUklWQVRFX1dlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZSAmJiAodGhpcy5zaGFyZWRDbGllbnRTdGF0ZS5zeW5jRW5naW5lID0ge1xuICAgICAgICAgICAgdW86IF9fUFJJVkFURV9zeW5jRW5naW5lQXBwbHlCYXRjaFN0YXRlLmJpbmQobnVsbCwgdCksXG4gICAgICAgICAgICBjbzogX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseVRhcmdldFN0YXRlLmJpbmQobnVsbCwgdCksXG4gICAgICAgICAgICBsbzogX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseUFjdGl2ZVRhcmdldHNDaGFuZ2UuYmluZChudWxsLCB0KSxcbiAgICAgICAgICAgIHppOiBfX1BSSVZBVEVfc3luY0VuZ2luZUdldEFjdGl2ZUNsaWVudHMuYmluZChudWxsLCB0KSxcbiAgICAgICAgICAgIGFvOiBfX1BSSVZBVEVfc3luY0VuZ2luZVN5bmNocm9uaXplV2l0aENoYW5nZWREb2N1bWVudHMuYmluZChudWxsLCB0KVxuICAgICAgICB9LCBhd2FpdCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLnN0YXJ0KCkpLCBcbiAgICAgICAgLy8gTk9URTogVGhpcyB3aWxsIGltbWVkaWF0ZWx5IGNhbGwgdGhlIGxpc3RlbmVyLCBzbyB3ZSBtYWtlIHN1cmUgdG9cbiAgICAgICAgLy8gc2V0IGl0IGFmdGVyIGxvY2FsU3RvcmUgLyByZW1vdGVTdG9yZSBhcmUgc3RhcnRlZC5cbiAgICAgICAgYXdhaXQgdGhpcy5wZXJzaXN0ZW5jZS5DaSgoYXN5bmMgZSA9PiB7XG4gICAgICAgICAgICBhd2FpdCBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5UHJpbWFyeVN0YXRlKHRoaXMucnUuc3luY0VuZ2luZSwgZSksIHRoaXMuZ2NTY2hlZHVsZXIgJiYgKGUgJiYgIXRoaXMuZ2NTY2hlZHVsZXIuc3RhcnRlZCA/IHRoaXMuZ2NTY2hlZHVsZXIuc3RhcnQoKSA6IGUgfHwgdGhpcy5nY1NjaGVkdWxlci5zdG9wKCkpLCBcbiAgICAgICAgICAgIHRoaXMuaW5kZXhCYWNrZmlsbGVyU2NoZWR1bGVyICYmIChlICYmICF0aGlzLmluZGV4QmFja2ZpbGxlclNjaGVkdWxlci5zdGFydGVkID8gdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIuc3RhcnQoKSA6IGUgfHwgdGhpcy5pbmRleEJhY2tmaWxsZXJTY2hlZHVsZXIuc3RvcCgpKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBaYShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfZ2V0V2luZG93KCk7XG4gICAgICAgIGlmICghX19QUklWQVRFX1dlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZS5EKHQpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5VTklNUExFTUVOVEVELCBcIkluZGV4ZWREQiBwZXJzaXN0ZW5jZSBpcyBvbmx5IGF2YWlsYWJsZSBvbiBwbGF0Zm9ybXMgdGhhdCBzdXBwb3J0IExvY2FsU3RvcmFnZS5cIik7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfaW5kZXhlZERiU3RvcmFnZVByZWZpeChlLmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkLCBlLmRhdGFiYXNlSW5mby5wZXJzaXN0ZW5jZUtleSk7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1dlYlN0b3JhZ2VTaGFyZWRDbGllbnRTdGF0ZSh0LCBlLmFzeW5jUXVldWUsIG4sIGUuY2xpZW50SWQsIGUuaW5pdGlhbFVzZXIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhbmQgd2lyZXMgdGhlIGNvbXBvbmVudHMgdGhhdCBhcmUgbmVlZGVkIHRvIGludGVyZmFjZSB3aXRoIHRoZVxuICogbmV0d29yay5cbiAqLyBjbGFzcyBPbmxpbmVDb21wb25lbnRQcm92aWRlciB7XG4gICAgYXN5bmMgaW5pdGlhbGl6ZShlLCB0KSB7XG4gICAgICAgIHRoaXMubG9jYWxTdG9yZSB8fCAodGhpcy5sb2NhbFN0b3JlID0gZS5sb2NhbFN0b3JlLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlID0gZS5zaGFyZWRDbGllbnRTdGF0ZSwgXG4gICAgICAgIHRoaXMuZGF0YXN0b3JlID0gdGhpcy5jcmVhdGVEYXRhc3RvcmUodCksIHRoaXMucmVtb3RlU3RvcmUgPSB0aGlzLmNyZWF0ZVJlbW90ZVN0b3JlKHQpLCBcbiAgICAgICAgdGhpcy5ldmVudE1hbmFnZXIgPSB0aGlzLmNyZWF0ZUV2ZW50TWFuYWdlcih0KSwgdGhpcy5zeW5jRW5naW5lID0gdGhpcy5jcmVhdGVTeW5jRW5naW5lKHQsIFxuICAgICAgICAvKiBzdGFydEFzUHJpbWFyeT0qLyAhZS5zeW5jaHJvbml6ZVRhYnMpLCB0aGlzLnNoYXJlZENsaWVudFN0YXRlLm9ubGluZVN0YXRlSGFuZGxlciA9IGUgPT4gX19QUklWQVRFX3N5bmNFbmdpbmVBcHBseU9ubGluZVN0YXRlQ2hhbmdlKHRoaXMuc3luY0VuZ2luZSwgZSwgMSAvKiBPbmxpbmVTdGF0ZVNvdXJjZS5TaGFyZWRDbGllbnRTdGF0ZSAqLyksIFxuICAgICAgICB0aGlzLnJlbW90ZVN0b3JlLnJlbW90ZVN5bmNlci5oYW5kbGVDcmVkZW50aWFsQ2hhbmdlID0gX19QUklWQVRFX3N5bmNFbmdpbmVIYW5kbGVDcmVkZW50aWFsQ2hhbmdlLmJpbmQobnVsbCwgdGhpcy5zeW5jRW5naW5lKSwgXG4gICAgICAgIGF3YWl0IF9fUFJJVkFURV9yZW1vdGVTdG9yZUFwcGx5UHJpbWFyeVN0YXRlKHRoaXMucmVtb3RlU3RvcmUsIHRoaXMuc3luY0VuZ2luZS5pc1ByaW1hcnlDbGllbnQpKTtcbiAgICB9XG4gICAgY3JlYXRlRXZlbnRNYW5hZ2VyKGUpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdFdmVudE1hbmFnZXIoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9FdmVudE1hbmFnZXJJbXBsO1xuICAgICAgICB9KCk7XG4gICAgfVxuICAgIGNyZWF0ZURhdGFzdG9yZShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcihlLmRhdGFiYXNlSW5mby5kYXRhYmFzZUlkKSwgbiA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdDb25uZWN0aW9uKGUpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1dlYkNoYW5uZWxDb25uZWN0aW9uKGUpO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBSZXR1cm4gdGhlIFBsYXRmb3JtLXNwZWNpZmljIGNvbm5lY3Rpdml0eSBtb25pdG9yLiAqLyAoZS5kYXRhYmFzZUluZm8pO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld0RhdGFzdG9yZShlLCB0LCBuLCByKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9EYXRhc3RvcmVJbXBsKGUsIHQsIG4sIHIpO1xuICAgICAgICB9KGUuYXV0aENyZWRlbnRpYWxzLCBlLmFwcENoZWNrQ3JlZGVudGlhbHMsIG4sIHQpO1xuICAgIH1cbiAgICBjcmVhdGVSZW1vdGVTdG9yZShlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UmVtb3RlU3RvcmUoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUmVtb3RlU3RvcmVJbXBsKGUsIHQsIG4sIHIsIGkpO1xuICAgICAgICB9XG4gICAgICAgIC8qKiBSZS1lbmFibGVzIHRoZSBuZXR3b3JrLiBJZGVtcG90ZW50LiAqLyAodGhpcy5sb2NhbFN0b3JlLCB0aGlzLmRhdGFzdG9yZSwgZS5hc3luY1F1ZXVlLCAoZSA9PiBfX1BSSVZBVEVfc3luY0VuZ2luZUFwcGx5T25saW5lU3RhdGVDaGFuZ2UodGhpcy5zeW5jRW5naW5lLCBlLCAwIC8qIE9ubGluZVN0YXRlU291cmNlLlJlbW90ZVN0b3JlICovKSksIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdDb25uZWN0aXZpdHlNb25pdG9yKCkge1xuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9Ccm93c2VyQ29ubmVjdGl2aXR5TW9uaXRvci5EKCkgPyBuZXcgX19QUklWQVRFX0Jyb3dzZXJDb25uZWN0aXZpdHlNb25pdG9yIDogbmV3IF9fUFJJVkFURV9Ob29wQ29ubmVjdGl2aXR5TW9uaXRvcjtcbiAgICAgICAgfSgpKTtcbiAgICB9XG4gICAgY3JlYXRlU3luY0VuZ2luZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3U3luY0VuZ2luZShlLCB0LCBuLCBcbiAgICAgICAgLy8gUE9SVElORyBOT1RFOiBNYW5hZ2VzIHN0YXRlIHN5bmNocm9uaXphdGlvbiBpbiBtdWx0aS10YWIgZW52aXJvbm1lbnRzLlxuICAgICAgICByLCBpLCBzLCBvKSB7XG4gICAgICAgICAgICBjb25zdCBfID0gbmV3IF9fUFJJVkFURV9TeW5jRW5naW5lSW1wbChlLCB0LCBuLCByLCBpLCBzKTtcbiAgICAgICAgICAgIHJldHVybiBvICYmIChfLmphID0gITApLCBfO1xuICAgICAgICB9KHRoaXMubG9jYWxTdG9yZSwgdGhpcy5yZW1vdGVTdG9yZSwgdGhpcy5ldmVudE1hbmFnZXIsIHRoaXMuc2hhcmVkQ2xpZW50U3RhdGUsIGUuaW5pdGlhbFVzZXIsIGUubWF4Q29uY3VycmVudExpbWJvUmVzb2x1dGlvbnMsIHQpO1xuICAgIH1cbiAgICBhc3luYyB0ZXJtaW5hdGUoKSB7XG4gICAgICAgIHZhciBlLCB0O1xuICAgICAgICBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVTaHV0ZG93bihlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1Zyh6dCwgXCJSZW1vdGVTdG9yZSBzaHV0dGluZyBkb3duLlwiKSwgdC5XXy5hZGQoNSAvKiBPZmZsaW5lQ2F1c2UuU2h1dGRvd24gKi8pLCBcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKHQpLCB0LnpfLnNodXRkb3duKCksIFxuICAgICAgICAgICAgLy8gU2V0IHRoZSBPbmxpbmVTdGF0ZSB0byBVbmtub3duIChyYXRoZXIgdGhhbiBPZmZsaW5lKSB0byBhdm9pZCBwb3RlbnRpYWxseVxuICAgICAgICAgICAgLy8gdHJpZ2dlcmluZyBzcHVyaW91cyBsaXN0ZW5lciBldmVudHMgd2l0aCBjYWNoZWQgZGF0YSwgZXRjLlxuICAgICAgICAgICAgdC5qXy5zZXQoXCJVbmtub3duXCIgLyogT25saW5lU3RhdGUuVW5rbm93biAqLyk7XG4gICAgICAgIH0odGhpcy5yZW1vdGVTdG9yZSksIG51bGwgPT09IChlID0gdGhpcy5kYXRhc3RvcmUpIHx8IHZvaWQgMCA9PT0gZSB8fCBlLnRlcm1pbmF0ZSgpLCBcbiAgICAgICAgbnVsbCA9PT0gKHQgPSB0aGlzLmV2ZW50TWFuYWdlcikgfHwgdm9pZCAwID09PSB0IHx8IHQudGVybWluYXRlKCk7XG4gICAgfVxufVxuXG5PbmxpbmVDb21wb25lbnRQcm92aWRlci5wcm92aWRlciA9IHtcbiAgICBidWlsZDogKCkgPT4gbmV3IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXG59O1xuXG4vKipcbiAqIEJ1aWxkcyBhIGBCeXRlU3RyZWFtUmVhZGVyYCBmcm9tIGEgVUludDhBcnJheS5cbiAqIEBwYXJhbSBzb3VyY2UgLSBUaGUgZGF0YSBzb3VyY2UgdG8gdXNlLlxuICogQHBhcmFtIGJ5dGVzUGVyUmVhZCAtIEhvdyBtYW55IGJ5dGVzIGVhY2ggYHJlYWQoKWAgZnJvbSB0aGUgcmV0dXJuZWQgcmVhZGVyXG4gKiAgICAgICAgd2lsbCByZWFkLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdG9CeXRlU3RyZWFtUmVhZGVySGVscGVyKGUsIHQgPSAxMDI0MCkge1xuICAgIGxldCBuID0gMDtcbiAgICAvLyBUaGUgVHlwZVNjcmlwdCBkZWZpbml0aW9uIGZvciBSZWFkYWJsZVN0cmVhbVJlYWRlciBjaGFuZ2VkLiBXZSB1c2VcbiAgICAvLyBgYW55YCBoZXJlIHRvIGFsbG93IHRoaXMgY29kZSB0byBjb21waWxlIHdpdGggZGlmZmVyZW50IHZlcnNpb25zLlxuICAgIC8vIFNlZSBodHRwczovL2dpdGh1Yi5jb20vbWljcm9zb2Z0L1R5cGVTY3JpcHQvaXNzdWVzLzQyOTcwXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgYXN5bmMgcmVhZCgpIHtcbiAgICAgICAgICAgIGlmIChuIDwgZS5ieXRlTGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgciA9IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IGUuc2xpY2UobiwgbiArIHQpLFxuICAgICAgICAgICAgICAgICAgICBkb25lOiAhMVxuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgcmV0dXJuIG4gKz0gdCwgcjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgZG9uZTogITBcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgIGFzeW5jIGNhbmNlbCgpIHt9LFxuICAgICAgICByZWxlYXNlTG9jaygpIHt9LFxuICAgICAgICBjbG9zZWQ6IFByb21pc2UucmVzb2x2ZSgpXG4gICAgfTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogT24gd2ViLCBhIGBSZWFkYWJsZVN0cmVhbWAgaXMgd3JhcHBlZCBhcm91bmQgYnkgYSBgQnl0ZVN0cmVhbVJlYWRlcmAuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKlxuICogQSB3cmFwcGVyIGltcGxlbWVudGF0aW9uIG9mIE9ic2VydmVyPFQ+IHRoYXQgd2lsbCBkaXNwYXRjaCBldmVudHNcbiAqIGFzeW5jaHJvbm91c2x5LiBUbyBhbGxvdyBpbW1lZGlhdGUgc2lsZW5jaW5nLCBhIG11dGUgY2FsbCBpcyBhZGRlZCB3aGljaFxuICogY2F1c2VzIGV2ZW50cyBzY2hlZHVsZWQgdG8gbm8gbG9uZ2VyIGJlIHJhaXNlZC5cbiAqL1xuY2xhc3MgX19QUklWQVRFX0FzeW5jT2JzZXJ2ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5vYnNlcnZlciA9IGUsIFxuICAgICAgICAvKipcbiAgICAgICAgICogV2hlbiBzZXQgdG8gdHJ1ZSwgd2lsbCBub3QgcmFpc2UgZnV0dXJlIGV2ZW50cy4gTmVjZXNzYXJ5IHRvIGRlYWwgd2l0aFxuICAgICAgICAgKiBhc3luYyBkZXRhY2htZW50IG9mIGxpc3RlbmVyLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5tdXRlZCA9ICExO1xuICAgIH1cbiAgICBuZXh0KGUpIHtcbiAgICAgICAgdGhpcy5tdXRlZCB8fCB0aGlzLm9ic2VydmVyLm5leHQgJiYgdGhpcy5pdSh0aGlzLm9ic2VydmVyLm5leHQsIGUpO1xuICAgIH1cbiAgICBlcnJvcihlKSB7XG4gICAgICAgIHRoaXMubXV0ZWQgfHwgKHRoaXMub2JzZXJ2ZXIuZXJyb3IgPyB0aGlzLml1KHRoaXMub2JzZXJ2ZXIuZXJyb3IsIGUpIDogX19QUklWQVRFX2xvZ0Vycm9yKFwiVW5jYXVnaHQgRXJyb3IgaW4gc25hcHNob3QgbGlzdGVuZXI6XCIsIGUudG9TdHJpbmcoKSkpO1xuICAgIH1cbiAgICBzdSgpIHtcbiAgICAgICAgdGhpcy5tdXRlZCA9ICEwO1xuICAgIH1cbiAgICBpdShlLCB0KSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubXV0ZWQgfHwgZSh0KTtcbiAgICAgICAgfSksIDApO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBjbGFzcyByZXByZXNlbnRpbmcgYSBidW5kbGUuXG4gKlxuICogVGFrZXMgYSBidW5kbGUgc3RyZWFtIG9yIGJ1ZmZlciwgYW5kIHByZXNlbnRzIGFic3RyYWN0aW9ucyB0byByZWFkIGJ1bmRsZWRcbiAqIGVsZW1lbnRzIG91dCBvZiB0aGUgdW5kZXJseWluZyBjb250ZW50LlxuICovIGNsYXNzIF9fUFJJVkFURV9CdW5kbGVSZWFkZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIHJlYWRlciB0byByZWFkIGZyb20gdW5kZXJseWluZyBiaW5hcnkgYnVuZGxlIGRhdGEgc291cmNlLiAqL1xuICAgIGUsIHQpIHtcbiAgICAgICAgdGhpcy5vdSA9IGUsIHRoaXMuc2VyaWFsaXplciA9IHQsIFxuICAgICAgICAvKiogQ2FjaGVkIGJ1bmRsZSBtZXRhZGF0YS4gKi9cbiAgICAgICAgdGhpcy5tZXRhZGF0YSA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQsIFxuICAgICAgICAvKipcbiAgICAgICAgICogSW50ZXJuYWwgYnVmZmVyIHRvIGhvbGQgYnVuZGxlIGNvbnRlbnQsIGFjY3VtdWxhdGluZyBpbmNvbXBsZXRlIGVsZW1lbnRcbiAgICAgICAgICogY29udGVudC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXksIHRoaXMuX3UgPSBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3VGV4dERlY29kZXIoKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFRleHREZWNvZGVyKFwidXRmLThcIik7XG4gICAgICAgIH0oKSwgXG4gICAgICAgIC8vIFJlYWQgdGhlIG1ldGFkYXRhICh3aGljaCBpcyB0aGUgZmlyc3QgZWxlbWVudCkuXG4gICAgICAgIHRoaXMuYXUoKS50aGVuKChlID0+IHtcbiAgICAgICAgICAgIGUgJiYgZS5FYSgpID8gdGhpcy5tZXRhZGF0YS5yZXNvbHZlKGUuSWEubWV0YWRhdGEpIDogdGhpcy5tZXRhZGF0YS5yZWplY3QobmV3IEVycm9yKGBUaGUgZmlyc3QgZWxlbWVudCBvZiB0aGUgYnVuZGxlIGlzIG5vdCBhIG1ldGFkYXRhLCBpdCBpc1xcbiAgICAgICAgICAgICAke0pTT04uc3RyaW5naWZ5KG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuSWEpfWApKTtcbiAgICAgICAgfSksIChlID0+IHRoaXMubWV0YWRhdGEucmVqZWN0KGUpKSk7XG4gICAgfVxuICAgIGNsb3NlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5vdS5jYW5jZWwoKTtcbiAgICB9XG4gICAgYXN5bmMgZ2V0TWV0YWRhdGEoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm1ldGFkYXRhLnByb21pc2U7XG4gICAgfVxuICAgIGFzeW5jIFlhKCkge1xuICAgICAgICAvLyBNYWtlcyBzdXJlIG1ldGFkYXRhIGlzIHJlYWQgYmVmb3JlIHByb2NlZWRpbmcuXG4gICAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldE1ldGFkYXRhKCksIHRoaXMuYXUoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSB0aGUgaGVhZCBvZiBpbnRlcm5hbCBidWZmZXIsIGFuZCBwdWxsaW5nIG1vcmUgZGF0YSBmcm9tXG4gICAgICogdW5kZXJseWluZyBzdHJlYW0gaWYgYSBjb21wbGV0ZSBlbGVtZW50IGNhbm5vdCBiZSBmb3VuZCwgdW50aWwgYW5cbiAgICAgKiBlbGVtZW50KGluY2x1ZGluZyB0aGUgcHJlZml4ZWQgbGVuZ3RoIGFuZCB0aGUgSlNPTiBzdHJpbmcpIGlzIGZvdW5kLlxuICAgICAqXG4gICAgICogT25jZSBhIGNvbXBsZXRlIGVsZW1lbnQgaXMgcmVhZCwgaXQgaXMgZHJvcHBlZCBmcm9tIGludGVybmFsIGJ1ZmZlci5cbiAgICAgKlxuICAgICAqIFJldHVybnMgZWl0aGVyIHRoZSBidW5kbGVkIGVsZW1lbnQsIG9yIG51bGwgaWYgd2UgaGF2ZSByZWFjaGVkIHRoZSBlbmQgb2ZcbiAgICAgKiB0aGUgc3RyZWFtLlxuICAgICAqLyAgICBhc3luYyBhdSgpIHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IHRoaXMudXUoKTtcbiAgICAgICAgaWYgKG51bGwgPT09IGUpIHJldHVybiBudWxsO1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5fdS5kZWNvZGUoZSksIG4gPSBOdW1iZXIodCk7XG4gICAgICAgIGlzTmFOKG4pICYmIHRoaXMuY3UoYGxlbmd0aCBzdHJpbmcgKCR7dH0pIGlzIG5vdCB2YWxpZCBudW1iZXJgKTtcbiAgICAgICAgY29uc3QgciA9IGF3YWl0IHRoaXMubHUobik7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1NpemVkQnVuZGxlRWxlbWVudChKU09OLnBhcnNlKHIpLCBlLmxlbmd0aCArIG4pO1xuICAgIH1cbiAgICAvKiogRmlyc3QgaW5kZXggb2YgJ3snIGZyb20gdGhlIHVuZGVybHlpbmcgYnVmZmVyLiAqLyAgICBodSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYnVmZmVyLmZpbmRJbmRleCgoZSA9PiBlID09PSBcIntcIi5jaGFyQ29kZUF0KDApKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlYWRzIGZyb20gdGhlIGJlZ2lubmluZyBvZiB0aGUgaW50ZXJuYWwgYnVmZmVyLCB1bnRpbCB0aGUgZmlyc3QgJ3snLCBhbmRcbiAgICAgKiByZXR1cm4gdGhlIGNvbnRlbnQuXG4gICAgICpcbiAgICAgKiBJZiByZWFjaGVkIGVuZCBvZiB0aGUgc3RyZWFtLCByZXR1cm5zIGEgbnVsbC5cbiAgICAgKi8gICAgYXN5bmMgdXUoKSB7XG4gICAgICAgIGZvciAoO3RoaXMuaHUoKSA8IDA7ICkge1xuICAgICAgICAgICAgaWYgKGF3YWl0IHRoaXMuUHUoKSkgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQnJva2Ugb3V0IG9mIHRoZSBsb29wIGJlY2F1c2UgdW5kZXJseWluZyBzdHJlYW0gaXMgY2xvc2VkLCBhbmQgdGhlcmVcbiAgICAgICAgLy8gaGFwcGVucyB0byBiZSBubyBtb3JlIGRhdGEgdG8gcHJvY2Vzcy5cbiAgICAgICAgICAgICAgICBpZiAoMCA9PT0gdGhpcy5idWZmZXIubGVuZ3RoKSByZXR1cm4gbnVsbDtcbiAgICAgICAgY29uc3QgZSA9IHRoaXMuaHUoKTtcbiAgICAgICAgLy8gQnJva2Ugb3V0IG9mIHRoZSBsb29wIGJlY2F1c2UgdW5kZXJseWluZyBzdHJlYW0gaXMgY2xvc2VkLCBidXQgc3RpbGxcbiAgICAgICAgLy8gY2Fubm90IGZpbmQgYW4gb3BlbiBicmFja2V0LlxuICAgICAgICAgICAgICAgIGUgPCAwICYmIHRoaXMuY3UoXCJSZWFjaGVkIHRoZSBlbmQgb2YgYnVuZGxlIHdoZW4gYSBsZW5ndGggc3RyaW5nIGlzIGV4cGVjdGVkLlwiKTtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuYnVmZmVyLnNsaWNlKDAsIGUpO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIGludGVybmFsIGJ1ZmZlciB0byBkcm9wIHRoZSByZWFkIGxlbmd0aC5cbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5idWZmZXIgPSB0aGlzLmJ1ZmZlci5zbGljZShlKSwgdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVhZHMgZnJvbSBhIHNwZWNpZmllZCBwb3NpdGlvbiBmcm9tIHRoZSBpbnRlcm5hbCBidWZmZXIsIGZvciBhIHNwZWNpZmllZFxuICAgICAqIG51bWJlciBvZiBieXRlcywgcHVsbGluZyBtb3JlIGRhdGEgZnJvbSB0aGUgdW5kZXJseWluZyBzdHJlYW0gaWYgbmVlZGVkLlxuICAgICAqXG4gICAgICogUmV0dXJucyBhIHN0cmluZyBkZWNvZGVkIGZyb20gdGhlIHJlYWQgYnl0ZXMuXG4gICAgICovICAgIGFzeW5jIGx1KGUpIHtcbiAgICAgICAgZm9yICg7dGhpcy5idWZmZXIubGVuZ3RoIDwgZTsgKSB7XG4gICAgICAgICAgICBhd2FpdCB0aGlzLlB1KCkgJiYgdGhpcy5jdShcIlJlYWNoZWQgdGhlIGVuZCBvZiBidW5kbGUgd2hlbiBtb3JlIGlzIGV4cGVjdGVkLlwiKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB0ID0gdGhpcy5fdS5kZWNvZGUodGhpcy5idWZmZXIuc2xpY2UoMCwgZSkpO1xuICAgICAgICAvLyBVcGRhdGUgdGhlIGludGVybmFsIGJ1ZmZlciB0byBkcm9wIHRoZSByZWFkIGpzb24gc3RyaW5nLlxuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLmJ1ZmZlciA9IHRoaXMuYnVmZmVyLnNsaWNlKGUpLCB0O1xuICAgIH1cbiAgICBjdShlKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXNcbiAgICAgICAgdGhyb3cgdGhpcy5vdS5jYW5jZWwoKSwgbmV3IEVycm9yKGBJbnZhbGlkIGJ1bmRsZSBmb3JtYXQ6ICR7ZX1gKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUHVsbHMgbW9yZSBkYXRhIGZyb20gdW5kZXJseWluZyBzdHJlYW0gdG8gaW50ZXJuYWwgYnVmZmVyLlxuICAgICAqIFJldHVybnMgYSBib29sZWFuIGluZGljYXRpbmcgd2hldGhlciB0aGUgc3RyZWFtIGlzIGZpbmlzaGVkLlxuICAgICAqLyAgICBhc3luYyBQdSgpIHtcbiAgICAgICAgY29uc3QgZSA9IGF3YWl0IHRoaXMub3UucmVhZCgpO1xuICAgICAgICBpZiAoIWUuZG9uZSkge1xuICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBVaW50OEFycmF5KHRoaXMuYnVmZmVyLmxlbmd0aCArIGUudmFsdWUubGVuZ3RoKTtcbiAgICAgICAgICAgIHQuc2V0KHRoaXMuYnVmZmVyKSwgdC5zZXQoZS52YWx1ZSwgdGhpcy5idWZmZXIubGVuZ3RoKSwgdGhpcy5idWZmZXIgPSB0O1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBlLmRvbmU7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbnRlcm5hbCB0cmFuc2FjdGlvbiBvYmplY3QgcmVzcG9uc2libGUgZm9yIGFjY3VtdWxhdGluZyB0aGUgbXV0YXRpb25zIHRvXG4gKiBwZXJmb3JtIGFuZCB0aGUgYmFzZSB2ZXJzaW9ucyBmb3IgYW55IGRvY3VtZW50cyByZWFkLlxuICovXG5jbGFzcyBUcmFuc2FjdGlvbiQyIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuZGF0YXN0b3JlID0gZSwgXG4gICAgICAgIC8vIFRoZSB2ZXJzaW9uIG9mIGVhY2ggZG9jdW1lbnQgdGhhdCB3YXMgcmVhZCBkdXJpbmcgdGhpcyB0cmFuc2FjdGlvbi5cbiAgICAgICAgdGhpcy5yZWFkVmVyc2lvbnMgPSBuZXcgTWFwLCB0aGlzLm11dGF0aW9ucyA9IFtdLCB0aGlzLmNvbW1pdHRlZCA9ICExLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEEgZGVmZXJyZWQgdXNhZ2UgZXJyb3IgdGhhdCBvY2N1cnJlZCBwcmV2aW91c2x5IGluIHRoaXMgdHJhbnNhY3Rpb24gdGhhdFxuICAgICAgICAgKiB3aWxsIGNhdXNlIHRoZSB0cmFuc2FjdGlvbiB0byBmYWlsIG9uY2UgaXQgYWN0dWFsbHkgY29tbWl0cy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubGFzdFRyYW5zYWN0aW9uRXJyb3IgPSBudWxsLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNldCBvZiBkb2N1bWVudHMgdGhhdCBoYXZlIGJlZW4gd3JpdHRlbiBpbiB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgICAqXG4gICAgICAgICAqIFdoZW4gdGhlcmUncyBtb3JlIHRoYW4gb25lIHdyaXRlIHRvIHRoZSBzYW1lIGtleSBpbiBhIHRyYW5zYWN0aW9uLCBhbnlcbiAgICAgICAgICogd3JpdGVzIGFmdGVyIHRoZSBmaXJzdCBhcmUgaGFuZGxlZCBkaWZmZXJlbnRseS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MgPSBuZXcgU2V0O1xuICAgIH1cbiAgICBhc3luYyBsb29rdXAoZSkge1xuICAgICAgICBpZiAodGhpcy5lbnN1cmVDb21taXROb3RDYWxsZWQoKSwgdGhpcy5tdXRhdGlvbnMubGVuZ3RoID4gMCkgdGhyb3cgdGhpcy5sYXN0VHJhbnNhY3Rpb25FcnJvciA9IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiRmlyZXN0b3JlIHRyYW5zYWN0aW9ucyByZXF1aXJlIGFsbCByZWFkcyB0byBiZSBleGVjdXRlZCBiZWZvcmUgYWxsIHdyaXRlcy5cIiksIFxuICAgICAgICB0aGlzLmxhc3RUcmFuc2FjdGlvbkVycm9yO1xuICAgICAgICBjb25zdCB0ID0gYXdhaXQgYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2ludm9rZUJhdGNoR2V0RG9jdW1lbnRzUnBjKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0ge1xuICAgICAgICAgICAgICAgIGRvY3VtZW50czogdC5tYXAoKGUgPT4gX19QUklWQVRFX3RvTmFtZShuLnNlcmlhbGl6ZXIsIGUpKSlcbiAgICAgICAgICAgIH0sIGkgPSBhd2FpdCBuLkNvKFwiQmF0Y2hHZXREb2N1bWVudHNcIiwgbi5zZXJpYWxpemVyLmRhdGFiYXNlSWQsIFJlc291cmNlUGF0aC5lbXB0eVBhdGgoKSwgciwgdC5sZW5ndGgpLCBzID0gbmV3IE1hcDtcbiAgICAgICAgICAgIGkuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9mcm9tQmF0Y2hHZXREb2N1bWVudHNSZXNwb25zZShuLnNlcmlhbGl6ZXIsIGUpO1xuICAgICAgICAgICAgICAgIHMuc2V0KHQua2V5LnRvU3RyaW5nKCksIHQpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgY29uc3QgbyA9IFtdO1xuICAgICAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IHMuZ2V0KGUudG9TdHJpbmcoKSk7XG4gICAgICAgICAgICAgICAgX19QUklWQVRFX2hhcmRBc3NlcnQoISF0KSwgby5wdXNoKHQpO1xuICAgICAgICAgICAgfSkpLCBvO1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCBlKTtcbiAgICAgICAgcmV0dXJuIHQuZm9yRWFjaCgoZSA9PiB0aGlzLnJlY29yZFZlcnNpb24oZSkpKSwgdDtcbiAgICB9XG4gICAgc2V0KGUsIHQpIHtcbiAgICAgICAgdGhpcy53cml0ZSh0LnRvTXV0YXRpb24oZSwgdGhpcy5wcmVjb25kaXRpb24oZSkpKSwgdGhpcy53cml0dGVuRG9jcy5hZGQoZS50b1N0cmluZygpKTtcbiAgICB9XG4gICAgdXBkYXRlKGUsIHQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMud3JpdGUodC50b011dGF0aW9uKGUsIHRoaXMucHJlY29uZGl0aW9uRm9yVXBkYXRlKGUpKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHRoaXMubGFzdFRyYW5zYWN0aW9uRXJyb3IgPSBlO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMud3JpdHRlbkRvY3MuYWRkKGUudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGRlbGV0ZShlKSB7XG4gICAgICAgIHRoaXMud3JpdGUobmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLCB0aGlzLnByZWNvbmRpdGlvbihlKSkpLCB0aGlzLndyaXR0ZW5Eb2NzLmFkZChlLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBhc3luYyBjb21taXQoKSB7XG4gICAgICAgIGlmICh0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLmxhc3RUcmFuc2FjdGlvbkVycm9yKSB0aHJvdyB0aGlzLmxhc3RUcmFuc2FjdGlvbkVycm9yO1xuICAgICAgICBjb25zdCBlID0gdGhpcy5yZWFkVmVyc2lvbnM7XG4gICAgICAgIC8vIEZvciBlYWNoIG11dGF0aW9uLCBub3RlIHRoYXQgdGhlIGRvYyB3YXMgd3JpdHRlbi5cbiAgICAgICAgICAgICAgICB0aGlzLm11dGF0aW9ucy5mb3JFYWNoKCh0ID0+IHtcbiAgICAgICAgICAgIGUuZGVsZXRlKHQua2V5LnRvU3RyaW5nKCkpO1xuICAgICAgICB9KSksIFxuICAgICAgICAvLyBGb3IgZWFjaCBkb2N1bWVudCB0aGF0IHdhcyByZWFkIGJ1dCBub3Qgd3JpdHRlbiB0bywgd2Ugd2FudCB0byBwZXJmb3JtXG4gICAgICAgIC8vIGEgYHZlcmlmeWAgb3BlcmF0aW9uLlxuICAgICAgICBlLmZvckVhY2goKChlLCB0KSA9PiB7XG4gICAgICAgICAgICBjb25zdCBuID0gRG9jdW1lbnRLZXkuZnJvbVBhdGgodCk7XG4gICAgICAgICAgICB0aGlzLm11dGF0aW9ucy5wdXNoKG5ldyBfX1BSSVZBVEVfVmVyaWZ5TXV0YXRpb24obiwgdGhpcy5wcmVjb25kaXRpb24obikpKTtcbiAgICAgICAgfSkpLCBhd2FpdCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfaW52b2tlQ29tbWl0UnBjKGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpLCByID0ge1xuICAgICAgICAgICAgICAgIHdyaXRlczogdC5tYXAoKGUgPT4gdG9NdXRhdGlvbihuLnNlcmlhbGl6ZXIsIGUpKSlcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBhd2FpdCBuLlNvKFwiQ29tbWl0XCIsIG4uc2VyaWFsaXplci5kYXRhYmFzZUlkLCBSZXNvdXJjZVBhdGguZW1wdHlQYXRoKCksIHIpO1xuICAgICAgICB9KHRoaXMuZGF0YXN0b3JlLCB0aGlzLm11dGF0aW9ucyksIHRoaXMuY29tbWl0dGVkID0gITA7XG4gICAgfVxuICAgIHJlY29yZFZlcnNpb24oZSkge1xuICAgICAgICBsZXQgdDtcbiAgICAgICAgaWYgKGUuaXNGb3VuZERvY3VtZW50KCkpIHQgPSBlLnZlcnNpb247IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFlLmlzTm9Eb2N1bWVudCgpKSB0aHJvdyBmYWlsKCk7XG4gICAgICAgICAgICAvLyBSZXByZXNlbnQgYSBkZWxldGVkIGRvYyB1c2luZyBTbmFwc2hvdFZlcnNpb24ubWluKCkuXG4gICAgICAgICAgICB0ID0gU25hcHNob3RWZXJzaW9uLm1pbigpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLnJlYWRWZXJzaW9ucy5nZXQoZS5rZXkudG9TdHJpbmcoKSk7XG4gICAgICAgIGlmIChuKSB7XG4gICAgICAgICAgICBpZiAoIXQuaXNFcXVhbChuKSkgXG4gICAgICAgICAgICAvLyBUaGlzIHRyYW5zYWN0aW9uIHdpbGwgZmFpbCBubyBtYXR0ZXIgd2hhdC5cbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLkFCT1JURUQsIFwiRG9jdW1lbnQgdmVyc2lvbiBjaGFuZ2VkIGJldHdlZW4gdHdvIHJlYWRzLlwiKTtcbiAgICAgICAgfSBlbHNlIHRoaXMucmVhZFZlcnNpb25zLnNldChlLmtleS50b1N0cmluZygpLCB0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdmVyc2lvbiBvZiB0aGlzIGRvY3VtZW50IHdoZW4gaXQgd2FzIHJlYWQgaW4gdGhpcyB0cmFuc2FjdGlvbixcbiAgICAgKiBhcyBhIHByZWNvbmRpdGlvbiwgb3Igbm8gcHJlY29uZGl0aW9uIGlmIGl0IHdhcyBub3QgcmVhZC5cbiAgICAgKi8gICAgcHJlY29uZGl0aW9uKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMucmVhZFZlcnNpb25zLmdldChlLnRvU3RyaW5nKCkpO1xuICAgICAgICByZXR1cm4gIXRoaXMud3JpdHRlbkRvY3MuaGFzKGUudG9TdHJpbmcoKSkgJiYgdCA/IHQuaXNFcXVhbChTbmFwc2hvdFZlcnNpb24ubWluKCkpID8gUHJlY29uZGl0aW9uLmV4aXN0cyghMSkgOiBQcmVjb25kaXRpb24udXBkYXRlVGltZSh0KSA6IFByZWNvbmRpdGlvbi5ub25lKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdGhlIHByZWNvbmRpdGlvbiBmb3IgYSBkb2N1bWVudCBpZiB0aGUgb3BlcmF0aW9uIGlzIGFuIHVwZGF0ZS5cbiAgICAgKi8gICAgcHJlY29uZGl0aW9uRm9yVXBkYXRlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMucmVhZFZlcnNpb25zLmdldChlLnRvU3RyaW5nKCkpO1xuICAgICAgICAvLyBUaGUgZmlyc3QgdGltZSBhIGRvY3VtZW50IGlzIHdyaXR0ZW4sIHdlIHdhbnQgdG8gdGFrZSBpbnRvIGFjY291bnQgdGhlXG4gICAgICAgIC8vIHJlYWQgdGltZSBhbmQgZXhpc3RlbmNlXG4gICAgICAgICAgICAgICAgaWYgKCF0aGlzLndyaXR0ZW5Eb2NzLmhhcyhlLnRvU3RyaW5nKCkpICYmIHQpIHtcbiAgICAgICAgICAgIGlmICh0LmlzRXF1YWwoU25hcHNob3RWZXJzaW9uLm1pbigpKSkgXG4gICAgICAgICAgICAvLyBUaGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdCwgc28gZmFpbCB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgICAgICAvLyBUaGlzIGhhcyB0byBiZSB2YWxpZGF0ZWQgbG9jYWxseSBiZWNhdXNlIHlvdSBjYW4ndCBzZW5kIGFcbiAgICAgICAgICAgIC8vIHByZWNvbmRpdGlvbiB0aGF0IGEgZG9jdW1lbnQgZG9lcyBub3QgZXhpc3Qgd2l0aG91dCBjaGFuZ2luZyB0aGVcbiAgICAgICAgICAgIC8vIHNlbWFudGljcyBvZiB0aGUgYmFja2VuZCB3cml0ZSB0byBiZSBhbiBpbnNlcnQuIFRoaXMgaXMgdGhlIHJldmVyc2VcbiAgICAgICAgICAgIC8vIG9mIHdoYXQgd2Ugd2FudCwgc2luY2Ugd2Ugd2FudCB0byBhc3NlcnQgdGhhdCB0aGUgZG9jdW1lbnQgZG9lc24ndFxuICAgICAgICAgICAgLy8gZXhpc3QgYnV0IHRoZW4gc2VuZCB0aGUgdXBkYXRlIGFuZCBoYXZlIGl0IGZhaWwuIFNpbmNlIHdlIGNhbid0XG4gICAgICAgICAgICAvLyBleHByZXNzIHRoYXQgdG8gdGhlIGJhY2tlbmQsIHdlIGhhdmUgdG8gdmFsaWRhdGUgbG9jYWxseS5cbiAgICAgICAgICAgIC8vIE5vdGU6IHRoaXMgY2FuIGNoYW5nZSBvbmNlIHdlIGNhbiBzZW5kIHNlcGFyYXRlIHZlcmlmeSB3cml0ZXMgaW4gdGhlXG4gICAgICAgICAgICAvLyB0cmFuc2FjdGlvbi5cbiAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiQ2FuJ3QgdXBkYXRlIGEgZG9jdW1lbnQgdGhhdCBkb2Vzbid0IGV4aXN0LlwiKTtcbiAgICAgICAgICAgIC8vIERvY3VtZW50IGV4aXN0cywgYmFzZSBwcmVjb25kaXRpb24gb24gZG9jdW1lbnQgdXBkYXRlIHRpbWUuXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gUHJlY29uZGl0aW9uLnVwZGF0ZVRpbWUodCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRG9jdW1lbnQgd2FzIG5vdCByZWFkLCBzbyB3ZSBqdXN0IHVzZSB0aGUgcHJlY29uZGl0aW9ucyBmb3IgYSBibGluZFxuICAgICAgICAvLyB1cGRhdGUuXG4gICAgICAgIHJldHVybiBQcmVjb25kaXRpb24uZXhpc3RzKCEwKTtcbiAgICB9XG4gICAgd3JpdGUoZSkge1xuICAgICAgICB0aGlzLmVuc3VyZUNvbW1pdE5vdENhbGxlZCgpLCB0aGlzLm11dGF0aW9ucy5wdXNoKGUpO1xuICAgIH1cbiAgICBlbnN1cmVDb21taXROb3RDYWxsZWQoKSB7fVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxOSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUcmFuc2FjdGlvblJ1bm5lciBlbmNhcHN1bGF0ZXMgdGhlIGxvZ2ljIG5lZWRlZCB0byBydW4gYW5kIHJldHJ5IHRyYW5zYWN0aW9uc1xuICogd2l0aCBiYWNrb2ZmLlxuICovIGNsYXNzIF9fUFJJVkFURV9UcmFuc2FjdGlvblJ1bm5lciB7XG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICB0aGlzLmFzeW5jUXVldWUgPSBlLCB0aGlzLmRhdGFzdG9yZSA9IHQsIHRoaXMub3B0aW9ucyA9IG4sIHRoaXMudXBkYXRlRnVuY3Rpb24gPSByLCBcbiAgICAgICAgdGhpcy5kZWZlcnJlZCA9IGksIHRoaXMuVHUgPSBuLm1heEF0dGVtcHRzLCB0aGlzLmFfID0gbmV3IF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYodGhpcy5hc3luY1F1ZXVlLCBcInRyYW5zYWN0aW9uX3JldHJ5XCIgLyogVGltZXJJZC5UcmFuc2FjdGlvblJldHJ5ICovKTtcbiAgICB9XG4gICAgLyoqIFJ1bnMgdGhlIHRyYW5zYWN0aW9uIGFuZCBzZXRzIHRoZSByZXN1bHQgb24gZGVmZXJyZWQuICovICAgIEl1KCkge1xuICAgICAgICB0aGlzLlR1IC09IDEsIHRoaXMuRXUoKTtcbiAgICB9XG4gICAgRXUoKSB7XG4gICAgICAgIHRoaXMuYV8uWG8oKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBuZXcgVHJhbnNhY3Rpb24kMih0aGlzLmRhdGFzdG9yZSksIHQgPSB0aGlzLmR1KGUpO1xuICAgICAgICAgICAgdCAmJiB0LnRoZW4oKHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiBlLmNvbW1pdCgpLnRoZW4oKCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5kZWZlcnJlZC5yZXNvbHZlKHQpO1xuICAgICAgICAgICAgICAgIH0pKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuQXUoZSk7XG4gICAgICAgICAgICAgICAgfSkpKSk7XG4gICAgICAgICAgICB9KSkuY2F0Y2goKGUgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuQXUoZSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgIH0pKTtcbiAgICB9XG4gICAgZHUoZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgdCA9IHRoaXMudXBkYXRlRnVuY3Rpb24oZSk7XG4gICAgICAgICAgICByZXR1cm4gIV9fUFJJVkFURV9pc051bGxPclVuZGVmaW5lZCh0KSAmJiB0LmNhdGNoICYmIHQudGhlbiA/IHQgOiAodGhpcy5kZWZlcnJlZC5yZWplY3QoRXJyb3IoXCJUcmFuc2FjdGlvbiBjYWxsYmFjayBtdXN0IHJldHVybiBhIFByb21pc2VcIikpLCBcbiAgICAgICAgICAgIG51bGwpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAvLyBEbyBub3QgcmV0cnkgZXJyb3JzIHRocm93biBieSB1c2VyIHByb3ZpZGVkIHVwZGF0ZUZ1bmN0aW9uLlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZGVmZXJyZWQucmVqZWN0KGUpLCBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIEF1KGUpIHtcbiAgICAgICAgdGhpcy5UdSA+IDAgJiYgdGhpcy5SdShlKSA/ICh0aGlzLlR1IC09IDEsIHRoaXMuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiAodGhpcy5FdSgpLCBcbiAgICAgICAgUHJvbWlzZS5yZXNvbHZlKCkpKSkpIDogdGhpcy5kZWZlcnJlZC5yZWplY3QoZSk7XG4gICAgfVxuICAgIFJ1KGUpIHtcbiAgICAgICAgaWYgKFwiRmlyZWJhc2VFcnJvclwiID09PSBlLm5hbWUpIHtcbiAgICAgICAgICAgIC8vIEluIHRyYW5zYWN0aW9ucywgdGhlIGJhY2tlbmQgd2lsbCBmYWlsIG91dGRhdGVkIHJlYWRzIHdpdGggRkFJTEVEX1BSRUNPTkRJVElPTiBhbmRcbiAgICAgICAgICAgIC8vIG5vbi1tYXRjaGluZyBkb2N1bWVudCB2ZXJzaW9ucyB3aXRoIEFCT1JURUQuIFRoZXNlIGVycm9ycyBzaG91bGQgYmUgcmV0cmllZC5cbiAgICAgICAgICAgIGNvbnN0IHQgPSBlLmNvZGU7XG4gICAgICAgICAgICByZXR1cm4gXCJhYm9ydGVkXCIgPT09IHQgfHwgXCJmYWlsZWQtcHJlY29uZGl0aW9uXCIgPT09IHQgfHwgXCJhbHJlYWR5LWV4aXN0c1wiID09PSB0IHx8ICFfX1BSSVZBVEVfaXNQZXJtYW5lbnRFcnJvcih0KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gITE7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBZdCA9IFwiRmlyZXN0b3JlQ2xpZW50XCI7XG5cbi8qKlxuICogRmlyZXN0b3JlQ2xpZW50IGlzIGEgdG9wLWxldmVsIGNsYXNzIHRoYXQgY29uc3RydWN0cyBhbmQgb3ducyBhbGwgb2YgdGhlIC8vXG4gKiBwaWVjZXMgb2YgdGhlIGNsaWVudCBTREsgYXJjaGl0ZWN0dXJlLiBJdCBpcyByZXNwb25zaWJsZSBmb3IgY3JlYXRpbmcgdGhlIC8vXG4gKiBhc3luYyBxdWV1ZSB0aGF0IGlzIHNoYXJlZCBieSBhbGwgb2YgdGhlIG90aGVyIGNvbXBvbmVudHMgaW4gdGhlIHN5c3RlbS4gLy9cbiAqL1xuY2xhc3MgRmlyZXN0b3JlQ2xpZW50IHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBcbiAgICAvKipcbiAgICAgKiBBc3luY2hyb25vdXMgcXVldWUgcmVzcG9uc2libGUgZm9yIGFsbCBvZiBvdXIgaW50ZXJuYWwgcHJvY2Vzc2luZy4gV2hlblxuICAgICAqIHdlIGdldCBpbmNvbWluZyB3b3JrIGZyb20gdGhlIHVzZXIgKHZpYSBwdWJsaWMgQVBJKSBvciB0aGUgbmV0d29ya1xuICAgICAqIChpbmNvbWluZyBHUlBDIG1lc3NhZ2VzKSwgd2Ugc2hvdWxkIGFsd2F5cyBzY2hlZHVsZSBvbnRvIHRoaXMgcXVldWUuXG4gICAgICogVGhpcyBlbnN1cmVzIGFsbCBvZiBvdXIgd29yayBpcyBwcm9wZXJseSBzZXJpYWxpemVkIChlLmcuIHdlIGRvbid0XG4gICAgICogc3RhcnQgcHJvY2Vzc2luZyBhIG5ldyBvcGVyYXRpb24gd2hpbGUgdGhlIHByZXZpb3VzIG9uZSBpcyB3YWl0aW5nIGZvclxuICAgICAqIGFuIGFzeW5jIEkvTyB0byBjb21wbGV0ZSkuXG4gICAgICovXG4gICAgbiwgciwgaSkge1xuICAgICAgICB0aGlzLmF1dGhDcmVkZW50aWFscyA9IGUsIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFscyA9IHQsIHRoaXMuYXN5bmNRdWV1ZSA9IG4sIHRoaXMuZGF0YWJhc2VJbmZvID0gciwgXG4gICAgICAgIHRoaXMudXNlciA9IFVzZXIuVU5BVVRIRU5USUNBVEVELCB0aGlzLmNsaWVudElkID0gX19QUklWQVRFX0F1dG9JZC5uZXdJZCgpLCB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIgPSAoKSA9PiBQcm9taXNlLnJlc29sdmUoKSwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIgPSAoKSA9PiBQcm9taXNlLnJlc29sdmUoKSwgdGhpcy5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlciA9IGksIFxuICAgICAgICB0aGlzLmF1dGhDcmVkZW50aWFscy5zdGFydChuLCAoYXN5bmMgZSA9PiB7XG4gICAgICAgICAgICBfX1BSSVZBVEVfbG9nRGVidWcoWXQsIFwiUmVjZWl2ZWQgdXNlcj1cIiwgZS51aWQpLCBhd2FpdCB0aGlzLmF1dGhDcmVkZW50aWFsTGlzdGVuZXIoZSksIFxuICAgICAgICAgICAgdGhpcy51c2VyID0gZTtcbiAgICAgICAgfSkpLCB0aGlzLmFwcENoZWNrQ3JlZGVudGlhbHMuc3RhcnQobiwgKGUgPT4gKF9fUFJJVkFURV9sb2dEZWJ1ZyhZdCwgXCJSZWNlaXZlZCBuZXcgYXBwIGNoZWNrIHRva2VuPVwiLCBlKSwgXG4gICAgICAgIHRoaXMuYXBwQ2hlY2tDcmVkZW50aWFsTGlzdGVuZXIoZSwgdGhpcy51c2VyKSkpKTtcbiAgICB9XG4gICAgZ2V0IGNvbmZpZ3VyYXRpb24oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhc3luY1F1ZXVlOiB0aGlzLmFzeW5jUXVldWUsXG4gICAgICAgICAgICBkYXRhYmFzZUluZm86IHRoaXMuZGF0YWJhc2VJbmZvLFxuICAgICAgICAgICAgY2xpZW50SWQ6IHRoaXMuY2xpZW50SWQsXG4gICAgICAgICAgICBhdXRoQ3JlZGVudGlhbHM6IHRoaXMuYXV0aENyZWRlbnRpYWxzLFxuICAgICAgICAgICAgYXBwQ2hlY2tDcmVkZW50aWFsczogdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLFxuICAgICAgICAgICAgaW5pdGlhbFVzZXI6IHRoaXMudXNlcixcbiAgICAgICAgICAgIG1heENvbmN1cnJlbnRMaW1ib1Jlc29sdXRpb25zOiAxMDBcbiAgICAgICAgfTtcbiAgICB9XG4gICAgc2V0Q3JlZGVudGlhbENoYW5nZUxpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5hdXRoQ3JlZGVudGlhbExpc3RlbmVyID0gZTtcbiAgICB9XG4gICAgc2V0QXBwQ2hlY2tUb2tlbkNoYW5nZUxpc3RlbmVyKGUpIHtcbiAgICAgICAgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxMaXN0ZW5lciA9IGU7XG4gICAgfVxuICAgIHRlcm1pbmF0ZSgpIHtcbiAgICAgICAgdGhpcy5hc3luY1F1ZXVlLmVudGVyUmVzdHJpY3RlZE1vZGUoKTtcbiAgICAgICAgY29uc3QgZSA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgICAgIHJldHVybiB0aGlzLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldEV2ZW5XaGlsZVJlc3RyaWN0ZWQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fb25saW5lQ29tcG9uZW50cyAmJiBhd2FpdCB0aGlzLl9vbmxpbmVDb21wb25lbnRzLnRlcm1pbmF0ZSgpLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50cyAmJiBhd2FpdCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50cy50ZXJtaW5hdGUoKSwgXG4gICAgICAgICAgICAgICAgLy8gVGhlIGNyZWRlbnRpYWxzIHByb3ZpZGVyIG11c3QgYmUgdGVybWluYXRlZCBhZnRlciBzaHV0dGluZyBkb3duIHRoZVxuICAgICAgICAgICAgICAgIC8vIFJlbW90ZVN0b3JlIGFzIGl0IHdpbGwgcHJldmVudCB0aGUgUmVtb3RlU3RvcmUgZnJvbSByZXRyaWV2aW5nIGF1dGhcbiAgICAgICAgICAgICAgICAvLyB0b2tlbnMuXG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoQ3JlZGVudGlhbHMuc2h1dGRvd24oKSwgdGhpcy5hcHBDaGVja0NyZWRlbnRpYWxzLnNodXRkb3duKCksIGUucmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSBjYXRjaCAodCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZSh0LCBcIkZhaWxlZCB0byBzaHV0ZG93biBwZXJzaXN0ZW5jZVwiKTtcbiAgICAgICAgICAgICAgICBlLnJlamVjdChuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSkpLCBlLnByb21pc2U7XG4gICAgfVxufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIHQpIHtcbiAgICBlLmFzeW5jUXVldWUudmVyaWZ5T3BlcmF0aW9uSW5Qcm9ncmVzcygpLCBfX1BSSVZBVEVfbG9nRGVidWcoWXQsIFwiSW5pdGlhbGl6aW5nIE9mZmxpbmVDb21wb25lbnRQcm92aWRlclwiKTtcbiAgICBjb25zdCBuID0gZS5jb25maWd1cmF0aW9uO1xuICAgIGF3YWl0IHQuaW5pdGlhbGl6ZShuKTtcbiAgICBsZXQgciA9IG4uaW5pdGlhbFVzZXI7XG4gICAgZS5zZXRDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIoKGFzeW5jIGUgPT4ge1xuICAgICAgICByLmlzRXF1YWwoZSkgfHwgKGF3YWl0IF9fUFJJVkFURV9sb2NhbFN0b3JlSGFuZGxlVXNlckNoYW5nZSh0LmxvY2FsU3RvcmUsIGUpLCByID0gZSk7XG4gICAgfSkpLCBcbiAgICAvLyBXaGVuIGEgdXNlciBjYWxscyBjbGVhclBlcnNpc3RlbmNlKCkgaW4gb25lIGNsaWVudCwgYWxsIG90aGVyIGNsaWVudHNcbiAgICAvLyBuZWVkIHRvIGJlIHRlcm1pbmF0ZWQgdG8gYWxsb3cgdGhlIGRlbGV0ZSB0byBzdWNjZWVkLlxuICAgIHQucGVyc2lzdGVuY2Uuc2V0RGF0YWJhc2VEZWxldGVkTGlzdGVuZXIoKCgpID0+IGUudGVybWluYXRlKCkpKSwgZS5fb2ZmbGluZUNvbXBvbmVudHMgPSB0O1xufVxuXG5hc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0T25saW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgdCkge1xuICAgIGUuYXN5bmNRdWV1ZS52ZXJpZnlPcGVyYXRpb25JblByb2dyZXNzKCk7XG4gICAgY29uc3QgbiA9IGF3YWl0IF9fUFJJVkFURV9lbnN1cmVPZmZsaW5lQ29tcG9uZW50cyhlKTtcbiAgICBfX1BSSVZBVEVfbG9nRGVidWcoWXQsIFwiSW5pdGlhbGl6aW5nIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXCIpLCBhd2FpdCB0LmluaXRpYWxpemUobiwgZS5jb25maWd1cmF0aW9uKSwgXG4gICAgLy8gVGhlIENyZWRlbnRpYWxDaGFuZ2VMaXN0ZW5lciBvZiB0aGUgb25saW5lIGNvbXBvbmVudCBwcm92aWRlciB0YWtlc1xuICAgIC8vIHByZWNlZGVuY2Ugb3ZlciB0aGUgb2ZmbGluZSBjb21wb25lbnQgcHJvdmlkZXIuXG4gICAgZS5zZXRDcmVkZW50aWFsQ2hhbmdlTGlzdGVuZXIoKGUgPT4gX19QUklWQVRFX3JlbW90ZVN0b3JlSGFuZGxlQ3JlZGVudGlhbENoYW5nZSh0LnJlbW90ZVN0b3JlLCBlKSkpLCBcbiAgICBlLnNldEFwcENoZWNrVG9rZW5DaGFuZ2VMaXN0ZW5lcigoKGUsIG4pID0+IF9fUFJJVkFURV9yZW1vdGVTdG9yZUhhbmRsZUNyZWRlbnRpYWxDaGFuZ2UodC5yZW1vdGVTdG9yZSwgbikpKSwgXG4gICAgZS5fb25saW5lQ29tcG9uZW50cyA9IHQ7XG59XG5cbi8qKlxuICogRGVjaWRlcyB3aGV0aGVyIHRoZSBwcm92aWRlZCBlcnJvciBhbGxvd3MgdXMgdG8gZ3JhY2VmdWxseSBkaXNhYmxlXG4gKiBwZXJzaXN0ZW5jZSAoYXMgb3Bwb3NlZCB0byBjcmFzaGluZyB0aGUgY2xpZW50KS5cbiAqLyBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfZW5zdXJlT2ZmbGluZUNvbXBvbmVudHMoZSkge1xuICAgIGlmICghZS5fb2ZmbGluZUNvbXBvbmVudHMpIGlmIChlLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyKSB7XG4gICAgICAgIF9fUFJJVkFURV9sb2dEZWJ1ZyhZdCwgXCJVc2luZyB1c2VyIHByb3ZpZGVkIE9mZmxpbmVDb21wb25lbnRQcm92aWRlclwiKTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9zZXRPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgZS5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlci5fb2ZmbGluZSk7XG4gICAgICAgIH0gY2F0Y2ggKHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0O1xuICAgICAgICAgICAgaWYgKCFmdW5jdGlvbiBfX1BSSVZBVEVfY2FuRmFsbGJhY2tGcm9tSW5kZXhlZERiRXJyb3IoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBcIkZpcmViYXNlRXJyb3JcIiA9PT0gZS5uYW1lID8gZS5jb2RlID09PSBDLkZBSUxFRF9QUkVDT05ESVRJT04gfHwgZS5jb2RlID09PSBDLlVOSU1QTEVNRU5URUQgOiAhKFwidW5kZWZpbmVkXCIgIT0gdHlwZW9mIERPTUV4Y2VwdGlvbiAmJiBlIGluc3RhbmNlb2YgRE9NRXhjZXB0aW9uKSB8fCBcbiAgICAgICAgICAgICAgICAvLyBXaGVuIHRoZSBicm93c2VyIGlzIG91dCBvZiBxdW90YSB3ZSBjb3VsZCBnZXQgZWl0aGVyIHF1b3RhIGV4Y2VlZGVkXG4gICAgICAgICAgICAgICAgLy8gb3IgYW4gYWJvcnRlZCBlcnJvciBkZXBlbmRpbmcgb24gd2hldGhlciB0aGUgZXJyb3IgaGFwcGVuZWQgZHVyaW5nXG4gICAgICAgICAgICAgICAgLy8gc2NoZW1hIG1pZ3JhdGlvbi5cbiAgICAgICAgICAgICAgICAyMiA9PT0gZS5jb2RlIHx8IDIwID09PSBlLmNvZGUgfHwgXG4gICAgICAgICAgICAgICAgLy8gRmlyZWZveCBQcml2YXRlIEJyb3dzaW5nIG1vZGUgZGlzYWJsZXMgSW5kZXhlZERiIGFuZCByZXR1cm5zXG4gICAgICAgICAgICAgICAgLy8gSU5WQUxJRF9TVEFURSBmb3IgYW55IHVzYWdlLlxuICAgICAgICAgICAgICAgIDExID09PSBlLmNvZGU7XG4gICAgICAgICAgICB9KG4pKSB0aHJvdyBuO1xuICAgICAgICAgICAgX19QUklWQVRFX2xvZ1dhcm4oXCJFcnJvciB1c2luZyB1c2VyIHByb3ZpZGVkIGNhY2hlLiBGYWxsaW5nIGJhY2sgdG8gbWVtb3J5IGNhY2hlOiBcIiArIG4pLCBcbiAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9zZXRPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgbmV3IF9fUFJJVkFURV9NZW1vcnlPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIpO1xuICAgICAgICB9XG4gICAgfSBlbHNlIF9fUFJJVkFURV9sb2dEZWJ1ZyhZdCwgXCJVc2luZyBkZWZhdWx0IE9mZmxpbmVDb21wb25lbnRQcm92aWRlclwiKSwgYXdhaXQgX19QUklWQVRFX3NldE9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlLCBuZXcgX19QUklWQVRFX0xydUdjTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHZvaWQgMCkpO1xuICAgIHJldHVybiBlLl9vZmZsaW5lQ29tcG9uZW50cztcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2Vuc3VyZU9ubGluZUNvbXBvbmVudHMoZSkge1xuICAgIHJldHVybiBlLl9vbmxpbmVDb21wb25lbnRzIHx8IChlLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyID8gKF9fUFJJVkFURV9sb2dEZWJ1ZyhZdCwgXCJVc2luZyB1c2VyIHByb3ZpZGVkIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyXCIpLCBcbiAgICBhd2FpdCBfX1BSSVZBVEVfc2V0T25saW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgZS5fdW5pbml0aWFsaXplZENvbXBvbmVudHNQcm92aWRlci5fb25saW5lKSkgOiAoX19QUklWQVRFX2xvZ0RlYnVnKFl0LCBcIlVzaW5nIGRlZmF1bHQgT25saW5lQ29tcG9uZW50UHJvdmlkZXJcIiksIFxuICAgIGF3YWl0IF9fUFJJVkFURV9zZXRPbmxpbmVDb21wb25lbnRQcm92aWRlcihlLCBuZXcgT25saW5lQ29tcG9uZW50UHJvdmlkZXIpKSksIGUuX29ubGluZUNvbXBvbmVudHM7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRQZXJzaXN0ZW5jZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9lbnN1cmVPZmZsaW5lQ29tcG9uZW50cyhlKS50aGVuKChlID0+IGUucGVyc2lzdGVuY2UpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSkge1xuICAgIHJldHVybiBfX1BSSVZBVEVfZW5zdXJlT2ZmbGluZUNvbXBvbmVudHMoZSkudGhlbigoZSA9PiBlLmxvY2FsU3RvcmUpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldFJlbW90ZVN0b3JlKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2Vuc3VyZU9ubGluZUNvbXBvbmVudHMoZSkudGhlbigoZSA9PiBlLnJlbW90ZVN0b3JlKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9nZXRTeW5jRW5naW5lKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2Vuc3VyZU9ubGluZUNvbXBvbmVudHMoZSkudGhlbigoZSA9PiBlLnN5bmNFbmdpbmUpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2dldERhdGFzdG9yZShlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9lbnN1cmVPbmxpbmVDb21wb25lbnRzKGUpLnRoZW4oKGUgPT4gZS5kYXRhc3RvcmUpKTtcbn1cblxuYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSB7XG4gICAgY29uc3QgdCA9IGF3YWl0IF9fUFJJVkFURV9lbnN1cmVPbmxpbmVDb21wb25lbnRzKGUpLCBuID0gdC5ldmVudE1hbmFnZXI7XG4gICAgcmV0dXJuIG4ub25MaXN0ZW4gPSBfX1BSSVZBVEVfc3luY0VuZ2luZUxpc3Rlbi5iaW5kKG51bGwsIHQuc3luY0VuZ2luZSksIG4ub25Vbmxpc3RlbiA9IF9fUFJJVkFURV9zeW5jRW5naW5lVW5saXN0ZW4uYmluZChudWxsLCB0LnN5bmNFbmdpbmUpLCBcbiAgICBuLm9uRmlyc3RSZW1vdGVTdG9yZUxpc3RlbiA9IF9fUFJJVkFURV90cmlnZ2VyUmVtb3RlU3RvcmVMaXN0ZW4uYmluZChudWxsLCB0LnN5bmNFbmdpbmUpLCBcbiAgICBuLm9uTGFzdFJlbW90ZVN0b3JlVW5saXN0ZW4gPSBfX1BSSVZBVEVfdHJpZ2dlclJlbW90ZVN0b3JlVW5saXN0ZW4uYmluZChudWxsLCB0LnN5bmNFbmdpbmUpLCBcbiAgICBuO1xufVxuXG4vKiogRW5hYmxlcyB0aGUgbmV0d29yayBjb25uZWN0aW9uIGFuZCByZS1lbnF1ZXVlcyBhbGwgcGVuZGluZyBvcGVyYXRpb25zLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50RW5hYmxlTmV0d29yayhlKSB7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlKChhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHQgPSBhd2FpdCBfX1BSSVZBVEVfZ2V0UGVyc2lzdGVuY2UoZSksIG4gPSBhd2FpdCBfX1BSSVZBVEVfZ2V0UmVtb3RlU3RvcmUoZSk7XG4gICAgICAgIHJldHVybiB0LnNldE5ldHdvcmtFbmFibGVkKCEwKSwgZnVuY3Rpb24gX19QUklWQVRFX3JlbW90ZVN0b3JlRW5hYmxlTmV0d29yayhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIHJldHVybiB0LldfLmRlbGV0ZSgwIC8qIE9mZmxpbmVDYXVzZS5Vc2VyRGlzYWJsZWQgKi8pLCBfX1BSSVZBVEVfZW5hYmxlTmV0d29ya0ludGVybmFsKHQpO1xuICAgICAgICB9KG4pO1xuICAgIH0pKTtcbn1cblxuLyoqIERpc2FibGVzIHRoZSBuZXR3b3JrIGNvbm5lY3Rpb24uIFBlbmRpbmcgb3BlcmF0aW9ucyB3aWxsIG5vdCBjb21wbGV0ZS4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudERpc2FibGVOZXR3b3JrKGUpIHtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgdCA9IGF3YWl0IF9fUFJJVkFURV9nZXRQZXJzaXN0ZW5jZShlKSwgbiA9IGF3YWl0IF9fUFJJVkFURV9nZXRSZW1vdGVTdG9yZShlKTtcbiAgICAgICAgcmV0dXJuIHQuc2V0TmV0d29ya0VuYWJsZWQoITEpLCBhc3luYyBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3RlU3RvcmVEaXNhYmxlTmV0d29yayhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKTtcbiAgICAgICAgICAgIHQuV18uYWRkKDAgLyogT2ZmbGluZUNhdXNlLlVzZXJEaXNhYmxlZCAqLyksIGF3YWl0IF9fUFJJVkFURV9kaXNhYmxlTmV0d29ya0ludGVybmFsKHQpLCBcbiAgICAgICAgICAgIC8vIFNldCB0aGUgT25saW5lU3RhdGUgdG8gT2ZmbGluZSBzbyBnZXQoKXMgcmV0dXJuIGZyb20gY2FjaGUsIGV0Yy5cbiAgICAgICAgICAgIHQual8uc2V0KFwiT2ZmbGluZVwiIC8qIE9ubGluZVN0YXRlLk9mZmxpbmUgKi8pO1xuICAgICAgICB9KG4pO1xuICAgIH0pKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIHdoZW4gYWxsIHdyaXRlcyB0aGF0IHdlcmUgcGVuZGluZyBhdCB0aGUgdGltZVxuICogdGhpcyBtZXRob2Qgd2FzIGNhbGxlZCByZWNlaXZlZCBzZXJ2ZXIgYWNrbm93bGVkZ2VtZW50LiBBbiBhY2tub3dsZWRnZW1lbnRcbiAqIGNhbiBiZSBlaXRoZXIgYWNjZXB0YW5jZSBvciByZWplY3Rpb24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50RnJvbUxvY2FsQ2FjaGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX3JlYWREb2N1bWVudEZyb21DYWNoZShlLCB0LCBuKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByID0gYXdhaXQgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVSZWFkRG9jdW1lbnQoZSwgdCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICAgICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwicmVhZCBkb2N1bWVudFwiLCBcInJlYWRvbmx5XCIsIChlID0+IG4ubG9jYWxEb2N1bWVudHMuZ2V0RG9jdW1lbnQoZSwgdCkpKTtcbiAgICAgICAgICAgIH0oZSwgdCk7XG4gICAgICAgICAgICByLmlzRm91bmREb2N1bWVudCgpID8gbi5yZXNvbHZlKHIpIDogci5pc05vRG9jdW1lbnQoKSA/IG4ucmVzb2x2ZShudWxsKSA6IG4ucmVqZWN0KG5ldyBGaXJlc3RvcmVFcnJvcihDLlVOQVZBSUxBQkxFLCBcIkZhaWxlZCB0byBnZXQgZG9jdW1lbnQgZnJvbSBjYWNoZS4gKEhvd2V2ZXIsIHRoaXMgZG9jdW1lbnQgbWF5IGV4aXN0IG9uIHRoZSBzZXJ2ZXIuIFJ1biBhZ2FpbiB3aXRob3V0IHNldHRpbmcgJ3NvdXJjZScgaW4gdGhlIEdldE9wdGlvbnMgdG8gYXR0ZW1wdCB0byByZXRyaWV2ZSB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgc2VydmVyLilcIikpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3dyYXBJblVzZXJFcnJvcklmUmVjb3ZlcmFibGUoZSwgYEZhaWxlZCB0byBnZXQgZG9jdW1lbnQgJyR7dH0gZnJvbSBjYWNoZWApO1xuICAgICAgICAgICAgbi5yZWplY3Qocik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gKiBSZXRyaWV2ZXMgYSBsYXRlbmN5LWNvbXBlbnNhdGVkIGRvY3VtZW50IGZyb20gdGhlIGJhY2tlbmQgdmlhIGFcbiAqIFNuYXBzaG90TGlzdGVuZXIuXG4gKi8gKGF3YWl0IF9fUFJJVkFURV9nZXRMb2NhbFN0b3JlKGUpLCB0LCBuKSkpLCBuLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudFZpYVNuYXBzaG90TGlzdGVuZXIoZSwgdCwgbiA9IHt9KSB7XG4gICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfcmVhZERvY3VtZW50VmlhU25hcHNob3RMaXN0ZW5lcihlLCB0LCBuLCByLCBpKSB7XG4gICAgICAgIGNvbnN0IHMgPSBuZXcgX19QUklWQVRFX0FzeW5jT2JzZXJ2ZXIoe1xuICAgICAgICAgICAgbmV4dDogXyA9PiB7XG4gICAgICAgICAgICAgICAgLy8gTXV0ZSBhbmQgcmVtb3ZlIHF1ZXJ5IGZpcnN0IGJlZm9yZSBwYXNzaW5nIGV2ZW50IHRvIHVzZXIgdG8gYXZvaWRcbiAgICAgICAgICAgICAgICAvLyB1c2VyIGFjdGlvbnMgYWZmZWN0aW5nIHRoZSBub3cgc3RhbGUgcXVlcnkuXG4gICAgICAgICAgICAgICAgcy5zdSgpLCB0LmVucXVldWVBbmRGb3JnZXQoKCgpID0+IF9fUFJJVkFURV9ldmVudE1hbmFnZXJVbmxpc3RlbihlLCBvKSkpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGEgPSBfLmRvY3MuaGFzKG4pO1xuICAgICAgICAgICAgICAgICFhICYmIF8uZnJvbUNhY2hlID8gXG4gICAgICAgICAgICAgICAgLy8gVE9ETyhkaW1vbmQpOiBJZiB3ZSdyZSBvbmxpbmUgYW5kIHRoZSBkb2N1bWVudCBkb2Vzbid0XG4gICAgICAgICAgICAgICAgLy8gZXhpc3QgdGhlbiB3ZSByZXNvbHZlIHdpdGggYSBkb2MuZXhpc3RzIHNldCB0byBmYWxzZS4gSWZcbiAgICAgICAgICAgICAgICAvLyB3ZSdyZSBvZmZsaW5lIGhvd2V2ZXIsIHdlIHJlamVjdCB0aGUgUHJvbWlzZSBpbiB0aGlzXG4gICAgICAgICAgICAgICAgLy8gY2FzZS4gVHdvIG9wdGlvbnM6IDEpIENhY2hlIHRoZSBuZWdhdGl2ZSByZXNwb25zZSBmcm9tXG4gICAgICAgICAgICAgICAgLy8gdGhlIHNlcnZlciBzbyB3ZSBjYW4gZGVsaXZlciB0aGF0IGV2ZW4gd2hlbiB5b3UncmVcbiAgICAgICAgICAgICAgICAvLyBvZmZsaW5lIDIpIEFjdHVhbGx5IHJlamVjdCB0aGUgUHJvbWlzZSBpbiB0aGUgb25saW5lIGNhc2VcbiAgICAgICAgICAgICAgICAvLyBpZiB0aGUgZG9jdW1lbnQgZG9lc24ndCBleGlzdC5cbiAgICAgICAgICAgICAgICBpLnJlamVjdChuZXcgRmlyZXN0b3JlRXJyb3IoQy5VTkFWQUlMQUJMRSwgXCJGYWlsZWQgdG8gZ2V0IGRvY3VtZW50IGJlY2F1c2UgdGhlIGNsaWVudCBpcyBvZmZsaW5lLlwiKSkgOiBhICYmIF8uZnJvbUNhY2hlICYmIHIgJiYgXCJzZXJ2ZXJcIiA9PT0gci5zb3VyY2UgPyBpLnJlamVjdChuZXcgRmlyZXN0b3JlRXJyb3IoQy5VTkFWQUlMQUJMRSwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnQgZnJvbSBzZXJ2ZXIuIChIb3dldmVyLCB0aGlzIGRvY3VtZW50IGRvZXMgZXhpc3QgaW4gdGhlIGxvY2FsIGNhY2hlLiBSdW4gYWdhaW4gd2l0aG91dCBzZXR0aW5nIHNvdXJjZSB0byBcInNlcnZlclwiIHRvIHJldHJpZXZlIHRoZSBjYWNoZWQgZG9jdW1lbnQuKScpKSA6IGkucmVzb2x2ZShfKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZSA9PiBpLnJlamVjdChlKVxuICAgICAgICB9KSwgbyA9IG5ldyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcihfX1BSSVZBVEVfbmV3UXVlcnlGb3JQYXRoKG4ucGF0aCksIHMsIHtcbiAgICAgICAgICAgIGluY2x1ZGVNZXRhZGF0YUNoYW5nZXM6ICEwLFxuICAgICAgICAgICAgVGE6ICEwXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2V2ZW50TWFuYWdlckxpc3RlbihlLCBvKTtcbiAgICB9KGF3YWl0IF9fUFJJVkFURV9nZXRFdmVudE1hbmFnZXIoZSksIGUuYXN5bmNRdWV1ZSwgdCwgbiwgcikpKSwgci5wcm9taXNlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRzRnJvbUxvY2FsQ2FjaGUoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2V4ZWN1dGVRdWVyeUZyb21DYWNoZShlLCB0LCBuKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByID0gYXdhaXQgX19QUklWQVRFX2xvY2FsU3RvcmVFeGVjdXRlUXVlcnkoZSwgdCwgXG4gICAgICAgICAgICAvKiB1c2VQcmV2aW91c1Jlc3VsdHM9ICovICEwKSwgaSA9IG5ldyBfX1BSSVZBVEVfVmlldyh0LCByLmdzKSwgcyA9IGkuYmEoci5kb2N1bWVudHMpLCBvID0gaS5hcHBseUNoYW5nZXMocywgXG4gICAgICAgICAgICAvKiBsaW1ib1Jlc29sdXRpb25FbmFibGVkPSAqLyAhMSk7XG4gICAgICAgICAgICBuLnJlc29sdmUoby5zbmFwc2hvdCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfd3JhcEluVXNlckVycm9ySWZSZWNvdmVyYWJsZShlLCBgRmFpbGVkIHRvIGV4ZWN1dGUgcXVlcnkgJyR7dH0gYWdhaW5zdCBjYWNoZWApO1xuICAgICAgICAgICAgbi5yZWplY3Qocik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gKiBSZXRyaWV2ZXMgYSBsYXRlbmN5LWNvbXBlbnNhdGVkIHF1ZXJ5IHNuYXBzaG90IGZyb20gdGhlIGJhY2tlbmQgdmlhIGFcbiAqIFNuYXBzaG90TGlzdGVuZXIuXG4gKi8gKGF3YWl0IF9fUFJJVkFURV9nZXRMb2NhbFN0b3JlKGUpLCB0LCBuKSkpLCBuLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNWaWFTbmFwc2hvdExpc3RlbmVyKGUsIHQsIG4gPSB7fSkge1xuICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZUFuZEZvcmdldCgoYXN5bmMgKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2V4ZWN1dGVRdWVyeVZpYVNuYXBzaG90TGlzdGVuZXIoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBjb25zdCBzID0gbmV3IF9fUFJJVkFURV9Bc3luY09ic2VydmVyKHtcbiAgICAgICAgICAgIG5leHQ6IG4gPT4ge1xuICAgICAgICAgICAgICAgIC8vIE11dGUgYW5kIHJlbW92ZSBxdWVyeSBmaXJzdCBiZWZvcmUgcGFzc2luZyBldmVudCB0byB1c2VyIHRvIGF2b2lkXG4gICAgICAgICAgICAgICAgLy8gdXNlciBhY3Rpb25zIGFmZmVjdGluZyB0aGUgbm93IHN0YWxlIHF1ZXJ5LlxuICAgICAgICAgICAgICAgIHMuc3UoKSwgdC5lbnF1ZXVlQW5kRm9yZ2V0KCgoKSA9PiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyVW5saXN0ZW4oZSwgbykpKSwgbi5mcm9tQ2FjaGUgJiYgXCJzZXJ2ZXJcIiA9PT0gci5zb3VyY2UgPyBpLnJlamVjdChuZXcgRmlyZXN0b3JlRXJyb3IoQy5VTkFWQUlMQUJMRSwgJ0ZhaWxlZCB0byBnZXQgZG9jdW1lbnRzIGZyb20gc2VydmVyLiAoSG93ZXZlciwgdGhlc2UgZG9jdW1lbnRzIG1heSBleGlzdCBpbiB0aGUgbG9jYWwgY2FjaGUuIFJ1biBhZ2FpbiB3aXRob3V0IHNldHRpbmcgc291cmNlIHRvIFwic2VydmVyXCIgdG8gcmV0cmlldmUgdGhlIGNhY2hlZCBkb2N1bWVudHMuKScpKSA6IGkucmVzb2x2ZShuKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvcjogZSA9PiBpLnJlamVjdChlKVxuICAgICAgICB9KSwgbyA9IG5ldyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcihuLCBzLCB7XG4gICAgICAgICAgICBpbmNsdWRlTWV0YWRhdGFDaGFuZ2VzOiAhMCxcbiAgICAgICAgICAgIFRhOiAhMFxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9ldmVudE1hbmFnZXJMaXN0ZW4oZSwgbyk7XG4gICAgfShhd2FpdCBfX1BSSVZBVEVfZ2V0RXZlbnRNYW5hZ2VyKGUpLCBlLmFzeW5jUXVldWUsIHQsIG4sIHIpKSksIHIucHJvbWlzZTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFJ1bkFnZ3JlZ2F0ZVF1ZXJ5KGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgLy8gSW1wbGVtZW50IGFuZCBjYWxsIGV4ZWN1dGVBZ2dyZWdhdGVRdWVyeVZpYVNuYXBzaG90TGlzdGVuZXIsIHNpbWlsYXJcbiAgICAgICAgLy8gdG8gdGhlIGltcGxlbWVudGF0aW9uIGluIGZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50c1ZpYVNuYXBzaG90TGlzdGVuZXJcbiAgICAgICAgLy8gYWJvdmVcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIFRPRE8oYi8yNzc2MjgzODQpOiBjaGVjayBgY2FuVXNlTmV0d29yaygpYCBhbmQgaGFuZGxlIG11bHRpLXRhYi5cbiAgICAgICAgICAgIGNvbnN0IGkgPSBhd2FpdCBfX1BSSVZBVEVfZ2V0RGF0YXN0b3JlKGUpO1xuICAgICAgICAgICAgci5yZXNvbHZlKGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9pbnZva2VSdW5BZ2dyZWdhdGlvblF1ZXJ5UnBjKGUsIHQsIG4pIHtcbiAgICAgICAgICAgICAgICB2YXIgcjtcbiAgICAgICAgICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwge3JlcXVlc3Q6IHMsIFB0OiBvLCBwYXJlbnQ6IF99ID0gX19QUklWQVRFX3RvUnVuQWdncmVnYXRpb25RdWVyeVJlcXVlc3QoaS5zZXJpYWxpemVyLCBfX1BSSVZBVEVfcXVlcnlUb0FnZ3JlZ2F0ZVRhcmdldCh0KSwgbik7XG4gICAgICAgICAgICAgICAgaS5jb25uZWN0aW9uLmZvIHx8IGRlbGV0ZSBzLnBhcmVudDtcbiAgICAgICAgICAgICAgICBjb25zdCBhID0gKGF3YWl0IGkuQ28oXCJSdW5BZ2dyZWdhdGlvblF1ZXJ5XCIsIGkuc2VyaWFsaXplci5kYXRhYmFzZUlkLCBfLCBzLCBcbiAgICAgICAgICAgICAgICAvKmV4cGVjdGVkUmVzcG9uc2VDb3VudD0qLyAxKSkuZmlsdGVyKChlID0+ICEhZS5yZXN1bHQpKTtcbiAgICAgICAgICAgICAgICAvLyBPbWl0IFJ1bkFnZ3JlZ2F0aW9uUXVlcnlSZXNwb25zZSB0aGF0IG9ubHkgY29udGFpbiByZWFkVGltZXMuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KDEgPT09IGEubGVuZ3RoKTtcbiAgICAgICAgICAgICAgICAvLyBSZW1hcCB0aGUgc2hvcnQtZm9ybSBhbGlhc2VzIHRoYXQgd2VyZSBzZW50IHRvIHRoZSBzZXJ2ZXJcbiAgICAgICAgICAgICAgICAvLyB0byB0aGUgY2xpZW50LXNpZGUgYWxpYXNlcy4gVXNlcnMgd2lsbCBhY2Nlc3MgdGhlIHJlc3VsdHNcbiAgICAgICAgICAgICAgICAvLyB1c2luZyB0aGUgY2xpZW50LXNpZGUgYWxpYXMuXG4gICAgICAgICAgICAgICAgY29uc3QgdSA9IG51bGwgPT09IChyID0gYVswXS5yZXN1bHQpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuYWdncmVnYXRlRmllbGRzO1xuICAgICAgICAgICAgICAgIHJldHVybiBPYmplY3Qua2V5cyh1KS5yZWR1Y2UoKChlLCB0KSA9PiAoZVtvW3RdXSA9IHVbdF0sIGUpKSwge30pO1xuICAgICAgICAgICAgfShpLCB0LCBuKSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIHIucmVqZWN0KGUpO1xuICAgICAgICB9XG4gICAgfSkpLCByLnByb21pc2U7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRBZGRTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlLCB0KSB7XG4gICAgY29uc3QgbiA9IG5ldyBfX1BSSVZBVEVfQXN5bmNPYnNlcnZlcih0KTtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9hZGRTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSkuaWEuYWRkKHQpLCBcbiAgICAgICAgLy8gSW1tZWRpYXRlbHkgZmlyZSBhbiBpbml0aWFsIGV2ZW50LCBpbmRpY2F0aW5nIGFsbCBleGlzdGluZyBsaXN0ZW5lcnNcbiAgICAgICAgLy8gYXJlIGluLXN5bmMuXG4gICAgICAgIHQubmV4dCgpO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgbikpKSwgKCkgPT4ge1xuICAgICAgICBuLnN1KCksIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlU25hcHNob3RzSW5TeW5jTGlzdGVuZXIoZSwgdCkge1xuICAgICAgICAgICAgX19QUklWQVRFX2RlYnVnQ2FzdChlKS5pYS5kZWxldGUodCk7XG4gICAgICAgIH0oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgbikpKTtcbiAgICB9O1xufVxuXG4vKipcbiAqIFRha2VzIGFuIHVwZGF0ZUZ1bmN0aW9uIGluIHdoaWNoIGEgc2V0IG9mIHJlYWRzIGFuZCB3cml0ZXMgY2FuIGJlIHBlcmZvcm1lZFxuICogYXRvbWljYWxseS4gSW4gdGhlIHVwZGF0ZUZ1bmN0aW9uLCB0aGUgY2xpZW50IGNhbiByZWFkIGFuZCB3cml0ZSB2YWx1ZXNcbiAqIHVzaW5nIHRoZSBzdXBwbGllZCB0cmFuc2FjdGlvbiBvYmplY3QuIEFmdGVyIHRoZSB1cGRhdGVGdW5jdGlvbiwgYWxsXG4gKiBjaGFuZ2VzIHdpbGwgYmUgY29tbWl0dGVkLiBJZiBhIHJldHJ5YWJsZSBlcnJvciBvY2N1cnMgKGV4OiBzb21lIG90aGVyXG4gKiBjbGllbnQgaGFzIGNoYW5nZWQgYW55IG9mIHRoZSBkYXRhIHJlZmVyZW5jZWQpLCB0aGVuIHRoZSB1cGRhdGVGdW5jdGlvblxuICogd2lsbCBiZSBjYWxsZWQgYWdhaW4gYWZ0ZXIgYSBiYWNrb2ZmLiBJZiB0aGUgdXBkYXRlRnVuY3Rpb24gc3RpbGwgZmFpbHNcbiAqIGFmdGVyIGFsbCByZXRyaWVzLCB0aGVuIHRoZSB0cmFuc2FjdGlvbiB3aWxsIGJlIHJlamVjdGVkLlxuICpcbiAqIFRoZSB0cmFuc2FjdGlvbiBvYmplY3QgcGFzc2VkIHRvIHRoZSB1cGRhdGVGdW5jdGlvbiBjb250YWlucyBtZXRob2RzIGZvclxuICogYWNjZXNzaW5nIGRvY3VtZW50cyBhbmQgY29sbGVjdGlvbnMuIFVubGlrZSBvdGhlciBkYXRhc3RvcmUgYWNjZXNzLCBkYXRhXG4gKiBhY2Nlc3NlZCB3aXRoIHRoZSB0cmFuc2FjdGlvbiB3aWxsIG5vdCByZWZsZWN0IGxvY2FsIGNoYW5nZXMgdGhhdCBoYXZlIG5vdFxuICogYmVlbiBjb21taXR0ZWQuIEZvciB0aGlzIHJlYXNvbiwgaXQgaXMgcmVxdWlyZWQgdGhhdCBhbGwgcmVhZHMgYXJlXG4gKiBwZXJmb3JtZWQgYmVmb3JlIGFueSB3cml0ZXMuIFRyYW5zYWN0aW9ucyBtdXN0IGJlIHBlcmZvcm1lZCB3aGlsZSBvbmxpbmUuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudExvYWRCdW5kbGUoZSwgdCwgbiwgcikge1xuICAgIGNvbnN0IGkgPSBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlQnVuZGxlUmVhZGVyKGUsIHQpIHtcbiAgICAgICAgbGV0IG47XG4gICAgICAgIG4gPSBcInN0cmluZ1wiID09IHR5cGVvZiBlID8gX19QUklWQVRFX25ld1RleHRFbmNvZGVyKCkuZW5jb2RlKGUpIDogZTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdCdW5kbGVSZWFkZXIoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfQnVuZGxlUmVhZGVySW1wbChlLCB0KTtcbiAgICAgICAgfShmdW5jdGlvbiBfX1BSSVZBVEVfdG9CeXRlU3RyZWFtUmVhZGVyKGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChlIGluc3RhbmNlb2YgVWludDhBcnJheSkgcmV0dXJuIF9fUFJJVkFURV90b0J5dGVTdHJlYW1SZWFkZXJIZWxwZXIoZSwgdCk7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEFycmF5QnVmZmVyKSByZXR1cm4gX19QUklWQVRFX3RvQnl0ZVN0cmVhbVJlYWRlckhlbHBlcihuZXcgVWludDhBcnJheShlKSwgdCk7XG4gICAgICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIFJlYWRhYmxlU3RyZWFtKSByZXR1cm4gZS5nZXRSZWFkZXIoKTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlNvdXJjZSBvZiBgdG9CeXRlU3RyZWFtUmVhZGVyYCBoYXMgdG8gYmUgYSBBcnJheUJ1ZmZlciBvciBSZWFkYWJsZVN0cmVhbVwiKTtcbiAgICAgICAgfShuKSwgdCk7XG4gICAgfShuLCBfX1BSSVZBVEVfbmV3U2VyaWFsaXplcih0KSk7XG4gICAgZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgX19QUklWQVRFX3N5bmNFbmdpbmVMb2FkQnVuZGxlKGF3YWl0IF9fUFJJVkFURV9nZXRTeW5jRW5naW5lKGUpLCBpLCByKTtcbiAgICB9KSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXROYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWUoKGFzeW5jICgpID0+IGZ1bmN0aW9uIF9fUFJJVkFURV9sb2NhbFN0b3JlR2V0TmFtZWRRdWVyeShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfZGVidWdDYXN0KGUpO1xuICAgICAgICByZXR1cm4gbi5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkdldCBuYW1lZCBxdWVyeVwiLCBcInJlYWRvbmx5XCIsIChlID0+IG4uWXIuZ2V0TmFtZWRRdWVyeShlLCB0KSkpO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSksIHQpKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRTZXRJbmRleENvbmZpZ3VyYXRpb24oZSwgdCkge1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4gYXN5bmMgZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVDb25maWd1cmVGaWVsZEluZGV4ZXMoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgciA9IG4uaW5kZXhNYW5hZ2VyLCBpID0gW107XG4gICAgICAgIHJldHVybiBuLnBlcnNpc3RlbmNlLnJ1blRyYW5zYWN0aW9uKFwiQ29uZmlndXJlIGluZGV4ZXNcIiwgXCJyZWFkd3JpdGVcIiwgKGUgPT4gci5nZXRGaWVsZEluZGV4ZXMoZSkubmV4dCgobiA9PiBcbiAgICAgICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbiAgICAgICAgLyoqXG4gKiBDb21wYXJlcyB0d28gYXJyYXkgZm9yIGVxdWFsaXR5IHVzaW5nIGNvbXBhcmF0b3IuIFRoZSBtZXRob2QgY29tcHV0ZXMgdGhlXG4gKiBpbnRlcnNlY3Rpb24gYW5kIGludm9rZXMgYG9uQWRkYCBmb3IgZXZlcnkgZWxlbWVudCB0aGF0IGlzIGluIGBhZnRlcmAgYnV0IG5vdFxuICogYGJlZm9yZWAuIGBvblJlbW92ZWAgaXMgaW52b2tlZCBmb3IgZXZlcnkgZWxlbWVudCBpbiBgYmVmb3JlYCBidXQgbWlzc2luZ1xuICogZnJvbSBgYWZ0ZXJgLlxuICpcbiAqIFRoZSBtZXRob2QgY3JlYXRlcyBhIGNvcHkgb2YgYm90aCBgYmVmb3JlYCBhbmQgYGFmdGVyYCBhbmQgcnVucyBpbiBPKG4gbG9nXG4gKiBuKSwgd2hlcmUgbiBpcyB0aGUgc2l6ZSBvZiB0aGUgdHdvIGxpc3RzLlxuICpcbiAqIEBwYXJhbSBiZWZvcmUgLSBUaGUgZWxlbWVudHMgdGhhdCBleGlzdCBpbiB0aGUgb3JpZ2luYWwgYXJyYXkuXG4gKiBAcGFyYW0gYWZ0ZXIgLSBUaGUgZWxlbWVudHMgdG8gZGlmZiBhZ2FpbnN0IHRoZSBvcmlnaW5hbCBhcnJheS5cbiAqIEBwYXJhbSBjb21wYXJhdG9yIC0gVGhlIGNvbXBhcmF0b3IgZm9yIHRoZSBlbGVtZW50cyBpbiBiZWZvcmUgYW5kIGFmdGVyLlxuICogQHBhcmFtIG9uQWRkIC0gQSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBwYXJ0IG9mIGBcbiAqIGFmdGVyYCBidXQgbm90IGBiZWZvcmVgLlxuICogQHBhcmFtIG9uUmVtb3ZlIC0gQSBmdW5jdGlvbiB0byBpbnZva2UgZm9yIGV2ZXJ5IGVsZW1lbnQgdGhhdCBpcyBwYXJ0IG9mXG4gKiBgYmVmb3JlYCBidXQgbm90IGBhZnRlcmAuXG4gKi9cbiAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX2RpZmZBcnJheXMoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICAgICAgZSA9IFsgLi4uZSBdLCB0ID0gWyAuLi50IF0sIGUuc29ydChuKSwgdC5zb3J0KG4pO1xuICAgICAgICAgICAgY29uc3QgcyA9IGUubGVuZ3RoLCBvID0gdC5sZW5ndGg7XG4gICAgICAgICAgICBsZXQgXyA9IDAsIGEgPSAwO1xuICAgICAgICAgICAgZm9yICg7XyA8IG8gJiYgYSA8IHM7ICkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHMgPSBuKGVbYV0sIHRbX10pO1xuICAgICAgICAgICAgICAgIHMgPCAwID8gXG4gICAgICAgICAgICAgICAgLy8gVGhlIGVsZW1lbnQgd2FzIHJlbW92ZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZFxuICAgICAgICAgICAgICAgIC8vIHdhbGt0aHJvdWdoIGlzIG9ubHkgaW4gYGJlZm9yZWAuXG4gICAgICAgICAgICAgICAgaShlW2ErK10pIDogcyA+IDAgPyBcbiAgICAgICAgICAgICAgICAvLyBUaGUgZWxlbWVudCB3YXMgYWRkZWQgaWYgdGhlIG5leHQgZWxlbWVudCBpbiBvdXIgb3JkZXJlZCB3YWxrdGhyb3VnaFxuICAgICAgICAgICAgICAgIC8vIGlzIG9ubHkgaW4gYGFmdGVyYC5cbiAgICAgICAgICAgICAgICByKHRbXysrXSkgOiAoXysrLCBhKyspO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yICg7XyA8IG87ICkgcih0W18rK10pO1xuICAgICAgICAgICAgZm9yICg7YSA8IHM7ICkgaShlW2ErK10pO1xuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogVmVyaWZpZXMgZXF1YWxpdHkgZm9yIGFuIGFycmF5IG9mIHByaW1pdGl2ZXMuXG4gKlxuICogQHByaXZhdGVcbiAqIEBpbnRlcm5hbFxuICogQHBhcmFtIGxlZnQgQXJyYXkgb2YgcHJpbWl0aXZlcy5cbiAqIEBwYXJhbSByaWdodCBBcnJheSBvZiBwcmltaXRpdmVzLlxuICogQHJldHVybiBUcnVlIGlmIGFycmF5cyBhcmUgZXF1YWwuXG4gKi8gKG4sIHQsIF9fUFJJVkFURV9maWVsZEluZGV4U2VtYW50aWNDb21wYXJhdG9yLCAodCA9PiB7XG4gICAgICAgICAgICBpLnB1c2goci5hZGRGaWVsZEluZGV4KGUsIHQpKTtcbiAgICAgICAgfSksICh0ID0+IHtcbiAgICAgICAgICAgIGkucHVzaChyLmRlbGV0ZUZpZWxkSW5kZXgoZSwgdCkpO1xuICAgICAgICB9KSkpKS5uZXh0KCgoKSA9PiBQZXJzaXN0ZW5jZVByb21pc2Uud2FpdEZvcihpKSkpKSk7XG4gICAgfShhd2FpdCBfX1BSSVZBVEVfZ2V0TG9jYWxTdG9yZShlKSwgdCkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFNldFBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uRW5hYmxlZChlLCB0KSB7XG4gICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlKChhc3luYyAoKSA9PiBmdW5jdGlvbiBfX1BSSVZBVEVfbG9jYWxTdG9yZVNldEluZGV4QXV0b0NyZWF0aW9uRW5hYmxlZChlLCB0KSB7XG4gICAgICAgIF9fUFJJVkFURV9kZWJ1Z0Nhc3QoZSkuUHMuWGkgPSB0O1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSksIHQpKSk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnREZWxldGVBbGxGaWVsZEluZGV4ZXMoZSkge1xuICAgIHJldHVybiBlLmFzeW5jUXVldWUuZW5xdWV1ZSgoYXN5bmMgKCkgPT4gZnVuY3Rpb24gX19QUklWQVRFX2xvY2FsU3RvcmVEZWxldGVBbGxGaWVsZEluZGV4ZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2RlYnVnQ2FzdChlKSwgbiA9IHQuaW5kZXhNYW5hZ2VyO1xuICAgICAgICByZXR1cm4gdC5wZXJzaXN0ZW5jZS5ydW5UcmFuc2FjdGlvbihcIkRlbGV0ZSBBbGwgSW5kZXhlc1wiLCBcInJlYWR3cml0ZVwiLCAoZSA9PiBuLmRlbGV0ZUFsbEZpZWxkSW5kZXhlcyhlKSkpO1xuICAgIH0oYXdhaXQgX19QUklWQVRFX2dldExvY2FsU3RvcmUoZSkpKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIzIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENvbXBhcmVzIHR3byBgRXhwZXJpbWVudGFsTG9uZ1BvbGxpbmdPcHRpb25zYCBvYmplY3RzIGZvciBlcXVhbGl0eS5cbiAqL1xuLyoqXG4gKiBDcmVhdGVzIGFuZCByZXR1cm5zIGEgbmV3IGBFeHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnNgIHdpdGggdGhlIHNhbWVcbiAqIG9wdGlvbiB2YWx1ZXMgYXMgdGhlIGdpdmVuIGluc3RhbmNlLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfY2xvbmVMb25nUG9sbGluZ09wdGlvbnMoZSkge1xuICAgIGNvbnN0IHQgPSB7fTtcbiAgICByZXR1cm4gdm9pZCAwICE9PSBlLnRpbWVvdXRTZWNvbmRzICYmICh0LnRpbWVvdXRTZWNvbmRzID0gZS50aW1lb3V0U2Vjb25kcyksIHQ7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovIGNvbnN0IFp0ID0gbmV3IE1hcDtcblxuLyoqXG4gKiBBbiBpbnN0YW5jZSBtYXAgdGhhdCBlbnN1cmVzIG9ubHkgb25lIERhdGFzdG9yZSBleGlzdHMgcGVyIEZpcmVzdG9yZVxuICogaW5zdGFuY2UuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVOb25FbXB0eUFyZ3VtZW50KGUsIHQsIG4pIHtcbiAgICBpZiAoIW4pIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBGdW5jdGlvbiAke2V9KCkgY2Fubm90IGJlIGNhbGxlZCB3aXRoIGFuIGVtcHR5ICR7dH0uYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgdHdvIGJvb2xlYW4gb3B0aW9ucyBhcmUgbm90IHNldCBhdCB0aGUgc2FtZSB0aW1lLlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlSXNOb3RVc2VkVG9nZXRoZXIoZSwgdCwgbiwgcikge1xuICAgIGlmICghMCA9PT0gdCAmJiAhMCA9PT0gcikgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgYCR7ZX0gYW5kICR7bn0gY2Fubm90IGJlIHVzZWQgdG9nZXRoZXIuYCk7XG59XG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgYHBhdGhgIHJlZmVycyB0byBhIGRvY3VtZW50IChpbmRpY2F0ZWQgYnkgdGhlIGZhY3QgaXQgY29udGFpbnNcbiAqIGFuIGV2ZW4gbnVtYmVycyBvZiBzZWdtZW50cykuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlRG9jdW1lbnRQYXRoKGUpIHtcbiAgICBpZiAoIURvY3VtZW50S2V5LmlzRG9jdW1lbnRLZXkoZSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIGRvY3VtZW50IHJlZmVyZW5jZS4gRG9jdW1lbnQgcmVmZXJlbmNlcyBtdXN0IGhhdmUgYW4gZXZlbiBudW1iZXIgb2Ygc2VnbWVudHMsIGJ1dCAke2V9IGhhcyAke2UubGVuZ3RofS5gKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBgcGF0aGAgcmVmZXJzIHRvIGEgY29sbGVjdGlvbiAoaW5kaWNhdGVkIGJ5IHRoZSBmYWN0IGl0XG4gKiBjb250YWlucyBhbiBvZGQgbnVtYmVycyBvZiBzZWdtZW50cykuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlQ29sbGVjdGlvblBhdGgoZSkge1xuICAgIGlmIChEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KGUpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBjb2xsZWN0aW9uIHJlZmVyZW5jZS4gQ29sbGVjdGlvbiByZWZlcmVuY2VzIG11c3QgaGF2ZSBhbiBvZGQgbnVtYmVyIG9mIHNlZ21lbnRzLCBidXQgJHtlfSBoYXMgJHtlLmxlbmd0aH0uYCk7XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGl0J3MgYSBub24tbnVsbCBvYmplY3Qgd2l0aG91dCBhIGN1c3RvbSBwcm90b3R5cGVcbiAqIChpLmUuIGV4Y2x1ZGVzIEFycmF5LCBEYXRlLCBldGMuKS5cbiAqL1xuLyoqIFJldHVybnMgYSBzdHJpbmcgZGVzY3JpYmluZyB0aGUgdHlwZSAvIHZhbHVlIG9mIHRoZSBwcm92aWRlZCBpbnB1dC4gKi9cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWx1ZURlc2NyaXB0aW9uKGUpIHtcbiAgICBpZiAodm9pZCAwID09PSBlKSByZXR1cm4gXCJ1bmRlZmluZWRcIjtcbiAgICBpZiAobnVsbCA9PT0gZSkgcmV0dXJuIFwibnVsbFwiO1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiBlKSByZXR1cm4gZS5sZW5ndGggPiAyMCAmJiAoZSA9IGAke2Uuc3Vic3RyaW5nKDAsIDIwKX0uLi5gKSwgXG4gICAgSlNPTi5zdHJpbmdpZnkoZSk7XG4gICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIGUgfHwgXCJib29sZWFuXCIgPT0gdHlwZW9mIGUpIHJldHVybiBcIlwiICsgZTtcbiAgICBpZiAoXCJvYmplY3RcIiA9PSB0eXBlb2YgZSkge1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIEFycmF5KSByZXR1cm4gXCJhbiBhcnJheVwiO1xuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCB0ID0gXG4gICAgICAgICAgICAvKiogdHJ5IHRvIGdldCB0aGUgY29uc3RydWN0b3IgbmFtZSBmb3IgYW4gb2JqZWN0LiAqL1xuICAgICAgICAgICAgZnVuY3Rpb24gX19QUklWQVRFX3RyeUdldEN1c3RvbU9iamVjdFR5cGUoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlLmNvbnN0cnVjdG9yKSByZXR1cm4gZS5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLyoqXG4gKiBDYXN0cyBgb2JqYCB0byBgVGAsIG9wdGlvbmFsbHkgdW53cmFwcGluZyBDb21wYXQgdHlwZXMgdG8gZXhwb3NlIHRoZVxuICogdW5kZXJseWluZyBpbnN0YW5jZS4gVGhyb3dzIGlmICBgb2JqYCBpcyBub3QgYW4gaW5zdGFuY2Ugb2YgYFRgLlxuICpcbiAqIFRoaXMgY2FzdCBpcyB1c2VkIGluIHRoZSBMaXRlIGFuZCBGdWxsIFNESyB0byB2ZXJpZnkgaW5zdGFuY2UgdHlwZXMgZm9yXG4gKiBhcmd1bWVudHMgcGFzc2VkIHRvIHRoZSBwdWJsaWMgQVBJLlxuICogQGludGVybmFsXG4gKi8gKGUpO1xuICAgICAgICAgICAgcmV0dXJuIHQgPyBgYSBjdXN0b20gJHt0fSBvYmplY3RgIDogXCJhbiBvYmplY3RcIjtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gXCJmdW5jdGlvblwiID09IHR5cGVvZiBlID8gXCJhIGZ1bmN0aW9uXCIgOiBmYWlsKCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9jYXN0KGUsIFxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbnQpIHtcbiAgICBpZiAoXCJfZGVsZWdhdGVcIiBpbiBlICYmIChcbiAgICAvLyBVbndyYXAgQ29tcGF0IHR5cGVzXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBlID0gZS5fZGVsZWdhdGUpLCAhKGUgaW5zdGFuY2VvZiB0KSkge1xuICAgICAgICBpZiAodC5uYW1lID09PSBlLmNvbnN0cnVjdG9yLm5hbWUpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiVHlwZSBkb2VzIG5vdCBtYXRjaCB0aGUgZXhwZWN0ZWQgaW5zdGFuY2UuIERpZCB5b3UgcGFzcyBhIHJlZmVyZW5jZSBmcm9tIGEgZGlmZmVyZW50IEZpcmVzdG9yZSBTREs/XCIpO1xuICAgICAgICB7XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24oZSk7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgRXhwZWN0ZWQgdHlwZSAnJHt0Lm5hbWV9JywgYnV0IGl0IHdhczogJHtufWApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBlO1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVQb3NpdGl2ZU51bWJlcihlLCB0KSB7XG4gICAgaWYgKHQgPD0gMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgYEZ1bmN0aW9uICR7ZX0oKSByZXF1aXJlcyBhIHBvc2l0aXZlIG51bWJlciwgYnV0IGl0IHdhczogJHt0fS5gKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIHNldHRpbmdzKCkgZGVmYXVsdHM6XG5jb25zdCBYdCA9IFwiZmlyZXN0b3JlLmdvb2dsZWFwaXMuY29tXCIsIGVuID0gITA7XG5cbi8qKlxuICogQSBjb25jcmV0ZSB0eXBlIGRlc2NyaWJpbmcgYWxsIHRoZSB2YWx1ZXMgdGhhdCBjYW4gYmUgYXBwbGllZCB2aWEgYVxuICogdXNlci1zdXBwbGllZCBgRmlyZXN0b3JlU2V0dGluZ3NgIG9iamVjdC4gVGhpcyBpcyBhIHNlcGFyYXRlIHR5cGUgc28gdGhhdFxuICogZGVmYXVsdHMgY2FuIGJlIHN1cHBsaWVkIGFuZCB0aGUgdmFsdWUgY2FuIGJlIGNoZWNrZWQgZm9yIGVxdWFsaXR5LlxuICovXG5jbGFzcyBGaXJlc3RvcmVTZXR0aW5nc0ltcGwge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdmFyIHQsIG47XG4gICAgICAgIGlmICh2b2lkIDAgPT09IGUuaG9zdCkge1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZS5zc2wpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiQ2FuJ3QgcHJvdmlkZSBzc2wgb3B0aW9uIGlmIGhvc3Qgb3B0aW9uIGlzIG5vdCBzZXRcIik7XG4gICAgICAgICAgICB0aGlzLmhvc3QgPSBYdCwgdGhpcy5zc2wgPSBlbjtcbiAgICAgICAgfSBlbHNlIHRoaXMuaG9zdCA9IGUuaG9zdCwgdGhpcy5zc2wgPSBudWxsICE9PSAodCA9IGUuc3NsKSAmJiB2b2lkIDAgIT09IHQgPyB0IDogZW47XG4gICAgICAgIGlmICh0aGlzLmNyZWRlbnRpYWxzID0gZS5jcmVkZW50aWFscywgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzID0gISFlLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIFxuICAgICAgICB0aGlzLmxvY2FsQ2FjaGUgPSBlLmxvY2FsQ2FjaGUsIHZvaWQgMCA9PT0gZS5jYWNoZVNpemVCeXRlcykgdGhpcy5jYWNoZVNpemVCeXRlcyA9IFN0OyBlbHNlIHtcbiAgICAgICAgICAgIGlmICgtMSAhPT0gZS5jYWNoZVNpemVCeXRlcyAmJiBlLmNhY2hlU2l6ZUJ5dGVzIDwgRHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiY2FjaGVTaXplQnl0ZXMgbXVzdCBiZSBhdCBsZWFzdCAxMDQ4NTc2XCIpO1xuICAgICAgICAgICAgdGhpcy5jYWNoZVNpemVCeXRlcyA9IGUuY2FjaGVTaXplQnl0ZXM7XG4gICAgICAgIH1cbiAgICAgICAgX19QUklWQVRFX3ZhbGlkYXRlSXNOb3RVc2VkVG9nZXRoZXIoXCJleHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nXCIsIGUuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZywgXCJleHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmdcIiwgZS5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcpLCBcbiAgICAgICAgdGhpcy5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nID0gISFlLmV4cGVyaW1lbnRhbEZvcmNlTG9uZ1BvbGxpbmcsIHRoaXMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZyA/IHRoaXMuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nID0gITEgOiB2b2lkIDAgPT09IGUuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nID8gdGhpcy5leHBlcmltZW50YWxBdXRvRGV0ZWN0TG9uZ1BvbGxpbmcgPSB0cnVlIDogXG4gICAgICAgIC8vIEZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eSwgY29lcmNlIHRoZSB2YWx1ZSB0byBib29sZWFuIGV2ZW4gdGhvdWdoXG4gICAgICAgIC8vIHRoZSBUeXBlU2NyaXB0IGNvbXBpbGVyIGhhcyBuYXJyb3dlZCB0aGUgdHlwZSB0byBib29sZWFuIGFscmVhZHkuXG4gICAgICAgIC8vIG5vaW5zcGVjdGlvbiBQb2ludGxlc3NCb29sZWFuRXhwcmVzc2lvbkpTXG4gICAgICAgIHRoaXMuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nID0gISFlLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZywgXG4gICAgICAgIHRoaXMuZXhwZXJpbWVudGFsTG9uZ1BvbGxpbmdPcHRpb25zID0gX19QUklWQVRFX2Nsb25lTG9uZ1BvbGxpbmdPcHRpb25zKG51bGwgIT09IChuID0gZS5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMpICYmIHZvaWQgMCAhPT0gbiA/IG4gOiB7fSksIFxuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVMb25nUG9sbGluZ09wdGlvbnMoZSkge1xuICAgICAgICAgICAgaWYgKHZvaWQgMCAhPT0gZS50aW1lb3V0U2Vjb25kcykge1xuICAgICAgICAgICAgICAgIGlmIChpc05hTihlLnRpbWVvdXRTZWNvbmRzKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgYGludmFsaWQgbG9uZyBwb2xsaW5nIHRpbWVvdXQ6ICR7ZS50aW1lb3V0U2Vjb25kc30gKG11c3Qgbm90IGJlIE5hTilgKTtcbiAgICAgICAgICAgICAgICBpZiAoZS50aW1lb3V0U2Vjb25kcyA8IDUpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBpbnZhbGlkIGxvbmcgcG9sbGluZyB0aW1lb3V0OiAke2UudGltZW91dFNlY29uZHN9IChtaW5pbXVtIGFsbG93ZWQgdmFsdWUgaXMgNSlgKTtcbiAgICAgICAgICAgICAgICBpZiAoZS50aW1lb3V0U2Vjb25kcyA+IDMwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgaW52YWxpZCBsb25nIHBvbGxpbmcgdGltZW91dDogJHtlLnRpbWVvdXRTZWNvbmRzfSAobWF4aW11bSBhbGxvd2VkIHZhbHVlIGlzIDMwKWApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4gICAgICAgIC8qKlxuICogVGhlIENsb3VkIEZpcmVzdG9yZSBzZXJ2aWNlIGludGVyZmFjZS5cbiAqXG4gKiBEbyBub3QgY2FsbCB0aGlzIGNvbnN0cnVjdG9yIGRpcmVjdGx5LiBJbnN0ZWFkLCB1c2Uge0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9LlxuICovICh0aGlzLmV4cGVyaW1lbnRhbExvbmdQb2xsaW5nT3B0aW9ucyksIHRoaXMudXNlRmV0Y2hTdHJlYW1zID0gISFlLnVzZUZldGNoU3RyZWFtcztcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhvc3QgPT09IGUuaG9zdCAmJiB0aGlzLnNzbCA9PT0gZS5zc2wgJiYgdGhpcy5jcmVkZW50aWFscyA9PT0gZS5jcmVkZW50aWFscyAmJiB0aGlzLmNhY2hlU2l6ZUJ5dGVzID09PSBlLmNhY2hlU2l6ZUJ5dGVzICYmIHRoaXMuZXhwZXJpbWVudGFsRm9yY2VMb25nUG9sbGluZyA9PT0gZS5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nICYmIHRoaXMuZXhwZXJpbWVudGFsQXV0b0RldGVjdExvbmdQb2xsaW5nID09PSBlLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZyAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfbG9uZ1BvbGxpbmdPcHRpb25zRXF1YWwoZSwgdCkge1xuICAgICAgICAgICAgcmV0dXJuIGUudGltZW91dFNlY29uZHMgPT09IHQudGltZW91dFNlY29uZHM7XG4gICAgICAgIH0odGhpcy5leHBlcmltZW50YWxMb25nUG9sbGluZ09wdGlvbnMsIGUuZXhwZXJpbWVudGFsTG9uZ1BvbGxpbmdPcHRpb25zKSAmJiB0aGlzLmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgPT09IGUuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyAmJiB0aGlzLnVzZUZldGNoU3RyZWFtcyA9PT0gZS51c2VGZXRjaFN0cmVhbXM7XG4gICAgfVxufVxuXG5jbGFzcyBGaXJlc3RvcmUkMSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMuX2F1dGhDcmVkZW50aWFscyA9IGUsIHRoaXMuX2FwcENoZWNrQ3JlZGVudGlhbHMgPSB0LCB0aGlzLl9kYXRhYmFzZUlkID0gbiwgXG4gICAgICAgIHRoaXMuX2FwcCA9IHIsIFxuICAgICAgICAvKipcbiAgICAgICAgICogV2hldGhlciBpdCdzIGEgRmlyZXN0b3JlIG9yIEZpcmVzdG9yZSBMaXRlIGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJmaXJlc3RvcmUtbGl0ZVwiLCB0aGlzLl9wZXJzaXN0ZW5jZUtleSA9IFwiKGxpdGUpXCIsIHRoaXMuX3NldHRpbmdzID0gbmV3IEZpcmVzdG9yZVNldHRpbmdzSW1wbCh7fSksIFxuICAgICAgICB0aGlzLl9zZXR0aW5nc0Zyb3plbiA9ICExLCB0aGlzLl9lbXVsYXRvck9wdGlvbnMgPSB7fSwgXG4gICAgICAgIC8vIEEgdGFzayB0aGF0IGlzIGFzc2lnbmVkIHdoZW4gdGhlIHRlcm1pbmF0ZSgpIGlzIGludm9rZWQgYW5kIHJlc29sdmVkIHdoZW5cbiAgICAgICAgLy8gYWxsIGNvbXBvbmVudHMgaGF2ZSBzaHV0IGRvd24uIE90aGVyd2lzZSwgRmlyZXN0b3JlIGlzIG5vdCB0ZXJtaW5hdGVkLFxuICAgICAgICAvLyB3aGljaCBjYW4gbWVhbiBlaXRoZXIgdGhlIEZpcmVzdG9yZUNsaWVudCBpcyBpbiB0aGUgcHJvY2VzcyBvZiBzdGFydGluZyxcbiAgICAgICAgLy8gb3IgcmVzdGFydGluZy5cbiAgICAgICAgdGhpcy5fdGVybWluYXRlVGFzayA9IFwibm90VGVybWluYXRlZFwiO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGFzc29jaWF0ZWQgd2l0aCB0aGlzIGBGaXJlc3RvcmVgIHNlcnZpY2VcbiAgICAgKiBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGFwcCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9hcHApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiRmlyZXN0b3JlIHdhcyBub3QgaW5pdGlhbGl6ZWQgdXNpbmcgdGhlIEZpcmViYXNlIFNESy4gJ2FwcCcgaXMgbm90IGF2YWlsYWJsZVwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2FwcDtcbiAgICB9XG4gICAgZ2V0IF9pbml0aWFsaXplZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzRnJvemVuO1xuICAgIH1cbiAgICBnZXQgX3Rlcm1pbmF0ZWQoKSB7XG4gICAgICAgIHJldHVybiBcIm5vdFRlcm1pbmF0ZWRcIiAhPT0gdGhpcy5fdGVybWluYXRlVGFzaztcbiAgICB9XG4gICAgX3NldFNldHRpbmdzKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuX3NldHRpbmdzRnJvemVuKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5GQUlMRURfUFJFQ09ORElUSU9OLCBcIkZpcmVzdG9yZSBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQgYW5kIGl0cyBzZXR0aW5ncyBjYW4gbm8gbG9uZ2VyIGJlIGNoYW5nZWQuIFlvdSBjYW4gb25seSBtb2RpZnkgc2V0dGluZ3MgYmVmb3JlIGNhbGxpbmcgYW55IG90aGVyIG1ldGhvZHMgb24gYSBGaXJlc3RvcmUgb2JqZWN0LlwiKTtcbiAgICAgICAgdGhpcy5fc2V0dGluZ3MgPSBuZXcgRmlyZXN0b3JlU2V0dGluZ3NJbXBsKGUpLCB0aGlzLl9lbXVsYXRvck9wdGlvbnMgPSBlLmVtdWxhdG9yT3B0aW9ucyB8fCB7fSwgXG4gICAgICAgIHZvaWQgMCAhPT0gZS5jcmVkZW50aWFscyAmJiAodGhpcy5fYXV0aENyZWRlbnRpYWxzID0gZnVuY3Rpb24gX19QUklWQVRFX21ha2VBdXRoQ3JlZGVudGlhbHNQcm92aWRlcihlKSB7XG4gICAgICAgICAgICBpZiAoIWUpIHJldHVybiBuZXcgX19QUklWQVRFX0VtcHR5QXV0aENyZWRlbnRpYWxzUHJvdmlkZXI7XG4gICAgICAgICAgICBzd2l0Y2ggKGUudHlwZSkge1xuICAgICAgICAgICAgICBjYXNlIFwiZmlyc3RQYXJ0eVwiOlxuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX0ZpcnN0UGFydHlBdXRoQ3JlZGVudGlhbHNQcm92aWRlcihlLnNlc3Npb25JbmRleCB8fCBcIjBcIiwgZS5pYW1Ub2tlbiB8fCBudWxsLCBlLmF1dGhUb2tlbkZhY3RvcnkgfHwgbnVsbCk7XG5cbiAgICAgICAgICAgICAgY2FzZSBcInByb3ZpZGVyXCI6XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuY2xpZW50O1xuXG4gICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJtYWtlQXV0aENyZWRlbnRpYWxzUHJvdmlkZXIgZmFpbGVkIGR1ZSB0byBpbnZhbGlkIGNyZWRlbnRpYWwgdHlwZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfShlLmNyZWRlbnRpYWxzKSk7XG4gICAgfVxuICAgIF9nZXRTZXR0aW5ncygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NldHRpbmdzO1xuICAgIH1cbiAgICBfZ2V0RW11bGF0b3JPcHRpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fZW11bGF0b3JPcHRpb25zO1xuICAgIH1cbiAgICBfZnJlZXplU2V0dGluZ3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9zZXR0aW5nc0Zyb3plbiA9ICEwLCB0aGlzLl9zZXR0aW5ncztcbiAgICB9XG4gICAgX2RlbGV0ZSgpIHtcbiAgICAgICAgLy8gVGhlIGBfdGVybWluYXRlVGFza2AgbXVzdCBiZSBhc3NpZ25lZCBmdXR1cmUgdGhhdCBjb21wbGV0ZXMgd2hlblxuICAgICAgICAvLyB0ZXJtaW5hdGUgaXMgY29tcGxldGUuIFRoZSBleGlzdGVuY2Ugb2YgdGhpcyBmdXR1cmUgcHV0cyBTREsgaW4gc3RhdGVcbiAgICAgICAgLy8gdGhhdCB3aWxsIG5vdCBhY2NlcHQgZnVydGhlciBBUEkgaW50ZXJhY3Rpb24uXG4gICAgICAgIHJldHVybiBcIm5vdFRlcm1pbmF0ZWRcIiA9PT0gdGhpcy5fdGVybWluYXRlVGFzayAmJiAodGhpcy5fdGVybWluYXRlVGFzayA9IHRoaXMuX3Rlcm1pbmF0ZSgpKSwgXG4gICAgICAgIHRoaXMuX3Rlcm1pbmF0ZVRhc2s7XG4gICAgfVxuICAgIGFzeW5jIF9yZXN0YXJ0KCkge1xuICAgICAgICAvLyBUaGUgYF90ZXJtaW5hdGVUYXNrYCBtdXN0IGVxdWFsICdub3RUZXJtaW5hdGVkJyBhZnRlciByZXN0YXJ0IHRvXG4gICAgICAgIC8vIHNpZ25hbCB0aGF0IGNsaWVudCBpcyBpbiBhIHN0YXRlIHRoYXQgYWNjZXB0cyBBUEkgY2FsbHMuXG4gICAgICAgIFwibm90VGVybWluYXRlZFwiID09PSB0aGlzLl90ZXJtaW5hdGVUYXNrID8gYXdhaXQgdGhpcy5fdGVybWluYXRlKCkgOiB0aGlzLl90ZXJtaW5hdGVUYXNrID0gXCJub3RUZXJtaW5hdGVkXCI7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBgRmlyZXN0b3JlYCBpbnN0YW5jZS4gKi8gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgYXBwOiB0aGlzLl9hcHAsXG4gICAgICAgICAgICBkYXRhYmFzZUlkOiB0aGlzLl9kYXRhYmFzZUlkLFxuICAgICAgICAgICAgc2V0dGluZ3M6IHRoaXMuX3NldHRpbmdzXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRlcm1pbmF0ZXMgYWxsIGNvbXBvbmVudHMgdXNlZCBieSB0aGlzIGNsaWVudC4gU3ViY2xhc3NlcyBjYW4gb3ZlcnJpZGVcbiAgICAgKiB0aGlzIG1ldGhvZCB0byBjbGVhbiB1cCB0aGVpciBvd24gZGVwZW5kZW5jaWVzLCBidXQgbXVzdCBhbHNvIGNhbGwgdGhpc1xuICAgICAqIG1ldGhvZC5cbiAgICAgKlxuICAgICAqIE9ubHkgZXZlciBjYWxsZWQgb25jZS5cbiAgICAgKi8gICAgX3Rlcm1pbmF0ZSgpIHtcbiAgICAgICAgLyoqXG4gKiBSZW1vdmVzIGFsbCBjb21wb25lbnRzIGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJvdmlkZWQgaW5zdGFuY2UuIE11c3QgYmUgY2FsbGVkXG4gKiB3aGVuIHRoZSBgRmlyZXN0b3JlYCBpbnN0YW5jZSBpcyB0ZXJtaW5hdGVkLlxuICovXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcmVtb3ZlQ29tcG9uZW50cyhlKSB7XG4gICAgICAgICAgICBjb25zdCB0ID0gWnQuZ2V0KGUpO1xuICAgICAgICAgICAgdCAmJiAoX19QUklWQVRFX2xvZ0RlYnVnKFwiQ29tcG9uZW50UHJvdmlkZXJcIiwgXCJSZW1vdmluZyBEYXRhc3RvcmVcIiksIFp0LmRlbGV0ZShlKSwgXG4gICAgICAgICAgICB0LnRlcm1pbmF0ZSgpKTtcbiAgICAgICAgfSh0aGlzKSwgUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIE1vZGlmeSB0aGlzIGluc3RhbmNlIHRvIGNvbW11bmljYXRlIHdpdGggdGhlIENsb3VkIEZpcmVzdG9yZSBlbXVsYXRvci5cbiAqXG4gKiBOb3RlOiBUaGlzIG11c3QgYmUgY2FsbGVkIGJlZm9yZSB0aGlzIGluc3RhbmNlIGhhcyBiZWVuIHVzZWQgdG8gZG8gYW55XG4gKiBvcGVyYXRpb25zLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUgYEZpcmVzdG9yZWAgaW5zdGFuY2UgdG8gY29uZmlndXJlIHRvIGNvbm5lY3QgdG8gdGhlXG4gKiBlbXVsYXRvci5cbiAqIEBwYXJhbSBob3N0IC0gdGhlIGVtdWxhdG9yIGhvc3QgKGV4OiBsb2NhbGhvc3QpLlxuICogQHBhcmFtIHBvcnQgLSB0aGUgZW11bGF0b3IgcG9ydCAoZXg6IDkwMDApLlxuICogQHBhcmFtIG9wdGlvbnMubW9ja1VzZXJUb2tlbiAtIHRoZSBtb2NrIGF1dGggdG9rZW4gdG8gdXNlIGZvciB1bml0IHRlc3RpbmdcbiAqIFNlY3VyaXR5IFJ1bGVzLlxuICovIGZ1bmN0aW9uIGNvbm5lY3RGaXJlc3RvcmVFbXVsYXRvcihlLCB0LCBuLCByID0ge30pIHtcbiAgICB2YXIgaTtcbiAgICBjb25zdCBzID0gKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUkMSkpLl9nZXRTZXR0aW5ncygpLCBvID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzKSwge1xuICAgICAgICBlbXVsYXRvck9wdGlvbnM6IGUuX2dldEVtdWxhdG9yT3B0aW9ucygpXG4gICAgfSksIF8gPSBgJHt0fToke259YDtcbiAgICBzLmhvc3QgIT09IFh0ICYmIHMuaG9zdCAhPT0gXyAmJiBfX1BSSVZBVEVfbG9nV2FybihcIkhvc3QgaGFzIGJlZW4gc2V0IGluIGJvdGggc2V0dGluZ3MoKSBhbmQgY29ubmVjdEZpcmVzdG9yZUVtdWxhdG9yKCksIGVtdWxhdG9yIGhvc3Qgd2lsbCBiZSB1c2VkLlwiKTtcbiAgICBjb25zdCBhID0gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LCBzKSwge1xuICAgICAgICBob3N0OiBfLFxuICAgICAgICBzc2w6ICExLFxuICAgICAgICBlbXVsYXRvck9wdGlvbnM6IHJcbiAgICB9KTtcbiAgICAvLyBOby1vcCBpZiB0aGUgbmV3IGNvbmZpZ3VyYXRpb24gbWF0Y2hlcyB0aGUgY3VycmVudCBjb25maWd1cmF0aW9uLiBUaGlzIHN1cHBvcnRzIFNTUlxuICAgIC8vIGVudmlvcm5tZW50cyB3aGljaCBtaWdodCBjYWxsIGBjb25uZWN0RmlyZXN0b3JlRW11bGF0b3JgIG11bHRpcGxlIHRpbWVzIGFzIGEgc3RhbmRhcmQgcHJhY3RpY2UuXG4gICAgICAgIGlmICghZGVlcEVxdWFsKGEsIG8pICYmIChlLl9zZXRTZXR0aW5ncyhhKSwgci5tb2NrVXNlclRva2VuKSkge1xuICAgICAgICBsZXQgdCwgbjtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHIubW9ja1VzZXJUb2tlbikgdCA9IHIubW9ja1VzZXJUb2tlbiwgbiA9IFVzZXIuTU9DS19VU0VSOyBlbHNlIHtcbiAgICAgICAgICAgIC8vIExldCBjcmVhdGVNb2NrVXNlclRva2VuIHZhbGlkYXRlIGZpcnN0IChjYXRjaGVzIGNvbW1vbiBtaXN0YWtlcyBsaWtlXG4gICAgICAgICAgICAvLyBpbnZhbGlkIGZpZWxkIFwidWlkXCIgYW5kIG1pc3NpbmcgZmllbGQgXCJzdWJcIiAvIFwidXNlcl9pZFwiLilcbiAgICAgICAgICAgIHQgPSBjcmVhdGVNb2NrVXNlclRva2VuKHIubW9ja1VzZXJUb2tlbiwgbnVsbCA9PT0gKGkgPSBlLl9hcHApIHx8IHZvaWQgMCA9PT0gaSA/IHZvaWQgMCA6IGkub3B0aW9ucy5wcm9qZWN0SWQpO1xuICAgICAgICAgICAgY29uc3QgcyA9IHIubW9ja1VzZXJUb2tlbi5zdWIgfHwgci5tb2NrVXNlclRva2VuLnVzZXJfaWQ7XG4gICAgICAgICAgICBpZiAoIXMpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwibW9ja1VzZXJUb2tlbiBtdXN0IGNvbnRhaW4gJ3N1Yicgb3IgJ3VzZXJfaWQnIGZpZWxkIVwiKTtcbiAgICAgICAgICAgIG4gPSBuZXcgVXNlcihzKTtcbiAgICAgICAgfVxuICAgICAgICBlLl9hdXRoQ3JlZGVudGlhbHMgPSBuZXcgX19QUklWQVRFX0VtdWxhdG9yQXV0aENyZWRlbnRpYWxzUHJvdmlkZXIobmV3IF9fUFJJVkFURV9PQXV0aFRva2VuKHQsIG4pKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYFF1ZXJ5YCByZWZlcnMgdG8gYSBxdWVyeSB3aGljaCB5b3UgY2FuIHJlYWQgb3IgbGlzdGVuIHRvLiBZb3UgY2FuIGFsc29cbiAqIGNvbnN0cnVjdCByZWZpbmVkIGBRdWVyeWAgb2JqZWN0cyBieSBhZGRpbmcgZmlsdGVycyBhbmQgb3JkZXJpbmcuXG4gKi8gY2xhc3MgUXVlcnkge1xuICAgIC8vIFRoaXMgaXMgdGhlIGxpdGUgdmVyc2lvbiBvZiB0aGUgUXVlcnkgY2xhc3MgaW4gdGhlIG1haW4gU0RLLlxuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yIHByb3RlY3RlZCAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIFxuICAgIC8qKlxuICAgICAqIElmIHByb3ZpZGVkLCB0aGUgYEZpcmVzdG9yZURhdGFDb252ZXJ0ZXJgIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGluc3RhbmNlLlxuICAgICAqL1xuICAgIHQsIG4pIHtcbiAgICAgICAgdGhpcy5jb252ZXJ0ZXIgPSB0LCB0aGlzLl9xdWVyeSA9IG4sIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBGaXJlc3RvcmUgcmVmZXJlbmNlLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcInF1ZXJ5XCIsIHRoaXMuZmlyZXN0b3JlID0gZTtcbiAgICB9XG4gICAgd2l0aENvbnZlcnRlcihlKSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnkodGhpcy5maXJlc3RvcmUsIGUsIHRoaXMuX3F1ZXJ5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQSBgRG9jdW1lbnRSZWZlcmVuY2VgIHJlZmVycyB0byBhIGRvY3VtZW50IGxvY2F0aW9uIGluIGEgRmlyZXN0b3JlIGRhdGFiYXNlXG4gKiBhbmQgY2FuIGJlIHVzZWQgdG8gd3JpdGUsIHJlYWQsIG9yIGxpc3RlbiB0byB0aGUgbG9jYXRpb24uIFRoZSBkb2N1bWVudCBhdFxuICogdGhlIHJlZmVyZW5jZWQgbG9jYXRpb24gbWF5IG9yIG1heSBub3QgZXhpc3QuXG4gKi8gY2xhc3MgRG9jdW1lbnRSZWZlcmVuY2Uge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLyoqXG4gICAgICogSWYgcHJvdmlkZWQsIHRoZSBgRmlyZXN0b3JlRGF0YUNvbnZlcnRlcmAgYXNzb2NpYXRlZCB3aXRoIHRoaXMgaW5zdGFuY2UuXG4gICAgICovXG4gICAgdCwgbikge1xuICAgICAgICB0aGlzLmNvbnZlcnRlciA9IHQsIHRoaXMuX2tleSA9IG4sIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBGaXJlc3RvcmUgcmVmZXJlbmNlLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcImRvY3VtZW50XCIsIHRoaXMuZmlyZXN0b3JlID0gZTtcbiAgICB9XG4gICAgZ2V0IF9wYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fa2V5LnBhdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBkb2N1bWVudCdzIGlkZW50aWZpZXIgd2l0aGluIGl0cyBjb2xsZWN0aW9uLlxuICAgICAqLyAgICBnZXQgaWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHN0cmluZyByZXByZXNlbnRpbmcgdGhlIHBhdGggb2YgdGhlIHJlZmVyZW5jZWQgZG9jdW1lbnQgKHJlbGF0aXZlXG4gICAgICogdG8gdGhlIHJvb3Qgb2YgdGhlIGRhdGFiYXNlKS5cbiAgICAgKi8gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aC5jYW5vbmljYWxTdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGNvbGxlY3Rpb24gdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGJlbG9uZ3MgdG8uXG4gICAgICovICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvblJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgdGhpcy5jb252ZXJ0ZXIsIHRoaXMuX2tleS5wYXRoLnBvcExhc3QoKSk7XG4gICAgfVxuICAgIHdpdGhDb252ZXJ0ZXIoZSkge1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50UmVmZXJlbmNlKHRoaXMuZmlyZXN0b3JlLCBlLCB0aGlzLl9rZXkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBDb2xsZWN0aW9uUmVmZXJlbmNlYCBvYmplY3QgY2FuIGJlIHVzZWQgZm9yIGFkZGluZyBkb2N1bWVudHMsIGdldHRpbmdcbiAqIGRvY3VtZW50IHJlZmVyZW5jZXMsIGFuZCBxdWVyeWluZyBmb3IgZG9jdW1lbnRzICh1c2luZyB7QGxpbmsgKHF1ZXJ5OjEpfSkuXG4gKi8gY2xhc3MgQ29sbGVjdGlvblJlZmVyZW5jZSBleHRlbmRzIFF1ZXJ5IHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4pIHtcbiAgICAgICAgc3VwZXIoZSwgdCwgX19QUklWQVRFX25ld1F1ZXJ5Rm9yUGF0aChuKSksIHRoaXMuX3BhdGggPSBuLCBcbiAgICAgICAgLyoqIFRoZSB0eXBlIG9mIHRoaXMgRmlyZXN0b3JlIHJlZmVyZW5jZS4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJjb2xsZWN0aW9uXCI7XG4gICAgfVxuICAgIC8qKiBUaGUgY29sbGVjdGlvbidzIGlkZW50aWZpZXIuICovICAgIGdldCBpZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3F1ZXJ5LnBhdGgubGFzdFNlZ21lbnQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQSBzdHJpbmcgcmVwcmVzZW50aW5nIHRoZSBwYXRoIG9mIHRoZSByZWZlcmVuY2VkIGNvbGxlY3Rpb24gKHJlbGF0aXZlXG4gICAgICogdG8gdGhlIHJvb3Qgb2YgdGhlIGRhdGFiYXNlKS5cbiAgICAgKi8gICAgZ2V0IHBhdGgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9xdWVyeS5wYXRoLmNhbm9uaWNhbFN0cmluZygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBIHJlZmVyZW5jZSB0byB0aGUgY29udGFpbmluZyBgRG9jdW1lbnRSZWZlcmVuY2VgIGlmIHRoaXMgaXMgYVxuICAgICAqIHN1YmNvbGxlY3Rpb24uIElmIHRoaXMgaXNuJ3QgYSBzdWJjb2xsZWN0aW9uLCB0aGUgcmVmZXJlbmNlIGlzIG51bGwuXG4gICAgICovICAgIGdldCBwYXJlbnQoKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0aGlzLl9wYXRoLnBvcExhc3QoKTtcbiAgICAgICAgcmV0dXJuIGUuaXNFbXB0eSgpID8gbnVsbCA6IG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgXG4gICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgbmV3IERvY3VtZW50S2V5KGUpKTtcbiAgICB9XG4gICAgd2l0aENvbnZlcnRlcihlKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29sbGVjdGlvblJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgZSwgdGhpcy5fcGF0aCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBjb2xsZWN0aW9uKGUsIHQsIC4uLm4pIHtcbiAgICBpZiAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgX19QUklWQVRFX3ZhbGlkYXRlTm9uRW1wdHlBcmd1bWVudChcImNvbGxlY3Rpb25cIiwgXCJwYXRoXCIsIHQpLCBlIGluc3RhbmNlb2YgRmlyZXN0b3JlJDEpIHtcbiAgICAgICAgY29uc3QgciA9IFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKHQsIC4uLm4pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlQ29sbGVjdGlvblBhdGgociksIG5ldyBDb2xsZWN0aW9uUmVmZXJlbmNlKGUsIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgcik7XG4gICAgfVxuICAgIHtcbiAgICAgICAgaWYgKCEoZSBpbnN0YW5jZW9mIERvY3VtZW50UmVmZXJlbmNlIHx8IGUgaW5zdGFuY2VvZiBDb2xsZWN0aW9uUmVmZXJlbmNlKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJFeHBlY3RlZCBmaXJzdCBhcmd1bWVudCB0byBjb2xsZWN0aW9uKCkgdG8gYmUgYSBDb2xsZWN0aW9uUmVmZXJlbmNlLCBhIERvY3VtZW50UmVmZXJlbmNlIG9yIEZpcmViYXNlRmlyZXN0b3JlXCIpO1xuICAgICAgICBjb25zdCByID0gZS5fcGF0aC5jaGlsZChSZXNvdXJjZVBhdGguZnJvbVN0cmluZyh0LCAuLi5uKSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVDb2xsZWN0aW9uUGF0aChyKSwgbmV3IENvbGxlY3Rpb25SZWZlcmVuY2UoZS5maXJlc3RvcmUsIFxuICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHIpO1xuICAgIH1cbn1cblxuLy8gVE9ETyhmaXJlc3RvcmVsaXRlKTogQ29uc2lkZXIgdXNpbmcgRXJyb3JGYWN0b3J5IC1cbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9maXJlYmFzZS9maXJlYmFzZS1qcy1zZGsvYmxvYi8wMTMxZTFmL3BhY2thZ2VzL3V0aWwvc3JjL2Vycm9ycy50cyNMMTA2XG4vKipcbiAqIENyZWF0ZXMgYW5kIHJldHVybnMgYSBuZXcgYFF1ZXJ5YCBpbnN0YW5jZSB0aGF0IGluY2x1ZGVzIGFsbCBkb2N1bWVudHMgaW4gdGhlXG4gKiBkYXRhYmFzZSB0aGF0IGFyZSBjb250YWluZWQgaW4gYSBjb2xsZWN0aW9uIG9yIHN1YmNvbGxlY3Rpb24gd2l0aCB0aGVcbiAqIGdpdmVuIGBjb2xsZWN0aW9uSWRgLlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBBIHJlZmVyZW5jZSB0byB0aGUgcm9vdCBgRmlyZXN0b3JlYCBpbnN0YW5jZS5cbiAqIEBwYXJhbSBjb2xsZWN0aW9uSWQgLSBJZGVudGlmaWVzIHRoZSBjb2xsZWN0aW9ucyB0byBxdWVyeSBvdmVyLiBFdmVyeVxuICogY29sbGVjdGlvbiBvciBzdWJjb2xsZWN0aW9uIHdpdGggdGhpcyBJRCBhcyB0aGUgbGFzdCBzZWdtZW50IG9mIGl0cyBwYXRoXG4gKiB3aWxsIGJlIGluY2x1ZGVkLiBDYW5ub3QgY29udGFpbiBhIHNsYXNoLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQgYFF1ZXJ5YC5cbiAqLyBmdW5jdGlvbiBjb2xsZWN0aW9uR3JvdXAoZSwgdCkge1xuICAgIGlmIChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlJDEpLCBfX1BSSVZBVEVfdmFsaWRhdGVOb25FbXB0eUFyZ3VtZW50KFwiY29sbGVjdGlvbkdyb3VwXCIsIFwiY29sbGVjdGlvbiBpZFwiLCB0KSwgXG4gICAgdC5pbmRleE9mKFwiL1wiKSA+PSAwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBjb2xsZWN0aW9uIElEICcke3R9JyBwYXNzZWQgdG8gZnVuY3Rpb24gY29sbGVjdGlvbkdyb3VwKCkuIENvbGxlY3Rpb24gSURzIG11c3Qgbm90IGNvbnRhaW4gJy8nLmApO1xuICAgIHJldHVybiBuZXcgUXVlcnkoZSwgXG4gICAgLyogY29udmVydGVyPSAqLyBudWxsLCBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlGb3JDb2xsZWN0aW9uR3JvdXAoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoUmVzb3VyY2VQYXRoLmVtcHR5UGF0aCgpLCBlKTtcbiAgICB9KHQpKTtcbn1cblxuZnVuY3Rpb24gZG9jKGUsIHQsIC4uLm4pIHtcbiAgICBpZiAoZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgXG4gICAgLy8gV2UgYWxsb3cgb21pc3Npb24gb2YgJ3BhdGhTdHJpbmcnIGJ1dCBleHBsaWNpdGx5IHByb2hpYml0IHBhc3NpbmcgaW4gYm90aFxuICAgIC8vICd1bmRlZmluZWQnIGFuZCAnbnVsbCcuXG4gICAgMSA9PT0gYXJndW1lbnRzLmxlbmd0aCAmJiAodCA9IF9fUFJJVkFURV9BdXRvSWQubmV3SWQoKSksIF9fUFJJVkFURV92YWxpZGF0ZU5vbkVtcHR5QXJndW1lbnQoXCJkb2NcIiwgXCJwYXRoXCIsIHQpLCBcbiAgICBlIGluc3RhbmNlb2YgRmlyZXN0b3JlJDEpIHtcbiAgICAgICAgY29uc3QgciA9IFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKHQsIC4uLm4pO1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlRG9jdW1lbnRQYXRoKHIpLCBuZXcgRG9jdW1lbnRSZWZlcmVuY2UoZSwgXG4gICAgICAgIC8qIGNvbnZlcnRlcj0gKi8gbnVsbCwgbmV3IERvY3VtZW50S2V5KHIpKTtcbiAgICB9XG4gICAge1xuICAgICAgICBpZiAoIShlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UgfHwgZSBpbnN0YW5jZW9mIENvbGxlY3Rpb25SZWZlcmVuY2UpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIkV4cGVjdGVkIGZpcnN0IGFyZ3VtZW50IHRvIGNvbGxlY3Rpb24oKSB0byBiZSBhIENvbGxlY3Rpb25SZWZlcmVuY2UsIGEgRG9jdW1lbnRSZWZlcmVuY2Ugb3IgRmlyZWJhc2VGaXJlc3RvcmVcIik7XG4gICAgICAgIGNvbnN0IHIgPSBlLl9wYXRoLmNoaWxkKFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKHQsIC4uLm4pKTtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZURvY3VtZW50UGF0aChyKSwgbmV3IERvY3VtZW50UmVmZXJlbmNlKGUuZmlyZXN0b3JlLCBlIGluc3RhbmNlb2YgQ29sbGVjdGlvblJlZmVyZW5jZSA/IGUuY29udmVydGVyIDogbnVsbCwgbmV3IERvY3VtZW50S2V5KHIpKTtcbiAgICB9XG59XG5cbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIHRoZSBwcm92aWRlZCByZWZlcmVuY2VzIGFyZSBlcXVhbC5cbiAqXG4gKiBAcGFyYW0gbGVmdCAtIEEgcmVmZXJlbmNlIHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBBIHJlZmVyZW5jZSB0byBjb21wYXJlLlxuICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgcmVmZXJlbmNlcyBwb2ludCB0byB0aGUgc2FtZSBsb2NhdGlvbiBpbiB0aGUgc2FtZVxuICogRmlyZXN0b3JlIGRhdGFiYXNlLlxuICovIGZ1bmN0aW9uIHJlZkVxdWFsKGUsIHQpIHtcbiAgICByZXR1cm4gZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKSwgdCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSwgKGUgaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSB8fCBlIGluc3RhbmNlb2YgQ29sbGVjdGlvblJlZmVyZW5jZSkgJiYgKHQgaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSB8fCB0IGluc3RhbmNlb2YgQ29sbGVjdGlvblJlZmVyZW5jZSkgJiYgKGUuZmlyZXN0b3JlID09PSB0LmZpcmVzdG9yZSAmJiBlLnBhdGggPT09IHQucGF0aCAmJiBlLmNvbnZlcnRlciA9PT0gdC5jb252ZXJ0ZXIpO1xufVxuXG4vKipcbiAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgcHJvdmlkZWQgcXVlcmllcyBwb2ludCB0byB0aGUgc2FtZSBjb2xsZWN0aW9uIGFuZCBhcHBseVxuICogdGhlIHNhbWUgY29uc3RyYWludHMuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBBIGBRdWVyeWAgdG8gY29tcGFyZS5cbiAqIEBwYXJhbSByaWdodCAtIEEgYFF1ZXJ5YCB0byBjb21wYXJlLlxuICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgcmVmZXJlbmNlcyBwb2ludCB0byB0aGUgc2FtZSBsb2NhdGlvbiBpbiB0aGUgc2FtZVxuICogRmlyZXN0b3JlIGRhdGFiYXNlLlxuICovIGZ1bmN0aW9uIHF1ZXJ5RXF1YWwoZSwgdCkge1xuICAgIHJldHVybiBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpLCB0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpLCBlIGluc3RhbmNlb2YgUXVlcnkgJiYgdCBpbnN0YW5jZW9mIFF1ZXJ5ICYmIChlLmZpcmVzdG9yZSA9PT0gdC5maXJlc3RvcmUgJiYgX19QUklWQVRFX3F1ZXJ5RXF1YWxzKGUuX3F1ZXJ5LCB0Ll9xdWVyeSkgJiYgZS5jb252ZXJ0ZXIgPT09IHQuY29udmVydGVyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gY29uc3QgdG4gPSBcIkFzeW5jUXVldWVcIjtcblxuY2xhc3MgX19QUklWQVRFX0FzeW5jUXVldWVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlID0gUHJvbWlzZS5yZXNvbHZlKCkpIHtcbiAgICAgICAgLy8gQSBsaXN0IG9mIHJldHJ5YWJsZSBvcGVyYXRpb25zLiBSZXRyeWFibGUgb3BlcmF0aW9ucyBhcmUgcnVuIGluIG9yZGVyIGFuZFxuICAgICAgICAvLyByZXRyaWVkIHdpdGggYmFja29mZi5cbiAgICAgICAgdGhpcy5WdSA9IFtdLCBcbiAgICAgICAgLy8gSXMgdGhpcyBBc3luY1F1ZXVlIGJlaW5nIHNodXQgZG93bj8gT25jZSBpdCBpcyBzZXQgdG8gdHJ1ZSwgaXQgd2lsbCBub3RcbiAgICAgICAgLy8gYmUgY2hhbmdlZCBhZ2Fpbi5cbiAgICAgICAgdGhpcy5tdSA9ICExLCBcbiAgICAgICAgLy8gT3BlcmF0aW9ucyBzY2hlZHVsZWQgdG8gYmUgcXVldWVkIGluIHRoZSBmdXR1cmUuIE9wZXJhdGlvbnMgYXJlXG4gICAgICAgIC8vIGF1dG9tYXRpY2FsbHkgcmVtb3ZlZCBhZnRlciB0aGV5IGFyZSBydW4gb3IgY2FuY2VsZWQuXG4gICAgICAgIHRoaXMuZnUgPSBbXSwgXG4gICAgICAgIC8vIHZpc2libGUgZm9yIHRlc3RpbmdcbiAgICAgICAgdGhpcy5ndSA9IG51bGwsIFxuICAgICAgICAvLyBGbGFnIHNldCB3aGlsZSB0aGVyZSdzIGFuIG91dHN0YW5kaW5nIEFzeW5jUXVldWUgb3BlcmF0aW9uLCB1c2VkIGZvclxuICAgICAgICAvLyBhc3NlcnRpb24gc2FuaXR5LWNoZWNrcy5cbiAgICAgICAgdGhpcy5wdSA9ICExLCBcbiAgICAgICAgLy8gRW5hYmxlZCBkdXJpbmcgc2h1dGRvd24gb24gU2FmYXJpIHRvIHByZXZlbnQgZnV0dXJlIGFjY2VzcyB0byBJbmRleGVkREIuXG4gICAgICAgIHRoaXMueXUgPSAhMSwgXG4gICAgICAgIC8vIExpc3Qgb2YgVGltZXJJZHMgdG8gZmFzdC1mb3J3YXJkIGRlbGF5cyBmb3IuXG4gICAgICAgIHRoaXMud3UgPSBbXSwgXG4gICAgICAgIC8vIEJhY2tvZmYgdGltZXIgdXNlZCB0byBzY2hlZHVsZSByZXRyaWVzIGZvciByZXRyeWFibGUgb3BlcmF0aW9uc1xuICAgICAgICB0aGlzLmFfID0gbmV3IF9fUFJJVkFURV9FeHBvbmVudGlhbEJhY2tvZmYodGhpcywgXCJhc3luY19xdWV1ZV9yZXRyeVwiIC8qIFRpbWVySWQuQXN5bmNRdWV1ZVJldHJ5ICovKSwgXG4gICAgICAgIC8vIFZpc2liaWxpdHkgaGFuZGxlciB0aGF0IHRyaWdnZXJzIGFuIGltbWVkaWF0ZSByZXRyeSBvZiBhbGwgcmV0cnlhYmxlXG4gICAgICAgIC8vIG9wZXJhdGlvbnMuIE1lYW50IHRvIHNwZWVkIHVwIHJlY292ZXJ5IHdoZW4gd2UgcmVnYWluIGZpbGUgc3lzdGVtIGFjY2Vzc1xuICAgICAgICAvLyBhZnRlciBwYWdlIGNvbWVzIGludG8gZm9yZWdyb3VuZC5cbiAgICAgICAgdGhpcy5TdSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSBnZXREb2N1bWVudCgpO1xuICAgICAgICAgICAgZSAmJiBfX1BSSVZBVEVfbG9nRGVidWcodG4sIFwiVmlzaWJpbGl0eSBzdGF0ZSBjaGFuZ2VkIHRvIFwiICsgZS52aXNpYmlsaXR5U3RhdGUpLCBcbiAgICAgICAgICAgIHRoaXMuYV8udF8oKTtcbiAgICAgICAgfSwgdGhpcy5idSA9IGU7XG4gICAgICAgIGNvbnN0IHQgPSBnZXREb2N1bWVudCgpO1xuICAgICAgICB0ICYmIFwiZnVuY3Rpb25cIiA9PSB0eXBlb2YgdC5hZGRFdmVudExpc3RlbmVyICYmIHQuYWRkRXZlbnRMaXN0ZW5lcihcInZpc2liaWxpdHljaGFuZ2VcIiwgdGhpcy5TdSk7XG4gICAgfVxuICAgIGdldCBpc1NodXR0aW5nRG93bigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubXU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFkZHMgYSBuZXcgb3BlcmF0aW9uIHRvIHRoZSBxdWV1ZSB3aXRob3V0IHdhaXRpbmcgZm9yIGl0IHRvIGNvbXBsZXRlIChpLmUuXG4gICAgICogd2UgaWdub3JlIHRoZSBQcm9taXNlIHJlc3VsdCkuXG4gICAgICovICAgIGVucXVldWVBbmRGb3JnZXQoZSkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIHRoaXMuZW5xdWV1ZShlKTtcbiAgICB9XG4gICAgZW5xdWV1ZUFuZEZvcmdldEV2ZW5XaGlsZVJlc3RyaWN0ZWQoZSkge1xuICAgICAgICB0aGlzLkR1KCksIFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWZsb2F0aW5nLXByb21pc2VzXG4gICAgICAgIHRoaXMudnUoZSk7XG4gICAgfVxuICAgIGVudGVyUmVzdHJpY3RlZE1vZGUoZSkge1xuICAgICAgICBpZiAoIXRoaXMubXUpIHtcbiAgICAgICAgICAgIHRoaXMubXUgPSAhMCwgdGhpcy55dSA9IGUgfHwgITE7XG4gICAgICAgICAgICBjb25zdCB0ID0gZ2V0RG9jdW1lbnQoKTtcbiAgICAgICAgICAgIHQgJiYgXCJmdW5jdGlvblwiID09IHR5cGVvZiB0LnJlbW92ZUV2ZW50TGlzdGVuZXIgJiYgdC5yZW1vdmVFdmVudExpc3RlbmVyKFwidmlzaWJpbGl0eWNoYW5nZVwiLCB0aGlzLlN1KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbnF1ZXVlKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuRHUoKSwgdGhpcy5tdSkgXG4gICAgICAgIC8vIFJldHVybiBhIFByb21pc2Ugd2hpY2ggbmV2ZXIgcmVzb2x2ZXMuXG4gICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgoKCkgPT4ge30pKTtcbiAgICAgICAgLy8gQ3JlYXRlIGEgZGVmZXJyZWQgUHJvbWlzZSB0aGF0IHdlIGNhbiByZXR1cm4gdG8gdGhlIGNhbGxlZS4gVGhpc1xuICAgICAgICAvLyBhbGxvd3MgdXMgdG8gcmV0dXJuIGEgXCJoYW5naW5nIFByb21pc2VcIiBvbmx5IHRvIHRoZSBjYWxsZWUgYW5kIHN0aWxsXG4gICAgICAgIC8vIGFkdmFuY2UgdGhlIHF1ZXVlIGV2ZW4gd2hlbiB0aGUgb3BlcmF0aW9uIGlzIG5vdCBydW4uXG4gICAgICAgICAgICAgICAgY29uc3QgdCA9IG5ldyBfX1BSSVZBVEVfRGVmZXJyZWQ7XG4gICAgICAgIHJldHVybiB0aGlzLnZ1KCgoKSA9PiB0aGlzLm11ICYmIHRoaXMueXUgPyBQcm9taXNlLnJlc29sdmUoKSA6IChlKCkudGhlbih0LnJlc29sdmUsIHQucmVqZWN0KSwgXG4gICAgICAgIHQucHJvbWlzZSkpKS50aGVuKCgoKSA9PiB0LnByb21pc2UpKTtcbiAgICB9XG4gICAgZW5xdWV1ZVJldHJ5YWJsZShlKSB7XG4gICAgICAgIHRoaXMuZW5xdWV1ZUFuZEZvcmdldCgoKCkgPT4gKHRoaXMuVnUucHVzaChlKSwgdGhpcy5DdSgpKSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSdW5zIHRoZSBuZXh0IG9wZXJhdGlvbiBmcm9tIHRoZSByZXRyeWFibGUgcXVldWUuIElmIHRoZSBvcGVyYXRpb24gZmFpbHMsXG4gICAgICogcmVzY2hlZHVsZXMgd2l0aCBiYWNrb2ZmLlxuICAgICAqLyAgICBhc3luYyBDdSgpIHtcbiAgICAgICAgaWYgKDAgIT09IHRoaXMuVnUubGVuZ3RoKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMuVnVbMF0oKSwgdGhpcy5WdS5zaGlmdCgpLCB0aGlzLmFfLnJlc2V0KCk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFfX1BSSVZBVEVfaXNJbmRleGVkRGJUcmFuc2FjdGlvbkVycm9yKGUpKSB0aHJvdyBlO1xuIC8vIEZhaWx1cmUgd2lsbCBiZSBoYW5kbGVkIGJ5IEFzeW5jUXVldWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX19QUklWQVRFX2xvZ0RlYnVnKHRuLCBcIk9wZXJhdGlvbiBmYWlsZWQgd2l0aCByZXRyeWFibGUgZXJyb3I6IFwiICsgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLlZ1Lmxlbmd0aCA+IDAgJiYgXG4gICAgICAgICAgICAvLyBJZiB0aGVyZSBhcmUgYWRkaXRpb25hbCBvcGVyYXRpb25zLCB3ZSByZS1zY2hlZHVsZSBgcmV0cnlOZXh0T3AoKWAuXG4gICAgICAgICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSB0byBydW4gcmV0cnlhYmxlIG9wZXJhdGlvbnMgdGhhdCBmYWlsZWQgZHVyaW5nXG4gICAgICAgICAgICAvLyB0aGVpciBpbml0aWFsIGF0dGVtcHQgc2luY2Ugd2UgZG9uJ3Qga25vdyB3aGV0aGVyIHRoZXkgYXJlIGFscmVhZHlcbiAgICAgICAgICAgIC8vIGVucXVldWVkLiBJZiwgZm9yIGV4YW1wbGUsIGBvcDFgLCBgb3AyYCwgYG9wM2AgYXJlIGVucXVldWVkIGFuZCBgb3AxYFxuICAgICAgICAgICAgLy8gbmVlZHMgdG8gIGJlIHJlLXJ1biwgd2Ugd2lsbCBydW4gYG9wMWAsIGBvcDFgLCBgb3AyYCB1c2luZyB0aGVcbiAgICAgICAgICAgIC8vIGFscmVhZHkgZW5xdWV1ZWQgY2FsbHMgdG8gYHJldHJ5TmV4dE9wKClgLiBgb3AzKClgIHdpbGwgdGhlbiBydW4gaW4gdGhlXG4gICAgICAgICAgICAvLyBjYWxsIHNjaGVkdWxlZCBoZXJlLlxuICAgICAgICAgICAgLy8gU2luY2UgYGJhY2tvZmZBbmRSdW4oKWAgY2FuY2VscyBhbiBleGlzdGluZyBiYWNrb2ZmIGFuZCBzY2hlZHVsZXMgYVxuICAgICAgICAgICAgLy8gbmV3IGJhY2tvZmYgb24gZXZlcnkgY2FsbCwgdGhlcmUgaXMgb25seSBldmVyIGEgc2luZ2xlIGFkZGl0aW9uYWxcbiAgICAgICAgICAgIC8vIG9wZXJhdGlvbiBpbiB0aGUgcXVldWUuXG4gICAgICAgICAgICB0aGlzLmFfLlhvKCgoKSA9PiB0aGlzLkN1KCkpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB2dShlKSB7XG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmJ1LnRoZW4oKCgpID0+ICh0aGlzLnB1ID0gITAsIGUoKS5jYXRjaCgoZSA9PiB7XG4gICAgICAgICAgICB0aGlzLmd1ID0gZSwgdGhpcy5wdSA9ICExO1xuICAgICAgICAgICAgY29uc3QgdCA9IFxuICAgICAgICAgICAgLyoqXG4gKiBDaHJvbWUgaW5jbHVkZXMgRXJyb3IubWVzc2FnZSBpbiBFcnJvci5zdGFjay4gT3RoZXIgYnJvd3NlcnMgZG8gbm90LlxuICogVGhpcyByZXR1cm5zIGV4cGVjdGVkIG91dHB1dCBvZiBtZXNzYWdlICsgc3RhY2sgd2hlbiBhdmFpbGFibGUuXG4gKiBAcGFyYW0gZXJyb3IgLSBFcnJvciBvciBGaXJlc3RvcmVFcnJvclxuICovXG4gICAgICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfZ2V0TWVzc2FnZU9yU3RhY2soZSkge1xuICAgICAgICAgICAgICAgIGxldCB0ID0gZS5tZXNzYWdlIHx8IFwiXCI7XG4gICAgICAgICAgICAgICAgZS5zdGFjayAmJiAodCA9IGUuc3RhY2suaW5jbHVkZXMoZS5tZXNzYWdlKSA/IGUuc3RhY2sgOiBlLm1lc3NhZ2UgKyBcIlxcblwiICsgZS5zdGFjayk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyAoZSk7XG4gICAgICAgICAgICAvLyBSZS10aHJvdyB0aGUgZXJyb3Igc28gdGhhdCB0aGlzLnRhaWwgYmVjb21lcyBhIHJlamVjdGVkIFByb21pc2UgYW5kXG4gICAgICAgICAgICAvLyBhbGwgZnVydGhlciBhdHRlbXB0cyB0byBjaGFpbiAodmlhIC50aGVuKSB3aWxsIGp1c3Qgc2hvcnQtY2lyY3VpdFxuICAgICAgICAgICAgLy8gYW5kIHJldHVybiB0aGUgcmVqZWN0ZWQgUHJvbWlzZS5cbiAgICAgICAgICAgIHRocm93IF9fUFJJVkFURV9sb2dFcnJvcihcIklOVEVSTkFMIFVOSEFORExFRCBFUlJPUjogXCIsIHQpLCBlO1xuICAgICAgICB9KSkudGhlbigoZSA9PiAodGhpcy5wdSA9ICExLCBlKSkpKSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5idSA9IHQsIHQ7XG4gICAgfVxuICAgIGVucXVldWVBZnRlckRlbGF5KGUsIHQsIG4pIHtcbiAgICAgICAgdGhpcy5EdSgpLCBcbiAgICAgICAgLy8gRmFzdC1mb3J3YXJkIGRlbGF5cyBmb3IgdGltZXJJZHMgdGhhdCBoYXZlIGJlZW4gb3ZlcnJpZGRlbi5cbiAgICAgICAgdGhpcy53dS5pbmRleE9mKGUpID4gLTEgJiYgKHQgPSAwKTtcbiAgICAgICAgY29uc3QgciA9IERlbGF5ZWRPcGVyYXRpb24uY3JlYXRlQW5kU2NoZWR1bGUodGhpcywgZSwgdCwgbiwgKGUgPT4gdGhpcy5GdShlKSkpO1xuICAgICAgICByZXR1cm4gdGhpcy5mdS5wdXNoKHIpLCByO1xuICAgIH1cbiAgICBEdSgpIHtcbiAgICAgICAgdGhpcy5ndSAmJiBmYWlsKCk7XG4gICAgfVxuICAgIHZlcmlmeU9wZXJhdGlvbkluUHJvZ3Jlc3MoKSB7fVxuICAgIC8qKlxuICAgICAqIFdhaXRzIHVudGlsIGFsbCBjdXJyZW50bHkgcXVldWVkIHRhc2tzIGFyZSBmaW5pc2hlZCBleGVjdXRpbmcuIERlbGF5ZWRcbiAgICAgKiBvcGVyYXRpb25zIGFyZSBub3QgcnVuLlxuICAgICAqLyAgICBhc3luYyBNdSgpIHtcbiAgICAgICAgLy8gT3BlcmF0aW9ucyBpbiB0aGUgcXVldWUgcHJpb3IgdG8gZHJhaW5pbmcgbWF5IGhhdmUgZW5xdWV1ZWQgYWRkaXRpb25hbFxuICAgICAgICAvLyBvcGVyYXRpb25zLiBLZWVwIGRyYWluaW5nIHRoZSBxdWV1ZSB1bnRpbCB0aGUgdGFpbCBpcyBubyBsb25nZXIgYWR2YW5jZWQsXG4gICAgICAgIC8vIHdoaWNoIGluZGljYXRlcyB0aGF0IG5vIG1vcmUgbmV3IG9wZXJhdGlvbnMgd2VyZSBlbnF1ZXVlZCBhbmQgdGhhdCBhbGxcbiAgICAgICAgLy8gb3BlcmF0aW9ucyB3ZXJlIGV4ZWN1dGVkLlxuICAgICAgICBsZXQgZTtcbiAgICAgICAgZG8ge1xuICAgICAgICAgICAgZSA9IHRoaXMuYnUsIGF3YWl0IGU7XG4gICAgICAgIH0gd2hpbGUgKGUgIT09IHRoaXMuYnUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb3IgVGVzdHM6IERldGVybWluZSBpZiBhIGRlbGF5ZWQgb3BlcmF0aW9uIHdpdGggYSBwYXJ0aWN1bGFyIFRpbWVySWRcbiAgICAgKiBleGlzdHMuXG4gICAgICovICAgIHh1KGUpIHtcbiAgICAgICAgZm9yIChjb25zdCB0IG9mIHRoaXMuZnUpIGlmICh0LnRpbWVySWQgPT09IGUpIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb3IgVGVzdHM6IFJ1bnMgc29tZSBvciBhbGwgZGVsYXllZCBvcGVyYXRpb25zIGVhcmx5LlxuICAgICAqXG4gICAgICogQHBhcmFtIGxhc3RUaW1lcklkIC0gRGVsYXllZCBvcGVyYXRpb25zIHVwIHRvIGFuZCBpbmNsdWRpbmcgdGhpcyBUaW1lcklkXG4gICAgICogd2lsbCBiZSBkcmFpbmVkLiBQYXNzIFRpbWVySWQuQWxsIHRvIHJ1biBhbGwgZGVsYXllZCBvcGVyYXRpb25zLlxuICAgICAqIEByZXR1cm5zIGEgUHJvbWlzZSB0aGF0IHJlc29sdmVzIG9uY2UgYWxsIG9wZXJhdGlvbnMgaGF2ZSBiZWVuIHJ1bi5cbiAgICAgKi8gICAgT3UoZSkge1xuICAgICAgICAvLyBOb3RlIHRoYXQgZHJhaW5pbmcgbWF5IGdlbmVyYXRlIG1vcmUgZGVsYXllZCBvcHMsIHNvIHdlIGRvIHRoYXQgZmlyc3QuXG4gICAgICAgIHJldHVybiB0aGlzLk11KCkudGhlbigoKCkgPT4ge1xuICAgICAgICAgICAgLy8gUnVuIG9wcyBpbiB0aGUgc2FtZSBvcmRlciB0aGV5J2QgcnVuIGlmIHRoZXkgcmFuIG5hdHVyYWxseS5cbiAgICAgICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXMgKi9cbiAgICAgICAgICAgIHRoaXMuZnUuc29ydCgoKGUsIHQpID0+IGUudGFyZ2V0VGltZU1zIC0gdC50YXJnZXRUaW1lTXMpKTtcbiAgICAgICAgICAgIGZvciAoY29uc3QgdCBvZiB0aGlzLmZ1KSBpZiAodC5za2lwRGVsYXkoKSwgXCJhbGxcIiAvKiBUaW1lcklkLkFsbCAqLyAhPT0gZSAmJiB0LnRpbWVySWQgPT09IGUpIGJyZWFrO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuTXUoKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb3IgVGVzdHM6IFNraXAgYWxsIHN1YnNlcXVlbnQgZGVsYXlzIGZvciBhIHRpbWVyIGlkLlxuICAgICAqLyAgICBOdShlKSB7XG4gICAgICAgIHRoaXMud3UucHVzaChlKTtcbiAgICB9XG4gICAgLyoqIENhbGxlZCBvbmNlIGEgRGVsYXllZE9wZXJhdGlvbiBpcyBydW4gb3IgY2FuY2VsZWQuICovICAgIEZ1KGUpIHtcbiAgICAgICAgLy8gTk9URTogaW5kZXhPZiAvIHNsaWNlIGFyZSBPKG4pLCBidXQgZGVsYXllZE9wZXJhdGlvbnMgaXMgZXhwZWN0ZWQgdG8gYmUgc21hbGwuXG4gICAgICAgIGNvbnN0IHQgPSB0aGlzLmZ1LmluZGV4T2YoZSk7XG4gICAgICAgIC8qIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZmxvYXRpbmctcHJvbWlzZXMgKi8gICAgICAgIHRoaXMuZnUuc3BsaWNlKHQsIDEpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2lzUGFydGlhbE9ic2VydmVyKGUpIHtcbiAgICAvKipcbiAqIFJldHVybnMgdHJ1ZSBpZiBvYmogaXMgYW4gb2JqZWN0IGFuZCBjb250YWlucyBhdCBsZWFzdCBvbmUgb2YgdGhlIHNwZWNpZmllZFxuICogbWV0aG9kcy5cbiAqL1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfaW1wbGVtZW50c0FueU1ldGhvZHMoZSwgdCkge1xuICAgICAgICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgZSB8fCBudWxsID09PSBlKSByZXR1cm4gITE7XG4gICAgICAgIGNvbnN0IG4gPSBlO1xuICAgICAgICBmb3IgKGNvbnN0IGUgb2YgdCkgaWYgKGUgaW4gbiAmJiBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIG5bZV0pIHJldHVybiAhMDtcbiAgICAgICAgcmV0dXJuICExO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKlxuICogUmVwcmVzZW50cyB0aGUgdGFzayBvZiBsb2FkaW5nIGEgRmlyZXN0b3JlIGJ1bmRsZS4gSXQgcHJvdmlkZXMgcHJvZ3Jlc3Mgb2YgYnVuZGxlXG4gKiBsb2FkaW5nLCBhcyB3ZWxsIGFzIHRhc2sgY29tcGxldGlvbiBhbmQgZXJyb3IgZXZlbnRzLlxuICpcbiAqIFRoZSBBUEkgaXMgY29tcGF0aWJsZSB3aXRoIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+YC5cbiAqLyAoZSwgWyBcIm5leHRcIiwgXCJlcnJvclwiLCBcImNvbXBsZXRlXCIgXSk7XG59XG5cbmNsYXNzIExvYWRCdW5kbGVUYXNrIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlciA9IHt9LCB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZCwgXG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcyA9IHtcbiAgICAgICAgICAgIHRhc2tTdGF0ZTogXCJSdW5uaW5nXCIsXG4gICAgICAgICAgICB0b3RhbEJ5dGVzOiAwLFxuICAgICAgICAgICAgdG90YWxEb2N1bWVudHM6IDAsXG4gICAgICAgICAgICBieXRlc0xvYWRlZDogMCxcbiAgICAgICAgICAgIGRvY3VtZW50c0xvYWRlZDogMFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWdpc3RlcnMgZnVuY3Rpb25zIHRvIGxpc3RlbiB0byBidW5kbGUgbG9hZGluZyBwcm9ncmVzcyBldmVudHMuXG4gICAgICogQHBhcmFtIG5leHQgLSBDYWxsZWQgd2hlbiB0aGVyZSBpcyBhIHByb2dyZXNzIHVwZGF0ZSBmcm9tIGJ1bmRsZSBsb2FkaW5nLiBUeXBpY2FsbHkgYG5leHRgIGNhbGxzIG9jY3VyXG4gICAgICogICBlYWNoIHRpbWUgYSBGaXJlc3RvcmUgZG9jdW1lbnQgaXMgbG9hZGVkIGZyb20gdGhlIGJ1bmRsZS5cbiAgICAgKiBAcGFyYW0gZXJyb3IgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLiBUaGUgdGFzayBhYm9ydHMgYWZ0ZXIgcmVwb3J0aW5nIHRoZVxuICAgICAqICAgZXJyb3IsIGFuZCB0aGVyZSBzaG91bGQgYmUgbm8gbW9yZSB1cGRhdGVzIGFmdGVyIHRoaXMuXG4gICAgICogQHBhcmFtIGNvbXBsZXRlIC0gQ2FsbGVkIHdoZW4gdGhlIGxvYWRpbmcgdGFzayBpcyBjb21wbGV0ZS5cbiAgICAgKi8gICAgb25Qcm9ncmVzcyhlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIgPSB7XG4gICAgICAgICAgICBuZXh0OiBlLFxuICAgICAgICAgICAgZXJyb3I6IHQsXG4gICAgICAgICAgICBjb21wbGV0ZTogblxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbXBsZW1lbnRzIHRoZSBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPi5jYXRjaGAgaW50ZXJmYWNlLlxuICAgICAqXG4gICAgICogQHBhcmFtIG9uUmVqZWN0ZWQgLSBDYWxsZWQgd2hlbiBhbiBlcnJvciBvY2N1cnMgZHVyaW5nIGJ1bmRsZSBsb2FkaW5nLlxuICAgICAqLyAgICBjYXRjaChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl90YXNrQ29tcGxldGlvblJlc29sdmVyLnByb21pc2UuY2F0Y2goZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEltcGxlbWVudHMgdGhlIGBQcm9taXNlPExvYWRCdW5kbGVUYXNrUHJvZ3Jlc3M+LnRoZW5gIGludGVyZmFjZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvbkZ1bGZpbGxlZCAtIENhbGxlZCBvbiB0aGUgY29tcGxldGlvbiBvZiB0aGUgbG9hZGluZyB0YXNrIHdpdGggYSBmaW5hbCBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2AgdXBkYXRlLlxuICAgICAqICAgVGhlIHVwZGF0ZSB3aWxsIGFsd2F5cyBoYXZlIGl0cyBgdGFza1N0YXRlYCBzZXQgdG8gYFwiU3VjY2Vzc1wiYC5cbiAgICAgKiBAcGFyYW0gb25SZWplY3RlZCAtIENhbGxlZCB3aGVuIGFuIGVycm9yIG9jY3VycyBkdXJpbmcgYnVuZGxlIGxvYWRpbmcuXG4gICAgICovICAgIHRoZW4oZSwgdCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5wcm9taXNlLnRoZW4oZSwgdCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGFsbCBvYnNlcnZlcnMgdGhhdCBidW5kbGUgbG9hZGluZyBoYXMgY29tcGxldGVkLCB3aXRoIGEgcHJvdmlkZWRcbiAgICAgKiBgTG9hZEJ1bmRsZVRhc2tQcm9ncmVzc2Agb2JqZWN0LlxuICAgICAqXG4gICAgICogQHByaXZhdGVcbiAgICAgKi8gICAgX2NvbXBsZXRlV2l0aChlKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZVByb2dyZXNzKGUpLCB0aGlzLl9wcm9ncmVzc09ic2VydmVyLmNvbXBsZXRlICYmIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuY29tcGxldGUoKSwgXG4gICAgICAgIHRoaXMuX3Rhc2tDb21wbGV0aW9uUmVzb2x2ZXIucmVzb2x2ZShlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogTm90aWZpZXMgYWxsIG9ic2VydmVycyB0aGF0IGJ1bmRsZSBsb2FkaW5nIGhhcyBmYWlsZWQsIHdpdGggYSBwcm92aWRlZFxuICAgICAqIGBFcnJvcmAgYXMgdGhlIHJlYXNvbi5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF9mYWlsV2l0aChlKSB7XG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcy50YXNrU3RhdGUgPSBcIkVycm9yXCIsIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIubmV4dCAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQodGhpcy5fbGFzdFByb2dyZXNzKSwgXG4gICAgICAgIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIuZXJyb3IgJiYgdGhpcy5fcHJvZ3Jlc3NPYnNlcnZlci5lcnJvcihlKSwgdGhpcy5fdGFza0NvbXBsZXRpb25SZXNvbHZlci5yZWplY3QoZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vdGlmaWVzIGEgcHJvZ3Jlc3MgdXBkYXRlIG9mIGxvYWRpbmcgYSBidW5kbGUuXG4gICAgICogQHBhcmFtIHByb2dyZXNzIC0gVGhlIG5ldyBwcm9ncmVzcy5cbiAgICAgKlxuICAgICAqIEBwcml2YXRlXG4gICAgICovICAgIF91cGRhdGVQcm9ncmVzcyhlKSB7XG4gICAgICAgIHRoaXMuX2xhc3RQcm9ncmVzcyA9IGUsIHRoaXMuX3Byb2dyZXNzT2JzZXJ2ZXIubmV4dCAmJiB0aGlzLl9wcm9ncmVzc09ic2VydmVyLm5leHQoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb25zdGFudCB1c2VkIHRvIGluZGljYXRlIHRoZSBMUlUgZ2FyYmFnZSBjb2xsZWN0aW9uIHNob3VsZCBiZSBkaXNhYmxlZC5cbiAqIFNldCB0aGlzIHZhbHVlIGFzIHRoZSBgY2FjaGVTaXplQnl0ZXNgIG9uIHRoZSBzZXR0aW5ncyBwYXNzZWQgdG8gdGhlXG4gKiB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZS5cbiAqLyBjb25zdCBubiA9IC0xO1xuXG4vKipcbiAqIFRoZSBDbG91ZCBGaXJlc3RvcmUgc2VydmljZSBpbnRlcmZhY2UuXG4gKlxuICogRG8gbm90IGNhbGwgdGhpcyBjb25zdHJ1Y3RvciBkaXJlY3RseS4gSW5zdGVhZCwgdXNlIHtAbGluayAoZ2V0RmlyZXN0b3JlOjEpfS5cbiAqLyBjbGFzcyBGaXJlc3RvcmUgZXh0ZW5kcyBGaXJlc3RvcmUkMSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHN1cGVyKGUsIHQsIG4sIHIpLCBcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFdoZXRoZXIgaXQncyBhIHtAbGluayBGaXJlc3RvcmV9IG9yIEZpcmVzdG9yZSBMaXRlIGluc3RhbmNlLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJmaXJlc3RvcmVcIiwgdGhpcy5fcXVldWUgPSBuZXcgX19QUklWQVRFX0FzeW5jUXVldWVJbXBsLCB0aGlzLl9wZXJzaXN0ZW5jZUtleSA9IChudWxsID09IHIgPyB2b2lkIDAgOiByLm5hbWUpIHx8IFwiW0RFRkFVTFRdXCI7XG4gICAgfVxuICAgIGFzeW5jIF90ZXJtaW5hdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLl9maXJlc3RvcmVDbGllbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSB0aGlzLl9maXJlc3RvcmVDbGllbnQudGVybWluYXRlKCk7XG4gICAgICAgICAgICB0aGlzLl9xdWV1ZSA9IG5ldyBfX1BSSVZBVEVfQXN5bmNRdWV1ZUltcGwoZSksIHRoaXMuX2ZpcmVzdG9yZUNsaWVudCA9IHZvaWQgMCwgYXdhaXQgZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBJbml0aWFsaXplcyBhIG5ldyBpbnN0YW5jZSBvZiB7QGxpbmsgRmlyZXN0b3JlfSB3aXRoIHRoZSBwcm92aWRlZCBzZXR0aW5ncy5cbiAqIENhbiBvbmx5IGJlIGNhbGxlZCBiZWZvcmUgYW55IG90aGVyIGZ1bmN0aW9uLCBpbmNsdWRpbmdcbiAqIHtAbGluayAoZ2V0RmlyZXN0b3JlOjEpfS4gSWYgdGhlIGN1c3RvbSBzZXR0aW5ncyBhcmUgZW1wdHksIHRoaXMgZnVuY3Rpb24gaXNcbiAqIGVxdWl2YWxlbnQgdG8gY2FsbGluZyB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKlxuICogQHBhcmFtIGFwcCAtIFRoZSB7QGxpbmsgQGZpcmViYXNlL2FwcCNGaXJlYmFzZUFwcH0gd2l0aCB3aGljaCB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2Ugd2lsbFxuICogYmUgYXNzb2NpYXRlZC5cbiAqIEBwYXJhbSBzZXR0aW5ncyAtIEEgc2V0dGluZ3Mgb2JqZWN0IHRvIGNvbmZpZ3VyZSB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKiBAcGFyYW0gZGF0YWJhc2VJZCAtIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZS5cbiAqIEByZXR1cm5zIEEgbmV3bHkgaW5pdGlhbGl6ZWQge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKi8gZnVuY3Rpb24gaW5pdGlhbGl6ZUZpcmVzdG9yZShlLCB0LCBuKSB7XG4gICAgbiB8fCAobiA9IHJ0KTtcbiAgICBjb25zdCByID0gX2dldFByb3ZpZGVyKGUsIFwiZmlyZXN0b3JlXCIpO1xuICAgIGlmIChyLmlzSW5pdGlhbGl6ZWQobikpIHtcbiAgICAgICAgY29uc3QgZSA9IHIuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgICAgIGlkZW50aWZpZXI6IG5cbiAgICAgICAgfSksIGkgPSByLmdldE9wdGlvbnMobik7XG4gICAgICAgIGlmIChkZWVwRXF1YWwoaSwgdCkpIHJldHVybiBlO1xuICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5GQUlMRURfUFJFQ09ORElUSU9OLCBcImluaXRpYWxpemVGaXJlc3RvcmUoKSBoYXMgYWxyZWFkeSBiZWVuIGNhbGxlZCB3aXRoIGRpZmZlcmVudCBvcHRpb25zLiBUbyBhdm9pZCB0aGlzIGVycm9yLCBjYWxsIGluaXRpYWxpemVGaXJlc3RvcmUoKSB3aXRoIHRoZSBzYW1lIG9wdGlvbnMgYXMgd2hlbiBpdCB3YXMgb3JpZ2luYWxseSBjYWxsZWQsIG9yIGNhbGwgZ2V0RmlyZXN0b3JlKCkgdG8gcmV0dXJuIHRoZSBhbHJlYWR5IGluaXRpYWxpemVkIGluc3RhbmNlLlwiKTtcbiAgICB9XG4gICAgaWYgKHZvaWQgMCAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiB2b2lkIDAgIT09IHQubG9jYWxDYWNoZSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJjYWNoZSBhbmQgY2FjaGVTaXplQnl0ZXMgY2Fubm90IGJlIHNwZWNpZmllZCBhdCB0aGUgc2FtZSB0aW1lIGFzIGNhY2hlU2l6ZUJ5dGVzIHdpbGxiZSBkZXByZWNhdGVkLiBJbnN0ZWFkLCBzcGVjaWZ5IHRoZSBjYWNoZSBzaXplIGluIHRoZSBjYWNoZSBvYmplY3RcIik7XG4gICAgaWYgKHZvaWQgMCAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiAtMSAhPT0gdC5jYWNoZVNpemVCeXRlcyAmJiB0LmNhY2hlU2l6ZUJ5dGVzIDwgRHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiY2FjaGVTaXplQnl0ZXMgbXVzdCBiZSBhdCBsZWFzdCAxMDQ4NTc2XCIpO1xuICAgIHJldHVybiByLmluaXRpYWxpemUoe1xuICAgICAgICBvcHRpb25zOiB0LFxuICAgICAgICBpbnN0YW5jZUlkZW50aWZpZXI6IG5cbiAgICB9KTtcbn1cblxuZnVuY3Rpb24gZ2V0RmlyZXN0b3JlKGUsIG4pIHtcbiAgICBjb25zdCByID0gXCJvYmplY3RcIiA9PSB0eXBlb2YgZSA/IGUgOiBnZXRBcHAoKSwgaSA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBlIDogbiB8fCBydCwgcyA9IF9nZXRQcm92aWRlcihyLCBcImZpcmVzdG9yZVwiKS5nZXRJbW1lZGlhdGUoe1xuICAgICAgICBpZGVudGlmaWVyOiBpXG4gICAgfSk7XG4gICAgaWYgKCFzLl9pbml0aWFsaXplZCkge1xuICAgICAgICBjb25zdCBlID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0KFwiZmlyZXN0b3JlXCIpO1xuICAgICAgICBlICYmIGNvbm5lY3RGaXJlc3RvcmVFbXVsYXRvcihzLCAuLi5lKTtcbiAgICB9XG4gICAgcmV0dXJuIHM7XG59XG5cbi8qKlxuICogQGludGVybmFsXG4gKi8gZnVuY3Rpb24gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlKSB7XG4gICAgaWYgKGUuX3Rlcm1pbmF0ZWQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiVGhlIGNsaWVudCBoYXMgYWxyZWFkeSBiZWVuIHRlcm1pbmF0ZWQuXCIpO1xuICAgIHJldHVybiBlLl9maXJlc3RvcmVDbGllbnQgfHwgX19QUklWQVRFX2NvbmZpZ3VyZUZpcmVzdG9yZShlKSwgZS5fZmlyZXN0b3JlQ2xpZW50O1xufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY29uZmlndXJlRmlyZXN0b3JlKGUpIHtcbiAgICB2YXIgdCwgbiwgcjtcbiAgICBjb25zdCBpID0gZS5fZnJlZXplU2V0dGluZ3MoKSwgcyA9IGZ1bmN0aW9uIF9fUFJJVkFURV9tYWtlRGF0YWJhc2VJbmZvKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhYmFzZUluZm8oZSwgdCwgbiwgci5ob3N0LCByLnNzbCwgci5leHBlcmltZW50YWxGb3JjZUxvbmdQb2xsaW5nLCByLmV4cGVyaW1lbnRhbEF1dG9EZXRlY3RMb25nUG9sbGluZywgX19QUklWQVRFX2Nsb25lTG9uZ1BvbGxpbmdPcHRpb25zKHIuZXhwZXJpbWVudGFsTG9uZ1BvbGxpbmdPcHRpb25zKSwgci51c2VGZXRjaFN0cmVhbXMpO1xuICAgIH0oZS5fZGF0YWJhc2VJZCwgKG51bGwgPT09ICh0ID0gZS5fYXBwKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0Lm9wdGlvbnMuYXBwSWQpIHx8IFwiXCIsIGUuX3BlcnNpc3RlbmNlS2V5LCBpKTtcbiAgICBlLl9jb21wb25lbnRzUHJvdmlkZXIgfHwgKG51bGwgPT09IChuID0gaS5sb2NhbENhY2hlKSB8fCB2b2lkIDAgPT09IG4gPyB2b2lkIDAgOiBuLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIpICYmIChudWxsID09PSAociA9IGkubG9jYWxDYWNoZSkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5fb25saW5lQ29tcG9uZW50UHJvdmlkZXIpICYmIChlLl9jb21wb25lbnRzUHJvdmlkZXIgPSB7XG4gICAgICAgIF9vZmZsaW5lOiBpLmxvY2FsQ2FjaGUuX29mZmxpbmVDb21wb25lbnRQcm92aWRlcixcbiAgICAgICAgX29ubGluZTogaS5sb2NhbENhY2hlLl9vbmxpbmVDb21wb25lbnRQcm92aWRlclxuICAgIH0pLCBlLl9maXJlc3RvcmVDbGllbnQgPSBuZXcgRmlyZXN0b3JlQ2xpZW50KGUuX2F1dGhDcmVkZW50aWFscywgZS5fYXBwQ2hlY2tDcmVkZW50aWFscywgZS5fcXVldWUsIHMsIGUuX2NvbXBvbmVudHNQcm92aWRlciAmJiBmdW5jdGlvbiBfX1BSSVZBVEVfYnVpbGRDb21wb25lbnRQcm92aWRlcihlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBudWxsID09IGUgPyB2b2lkIDAgOiBlLl9vbmxpbmUuYnVpbGQoKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIF9vZmZsaW5lOiBudWxsID09IGUgPyB2b2lkIDAgOiBlLl9vZmZsaW5lLmJ1aWxkKHQpLFxuICAgICAgICAgICAgX29ubGluZTogdFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAqIEF0dGVtcHRzIHRvIGVuYWJsZSBwZXJzaXN0ZW50IHN0b3JhZ2UsIGlmIHBvc3NpYmxlLlxuICpcbiAqIE9uIGZhaWx1cmUsIGBlbmFibGVJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCB3aWxsIHJlamVjdCB0aGUgcHJvbWlzZSBvclxuICogdGhyb3cgYW4gZXhjZXB0aW9uLiBUaGVyZSBhcmUgc2V2ZXJhbCByZWFzb25zIHdoeSB0aGlzIGNhbiBmYWlsLCB3aGljaCBjYW4gYmVcbiAqIGlkZW50aWZpZWQgYnkgdGhlIGBjb2RlYCBvbiB0aGUgZXJyb3IuXG4gKlxuICogICAqIGZhaWxlZC1wcmVjb25kaXRpb246IFRoZSBhcHAgaXMgYWxyZWFkeSBvcGVuIGluIGFub3RoZXIgYnJvd3NlciB0YWIuXG4gKiAgICogdW5pbXBsZW1lbnRlZDogVGhlIGJyb3dzZXIgaXMgaW5jb21wYXRpYmxlIHdpdGggdGhlIG9mZmxpbmUgcGVyc2lzdGVuY2VcbiAqICAgICBpbXBsZW1lbnRhdGlvbi5cbiAqXG4gKiBOb3RlIHRoYXQgZXZlbiBhZnRlciBhIGZhaWx1cmUsIHRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB3aWxsIHJlbWFpblxuICogdXNhYmxlLCBob3dldmVyIG9mZmxpbmUgcGVyc2lzdGVuY2Ugd2lsbCBiZSBkaXNhYmxlZC5cbiAqXG4gKiBOb3RlOiBgZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgbXVzdCBiZSBjYWxsZWQgYmVmb3JlIGFueSBvdGhlciBmdW5jdGlvbnNcbiAqIChvdGhlciB0aGFuIHtAbGluayBpbml0aWFsaXplRmlyZXN0b3JlfSwge0BsaW5rIChnZXRGaXJlc3RvcmU6MSl9IG9yXG4gKiB7QGxpbmsgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZX0uXG4gKlxuICogUGVyc2lzdGVuY2UgY2Fubm90IGJlIHVzZWQgaW4gYSBOb2RlLmpzIGVudmlyb25tZW50LlxuICpcbiAqIEBwYXJhbSBmaXJlc3RvcmUgLSBUaGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgdG8gZW5hYmxlIHBlcnNpc3RlbmNlIGZvci5cbiAqIEBwYXJhbSBwZXJzaXN0ZW5jZVNldHRpbmdzIC0gT3B0aW9uYWwgc2V0dGluZ3Mgb2JqZWN0IHRvIGNvbmZpZ3VyZVxuICogcGVyc2lzdGVuY2UuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IHJlcHJlc2VudHMgc3VjY2Vzc2Z1bGx5IGVuYWJsaW5nIHBlcnNpc3RlbnQgc3RvcmFnZS5cbiAqIEBkZXByZWNhdGVkIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSByZW1vdmVkIGluIGEgZnV0dXJlIG1ham9yIHJlbGVhc2UuIEluc3RlYWQsIHNldFxuICogYEZpcmVzdG9yZVNldHRpbmdzLmxvY2FsQ2FjaGVgIHRvIGFuIGluc3RhbmNlIG9mIGBQZXJzaXN0ZW50TG9jYWxDYWNoZWAgdG9cbiAqIHR1cm4gb24gSW5kZXhlZERiIGNhY2hlLiBDYWxsaW5nIHRoaXMgZnVuY3Rpb24gd2hlbiBgRmlyZXN0b3JlU2V0dGluZ3MubG9jYWxDYWNoZWBcbiAqIGlzIGFscmVhZHkgc3BlY2lmaWVkIHdpbGwgdGhyb3cgYW4gZXhjZXB0aW9uLlxuICovIChlLl9jb21wb25lbnRzUHJvdmlkZXIpKTtcbn1cblxuZnVuY3Rpb24gZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoZSwgdCkge1xuICAgIF9fUFJJVkFURV9sb2dXYXJuKFwiZW5hYmxlSW5kZXhlZERiUGVyc2lzdGVuY2UoKSB3aWxsIGJlIGRlcHJlY2F0ZWQgaW4gdGhlIGZ1dHVyZSwgeW91IGNhbiB1c2UgYEZpcmVzdG9yZVNldHRpbmdzLmNhY2hlYCBpbnN0ZWFkLlwiKTtcbiAgICBjb25zdCBuID0gZS5fZnJlZXplU2V0dGluZ3MoKTtcbiAgICByZXR1cm4gX19QUklWQVRFX3NldFBlcnNpc3RlbmNlUHJvdmlkZXJzKGUsIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyLCB7XG4gICAgICAgIGJ1aWxkOiBlID0+IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKGUsIG4uY2FjaGVTaXplQnl0ZXMsIG51bGwgPT0gdCA/IHZvaWQgMCA6IHQuZm9yY2VPd25lcnNoaXApXG4gICAgfSksIFByb21pc2UucmVzb2x2ZSgpO1xufVxuXG4vKipcbiAqIEF0dGVtcHRzIHRvIGVuYWJsZSBtdWx0aS10YWIgcGVyc2lzdGVudCBzdG9yYWdlLCBpZiBwb3NzaWJsZS4gSWYgZW5hYmxlZFxuICogYWNyb3NzIGFsbCB0YWJzLCBhbGwgb3BlcmF0aW9ucyBzaGFyZSBhY2Nlc3MgdG8gbG9jYWwgcGVyc2lzdGVuY2UsIGluY2x1ZGluZ1xuICogc2hhcmVkIGV4ZWN1dGlvbiBvZiBxdWVyaWVzIGFuZCBsYXRlbmN5LWNvbXBlbnNhdGVkIGxvY2FsIGRvY3VtZW50IHVwZGF0ZXNcbiAqIGFjcm9zcyBhbGwgY29ubmVjdGVkIGluc3RhbmNlcy5cbiAqXG4gKiBPbiBmYWlsdXJlLCBgZW5hYmxlTXVsdGlUYWJJbmRleGVkRGJQZXJzaXN0ZW5jZSgpYCB3aWxsIHJlamVjdCB0aGUgcHJvbWlzZSBvclxuICogdGhyb3cgYW4gZXhjZXB0aW9uLiBUaGVyZSBhcmUgc2V2ZXJhbCByZWFzb25zIHdoeSB0aGlzIGNhbiBmYWlsLCB3aGljaCBjYW4gYmVcbiAqIGlkZW50aWZpZWQgYnkgdGhlIGBjb2RlYCBvbiB0aGUgZXJyb3IuXG4gKlxuICogICAqIGZhaWxlZC1wcmVjb25kaXRpb246IFRoZSBhcHAgaXMgYWxyZWFkeSBvcGVuIGluIGFub3RoZXIgYnJvd3NlciB0YWIgYW5kXG4gKiAgICAgbXVsdGktdGFiIGlzIG5vdCBlbmFibGVkLlxuICogICAqIHVuaW1wbGVtZW50ZWQ6IFRoZSBicm93c2VyIGlzIGluY29tcGF0aWJsZSB3aXRoIHRoZSBvZmZsaW5lIHBlcnNpc3RlbmNlXG4gKiAgICAgaW1wbGVtZW50YXRpb24uXG4gKlxuICogTm90ZSB0aGF0IGV2ZW4gYWZ0ZXIgYSBmYWlsdXJlLCB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2Ugd2lsbCByZW1haW5cbiAqIHVzYWJsZSwgaG93ZXZlciBvZmZsaW5lIHBlcnNpc3RlbmNlIHdpbGwgYmUgZGlzYWJsZWQuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB0byBlbmFibGUgcGVyc2lzdGVuY2UgZm9yLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCByZXByZXNlbnRzIHN1Y2Nlc3NmdWxseSBlbmFibGluZyBwZXJzaXN0ZW50XG4gKiBzdG9yYWdlLlxuICogQGRlcHJlY2F0ZWQgVGhpcyBmdW5jdGlvbiB3aWxsIGJlIHJlbW92ZWQgaW4gYSBmdXR1cmUgbWFqb3IgcmVsZWFzZS4gSW5zdGVhZCwgc2V0XG4gKiBgRmlyZXN0b3JlU2V0dGluZ3MubG9jYWxDYWNoZWAgdG8gYW4gaW5zdGFuY2Ugb2YgYFBlcnNpc3RlbnRMb2NhbENhY2hlYCB0b1xuICogdHVybiBvbiBpbmRleGVkZGIgY2FjaGUuIENhbGxpbmcgdGhpcyBmdW5jdGlvbiB3aGVuIGBGaXJlc3RvcmVTZXR0aW5ncy5sb2NhbENhY2hlYFxuICogaXMgYWxyZWFkeSBzcGVjaWZpZWQgd2lsbCB0aHJvdyBhbiBleGNlcHRpb24uXG4gKi8gYXN5bmMgZnVuY3Rpb24gZW5hYmxlTXVsdGlUYWJJbmRleGVkRGJQZXJzaXN0ZW5jZShlKSB7XG4gICAgX19QUklWQVRFX2xvZ1dhcm4oXCJlbmFibGVNdWx0aVRhYkluZGV4ZWREYlBlcnNpc3RlbmNlKCkgd2lsbCBiZSBkZXByZWNhdGVkIGluIHRoZSBmdXR1cmUsIHlvdSBjYW4gdXNlIGBGaXJlc3RvcmVTZXR0aW5ncy5jYWNoZWAgaW5zdGVhZC5cIik7XG4gICAgY29uc3QgdCA9IGUuX2ZyZWV6ZVNldHRpbmdzKCk7XG4gICAgX19QUklWQVRFX3NldFBlcnNpc3RlbmNlUHJvdmlkZXJzKGUsIE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyLCB7XG4gICAgICAgIGJ1aWxkOiBlID0+IG5ldyBfX1BSSVZBVEVfTXVsdGlUYWJPZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIoZSwgdC5jYWNoZVNpemVCeXRlcylcbiAgICB9KTtcbn1cblxuLyoqXG4gKiBSZWdpc3RlcnMgYm90aCB0aGUgYE9mZmxpbmVDb21wb25lbnRQcm92aWRlcmAgYW5kIGBPbmxpbmVDb21wb25lbnRQcm92aWRlcmAuXG4gKiBJZiB0aGUgb3BlcmF0aW9uIGZhaWxzIHdpdGggYSByZWNvdmVyYWJsZSBlcnJvciAoc2VlXG4gKiBgY2FuUmVjb3ZlckZyb21JbmRleGVkRGJFcnJvcigpYCBiZWxvdyksIHRoZSByZXR1cm5lZCBQcm9taXNlIGlzIHJlamVjdGVkXG4gKiBidXQgdGhlIGNsaWVudCByZW1haW5zIHVzYWJsZS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfc2V0UGVyc2lzdGVuY2VQcm92aWRlcnMoZSwgdCwgbikge1xuICAgIGlmICgoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpLl9maXJlc3RvcmVDbGllbnQgfHwgZS5fdGVybWluYXRlZCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJGaXJlc3RvcmUgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkIGFuZCBwZXJzaXN0ZW5jZSBjYW4gbm8gbG9uZ2VyIGJlIGVuYWJsZWQuIFlvdSBjYW4gb25seSBlbmFibGUgcGVyc2lzdGVuY2UgYmVmb3JlIGNhbGxpbmcgYW55IG90aGVyIG1ldGhvZHMgb24gYSBGaXJlc3RvcmUgb2JqZWN0LlwiKTtcbiAgICBpZiAoZS5fY29tcG9uZW50c1Byb3ZpZGVyIHx8IGUuX2dldFNldHRpbmdzKCkubG9jYWxDYWNoZSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJTREsgY2FjaGUgaXMgYWxyZWFkeSBzcGVjaWZpZWQuXCIpO1xuICAgIGUuX2NvbXBvbmVudHNQcm92aWRlciA9IHtcbiAgICAgICAgX29ubGluZTogdCxcbiAgICAgICAgX29mZmxpbmU6IG5cbiAgICB9LCBfX1BSSVZBVEVfY29uZmlndXJlRmlyZXN0b3JlKGUpO1xufVxuXG4vKipcbiAqIENsZWFycyB0aGUgcGVyc2lzdGVudCBzdG9yYWdlLiBUaGlzIGluY2x1ZGVzIHBlbmRpbmcgd3JpdGVzIGFuZCBjYWNoZWRcbiAqIGRvY3VtZW50cy5cbiAqXG4gKiBNdXN0IGJlIGNhbGxlZCB3aGlsZSB0aGUge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UgaXMgbm90IHN0YXJ0ZWQgKGFmdGVyIHRoZSBhcHAgaXNcbiAqIHRlcm1pbmF0ZWQgb3Igd2hlbiB0aGUgYXBwIGlzIGZpcnN0IGluaXRpYWxpemVkKS4gT24gc3RhcnR1cCwgdGhpcyBmdW5jdGlvblxuICogbXVzdCBiZSBjYWxsZWQgYmVmb3JlIG90aGVyIGZ1bmN0aW9ucyAob3RoZXIgdGhhbiB7QGxpbmtcbiAqIGluaXRpYWxpemVGaXJlc3RvcmV9IG9yIHtAbGluayAoZ2V0RmlyZXN0b3JlOjEpfSkpLiBJZiB0aGUge0BsaW5rIEZpcmVzdG9yZX1cbiAqIGluc3RhbmNlIGlzIHN0aWxsIHJ1bm5pbmcsIHRoZSBwcm9taXNlIHdpbGwgYmUgcmVqZWN0ZWQgd2l0aCB0aGUgZXJyb3IgY29kZVxuICogb2YgYGZhaWxlZC1wcmVjb25kaXRpb25gLlxuICpcbiAqIE5vdGU6IGBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlKClgIGlzIHByaW1hcmlseSBpbnRlbmRlZCB0byBoZWxwIHdyaXRlXG4gKiByZWxpYWJsZSB0ZXN0cyB0aGF0IHVzZSBDbG91ZCBGaXJlc3RvcmUuIEl0IHVzZXMgYW4gZWZmaWNpZW50IG1lY2hhbmlzbSBmb3JcbiAqIGRyb3BwaW5nIGV4aXN0aW5nIGRhdGEgYnV0IGRvZXMgbm90IGF0dGVtcHQgdG8gc2VjdXJlbHkgb3ZlcndyaXRlIG9yXG4gKiBvdGhlcndpc2UgbWFrZSBjYWNoZWQgZGF0YSB1bnJlY292ZXJhYmxlLiBGb3IgYXBwbGljYXRpb25zIHRoYXQgYXJlIHNlbnNpdGl2ZVxuICogdG8gdGhlIGRpc2Nsb3N1cmUgb2YgY2FjaGVkIGRhdGEgaW4gYmV0d2VlbiB1c2VyIHNlc3Npb25zLCB3ZSBzdHJvbmdseVxuICogcmVjb21tZW5kIG5vdCBlbmFibGluZyBwZXJzaXN0ZW5jZSBhdCBhbGwuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB0byBjbGVhciBwZXJzaXN0ZW5jZSBmb3IuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIHdoZW4gdGhlIHBlcnNpc3RlbnQgc3RvcmFnZSBpc1xuICogY2xlYXJlZC4gT3RoZXJ3aXNlLCB0aGUgcHJvbWlzZSBpcyByZWplY3RlZCB3aXRoIGFuIGVycm9yLlxuICovIGZ1bmN0aW9uIGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UoZSkge1xuICAgIGlmIChlLl9pbml0aWFsaXplZCAmJiAhZS5fdGVybWluYXRlZCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuRkFJTEVEX1BSRUNPTkRJVElPTiwgXCJQZXJzaXN0ZW5jZSBjYW4gb25seSBiZSBjbGVhcmVkIGJlZm9yZSBhIEZpcmVzdG9yZSBpbnN0YW5jZSBpcyBpbml0aWFsaXplZCBvciBhZnRlciBpdCBpcyB0ZXJtaW5hdGVkLlwiKTtcbiAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICByZXR1cm4gZS5fcXVldWUuZW5xdWV1ZUFuZEZvcmdldEV2ZW5XaGlsZVJlc3RyaWN0ZWQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGF3YWl0IGFzeW5jIGZ1bmN0aW9uIF9fUFJJVkFURV9pbmRleGVkRGJDbGVhclBlcnNpc3RlbmNlKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoIV9fUFJJVkFURV9TaW1wbGVEYi5EKCkpIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gZSArIHh0O1xuICAgICAgICAgICAgICAgIGF3YWl0IF9fUFJJVkFURV9TaW1wbGVEYi5kZWxldGUodCk7XG4gICAgICAgICAgICB9KF9fUFJJVkFURV9pbmRleGVkRGJTdG9yYWdlUHJlZml4KGUuX2RhdGFiYXNlSWQsIGUuX3BlcnNpc3RlbmNlS2V5KSksIHQucmVzb2x2ZSgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0LnJlamVjdChlKTtcbiAgICAgICAgfVxuICAgIH0pKSwgdC5wcm9taXNlO1xufVxuXG4vKipcbiAqIFdhaXRzIHVudGlsIGFsbCBjdXJyZW50bHkgcGVuZGluZyB3cml0ZXMgZm9yIHRoZSBhY3RpdmUgdXNlciBoYXZlIGJlZW5cbiAqIGFja25vd2xlZGdlZCBieSB0aGUgYmFja2VuZC5cbiAqXG4gKiBUaGUgcmV0dXJuZWQgcHJvbWlzZSByZXNvbHZlcyBpbW1lZGlhdGVseSBpZiB0aGVyZSBhcmUgbm8gb3V0c3RhbmRpbmcgd3JpdGVzLlxuICogT3RoZXJ3aXNlLCB0aGUgcHJvbWlzZSB3YWl0cyBmb3IgYWxsIHByZXZpb3VzbHkgaXNzdWVkIHdyaXRlcyAoaW5jbHVkaW5nXG4gKiB0aG9zZSB3cml0dGVuIGluIGEgcHJldmlvdXMgYXBwIHNlc3Npb24pLCBidXQgaXQgZG9lcyBub3Qgd2FpdCBmb3Igd3JpdGVzXG4gKiB0aGF0IHdlcmUgYWRkZWQgYWZ0ZXIgdGhlIGZ1bmN0aW9uIGlzIGNhbGxlZC4gSWYgeW91IHdhbnQgdG8gd2FpdCBmb3JcbiAqIGFkZGl0aW9uYWwgd3JpdGVzLCBjYWxsIGB3YWl0Rm9yUGVuZGluZ1dyaXRlcygpYCBhZ2Fpbi5cbiAqXG4gKiBBbnkgb3V0c3RhbmRpbmcgYHdhaXRGb3JQZW5kaW5nV3JpdGVzKClgIHByb21pc2VzIGFyZSByZWplY3RlZCBkdXJpbmcgdXNlclxuICogY2hhbmdlcy5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB3aGljaCByZXNvbHZlcyB3aGVuIGFsbCBjdXJyZW50bHkgcGVuZGluZyB3cml0ZXMgaGF2ZSBiZWVuXG4gKiBhY2tub3dsZWRnZWQgYnkgdGhlIGJhY2tlbmQuXG4gKi8gZnVuY3Rpb24gd2FpdEZvclBlbmRpbmdXcml0ZXMoZSkge1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50V2FpdEZvclBlbmRpbmdXcml0ZXMoZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9EZWZlcnJlZDtcbiAgICAgICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBfX1BSSVZBVEVfc3luY0VuZ2luZVJlZ2lzdGVyUGVuZGluZ1dyaXRlc0NhbGxiYWNrKGF3YWl0IF9fUFJJVkFURV9nZXRTeW5jRW5naW5lKGUpLCB0KSkpLCBcbiAgICAgICAgdC5wcm9taXNlO1xuICAgIH0oZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSkpO1xufVxuXG4vKipcbiAqIFJlLWVuYWJsZXMgdXNlIG9mIHRoZSBuZXR3b3JrIGZvciB0aGlzIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIGFmdGVyIGEgcHJpb3JcbiAqIGNhbGwgdG8ge0BsaW5rIGRpc2FibGVOZXR3b3JrfS5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIG9uY2UgdGhlIG5ldHdvcmsgaGFzIGJlZW4gZW5hYmxlZC5cbiAqLyBmdW5jdGlvbiBlbmFibGVOZXR3b3JrKGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEVuYWJsZU5ldHdvcmsoZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSkpO1xufVxuXG4vKipcbiAqIERpc2FibGVzIG5ldHdvcmsgdXNhZ2UgZm9yIHRoaXMgaW5zdGFuY2UuIEl0IGNhbiBiZSByZS1lbmFibGVkIHZpYSB7QGxpbmtcbiAqIGVuYWJsZU5ldHdvcmt9LiBXaGlsZSB0aGUgbmV0d29yayBpcyBkaXNhYmxlZCwgYW55IHNuYXBzaG90IGxpc3RlbmVycyxcbiAqIGBnZXREb2MoKWAgb3IgYGdldERvY3MoKWAgY2FsbHMgd2lsbCByZXR1cm4gcmVzdWx0cyBmcm9tIGNhY2hlLCBhbmQgYW55IHdyaXRlXG4gKiBvcGVyYXRpb25zIHdpbGwgYmUgcXVldWVkIHVudGlsIHRoZSBuZXR3b3JrIGlzIHJlc3RvcmVkLlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgaXMgcmVzb2x2ZWQgb25jZSB0aGUgbmV0d29yayBoYXMgYmVlbiBkaXNhYmxlZC5cbiAqLyBmdW5jdGlvbiBkaXNhYmxlTmV0d29yayhlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnREaXNhYmxlTmV0d29yayhlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSk7XG59XG5cbi8qKlxuICogVGVybWluYXRlcyB0aGUgcHJvdmlkZWQge0BsaW5rIEZpcmVzdG9yZX0gaW5zdGFuY2UuXG4gKlxuICogQWZ0ZXIgY2FsbGluZyBgdGVybWluYXRlKClgIG9ubHkgdGhlIGBjbGVhckluZGV4ZWREYlBlcnNpc3RlbmNlKClgIGZ1bmN0aW9uXG4gKiBtYXkgYmUgdXNlZC4gQW55IG90aGVyIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYSBgRmlyZXN0b3JlRXJyb3JgLlxuICpcbiAqIFRvIHJlc3RhcnQgYWZ0ZXIgdGVybWluYXRpb24sIGNyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBGaXJlYmFzZUZpcmVzdG9yZSB3aXRoXG4gKiB7QGxpbmsgKGdldEZpcmVzdG9yZToxKX0uXG4gKlxuICogVGVybWluYXRpb24gZG9lcyBub3QgY2FuY2VsIGFueSBwZW5kaW5nIHdyaXRlcywgYW5kIGFueSBwcm9taXNlcyB0aGF0IGFyZVxuICogYXdhaXRpbmcgYSByZXNwb25zZSBmcm9tIHRoZSBzZXJ2ZXIgd2lsbCBub3QgYmUgcmVzb2x2ZWQuIElmIHlvdSBoYXZlXG4gKiBwZXJzaXN0ZW5jZSBlbmFibGVkLCB0aGUgbmV4dCB0aW1lIHlvdSBzdGFydCB0aGlzIGluc3RhbmNlLCBpdCB3aWxsIHJlc3VtZVxuICogc2VuZGluZyB0aGVzZSB3cml0ZXMgdG8gdGhlIHNlcnZlci5cbiAqXG4gKiBOb3RlOiBVbmRlciBub3JtYWwgY2lyY3Vtc3RhbmNlcywgY2FsbGluZyBgdGVybWluYXRlKClgIGlzIG5vdCByZXF1aXJlZC4gVGhpc1xuICogZnVuY3Rpb24gaXMgdXNlZnVsIG9ubHkgd2hlbiB5b3Ugd2FudCB0byBmb3JjZSB0aGlzIGluc3RhbmNlIHRvIHJlbGVhc2UgYWxsXG4gKiBvZiBpdHMgcmVzb3VyY2VzIG9yIGluIGNvbWJpbmF0aW9uIHdpdGggYGNsZWFySW5kZXhlZERiUGVyc2lzdGVuY2UoKWAgdG9cbiAqIGVuc3VyZSB0aGF0IGFsbCBsb2NhbCBzdGF0ZSBpcyBkZXN0cm95ZWQgYmV0d2VlbiB0ZXN0IHJ1bnMuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBpcyByZXNvbHZlZCB3aGVuIHRoZSBpbnN0YW5jZSBoYXMgYmVlbiBzdWNjZXNzZnVsbHlcbiAqIHRlcm1pbmF0ZWQuXG4gKi8gZnVuY3Rpb24gdGVybWluYXRlKGUpIHtcbiAgICByZXR1cm4gX3JlbW92ZVNlcnZpY2VJbnN0YW5jZShlLmFwcCwgXCJmaXJlc3RvcmVcIiwgZS5fZGF0YWJhc2VJZC5kYXRhYmFzZSksIGUuX2RlbGV0ZSgpO1xufVxuXG4vKipcbiAqIExvYWRzIGEgRmlyZXN0b3JlIGJ1bmRsZSBpbnRvIHRoZSBsb2NhbCBjYWNoZS5cbiAqXG4gKiBAcGFyYW0gZmlyZXN0b3JlIC0gVGhlIHtAbGluayBGaXJlc3RvcmV9IGluc3RhbmNlIHRvIGxvYWQgYnVuZGxlcyBmb3IuXG4gKiBAcGFyYW0gYnVuZGxlRGF0YSAtIEFuIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGJ1bmRsZSB0byBiZSBsb2FkZWQuIFZhbGlkXG4gKiBvYmplY3RzIGFyZSBgQXJyYXlCdWZmZXJgLCBgUmVhZGFibGVTdHJlYW08VWludDhBcnJheT5gIG9yIGBzdHJpbmdgLlxuICpcbiAqIEByZXR1cm5zIEEgYExvYWRCdW5kbGVUYXNrYCBvYmplY3QsIHdoaWNoIG5vdGlmaWVzIGNhbGxlcnMgd2l0aCBwcm9ncmVzc1xuICogdXBkYXRlcywgYW5kIGNvbXBsZXRpb24gb3IgZXJyb3IgZXZlbnRzLiBJdCBjYW4gYmUgdXNlZCBhcyBhXG4gKiBgUHJvbWlzZTxMb2FkQnVuZGxlVGFza1Byb2dyZXNzPmAuXG4gKi8gZnVuY3Rpb24gbG9hZEJ1bmRsZShlLCB0KSB7XG4gICAgY29uc3QgbiA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpLCByID0gbmV3IExvYWRCdW5kbGVUYXNrO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50TG9hZEJ1bmRsZShuLCBlLl9kYXRhYmFzZUlkLCB0LCByKSwgcjtcbn1cblxuLyoqXG4gKiBSZWFkcyBhIEZpcmVzdG9yZSB7QGxpbmsgUXVlcnl9IGZyb20gbG9jYWwgY2FjaGUsIGlkZW50aWZpZWQgYnkgdGhlIGdpdmVuXG4gKiBuYW1lLlxuICpcbiAqIFRoZSBuYW1lZCBxdWVyaWVzIGFyZSBwYWNrYWdlZCAgaW50byBidW5kbGVzIG9uIHRoZSBzZXJ2ZXIgc2lkZSAoYWxvbmdcbiAqIHdpdGggcmVzdWx0aW5nIGRvY3VtZW50cyksIGFuZCBsb2FkZWQgdG8gbG9jYWwgY2FjaGUgdXNpbmcgYGxvYWRCdW5kbGVgLiBPbmNlXG4gKiBpbiBsb2NhbCBjYWNoZSwgdXNlIHRoaXMgbWV0aG9kIHRvIGV4dHJhY3QgYSB7QGxpbmsgUXVlcnl9IGJ5IG5hbWUuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIFRoZSB7QGxpbmsgRmlyZXN0b3JlfSBpbnN0YW5jZSB0byByZWFkIHRoZSBxdWVyeSBmcm9tLlxuICogQHBhcmFtIG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgcXVlcnkuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCB0aGF0IGlzIHJlc29sdmVkIHdpdGggdGhlIFF1ZXJ5IG9yIGBudWxsYC5cbiAqLyBmdW5jdGlvbiBuYW1lZFF1ZXJ5KGUsIHQpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldE5hbWVkUXVlcnkoZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSksIHQpLnRoZW4oKHQgPT4gdCA/IG5ldyBRdWVyeShlLCBudWxsLCB0LnF1ZXJ5KSA6IG51bGwpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYW4gYWdncmVnYXRpb24gdGhhdCBjYW4gYmUgcGVyZm9ybWVkIGJ5IEZpcmVzdG9yZS5cbiAqL1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFyc1xuY2xhc3MgQWdncmVnYXRlRmllbGQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBBZ2dyZWdhdGVGaWVsZDxUPlxuICAgICAqIEBwYXJhbSBhZ2dyZWdhdGVUeXBlIFNwZWNpZmllcyB0aGUgdHlwZSBvZiBhZ2dyZWdhdGlvbiBvcGVyYXRpb24gdG8gcGVyZm9ybS5cbiAgICAgKiBAcGFyYW0gX2ludGVybmFsRmllbGRQYXRoIE9wdGlvbmFsbHkgc3BlY2lmaWVzIHRoZSBmaWVsZCB0aGF0IGlzIGFnZ3JlZ2F0ZWQuXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSA9IFwiY291bnRcIiwgdCkge1xuICAgICAgICB0aGlzLl9pbnRlcm5hbEZpZWxkUGF0aCA9IHQsIFxuICAgICAgICAvKiogQSB0eXBlIHN0cmluZyB0byB1bmlxdWVseSBpZGVudGlmeSBpbnN0YW5jZXMgb2YgdGhpcyBjbGFzcy4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJBZ2dyZWdhdGVGaWVsZFwiLCB0aGlzLmFnZ3JlZ2F0ZVR5cGUgPSBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBUaGUgcmVzdWx0cyBvZiBleGVjdXRpbmcgYW4gYWdncmVnYXRpb24gcXVlcnkuXG4gKi8gY2xhc3MgQWdncmVnYXRlUXVlcnlTbmFwc2hvdCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuX3VzZXJEYXRhV3JpdGVyID0gdCwgdGhpcy5fZGF0YSA9IG4sIFxuICAgICAgICAvKiogQSB0eXBlIHN0cmluZyB0byB1bmlxdWVseSBpZGVudGlmeSBpbnN0YW5jZXMgb2YgdGhpcyBjbGFzcy4gKi9cbiAgICAgICAgdGhpcy50eXBlID0gXCJBZ2dyZWdhdGVRdWVyeVNuYXBzaG90XCIsIHRoaXMucXVlcnkgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSByZXN1bHRzIG9mIHRoZSBhZ2dyZWdhdGlvbnMgcGVyZm9ybWVkIG92ZXIgdGhlIHVuZGVybHlpbmdcbiAgICAgKiBxdWVyeS5cbiAgICAgKlxuICAgICAqIFRoZSBrZXlzIG9mIHRoZSByZXR1cm5lZCBvYmplY3Qgd2lsbCBiZSB0aGUgc2FtZSBhcyB0aG9zZSBvZiB0aGVcbiAgICAgKiBgQWdncmVnYXRlU3BlY2Agb2JqZWN0IHNwZWNpZmllZCB0byB0aGUgYWdncmVnYXRpb24gbWV0aG9kLCBhbmQgdGhlIHZhbHVlc1xuICAgICAqIHdpbGwgYmUgdGhlIGNvcnJlc3BvbmRpbmcgYWdncmVnYXRpb24gcmVzdWx0LlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIHJlc3VsdHMgb2YgdGhlIGFnZ3JlZ2F0aW9ucyBwZXJmb3JtZWQgb3ZlciB0aGUgdW5kZXJseWluZ1xuICAgICAqIHF1ZXJ5LlxuICAgICAqLyAgICBkYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdXNlckRhdGFXcml0ZXIuY29udmVydE9iamVjdE1hcCh0aGlzLl9kYXRhKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGltbXV0YWJsZSBvYmplY3QgcmVwcmVzZW50aW5nIGFuIGFycmF5IG9mIGJ5dGVzLlxuICovIGNsYXNzIEJ5dGVzIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5fYnl0ZVN0cmluZyA9IGU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgYEJ5dGVzYCBvYmplY3QgZnJvbSB0aGUgZ2l2ZW4gQmFzZTY0IHN0cmluZywgY29udmVydGluZyBpdCB0b1xuICAgICAqIGJ5dGVzLlxuICAgICAqXG4gICAgICogQHBhcmFtIGJhc2U2NCAtIFRoZSBCYXNlNjQgc3RyaW5nIHVzZWQgdG8gY3JlYXRlIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgc3RhdGljIGZyb21CYXNlNjRTdHJpbmcoZSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBCeXRlcyhCeXRlU3RyaW5nLmZyb21CYXNlNjRTdHJpbmcoZSkpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIkZhaWxlZCB0byBjb25zdHJ1Y3QgZGF0YSBmcm9tIEJhc2U2NCBzdHJpbmc6IFwiICsgZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIG5ldyBgQnl0ZXNgIG9iamVjdCBmcm9tIHRoZSBnaXZlbiBVaW50OEFycmF5LlxuICAgICAqXG4gICAgICogQHBhcmFtIGFycmF5IC0gVGhlIFVpbnQ4QXJyYXkgdXNlZCB0byBjcmVhdGUgdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICBzdGF0aWMgZnJvbVVpbnQ4QXJyYXkoZSkge1xuICAgICAgICByZXR1cm4gbmV3IEJ5dGVzKEJ5dGVTdHJpbmcuZnJvbVVpbnQ4QXJyYXkoZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB1bmRlcmx5aW5nIGJ5dGVzIGFzIGEgQmFzZTY0LWVuY29kZWQgc3RyaW5nLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIEJhc2U2NC1lbmNvZGVkIHN0cmluZyBjcmVhdGVkIGZyb20gdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICB0b0Jhc2U2NCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2J5dGVTdHJpbmcudG9CYXNlNjQoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUgdW5kZXJseWluZyBieXRlcyBpbiBhIG5ldyBgVWludDhBcnJheWAuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUaGUgVWludDhBcnJheSBjcmVhdGVkIGZyb20gdGhlIGBCeXRlc2Agb2JqZWN0LlxuICAgICAqLyAgICB0b1VpbnQ4QXJyYXkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ieXRlU3RyaW5nLnRvVWludDhBcnJheSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIEEgc3RyaW5nIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBgQnl0ZXNgIG9iamVjdC5cbiAgICAgKi8gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBcIkJ5dGVzKGJhc2U2NDogXCIgKyB0aGlzLnRvQmFzZTY0KCkgKyBcIilcIjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYEJ5dGVzYCBvYmplY3QgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgQnl0ZXNgIG9iamVjdCB0byBjb21wYXJlIGFnYWluc3QuXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIGBCeXRlc2Agb2JqZWN0IGlzIGVxdWFsIHRvIHRoZSBwcm92aWRlZCBvbmUuXG4gICAgICovICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5fYnl0ZVN0cmluZy5pc0VxdWFsKGUuX2J5dGVTdHJpbmcpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBgRmllbGRQYXRoYCByZWZlcnMgdG8gYSBmaWVsZCBpbiBhIGRvY3VtZW50LiBUaGUgcGF0aCBtYXkgY29uc2lzdCBvZiBhXG4gKiBzaW5nbGUgZmllbGQgbmFtZSAocmVmZXJyaW5nIHRvIGEgdG9wLWxldmVsIGZpZWxkIGluIHRoZSBkb2N1bWVudCksIG9yIGFcbiAqIGxpc3Qgb2YgZmllbGQgbmFtZXMgKHJlZmVycmluZyB0byBhIG5lc3RlZCBmaWVsZCBpbiB0aGUgZG9jdW1lbnQpLlxuICpcbiAqIENyZWF0ZSBhIGBGaWVsZFBhdGhgIGJ5IHByb3ZpZGluZyBmaWVsZCBuYW1lcy4gSWYgbW9yZSB0aGFuIG9uZSBmaWVsZFxuICogbmFtZSBpcyBwcm92aWRlZCwgdGhlIHBhdGggd2lsbCBwb2ludCB0byBhIG5lc3RlZCBmaWVsZCBpbiBhIGRvY3VtZW50LlxuICovIGNsYXNzIEZpZWxkUGF0aCB7XG4gICAgLyoqXG4gICAgICogQ3JlYXRlcyBhIGBGaWVsZFBhdGhgIGZyb20gdGhlIHByb3ZpZGVkIGZpZWxkIG5hbWVzLiBJZiBtb3JlIHRoYW4gb25lIGZpZWxkXG4gICAgICogbmFtZSBpcyBwcm92aWRlZCwgdGhlIHBhdGggd2lsbCBwb2ludCB0byBhIG5lc3RlZCBmaWVsZCBpbiBhIGRvY3VtZW50LlxuICAgICAqXG4gICAgICogQHBhcmFtIGZpZWxkTmFtZXMgLSBBIGxpc3Qgb2YgZmllbGQgbmFtZXMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoLi4uZSkge1xuICAgICAgICBmb3IgKGxldCB0ID0gMDsgdCA8IGUubGVuZ3RoOyArK3QpIGlmICgwID09PSBlW3RdLmxlbmd0aCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIGZpZWxkIG5hbWUgYXQgYXJndW1lbnQgJChpICsgMSkuIEZpZWxkIG5hbWVzIG11c3Qgbm90IGJlIGVtcHR5LlwiKTtcbiAgICAgICAgdGhpcy5faW50ZXJuYWxQYXRoID0gbmV3IEZpZWxkUGF0aCQxKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgRmllbGRQYXRoYCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqXG4gICAgICogQHBhcmFtIG90aGVyIC0gVGhlIGBGaWVsZFBhdGhgIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYEZpZWxkUGF0aGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9pbnRlcm5hbFBhdGguaXNFcXVhbChlLl9pbnRlcm5hbFBhdGgpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCBzZW50aW5lbCBgRmllbGRQYXRoYCB0byByZWZlciB0byB0aGUgSUQgb2YgYSBkb2N1bWVudC5cbiAqIEl0IGNhbiBiZSB1c2VkIGluIHF1ZXJpZXMgdG8gc29ydCBvciBmaWx0ZXIgYnkgdGhlIGRvY3VtZW50IElELlxuICovIGZ1bmN0aW9uIGRvY3VtZW50SWQoKSB7XG4gICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgoeCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFNlbnRpbmVsIHZhbHVlcyB0aGF0IGNhbiBiZSB1c2VkIHdoZW4gd3JpdGluZyBkb2N1bWVudCBmaWVsZHMgd2l0aCBgc2V0KClgXG4gKiBvciBgdXBkYXRlKClgLlxuICovIGNsYXNzIEZpZWxkVmFsdWUge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBfbWV0aG9kTmFtZSAtIFRoZSBwdWJsaWMgQVBJIGVuZHBvaW50IHRoYXQgcmV0dXJucyB0aGlzIGNsYXNzLlxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuX21ldGhvZE5hbWUgPSBlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gaW1tdXRhYmxlIG9iamVjdCByZXByZXNlbnRpbmcgYSBnZW9ncmFwaGljIGxvY2F0aW9uIGluIEZpcmVzdG9yZS4gVGhlXG4gKiBsb2NhdGlvbiBpcyByZXByZXNlbnRlZCBhcyBsYXRpdHVkZS9sb25naXR1ZGUgcGFpci5cbiAqXG4gKiBMYXRpdHVkZSB2YWx1ZXMgYXJlIGluIHRoZSByYW5nZSBvZiBbLTkwLCA5MF0uXG4gKiBMb25naXR1ZGUgdmFsdWVzIGFyZSBpbiB0aGUgcmFuZ2Ugb2YgWy0xODAsIDE4MF0uXG4gKi8gY2xhc3MgR2VvUG9pbnQge1xuICAgIC8qKlxuICAgICAqIENyZWF0ZXMgYSBuZXcgaW1tdXRhYmxlIGBHZW9Qb2ludGAgb2JqZWN0IHdpdGggdGhlIHByb3ZpZGVkIGxhdGl0dWRlIGFuZFxuICAgICAqIGxvbmdpdHVkZSB2YWx1ZXMuXG4gICAgICogQHBhcmFtIGxhdGl0dWRlIC0gVGhlIGxhdGl0dWRlIGFzIG51bWJlciBiZXR3ZWVuIC05MCBhbmQgOTAuXG4gICAgICogQHBhcmFtIGxvbmdpdHVkZSAtIFRoZSBsb25naXR1ZGUgYXMgbnVtYmVyIGJldHdlZW4gLTE4MCBhbmQgMTgwLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgaWYgKCFpc0Zpbml0ZShlKSB8fCBlIDwgLTkwIHx8IGUgPiA5MCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJMYXRpdHVkZSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gLTkwIGFuZCA5MCwgYnV0IHdhczogXCIgKyBlKTtcbiAgICAgICAgaWYgKCFpc0Zpbml0ZSh0KSB8fCB0IDwgLTE4MCB8fCB0ID4gMTgwKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIkxvbmdpdHVkZSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gLTE4MCBhbmQgMTgwLCBidXQgd2FzOiBcIiArIHQpO1xuICAgICAgICB0aGlzLl9sYXQgPSBlLCB0aGlzLl9sb25nID0gdDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVGhlIGxhdGl0dWRlIG9mIHRoaXMgYEdlb1BvaW50YCBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGxhdGl0dWRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbGF0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgbG9uZ2l0dWRlIG9mIHRoaXMgYEdlb1BvaW50YCBpbnN0YW5jZS5cbiAgICAgKi8gICAgZ2V0IGxvbmdpdHVkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xvbmc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIGBHZW9Qb2ludGAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgR2VvUG9pbnRgIHRvIGNvbXBhcmUgYWdhaW5zdC5cbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIHRoaXMgYEdlb1BvaW50YCBpcyBlcXVhbCB0byB0aGUgcHJvdmlkZWQgb25lLlxuICAgICAqLyAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2xhdCA9PT0gZS5fbGF0ICYmIHRoaXMuX2xvbmcgPT09IGUuX2xvbmc7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBHZW9Qb2ludC4gKi8gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgbGF0aXR1ZGU6IHRoaXMuX2xhdCxcbiAgICAgICAgICAgIGxvbmdpdHVkZTogdGhpcy5fbG9uZ1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBY3R1YWxseSBwcml2YXRlIHRvIEpTIGNvbnN1bWVycyBvZiBvdXIgQVBJLCBzbyB0aGlzIGZ1bmN0aW9uIGlzIHByZWZpeGVkXG4gICAgICogd2l0aCBhbiB1bmRlcnNjb3JlLlxuICAgICAqLyAgICBfY29tcGFyZVRvKGUpIHtcbiAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9wcmltaXRpdmVDb21wYXJhdG9yKHRoaXMuX2xhdCwgZS5fbGF0KSB8fCBfX1BSSVZBVEVfcHJpbWl0aXZlQ29tcGFyYXRvcih0aGlzLl9sb25nLCBlLl9sb25nKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDI0IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJlcHJlc2VudHMgYSB2ZWN0b3IgdHlwZSBpbiBGaXJlc3RvcmUgZG9jdW1lbnRzLlxuICogQ3JlYXRlIGFuIGluc3RhbmNlIHdpdGggPGNvZGU+e0BsaW5rIHZlY3Rvcn08L2NvZGU+LlxuICpcbiAqIEBjbGFzcyBWZWN0b3JWYWx1ZVxuICovIGNsYXNzIFZlY3RvclZhbHVlIHtcbiAgICAvKipcbiAgICAgKiBAcHJpdmF0ZVxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgLy8gTWFraW5nIGEgY29weSBvZiB0aGUgcGFyYW1ldGVyLlxuICAgICAgICB0aGlzLl92YWx1ZXMgPSAoZSB8fCBbXSkubWFwKChlID0+IGUpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIHJhdyBudW1iZXIgYXJyYXkgZm9ybSBvZiB0aGUgdmVjdG9yLlxuICAgICAqLyAgICB0b0FycmF5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fdmFsdWVzLm1hcCgoZSA9PiBlKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYHRydWVgIGlmIHRoZSB0d28gYFZlY3RvclZhbHVlYCB2YWx1ZXMgaGF2ZSB0aGUgc2FtZSByYXcgbnVtYmVyIGFycmF5cywgcmV0dXJucyBgZmFsc2VgIG90aGVyd2lzZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfaXNQcmltaXRpdmVBcnJheUVxdWFsKGUsIHQpIHtcbiAgICAgICAgICAgIGlmIChlLmxlbmd0aCAhPT0gdC5sZW5ndGgpIHJldHVybiAhMTtcbiAgICAgICAgICAgIGZvciAobGV0IG4gPSAwOyBuIDwgZS5sZW5ndGg7ICsrbikgaWYgKGVbbl0gIT09IHRbbl0pIHJldHVybiAhMTtcbiAgICAgICAgICAgIHJldHVybiAhMDtcbiAgICAgICAgfSh0aGlzLl92YWx1ZXMsIGUuX3ZhbHVlcyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBybiA9IC9eX18uKl9fJC87XG5cbi8qKiBUaGUgcmVzdWx0IG9mIHBhcnNpbmcgZG9jdW1lbnQgZGF0YSAoZS5nLiBmb3IgYSBzZXREYXRhIGNhbGwpLiAqLyBjbGFzcyBQYXJzZWRTZXREYXRhIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YSA9IGUsIHRoaXMuZmllbGRNYXNrID0gdCwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBuO1xuICAgIH1cbiAgICB0b011dGF0aW9uKGUsIHQpIHtcbiAgICAgICAgcmV0dXJuIG51bGwgIT09IHRoaXMuZmllbGRNYXNrID8gbmV3IF9fUFJJVkFURV9QYXRjaE11dGF0aW9uKGUsIHRoaXMuZGF0YSwgdGhpcy5maWVsZE1hc2ssIHQsIHRoaXMuZmllbGRUcmFuc2Zvcm1zKSA6IG5ldyBfX1BSSVZBVEVfU2V0TXV0YXRpb24oZSwgdGhpcy5kYXRhLCB0LCB0aGlzLmZpZWxkVHJhbnNmb3Jtcyk7XG4gICAgfVxufVxuXG4vKiogVGhlIHJlc3VsdCBvZiBwYXJzaW5nIFwidXBkYXRlXCIgZGF0YSAoaS5lLiBmb3IgYW4gdXBkYXRlRGF0YSBjYWxsKS4gKi8gY2xhc3MgUGFyc2VkVXBkYXRlRGF0YSB7XG4gICAgY29uc3RydWN0b3IoZSwgXG4gICAgLy8gVGhlIGZpZWxkTWFzayBkb2VzIG5vdCBpbmNsdWRlIGRvY3VtZW50IHRyYW5zZm9ybXMuXG4gICAgdCwgbikge1xuICAgICAgICB0aGlzLmRhdGEgPSBlLCB0aGlzLmZpZWxkTWFzayA9IHQsIHRoaXMuZmllbGRUcmFuc2Zvcm1zID0gbjtcbiAgICB9XG4gICAgdG9NdXRhdGlvbihlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhdGNoTXV0YXRpb24oZSwgdGhpcy5kYXRhLCB0aGlzLmZpZWxkTWFzaywgdCwgdGhpcy5maWVsZFRyYW5zZm9ybXMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX2lzV3JpdGUoZSkge1xuICAgIHN3aXRjaCAoZSkge1xuICAgICAgY2FzZSAwIC8qIFVzZXJEYXRhU291cmNlLlNldCAqLyA6XG4gLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgICAgICAgIGNhc2UgMiAvKiBVc2VyRGF0YVNvdXJjZS5NZXJnZVNldCAqLyA6XG4gLy8gZmFsbCB0aHJvdWdoXG4gICAgICAgICAgICAgIGNhc2UgMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gOlxuICAgICAgICByZXR1cm4gITA7XG5cbiAgICAgIGNhc2UgMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyA6XG4gICAgICBjYXNlIDQgLyogVXNlckRhdGFTb3VyY2UuQXJyYXlBcmd1bWVudCAqLyA6XG4gICAgICAgIHJldHVybiAhMTtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgIH1cbn1cblxuLyoqIEEgXCJjb250ZXh0XCIgb2JqZWN0IHBhc3NlZCBhcm91bmQgd2hpbGUgcGFyc2luZyB1c2VyIGRhdGEuICovIGNsYXNzIF9fUFJJVkFURV9QYXJzZUNvbnRleHRJbXBsIHtcbiAgICAvKipcbiAgICAgKiBJbml0aWFsaXplcyBhIFBhcnNlQ29udGV4dCB3aXRoIHRoZSBnaXZlbiBzb3VyY2UgYW5kIHBhdGguXG4gICAgICpcbiAgICAgKiBAcGFyYW0gc2V0dGluZ3MgLSBUaGUgc2V0dGluZ3MgZm9yIHRoZSBwYXJzZXIuXG4gICAgICogQHBhcmFtIGRhdGFiYXNlSWQgLSBUaGUgZGF0YWJhc2UgSUQgb2YgdGhlIEZpcmVzdG9yZSBpbnN0YW5jZS5cbiAgICAgKiBAcGFyYW0gc2VyaWFsaXplciAtIFRoZSBzZXJpYWxpemVyIHRvIHVzZSB0byBnZW5lcmF0ZSB0aGUgVmFsdWUgcHJvdG8uXG4gICAgICogQHBhcmFtIGlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMgLSBXaGV0aGVyIHRvIGlnbm9yZSB1bmRlZmluZWQgcHJvcGVydGllc1xuICAgICAqIHJhdGhlciB0aGFuIHRocm93LlxuICAgICAqIEBwYXJhbSBmaWVsZFRyYW5zZm9ybXMgLSBBIG11dGFibGUgbGlzdCBvZiBmaWVsZCB0cmFuc2Zvcm1zIGVuY291bnRlcmVkXG4gICAgICogd2hpbGUgcGFyc2luZyB0aGUgZGF0YS5cbiAgICAgKiBAcGFyYW0gZmllbGRNYXNrIC0gQSBtdXRhYmxlIGxpc3Qgb2YgZmllbGQgcGF0aHMgZW5jb3VudGVyZWQgd2hpbGUgcGFyc2luZ1xuICAgICAqIHRoZSBkYXRhLlxuICAgICAqXG4gICAgICogVE9ETyhiLzM0ODcxMTMxKTogV2UgZG9uJ3Qgc3VwcG9ydCBhcnJheSBwYXRocyByaWdodCBub3csIHNvIHBhdGggY2FuIGJlXG4gICAgICogbnVsbCB0byBpbmRpY2F0ZSB0aGUgY29udGV4dCByZXByZXNlbnRzIGFueSBsb2NhdGlvbiB3aXRoaW4gYW4gYXJyYXkgKGluXG4gICAgICogd2hpY2ggY2FzZSBjZXJ0YWluIGZlYXR1cmVzIHdpbGwgbm90IHdvcmsgYW5kIGVycm9ycyB3aWxsIGJlIHNvbWV3aGF0XG4gICAgICogY29tcHJvbWlzZWQpLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGksIHMpIHtcbiAgICAgICAgdGhpcy5zZXR0aW5ncyA9IGUsIHRoaXMuZGF0YWJhc2VJZCA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4sIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHIsIFxuICAgICAgICAvLyBNaW5vciBoYWNrOiBJZiBmaWVsZFRyYW5zZm9ybXMgaXMgdW5kZWZpbmVkLCB3ZSBhc3N1bWUgdGhpcyBpcyBhblxuICAgICAgICAvLyBleHRlcm5hbCBjYWxsIGFuZCB3ZSBuZWVkIHRvIHZhbGlkYXRlIHRoZSBlbnRpcmUgcGF0aC5cbiAgICAgICAgdm9pZCAwID09PSBpICYmIHRoaXMuQnUoKSwgdGhpcy5maWVsZFRyYW5zZm9ybXMgPSBpIHx8IFtdLCB0aGlzLmZpZWxkTWFzayA9IHMgfHwgW107XG4gICAgfVxuICAgIGdldCBwYXRoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zZXR0aW5ncy5wYXRoO1xuICAgIH1cbiAgICBnZXQgTHUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNldHRpbmdzLkx1O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyBhIG5ldyBjb250ZXh0IHdpdGggdGhlIHNwZWNpZmllZCBzZXR0aW5ncyBvdmVyd3JpdHRlbi4gKi8gICAga3UoZSkge1xuICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9QYXJzZUNvbnRleHRJbXBsKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5zZXR0aW5ncyksIGUpLCB0aGlzLmRhdGFiYXNlSWQsIHRoaXMuc2VyaWFsaXplciwgdGhpcy5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzLCB0aGlzLmZpZWxkVHJhbnNmb3JtcywgdGhpcy5maWVsZE1hc2spO1xuICAgIH1cbiAgICBxdShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICBjb25zdCBuID0gbnVsbCA9PT0gKHQgPSB0aGlzLnBhdGgpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY2hpbGQoZSksIHIgPSB0aGlzLmt1KHtcbiAgICAgICAgICAgIHBhdGg6IG4sXG4gICAgICAgICAgICBRdTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByLiR1KGUpLCByO1xuICAgIH1cbiAgICBVdShlKSB7XG4gICAgICAgIHZhciB0O1xuICAgICAgICBjb25zdCBuID0gbnVsbCA9PT0gKHQgPSB0aGlzLnBhdGgpIHx8IHZvaWQgMCA9PT0gdCA/IHZvaWQgMCA6IHQuY2hpbGQoZSksIHIgPSB0aGlzLmt1KHtcbiAgICAgICAgICAgIHBhdGg6IG4sXG4gICAgICAgICAgICBRdTogITFcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByLkJ1KCksIHI7XG4gICAgfVxuICAgIEt1KGUpIHtcbiAgICAgICAgLy8gVE9ETyhiLzM0ODcxMTMxKTogV2UgZG9uJ3Qgc3VwcG9ydCBhcnJheSBwYXRocyByaWdodCBub3c7IHNvIG1ha2UgcGF0aFxuICAgICAgICAvLyB1bmRlZmluZWQuXG4gICAgICAgIHJldHVybiB0aGlzLmt1KHtcbiAgICAgICAgICAgIHBhdGg6IHZvaWQgMCxcbiAgICAgICAgICAgIFF1OiAhMFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgV3UoZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX2NyZWF0ZUVycm9yKGUsIHRoaXMuc2V0dGluZ3MubWV0aG9kTmFtZSwgdGhpcy5zZXR0aW5ncy5HdSB8fCAhMSwgdGhpcy5wYXRoLCB0aGlzLnNldHRpbmdzLnp1KTtcbiAgICB9XG4gICAgLyoqIFJldHVybnMgJ3RydWUnIGlmICdmaWVsZFBhdGgnIHdhcyB0cmF2ZXJzZWQgd2hlbiBjcmVhdGluZyB0aGlzIGNvbnRleHQuICovICAgIGNvbnRhaW5zKGUpIHtcbiAgICAgICAgcmV0dXJuIHZvaWQgMCAhPT0gdGhpcy5maWVsZE1hc2suZmluZCgodCA9PiBlLmlzUHJlZml4T2YodCkpKSB8fCB2b2lkIDAgIT09IHRoaXMuZmllbGRUcmFuc2Zvcm1zLmZpbmQoKHQgPT4gZS5pc1ByZWZpeE9mKHQuZmllbGQpKSk7XG4gICAgfVxuICAgIEJ1KCkge1xuICAgICAgICAvLyBUT0RPKGIvMzQ4NzExMzEpOiBSZW1vdmUgbnVsbCBjaGVjayBvbmNlIHdlIGhhdmUgcHJvcGVyIHBhdGhzIGZvciBmaWVsZHNcbiAgICAgICAgLy8gd2l0aGluIGFycmF5cy5cbiAgICAgICAgaWYgKHRoaXMucGF0aCkgZm9yIChsZXQgZSA9IDA7IGUgPCB0aGlzLnBhdGgubGVuZ3RoOyBlKyspIHRoaXMuJHUodGhpcy5wYXRoLmdldChlKSk7XG4gICAgfVxuICAgICR1KGUpIHtcbiAgICAgICAgaWYgKDAgPT09IGUubGVuZ3RoKSB0aHJvdyB0aGlzLld1KFwiRG9jdW1lbnQgZmllbGRzIG11c3Qgbm90IGJlIGVtcHR5XCIpO1xuICAgICAgICBpZiAoX19QUklWQVRFX2lzV3JpdGUodGhpcy5MdSkgJiYgcm4udGVzdChlKSkgdGhyb3cgdGhpcy5XdSgnRG9jdW1lbnQgZmllbGRzIGNhbm5vdCBiZWdpbiBhbmQgZW5kIHdpdGggXCJfX1wiJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciBmb3IgcGFyc2luZyByYXcgdXNlciBpbnB1dCAocHJvdmlkZWQgdmlhIHRoZSBBUEkpIGludG8gaW50ZXJuYWwgbW9kZWxcbiAqIGNsYXNzZXMuXG4gKi8gY2xhc3MgX19QUklWQVRFX1VzZXJEYXRhUmVhZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuZGF0YWJhc2VJZCA9IGUsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyA9IHQsIHRoaXMuc2VyaWFsaXplciA9IG4gfHwgX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZSk7XG4gICAgfVxuICAgIC8qKiBDcmVhdGVzIGEgbmV3IHRvcC1sZXZlbCBwYXJzZSBjb250ZXh0LiAqLyAgICBqdShlLCB0LCBuLCByID0gITEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfUGFyc2VDb250ZXh0SW1wbCh7XG4gICAgICAgICAgICBMdTogZSxcbiAgICAgICAgICAgIG1ldGhvZE5hbWU6IHQsXG4gICAgICAgICAgICB6dTogbixcbiAgICAgICAgICAgIHBhdGg6IEZpZWxkUGF0aCQxLmVtcHR5UGF0aCgpLFxuICAgICAgICAgICAgUXU6ICExLFxuICAgICAgICAgICAgR3U6IHJcbiAgICAgICAgfSwgdGhpcy5kYXRhYmFzZUlkLCB0aGlzLnNlcmlhbGl6ZXIsIHRoaXMuaWdub3JlVW5kZWZpbmVkUHJvcGVydGllcyk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSkge1xuICAgIGNvbnN0IHQgPSBlLl9mcmVlemVTZXR0aW5ncygpLCBuID0gX19QUklWQVRFX25ld1NlcmlhbGl6ZXIoZS5fZGF0YWJhc2VJZCk7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfVXNlckRhdGFSZWFkZXIoZS5fZGF0YWJhc2VJZCwgISF0Lmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMsIG4pO1xufVxuXG4vKiogUGFyc2UgZG9jdW1lbnQgZGF0YSBmcm9tIGEgc2V0KCkgY2FsbC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlU2V0RGF0YShlLCB0LCBuLCByLCBpLCBzID0ge30pIHtcbiAgICBjb25zdCBvID0gZS5qdShzLm1lcmdlIHx8IHMubWVyZ2VGaWVsZHMgPyAyIC8qIFVzZXJEYXRhU291cmNlLk1lcmdlU2V0ICovIDogMCAvKiBVc2VyRGF0YVNvdXJjZS5TZXQgKi8gLCB0LCBuLCBpKTtcbiAgICBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChcIkRhdGEgbXVzdCBiZSBhbiBvYmplY3QsIGJ1dCBpdCB3YXM6XCIsIG8sIHIpO1xuICAgIGNvbnN0IF8gPSBfX1BSSVZBVEVfcGFyc2VPYmplY3Qociwgbyk7XG4gICAgbGV0IGEsIHU7XG4gICAgaWYgKHMubWVyZ2UpIGEgPSBuZXcgRmllbGRNYXNrKG8uZmllbGRNYXNrKSwgdSA9IG8uZmllbGRUcmFuc2Zvcm1zOyBlbHNlIGlmIChzLm1lcmdlRmllbGRzKSB7XG4gICAgICAgIGNvbnN0IGUgPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCByIG9mIHMubWVyZ2VGaWVsZHMpIHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50JDEodCwgciwgbik7XG4gICAgICAgICAgICBpZiAoIW8uY29udGFpbnMoaSkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBGaWVsZCAnJHtpfScgaXMgc3BlY2lmaWVkIGluIHlvdXIgZmllbGQgbWFzayBidXQgbWlzc2luZyBmcm9tIHlvdXIgaW5wdXQgZGF0YS5gKTtcbiAgICAgICAgICAgIF9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyhlLCBpKSB8fCBlLnB1c2goaSk7XG4gICAgICAgIH1cbiAgICAgICAgYSA9IG5ldyBGaWVsZE1hc2soZSksIHUgPSBvLmZpZWxkVHJhbnNmb3Jtcy5maWx0ZXIoKGUgPT4gYS5jb3ZlcnMoZS5maWVsZCkpKTtcbiAgICB9IGVsc2UgYSA9IG51bGwsIHUgPSBvLmZpZWxkVHJhbnNmb3JtcztcbiAgICByZXR1cm4gbmV3IFBhcnNlZFNldERhdGEobmV3IE9iamVjdFZhbHVlKF8pLCBhLCB1KTtcbn1cblxuY2xhc3MgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsIGV4dGVuZHMgRmllbGRWYWx1ZSB7XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBpZiAoMiAvKiBVc2VyRGF0YVNvdXJjZS5NZXJnZVNldCAqLyAhPT0gZS5MdSkgdGhyb3cgMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gPT09IGUuTHUgPyBlLld1KGAke3RoaXMuX21ldGhvZE5hbWV9KCkgY2FuIG9ubHkgYXBwZWFyIGF0IHRoZSB0b3AgbGV2ZWwgb2YgeW91ciB1cGRhdGUgZGF0YWApIDogZS5XdShgJHt0aGlzLl9tZXRob2ROYW1lfSgpIGNhbm5vdCBiZSB1c2VkIHdpdGggc2V0KCkgdW5sZXNzIHlvdSBwYXNzIHttZXJnZTp0cnVlfWApO1xuICAgICAgICAvLyBObyB0cmFuc2Zvcm0gdG8gYWRkIGZvciBhIGRlbGV0ZSwgYnV0IHdlIG5lZWQgdG8gYWRkIGl0IHRvIG91clxuICAgICAgICAvLyBmaWVsZE1hc2sgc28gaXQgZ2V0cyBkZWxldGVkLlxuICAgICAgICByZXR1cm4gZS5maWVsZE1hc2sucHVzaChlLnBhdGgpLCBudWxsO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfRGVsZXRlRmllbGRWYWx1ZUltcGw7XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBjaGlsZCBjb250ZXh0IGZvciBwYXJzaW5nIFNlcmlhbGl6YWJsZUZpZWxkVmFsdWVzLlxuICpcbiAqIFRoaXMgaXMgZGlmZmVyZW50IHRoYW4gY2FsbGluZyBgUGFyc2VDb250ZXh0LmNvbnRleHRXaXRoYCBiZWNhdXNlIGl0IGtlZXBzXG4gKiB0aGUgZmllbGRUcmFuc2Zvcm1zIGFuZCBmaWVsZE1hc2sgc2VwYXJhdGUuXG4gKlxuICogVGhlIGNyZWF0ZWQgY29udGV4dCBoYXMgaXRzIGBkYXRhU291cmNlYCBzZXQgdG8gYFVzZXJEYXRhU291cmNlLkFyZ3VtZW50YC5cbiAqIEFsdGhvdWdoIHRoZXNlIHZhbHVlcyBhcmUgdXNlZCB3aXRoIHdyaXRlcywgYW55IGVsZW1lbnRzIGluIHRoZXNlIEZpZWxkVmFsdWVzXG4gKiBhcmUgbm90IGNvbnNpZGVyZWQgd3JpdGVzIHNpbmNlIHRoZXkgY2Fubm90IGNvbnRhaW4gYW55IEZpZWxkVmFsdWUgc2VudGluZWxzLFxuICogZXRjLlxuICpcbiAqIEBwYXJhbSBmaWVsZFZhbHVlIC0gVGhlIHNlbnRpbmVsIEZpZWxkVmFsdWUgZm9yIHdoaWNoIHRvIGNyZWF0ZSBhIGNoaWxkXG4gKiAgICAgY29udGV4dC5cbiAqIEBwYXJhbSBjb250ZXh0IC0gVGhlIHBhcmVudCBjb250ZXh0LlxuICogQHBhcmFtIGFycmF5RWxlbWVudCAtIFdoZXRoZXIgb3Igbm90IHRoZSBGaWVsZFZhbHVlIGhhcyBhbiBhcnJheS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlU2VudGluZWxDaGlsZENvbnRleHQoZSwgdCwgbikge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BhcnNlQ29udGV4dEltcGwoe1xuICAgICAgICBMdTogMyAvKiBVc2VyRGF0YVNvdXJjZS5Bcmd1bWVudCAqLyAsXG4gICAgICAgIHp1OiB0LnNldHRpbmdzLnp1LFxuICAgICAgICBtZXRob2ROYW1lOiBlLl9tZXRob2ROYW1lLFxuICAgICAgICBRdTogblxuICAgIH0sIHQuZGF0YWJhc2VJZCwgdC5zZXJpYWxpemVyLCB0Lmlnbm9yZVVuZGVmaW5lZFByb3BlcnRpZXMpO1xufVxuXG5jbGFzcyBfX1BSSVZBVEVfU2VydmVyVGltZXN0YW1wRmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBfdG9GaWVsZFRyYW5zZm9ybShlKSB7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRUcmFuc2Zvcm0oZS5wYXRoLCBuZXcgX19QUklWQVRFX1NlcnZlclRpbWVzdGFtcFRyYW5zZm9ybSk7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBGaWVsZFZhbHVlSW1wbDtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9BcnJheVVuaW9uRmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUpLCB0aGlzLkh1ID0gdDtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX2NyZWF0ZVNlbnRpbmVsQ2hpbGRDb250ZXh0KHRoaXMsIGUsIFxuICAgICAgICAvKmFycmF5PSovICEwKSwgbiA9IHRoaXMuSHUubWFwKChlID0+IF9fUFJJVkFURV9wYXJzZURhdGEoZSwgdCkpKSwgciA9IG5ldyBfX1BSSVZBVEVfQXJyYXlVbmlvblRyYW5zZm9ybU9wZXJhdGlvbihuKTtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFRyYW5zZm9ybShlLnBhdGgsIHIpO1xuICAgIH1cbiAgICBpc0VxdWFsKGUpIHtcbiAgICAgICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBfX1BSSVZBVEVfQXJyYXlVbmlvbkZpZWxkVmFsdWVJbXBsICYmIGRlZXBFcXVhbCh0aGlzLkh1LCBlLkh1KTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9BcnJheVJlbW92ZUZpZWxkVmFsdWVJbXBsIGV4dGVuZHMgRmllbGRWYWx1ZSB7XG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcihlKSwgdGhpcy5IdSA9IHQ7XG4gICAgfVxuICAgIF90b0ZpZWxkVHJhbnNmb3JtKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV9jcmVhdGVTZW50aW5lbENoaWxkQ29udGV4dCh0aGlzLCBlLCBcbiAgICAgICAgLyphcnJheT0qLyAhMCksIG4gPSB0aGlzLkh1Lm1hcCgoZSA9PiBfX1BSSVZBVEVfcGFyc2VEYXRhKGUsIHQpKSksIHIgPSBuZXcgX19QUklWQVRFX0FycmF5UmVtb3ZlVHJhbnNmb3JtT3BlcmF0aW9uKG4pO1xuICAgICAgICByZXR1cm4gbmV3IEZpZWxkVHJhbnNmb3JtKGUucGF0aCwgcik7XG4gICAgfVxuICAgIGlzRXF1YWwoZSkge1xuICAgICAgICByZXR1cm4gZSBpbnN0YW5jZW9mIF9fUFJJVkFURV9BcnJheVJlbW92ZUZpZWxkVmFsdWVJbXBsICYmIGRlZXBFcXVhbCh0aGlzLkh1LCBlLkh1KTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50RmllbGRWYWx1ZUltcGwgZXh0ZW5kcyBGaWVsZFZhbHVlIHtcbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUpLCB0aGlzLkp1ID0gdDtcbiAgICB9XG4gICAgX3RvRmllbGRUcmFuc2Zvcm0oZSkge1xuICAgICAgICBjb25zdCB0ID0gbmV3IF9fUFJJVkFURV9OdW1lcmljSW5jcmVtZW50VHJhbnNmb3JtT3BlcmF0aW9uKGUuc2VyaWFsaXplciwgdG9OdW1iZXIoZS5zZXJpYWxpemVyLCB0aGlzLkp1KSk7XG4gICAgICAgIHJldHVybiBuZXcgRmllbGRUcmFuc2Zvcm0oZS5wYXRoLCB0KTtcbiAgICB9XG4gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiBlIGluc3RhbmNlb2YgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRGaWVsZFZhbHVlSW1wbCAmJiB0aGlzLkp1ID09PSBlLkp1O1xuICAgIH1cbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYW4gdXBkYXRlKCkgY2FsbC4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlVXBkYXRlRGF0YShlLCB0LCBuLCByKSB7XG4gICAgY29uc3QgaSA9IGUuanUoMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gLCB0LCBuKTtcbiAgICBfX1BSSVZBVEVfdmFsaWRhdGVQbGFpbk9iamVjdChcIkRhdGEgbXVzdCBiZSBhbiBvYmplY3QsIGJ1dCBpdCB3YXM6XCIsIGksIHIpO1xuICAgIGNvbnN0IHMgPSBbXSwgbyA9IE9iamVjdFZhbHVlLmVtcHR5KCk7XG4gICAgZm9yRWFjaChyLCAoKGUsIHIpID0+IHtcbiAgICAgICAgY29uc3QgXyA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tRG90U2VwYXJhdGVkU3RyaW5nKHQsIGUsIG4pO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgciA9IGdldE1vZHVsYXJJbnN0YW5jZShyKTtcbiAgICAgICAgY29uc3QgYSA9IGkuVXUoXyk7XG4gICAgICAgIGlmIChyIGluc3RhbmNlb2YgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsKSBcbiAgICAgICAgLy8gQWRkIGl0IHRvIHRoZSBmaWVsZCBtYXNrLCBidXQgZG9uJ3QgYWRkIGFueXRoaW5nIHRvIHVwZGF0ZURhdGEuXG4gICAgICAgIHMucHVzaChfKTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX3BhcnNlRGF0YShyLCBhKTtcbiAgICAgICAgICAgIG51bGwgIT0gZSAmJiAocy5wdXNoKF8pLCBvLnNldChfLCBlKSk7XG4gICAgICAgIH1cbiAgICB9KSk7XG4gICAgY29uc3QgXyA9IG5ldyBGaWVsZE1hc2socyk7XG4gICAgcmV0dXJuIG5ldyBQYXJzZWRVcGRhdGVEYXRhKG8sIF8sIGkuZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqIFBhcnNlIHVwZGF0ZSBkYXRhIGZyb20gYSBsaXN0IG9mIGZpZWxkL3ZhbHVlIGFyZ3VtZW50cy4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyhlLCB0LCBuLCByLCBpLCBzKSB7XG4gICAgY29uc3QgbyA9IGUuanUoMSAvKiBVc2VyRGF0YVNvdXJjZS5VcGRhdGUgKi8gLCB0LCBuKSwgXyA9IFsgX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKHQsIHIsIG4pIF0sIGEgPSBbIGkgXTtcbiAgICBpZiAocy5sZW5ndGggJSAyICE9IDApIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBGdW5jdGlvbiAke3R9KCkgbmVlZHMgdG8gYmUgY2FsbGVkIHdpdGggYW4gZXZlbiBudW1iZXIgb2YgYXJndW1lbnRzIHRoYXQgYWx0ZXJuYXRlIGJldHdlZW4gZmllbGQgbmFtZXMgYW5kIHZhbHVlcy5gKTtcbiAgICBmb3IgKGxldCBlID0gMDsgZSA8IHMubGVuZ3RoOyBlICs9IDIpIF8ucHVzaChfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50JDEodCwgc1tlXSkpLCBcbiAgICBhLnB1c2goc1tlICsgMV0pO1xuICAgIGNvbnN0IHUgPSBbXSwgYyA9IE9iamVjdFZhbHVlLmVtcHR5KCk7XG4gICAgLy8gV2UgaXRlcmF0ZSBpbiByZXZlcnNlIG9yZGVyIHRvIHBpY2sgdGhlIGxhc3QgdmFsdWUgZm9yIGEgZmllbGQgaWYgdGhlXG4gICAgLy8gdXNlciBzcGVjaWZpZWQgdGhlIGZpZWxkIG11bHRpcGxlIHRpbWVzLlxuICAgIGZvciAobGV0IGUgPSBfLmxlbmd0aCAtIDE7IGUgPj0gMDsgLS1lKSBpZiAoIV9fUFJJVkFURV9maWVsZE1hc2tDb250YWlucyh1LCBfW2VdKSkge1xuICAgICAgICBjb25zdCB0ID0gX1tlXTtcbiAgICAgICAgbGV0IG4gPSBhW2VdO1xuICAgICAgICAvLyBGb3IgQ29tcGF0IHR5cGVzLCB3ZSBoYXZlIHRvIFwiZXh0cmFjdFwiIHRoZSB1bmRlcmx5aW5nIHR5cGVzIGJlZm9yZVxuICAgICAgICAvLyBwZXJmb3JtaW5nIHZhbGlkYXRpb24uXG4gICAgICAgICAgICAgICAgbiA9IGdldE1vZHVsYXJJbnN0YW5jZShuKTtcbiAgICAgICAgY29uc3QgciA9IG8uVXUodCk7XG4gICAgICAgIGlmIChuIGluc3RhbmNlb2YgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsKSBcbiAgICAgICAgLy8gQWRkIGl0IHRvIHRoZSBmaWVsZCBtYXNrLCBidXQgZG9uJ3QgYWRkIGFueXRoaW5nIHRvIHVwZGF0ZURhdGEuXG4gICAgICAgIHUucHVzaCh0KTsgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX3BhcnNlRGF0YShuLCByKTtcbiAgICAgICAgICAgIG51bGwgIT0gZSAmJiAodS5wdXNoKHQpLCBjLnNldCh0LCBlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29uc3QgbCA9IG5ldyBGaWVsZE1hc2sodSk7XG4gICAgcmV0dXJuIG5ldyBQYXJzZWRVcGRhdGVEYXRhKGMsIGwsIG8uZmllbGRUcmFuc2Zvcm1zKTtcbn1cblxuLyoqXG4gKiBQYXJzZSBhIFwicXVlcnkgdmFsdWVcIiAoZS5nLiB2YWx1ZSBpbiBhIHdoZXJlIGZpbHRlciBvciBhIHZhbHVlIGluIGEgY3Vyc29yXG4gKiBib3VuZCkuXG4gKlxuICogQHBhcmFtIGFsbG93QXJyYXlzIC0gV2hldGhlciB0aGUgcXVlcnkgdmFsdWUgaXMgYW4gYXJyYXkgdGhhdCBtYXkgZGlyZWN0bHlcbiAqIGNvbnRhaW4gYWRkaXRpb25hbCBhcnJheXMgKGUuZy4gdGhlIG9wZXJhbmQgb2YgYW4gYGluYCBxdWVyeSkuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlUXVlcnlWYWx1ZShlLCB0LCBuLCByID0gITEpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3BhcnNlRGF0YShuLCBlLmp1KHIgPyA0IC8qIFVzZXJEYXRhU291cmNlLkFycmF5QXJndW1lbnQgKi8gOiAzIC8qIFVzZXJEYXRhU291cmNlLkFyZ3VtZW50ICovICwgdCkpO1xufVxuXG4vKipcbiAqIFBhcnNlcyB1c2VyIGRhdGEgdG8gUHJvdG9idWYgVmFsdWVzLlxuICpcbiAqIEBwYXJhbSBpbnB1dCAtIERhdGEgdG8gYmUgcGFyc2VkLlxuICogQHBhcmFtIGNvbnRleHQgLSBBIGNvbnRleHQgb2JqZWN0IHJlcHJlc2VudGluZyB0aGUgY3VycmVudCBwYXRoIGJlaW5nIHBhcnNlZCxcbiAqIHRoZSBzb3VyY2Ugb2YgdGhlIGRhdGEgYmVpbmcgcGFyc2VkLCBldGMuXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIHZhbHVlLCBvciBudWxsIGlmIHRoZSB2YWx1ZSB3YXMgYSBGaWVsZFZhbHVlIHNlbnRpbmVsXG4gKiB0aGF0IHNob3VsZCBub3QgYmUgaW5jbHVkZWQgaW4gdGhlIHJlc3VsdGluZyBwYXJzZWQgZGF0YS5cbiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VEYXRhKGUsIHQpIHtcbiAgICBpZiAoX19QUklWQVRFX2xvb2tzTGlrZUpzb25PYmplY3QoXG4gICAgLy8gVW53cmFwIHRoZSBBUEkgdHlwZSBmcm9tIHRoZSBDb21wYXQgU0RLLiBUaGlzIHdpbGwgcmV0dXJuIHRoZSBBUEkgdHlwZVxuICAgIC8vIGZyb20gZmlyZXN0b3JlLWV4cC5cbiAgICBlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKSkgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZVBsYWluT2JqZWN0KFwiVW5zdXBwb3J0ZWQgZmllbGQgdmFsdWU6XCIsIHQsIGUpLCBcbiAgICBfX1BSSVZBVEVfcGFyc2VPYmplY3QoZSwgdCk7XG4gICAgaWYgKGUgaW5zdGFuY2VvZiBGaWVsZFZhbHVlKSBcbiAgICAvLyBGaWVsZFZhbHVlcyB1c3VhbGx5IHBhcnNlIGludG8gdHJhbnNmb3JtcyAoZXhjZXB0IGRlbGV0ZUZpZWxkKCkpXG4gICAgLy8gaW4gd2hpY2ggY2FzZSB3ZSBkbyBub3Qgd2FudCB0byBpbmNsdWRlIHRoaXMgZmllbGQgaW4gb3VyIHBhcnNlZCBkYXRhXG4gICAgLy8gKGFzIGRvaW5nIHNvIHdpbGwgb3ZlcndyaXRlIHRoZSBmaWVsZCBkaXJlY3RseSBwcmlvciB0byB0aGUgdHJhbnNmb3JtXG4gICAgLy8gdHJ5aW5nIHRvIHRyYW5zZm9ybSBpdCkuIFNvIHdlIGRvbid0IGFkZCB0aGlzIGxvY2F0aW9uIHRvXG4gICAgLy8gY29udGV4dC5maWVsZE1hc2sgYW5kIHdlIHJldHVybiBudWxsIGFzIG91ciBwYXJzaW5nIHJlc3VsdC5cbiAgICAvKipcbiAqIFwiUGFyc2VzXCIgdGhlIHByb3ZpZGVkIEZpZWxkVmFsdWVJbXBsLCBhZGRpbmcgYW55IG5lY2Vzc2FyeSB0cmFuc2Zvcm1zIHRvXG4gKiBjb250ZXh0LmZpZWxkVHJhbnNmb3Jtcy5cbiAqL1xuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VTZW50aW5lbEZpZWxkVmFsdWUoZSwgdCkge1xuICAgICAgICAvLyBTZW50aW5lbHMgYXJlIG9ubHkgc3VwcG9ydGVkIHdpdGggd3JpdGVzLCBhbmQgbm90IHdpdGhpbiBhcnJheXMuXG4gICAgICAgIGlmICghX19QUklWQVRFX2lzV3JpdGUodC5MdSkpIHRocm93IHQuV3UoYCR7ZS5fbWV0aG9kTmFtZX0oKSBjYW4gb25seSBiZSB1c2VkIHdpdGggdXBkYXRlKCkgYW5kIHNldCgpYCk7XG4gICAgICAgIGlmICghdC5wYXRoKSB0aHJvdyB0Lld1KGAke2UuX21ldGhvZE5hbWV9KCkgaXMgbm90IGN1cnJlbnRseSBzdXBwb3J0ZWQgaW5zaWRlIGFycmF5c2ApO1xuICAgICAgICBjb25zdCBuID0gZS5fdG9GaWVsZFRyYW5zZm9ybSh0KTtcbiAgICAgICAgbiAmJiB0LmZpZWxkVHJhbnNmb3Jtcy5wdXNoKG4pO1xuICAgIH1cbiAgICAvKipcbiAqIEhlbHBlciB0byBwYXJzZSBhIHNjYWxhciB2YWx1ZSAoaS5lLiBub3QgYW4gT2JqZWN0LCBBcnJheSwgb3IgRmllbGRWYWx1ZSlcbiAqXG4gKiBAcmV0dXJucyBUaGUgcGFyc2VkIHZhbHVlXG4gKi8gKGUsIHQpLCBudWxsO1xuICAgIGlmICh2b2lkIDAgPT09IGUgJiYgdC5pZ25vcmVVbmRlZmluZWRQcm9wZXJ0aWVzKSBcbiAgICAvLyBJZiB0aGUgaW5wdXQgaXMgdW5kZWZpbmVkIGl0IGNhbiBuZXZlciBwYXJ0aWNpcGF0ZSBpbiB0aGUgZmllbGRNYXNrLCBzb1xuICAgIC8vIGRvbid0IGhhbmRsZSB0aGlzIGJlbG93LiBJZiBgaWdub3JlVW5kZWZpbmVkUHJvcGVydGllc2AgaXMgZmFsc2UsXG4gICAgLy8gYHBhcnNlU2NhbGFyVmFsdWVgIHdpbGwgcmVqZWN0IGFuIHVuZGVmaW5lZCB2YWx1ZS5cbiAgICByZXR1cm4gbnVsbDtcbiAgICBpZiAoXG4gICAgLy8gSWYgY29udGV4dC5wYXRoIGlzIG51bGwgd2UgYXJlIGluc2lkZSBhbiBhcnJheSBhbmQgd2UgZG9uJ3Qgc3VwcG9ydFxuICAgIC8vIGZpZWxkIG1hc2sgcGF0aHMgbW9yZSBncmFudWxhciB0aGFuIHRoZSB0b3AtbGV2ZWwgYXJyYXkuXG4gICAgdC5wYXRoICYmIHQuZmllbGRNYXNrLnB1c2godC5wYXRoKSwgZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgIC8vIFRPRE8oYi8zNDg3MTEzMSk6IEluY2x1ZGUgdGhlIHBhdGggY29udGFpbmluZyB0aGUgYXJyYXkgaW4gdGhlIGVycm9yXG4gICAgICAgIC8vIG1lc3NhZ2UuXG4gICAgICAgIC8vIEluIHRoZSBjYXNlIG9mIElOIHF1ZXJpZXMsIHRoZSBwYXJzZWQgZGF0YSBpcyBhbiBhcnJheSAocmVwcmVzZW50aW5nXG4gICAgICAgIC8vIHRoZSBzZXQgb2YgdmFsdWVzIHRvIGJlIGluY2x1ZGVkIGZvciB0aGUgSU4gcXVlcnkpIHRoYXQgbWF5IGRpcmVjdGx5XG4gICAgICAgIC8vIGNvbnRhaW4gYWRkaXRpb25hbCBhcnJheXMgKGVhY2ggcmVwcmVzZW50aW5nIGFuIGluZGl2aWR1YWwgZmllbGRcbiAgICAgICAgLy8gdmFsdWUpLCBzbyB3ZSBkaXNhYmxlIHRoaXMgdmFsaWRhdGlvbi5cbiAgICAgICAgaWYgKHQuc2V0dGluZ3MuUXUgJiYgNCAvKiBVc2VyRGF0YVNvdXJjZS5BcnJheUFyZ3VtZW50ICovICE9PSB0Lkx1KSB0aHJvdyB0Lld1KFwiTmVzdGVkIGFycmF5cyBhcmUgbm90IHN1cHBvcnRlZFwiKTtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZUFycmF5KGUsIHQpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBbXTtcbiAgICAgICAgICAgIGxldCByID0gMDtcbiAgICAgICAgICAgIGZvciAoY29uc3QgaSBvZiBlKSB7XG4gICAgICAgICAgICAgICAgbGV0IGUgPSBfX1BSSVZBVEVfcGFyc2VEYXRhKGksIHQuS3UocikpO1xuICAgICAgICAgICAgICAgIG51bGwgPT0gZSAmJiAoXG4gICAgICAgICAgICAgICAgLy8gSnVzdCBpbmNsdWRlIG51bGxzIGluIHRoZSBhcnJheSBmb3IgZmllbGRzIGJlaW5nIHJlcGxhY2VkIHdpdGggYVxuICAgICAgICAgICAgICAgIC8vIHNlbnRpbmVsLlxuICAgICAgICAgICAgICAgIGUgPSB7XG4gICAgICAgICAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgICAgICAgICB9KSwgbi5wdXNoKGUpLCByKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgdmFsdWVzOiBuXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfShlLCB0KTtcbiAgICB9XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZVNjYWxhclZhbHVlKGUsIHQpIHtcbiAgICAgICAgaWYgKG51bGwgPT09IChlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKSkgcmV0dXJuIHtcbiAgICAgICAgICAgIG51bGxWYWx1ZTogXCJOVUxMX1ZBTFVFXCJcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwibnVtYmVyXCIgPT0gdHlwZW9mIGUpIHJldHVybiB0b051bWJlcih0LnNlcmlhbGl6ZXIsIGUpO1xuICAgICAgICBpZiAoXCJib29sZWFuXCIgPT0gdHlwZW9mIGUpIHJldHVybiB7XG4gICAgICAgICAgICBib29sZWFuVmFsdWU6IGVcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIGUpIHJldHVybiB7XG4gICAgICAgICAgICBzdHJpbmdWYWx1ZTogZVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSBUaW1lc3RhbXAuZnJvbURhdGUoZSk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIHRpbWVzdGFtcFZhbHVlOiB0b1RpbWVzdGFtcCh0LnNlcmlhbGl6ZXIsIG4pXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgVGltZXN0YW1wKSB7XG4gICAgICAgICAgICAvLyBGaXJlc3RvcmUgYmFja2VuZCB0cnVuY2F0ZXMgcHJlY2lzaW9uIGRvd24gdG8gbWljcm9zZWNvbmRzLiBUbyBlbnN1cmVcbiAgICAgICAgICAgIC8vIG9mZmxpbmUgbW9kZSB3b3JrcyB0aGUgc2FtZSB3aXRoIHJlZ2FyZHMgdG8gdHJ1bmNhdGlvbiwgcGVyZm9ybSB0aGVcbiAgICAgICAgICAgIC8vIHRydW5jYXRpb24gaW1tZWRpYXRlbHkgd2l0aG91dCB3YWl0aW5nIGZvciB0aGUgYmFja2VuZCB0byBkbyB0aGF0LlxuICAgICAgICAgICAgY29uc3QgbiA9IG5ldyBUaW1lc3RhbXAoZS5zZWNvbmRzLCAxZTMgKiBNYXRoLmZsb29yKGUubmFub3NlY29uZHMgLyAxZTMpKTtcbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgdGltZXN0YW1wVmFsdWU6IHRvVGltZXN0YW1wKHQuc2VyaWFsaXplciwgbilcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGUgaW5zdGFuY2VvZiBHZW9Qb2ludCkgcmV0dXJuIHtcbiAgICAgICAgICAgIGdlb1BvaW50VmFsdWU6IHtcbiAgICAgICAgICAgICAgICBsYXRpdHVkZTogZS5sYXRpdHVkZSxcbiAgICAgICAgICAgICAgICBsb25naXR1ZGU6IGUubG9uZ2l0dWRlXG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgQnl0ZXMpIHJldHVybiB7XG4gICAgICAgICAgICBieXRlc1ZhbHVlOiBfX1BSSVZBVEVfdG9CeXRlcyh0LnNlcmlhbGl6ZXIsIGUuX2J5dGVTdHJpbmcpXG4gICAgICAgIH07XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UpIHtcbiAgICAgICAgICAgIGNvbnN0IG4gPSB0LmRhdGFiYXNlSWQsIHIgPSBlLmZpcmVzdG9yZS5fZGF0YWJhc2VJZDtcbiAgICAgICAgICAgIGlmICghci5pc0VxdWFsKG4pKSB0aHJvdyB0Lld1KGBEb2N1bWVudCByZWZlcmVuY2UgaXMgZm9yIGRhdGFiYXNlICR7ci5wcm9qZWN0SWR9LyR7ci5kYXRhYmFzZX0gYnV0IHNob3VsZCBiZSBmb3IgZGF0YWJhc2UgJHtuLnByb2plY3RJZH0vJHtuLmRhdGFiYXNlfWApO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICByZWZlcmVuY2VWYWx1ZTogX19QUklWQVRFX3RvUmVzb3VyY2VOYW1lKGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkIHx8IHQuZGF0YWJhc2VJZCwgZS5fa2V5LnBhdGgpXG4gICAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICAgIGlmIChlIGluc3RhbmNlb2YgVmVjdG9yVmFsdWUpIFxuICAgICAgICAvKipcbiAqIENyZWF0ZXMgYSBuZXcgVmVjdG9yVmFsdWUgcHJvdG8gdmFsdWUgKHVzaW5nIHRoZSBpbnRlcm5hbCBmb3JtYXQpLlxuICovXG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VWZWN0b3JWYWx1ZShlLCB0KSB7XG4gICAgICAgICAgICBjb25zdCBuID0ge1xuICAgICAgICAgICAgICAgIGZpZWxkczoge1xuICAgICAgICAgICAgICAgICAgICBbaXRdOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdHJpbmdWYWx1ZTogX3RcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgW2F0XToge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXJyYXlWYWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlczogZS50b0FycmF5KCkubWFwKChlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKFwibnVtYmVyXCIgIT0gdHlwZW9mIGUpIHRocm93IHQuV3UoXCJWZWN0b3JWYWx1ZXMgbXVzdCBvbmx5IGNvbnRhaW4gbnVtZXJpYyB2YWx1ZXMuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX19QUklWQVRFX3RvRG91YmxlKHQuc2VyaWFsaXplciwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkpXG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBtYXBWYWx1ZTogblxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIENoZWNrcyB3aGV0aGVyIGFuIG9iamVjdCBsb29rcyBsaWtlIGEgSlNPTiBvYmplY3QgdGhhdCBzaG91bGQgYmUgY29udmVydGVkXG4gKiBpbnRvIGEgc3RydWN0LiBOb3JtYWwgY2xhc3MvcHJvdG90eXBlIGluc3RhbmNlcyBhcmUgY29uc2lkZXJlZCB0byBsb29rIGxpa2VcbiAqIEpTT04gb2JqZWN0cyBzaW5jZSB0aGV5IHNob3VsZCBiZSBjb252ZXJ0ZWQgdG8gYSBzdHJ1Y3QgdmFsdWUuIEFycmF5cywgRGF0ZXMsXG4gKiBHZW9Qb2ludHMsIGV0Yy4gYXJlIG5vdCBjb25zaWRlcmVkIHRvIGxvb2sgbGlrZSBKU09OIG9iamVjdHMgc2luY2UgdGhleSBtYXBcbiAqIHRvIHNwZWNpZmljIEZpZWxkVmFsdWUgdHlwZXMgb3RoZXIgdGhhbiBPYmplY3RWYWx1ZS5cbiAqLyAoZSwgdCk7XG4gICAgICAgIHRocm93IHQuV3UoYFVuc3VwcG9ydGVkIGZpZWxkIHZhbHVlOiAke19fUFJJVkFURV92YWx1ZURlc2NyaXB0aW9uKGUpfWApO1xuICAgIH0oZSwgdCk7XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9wYXJzZU9iamVjdChlLCB0KSB7XG4gICAgY29uc3QgbiA9IHt9O1xuICAgIHJldHVybiBpc0VtcHR5KGUpID8gXG4gICAgLy8gSWYgd2UgZW5jb3VudGVyIGFuIGVtcHR5IG9iamVjdCwgd2UgZXhwbGljaXRseSBhZGQgaXQgdG8gdGhlIHVwZGF0ZVxuICAgIC8vIG1hc2sgdG8gZW5zdXJlIHRoYXQgdGhlIHNlcnZlciBjcmVhdGVzIGEgbWFwIGVudHJ5LlxuICAgIHQucGF0aCAmJiB0LnBhdGgubGVuZ3RoID4gMCAmJiB0LmZpZWxkTWFzay5wdXNoKHQucGF0aCkgOiBmb3JFYWNoKGUsICgoZSwgcikgPT4ge1xuICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX3BhcnNlRGF0YShyLCB0LnF1KGUpKTtcbiAgICAgICAgbnVsbCAhPSBpICYmIChuW2VdID0gaSk7XG4gICAgfSkpLCB7XG4gICAgICAgIG1hcFZhbHVlOiB7XG4gICAgICAgICAgICBmaWVsZHM6IG5cbiAgICAgICAgfVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV9sb29rc0xpa2VKc29uT2JqZWN0KGUpIHtcbiAgICByZXR1cm4gIShcIm9iamVjdFwiICE9IHR5cGVvZiBlIHx8IG51bGwgPT09IGUgfHwgZSBpbnN0YW5jZW9mIEFycmF5IHx8IGUgaW5zdGFuY2VvZiBEYXRlIHx8IGUgaW5zdGFuY2VvZiBUaW1lc3RhbXAgfHwgZSBpbnN0YW5jZW9mIEdlb1BvaW50IHx8IGUgaW5zdGFuY2VvZiBCeXRlcyB8fCBlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UgfHwgZSBpbnN0YW5jZW9mIEZpZWxkVmFsdWUgfHwgZSBpbnN0YW5jZW9mIFZlY3RvclZhbHVlKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlUGxhaW5PYmplY3QoZSwgdCwgbikge1xuICAgIGlmICghX19QUklWQVRFX2xvb2tzTGlrZUpzb25PYmplY3QobikgfHwgIWZ1bmN0aW9uIF9fUFJJVkFURV9pc1BsYWluT2JqZWN0KGUpIHtcbiAgICAgICAgcmV0dXJuIFwib2JqZWN0XCIgPT0gdHlwZW9mIGUgJiYgbnVsbCAhPT0gZSAmJiAoT2JqZWN0LmdldFByb3RvdHlwZU9mKGUpID09PSBPYmplY3QucHJvdG90eXBlIHx8IG51bGwgPT09IE9iamVjdC5nZXRQcm90b3R5cGVPZihlKSk7XG4gICAgfShuKSkge1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24obik7XG4gICAgICAgIHRocm93IFwiYW4gb2JqZWN0XCIgPT09IHIgPyB0Lld1KGUgKyBcIiBhIGN1c3RvbSBvYmplY3RcIikgOiB0Lld1KGUgKyBcIiBcIiArIHIpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBIZWxwZXIgdGhhdCBjYWxscyBmcm9tRG90U2VwYXJhdGVkU3RyaW5nKCkgYnV0IHdyYXBzIGFueSBlcnJvciB0aHJvd24uXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKGUsIHQsIG4pIHtcbiAgICBpZiAoKFxuICAgIC8vIElmIHJlcXVpcmVkLCByZXBsYWNlIHRoZSBGaWVsZFBhdGggQ29tcGF0IGNsYXNzIHdpdGggdGhlIGZpcmVzdG9yZS1leHBcbiAgICAvLyBGaWVsZFBhdGguXG4gICAgdCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSkgaW5zdGFuY2VvZiBGaWVsZFBhdGgpIHJldHVybiB0Ll9pbnRlcm5hbFBhdGg7XG4gICAgaWYgKFwic3RyaW5nXCIgPT0gdHlwZW9mIHQpIHJldHVybiBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbURvdFNlcGFyYXRlZFN0cmluZyhlLCB0KTtcbiAgICB0aHJvdyBfX1BSSVZBVEVfY3JlYXRlRXJyb3IoXCJGaWVsZCBwYXRoIGFyZ3VtZW50cyBtdXN0IGJlIG9mIHR5cGUgc3RyaW5nIG9yIFwiLCBlLCBcbiAgICAvKiBoYXNDb252ZXJ0ZXI9ICovICExLCBcbiAgICAvKiBwYXRoPSAqLyB2b2lkIDAsIG4pO1xufVxuXG4vKipcbiAqIE1hdGNoZXMgYW55IGNoYXJhY3RlcnMgaW4gYSBmaWVsZCBwYXRoIHN0cmluZyB0aGF0IGFyZSByZXNlcnZlZC5cbiAqLyBjb25zdCBzbiA9IG5ldyBSZWdFeHAoXCJbflxcXFwqL1xcXFxbXFxcXF1dXCIpO1xuXG4vKipcbiAqIFdyYXBzIGZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcgd2l0aCBhbiBlcnJvciBtZXNzYWdlIGFib3V0IHRoZSBtZXRob2QgdGhhdFxuICogd2FzIHRocm93bi5cbiAqIEBwYXJhbSBtZXRob2ROYW1lIC0gVGhlIHB1YmxpY2x5IHZpc2libGUgbWV0aG9kIG5hbWVcbiAqIEBwYXJhbSBwYXRoIC0gVGhlIGRvdC1zZXBhcmF0ZWQgc3RyaW5nIGZvcm0gb2YgYSBmaWVsZCBwYXRoIHdoaWNoIHdpbGwgYmVcbiAqIHNwbGl0IG9uIGRvdHMuXG4gKiBAcGFyYW0gdGFyZ2V0RG9jIC0gVGhlIGRvY3VtZW50IGFnYWluc3Qgd2hpY2ggdGhlIGZpZWxkIHBhdGggd2lsbCBiZVxuICogZXZhbHVhdGVkLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tRG90U2VwYXJhdGVkU3RyaW5nKGUsIHQsIG4pIHtcbiAgICBpZiAodC5zZWFyY2goc24pID49IDApIHRocm93IF9fUFJJVkFURV9jcmVhdGVFcnJvcihgSW52YWxpZCBmaWVsZCBwYXRoICgke3R9KS4gUGF0aHMgbXVzdCBub3QgY29udGFpbiAnficsICcqJywgJy8nLCAnWycsIG9yICddJ2AsIGUsIFxuICAgIC8qIGhhc0NvbnZlcnRlcj0gKi8gITEsIFxuICAgIC8qIHBhdGg9ICovIHZvaWQgMCwgbik7XG4gICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIG5ldyBGaWVsZFBhdGgoLi4udC5zcGxpdChcIi5cIikpLl9pbnRlcm5hbFBhdGg7XG4gICAgfSBjYXRjaCAocikge1xuICAgICAgICB0aHJvdyBfX1BSSVZBVEVfY3JlYXRlRXJyb3IoYEludmFsaWQgZmllbGQgcGF0aCAoJHt0fSkuIFBhdGhzIG11c3Qgbm90IGJlIGVtcHR5LCBiZWdpbiB3aXRoICcuJywgZW5kIHdpdGggJy4nLCBvciBjb250YWluICcuLidgLCBlLCBcbiAgICAgICAgLyogaGFzQ29udmVydGVyPSAqLyAhMSwgXG4gICAgICAgIC8qIHBhdGg9ICovIHZvaWQgMCwgbik7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfY3JlYXRlRXJyb3IoZSwgdCwgbiwgciwgaSkge1xuICAgIGNvbnN0IHMgPSByICYmICFyLmlzRW1wdHkoKSwgbyA9IHZvaWQgMCAhPT0gaTtcbiAgICBsZXQgXyA9IGBGdW5jdGlvbiAke3R9KCkgY2FsbGVkIHdpdGggaW52YWxpZCBkYXRhYDtcbiAgICBuICYmIChfICs9IFwiICh2aWEgYHRvRmlyZXN0b3JlKClgKVwiKSwgXyArPSBcIi4gXCI7XG4gICAgbGV0IGEgPSBcIlwiO1xuICAgIHJldHVybiAocyB8fCBvKSAmJiAoYSArPSBcIiAoZm91bmRcIiwgcyAmJiAoYSArPSBgIGluIGZpZWxkICR7cn1gKSwgbyAmJiAoYSArPSBgIGluIGRvY3VtZW50ICR7aX1gKSwgXG4gICAgYSArPSBcIilcIiksIG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIF8gKyBlICsgYSk7XG59XG5cbi8qKiBDaGVja3MgYGhheXN0YWNrYCBpZiBGaWVsZFBhdGggYG5lZWRsZWAgaXMgcHJlc2VudC4gUnVucyBpbiBPKG4pLiAqLyBmdW5jdGlvbiBfX1BSSVZBVEVfZmllbGRNYXNrQ29udGFpbnMoZSwgdCkge1xuICAgIHJldHVybiBlLnNvbWUoKGUgPT4gZS5pc0VxdWFsKHQpKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91ciBGaXJlc3RvcmVcbiAqIGRhdGFiYXNlLiBUaGUgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0b1xuICogZ2V0IGEgc3BlY2lmaWMgZmllbGQuXG4gKlxuICogRm9yIGEgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcG9pbnRzIHRvIGEgbm9uLWV4aXN0aW5nIGRvY3VtZW50LCBhbnkgZGF0YVxuICogYWNjZXNzIHdpbGwgcmV0dXJuICd1bmRlZmluZWQnLiBZb3UgY2FuIHVzZSB0aGUgYGV4aXN0cygpYCBtZXRob2QgdG9cbiAqIGV4cGxpY2l0bHkgdmVyaWZ5IGEgZG9jdW1lbnQncyBleGlzdGVuY2UuXG4gKi8gY2xhc3MgRG9jdW1lbnRTbmFwc2hvdCQxIHtcbiAgICAvLyBOb3RlOiBUaGlzIGNsYXNzIGlzIHN0cmlwcGVkIGRvd24gdmVyc2lvbiBvZiB0aGUgRG9jdW1lbnRTbmFwc2hvdCBpblxuICAgIC8vIHRoZSBsZWdhY3kgU0RLLiBUaGUgY2hhbmdlcyBhcmU6XG4gICAgLy8gLSBObyBzdXBwb3J0IGZvciBTbmFwc2hvdE1ldGFkYXRhLlxuICAgIC8vIC0gTm8gc3VwcG9ydCBmb3IgU25hcHNob3RPcHRpb25zLlxuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yIHByb3RlY3RlZCAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQsIG4sIHIsIGkpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIgPSB0LCB0aGlzLl9rZXkgPSBuLCB0aGlzLl9kb2N1bWVudCA9IHIsIFxuICAgICAgICB0aGlzLl9jb252ZXJ0ZXIgPSBpO1xuICAgIH1cbiAgICAvKiogUHJvcGVydHkgb2YgdGhlIGBEb2N1bWVudFNuYXBzaG90YCB0aGF0IHByb3ZpZGVzIHRoZSBkb2N1bWVudCdzIElELiAqLyAgICBnZXQgaWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9rZXkucGF0aC5sYXN0U2VnbWVudCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUgYERvY3VtZW50UmVmZXJlbmNlYCBmb3IgdGhlIGRvY3VtZW50IGluY2x1ZGVkIGluIHRoZSBgRG9jdW1lbnRTbmFwc2hvdGAuXG4gICAgICovICAgIGdldCByZWYoKSB7XG4gICAgICAgIHJldHVybiBuZXcgRG9jdW1lbnRSZWZlcmVuY2UodGhpcy5fZmlyZXN0b3JlLCB0aGlzLl9jb252ZXJ0ZXIsIHRoaXMuX2tleSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNpZ25hbHMgd2hldGhlciBvciBub3QgdGhlIGRvY3VtZW50IGF0IHRoZSBzbmFwc2hvdCdzIGxvY2F0aW9uIGV4aXN0cy5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGRvY3VtZW50IGV4aXN0cy5cbiAgICAgKi8gICAgZXhpc3RzKCkge1xuICAgICAgICByZXR1cm4gbnVsbCAhPT0gdGhpcy5fZG9jdW1lbnQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZlxuICAgICAqIHRoZSBkb2N1bWVudCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQHJldHVybnMgQW4gYE9iamVjdGAgY29udGFpbmluZyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBvciBgdW5kZWZpbmVkYFxuICAgICAqIGlmIHRoZSBkb2N1bWVudCBkb2Vzbid0IGV4aXN0LlxuICAgICAqLyAgICBkYXRhKCkge1xuICAgICAgICBpZiAodGhpcy5fZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLl9jb252ZXJ0ZXIpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSBvbmx5IHdhbnQgdG8gdXNlIHRoZSBjb252ZXJ0ZXIgYW5kIGNyZWF0ZSBhIG5ldyBEb2N1bWVudFNuYXBzaG90XG4gICAgICAgICAgICAgICAgLy8gaWYgYSBjb252ZXJ0ZXIgaGFzIGJlZW4gcHJvdmlkZWQuXG4gICAgICAgICAgICAgICAgY29uc3QgZSA9IG5ldyBRdWVyeURvY3VtZW50U25hcHNob3QkMSh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX3VzZXJEYXRhV3JpdGVyLCB0aGlzLl9rZXksIHRoaXMuX2RvY3VtZW50LCBcbiAgICAgICAgICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0ZXIuZnJvbUZpcmVzdG9yZShlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YVdyaXRlci5jb252ZXJ0VmFsdWUodGhpcy5fZG9jdW1lbnQuZGF0YS52YWx1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIHRoZSBmaWVsZCBzcGVjaWZpZWQgYnkgYGZpZWxkUGF0aGAuIFJldHVybnMgYHVuZGVmaW5lZGAgaWYgdGhlXG4gICAgICogZG9jdW1lbnQgb3IgZmllbGQgZG9lc24ndCBleGlzdC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBmaWVsZFBhdGggLSBUaGUgcGF0aCAoZm9yIGV4YW1wbGUgJ2Zvbycgb3IgJ2Zvby5iYXInKSB0byBhIHNwZWNpZmljXG4gICAgICogZmllbGQuXG4gICAgICogQHJldHVybnMgVGhlIGRhdGEgYXQgdGhlIHNwZWNpZmllZCBmaWVsZCBsb2NhdGlvbiBvciB1bmRlZmluZWQgaWYgbm8gc3VjaFxuICAgICAqIGZpZWxkIGV4aXN0cyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgLy8gV2UgYXJlIHVzaW5nIGBhbnlgIGhlcmUgdG8gYXZvaWQgYW4gZXhwbGljaXQgY2FzdCBieSBvdXIgdXNlcnMuXG4gICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICBnZXQoZSkge1xuICAgICAgICBpZiAodGhpcy5fZG9jdW1lbnQpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSB0aGlzLl9kb2N1bWVudC5kYXRhLmZpZWxkKF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoXCJEb2N1bWVudFNuYXBzaG90LmdldFwiLCBlKSk7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gdCkgcmV0dXJuIHRoaXMuX3VzZXJEYXRhV3JpdGVyLmNvbnZlcnRWYWx1ZSh0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91clxuICogRmlyZXN0b3JlIGRhdGFiYXNlIGFzIHBhcnQgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50IGlzIGd1YXJhbnRlZWQgdG8gZXhpc3RcbiAqIGFuZCBpdHMgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0byBnZXQgYVxuICogc3BlY2lmaWMgZmllbGQuXG4gKlxuICogQSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBvZmZlcnMgdGhlIHNhbWUgQVBJIHN1cmZhY2UgYXMgYVxuICogYERvY3VtZW50U25hcHNob3RgLiBTaW5jZSBxdWVyeSByZXN1bHRzIGNvbnRhaW4gb25seSBleGlzdGluZyBkb2N1bWVudHMsIHRoZVxuICogYGV4aXN0c2AgcHJvcGVydHkgd2lsbCBhbHdheXMgYmUgdHJ1ZSBhbmQgYGRhdGEoKWAgd2lsbCBuZXZlciByZXR1cm5cbiAqICd1bmRlZmluZWQnLlxuICovIGNsYXNzIFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCQxIGV4dGVuZHMgRG9jdW1lbnRTbmFwc2hvdCQxIHtcbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQgYXMgYW4gYE9iamVjdGAuXG4gICAgICpcbiAgICAgKiBAb3ZlcnJpZGVcbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50LlxuICAgICAqL1xuICAgIGRhdGEoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5kYXRhKCk7XG4gICAgfVxufVxuXG4vKipcbiAqIEhlbHBlciB0aGF0IGNhbGxzIGBmcm9tRG90U2VwYXJhdGVkU3RyaW5nKClgIGJ1dCB3cmFwcyBhbnkgZXJyb3IgdGhyb3duLlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoZSwgdCkge1xuICAgIHJldHVybiBcInN0cmluZ1wiID09IHR5cGVvZiB0ID8gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Eb3RTZXBhcmF0ZWRTdHJpbmcoZSwgdCkgOiB0IGluc3RhbmNlb2YgRmllbGRQYXRoID8gdC5faW50ZXJuYWxQYXRoIDogdC5fZGVsZWdhdGUuX2ludGVybmFsUGF0aDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlSGFzRXhwbGljaXRPcmRlckJ5Rm9yTGltaXRUb0xhc3QoZSkge1xuICAgIGlmIChcIkxcIiAvKiBMaW1pdFR5cGUuTGFzdCAqLyA9PT0gZS5saW1pdFR5cGUgJiYgMCA9PT0gZS5leHBsaWNpdE9yZGVyQnkubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5VTklNUExFTUVOVEVELCBcImxpbWl0VG9MYXN0KCkgcXVlcmllcyByZXF1aXJlIHNwZWNpZnlpbmcgYXQgbGVhc3Qgb25lIG9yZGVyQnkoKSBjbGF1c2VcIik7XG59XG5cbi8qKlxuICogQW4gYEFwcGxpYWJsZUNvbnN0cmFpbnRgIGlzIGFuIGFic3RyYWN0aW9uIG9mIGEgY29uc3RyYWludCB0aGF0IGNhbiBiZSBhcHBsaWVkXG4gKiB0byBhIEZpcmVzdG9yZSBxdWVyeS5cbiAqLyBjbGFzcyBBcHBsaWFibGVDb25zdHJhaW50IHt9XG5cbi8qKlxuICogQSBgUXVlcnlDb25zdHJhaW50YCBpcyB1c2VkIHRvIG5hcnJvdyB0aGUgc2V0IG9mIGRvY3VtZW50cyByZXR1cm5lZCBieSBhXG4gKiBGaXJlc3RvcmUgcXVlcnkuIGBRdWVyeUNvbnN0cmFpbnRgcyBhcmUgY3JlYXRlZCBieSBpbnZva2luZyB7QGxpbmsgd2hlcmV9LFxuICoge0BsaW5rIG9yZGVyQnl9LCB7QGxpbmsgKHN0YXJ0QXQ6MSl9LCB7QGxpbmsgKHN0YXJ0QWZ0ZXI6MSl9LCB7QGxpbmtcbiAqIChlbmRCZWZvcmU6MSl9LCB7QGxpbmsgKGVuZEF0OjEpfSwge0BsaW5rIGxpbWl0fSwge0BsaW5rIGxpbWl0VG9MYXN0fSBhbmRcbiAqIGNhbiB0aGVuIGJlIHBhc3NlZCB0byB7QGxpbmsgKHF1ZXJ5OjEpfSB0byBjcmVhdGUgYSBuZXcgcXVlcnkgaW5zdGFuY2UgdGhhdFxuICogYWxzbyBjb250YWlucyB0aGlzIGBRdWVyeUNvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5Q29uc3RyYWludCBleHRlbmRzIEFwcGxpYWJsZUNvbnN0cmFpbnQge31cblxuZnVuY3Rpb24gcXVlcnkoZSwgdCwgLi4ubikge1xuICAgIGxldCByID0gW107XG4gICAgdCBpbnN0YW5jZW9mIEFwcGxpYWJsZUNvbnN0cmFpbnQgJiYgci5wdXNoKHQpLCByID0gci5jb25jYXQobiksIGZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVF1ZXJ5Q29uc3RyYWludEFycmF5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGUuZmlsdGVyKChlID0+IGUgaW5zdGFuY2VvZiBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQpKS5sZW5ndGgsIG4gPSBlLmZpbHRlcigoZSA9PiBlIGluc3RhbmNlb2YgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQpKS5sZW5ndGg7XG4gICAgICAgIGlmICh0ID4gMSB8fCB0ID4gMCAmJiBuID4gMCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkUXVlcnkuIFdoZW4gdXNpbmcgY29tcG9zaXRlIGZpbHRlcnMsIHlvdSBjYW5ub3QgdXNlIG1vcmUgdGhhbiBvbmUgZmlsdGVyIGF0IHRoZSB0b3AgbGV2ZWwuIENvbnNpZGVyIG5lc3RpbmcgdGhlIG11bHRpcGxlIGZpbHRlcnMgd2l0aGluIGFuIGBhbmQoLi4uKWAgc3RhdGVtZW50LiBGb3IgZXhhbXBsZTogY2hhbmdlIGBxdWVyeShxdWVyeSwgd2hlcmUoLi4uKSwgb3IoLi4uKSlgIHRvIGBxdWVyeShxdWVyeSwgYW5kKHdoZXJlKC4uLiksIG9yKC4uLikpKWAuXCIpO1xuICAgIH1cbiAgICAvKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuICAgIC8qKlxuICogQ29udmVydHMgRmlyZXN0b3JlJ3MgaW50ZXJuYWwgdHlwZXMgdG8gdGhlIEphdmFTY3JpcHQgdHlwZXMgdGhhdCB3ZSBleHBvc2VcbiAqIHRvIHRoZSB1c2VyLlxuICpcbiAqIEBpbnRlcm5hbFxuICovIChyKTtcbiAgICBmb3IgKGNvbnN0IHQgb2YgcikgZSA9IHQuX2FwcGx5KGUpO1xuICAgIHJldHVybiBlO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50YCBpcyB1c2VkIHRvIG5hcnJvdyB0aGUgc2V0IG9mIGRvY3VtZW50cyByZXR1cm5lZCBieVxuICogYSBGaXJlc3RvcmUgcXVlcnkgYnkgZmlsdGVyaW5nIG9uIG9uZSBvciBtb3JlIGRvY3VtZW50IGZpZWxkcy5cbiAqIGBRdWVyeUZpZWxkRmlsdGVyQ29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayB3aGVyZX0gYW5kIGNhbiB0aGVuXG4gKiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5IGluc3RhbmNlIHRoYXQgYWxzbyBjb250YWluc1xuICogdGhpcyBgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMuX2ZpZWxkID0gZSwgdGhpcy5fb3AgPSB0LCB0aGlzLl92YWx1ZSA9IG4sIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwid2hlcmVcIjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50KGUsIHQsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5fcGFyc2UoZSk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVOZXdGaWVsZEZpbHRlcihlLl9xdWVyeSwgdCksIG5ldyBRdWVyeShlLmZpcmVzdG9yZSwgZS5jb252ZXJ0ZXIsIF9fUFJJVkFURV9xdWVyeVdpdGhBZGRlZEZpbHRlcihlLl9xdWVyeSwgdCkpO1xuICAgIH1cbiAgICBfcGFyc2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld1VzZXJEYXRhUmVhZGVyKGUuZmlyZXN0b3JlKSwgbiA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeUZpbHRlcihlLCB0LCBuLCByLCBpLCBzLCBvKSB7XG4gICAgICAgICAgICBsZXQgXztcbiAgICAgICAgICAgIGlmIChpLmlzS2V5RmllbGQoKSkge1xuICAgICAgICAgICAgICAgIGlmIChcImFycmF5LWNvbnRhaW5zXCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlMgKi8gPT09IHMgfHwgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gPT09IHMpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIFF1ZXJ5LiBZb3UgY2FuJ3QgcGVyZm9ybSAnJHtzfScgcXVlcmllcyBvbiBkb2N1bWVudElkKCkuYCk7XG4gICAgICAgICAgICAgICAgaWYgKFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA9PT0gcyB8fCBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA9PT0gcykge1xuICAgICAgICAgICAgICAgICAgICBfX1BSSVZBVEVfdmFsaWRhdGVEaXNqdW5jdGl2ZUZpbHRlckVsZW1lbnRzKG8sIHMpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gW107XG4gICAgICAgICAgICAgICAgICAgIGZvciAoY29uc3QgbiBvZiBvKSB0LnB1c2goX19QUklWQVRFX3BhcnNlRG9jdW1lbnRJZFZhbHVlKHIsIGUsIG4pKTtcbiAgICAgICAgICAgICAgICAgICAgXyA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFycmF5VmFsdWU6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZXM6IHRcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgXyA9IF9fUFJJVkFURV9wYXJzZURvY3VtZW50SWRWYWx1ZShyLCBlLCBvKTtcbiAgICAgICAgICAgIH0gZWxzZSBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gIT09IHMgJiYgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gIT09IHMgJiYgXCJhcnJheS1jb250YWlucy1hbnlcIiAvKiBPcGVyYXRvci5BUlJBWV9DT05UQUlOU19BTlkgKi8gIT09IHMgfHwgX19QUklWQVRFX3ZhbGlkYXRlRGlzanVuY3RpdmVGaWx0ZXJFbGVtZW50cyhvLCBzKSwgXG4gICAgICAgICAgICBfID0gX19QUklWQVRFX3BhcnNlUXVlcnlWYWx1ZShuLCB0LCBvLCBcbiAgICAgICAgICAgIC8qIGFsbG93QXJyYXlzPSAqLyBcImluXCIgLyogT3BlcmF0b3IuSU4gKi8gPT09IHMgfHwgXCJub3QtaW5cIiAvKiBPcGVyYXRvci5OT1RfSU4gKi8gPT09IHMpO1xuICAgICAgICAgICAgY29uc3QgYSA9IEZpZWxkRmlsdGVyLmNyZWF0ZShpLCBzLCBfKTtcbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9KGUuX3F1ZXJ5LCBcIndoZXJlXCIsIHQsIGUuZmlyZXN0b3JlLl9kYXRhYmFzZUlkLCB0aGlzLl9maWVsZCwgdGhpcy5fb3AsIHRoaXMuX3ZhbHVlKTtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9IHRoYXQgZW5mb3JjZXMgdGhhdCBkb2N1bWVudHNcbiAqIG11c3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIGZpZWxkIGFuZCB0aGF0IHRoZSB2YWx1ZSBzaG91bGQgc2F0aXNmeSB0aGVcbiAqIHJlbGF0aW9uIGNvbnN0cmFpbnQgcHJvdmlkZWQuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBwYXRoIHRvIGNvbXBhcmVcbiAqIEBwYXJhbSBvcFN0ciAtIFRoZSBvcGVyYXRpb24gc3RyaW5nIChlLmcgXCImbHQ7XCIsIFwiJmx0Oz1cIiwgXCI9PVwiLCBcIiZsdDtcIixcbiAqICAgXCImbHQ7PVwiLCBcIiE9XCIpLlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIGZvciBjb21wYXJpc29uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIHdoZXJlKGUsIHQsIG4pIHtcbiAgICBjb25zdCByID0gdCwgaSA9IF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQoXCJ3aGVyZVwiLCBlKTtcbiAgICByZXR1cm4gUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShpLCByLCBuKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzXG4gKiByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBxdWVyeSBieSBwZXJmb3JtaW5nIHRoZSBsb2dpY2FsIE9SIG9yIEFORCBvZiBtdWx0aXBsZVxuICoge0BsaW5rIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50fXMgb3Ige0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH1zLlxuICogYFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayBvcn0gb3JcbiAqIHtAbGluayBhbmR9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5XG4gKiBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhlIGBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCBleHRlbmRzIEFwcGxpYWJsZUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICBlLCB0KSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IGUsIHRoaXMuX3F1ZXJ5Q29uc3RyYWludHMgPSB0O1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50KGUsIHQpO1xuICAgIH1cbiAgICBfcGFyc2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5fcXVlcnlDb25zdHJhaW50cy5tYXAoKHQgPT4gdC5fcGFyc2UoZSkpKS5maWx0ZXIoKGUgPT4gZS5nZXRGaWx0ZXJzKCkubGVuZ3RoID4gMCkpO1xuICAgICAgICByZXR1cm4gMSA9PT0gdC5sZW5ndGggPyB0WzBdIDogQ29tcG9zaXRlRmlsdGVyLmNyZWF0ZSh0LCB0aGlzLl9nZXRPcGVyYXRvcigpKTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuX3BhcnNlKGUpO1xuICAgICAgICByZXR1cm4gMCA9PT0gdC5nZXRGaWx0ZXJzKCkubGVuZ3RoID8gZSA6IChmdW5jdGlvbiBfX1BSSVZBVEVfdmFsaWRhdGVOZXdGaWx0ZXIoZSwgdCkge1xuICAgICAgICAgICAgbGV0IG4gPSBlO1xuICAgICAgICAgICAgY29uc3QgciA9IHQuZ2V0RmxhdHRlbmVkRmlsdGVycygpO1xuICAgICAgICAgICAgZm9yIChjb25zdCBlIG9mIHIpIF9fUFJJVkFURV92YWxpZGF0ZU5ld0ZpZWxkRmlsdGVyKG4sIGUpLCBuID0gX19QUklWQVRFX3F1ZXJ5V2l0aEFkZGVkRmlsdGVyKG4sIGUpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoZWNrcyBpZiBhbnkgb2YgdGhlIHByb3ZpZGVkIGZpbHRlciBvcGVyYXRvcnMgYXJlIGluY2x1ZGVkIGluIHRoZSBnaXZlbiBsaXN0IG9mIGZpbHRlcnMgYW5kXG4gICAgICAgIC8vIHJldHVybnMgdGhlIGZpcnN0IG9uZSB0aGF0IGlzLCBvciBudWxsIGlmIG5vbmUgYXJlLlxuICAgICAgICAoZS5fcXVlcnksIHQpLCBuZXcgUXVlcnkoZS5maXJlc3RvcmUsIGUuY29udmVydGVyLCBfX1BSSVZBVEVfcXVlcnlXaXRoQWRkZWRGaWx0ZXIoZS5fcXVlcnksIHQpKSk7XG4gICAgfVxuICAgIF9nZXRRdWVyeUNvbnN0cmFpbnRzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcXVlcnlDb25zdHJhaW50cztcbiAgICB9XG4gICAgX2dldE9wZXJhdG9yKCkge1xuICAgICAgICByZXR1cm4gXCJhbmRcIiA9PT0gdGhpcy50eXBlID8gXCJhbmRcIiAvKiBDb21wb3NpdGVPcGVyYXRvci5BTkQgKi8gOiBcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi87XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBuZXcge0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH0gdGhhdCBpcyBhIGRpc2p1bmN0aW9uIG9mXG4gKiB0aGUgZ2l2ZW4gZmlsdGVyIGNvbnN0cmFpbnRzLiBBIGRpc2p1bmN0aW9uIGZpbHRlciBpbmNsdWRlcyBhIGRvY3VtZW50IGlmIGl0XG4gKiBzYXRpc2ZpZXMgYW55IG9mIHRoZSBnaXZlbiBmaWx0ZXJzLlxuICpcbiAqIEBwYXJhbSBxdWVyeUNvbnN0cmFpbnRzIC0gT3B0aW9uYWwuIFRoZSBsaXN0IG9mXG4gKiB7QGxpbmsgUXVlcnlGaWx0ZXJDb25zdHJhaW50fXMgdG8gcGVyZm9ybSBhIGRpc2p1bmN0aW9uIGZvci4gVGhlc2UgbXVzdCBiZVxuICogY3JlYXRlZCB3aXRoIGNhbGxzIHRvIHtAbGluayB3aGVyZX0sIHtAbGluayBvcn0sIG9yIHtAbGluayBhbmR9LlxuICogQHJldHVybnMgVGhlIG5ld2x5IGNyZWF0ZWQge0BsaW5rIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gb3IoLi4uZSkge1xuICAgIC8vIE9ubHkgc3VwcG9ydCBRdWVyeUZpbHRlckNvbnN0cmFpbnRzXG4gICAgcmV0dXJuIGUuZm9yRWFjaCgoZSA9PiBfX1BSSVZBVEVfdmFsaWRhdGVRdWVyeUZpbHRlckNvbnN0cmFpbnQoXCJvclwiLCBlKSkpLCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShcIm9yXCIgLyogQ29tcG9zaXRlT3BlcmF0b3IuT1IgKi8gLCBlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9IHRoYXQgaXMgYSBjb25qdW5jdGlvbiBvZlxuICogdGhlIGdpdmVuIGZpbHRlciBjb25zdHJhaW50cy4gQSBjb25qdW5jdGlvbiBmaWx0ZXIgaW5jbHVkZXMgYSBkb2N1bWVudCBpZiBpdFxuICogc2F0aXNmaWVzIGFsbCBvZiB0aGUgZ2l2ZW4gZmlsdGVycy5cbiAqXG4gKiBAcGFyYW0gcXVlcnlDb25zdHJhaW50cyAtIE9wdGlvbmFsLiBUaGUgbGlzdCBvZlxuICoge0BsaW5rIFF1ZXJ5RmlsdGVyQ29uc3RyYWludH1zIHRvIHBlcmZvcm0gYSBjb25qdW5jdGlvbiBmb3IuIFRoZXNlIG11c3QgYmVcbiAqIGNyZWF0ZWQgd2l0aCBjYWxscyB0byB7QGxpbmsgd2hlcmV9LCB7QGxpbmsgb3J9LCBvciB7QGxpbmsgYW5kfS5cbiAqIEByZXR1cm5zIFRoZSBuZXdseSBjcmVhdGVkIHtAbGluayBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIGFuZCguLi5lKSB7XG4gICAgLy8gT25seSBzdXBwb3J0IFF1ZXJ5RmlsdGVyQ29uc3RyYWludHNcbiAgICByZXR1cm4gZS5mb3JFYWNoKChlID0+IF9fUFJJVkFURV92YWxpZGF0ZVF1ZXJ5RmlsdGVyQ29uc3RyYWludChcImFuZFwiLCBlKSkpLCBRdWVyeUNvbXBvc2l0ZUZpbHRlckNvbnN0cmFpbnQuX2NyZWF0ZShcImFuZFwiIC8qIENvbXBvc2l0ZU9wZXJhdG9yLkFORCAqLyAsIGUpO1xufVxuXG4vKipcbiAqIEEgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gc29ydCB0aGUgc2V0IG9mIGRvY3VtZW50cyByZXR1cm5lZCBieSBhXG4gKiBGaXJlc3RvcmUgcXVlcnkuIGBRdWVyeU9yZGVyQnlDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmdcbiAqIHtAbGluayBvcmRlckJ5fSBhbmQgY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayAocXVlcnk6MSl9IHRvIGNyZWF0ZSBhIG5ldyBxdWVyeVxuICogaW5zdGFuY2UgdGhhdCBhbHNvIGNvbnRhaW5zIHRoaXMgYFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnRgLlxuICpcbiAqIE5vdGU6IERvY3VtZW50cyB0aGF0IGRvIG5vdCBjb250YWluIHRoZSBvcmRlckJ5IGZpZWxkIHdpbGwgbm90IGJlIHByZXNlbnQgaW5cbiAqIHRoZSBxdWVyeSByZXN1bHQuXG4gKi8gY2xhc3MgUXVlcnlPcmRlckJ5Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgLyoqXG4gICAgICogQGludGVybmFsXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZSwgdCkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLl9maWVsZCA9IGUsIHRoaXMuX2RpcmVjdGlvbiA9IHQsIFxuICAgICAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgICAgIHRoaXMudHlwZSA9IFwib3JkZXJCeVwiO1xuICAgIH1cbiAgICBzdGF0aWMgX2NyZWF0ZShlLCB0KSB7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlPcmRlckJ5Q29uc3RyYWludChlLCB0KTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IGZ1bmN0aW9uIF9fUFJJVkFURV9uZXdRdWVyeU9yZGVyQnkoZSwgdCwgbikge1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IGUuc3RhcnRBdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBzdGFydEF0KCkgb3Igc3RhcnRBZnRlcigpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICBpZiAobnVsbCAhPT0gZS5lbmRBdCkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJJbnZhbGlkIHF1ZXJ5LiBZb3UgbXVzdCBub3QgY2FsbCBlbmRBdCgpIG9yIGVuZEJlZm9yZSgpIGJlZm9yZSBjYWxsaW5nIG9yZGVyQnkoKS5cIik7XG4gICAgICAgICAgICBjb25zdCByID0gbmV3IE9yZGVyQnkodCwgbik7XG4gICAgICAgICAgICByZXR1cm4gcjtcbiAgICAgICAgfVxuICAgICAgICAvKipcbiAqIENyZWF0ZSBhIGBCb3VuZGAgZnJvbSBhIHF1ZXJ5IGFuZCBhIGRvY3VtZW50LlxuICpcbiAqIE5vdGUgdGhhdCB0aGUgYEJvdW5kYCB3aWxsIGFsd2F5cyBpbmNsdWRlIHRoZSBrZXkgb2YgdGhlIGRvY3VtZW50XG4gKiBhbmQgc28gb25seSB0aGUgcHJvdmlkZWQgZG9jdW1lbnQgd2lsbCBjb21wYXJlIGVxdWFsIHRvIHRoZSByZXR1cm5lZFxuICogcG9zaXRpb24uXG4gKlxuICogV2lsbCB0aHJvdyBpZiB0aGUgZG9jdW1lbnQgZG9lcyBub3QgY29udGFpbiBhbGwgZmllbGRzIG9mIHRoZSBvcmRlciBieVxuICogb2YgdGhlIHF1ZXJ5IG9yIGlmIGFueSBvZiB0aGUgZmllbGRzIGluIHRoZSBvcmRlciBieSBhcmUgYW4gdW5jb21taXR0ZWRcbiAqIHNlcnZlciB0aW1lc3RhbXAuXG4gKi8gKGUuX3F1ZXJ5LCB0aGlzLl9maWVsZCwgdGhpcy5fZGlyZWN0aW9uKTtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeShlLmZpcmVzdG9yZSwgZS5jb252ZXJ0ZXIsIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhBZGRlZE9yZGVyQnkoZSwgdCkge1xuICAgICAgICAgICAgLy8gVE9ETyhkaW1vbmQpOiB2YWxpZGF0ZSB0aGF0IG9yZGVyQnkgZG9lcyBub3QgbGlzdCB0aGUgc2FtZSBrZXkgdHdpY2UuXG4gICAgICAgICAgICBjb25zdCBuID0gZS5leHBsaWNpdE9yZGVyQnkuY29uY2F0KFsgdCBdKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCBuLCBlLmZpbHRlcnMuc2xpY2UoKSwgZS5saW1pdCwgZS5saW1pdFR5cGUsIGUuc3RhcnRBdCwgZS5lbmRBdCk7XG4gICAgICAgIH0oZS5fcXVlcnksIHQpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIHtAbGluayBRdWVyeU9yZGVyQnlDb25zdHJhaW50fSB0aGF0IHNvcnRzIHRoZSBxdWVyeSByZXN1bHQgYnkgdGhlXG4gKiBzcGVjaWZpZWQgZmllbGQsIG9wdGlvbmFsbHkgaW4gZGVzY2VuZGluZyBvcmRlciBpbnN0ZWFkIG9mIGFzY2VuZGluZy5cbiAqXG4gKiBOb3RlOiBEb2N1bWVudHMgdGhhdCBkbyBub3QgY29udGFpbiB0aGUgc3BlY2lmaWVkIGZpZWxkIHdpbGwgbm90IGJlIHByZXNlbnRcbiAqIGluIHRoZSBxdWVyeSByZXN1bHQuXG4gKlxuICogQHBhcmFtIGZpZWxkUGF0aCAtIFRoZSBmaWVsZCB0byBzb3J0IGJ5LlxuICogQHBhcmFtIGRpcmVjdGlvblN0ciAtIE9wdGlvbmFsIGRpcmVjdGlvbiB0byBzb3J0IGJ5ICgnYXNjJyBvciAnZGVzYycpLiBJZlxuICogbm90IHNwZWNpZmllZCwgb3JkZXIgd2lsbCBiZSBhc2NlbmRpbmcuXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlPcmRlckJ5Q29uc3RyYWludH0uXG4gKi8gZnVuY3Rpb24gb3JkZXJCeShlLCB0ID0gXCJhc2NcIikge1xuICAgIGNvbnN0IG4gPSB0LCByID0gX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudChcIm9yZGVyQnlcIiwgZSk7XG4gICAgcmV0dXJuIFF1ZXJ5T3JkZXJCeUNvbnN0cmFpbnQuX2NyZWF0ZShyLCBuKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUxpbWl0Q29uc3RyYWludGAgaXMgdXNlZCB0byBsaW1pdCB0aGUgbnVtYmVyIG9mIGRvY3VtZW50cyByZXR1cm5lZCBieVxuICogYSBGaXJlc3RvcmUgcXVlcnkuXG4gKiBgUXVlcnlMaW1pdENvbnN0cmFpbnRgcyBhcmUgY3JlYXRlZCBieSBpbnZva2luZyB7QGxpbmsgbGltaXR9IG9yXG4gKiB7QGxpbmsgbGltaXRUb0xhc3R9IGFuZCBjYW4gdGhlbiBiZSBwYXNzZWQgdG8ge0BsaW5rIChxdWVyeToxKX0gdG8gY3JlYXRlIGEgbmV3XG4gKiBxdWVyeSBpbnN0YW5jZSB0aGF0IGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlMaW1pdENvbnN0cmFpbnRgLlxuICovIGNsYXNzIFF1ZXJ5TGltaXRDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgZSwgdCwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnR5cGUgPSBlLCB0aGlzLl9saW1pdCA9IHQsIHRoaXMuX2xpbWl0VHlwZSA9IG47XG4gICAgfVxuICAgIHN0YXRpYyBfY3JlYXRlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUxpbWl0Q29uc3RyYWludChlLCB0LCBuKTtcbiAgICB9XG4gICAgX2FwcGx5KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeShlLmZpcmVzdG9yZSwgZS5jb252ZXJ0ZXIsIF9fUFJJVkFURV9xdWVyeVdpdGhMaW1pdChlLl9xdWVyeSwgdGhpcy5fbGltaXQsIHRoaXMuX2xpbWl0VHlwZSkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEge0BsaW5rIFF1ZXJ5TGltaXRDb25zdHJhaW50fSB0aGF0IG9ubHkgcmV0dXJucyB0aGUgZmlyc3QgbWF0Y2hpbmdcbiAqIGRvY3VtZW50cy5cbiAqXG4gKiBAcGFyYW0gbGltaXQgLSBUaGUgbWF4aW11bSBudW1iZXIgb2YgaXRlbXMgdG8gcmV0dXJuLlxuICogQHJldHVybnMgVGhlIGNyZWF0ZWQge0BsaW5rIFF1ZXJ5TGltaXRDb25zdHJhaW50fS5cbiAqLyBmdW5jdGlvbiBsaW1pdChlKSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV92YWxpZGF0ZVBvc2l0aXZlTnVtYmVyKFwibGltaXRcIiwgZSksIFF1ZXJ5TGltaXRDb25zdHJhaW50Ll9jcmVhdGUoXCJsaW1pdFwiLCBlLCBcIkZcIiAvKiBMaW1pdFR5cGUuRmlyc3QgKi8pO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYSB7QGxpbmsgUXVlcnlMaW1pdENvbnN0cmFpbnR9IHRoYXQgb25seSByZXR1cm5zIHRoZSBsYXN0IG1hdGNoaW5nXG4gKiBkb2N1bWVudHMuXG4gKlxuICogWW91IG11c3Qgc3BlY2lmeSBhdCBsZWFzdCBvbmUgYG9yZGVyQnlgIGNsYXVzZSBmb3IgYGxpbWl0VG9MYXN0YCBxdWVyaWVzLFxuICogb3RoZXJ3aXNlIGFuIGV4Y2VwdGlvbiB3aWxsIGJlIHRocm93biBkdXJpbmcgZXhlY3V0aW9uLlxuICpcbiAqIEBwYXJhbSBsaW1pdCAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBpdGVtcyB0byByZXR1cm4uXG4gKiBAcmV0dXJucyBUaGUgY3JlYXRlZCB7QGxpbmsgUXVlcnlMaW1pdENvbnN0cmFpbnR9LlxuICovIGZ1bmN0aW9uIGxpbWl0VG9MYXN0KGUpIHtcbiAgICByZXR1cm4gX19QUklWQVRFX3ZhbGlkYXRlUG9zaXRpdmVOdW1iZXIoXCJsaW1pdFRvTGFzdFwiLCBlKSwgUXVlcnlMaW1pdENvbnN0cmFpbnQuX2NyZWF0ZShcImxpbWl0VG9MYXN0XCIsIGUsIFwiTFwiIC8qIExpbWl0VHlwZS5MYXN0ICovKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeVN0YXJ0QXRDb25zdHJhaW50YCBpcyB1c2VkIHRvIGV4Y2x1ZGUgZG9jdW1lbnRzIGZyb20gdGhlIHN0YXJ0IG9mIGFcbiAqIHJlc3VsdCBzZXQgcmV0dXJuZWQgYnkgYSBGaXJlc3RvcmUgcXVlcnkuXG4gKiBgUXVlcnlTdGFydEF0Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayAoc3RhcnRBdDoxKX0gb3JcbiAqIHtAbGluayAoc3RhcnRBZnRlcjoxKX0gYW5kIGNhbiB0aGVuIGJlIHBhc3NlZCB0byB7QGxpbmsgKHF1ZXJ5OjEpfSB0byBjcmVhdGUgYVxuICogbmV3IHF1ZXJ5IGluc3RhbmNlIHRoYXQgYWxzbyBjb250YWlucyB0aGlzIGBRdWVyeVN0YXJ0QXRDb25zdHJhaW50YC5cbiAqLyBjbGFzcyBRdWVyeVN0YXJ0QXRDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogVGhlIHR5cGUgb2YgdGhpcyBxdWVyeSBjb25zdHJhaW50ICovXG4gICAgZSwgdCwgbikge1xuICAgICAgICBzdXBlcigpLCB0aGlzLnR5cGUgPSBlLCB0aGlzLl9kb2NPckZpZWxkcyA9IHQsIHRoaXMuX2luY2x1c2l2ZSA9IG47XG4gICAgfVxuICAgIHN0YXRpYyBfY3JlYXRlKGUsIHQsIG4pIHtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeVN0YXJ0QXRDb25zdHJhaW50KGUsIHQsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld1F1ZXJ5Qm91bmRGcm9tRG9jT3JGaWVsZHMoZSwgdGhpcy50eXBlLCB0aGlzLl9kb2NPckZpZWxkcywgdGhpcy5faW5jbHVzaXZlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeShlLmZpcmVzdG9yZSwgZS5jb252ZXJ0ZXIsIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhTdGFydEF0KGUsIHQpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgX19QUklWQVRFX1F1ZXJ5SW1wbChlLnBhdGgsIGUuY29sbGVjdGlvbkdyb3VwLCBlLmV4cGxpY2l0T3JkZXJCeS5zbGljZSgpLCBlLmZpbHRlcnMuc2xpY2UoKSwgZS5saW1pdCwgZS5saW1pdFR5cGUsIHQsIGUuZW5kQXQpO1xuICAgICAgICB9KGUuX3F1ZXJ5LCB0KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzdGFydEF0KC4uLmUpIHtcbiAgICByZXR1cm4gUXVlcnlTdGFydEF0Q29uc3RyYWludC5fY3JlYXRlKFwic3RhcnRBdFwiLCBlLCBcbiAgICAvKmluY2x1c2l2ZT0qLyAhMCk7XG59XG5cbmZ1bmN0aW9uIHN0YXJ0QWZ0ZXIoLi4uZSkge1xuICAgIHJldHVybiBRdWVyeVN0YXJ0QXRDb25zdHJhaW50Ll9jcmVhdGUoXCJzdGFydEFmdGVyXCIsIGUsIFxuICAgIC8qaW5jbHVzaXZlPSovICExKTtcbn1cblxuLyoqXG4gKiBBIGBRdWVyeUVuZEF0Q29uc3RyYWludGAgaXMgdXNlZCB0byBleGNsdWRlIGRvY3VtZW50cyBmcm9tIHRoZSBlbmQgb2YgYVxuICogcmVzdWx0IHNldCByZXR1cm5lZCBieSBhIEZpcmVzdG9yZSBxdWVyeS5cbiAqIGBRdWVyeUVuZEF0Q29uc3RyYWludGBzIGFyZSBjcmVhdGVkIGJ5IGludm9raW5nIHtAbGluayAoZW5kQXQ6MSl9IG9yXG4gKiB7QGxpbmsgKGVuZEJlZm9yZToxKX0gYW5kIGNhbiB0aGVuIGJlIHBhc3NlZCB0byB7QGxpbmsgKHF1ZXJ5OjEpfSB0byBjcmVhdGUgYSBuZXdcbiAqIHF1ZXJ5IGluc3RhbmNlIHRoYXQgYWxzbyBjb250YWlucyB0aGlzIGBRdWVyeUVuZEF0Q29uc3RyYWludGAuXG4gKi8gY2xhc3MgUXVlcnlFbmRBdENvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBUaGUgdHlwZSBvZiB0aGlzIHF1ZXJ5IGNvbnN0cmFpbnQgKi9cbiAgICBlLCB0LCBuKSB7XG4gICAgICAgIHN1cGVyKCksIHRoaXMudHlwZSA9IGUsIHRoaXMuX2RvY09yRmllbGRzID0gdCwgdGhpcy5faW5jbHVzaXZlID0gbjtcbiAgICB9XG4gICAgc3RhdGljIF9jcmVhdGUoZSwgdCwgbikge1xuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5RW5kQXRDb25zdHJhaW50KGUsIHQsIG4pO1xuICAgIH1cbiAgICBfYXBwbHkoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX25ld1F1ZXJ5Qm91bmRGcm9tRG9jT3JGaWVsZHMoZSwgdGhpcy50eXBlLCB0aGlzLl9kb2NPckZpZWxkcywgdGhpcy5faW5jbHVzaXZlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeShlLmZpcmVzdG9yZSwgZS5jb252ZXJ0ZXIsIGZ1bmN0aW9uIF9fUFJJVkFURV9xdWVyeVdpdGhFbmRBdChlLCB0KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9RdWVyeUltcGwoZS5wYXRoLCBlLmNvbGxlY3Rpb25Hcm91cCwgZS5leHBsaWNpdE9yZGVyQnkuc2xpY2UoKSwgZS5maWx0ZXJzLnNsaWNlKCksIGUubGltaXQsIGUubGltaXRUeXBlLCBlLnN0YXJ0QXQsIHQpO1xuICAgICAgICB9KGUuX3F1ZXJ5LCB0KSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBlbmRCZWZvcmUoLi4uZSkge1xuICAgIHJldHVybiBRdWVyeUVuZEF0Q29uc3RyYWludC5fY3JlYXRlKFwiZW5kQmVmb3JlXCIsIGUsIFxuICAgIC8qaW5jbHVzaXZlPSovICExKTtcbn1cblxuZnVuY3Rpb24gZW5kQXQoLi4uZSkge1xuICAgIHJldHVybiBRdWVyeUVuZEF0Q29uc3RyYWludC5fY3JlYXRlKFwiZW5kQXRcIiwgZSwgXG4gICAgLyppbmNsdXNpdmU9Ki8gITApO1xufVxuXG4vKiogSGVscGVyIGZ1bmN0aW9uIHRvIGNyZWF0ZSBhIGJvdW5kIGZyb20gYSBkb2N1bWVudCBvciBmaWVsZHMgKi8gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5Qm91bmRGcm9tRG9jT3JGaWVsZHMoZSwgdCwgbiwgcikge1xuICAgIGlmIChuWzBdID0gZ2V0TW9kdWxhckluc3RhbmNlKG5bMF0pLCBuWzBdIGluc3RhbmNlb2YgRG9jdW1lbnRTbmFwc2hvdCQxKSByZXR1cm4gZnVuY3Rpb24gX19QUklWQVRFX25ld1F1ZXJ5Qm91bmRGcm9tRG9jdW1lbnQoZSwgdCwgbiwgciwgaSkge1xuICAgICAgICBpZiAoIXIpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLk5PVF9GT1VORCwgYENhbid0IHVzZSBhIERvY3VtZW50U25hcHNob3QgdGhhdCBkb2Vzbid0IGV4aXN0IGZvciAke259KCkuYCk7XG4gICAgICAgIGNvbnN0IHMgPSBbXTtcbiAgICAgICAgLy8gQmVjYXVzZSBwZW9wbGUgZXhwZWN0IHRvIGNvbnRpbnVlL2VuZCBhIHF1ZXJ5IGF0IHRoZSBleGFjdCBkb2N1bWVudFxuICAgICAgICAvLyBwcm92aWRlZCwgd2UgbmVlZCB0byB1c2UgdGhlIGltcGxpY2l0IHNvcnQgb3JkZXIgcmF0aGVyIHRoYW4gdGhlIGV4cGxpY2l0XG4gICAgICAgIC8vIHNvcnQgb3JkZXIsIGJlY2F1c2UgaXQncyBndWFyYW50ZWVkIHRvIGNvbnRhaW4gdGhlIGRvY3VtZW50IGtleS4gVGhhdCB3YXlcbiAgICAgICAgLy8gdGhlIHBvc2l0aW9uIGJlY29tZXMgdW5hbWJpZ3VvdXMgYW5kIHRoZSBxdWVyeSBjb250aW51ZXMvZW5kcyBleGFjdGx5IGF0XG4gICAgICAgIC8vIHRoZSBwcm92aWRlZCBkb2N1bWVudC4gV2l0aG91dCB0aGUga2V5IChieSB1c2luZyB0aGUgZXhwbGljaXQgc29ydFxuICAgICAgICAvLyBvcmRlcnMpLCBtdWx0aXBsZSBkb2N1bWVudHMgY291bGQgbWF0Y2ggdGhlIHBvc2l0aW9uLCB5aWVsZGluZyBkdXBsaWNhdGVcbiAgICAgICAgLy8gcmVzdWx0cy5cbiAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IG4gb2YgX19QUklWQVRFX3F1ZXJ5Tm9ybWFsaXplZE9yZGVyQnkoZSkpIGlmIChuLmZpZWxkLmlzS2V5RmllbGQoKSkgcy5wdXNoKF9fUFJJVkFURV9yZWZWYWx1ZSh0LCByLmtleSkpOyBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGUgPSByLmRhdGEuZmllbGQobi5maWVsZCk7XG4gICAgICAgICAgICBpZiAoX19QUklWQVRFX2lzU2VydmVyVGltZXN0YW1wKGUpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCAnSW52YWxpZCBxdWVyeS4gWW91IGFyZSB0cnlpbmcgdG8gc3RhcnQgb3IgZW5kIGEgcXVlcnkgdXNpbmcgYSBkb2N1bWVudCBmb3Igd2hpY2ggdGhlIGZpZWxkIFwiJyArIG4uZmllbGQgKyAnXCIgaXMgYW4gdW5jb21taXR0ZWQgc2VydmVyIHRpbWVzdGFtcC4gKFNpbmNlIHRoZSB2YWx1ZSBvZiB0aGlzIGZpZWxkIGlzIHVua25vd24sIHlvdSBjYW5ub3Qgc3RhcnQvZW5kIGEgcXVlcnkgd2l0aCBpdC4pJyk7XG4gICAgICAgICAgICBpZiAobnVsbCA9PT0gZSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBuLmZpZWxkLmNhbm9uaWNhbFN0cmluZygpO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBZb3UgYXJlIHRyeWluZyB0byBzdGFydCBvciBlbmQgYSBxdWVyeSB1c2luZyBhIGRvY3VtZW50IGZvciB3aGljaCB0aGUgZmllbGQgJyR7ZX0nICh1c2VkIGFzIHRoZSBvcmRlckJ5KSBkb2VzIG5vdCBleGlzdC5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHMucHVzaChlKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IEJvdW5kKHMsIGkpO1xuICAgIH1cbiAgICAvKipcbiAqIENvbnZlcnRzIGEgbGlzdCBvZiBmaWVsZCB2YWx1ZXMgdG8gYSBgQm91bmRgIGZvciB0aGUgZ2l2ZW4gcXVlcnkuXG4gKi8gKGUuX3F1ZXJ5LCBlLmZpcmVzdG9yZS5fZGF0YWJhc2VJZCwgdCwgblswXS5fZG9jdW1lbnQsIHIpO1xuICAgIHtcbiAgICAgICAgY29uc3QgaSA9IF9fUFJJVkFURV9uZXdVc2VyRGF0YVJlYWRlcihlLmZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfbmV3UXVlcnlCb3VuZEZyb21GaWVsZHMoZSwgdCwgbiwgciwgaSwgcykge1xuICAgICAgICAgICAgLy8gVXNlIGV4cGxpY2l0IG9yZGVyIGJ5J3MgYmVjYXVzZSBpdCBoYXMgdG8gbWF0Y2ggdGhlIHF1ZXJ5IHRoZSB1c2VyIG1hZGVcbiAgICAgICAgICAgIGNvbnN0IG8gPSBlLmV4cGxpY2l0T3JkZXJCeTtcbiAgICAgICAgICAgIGlmIChpLmxlbmd0aCA+IG8ubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgVG9vIG1hbnkgYXJndW1lbnRzIHByb3ZpZGVkIHRvICR7cn0oKS4gVGhlIG51bWJlciBvZiBhcmd1bWVudHMgbXVzdCBiZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gdGhlIG51bWJlciBvZiBvcmRlckJ5KCkgY2xhdXNlc2ApO1xuICAgICAgICAgICAgY29uc3QgXyA9IFtdO1xuICAgICAgICAgICAgZm9yIChsZXQgcyA9IDA7IHMgPCBpLmxlbmd0aDsgcysrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IGlbc107XG4gICAgICAgICAgICAgICAgaWYgKG9bc10uZmllbGQuaXNLZXlGaWVsZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChcInN0cmluZ1wiICE9IHR5cGVvZiBhKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gRXhwZWN0ZWQgYSBzdHJpbmcgZm9yIGRvY3VtZW50IElEIGluICR7cn0oKSwgYnV0IGdvdCBhICR7dHlwZW9mIGF9YCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghX19QUklWQVRFX2lzQ29sbGVjdGlvbkdyb3VwUXVlcnkoZSkgJiYgLTEgIT09IGEuaW5kZXhPZihcIi9cIikpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIGEgY29sbGVjdGlvbiBhbmQgb3JkZXJpbmcgYnkgZG9jdW1lbnRJZCgpLCB0aGUgdmFsdWUgcGFzc2VkIHRvICR7cn0oKSBtdXN0IGJlIGEgcGxhaW4gZG9jdW1lbnQgSUQsIGJ1dCAnJHthfScgY29udGFpbnMgYSBzbGFzaC5gKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbiA9IGUucGF0aC5jaGlsZChSZXNvdXJjZVBhdGguZnJvbVN0cmluZyhhKSk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghRG9jdW1lbnRLZXkuaXNEb2N1bWVudEtleShuKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgYEludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgYSBjb2xsZWN0aW9uIGdyb3VwIGFuZCBvcmRlcmluZyBieSBkb2N1bWVudElkKCksIHRoZSB2YWx1ZSBwYXNzZWQgdG8gJHtyfSgpIG11c3QgcmVzdWx0IGluIGEgdmFsaWQgZG9jdW1lbnQgcGF0aCwgYnV0ICcke259JyBpcyBub3QgYmVjYXVzZSBpdCBjb250YWlucyBhbiBvZGQgbnVtYmVyIG9mIHNlZ21lbnRzLmApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBpID0gbmV3IERvY3VtZW50S2V5KG4pO1xuICAgICAgICAgICAgICAgICAgICBfLnB1c2goX19QUklWQVRFX3JlZlZhbHVlKHQsIGkpKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBlID0gX19QUklWQVRFX3BhcnNlUXVlcnlWYWx1ZShuLCByLCBhKTtcbiAgICAgICAgICAgICAgICAgICAgXy5wdXNoKGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBuZXcgQm91bmQoXywgcyk7XG4gICAgICAgIH1cbiAgICAgICAgLyoqXG4gKiBQYXJzZXMgdGhlIGdpdmVuIGBkb2N1bWVudElkVmFsdWVgIGludG8gYSBgUmVmZXJlbmNlVmFsdWVgLCB0aHJvd2luZ1xuICogYXBwcm9wcmlhdGUgZXJyb3JzIGlmIHRoZSB2YWx1ZSBpcyBhbnl0aGluZyBvdGhlciB0aGFuIGEgYERvY3VtZW50UmVmZXJlbmNlYFxuICogb3IgYHN0cmluZ2AsIG9yIGlmIHRoZSBzdHJpbmcgaXMgbWFsZm9ybWVkLlxuICovIChlLl9xdWVyeSwgZS5maXJlc3RvcmUuX2RhdGFiYXNlSWQsIGksIHQsIG4sIHIpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3BhcnNlRG9jdW1lbnRJZFZhbHVlKGUsIHQsIG4pIHtcbiAgICBpZiAoXCJzdHJpbmdcIiA9PSB0eXBlb2YgKG4gPSBnZXRNb2R1bGFySW5zdGFuY2UobikpKSB7XG4gICAgICAgIGlmIChcIlwiID09PSBuKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIkludmFsaWQgcXVlcnkuIFdoZW4gcXVlcnlpbmcgd2l0aCBkb2N1bWVudElkKCksIHlvdSBtdXN0IHByb3ZpZGUgYSB2YWxpZCBkb2N1bWVudCBJRCwgYnV0IGl0IHdhcyBhbiBlbXB0eSBzdHJpbmcuXCIpO1xuICAgICAgICBpZiAoIV9fUFJJVkFURV9pc0NvbGxlY3Rpb25Hcm91cFF1ZXJ5KHQpICYmIC0xICE9PSBuLmluZGV4T2YoXCIvXCIpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyBhIGNvbGxlY3Rpb24gYnkgZG9jdW1lbnRJZCgpLCB5b3UgbXVzdCBwcm92aWRlIGEgcGxhaW4gZG9jdW1lbnQgSUQsIGJ1dCAnJHtufScgY29udGFpbnMgYSAnLycgY2hhcmFjdGVyLmApO1xuICAgICAgICBjb25zdCByID0gdC5wYXRoLmNoaWxkKFJlc291cmNlUGF0aC5mcm9tU3RyaW5nKG4pKTtcbiAgICAgICAgaWYgKCFEb2N1bWVudEtleS5pc0RvY3VtZW50S2V5KHIpKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBxdWVyeS4gV2hlbiBxdWVyeWluZyBhIGNvbGxlY3Rpb24gZ3JvdXAgYnkgZG9jdW1lbnRJZCgpLCB0aGUgdmFsdWUgcHJvdmlkZWQgbXVzdCByZXN1bHQgaW4gYSB2YWxpZCBkb2N1bWVudCBwYXRoLCBidXQgJyR7cn0nIGlzIG5vdCBiZWNhdXNlIGl0IGhhcyBhbiBvZGQgbnVtYmVyIG9mIHNlZ21lbnRzICgke3IubGVuZ3RofSkuYCk7XG4gICAgICAgIHJldHVybiBfX1BSSVZBVEVfcmVmVmFsdWUoZSwgbmV3IERvY3VtZW50S2V5KHIpKTtcbiAgICB9XG4gICAgaWYgKG4gaW5zdGFuY2VvZiBEb2N1bWVudFJlZmVyZW5jZSkgcmV0dXJuIF9fUFJJVkFURV9yZWZWYWx1ZShlLCBuLl9rZXkpO1xuICAgIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBXaGVuIHF1ZXJ5aW5nIHdpdGggZG9jdW1lbnRJZCgpLCB5b3UgbXVzdCBwcm92aWRlIGEgdmFsaWQgc3RyaW5nIG9yIGEgRG9jdW1lbnRSZWZlcmVuY2UsIGJ1dCBpdCB3YXM6ICR7X19QUklWQVRFX3ZhbHVlRGVzY3JpcHRpb24obil9LmApO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlcyB0aGF0IHRoZSB2YWx1ZSBwYXNzZWQgaW50byBhIGRpc2p1bmN0aXZlIGZpbHRlciBzYXRpc2ZpZXMgYWxsXG4gKiBhcnJheSByZXF1aXJlbWVudHMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlRGlzanVuY3RpdmVGaWx0ZXJFbGVtZW50cyhlLCB0KSB7XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGUpIHx8IDAgPT09IGUubGVuZ3RoKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBgSW52YWxpZCBRdWVyeS4gQSBub24tZW1wdHkgYXJyYXkgaXMgcmVxdWlyZWQgZm9yICcke3QudG9TdHJpbmcoKX0nIGZpbHRlcnMuYCk7XG59XG5cbi8qKlxuICogR2l2ZW4gYW4gb3BlcmF0b3IsIHJldHVybnMgdGhlIHNldCBvZiBvcGVyYXRvcnMgdGhhdCBjYW5ub3QgYmUgdXNlZCB3aXRoIGl0LlxuICpcbiAqIFRoaXMgaXMgbm90IGEgY29tcHJlaGVuc2l2ZSBjaGVjaywgYW5kIHRoaXMgZnVuY3Rpb24gc2hvdWxkIGJlIHJlbW92ZWQgaW4gdGhlXG4gKiBsb25nIHRlcm0uIFZhbGlkYXRpb25zIHNob3VsZCBvY2N1ciBpbiB0aGUgRmlyZXN0b3JlIGJhY2tlbmQuXG4gKlxuICogT3BlcmF0b3JzIGluIGEgcXVlcnkgbXVzdCBhZGhlcmUgdG8gdGhlIGZvbGxvd2luZyBzZXQgb2YgcnVsZXM6XG4gKiAxLiBPbmx5IG9uZSBpbmVxdWFsaXR5IHBlciBxdWVyeS5cbiAqIDIuIGBOT1RfSU5gIGNhbm5vdCBiZSB1c2VkIHdpdGggYXJyYXksIGRpc2p1bmN0aXZlLCBvciBgTk9UX0VRVUFMYCBvcGVyYXRvcnMuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlTmV3RmllbGRGaWx0ZXIoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBmdW5jdGlvbiBfX1BSSVZBVEVfZmluZE9wSW5zaWRlRmlsdGVycyhlLCB0KSB7XG4gICAgICAgIGZvciAoY29uc3QgbiBvZiBlKSBmb3IgKGNvbnN0IGUgb2Ygbi5nZXRGbGF0dGVuZWRGaWx0ZXJzKCkpIGlmICh0LmluZGV4T2YoZS5vcCkgPj0gMCkgcmV0dXJuIGUub3A7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH0oZS5maWx0ZXJzLCBmdW5jdGlvbiBfX1BSSVZBVEVfY29uZmxpY3RpbmdPcHMoZSkge1xuICAgICAgICBzd2l0Y2ggKGUpIHtcbiAgICAgICAgICBjYXNlIFwiIT1cIiAvKiBPcGVyYXRvci5OT1RfRVFVQUwgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIFsgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyAsIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovIF07XG5cbiAgICAgICAgICBjYXNlIFwiYXJyYXktY29udGFpbnMtYW55XCIgLyogT3BlcmF0b3IuQVJSQVlfQ09OVEFJTlNfQU5ZICovIDpcbiAgICAgICAgICBjYXNlIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gWyBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyBdO1xuXG4gICAgICAgICAgY2FzZSBcIm5vdC1pblwiIC8qIE9wZXJhdG9yLk5PVF9JTiAqLyA6XG4gICAgICAgICAgICByZXR1cm4gWyBcImFycmF5LWNvbnRhaW5zLWFueVwiIC8qIE9wZXJhdG9yLkFSUkFZX0NPTlRBSU5TX0FOWSAqLyAsIFwiaW5cIiAvKiBPcGVyYXRvci5JTiAqLyAsIFwibm90LWluXCIgLyogT3BlcmF0b3IuTk9UX0lOICovICwgXCIhPVwiIC8qIE9wZXJhdG9yLk5PVF9FUVVBTCAqLyBdO1xuXG4gICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgIH0odC5vcCkpO1xuICAgIGlmIChudWxsICE9PSBuKSBcbiAgICAvLyBTcGVjaWFsIGNhc2Ugd2hlbiBpdCdzIGEgZHVwbGljYXRlIG9wIHRvIGdpdmUgYSBzbGlnaHRseSBjbGVhcmVyIGVycm9yIG1lc3NhZ2UuXG4gICAgdGhyb3cgbiA9PT0gdC5vcCA/IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBZb3UgY2Fubm90IHVzZSBtb3JlIHRoYW4gb25lICcke3Qub3AudG9TdHJpbmcoKX0nIGZpbHRlci5gKSA6IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBJbnZhbGlkIHF1ZXJ5LiBZb3UgY2Fubm90IHVzZSAnJHt0Lm9wLnRvU3RyaW5nKCl9JyBmaWx0ZXJzIHdpdGggJyR7bi50b1N0cmluZygpfScgZmlsdGVycy5gKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3ZhbGlkYXRlUXVlcnlGaWx0ZXJDb25zdHJhaW50KGUsIHQpIHtcbiAgICBpZiAoISh0IGluc3RhbmNlb2YgUXVlcnlGaWVsZEZpbHRlckNvbnN0cmFpbnQgfHwgdCBpbnN0YW5jZW9mIFF1ZXJ5Q29tcG9zaXRlRmlsdGVyQ29uc3RyYWludCkpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIGBGdW5jdGlvbiAke2V9KCkgcmVxdWlyZXMgQXBwbGlhYmxlQ29uc3RyYWludHMgY3JlYXRlZCB3aXRoIGEgY2FsbCB0byAnd2hlcmUoLi4uKScsICdvciguLi4pJywgb3IgJ2FuZCguLi4pJy5gKTtcbn1cblxuY2xhc3MgQWJzdHJhY3RVc2VyRGF0YVdyaXRlciB7XG4gICAgY29udmVydFZhbHVlKGUsIHQgPSBcIm5vbmVcIikge1xuICAgICAgICBzd2l0Y2ggKF9fUFJJVkFURV90eXBlT3JkZXIoZSkpIHtcbiAgICAgICAgICBjYXNlIDAgLyogVHlwZU9yZGVyLk51bGxWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcblxuICAgICAgICAgIGNhc2UgMSAvKiBUeXBlT3JkZXIuQm9vbGVhblZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiBlLmJvb2xlYW5WYWx1ZTtcblxuICAgICAgICAgIGNhc2UgMiAvKiBUeXBlT3JkZXIuTnVtYmVyVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5pbnRlZ2VyVmFsdWUgfHwgZS5kb3VibGVWYWx1ZSk7XG5cbiAgICAgICAgICBjYXNlIDMgLyogVHlwZU9yZGVyLlRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRUaW1lc3RhbXAoZS50aW1lc3RhbXBWYWx1ZSk7XG5cbiAgICAgICAgICBjYXNlIDQgLyogVHlwZU9yZGVyLlNlcnZlclRpbWVzdGFtcFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRTZXJ2ZXJUaW1lc3RhbXAoZSwgdCk7XG5cbiAgICAgICAgICBjYXNlIDUgLyogVHlwZU9yZGVyLlN0cmluZ1ZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiBlLnN0cmluZ1ZhbHVlO1xuXG4gICAgICAgICAgY2FzZSA2IC8qIFR5cGVPcmRlci5CbG9iVmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydEJ5dGVzKF9fUFJJVkFURV9ub3JtYWxpemVCeXRlU3RyaW5nKGUuYnl0ZXNWYWx1ZSkpO1xuXG4gICAgICAgICAgY2FzZSA3IC8qIFR5cGVPcmRlci5SZWZWYWx1ZSAqLyA6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0UmVmZXJlbmNlKGUucmVmZXJlbmNlVmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSA4IC8qIFR5cGVPcmRlci5HZW9Qb2ludFZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRHZW9Qb2ludChlLmdlb1BvaW50VmFsdWUpO1xuXG4gICAgICAgICAgY2FzZSA5IC8qIFR5cGVPcmRlci5BcnJheVZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRBcnJheShlLmFycmF5VmFsdWUsIHQpO1xuXG4gICAgICAgICAgY2FzZSAxMSAvKiBUeXBlT3JkZXIuT2JqZWN0VmFsdWUgKi8gOlxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY29udmVydE9iamVjdChlLm1hcFZhbHVlLCB0KTtcblxuICAgICAgICAgIGNhc2UgMTAgLyogVHlwZU9yZGVyLlZlY3RvclZhbHVlICovIDpcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRWZWN0b3JWYWx1ZShlLm1hcFZhbHVlKTtcblxuICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICB0aHJvdyBmYWlsKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udmVydE9iamVjdChlLCB0KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNvbnZlcnRPYmplY3RNYXAoZS5maWVsZHMsIHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi8gICAgY29udmVydE9iamVjdE1hcChlLCB0ID0gXCJub25lXCIpIHtcbiAgICAgICAgY29uc3QgbiA9IHt9O1xuICAgICAgICByZXR1cm4gZm9yRWFjaChlLCAoKGUsIHIpID0+IHtcbiAgICAgICAgICAgIG5bZV0gPSB0aGlzLmNvbnZlcnRWYWx1ZShyLCB0KTtcbiAgICAgICAgfSkpLCBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi8gICAgY29udmVydFZlY3RvclZhbHVlKGUpIHtcbiAgICAgICAgdmFyIHQsIG4sIHI7XG4gICAgICAgIGNvbnN0IGkgPSBudWxsID09PSAociA9IG51bGwgPT09IChuID0gbnVsbCA9PT0gKHQgPSBlLmZpZWxkcykgfHwgdm9pZCAwID09PSB0ID8gdm9pZCAwIDogdFthdF0uYXJyYXlWYWx1ZSkgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi52YWx1ZXMpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIubWFwKChlID0+IF9fUFJJVkFURV9ub3JtYWxpemVOdW1iZXIoZS5kb3VibGVWYWx1ZSkpKTtcbiAgICAgICAgcmV0dXJuIG5ldyBWZWN0b3JWYWx1ZShpKTtcbiAgICB9XG4gICAgY29udmVydEdlb1BvaW50KGUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBHZW9Qb2ludChfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubGF0aXR1ZGUpLCBfX1BSSVZBVEVfbm9ybWFsaXplTnVtYmVyKGUubG9uZ2l0dWRlKSk7XG4gICAgfVxuICAgIGNvbnZlcnRBcnJheShlLCB0KSB7XG4gICAgICAgIHJldHVybiAoZS52YWx1ZXMgfHwgW10pLm1hcCgoZSA9PiB0aGlzLmNvbnZlcnRWYWx1ZShlLCB0KSkpO1xuICAgIH1cbiAgICBjb252ZXJ0U2VydmVyVGltZXN0YW1wKGUsIHQpIHtcbiAgICAgICAgc3dpdGNoICh0KSB7XG4gICAgICAgICAgY2FzZSBcInByZXZpb3VzXCI6XG4gICAgICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2dldFByZXZpb3VzVmFsdWUoZSk7XG4gICAgICAgICAgICByZXR1cm4gbnVsbCA9PSBuID8gbnVsbCA6IHRoaXMuY29udmVydFZhbHVlKG4sIHQpO1xuXG4gICAgICAgICAgY2FzZSBcImVzdGltYXRlXCI6XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb252ZXJ0VGltZXN0YW1wKF9fUFJJVkFURV9nZXRMb2NhbFdyaXRlVGltZShlKSk7XG5cbiAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29udmVydFRpbWVzdGFtcChlKSB7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfbm9ybWFsaXplVGltZXN0YW1wKGUpO1xuICAgICAgICByZXR1cm4gbmV3IFRpbWVzdGFtcCh0LnNlY29uZHMsIHQubmFub3MpO1xuICAgIH1cbiAgICBjb252ZXJ0RG9jdW1lbnRLZXkoZSwgdCkge1xuICAgICAgICBjb25zdCBuID0gUmVzb3VyY2VQYXRoLmZyb21TdHJpbmcoZSk7XG4gICAgICAgIF9fUFJJVkFURV9oYXJkQXNzZXJ0KF9fUFJJVkFURV9pc1ZhbGlkUmVzb3VyY2VOYW1lKG4pKTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBEYXRhYmFzZUlkKG4uZ2V0KDEpLCBuLmdldCgzKSksIGkgPSBuZXcgRG9jdW1lbnRLZXkobi5wb3BGaXJzdCg1KSk7XG4gICAgICAgIHJldHVybiByLmlzRXF1YWwodCkgfHwgXG4gICAgICAgIC8vIFRPRE8oYi82NDEzMDIwMik6IFNvbWVob3cgc3VwcG9ydCBmb3JlaWduIHJlZmVyZW5jZXMuXG4gICAgICAgIF9fUFJJVkFURV9sb2dFcnJvcihgRG9jdW1lbnQgJHtpfSBjb250YWlucyBhIGRvY3VtZW50IHJlZmVyZW5jZSB3aXRoaW4gYSBkaWZmZXJlbnQgZGF0YWJhc2UgKCR7ci5wcm9qZWN0SWR9LyR7ci5kYXRhYmFzZX0pIHdoaWNoIGlzIG5vdCBzdXBwb3J0ZWQuIEl0IHdpbGwgYmUgdHJlYXRlZCBhcyBhIHJlZmVyZW5jZSBpbiB0aGUgY3VycmVudCBkYXRhYmFzZSAoJHt0LnByb2plY3RJZH0vJHt0LmRhdGFiYXNlfSkgaW5zdGVhZC5gKSwgXG4gICAgICAgIGk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDb252ZXJ0cyBjdXN0b20gbW9kZWwgb2JqZWN0IG9mIHR5cGUgVCBpbnRvIGBEb2N1bWVudERhdGFgIGJ5IGFwcGx5aW5nIHRoZVxuICogY29udmVydGVyIGlmIGl0IGV4aXN0cy5cbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIHVzZWQgd2hlbiBjb252ZXJ0aW5nIHVzZXIgb2JqZWN0cyB0byBgRG9jdW1lbnREYXRhYFxuICogYmVjYXVzZSB3ZSB3YW50IHRvIHByb3ZpZGUgdGhlIHVzZXIgd2l0aCBhIG1vcmUgc3BlY2lmaWMgZXJyb3IgbWVzc2FnZSBpZlxuICogdGhlaXIgYHNldCgpYCBvciBmYWlscyBkdWUgdG8gaW52YWxpZCBkYXRhIG9yaWdpbmF0aW5nIGZyb20gYSBgdG9GaXJlc3RvcmUoKWBcbiAqIGNhbGwuXG4gKi8gZnVuY3Rpb24gX19QUklWQVRFX2FwcGx5RmlyZXN0b3JlRGF0YUNvbnZlcnRlcihlLCB0LCBuKSB7XG4gICAgbGV0IHI7XG4gICAgLy8gQ2FzdCB0byBgYW55YCBpbiBvcmRlciB0byBzYXRpc2Z5IHRoZSB1bmlvbiB0eXBlIGNvbnN0cmFpbnQgb25cbiAgICAvLyB0b0ZpcmVzdG9yZSgpLlxuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgcmV0dXJuIHIgPSBlID8gbiAmJiAobi5tZXJnZSB8fCBuLm1lcmdlRmllbGRzKSA/IGUudG9GaXJlc3RvcmUodCwgbikgOiBlLnRvRmlyZXN0b3JlKHQpIDogdCwgXG4gICAgcjtcbn1cblxuY2xhc3MgX19QUklWQVRFX0xpdGVVc2VyRGF0YVdyaXRlciBleHRlbmRzIEFic3RyYWN0VXNlckRhdGFXcml0ZXIge1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgc3VwZXIoKSwgdGhpcy5maXJlc3RvcmUgPSBlO1xuICAgIH1cbiAgICBjb252ZXJ0Qnl0ZXMoZSkge1xuICAgICAgICByZXR1cm4gbmV3IEJ5dGVzKGUpO1xuICAgIH1cbiAgICBjb252ZXJ0UmVmZXJlbmNlKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IHRoaXMuY29udmVydERvY3VtZW50S2V5KGUsIHRoaXMuZmlyZXN0b3JlLl9kYXRhYmFzZUlkKTtcbiAgICAgICAgcmV0dXJuIG5ldyBEb2N1bWVudFJlZmVyZW5jZSh0aGlzLmZpcmVzdG9yZSwgLyogY29udmVydGVyPSAqLyBudWxsLCB0KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIyIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIENyZWF0ZSBhbiBBZ2dyZWdhdGVGaWVsZCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCB0byBjb21wdXRlIHRoZSBzdW0gb2ZcbiAqIGEgc3BlY2lmaWVkIGZpZWxkIG92ZXIgYSByYW5nZSBvZiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBwYXJhbSBmaWVsZCBTcGVjaWZpZXMgdGhlIGZpZWxkIHRvIHN1bSBhY3Jvc3MgdGhlIHJlc3VsdCBzZXQuXG4gKi8gZnVuY3Rpb24gc3VtKGUpIHtcbiAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUZpZWxkKFwic3VtXCIsIF9fUFJJVkFURV9maWVsZFBhdGhGcm9tQXJndW1lbnQkMShcInN1bVwiLCBlKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFuIEFnZ3JlZ2F0ZUZpZWxkIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGF2ZXJhZ2Ugb2ZcbiAqIGEgc3BlY2lmaWVkIGZpZWxkIG92ZXIgYSByYW5nZSBvZiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqIEBwYXJhbSBmaWVsZCBTcGVjaWZpZXMgdGhlIGZpZWxkIHRvIGF2ZXJhZ2UgYWNyb3NzIHRoZSByZXN1bHQgc2V0LlxuICovIGZ1bmN0aW9uIGF2ZXJhZ2UoZSkge1xuICAgIHJldHVybiBuZXcgQWdncmVnYXRlRmllbGQoXCJhdmdcIiwgX19QUklWQVRFX2ZpZWxkUGF0aEZyb21Bcmd1bWVudCQxKFwiYXZlcmFnZVwiLCBlKSk7XG59XG5cbi8qKlxuICogQ3JlYXRlIGFuIEFnZ3JlZ2F0ZUZpZWxkIG9iamVjdCB0aGF0IGNhbiBiZSB1c2VkIHRvIGNvbXB1dGUgdGhlIGNvdW50IG9mXG4gKiBkb2N1bWVudHMgaW4gdGhlIHJlc3VsdCBzZXQgb2YgYSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBjb3VudCgpIHtcbiAgICByZXR1cm4gbmV3IEFnZ3JlZ2F0ZUZpZWxkKFwiY291bnRcIik7XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdHdvICdBZ2dyZWdhdGVGaWVsZGAgaW5zdGFuY2VzIGZvciBlcXVhbGl0eS5cbiAqXG4gKiBAcGFyYW0gbGVmdCBDb21wYXJlIHRoaXMgQWdncmVnYXRlRmllbGQgdG8gdGhlIGByaWdodGAuXG4gKiBAcGFyYW0gcmlnaHQgQ29tcGFyZSB0aGlzIEFnZ3JlZ2F0ZUZpZWxkIHRvIHRoZSBgbGVmdGAuXG4gKi8gZnVuY3Rpb24gYWdncmVnYXRlRmllbGRFcXVhbChlLCB0KSB7XG4gICAgdmFyIG4sIHI7XG4gICAgcmV0dXJuIGUgaW5zdGFuY2VvZiBBZ2dyZWdhdGVGaWVsZCAmJiB0IGluc3RhbmNlb2YgQWdncmVnYXRlRmllbGQgJiYgZS5hZ2dyZWdhdGVUeXBlID09PSB0LmFnZ3JlZ2F0ZVR5cGUgJiYgKG51bGwgPT09IChuID0gZS5faW50ZXJuYWxGaWVsZFBhdGgpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uY2Fub25pY2FsU3RyaW5nKCkpID09PSAobnVsbCA9PT0gKHIgPSB0Ll9pbnRlcm5hbEZpZWxkUGF0aCkgfHwgdm9pZCAwID09PSByID8gdm9pZCAwIDogci5jYW5vbmljYWxTdHJpbmcoKSk7XG59XG5cbi8qKlxuICogQ29tcGFyZXMgdHdvIGBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90YCBpbnN0YW5jZXMgZm9yIGVxdWFsaXR5LlxuICpcbiAqIFR3byBgQWdncmVnYXRlUXVlcnlTbmFwc2hvdGAgaW5zdGFuY2VzIGFyZSBjb25zaWRlcmVkIFwiZXF1YWxcIiBpZiB0aGV5IGhhdmVcbiAqIHVuZGVybHlpbmcgcXVlcmllcyB0aGF0IGNvbXBhcmUgZXF1YWwsIGFuZCB0aGUgc2FtZSBkYXRhLlxuICpcbiAqIEBwYXJhbSBsZWZ0IC0gVGhlIGZpcnN0IGBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90YCB0byBjb21wYXJlLlxuICogQHBhcmFtIHJpZ2h0IC0gVGhlIHNlY29uZCBgQWdncmVnYXRlUXVlcnlTbmFwc2hvdGAgdG8gY29tcGFyZS5cbiAqXG4gKiBAcmV0dXJucyBgdHJ1ZWAgaWYgdGhlIG9iamVjdHMgYXJlIFwiZXF1YWxcIiwgYXMgZGVmaW5lZCBhYm92ZSwgb3IgYGZhbHNlYFxuICogb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIGFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RFcXVhbChlLCB0KSB7XG4gICAgcmV0dXJuIHF1ZXJ5RXF1YWwoZS5xdWVyeSwgdC5xdWVyeSkgJiYgZGVlcEVxdWFsKGUuZGF0YSgpLCB0LmRhdGEoKSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIE1ldGFkYXRhIGFib3V0IGEgc25hcHNob3QsIGRlc2NyaWJpbmcgdGhlIHN0YXRlIG9mIHRoZSBzbmFwc2hvdC5cbiAqLyBjbGFzcyBTbmFwc2hvdE1ldGFkYXRhIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5oYXNQZW5kaW5nV3JpdGVzID0gZSwgdGhpcy5mcm9tQ2FjaGUgPSB0O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBgU25hcHNob3RNZXRhZGF0YWAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBvdGhlciAtIFRoZSBgU25hcHNob3RNZXRhZGF0YWAgdG8gY29tcGFyZSBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHRydWUgaWYgdGhpcyBgU25hcHNob3RNZXRhZGF0YWAgaXMgZXF1YWwgdG8gdGhlIHByb3ZpZGVkIG9uZS5cbiAgICAgKi8gICAgaXNFcXVhbChlKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmhhc1BlbmRpbmdXcml0ZXMgPT09IGUuaGFzUGVuZGluZ1dyaXRlcyAmJiB0aGlzLmZyb21DYWNoZSA9PT0gZS5mcm9tQ2FjaGU7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91ciBGaXJlc3RvcmVcbiAqIGRhdGFiYXNlLiBUaGUgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0b1xuICogZ2V0IGEgc3BlY2lmaWMgZmllbGQuXG4gKlxuICogRm9yIGEgYERvY3VtZW50U25hcHNob3RgIHRoYXQgcG9pbnRzIHRvIGEgbm9uLWV4aXN0aW5nIGRvY3VtZW50LCBhbnkgZGF0YVxuICogYWNjZXNzIHdpbGwgcmV0dXJuICd1bmRlZmluZWQnLiBZb3UgY2FuIHVzZSB0aGUgYGV4aXN0cygpYCBtZXRob2QgdG9cbiAqIGV4cGxpY2l0bHkgdmVyaWZ5IGEgZG9jdW1lbnQncyBleGlzdGVuY2UuXG4gKi8gY2xhc3MgRG9jdW1lbnRTbmFwc2hvdCBleHRlbmRzIERvY3VtZW50U25hcHNob3QkMSB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgcHJvdGVjdGVkICovXG4gICAgY29uc3RydWN0b3IoZSwgdCwgbiwgciwgaSwgcykge1xuICAgICAgICBzdXBlcihlLCB0LCBuLCByLCBzKSwgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fZmlyZXN0b3JlSW1wbCA9IGUsIHRoaXMubWV0YWRhdGEgPSBpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgb3Igbm90IHRoZSBkYXRhIGV4aXN0cy4gVHJ1ZSBpZiB0aGUgZG9jdW1lbnQgZXhpc3RzLlxuICAgICAqLyAgICBleGlzdHMoKSB7XG4gICAgICAgIHJldHVybiBzdXBlci5leGlzdHMoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0cmlldmVzIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IGFzIGFuIGBPYmplY3RgLiBSZXR1cm5zIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICpcbiAgICAgKiBCeSBkZWZhdWx0LCBgc2VydmVyVGltZXN0YW1wKClgIHZhbHVlcyB0aGF0IGhhdmUgbm90IHlldCBiZWVuXG4gICAgICogc2V0IHRvIHRoZWlyIGZpbmFsIHZhbHVlIHdpbGwgYmUgcmV0dXJuZWQgYXMgYG51bGxgLiBZb3UgY2FuIG92ZXJyaWRlXG4gICAgICogdGhpcyBieSBwYXNzaW5nIGFuIG9wdGlvbnMgb2JqZWN0LlxuICAgICAqXG4gICAgICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgaG93IGRhdGEgaXMgcmV0cmlldmVkIGZyb21cbiAgICAgKiB0aGUgc25hcHNob3QgKGZvciBleGFtcGxlIHRoZSBkZXNpcmVkIGJlaGF2aW9yIGZvciBzZXJ2ZXIgdGltZXN0YW1wcyB0aGF0XG4gICAgICogaGF2ZSBub3QgeWV0IGJlZW4gc2V0IHRvIHRoZWlyIGZpbmFsIHZhbHVlKS5cbiAgICAgKiBAcmV0dXJucyBBbiBgT2JqZWN0YCBjb250YWluaW5nIGFsbCBmaWVsZHMgaW4gdGhlIGRvY3VtZW50IG9yIGB1bmRlZmluZWRgIGlmXG4gICAgICogdGhlIGRvY3VtZW50IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovICAgIGRhdGEoZSA9IHt9KSB7XG4gICAgICAgIGlmICh0aGlzLl9kb2N1bWVudCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbnZlcnRlcikge1xuICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgd2FudCB0byB1c2UgdGhlIGNvbnZlcnRlciBhbmQgY3JlYXRlIGEgbmV3IERvY3VtZW50U25hcHNob3RcbiAgICAgICAgICAgICAgICAvLyBpZiBhIGNvbnZlcnRlciBoYXMgYmVlbiBwcm92aWRlZC5cbiAgICAgICAgICAgICAgICBjb25zdCB0ID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCh0aGlzLl9maXJlc3RvcmUsIHRoaXMuX3VzZXJEYXRhV3JpdGVyLCB0aGlzLl9rZXksIHRoaXMuX2RvY3VtZW50LCB0aGlzLm1ldGFkYXRhLCBcbiAgICAgICAgICAgICAgICAvKiBjb252ZXJ0ZXI9ICovIG51bGwpO1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9jb252ZXJ0ZXIuZnJvbUZpcmVzdG9yZSh0LCBlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiB0aGlzLl91c2VyRGF0YVdyaXRlci5jb252ZXJ0VmFsdWUodGhpcy5fZG9jdW1lbnQuZGF0YS52YWx1ZSwgZS5zZXJ2ZXJUaW1lc3RhbXBzKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXRyaWV2ZXMgdGhlIGZpZWxkIHNwZWNpZmllZCBieSBgZmllbGRQYXRoYC4gUmV0dXJucyBgdW5kZWZpbmVkYCBpZiB0aGVcbiAgICAgKiBkb2N1bWVudCBvciBmaWVsZCBkb2Vzbid0IGV4aXN0LlxuICAgICAqXG4gICAgICogQnkgZGVmYXVsdCwgYSBgc2VydmVyVGltZXN0YW1wKClgIHRoYXQgaGFzIG5vdCB5ZXQgYmVlbiBzZXQgdG9cbiAgICAgKiBpdHMgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGUgdGhpcyBieVxuICAgICAqIHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmllbGRQYXRoIC0gVGhlIHBhdGggKGZvciBleGFtcGxlICdmb28nIG9yICdmb28uYmFyJykgdG8gYSBzcGVjaWZpY1xuICAgICAqIGZpZWxkLlxuICAgICAqIEBwYXJhbSBvcHRpb25zIC0gQW4gb3B0aW9ucyBvYmplY3QgdG8gY29uZmlndXJlIGhvdyB0aGUgZmllbGQgaXMgcmV0cmlldmVkXG4gICAgICogZnJvbSB0aGUgc25hcHNob3QgKGZvciBleGFtcGxlIHRoZSBkZXNpcmVkIGJlaGF2aW9yIGZvciBzZXJ2ZXIgdGltZXN0YW1wc1xuICAgICAqIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW4gc2V0IHRvIHRoZWlyIGZpbmFsIHZhbHVlKS5cbiAgICAgKiBAcmV0dXJucyBUaGUgZGF0YSBhdCB0aGUgc3BlY2lmaWVkIGZpZWxkIGxvY2F0aW9uIG9yIHVuZGVmaW5lZCBpZiBubyBzdWNoXG4gICAgICogZmllbGQgZXhpc3RzIGluIHRoZSBkb2N1bWVudC5cbiAgICAgKi9cbiAgICAvLyBXZSBhcmUgdXNpbmcgYGFueWAgaGVyZSB0byBhdm9pZCBhbiBleHBsaWNpdCBjYXN0IGJ5IG91ciB1c2Vycy5cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIGdldChlLCB0ID0ge30pIHtcbiAgICAgICAgaWYgKHRoaXMuX2RvY3VtZW50KSB7XG4gICAgICAgICAgICBjb25zdCBuID0gdGhpcy5fZG9jdW1lbnQuZGF0YS5maWVsZChfX1BSSVZBVEVfZmllbGRQYXRoRnJvbUFyZ3VtZW50KFwiRG9jdW1lbnRTbmFwc2hvdC5nZXRcIiwgZSkpO1xuICAgICAgICAgICAgaWYgKG51bGwgIT09IG4pIHJldHVybiB0aGlzLl91c2VyRGF0YVdyaXRlci5jb252ZXJ0VmFsdWUobiwgdC5zZXJ2ZXJUaW1lc3RhbXBzKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBBIGBRdWVyeURvY3VtZW50U25hcHNob3RgIGNvbnRhaW5zIGRhdGEgcmVhZCBmcm9tIGEgZG9jdW1lbnQgaW4geW91clxuICogRmlyZXN0b3JlIGRhdGFiYXNlIGFzIHBhcnQgb2YgYSBxdWVyeS4gVGhlIGRvY3VtZW50IGlzIGd1YXJhbnRlZWQgdG8gZXhpc3RcbiAqIGFuZCBpdHMgZGF0YSBjYW4gYmUgZXh0cmFjdGVkIHdpdGggYC5kYXRhKClgIG9yIGAuZ2V0KDxmaWVsZD4pYCB0byBnZXQgYVxuICogc3BlY2lmaWMgZmllbGQuXG4gKlxuICogQSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBvZmZlcnMgdGhlIHNhbWUgQVBJIHN1cmZhY2UgYXMgYVxuICogYERvY3VtZW50U25hcHNob3RgLiBTaW5jZSBxdWVyeSByZXN1bHRzIGNvbnRhaW4gb25seSBleGlzdGluZyBkb2N1bWVudHMsIHRoZVxuICogYGV4aXN0c2AgcHJvcGVydHkgd2lsbCBhbHdheXMgYmUgdHJ1ZSBhbmQgYGRhdGEoKWAgd2lsbCBuZXZlciByZXR1cm5cbiAqICd1bmRlZmluZWQnLlxuICovIGNsYXNzIFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCBleHRlbmRzIERvY3VtZW50U25hcHNob3Qge1xuICAgIC8qKlxuICAgICAqIFJldHJpZXZlcyBhbGwgZmllbGRzIGluIHRoZSBkb2N1bWVudCBhcyBhbiBgT2JqZWN0YC5cbiAgICAgKlxuICAgICAqIEJ5IGRlZmF1bHQsIGBzZXJ2ZXJUaW1lc3RhbXAoKWAgdmFsdWVzIHRoYXQgaGF2ZSBub3QgeWV0IGJlZW5cbiAgICAgKiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUgd2lsbCBiZSByZXR1cm5lZCBhcyBgbnVsbGAuIFlvdSBjYW4gb3ZlcnJpZGVcbiAgICAgKiB0aGlzIGJ5IHBhc3NpbmcgYW4gb3B0aW9ucyBvYmplY3QuXG4gICAgICpcbiAgICAgKiBAb3ZlcnJpZGVcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIEFuIG9wdGlvbnMgb2JqZWN0IHRvIGNvbmZpZ3VyZSBob3cgZGF0YSBpcyByZXRyaWV2ZWQgZnJvbVxuICAgICAqIHRoZSBzbmFwc2hvdCAoZm9yIGV4YW1wbGUgdGhlIGRlc2lyZWQgYmVoYXZpb3IgZm9yIHNlcnZlciB0aW1lc3RhbXBzIHRoYXRcbiAgICAgKiBoYXZlIG5vdCB5ZXQgYmVlbiBzZXQgdG8gdGhlaXIgZmluYWwgdmFsdWUpLlxuICAgICAqIEByZXR1cm5zIEFuIGBPYmplY3RgIGNvbnRhaW5pbmcgYWxsIGZpZWxkcyBpbiB0aGUgZG9jdW1lbnQuXG4gICAgICovXG4gICAgZGF0YShlID0ge30pIHtcbiAgICAgICAgcmV0dXJuIHN1cGVyLmRhdGEoZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEEgYFF1ZXJ5U25hcHNob3RgIGNvbnRhaW5zIHplcm8gb3IgbW9yZSBgRG9jdW1lbnRTbmFwc2hvdGAgb2JqZWN0c1xuICogcmVwcmVzZW50aW5nIHRoZSByZXN1bHRzIG9mIGEgcXVlcnkuIFRoZSBkb2N1bWVudHMgY2FuIGJlIGFjY2Vzc2VkIGFzIGFuXG4gKiBhcnJheSB2aWEgdGhlIGBkb2NzYCBwcm9wZXJ0eSBvciBlbnVtZXJhdGVkIHVzaW5nIHRoZSBgZm9yRWFjaGAgbWV0aG9kLiBUaGVcbiAqIG51bWJlciBvZiBkb2N1bWVudHMgY2FuIGJlIGRldGVybWluZWQgdmlhIHRoZSBgZW1wdHlgIGFuZCBgc2l6ZWBcbiAqIHByb3BlcnRpZXMuXG4gKi8gY2xhc3MgUXVlcnlTbmFwc2hvdCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0LCBuLCByKSB7XG4gICAgICAgIHRoaXMuX2ZpcmVzdG9yZSA9IGUsIHRoaXMuX3VzZXJEYXRhV3JpdGVyID0gdCwgdGhpcy5fc25hcHNob3QgPSByLCB0aGlzLm1ldGFkYXRhID0gbmV3IFNuYXBzaG90TWV0YWRhdGEoci5oYXNQZW5kaW5nV3JpdGVzLCByLmZyb21DYWNoZSksIFxuICAgICAgICB0aGlzLnF1ZXJ5ID0gbjtcbiAgICB9XG4gICAgLyoqIEFuIGFycmF5IG9mIGFsbCB0aGUgZG9jdW1lbnRzIGluIHRoZSBgUXVlcnlTbmFwc2hvdGAuICovICAgIGdldCBkb2NzKCkge1xuICAgICAgICBjb25zdCBlID0gW107XG4gICAgICAgIHJldHVybiB0aGlzLmZvckVhY2goKHQgPT4gZS5wdXNoKHQpKSksIGU7XG4gICAgfVxuICAgIC8qKiBUaGUgbnVtYmVyIG9mIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLiAqLyAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3NuYXBzaG90LmRvY3Muc2l6ZTtcbiAgICB9XG4gICAgLyoqIFRydWUgaWYgdGhlcmUgYXJlIG5vIGRvY3VtZW50cyBpbiB0aGUgYFF1ZXJ5U25hcHNob3RgLiAqLyAgICBnZXQgZW1wdHkoKSB7XG4gICAgICAgIHJldHVybiAwID09PSB0aGlzLnNpemU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVudW1lcmF0ZXMgYWxsIG9mIHRoZSBkb2N1bWVudHMgaW4gdGhlIGBRdWVyeVNuYXBzaG90YC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYWxsYmFjayAtIEEgY2FsbGJhY2sgdG8gYmUgY2FsbGVkIHdpdGggYSBgUXVlcnlEb2N1bWVudFNuYXBzaG90YCBmb3JcbiAgICAgKiBlYWNoIGRvY3VtZW50IGluIHRoZSBzbmFwc2hvdC5cbiAgICAgKiBAcGFyYW0gdGhpc0FyZyAtIFRoZSBgdGhpc2AgYmluZGluZyBmb3IgdGhlIGNhbGxiYWNrLlxuICAgICAqLyAgICBmb3JFYWNoKGUsIHQpIHtcbiAgICAgICAgdGhpcy5fc25hcHNob3QuZG9jcy5mb3JFYWNoKChuID0+IHtcbiAgICAgICAgICAgIGUuY2FsbCh0LCBuZXcgUXVlcnlEb2N1bWVudFNuYXBzaG90KHRoaXMuX2ZpcmVzdG9yZSwgdGhpcy5fdXNlckRhdGFXcml0ZXIsIG4ua2V5LCBuLCBuZXcgU25hcHNob3RNZXRhZGF0YSh0aGlzLl9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXMobi5rZXkpLCB0aGlzLl9zbmFwc2hvdC5mcm9tQ2FjaGUpLCB0aGlzLnF1ZXJ5LmNvbnZlcnRlcikpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYW4gYXJyYXkgb2YgdGhlIGRvY3VtZW50cyBjaGFuZ2VzIHNpbmNlIHRoZSBsYXN0IHNuYXBzaG90LiBJZiB0aGlzXG4gICAgICogaXMgdGhlIGZpcnN0IHNuYXBzaG90LCBhbGwgZG9jdW1lbnRzIHdpbGwgYmUgaW4gdGhlIGxpc3QgYXMgJ2FkZGVkJ1xuICAgICAqIGNoYW5nZXMuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb3B0aW9ucyAtIGBTbmFwc2hvdExpc3Rlbk9wdGlvbnNgIHRoYXQgY29udHJvbCB3aGV0aGVyIG1ldGFkYXRhLW9ubHlcbiAgICAgKiBjaGFuZ2VzIChpLmUuIG9ubHkgYERvY3VtZW50U25hcHNob3QubWV0YWRhdGFgIGNoYW5nZWQpIHNob3VsZCB0cmlnZ2VyXG4gICAgICogc25hcHNob3QgZXZlbnRzLlxuICAgICAqLyAgICBkb2NDaGFuZ2VzKGUgPSB7fSkge1xuICAgICAgICBjb25zdCB0ID0gISFlLmluY2x1ZGVNZXRhZGF0YUNoYW5nZXM7XG4gICAgICAgIGlmICh0ICYmIHRoaXMuX3NuYXBzaG90LmV4Y2x1ZGVzTWV0YWRhdGFDaGFuZ2VzKSB0aHJvdyBuZXcgRmlyZXN0b3JlRXJyb3IoQy5JTlZBTElEX0FSR1VNRU5ULCBcIlRvIGluY2x1ZGUgbWV0YWRhdGEgY2hhbmdlcyB3aXRoIHlvdXIgZG9jdW1lbnQgY2hhbmdlcywgeW91IG11c3QgYWxzbyBwYXNzIHsgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczp0cnVlIH0gdG8gb25TbmFwc2hvdCgpLlwiKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2NhY2hlZENoYW5nZXMgJiYgdGhpcy5fY2FjaGVkQ2hhbmdlc0luY2x1ZGVNZXRhZGF0YUNoYW5nZXMgPT09IHQgfHwgKHRoaXMuX2NhY2hlZENoYW5nZXMgPSBcbiAgICAgICAgLyoqIENhbGN1bGF0ZXMgdGhlIGFycmF5IG9mIGBEb2N1bWVudENoYW5nZWBzIGZvciBhIGdpdmVuIGBWaWV3U25hcHNob3RgLiAqL1xuICAgICAgICBmdW5jdGlvbiBfX1BSSVZBVEVfY2hhbmdlc0Zyb21TbmFwc2hvdChlLCB0KSB7XG4gICAgICAgICAgICBpZiAoZS5fc25hcHNob3Qub2xkRG9jcy5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgdCA9IDA7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuX3NuYXBzaG90LmRvY0NoYW5nZXMubWFwKChuID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgciA9IG5ldyBRdWVyeURvY3VtZW50U25hcHNob3QoZS5fZmlyZXN0b3JlLCBlLl91c2VyRGF0YVdyaXRlciwgbi5kb2Mua2V5LCBuLmRvYywgbmV3IFNuYXBzaG90TWV0YWRhdGEoZS5fc25hcHNob3QubXV0YXRlZEtleXMuaGFzKG4uZG9jLmtleSksIGUuX3NuYXBzaG90LmZyb21DYWNoZSksIGUucXVlcnkuY29udmVydGVyKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG4uZG9jLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBcImFkZGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBkb2M6IHIsXG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRJbmRleDogLTEsXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdJbmRleDogdCsrXG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIC8vIEEgYERvY3VtZW50U2V0YCB0aGF0IGlzIHVwZGF0ZWQgaW5jcmVtZW50YWxseSBhcyBjaGFuZ2VzIGFyZSBhcHBsaWVkIHRvIHVzZVxuICAgICAgICAgICAgICAgIC8vIHRvIGxvb2t1cCB0aGUgaW5kZXggb2YgYSBkb2N1bWVudC5cbiAgICAgICAgICAgICAgICBsZXQgbiA9IGUuX3NuYXBzaG90Lm9sZERvY3M7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUuX3NuYXBzaG90LmRvY0NoYW5nZXMuZmlsdGVyKChlID0+IHQgfHwgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovICE9PSBlLnR5cGUpKS5tYXAoKHQgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCByID0gbmV3IFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdChlLl9maXJlc3RvcmUsIGUuX3VzZXJEYXRhV3JpdGVyLCB0LmRvYy5rZXksIHQuZG9jLCBuZXcgU25hcHNob3RNZXRhZGF0YShlLl9zbmFwc2hvdC5tdXRhdGVkS2V5cy5oYXModC5kb2Mua2V5KSwgZS5fc25hcHNob3QuZnJvbUNhY2hlKSwgZS5xdWVyeS5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgaSA9IC0xLCBzID0gLTE7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAwIC8qIENoYW5nZVR5cGUuQWRkZWQgKi8gIT09IHQudHlwZSAmJiAoaSA9IG4uaW5kZXhPZih0LmRvYy5rZXkpLCBuID0gbi5kZWxldGUodC5kb2Mua2V5KSksIFxuICAgICAgICAgICAgICAgICAgICAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyAhPT0gdC50eXBlICYmIChuID0gbi5hZGQodC5kb2MpLCBzID0gbi5pbmRleE9mKHQuZG9jLmtleSkpLCBcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHlwZTogX19QUklWQVRFX3Jlc3VsdENoYW5nZVR5cGUodC50eXBlKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGRvYzogcixcbiAgICAgICAgICAgICAgICAgICAgICAgIG9sZEluZGV4OiBpLFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3SW5kZXg6IHNcbiAgICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0odGhpcywgdCksIHRoaXMuX2NhY2hlZENoYW5nZXNJbmNsdWRlTWV0YWRhdGFDaGFuZ2VzID0gdCksIHRoaXMuX2NhY2hlZENoYW5nZXM7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBfX1BSSVZBVEVfcmVzdWx0Q2hhbmdlVHlwZShlKSB7XG4gICAgc3dpdGNoIChlKSB7XG4gICAgICBjYXNlIDAgLyogQ2hhbmdlVHlwZS5BZGRlZCAqLyA6XG4gICAgICAgIHJldHVybiBcImFkZGVkXCI7XG5cbiAgICAgIGNhc2UgMiAvKiBDaGFuZ2VUeXBlLk1vZGlmaWVkICovIDpcbiAgICAgIGNhc2UgMyAvKiBDaGFuZ2VUeXBlLk1ldGFkYXRhICovIDpcbiAgICAgICAgcmV0dXJuIFwibW9kaWZpZWRcIjtcblxuICAgICAgY2FzZSAxIC8qIENoYW5nZVR5cGUuUmVtb3ZlZCAqLyA6XG4gICAgICAgIHJldHVybiBcInJlbW92ZWRcIjtcblxuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhaWwoKTtcbiAgICB9XG59XG5cbi8vIFRPRE8oZmlyZXN0b3JlZXhwKTogQWRkIHRlc3RzIGZvciBzbmFwc2hvdEVxdWFsIHdpdGggZGlmZmVyZW50IHNuYXBzaG90XG4vLyBtZXRhZGF0YVxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhlIHByb3ZpZGVkIHNuYXBzaG90cyBhcmUgZXF1YWwuXG4gKlxuICogQHBhcmFtIGxlZnQgLSBBIHNuYXBzaG90IHRvIGNvbXBhcmUuXG4gKiBAcGFyYW0gcmlnaHQgLSBBIHNuYXBzaG90IHRvIGNvbXBhcmUuXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSBzbmFwc2hvdHMgYXJlIGVxdWFsLlxuICovIGZ1bmN0aW9uIHNuYXBzaG90RXF1YWwoZSwgdCkge1xuICAgIHJldHVybiBlIGluc3RhbmNlb2YgRG9jdW1lbnRTbmFwc2hvdCAmJiB0IGluc3RhbmNlb2YgRG9jdW1lbnRTbmFwc2hvdCA/IGUuX2ZpcmVzdG9yZSA9PT0gdC5fZmlyZXN0b3JlICYmIGUuX2tleS5pc0VxdWFsKHQuX2tleSkgJiYgKG51bGwgPT09IGUuX2RvY3VtZW50ID8gbnVsbCA9PT0gdC5fZG9jdW1lbnQgOiBlLl9kb2N1bWVudC5pc0VxdWFsKHQuX2RvY3VtZW50KSkgJiYgZS5fY29udmVydGVyID09PSB0Ll9jb252ZXJ0ZXIgOiBlIGluc3RhbmNlb2YgUXVlcnlTbmFwc2hvdCAmJiB0IGluc3RhbmNlb2YgUXVlcnlTbmFwc2hvdCAmJiAoZS5fZmlyZXN0b3JlID09PSB0Ll9maXJlc3RvcmUgJiYgcXVlcnlFcXVhbChlLnF1ZXJ5LCB0LnF1ZXJ5KSAmJiBlLm1ldGFkYXRhLmlzRXF1YWwodC5tZXRhZGF0YSkgJiYgZS5fc25hcHNob3QuaXNFcXVhbCh0Ll9zbmFwc2hvdCkpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgLlxuICpcbiAqIE5vdGU6IGBnZXREb2MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieSB3YWl0aW5nXG4gKiBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWYgeW91IGFyZVxuICogb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLCBpbnZva2VcbiAqIHtAbGluayBnZXREb2NGcm9tQ2FjaGV9IG9yIHtAbGluayBnZXREb2NGcm9tU2VydmVyfS5cbiAqXG4gKiBAcGFyYW0gcmVmZXJlbmNlIC0gVGhlIHJlZmVyZW5jZSBvZiB0aGUgZG9jdW1lbnQgdG8gZmV0Y2guXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqLyBmdW5jdGlvbiBnZXREb2MoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBEb2N1bWVudFJlZmVyZW5jZSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRWaWFTbmFwc2hvdExpc3RlbmVyKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIGUuX2tleSkudGhlbigobiA9PiBfX1BSSVZBVEVfY29udmVydFRvRG9jU25hcHNob3QodCwgZSwgbikpKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyIGV4dGVuZHMgQWJzdHJhY3RVc2VyRGF0YVdyaXRlciB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICBzdXBlcigpLCB0aGlzLmZpcmVzdG9yZSA9IGU7XG4gICAgfVxuICAgIGNvbnZlcnRCeXRlcyhlKSB7XG4gICAgICAgIHJldHVybiBuZXcgQnl0ZXMoZSk7XG4gICAgfVxuICAgIGNvbnZlcnRSZWZlcmVuY2UoZSkge1xuICAgICAgICBjb25zdCB0ID0gdGhpcy5jb252ZXJ0RG9jdW1lbnRLZXkoZSwgdGhpcy5maXJlc3RvcmUuX2RhdGFiYXNlSWQpO1xuICAgICAgICByZXR1cm4gbmV3IERvY3VtZW50UmVmZXJlbmNlKHRoaXMuZmlyZXN0b3JlLCAvKiBjb252ZXJ0ZXI9ICovIG51bGwsIHQpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJyZWQgdG8gYnkgdGhpcyBgRG9jdW1lbnRSZWZlcmVuY2VgIGZyb20gY2FjaGUuXG4gKiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBkb2N1bWVudCBpcyBub3QgY3VycmVudGx5IGNhY2hlZC5cbiAqXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50U25hcHNob3RgIGNvbnRhaW5pbmcgdGhlXG4gKiBjdXJyZW50IGRvY3VtZW50IGNvbnRlbnRzLlxuICovIGZ1bmN0aW9uIGdldERvY0Zyb21DYWNoZShlKSB7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIERvY3VtZW50UmVmZXJlbmNlKTtcbiAgICBjb25zdCB0ID0gX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIG4gPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKHQpLCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih0KTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50RnJvbUxvY2FsQ2FjaGUobiwgZS5fa2V5KS50aGVuKChuID0+IG5ldyBEb2N1bWVudFNuYXBzaG90KHQsIHIsIGUuX2tleSwgbiwgbmV3IFNuYXBzaG90TWV0YWRhdGEobnVsbCAhPT0gbiAmJiBuLmhhc0xvY2FsTXV0YXRpb25zLCBcbiAgICAvKiBmcm9tQ2FjaGU9ICovICEwKSwgZS5jb252ZXJ0ZXIpKSk7XG59XG5cbi8qKlxuICogUmVhZHMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoaXMgYERvY3VtZW50UmVmZXJlbmNlYCBmcm9tIHRoZSBzZXJ2ZXIuXG4gKiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBuZXR3b3JrIGlzIG5vdCBhdmFpbGFibGUuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgd2l0aCBhIGBEb2N1bWVudFNuYXBzaG90YCBjb250YWluaW5nIHRoZVxuICogY3VycmVudCBkb2N1bWVudCBjb250ZW50cy5cbiAqLyBmdW5jdGlvbiBnZXREb2NGcm9tU2VydmVyKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgRG9jdW1lbnRSZWZlcmVuY2UpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudEdldERvY3VtZW50VmlhU25hcHNob3RMaXN0ZW5lcihlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKHQpLCBlLl9rZXksIHtcbiAgICAgICAgc291cmNlOiBcInNlcnZlclwiXG4gICAgfSkudGhlbigobiA9PiBfX1BSSVZBVEVfY29udmVydFRvRG9jU25hcHNob3QodCwgZSwgbikpKTtcbn1cblxuLyoqXG4gKiBFeGVjdXRlcyB0aGUgcXVlcnkgYW5kIHJldHVybnMgdGhlIHJlc3VsdHMgYXMgYSBgUXVlcnlTbmFwc2hvdGAuXG4gKlxuICogTm90ZTogYGdldERvY3MoKWAgYXR0ZW1wdHMgdG8gcHJvdmlkZSB1cC10by1kYXRlIGRhdGEgd2hlbiBwb3NzaWJsZSBieVxuICogd2FpdGluZyBmb3IgZGF0YSBmcm9tIHRoZSBzZXJ2ZXIsIGJ1dCBpdCBtYXkgcmV0dXJuIGNhY2hlZCBkYXRhIG9yIGZhaWwgaWZcbiAqIHlvdSBhcmUgb2ZmbGluZSBhbmQgdGhlIHNlcnZlciBjYW5ub3QgYmUgcmVhY2hlZC4gVG8gc3BlY2lmeSB0aGlzIGJlaGF2aW9yLFxuICogaW52b2tlIHtAbGluayBnZXREb2NzRnJvbUNhY2hlfSBvciB7QGxpbmsgZ2V0RG9jc0Zyb21TZXJ2ZXJ9LlxuICpcbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHRoYXQgd2lsbCBiZSByZXNvbHZlZCB3aXRoIHRoZSByZXN1bHRzIG9mIHRoZSBxdWVyeS5cbiAqLyBmdW5jdGlvbiBnZXREb2NzKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgUXVlcnkpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgbiA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIHIgPSBuZXcgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyKHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfdmFsaWRhdGVIYXNFeHBsaWNpdE9yZGVyQnlGb3JMaW1pdFRvTGFzdChlLl9xdWVyeSksIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNWaWFTbmFwc2hvdExpc3RlbmVyKG4sIGUuX3F1ZXJ5KS50aGVuKChuID0+IG5ldyBRdWVyeVNuYXBzaG90KHQsIHIsIGUsIG4pKSk7XG59XG5cbi8qKlxuICogRXhlY3V0ZXMgdGhlIHF1ZXJ5IGFuZCByZXR1cm5zIHRoZSByZXN1bHRzIGFzIGEgYFF1ZXJ5U25hcHNob3RgIGZyb20gY2FjaGUuXG4gKiBSZXR1cm5zIGFuIGVtcHR5IHJlc3VsdCBzZXQgaWYgbm8gZG9jdW1lbnRzIG1hdGNoaW5nIHRoZSBxdWVyeSBhcmUgY3VycmVudGx5XG4gKiBjYWNoZWQuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5LlxuICovIGZ1bmN0aW9uIGdldERvY3NGcm9tQ2FjaGUoZSkge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBRdWVyeSk7XG4gICAgY29uc3QgdCA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCh0KSwgciA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIodCk7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRHZXREb2N1bWVudHNGcm9tTG9jYWxDYWNoZShuLCBlLl9xdWVyeSkudGhlbigobiA9PiBuZXcgUXVlcnlTbmFwc2hvdCh0LCByLCBlLCBuKSkpO1xufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBxdWVyeSBhbmQgcmV0dXJucyB0aGUgcmVzdWx0cyBhcyBhIGBRdWVyeVNuYXBzaG90YCBmcm9tIHRoZVxuICogc2VydmVyLiBSZXR1cm5zIGFuIGVycm9yIGlmIHRoZSBuZXR3b3JrIGlzIG5vdCBhdmFpbGFibGUuXG4gKlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCB3aWxsIGJlIHJlc29sdmVkIHdpdGggdGhlIHJlc3VsdHMgb2YgdGhlIHF1ZXJ5LlxuICovIGZ1bmN0aW9uIGdldERvY3NGcm9tU2VydmVyKGUpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgUXVlcnkpO1xuICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgbiA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodCksIHIgPSBuZXcgX19QUklWQVRFX0V4cFVzZXJEYXRhV3JpdGVyKHQpO1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50R2V0RG9jdW1lbnRzVmlhU25hcHNob3RMaXN0ZW5lcihuLCBlLl9xdWVyeSwge1xuICAgICAgICBzb3VyY2U6IFwic2VydmVyXCJcbiAgICB9KS50aGVuKChuID0+IG5ldyBRdWVyeVNuYXBzaG90KHQsIHIsIGUsIG4pKSk7XG59XG5cbmZ1bmN0aW9uIHNldERvYyhlLCB0LCBuKSB7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIERvY3VtZW50UmVmZXJlbmNlKTtcbiAgICBjb25zdCByID0gX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIGkgPSBfX1BSSVZBVEVfYXBwbHlGaXJlc3RvcmVEYXRhQ29udmVydGVyKGUuY29udmVydGVyLCB0LCBuKTtcbiAgICByZXR1cm4gZXhlY3V0ZVdyaXRlKHIsIFsgX19QUklWQVRFX3BhcnNlU2V0RGF0YShfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIociksIFwic2V0RG9jXCIsIGUuX2tleSwgaSwgbnVsbCAhPT0gZS5jb252ZXJ0ZXIsIG4pLnRvTXV0YXRpb24oZS5fa2V5LCBQcmVjb25kaXRpb24ubm9uZSgpKSBdKTtcbn1cblxuZnVuY3Rpb24gdXBkYXRlRG9jKGUsIHQsIG4sIC4uLnIpIHtcbiAgICBlID0gX19QUklWQVRFX2Nhc3QoZSwgRG9jdW1lbnRSZWZlcmVuY2UpO1xuICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgcyA9IF9fUFJJVkFURV9uZXdVc2VyRGF0YVJlYWRlcihpKTtcbiAgICBsZXQgbztcbiAgICBvID0gXCJzdHJpbmdcIiA9PSB0eXBlb2YgKFxuICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgIHQgPSBnZXRNb2R1bGFySW5zdGFuY2UodCkpIHx8IHQgaW5zdGFuY2VvZiBGaWVsZFBhdGggPyBfX1BSSVZBVEVfcGFyc2VVcGRhdGVWYXJhcmdzKHMsIFwidXBkYXRlRG9jXCIsIGUuX2tleSwgdCwgbiwgcikgOiBfX1BSSVZBVEVfcGFyc2VVcGRhdGVEYXRhKHMsIFwidXBkYXRlRG9jXCIsIGUuX2tleSwgdCk7XG4gICAgcmV0dXJuIGV4ZWN1dGVXcml0ZShpLCBbIG8udG9NdXRhdGlvbihlLl9rZXksIFByZWNvbmRpdGlvbi5leGlzdHMoITApKSBdKTtcbn1cblxuLyoqXG4gKiBEZWxldGVzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGUgc3BlY2lmaWVkIGBEb2N1bWVudFJlZmVyZW5jZWAuXG4gKlxuICogQHBhcmFtIHJlZmVyZW5jZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBkZWxldGUuXG4gKiBAcmV0dXJucyBBIFByb21pc2UgcmVzb2x2ZWQgb25jZSB0aGUgZG9jdW1lbnQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5XG4gKiBkZWxldGVkIGZyb20gdGhlIGJhY2tlbmQgKG5vdGUgdGhhdCBpdCB3b24ndCByZXNvbHZlIHdoaWxlIHlvdSdyZSBvZmZsaW5lKS5cbiAqLyBmdW5jdGlvbiBkZWxldGVEb2MoZSkge1xuICAgIHJldHVybiBleGVjdXRlV3JpdGUoX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSksIFsgbmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbihlLl9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpIF0pO1xufVxuXG4vKipcbiAqIEFkZCBhIG5ldyBkb2N1bWVudCB0byBzcGVjaWZpZWQgYENvbGxlY3Rpb25SZWZlcmVuY2VgIHdpdGggdGhlIGdpdmVuIGRhdGEsXG4gKiBhc3NpZ25pbmcgaXQgYSBkb2N1bWVudCBJRCBhdXRvbWF0aWNhbGx5LlxuICpcbiAqIEBwYXJhbSByZWZlcmVuY2UgLSBBIHJlZmVyZW5jZSB0byB0aGUgY29sbGVjdGlvbiB0byBhZGQgdGhpcyBkb2N1bWVudCB0by5cbiAqIEBwYXJhbSBkYXRhIC0gQW4gT2JqZWN0IGNvbnRhaW5pbmcgdGhlIGRhdGEgZm9yIHRoZSBuZXcgZG9jdW1lbnQuXG4gKiBAcmV0dXJucyBBIGBQcm9taXNlYCByZXNvbHZlZCB3aXRoIGEgYERvY3VtZW50UmVmZXJlbmNlYCBwb2ludGluZyB0byB0aGVcbiAqIG5ld2x5IGNyZWF0ZWQgZG9jdW1lbnQgYWZ0ZXIgaXQgaGFzIGJlZW4gd3JpdHRlbiB0byB0aGUgYmFja2VuZCAoTm90ZSB0aGF0IGl0XG4gKiB3b24ndCByZXNvbHZlIHdoaWxlIHlvdSdyZSBvZmZsaW5lKS5cbiAqLyBmdW5jdGlvbiBhZGREb2MoZSwgdCkge1xuICAgIGNvbnN0IG4gPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgciA9IGRvYyhlKSwgaSA9IF9fUFJJVkFURV9hcHBseUZpcmVzdG9yZURhdGFDb252ZXJ0ZXIoZS5jb252ZXJ0ZXIsIHQpO1xuICAgIHJldHVybiBleGVjdXRlV3JpdGUobiwgWyBfX1BSSVZBVEVfcGFyc2VTZXREYXRhKF9fUFJJVkFURV9uZXdVc2VyRGF0YVJlYWRlcihlLmZpcmVzdG9yZSksIFwiYWRkRG9jXCIsIHIuX2tleSwgaSwgbnVsbCAhPT0gZS5jb252ZXJ0ZXIsIHt9KS50b011dGF0aW9uKHIuX2tleSwgUHJlY29uZGl0aW9uLmV4aXN0cyghMSkpIF0pLnRoZW4oKCgpID0+IHIpKTtcbn1cblxuZnVuY3Rpb24gb25TbmFwc2hvdChlLCAuLi50KSB7XG4gICAgdmFyIG4sIHIsIGk7XG4gICAgZSA9IGdldE1vZHVsYXJJbnN0YW5jZShlKTtcbiAgICBsZXQgcyA9IHtcbiAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogITEsXG4gICAgICAgIHNvdXJjZTogXCJkZWZhdWx0XCJcbiAgICB9LCBvID0gMDtcbiAgICBcIm9iamVjdFwiICE9IHR5cGVvZiB0W29dIHx8IF9fUFJJVkFURV9pc1BhcnRpYWxPYnNlcnZlcih0W29dKSB8fCAocyA9IHRbb10sIG8rKyk7XG4gICAgY29uc3QgXyA9IHtcbiAgICAgICAgaW5jbHVkZU1ldGFkYXRhQ2hhbmdlczogcy5pbmNsdWRlTWV0YWRhdGFDaGFuZ2VzLFxuICAgICAgICBzb3VyY2U6IHMuc291cmNlXG4gICAgfTtcbiAgICBpZiAoX19QUklWQVRFX2lzUGFydGlhbE9ic2VydmVyKHRbb10pKSB7XG4gICAgICAgIGNvbnN0IGUgPSB0W29dO1xuICAgICAgICB0W29dID0gbnVsbCA9PT0gKG4gPSBlLm5leHQpIHx8IHZvaWQgMCA9PT0gbiA/IHZvaWQgMCA6IG4uYmluZChlKSwgdFtvICsgMV0gPSBudWxsID09PSAociA9IGUuZXJyb3IpIHx8IHZvaWQgMCA9PT0gciA/IHZvaWQgMCA6IHIuYmluZChlKSwgXG4gICAgICAgIHRbbyArIDJdID0gbnVsbCA9PT0gKGkgPSBlLmNvbXBsZXRlKSB8fCB2b2lkIDAgPT09IGkgPyB2b2lkIDAgOiBpLmJpbmQoZSk7XG4gICAgfVxuICAgIGxldCBhLCB1LCBjO1xuICAgIGlmIChlIGluc3RhbmNlb2YgRG9jdW1lbnRSZWZlcmVuY2UpIHUgPSBfX1BSSVZBVEVfY2FzdChlLmZpcmVzdG9yZSwgRmlyZXN0b3JlKSwgXG4gICAgYyA9IF9fUFJJVkFURV9uZXdRdWVyeUZvclBhdGgoZS5fa2V5LnBhdGgpLCBhID0ge1xuICAgICAgICBuZXh0OiBuID0+IHtcbiAgICAgICAgICAgIHRbb10gJiYgdFtvXShfX1BSSVZBVEVfY29udmVydFRvRG9jU25hcHNob3QodSwgZSwgbikpO1xuICAgICAgICB9LFxuICAgICAgICBlcnJvcjogdFtvICsgMV0sXG4gICAgICAgIGNvbXBsZXRlOiB0W28gKyAyXVxuICAgIH07IGVsc2Uge1xuICAgICAgICBjb25zdCBuID0gX19QUklWQVRFX2Nhc3QoZSwgUXVlcnkpO1xuICAgICAgICB1ID0gX19QUklWQVRFX2Nhc3Qobi5maXJlc3RvcmUsIEZpcmVzdG9yZSksIGMgPSBuLl9xdWVyeTtcbiAgICAgICAgY29uc3QgciA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIodSk7XG4gICAgICAgIGEgPSB7XG4gICAgICAgICAgICBuZXh0OiBlID0+IHtcbiAgICAgICAgICAgICAgICB0W29dICYmIHRbb10obmV3IFF1ZXJ5U25hcHNob3QodSwgciwgbiwgZSkpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yOiB0W28gKyAxXSxcbiAgICAgICAgICAgIGNvbXBsZXRlOiB0W28gKyAyXVxuICAgICAgICB9LCBfX1BSSVZBVEVfdmFsaWRhdGVIYXNFeHBsaWNpdE9yZGVyQnlGb3JMaW1pdFRvTGFzdChlLl9xdWVyeSk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50TGlzdGVuKGUsIHQsIG4sIHIpIHtcbiAgICAgICAgY29uc3QgaSA9IG5ldyBfX1BSSVZBVEVfQXN5bmNPYnNlcnZlcihyKSwgcyA9IG5ldyBfX1BSSVZBVEVfUXVlcnlMaXN0ZW5lcih0LCBpLCBuKTtcbiAgICAgICAgcmV0dXJuIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyTGlzdGVuKGF3YWl0IF9fUFJJVkFURV9nZXRFdmVudE1hbmFnZXIoZSksIHMpKSksIFxuICAgICAgICAoKSA9PiB7XG4gICAgICAgICAgICBpLnN1KCksIGUuYXN5bmNRdWV1ZS5lbnF1ZXVlQW5kRm9yZ2V0KChhc3luYyAoKSA9PiBfX1BSSVZBVEVfZXZlbnRNYW5hZ2VyVW5saXN0ZW4oYXdhaXQgX19QUklWQVRFX2dldEV2ZW50TWFuYWdlcihlKSwgcykpKTtcbiAgICAgICAgfTtcbiAgICB9KGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQodSksIGMsIF8sIGEpO1xufVxuXG5mdW5jdGlvbiBvblNuYXBzaG90c0luU3luYyhlLCB0KSB7XG4gICAgcmV0dXJuIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRBZGRTbmFwc2hvdHNJblN5bmNMaXN0ZW5lcihlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpKSwgX19QUklWQVRFX2lzUGFydGlhbE9ic2VydmVyKHQpID8gdCA6IHtcbiAgICAgICAgbmV4dDogdFxuICAgIH0pO1xufVxuXG4vKipcbiAqIExvY2FsbHkgd3JpdGVzIGBtdXRhdGlvbnNgIG9uIHRoZSBhc3luYyBxdWV1ZS5cbiAqIEBpbnRlcm5hbFxuICovIGZ1bmN0aW9uIGV4ZWN1dGVXcml0ZShlLCB0KSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRXcml0ZShlLCB0KSB7XG4gICAgICAgIGNvbnN0IG4gPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IF9fUFJJVkFURV9zeW5jRW5naW5lV3JpdGUoYXdhaXQgX19QUklWQVRFX2dldFN5bmNFbmdpbmUoZSksIHQsIG4pKSksIFxuICAgICAgICBuLnByb21pc2U7XG4gICAgfShlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUpLCB0KTtcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhIHtAbGluayBWaWV3U25hcHNob3R9IHRoYXQgY29udGFpbnMgdGhlIHNpbmdsZSBkb2N1bWVudCBzcGVjaWZpZWQgYnkgYHJlZmBcbiAqIHRvIGEge0BsaW5rIERvY3VtZW50U25hcHNob3R9LlxuICovIGZ1bmN0aW9uIF9fUFJJVkFURV9jb252ZXJ0VG9Eb2NTbmFwc2hvdChlLCB0LCBuKSB7XG4gICAgY29uc3QgciA9IG4uZG9jcy5nZXQodC5fa2V5KSwgaSA9IG5ldyBfX1BSSVZBVEVfRXhwVXNlckRhdGFXcml0ZXIoZSk7XG4gICAgcmV0dXJuIG5ldyBEb2N1bWVudFNuYXBzaG90KGUsIGksIHQuX2tleSwgciwgbmV3IFNuYXBzaG90TWV0YWRhdGEobi5oYXNQZW5kaW5nV3JpdGVzLCBuLmZyb21DYWNoZSksIHQuY29udmVydGVyKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjIgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ2FsY3VsYXRlcyB0aGUgbnVtYmVyIG9mIGRvY3VtZW50cyBpbiB0aGUgcmVzdWx0IHNldCBvZiB0aGUgZ2l2ZW4gcXVlcnlcbiAqIHdpdGhvdXQgYWN0dWFsbHkgZG93bmxvYWRpbmcgdGhlIGRvY3VtZW50cy5cbiAqXG4gKiBVc2luZyB0aGlzIGZ1bmN0aW9uIHRvIGNvdW50IHRoZSBkb2N1bWVudHMgaXMgZWZmaWNpZW50IGJlY2F1c2Ugb25seSB0aGVcbiAqIGZpbmFsIGNvdW50LCBub3QgdGhlIGRvY3VtZW50cycgZGF0YSwgaXMgZG93bmxvYWRlZC4gVGhpcyBmdW5jdGlvbiBjYW5cbiAqIGNvdW50IHRoZSBkb2N1bWVudHMgaW4gY2FzZXMgd2hlcmUgdGhlIHJlc3VsdCBzZXQgaXMgcHJvaGliaXRpdmVseSBsYXJnZSB0b1xuICogZG93bmxvYWQgZW50aXJlbHkgKHRob3VzYW5kcyBvZiBkb2N1bWVudHMpLlxuICpcbiAqIFRoZSByZXN1bHQgcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyIGlzIHByZXNlbnRlZCwgdW5hbHRlcmVkLCB3aXRob3V0XG4gKiBjb25zaWRlcmluZyBhbnkgbG9jYWwgc3RhdGUuIFRoYXQgaXMsIGRvY3VtZW50cyBpbiB0aGUgbG9jYWwgY2FjaGUgYXJlIG5vdFxuICogdGFrZW4gaW50byBjb25zaWRlcmF0aW9uLCBuZWl0aGVyIGFyZSBsb2NhbCBtb2RpZmljYXRpb25zIG5vdCB5ZXRcbiAqIHN5bmNocm9uaXplZCB3aXRoIHRoZSBzZXJ2ZXIuIFByZXZpb3VzbHktZG93bmxvYWRlZCByZXN1bHRzLCBpZiBhbnksIGFyZSBub3RcbiAqIHVzZWQuIEV2ZXJ5IGludm9jYXRpb24gb2YgdGhpcyBmdW5jdGlvbiBuZWNlc3NhcmlseSBpbnZvbHZlcyBhIHJvdW5kIHRyaXAgdG9cbiAqIHRoZSBzZXJ2ZXIuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IFRoZSBxdWVyeSB3aG9zZSByZXN1bHQgc2V0IHNpemUgaXMgY2FsY3VsYXRlZC5cbiAqIEByZXR1cm5zIEEgUHJvbWlzZSB0aGF0IHdpbGwgYmUgcmVzb2x2ZWQgd2l0aCB0aGUgY291bnQ7IHRoZSBjb3VudCBjYW4gYmVcbiAqIHJldHJpZXZlZCBmcm9tIGBzbmFwc2hvdC5kYXRhKCkuY291bnRgLCB3aGVyZSBgc25hcHNob3RgIGlzIHRoZVxuICogYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgIHRvIHdoaWNoIHRoZSByZXR1cm5lZCBQcm9taXNlIHJlc29sdmVzLlxuICovIGZ1bmN0aW9uIGdldENvdW50RnJvbVNlcnZlcihlKSB7XG4gICAgcmV0dXJuIGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIoZSwge1xuICAgICAgICBjb3VudDogY291bnQoKVxuICAgIH0pO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZXMgdGhlIHNwZWNpZmllZCBhZ2dyZWdhdGlvbnMgb3ZlciB0aGUgZG9jdW1lbnRzIGluIHRoZSByZXN1bHRcbiAqIHNldCBvZiB0aGUgZ2l2ZW4gcXVlcnkgd2l0aG91dCBhY3R1YWxseSBkb3dubG9hZGluZyB0aGUgZG9jdW1lbnRzLlxuICpcbiAqIFVzaW5nIHRoaXMgZnVuY3Rpb24gdG8gcGVyZm9ybSBhZ2dyZWdhdGlvbnMgaXMgZWZmaWNpZW50IGJlY2F1c2Ugb25seSB0aGVcbiAqIGZpbmFsIGFnZ3JlZ2F0aW9uIHZhbHVlcywgbm90IHRoZSBkb2N1bWVudHMnIGRhdGEsIGFyZSBkb3dubG9hZGVkLiBUaGlzXG4gKiBmdW5jdGlvbiBjYW4gcGVyZm9ybSBhZ2dyZWdhdGlvbnMgb2YgdGhlIGRvY3VtZW50cyBpbiBjYXNlcyB3aGVyZSB0aGUgcmVzdWx0XG4gKiBzZXQgaXMgcHJvaGliaXRpdmVseSBsYXJnZSB0byBkb3dubG9hZCBlbnRpcmVseSAodGhvdXNhbmRzIG9mIGRvY3VtZW50cykuXG4gKlxuICogVGhlIHJlc3VsdCByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIgaXMgcHJlc2VudGVkLCB1bmFsdGVyZWQsIHdpdGhvdXRcbiAqIGNvbnNpZGVyaW5nIGFueSBsb2NhbCBzdGF0ZS4gVGhhdCBpcywgZG9jdW1lbnRzIGluIHRoZSBsb2NhbCBjYWNoZSBhcmUgbm90XG4gKiB0YWtlbiBpbnRvIGNvbnNpZGVyYXRpb24sIG5laXRoZXIgYXJlIGxvY2FsIG1vZGlmaWNhdGlvbnMgbm90IHlldFxuICogc3luY2hyb25pemVkIHdpdGggdGhlIHNlcnZlci4gUHJldmlvdXNseS1kb3dubG9hZGVkIHJlc3VsdHMsIGlmIGFueSwgYXJlIG5vdFxuICogdXNlZC4gRXZlcnkgaW52b2NhdGlvbiBvZiB0aGlzIGZ1bmN0aW9uIG5lY2Vzc2FyaWx5IGludm9sdmVzIGEgcm91bmQgdHJpcCB0b1xuICogdGhlIHNlcnZlci5cbiAqXG4gKiBAcGFyYW0gcXVlcnkgVGhlIHF1ZXJ5IHdob3NlIHJlc3VsdCBzZXQgaXMgYWdncmVnYXRlZCBvdmVyLlxuICogQHBhcmFtIGFnZ3JlZ2F0ZVNwZWMgQW4gYEFnZ3JlZ2F0ZVNwZWNgIG9iamVjdCB0aGF0IHNwZWNpZmllcyB0aGUgYWdncmVnYXRlc1xuICogdG8gcGVyZm9ybSBvdmVyIHRoZSByZXN1bHQgc2V0LiBUaGUgQWdncmVnYXRlU3BlYyBzcGVjaWZpZXMgYWxpYXNlcyBmb3IgZWFjaFxuICogYWdncmVnYXRlLCB3aGljaCBjYW4gYmUgdXNlZCB0byByZXRyaWV2ZSB0aGUgYWdncmVnYXRlIHJlc3VsdC5cbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCBhZ2dyZWdhdGVTbmFwc2hvdCA9IGF3YWl0IGdldEFnZ3JlZ2F0ZUZyb21TZXJ2ZXIocXVlcnksIHtcbiAqICAgY291bnRPZkRvY3M6IGNvdW50KCksXG4gKiAgIHRvdGFsSG91cnM6IHN1bSgnaG91cnMnKSxcbiAqICAgYXZlcmFnZVNjb3JlOiBhdmVyYWdlKCdzY29yZScpXG4gKiB9KTtcbiAqXG4gKiBjb25zdCBjb3VudE9mRG9jczogbnVtYmVyID0gYWdncmVnYXRlU25hcHNob3QuZGF0YSgpLmNvdW50T2ZEb2NzO1xuICogY29uc3QgdG90YWxIb3VyczogbnVtYmVyID0gYWdncmVnYXRlU25hcHNob3QuZGF0YSgpLnRvdGFsSG91cnM7XG4gKiBjb25zdCBhdmVyYWdlU2NvcmU6IG51bWJlciB8IG51bGwgPSBhZ2dyZWdhdGVTbmFwc2hvdC5kYXRhKCkuYXZlcmFnZVNjb3JlO1xuICogYGBgXG4gKi8gZnVuY3Rpb24gZ2V0QWdncmVnYXRlRnJvbVNlcnZlcihlLCB0KSB7XG4gICAgY29uc3QgbiA9IF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpLCByID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChuKSwgaSA9IF9fUFJJVkFURV9tYXBUb0FycmF5KHQsICgoZSwgdCkgPT4gbmV3IF9fUFJJVkFURV9BZ2dyZWdhdGVJbXBsKHQsIGUuYWdncmVnYXRlVHlwZSwgZS5faW50ZXJuYWxGaWVsZFBhdGgpKSk7XG4gICAgLy8gUnVuIHRoZSBhZ2dyZWdhdGlvbiBhbmQgY29udmVydCB0aGUgcmVzdWx0c1xuICAgIHJldHVybiBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50UnVuQWdncmVnYXRlUXVlcnkociwgZS5fcXVlcnksIGkpLnRoZW4oKHQgPT4gXG4gICAgLyoqXG4gKiBDb252ZXJ0cyB0aGUgY29yZSBhZ2dyZWdhdGlvbiByZXN1bHQgdG8gYW4gYEFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RgXG4gKiB0aGF0IGNhbiBiZSByZXR1cm5lZCB0byB0aGUgY29uc3VtZXIuXG4gKiBAcGFyYW0gcXVlcnlcbiAqIEBwYXJhbSBhZ2dyZWdhdGVSZXN1bHQgQ29yZSBhZ2dyZWdhdGlvbiByZXN1bHRcbiAqIEBpbnRlcm5hbFxuICovXG4gICAgZnVuY3Rpb24gX19QUklWQVRFX2NvbnZlcnRUb0FnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3QoZSwgdCwgbikge1xuICAgICAgICBjb25zdCByID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcihlKSwgaSA9IG5ldyBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90KHQsIHIsIG4pO1xuICAgICAgICByZXR1cm4gaTtcbiAgICB9XG4gICAgLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gKG4sIGUsIHQpKSk7XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlMb2NhbENhY2hlSW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmtpbmQgPSBcIm1lbW9yeVwiLCB0aGlzLl9vbmxpbmVDb21wb25lbnRQcm92aWRlciA9IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyLCBcbiAgICAgICAgKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuZ2FyYmFnZUNvbGxlY3RvcikgPyB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSBlLmdhcmJhZ2VDb2xsZWN0b3IuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA6IHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IHtcbiAgICAgICAgICAgIGJ1aWxkOiAoKSA9PiBuZXcgX19QUklWQVRFX0xydUdjTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHZvaWQgMClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2luZDogdGhpcy5raW5kXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfUGVyc2lzdGVudExvY2FsQ2FjaGVJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIGxldCB0O1xuICAgICAgICB0aGlzLmtpbmQgPSBcInBlcnNpc3RlbnRcIiwgKG51bGwgPT0gZSA/IHZvaWQgMCA6IGUudGFiTWFuYWdlcikgPyAoZS50YWJNYW5hZ2VyLl9pbml0aWFsaXplKGUpLCBcbiAgICAgICAgdCA9IGUudGFiTWFuYWdlcikgOiAodCA9IHBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyKHZvaWQgMCksIHQuX2luaXRpYWxpemUoZSkpLCBcbiAgICAgICAgdGhpcy5fb25saW5lQ29tcG9uZW50UHJvdmlkZXIgPSB0Ll9vbmxpbmVDb21wb25lbnRQcm92aWRlciwgdGhpcy5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyID0gdC5fb2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3JJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5raW5kID0gXCJtZW1vcnlFYWdlclwiLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSBfX1BSSVZBVEVfTWVtb3J5T2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyO1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbmNsYXNzIF9fUFJJVkFURV9NZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9ySW1wbCB7XG4gICAgY29uc3RydWN0b3IoZSkge1xuICAgICAgICB0aGlzLmtpbmQgPSBcIm1lbW9yeUxydVwiLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSB7XG4gICAgICAgICAgICBidWlsZDogKCkgPT4gbmV3IF9fUFJJVkFURV9McnVHY01lbW9yeU9mZmxpbmVDb21wb25lbnRQcm92aWRlcihlKVxuICAgICAgICB9O1xuICAgIH1cbiAgICB0b0pTT04oKSB7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBraW5kOiB0aGlzLmtpbmRcbiAgICAgICAgfTtcbiAgICB9XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgTWVtb3J5RWFnZXJHYXJiYWdlQ29sbGVjdG9yYC4gVGhpcyBpcyBhbHNvIHRoZVxuICogZGVmYXVsdCBnYXJiYWdlIGNvbGxlY3RvciB1bmxlc3MgaXQgaXMgZXhwbGljaXRseSBzcGVjaWZpZWQgb3RoZXJ3aXNlLlxuICovIGZ1bmN0aW9uIG1lbW9yeUVhZ2VyR2FyYmFnZUNvbGxlY3RvcigpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3JJbXBsO1xufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYE1lbW9yeUxydUdhcmJhZ2VDb2xsZWN0b3JgLlxuICpcbiAqIEEgdGFyZ2V0IHNpemUgY2FuIGJlIHNwZWNpZmllZCBhcyBwYXJ0IG9mIHRoZSBzZXR0aW5nIHBhcmFtZXRlci4gVGhlXG4gKiBjb2xsZWN0b3Igd2lsbCBzdGFydCBkZWxldGluZyBkb2N1bWVudHMgb25jZSB0aGUgY2FjaGUgc2l6ZSBleGNlZWRzXG4gKiB0aGUgZ2l2ZW4gc2l6ZS4gVGhlIGRlZmF1bHQgY2FjaGUgc2l6ZSBpcyA0ME1CICg0MCAqIDEwMjQgKiAxMDI0IGJ5dGVzKS5cbiAqLyBmdW5jdGlvbiBtZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9yKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMcnVHYXJiYWdlQ29sbGVjdG9ySW1wbChudWxsID09IGUgPyB2b2lkIDAgOiBlLmNhY2hlU2l6ZUJ5dGVzKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBNZW1vcnlMb2NhbENhY2hlYC4gVGhlIGluc3RhbmNlIGNhbiBiZSBzZXQgdG9cbiAqIGBGaXJlc3RvcmVTZXR0aW5ncy5jYWNoZWAgdG8gdGVsbCB0aGUgU0RLIHdoaWNoIGNhY2hlIGxheWVyIHRvIHVzZS5cbiAqLyBmdW5jdGlvbiBtZW1vcnlMb2NhbENhY2hlKGUpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NZW1vcnlMb2NhbENhY2hlSW1wbChlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIGBQZXJzaXN0ZW50TG9jYWxDYWNoZWAuIFRoZSBpbnN0YW5jZSBjYW4gYmUgc2V0IHRvXG4gKiBgRmlyZXN0b3JlU2V0dGluZ3MuY2FjaGVgIHRvIHRlbGwgdGhlIFNESyB3aGljaCBjYWNoZSBsYXllciB0byB1c2UuXG4gKlxuICogUGVyc2lzdGVudCBjYWNoZSBjYW5ub3QgYmUgdXNlZCBpbiBhIE5vZGUuanMgZW52aXJvbm1lbnQuXG4gKi8gZnVuY3Rpb24gcGVyc2lzdGVudExvY2FsQ2FjaGUoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX1BlcnNpc3RlbnRMb2NhbENhY2hlSW1wbChlKTtcbn1cblxuY2xhc3MgX19QUklWQVRFX1NpbmdsZVRhYk1hbmFnZXJJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcihlKSB7XG4gICAgICAgIHRoaXMuZm9yY2VPd25lcnNoaXAgPSBlLCB0aGlzLmtpbmQgPSBcInBlcnNpc3RlbnRTaW5nbGVUYWJcIjtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAga2luZDogdGhpcy5raW5kXG4gICAgICAgIH07XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbnRlcm5hbFxuICAgICAqLyAgICBfaW5pdGlhbGl6ZShlKSB7XG4gICAgICAgIHRoaXMuX29ubGluZUNvbXBvbmVudFByb3ZpZGVyID0gT25saW5lQ29tcG9uZW50UHJvdmlkZXIucHJvdmlkZXIsIHRoaXMuX29mZmxpbmVDb21wb25lbnRQcm92aWRlciA9IHtcbiAgICAgICAgICAgIGJ1aWxkOiB0ID0+IG5ldyBfX1BSSVZBVEVfSW5kZXhlZERiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHQsIG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuY2FjaGVTaXplQnl0ZXMsIHRoaXMuZm9yY2VPd25lcnNoaXApXG4gICAgICAgIH07XG4gICAgfVxufVxuXG5jbGFzcyBfX1BSSVZBVEVfTXVsdGlUYWJNYW5hZ2VySW1wbCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMua2luZCA9IFwiUGVyc2lzdGVudE11bHRpcGxlVGFiXCI7XG4gICAgfVxuICAgIHRvSlNPTigpIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIGtpbmQ6IHRoaXMua2luZFxuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaW50ZXJuYWxcbiAgICAgKi8gICAgX2luaXRpYWxpemUoZSkge1xuICAgICAgICB0aGlzLl9vbmxpbmVDb21wb25lbnRQcm92aWRlciA9IE9ubGluZUNvbXBvbmVudFByb3ZpZGVyLnByb3ZpZGVyLCB0aGlzLl9vZmZsaW5lQ29tcG9uZW50UHJvdmlkZXIgPSB7XG4gICAgICAgICAgICBidWlsZDogdCA9PiBuZXcgX19QUklWQVRFX011bHRpVGFiT2ZmbGluZUNvbXBvbmVudFByb3ZpZGVyKHQsIG51bGwgPT0gZSA/IHZvaWQgMCA6IGUuY2FjaGVTaXplQnl0ZXMpXG4gICAgICAgIH07XG4gICAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYW4gaW5zdGFuY2Ugb2YgYFBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyYC5cbiAqXG4gKiBAcGFyYW0gc2V0dGluZ3MgQ29uZmlndXJlcyB0aGUgY3JlYXRlZCB0YWIgbWFuYWdlci5cbiAqLyBmdW5jdGlvbiBwZXJzaXN0ZW50U2luZ2xlVGFiTWFuYWdlcihlKSB7XG4gICAgcmV0dXJuIG5ldyBfX1BSSVZBVEVfU2luZ2xlVGFiTWFuYWdlckltcGwobnVsbCA9PSBlID8gdm9pZCAwIDogZS5mb3JjZU93bmVyc2hpcCk7XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhbiBpbnN0YW5jZSBvZiBgUGVyc2lzdGVudE11bHRpcGxlVGFiTWFuYWdlcmAuXG4gKi8gZnVuY3Rpb24gcGVyc2lzdGVudE11bHRpcGxlVGFiTWFuYWdlcigpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9NdWx0aVRhYk1hbmFnZXJJbXBsO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMiBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqLyBjb25zdCBvbiA9IHtcbiAgICBtYXhBdHRlbXB0czogNVxufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSB3cml0ZSBiYXRjaCwgdXNlZCB0byBwZXJmb3JtIG11bHRpcGxlIHdyaXRlcyBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAqXG4gKiBBIGBXcml0ZUJhdGNoYCBvYmplY3QgY2FuIGJlIGFjcXVpcmVkIGJ5IGNhbGxpbmcge0BsaW5rIHdyaXRlQmF0Y2h9LiBJdFxuICogcHJvdmlkZXMgbWV0aG9kcyBmb3IgYWRkaW5nIHdyaXRlcyB0byB0aGUgd3JpdGUgYmF0Y2guIE5vbmUgb2YgdGhlIHdyaXRlc1xuICogd2lsbCBiZSBjb21taXR0ZWQgKG9yIHZpc2libGUgbG9jYWxseSkgdW50aWwge0BsaW5rIFdyaXRlQmF0Y2guY29tbWl0fSBpc1xuICogY2FsbGVkLlxuICovXG5jbGFzcyBXcml0ZUJhdGNoIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fY29tbWl0SGFuZGxlciA9IHQsIHRoaXMuX211dGF0aW9ucyA9IFtdLCB0aGlzLl9jb21taXR0ZWQgPSAhMSwgXG4gICAgICAgIHRoaXMuX2RhdGFSZWFkZXIgPSBfX1BSSVZBVEVfbmV3VXNlckRhdGFSZWFkZXIoZSk7XG4gICAgfVxuICAgIHNldChlLCB0LCBuKSB7XG4gICAgICAgIHRoaXMuX3ZlcmlmeU5vdENvbW1pdHRlZCgpO1xuICAgICAgICBjb25zdCByID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSksIGkgPSBfX1BSSVZBVEVfYXBwbHlGaXJlc3RvcmVEYXRhQ29udmVydGVyKHIuY29udmVydGVyLCB0LCBuKSwgcyA9IF9fUFJJVkFURV9wYXJzZVNldERhdGEodGhpcy5fZGF0YVJlYWRlciwgXCJXcml0ZUJhdGNoLnNldFwiLCByLl9rZXksIGksIG51bGwgIT09IHIuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucy5wdXNoKHMudG9NdXRhdGlvbihyLl9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpKSwgdGhpcztcbiAgICB9XG4gICAgdXBkYXRlKGUsIHQsIG4sIC4uLnIpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IGkgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgLy8gRm9yIENvbXBhdCB0eXBlcywgd2UgaGF2ZSB0byBcImV4dHJhY3RcIiB0aGUgdW5kZXJseWluZyB0eXBlcyBiZWZvcmVcbiAgICAgICAgLy8gcGVyZm9ybWluZyB2YWxpZGF0aW9uLlxuICAgICAgICAgICAgICAgIGxldCBzO1xuICAgICAgICByZXR1cm4gcyA9IFwic3RyaW5nXCIgPT0gdHlwZW9mICh0ID0gZ2V0TW9kdWxhckluc3RhbmNlKHQpKSB8fCB0IGluc3RhbmNlb2YgRmllbGRQYXRoID8gX19QUklWQVRFX3BhcnNlVXBkYXRlVmFyYXJncyh0aGlzLl9kYXRhUmVhZGVyLCBcIldyaXRlQmF0Y2gudXBkYXRlXCIsIGkuX2tleSwgdCwgbiwgcikgOiBfX1BSSVZBVEVfcGFyc2VVcGRhdGVEYXRhKHRoaXMuX2RhdGFSZWFkZXIsIFwiV3JpdGVCYXRjaC51cGRhdGVcIiwgaS5fa2V5LCB0KSwgXG4gICAgICAgIHRoaXMuX211dGF0aW9ucy5wdXNoKHMudG9NdXRhdGlvbihpLl9rZXksIFByZWNvbmRpdGlvbi5leGlzdHMoITApKSksIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERlbGV0ZXMgdGhlIGRvY3VtZW50IHJlZmVycmVkIHRvIGJ5IHRoZSBwcm92aWRlZCB7QGxpbmsgRG9jdW1lbnRSZWZlcmVuY2V9LlxuICAgICAqXG4gICAgICogQHBhcmFtIGRvY3VtZW50UmVmIC0gQSByZWZlcmVuY2UgdG8gdGhlIGRvY3VtZW50IHRvIGJlIGRlbGV0ZWQuXG4gICAgICogQHJldHVybnMgVGhpcyBgV3JpdGVCYXRjaGAgaW5zdGFuY2UuIFVzZWQgZm9yIGNoYWluaW5nIG1ldGhvZCBjYWxscy5cbiAgICAgKi8gICAgZGVsZXRlKGUpIHtcbiAgICAgICAgdGhpcy5fdmVyaWZ5Tm90Q29tbWl0dGVkKCk7XG4gICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX211dGF0aW9ucyA9IHRoaXMuX211dGF0aW9ucy5jb25jYXQobmV3IF9fUFJJVkFURV9EZWxldGVNdXRhdGlvbih0Ll9rZXksIFByZWNvbmRpdGlvbi5ub25lKCkpKSwgXG4gICAgICAgIHRoaXM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbW1pdHMgYWxsIG9mIHRoZSB3cml0ZXMgaW4gdGhpcyB3cml0ZSBiYXRjaCBhcyBhIHNpbmdsZSBhdG9taWMgdW5pdC5cbiAgICAgKlxuICAgICAqIFRoZSByZXN1bHQgb2YgdGhlc2Ugd3JpdGVzIHdpbGwgb25seSBiZSByZWZsZWN0ZWQgaW4gZG9jdW1lbnQgcmVhZHMgdGhhdFxuICAgICAqIG9jY3VyIGFmdGVyIHRoZSByZXR1cm5lZCBwcm9taXNlIHJlc29sdmVzLiBJZiB0aGUgY2xpZW50IGlzIG9mZmxpbmUsIHRoZVxuICAgICAqIHdyaXRlIGZhaWxzLiBJZiB5b3Ugd291bGQgbGlrZSB0byBzZWUgbG9jYWwgbW9kaWZpY2F0aW9ucyBvciBidWZmZXIgd3JpdGVzXG4gICAgICogdW50aWwgdGhlIGNsaWVudCBpcyBvbmxpbmUsIHVzZSB0aGUgZnVsbCBGaXJlc3RvcmUgU0RLLlxuICAgICAqXG4gICAgICogQHJldHVybnMgQSBgUHJvbWlzZWAgcmVzb2x2ZWQgb25jZSBhbGwgb2YgdGhlIHdyaXRlcyBpbiB0aGUgYmF0Y2ggaGF2ZSBiZWVuXG4gICAgICogc3VjY2Vzc2Z1bGx5IHdyaXR0ZW4gdG8gdGhlIGJhY2tlbmQgYXMgYW4gYXRvbWljIHVuaXQgKG5vdGUgdGhhdCBpdCB3b24ndFxuICAgICAqIHJlc29sdmUgd2hpbGUgeW91J3JlIG9mZmxpbmUpLlxuICAgICAqLyAgICBjb21taXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl92ZXJpZnlOb3RDb21taXR0ZWQoKSwgdGhpcy5fY29tbWl0dGVkID0gITAsIHRoaXMuX211dGF0aW9ucy5sZW5ndGggPiAwID8gdGhpcy5fY29tbWl0SGFuZGxlcih0aGlzLl9tdXRhdGlvbnMpIDogUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIF92ZXJpZnlOb3RDb21taXR0ZWQoKSB7XG4gICAgICAgIGlmICh0aGlzLl9jb21taXR0ZWQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLkZBSUxFRF9QUkVDT05ESVRJT04sIFwiQSB3cml0ZSBiYXRjaCBjYW4gbm8gbG9uZ2VyIGJlIHVzZWQgYWZ0ZXIgY29tbWl0KCkgaGFzIGJlZW4gY2FsbGVkLlwiKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0KSB7XG4gICAgaWYgKChlID0gZ2V0TW9kdWxhckluc3RhbmNlKGUpKS5maXJlc3RvcmUgIT09IHQpIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiUHJvdmlkZWQgZG9jdW1lbnQgcmVmZXJlbmNlIGlzIGZyb20gYSBkaWZmZXJlbnQgRmlyZXN0b3JlIGluc3RhbmNlLlwiKTtcbiAgICByZXR1cm4gZTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIFRPRE8obXJzY2htaWR0KSBDb25zaWRlciB1c2luZyBgQmFzZVRyYW5zYWN0aW9uYCBhcyB0aGUgYmFzZSBjbGFzcyBpbiB0aGVcbi8vIGxlZ2FjeSBTREsuXG4vKipcbiAqIEEgcmVmZXJlbmNlIHRvIGEgdHJhbnNhY3Rpb24uXG4gKlxuICogVGhlIGBUcmFuc2FjdGlvbmAgb2JqZWN0IHBhc3NlZCB0byBhIHRyYW5zYWN0aW9uJ3MgYHVwZGF0ZUZ1bmN0aW9uYCBwcm92aWRlc1xuICogdGhlIG1ldGhvZHMgdG8gcmVhZCBhbmQgd3JpdGUgZGF0YSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uIGNvbnRleHQuIFNlZVxuICoge0BsaW5rIHJ1blRyYW5zYWN0aW9ufS5cbiAqLyBjbGFzcyBUcmFuc2FjdGlvbiQxIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUsIHQpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgdGhpcy5fdHJhbnNhY3Rpb24gPSB0LCB0aGlzLl9kYXRhUmVhZGVyID0gX19QUklWQVRFX25ld1VzZXJEYXRhUmVhZGVyKGUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJlbmNlZCBieSB0aGUgcHJvdmlkZWQge0BsaW5rIERvY3VtZW50UmVmZXJlbmNlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudFJlZiAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBiZSByZWFkLlxuICAgICAqIEByZXR1cm5zIEEgYERvY3VtZW50U25hcHNob3RgIHdpdGggdGhlIHJlYWQgZGF0YS5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IF9fUFJJVkFURV9MaXRlVXNlckRhdGFXcml0ZXIodGhpcy5fZmlyZXN0b3JlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zYWN0aW9uLmxvb2t1cChbIHQuX2tleSBdKS50aGVuKChlID0+IHtcbiAgICAgICAgICAgIGlmICghZSB8fCAxICE9PSBlLmxlbmd0aCkgcmV0dXJuIGZhaWwoKTtcbiAgICAgICAgICAgIGNvbnN0IHIgPSBlWzBdO1xuICAgICAgICAgICAgaWYgKHIuaXNGb3VuZERvY3VtZW50KCkpIHJldHVybiBuZXcgRG9jdW1lbnRTbmFwc2hvdCQxKHRoaXMuX2ZpcmVzdG9yZSwgbiwgci5rZXksIHIsIHQuY29udmVydGVyKTtcbiAgICAgICAgICAgIGlmIChyLmlzTm9Eb2N1bWVudCgpKSByZXR1cm4gbmV3IERvY3VtZW50U25hcHNob3QkMSh0aGlzLl9maXJlc3RvcmUsIG4sIHQuX2tleSwgbnVsbCwgdC5jb252ZXJ0ZXIpO1xuICAgICAgICAgICAgdGhyb3cgZmFpbCgpO1xuICAgICAgICB9KSk7XG4gICAgfVxuICAgIHNldChlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfdmFsaWRhdGVSZWZlcmVuY2UoZSwgdGhpcy5fZmlyZXN0b3JlKSwgaSA9IF9fUFJJVkFURV9hcHBseUZpcmVzdG9yZURhdGFDb252ZXJ0ZXIoci5jb252ZXJ0ZXIsIHQsIG4pLCBzID0gX19QUklWQVRFX3BhcnNlU2V0RGF0YSh0aGlzLl9kYXRhUmVhZGVyLCBcIlRyYW5zYWN0aW9uLnNldFwiLCByLl9rZXksIGksIG51bGwgIT09IHIuY29udmVydGVyLCBuKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RyYW5zYWN0aW9uLnNldChyLl9rZXksIHMpLCB0aGlzO1xuICAgIH1cbiAgICB1cGRhdGUoZSwgdCwgbiwgLi4ucikge1xuICAgICAgICBjb25zdCBpID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIC8vIEZvciBDb21wYXQgdHlwZXMsIHdlIGhhdmUgdG8gXCJleHRyYWN0XCIgdGhlIHVuZGVybHlpbmcgdHlwZXMgYmVmb3JlXG4gICAgICAgIC8vIHBlcmZvcm1pbmcgdmFsaWRhdGlvbi5cbiAgICAgICAgICAgICAgICBsZXQgcztcbiAgICAgICAgcmV0dXJuIHMgPSBcInN0cmluZ1wiID09IHR5cGVvZiAodCA9IGdldE1vZHVsYXJJbnN0YW5jZSh0KSkgfHwgdCBpbnN0YW5jZW9mIEZpZWxkUGF0aCA/IF9fUFJJVkFURV9wYXJzZVVwZGF0ZVZhcmFyZ3ModGhpcy5fZGF0YVJlYWRlciwgXCJUcmFuc2FjdGlvbi51cGRhdGVcIiwgaS5fa2V5LCB0LCBuLCByKSA6IF9fUFJJVkFURV9wYXJzZVVwZGF0ZURhdGEodGhpcy5fZGF0YVJlYWRlciwgXCJUcmFuc2FjdGlvbi51cGRhdGVcIiwgaS5fa2V5LCB0KSwgXG4gICAgICAgIHRoaXMuX3RyYW5zYWN0aW9uLnVwZGF0ZShpLl9rZXksIHMpLCB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBEZWxldGVzIHRoZSBkb2N1bWVudCByZWZlcnJlZCB0byBieSB0aGUgcHJvdmlkZWQge0BsaW5rIERvY3VtZW50UmVmZXJlbmNlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudFJlZiAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBiZSBkZWxldGVkLlxuICAgICAqIEByZXR1cm5zIFRoaXMgYFRyYW5zYWN0aW9uYCBpbnN0YW5jZS4gVXNlZCBmb3IgY2hhaW5pbmcgbWV0aG9kIGNhbGxzLlxuICAgICAqLyAgICBkZWxldGUoZSkge1xuICAgICAgICBjb25zdCB0ID0gX19QUklWQVRFX3ZhbGlkYXRlUmVmZXJlbmNlKGUsIHRoaXMuX2ZpcmVzdG9yZSk7XG4gICAgICAgIHJldHVybiB0aGlzLl90cmFuc2FjdGlvbi5kZWxldGUodC5fa2V5KSwgdGhpcztcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgcmVmZXJlbmNlIHRvIGEgdHJhbnNhY3Rpb24uXG4gKlxuICogVGhlIGBUcmFuc2FjdGlvbmAgb2JqZWN0IHBhc3NlZCB0byBhIHRyYW5zYWN0aW9uJ3MgYHVwZGF0ZUZ1bmN0aW9uYCBwcm92aWRlc1xuICogdGhlIG1ldGhvZHMgdG8gcmVhZCBhbmQgd3JpdGUgZGF0YSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uIGNvbnRleHQuIFNlZVxuICoge0BsaW5rIHJ1blRyYW5zYWN0aW9ufS5cbiAqLyBjbGFzcyBUcmFuc2FjdGlvbiBleHRlbmRzIFRyYW5zYWN0aW9uJDEge1xuICAgIC8vIFRoaXMgY2xhc3MgaW1wbGVtZW50cyB0aGUgc2FtZSBsb2dpYyBhcyB0aGUgVHJhbnNhY3Rpb24gQVBJIGluIHRoZSBMaXRlIFNES1xuICAgIC8vIGJ1dCBpcyBzdWJjbGFzc2VkIGluIG9yZGVyIHRvIHJldHVybiBpdHMgb3duIERvY3VtZW50U25hcHNob3QgdHlwZXMuXG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihlLCB0KSB7XG4gICAgICAgIHN1cGVyKGUsIHQpLCB0aGlzLl9maXJlc3RvcmUgPSBlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZWFkcyB0aGUgZG9jdW1lbnQgcmVmZXJlbmNlZCBieSB0aGUgcHJvdmlkZWQge0BsaW5rIERvY3VtZW50UmVmZXJlbmNlfS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBkb2N1bWVudFJlZiAtIEEgcmVmZXJlbmNlIHRvIHRoZSBkb2N1bWVudCB0byBiZSByZWFkLlxuICAgICAqIEByZXR1cm5zIEEgYERvY3VtZW50U25hcHNob3RgIHdpdGggdGhlIHJlYWQgZGF0YS5cbiAgICAgKi8gICAgZ2V0KGUpIHtcbiAgICAgICAgY29uc3QgdCA9IF9fUFJJVkFURV92YWxpZGF0ZVJlZmVyZW5jZShlLCB0aGlzLl9maXJlc3RvcmUpLCBuID0gbmV3IF9fUFJJVkFURV9FeHBVc2VyRGF0YVdyaXRlcih0aGlzLl9maXJlc3RvcmUpO1xuICAgICAgICByZXR1cm4gc3VwZXIuZ2V0KGUpLnRoZW4oKGUgPT4gbmV3IERvY3VtZW50U25hcHNob3QodGhpcy5fZmlyZXN0b3JlLCBuLCB0Ll9rZXksIGUuX2RvY3VtZW50LCBuZXcgU25hcHNob3RNZXRhZGF0YShcbiAgICAgICAgLyogaGFzUGVuZGluZ1dyaXRlcz0gKi8gITEsIFxuICAgICAgICAvKiBmcm9tQ2FjaGU9ICovICExKSwgdC5jb252ZXJ0ZXIpKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEV4ZWN1dGVzIHRoZSBnaXZlbiBgdXBkYXRlRnVuY3Rpb25gIGFuZCB0aGVuIGF0dGVtcHRzIHRvIGNvbW1pdCB0aGUgY2hhbmdlc1xuICogYXBwbGllZCB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uLiBJZiBhbnkgZG9jdW1lbnQgcmVhZCB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uXG4gKiBoYXMgY2hhbmdlZCwgQ2xvdWQgRmlyZXN0b3JlIHJldHJpZXMgdGhlIGB1cGRhdGVGdW5jdGlvbmAuIElmIGl0IGZhaWxzIHRvXG4gKiBjb21taXQgYWZ0ZXIgNSBhdHRlbXB0cywgdGhlIHRyYW5zYWN0aW9uIGZhaWxzLlxuICpcbiAqIFRoZSBtYXhpbXVtIG51bWJlciBvZiB3cml0ZXMgYWxsb3dlZCBpbiBhIHNpbmdsZSB0cmFuc2FjdGlvbiBpcyA1MDAuXG4gKlxuICogQHBhcmFtIGZpcmVzdG9yZSAtIEEgcmVmZXJlbmNlIHRvIHRoZSBGaXJlc3RvcmUgZGF0YWJhc2UgdG8gcnVuIHRoaXNcbiAqIHRyYW5zYWN0aW9uIGFnYWluc3QuXG4gKiBAcGFyYW0gdXBkYXRlRnVuY3Rpb24gLSBUaGUgZnVuY3Rpb24gdG8gZXhlY3V0ZSB3aXRoaW4gdGhlIHRyYW5zYWN0aW9uXG4gKiBjb250ZXh0LlxuICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgbWF4aW11bSBudW1iZXIgb2YgYXR0ZW1wdHMgdG9cbiAqIGNvbW1pdC5cbiAqIEByZXR1cm5zIElmIHRoZSB0cmFuc2FjdGlvbiBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IG9yIHdhcyBleHBsaWNpdGx5IGFib3J0ZWRcbiAqICh0aGUgYHVwZGF0ZUZ1bmN0aW9uYCByZXR1cm5lZCBhIGZhaWxlZCBwcm9taXNlKSwgdGhlIHByb21pc2UgcmV0dXJuZWQgYnkgdGhlXG4gKiBgdXBkYXRlRnVuY3Rpb24gYGlzIHJldHVybmVkIGhlcmUuIE90aGVyd2lzZSwgaWYgdGhlIHRyYW5zYWN0aW9uIGZhaWxlZCwgYVxuICogcmVqZWN0ZWQgcHJvbWlzZSB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIGZhaWx1cmUgZXJyb3IgaXMgcmV0dXJuZWQuXG4gKi8gZnVuY3Rpb24gcnVuVHJhbnNhY3Rpb24oZSwgdCwgbikge1xuICAgIGUgPSBfX1BSSVZBVEVfY2FzdChlLCBGaXJlc3RvcmUpO1xuICAgIGNvbnN0IHIgPSBPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sIG9uKSwgbik7XG4gICAgIWZ1bmN0aW9uIF9fUFJJVkFURV92YWxpZGF0ZVRyYW5zYWN0aW9uT3B0aW9ucyhlKSB7XG4gICAgICAgIGlmIChlLm1heEF0dGVtcHRzIDwgMSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJNYXggYXR0ZW1wdHMgbXVzdCBiZSBhdCBsZWFzdCAxXCIpO1xuICAgIH0ocik7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIF9fUFJJVkFURV9maXJlc3RvcmVDbGllbnRUcmFuc2FjdGlvbihlLCB0LCBuKSB7XG4gICAgICAgIGNvbnN0IHIgPSBuZXcgX19QUklWQVRFX0RlZmVycmVkO1xuICAgICAgICByZXR1cm4gZS5hc3luY1F1ZXVlLmVucXVldWVBbmRGb3JnZXQoKGFzeW5jICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGkgPSBhd2FpdCBfX1BSSVZBVEVfZ2V0RGF0YXN0b3JlKGUpO1xuICAgICAgICAgICAgbmV3IF9fUFJJVkFURV9UcmFuc2FjdGlvblJ1bm5lcihlLmFzeW5jUXVldWUsIGksIG4sIHQsIHIpLkl1KCk7XG4gICAgICAgIH0pKSwgci5wcm9taXNlO1xuICAgIH0oZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlKSwgKG4gPT4gdChuZXcgVHJhbnNhY3Rpb24oZSwgbikpKSwgcik7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDIwIEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgYSBzZW50aW5lbCBmb3IgdXNlIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSBvclxuICoge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSB3aXRoIGB7bWVyZ2U6IHRydWV9YCB0byBtYXJrIGEgZmllbGQgZm9yIGRlbGV0aW9uLlxuICovIGZ1bmN0aW9uIGRlbGV0ZUZpZWxkKCkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX0RlbGV0ZUZpZWxkVmFsdWVJbXBsKFwiZGVsZXRlRmllbGRcIik7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNlbnRpbmVsIHVzZWQgd2l0aCB7QGxpbmsgQGZpcmViYXNlL2ZpcmVzdG9yZS9saXRlIyhzZXREb2M6MSl9IG9yIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHVwZGF0ZURvYzoxKX0gdG9cbiAqIGluY2x1ZGUgYSBzZXJ2ZXItZ2VuZXJhdGVkIHRpbWVzdGFtcCBpbiB0aGUgd3JpdHRlbiBkYXRhLlxuICovIGZ1bmN0aW9uIHNlcnZlclRpbWVzdGFtcCgpIHtcbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9TZXJ2ZXJUaW1lc3RhbXBGaWVsZFZhbHVlSW1wbChcInNlcnZlclRpbWVzdGFtcFwiKTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgc3BlY2lhbCB2YWx1ZSB0aGF0IGNhbiBiZSB1c2VkIHdpdGgge0BsaW5rIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSMoc2V0RG9jOjEpfSBvciB7QGxpbmtcbiAqIEBmaXJlYmFzZS9maXJlc3RvcmUvbGl0ZSModXBkYXRlRG9jOjEpfSB0aGF0IHRlbGxzIHRoZSBzZXJ2ZXIgdG8gdW5pb24gdGhlIGdpdmVuIGVsZW1lbnRzIHdpdGggYW55IGFycmF5XG4gKiB2YWx1ZSB0aGF0IGFscmVhZHkgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIuIEVhY2ggc3BlY2lmaWVkIGVsZW1lbnQgdGhhdCBkb2Vzbid0XG4gKiBhbHJlYWR5IGV4aXN0IGluIHRoZSBhcnJheSB3aWxsIGJlIGFkZGVkIHRvIHRoZSBlbmQuIElmIHRoZSBmaWVsZCBiZWluZ1xuICogbW9kaWZpZWQgaXMgbm90IGFscmVhZHkgYW4gYXJyYXkgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIGFuIGFycmF5XG4gKiBjb250YWluaW5nIGV4YWN0bHkgdGhlIHNwZWNpZmllZCBlbGVtZW50cy5cbiAqXG4gKiBAcGFyYW0gZWxlbWVudHMgLSBUaGUgZWxlbWVudHMgdG8gdW5pb24gaW50byB0aGUgYXJyYXkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWAuXG4gKi8gZnVuY3Rpb24gYXJyYXlVbmlvbiguLi5lKSB7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgYWN0dWFsbHkgcGFyc2UgdGhlIGRhdGEgdW50aWwgaXQncyB1c2VkIGluIHNldCgpIG9yXG4gICAgLy8gdXBkYXRlKCkgc2luY2Ugd2UnZCBuZWVkIHRoZSBGaXJlc3RvcmUgaW5zdGFuY2UgdG8gZG8gdGhpcy5cbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9BcnJheVVuaW9uRmllbGRWYWx1ZUltcGwoXCJhcnJheVVuaW9uXCIsIGUpO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBzcGVjaWFsIHZhbHVlIHRoYXQgY2FuIGJlIHVzZWQgd2l0aCB7QGxpbmsgKHNldERvYzoxKX0gb3Ige0BsaW5rXG4gKiB1cGRhdGVEb2M6MX0gdGhhdCB0ZWxscyB0aGUgc2VydmVyIHRvIHJlbW92ZSB0aGUgZ2l2ZW4gZWxlbWVudHMgZnJvbSBhbnlcbiAqIGFycmF5IHZhbHVlIHRoYXQgYWxyZWFkeSBleGlzdHMgb24gdGhlIHNlcnZlci4gQWxsIGluc3RhbmNlcyBvZiBlYWNoIGVsZW1lbnRcbiAqIHNwZWNpZmllZCB3aWxsIGJlIHJlbW92ZWQgZnJvbSB0aGUgYXJyYXkuIElmIHRoZSBmaWVsZCBiZWluZyBtb2RpZmllZCBpcyBub3RcbiAqIGFscmVhZHkgYW4gYXJyYXkgaXQgd2lsbCBiZSBvdmVyd3JpdHRlbiB3aXRoIGFuIGVtcHR5IGFycmF5LlxuICpcbiAqIEBwYXJhbSBlbGVtZW50cyAtIFRoZSBlbGVtZW50cyB0byByZW1vdmUgZnJvbSB0aGUgYXJyYXkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWBcbiAqLyBmdW5jdGlvbiBhcnJheVJlbW92ZSguLi5lKSB7XG4gICAgLy8gTk9URTogV2UgZG9uJ3QgYWN0dWFsbHkgcGFyc2UgdGhlIGRhdGEgdW50aWwgaXQncyB1c2VkIGluIHNldCgpIG9yXG4gICAgLy8gdXBkYXRlKCkgc2luY2Ugd2UnZCBuZWVkIHRoZSBGaXJlc3RvcmUgaW5zdGFuY2UgdG8gZG8gdGhpcy5cbiAgICByZXR1cm4gbmV3IF9fUFJJVkFURV9BcnJheVJlbW92ZUZpZWxkVmFsdWVJbXBsKFwiYXJyYXlSZW1vdmVcIiwgZSk7XG59XG5cbi8qKlxuICogUmV0dXJucyBhIHNwZWNpYWwgdmFsdWUgdGhhdCBjYW4gYmUgdXNlZCB3aXRoIHtAbGluayBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHNldERvYzoxKX0gb3Ige0BsaW5rXG4gKiBAZmlyZWJhc2UvZmlyZXN0b3JlL2xpdGUjKHVwZGF0ZURvYzoxKX0gdGhhdCB0ZWxscyB0aGUgc2VydmVyIHRvIGluY3JlbWVudCB0aGUgZmllbGQncyBjdXJyZW50IHZhbHVlIGJ5XG4gKiB0aGUgZ2l2ZW4gdmFsdWUuXG4gKlxuICogSWYgZWl0aGVyIHRoZSBvcGVyYW5kIG9yIHRoZSBjdXJyZW50IGZpZWxkIHZhbHVlIHVzZXMgZmxvYXRpbmcgcG9pbnRcbiAqIHByZWNpc2lvbiwgYWxsIGFyaXRobWV0aWMgZm9sbG93cyBJRUVFIDc1NCBzZW1hbnRpY3MuIElmIGJvdGggdmFsdWVzIGFyZVxuICogaW50ZWdlcnMsIHZhbHVlcyBvdXRzaWRlIG9mIEphdmFTY3JpcHQncyBzYWZlIG51bWJlciByYW5nZVxuICogKGBOdW1iZXIuTUlOX1NBRkVfSU5URUdFUmAgdG8gYE51bWJlci5NQVhfU0FGRV9JTlRFR0VSYCkgYXJlIGFsc28gc3ViamVjdCB0b1xuICogcHJlY2lzaW9uIGxvc3MuIEZ1cnRoZXJtb3JlLCBvbmNlIHByb2Nlc3NlZCBieSB0aGUgRmlyZXN0b3JlIGJhY2tlbmQsIGFsbFxuICogaW50ZWdlciBvcGVyYXRpb25zIGFyZSBjYXBwZWQgYmV0d2VlbiAtMl42MyBhbmQgMl42My0xLlxuICpcbiAqIElmIHRoZSBjdXJyZW50IGZpZWxkIHZhbHVlIGlzIG5vdCBvZiB0eXBlIGBudW1iZXJgLCBvciBpZiB0aGUgZmllbGQgZG9lcyBub3RcbiAqIHlldCBleGlzdCwgdGhlIHRyYW5zZm9ybWF0aW9uIHNldHMgdGhlIGZpZWxkIHRvIHRoZSBnaXZlbiB2YWx1ZS5cbiAqXG4gKiBAcGFyYW0gbiAtIFRoZSB2YWx1ZSB0byBpbmNyZW1lbnQgYnkuXG4gKiBAcmV0dXJucyBUaGUgYEZpZWxkVmFsdWVgIHNlbnRpbmVsIGZvciB1c2UgaW4gYSBjYWxsIHRvIGBzZXREb2MoKWAgb3JcbiAqIGB1cGRhdGVEb2MoKWBcbiAqLyBmdW5jdGlvbiBpbmNyZW1lbnQoZSkge1xuICAgIHJldHVybiBuZXcgX19QUklWQVRFX051bWVyaWNJbmNyZW1lbnRGaWVsZFZhbHVlSW1wbChcImluY3JlbWVudFwiLCBlKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBWZWN0b3JWYWx1ZWAgY29uc3RydWN0ZWQgd2l0aCBhIGNvcHkgb2YgdGhlIGdpdmVuIGFycmF5IG9mIG51bWJlcnMuXG4gKlxuICogQHBhcmFtIHZhbHVlcyAtIENyZWF0ZSBhIGBWZWN0b3JWYWx1ZWAgaW5zdGFuY2Ugd2l0aCBhIGNvcHkgb2YgdGhpcyBhcnJheSBvZiBudW1iZXJzLlxuICpcbiAqIEByZXR1cm5zIEEgbmV3IGBWZWN0b3JWYWx1ZWAgY29uc3RydWN0ZWQgd2l0aCBhIGNvcHkgb2YgdGhlIGdpdmVuIGFycmF5IG9mIG51bWJlcnMuXG4gKi8gZnVuY3Rpb24gdmVjdG9yKGUpIHtcbiAgICByZXR1cm4gbmV3IFZlY3RvclZhbHVlKGUpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBDcmVhdGVzIGEgd3JpdGUgYmF0Y2gsIHVzZWQgZm9yIHBlcmZvcm1pbmcgbXVsdGlwbGUgd3JpdGVzIGFzIGEgc2luZ2xlXG4gKiBhdG9taWMgb3BlcmF0aW9uLiBUaGUgbWF4aW11bSBudW1iZXIgb2Ygd3JpdGVzIGFsbG93ZWQgaW4gYSBzaW5nbGUge0BsaW5rIFdyaXRlQmF0Y2h9XG4gKiBpcyA1MDAuXG4gKlxuICogVW5saWtlIHRyYW5zYWN0aW9ucywgd3JpdGUgYmF0Y2hlcyBhcmUgcGVyc2lzdGVkIG9mZmxpbmUgYW5kIHRoZXJlZm9yZSBhcmVcbiAqIHByZWZlcmFibGUgd2hlbiB5b3UgZG9uJ3QgbmVlZCB0byBjb25kaXRpb24geW91ciB3cml0ZXMgb24gcmVhZCBkYXRhLlxuICpcbiAqIEByZXR1cm5zIEEge0BsaW5rIFdyaXRlQmF0Y2h9IHRoYXQgY2FuIGJlIHVzZWQgdG8gYXRvbWljYWxseSBleGVjdXRlIG11bHRpcGxlXG4gKiB3cml0ZXMuXG4gKi8gZnVuY3Rpb24gd3JpdGVCYXRjaChlKSB7XG4gICAgcmV0dXJuIGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSkpLCBuZXcgV3JpdGVCYXRjaChlLCAodCA9PiBleGVjdXRlV3JpdGUoZSwgdCkpKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi8gZnVuY3Rpb24gc2V0SW5kZXhDb25maWd1cmF0aW9uKGUsIHQpIHtcbiAgICBjb25zdCBuID0gZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZChlID0gX19QUklWQVRFX2Nhc3QoZSwgRmlyZXN0b3JlKSk7XG4gICAgaWYgKCFuLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyIHx8IFwibWVtb3J5XCIgPT09IG4uX3VuaW5pdGlhbGl6ZWRDb21wb25lbnRzUHJvdmlkZXIuX29mZmxpbmUua2luZCkgXG4gICAgLy8gUE9SVElORyBOT1RFOiBXZSBkb24ndCByZXR1cm4gYW4gZXJyb3IgaWYgdGhlIHVzZXIgaGFzIG5vdCBlbmFibGVkXG4gICAgLy8gcGVyc2lzdGVuY2Ugc2luY2UgYGVuYWJsZUluZGV4ZWRkYlBlcnNpc3RlbmNlKClgIGNhbiBmYWlsIG9uIHRoZSBXZWIuXG4gICAgcmV0dXJuIF9fUFJJVkFURV9sb2dXYXJuKFwiQ2Fubm90IGVuYWJsZSBpbmRleGVzIHdoZW4gcGVyc2lzdGVuY2UgaXMgZGlzYWJsZWRcIiksIFxuICAgIFByb21pc2UucmVzb2x2ZSgpO1xuICAgIGNvbnN0IHIgPSBmdW5jdGlvbiBfX1BSSVZBVEVfcGFyc2VJbmRleGVzKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFwic3RyaW5nXCIgPT0gdHlwZW9mIGUgPyBmdW5jdGlvbiBfX1BSSVZBVEVfdHJ5UGFyc2VKc29uKGUpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoZSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgXCJGYWlsZWQgdG8gcGFyc2UgSlNPTjogXCIgKyAobnVsbCA9PSBlID8gdm9pZCAwIDogZS5tZXNzYWdlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0oZSkgOiBlLCBuID0gW107XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHQuaW5kZXhlcykpIGZvciAoY29uc3QgZSBvZiB0LmluZGV4ZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IHQgPSBfX1BSSVZBVEVfdHJ5R2V0U3RyaW5nKGUsIFwiY29sbGVjdGlvbkdyb3VwXCIpLCByID0gW107XG4gICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShlLmZpZWxkcykpIGZvciAoY29uc3QgdCBvZiBlLmZpZWxkcykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGUgPSBfX1BSSVZBVEVfZmllbGRQYXRoRnJvbURvdFNlcGFyYXRlZFN0cmluZyhcInNldEluZGV4Q29uZmlndXJhdGlvblwiLCBfX1BSSVZBVEVfdHJ5R2V0U3RyaW5nKHQsIFwiZmllbGRQYXRoXCIpKTtcbiAgICAgICAgICAgICAgICBcIkNPTlRBSU5TXCIgPT09IHQuYXJyYXlDb25maWcgPyByLnB1c2gobmV3IEluZGV4U2VnbWVudChlLCAyIC8qIEluZGV4S2luZC5DT05UQUlOUyAqLykpIDogXCJBU0NFTkRJTkdcIiA9PT0gdC5vcmRlciA/IHIucHVzaChuZXcgSW5kZXhTZWdtZW50KGUsIDAgLyogSW5kZXhLaW5kLkFTQ0VORElORyAqLykpIDogXCJERVNDRU5ESU5HXCIgPT09IHQub3JkZXIgJiYgci5wdXNoKG5ldyBJbmRleFNlZ21lbnQoZSwgMSAvKiBJbmRleEtpbmQuREVTQ0VORElORyAqLykpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbi5wdXNoKG5ldyBGaWVsZEluZGV4KEZpZWxkSW5kZXguVU5LTk9XTl9JRCwgdCwgciwgSW5kZXhTdGF0ZS5lbXB0eSgpKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfSh0KTtcbiAgICByZXR1cm4gX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFNldEluZGV4Q29uZmlndXJhdGlvbihuLCByKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3RyeUdldFN0cmluZyhlLCB0KSB7XG4gICAgaWYgKFwic3RyaW5nXCIgIT0gdHlwZW9mIGVbdF0pIHRocm93IG5ldyBGaXJlc3RvcmVFcnJvcihDLklOVkFMSURfQVJHVU1FTlQsIFwiTWlzc2luZyBzdHJpbmcgdmFsdWUgZm9yOiBcIiArIHQpO1xuICAgIHJldHVybiBlW3RdO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGBQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXJgIGZvciBjb25maWd1cmluZyBwZXJzaXN0ZW50IGNhY2hlIGluZGV4ZXMgdXNlZFxuICogZm9yIGxvY2FsIHF1ZXJ5IGV4ZWN1dGlvbi5cbiAqXG4gKiBUbyB1c2UsIGNhbGwgYGdldFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlcigpYCB0byBnZXQgYW4gaW5zdGFuY2UuXG4gKi8gY2xhc3MgUGVyc2lzdGVudENhY2hlSW5kZXhNYW5hZ2VyIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKGUpIHtcbiAgICAgICAgdGhpcy5fZmlyZXN0b3JlID0gZSwgXG4gICAgICAgIC8qKiBBIHR5cGUgc3RyaW5nIHRvIHVuaXF1ZWx5IGlkZW50aWZ5IGluc3RhbmNlcyBvZiB0aGlzIGNsYXNzLiAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBcIlBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlclwiO1xuICAgIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIHRoZSBQZXJzaXN0ZW50Q2FjaGUgSW5kZXggTWFuYWdlciB1c2VkIGJ5IHRoZSBnaXZlbiBgRmlyZXN0b3JlYFxuICogb2JqZWN0LlxuICpcbiAqIEByZXR1cm4gVGhlIGBQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXJgIGluc3RhbmNlLCBvciBgbnVsbGAgaWYgbG9jYWxcbiAqIHBlcnNpc3RlbnQgc3RvcmFnZSBpcyBub3QgaW4gdXNlLlxuICovIGZ1bmN0aW9uIGdldFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlcihlKSB7XG4gICAgdmFyIHQ7XG4gICAgZSA9IF9fUFJJVkFURV9jYXN0KGUsIEZpcmVzdG9yZSk7XG4gICAgY29uc3QgbiA9IF9uLmdldChlKTtcbiAgICBpZiAobikgcmV0dXJuIG47XG4gICAgaWYgKFwicGVyc2lzdGVudFwiICE9PSAobnVsbCA9PT0gKHQgPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUpLl91bmluaXRpYWxpemVkQ29tcG9uZW50c1Byb3ZpZGVyKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0Ll9vZmZsaW5lLmtpbmQpKSByZXR1cm4gbnVsbDtcbiAgICBjb25zdCByID0gbmV3IFBlcnNpc3RlbnRDYWNoZUluZGV4TWFuYWdlcihlKTtcbiAgICByZXR1cm4gX24uc2V0KGUsIHIpLCByO1xufVxuXG4vKipcbiAqIEVuYWJsZXMgdGhlIFNESyB0byBjcmVhdGUgcGVyc2lzdGVudCBjYWNoZSBpbmRleGVzIGF1dG9tYXRpY2FsbHkgZm9yIGxvY2FsXG4gKiBxdWVyeSBleGVjdXRpb24gd2hlbiB0aGUgU0RLIGJlbGlldmVzIGNhY2hlIGluZGV4ZXMgY2FuIGhlbHAgaW1wcm92ZVxuICogcGVyZm9ybWFuY2UuXG4gKlxuICogVGhpcyBmZWF0dXJlIGlzIGRpc2FibGVkIGJ5IGRlZmF1bHQuXG4gKi8gZnVuY3Rpb24gZW5hYmxlUGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb24oZSkge1xuICAgIF9fUFJJVkFURV9zZXRQZXJzaXN0ZW50Q2FjaGVJbmRleEF1dG9DcmVhdGlvbkVuYWJsZWQoZSwgITApO1xufVxuXG4vKipcbiAqIFN0b3BzIGNyZWF0aW5nIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXhlcyBhdXRvbWF0aWNhbGx5IGZvciBsb2NhbCBxdWVyeVxuICogZXhlY3V0aW9uLiBUaGUgaW5kZXhlcyB3aGljaCBoYXZlIGJlZW4gY3JlYXRlZCBieSBjYWxsaW5nXG4gKiBgZW5hYmxlUGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb24oKWAgc3RpbGwgdGFrZSBlZmZlY3QuXG4gKi8gZnVuY3Rpb24gZGlzYWJsZVBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uKGUpIHtcbiAgICBfX1BSSVZBVEVfc2V0UGVyc2lzdGVudENhY2hlSW5kZXhBdXRvQ3JlYXRpb25FbmFibGVkKGUsICExKTtcbn1cblxuLyoqXG4gKiBSZW1vdmVzIGFsbCBwZXJzaXN0ZW50IGNhY2hlIGluZGV4ZXMuXG4gKlxuICogUGxlYXNlIG5vdGUgdGhpcyBmdW5jdGlvbiB3aWxsIGFsc28gZGVsZXRlcyBpbmRleGVzIGdlbmVyYXRlZCBieVxuICogYHNldEluZGV4Q29uZmlndXJhdGlvbigpYCwgd2hpY2ggaXMgZGVwcmVjYXRlZC5cbiAqLyBmdW5jdGlvbiBkZWxldGVBbGxQZXJzaXN0ZW50Q2FjaGVJbmRleGVzKGUpIHtcbiAgICBfX1BSSVZBVEVfZmlyZXN0b3JlQ2xpZW50RGVsZXRlQWxsRmllbGRJbmRleGVzKGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoZS5fZmlyZXN0b3JlKSkudGhlbigoZSA9PiBfX1BSSVZBVEVfbG9nRGVidWcoXCJkZWxldGluZyBhbGwgcGVyc2lzdGVudCBjYWNoZSBpbmRleGVzIHN1Y2NlZWRlZFwiKSkpLmNhdGNoKChlID0+IF9fUFJJVkFURV9sb2dXYXJuKFwiZGVsZXRpbmcgYWxsIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXhlcyBmYWlsZWRcIiwgZSkpKTtcbn1cblxuZnVuY3Rpb24gX19QUklWQVRFX3NldFBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uRW5hYmxlZChlLCB0KSB7XG4gICAgX19QUklWQVRFX2ZpcmVzdG9yZUNsaWVudFNldFBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uRW5hYmxlZChlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKGUuX2ZpcmVzdG9yZSksIHQpLnRoZW4oKGUgPT4gX19QUklWQVRFX2xvZ0RlYnVnKGBzZXR0aW5nIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXggYXV0byBjcmVhdGlvbiBpc0VuYWJsZWQ9JHt0fSBzdWNjZWVkZWRgKSkpLmNhdGNoKChlID0+IF9fUFJJVkFURV9sb2dXYXJuKGBzZXR0aW5nIHBlcnNpc3RlbnQgY2FjaGUgaW5kZXggYXV0byBjcmVhdGlvbiBpc0VuYWJsZWQ9JHt0fSBmYWlsZWRgLCBlKSkpO1xufVxuXG4vKipcbiAqIE1hcHMgYEZpcmVzdG9yZWAgaW5zdGFuY2VzIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmdcbiAqIGBQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXJgIGluc3RhbmNlcy5cbiAqXG4gKiBVc2UgYSBgV2Vha01hcGAgc28gdGhhdCB0aGUgbWFwcGluZyB3aWxsIGJlIGF1dG9tYXRpY2FsbHkgZHJvcHBlZCB3aGVuIHRoZVxuICogYEZpcmVzdG9yZWAgaW5zdGFuY2UgaXMgZ2FyYmFnZSBjb2xsZWN0ZWQuIFRoaXMgZW11bGF0ZXMgYSBwcml2YXRlIG1lbWJlclxuICogYXMgZGVzY3JpYmVkIGluIGh0dHBzOi8vZ29vLmdsZS80NTR5dnVnLlxuICovIGNvbnN0IF9uID0gbmV3IFdlYWtNYXA7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEBpbnRlcm5hbFxuICogQHByaXZhdGVcbiAqXG4gKiBUaGlzIGZ1bmN0aW9uIGlzIGZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAqXG4gKiBSZXR1cm5zIHRoZSBgUXVlcnlUYXJnZXRgIHJlcHJlc2VudGF0aW9uIG9mIHRoZSBnaXZlbiBxdWVyeS4gUmV0dXJucyBgbnVsbGBcbiAqIGlmIHRoZSBGaXJlc3RvcmUgY2xpZW50IGFzc29jaWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gcXVlcnkgaGFzIG5vdCBiZWVuXG4gKiBpbml0aWFsaXplZCBvciBoYXMgYmVlbiB0ZXJtaW5hdGVkLlxuICpcbiAqIEBwYXJhbSBxdWVyeSAtIFRoZSBRdWVyeSB0byBjb252ZXJ0IHRvIHByb3RvIHJlcHJlc2VudGF0aW9uLlxuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuZnVuY3Rpb24gX2ludGVybmFsUXVlcnlUb1Byb3RvUXVlcnlUYXJnZXQoZSkge1xuICAgIHZhciB0O1xuICAgIGNvbnN0IG4gPSBudWxsID09PSAodCA9IGVuc3VyZUZpcmVzdG9yZUNvbmZpZ3VyZWQoX19QUklWQVRFX2Nhc3QoZS5maXJlc3RvcmUsIEZpcmVzdG9yZSkpLl9vbmxpbmVDb21wb25lbnRzKSB8fCB2b2lkIDAgPT09IHQgPyB2b2lkIDAgOiB0LmRhdGFzdG9yZS5zZXJpYWxpemVyO1xuICAgIHJldHVybiB2b2lkIDAgPT09IG4gPyBudWxsIDogX19QUklWQVRFX3RvUXVlcnlUYXJnZXQobiwgX19QUklWQVRFX3F1ZXJ5VG9UYXJnZXQoZS5fcXVlcnkpKS5odDtcbn1cblxuLyoqXG4gKiBAaW50ZXJuYWxcbiAqIEBwcml2YXRlXG4gKlxuICogVGhpcyBmdW5jdGlvbiBpcyBmb3IgaW50ZXJuYWwgdXNlIG9ubHkuXG4gKlxuICogUmV0dXJucyBgUnVuQWdncmVnYXRpb25RdWVyeVJlcXVlc3RgIHdoaWNoIGNvbnRhaW5zIHRoZSBwcm90byByZXByZXNlbnRhdGlvblxuICogb2YgdGhlIGdpdmVuIGFnZ3JlZ2F0aW9uIHF1ZXJ5IHJlcXVlc3QuIFJldHVybnMgbnVsbCBpZiB0aGUgRmlyZXN0b3JlIGNsaWVudFxuICogYXNzb2NpYXRlZCB3aXRoIHRoZSBnaXZlbiBxdWVyeSBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQgb3IgaGFzIGJlZW5cbiAqIHRlcm1pbmF0ZWQuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIFF1ZXJ5IHRvIGNvbnZlcnQgdG8gcHJvdG8gcmVwcmVzZW50YXRpb24uXG4gKiBAcGFyYW0gYWdncmVnYXRlU3BlYyAtIFRoZSBzZXQgb2YgYWdncmVnYXRpb25zIGFuZCB0aGVpciBhbGlhc2VzLlxuICovIGZ1bmN0aW9uIF9pbnRlcm5hbEFnZ3JlZ2F0aW9uUXVlcnlUb1Byb3RvUnVuQWdncmVnYXRpb25RdWVyeVJlcXVlc3QoZSwgdCkge1xuICAgIHZhciBuO1xuICAgIGNvbnN0IHIgPSBfX1BSSVZBVEVfbWFwVG9BcnJheSh0LCAoKGUsIHQpID0+IG5ldyBfX1BSSVZBVEVfQWdncmVnYXRlSW1wbCh0LCBlLmFnZ3JlZ2F0ZVR5cGUsIGUuX2ludGVybmFsRmllbGRQYXRoKSkpLCBpID0gbnVsbCA9PT0gKG4gPSBlbnN1cmVGaXJlc3RvcmVDb25maWd1cmVkKF9fUFJJVkFURV9jYXN0KGUuZmlyZXN0b3JlLCBGaXJlc3RvcmUpKS5fb25saW5lQ29tcG9uZW50cykgfHwgdm9pZCAwID09PSBuID8gdm9pZCAwIDogbi5kYXRhc3RvcmUuc2VyaWFsaXplcjtcbiAgICByZXR1cm4gdm9pZCAwID09PSBpID8gbnVsbCA6IF9fUFJJVkFURV90b1J1bkFnZ3JlZ2F0aW9uUXVlcnlSZXF1ZXN0KGksIF9fUFJJVkFURV9xdWVyeVRvQWdncmVnYXRlVGFyZ2V0KGUuX3F1ZXJ5KSwgciwgXG4gICAgLyogc2tpcEFsaWFzaW5nPSAqLyAhMCkucmVxdWVzdDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGVzdGluZyBob29rcyBmb3IgdXNlIGJ5IEZpcmVzdG9yZSdzIGludGVncmF0aW9uIHRlc3Qgc3VpdGUgdG8gcmVhY2ggaW50byB0aGVcbiAqIFNESyBpbnRlcm5hbHMgdG8gdmFsaWRhdGUgbG9naWMgYW5kIGJlaGF2aW9yIHRoYXQgaXMgbm90IHZpc2libGUgZnJvbSB0aGVcbiAqIHB1YmxpYyBBUEkgc3VyZmFjZS5cbiAqXG4gKiBAaW50ZXJuYWxcbiAqLyBjbGFzcyBUZXN0aW5nSG9va3Mge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJpbnN0YW5jZXMgb2YgdGhpcyBjbGFzcyBzaG91bGQgbm90IGJlIGNyZWF0ZWRcIik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlZ2lzdGVycyBhIGNhbGxiYWNrIHRvIGJlIG5vdGlmaWVkIHdoZW4gYW4gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaFxuICAgICAqIG9jY3VycyBpbiB0aGUgV2F0Y2ggbGlzdGVuIHN0cmVhbS5cbiAgICAgKlxuICAgICAqIFRoZSByZWxhdGl2ZSBvcmRlciBpbiB3aGljaCBjYWxsYmFja3MgYXJlIG5vdGlmaWVkIGlzIHVuc3BlY2lmaWVkOyBkbyBub3RcbiAgICAgKiByZWx5IG9uIGFueSBwYXJ0aWN1bGFyIG9yZGVyaW5nLiBJZiBhIGdpdmVuIGNhbGxiYWNrIGlzIHJlZ2lzdGVyZWQgbXVsdGlwbGVcbiAgICAgKiB0aW1lcyB0aGVuIGl0IHdpbGwgYmUgbm90aWZpZWQgbXVsdGlwbGUgdGltZXMsIG9uY2UgcGVyIHJlZ2lzdHJhdGlvbi5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBjYWxsYmFjayB0aGUgY2FsbGJhY2sgdG8gaW52b2tlIHVwb24gZXhpc3RlbmNlIGZpbHRlciBtaXNtYXRjaC5cbiAgICAgKlxuICAgICAqIEByZXR1cm4gYSBmdW5jdGlvbiB0aGF0LCB3aGVuIGNhbGxlZCwgdW5yZWdpc3RlcnMgdGhlIGdpdmVuIGNhbGxiYWNrOyBvbmx5XG4gICAgICogdGhlIGZpcnN0IGludm9jYXRpb24gb2YgdGhlIHJldHVybmVkIGZ1bmN0aW9uIGRvZXMgYW55dGhpbmc7IGFsbCBzdWJzZXF1ZW50XG4gICAgICogaW52b2NhdGlvbnMgZG8gbm90aGluZy5cbiAgICAgKi8gICAgc3RhdGljIG9uRXhpc3RlbmNlRmlsdGVyTWlzbWF0Y2goZSkge1xuICAgICAgICByZXR1cm4gX19QUklWQVRFX1Rlc3RpbmdIb29rc1NwaUltcGwuaW5zdGFuY2Uub25FeGlzdGVuY2VGaWx0ZXJNaXNtYXRjaChlKTtcbiAgICB9XG59XG5cbi8qKlxuICogVGhlIGltcGxlbWVudGF0aW9uIG9mIGBUZXN0aW5nSG9va3NTcGlgLlxuICovIGNsYXNzIF9fUFJJVkFURV9UZXN0aW5nSG9va3NTcGlJbXBsIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5ZdSA9IG5ldyBNYXA7XG4gICAgfVxuICAgIHN0YXRpYyBnZXQgaW5zdGFuY2UoKSB7XG4gICAgICAgIHJldHVybiBhbiB8fCAoYW4gPSBuZXcgX19QUklWQVRFX1Rlc3RpbmdIb29rc1NwaUltcGwsIGZ1bmN0aW9uIF9fUFJJVkFURV9zZXRUZXN0aW5nSG9va3NTcGkoZSkge1xuICAgICAgICAgICAgaWYgKEF0KSB0aHJvdyBuZXcgRXJyb3IoXCJhIFRlc3RpbmdIb29rc1NwaSBpbnN0YW5jZSBpcyBhbHJlYWR5IHNldFwiKTtcbiAgICAgICAgICAgIEF0ID0gZTtcbiAgICAgICAgfShhbikpLCBhbjtcbiAgICB9XG4gICAgcnQoZSkge1xuICAgICAgICB0aGlzLll1LmZvckVhY2goKHQgPT4gdChlKSkpO1xuICAgIH1cbiAgICBvbkV4aXN0ZW5jZUZpbHRlck1pc21hdGNoKGUpIHtcbiAgICAgICAgY29uc3QgdCA9IFN5bWJvbCgpLCBuID0gdGhpcy5ZdTtcbiAgICAgICAgcmV0dXJuIG4uc2V0KHQsIGUpLCAoKSA9PiBuLmRlbGV0ZSh0KTtcbiAgICB9XG59XG5cbmxldCBhbiA9IG51bGw7XG5cbi8qKlxuICogQ2xvdWQgRmlyZXN0b3JlXG4gKlxuICogQHBhY2thZ2VEb2N1bWVudGF0aW9uXG4gKi8gIWZ1bmN0aW9uIF9fUFJJVkFURV9yZWdpc3RlckZpcmVzdG9yZShlLCB0ID0gITApIHtcbiAgICAhZnVuY3Rpb24gX19QUklWQVRFX3NldFNES1ZlcnNpb24oZSkge1xuICAgICAgICBEID0gZTtcbiAgICB9KFNES19WRVJTSU9OKSwgX3JlZ2lzdGVyQ29tcG9uZW50KG5ldyBDb21wb25lbnQoXCJmaXJlc3RvcmVcIiwgKChlLCB7aW5zdGFuY2VJZGVudGlmaWVyOiBuLCBvcHRpb25zOiByfSkgPT4ge1xuICAgICAgICBjb25zdCBpID0gZS5nZXRQcm92aWRlcihcImFwcFwiKS5nZXRJbW1lZGlhdGUoKSwgcyA9IG5ldyBGaXJlc3RvcmUobmV3IF9fUFJJVkFURV9GaXJlYmFzZUF1dGhDcmVkZW50aWFsc1Byb3ZpZGVyKGUuZ2V0UHJvdmlkZXIoXCJhdXRoLWludGVybmFsXCIpKSwgbmV3IF9fUFJJVkFURV9GaXJlYmFzZUFwcENoZWNrVG9rZW5Qcm92aWRlcihpLCBlLmdldFByb3ZpZGVyKFwiYXBwLWNoZWNrLWludGVybmFsXCIpKSwgZnVuY3Rpb24gX19QUklWQVRFX2RhdGFiYXNlSWRGcm9tQXBwKGUsIHQpIHtcbiAgICAgICAgICAgIGlmICghT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5hcHBseShlLm9wdGlvbnMsIFsgXCJwcm9qZWN0SWRcIiBdKSkgdGhyb3cgbmV3IEZpcmVzdG9yZUVycm9yKEMuSU5WQUxJRF9BUkdVTUVOVCwgJ1wicHJvamVjdElkXCIgbm90IHByb3ZpZGVkIGluIGZpcmViYXNlLmluaXRpYWxpemVBcHAuJyk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IERhdGFiYXNlSWQoZS5vcHRpb25zLnByb2plY3RJZCwgdCk7XG4gICAgICAgIH0oaSwgbiksIGkpO1xuICAgICAgICByZXR1cm4gciA9IE9iamVjdC5hc3NpZ24oe1xuICAgICAgICAgICAgdXNlRmV0Y2hTdHJlYW1zOiB0XG4gICAgICAgIH0sIHIpLCBzLl9zZXRTZXR0aW5ncyhyKSwgcztcbiAgICB9KSwgXCJQVUJMSUNcIikuc2V0TXVsdGlwbGVJbnN0YW5jZXMoITApKSwgcmVnaXN0ZXJWZXJzaW9uKFMsIGIsIGUpLCBcbiAgICAvLyBCVUlMRF9UQVJHRVQgd2lsbCBiZSByZXBsYWNlZCBieSB2YWx1ZXMgbGlrZSBlc20yMDE3LCBjanMyMDE3LCBldGMgZHVyaW5nIHRoZSBjb21waWxhdGlvblxuICAgIHJlZ2lzdGVyVmVyc2lvbihTLCBiLCBcImVzbTIwMTdcIik7XG59KCk7XG5cbmV4cG9ydCB7IEFic3RyYWN0VXNlckRhdGFXcml0ZXIsIEFnZ3JlZ2F0ZUZpZWxkLCBBZ2dyZWdhdGVRdWVyeVNuYXBzaG90LCBCeXRlcywgbm4gYXMgQ0FDSEVfU0laRV9VTkxJTUlURUQsIENvbGxlY3Rpb25SZWZlcmVuY2UsIERvY3VtZW50UmVmZXJlbmNlLCBEb2N1bWVudFNuYXBzaG90LCBGaWVsZFBhdGgsIEZpZWxkVmFsdWUsIEZpcmVzdG9yZSwgRmlyZXN0b3JlRXJyb3IsIEdlb1BvaW50LCBMb2FkQnVuZGxlVGFzaywgUGVyc2lzdGVudENhY2hlSW5kZXhNYW5hZ2VyLCBRdWVyeSwgUXVlcnlDb21wb3NpdGVGaWx0ZXJDb25zdHJhaW50LCBRdWVyeUNvbnN0cmFpbnQsIFF1ZXJ5RG9jdW1lbnRTbmFwc2hvdCwgUXVlcnlFbmRBdENvbnN0cmFpbnQsIFF1ZXJ5RmllbGRGaWx0ZXJDb25zdHJhaW50LCBRdWVyeUxpbWl0Q29uc3RyYWludCwgUXVlcnlPcmRlckJ5Q29uc3RyYWludCwgUXVlcnlTbmFwc2hvdCwgUXVlcnlTdGFydEF0Q29uc3RyYWludCwgU25hcHNob3RNZXRhZGF0YSwgVGltZXN0YW1wLCBUcmFuc2FjdGlvbiwgVmVjdG9yVmFsdWUsIFdyaXRlQmF0Y2gsIF9fUFJJVkFURV9BdXRvSWQgYXMgX0F1dG9JZCwgQnl0ZVN0cmluZyBhcyBfQnl0ZVN0cmluZywgRGF0YWJhc2VJZCBhcyBfRGF0YWJhc2VJZCwgRG9jdW1lbnRLZXkgYXMgX0RvY3VtZW50S2V5LCBfX1BSSVZBVEVfRW1wdHlBcHBDaGVja1Rva2VuUHJvdmlkZXIgYXMgX0VtcHR5QXBwQ2hlY2tUb2tlblByb3ZpZGVyLCBfX1BSSVZBVEVfRW1wdHlBdXRoQ3JlZGVudGlhbHNQcm92aWRlciBhcyBfRW1wdHlBdXRoQ3JlZGVudGlhbHNQcm92aWRlciwgRmllbGRQYXRoJDEgYXMgX0ZpZWxkUGF0aCwgVGVzdGluZ0hvb2tzIGFzIF9UZXN0aW5nSG9va3MsIF9fUFJJVkFURV9jYXN0IGFzIF9jYXN0LCBfX1BSSVZBVEVfZGVidWdBc3NlcnQgYXMgX2RlYnVnQXNzZXJ0LCBfaW50ZXJuYWxBZ2dyZWdhdGlvblF1ZXJ5VG9Qcm90b1J1bkFnZ3JlZ2F0aW9uUXVlcnlSZXF1ZXN0LCBfaW50ZXJuYWxRdWVyeVRvUHJvdG9RdWVyeVRhcmdldCwgX19QUklWQVRFX2lzQmFzZTY0QXZhaWxhYmxlIGFzIF9pc0Jhc2U2NEF2YWlsYWJsZSwgX19QUklWQVRFX2xvZ1dhcm4gYXMgX2xvZ1dhcm4sIF9fUFJJVkFURV92YWxpZGF0ZUlzTm90VXNlZFRvZ2V0aGVyIGFzIF92YWxpZGF0ZUlzTm90VXNlZFRvZ2V0aGVyLCBhZGREb2MsIGFnZ3JlZ2F0ZUZpZWxkRXF1YWwsIGFnZ3JlZ2F0ZVF1ZXJ5U25hcHNob3RFcXVhbCwgYW5kLCBhcnJheVJlbW92ZSwgYXJyYXlVbmlvbiwgYXZlcmFnZSwgY2xlYXJJbmRleGVkRGJQZXJzaXN0ZW5jZSwgY29sbGVjdGlvbiwgY29sbGVjdGlvbkdyb3VwLCBjb25uZWN0RmlyZXN0b3JlRW11bGF0b3IsIGNvdW50LCBkZWxldGVBbGxQZXJzaXN0ZW50Q2FjaGVJbmRleGVzLCBkZWxldGVEb2MsIGRlbGV0ZUZpZWxkLCBkaXNhYmxlTmV0d29yaywgZGlzYWJsZVBlcnNpc3RlbnRDYWNoZUluZGV4QXV0b0NyZWF0aW9uLCBkb2MsIGRvY3VtZW50SWQsIGVuYWJsZUluZGV4ZWREYlBlcnNpc3RlbmNlLCBlbmFibGVNdWx0aVRhYkluZGV4ZWREYlBlcnNpc3RlbmNlLCBlbmFibGVOZXR3b3JrLCBlbmFibGVQZXJzaXN0ZW50Q2FjaGVJbmRleEF1dG9DcmVhdGlvbiwgZW5kQXQsIGVuZEJlZm9yZSwgZW5zdXJlRmlyZXN0b3JlQ29uZmlndXJlZCwgZXhlY3V0ZVdyaXRlLCBnZXRBZ2dyZWdhdGVGcm9tU2VydmVyLCBnZXRDb3VudEZyb21TZXJ2ZXIsIGdldERvYywgZ2V0RG9jRnJvbUNhY2hlLCBnZXREb2NGcm9tU2VydmVyLCBnZXREb2NzLCBnZXREb2NzRnJvbUNhY2hlLCBnZXREb2NzRnJvbVNlcnZlciwgZ2V0RmlyZXN0b3JlLCBnZXRQZXJzaXN0ZW50Q2FjaGVJbmRleE1hbmFnZXIsIGluY3JlbWVudCwgaW5pdGlhbGl6ZUZpcmVzdG9yZSwgbGltaXQsIGxpbWl0VG9MYXN0LCBsb2FkQnVuZGxlLCBtZW1vcnlFYWdlckdhcmJhZ2VDb2xsZWN0b3IsIG1lbW9yeUxvY2FsQ2FjaGUsIG1lbW9yeUxydUdhcmJhZ2VDb2xsZWN0b3IsIG5hbWVkUXVlcnksIG9uU25hcHNob3QsIG9uU25hcHNob3RzSW5TeW5jLCBvciwgb3JkZXJCeSwgcGVyc2lzdGVudExvY2FsQ2FjaGUsIHBlcnNpc3RlbnRNdWx0aXBsZVRhYk1hbmFnZXIsIHBlcnNpc3RlbnRTaW5nbGVUYWJNYW5hZ2VyLCBxdWVyeSwgcXVlcnlFcXVhbCwgcmVmRXF1YWwsIHJ1blRyYW5zYWN0aW9uLCBzZXJ2ZXJUaW1lc3RhbXAsIHNldERvYywgc2V0SW5kZXhDb25maWd1cmF0aW9uLCBzZXRMb2dMZXZlbCwgc25hcHNob3RFcXVhbCwgc3RhcnRBZnRlciwgc3RhcnRBdCwgc3VtLCB0ZXJtaW5hdGUsIHVwZGF0ZURvYywgdmVjdG9yLCB3YWl0Rm9yUGVuZGluZ1dyaXRlcywgd2hlcmUsIHdyaXRlQmF0Y2ggfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCJpbXBvcnQgeyBfaXNGaXJlYmFzZVNlcnZlckFwcCwgX2dldFByb3ZpZGVyLCBnZXRBcHAsIFNES19WRVJTSU9OIGFzIFNES19WRVJTSU9OJDEsIF9yZWdpc3RlckNvbXBvbmVudCwgcmVnaXN0ZXJWZXJzaW9uIH0gZnJvbSAnQGZpcmViYXNlL2FwcCc7XG5pbXBvcnQgeyBDb21wb25lbnQsIENvbXBvbmVudENvbnRhaW5lciwgUHJvdmlkZXIgfSBmcm9tICdAZmlyZWJhc2UvY29tcG9uZW50JztcbmltcG9ydCB7IHN0cmluZ2lmeSwganNvbkV2YWwsIGNvbnRhaW5zLCBhc3NlcnQsIGlzTm9kZVNkaywgc3RyaW5nVG9CeXRlQXJyYXksIFNoYTEsIGJhc2U2NCwgZGVlcENvcHksIGJhc2U2NEVuY29kZSwgaXNNb2JpbGVDb3Jkb3ZhLCBzdHJpbmdMZW5ndGgsIERlZmVycmVkLCBzYWZlR2V0LCBpc0FkbWluLCBpc1ZhbGlkRm9ybWF0LCBpc0VtcHR5LCBpc1JlYWN0TmF0aXZlLCBhc3NlcnRpb25FcnJvciwgbWFwLCBxdWVyeXN0cmluZywgZXJyb3JQcmVmaXgsIGdldE1vZHVsYXJJbnN0YW5jZSwgZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0LCBkZWVwRXF1YWwsIGNyZWF0ZU1vY2tVc2VyVG9rZW4gfSBmcm9tICdAZmlyZWJhc2UvdXRpbCc7XG5pbXBvcnQgeyBMb2dnZXIsIExvZ0xldmVsIH0gZnJvbSAnQGZpcmViYXNlL2xvZ2dlcic7XG5cbmNvbnN0IG5hbWUgPSBcIkBmaXJlYmFzZS9kYXRhYmFzZVwiO1xuY29uc3QgdmVyc2lvbiA9IFwiMS4wLjE0XCI7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE5IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKiogVGhlIHNlbXZlciAod3d3LnNlbXZlci5vcmcpIHZlcnNpb24gb2YgdGhlIFNESy4gKi9cbmxldCBTREtfVkVSU0lPTiA9ICcnO1xuLyoqXG4gKiBTREtfVkVSU0lPTiBzaG91bGQgYmUgc2V0IGJlZm9yZSBhbnkgZGF0YWJhc2UgaW5zdGFuY2UgaXMgY3JlYXRlZFxuICogQGludGVybmFsXG4gKi9cbmZ1bmN0aW9uIHNldFNES1ZlcnNpb24odmVyc2lvbikge1xuICAgIFNES19WRVJTSU9OID0gdmVyc2lvbjtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogV3JhcHMgYSBET00gU3RvcmFnZSBvYmplY3QgYW5kOlxuICogLSBhdXRvbWF0aWNhbGx5IGVuY29kZSBvYmplY3RzIGFzIEpTT04gc3RyaW5ncyBiZWZvcmUgc3RvcmluZyB0aGVtIHRvIGFsbG93IHVzIHRvIHN0b3JlIGFyYml0cmFyeSB0eXBlcy5cbiAqIC0gcHJlZml4ZXMgbmFtZXMgd2l0aCBcImZpcmViYXNlOlwiIHRvIGF2b2lkIGNvbGxpc2lvbnMgd2l0aCBhcHAgZGF0YS5cbiAqXG4gKiBXZSBhdXRvbWF0aWNhbGx5IChzZWUgc3RvcmFnZS5qcykgY3JlYXRlIHR3byBzdWNoIHdyYXBwZXJzLCBvbmUgZm9yIHNlc3Npb25TdG9yYWdlLFxuICogYW5kIG9uZSBmb3IgbG9jYWxTdG9yYWdlLlxuICpcbiAqL1xuY2xhc3MgRE9NU3RvcmFnZVdyYXBwZXIge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBkb21TdG9yYWdlXyAtIFRoZSB1bmRlcmx5aW5nIHN0b3JhZ2Ugb2JqZWN0IChlLmcuIGxvY2FsU3RvcmFnZSBvciBzZXNzaW9uU3RvcmFnZSlcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihkb21TdG9yYWdlXykge1xuICAgICAgICB0aGlzLmRvbVN0b3JhZ2VfID0gZG9tU3RvcmFnZV87XG4gICAgICAgIC8vIFVzZSBhIHByZWZpeCB0byBhdm9pZCBjb2xsaXNpb25zIHdpdGggb3RoZXIgc3R1ZmYgc2F2ZWQgYnkgdGhlIGFwcC5cbiAgICAgICAgdGhpcy5wcmVmaXhfID0gJ2ZpcmViYXNlOic7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBrZXkgLSBUaGUga2V5IHRvIHNhdmUgdGhlIHZhbHVlIHVuZGVyXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIGJlaW5nIHN0b3JlZCwgb3IgbnVsbCB0byByZW1vdmUgdGhlIGtleS5cbiAgICAgKi9cbiAgICBzZXQoa2V5LCB2YWx1ZSkge1xuICAgICAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5kb21TdG9yYWdlXy5yZW1vdmVJdGVtKHRoaXMucHJlZml4ZWROYW1lXyhrZXkpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuZG9tU3RvcmFnZV8uc2V0SXRlbSh0aGlzLnByZWZpeGVkTmFtZV8oa2V5KSwgc3RyaW5naWZ5KHZhbHVlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVGhlIHZhbHVlIHRoYXQgd2FzIHN0b3JlZCB1bmRlciB0aGlzIGtleSwgb3IgbnVsbFxuICAgICAqL1xuICAgIGdldChrZXkpIHtcbiAgICAgICAgY29uc3Qgc3RvcmVkVmFsID0gdGhpcy5kb21TdG9yYWdlXy5nZXRJdGVtKHRoaXMucHJlZml4ZWROYW1lXyhrZXkpKTtcbiAgICAgICAgaWYgKHN0b3JlZFZhbCA9PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBqc29uRXZhbChzdG9yZWRWYWwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZShrZXkpIHtcbiAgICAgICAgdGhpcy5kb21TdG9yYWdlXy5yZW1vdmVJdGVtKHRoaXMucHJlZml4ZWROYW1lXyhrZXkpKTtcbiAgICB9XG4gICAgcHJlZml4ZWROYW1lXyhuYW1lKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByZWZpeF8gKyBuYW1lO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZG9tU3RvcmFnZV8udG9TdHJpbmcoKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGluLW1lbW9yeSBzdG9yYWdlIGltcGxlbWVudGF0aW9uIHRoYXQgbWF0Y2hlcyB0aGUgQVBJIG9mIERPTVN0b3JhZ2VXcmFwcGVyXG4gKiAoVE9ETzogY3JlYXRlIGludGVyZmFjZSBmb3IgYm90aCB0byBpbXBsZW1lbnQpLlxuICovXG5jbGFzcyBNZW1vcnlTdG9yYWdlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5jYWNoZV8gPSB7fTtcbiAgICAgICAgdGhpcy5pc0luTWVtb3J5U3RvcmFnZSA9IHRydWU7XG4gICAgfVxuICAgIHNldChrZXksIHZhbHVlKSB7XG4gICAgICAgIGlmICh2YWx1ZSA9PSBudWxsKSB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5jYWNoZV9ba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FjaGVfW2tleV0gPSB2YWx1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQoa2V5KSB7XG4gICAgICAgIGlmIChjb250YWlucyh0aGlzLmNhY2hlXywga2V5KSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuY2FjaGVfW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJlbW92ZShrZXkpIHtcbiAgICAgICAgZGVsZXRlIHRoaXMuY2FjaGVfW2tleV07XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBIZWxwZXIgdG8gY3JlYXRlIGEgRE9NU3RvcmFnZVdyYXBwZXIgb3IgZWxzZSBmYWxsIGJhY2sgdG8gTWVtb3J5U3RvcmFnZS5cbiAqIFRPRE86IE9uY2UgTWVtb3J5U3RvcmFnZSBhbmQgRE9NU3RvcmFnZVdyYXBwZXIgaGF2ZSBhIHNoYXJlZCBpbnRlcmZhY2UgdGhpcyBtZXRob2QgYW5ub3RhdGlvbiBzaG91bGQgY2hhbmdlXG4gKiB0byByZWZsZWN0IHRoaXMgdHlwZVxuICpcbiAqIEBwYXJhbSBkb21TdG9yYWdlTmFtZSAtIE5hbWUgb2YgdGhlIHVuZGVybHlpbmcgc3RvcmFnZSBvYmplY3RcbiAqICAgKGUuZy4gJ2xvY2FsU3RvcmFnZScgb3IgJ3Nlc3Npb25TdG9yYWdlJykuXG4gKiBAcmV0dXJucyBUdXJuaW5nIG9mZiB0eXBlIGluZm9ybWF0aW9uIHVudGlsIGEgY29tbW9uIGludGVyZmFjZSBpcyBkZWZpbmVkLlxuICovXG5jb25zdCBjcmVhdGVTdG9yYWdlZm9yID0gZnVuY3Rpb24gKGRvbVN0b3JhZ2VOYW1lKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgLy8gTk9URToganVzdCBhY2Nlc3NpbmcgXCJsb2NhbFN0b3JhZ2VcIiBvciBcIndpbmRvd1snbG9jYWxTdG9yYWdlJ11cIiBtYXkgdGhyb3cgYSBzZWN1cml0eSBleGNlcHRpb24sXG4gICAgICAgIC8vIHNvIGl0IG11c3QgYmUgaW5zaWRlIHRoZSB0cnkvY2F0Y2guXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgdHlwZW9mIHdpbmRvd1tkb21TdG9yYWdlTmFtZV0gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvLyBOZWVkIHRvIHRlc3QgY2FjaGUuIEp1c3QgYmVjYXVzZSBpdCdzIGhlcmUgZG9lc24ndCBtZWFuIGl0IHdvcmtzXG4gICAgICAgICAgICBjb25zdCBkb21TdG9yYWdlID0gd2luZG93W2RvbVN0b3JhZ2VOYW1lXTtcbiAgICAgICAgICAgIGRvbVN0b3JhZ2Uuc2V0SXRlbSgnZmlyZWJhc2U6c2VudGluZWwnLCAnY2FjaGUnKTtcbiAgICAgICAgICAgIGRvbVN0b3JhZ2UucmVtb3ZlSXRlbSgnZmlyZWJhc2U6c2VudGluZWwnKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgRE9NU3RvcmFnZVdyYXBwZXIoZG9tU3RvcmFnZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2F0Y2ggKGUpIHsgfVxuICAgIC8vIEZhaWxlZCB0byBjcmVhdGUgd3JhcHBlci4gIEp1c3QgcmV0dXJuIGluLW1lbW9yeSBzdG9yYWdlLlxuICAgIC8vIFRPRE86IGxvZz9cbiAgICByZXR1cm4gbmV3IE1lbW9yeVN0b3JhZ2UoKTtcbn07XG4vKiogQSBzdG9yYWdlIG9iamVjdCB0aGF0IGxhc3RzIGFjcm9zcyBzZXNzaW9ucyAqL1xuY29uc3QgUGVyc2lzdGVudFN0b3JhZ2UgPSBjcmVhdGVTdG9yYWdlZm9yKCdsb2NhbFN0b3JhZ2UnKTtcbi8qKiBBIHN0b3JhZ2Ugb2JqZWN0IHRoYXQgb25seSBsYXN0cyBvbmUgc2Vzc2lvbiAqL1xuY29uc3QgU2Vzc2lvblN0b3JhZ2UgPSBjcmVhdGVTdG9yYWdlZm9yKCdzZXNzaW9uU3RvcmFnZScpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgbG9nQ2xpZW50ID0gbmV3IExvZ2dlcignQGZpcmViYXNlL2RhdGFiYXNlJyk7XG4vKipcbiAqIFJldHVybnMgYSBsb2NhbGx5LXVuaXF1ZSBJRCAoZ2VuZXJhdGVkIGJ5IGp1c3QgaW5jcmVtZW50aW5nIHVwIGZyb20gMCBlYWNoIHRpbWUgaXRzIGNhbGxlZCkuXG4gKi9cbmNvbnN0IExVSURHZW5lcmF0b3IgPSAoZnVuY3Rpb24gKCkge1xuICAgIGxldCBpZCA9IDE7XG4gICAgcmV0dXJuIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGlkKys7XG4gICAgfTtcbn0pKCk7XG4vKipcbiAqIFNoYTEgaGFzaCBvZiB0aGUgaW5wdXQgc3RyaW5nXG4gKiBAcGFyYW0gc3RyIC0gVGhlIHN0cmluZyB0byBoYXNoXG4gKiBAcmV0dXJucyB7IXN0cmluZ30gVGhlIHJlc3VsdGluZyBoYXNoXG4gKi9cbmNvbnN0IHNoYTEgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgY29uc3QgdXRmOEJ5dGVzID0gc3RyaW5nVG9CeXRlQXJyYXkoc3RyKTtcbiAgICBjb25zdCBzaGExID0gbmV3IFNoYTEoKTtcbiAgICBzaGExLnVwZGF0ZSh1dGY4Qnl0ZXMpO1xuICAgIGNvbnN0IHNoYTFCeXRlcyA9IHNoYTEuZGlnZXN0KCk7XG4gICAgcmV0dXJuIGJhc2U2NC5lbmNvZGVCeXRlQXJyYXkoc2hhMUJ5dGVzKTtcbn07XG5jb25zdCBidWlsZExvZ01lc3NhZ2VfID0gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHtcbiAgICBsZXQgbWVzc2FnZSA9ICcnO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmFyQXJncy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBhcmcgPSB2YXJBcmdzW2ldO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShhcmcpIHx8XG4gICAgICAgICAgICAoYXJnICYmXG4gICAgICAgICAgICAgICAgdHlwZW9mIGFyZyA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgIHR5cGVvZiBhcmcubGVuZ3RoID09PSAnbnVtYmVyJykpIHtcbiAgICAgICAgICAgIG1lc3NhZ2UgKz0gYnVpbGRMb2dNZXNzYWdlXy5hcHBseShudWxsLCBhcmcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHR5cGVvZiBhcmcgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBtZXNzYWdlICs9IHN0cmluZ2lmeShhcmcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbWVzc2FnZSArPSBhcmc7XG4gICAgICAgIH1cbiAgICAgICAgbWVzc2FnZSArPSAnICc7XG4gICAgfVxuICAgIHJldHVybiBtZXNzYWdlO1xufTtcbi8qKlxuICogVXNlIHRoaXMgZm9yIGFsbCBkZWJ1ZyBtZXNzYWdlcyBpbiBGaXJlYmFzZS5cbiAqL1xubGV0IGxvZ2dlciA9IG51bGw7XG4vKipcbiAqIEZsYWcgdG8gY2hlY2sgZm9yIGxvZyBhdmFpbGFiaWxpdHkgb24gZmlyc3QgbG9nIG1lc3NhZ2VcbiAqL1xubGV0IGZpcnN0TG9nXyA9IHRydWU7XG4vKipcbiAqIFRoZSBpbXBsZW1lbnRhdGlvbiBvZiBGaXJlYmFzZS5lbmFibGVMb2dnaW5nIChkZWZpbmVkIGhlcmUgdG8gYnJlYWsgZGVwZW5kZW5jaWVzKVxuICogQHBhcmFtIGxvZ2dlcl8gLSBBIGZsYWcgdG8gdHVybiBvbiBsb2dnaW5nLCBvciBhIGN1c3RvbSBsb2dnZXJcbiAqIEBwYXJhbSBwZXJzaXN0ZW50IC0gV2hldGhlciBvciBub3QgdG8gcGVyc2lzdCBsb2dnaW5nIHNldHRpbmdzIGFjcm9zcyByZWZyZXNoZXNcbiAqL1xuY29uc3QgZW5hYmxlTG9nZ2luZyQxID0gZnVuY3Rpb24gKGxvZ2dlcl8sIHBlcnNpc3RlbnQpIHtcbiAgICBhc3NlcnQoIXBlcnNpc3RlbnQgfHwgbG9nZ2VyXyA9PT0gdHJ1ZSB8fCBsb2dnZXJfID09PSBmYWxzZSwgXCJDYW4ndCB0dXJuIG9uIGN1c3RvbSBsb2dnZXJzIHBlcnNpc3RlbnRseS5cIik7XG4gICAgaWYgKGxvZ2dlcl8gPT09IHRydWUpIHtcbiAgICAgICAgbG9nQ2xpZW50LmxvZ0xldmVsID0gTG9nTGV2ZWwuVkVSQk9TRTtcbiAgICAgICAgbG9nZ2VyID0gbG9nQ2xpZW50LmxvZy5iaW5kKGxvZ0NsaWVudCk7XG4gICAgICAgIGlmIChwZXJzaXN0ZW50KSB7XG4gICAgICAgICAgICBTZXNzaW9uU3RvcmFnZS5zZXQoJ2xvZ2dpbmdfZW5hYmxlZCcsIHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiBsb2dnZXJfID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIGxvZ2dlciA9IGxvZ2dlcl87XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsb2dnZXIgPSBudWxsO1xuICAgICAgICBTZXNzaW9uU3RvcmFnZS5yZW1vdmUoJ2xvZ2dpbmdfZW5hYmxlZCcpO1xuICAgIH1cbn07XG5jb25zdCBsb2cgPSBmdW5jdGlvbiAoLi4udmFyQXJncykge1xuICAgIGlmIChmaXJzdExvZ18gPT09IHRydWUpIHtcbiAgICAgICAgZmlyc3RMb2dfID0gZmFsc2U7XG4gICAgICAgIGlmIChsb2dnZXIgPT09IG51bGwgJiYgU2Vzc2lvblN0b3JhZ2UuZ2V0KCdsb2dnaW5nX2VuYWJsZWQnKSA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgZW5hYmxlTG9nZ2luZyQxKHRydWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChsb2dnZXIpIHtcbiAgICAgICAgY29uc3QgbWVzc2FnZSA9IGJ1aWxkTG9nTWVzc2FnZV8uYXBwbHkobnVsbCwgdmFyQXJncyk7XG4gICAgICAgIGxvZ2dlcihtZXNzYWdlKTtcbiAgICB9XG59O1xuY29uc3QgbG9nV3JhcHBlciA9IGZ1bmN0aW9uIChwcmVmaXgpIHtcbiAgICByZXR1cm4gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHtcbiAgICAgICAgbG9nKHByZWZpeCwgLi4udmFyQXJncyk7XG4gICAgfTtcbn07XG5jb25zdCBlcnJvciA9IGZ1bmN0aW9uICguLi52YXJBcmdzKSB7XG4gICAgY29uc3QgbWVzc2FnZSA9ICdGSVJFQkFTRSBJTlRFUk5BTCBFUlJPUjogJyArIGJ1aWxkTG9nTWVzc2FnZV8oLi4udmFyQXJncyk7XG4gICAgbG9nQ2xpZW50LmVycm9yKG1lc3NhZ2UpO1xufTtcbmNvbnN0IGZhdGFsID0gZnVuY3Rpb24gKC4uLnZhckFyZ3MpIHtcbiAgICBjb25zdCBtZXNzYWdlID0gYEZJUkVCQVNFIEZBVEFMIEVSUk9SOiAke2J1aWxkTG9nTWVzc2FnZV8oLi4udmFyQXJncyl9YDtcbiAgICBsb2dDbGllbnQuZXJyb3IobWVzc2FnZSk7XG4gICAgdGhyb3cgbmV3IEVycm9yKG1lc3NhZ2UpO1xufTtcbmNvbnN0IHdhcm4gPSBmdW5jdGlvbiAoLi4udmFyQXJncykge1xuICAgIGNvbnN0IG1lc3NhZ2UgPSAnRklSRUJBU0UgV0FSTklORzogJyArIGJ1aWxkTG9nTWVzc2FnZV8oLi4udmFyQXJncyk7XG4gICAgbG9nQ2xpZW50Lndhcm4obWVzc2FnZSk7XG59O1xuLyoqXG4gKiBMb2dzIGEgd2FybmluZyBpZiB0aGUgY29udGFpbmluZyBwYWdlIHVzZXMgaHR0cHMuIENhbGxlZCB3aGVuIGEgY2FsbCB0byBuZXcgRmlyZWJhc2VcbiAqIGRvZXMgbm90IHVzZSBodHRwcy5cbiAqL1xuY29uc3Qgd2FybklmUGFnZUlzU2VjdXJlID0gZnVuY3Rpb24gKCkge1xuICAgIC8vIEJlIHZlcnkgY2FyZWZ1bCBhY2Nlc3NpbmcgYnJvd3NlciBnbG9iYWxzLiBXaG8ga25vd3Mgd2hhdCBtYXkgb3IgbWF5IG5vdCBleGlzdC5cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgd2luZG93LmxvY2F0aW9uICYmXG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCAmJlxuICAgICAgICB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wuaW5kZXhPZignaHR0cHM6JykgIT09IC0xKSB7XG4gICAgICAgIHdhcm4oJ0luc2VjdXJlIEZpcmViYXNlIGFjY2VzcyBmcm9tIGEgc2VjdXJlIHBhZ2UuICcgK1xuICAgICAgICAgICAgJ1BsZWFzZSB1c2UgaHR0cHMgaW4gY2FsbHMgdG8gbmV3IEZpcmViYXNlKCkuJyk7XG4gICAgfVxufTtcbi8qKlxuICogUmV0dXJucyB0cnVlIGlmIGRhdGEgaXMgTmFOLCBvciArLy0gSW5maW5pdHkuXG4gKi9cbmNvbnN0IGlzSW52YWxpZEpTT05OdW1iZXIgPSBmdW5jdGlvbiAoZGF0YSkge1xuICAgIHJldHVybiAodHlwZW9mIGRhdGEgPT09ICdudW1iZXInICYmXG4gICAgICAgIChkYXRhICE9PSBkYXRhIHx8IC8vIE5hTlxuICAgICAgICAgICAgZGF0YSA9PT0gTnVtYmVyLlBPU0lUSVZFX0lORklOSVRZIHx8XG4gICAgICAgICAgICBkYXRhID09PSBOdW1iZXIuTkVHQVRJVkVfSU5GSU5JVFkpKTtcbn07XG5jb25zdCBleGVjdXRlV2hlbkRPTVJlYWR5ID0gZnVuY3Rpb24gKGZuKSB7XG4gICAgaWYgKGlzTm9kZVNkaygpIHx8IGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgZm4oKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIE1vZGVsZWQgYWZ0ZXIgalF1ZXJ5LiBUcnkgRE9NQ29udGVudExvYWRlZCBhbmQgb25yZWFkeXN0YXRlY2hhbmdlICh3aGljaFxuICAgICAgICAvLyBmaXJlIGJlZm9yZSBvbmxvYWQpLCBidXQgZmFsbCBiYWNrIHRvIG9ubG9hZC5cbiAgICAgICAgbGV0IGNhbGxlZCA9IGZhbHNlO1xuICAgICAgICBjb25zdCB3cmFwcGVkRm4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRvY3VtZW50LmJvZHkpIHtcbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KHdyYXBwZWRGbiwgTWF0aC5mbG9vcigxMCkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY2FsbGVkKSB7XG4gICAgICAgICAgICAgICAgY2FsbGVkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBmbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICBpZiAoZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIHdyYXBwZWRGbiwgZmFsc2UpO1xuICAgICAgICAgICAgLy8gZmFsbGJhY2sgdG8gb25sb2FkLlxuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB3cmFwcGVkRm4sIGZhbHNlKTtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZG9jdW1lbnQuYXR0YWNoRXZlbnQpIHtcbiAgICAgICAgICAgIC8vIElFLlxuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgIGRvY3VtZW50LmF0dGFjaEV2ZW50KCdvbnJlYWR5c3RhdGVjaGFuZ2UnLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGRvY3VtZW50LnJlYWR5U3RhdGUgPT09ICdjb21wbGV0ZScpIHtcbiAgICAgICAgICAgICAgICAgICAgd3JhcHBlZEZuKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBmYWxsYmFjayB0byBvbmxvYWQuXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgd2luZG93LmF0dGFjaEV2ZW50KCdvbmxvYWQnLCB3cmFwcGVkRm4pO1xuICAgICAgICAgICAgLy8galF1ZXJ5IGhhcyBhbiBleHRyYSBoYWNrIGZvciBJRSB0aGF0IHdlIGNvdWxkIGVtcGxveSAoYmFzZWQgb25cbiAgICAgICAgICAgIC8vIGh0dHA6Ly9qYXZhc2NyaXB0Lm53Ym94LmNvbS9JRUNvbnRlbnRMb2FkZWQvKSBCdXQgaXQgbG9va3MgcmVhbGx5IG9sZC5cbiAgICAgICAgICAgIC8vIEknbSBob3Bpbmcgd2UgZG9uJ3QgbmVlZCBpdC5cbiAgICAgICAgfVxuICAgIH1cbn07XG4vKipcbiAqIE1pbmltdW0ga2V5IG5hbWUuIEludmFsaWQgZm9yIGFjdHVhbCBkYXRhLCB1c2VkIGFzIGEgbWFya2VyIHRvIHNvcnQgYmVmb3JlIGFueSB2YWxpZCBuYW1lc1xuICovXG5jb25zdCBNSU5fTkFNRSA9ICdbTUlOX05BTUVdJztcbi8qKlxuICogTWF4aW11bSBrZXkgbmFtZS4gSW52YWxpZCBmb3IgYWN0dWFsIGRhdGEsIHVzZWQgYXMgYSBtYXJrZXIgdG8gc29ydCBhYm92ZSBhbnkgdmFsaWQgbmFtZXNcbiAqL1xuY29uc3QgTUFYX05BTUUgPSAnW01BWF9OQU1FXSc7XG4vKipcbiAqIENvbXBhcmVzIHZhbGlkIEZpcmViYXNlIGtleSBuYW1lcywgcGx1cyBtaW4gYW5kIG1heCBuYW1lXG4gKi9cbmNvbnN0IG5hbWVDb21wYXJlID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICBpZiAoYSA9PT0gYikge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgZWxzZSBpZiAoYSA9PT0gTUlOX05BTUUgfHwgYiA9PT0gTUFYX05BTUUpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBlbHNlIGlmIChiID09PSBNSU5fTkFNRSB8fCBhID09PSBNQVhfTkFNRSkge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGFBc0ludCA9IHRyeVBhcnNlSW50KGEpLCBiQXNJbnQgPSB0cnlQYXJzZUludChiKTtcbiAgICAgICAgaWYgKGFBc0ludCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKGJBc0ludCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBhQXNJbnQgLSBiQXNJbnQgPT09IDAgPyBhLmxlbmd0aCAtIGIubGVuZ3RoIDogYUFzSW50IC0gYkFzSW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGJBc0ludCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gYSA8IGIgPyAtMSA6IDE7XG4gICAgICAgIH1cbiAgICB9XG59O1xuLyoqXG4gKiBAcmV0dXJucyB7IW51bWJlcn0gY29tcGFyaXNvbiByZXN1bHQuXG4gKi9cbmNvbnN0IHN0cmluZ0NvbXBhcmUgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIGlmIChhID09PSBiKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICBlbHNlIGlmIChhIDwgYikge1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gMTtcbiAgICB9XG59O1xuY29uc3QgcmVxdWlyZUtleSA9IGZ1bmN0aW9uIChrZXksIG9iaikge1xuICAgIGlmIChvYmogJiYga2V5IGluIG9iaikge1xuICAgICAgICByZXR1cm4gb2JqW2tleV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01pc3NpbmcgcmVxdWlyZWQga2V5ICgnICsga2V5ICsgJykgaW4gb2JqZWN0OiAnICsgc3RyaW5naWZ5KG9iaikpO1xuICAgIH1cbn07XG5jb25zdCBPYmplY3RUb1VuaXF1ZUtleSA9IGZ1bmN0aW9uIChvYmopIHtcbiAgICBpZiAodHlwZW9mIG9iaiAhPT0gJ29iamVjdCcgfHwgb2JqID09PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBzdHJpbmdpZnkob2JqKTtcbiAgICB9XG4gICAgY29uc3Qga2V5cyA9IFtdO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBndWFyZC1mb3ItaW5cbiAgICBmb3IgKGNvbnN0IGsgaW4gb2JqKSB7XG4gICAgICAgIGtleXMucHVzaChrKTtcbiAgICB9XG4gICAgLy8gRXhwb3J0IGFzIGpzb24sIGJ1dCB3aXRoIHRoZSBrZXlzIHNvcnRlZC5cbiAgICBrZXlzLnNvcnQoKTtcbiAgICBsZXQga2V5ID0gJ3snO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBpZiAoaSAhPT0gMCkge1xuICAgICAgICAgICAga2V5ICs9ICcsJztcbiAgICAgICAgfVxuICAgICAgICBrZXkgKz0gc3RyaW5naWZ5KGtleXNbaV0pO1xuICAgICAgICBrZXkgKz0gJzonO1xuICAgICAgICBrZXkgKz0gT2JqZWN0VG9VbmlxdWVLZXkob2JqW2tleXNbaV1dKTtcbiAgICB9XG4gICAga2V5ICs9ICd9JztcbiAgICByZXR1cm4ga2V5O1xufTtcbi8qKlxuICogU3BsaXRzIGEgc3RyaW5nIGludG8gYSBudW1iZXIgb2Ygc21hbGxlciBzZWdtZW50cyBvZiBtYXhpbXVtIHNpemVcbiAqIEBwYXJhbSBzdHIgLSBUaGUgc3RyaW5nXG4gKiBAcGFyYW0gc2Vnc2l6ZSAtIFRoZSBtYXhpbXVtIG51bWJlciBvZiBjaGFycyBpbiB0aGUgc3RyaW5nLlxuICogQHJldHVybnMgVGhlIHN0cmluZywgc3BsaXQgaW50byBhcHByb3ByaWF0ZWx5LXNpemVkIGNodW5rc1xuICovXG5jb25zdCBzcGxpdFN0cmluZ0J5U2l6ZSA9IGZ1bmN0aW9uIChzdHIsIHNlZ3NpemUpIHtcbiAgICBjb25zdCBsZW4gPSBzdHIubGVuZ3RoO1xuICAgIGlmIChsZW4gPD0gc2Vnc2l6ZSkge1xuICAgICAgICByZXR1cm4gW3N0cl07XG4gICAgfVxuICAgIGNvbnN0IGRhdGFTZWdzID0gW107XG4gICAgZm9yIChsZXQgYyA9IDA7IGMgPCBsZW47IGMgKz0gc2Vnc2l6ZSkge1xuICAgICAgICBpZiAoYyArIHNlZ3NpemUgPiBsZW4pIHtcbiAgICAgICAgICAgIGRhdGFTZWdzLnB1c2goc3RyLnN1YnN0cmluZyhjLCBsZW4pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRhdGFTZWdzLnB1c2goc3RyLnN1YnN0cmluZyhjLCBjICsgc2Vnc2l6ZSkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhU2Vncztcbn07XG4vKipcbiAqIEFwcGx5IGEgZnVuY3Rpb24gdG8gZWFjaCAoa2V5LCB2YWx1ZSkgcGFpciBpbiBhbiBvYmplY3Qgb3JcbiAqIGFwcGx5IGEgZnVuY3Rpb24gdG8gZWFjaCAoaW5kZXgsIHZhbHVlKSBwYWlyIGluIGFuIGFycmF5XG4gKiBAcGFyYW0gb2JqIC0gVGhlIG9iamVjdCBvciBhcnJheSB0byBpdGVyYXRlIG92ZXJcbiAqIEBwYXJhbSBmbiAtIFRoZSBmdW5jdGlvbiB0byBhcHBseVxuICovXG5mdW5jdGlvbiBlYWNoKG9iaiwgZm4pIHtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBvYmopIHtcbiAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XG4gICAgICAgICAgICBmbihrZXksIG9ialtrZXldKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogQm9ycm93ZWQgZnJvbSBodHRwOi8vaGcuc2Vjb25kbGlmZS5jb20vbGxzZC9zcmMvdGlwL2pzL3R5cGVkYXJyYXkuanMgKE1JVCBMaWNlbnNlKVxuICogSSBtYWRlIG9uZSBtb2RpZmljYXRpb24gYXQgdGhlIGVuZCBhbmQgcmVtb3ZlZCB0aGUgTmFOIC8gSW5maW5pdHlcbiAqIGhhbmRsaW5nIChzaW5jZSBpdCBzZWVtZWQgYnJva2VuIFtjYXVzZWQgYW4gb3ZlcmZsb3ddIGFuZCB3ZSBkb24ndCBuZWVkIGl0KS4gIFNlZSBNSkwgY29tbWVudHMuXG4gKiBAcGFyYW0gdiAtIEEgZG91YmxlXG4gKlxuICovXG5jb25zdCBkb3VibGVUb0lFRUU3NTRTdHJpbmcgPSBmdW5jdGlvbiAodikge1xuICAgIGFzc2VydCghaXNJbnZhbGlkSlNPTk51bWJlcih2KSwgJ0ludmFsaWQgSlNPTiBudW1iZXInKTsgLy8gTUpMXG4gICAgY29uc3QgZWJpdHMgPSAxMSwgZmJpdHMgPSA1MjtcbiAgICBjb25zdCBiaWFzID0gKDEgPDwgKGViaXRzIC0gMSkpIC0gMTtcbiAgICBsZXQgcywgZSwgZiwgbG4sIGk7XG4gICAgLy8gQ29tcHV0ZSBzaWduLCBleHBvbmVudCwgZnJhY3Rpb25cbiAgICAvLyBTa2lwIE5hTiAvIEluZmluaXR5IGhhbmRsaW5nIC0tTUpMLlxuICAgIGlmICh2ID09PSAwKSB7XG4gICAgICAgIGUgPSAwO1xuICAgICAgICBmID0gMDtcbiAgICAgICAgcyA9IDEgLyB2ID09PSAtSW5maW5pdHkgPyAxIDogMDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHMgPSB2IDwgMDtcbiAgICAgICAgdiA9IE1hdGguYWJzKHYpO1xuICAgICAgICBpZiAodiA+PSBNYXRoLnBvdygyLCAxIC0gYmlhcykpIHtcbiAgICAgICAgICAgIC8vIE5vcm1hbGl6ZWRcbiAgICAgICAgICAgIGxuID0gTWF0aC5taW4oTWF0aC5mbG9vcihNYXRoLmxvZyh2KSAvIE1hdGguTE4yKSwgYmlhcyk7XG4gICAgICAgICAgICBlID0gbG4gKyBiaWFzO1xuICAgICAgICAgICAgZiA9IE1hdGgucm91bmQodiAqIE1hdGgucG93KDIsIGZiaXRzIC0gbG4pIC0gTWF0aC5wb3coMiwgZmJpdHMpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIERlbm9ybWFsaXplZFxuICAgICAgICAgICAgZSA9IDA7XG4gICAgICAgICAgICBmID0gTWF0aC5yb3VuZCh2IC8gTWF0aC5wb3coMiwgMSAtIGJpYXMgLSBmYml0cykpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8vIFBhY2sgc2lnbiwgZXhwb25lbnQsIGZyYWN0aW9uXG4gICAgY29uc3QgYml0cyA9IFtdO1xuICAgIGZvciAoaSA9IGZiaXRzOyBpOyBpIC09IDEpIHtcbiAgICAgICAgYml0cy5wdXNoKGYgJSAyID8gMSA6IDApO1xuICAgICAgICBmID0gTWF0aC5mbG9vcihmIC8gMik7XG4gICAgfVxuICAgIGZvciAoaSA9IGViaXRzOyBpOyBpIC09IDEpIHtcbiAgICAgICAgYml0cy5wdXNoKGUgJSAyID8gMSA6IDApO1xuICAgICAgICBlID0gTWF0aC5mbG9vcihlIC8gMik7XG4gICAgfVxuICAgIGJpdHMucHVzaChzID8gMSA6IDApO1xuICAgIGJpdHMucmV2ZXJzZSgpO1xuICAgIGNvbnN0IHN0ciA9IGJpdHMuam9pbignJyk7XG4gICAgLy8gUmV0dXJuIHRoZSBkYXRhIGFzIGEgaGV4IHN0cmluZy4gLS1NSkxcbiAgICBsZXQgaGV4Qnl0ZVN0cmluZyA9ICcnO1xuICAgIGZvciAoaSA9IDA7IGkgPCA2NDsgaSArPSA4KSB7XG4gICAgICAgIGxldCBoZXhCeXRlID0gcGFyc2VJbnQoc3RyLnN1YnN0cihpLCA4KSwgMikudG9TdHJpbmcoMTYpO1xuICAgICAgICBpZiAoaGV4Qnl0ZS5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIGhleEJ5dGUgPSAnMCcgKyBoZXhCeXRlO1xuICAgICAgICB9XG4gICAgICAgIGhleEJ5dGVTdHJpbmcgPSBoZXhCeXRlU3RyaW5nICsgaGV4Qnl0ZTtcbiAgICB9XG4gICAgcmV0dXJuIGhleEJ5dGVTdHJpbmcudG9Mb3dlckNhc2UoKTtcbn07XG4vKipcbiAqIFVzZWQgdG8gZGV0ZWN0IGlmIHdlJ3JlIGluIGEgQ2hyb21lIGNvbnRlbnQgc2NyaXB0ICh3aGljaCBleGVjdXRlcyBpbiBhblxuICogaXNvbGF0ZWQgZW52aXJvbm1lbnQgd2hlcmUgbG9uZy1wb2xsaW5nIGRvZXNuJ3Qgd29yaykuXG4gKi9cbmNvbnN0IGlzQ2hyb21lRXh0ZW5zaW9uQ29udGVudFNjcmlwdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gISEodHlwZW9mIHdpbmRvdyA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgd2luZG93WydjaHJvbWUnXSAmJlxuICAgICAgICB3aW5kb3dbJ2Nocm9tZSddWydleHRlbnNpb24nXSAmJlxuICAgICAgICAhL15jaHJvbWUvLnRlc3Qod2luZG93LmxvY2F0aW9uLmhyZWYpKTtcbn07XG4vKipcbiAqIFVzZWQgdG8gZGV0ZWN0IGlmIHdlJ3JlIGluIGEgV2luZG93cyA4IFN0b3JlIGFwcC5cbiAqL1xuY29uc3QgaXNXaW5kb3dzU3RvcmVBcHAgPSBmdW5jdGlvbiAoKSB7XG4gICAgLy8gQ2hlY2sgZm9yIHRoZSBwcmVzZW5jZSBvZiBhIGNvdXBsZSBXaW5SVCBnbG9iYWxzXG4gICAgcmV0dXJuIHR5cGVvZiBXaW5kb3dzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgV2luZG93cy5VSSA9PT0gJ29iamVjdCc7XG59O1xuLyoqXG4gKiBDb252ZXJ0cyBhIHNlcnZlciBlcnJvciBjb2RlIHRvIGEgSmF2YVNjcmlwdCBFcnJvclxuICovXG5mdW5jdGlvbiBlcnJvckZvclNlcnZlckNvZGUoY29kZSwgcXVlcnkpIHtcbiAgICBsZXQgcmVhc29uID0gJ1Vua25vd24gRXJyb3InO1xuICAgIGlmIChjb2RlID09PSAndG9vX2JpZycpIHtcbiAgICAgICAgcmVhc29uID1cbiAgICAgICAgICAgICdUaGUgZGF0YSByZXF1ZXN0ZWQgZXhjZWVkcyB0aGUgbWF4aW11bSBzaXplICcgK1xuICAgICAgICAgICAgICAgICd0aGF0IGNhbiBiZSBhY2Nlc3NlZCB3aXRoIGEgc2luZ2xlIHJlcXVlc3QuJztcbiAgICB9XG4gICAgZWxzZSBpZiAoY29kZSA9PT0gJ3Blcm1pc3Npb25fZGVuaWVkJykge1xuICAgICAgICByZWFzb24gPSBcIkNsaWVudCBkb2Vzbid0IGhhdmUgcGVybWlzc2lvbiB0byBhY2Nlc3MgdGhlIGRlc2lyZWQgZGF0YS5cIjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29kZSA9PT0gJ3VuYXZhaWxhYmxlJykge1xuICAgICAgICByZWFzb24gPSAnVGhlIHNlcnZpY2UgaXMgdW5hdmFpbGFibGUnO1xuICAgIH1cbiAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihjb2RlICsgJyBhdCAnICsgcXVlcnkuX3BhdGgudG9TdHJpbmcoKSArICc6ICcgKyByZWFzb24pO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgZXJyb3IuY29kZSA9IGNvZGUudG9VcHBlckNhc2UoKTtcbiAgICByZXR1cm4gZXJyb3I7XG59XG4vKipcbiAqIFVzZWQgdG8gdGVzdCBmb3IgaW50ZWdlci1sb29raW5nIHN0cmluZ3NcbiAqL1xuY29uc3QgSU5URUdFUl9SRUdFWFBfID0gbmV3IFJlZ0V4cCgnXi0/KDAqKVxcXFxkezEsMTB9JCcpO1xuLyoqXG4gKiBGb3IgdXNlIGluIGtleXMsIHRoZSBtaW5pbXVtIHBvc3NpYmxlIDMyLWJpdCBpbnRlZ2VyLlxuICovXG5jb25zdCBJTlRFR0VSXzMyX01JTiA9IC0yMTQ3NDgzNjQ4O1xuLyoqXG4gKiBGb3IgdXNlIGluIGtleXMsIHRoZSBtYXhpbXVtIHBvc3NpYmxlIDMyLWJpdCBpbnRlZ2VyLlxuICovXG5jb25zdCBJTlRFR0VSXzMyX01BWCA9IDIxNDc0ODM2NDc7XG4vKipcbiAqIElmIHRoZSBzdHJpbmcgY29udGFpbnMgYSAzMi1iaXQgaW50ZWdlciwgcmV0dXJuIGl0LiAgRWxzZSByZXR1cm4gbnVsbC5cbiAqL1xuY29uc3QgdHJ5UGFyc2VJbnQgPSBmdW5jdGlvbiAoc3RyKSB7XG4gICAgaWYgKElOVEVHRVJfUkVHRVhQXy50ZXN0KHN0cikpIHtcbiAgICAgICAgY29uc3QgaW50VmFsID0gTnVtYmVyKHN0cik7XG4gICAgICAgIGlmIChpbnRWYWwgPj0gSU5URUdFUl8zMl9NSU4gJiYgaW50VmFsIDw9IElOVEVHRVJfMzJfTUFYKSB7XG4gICAgICAgICAgICByZXR1cm4gaW50VmFsO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufTtcbi8qKlxuICogSGVscGVyIHRvIHJ1biBzb21lIGNvZGUgYnV0IGNhdGNoIGFueSBleGNlcHRpb25zIGFuZCByZS10aHJvdyB0aGVtIGxhdGVyLlxuICogVXNlZnVsIGZvciBwcmV2ZW50aW5nIHVzZXIgY2FsbGJhY2tzIGZyb20gYnJlYWtpbmcgaW50ZXJuYWwgY29kZS5cbiAqXG4gKiBSZS10aHJvd2luZyB0aGUgZXhjZXB0aW9uIGZyb20gYSBzZXRUaW1lb3V0IGlzIGEgbGl0dGxlIGV2aWwsIGJ1dCBpdCdzIHZlcnlcbiAqIGNvbnZlbmllbnQgKHdlIGRvbid0IGhhdmUgdG8gdHJ5IHRvIGZpZ3VyZSBvdXQgd2hlbiBpcyBhIHNhZmUgcG9pbnQgdG9cbiAqIHJlLXRocm93IGl0KSwgYW5kIHRoZSBiZWhhdmlvciBzZWVtcyByZWFzb25hYmxlOlxuICpcbiAqICogSWYgeW91IGFyZW4ndCBwYXVzaW5nIG9uIGV4Y2VwdGlvbnMsIHlvdSBnZXQgYW4gZXJyb3IgaW4gdGhlIGNvbnNvbGUgd2l0aFxuICogICB0aGUgY29ycmVjdCBzdGFjayB0cmFjZS5cbiAqICogSWYgeW91J3JlIHBhdXNpbmcgb24gYWxsIGV4Y2VwdGlvbnMsIHRoZSBkZWJ1Z2dlciB3aWxsIHBhdXNlIG9uIHlvdXJcbiAqICAgZXhjZXB0aW9uIGFuZCB0aGVuIGFnYWluIHdoZW4gd2UgcmV0aHJvdyBpdC5cbiAqICogSWYgeW91J3JlIG9ubHkgcGF1c2luZyBvbiB1bmNhdWdodCBleGNlcHRpb25zLCB0aGUgZGVidWdnZXIgd2lsbCBvbmx5IHBhdXNlXG4gKiAgIG9uIHVzIHJlLXRocm93aW5nIGl0LlxuICpcbiAqIEBwYXJhbSBmbiAtIFRoZSBjb2RlIHRvIGd1YXJkLlxuICovXG5jb25zdCBleGNlcHRpb25HdWFyZCA9IGZ1bmN0aW9uIChmbikge1xuICAgIHRyeSB7XG4gICAgICAgIGZuKCk7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vIFJlLXRocm93IGV4Y2VwdGlvbiB3aGVuIGl0J3Mgc2FmZS5cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAvLyBJdCB1c2VkIHRvIGJlIHRoYXQgXCJ0aHJvdyBlXCIgd291bGQgcmVzdWx0IGluIGEgZ29vZCBjb25zb2xlIGVycm9yIHdpdGhcbiAgICAgICAgICAgIC8vIHJlbGV2YW50IGNvbnRleHQsIGJ1dCBhcyBvZiBDaHJvbWUgMzksIHlvdSBqdXN0IGdldCB0aGUgZmlyZWJhc2UuanNcbiAgICAgICAgICAgIC8vIGZpbGUvbGluZSBudW1iZXIgd2hlcmUgd2UgcmUtdGhyb3cgaXQsIHdoaWNoIGlzIHVzZWxlc3MuIFNvIHdlIGxvZ1xuICAgICAgICAgICAgLy8gZS5zdGFjayBleHBsaWNpdGx5LlxuICAgICAgICAgICAgY29uc3Qgc3RhY2sgPSBlLnN0YWNrIHx8ICcnO1xuICAgICAgICAgICAgd2FybignRXhjZXB0aW9uIHdhcyB0aHJvd24gYnkgdXNlciBjYWxsYmFjay4nLCBzdGFjayk7XG4gICAgICAgICAgICB0aHJvdyBlO1xuICAgICAgICB9LCBNYXRoLmZsb29yKDApKTtcbiAgICB9XG59O1xuLyoqXG4gKiBAcmV0dXJucyB7Ym9vbGVhbn0gdHJ1ZSBpZiB3ZSB0aGluayB3ZSdyZSBjdXJyZW50bHkgYmVpbmcgY3Jhd2xlZC5cbiAqL1xuY29uc3QgYmVpbmdDcmF3bGVkID0gZnVuY3Rpb24gKCkge1xuICAgIGNvbnN0IHVzZXJBZ2VudCA9ICh0eXBlb2Ygd2luZG93ID09PSAnb2JqZWN0JyAmJlxuICAgICAgICB3aW5kb3dbJ25hdmlnYXRvciddICYmXG4gICAgICAgIHdpbmRvd1snbmF2aWdhdG9yJ11bJ3VzZXJBZ2VudCddKSB8fFxuICAgICAgICAnJztcbiAgICAvLyBGb3Igbm93IHdlIHdoaXRlbGlzdCB0aGUgbW9zdCBwb3B1bGFyIGNyYXdsZXJzLiAgV2Ugc2hvdWxkIHJlZmluZSB0aGlzIHRvIGJlIHRoZSBzZXQgb2YgY3Jhd2xlcnMgd2VcbiAgICAvLyBiZWxpZXZlIHRvIHN1cHBvcnQgSmF2YVNjcmlwdC9BSkFYIHJlbmRlcmluZy5cbiAgICAvLyBOT1RFOiBHb29nbGUgV2VibWFzdGVyIFRvb2xzIGRvZXNuJ3QgcmVhbGx5IGJlbG9uZywgYnV0IHRoZWlyIFwiVGhpcyBpcyBob3cgYSB2aXNpdG9yIHRvIHlvdXIgd2Vic2l0ZVxuICAgIC8vIHdvdWxkIGhhdmUgc2VlbiB0aGUgcGFnZVwiIGlzIGZsYWt5IGlmIHdlIGRvbid0IHRyZWF0IGl0IGFzIGEgY3Jhd2xlci5cbiAgICByZXR1cm4gKHVzZXJBZ2VudC5zZWFyY2goL2dvb2dsZWJvdHxnb29nbGUgd2VibWFzdGVyIHRvb2xzfGJpbmdib3R8eWFob28hIHNsdXJwfGJhaWR1c3BpZGVyfHlhbmRleGJvdHxkdWNrZHVja2JvdC9pKSA+PSAwKTtcbn07XG4vKipcbiAqIFNhbWUgYXMgc2V0VGltZW91dCgpIGV4Y2VwdCBvbiBOb2RlLkpTIGl0IHdpbGwgL25vdC8gcHJldmVudCB0aGUgcHJvY2VzcyBmcm9tIGV4aXRpbmcuXG4gKlxuICogSXQgaXMgcmVtb3ZlZCB3aXRoIGNsZWFyVGltZW91dCgpIGFzIG5vcm1hbC5cbiAqXG4gKiBAcGFyYW0gZm4gLSBGdW5jdGlvbiB0byBydW4uXG4gKiBAcGFyYW0gdGltZSAtIE1pbGxpc2Vjb25kcyB0byB3YWl0IGJlZm9yZSBydW5uaW5nLlxuICogQHJldHVybnMgVGhlIHNldFRpbWVvdXQoKSByZXR1cm4gdmFsdWUuXG4gKi9cbmNvbnN0IHNldFRpbWVvdXROb25CbG9ja2luZyA9IGZ1bmN0aW9uIChmbiwgdGltZSkge1xuICAgIGNvbnN0IHRpbWVvdXQgPSBzZXRUaW1lb3V0KGZuLCB0aW1lKTtcbiAgICAvLyBOb3RlOiBhdCB0aGUgdGltZSBvZiB0aGlzIGNvbW1lbnQsIHVucmVmVGltZXIgaXMgdW5kZXIgdGhlIHVuc3RhYmxlIHNldCBvZiBBUElzLiBSdW4gd2l0aCAtLXVuc3RhYmxlIHRvIGVuYWJsZSB0aGUgQVBJLlxuICAgIGlmICh0eXBlb2YgdGltZW91dCA9PT0gJ251bWJlcicgJiZcbiAgICAgICAgLy8gQHRzLWlnbm9yZSBJcyBvbmx5IGRlZmluZWQgaW4gRGVubyBlbnZpcm9ubWVudHMuXG4gICAgICAgIHR5cGVvZiBEZW5vICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAvLyBAdHMtaWdub3JlIERlbm8gYW5kIHVucmVmVGltZXIgYXJlIG9ubHkgZGVmaW5lZCBpbiBEZW5vIGVudmlyb25tZW50cy5cbiAgICAgICAgRGVub1sndW5yZWZUaW1lciddKSB7XG4gICAgICAgIC8vIEB0cy1pZ25vcmUgRGVubyBhbmQgdW5yZWZUaW1lciBhcmUgb25seSBkZWZpbmVkIGluIERlbm8gZW52aXJvbm1lbnRzLlxuICAgICAgICBEZW5vLnVucmVmVGltZXIodGltZW91dCk7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgfVxuICAgIGVsc2UgaWYgKHR5cGVvZiB0aW1lb3V0ID09PSAnb2JqZWN0JyAmJiB0aW1lb3V0Wyd1bnJlZiddKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIHRpbWVvdXRbJ3VucmVmJ10oKTtcbiAgICB9XG4gICAgcmV0dXJuIHRpbWVvdXQ7XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBYnN0cmFjdGlvbiBhcm91bmQgQXBwQ2hlY2sncyB0b2tlbiBmZXRjaGluZyBjYXBhYmlsaXRpZXMuXG4gKi9cbmNsYXNzIEFwcENoZWNrVG9rZW5Qcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoYXBwLCBhcHBDaGVja1Byb3ZpZGVyKSB7XG4gICAgICAgIHRoaXMuYXBwQ2hlY2tQcm92aWRlciA9IGFwcENoZWNrUHJvdmlkZXI7XG4gICAgICAgIHRoaXMuYXBwTmFtZSA9IGFwcC5uYW1lO1xuICAgICAgICBpZiAoX2lzRmlyZWJhc2VTZXJ2ZXJBcHAoYXBwKSAmJiBhcHAuc2V0dGluZ3MuYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJBcHBBcHBDaGVja1Rva2VuID0gYXBwLnNldHRpbmdzLmFwcENoZWNrVG9rZW47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5hcHBDaGVjayA9IGFwcENoZWNrUHJvdmlkZXIgPT09IG51bGwgfHwgYXBwQ2hlY2tQcm92aWRlciA9PT0gdm9pZCAwID8gdm9pZCAwIDogYXBwQ2hlY2tQcm92aWRlci5nZXRJbW1lZGlhdGUoeyBvcHRpb25hbDogdHJ1ZSB9KTtcbiAgICAgICAgaWYgKCF0aGlzLmFwcENoZWNrKSB7XG4gICAgICAgICAgICBhcHBDaGVja1Byb3ZpZGVyID09PSBudWxsIHx8IGFwcENoZWNrUHJvdmlkZXIgPT09IHZvaWQgMCA/IHZvaWQgMCA6IGFwcENoZWNrUHJvdmlkZXIuZ2V0KCkudGhlbihhcHBDaGVjayA9PiAodGhpcy5hcHBDaGVjayA9IGFwcENoZWNrKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKSB7XG4gICAgICAgIGlmICh0aGlzLnNlcnZlckFwcEFwcENoZWNrVG9rZW4pIHtcbiAgICAgICAgICAgIGlmIChmb3JjZVJlZnJlc2gpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F0dGVtcHRlZCByZXVzZSBvZiBgRmlyZWJhc2VTZXJ2ZXJBcHAuYXBwQ2hlY2tUb2tlbmAgYWZ0ZXIgcHJldmlvdXMgdXNhZ2UgZmFpbGVkLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSh7IHRva2VuOiB0aGlzLnNlcnZlckFwcEFwcENoZWNrVG9rZW4gfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmFwcENoZWNrKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgZGVsYXllZCBpbml0aWFsaXphdGlvbiBvZiBGaXJlYmFzZUFwcENoZWNrLiBUaGlzIGFsbG93cyBvdXJcbiAgICAgICAgICAgICAgICAvLyBjdXN0b21lcnMgdG8gaW5pdGlhbGl6ZSB0aGUgUlREQiBTREsgYmVmb3JlIGluaXRpYWxpemluZyBGaXJlYmFzZVxuICAgICAgICAgICAgICAgIC8vIEFwcENoZWNrIGFuZCBlbnN1cmVzIHRoYXQgYWxsIHJlcXVlc3RzIGFyZSBhdXRoZW50aWNhdGVkIGlmIGEgdG9rZW5cbiAgICAgICAgICAgICAgICAvLyBiZWNvbWVzIGF2YWlsYWJsZSBiZWZvcmUgdGhlIHRpbWVvdXQgYmVsb3cgZXhwaXJlcy5cbiAgICAgICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuYXBwQ2hlY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKS50aGVuKHJlc29sdmUsIHJlamVjdCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5hcHBDaGVjay5nZXRUb2tlbihmb3JjZVJlZnJlc2gpO1xuICAgIH1cbiAgICBhZGRUb2tlbkNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gICAgICAgIHZhciBfYTtcbiAgICAgICAgKF9hID0gdGhpcy5hcHBDaGVja1Byb3ZpZGVyKSA9PT0gbnVsbCB8fCBfYSA9PT0gdm9pZCAwID8gdm9pZCAwIDogX2EuZ2V0KCkudGhlbihhcHBDaGVjayA9PiBhcHBDaGVjay5hZGRUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKSk7XG4gICAgfVxuICAgIG5vdGlmeUZvckludmFsaWRUb2tlbigpIHtcbiAgICAgICAgd2FybihgUHJvdmlkZWQgQXBwQ2hlY2sgY3JlZGVudGlhbHMgZm9yIHRoZSBhcHAgbmFtZWQgXCIke3RoaXMuYXBwTmFtZX1cIiBgICtcbiAgICAgICAgICAgICdhcmUgaW52YWxpZC4gVGhpcyB1c3VhbGx5IGluZGljYXRlcyB5b3VyIGFwcCB3YXMgbm90IGluaXRpYWxpemVkIGNvcnJlY3RseS4nKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFic3RyYWN0aW9uIGFyb3VuZCBGaXJlYmFzZUFwcCdzIHRva2VuIGZldGNoaW5nIGNhcGFiaWxpdGllcy5cbiAqL1xuY2xhc3MgRmlyZWJhc2VBdXRoVG9rZW5Qcm92aWRlciB7XG4gICAgY29uc3RydWN0b3IoYXBwTmFtZV8sIGZpcmViYXNlT3B0aW9uc18sIGF1dGhQcm92aWRlcl8pIHtcbiAgICAgICAgdGhpcy5hcHBOYW1lXyA9IGFwcE5hbWVfO1xuICAgICAgICB0aGlzLmZpcmViYXNlT3B0aW9uc18gPSBmaXJlYmFzZU9wdGlvbnNfO1xuICAgICAgICB0aGlzLmF1dGhQcm92aWRlcl8gPSBhdXRoUHJvdmlkZXJfO1xuICAgICAgICB0aGlzLmF1dGhfID0gbnVsbDtcbiAgICAgICAgdGhpcy5hdXRoXyA9IGF1dGhQcm92aWRlcl8uZ2V0SW1tZWRpYXRlKHsgb3B0aW9uYWw6IHRydWUgfSk7XG4gICAgICAgIGlmICghdGhpcy5hdXRoXykge1xuICAgICAgICAgICAgYXV0aFByb3ZpZGVyXy5vbkluaXQoYXV0aCA9PiAodGhpcy5hdXRoXyA9IGF1dGgpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRUb2tlbihmb3JjZVJlZnJlc2gpIHtcbiAgICAgICAgaWYgKCF0aGlzLmF1dGhfKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgICAgIC8vIFN1cHBvcnQgZGVsYXllZCBpbml0aWFsaXphdGlvbiBvZiBGaXJlYmFzZUF1dGguIFRoaXMgYWxsb3dzIG91clxuICAgICAgICAgICAgICAgIC8vIGN1c3RvbWVycyB0byBpbml0aWFsaXplIHRoZSBSVERCIFNESyBiZWZvcmUgaW5pdGlhbGl6aW5nIEZpcmViYXNlXG4gICAgICAgICAgICAgICAgLy8gQXV0aCBhbmQgZW5zdXJlcyB0aGF0IGFsbCByZXF1ZXN0cyBhcmUgYXV0aGVudGljYXRlZCBpZiBhIHRva2VuXG4gICAgICAgICAgICAgICAgLy8gYmVjb21lcyBhdmFpbGFibGUgYmVmb3JlIHRoZSB0aW1lb3V0IGJlbG93IGV4cGlyZXMuXG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1dGhfKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmdldFRva2VuKGZvcmNlUmVmcmVzaCkudGhlbihyZXNvbHZlLCByZWplY3QpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShudWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0sIDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYXV0aF8uZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKS5jYXRjaChlcnJvciA9PiB7XG4gICAgICAgICAgICAvLyBUT0RPOiBOZWVkIHRvIGZpZ3VyZSBvdXQgYWxsIHRoZSBjYXNlcyB0aGlzIGlzIHJhaXNlZCBhbmQgd2hldGhlclxuICAgICAgICAgICAgLy8gdGhpcyBtYWtlcyBzZW5zZS5cbiAgICAgICAgICAgIGlmIChlcnJvciAmJiBlcnJvci5jb2RlID09PSAnYXV0aC90b2tlbi1ub3QtaW5pdGlhbGl6ZWQnKSB7XG4gICAgICAgICAgICAgICAgbG9nKCdHb3QgYXV0aC90b2tlbi1ub3QtaW5pdGlhbGl6ZWQgZXJyb3IuICBUcmVhdGluZyBhcyBudWxsIHRva2VuLicpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGFkZFRva2VuQ2hhbmdlTGlzdGVuZXIobGlzdGVuZXIpIHtcbiAgICAgICAgLy8gVE9ETzogV2UgbWlnaHQgd2FudCB0byB3cmFwIHRoZSBsaXN0ZW5lciBhbmQgY2FsbCBpdCB3aXRoIG5vIGFyZ3MgdG9cbiAgICAgICAgLy8gYXZvaWQgYSBsZWFreSBhYnN0cmFjdGlvbiwgYnV0IHRoYXQgbWFrZXMgcmVtb3ZpbmcgdGhlIGxpc3RlbmVyIGhhcmRlci5cbiAgICAgICAgaWYgKHRoaXMuYXV0aF8pIHtcbiAgICAgICAgICAgIHRoaXMuYXV0aF8uYWRkQXV0aFRva2VuTGlzdGVuZXIobGlzdGVuZXIpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5hdXRoUHJvdmlkZXJfXG4gICAgICAgICAgICAgICAgLmdldCgpXG4gICAgICAgICAgICAgICAgLnRoZW4oYXV0aCA9PiBhdXRoLmFkZEF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVtb3ZlVG9rZW5DaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcikge1xuICAgICAgICB0aGlzLmF1dGhQcm92aWRlcl9cbiAgICAgICAgICAgIC5nZXQoKVxuICAgICAgICAgICAgLnRoZW4oYXV0aCA9PiBhdXRoLnJlbW92ZUF1dGhUb2tlbkxpc3RlbmVyKGxpc3RlbmVyKSk7XG4gICAgfVxuICAgIG5vdGlmeUZvckludmFsaWRUb2tlbigpIHtcbiAgICAgICAgbGV0IGVycm9yTWVzc2FnZSA9ICdQcm92aWRlZCBhdXRoZW50aWNhdGlvbiBjcmVkZW50aWFscyBmb3IgdGhlIGFwcCBuYW1lZCBcIicgK1xuICAgICAgICAgICAgdGhpcy5hcHBOYW1lXyArXG4gICAgICAgICAgICAnXCIgYXJlIGludmFsaWQuIFRoaXMgdXN1YWxseSBpbmRpY2F0ZXMgeW91ciBhcHAgd2FzIG5vdCAnICtcbiAgICAgICAgICAgICdpbml0aWFsaXplZCBjb3JyZWN0bHkuICc7XG4gICAgICAgIGlmICgnY3JlZGVudGlhbCcgaW4gdGhpcy5maXJlYmFzZU9wdGlvbnNfKSB7XG4gICAgICAgICAgICBlcnJvck1lc3NhZ2UgKz1cbiAgICAgICAgICAgICAgICAnTWFrZSBzdXJlIHRoZSBcImNyZWRlbnRpYWxcIiBwcm9wZXJ0eSBwcm92aWRlZCB0byBpbml0aWFsaXplQXBwKCkgJyArXG4gICAgICAgICAgICAgICAgICAgICdpcyBhdXRob3JpemVkIHRvIGFjY2VzcyB0aGUgc3BlY2lmaWVkIFwiZGF0YWJhc2VVUkxcIiBhbmQgaXMgZnJvbSB0aGUgY29ycmVjdCAnICtcbiAgICAgICAgICAgICAgICAgICAgJ3Byb2plY3QuJztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgnc2VydmljZUFjY291bnQnIGluIHRoaXMuZmlyZWJhc2VPcHRpb25zXykge1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlICs9XG4gICAgICAgICAgICAgICAgJ01ha2Ugc3VyZSB0aGUgXCJzZXJ2aWNlQWNjb3VudFwiIHByb3BlcnR5IHByb3ZpZGVkIHRvIGluaXRpYWxpemVBcHAoKSAnICtcbiAgICAgICAgICAgICAgICAgICAgJ2lzIGF1dGhvcml6ZWQgdG8gYWNjZXNzIHRoZSBzcGVjaWZpZWQgXCJkYXRhYmFzZVVSTFwiIGFuZCBpcyBmcm9tIHRoZSBjb3JyZWN0ICcgK1xuICAgICAgICAgICAgICAgICAgICAncHJvamVjdC4nO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZXJyb3JNZXNzYWdlICs9XG4gICAgICAgICAgICAgICAgJ01ha2Ugc3VyZSB0aGUgXCJhcGlLZXlcIiBhbmQgXCJkYXRhYmFzZVVSTFwiIHByb3BlcnRpZXMgcHJvdmlkZWQgdG8gJyArXG4gICAgICAgICAgICAgICAgICAgICdpbml0aWFsaXplQXBwKCkgbWF0Y2ggdGhlIHZhbHVlcyBwcm92aWRlZCBmb3IgeW91ciBhcHAgYXQgJyArXG4gICAgICAgICAgICAgICAgICAgICdodHRwczovL2NvbnNvbGUuZmlyZWJhc2UuZ29vZ2xlLmNvbS8uJztcbiAgICAgICAgfVxuICAgICAgICB3YXJuKGVycm9yTWVzc2FnZSk7XG4gICAgfVxufVxuLyogQXV0aFRva2VuUHJvdmlkZXIgdGhhdCBzdXBwbGllcyBhIGNvbnN0YW50IHRva2VuLiBVc2VkIGJ5IEFkbWluIFNESyBvciBtb2NrVXNlclRva2VuIHdpdGggZW11bGF0b3JzLiAqL1xuY2xhc3MgRW11bGF0b3JUb2tlblByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3RvcihhY2Nlc3NUb2tlbikge1xuICAgICAgICB0aGlzLmFjY2Vzc1Rva2VuID0gYWNjZXNzVG9rZW47XG4gICAgfVxuICAgIGdldFRva2VuKGZvcmNlUmVmcmVzaCkge1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHtcbiAgICAgICAgICAgIGFjY2Vzc1Rva2VuOiB0aGlzLmFjY2Vzc1Rva2VuXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhZGRUb2tlbkNoYW5nZUxpc3RlbmVyKGxpc3RlbmVyKSB7XG4gICAgICAgIC8vIEludm9rZSB0aGUgbGlzdGVuZXIgaW1tZWRpYXRlbHkgdG8gbWF0Y2ggdGhlIGJlaGF2aW9yIGluIEZpcmViYXNlIEF1dGhcbiAgICAgICAgLy8gKHNlZSBwYWNrYWdlcy9hdXRoL3NyYy9hdXRoLmpzI0wxODA3KVxuICAgICAgICBsaXN0ZW5lcih0aGlzLmFjY2Vzc1Rva2VuKTtcbiAgICB9XG4gICAgcmVtb3ZlVG9rZW5DaGFuZ2VMaXN0ZW5lcihsaXN0ZW5lcikgeyB9XG4gICAgbm90aWZ5Rm9ySW52YWxpZFRva2VuKCkgeyB9XG59XG4vKiogQSBzdHJpbmcgdGhhdCBpcyB0cmVhdGVkIGFzIGFuIGFkbWluIGFjY2VzcyB0b2tlbiBieSB0aGUgUlREQiBlbXVsYXRvci4gVXNlZCBieSBBZG1pbiBTREsuICovXG5FbXVsYXRvclRva2VuUHJvdmlkZXIuT1dORVIgPSAnb3duZXInO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgUFJPVE9DT0xfVkVSU0lPTiA9ICc1JztcbmNvbnN0IFZFUlNJT05fUEFSQU0gPSAndic7XG5jb25zdCBUUkFOU1BPUlRfU0VTU0lPTl9QQVJBTSA9ICdzJztcbmNvbnN0IFJFRkVSRVJfUEFSQU0gPSAncic7XG5jb25zdCBGT1JHRV9SRUYgPSAnZic7XG4vLyBNYXRjaGVzIGNvbnNvbGUuZmlyZWJhc2UuZ29vZ2xlLmNvbSwgZmlyZWJhc2UtY29uc29sZS0qLmNvcnAuZ29vZ2xlLmNvbSBhbmRcbi8vIGZpcmViYXNlLmNvcnAuZ29vZ2xlLmNvbVxuY29uc3QgRk9SR0VfRE9NQUlOX1JFID0gLyhjb25zb2xlXFwuZmlyZWJhc2V8ZmlyZWJhc2UtY29uc29sZS1cXHcrXFwuY29ycHxmaXJlYmFzZVxcLmNvcnApXFwuZ29vZ2xlXFwuY29tLztcbmNvbnN0IExBU1RfU0VTU0lPTl9QQVJBTSA9ICdscyc7XG5jb25zdCBBUFBMSUNBVElPTl9JRF9QQVJBTSA9ICdwJztcbmNvbnN0IEFQUF9DSEVDS19UT0tFTl9QQVJBTSA9ICdhYyc7XG5jb25zdCBXRUJTT0NLRVQgPSAnd2Vic29ja2V0JztcbmNvbnN0IExPTkdfUE9MTElORyA9ICdsb25nX3BvbGxpbmcnO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIGNsYXNzIHRoYXQgaG9sZHMgbWV0YWRhdGEgYWJvdXQgYSBSZXBvIG9iamVjdFxuICovXG5jbGFzcyBSZXBvSW5mbyB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGhvc3QgLSBIb3N0bmFtZSBwb3J0aW9uIG9mIHRoZSB1cmwgZm9yIHRoZSByZXBvXG4gICAgICogQHBhcmFtIHNlY3VyZSAtIFdoZXRoZXIgb3Igbm90IHRoaXMgcmVwbyBpcyBhY2Nlc3NlZCBvdmVyIHNzbFxuICAgICAqIEBwYXJhbSBuYW1lc3BhY2UgLSBUaGUgbmFtZXNwYWNlIHJlcHJlc2VudGVkIGJ5IHRoZSByZXBvXG4gICAgICogQHBhcmFtIHdlYlNvY2tldE9ubHkgLSBXaGV0aGVyIHRvIHByZWZlciB3ZWJzb2NrZXRzIG92ZXIgYWxsIG90aGVyIHRyYW5zcG9ydHMgKHVzZWQgYnkgTmVzdCkuXG4gICAgICogQHBhcmFtIG5vZGVBZG1pbiAtIFdoZXRoZXIgdGhpcyBpbnN0YW5jZSB1c2VzIEFkbWluIFNESyBjcmVkZW50aWFsc1xuICAgICAqIEBwYXJhbSBwZXJzaXN0ZW5jZUtleSAtIE92ZXJyaWRlIHRoZSBkZWZhdWx0IHNlc3Npb24gcGVyc2lzdGVuY2Ugc3RvcmFnZSBrZXlcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihob3N0LCBzZWN1cmUsIG5hbWVzcGFjZSwgd2ViU29ja2V0T25seSwgbm9kZUFkbWluID0gZmFsc2UsIHBlcnNpc3RlbmNlS2V5ID0gJycsIGluY2x1ZGVOYW1lc3BhY2VJblF1ZXJ5UGFyYW1zID0gZmFsc2UsIGlzVXNpbmdFbXVsYXRvciA9IGZhbHNlLCBlbXVsYXRvck9wdGlvbnMgPSBudWxsKSB7XG4gICAgICAgIHRoaXMuc2VjdXJlID0gc2VjdXJlO1xuICAgICAgICB0aGlzLm5hbWVzcGFjZSA9IG5hbWVzcGFjZTtcbiAgICAgICAgdGhpcy53ZWJTb2NrZXRPbmx5ID0gd2ViU29ja2V0T25seTtcbiAgICAgICAgdGhpcy5ub2RlQWRtaW4gPSBub2RlQWRtaW47XG4gICAgICAgIHRoaXMucGVyc2lzdGVuY2VLZXkgPSBwZXJzaXN0ZW5jZUtleTtcbiAgICAgICAgdGhpcy5pbmNsdWRlTmFtZXNwYWNlSW5RdWVyeVBhcmFtcyA9IGluY2x1ZGVOYW1lc3BhY2VJblF1ZXJ5UGFyYW1zO1xuICAgICAgICB0aGlzLmlzVXNpbmdFbXVsYXRvciA9IGlzVXNpbmdFbXVsYXRvcjtcbiAgICAgICAgdGhpcy5lbXVsYXRvck9wdGlvbnMgPSBlbXVsYXRvck9wdGlvbnM7XG4gICAgICAgIHRoaXMuX2hvc3QgPSBob3N0LnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIHRoaXMuX2RvbWFpbiA9IHRoaXMuX2hvc3Quc3Vic3RyKHRoaXMuX2hvc3QuaW5kZXhPZignLicpICsgMSk7XG4gICAgICAgIHRoaXMuaW50ZXJuYWxIb3N0ID1cbiAgICAgICAgICAgIFBlcnNpc3RlbnRTdG9yYWdlLmdldCgnaG9zdDonICsgaG9zdCkgfHwgdGhpcy5faG9zdDtcbiAgICB9XG4gICAgaXNDYWNoZWFibGVIb3N0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbnRlcm5hbEhvc3Quc3Vic3RyKDAsIDIpID09PSAncy0nO1xuICAgIH1cbiAgICBpc0N1c3RvbUhvc3QoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5fZG9tYWluICE9PSAnZmlyZWJhc2Vpby5jb20nICYmXG4gICAgICAgICAgICB0aGlzLl9kb21haW4gIT09ICdmaXJlYmFzZWlvLWRlbW8uY29tJyk7XG4gICAgfVxuICAgIGdldCBob3N0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5faG9zdDtcbiAgICB9XG4gICAgc2V0IGhvc3QobmV3SG9zdCkge1xuICAgICAgICBpZiAobmV3SG9zdCAhPT0gdGhpcy5pbnRlcm5hbEhvc3QpIHtcbiAgICAgICAgICAgIHRoaXMuaW50ZXJuYWxIb3N0ID0gbmV3SG9zdDtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2FjaGVhYmxlSG9zdCgpKSB7XG4gICAgICAgICAgICAgICAgUGVyc2lzdGVudFN0b3JhZ2Uuc2V0KCdob3N0OicgKyB0aGlzLl9ob3N0LCB0aGlzLmludGVybmFsSG9zdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIGxldCBzdHIgPSB0aGlzLnRvVVJMU3RyaW5nKCk7XG4gICAgICAgIGlmICh0aGlzLnBlcnNpc3RlbmNlS2V5KSB7XG4gICAgICAgICAgICBzdHIgKz0gJzwnICsgdGhpcy5wZXJzaXN0ZW5jZUtleSArICc+JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gc3RyO1xuICAgIH1cbiAgICB0b1VSTFN0cmluZygpIHtcbiAgICAgICAgY29uc3QgcHJvdG9jb2wgPSB0aGlzLnNlY3VyZSA/ICdodHRwczovLycgOiAnaHR0cDovLyc7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gdGhpcy5pbmNsdWRlTmFtZXNwYWNlSW5RdWVyeVBhcmFtc1xuICAgICAgICAgICAgPyBgP25zPSR7dGhpcy5uYW1lc3BhY2V9YFxuICAgICAgICAgICAgOiAnJztcbiAgICAgICAgcmV0dXJuIGAke3Byb3RvY29sfSR7dGhpcy5ob3N0fS8ke3F1ZXJ5fWA7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVwb0luZm9OZWVkc1F1ZXJ5UGFyYW0ocmVwb0luZm8pIHtcbiAgICByZXR1cm4gKHJlcG9JbmZvLmhvc3QgIT09IHJlcG9JbmZvLmludGVybmFsSG9zdCB8fFxuICAgICAgICByZXBvSW5mby5pc0N1c3RvbUhvc3QoKSB8fFxuICAgICAgICByZXBvSW5mby5pbmNsdWRlTmFtZXNwYWNlSW5RdWVyeVBhcmFtcyk7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIHdlYnNvY2tldCBVUkwgZm9yIHRoaXMgcmVwb1xuICogQHBhcmFtIHJlcG9JbmZvIC0gUmVwb0luZm8gb2JqZWN0XG4gKiBAcGFyYW0gdHlwZSAtIG9mIGNvbm5lY3Rpb25cbiAqIEBwYXJhbSBwYXJhbXMgLSBsaXN0XG4gKiBAcmV0dXJucyBUaGUgVVJMIGZvciB0aGlzIHJlcG9cbiAqL1xuZnVuY3Rpb24gcmVwb0luZm9Db25uZWN0aW9uVVJMKHJlcG9JbmZvLCB0eXBlLCBwYXJhbXMpIHtcbiAgICBhc3NlcnQodHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnLCAndHlwZW9mIHR5cGUgbXVzdCA9PSBzdHJpbmcnKTtcbiAgICBhc3NlcnQodHlwZW9mIHBhcmFtcyA9PT0gJ29iamVjdCcsICd0eXBlb2YgcGFyYW1zIG11c3QgPT0gb2JqZWN0Jyk7XG4gICAgbGV0IGNvbm5VUkw7XG4gICAgaWYgKHR5cGUgPT09IFdFQlNPQ0tFVCkge1xuICAgICAgICBjb25uVVJMID1cbiAgICAgICAgICAgIChyZXBvSW5mby5zZWN1cmUgPyAnd3NzOi8vJyA6ICd3czovLycpICsgcmVwb0luZm8uaW50ZXJuYWxIb3N0ICsgJy8ud3M/JztcbiAgICB9XG4gICAgZWxzZSBpZiAodHlwZSA9PT0gTE9OR19QT0xMSU5HKSB7XG4gICAgICAgIGNvbm5VUkwgPVxuICAgICAgICAgICAgKHJlcG9JbmZvLnNlY3VyZSA/ICdodHRwczovLycgOiAnaHR0cDovLycpICtcbiAgICAgICAgICAgICAgICByZXBvSW5mby5pbnRlcm5hbEhvc3QgK1xuICAgICAgICAgICAgICAgICcvLmxwPyc7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gY29ubmVjdGlvbiB0eXBlOiAnICsgdHlwZSk7XG4gICAgfVxuICAgIGlmIChyZXBvSW5mb05lZWRzUXVlcnlQYXJhbShyZXBvSW5mbykpIHtcbiAgICAgICAgcGFyYW1zWyducyddID0gcmVwb0luZm8ubmFtZXNwYWNlO1xuICAgIH1cbiAgICBjb25zdCBwYWlycyA9IFtdO1xuICAgIGVhY2gocGFyYW1zLCAoa2V5LCB2YWx1ZSkgPT4ge1xuICAgICAgICBwYWlycy5wdXNoKGtleSArICc9JyArIHZhbHVlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gY29ublVSTCArIHBhaXJzLmpvaW4oJyYnKTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVHJhY2tzIGEgY29sbGVjdGlvbiBvZiBzdGF0cy5cbiAqL1xuY2xhc3MgU3RhdHNDb2xsZWN0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5jb3VudGVyc18gPSB7fTtcbiAgICB9XG4gICAgaW5jcmVtZW50Q291bnRlcihuYW1lLCBhbW91bnQgPSAxKSB7XG4gICAgICAgIGlmICghY29udGFpbnModGhpcy5jb3VudGVyc18sIG5hbWUpKSB7XG4gICAgICAgICAgICB0aGlzLmNvdW50ZXJzX1tuYW1lXSA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jb3VudGVyc19bbmFtZV0gKz0gYW1vdW50O1xuICAgIH1cbiAgICBnZXQoKSB7XG4gICAgICAgIHJldHVybiBkZWVwQ29weSh0aGlzLmNvdW50ZXJzXyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgY29sbGVjdGlvbnMgPSB7fTtcbmNvbnN0IHJlcG9ydGVycyA9IHt9O1xuZnVuY3Rpb24gc3RhdHNNYW5hZ2VyR2V0Q29sbGVjdGlvbihyZXBvSW5mbykge1xuICAgIGNvbnN0IGhhc2hTdHJpbmcgPSByZXBvSW5mby50b1N0cmluZygpO1xuICAgIGlmICghY29sbGVjdGlvbnNbaGFzaFN0cmluZ10pIHtcbiAgICAgICAgY29sbGVjdGlvbnNbaGFzaFN0cmluZ10gPSBuZXcgU3RhdHNDb2xsZWN0aW9uKCk7XG4gICAgfVxuICAgIHJldHVybiBjb2xsZWN0aW9uc1toYXNoU3RyaW5nXTtcbn1cbmZ1bmN0aW9uIHN0YXRzTWFuYWdlckdldE9yQ3JlYXRlUmVwb3J0ZXIocmVwb0luZm8sIGNyZWF0b3JGdW5jdGlvbikge1xuICAgIGNvbnN0IGhhc2hTdHJpbmcgPSByZXBvSW5mby50b1N0cmluZygpO1xuICAgIGlmICghcmVwb3J0ZXJzW2hhc2hTdHJpbmddKSB7XG4gICAgICAgIHJlcG9ydGVyc1toYXNoU3RyaW5nXSA9IGNyZWF0b3JGdW5jdGlvbigpO1xuICAgIH1cbiAgICByZXR1cm4gcmVwb3J0ZXJzW2hhc2hTdHJpbmddO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGlzIGNsYXNzIGVuc3VyZXMgdGhlIHBhY2tldHMgZnJvbSB0aGUgc2VydmVyIGFycml2ZSBpbiBvcmRlclxuICogVGhpcyBjbGFzcyB0YWtlcyBkYXRhIGZyb20gdGhlIHNlcnZlciBhbmQgZW5zdXJlcyBpdCBnZXRzIHBhc3NlZCBpbnRvIHRoZSBjYWxsYmFja3MgaW4gb3JkZXIuXG4gKi9cbmNsYXNzIFBhY2tldFJlY2VpdmVyIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gb25NZXNzYWdlX1xuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG9uTWVzc2FnZV8pIHtcbiAgICAgICAgdGhpcy5vbk1lc3NhZ2VfID0gb25NZXNzYWdlXztcbiAgICAgICAgdGhpcy5wZW5kaW5nUmVzcG9uc2VzID0gW107XG4gICAgICAgIHRoaXMuY3VycmVudFJlc3BvbnNlTnVtID0gMDtcbiAgICAgICAgdGhpcy5jbG9zZUFmdGVyUmVzcG9uc2UgPSAtMTtcbiAgICAgICAgdGhpcy5vbkNsb3NlID0gbnVsbDtcbiAgICB9XG4gICAgY2xvc2VBZnRlcihyZXNwb25zZU51bSwgY2FsbGJhY2spIHtcbiAgICAgICAgdGhpcy5jbG9zZUFmdGVyUmVzcG9uc2UgPSByZXNwb25zZU51bTtcbiAgICAgICAgdGhpcy5vbkNsb3NlID0gY2FsbGJhY2s7XG4gICAgICAgIGlmICh0aGlzLmNsb3NlQWZ0ZXJSZXNwb25zZSA8IHRoaXMuY3VycmVudFJlc3BvbnNlTnVtKSB7XG4gICAgICAgICAgICB0aGlzLm9uQ2xvc2UoKTtcbiAgICAgICAgICAgIHRoaXMub25DbG9zZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogRWFjaCBtZXNzYWdlIGZyb20gdGhlIHNlcnZlciBjb21lcyB3aXRoIGEgcmVzcG9uc2UgbnVtYmVyLCBhbmQgYW4gYXJyYXkgb2YgZGF0YS4gVGhlIHJlc3BvbnNlTnVtYmVyXG4gICAgICogYWxsb3dzIHVzIHRvIGVuc3VyZSB0aGF0IHdlIHByb2Nlc3MgdGhlbSBpbiB0aGUgcmlnaHQgb3JkZXIsIHNpbmNlIHdlIGNhbid0IGJlIGd1YXJhbnRlZWQgdGhhdCBhbGxcbiAgICAgKiBicm93c2VycyB3aWxsIHJlc3BvbmQgaW4gdGhlIHNhbWUgb3JkZXIgYXMgdGhlIHJlcXVlc3RzIHdlIHNlbnRcbiAgICAgKi9cbiAgICBoYW5kbGVSZXNwb25zZShyZXF1ZXN0TnVtLCBkYXRhKSB7XG4gICAgICAgIHRoaXMucGVuZGluZ1Jlc3BvbnNlc1tyZXF1ZXN0TnVtXSA9IGRhdGE7XG4gICAgICAgIHdoaWxlICh0aGlzLnBlbmRpbmdSZXNwb25zZXNbdGhpcy5jdXJyZW50UmVzcG9uc2VOdW1dKSB7XG4gICAgICAgICAgICBjb25zdCB0b1Byb2Nlc3MgPSB0aGlzLnBlbmRpbmdSZXNwb25zZXNbdGhpcy5jdXJyZW50UmVzcG9uc2VOdW1dO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMucGVuZGluZ1Jlc3BvbnNlc1t0aGlzLmN1cnJlbnRSZXNwb25zZU51bV07XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvUHJvY2Vzcy5sZW5ndGg7ICsraSkge1xuICAgICAgICAgICAgICAgIGlmICh0b1Byb2Nlc3NbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgZXhjZXB0aW9uR3VhcmQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbk1lc3NhZ2VfKHRvUHJvY2Vzc1tpXSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRSZXNwb25zZU51bSA9PT0gdGhpcy5jbG9zZUFmdGVyUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5vbkNsb3NlKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25DbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQ2xvc2UgPSBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY3VycmVudFJlc3BvbnNlTnVtKys7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBVUkwgcXVlcnkgcGFyYW1ldGVycyBhc3NvY2lhdGVkIHdpdGggbG9uZ3BvbGxpbmdcbmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX1NUQVJUX1BBUkFNID0gJ3N0YXJ0JztcbmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0NMT1NFX0NPTU1BTkQgPSAnY2xvc2UnO1xuY29uc3QgRklSRUJBU0VfTE9OR1BPTExfQ09NTUFORF9DQl9OQU1FID0gJ3BMUENvbW1hbmQnO1xuY29uc3QgRklSRUJBU0VfTE9OR1BPTExfREFUQV9DQl9OQU1FID0gJ3BSVExQQ0InO1xuY29uc3QgRklSRUJBU0VfTE9OR1BPTExfSURfUEFSQU0gPSAnaWQnO1xuY29uc3QgRklSRUJBU0VfTE9OR1BPTExfUFdfUEFSQU0gPSAncHcnO1xuY29uc3QgRklSRUJBU0VfTE9OR1BPTExfU0VSSUFMX1BBUkFNID0gJ3Nlcic7XG5jb25zdCBGSVJFQkFTRV9MT05HUE9MTF9DQUxMQkFDS19JRF9QQVJBTSA9ICdjYic7XG5jb25zdCBGSVJFQkFTRV9MT05HUE9MTF9TRUdNRU5UX05VTV9QQVJBTSA9ICdzZWcnO1xuY29uc3QgRklSRUJBU0VfTE9OR1BPTExfU0VHTUVOVFNfSU5fUEFDS0VUID0gJ3RzJztcbmNvbnN0IEZJUkVCQVNFX0xPTkdQT0xMX0RBVEFfUEFSQU0gPSAnZCc7XG5jb25zdCBGSVJFQkFTRV9MT05HUE9MTF9ESVNDT05OX0ZSQU1FX1JFUVVFU1RfUEFSQU0gPSAnZGZyYW1lJztcbi8vRGF0YSBzaXplIGNvbnN0YW50cy5cbi8vVE9ETzogUGVyZjogdGhlIG1heGltdW0gbGVuZ3RoIGFjdHVhbGx5IGRpZmZlcnMgZnJvbSBicm93c2VyIHRvIGJyb3dzZXIuXG4vLyBXZSBzaG91bGQgY2hlY2sgd2hhdCBicm93c2VyIHdlJ3JlIG9uIGFuZCBzZXQgYWNjb3JkaW5nbHkuXG5jb25zdCBNQVhfVVJMX0RBVEFfU0laRSA9IDE4NzA7XG5jb25zdCBTRUdfSEVBREVSX1NJWkUgPSAzMDsgLy9pZTogJnNlZz04Mjk5MjM0JnRzPTk4MjM4OTEyMyZkPVxuY29uc3QgTUFYX1BBWUxPQURfU0laRSA9IE1BWF9VUkxfREFUQV9TSVpFIC0gU0VHX0hFQURFUl9TSVpFO1xuLyoqXG4gKiBLZWVwYWxpdmUgcGVyaW9kXG4gKiBzZW5kIGEgZnJlc2ggcmVxdWVzdCBhdCBtaW5pbXVtIGV2ZXJ5IDI1IHNlY29uZHMuIE9wZXJhIGhhcyBhIG1heGltdW0gcmVxdWVzdFxuICogbGVuZ3RoIG9mIDMwIHNlY29uZHMgdGhhdCB3ZSBjYW4ndCBleGNlZWQuXG4gKi9cbmNvbnN0IEtFRVBBTElWRV9SRVFVRVNUX0lOVEVSVkFMID0gMjUwMDA7XG4vKipcbiAqIEhvdyBsb25nIHRvIHdhaXQgYmVmb3JlIGFib3J0aW5nIGEgbG9uZy1wb2xsaW5nIGNvbm5lY3Rpb24gYXR0ZW1wdC5cbiAqL1xuY29uc3QgTFBfQ09OTkVDVF9USU1FT1VUID0gMzAwMDA7XG4vKipcbiAqIFRoaXMgY2xhc3MgbWFuYWdlcyBhIHNpbmdsZSBsb25nLXBvbGxpbmcgY29ubmVjdGlvbi5cbiAqL1xuY2xhc3MgQnJvd3NlclBvbGxDb25uZWN0aW9uIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gY29ubklkIEFuIGlkZW50aWZpZXIgZm9yIHRoaXMgY29ubmVjdGlvbiwgdXNlZCBmb3IgbG9nZ2luZ1xuICAgICAqIEBwYXJhbSByZXBvSW5mbyBUaGUgaW5mbyBmb3IgdGhlIGVuZHBvaW50IHRvIHNlbmQgZGF0YSB0by5cbiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25JZCBUaGUgRmlyZWJhc2UgQXBwIElEIGZvciB0aGlzIHByb2plY3QuXG4gICAgICogQHBhcmFtIGFwcENoZWNrVG9rZW4gVGhlIEFwcENoZWNrIHRva2VuIGZvciB0aGlzIGNsaWVudC5cbiAgICAgKiBAcGFyYW0gYXV0aFRva2VuIFRoZSBBdXRoVG9rZW4gdG8gdXNlIGZvciB0aGlzIGNvbm5lY3Rpb24uXG4gICAgICogQHBhcmFtIHRyYW5zcG9ydFNlc3Npb25JZCBPcHRpb25hbCB0cmFuc3BvcnRTZXNzaW9uaWQgaWYgd2UgYXJlXG4gICAgICogcmVjb25uZWN0aW5nIGZvciBhbiBleGlzdGluZyB0cmFuc3BvcnQgc2Vzc2lvblxuICAgICAqIEBwYXJhbSBsYXN0U2Vzc2lvbklkIE9wdGlvbmFsIGxhc3RTZXNzaW9uSWQgaWYgdGhlIFBlcnNpc3RlbnRDb25uZWN0aW9uIGhhc1xuICAgICAqIGFscmVhZHkgY3JlYXRlZCBhIGNvbm5lY3Rpb24gcHJldmlvdXNseVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5JZCwgcmVwb0luZm8sIGFwcGxpY2F0aW9uSWQsIGFwcENoZWNrVG9rZW4sIGF1dGhUb2tlbiwgdHJhbnNwb3J0U2Vzc2lvbklkLCBsYXN0U2Vzc2lvbklkKSB7XG4gICAgICAgIHRoaXMuY29ubklkID0gY29ubklkO1xuICAgICAgICB0aGlzLnJlcG9JbmZvID0gcmVwb0luZm87XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb25JZCA9IGFwcGxpY2F0aW9uSWQ7XG4gICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbiA9IGFwcENoZWNrVG9rZW47XG4gICAgICAgIHRoaXMuYXV0aFRva2VuID0gYXV0aFRva2VuO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydFNlc3Npb25JZCA9IHRyYW5zcG9ydFNlc3Npb25JZDtcbiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gbGFzdFNlc3Npb25JZDtcbiAgICAgICAgdGhpcy5ieXRlc1NlbnQgPSAwO1xuICAgICAgICB0aGlzLmJ5dGVzUmVjZWl2ZWQgPSAwO1xuICAgICAgICB0aGlzLmV2ZXJDb25uZWN0ZWRfID0gZmFsc2U7XG4gICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoY29ubklkKTtcbiAgICAgICAgdGhpcy5zdGF0c18gPSBzdGF0c01hbmFnZXJHZXRDb2xsZWN0aW9uKHJlcG9JbmZvKTtcbiAgICAgICAgdGhpcy51cmxGbiA9IChwYXJhbXMpID0+IHtcbiAgICAgICAgICAgIC8vIEFsd2F5cyBhZGQgdGhlIHRva2VuIGlmIHdlIGhhdmUgb25lLlxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgICAgIHBhcmFtc1tBUFBfQ0hFQ0tfVE9LRU5fUEFSQU1dID0gdGhpcy5hcHBDaGVja1Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJlcG9JbmZvQ29ubmVjdGlvblVSTChyZXBvSW5mbywgTE9OR19QT0xMSU5HLCBwYXJhbXMpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gb25NZXNzYWdlIC0gQ2FsbGJhY2sgd2hlbiBtZXNzYWdlcyBhcnJpdmVcbiAgICAgKiBAcGFyYW0gb25EaXNjb25uZWN0IC0gQ2FsbGJhY2sgd2l0aCBjb25uZWN0aW9uIGxvc3QuXG4gICAgICovXG4gICAgb3Blbihvbk1lc3NhZ2UsIG9uRGlzY29ubmVjdCkge1xuICAgICAgICB0aGlzLmN1clNlZ21lbnROdW0gPSAwO1xuICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8gPSBvbkRpc2Nvbm5lY3Q7XG4gICAgICAgIHRoaXMubXlQYWNrZXRPcmRlcmVyID0gbmV3IFBhY2tldFJlY2VpdmVyKG9uTWVzc2FnZSk7XG4gICAgICAgIHRoaXMuaXNDbG9zZWRfID0gZmFsc2U7XG4gICAgICAgIHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8gPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnVGltZWQgb3V0IHRyeWluZyB0byBjb25uZWN0LicpO1xuICAgICAgICAgICAgLy8gTWFrZSBzdXJlIHdlIGNsZWFyIHRoZSBob3N0IGNhY2hlXG4gICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpO1xuICAgICAgICAgICAgdGhpcy5jb25uZWN0VGltZW91dFRpbWVyXyA9IG51bGw7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICB9LCBNYXRoLmZsb29yKExQX0NPTk5FQ1RfVElNRU9VVCkpO1xuICAgICAgICAvLyBFbnN1cmUgd2UgZGVsYXkgdGhlIGNyZWF0aW9uIG9mIHRoZSBpZnJhbWUgdW50aWwgdGhlIERPTSBpcyBsb2FkZWQuXG4gICAgICAgIGV4ZWN1dGVXaGVuRE9NUmVhZHkoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNDbG9zZWRfKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9TZXQgdXAgYSBjYWxsYmFjayB0aGF0IGdldHMgdHJpZ2dlcmVkIG9uY2UgYSBjb25uZWN0aW9uIGlzIHNldCB1cC5cbiAgICAgICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyID0gbmV3IEZpcmViYXNlSUZyYW1lU2NyaXB0SG9sZGVyKCguLi5hcmdzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW2NvbW1hbmQsIGFyZzEsIGFyZzIsIGFyZzMsIGFyZzRdID0gYXJncztcbiAgICAgICAgICAgICAgICB0aGlzLmluY3JlbWVudEluY29taW5nQnl0ZXNfKGFyZ3MpO1xuICAgICAgICAgICAgICAgIGlmICghdGhpcy5zY3JpcHRUYWdIb2xkZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOyAvLyB3ZSBjbG9zZWQgdGhlIGNvbm5lY3Rpb24uXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3RUaW1lb3V0VGltZXJfKSB7XG4gICAgICAgICAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNvbm5lY3RUaW1lb3V0VGltZXJfKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uZWN0VGltZW91dFRpbWVyXyA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuZXZlckNvbm5lY3RlZF8gPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmIChjb21tYW5kID09PSBGSVJFQkFTRV9MT05HUE9MTF9TVEFSVF9QQVJBTSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmlkID0gYXJnMTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5wYXNzd29yZCA9IGFyZzI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNvbW1hbmQgPT09IEZJUkVCQVNFX0xPTkdQT0xMX0NMT1NFX0NPTU1BTkQpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gRG9uJ3QgY2xlYXIgdGhlIGhvc3QgY2FjaGUuIFdlIGdvdCBhIHJlc3BvbnNlIGZyb20gdGhlIHNlcnZlciwgc28gd2Uga25vdyBpdCdzIHJlYWNoYWJsZVxuICAgICAgICAgICAgICAgICAgICBpZiAoYXJnMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gV2UgYXJlbid0IGV4cGVjdGluZyBhbnkgbW9yZSBkYXRhIChvdGhlciB0aGFuIHdoYXQgdGhlIHNlcnZlcidzIGFscmVhZHkgaW4gdGhlIHByb2Nlc3Mgb2Ygc2VuZGluZyB1c1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhyb3VnaCBvdXIgYWxyZWFkeSBvcGVuIHBvbGxzKSwgc28gZG9uJ3Qgc2VuZCBhbnkgbW9yZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NyaXB0VGFnSG9sZGVyLnNlbmROZXdQb2xscyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gYXJnMSBpbiB0aGlzIGNhc2UgaXMgdGhlIGxhc3QgcmVzcG9uc2UgbnVtYmVyIHNlbnQgYnkgdGhlIHNlcnZlci4gV2Ugc2hvdWxkIHRyeSB0byByZWNlaXZlXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBhbGwgb2YgdGhlIHJlc3BvbnNlcyB1cCB0byB0aGlzIG9uZSBiZWZvcmUgY2xvc2luZ1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5teVBhY2tldE9yZGVyZXIuY2xvc2VBZnRlcihhcmcxLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbnJlY29nbml6ZWQgY29tbWFuZCByZWNlaXZlZDogJyArIGNvbW1hbmQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sICguLi5hcmdzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgW3BOLCBkYXRhXSA9IGFyZ3M7XG4gICAgICAgICAgICAgICAgdGhpcy5pbmNyZW1lbnRJbmNvbWluZ0J5dGVzXyhhcmdzKTtcbiAgICAgICAgICAgICAgICB0aGlzLm15UGFja2V0T3JkZXJlci5oYW5kbGVSZXNwb25zZShwTiwgZGF0YSk7XG4gICAgICAgICAgICB9LCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTtcbiAgICAgICAgICAgIH0sIHRoaXMudXJsRm4pO1xuICAgICAgICAgICAgLy9TZW5kIHRoZSBpbml0aWFsIHJlcXVlc3QgdG8gY29ubmVjdC4gVGhlIHNlcmlhbCBudW1iZXIgaXMgc2ltcGx5IHRvIGtlZXAgdGhlIGJyb3dzZXIgZnJvbSBwdWxsaW5nIHByZXZpb3VzIHJlc3VsdHNcbiAgICAgICAgICAgIC8vZnJvbSBjYWNoZS5cbiAgICAgICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX1NUQVJUX1BBUkFNXSA9ICd0JztcbiAgICAgICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9TRVJJQUxfUEFSQU1dID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwKTtcbiAgICAgICAgICAgIGlmICh0aGlzLnNjcmlwdFRhZ0hvbGRlci51bmlxdWVDYWxsYmFja0lkZW50aWZpZXIpIHtcbiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfQ0FMTEJBQ0tfSURfUEFSQU1dID1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY3JpcHRUYWdIb2xkZXIudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdXJsUGFyYW1zW1ZFUlNJT05fUEFSQU1dID0gUFJPVE9DT0xfVkVSU0lPTjtcbiAgICAgICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydFNlc3Npb25JZCkge1xuICAgICAgICAgICAgICAgIHVybFBhcmFtc1tUUkFOU1BPUlRfU0VTU0lPTl9QQVJBTV0gPSB0aGlzLnRyYW5zcG9ydFNlc3Npb25JZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RTZXNzaW9uSWQpIHtcbiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbTEFTVF9TRVNTSU9OX1BBUkFNXSA9IHRoaXMubGFzdFNlc3Npb25JZDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmFwcGxpY2F0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICB1cmxQYXJhbXNbQVBQTElDQVRJT05fSURfUEFSQU1dID0gdGhpcy5hcHBsaWNhdGlvbklkO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgICAgIHVybFBhcmFtc1tBUFBfQ0hFQ0tfVE9LRU5fUEFSQU1dID0gdGhpcy5hcHBDaGVja1Rva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBsb2NhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgICAgICAgICBsb2NhdGlvbi5ob3N0bmFtZSAmJlxuICAgICAgICAgICAgICAgIEZPUkdFX0RPTUFJTl9SRS50ZXN0KGxvY2F0aW9uLmhvc3RuYW1lKSkge1xuICAgICAgICAgICAgICAgIHVybFBhcmFtc1tSRUZFUkVSX1BBUkFNXSA9IEZPUkdFX1JFRjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbm5lY3RVUkwgPSB0aGlzLnVybEZuKHVybFBhcmFtcyk7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ0Nvbm5lY3RpbmcgdmlhIGxvbmctcG9sbCB0byAnICsgY29ubmVjdFVSTCk7XG4gICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlci5hZGRUYWcoY29ubmVjdFVSTCwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIC8qIGRvIG5vdGhpbmcgKi9cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FsbCB0aGlzIHdoZW4gYSBoYW5kc2hha2UgaGFzIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkgYW5kIHdlIHdhbnQgdG8gY29uc2lkZXIgdGhlIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWRcbiAgICAgKi9cbiAgICBzdGFydCgpIHtcbiAgICAgICAgdGhpcy5zY3JpcHRUYWdIb2xkZXIuc3RhcnRMb25nUG9sbCh0aGlzLmlkLCB0aGlzLnBhc3N3b3JkKTtcbiAgICAgICAgdGhpcy5hZGREaXNjb25uZWN0UGluZ0ZyYW1lKHRoaXMuaWQsIHRoaXMucGFzc3dvcmQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb3JjZXMgbG9uZyBwb2xsaW5nIHRvIGJlIGNvbnNpZGVyZWQgYXMgYSBwb3RlbnRpYWwgdHJhbnNwb3J0XG4gICAgICovXG4gICAgc3RhdGljIGZvcmNlQWxsb3coKSB7XG4gICAgICAgIEJyb3dzZXJQb2xsQ29ubmVjdGlvbi5mb3JjZUFsbG93XyA9IHRydWU7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEZvcmNlcyBsb25ncG9sbGluZyB0byBub3QgYmUgY29uc2lkZXJlZCBhcyBhIHBvdGVudGlhbCB0cmFuc3BvcnRcbiAgICAgKi9cbiAgICBzdGF0aWMgZm9yY2VEaXNhbGxvdygpIHtcbiAgICAgICAgQnJvd3NlclBvbGxDb25uZWN0aW9uLmZvcmNlRGlzYWxsb3dfID0gdHJ1ZTtcbiAgICB9XG4gICAgLy8gU3RhdGljIG1ldGhvZCwgdXNlIHN0cmluZyBsaXRlcmFsIHNvIGl0IGNhbiBiZSBhY2Nlc3NlZCBpbiBhIGdlbmVyaWMgd2F5XG4gICAgc3RhdGljIGlzQXZhaWxhYmxlKCkge1xuICAgICAgICBpZiAoaXNOb2RlU2RrKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChCcm93c2VyUG9sbENvbm5lY3Rpb24uZm9yY2VBbGxvd18pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gTk9URTogSW4gUmVhY3QtTmF0aXZlIHRoZXJlJ3Mgbm9ybWFsbHkgbm8gJ2RvY3VtZW50JywgYnV0IGlmIHlvdSBkZWJ1ZyBhIFJlYWN0LU5hdGl2ZSBhcHAgaW5cbiAgICAgICAgICAgIC8vIHRoZSBDaHJvbWUgZGVidWdnZXIsICdkb2N1bWVudCcgaXMgZGVmaW5lZCwgYnV0IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgbnVsbCAoMjAxNS8wNi8wOCkuXG4gICAgICAgICAgICByZXR1cm4gKCFCcm93c2VyUG9sbENvbm5lY3Rpb24uZm9yY2VEaXNhbGxvd18gJiZcbiAgICAgICAgICAgICAgICB0eXBlb2YgZG9jdW1lbnQgIT09ICd1bmRlZmluZWQnICYmXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgIWlzQ2hyb21lRXh0ZW5zaW9uQ29udGVudFNjcmlwdCgpICYmXG4gICAgICAgICAgICAgICAgIWlzV2luZG93c1N0b3JlQXBwKCkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE5vLW9wIGZvciBwb2xsaW5nXG4gICAgICovXG4gICAgbWFya0Nvbm5lY3Rpb25IZWFsdGh5KCkgeyB9XG4gICAgLyoqXG4gICAgICogU3RvcHMgcG9sbGluZyBhbmQgY2xlYW5zIHVwIHRoZSBpZnJhbWVcbiAgICAgKi9cbiAgICBzaHV0ZG93bl8oKSB7XG4gICAgICAgIHRoaXMuaXNDbG9zZWRfID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuc2NyaXB0VGFnSG9sZGVyKSB7XG4gICAgICAgICAgICB0aGlzLnNjcmlwdFRhZ0hvbGRlci5jbG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5zY3JpcHRUYWdIb2xkZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIC8vcmVtb3ZlIHRoZSBkaXNjb25uZWN0IGZyYW1lLCB3aGljaCB3aWxsIHRyaWdnZXIgYW4gWEhSIGNhbGwgdG8gdGhlIHNlcnZlciB0byB0ZWxsIGl0IHdlJ3JlIGxlYXZpbmcuXG4gICAgICAgIGlmICh0aGlzLm15RGlzY29ubkZyYW1lKSB7XG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKHRoaXMubXlEaXNjb25uRnJhbWUpO1xuICAgICAgICAgICAgdGhpcy5teURpc2Nvbm5GcmFtZSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8pIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dCh0aGlzLmNvbm5lY3RUaW1lb3V0VGltZXJfKTtcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdFRpbWVvdXRUaW1lcl8gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJlZCB3aGVuIHRoaXMgdHJhbnNwb3J0IGlzIGNsb3NlZFxuICAgICAqL1xuICAgIG9uQ2xvc2VkXygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ2xvc2VkXykge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdMb25ncG9sbCBpcyBjbG9zaW5nIGl0c2VsZicpO1xuICAgICAgICAgICAgdGhpcy5zaHV0ZG93bl8oKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uRGlzY29ubmVjdF8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8odGhpcy5ldmVyQ29ubmVjdGVkXyk7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBFeHRlcm5hbC1mYWNpbmcgY2xvc2UgaGFuZGxlci4gUmVhbFRpbWUgaGFzIHJlcXVlc3RlZCB3ZSBzaHV0IGRvd24uIEtpbGwgb3VyIGNvbm5lY3Rpb24gYW5kIHRlbGwgdGhlIHNlcnZlclxuICAgICAqIHRoYXQgd2UndmUgbGVmdC5cbiAgICAgKi9cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ2xvc2VkXykge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdMb25ncG9sbCBpcyBiZWluZyBjbG9zZWQuJyk7XG4gICAgICAgICAgICB0aGlzLnNodXRkb3duXygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNlbmQgdGhlIEpTT04gb2JqZWN0IGRvd24gdG8gdGhlIHNlcnZlci4gSXQgd2lsbCBuZWVkIHRvIGJlIHN0cmluZ2lmaWVkLCBiYXNlNjQgZW5jb2RlZCwgYW5kIHRoZW5cbiAgICAgKiBicm9rZW4gaW50byBjaHVua3MgKHNpbmNlIFVSTHMgaGF2ZSBhIHNtYWxsIG1heGltdW0gbGVuZ3RoKS5cbiAgICAgKiBAcGFyYW0gZGF0YSAtIFRoZSBKU09OIGRhdGEgdG8gdHJhbnNtaXQuXG4gICAgICovXG4gICAgc2VuZChkYXRhKSB7XG4gICAgICAgIGNvbnN0IGRhdGFTdHIgPSBzdHJpbmdpZnkoZGF0YSk7XG4gICAgICAgIHRoaXMuYnl0ZXNTZW50ICs9IGRhdGFTdHIubGVuZ3RoO1xuICAgICAgICB0aGlzLnN0YXRzXy5pbmNyZW1lbnRDb3VudGVyKCdieXRlc19zZW50JywgZGF0YVN0ci5sZW5ndGgpO1xuICAgICAgICAvL2ZpcnN0LCBsZXRzIGdldCB0aGUgYmFzZTY0LWVuY29kZWQgZGF0YVxuICAgICAgICBjb25zdCBiYXNlNjRkYXRhID0gYmFzZTY0RW5jb2RlKGRhdGFTdHIpO1xuICAgICAgICAvL1dlIGNhbiBvbmx5IGZpdCBhIGNlcnRhaW4gYW1vdW50IGluIGVhY2ggVVJMLCBzbyB3ZSBuZWVkIHRvIHNwbGl0IHRoaXMgcmVxdWVzdFxuICAgICAgICAvL3VwIGludG8gbXVsdGlwbGUgcGllY2VzIGlmIGl0IGRvZXNuJ3QgZml0IGluIG9uZSByZXF1ZXN0LlxuICAgICAgICBjb25zdCBkYXRhU2VncyA9IHNwbGl0U3RyaW5nQnlTaXplKGJhc2U2NGRhdGEsIE1BWF9QQVlMT0FEX1NJWkUpO1xuICAgICAgICAvL0VucXVldWUgZWFjaCBzZWdtZW50IGZvciB0cmFuc21pc3Npb24uIFdlIGFzc2lnbiBlYWNoIGNodW5rIGEgc2VxdWVudGlhbCBJRCBhbmQgYSB0b3RhbCBudW1iZXJcbiAgICAgICAgLy9vZiBzZWdtZW50cyBzbyB0aGF0IHdlIGNhbiByZWFzc2VtYmxlIHRoZSBwYWNrZXQgb24gdGhlIHNlcnZlci5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhU2Vncy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5zY3JpcHRUYWdIb2xkZXIuZW5xdWV1ZVNlZ21lbnQodGhpcy5jdXJTZWdtZW50TnVtLCBkYXRhU2Vncy5sZW5ndGgsIGRhdGFTZWdzW2ldKTtcbiAgICAgICAgICAgIHRoaXMuY3VyU2VnbWVudE51bSsrO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoaXMgaXMgaG93IHdlIG5vdGlmeSB0aGUgc2VydmVyIHRoYXQgd2UncmUgbGVhdmluZy5cbiAgICAgKiBXZSBhcmVuJ3QgYWJsZSB0byBzZW5kIHJlcXVlc3RzIHdpdGggREhUTUwgb24gYSB3aW5kb3cgY2xvc2UgZXZlbnQsIGJ1dCB3ZSBjYW5cbiAgICAgKiB0cmlnZ2VyIFhIUiByZXF1ZXN0cyBpbiBzb21lIGJyb3dzZXJzIChldmVyeXRoaW5nIGJ1dCBPcGVyYSBiYXNpY2FsbHkpLlxuICAgICAqL1xuICAgIGFkZERpc2Nvbm5lY3RQaW5nRnJhbWUoaWQsIHB3KSB7XG4gICAgICAgIGlmIChpc05vZGVTZGsoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubXlEaXNjb25uRnJhbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTtcbiAgICAgICAgY29uc3QgdXJsUGFyYW1zID0ge307XG4gICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9ESVNDT05OX0ZSQU1FX1JFUVVFU1RfUEFSQU1dID0gJ3QnO1xuICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfSURfUEFSQU1dID0gaWQ7XG4gICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9QV19QQVJBTV0gPSBwdztcbiAgICAgICAgdGhpcy5teURpc2Nvbm5GcmFtZS5zcmMgPSB0aGlzLnVybEZuKHVybFBhcmFtcyk7XG4gICAgICAgIHRoaXMubXlEaXNjb25uRnJhbWUuc3R5bGUuZGlzcGxheSA9ICdub25lJztcbiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLm15RGlzY29ubkZyYW1lKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXNlZCB0byB0cmFjayB0aGUgYnl0ZXMgcmVjZWl2ZWQgYnkgdGhpcyBjbGllbnRcbiAgICAgKi9cbiAgICBpbmNyZW1lbnRJbmNvbWluZ0J5dGVzXyhhcmdzKSB7XG4gICAgICAgIC8vIFRPRE86IFRoaXMgaXMgYW4gYW5ub3lpbmcgcGVyZiBoaXQganVzdCB0byB0cmFjayB0aGUgbnVtYmVyIG9mIGluY29taW5nIGJ5dGVzLiAgTWF5YmUgaXQgc2hvdWxkIGJlIG9wdC1pbi5cbiAgICAgICAgY29uc3QgYnl0ZXNSZWNlaXZlZCA9IHN0cmluZ2lmeShhcmdzKS5sZW5ndGg7XG4gICAgICAgIHRoaXMuYnl0ZXNSZWNlaXZlZCArPSBieXRlc1JlY2VpdmVkO1xuICAgICAgICB0aGlzLnN0YXRzXy5pbmNyZW1lbnRDb3VudGVyKCdieXRlc19yZWNlaXZlZCcsIGJ5dGVzUmVjZWl2ZWQpO1xuICAgIH1cbn1cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKipcbiAqIEEgd3JhcHBlciBhcm91bmQgYW4gaWZyYW1lIHRoYXQgaXMgdXNlZCBhcyBhIGxvbmctcG9sbGluZyBzY3JpcHQgaG9sZGVyLlxuICoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi9cbmNsYXNzIEZpcmViYXNlSUZyYW1lU2NyaXB0SG9sZGVyIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gY29tbWFuZENCIC0gVGhlIGNhbGxiYWNrIHRvIGJlIGNhbGxlZCB3aGVuIGNvbnRyb2wgY29tbWFuZHMgYXJlIHJlY2VpdmVkIGZyb20gdGhlIHNlcnZlci5cbiAgICAgKiBAcGFyYW0gb25NZXNzYWdlQ0IgLSBUaGUgY2FsbGJhY2sgdG8gYmUgdHJpZ2dlcmVkIHdoZW4gcmVzcG9uc2VzIGFycml2ZSBmcm9tIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIG9uRGlzY29ubmVjdCAtIFRoZSBjYWxsYmFjayB0byBiZSB0cmlnZ2VyZWQgd2hlbiB0aGlzIHRhZyBob2xkZXIgaXMgY2xvc2VkXG4gICAgICogQHBhcmFtIHVybEZuIC0gQSBmdW5jdGlvbiB0aGF0IHByb3ZpZGVzIHRoZSBVUkwgb2YgdGhlIGVuZHBvaW50IHRvIHNlbmQgZGF0YSB0by5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb21tYW5kQ0IsIG9uTWVzc2FnZUNCLCBvbkRpc2Nvbm5lY3QsIHVybEZuKSB7XG4gICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gb25EaXNjb25uZWN0O1xuICAgICAgICB0aGlzLnVybEZuID0gdXJsRm47XG4gICAgICAgIC8vV2UgbWFpbnRhaW4gYSBjb3VudCBvZiBhbGwgb2YgdGhlIG91dHN0YW5kaW5nIHJlcXVlc3RzLCBiZWNhdXNlIGlmIHdlIGhhdmUgdG9vIG1hbnkgYWN0aXZlIGF0IG9uY2UgaXQgY2FuIGNhdXNlXG4gICAgICAgIC8vcHJvYmxlbXMgaW4gc29tZSBicm93c2Vycy5cbiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1JlcXVlc3RzID0gbmV3IFNldCgpO1xuICAgICAgICAvL0EgcXVldWUgb2YgdGhlIHBlbmRpbmcgc2VnbWVudHMgd2FpdGluZyBmb3IgdHJhbnNtaXNzaW9uIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICAgIHRoaXMucGVuZGluZ1NlZ3MgPSBbXTtcbiAgICAgICAgLy9BIHNlcmlhbCBudW1iZXIuIFdlIHVzZSB0aGlzIGZvciB0d28gdGhpbmdzOlxuICAgICAgICAvLyAxKSBBIHdheSB0byBlbnN1cmUgdGhlIGJyb3dzZXIgZG9lc24ndCBjYWNoZSByZXNwb25zZXMgdG8gcG9sbHNcbiAgICAgICAgLy8gMikgQSB3YXkgdG8gbWFrZSB0aGUgc2VydmVyIGF3YXJlIHdoZW4gbG9uZy1wb2xscyBhcnJpdmUgaW4gYSBkaWZmZXJlbnQgb3JkZXIgdGhhbiB3ZSBzdGFydGVkIHRoZW0uIFRoZVxuICAgICAgICAvLyAgICBzZXJ2ZXIgbmVlZHMgdG8gcmVsZWFzZSBib3RoIHBvbGxzIGluIHRoaXMgY2FzZSBvciBpdCB3aWxsIGNhdXNlIHByb2JsZW1zIGluIE9wZXJhIHNpbmNlIE9wZXJhIGNhbiBvbmx5IGV4ZWN1dGVcbiAgICAgICAgLy8gICAgSlNPTlAgY29kZSBpbiB0aGUgb3JkZXIgaXQgd2FzIGFkZGVkIHRvIHRoZSBpZnJhbWUuXG4gICAgICAgIHRoaXMuY3VycmVudFNlcmlhbCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMDAwMCk7XG4gICAgICAgIC8vIFRoaXMgZ2V0cyBzZXQgdG8gZmFsc2Ugd2hlbiB3ZSdyZSBcImNsb3NpbmcgZG93blwiIHRoZSBjb25uZWN0aW9uIChlLmcuIHdlJ3JlIHN3aXRjaGluZyB0cmFuc3BvcnRzIGJ1dCB0aGVyZSdzIHN0aWxsXG4gICAgICAgIC8vIGluY29taW5nIGRhdGEgZnJvbSB0aGUgc2VydmVyIHRoYXQgd2UncmUgd2FpdGluZyBmb3IpLlxuICAgICAgICB0aGlzLnNlbmROZXdQb2xscyA9IHRydWU7XG4gICAgICAgIGlmICghaXNOb2RlU2RrKCkpIHtcbiAgICAgICAgICAgIC8vRWFjaCBzY3JpcHQgaG9sZGVyIHJlZ2lzdGVycyBhIGNvdXBsZSBvZiB1bmlxdWVseSBuYW1lZCBjYWxsYmFja3Mgd2l0aCB0aGUgd2luZG93LiBUaGVzZSBhcmUgY2FsbGVkIGZyb20gdGhlXG4gICAgICAgICAgICAvL2lmcmFtZXMgd2hlcmUgd2UgcHV0IHRoZSBsb25nLXBvbGxpbmcgc2NyaXB0IHRhZ3MuIFdlIGhhdmUgdHdvIGNhbGxiYWNrczpcbiAgICAgICAgICAgIC8vICAgMSkgQ29tbWFuZCBDYWxsYmFjayAtIFRyaWdnZXJlZCBmb3IgY29udHJvbCBpc3N1ZXMsIGxpa2Ugc3RhcnRpbmcgYSBjb25uZWN0aW9uLlxuICAgICAgICAgICAgLy8gICAyKSBNZXNzYWdlIENhbGxiYWNrIC0gVHJpZ2dlcmVkIHdoZW4gbmV3IGRhdGEgYXJyaXZlcy5cbiAgICAgICAgICAgIHRoaXMudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyID0gTFVJREdlbmVyYXRvcigpO1xuICAgICAgICAgICAgd2luZG93W0ZJUkVCQVNFX0xPTkdQT0xMX0NPTU1BTkRfQ0JfTkFNRSArIHRoaXMudW5pcXVlQ2FsbGJhY2tJZGVudGlmaWVyXSA9IGNvbW1hbmRDQjtcbiAgICAgICAgICAgIHdpbmRvd1tGSVJFQkFTRV9MT05HUE9MTF9EQVRBX0NCX05BTUUgKyB0aGlzLnVuaXF1ZUNhbGxiYWNrSWRlbnRpZmllcl0gPVxuICAgICAgICAgICAgICAgIG9uTWVzc2FnZUNCO1xuICAgICAgICAgICAgLy9DcmVhdGUgYW4gaWZyYW1lIGZvciB1cyB0byBhZGQgc2NyaXB0IHRhZ3MgdG8uXG4gICAgICAgICAgICB0aGlzLm15SUZyYW1lID0gRmlyZWJhc2VJRnJhbWVTY3JpcHRIb2xkZXIuY3JlYXRlSUZyYW1lXygpO1xuICAgICAgICAgICAgLy8gU2V0IHRoZSBpZnJhbWUncyBjb250ZW50cy5cbiAgICAgICAgICAgIGxldCBzY3JpcHQgPSAnJztcbiAgICAgICAgICAgIC8vIGlmIHdlIHNldCBhIGphdmFzY3JpcHQgdXJsLCBpdCdzIElFIGFuZCB3ZSBuZWVkIHRvIHNldCB0aGUgZG9jdW1lbnQgZG9tYWluLiBUaGUgamF2YXNjcmlwdCB1cmwgaXMgc3VmZmljaWVudFxuICAgICAgICAgICAgLy8gZm9yIGllOSwgYnV0IGllOCBuZWVkcyB0byBkbyBpdCBhZ2FpbiBpbiB0aGUgZG9jdW1lbnQgaXRzZWxmLlxuICAgICAgICAgICAgaWYgKHRoaXMubXlJRnJhbWUuc3JjICYmXG4gICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5zcmMuc3Vic3RyKDAsICdqYXZhc2NyaXB0OicubGVuZ3RoKSA9PT0gJ2phdmFzY3JpcHQ6Jykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnREb21haW4gPSBkb2N1bWVudC5kb21haW47XG4gICAgICAgICAgICAgICAgc2NyaXB0ID0gJzxzY3JpcHQ+ZG9jdW1lbnQuZG9tYWluPVwiJyArIGN1cnJlbnREb21haW4gKyAnXCI7PC9zY3JpcHQ+JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGlmcmFtZUNvbnRlbnRzID0gJzxodG1sPjxib2R5PicgKyBzY3JpcHQgKyAnPC9ib2R5PjwvaHRtbD4nO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICB0aGlzLm15SUZyYW1lLmRvYy5vcGVuKCk7XG4gICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5kb2Mud3JpdGUoaWZyYW1lQ29udGVudHMpO1xuICAgICAgICAgICAgICAgIHRoaXMubXlJRnJhbWUuZG9jLmNsb3NlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGxvZygnZnJhbWUgd3JpdGluZyBleGNlcHRpb24nKTtcbiAgICAgICAgICAgICAgICBpZiAoZS5zdGFjaykge1xuICAgICAgICAgICAgICAgICAgICBsb2coZS5zdGFjayk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxvZyhlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29tbWFuZENCID0gY29tbWFuZENCO1xuICAgICAgICAgICAgdGhpcy5vbk1lc3NhZ2VDQiA9IG9uTWVzc2FnZUNCO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVhY2ggYnJvd3NlciBoYXMgaXRzIG93biBmdW5ueSB3YXkgdG8gaGFuZGxlIGlmcmFtZXMuIEhlcmUgd2UgbXVzaCB0aGVtIGFsbCB0b2dldGhlciBpbnRvIG9uZSBvYmplY3QgdGhhdCBJIGNhblxuICAgICAqIGFjdHVhbGx5IHVzZS5cbiAgICAgKi9cbiAgICBzdGF0aWMgY3JlYXRlSUZyYW1lXygpIHtcbiAgICAgICAgY29uc3QgaWZyYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaWZyYW1lJyk7XG4gICAgICAgIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xuICAgICAgICAvLyBUaGlzIGlzIG5lY2Vzc2FyeSBpbiBvcmRlciB0byBpbml0aWFsaXplIHRoZSBkb2N1bWVudCBpbnNpZGUgdGhlIGlmcmFtZVxuICAgICAgICBpZiAoZG9jdW1lbnQuYm9keSkge1xuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChpZnJhbWUpO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBJZiBkb2N1bWVudC5kb21haW4gaGFzIGJlZW4gbW9kaWZpZWQgaW4gSUUsIHRoaXMgd2lsbCB0aHJvdyBhbiBlcnJvciwgYW5kIHdlIG5lZWQgdG8gc2V0IHRoZVxuICAgICAgICAgICAgICAgIC8vIGRvbWFpbiBvZiB0aGUgaWZyYW1lJ3MgZG9jdW1lbnQgbWFudWFsbHkuIFdlIGNhbiBkbyB0aGlzIHZpYSBhIGphdmFzY3JpcHQ6IHVybCBhcyB0aGUgc3JjIGF0dHJpYnV0ZVxuICAgICAgICAgICAgICAgIC8vIEFsc28gbm90ZSB0aGF0IHdlIG11c3QgZG8gdGhpcyAqYWZ0ZXIqIHRoZSBpZnJhbWUgaGFzIGJlZW4gYXBwZW5kZWQgdG8gdGhlIHBhZ2UuIE90aGVyd2lzZSBpdCBkb2Vzbid0IHdvcmsuXG4gICAgICAgICAgICAgICAgY29uc3QgYSA9IGlmcmFtZS5jb250ZW50V2luZG93LmRvY3VtZW50O1xuICAgICAgICAgICAgICAgIGlmICghYSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBBcG9sb2dpZXMgZm9yIHRoZSBsb2ctc3BhbSwgSSBuZWVkIHRvIGRvIHNvbWV0aGluZyB0byBrZWVwIGNsb3N1cmUgZnJvbSBvcHRpbWl6aW5nIG91dCB0aGUgYXNzaWdubWVudCBhYm92ZS5cbiAgICAgICAgICAgICAgICAgICAgbG9nKCdObyBJRSBkb21haW4gc2V0dGluZyByZXF1aXJlZCcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZG9tYWluID0gZG9jdW1lbnQuZG9tYWluO1xuICAgICAgICAgICAgICAgIGlmcmFtZS5zcmMgPVxuICAgICAgICAgICAgICAgICAgICBcImphdmFzY3JpcHQ6dm9pZCgoZnVuY3Rpb24oKXtkb2N1bWVudC5vcGVuKCk7ZG9jdW1lbnQuZG9tYWluPSdcIiArXG4gICAgICAgICAgICAgICAgICAgICAgICBkb21haW4gK1xuICAgICAgICAgICAgICAgICAgICAgICAgXCInO2RvY3VtZW50LmNsb3NlKCk7fSkoKSlcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIExvbmdQb2xsQ29ubmVjdGlvbiBhdHRlbXB0cyB0byBkZWxheSBpbml0aWFsaXphdGlvbiB1bnRpbCB0aGUgZG9jdW1lbnQgaXMgcmVhZHksIHNvIGhvcGVmdWxseSB0aGlzXG4gICAgICAgICAgICAvLyBuZXZlciBnZXRzIGhpdC5cbiAgICAgICAgICAgIHRocm93ICdEb2N1bWVudCBib2R5IGhhcyBub3QgaW5pdGlhbGl6ZWQuIFdhaXQgdG8gaW5pdGlhbGl6ZSBGaXJlYmFzZSB1bnRpbCBhZnRlciB0aGUgZG9jdW1lbnQgaXMgcmVhZHkuJztcbiAgICAgICAgfVxuICAgICAgICAvLyBHZXQgdGhlIGRvY3VtZW50IG9mIHRoZSBpZnJhbWUgaW4gYSBicm93c2VyLXNwZWNpZmljIHdheS5cbiAgICAgICAgaWYgKGlmcmFtZS5jb250ZW50RG9jdW1lbnQpIHtcbiAgICAgICAgICAgIGlmcmFtZS5kb2MgPSBpZnJhbWUuY29udGVudERvY3VtZW50OyAvLyBGaXJlZm94LCBPcGVyYSwgU2FmYXJpXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaWZyYW1lLmNvbnRlbnRXaW5kb3cpIHtcbiAgICAgICAgICAgIGlmcmFtZS5kb2MgPSBpZnJhbWUuY29udGVudFdpbmRvdy5kb2N1bWVudDsgLy8gSW50ZXJuZXQgRXhwbG9yZXJcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoaWZyYW1lLmRvY3VtZW50KSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgaWZyYW1lLmRvYyA9IGlmcmFtZS5kb2N1bWVudDsgLy9vdGhlcnM/XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGlmcmFtZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2FuY2VsIGFsbCBvdXRzdGFuZGluZyBxdWVyaWVzIGFuZCByZW1vdmUgdGhlIGZyYW1lLlxuICAgICAqL1xuICAgIGNsb3NlKCkge1xuICAgICAgICAvL01hcmsgdGhpcyBpZnJhbWUgYXMgZGVhZCwgc28gbm8gbmV3IHJlcXVlc3RzIGFyZSBzZW50LlxuICAgICAgICB0aGlzLmFsaXZlID0gZmFsc2U7XG4gICAgICAgIGlmICh0aGlzLm15SUZyYW1lKSB7XG4gICAgICAgICAgICAvL1dlIGhhdmUgdG8gYWN0dWFsbHkgcmVtb3ZlIGFsbCBvZiB0aGUgaHRtbCBpbnNpZGUgdGhpcyBpZnJhbWUgYmVmb3JlIHJlbW92aW5nIGl0IGZyb20gdGhlXG4gICAgICAgICAgICAvL3dpbmRvdywgb3IgSUUgd2lsbCBjb250aW51ZSBsb2FkaW5nIGFuZCBleGVjdXRpbmcgdGhlIHNjcmlwdCB0YWdzIHdlJ3ZlIGFscmVhZHkgYWRkZWQsIHdoaWNoXG4gICAgICAgICAgICAvL2NhbiBsZWFkIHRvIHNvbWUgZXJyb3JzIGJlaW5nIHRocm93bi4gU2V0dGluZyB0ZXh0Q29udGVudCBzZWVtcyB0byBiZSB0aGUgc2FmZXN0IHdheSB0byBkbyB0aGlzLlxuICAgICAgICAgICAgdGhpcy5teUlGcmFtZS5kb2MuYm9keS50ZXh0Q29udGVudCA9ICcnO1xuICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubXlJRnJhbWUgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLm15SUZyYW1lKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5teUlGcmFtZSA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgTWF0aC5mbG9vcigwKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUHJvdGVjdCBmcm9tIGJlaW5nIGNhbGxlZCByZWN1cnNpdmVseS5cbiAgICAgICAgY29uc3Qgb25EaXNjb25uZWN0ID0gdGhpcy5vbkRpc2Nvbm5lY3Q7XG4gICAgICAgIGlmIChvbkRpc2Nvbm5lY3QpIHtcbiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gbnVsbDtcbiAgICAgICAgICAgIG9uRGlzY29ubmVjdCgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEFjdHVhbGx5IHN0YXJ0IHRoZSBsb25nLXBvbGxpbmcgc2Vzc2lvbiBieSBhZGRpbmcgdGhlIGZpcnN0IHNjcmlwdCB0YWcocykgdG8gdGhlIGlmcmFtZS5cbiAgICAgKiBAcGFyYW0gaWQgLSBUaGUgSUQgb2YgdGhpcyBjb25uZWN0aW9uXG4gICAgICogQHBhcmFtIHB3IC0gVGhlIHBhc3N3b3JkIGZvciB0aGlzIGNvbm5lY3Rpb25cbiAgICAgKi9cbiAgICBzdGFydExvbmdQb2xsKGlkLCBwdykge1xuICAgICAgICB0aGlzLm15SUQgPSBpZDtcbiAgICAgICAgdGhpcy5teVBXID0gcHc7XG4gICAgICAgIHRoaXMuYWxpdmUgPSB0cnVlO1xuICAgICAgICAvL3NlbmQgdGhlIGluaXRpYWwgcmVxdWVzdC4gSWYgdGhlcmUgYXJlIHJlcXVlc3RzIHF1ZXVlZCwgbWFrZSBzdXJlIHRoYXQgd2UgdHJhbnNtaXQgYXMgbWFueSBhcyB3ZSBhcmUgY3VycmVudGx5IGFibGUgdG8uXG4gICAgICAgIHdoaWxlICh0aGlzLm5ld1JlcXVlc3RfKCkpIHsgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGlzIGlzIGNhbGxlZCBhbnkgdGltZSBzb21lb25lIG1pZ2h0IHdhbnQgYSBzY3JpcHQgdGFnIHRvIGJlIGFkZGVkLiBJdCBhZGRzIGEgc2NyaXB0IHRhZyB3aGVuIHRoZXJlIGFyZW4ndFxuICAgICAqIHRvbyBtYW55IG91dHN0YW5kaW5nIHJlcXVlc3RzIGFuZCB3ZSBhcmUgc3RpbGwgYWxpdmUuXG4gICAgICpcbiAgICAgKiBJZiB0aGVyZSBhcmUgb3V0c3RhbmRpbmcgcGFja2V0IHNlZ21lbnRzIHRvIHNlbmQsIGl0IHNlbmRzIG9uZS4gSWYgdGhlcmUgYXJlbid0LCBpdCBzZW5kcyBhIGxvbmctcG9sbCBhbnl3YXlzIGlmXG4gICAgICogbmVlZGVkLlxuICAgICAqL1xuICAgIG5ld1JlcXVlc3RfKCkge1xuICAgICAgICAvLyBXZSBrZWVwIG9uZSBvdXRzdGFuZGluZyByZXF1ZXN0IG9wZW4gYWxsIHRoZSB0aW1lIHRvIHJlY2VpdmUgZGF0YSwgYnV0IGlmIHdlIG5lZWQgdG8gc2VuZCBkYXRhXG4gICAgICAgIC8vIChwZW5kaW5nU2Vncy5sZW5ndGggPiAwKSB0aGVuIHdlIGNyZWF0ZSBhIG5ldyByZXF1ZXN0IHRvIHNlbmQgdGhlIGRhdGEuICBUaGUgc2VydmVyIHdpbGwgYXV0b21hdGljYWxseVxuICAgICAgICAvLyBjbG9zZSB0aGUgb2xkIHJlcXVlc3QuXG4gICAgICAgIGlmICh0aGlzLmFsaXZlICYmXG4gICAgICAgICAgICB0aGlzLnNlbmROZXdQb2xscyAmJlxuICAgICAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1JlcXVlc3RzLnNpemUgPCAodGhpcy5wZW5kaW5nU2Vncy5sZW5ndGggPiAwID8gMiA6IDEpKSB7XG4gICAgICAgICAgICAvL2NvbnN0cnVjdCBvdXIgdXJsXG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRTZXJpYWwrKztcbiAgICAgICAgICAgIGNvbnN0IHVybFBhcmFtcyA9IHt9O1xuICAgICAgICAgICAgdXJsUGFyYW1zW0ZJUkVCQVNFX0xPTkdQT0xMX0lEX1BBUkFNXSA9IHRoaXMubXlJRDtcbiAgICAgICAgICAgIHVybFBhcmFtc1tGSVJFQkFTRV9MT05HUE9MTF9QV19QQVJBTV0gPSB0aGlzLm15UFc7XG4gICAgICAgICAgICB1cmxQYXJhbXNbRklSRUJBU0VfTE9OR1BPTExfU0VSSUFMX1BBUkFNXSA9IHRoaXMuY3VycmVudFNlcmlhbDtcbiAgICAgICAgICAgIGxldCB0aGVVUkwgPSB0aGlzLnVybEZuKHVybFBhcmFtcyk7XG4gICAgICAgICAgICAvL05vdyBhZGQgYXMgbXVjaCBkYXRhIGFzIHdlIGNhbi5cbiAgICAgICAgICAgIGxldCBjdXJEYXRhU3RyaW5nID0gJyc7XG4gICAgICAgICAgICBsZXQgaSA9IDA7XG4gICAgICAgICAgICB3aGlsZSAodGhpcy5wZW5kaW5nU2Vncy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgLy9maXJzdCwgbGV0cyBzZWUgaWYgdGhlIG5leHQgc2VnbWVudCB3aWxsIGZpdC5cbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0U2VnID0gdGhpcy5wZW5kaW5nU2Vnc1swXTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dFNlZy5kLmxlbmd0aCArXG4gICAgICAgICAgICAgICAgICAgIFNFR19IRUFERVJfU0laRSArXG4gICAgICAgICAgICAgICAgICAgIGN1ckRhdGFTdHJpbmcubGVuZ3RoIDw9XG4gICAgICAgICAgICAgICAgICAgIE1BWF9VUkxfREFUQV9TSVpFKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vZ3JlYXQsIHRoZSBzZWdtZW50IHdpbGwgZml0LiBMZXRzIGFwcGVuZCBpdC5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgdGhlU2VnID0gdGhpcy5wZW5kaW5nU2Vncy5zaGlmdCgpO1xuICAgICAgICAgICAgICAgICAgICBjdXJEYXRhU3RyaW5nID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGN1ckRhdGFTdHJpbmcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICcmJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgRklSRUJBU0VfTE9OR1BPTExfU0VHTUVOVF9OVU1fUEFSQU0gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc9JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlU2VnLnNlZyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyYnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGSVJFQkFTRV9MT05HUE9MTF9TRUdNRU5UU19JTl9QQUNLRVQgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc9JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlU2VnLnRzICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnJicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZJUkVCQVNFX0xPTkdQT0xMX0RBVEFfUEFSQU0gK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc9JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlU2VnLmQ7XG4gICAgICAgICAgICAgICAgICAgIGkrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoZVVSTCA9IHRoZVVSTCArIGN1ckRhdGFTdHJpbmc7XG4gICAgICAgICAgICB0aGlzLmFkZExvbmdQb2xsVGFnXyh0aGVVUkwsIHRoaXMuY3VycmVudFNlcmlhbCk7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBRdWV1ZSBhIHBhY2tldCBmb3IgdHJhbnNtaXNzaW9uIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICogQHBhcmFtIHNlZ251bSAtIEEgc2VxdWVudGlhbCBpZCBmb3IgdGhpcyBwYWNrZXQgc2VnbWVudCB1c2VkIGZvciByZWFzc2VtYmx5XG4gICAgICogQHBhcmFtIHRvdGFsc2VncyAtIFRoZSB0b3RhbCBudW1iZXIgb2Ygc2VnbWVudHMgaW4gdGhpcyBwYWNrZXRcbiAgICAgKiBAcGFyYW0gZGF0YSAtIFRoZSBkYXRhIGZvciB0aGlzIHNlZ21lbnQuXG4gICAgICovXG4gICAgZW5xdWV1ZVNlZ21lbnQoc2VnbnVtLCB0b3RhbHNlZ3MsIGRhdGEpIHtcbiAgICAgICAgLy9hZGQgdGhpcyB0byB0aGUgcXVldWUgb2Ygc2VnbWVudHMgdG8gc2VuZC5cbiAgICAgICAgdGhpcy5wZW5kaW5nU2Vncy5wdXNoKHsgc2VnOiBzZWdudW0sIHRzOiB0b3RhbHNlZ3MsIGQ6IGRhdGEgfSk7XG4gICAgICAgIC8vc2VuZCB0aGUgZGF0YSBpbW1lZGlhdGVseSBpZiB0aGVyZSBpc24ndCBhbHJlYWR5IGRhdGEgYmVpbmcgdHJhbnNtaXR0ZWQsIHVubGVzc1xuICAgICAgICAvL3N0YXJ0TG9uZ1BvbGwgaGFzbid0IGJlZW4gY2FsbGVkIHlldC5cbiAgICAgICAgaWYgKHRoaXMuYWxpdmUpIHtcbiAgICAgICAgICAgIHRoaXMubmV3UmVxdWVzdF8oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYSBzY3JpcHQgdGFnIGZvciBhIHJlZ3VsYXIgbG9uZy1wb2xsIHJlcXVlc3QuXG4gICAgICogQHBhcmFtIHVybCAtIFRoZSBVUkwgb2YgdGhlIHNjcmlwdCB0YWcuXG4gICAgICogQHBhcmFtIHNlcmlhbCAtIFRoZSBzZXJpYWwgbnVtYmVyIG9mIHRoZSByZXF1ZXN0LlxuICAgICAqL1xuICAgIGFkZExvbmdQb2xsVGFnXyh1cmwsIHNlcmlhbCkge1xuICAgICAgICAvL3JlbWVtYmVyIHRoYXQgd2Ugc2VudCB0aGlzIHJlcXVlc3QuXG4gICAgICAgIHRoaXMub3V0c3RhbmRpbmdSZXF1ZXN0cy5hZGQoc2VyaWFsKTtcbiAgICAgICAgY29uc3QgZG9OZXdSZXF1ZXN0ID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1JlcXVlc3RzLmRlbGV0ZShzZXJpYWwpO1xuICAgICAgICAgICAgdGhpcy5uZXdSZXF1ZXN0XygpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBJZiB0aGlzIHJlcXVlc3QgZG9lc24ndCByZXR1cm4gb24gaXRzIG93biBhY2NvcmQgKGJ5IHRoZSBzZXJ2ZXIgc2VuZGluZyB1cyBzb21lIGRhdGEpLCB3ZSdsbFxuICAgICAgICAvLyBjcmVhdGUgYSBuZXcgb25lIGFmdGVyIHRoZSBLRUVQQUxJVkUgaW50ZXJ2YWwgdG8gbWFrZSBzdXJlIHdlIGFsd2F5cyBrZWVwIGEgZnJlc2ggcmVxdWVzdCBvcGVuLlxuICAgICAgICBjb25zdCBrZWVwYWxpdmVUaW1lb3V0ID0gc2V0VGltZW91dChkb05ld1JlcXVlc3QsIE1hdGguZmxvb3IoS0VFUEFMSVZFX1JFUVVFU1RfSU5URVJWQUwpKTtcbiAgICAgICAgY29uc3QgcmVhZHlTdGF0ZUNCID0gKCkgPT4ge1xuICAgICAgICAgICAgLy8gUmVxdWVzdCBjb21wbGV0ZWQuICBDYW5jZWwgdGhlIGtlZXBhbGl2ZS5cbiAgICAgICAgICAgIGNsZWFyVGltZW91dChrZWVwYWxpdmVUaW1lb3V0KTtcbiAgICAgICAgICAgIC8vIFRyaWdnZXIgYSBuZXcgcmVxdWVzdCBzbyB3ZSBjYW4gY29udGludWUgcmVjZWl2aW5nIGRhdGEuXG4gICAgICAgICAgICBkb05ld1JlcXVlc3QoKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hZGRUYWcodXJsLCByZWFkeVN0YXRlQ0IpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBZGQgYW4gYXJiaXRyYXJ5IHNjcmlwdCB0YWcgdG8gdGhlIGlmcmFtZS5cbiAgICAgKiBAcGFyYW0gdXJsIC0gVGhlIFVSTCBmb3IgdGhlIHNjcmlwdCB0YWcgc291cmNlLlxuICAgICAqIEBwYXJhbSBsb2FkQ0IgLSBBIGNhbGxiYWNrIHRvIGJlIHRyaWdnZXJlZCBvbmNlIHRoZSBzY3JpcHQgaGFzIGxvYWRlZC5cbiAgICAgKi9cbiAgICBhZGRUYWcodXJsLCBsb2FkQ0IpIHtcbiAgICAgICAgaWYgKGlzTm9kZVNkaygpKSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgdGhpcy5kb05vZGVMb25nUG9sbCh1cmwsIGxvYWRDQik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSdyZSBhbHJlYWR5IGNsb3NlZCwgZG9uJ3QgYWRkIHRoaXMgcG9sbFxuICAgICAgICAgICAgICAgICAgICBpZiAoIXRoaXMuc2VuZE5ld1BvbGxzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3U2NyaXB0ID0gdGhpcy5teUlGcmFtZS5kb2MuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC50eXBlID0gJ3RleHQvamF2YXNjcmlwdCc7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5hc3luYyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5zcmMgPSB1cmw7XG4gICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5vbmxvYWQgPSBuZXdTY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID1cbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJzdGF0ZSA9IG5ld1NjcmlwdC5yZWFkeVN0YXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcnN0YXRlIHx8IHJzdGF0ZSA9PT0gJ2xvYWRlZCcgfHwgcnN0YXRlID09PSAnY29tcGxldGUnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5vbmxvYWQgPSBuZXdTY3JpcHQub25yZWFkeXN0YXRlY2hhbmdlID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG5ld1NjcmlwdC5wYXJlbnROb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXdTY3JpcHQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChuZXdTY3JpcHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvYWRDQigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIG5ld1NjcmlwdC5vbmVycm9yID0gKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgbG9nKCdMb25nLXBvbGwgc2NyaXB0IGZhaWxlZCB0byBsb2FkOiAnICsgdXJsKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2VuZE5ld1BvbGxzID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubXlJRnJhbWUuZG9jLmJvZHkuYXBwZW5kQ2hpbGQobmV3U2NyaXB0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzogd2Ugc2hvdWxkIG1ha2UgdGhpcyBlcnJvciB2aXNpYmxlIHNvbWVob3dcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBNYXRoLmZsb29yKDEpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IFdFQlNPQ0tFVF9NQVhfRlJBTUVfU0laRSA9IDE2Mzg0O1xuY29uc3QgV0VCU09DS0VUX0tFRVBBTElWRV9JTlRFUlZBTCA9IDQ1MDAwO1xubGV0IFdlYlNvY2tldEltcGwgPSBudWxsO1xuaWYgKHR5cGVvZiBNb3pXZWJTb2NrZXQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgV2ViU29ja2V0SW1wbCA9IE1veldlYlNvY2tldDtcbn1cbmVsc2UgaWYgKHR5cGVvZiBXZWJTb2NrZXQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgV2ViU29ja2V0SW1wbCA9IFdlYlNvY2tldDtcbn1cbi8qKlxuICogQ3JlYXRlIGEgbmV3IHdlYnNvY2tldCBjb25uZWN0aW9uIHdpdGggdGhlIGdpdmVuIGNhbGxiYWNrcy5cbiAqL1xuY2xhc3MgV2ViU29ja2V0Q29ubmVjdGlvbiB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNvbm5JZCBpZGVudGlmaWVyIGZvciB0aGlzIHRyYW5zcG9ydFxuICAgICAqIEBwYXJhbSByZXBvSW5mbyBUaGUgaW5mbyBmb3IgdGhlIHdlYnNvY2tldCBlbmRwb2ludC5cbiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25JZCBUaGUgRmlyZWJhc2UgQXBwIElEIGZvciB0aGlzIHByb2plY3QuXG4gICAgICogQHBhcmFtIGFwcENoZWNrVG9rZW4gVGhlIEFwcCBDaGVjayBUb2tlbiBmb3IgdGhpcyBjbGllbnQuXG4gICAgICogQHBhcmFtIGF1dGhUb2tlbiBUaGUgQXV0aCBUb2tlbiBmb3IgdGhpcyBjbGllbnQuXG4gICAgICogQHBhcmFtIHRyYW5zcG9ydFNlc3Npb25JZCBPcHRpb25hbCB0cmFuc3BvcnRTZXNzaW9uSWQgaWYgdGhpcyBpcyBjb25uZWN0aW5nXG4gICAgICogdG8gYW4gZXhpc3RpbmcgdHJhbnNwb3J0IHNlc3Npb25cbiAgICAgKiBAcGFyYW0gbGFzdFNlc3Npb25JZCBPcHRpb25hbCBsYXN0U2Vzc2lvbklkIGlmIHRoZXJlIHdhcyBhIHByZXZpb3VzXG4gICAgICogY29ubmVjdGlvblxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGNvbm5JZCwgcmVwb0luZm8sIGFwcGxpY2F0aW9uSWQsIGFwcENoZWNrVG9rZW4sIGF1dGhUb2tlbiwgdHJhbnNwb3J0U2Vzc2lvbklkLCBsYXN0U2Vzc2lvbklkKSB7XG4gICAgICAgIHRoaXMuY29ubklkID0gY29ubklkO1xuICAgICAgICB0aGlzLmFwcGxpY2F0aW9uSWQgPSBhcHBsaWNhdGlvbklkO1xuICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW4gPSBhcHBDaGVja1Rva2VuO1xuICAgICAgICB0aGlzLmF1dGhUb2tlbiA9IGF1dGhUb2tlbjtcbiAgICAgICAgdGhpcy5rZWVwYWxpdmVUaW1lciA9IG51bGw7XG4gICAgICAgIHRoaXMuZnJhbWVzID0gbnVsbDtcbiAgICAgICAgdGhpcy50b3RhbEZyYW1lcyA9IDA7XG4gICAgICAgIHRoaXMuYnl0ZXNTZW50ID0gMDtcbiAgICAgICAgdGhpcy5ieXRlc1JlY2VpdmVkID0gMDtcbiAgICAgICAgdGhpcy5sb2dfID0gbG9nV3JhcHBlcih0aGlzLmNvbm5JZCk7XG4gICAgICAgIHRoaXMuc3RhdHNfID0gc3RhdHNNYW5hZ2VyR2V0Q29sbGVjdGlvbihyZXBvSW5mbyk7XG4gICAgICAgIHRoaXMuY29ublVSTCA9IFdlYlNvY2tldENvbm5lY3Rpb24uY29ubmVjdGlvblVSTF8ocmVwb0luZm8sIHRyYW5zcG9ydFNlc3Npb25JZCwgbGFzdFNlc3Npb25JZCwgYXBwQ2hlY2tUb2tlbiwgYXBwbGljYXRpb25JZCk7XG4gICAgICAgIHRoaXMubm9kZUFkbWluID0gcmVwb0luZm8ubm9kZUFkbWluO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gcmVwb0luZm8gLSBUaGUgaW5mbyBmb3IgdGhlIHdlYnNvY2tldCBlbmRwb2ludC5cbiAgICAgKiBAcGFyYW0gdHJhbnNwb3J0U2Vzc2lvbklkIC0gT3B0aW9uYWwgdHJhbnNwb3J0U2Vzc2lvbklkIGlmIHRoaXMgaXMgY29ubmVjdGluZyB0byBhbiBleGlzdGluZyB0cmFuc3BvcnRcbiAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2Vzc2lvblxuICAgICAqIEBwYXJhbSBsYXN0U2Vzc2lvbklkIC0gT3B0aW9uYWwgbGFzdFNlc3Npb25JZCBpZiB0aGVyZSB3YXMgYSBwcmV2aW91cyBjb25uZWN0aW9uXG4gICAgICogQHJldHVybnMgY29ubmVjdGlvbiB1cmxcbiAgICAgKi9cbiAgICBzdGF0aWMgY29ubmVjdGlvblVSTF8ocmVwb0luZm8sIHRyYW5zcG9ydFNlc3Npb25JZCwgbGFzdFNlc3Npb25JZCwgYXBwQ2hlY2tUb2tlbiwgYXBwbGljYXRpb25JZCkge1xuICAgICAgICBjb25zdCB1cmxQYXJhbXMgPSB7fTtcbiAgICAgICAgdXJsUGFyYW1zW1ZFUlNJT05fUEFSQU1dID0gUFJPVE9DT0xfVkVSU0lPTjtcbiAgICAgICAgaWYgKCFpc05vZGVTZGsoKSAmJlxuICAgICAgICAgICAgdHlwZW9mIGxvY2F0aW9uICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgbG9jYXRpb24uaG9zdG5hbWUgJiZcbiAgICAgICAgICAgIEZPUkdFX0RPTUFJTl9SRS50ZXN0KGxvY2F0aW9uLmhvc3RuYW1lKSkge1xuICAgICAgICAgICAgdXJsUGFyYW1zW1JFRkVSRVJfUEFSQU1dID0gRk9SR0VfUkVGO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0cmFuc3BvcnRTZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIHVybFBhcmFtc1tUUkFOU1BPUlRfU0VTU0lPTl9QQVJBTV0gPSB0cmFuc3BvcnRTZXNzaW9uSWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGxhc3RTZXNzaW9uSWQpIHtcbiAgICAgICAgICAgIHVybFBhcmFtc1tMQVNUX1NFU1NJT05fUEFSQU1dID0gbGFzdFNlc3Npb25JZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoYXBwQ2hlY2tUb2tlbikge1xuICAgICAgICAgICAgdXJsUGFyYW1zW0FQUF9DSEVDS19UT0tFTl9QQVJBTV0gPSBhcHBDaGVja1Rva2VuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChhcHBsaWNhdGlvbklkKSB7XG4gICAgICAgICAgICB1cmxQYXJhbXNbQVBQTElDQVRJT05fSURfUEFSQU1dID0gYXBwbGljYXRpb25JZDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVwb0luZm9Db25uZWN0aW9uVVJMKHJlcG9JbmZvLCBXRUJTT0NLRVQsIHVybFBhcmFtcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBvbk1lc3NhZ2UgLSBDYWxsYmFjayB3aGVuIG1lc3NhZ2VzIGFycml2ZVxuICAgICAqIEBwYXJhbSBvbkRpc2Nvbm5lY3QgLSBDYWxsYmFjayB3aXRoIGNvbm5lY3Rpb24gbG9zdC5cbiAgICAgKi9cbiAgICBvcGVuKG9uTWVzc2FnZSwgb25EaXNjb25uZWN0KSB7XG4gICAgICAgIHRoaXMub25EaXNjb25uZWN0ID0gb25EaXNjb25uZWN0O1xuICAgICAgICB0aGlzLm9uTWVzc2FnZSA9IG9uTWVzc2FnZTtcbiAgICAgICAgdGhpcy5sb2dfKCdXZWJzb2NrZXQgY29ubmVjdGluZyB0byAnICsgdGhpcy5jb25uVVJMKTtcbiAgICAgICAgdGhpcy5ldmVyQ29ubmVjdGVkXyA9IGZhbHNlO1xuICAgICAgICAvLyBBc3N1bWUgZmFpbHVyZSB1bnRpbCBwcm92ZW4gb3RoZXJ3aXNlLlxuICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5zZXQoJ3ByZXZpb3VzX3dlYnNvY2tldF9mYWlsdXJlJywgdHJ1ZSk7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBsZXQgb3B0aW9ucztcbiAgICAgICAgICAgIGlmIChpc05vZGVTZGsoKSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRldmljZSA9IHRoaXMubm9kZUFkbWluID8gJ0FkbWluTm9kZScgOiAnTm9kZSc7XG4gICAgICAgICAgICAgICAgLy8gVUEgRm9ybWF0OiBGaXJlYmFzZS88d2lyZV9wcm90b2NvbD4vPHNka192ZXJzaW9uPi88cGxhdGZvcm0+LzxkZXZpY2U+XG4gICAgICAgICAgICAgICAgb3B0aW9ucyA9IHtcbiAgICAgICAgICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiBgRmlyZWJhc2UvJHtQUk9UT0NPTF9WRVJTSU9OfS8ke1NES19WRVJTSU9OfS8ke3Byb2Nlc3MucGxhdGZvcm19LyR7ZGV2aWNlfWAsXG4gICAgICAgICAgICAgICAgICAgICAgICAnWC1GaXJlYmFzZS1HTVBJRCc6IHRoaXMuYXBwbGljYXRpb25JZCB8fCAnJ1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAvLyBJZiB1c2luZyBOb2RlIHdpdGggYWRtaW4gY3JlZHMsIEFwcENoZWNrLXJlbGF0ZWQgY2hlY2tzIGFyZSB1bm5lY2Vzc2FyeS5cbiAgICAgICAgICAgICAgICAvLyBOb3RlIHRoYXQgd2Ugc2VuZCB0aGUgY3JlZGVudGlhbHMgaGVyZSBldmVuIGlmIHRoZXkgYXJlbid0IGFkbWluIGNyZWRlbnRpYWxzLCB3aGljaCBpc1xuICAgICAgICAgICAgICAgIC8vIG5vdCBhIHByb2JsZW0uXG4gICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgaGVhZGVyIGlzIGp1c3QgdXNlZCB0byBieXBhc3MgYXBwY2hlY2ssIGFuZCB0aGUgdG9rZW4gc2hvdWxkIHN0aWxsIGJlIHNlbnRcbiAgICAgICAgICAgICAgICAvLyB0aHJvdWdoIHRoZSB3ZWJzb2NrZXQgY29ubmVjdGlvbiBvbmNlIGl0IGlzIGVzdGFibGlzaGVkLlxuICAgICAgICAgICAgICAgIGlmICh0aGlzLmF1dGhUb2tlbikge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zLmhlYWRlcnNbJ0F1dGhvcml6YXRpb24nXSA9IGBCZWFyZXIgJHt0aGlzLmF1dGhUb2tlbn1gO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5hcHBDaGVja1Rva2VuKSB7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbnMuaGVhZGVyc1snWC1GaXJlYmFzZS1BcHBDaGVjayddID0gdGhpcy5hcHBDaGVja1Rva2VuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyBQbHVtYiBhcHByb3ByaWF0ZSBodHRwX3Byb3h5IGVudmlyb25tZW50IHZhcmlhYmxlIGludG8gZmF5ZS13ZWJzb2NrZXQgaWYgaXQgZXhpc3RzLlxuICAgICAgICAgICAgICAgIGNvbnN0IGVudiA9IHByb2Nlc3NbJ2VudiddO1xuICAgICAgICAgICAgICAgIGNvbnN0IHByb3h5ID0gdGhpcy5jb25uVVJMLmluZGV4T2YoJ3dzczovLycpID09PSAwXG4gICAgICAgICAgICAgICAgICAgID8gZW52WydIVFRQU19QUk9YWSddIHx8IGVudlsnaHR0cHNfcHJveHknXVxuICAgICAgICAgICAgICAgICAgICA6IGVudlsnSFRUUF9QUk9YWSddIHx8IGVudlsnaHR0cF9wcm94eSddO1xuICAgICAgICAgICAgICAgIGlmIChwcm94eSkge1xuICAgICAgICAgICAgICAgICAgICBvcHRpb25zWydwcm94eSddID0geyBvcmlnaW46IHByb3h5IH07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5teVNvY2sgPSBuZXcgV2ViU29ja2V0SW1wbCh0aGlzLmNvbm5VUkwsIFtdLCBvcHRpb25zKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdFcnJvciBpbnN0YW50aWF0aW5nIFdlYlNvY2tldC4nKTtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUuZGF0YTtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXyhlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubXlTb2NrLm9ub3BlbiA9ICgpID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnV2Vic29ja2V0IGNvbm5lY3RlZC4nKTtcbiAgICAgICAgICAgIHRoaXMuZXZlckNvbm5lY3RlZF8gPSB0cnVlO1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLm15U29jay5vbmNsb3NlID0gKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdXZWJzb2NrZXQgY29ubmVjdGlvbiB3YXMgZGlzY29ubmVjdGVkLicpO1xuICAgICAgICAgICAgdGhpcy5teVNvY2sgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5vbkNsb3NlZF8oKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5teVNvY2sub25tZXNzYWdlID0gbSA9PiB7XG4gICAgICAgICAgICB0aGlzLmhhbmRsZUluY29taW5nRnJhbWUobSk7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubXlTb2NrLm9uZXJyb3IgPSBlID0+IHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnV2ViU29ja2V0IGVycm9yLiAgQ2xvc2luZyBjb25uZWN0aW9uLicpO1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgIGNvbnN0IGVycm9yID0gZS5tZXNzYWdlIHx8IGUuZGF0YTtcbiAgICAgICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXyhlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm9uQ2xvc2VkXygpO1xuICAgICAgICB9O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBOby1vcCBmb3Igd2Vic29ja2V0cywgd2UgZG9uJ3QgbmVlZCB0byBkbyBhbnl0aGluZyBvbmNlIHRoZSBjb25uZWN0aW9uIGlzIGNvbmZpcm1lZCBhcyBvcGVuXG4gICAgICovXG4gICAgc3RhcnQoKSB7IH1cbiAgICBzdGF0aWMgZm9yY2VEaXNhbGxvdygpIHtcbiAgICAgICAgV2ViU29ja2V0Q29ubmVjdGlvbi5mb3JjZURpc2FsbG93XyA9IHRydWU7XG4gICAgfVxuICAgIHN0YXRpYyBpc0F2YWlsYWJsZSgpIHtcbiAgICAgICAgbGV0IGlzT2xkQW5kcm9pZCA9IGZhbHNlO1xuICAgICAgICBpZiAodHlwZW9mIG5hdmlnYXRvciAhPT0gJ3VuZGVmaW5lZCcgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudCkge1xuICAgICAgICAgICAgY29uc3Qgb2xkQW5kcm9pZFJlZ2V4ID0gL0FuZHJvaWQgKFswLTldezAsfVxcLlswLTldezAsfSkvO1xuICAgICAgICAgICAgY29uc3Qgb2xkQW5kcm9pZE1hdGNoID0gbmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaChvbGRBbmRyb2lkUmVnZXgpO1xuICAgICAgICAgICAgaWYgKG9sZEFuZHJvaWRNYXRjaCAmJiBvbGRBbmRyb2lkTWF0Y2gubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGlmIChwYXJzZUZsb2F0KG9sZEFuZHJvaWRNYXRjaFsxXSkgPCA0LjQpIHtcbiAgICAgICAgICAgICAgICAgICAgaXNPbGRBbmRyb2lkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICghaXNPbGRBbmRyb2lkICYmXG4gICAgICAgICAgICBXZWJTb2NrZXRJbXBsICE9PSBudWxsICYmXG4gICAgICAgICAgICAhV2ViU29ja2V0Q29ubmVjdGlvbi5mb3JjZURpc2FsbG93Xyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgdHJ1ZSBpZiB3ZSBwcmV2aW91c2x5IGZhaWxlZCB0byBjb25uZWN0IHdpdGggdGhpcyB0cmFuc3BvcnQuXG4gICAgICovXG4gICAgc3RhdGljIHByZXZpb3VzbHlGYWlsZWQoKSB7XG4gICAgICAgIC8vIElmIG91ciBwZXJzaXN0ZW50IHN0b3JhZ2UgaXMgYWN0dWFsbHkgb25seSBpbi1tZW1vcnkgc3RvcmFnZSxcbiAgICAgICAgLy8gd2UgZGVmYXVsdCB0byBhc3N1bWluZyB0aGF0IGl0IHByZXZpb3VzbHkgZmFpbGVkIHRvIGJlIHNhZmUuXG4gICAgICAgIHJldHVybiAoUGVyc2lzdGVudFN0b3JhZ2UuaXNJbk1lbW9yeVN0b3JhZ2UgfHxcbiAgICAgICAgICAgIFBlcnNpc3RlbnRTdG9yYWdlLmdldCgncHJldmlvdXNfd2Vic29ja2V0X2ZhaWx1cmUnKSA9PT0gdHJ1ZSk7XG4gICAgfVxuICAgIG1hcmtDb25uZWN0aW9uSGVhbHRoeSgpIHtcbiAgICAgICAgUGVyc2lzdGVudFN0b3JhZ2UucmVtb3ZlKCdwcmV2aW91c193ZWJzb2NrZXRfZmFpbHVyZScpO1xuICAgIH1cbiAgICBhcHBlbmRGcmFtZV8oZGF0YSkge1xuICAgICAgICB0aGlzLmZyYW1lcy5wdXNoKGRhdGEpO1xuICAgICAgICBpZiAodGhpcy5mcmFtZXMubGVuZ3RoID09PSB0aGlzLnRvdGFsRnJhbWVzKSB7XG4gICAgICAgICAgICBjb25zdCBmdWxsTWVzcyA9IHRoaXMuZnJhbWVzLmpvaW4oJycpO1xuICAgICAgICAgICAgdGhpcy5mcmFtZXMgPSBudWxsO1xuICAgICAgICAgICAgY29uc3QganNvbk1lc3MgPSBqc29uRXZhbChmdWxsTWVzcyk7XG4gICAgICAgICAgICAvL2hhbmRsZSB0aGUgbWVzc2FnZVxuICAgICAgICAgICAgdGhpcy5vbk1lc3NhZ2UoanNvbk1lc3MpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSBmcmFtZUNvdW50IC0gVGhlIG51bWJlciBvZiBmcmFtZXMgd2UgYXJlIGV4cGVjdGluZyBmcm9tIHRoZSBzZXJ2ZXJcbiAgICAgKi9cbiAgICBoYW5kbGVOZXdGcmFtZUNvdW50XyhmcmFtZUNvdW50KSB7XG4gICAgICAgIHRoaXMudG90YWxGcmFtZXMgPSBmcmFtZUNvdW50O1xuICAgICAgICB0aGlzLmZyYW1lcyA9IFtdO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBBdHRlbXB0cyB0byBwYXJzZSBhIGZyYW1lIGNvdW50IG91dCBvZiBzb21lIHRleHQuIElmIGl0IGNhbid0LCBhc3N1bWVzIGEgdmFsdWUgb2YgMVxuICAgICAqIEByZXR1cm5zIEFueSByZW1haW5pbmcgZGF0YSB0byBiZSBwcm9jZXNzLCBvciBudWxsIGlmIHRoZXJlIGlzIG5vbmVcbiAgICAgKi9cbiAgICBleHRyYWN0RnJhbWVDb3VudF8oZGF0YSkge1xuICAgICAgICBhc3NlcnQodGhpcy5mcmFtZXMgPT09IG51bGwsICdXZSBhbHJlYWR5IGhhdmUgYSBmcmFtZSBidWZmZXInKTtcbiAgICAgICAgLy8gVE9ETzogVGhlIHNlcnZlciBpcyBvbmx5IHN1cHBvc2VkIHRvIHNlbmQgdXAgdG8gOTk5OSBmcmFtZXMgKGkuZS4gbGVuZ3RoIDw9IDQpLCBidXQgdGhhdCBpc24ndCBiZWluZyBlbmZvcmNlZFxuICAgICAgICAvLyBjdXJyZW50bHkuICBTbyBhbGxvd2luZyBsYXJnZXIgZnJhbWUgY291bnRzIChsZW5ndGggPD0gNikuICBTZWUgaHR0cHM6Ly9hcHAuYXNhbmEuY29tLzAvc2VhcmNoLzg2ODg1OTg5OTgzODAvODIzNzYwODA0MjUwOFxuICAgICAgICBpZiAoZGF0YS5sZW5ndGggPD0gNikge1xuICAgICAgICAgICAgY29uc3QgZnJhbWVDb3VudCA9IE51bWJlcihkYXRhKTtcbiAgICAgICAgICAgIGlmICghaXNOYU4oZnJhbWVDb3VudCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmhhbmRsZU5ld0ZyYW1lQ291bnRfKGZyYW1lQ291bnQpO1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuaGFuZGxlTmV3RnJhbWVDb3VudF8oMSk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBQcm9jZXNzIGEgd2Vic29ja2V0IGZyYW1lIHRoYXQgaGFzIGFycml2ZWQgZnJvbSB0aGUgc2VydmVyLlxuICAgICAqIEBwYXJhbSBtZXNzIC0gVGhlIGZyYW1lIGRhdGFcbiAgICAgKi9cbiAgICBoYW5kbGVJbmNvbWluZ0ZyYW1lKG1lc3MpIHtcbiAgICAgICAgaWYgKHRoaXMubXlTb2NrID09PSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm47IC8vIENocm9tZSBhcHBhcmVudGx5IGRlbGl2ZXJzIGluY29taW5nIHBhY2tldHMgZXZlbiBhZnRlciB3ZSAuY2xvc2UoKSB0aGUgY29ubmVjdGlvbiBzb21ldGltZXMuXG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZGF0YSA9IG1lc3NbJ2RhdGEnXTtcbiAgICAgICAgdGhpcy5ieXRlc1JlY2VpdmVkICs9IGRhdGEubGVuZ3RoO1xuICAgICAgICB0aGlzLnN0YXRzXy5pbmNyZW1lbnRDb3VudGVyKCdieXRlc19yZWNlaXZlZCcsIGRhdGEubGVuZ3RoKTtcbiAgICAgICAgdGhpcy5yZXNldEtlZXBBbGl2ZSgpO1xuICAgICAgICBpZiAodGhpcy5mcmFtZXMgIT09IG51bGwpIHtcbiAgICAgICAgICAgIC8vIHdlJ3JlIGJ1ZmZlcmluZ1xuICAgICAgICAgICAgdGhpcy5hcHBlbmRGcmFtZV8oZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyB0cnkgdG8gcGFyc2Ugb3V0IGEgZnJhbWUgY291bnQsIG90aGVyd2lzZSwgYXNzdW1lIDEgYW5kIHByb2Nlc3MgaXRcbiAgICAgICAgICAgIGNvbnN0IHJlbWFpbmluZ0RhdGEgPSB0aGlzLmV4dHJhY3RGcmFtZUNvdW50XyhkYXRhKTtcbiAgICAgICAgICAgIGlmIChyZW1haW5pbmdEYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hcHBlbmRGcmFtZV8ocmVtYWluaW5nRGF0YSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VuZCBhIG1lc3NhZ2UgdG8gdGhlIHNlcnZlclxuICAgICAqIEBwYXJhbSBkYXRhIC0gVGhlIEpTT04gb2JqZWN0IHRvIHRyYW5zbWl0XG4gICAgICovXG4gICAgc2VuZChkYXRhKSB7XG4gICAgICAgIHRoaXMucmVzZXRLZWVwQWxpdmUoKTtcbiAgICAgICAgY29uc3QgZGF0YVN0ciA9IHN0cmluZ2lmeShkYXRhKTtcbiAgICAgICAgdGhpcy5ieXRlc1NlbnQgKz0gZGF0YVN0ci5sZW5ndGg7XG4gICAgICAgIHRoaXMuc3RhdHNfLmluY3JlbWVudENvdW50ZXIoJ2J5dGVzX3NlbnQnLCBkYXRhU3RyLmxlbmd0aCk7XG4gICAgICAgIC8vV2UgY2FuIG9ubHkgZml0IGEgY2VydGFpbiBhbW91bnQgaW4gZWFjaCB3ZWJzb2NrZXQgZnJhbWUsIHNvIHdlIG5lZWQgdG8gc3BsaXQgdGhpcyByZXF1ZXN0XG4gICAgICAgIC8vdXAgaW50byBtdWx0aXBsZSBwaWVjZXMgaWYgaXQgZG9lc24ndCBmaXQgaW4gb25lIHJlcXVlc3QuXG4gICAgICAgIGNvbnN0IGRhdGFTZWdzID0gc3BsaXRTdHJpbmdCeVNpemUoZGF0YVN0ciwgV0VCU09DS0VUX01BWF9GUkFNRV9TSVpFKTtcbiAgICAgICAgLy9TZW5kIHRoZSBsZW5ndGggaGVhZGVyXG4gICAgICAgIGlmIChkYXRhU2Vncy5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRTdHJpbmdfKFN0cmluZyhkYXRhU2Vncy5sZW5ndGgpKTtcbiAgICAgICAgfVxuICAgICAgICAvL1NlbmQgdGhlIGFjdHVhbCBkYXRhIGluIHNlZ21lbnRzLlxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGFTZWdzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRTdHJpbmdfKGRhdGFTZWdzW2ldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzaHV0ZG93bl8oKSB7XG4gICAgICAgIHRoaXMuaXNDbG9zZWRfID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMua2VlcGFsaXZlVGltZXIpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5rZWVwYWxpdmVUaW1lcik7XG4gICAgICAgICAgICB0aGlzLmtlZXBhbGl2ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5teVNvY2spIHtcbiAgICAgICAgICAgIHRoaXMubXlTb2NrLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLm15U29jayA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25DbG9zZWRfKCkge1xuICAgICAgICBpZiAoIXRoaXMuaXNDbG9zZWRfKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ1dlYlNvY2tldCBpcyBjbG9zaW5nIGl0c2VsZicpO1xuICAgICAgICAgICAgdGhpcy5zaHV0ZG93bl8oKTtcbiAgICAgICAgICAgIC8vIHNpbmNlIHRoaXMgaXMgYW4gaW50ZXJuYWwgY2xvc2UsIHRyaWdnZXIgdGhlIGNsb3NlIGxpc3RlbmVyXG4gICAgICAgICAgICBpZiAodGhpcy5vbkRpc2Nvbm5lY3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdCh0aGlzLmV2ZXJDb25uZWN0ZWRfKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdCA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogRXh0ZXJuYWwtZmFjaW5nIGNsb3NlIGhhbmRsZXIuXG4gICAgICogQ2xvc2UgdGhlIHdlYnNvY2tldCBhbmQga2lsbCB0aGUgY29ubmVjdGlvbi5cbiAgICAgKi9cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzQ2xvc2VkXykge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdXZWJTb2NrZXQgaXMgYmVpbmcgY2xvc2VkJyk7XG4gICAgICAgICAgICB0aGlzLnNodXRkb3duXygpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEtpbGwgdGhlIGN1cnJlbnQga2VlcGFsaXZlIHRpbWVyIGFuZCBzdGFydCBhIG5ldyBvbmUsIHRvIGVuc3VyZSB0aGF0IGl0IGFsd2F5cyBmaXJlcyBOIHNlY29uZHMgYWZ0ZXJcbiAgICAgKiB0aGUgbGFzdCBhY3Rpdml0eS5cbiAgICAgKi9cbiAgICByZXNldEtlZXBBbGl2ZSgpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmtlZXBhbGl2ZVRpbWVyKTtcbiAgICAgICAgdGhpcy5rZWVwYWxpdmVUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgIC8vSWYgdGhlcmUgaGFzIGJlZW4gbm8gd2Vic29ja2V0IGFjdGl2aXR5IGZvciBhIHdoaWxlLCBzZW5kIGEgbm8tb3BcbiAgICAgICAgICAgIGlmICh0aGlzLm15U29jaykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VuZFN0cmluZ18oJzAnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucmVzZXRLZWVwQWxpdmUoKTtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIH0sIE1hdGguZmxvb3IoV0VCU09DS0VUX0tFRVBBTElWRV9JTlRFUlZBTCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZW5kIGEgc3RyaW5nIG92ZXIgdGhlIHdlYnNvY2tldC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBzdHIgLSBTdHJpbmcgdG8gc2VuZC5cbiAgICAgKi9cbiAgICBzZW5kU3RyaW5nXyhzdHIpIHtcbiAgICAgICAgLy8gRmlyZWZveCBzZWVtcyB0byBzb21ldGltZXMgdGhyb3cgZXhjZXB0aW9ucyAoTlNfRVJST1JfVU5FWFBFQ1RFRCkgZnJvbSB3ZWJzb2NrZXQgLnNlbmQoKVxuICAgICAgICAvLyBjYWxscyBmb3Igc29tZSB1bmtub3duIHJlYXNvbi4gIFdlIHRyZWF0IHRoZXNlIGFzIGFuIGVycm9yIGFuZCBkaXNjb25uZWN0LlxuICAgICAgICAvLyBTZWUgaHR0cHM6Ly9hcHAuYXNhbmEuY29tLzAvNTg5MjYxMTE0MDIyOTIvNjgwMjEzNDAyNTA0MTBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHRoaXMubXlTb2NrLnNlbmQoc3RyKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdFeGNlcHRpb24gdGhyb3duIGZyb20gV2ViU29ja2V0LnNlbmQoKTonLCBlLm1lc3NhZ2UgfHwgZS5kYXRhLCAnQ2xvc2luZyBjb25uZWN0aW9uLicpO1xuICAgICAgICAgICAgc2V0VGltZW91dCh0aGlzLm9uQ2xvc2VkXy5iaW5kKHRoaXMpLCAwKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogTnVtYmVyIG9mIHJlc3BvbnNlIGJlZm9yZSB3ZSBjb25zaWRlciB0aGUgY29ubmVjdGlvbiBcImhlYWx0aHkuXCJcbiAqL1xuV2ViU29ja2V0Q29ubmVjdGlvbi5yZXNwb25zZXNSZXF1aXJlZFRvQmVIZWFsdGh5ID0gMjtcbi8qKlxuICogVGltZSB0byB3YWl0IGZvciB0aGUgY29ubmVjdGlvbiB0ZSBiZWNvbWUgaGVhbHRoeSBiZWZvcmUgZ2l2aW5nIHVwLlxuICovXG5XZWJTb2NrZXRDb25uZWN0aW9uLmhlYWx0aHlUaW1lb3V0ID0gMzAwMDA7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEN1cnJlbnRseSBzaW1wbGlzdGljLCB0aGlzIGNsYXNzIG1hbmFnZXMgd2hhdCB0cmFuc3BvcnQgYSBDb25uZWN0aW9uIHNob3VsZCB1c2UgYXQgdmFyaW91cyBzdGFnZXMgb2YgaXRzXG4gKiBsaWZlY3ljbGUuXG4gKlxuICogSXQgc3RhcnRzIHdpdGggbG9uZ3BvbGxpbmcgaW4gYSBicm93c2VyLCBhbmQgaHR0cHBvbGxpbmcgb24gbm9kZS4gSXQgdGhlbiB1cGdyYWRlcyB0byB3ZWJzb2NrZXRzIGlmXG4gKiB0aGV5IGFyZSBhdmFpbGFibGUuXG4gKi9cbmNsYXNzIFRyYW5zcG9ydE1hbmFnZXIge1xuICAgIHN0YXRpYyBnZXQgQUxMX1RSQU5TUE9SVFMoKSB7XG4gICAgICAgIHJldHVybiBbQnJvd3NlclBvbGxDb25uZWN0aW9uLCBXZWJTb2NrZXRDb25uZWN0aW9uXTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIHRyYW5zcG9ydCBoYXMgYmVlbiBzZWxlY3RlZCB0byBlbnN1cmUgV2ViU29ja2V0Q29ubmVjdGlvbiBvciBCcm93c2VyUG9sbENvbm5lY3Rpb24gYXJlIG5vdCBjYWxsZWQgYWZ0ZXJcbiAgICAgKiBUcmFuc3BvcnRNYW5hZ2VyIGhhcyBhbHJlYWR5IHNldCB1cCB0cmFuc3BvcnRzX1xuICAgICAqL1xuICAgIHN0YXRpYyBnZXQgSVNfVFJBTlNQT1JUX0lOSVRJQUxJWkVEKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5nbG9iYWxUcmFuc3BvcnRJbml0aWFsaXplZF87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBwYXJhbSByZXBvSW5mbyAtIE1ldGFkYXRhIGFyb3VuZCB0aGUgbmFtZXNwYWNlIHdlJ3JlIGNvbm5lY3RpbmcgdG9cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihyZXBvSW5mbykge1xuICAgICAgICB0aGlzLmluaXRUcmFuc3BvcnRzXyhyZXBvSW5mbyk7XG4gICAgfVxuICAgIGluaXRUcmFuc3BvcnRzXyhyZXBvSW5mbykge1xuICAgICAgICBjb25zdCBpc1dlYlNvY2tldHNBdmFpbGFibGUgPSBXZWJTb2NrZXRDb25uZWN0aW9uICYmIFdlYlNvY2tldENvbm5lY3Rpb25bJ2lzQXZhaWxhYmxlJ10oKTtcbiAgICAgICAgbGV0IGlzU2tpcFBvbGxDb25uZWN0aW9uID0gaXNXZWJTb2NrZXRzQXZhaWxhYmxlICYmICFXZWJTb2NrZXRDb25uZWN0aW9uLnByZXZpb3VzbHlGYWlsZWQoKTtcbiAgICAgICAgaWYgKHJlcG9JbmZvLndlYlNvY2tldE9ubHkpIHtcbiAgICAgICAgICAgIGlmICghaXNXZWJTb2NrZXRzQXZhaWxhYmxlKSB7XG4gICAgICAgICAgICAgICAgd2FybihcIndzczovLyBVUkwgdXNlZCwgYnV0IGJyb3dzZXIgaXNuJ3Qga25vd24gdG8gc3VwcG9ydCB3ZWJzb2NrZXRzLiAgVHJ5aW5nIGFueXdheS5cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpc1NraXBQb2xsQ29ubmVjdGlvbiA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGlzU2tpcFBvbGxDb25uZWN0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnRyYW5zcG9ydHNfID0gW1dlYlNvY2tldENvbm5lY3Rpb25dO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdHJhbnNwb3J0cyA9ICh0aGlzLnRyYW5zcG9ydHNfID0gW10pO1xuICAgICAgICAgICAgZm9yIChjb25zdCB0cmFuc3BvcnQgb2YgVHJhbnNwb3J0TWFuYWdlci5BTExfVFJBTlNQT1JUUykge1xuICAgICAgICAgICAgICAgIGlmICh0cmFuc3BvcnQgJiYgdHJhbnNwb3J0Wydpc0F2YWlsYWJsZSddKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNwb3J0cy5wdXNoKHRyYW5zcG9ydCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgVHJhbnNwb3J0TWFuYWdlci5nbG9iYWxUcmFuc3BvcnRJbml0aWFsaXplZF8gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFRoZSBjb25zdHJ1Y3RvciBmb3IgdGhlIGluaXRpYWwgdHJhbnNwb3J0IHRvIHVzZVxuICAgICAqL1xuICAgIGluaXRpYWxUcmFuc3BvcnQoKSB7XG4gICAgICAgIGlmICh0aGlzLnRyYW5zcG9ydHNfLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyYW5zcG9ydHNfWzBdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyB0cmFuc3BvcnRzIGF2YWlsYWJsZScpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFRoZSBjb25zdHJ1Y3RvciBmb3IgdGhlIG5leHQgdHJhbnNwb3J0LCBvciBudWxsXG4gICAgICovXG4gICAgdXBncmFkZVRyYW5zcG9ydCgpIHtcbiAgICAgICAgaWYgKHRoaXMudHJhbnNwb3J0c18ubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudHJhbnNwb3J0c19bMV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8vIEtlZXBzIHRyYWNrIG9mIHdoZXRoZXIgdGhlIFRyYW5zcG9ydE1hbmFnZXIgaGFzIGFscmVhZHkgY2hvc2VuIGEgdHJhbnNwb3J0IHRvIHVzZVxuVHJhbnNwb3J0TWFuYWdlci5nbG9iYWxUcmFuc3BvcnRJbml0aWFsaXplZF8gPSBmYWxzZTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8vIEFib3J0IHVwZ3JhZGUgYXR0ZW1wdCBpZiBpdCB0YWtlcyBsb25nZXIgdGhhbiA2MHMuXG5jb25zdCBVUEdSQURFX1RJTUVPVVQgPSA2MDAwMDtcbi8vIEZvciBzb21lIHRyYW5zcG9ydHMgKFdlYlNvY2tldHMpLCB3ZSBuZWVkIHRvIFwidmFsaWRhdGVcIiB0aGUgdHJhbnNwb3J0IGJ5IGV4Y2hhbmdpbmcgYSBmZXcgcmVxdWVzdHMgYW5kIHJlc3BvbnNlcy5cbi8vIElmIHdlIGhhdmVuJ3Qgc2VudCBlbm91Z2ggcmVxdWVzdHMgd2l0aGluIDVzLCB3ZSdsbCBzdGFydCBzZW5kaW5nIG5vb3AgcGluZyByZXF1ZXN0cy5cbmNvbnN0IERFTEFZX0JFRk9SRV9TRU5ESU5HX0VYVFJBX1JFUVVFU1RTID0gNTAwMDtcbi8vIElmIHRoZSBpbml0aWFsIGRhdGEgc2VudCB0cmlnZ2VycyBhIGxvdCBvZiBiYW5kd2lkdGggKGkuZS4gaXQncyBhIGxhcmdlIHB1dCBvciBhIGxpc3RlbiBmb3IgYSBsYXJnZSBhbW91bnQgb2YgZGF0YSlcbi8vIHRoZW4gd2UgbWF5IG5vdCBiZSBhYmxlIHRvIGV4Y2hhbmdlIG91ciBwaW5nL3BvbmcgcmVxdWVzdHMgd2l0aGluIHRoZSBoZWFsdGh5IHRpbWVvdXQuICBTbyBpZiB3ZSByZWFjaCB0aGUgdGltZW91dFxuLy8gYnV0IHdlJ3ZlIHNlbnQvcmVjZWl2ZWQgZW5vdWdoIGJ5dGVzLCB3ZSBkb24ndCBjYW5jZWwgdGhlIGNvbm5lY3Rpb24uXG5jb25zdCBCWVRFU19TRU5UX0hFQUxUSFlfT1ZFUlJJREUgPSAxMCAqIDEwMjQ7XG5jb25zdCBCWVRFU19SRUNFSVZFRF9IRUFMVEhZX09WRVJSSURFID0gMTAwICogMTAyNDtcbmNvbnN0IE1FU1NBR0VfVFlQRSA9ICd0JztcbmNvbnN0IE1FU1NBR0VfREFUQSA9ICdkJztcbmNvbnN0IENPTlRST0xfU0hVVERPV04gPSAncyc7XG5jb25zdCBDT05UUk9MX1JFU0VUID0gJ3InO1xuY29uc3QgQ09OVFJPTF9FUlJPUiA9ICdlJztcbmNvbnN0IENPTlRST0xfUE9ORyA9ICdvJztcbmNvbnN0IFNXSVRDSF9BQ0sgPSAnYSc7XG5jb25zdCBFTkRfVFJBTlNNSVNTSU9OID0gJ24nO1xuY29uc3QgUElORyA9ICdwJztcbmNvbnN0IFNFUlZFUl9IRUxMTyA9ICdoJztcbi8qKlxuICogQ3JlYXRlcyBhIG5ldyByZWFsLXRpbWUgY29ubmVjdGlvbiB0byB0aGUgc2VydmVyIHVzaW5nIHdoaWNoZXZlciBtZXRob2Qgd29ya3NcbiAqIGJlc3QgaW4gdGhlIGN1cnJlbnQgYnJvd3Nlci5cbiAqL1xuY2xhc3MgQ29ubmVjdGlvbiB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGlkIC0gYW4gaWQgZm9yIHRoaXMgY29ubmVjdGlvblxuICAgICAqIEBwYXJhbSByZXBvSW5mb18gLSB0aGUgaW5mbyBmb3IgdGhlIGVuZHBvaW50IHRvIGNvbm5lY3QgdG9cbiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25JZF8gLSB0aGUgRmlyZWJhc2UgQXBwIElEIGZvciB0aGlzIHByb2plY3RcbiAgICAgKiBAcGFyYW0gYXBwQ2hlY2tUb2tlbl8gLSBUaGUgQXBwIENoZWNrIFRva2VuIGZvciB0aGlzIGRldmljZS5cbiAgICAgKiBAcGFyYW0gYXV0aFRva2VuXyAtIFRoZSBhdXRoIHRva2VuIGZvciB0aGlzIHNlc3Npb24uXG4gICAgICogQHBhcmFtIG9uTWVzc2FnZV8gLSB0aGUgY2FsbGJhY2sgdG8gYmUgdHJpZ2dlcmVkIHdoZW4gYSBzZXJ2ZXItcHVzaCBtZXNzYWdlIGFycml2ZXNcbiAgICAgKiBAcGFyYW0gb25SZWFkeV8gLSB0aGUgY2FsbGJhY2sgdG8gYmUgdHJpZ2dlcmVkIHdoZW4gdGhpcyBjb25uZWN0aW9uIGlzIHJlYWR5IHRvIHNlbmQgbWVzc2FnZXMuXG4gICAgICogQHBhcmFtIG9uRGlzY29ubmVjdF8gLSB0aGUgY2FsbGJhY2sgdG8gYmUgdHJpZ2dlcmVkIHdoZW4gYSBjb25uZWN0aW9uIHdhcyBsb3N0XG4gICAgICogQHBhcmFtIG9uS2lsbF8gLSB0aGUgY2FsbGJhY2sgdG8gYmUgdHJpZ2dlcmVkIHdoZW4gdGhpcyBjb25uZWN0aW9uIGhhcyBwZXJtYW5lbnRseSBzaHV0IGRvd24uXG4gICAgICogQHBhcmFtIGxhc3RTZXNzaW9uSWQgLSBsYXN0IHNlc3Npb24gaWQgaW4gcGVyc2lzdGVudCBjb25uZWN0aW9uLiBpcyB1c2VkIHRvIGNsZWFuIHVwIG9sZCBzZXNzaW9uIGluIHJlYWwtdGltZSBzZXJ2ZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihpZCwgcmVwb0luZm9fLCBhcHBsaWNhdGlvbklkXywgYXBwQ2hlY2tUb2tlbl8sIGF1dGhUb2tlbl8sIG9uTWVzc2FnZV8sIG9uUmVhZHlfLCBvbkRpc2Nvbm5lY3RfLCBvbktpbGxfLCBsYXN0U2Vzc2lvbklkKSB7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICAgICAgdGhpcy5yZXBvSW5mb18gPSByZXBvSW5mb187XG4gICAgICAgIHRoaXMuYXBwbGljYXRpb25JZF8gPSBhcHBsaWNhdGlvbklkXztcbiAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuXyA9IGFwcENoZWNrVG9rZW5fO1xuICAgICAgICB0aGlzLmF1dGhUb2tlbl8gPSBhdXRoVG9rZW5fO1xuICAgICAgICB0aGlzLm9uTWVzc2FnZV8gPSBvbk1lc3NhZ2VfO1xuICAgICAgICB0aGlzLm9uUmVhZHlfID0gb25SZWFkeV87XG4gICAgICAgIHRoaXMub25EaXNjb25uZWN0XyA9IG9uRGlzY29ubmVjdF87XG4gICAgICAgIHRoaXMub25LaWxsXyA9IG9uS2lsbF87XG4gICAgICAgIHRoaXMubGFzdFNlc3Npb25JZCA9IGxhc3RTZXNzaW9uSWQ7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvbkNvdW50ID0gMDtcbiAgICAgICAgdGhpcy5wZW5kaW5nRGF0YU1lc3NhZ2VzID0gW107XG4gICAgICAgIHRoaXMuc3RhdGVfID0gMCAvKiBSZWFsdGltZVN0YXRlLkNPTk5FQ1RJTkcgKi87XG4gICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoJ2M6JyArIHRoaXMuaWQgKyAnOicpO1xuICAgICAgICB0aGlzLnRyYW5zcG9ydE1hbmFnZXJfID0gbmV3IFRyYW5zcG9ydE1hbmFnZXIocmVwb0luZm9fKTtcbiAgICAgICAgdGhpcy5sb2dfKCdDb25uZWN0aW9uIGNyZWF0ZWQnKTtcbiAgICAgICAgdGhpcy5zdGFydF8oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3RhcnRzIGEgY29ubmVjdGlvbiBhdHRlbXB0XG4gICAgICovXG4gICAgc3RhcnRfKCkge1xuICAgICAgICBjb25zdCBjb25uID0gdGhpcy50cmFuc3BvcnRNYW5hZ2VyXy5pbml0aWFsVHJhbnNwb3J0KCk7XG4gICAgICAgIHRoaXMuY29ubl8gPSBuZXcgY29ubih0aGlzLm5leHRUcmFuc3BvcnRJZF8oKSwgdGhpcy5yZXBvSW5mb18sIHRoaXMuYXBwbGljYXRpb25JZF8sIHRoaXMuYXBwQ2hlY2tUb2tlbl8sIHRoaXMuYXV0aFRva2VuXywgbnVsbCwgdGhpcy5sYXN0U2Vzc2lvbklkKTtcbiAgICAgICAgLy8gRm9yIGNlcnRhaW4gdHJhbnNwb3J0cyAoV2ViU29ja2V0cyksIHdlIG5lZWQgdG8gc2VuZCBhbmQgcmVjZWl2ZSBzZXZlcmFsIG1lc3NhZ2VzIGJhY2sgYW5kIGZvcnRoIGJlZm9yZSB3ZVxuICAgICAgICAvLyBjYW4gY29uc2lkZXIgdGhlIHRyYW5zcG9ydCBoZWFsdGh5LlxuICAgICAgICB0aGlzLnByaW1hcnlSZXNwb25zZXNSZXF1aXJlZF8gPSBjb25uWydyZXNwb25zZXNSZXF1aXJlZFRvQmVIZWFsdGh5J10gfHwgMDtcbiAgICAgICAgY29uc3Qgb25NZXNzYWdlUmVjZWl2ZWQgPSB0aGlzLmNvbm5SZWNlaXZlcl8odGhpcy5jb25uXyk7XG4gICAgICAgIGNvbnN0IG9uQ29ubmVjdGlvbkxvc3QgPSB0aGlzLmRpc2Nvbm5SZWNlaXZlcl8odGhpcy5jb25uXyk7XG4gICAgICAgIHRoaXMudHhfID0gdGhpcy5jb25uXztcbiAgICAgICAgdGhpcy5yeF8gPSB0aGlzLmNvbm5fO1xuICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fID0gbnVsbDtcbiAgICAgICAgdGhpcy5pc0hlYWx0aHlfID0gZmFsc2U7XG4gICAgICAgIC8qXG4gICAgICAgICAqIEZpcmVmb3ggZG9lc24ndCBsaWtlIHdoZW4gY29kZSBmcm9tIG9uZSBpZnJhbWUgdHJpZXMgdG8gY3JlYXRlIGFub3RoZXIgaWZyYW1lIGJ5IHdheSBvZiB0aGUgcGFyZW50IGZyYW1lLlxuICAgICAgICAgKiBUaGlzIGNhbiBvY2N1ciBpbiB0aGUgY2FzZSBvZiBhIHJlZGlyZWN0LCBpLmUuIHdlIGd1ZXNzZWQgd3Jvbmcgb24gd2hhdCBzZXJ2ZXIgdG8gY29ubmVjdCB0byBhbmQgcmVjZWl2ZWQgYSByZXNldC5cbiAgICAgICAgICogU29tZWhvdywgc2V0VGltZW91dCBzZWVtcyB0byBtYWtlIHRoaXMgb2suIFRoYXQgZG9lc24ndCBtYWtlIHNlbnNlIGZyb20gYSBzZWN1cml0eSBwZXJzcGVjdGl2ZSwgc2luY2UgeW91IHNob3VsZFxuICAgICAgICAgKiBzdGlsbCBoYXZlIHRoZSBjb250ZXh0IG9mIHlvdXIgb3JpZ2luYXRpbmcgZnJhbWUuXG4gICAgICAgICAqL1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIC8vIHRoaXMuY29ubl8gZ2V0cyBzZXQgdG8gbnVsbCBpbiBzb21lIG9mIHRoZSB0ZXN0cy4gQ2hlY2sgdG8gbWFrZSBzdXJlIGl0IHN0aWxsIGV4aXN0cyBiZWZvcmUgdXNpbmcgaXRcbiAgICAgICAgICAgIHRoaXMuY29ubl8gJiYgdGhpcy5jb25uXy5vcGVuKG9uTWVzc2FnZVJlY2VpdmVkLCBvbkNvbm5lY3Rpb25Mb3N0KTtcbiAgICAgICAgfSwgTWF0aC5mbG9vcigwKSk7XG4gICAgICAgIGNvbnN0IGhlYWx0aHlUaW1lb3V0TVMgPSBjb25uWydoZWFsdGh5VGltZW91dCddIHx8IDA7XG4gICAgICAgIGlmIChoZWFsdGh5VGltZW91dE1TID4gMCkge1xuICAgICAgICAgICAgdGhpcy5oZWFsdGh5VGltZW91dF8gPSBzZXRUaW1lb3V0Tm9uQmxvY2tpbmcoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuaGVhbHRoeVRpbWVvdXRfID0gbnVsbDtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaXNIZWFsdGh5Xykge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uXyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5ieXRlc1JlY2VpdmVkID4gQllURVNfUkVDRUlWRURfSEVBTFRIWV9PVkVSUklERSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdDb25uZWN0aW9uIGV4Y2VlZGVkIGhlYWx0aHkgdGltZW91dCBidXQgaGFzIHJlY2VpdmVkICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubl8uYnl0ZXNSZWNlaXZlZCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJyBieXRlcy4gIE1hcmtpbmcgY29ubmVjdGlvbiBoZWFsdGh5LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pc0hlYWx0aHlfID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubl8ubWFya0Nvbm5lY3Rpb25IZWFsdGh5KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jb25uXyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jb25uXy5ieXRlc1NlbnQgPiBCWVRFU19TRU5UX0hFQUxUSFlfT1ZFUlJJREUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nXygnQ29ubmVjdGlvbiBleGNlZWRlZCBoZWFsdGh5IHRpbWVvdXQgYnV0IGhhcyBzZW50ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubl8uYnl0ZXNTZW50ICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIGJ5dGVzLiAgTGVhdmluZyBjb25uZWN0aW9uIGFsaXZlLicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gTk9URTogV2UgZG9uJ3Qgd2FudCB0byBtYXJrIGl0IGhlYWx0aHksIHNpbmNlIHdlIGhhdmUgbm8gZ3VhcmFudGVlIHRoYXQgdGhlIGJ5dGVzIGhhdmUgbWFkZSBpdCB0b1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhlIHNlcnZlci5cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubG9nXygnQ2xvc2luZyB1bmhlYWx0aHkgY29ubmVjdGlvbiBhZnRlciB0aW1lb3V0LicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICB9LCBNYXRoLmZsb29yKGhlYWx0aHlUaW1lb3V0TVMpKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBuZXh0VHJhbnNwb3J0SWRfKCkge1xuICAgICAgICByZXR1cm4gJ2M6JyArIHRoaXMuaWQgKyAnOicgKyB0aGlzLmNvbm5lY3Rpb25Db3VudCsrO1xuICAgIH1cbiAgICBkaXNjb25uUmVjZWl2ZXJfKGNvbm4pIHtcbiAgICAgICAgcmV0dXJuIGV2ZXJDb25uZWN0ZWQgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbm4gPT09IHRoaXMuY29ubl8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvbkxvc3RfKGV2ZXJDb25uZWN0ZWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29ubiA9PT0gdGhpcy5zZWNvbmRhcnlDb25uXykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXygnU2Vjb25kYXJ5IGNvbm5lY3Rpb24gbG9zdC4nKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uU2Vjb25kYXJ5Q29ubmVjdGlvbkxvc3RfKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ2Nsb3NpbmcgYW4gb2xkIGNvbm5lY3Rpb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgY29ublJlY2VpdmVyXyhjb25uKSB7XG4gICAgICAgIHJldHVybiAobWVzc2FnZSkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMuc3RhdGVfICE9PSAyIC8qIFJlYWx0aW1lU3RhdGUuRElTQ09OTkVDVEVEICovKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbm4gPT09IHRoaXMucnhfKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25QcmltYXJ5TWVzc2FnZVJlY2VpdmVkXyhtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoY29ubiA9PT0gdGhpcy5zZWNvbmRhcnlDb25uXykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uU2Vjb25kYXJ5TWVzc2FnZVJlY2VpdmVkXyhtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubG9nXygnbWVzc2FnZSBvbiBvbGQgY29ubmVjdGlvbicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGRhdGFNc2cgLSBBbiBhcmJpdHJhcnkgZGF0YSBtZXNzYWdlIHRvIGJlIHNlbnQgdG8gdGhlIHNlcnZlclxuICAgICAqL1xuICAgIHNlbmRSZXF1ZXN0KGRhdGFNc2cpIHtcbiAgICAgICAgLy8gd3JhcCBpbiBhIGRhdGEgbWVzc2FnZSBlbnZlbG9wZSBhbmQgc2VuZCBpdCBvblxuICAgICAgICBjb25zdCBtc2cgPSB7IHQ6ICdkJywgZDogZGF0YU1zZyB9O1xuICAgICAgICB0aGlzLnNlbmREYXRhXyhtc2cpO1xuICAgIH1cbiAgICB0cnlDbGVhbnVwQ29ubmVjdGlvbigpIHtcbiAgICAgICAgaWYgKHRoaXMudHhfID09PSB0aGlzLnNlY29uZGFyeUNvbm5fICYmIHRoaXMucnhfID09PSB0aGlzLnNlY29uZGFyeUNvbm5fKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ2NsZWFuaW5nIHVwIGFuZCBwcm9tb3RpbmcgYSBjb25uZWN0aW9uOiAnICsgdGhpcy5zZWNvbmRhcnlDb25uXy5jb25uSWQpO1xuICAgICAgICAgICAgdGhpcy5jb25uXyA9IHRoaXMuc2Vjb25kYXJ5Q29ubl87XG4gICAgICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fID0gbnVsbDtcbiAgICAgICAgICAgIC8vIHRoZSBzZXJ2ZXIgd2lsbCBzaHV0ZG93biB0aGUgb2xkIGNvbm5lY3Rpb25cbiAgICAgICAgfVxuICAgIH1cbiAgICBvblNlY29uZGFyeUNvbnRyb2xfKGNvbnRyb2xEYXRhKSB7XG4gICAgICAgIGlmIChNRVNTQUdFX1RZUEUgaW4gY29udHJvbERhdGEpIHtcbiAgICAgICAgICAgIGNvbnN0IGNtZCA9IGNvbnRyb2xEYXRhW01FU1NBR0VfVFlQRV07XG4gICAgICAgICAgICBpZiAoY21kID09PSBTV0lUQ0hfQUNLKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGdyYWRlSWZTZWNvbmRhcnlIZWFsdGh5XygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBDT05UUk9MX1JFU0VUKSB7XG4gICAgICAgICAgICAgICAgLy8gTW9zdCBsaWtlbHkgdGhlIHNlc3Npb24gd2Fzbid0IHZhbGlkLiBBYmFuZG9uIHRoZSBzd2l0Y2ggYXR0ZW1wdFxuICAgICAgICAgICAgICAgIHRoaXMubG9nXygnR290IGEgcmVzZXQgb24gc2Vjb25kYXJ5LCBjbG9zaW5nIGl0Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXy5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIC8vIElmIHdlIHdlcmUgYWxyZWFkeSB1c2luZyB0aGlzIGNvbm5lY3Rpb24gZm9yIHNvbWV0aGluZywgdGhhbiB3ZSBuZWVkIHRvIGZ1bGx5IGNsb3NlXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMudHhfID09PSB0aGlzLnNlY29uZGFyeUNvbm5fIHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucnhfID09PSB0aGlzLnNlY29uZGFyeUNvbm5fKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjbWQgPT09IENPTlRST0xfUE9ORykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXygnZ290IHBvbmcgb24gc2Vjb25kYXJ5LicpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5UmVzcG9uc2VzUmVxdWlyZWRfLS07XG4gICAgICAgICAgICAgICAgdGhpcy51cGdyYWRlSWZTZWNvbmRhcnlIZWFsdGh5XygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIG9uU2Vjb25kYXJ5TWVzc2FnZVJlY2VpdmVkXyhwYXJzZWREYXRhKSB7XG4gICAgICAgIGNvbnN0IGxheWVyID0gcmVxdWlyZUtleSgndCcsIHBhcnNlZERhdGEpO1xuICAgICAgICBjb25zdCBkYXRhID0gcmVxdWlyZUtleSgnZCcsIHBhcnNlZERhdGEpO1xuICAgICAgICBpZiAobGF5ZXIgPT09ICdjJykge1xuICAgICAgICAgICAgdGhpcy5vblNlY29uZGFyeUNvbnRyb2xfKGRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxheWVyID09PSAnZCcpIHtcbiAgICAgICAgICAgIC8vIGdvdCBhIGRhdGEgbWVzc2FnZSwgYnV0IHdlJ3JlIHN0aWxsIHNlY29uZCBjb25uZWN0aW9uLiBOZWVkIHRvIGJ1ZmZlciBpdCB1cFxuICAgICAgICAgICAgdGhpcy5wZW5kaW5nRGF0YU1lc3NhZ2VzLnB1c2goZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Vua25vd24gcHJvdG9jb2wgbGF5ZXI6ICcgKyBsYXllcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBncmFkZUlmU2Vjb25kYXJ5SGVhbHRoeV8oKSB7XG4gICAgICAgIGlmICh0aGlzLnNlY29uZGFyeVJlc3BvbnNlc1JlcXVpcmVkXyA8PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ1NlY29uZGFyeSBjb25uZWN0aW9uIGlzIGhlYWx0aHkuJyk7XG4gICAgICAgICAgICB0aGlzLmlzSGVhbHRoeV8gPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXy5tYXJrQ29ubmVjdGlvbkhlYWx0aHkoKTtcbiAgICAgICAgICAgIHRoaXMucHJvY2VlZFdpdGhVcGdyYWRlXygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gU2VuZCBhIHBpbmcgdG8gbWFrZSBzdXJlIHRoZSBjb25uZWN0aW9uIGlzIGhlYWx0aHkuXG4gICAgICAgICAgICB0aGlzLmxvZ18oJ3NlbmRpbmcgcGluZyBvbiBzZWNvbmRhcnkuJyk7XG4gICAgICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLnNlbmQoeyB0OiAnYycsIGQ6IHsgdDogUElORywgZDoge30gfSB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBwcm9jZWVkV2l0aFVwZ3JhZGVfKCkge1xuICAgICAgICAvLyB0ZWxsIHRoaXMgY29ubmVjdGlvbiB0byBjb25zaWRlciBpdHNlbGYgb3BlblxuICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLnN0YXJ0KCk7XG4gICAgICAgIC8vIHNlbmQgYWNrXG4gICAgICAgIHRoaXMubG9nXygnc2VuZGluZyBjbGllbnQgYWNrIG9uIHNlY29uZGFyeScpO1xuICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fLnNlbmQoeyB0OiAnYycsIGQ6IHsgdDogU1dJVENIX0FDSywgZDoge30gfSB9KTtcbiAgICAgICAgLy8gc2VuZCBlbmQgcGFja2V0IG9uIHByaW1hcnkgdHJhbnNwb3J0LCBzd2l0Y2ggdG8gc2VuZGluZyBvbiB0aGlzIG9uZVxuICAgICAgICAvLyBjYW4gcmVjZWl2ZSBvbiB0aGlzIG9uZSwgYnVmZmVyIHJlc3BvbnNlcyB1bnRpbCBlbmQgcmVjZWl2ZWQgb24gcHJpbWFyeSB0cmFuc3BvcnRcbiAgICAgICAgdGhpcy5sb2dfKCdFbmRpbmcgdHJhbnNtaXNzaW9uIG9uIHByaW1hcnknKTtcbiAgICAgICAgdGhpcy5jb25uXy5zZW5kKHsgdDogJ2MnLCBkOiB7IHQ6IEVORF9UUkFOU01JU1NJT04sIGQ6IHt9IH0gfSk7XG4gICAgICAgIHRoaXMudHhfID0gdGhpcy5zZWNvbmRhcnlDb25uXztcbiAgICAgICAgdGhpcy50cnlDbGVhbnVwQ29ubmVjdGlvbigpO1xuICAgIH1cbiAgICBvblByaW1hcnlNZXNzYWdlUmVjZWl2ZWRfKHBhcnNlZERhdGEpIHtcbiAgICAgICAgLy8gTXVzdCByZWZlciB0byBwYXJzZWREYXRhIHByb3BlcnRpZXMgaW4gcXVvdGVzLCBzbyBjbG9zdXJlIGRvZXNuJ3QgdG91Y2ggdGhlbS5cbiAgICAgICAgY29uc3QgbGF5ZXIgPSByZXF1aXJlS2V5KCd0JywgcGFyc2VkRGF0YSk7XG4gICAgICAgIGNvbnN0IGRhdGEgPSByZXF1aXJlS2V5KCdkJywgcGFyc2VkRGF0YSk7XG4gICAgICAgIGlmIChsYXllciA9PT0gJ2MnKSB7XG4gICAgICAgICAgICB0aGlzLm9uQ29udHJvbF8oZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGF5ZXIgPT09ICdkJykge1xuICAgICAgICAgICAgdGhpcy5vbkRhdGFNZXNzYWdlXyhkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkRhdGFNZXNzYWdlXyhtZXNzYWdlKSB7XG4gICAgICAgIHRoaXMub25QcmltYXJ5UmVzcG9uc2VfKCk7XG4gICAgICAgIC8vIFdlIGRvbid0IGRvIGFueXRoaW5nIHdpdGggZGF0YSBtZXNzYWdlcywganVzdCBraWNrIHRoZW0gdXAgYSBsZXZlbFxuICAgICAgICB0aGlzLm9uTWVzc2FnZV8obWVzc2FnZSk7XG4gICAgfVxuICAgIG9uUHJpbWFyeVJlc3BvbnNlXygpIHtcbiAgICAgICAgaWYgKCF0aGlzLmlzSGVhbHRoeV8pIHtcbiAgICAgICAgICAgIHRoaXMucHJpbWFyeVJlc3BvbnNlc1JlcXVpcmVkXy0tO1xuICAgICAgICAgICAgaWYgKHRoaXMucHJpbWFyeVJlc3BvbnNlc1JlcXVpcmVkXyA8PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdQcmltYXJ5IGNvbm5lY3Rpb24gaXMgaGVhbHRoeS4nKTtcbiAgICAgICAgICAgICAgICB0aGlzLmlzSGVhbHRoeV8gPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuY29ubl8ubWFya0Nvbm5lY3Rpb25IZWFsdGh5KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25Db250cm9sXyhjb250cm9sRGF0YSkge1xuICAgICAgICBjb25zdCBjbWQgPSByZXF1aXJlS2V5KE1FU1NBR0VfVFlQRSwgY29udHJvbERhdGEpO1xuICAgICAgICBpZiAoTUVTU0FHRV9EQVRBIGluIGNvbnRyb2xEYXRhKSB7XG4gICAgICAgICAgICBjb25zdCBwYXlsb2FkID0gY29udHJvbERhdGFbTUVTU0FHRV9EQVRBXTtcbiAgICAgICAgICAgIGlmIChjbWQgPT09IFNFUlZFUl9IRUxMTykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGhhbmRzaGFrZVBheWxvYWQgPSBPYmplY3QuYXNzaWduKHt9LCBwYXlsb2FkKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXBvSW5mb18uaXNVc2luZ0VtdWxhdG9yKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFVwb24gY29ubmVjdGluZywgdGhlIGVtdWxhdG9yIHdpbGwgcGFzcyB0aGUgaG9zdG5hbWUgdGhhdCBpdCdzIGF3YXJlIG9mLCBidXQgd2UgcHJlZmVyIHRoZSB1c2VyJ3Mgc2V0IGhvc3RuYW1lIHZpYSBgY29ubmVjdERhdGFiYXNlRW11bGF0b3JgIG92ZXIgd2hhdCB0aGUgZW11bGF0b3IgcGFzc2VzLlxuICAgICAgICAgICAgICAgICAgICBoYW5kc2hha2VQYXlsb2FkLmggPSB0aGlzLnJlcG9JbmZvXy5ob3N0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLm9uSGFuZHNoYWtlXyhoYW5kc2hha2VQYXlsb2FkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNtZCA9PT0gRU5EX1RSQU5TTUlTU0lPTikge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXygncmVjdmQgZW5kIHRyYW5zbWlzc2lvbiBvbiBwcmltYXJ5Jyk7XG4gICAgICAgICAgICAgICAgdGhpcy5yeF8gPSB0aGlzLnNlY29uZGFyeUNvbm5fO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5wZW5kaW5nRGF0YU1lc3NhZ2VzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25EYXRhTWVzc2FnZV8odGhpcy5wZW5kaW5nRGF0YU1lc3NhZ2VzW2ldKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5wZW5kaW5nRGF0YU1lc3NhZ2VzID0gW107XG4gICAgICAgICAgICAgICAgdGhpcy50cnlDbGVhbnVwQ29ubmVjdGlvbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBDT05UUk9MX1NIVVRET1dOKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyB3YXMgcHJldmlvdXNseSB0aGUgJ29uS2lsbCcgY2FsbGJhY2sgcGFzc2VkIHRvIHRoZSBsb3dlci1sZXZlbCBjb25uZWN0aW9uXG4gICAgICAgICAgICAgICAgLy8gcGF5bG9hZCBpbiB0aGlzIGNhc2UgaXMgdGhlIHJlYXNvbiBmb3IgdGhlIHNodXRkb3duLiBHZW5lcmFsbHkgYSBodW1hbi1yZWFkYWJsZSBlcnJvclxuICAgICAgICAgICAgICAgIHRoaXMub25Db25uZWN0aW9uU2h1dGRvd25fKHBheWxvYWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBDT05UUk9MX1JFU0VUKSB7XG4gICAgICAgICAgICAgICAgLy8gcGF5bG9hZCBpbiB0aGlzIGNhc2UgaXMgdGhlIGhvc3Qgd2Ugc2hvdWxkIGNvbnRhY3RcbiAgICAgICAgICAgICAgICB0aGlzLm9uUmVzZXRfKHBheWxvYWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBDT05UUk9MX0VSUk9SKSB7XG4gICAgICAgICAgICAgICAgZXJyb3IoJ1NlcnZlciBFcnJvcjogJyArIHBheWxvYWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY21kID09PSBDT05UUk9MX1BPTkcpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ2dvdCBwb25nIG9uIHByaW1hcnkuJyk7XG4gICAgICAgICAgICAgICAgdGhpcy5vblByaW1hcnlSZXNwb25zZV8oKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRQaW5nT25QcmltYXJ5SWZOZWNlc3NhcnlfKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBlcnJvcignVW5rbm93biBjb250cm9sIHBhY2tldCBjb21tYW5kOiAnICsgY21kKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gaGFuZHNoYWtlIC0gVGhlIGhhbmRzaGFrZSBkYXRhIHJldHVybmVkIGZyb20gdGhlIHNlcnZlclxuICAgICAqL1xuICAgIG9uSGFuZHNoYWtlXyhoYW5kc2hha2UpIHtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gaGFuZHNoYWtlLnRzO1xuICAgICAgICBjb25zdCB2ZXJzaW9uID0gaGFuZHNoYWtlLnY7XG4gICAgICAgIGNvbnN0IGhvc3QgPSBoYW5kc2hha2UuaDtcbiAgICAgICAgdGhpcy5zZXNzaW9uSWQgPSBoYW5kc2hha2UucztcbiAgICAgICAgdGhpcy5yZXBvSW5mb18uaG9zdCA9IGhvc3Q7XG4gICAgICAgIC8vIGlmIHdlJ3ZlIGFscmVhZHkgY2xvc2VkIHRoZSBjb25uZWN0aW9uLCB0aGVuIGRvbid0IGJvdGhlciB0cnlpbmcgdG8gcHJvZ3Jlc3MgZnVydGhlclxuICAgICAgICBpZiAodGhpcy5zdGF0ZV8gPT09IDAgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNUSU5HICovKSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5fLnN0YXJ0KCk7XG4gICAgICAgICAgICB0aGlzLm9uQ29ubmVjdGlvbkVzdGFibGlzaGVkXyh0aGlzLmNvbm5fLCB0aW1lc3RhbXApO1xuICAgICAgICAgICAgaWYgKFBST1RPQ09MX1ZFUlNJT04gIT09IHZlcnNpb24pIHtcbiAgICAgICAgICAgICAgICB3YXJuKCdQcm90b2NvbCB2ZXJzaW9uIG1pc21hdGNoIGRldGVjdGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBUT0RPOiBkbyB3ZSB3YW50IHRvIHVwZ3JhZGU/IHdoZW4/IG1heWJlIGEgZGVsYXk/XG4gICAgICAgICAgICB0aGlzLnRyeVN0YXJ0VXBncmFkZV8oKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0cnlTdGFydFVwZ3JhZGVfKCkge1xuICAgICAgICBjb25zdCBjb25uID0gdGhpcy50cmFuc3BvcnRNYW5hZ2VyXy51cGdyYWRlVHJhbnNwb3J0KCk7XG4gICAgICAgIGlmIChjb25uKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXJ0VXBncmFkZV8oY29ubik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhcnRVcGdyYWRlXyhjb25uKSB7XG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8gPSBuZXcgY29ubih0aGlzLm5leHRUcmFuc3BvcnRJZF8oKSwgdGhpcy5yZXBvSW5mb18sIHRoaXMuYXBwbGljYXRpb25JZF8sIHRoaXMuYXBwQ2hlY2tUb2tlbl8sIHRoaXMuYXV0aFRva2VuXywgdGhpcy5zZXNzaW9uSWQpO1xuICAgICAgICAvLyBGb3IgY2VydGFpbiB0cmFuc3BvcnRzIChXZWJTb2NrZXRzKSwgd2UgbmVlZCB0byBzZW5kIGFuZCByZWNlaXZlIHNldmVyYWwgbWVzc2FnZXMgYmFjayBhbmQgZm9ydGggYmVmb3JlIHdlXG4gICAgICAgIC8vIGNhbiBjb25zaWRlciB0aGUgdHJhbnNwb3J0IGhlYWx0aHkuXG4gICAgICAgIHRoaXMuc2Vjb25kYXJ5UmVzcG9uc2VzUmVxdWlyZWRfID1cbiAgICAgICAgICAgIGNvbm5bJ3Jlc3BvbnNlc1JlcXVpcmVkVG9CZUhlYWx0aHknXSB8fCAwO1xuICAgICAgICBjb25zdCBvbk1lc3NhZ2UgPSB0aGlzLmNvbm5SZWNlaXZlcl8odGhpcy5zZWNvbmRhcnlDb25uXyk7XG4gICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMuZGlzY29ublJlY2VpdmVyXyh0aGlzLnNlY29uZGFyeUNvbm5fKTtcbiAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXy5vcGVuKG9uTWVzc2FnZSwgb25EaXNjb25uZWN0KTtcbiAgICAgICAgLy8gSWYgd2UgaGF2ZW4ndCBzdWNjZXNzZnVsbHkgdXBncmFkZWQgYWZ0ZXIgVVBHUkFERV9USU1FT1VULCBnaXZlIHVwIGFuZCBraWxsIHRoZSBzZWNvbmRhcnkuXG4gICAgICAgIHNldFRpbWVvdXROb25CbG9ja2luZygoKSA9PiB7XG4gICAgICAgICAgICBpZiAodGhpcy5zZWNvbmRhcnlDb25uXykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXygnVGltZWQgb3V0IHRyeWluZyB0byB1cGdyYWRlLicpO1xuICAgICAgICAgICAgICAgIHRoaXMuc2Vjb25kYXJ5Q29ubl8uY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgTWF0aC5mbG9vcihVUEdSQURFX1RJTUVPVVQpKTtcbiAgICB9XG4gICAgb25SZXNldF8oaG9zdCkge1xuICAgICAgICB0aGlzLmxvZ18oJ1Jlc2V0IHBhY2tldCByZWNlaXZlZC4gIE5ldyBob3N0OiAnICsgaG9zdCk7XG4gICAgICAgIHRoaXMucmVwb0luZm9fLmhvc3QgPSBob3N0O1xuICAgICAgICAvLyBUT0RPOiBpZiB3ZSdyZSBhbHJlYWR5IFwiY29ubmVjdGVkXCIsIHdlIG5lZWQgdG8gdHJpZ2dlciBhIGRpc2Nvbm5lY3QgYXQgdGhlIG5leHQgbGF5ZXIgdXAuXG4gICAgICAgIC8vIFdlIGRvbid0IGN1cnJlbnRseSBzdXBwb3J0IHJlc2V0cyBhZnRlciB0aGUgY29ubmVjdGlvbiBoYXMgYWxyZWFkeSBiZWVuIGVzdGFibGlzaGVkXG4gICAgICAgIGlmICh0aGlzLnN0YXRlXyA9PT0gMSAvKiBSZWFsdGltZVN0YXRlLkNPTk5FQ1RFRCAqLykge1xuICAgICAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gQ2xvc2Ugd2hhdGV2ZXIgY29ubmVjdGlvbnMgd2UgaGF2ZSBvcGVuIGFuZCBzdGFydCBhZ2Fpbi5cbiAgICAgICAgICAgIHRoaXMuY2xvc2VDb25uZWN0aW9uc18oKTtcbiAgICAgICAgICAgIHRoaXMuc3RhcnRfKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25Db25uZWN0aW9uRXN0YWJsaXNoZWRfKGNvbm4sIHRpbWVzdGFtcCkge1xuICAgICAgICB0aGlzLmxvZ18oJ1JlYWx0aW1lIGNvbm5lY3Rpb24gZXN0YWJsaXNoZWQuJyk7XG4gICAgICAgIHRoaXMuY29ubl8gPSBjb25uO1xuICAgICAgICB0aGlzLnN0YXRlXyA9IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi87XG4gICAgICAgIGlmICh0aGlzLm9uUmVhZHlfKSB7XG4gICAgICAgICAgICB0aGlzLm9uUmVhZHlfKHRpbWVzdGFtcCwgdGhpcy5zZXNzaW9uSWQpO1xuICAgICAgICAgICAgdGhpcy5vblJlYWR5XyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgLy8gSWYgYWZ0ZXIgNSBzZWNvbmRzIHdlIGhhdmVuJ3Qgc2VudCBlbm91Z2ggcmVxdWVzdHMgdG8gdGhlIHNlcnZlciB0byBnZXQgdGhlIGNvbm5lY3Rpb24gaGVhbHRoeSxcbiAgICAgICAgLy8gc2VuZCBzb21lIHBpbmdzLlxuICAgICAgICBpZiAodGhpcy5wcmltYXJ5UmVzcG9uc2VzUmVxdWlyZWRfID09PSAwKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ1ByaW1hcnkgY29ubmVjdGlvbiBpcyBoZWFsdGh5LicpO1xuICAgICAgICAgICAgdGhpcy5pc0hlYWx0aHlfID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldFRpbWVvdXROb25CbG9ja2luZygoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kUGluZ09uUHJpbWFyeUlmTmVjZXNzYXJ5XygpO1xuICAgICAgICAgICAgfSwgTWF0aC5mbG9vcihERUxBWV9CRUZPUkVfU0VORElOR19FWFRSQV9SRVFVRVNUUykpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlbmRQaW5nT25QcmltYXJ5SWZOZWNlc3NhcnlfKCkge1xuICAgICAgICAvLyBJZiB0aGUgY29ubmVjdGlvbiBpc24ndCBjb25zaWRlcmVkIGhlYWx0aHkgeWV0LCB3ZSdsbCBzZW5kIGEgbm9vcCBwaW5nIHBhY2tldCByZXF1ZXN0LlxuICAgICAgICBpZiAoIXRoaXMuaXNIZWFsdGh5XyAmJiB0aGlzLnN0YXRlXyA9PT0gMSAvKiBSZWFsdGltZVN0YXRlLkNPTk5FQ1RFRCAqLykge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdzZW5kaW5nIHBpbmcgb24gcHJpbWFyeS4nKTtcbiAgICAgICAgICAgIHRoaXMuc2VuZERhdGFfKHsgdDogJ2MnLCBkOiB7IHQ6IFBJTkcsIGQ6IHt9IH0gfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25TZWNvbmRhcnlDb25uZWN0aW9uTG9zdF8oKSB7XG4gICAgICAgIGNvbnN0IGNvbm4gPSB0aGlzLnNlY29uZGFyeUNvbm5fO1xuICAgICAgICB0aGlzLnNlY29uZGFyeUNvbm5fID0gbnVsbDtcbiAgICAgICAgaWYgKHRoaXMudHhfID09PSBjb25uIHx8IHRoaXMucnhfID09PSBjb25uKSB7XG4gICAgICAgICAgICAvLyB3ZSBhcmUgcmVseWluZyBvbiB0aGlzIGNvbm5lY3Rpb24gYWxyZWFkeSBpbiBzb21lIGNhcGFjaXR5LiBUaGVyZWZvcmUsIGEgZmFpbHVyZSBpcyByZWFsXG4gICAgICAgICAgICB0aGlzLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGV2ZXJDb25uZWN0ZWQgLSBXaGV0aGVyIG9yIG5vdCB0aGUgY29ubmVjdGlvbiBldmVyIHJlYWNoZWQgYSBzZXJ2ZXIuIFVzZWQgdG8gZGV0ZXJtaW5lIGlmXG4gICAgICogd2Ugc2hvdWxkIGZsdXNoIHRoZSBob3N0IGNhY2hlXG4gICAgICovXG4gICAgb25Db25uZWN0aW9uTG9zdF8oZXZlckNvbm5lY3RlZCkge1xuICAgICAgICB0aGlzLmNvbm5fID0gbnVsbDtcbiAgICAgICAgLy8gTk9URTogSUYgeW91J3JlIHNlZWluZyBhIEZpcmVmb3ggZXJyb3IgZm9yIHRoaXMgbGluZSwgSSB0aGluayBpdCBtaWdodCBiZSBiZWNhdXNlIGl0J3MgZ2V0dGluZ1xuICAgICAgICAvLyBjYWxsZWQgb24gd2luZG93IGNsb3NlIGFuZCBSZWFsdGltZVN0YXRlLkNPTk5FQ1RJTkcgaXMgbm8gbG9uZ2VyIGRlZmluZWQuICBKdXN0IGEgZ3Vlc3MuXG4gICAgICAgIGlmICghZXZlckNvbm5lY3RlZCAmJiB0aGlzLnN0YXRlXyA9PT0gMCAvKiBSZWFsdGltZVN0YXRlLkNPTk5FQ1RJTkcgKi8pIHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnUmVhbHRpbWUgY29ubmVjdGlvbiBmYWlsZWQuJyk7XG4gICAgICAgICAgICAvLyBTaW5jZSB3ZSBmYWlsZWQgdG8gY29ubmVjdCBhdCBhbGwsIGNsZWFyIGFueSBjYWNoZWQgZW50cnkgZm9yIHRoaXMgbmFtZXNwYWNlIGluIGNhc2UgdGhlIG1hY2hpbmUgd2VudCBhd2F5XG4gICAgICAgICAgICBpZiAodGhpcy5yZXBvSW5mb18uaXNDYWNoZWFibGVIb3N0KCkpIHtcbiAgICAgICAgICAgICAgICBQZXJzaXN0ZW50U3RvcmFnZS5yZW1vdmUoJ2hvc3Q6JyArIHRoaXMucmVwb0luZm9fLmhvc3QpO1xuICAgICAgICAgICAgICAgIC8vIHJlc2V0IHRoZSBpbnRlcm5hbCBob3N0IHRvIHdoYXQgd2Ugd291bGQgc2hvdyB0aGUgdXNlciwgaS5lLiA8bnM+LmZpcmViYXNlaW8uY29tXG4gICAgICAgICAgICAgICAgdGhpcy5yZXBvSW5mb18uaW50ZXJuYWxIb3N0ID0gdGhpcy5yZXBvSW5mb18uaG9zdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0aGlzLnN0YXRlXyA9PT0gMSAvKiBSZWFsdGltZVN0YXRlLkNPTk5FQ1RFRCAqLykge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdSZWFsdGltZSBjb25uZWN0aW9uIGxvc3QuJyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgICBvbkNvbm5lY3Rpb25TaHV0ZG93bl8ocmVhc29uKSB7XG4gICAgICAgIHRoaXMubG9nXygnQ29ubmVjdGlvbiBzaHV0ZG93biBjb21tYW5kIHJlY2VpdmVkLiBTaHV0dGluZyBkb3duLi4uJyk7XG4gICAgICAgIGlmICh0aGlzLm9uS2lsbF8pIHtcbiAgICAgICAgICAgIHRoaXMub25LaWxsXyhyZWFzb24pO1xuICAgICAgICAgICAgdGhpcy5vbktpbGxfID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICAvLyBXZSBpbnRlbnRpb25hbGx5IGRvbid0IHdhbnQgdG8gZmlyZSBvbkRpc2Nvbm5lY3QgKGtpbGwgaXMgYSBkaWZmZXJlbnQgY2FzZSksXG4gICAgICAgIC8vIHNvIGNsZWFyIHRoZSBjYWxsYmFjay5cbiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gbnVsbDtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgICBzZW5kRGF0YV8oZGF0YSkge1xuICAgICAgICBpZiAodGhpcy5zdGF0ZV8gIT09IDEgLyogUmVhbHRpbWVTdGF0ZS5DT05ORUNURUQgKi8pIHtcbiAgICAgICAgICAgIHRocm93ICdDb25uZWN0aW9uIGlzIG5vdCBjb25uZWN0ZWQnO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50eF8uc2VuZChkYXRhKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDbGVhbnMgdXAgdGhpcyBjb25uZWN0aW9uLCBjYWxsaW5nIHRoZSBhcHByb3ByaWF0ZSBjYWxsYmFja3NcbiAgICAgKi9cbiAgICBjbG9zZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGVfICE9PSAyIC8qIFJlYWx0aW1lU3RhdGUuRElTQ09OTkVDVEVEICovKSB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ0Nsb3NpbmcgcmVhbHRpbWUgY29ubmVjdGlvbi4nKTtcbiAgICAgICAgICAgIHRoaXMuc3RhdGVfID0gMiAvKiBSZWFsdGltZVN0YXRlLkRJU0NPTk5FQ1RFRCAqLztcbiAgICAgICAgICAgIHRoaXMuY2xvc2VDb25uZWN0aW9uc18oKTtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uRGlzY29ubmVjdF8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8oKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRGlzY29ubmVjdF8gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGNsb3NlQ29ubmVjdGlvbnNfKCkge1xuICAgICAgICB0aGlzLmxvZ18oJ1NodXR0aW5nIGRvd24gYWxsIGNvbm5lY3Rpb25zJyk7XG4gICAgICAgIGlmICh0aGlzLmNvbm5fKSB7XG4gICAgICAgICAgICB0aGlzLmNvbm5fLmNsb3NlKCk7XG4gICAgICAgICAgICB0aGlzLmNvbm5fID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5zZWNvbmRhcnlDb25uXykge1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXy5jbG9zZSgpO1xuICAgICAgICAgICAgdGhpcy5zZWNvbmRhcnlDb25uXyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaGVhbHRoeVRpbWVvdXRfKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5oZWFsdGh5VGltZW91dF8pO1xuICAgICAgICAgICAgdGhpcy5oZWFsdGh5VGltZW91dF8gPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBJbnRlcmZhY2UgZGVmaW5pbmcgdGhlIHNldCBvZiBhY3Rpb25zIHRoYXQgY2FuIGJlIHBlcmZvcm1lZCBhZ2FpbnN0IHRoZSBGaXJlYmFzZSBzZXJ2ZXJcbiAqIChiYXNpY2FsbHkgY29ycmVzcG9uZHMgdG8gb3VyIHdpcmUgcHJvdG9jb2wpLlxuICpcbiAqIEBpbnRlcmZhY2VcbiAqL1xuY2xhc3MgU2VydmVyQWN0aW9ucyB7XG4gICAgcHV0KHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUsIGhhc2gpIHsgfVxuICAgIG1lcmdlKHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUsIGhhc2gpIHsgfVxuICAgIC8qKlxuICAgICAqIFJlZnJlc2hlcyB0aGUgYXV0aCB0b2tlbiBmb3IgdGhlIGN1cnJlbnQgY29ubmVjdGlvbi5cbiAgICAgKiBAcGFyYW0gdG9rZW4gLSBUaGUgYXV0aGVudGljYXRpb24gdG9rZW5cbiAgICAgKi9cbiAgICByZWZyZXNoQXV0aFRva2VuKHRva2VuKSB7IH1cbiAgICAvKipcbiAgICAgKiBSZWZyZXNoZXMgdGhlIGFwcCBjaGVjayB0b2tlbiBmb3IgdGhlIGN1cnJlbnQgY29ubmVjdGlvbi5cbiAgICAgKiBAcGFyYW0gdG9rZW4gVGhlIGFwcCBjaGVjayB0b2tlblxuICAgICAqL1xuICAgIHJlZnJlc2hBcHBDaGVja1Rva2VuKHRva2VuKSB7IH1cbiAgICBvbkRpc2Nvbm5lY3RQdXQocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkgeyB9XG4gICAgb25EaXNjb25uZWN0TWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkgeyB9XG4gICAgb25EaXNjb25uZWN0Q2FuY2VsKHBhdGhTdHJpbmcsIG9uQ29tcGxldGUpIHsgfVxuICAgIHJlcG9ydFN0YXRzKHN0YXRzKSB7IH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQmFzZSBjbGFzcyB0byBiZSB1c2VkIGlmIHlvdSB3YW50IHRvIGVtaXQgZXZlbnRzLiBDYWxsIHRoZSBjb25zdHJ1Y3RvciB3aXRoXG4gKiB0aGUgc2V0IG9mIGFsbG93ZWQgZXZlbnQgbmFtZXMuXG4gKi9cbmNsYXNzIEV2ZW50RW1pdHRlciB7XG4gICAgY29uc3RydWN0b3IoYWxsb3dlZEV2ZW50c18pIHtcbiAgICAgICAgdGhpcy5hbGxvd2VkRXZlbnRzXyA9IGFsbG93ZWRFdmVudHNfO1xuICAgICAgICB0aGlzLmxpc3RlbmVyc18gPSB7fTtcbiAgICAgICAgYXNzZXJ0KEFycmF5LmlzQXJyYXkoYWxsb3dlZEV2ZW50c18pICYmIGFsbG93ZWRFdmVudHNfLmxlbmd0aCA+IDAsICdSZXF1aXJlcyBhIG5vbi1lbXB0eSBhcnJheScpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUbyBiZSBjYWxsZWQgYnkgZGVyaXZlZCBjbGFzc2VzIHRvIHRyaWdnZXIgZXZlbnRzLlxuICAgICAqL1xuICAgIHRyaWdnZXIoZXZlbnRUeXBlLCAuLi52YXJBcmdzKSB7XG4gICAgICAgIGlmIChBcnJheS5pc0FycmF5KHRoaXMubGlzdGVuZXJzX1tldmVudFR5cGVdKSkge1xuICAgICAgICAgICAgLy8gQ2xvbmUgdGhlIGxpc3QsIHNpbmNlIGNhbGxiYWNrcyBjb3VsZCBhZGQvcmVtb3ZlIGxpc3RlbmVycy5cbiAgICAgICAgICAgIGNvbnN0IGxpc3RlbmVycyA9IFsuLi50aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXV07XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxpc3RlbmVyc1tpXS5jYWxsYmFjay5hcHBseShsaXN0ZW5lcnNbaV0uY29udGV4dCwgdmFyQXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgb24oZXZlbnRUeXBlLCBjYWxsYmFjaywgY29udGV4dCkge1xuICAgICAgICB0aGlzLnZhbGlkYXRlRXZlbnRUeXBlXyhldmVudFR5cGUpO1xuICAgICAgICB0aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXSA9IHRoaXMubGlzdGVuZXJzX1tldmVudFR5cGVdIHx8IFtdO1xuICAgICAgICB0aGlzLmxpc3RlbmVyc19bZXZlbnRUeXBlXS5wdXNoKHsgY2FsbGJhY2ssIGNvbnRleHQgfSk7XG4gICAgICAgIGNvbnN0IGV2ZW50RGF0YSA9IHRoaXMuZ2V0SW5pdGlhbEV2ZW50KGV2ZW50VHlwZSk7XG4gICAgICAgIGlmIChldmVudERhdGEpIHtcbiAgICAgICAgICAgIGNhbGxiYWNrLmFwcGx5KGNvbnRleHQsIGV2ZW50RGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb2ZmKGV2ZW50VHlwZSwgY2FsbGJhY2ssIGNvbnRleHQpIHtcbiAgICAgICAgdGhpcy52YWxpZGF0ZUV2ZW50VHlwZV8oZXZlbnRUeXBlKTtcbiAgICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5saXN0ZW5lcnNfW2V2ZW50VHlwZV0gfHwgW107XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdGVuZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAobGlzdGVuZXJzW2ldLmNhbGxiYWNrID09PSBjYWxsYmFjayAmJlxuICAgICAgICAgICAgICAgICghY29udGV4dCB8fCBjb250ZXh0ID09PSBsaXN0ZW5lcnNbaV0uY29udGV4dCkpIHtcbiAgICAgICAgICAgICAgICBsaXN0ZW5lcnMuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICB2YWxpZGF0ZUV2ZW50VHlwZV8oZXZlbnRUeXBlKSB7XG4gICAgICAgIGFzc2VydCh0aGlzLmFsbG93ZWRFdmVudHNfLmZpbmQoZXQgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIGV0ID09PSBldmVudFR5cGU7XG4gICAgICAgIH0pLCAnVW5rbm93biBldmVudDogJyArIGV2ZW50VHlwZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBNb25pdG9ycyBvbmxpbmUgc3RhdGUgKGFzIHJlcG9ydGVkIGJ5IHdpbmRvdy5vbmxpbmUvb2ZmbGluZSBldmVudHMpLlxuICpcbiAqIFRoZSBleHBlY3RhdGlvbiBpcyB0aGF0IHRoaXMgY291bGQgaGF2ZSBtYW55IGZhbHNlIHBvc2l0aXZlcyAodGhpbmtzIHdlIGFyZSBvbmxpbmVcbiAqIHdoZW4gd2UncmUgbm90KSwgYnV0IG5vIGZhbHNlIG5lZ2F0aXZlcy4gIFNvIHdlIGNhbiBzYWZlbHkgdXNlIGl0IHRvIGRldGVybWluZSB3aGVuXG4gKiB3ZSBkZWZpbml0ZWx5IGNhbm5vdCByZWFjaCB0aGUgaW50ZXJuZXQuXG4gKi9cbmNsYXNzIE9ubGluZU1vbml0b3IgZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICAgIHN0YXRpYyBnZXRJbnN0YW5jZSgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBPbmxpbmVNb25pdG9yKCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihbJ29ubGluZSddKTtcbiAgICAgICAgdGhpcy5vbmxpbmVfID0gdHJ1ZTtcbiAgICAgICAgLy8gV2UndmUgaGFkIHJlcGVhdGVkIGNvbXBsYWludHMgdGhhdCBDb3Jkb3ZhIGFwcHMgY2FuIGdldCBzdHVjayBcIm9mZmxpbmVcIiwgZS5nLlxuICAgICAgICAvLyBodHRwczovL2ZvcnVtLmlvbmljZnJhbWV3b3JrLmNvbS90L2ZpcmViYXNlLWNvbm5lY3Rpb24taXMtbG9zdC1hbmQtbmV2ZXItY29tZS1iYWNrLzQzODEwXG4gICAgICAgIC8vIEl0IHdvdWxkIHNlZW0gdGhhdCB0aGUgJ29ubGluZScgZXZlbnQgZG9lcyBub3QgYWx3YXlzIGZpcmUgY29uc2lzdGVudGx5LiBTbyB3ZSBkaXNhYmxlIGl0XG4gICAgICAgIC8vIGZvciBDb3Jkb3ZhLlxuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgICAgIHR5cGVvZiB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lciAhPT0gJ3VuZGVmaW5lZCcgJiZcbiAgICAgICAgICAgICFpc01vYmlsZUNvcmRvdmEoKSkge1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMub25saW5lXykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9ubGluZV8gPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRyaWdnZXIoJ29ubGluZScsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvZmZsaW5lJywgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm9ubGluZV8pIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbmxpbmVfID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMudHJpZ2dlcignb25saW5lJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sIGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRJbml0aWFsRXZlbnQoZXZlbnRUeXBlKSB7XG4gICAgICAgIGFzc2VydChldmVudFR5cGUgPT09ICdvbmxpbmUnLCAnVW5rbm93biBldmVudCB0eXBlOiAnICsgZXZlbnRUeXBlKTtcbiAgICAgICAgcmV0dXJuIFt0aGlzLm9ubGluZV9dO1xuICAgIH1cbiAgICBjdXJyZW50bHlPbmxpbmUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm9ubGluZV87XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqIE1heGltdW0ga2V5IGRlcHRoLiAqL1xuY29uc3QgTUFYX1BBVEhfREVQVEggPSAzMjtcbi8qKiBNYXhpbXVtIG51bWJlciBvZiAoVVRGOCkgYnl0ZXMgaW4gYSBGaXJlYmFzZSBwYXRoLiAqL1xuY29uc3QgTUFYX1BBVEhfTEVOR1RIX0JZVEVTID0gNzY4O1xuLyoqXG4gKiBBbiBpbW11dGFibGUgb2JqZWN0IHJlcHJlc2VudGluZyBhIHBhcnNlZCBwYXRoLiAgSXQncyBpbW11dGFibGUgc28gdGhhdCB5b3VcbiAqIGNhbiBwYXNzIHRoZW0gYXJvdW5kIHRvIG90aGVyIGZ1bmN0aW9ucyB3aXRob3V0IHdvcnJ5aW5nIGFib3V0IHRoZW0gY2hhbmdpbmdcbiAqIGl0LlxuICovXG5jbGFzcyBQYXRoIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gcGF0aE9yU3RyaW5nIC0gUGF0aCBzdHJpbmcgdG8gcGFyc2UsIG9yIGFub3RoZXIgcGF0aCwgb3IgdGhlIHJhd1xuICAgICAqIHRva2VucyBhcnJheVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHBhdGhPclN0cmluZywgcGllY2VOdW0pIHtcbiAgICAgICAgaWYgKHBpZWNlTnVtID09PSB2b2lkIDApIHtcbiAgICAgICAgICAgIHRoaXMucGllY2VzXyA9IHBhdGhPclN0cmluZy5zcGxpdCgnLycpO1xuICAgICAgICAgICAgLy8gUmVtb3ZlIGVtcHR5IHBpZWNlcy5cbiAgICAgICAgICAgIGxldCBjb3B5VG8gPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBpZWNlc18ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5waWVjZXNfW2ldLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5waWVjZXNfW2NvcHlUb10gPSB0aGlzLnBpZWNlc19baV07XG4gICAgICAgICAgICAgICAgICAgIGNvcHlUbysrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMucGllY2VzXy5sZW5ndGggPSBjb3B5VG87XG4gICAgICAgICAgICB0aGlzLnBpZWNlTnVtXyA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnBpZWNlc18gPSBwYXRoT3JTdHJpbmc7XG4gICAgICAgICAgICB0aGlzLnBpZWNlTnVtXyA9IHBpZWNlTnVtO1xuICAgICAgICB9XG4gICAgfVxuICAgIHRvU3RyaW5nKCkge1xuICAgICAgICBsZXQgcGF0aFN0cmluZyA9ICcnO1xuICAgICAgICBmb3IgKGxldCBpID0gdGhpcy5waWVjZU51bV87IGkgPCB0aGlzLnBpZWNlc18ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnBpZWNlc19baV0gIT09ICcnKSB7XG4gICAgICAgICAgICAgICAgcGF0aFN0cmluZyArPSAnLycgKyB0aGlzLnBpZWNlc19baV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHBhdGhTdHJpbmcgfHwgJy8nO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG5ld0VtcHR5UGF0aCgpIHtcbiAgICByZXR1cm4gbmV3IFBhdGgoJycpO1xufVxuZnVuY3Rpb24gcGF0aEdldEZyb250KHBhdGgpIHtcbiAgICBpZiAocGF0aC5waWVjZU51bV8gPj0gcGF0aC5waWVjZXNfLmxlbmd0aCkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgcmV0dXJuIHBhdGgucGllY2VzX1twYXRoLnBpZWNlTnVtX107XG59XG4vKipcbiAqIEByZXR1cm5zIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgaW4gdGhpcyBwYXRoXG4gKi9cbmZ1bmN0aW9uIHBhdGhHZXRMZW5ndGgocGF0aCkge1xuICAgIHJldHVybiBwYXRoLnBpZWNlc18ubGVuZ3RoIC0gcGF0aC5waWVjZU51bV87XG59XG5mdW5jdGlvbiBwYXRoUG9wRnJvbnQocGF0aCkge1xuICAgIGxldCBwaWVjZU51bSA9IHBhdGgucGllY2VOdW1fO1xuICAgIGlmIChwaWVjZU51bSA8IHBhdGgucGllY2VzXy5sZW5ndGgpIHtcbiAgICAgICAgcGllY2VOdW0rKztcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBQYXRoKHBhdGgucGllY2VzXywgcGllY2VOdW0pO1xufVxuZnVuY3Rpb24gcGF0aEdldEJhY2socGF0aCkge1xuICAgIGlmIChwYXRoLnBpZWNlTnVtXyA8IHBhdGgucGllY2VzXy5sZW5ndGgpIHtcbiAgICAgICAgcmV0dXJuIHBhdGgucGllY2VzX1twYXRoLnBpZWNlc18ubGVuZ3RoIC0gMV07XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuZnVuY3Rpb24gcGF0aFRvVXJsRW5jb2RlZFN0cmluZyhwYXRoKSB7XG4gICAgbGV0IHBhdGhTdHJpbmcgPSAnJztcbiAgICBmb3IgKGxldCBpID0gcGF0aC5waWVjZU51bV87IGkgPCBwYXRoLnBpZWNlc18ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHBhdGgucGllY2VzX1tpXSAhPT0gJycpIHtcbiAgICAgICAgICAgIHBhdGhTdHJpbmcgKz0gJy8nICsgZW5jb2RlVVJJQ29tcG9uZW50KFN0cmluZyhwYXRoLnBpZWNlc19baV0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcGF0aFN0cmluZyB8fCAnLyc7XG59XG4vKipcbiAqIFNoYWxsb3cgY29weSBvZiB0aGUgcGFydHMgb2YgdGhlIHBhdGguXG4gKlxuICovXG5mdW5jdGlvbiBwYXRoU2xpY2UocGF0aCwgYmVnaW4gPSAwKSB7XG4gICAgcmV0dXJuIHBhdGgucGllY2VzXy5zbGljZShwYXRoLnBpZWNlTnVtXyArIGJlZ2luKTtcbn1cbmZ1bmN0aW9uIHBhdGhQYXJlbnQocGF0aCkge1xuICAgIGlmIChwYXRoLnBpZWNlTnVtXyA+PSBwYXRoLnBpZWNlc18ubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCBwaWVjZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gcGF0aC5waWVjZU51bV87IGkgPCBwYXRoLnBpZWNlc18ubGVuZ3RoIC0gMTsgaSsrKSB7XG4gICAgICAgIHBpZWNlcy5wdXNoKHBhdGgucGllY2VzX1tpXSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUGF0aChwaWVjZXMsIDApO1xufVxuZnVuY3Rpb24gcGF0aENoaWxkKHBhdGgsIGNoaWxkUGF0aE9iaikge1xuICAgIGNvbnN0IHBpZWNlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSBwYXRoLnBpZWNlTnVtXzsgaSA8IHBhdGgucGllY2VzXy5sZW5ndGg7IGkrKykge1xuICAgICAgICBwaWVjZXMucHVzaChwYXRoLnBpZWNlc19baV0pO1xuICAgIH1cbiAgICBpZiAoY2hpbGRQYXRoT2JqIGluc3RhbmNlb2YgUGF0aCkge1xuICAgICAgICBmb3IgKGxldCBpID0gY2hpbGRQYXRoT2JqLnBpZWNlTnVtXzsgaSA8IGNoaWxkUGF0aE9iai5waWVjZXNfLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBwaWVjZXMucHVzaChjaGlsZFBhdGhPYmoucGllY2VzX1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGNoaWxkUGllY2VzID0gY2hpbGRQYXRoT2JqLnNwbGl0KCcvJyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hpbGRQaWVjZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChjaGlsZFBpZWNlc1tpXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcGllY2VzLnB1c2goY2hpbGRQaWVjZXNbaV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBuZXcgUGF0aChwaWVjZXMsIDApO1xufVxuLyoqXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoZXJlIGFyZSBubyBzZWdtZW50cyBpbiB0aGlzIHBhdGhcbiAqL1xuZnVuY3Rpb24gcGF0aElzRW1wdHkocGF0aCkge1xuICAgIHJldHVybiBwYXRoLnBpZWNlTnVtXyA+PSBwYXRoLnBpZWNlc18ubGVuZ3RoO1xufVxuLyoqXG4gKiBAcmV0dXJucyBUaGUgcGF0aCBmcm9tIG91dGVyUGF0aCB0byBpbm5lclBhdGhcbiAqL1xuZnVuY3Rpb24gbmV3UmVsYXRpdmVQYXRoKG91dGVyUGF0aCwgaW5uZXJQYXRoKSB7XG4gICAgY29uc3Qgb3V0ZXIgPSBwYXRoR2V0RnJvbnQob3V0ZXJQYXRoKSwgaW5uZXIgPSBwYXRoR2V0RnJvbnQoaW5uZXJQYXRoKTtcbiAgICBpZiAob3V0ZXIgPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGlubmVyUGF0aDtcbiAgICB9XG4gICAgZWxzZSBpZiAob3V0ZXIgPT09IGlubmVyKSB7XG4gICAgICAgIHJldHVybiBuZXdSZWxhdGl2ZVBhdGgocGF0aFBvcEZyb250KG91dGVyUGF0aCksIHBhdGhQb3BGcm9udChpbm5lclBhdGgpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignSU5URVJOQUwgRVJST1I6IGlubmVyUGF0aCAoJyArXG4gICAgICAgICAgICBpbm5lclBhdGggK1xuICAgICAgICAgICAgJykgaXMgbm90IHdpdGhpbiAnICtcbiAgICAgICAgICAgICdvdXRlclBhdGggKCcgK1xuICAgICAgICAgICAgb3V0ZXJQYXRoICtcbiAgICAgICAgICAgICcpJyk7XG4gICAgfVxufVxuLyoqXG4gKiBAcmV0dXJucyAtMSwgMCwgMSBpZiBsZWZ0IGlzIGxlc3MsIGVxdWFsLCBvciBncmVhdGVyIHRoYW4gdGhlIHJpZ2h0LlxuICovXG5mdW5jdGlvbiBwYXRoQ29tcGFyZShsZWZ0LCByaWdodCkge1xuICAgIGNvbnN0IGxlZnRLZXlzID0gcGF0aFNsaWNlKGxlZnQsIDApO1xuICAgIGNvbnN0IHJpZ2h0S2V5cyA9IHBhdGhTbGljZShyaWdodCwgMCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZWZ0S2V5cy5sZW5ndGggJiYgaSA8IHJpZ2h0S2V5cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBjbXAgPSBuYW1lQ29tcGFyZShsZWZ0S2V5c1tpXSwgcmlnaHRLZXlzW2ldKTtcbiAgICAgICAgaWYgKGNtcCAhPT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIGNtcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAobGVmdEtleXMubGVuZ3RoID09PSByaWdodEtleXMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICByZXR1cm4gbGVmdEtleXMubGVuZ3RoIDwgcmlnaHRLZXlzLmxlbmd0aCA/IC0xIDogMTtcbn1cbi8qKlxuICogQHJldHVybnMgdHJ1ZSBpZiBwYXRocyBhcmUgdGhlIHNhbWUuXG4gKi9cbmZ1bmN0aW9uIHBhdGhFcXVhbHMocGF0aCwgb3RoZXIpIHtcbiAgICBpZiAocGF0aEdldExlbmd0aChwYXRoKSAhPT0gcGF0aEdldExlbmd0aChvdGhlcikpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBmb3IgKGxldCBpID0gcGF0aC5waWVjZU51bV8sIGogPSBvdGhlci5waWVjZU51bV87IGkgPD0gcGF0aC5waWVjZXNfLmxlbmd0aDsgaSsrLCBqKyspIHtcbiAgICAgICAgaWYgKHBhdGgucGllY2VzX1tpXSAhPT0gb3RoZXIucGllY2VzX1tqXSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgcGF0aCBpcyBhIHBhcmVudCBvZiAob3IgdGhlIHNhbWUgYXMpIG90aGVyXG4gKi9cbmZ1bmN0aW9uIHBhdGhDb250YWlucyhwYXRoLCBvdGhlcikge1xuICAgIGxldCBpID0gcGF0aC5waWVjZU51bV87XG4gICAgbGV0IGogPSBvdGhlci5waWVjZU51bV87XG4gICAgaWYgKHBhdGhHZXRMZW5ndGgocGF0aCkgPiBwYXRoR2V0TGVuZ3RoKG90aGVyKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHdoaWxlIChpIDwgcGF0aC5waWVjZXNfLmxlbmd0aCkge1xuICAgICAgICBpZiAocGF0aC5waWVjZXNfW2ldICE9PSBvdGhlci5waWVjZXNfW2pdKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgKytpO1xuICAgICAgICArK2o7XG4gICAgfVxuICAgIHJldHVybiB0cnVlO1xufVxuLyoqXG4gKiBEeW5hbWljIChtdXRhYmxlKSBwYXRoIHVzZWQgdG8gY291bnQgcGF0aCBsZW5ndGhzLlxuICpcbiAqIFRoaXMgY2xhc3MgaXMgdXNlZCB0byBlZmZpY2llbnRseSBjaGVjayBwYXRocyBmb3IgdmFsaWRcbiAqIGxlbmd0aCAoaW4gVVRGOCBieXRlcykgYW5kIGRlcHRoICh1c2VkIGluIHBhdGggdmFsaWRhdGlvbikuXG4gKlxuICogVGhyb3dzIEVycm9yIGV4Y2VwdGlvbiBpZiBwYXRoIGlzIGV2ZXIgaW52YWxpZC5cbiAqXG4gKiBUaGUgZGVmaW5pdGlvbiBvZiBhIHBhdGggYWx3YXlzIGJlZ2lucyB3aXRoICcvJy5cbiAqL1xuY2xhc3MgVmFsaWRhdGlvblBhdGgge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBwYXRoIC0gSW5pdGlhbCBQYXRoLlxuICAgICAqIEBwYXJhbSBlcnJvclByZWZpeF8gLSBQcmVmaXggZm9yIGFueSBlcnJvciBtZXNzYWdlcy5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihwYXRoLCBlcnJvclByZWZpeF8pIHtcbiAgICAgICAgdGhpcy5lcnJvclByZWZpeF8gPSBlcnJvclByZWZpeF87XG4gICAgICAgIHRoaXMucGFydHNfID0gcGF0aFNsaWNlKHBhdGgsIDApO1xuICAgICAgICAvKiogSW5pdGlhbGl6ZSB0byBudW1iZXIgb2YgJy8nIGNoYXJzIG5lZWRlZCBpbiBwYXRoLiAqL1xuICAgICAgICB0aGlzLmJ5dGVMZW5ndGhfID0gTWF0aC5tYXgoMSwgdGhpcy5wYXJ0c18ubGVuZ3RoKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLnBhcnRzXy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5ieXRlTGVuZ3RoXyArPSBzdHJpbmdMZW5ndGgodGhpcy5wYXJ0c19baV0pO1xuICAgICAgICB9XG4gICAgICAgIHZhbGlkYXRpb25QYXRoQ2hlY2tWYWxpZCh0aGlzKTtcbiAgICB9XG59XG5mdW5jdGlvbiB2YWxpZGF0aW9uUGF0aFB1c2godmFsaWRhdGlvblBhdGgsIGNoaWxkKSB7XG4gICAgLy8gQ291bnQgdGhlIG5lZWRlZCAnLydcbiAgICBpZiAodmFsaWRhdGlvblBhdGgucGFydHNfLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmFsaWRhdGlvblBhdGguYnl0ZUxlbmd0aF8gKz0gMTtcbiAgICB9XG4gICAgdmFsaWRhdGlvblBhdGgucGFydHNfLnB1c2goY2hpbGQpO1xuICAgIHZhbGlkYXRpb25QYXRoLmJ5dGVMZW5ndGhfICs9IHN0cmluZ0xlbmd0aChjaGlsZCk7XG4gICAgdmFsaWRhdGlvblBhdGhDaGVja1ZhbGlkKHZhbGlkYXRpb25QYXRoKTtcbn1cbmZ1bmN0aW9uIHZhbGlkYXRpb25QYXRoUG9wKHZhbGlkYXRpb25QYXRoKSB7XG4gICAgY29uc3QgbGFzdCA9IHZhbGlkYXRpb25QYXRoLnBhcnRzXy5wb3AoKTtcbiAgICB2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyAtPSBzdHJpbmdMZW5ndGgobGFzdCk7XG4gICAgLy8gVW4tY291bnQgdGhlIHByZXZpb3VzICcvJ1xuICAgIGlmICh2YWxpZGF0aW9uUGF0aC5wYXJ0c18ubGVuZ3RoID4gMCkge1xuICAgICAgICB2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyAtPSAxO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHZhbGlkYXRpb25QYXRoQ2hlY2tWYWxpZCh2YWxpZGF0aW9uUGF0aCkge1xuICAgIGlmICh2YWxpZGF0aW9uUGF0aC5ieXRlTGVuZ3RoXyA+IE1BWF9QQVRIX0xFTkdUSF9CWVRFUykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IodmFsaWRhdGlvblBhdGguZXJyb3JQcmVmaXhfICtcbiAgICAgICAgICAgICdoYXMgYSBrZXkgcGF0aCBsb25nZXIgdGhhbiAnICtcbiAgICAgICAgICAgIE1BWF9QQVRIX0xFTkdUSF9CWVRFUyArXG4gICAgICAgICAgICAnIGJ5dGVzICgnICtcbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoLmJ5dGVMZW5ndGhfICtcbiAgICAgICAgICAgICcpLicpO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGlvblBhdGgucGFydHNfLmxlbmd0aCA+IE1BWF9QQVRIX0RFUFRIKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcih2YWxpZGF0aW9uUGF0aC5lcnJvclByZWZpeF8gK1xuICAgICAgICAgICAgJ3BhdGggc3BlY2lmaWVkIGV4Y2VlZHMgdGhlIG1heGltdW0gZGVwdGggdGhhdCBjYW4gYmUgd3JpdHRlbiAoJyArXG4gICAgICAgICAgICBNQVhfUEFUSF9ERVBUSCArXG4gICAgICAgICAgICAnKSBvciBvYmplY3QgY29udGFpbnMgYSBjeWNsZSAnICtcbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyh2YWxpZGF0aW9uUGF0aCkpO1xuICAgIH1cbn1cbi8qKlxuICogU3RyaW5nIGZvciB1c2UgaW4gZXJyb3IgbWVzc2FnZXMgLSB1c2VzICcuJyBub3RhdGlvbiBmb3IgcGF0aC5cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGlvblBhdGhUb0Vycm9yU3RyaW5nKHZhbGlkYXRpb25QYXRoKSB7XG4gICAgaWYgKHZhbGlkYXRpb25QYXRoLnBhcnRzXy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuICcnO1xuICAgIH1cbiAgICByZXR1cm4gXCJpbiBwcm9wZXJ0eSAnXCIgKyB2YWxpZGF0aW9uUGF0aC5wYXJ0c18uam9pbignLicpICsgXCInXCI7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBWaXNpYmlsaXR5TW9uaXRvciBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gICAgc3RhdGljIGdldEluc3RhbmNlKCkge1xuICAgICAgICByZXR1cm4gbmV3IFZpc2liaWxpdHlNb25pdG9yKCk7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihbJ3Zpc2libGUnXSk7XG4gICAgICAgIGxldCBoaWRkZW47XG4gICAgICAgIGxldCB2aXNpYmlsaXR5Q2hhbmdlO1xuICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50ICE9PSAndW5kZWZpbmVkJyAmJlxuICAgICAgICAgICAgdHlwZW9mIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICBpZiAodHlwZW9mIGRvY3VtZW50WydoaWRkZW4nXSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvLyBPcGVyYSAxMi4xMCBhbmQgRmlyZWZveCAxOCBhbmQgbGF0ZXIgc3VwcG9ydFxuICAgICAgICAgICAgICAgIHZpc2liaWxpdHlDaGFuZ2UgPSAndmlzaWJpbGl0eWNoYW5nZSc7XG4gICAgICAgICAgICAgICAgaGlkZGVuID0gJ2hpZGRlbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnRbJ21vekhpZGRlbiddICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHlDaGFuZ2UgPSAnbW96dmlzaWJpbGl0eWNoYW5nZSc7XG4gICAgICAgICAgICAgICAgaGlkZGVuID0gJ21vekhpZGRlbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnRbJ21zSGlkZGVuJ10gIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZSA9ICdtc3Zpc2liaWxpdHljaGFuZ2UnO1xuICAgICAgICAgICAgICAgIGhpZGRlbiA9ICdtc0hpZGRlbic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZG9jdW1lbnRbJ3dlYmtpdEhpZGRlbiddICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZpc2liaWxpdHlDaGFuZ2UgPSAnd2Via2l0dmlzaWJpbGl0eWNoYW5nZSc7XG4gICAgICAgICAgICAgICAgaGlkZGVuID0gJ3dlYmtpdEhpZGRlbic7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgLy8gSW5pdGlhbGx5LCB3ZSBhbHdheXMgYXNzdW1lIHdlIGFyZSB2aXNpYmxlLiBUaGlzIGVuc3VyZXMgdGhhdCBpbiBicm93c2Vyc1xuICAgICAgICAvLyB3aXRob3V0IHBhZ2UgdmlzaWJpbGl0eSBzdXBwb3J0IG9yIGluIGNhc2VzIHdoZXJlIHdlIGFyZSBuZXZlciB2aXNpYmxlXG4gICAgICAgIC8vIChlLmcuIGNocm9tZSBleHRlbnNpb24pLCB3ZSBhY3QgYXMgaWYgd2UgYXJlIHZpc2libGUsIGkuZS4gZG9uJ3QgZGVsYXlcbiAgICAgICAgLy8gcmVjb25uZWN0c1xuICAgICAgICB0aGlzLnZpc2libGVfID0gdHJ1ZTtcbiAgICAgICAgaWYgKHZpc2liaWxpdHlDaGFuZ2UpIHtcbiAgICAgICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIodmlzaWJpbGl0eUNoYW5nZSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZpc2libGUgPSAhZG9jdW1lbnRbaGlkZGVuXTtcbiAgICAgICAgICAgICAgICBpZiAodmlzaWJsZSAhPT0gdGhpcy52aXNpYmxlXykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnZpc2libGVfID0gdmlzaWJsZTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy50cmlnZ2VyKCd2aXNpYmxlJywgdmlzaWJsZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZmFsc2UpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldEluaXRpYWxFdmVudChldmVudFR5cGUpIHtcbiAgICAgICAgYXNzZXJ0KGV2ZW50VHlwZSA9PT0gJ3Zpc2libGUnLCAnVW5rbm93biBldmVudCB0eXBlOiAnICsgZXZlbnRUeXBlKTtcbiAgICAgICAgcmV0dXJuIFt0aGlzLnZpc2libGVfXTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBSRUNPTk5FQ1RfTUlOX0RFTEFZID0gMTAwMDtcbmNvbnN0IFJFQ09OTkVDVF9NQVhfREVMQVlfREVGQVVMVCA9IDYwICogNSAqIDEwMDA7IC8vIDUgbWludXRlcyBpbiBtaWxsaXNlY29uZHMgKENhc2U6IDE4NTgpXG5jb25zdCBSRUNPTk5FQ1RfTUFYX0RFTEFZX0ZPUl9BRE1JTlMgPSAzMCAqIDEwMDA7IC8vIDMwIHNlY29uZHMgZm9yIGFkbWluIGNsaWVudHMgKGxpa2VseSB0byBiZSBhIGJhY2tlbmQgc2VydmVyKVxuY29uc3QgUkVDT05ORUNUX0RFTEFZX01VTFRJUExJRVIgPSAxLjM7XG5jb25zdCBSRUNPTk5FQ1RfREVMQVlfUkVTRVRfVElNRU9VVCA9IDMwMDAwOyAvLyBSZXNldCBkZWxheSBiYWNrIHRvIE1JTl9ERUxBWSBhZnRlciBiZWluZyBjb25uZWN0ZWQgZm9yIDMwc2VjLlxuY29uc3QgU0VSVkVSX0tJTExfSU5URVJSVVBUX1JFQVNPTiA9ICdzZXJ2ZXJfa2lsbCc7XG4vLyBJZiBhdXRoIGZhaWxzIHJlcGVhdGVkbHksIHdlJ2xsIGFzc3VtZSBzb21ldGhpbmcgaXMgd3JvbmcgYW5kIGxvZyBhIHdhcm5pbmcgLyBiYWNrIG9mZi5cbmNvbnN0IElOVkFMSURfVE9LRU5fVEhSRVNIT0xEID0gMztcbi8qKlxuICogRmlyZWJhc2UgY29ubmVjdGlvbi4gIEFic3RyYWN0cyB3aXJlIHByb3RvY29sIGFuZCBoYW5kbGVzIHJlY29ubmVjdGluZy5cbiAqXG4gKiBOT1RFOiBBbGwgSlNPTiBvYmplY3RzIHNlbnQgdG8gdGhlIHJlYWx0aW1lIGNvbm5lY3Rpb24gbXVzdCBoYXZlIHByb3BlcnR5IG5hbWVzIGVuY2xvc2VkXG4gKiBpbiBxdW90ZXMgdG8gbWFrZSBzdXJlIHRoZSBjbG9zdXJlIGNvbXBpbGVyIGRvZXMgbm90IG1pbmlmeSB0aGVtLlxuICovXG5jbGFzcyBQZXJzaXN0ZW50Q29ubmVjdGlvbiBleHRlbmRzIFNlcnZlckFjdGlvbnMge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSByZXBvSW5mb18gLSBEYXRhIGFib3V0IHRoZSBuYW1lc3BhY2Ugd2UgYXJlIGNvbm5lY3RpbmcgdG9cbiAgICAgKiBAcGFyYW0gYXBwbGljYXRpb25JZF8gLSBUaGUgRmlyZWJhc2UgQXBwIElEIGZvciB0aGlzIHByb2plY3RcbiAgICAgKiBAcGFyYW0gb25EYXRhVXBkYXRlXyAtIEEgY2FsbGJhY2sgZm9yIG5ldyBkYXRhIGZyb20gdGhlIHNlcnZlclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKHJlcG9JbmZvXywgYXBwbGljYXRpb25JZF8sIG9uRGF0YVVwZGF0ZV8sIG9uQ29ubmVjdFN0YXR1c18sIG9uU2VydmVySW5mb1VwZGF0ZV8sIGF1dGhUb2tlblByb3ZpZGVyXywgYXBwQ2hlY2tUb2tlblByb3ZpZGVyXywgYXV0aE92ZXJyaWRlXykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnJlcG9JbmZvXyA9IHJlcG9JbmZvXztcbiAgICAgICAgdGhpcy5hcHBsaWNhdGlvbklkXyA9IGFwcGxpY2F0aW9uSWRfO1xuICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8gPSBvbkRhdGFVcGRhdGVfO1xuICAgICAgICB0aGlzLm9uQ29ubmVjdFN0YXR1c18gPSBvbkNvbm5lY3RTdGF0dXNfO1xuICAgICAgICB0aGlzLm9uU2VydmVySW5mb1VwZGF0ZV8gPSBvblNlcnZlckluZm9VcGRhdGVfO1xuICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXyA9IGF1dGhUb2tlblByb3ZpZGVyXztcbiAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfID0gYXBwQ2hlY2tUb2tlblByb3ZpZGVyXztcbiAgICAgICAgdGhpcy5hdXRoT3ZlcnJpZGVfID0gYXV0aE92ZXJyaWRlXztcbiAgICAgICAgLy8gVXNlZCBmb3IgZGlhZ25vc3RpYyBsb2dnaW5nLlxuICAgICAgICB0aGlzLmlkID0gUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dFBlcnNpc3RlbnRDb25uZWN0aW9uSWRfKys7XG4gICAgICAgIHRoaXMubG9nXyA9IGxvZ1dyYXBwZXIoJ3A6JyArIHRoaXMuaWQgKyAnOicpO1xuICAgICAgICB0aGlzLmludGVycnVwdFJlYXNvbnNfID0ge307XG4gICAgICAgIHRoaXMubGlzdGVucyA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dHNfID0gW107XG4gICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRzXyA9IFtdO1xuICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfID0gMDtcbiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ0dldENvdW50XyA9IDA7XG4gICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXyA9IFtdO1xuICAgICAgICB0aGlzLmNvbm5lY3RlZF8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5yZWNvbm5lY3REZWxheV8gPSBSRUNPTk5FQ1RfTUlOX0RFTEFZO1xuICAgICAgICB0aGlzLm1heFJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfREVGQVVMVDtcbiAgICAgICAgdGhpcy5zZWN1cml0eURlYnVnQ2FsbGJhY2tfID0gbnVsbDtcbiAgICAgICAgdGhpcy5sYXN0U2Vzc2lvbklkID0gbnVsbDtcbiAgICAgICAgdGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfID0gbnVsbDtcbiAgICAgICAgdGhpcy52aXNpYmxlXyA9IGZhbHNlO1xuICAgICAgICAvLyBCZWZvcmUgd2UgZ2V0IGNvbm5lY3RlZCwgd2Uga2VlcCBhIHF1ZXVlIG9mIHBlbmRpbmcgbWVzc2FnZXMgdG8gc2VuZC5cbiAgICAgICAgdGhpcy5yZXF1ZXN0Q0JIYXNoXyA9IHt9O1xuICAgICAgICB0aGlzLnJlcXVlc3ROdW1iZXJfID0gMDtcbiAgICAgICAgdGhpcy5yZWFsdGltZV8gPSBudWxsO1xuICAgICAgICB0aGlzLmF1dGhUb2tlbl8gPSBudWxsO1xuICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gbnVsbDtcbiAgICAgICAgdGhpcy5mb3JjZVRva2VuUmVmcmVzaF8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5pbnZhbGlkQXV0aFRva2VuQ291bnRfID0gMDtcbiAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XyA9IDA7XG4gICAgICAgIHRoaXMuZmlyc3RDb25uZWN0aW9uXyA9IHRydWU7XG4gICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25BdHRlbXB0VGltZV8gPSBudWxsO1xuICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG51bGw7XG4gICAgICAgIGlmIChhdXRoT3ZlcnJpZGVfICYmICFpc05vZGVTZGsoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBdXRoIG92ZXJyaWRlIHNwZWNpZmllZCBpbiBvcHRpb25zLCBidXQgbm90IHN1cHBvcnRlZCBvbiBub24gTm9kZS5qcyBwbGF0Zm9ybXMnKTtcbiAgICAgICAgfVxuICAgICAgICBWaXNpYmlsaXR5TW9uaXRvci5nZXRJbnN0YW5jZSgpLm9uKCd2aXNpYmxlJywgdGhpcy5vblZpc2libGVfLCB0aGlzKTtcbiAgICAgICAgaWYgKHJlcG9JbmZvXy5ob3N0LmluZGV4T2YoJ2ZibG9jYWwnKSA9PT0gLTEpIHtcbiAgICAgICAgICAgIE9ubGluZU1vbml0b3IuZ2V0SW5zdGFuY2UoKS5vbignb25saW5lJywgdGhpcy5vbk9ubGluZV8sIHRoaXMpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlbmRSZXF1ZXN0KGFjdGlvbiwgYm9keSwgb25SZXNwb25zZSkge1xuICAgICAgICBjb25zdCBjdXJSZXFOdW0gPSArK3RoaXMucmVxdWVzdE51bWJlcl87XG4gICAgICAgIGNvbnN0IG1zZyA9IHsgcjogY3VyUmVxTnVtLCBhOiBhY3Rpb24sIGI6IGJvZHkgfTtcbiAgICAgICAgdGhpcy5sb2dfKHN0cmluZ2lmeShtc2cpKTtcbiAgICAgICAgYXNzZXJ0KHRoaXMuY29ubmVjdGVkXywgXCJzZW5kUmVxdWVzdCBjYWxsIHdoZW4gd2UncmUgbm90IGNvbm5lY3RlZCBub3QgYWxsb3dlZC5cIik7XG4gICAgICAgIHRoaXMucmVhbHRpbWVfLnNlbmRSZXF1ZXN0KG1zZyk7XG4gICAgICAgIGlmIChvblJlc3BvbnNlKSB7XG4gICAgICAgICAgICB0aGlzLnJlcXVlc3RDQkhhc2hfW2N1clJlcU51bV0gPSBvblJlc3BvbnNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldChxdWVyeSkge1xuICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpO1xuICAgICAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICAgICAgcDogcXVlcnkuX3BhdGgudG9TdHJpbmcoKSxcbiAgICAgICAgICAgIHE6IHF1ZXJ5Ll9xdWVyeU9iamVjdFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBvdXRzdGFuZGluZ0dldCA9IHtcbiAgICAgICAgICAgIGFjdGlvbjogJ2cnLFxuICAgICAgICAgICAgcmVxdWVzdCxcbiAgICAgICAgICAgIG9uQ29tcGxldGU6IChtZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IG1lc3NhZ2VbJ2QnXTtcbiAgICAgICAgICAgICAgICBpZiAobWVzc2FnZVsncyddID09PSAnb2snKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUocGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QocGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm91dHN0YW5kaW5nR2V0c18ucHVzaChvdXRzdGFuZGluZ0dldCk7XG4gICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRDb3VudF8rKztcbiAgICAgICAgY29uc3QgaW5kZXggPSB0aGlzLm91dHN0YW5kaW5nR2V0c18ubGVuZ3RoIC0gMTtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykge1xuICAgICAgICAgICAgdGhpcy5zZW5kR2V0XyhpbmRleCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuICAgIGxpc3RlbihxdWVyeSwgY3VycmVudEhhc2hGbiwgdGFnLCBvbkNvbXBsZXRlKSB7XG4gICAgICAgIHRoaXMuaW5pdENvbm5lY3Rpb25fKCk7XG4gICAgICAgIGNvbnN0IHF1ZXJ5SWQgPSBxdWVyeS5fcXVlcnlJZGVudGlmaWVyO1xuICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy5sb2dfKCdMaXN0ZW4gY2FsbGVkIGZvciAnICsgcGF0aFN0cmluZyArICcgJyArIHF1ZXJ5SWQpO1xuICAgICAgICBpZiAoIXRoaXMubGlzdGVucy5oYXMocGF0aFN0cmluZykpIHtcbiAgICAgICAgICAgIHRoaXMubGlzdGVucy5zZXQocGF0aFN0cmluZywgbmV3IE1hcCgpKTtcbiAgICAgICAgfVxuICAgICAgICBhc3NlcnQocXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpIHx8ICFxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCksICdsaXN0ZW4oKSBjYWxsZWQgZm9yIG5vbi1kZWZhdWx0IGJ1dCBjb21wbGV0ZSBxdWVyeScpO1xuICAgICAgICBhc3NlcnQoIXRoaXMubGlzdGVucy5nZXQocGF0aFN0cmluZykuaGFzKHF1ZXJ5SWQpLCBgbGlzdGVuKCkgY2FsbGVkIHR3aWNlIGZvciBzYW1lIHBhdGgvcXVlcnlJZC5gKTtcbiAgICAgICAgY29uc3QgbGlzdGVuU3BlYyA9IHtcbiAgICAgICAgICAgIG9uQ29tcGxldGUsXG4gICAgICAgICAgICBoYXNoRm46IGN1cnJlbnRIYXNoRm4sXG4gICAgICAgICAgICBxdWVyeSxcbiAgICAgICAgICAgIHRhZ1xuICAgICAgICB9O1xuICAgICAgICB0aGlzLmxpc3RlbnMuZ2V0KHBhdGhTdHJpbmcpLnNldChxdWVyeUlkLCBsaXN0ZW5TcGVjKTtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykge1xuICAgICAgICAgICAgdGhpcy5zZW5kTGlzdGVuXyhsaXN0ZW5TcGVjKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZW5kR2V0XyhpbmRleCkge1xuICAgICAgICBjb25zdCBnZXQgPSB0aGlzLm91dHN0YW5kaW5nR2V0c19baW5kZXhdO1xuICAgICAgICB0aGlzLnNlbmRSZXF1ZXN0KCdnJywgZ2V0LnJlcXVlc3QsIChtZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5vdXRzdGFuZGluZ0dldHNfW2luZGV4XTtcbiAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdHZXRDb3VudF8tLTtcbiAgICAgICAgICAgIGlmICh0aGlzLm91dHN0YW5kaW5nR2V0Q291bnRfID09PSAwKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vdXRzdGFuZGluZ0dldHNfID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoZ2V0Lm9uQ29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICBnZXQub25Db21wbGV0ZShtZXNzYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHNlbmRMaXN0ZW5fKGxpc3RlblNwZWMpIHtcbiAgICAgICAgY29uc3QgcXVlcnkgPSBsaXN0ZW5TcGVjLnF1ZXJ5O1xuICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7XG4gICAgICAgIHRoaXMubG9nXygnTGlzdGVuIG9uICcgKyBwYXRoU3RyaW5nICsgJyBmb3IgJyArIHF1ZXJ5SWQpO1xuICAgICAgICBjb25zdCByZXEgPSB7IC8qcGF0aCovIHA6IHBhdGhTdHJpbmcgfTtcbiAgICAgICAgY29uc3QgYWN0aW9uID0gJ3EnO1xuICAgICAgICAvLyBPbmx5IGJvdGhlciB0byBzZW5kIHF1ZXJ5IGlmIGl0J3Mgbm9uLWRlZmF1bHQuXG4gICAgICAgIGlmIChsaXN0ZW5TcGVjLnRhZykge1xuICAgICAgICAgICAgcmVxWydxJ10gPSBxdWVyeS5fcXVlcnlPYmplY3Q7XG4gICAgICAgICAgICByZXFbJ3QnXSA9IGxpc3RlblNwZWMudGFnO1xuICAgICAgICB9XG4gICAgICAgIHJlcVsgLypoYXNoKi8naCddID0gbGlzdGVuU3BlYy5oYXNoRm4oKTtcbiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcSwgKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHBheWxvYWQgPSBtZXNzYWdlWyAvKmRhdGEqLydkJ107XG4gICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBtZXNzYWdlWyAvKnN0YXR1cyovJ3MnXTtcbiAgICAgICAgICAgIC8vIHByaW50IHdhcm5pbmdzIGluIGFueSBjYXNlLi4uXG4gICAgICAgICAgICBQZXJzaXN0ZW50Q29ubmVjdGlvbi53YXJuT25MaXN0ZW5XYXJuaW5nc18ocGF5bG9hZCwgcXVlcnkpO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudExpc3RlblNwZWMgPSB0aGlzLmxpc3RlbnMuZ2V0KHBhdGhTdHJpbmcpICYmXG4gICAgICAgICAgICAgICAgdGhpcy5saXN0ZW5zLmdldChwYXRoU3RyaW5nKS5nZXQocXVlcnlJZCk7XG4gICAgICAgICAgICAvLyBvbmx5IHRyaWdnZXIgYWN0aW9ucyBpZiB0aGUgbGlzdGVuIGhhc24ndCBiZWVuIHJlbW92ZWQgYW5kIHJlYWRkZWRcbiAgICAgICAgICAgIGlmIChjdXJyZW50TGlzdGVuU3BlYyA9PT0gbGlzdGVuU3BlYykge1xuICAgICAgICAgICAgICAgIHRoaXMubG9nXygnbGlzdGVuIHJlc3BvbnNlJywgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgaWYgKHN0YXR1cyAhPT0gJ29rJykge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUxpc3Rlbl8ocGF0aFN0cmluZywgcXVlcnlJZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChsaXN0ZW5TcGVjLm9uQ29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdGVuU3BlYy5vbkNvbXBsZXRlKHN0YXR1cywgcGF5bG9hZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgc3RhdGljIHdhcm5Pbkxpc3Rlbldhcm5pbmdzXyhwYXlsb2FkLCBxdWVyeSkge1xuICAgICAgICBpZiAocGF5bG9hZCAmJiB0eXBlb2YgcGF5bG9hZCA9PT0gJ29iamVjdCcgJiYgY29udGFpbnMocGF5bG9hZCwgJ3cnKSkge1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgIGNvbnN0IHdhcm5pbmdzID0gc2FmZUdldChwYXlsb2FkLCAndycpO1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkod2FybmluZ3MpICYmIH53YXJuaW5ncy5pbmRleE9mKCdub19pbmRleCcpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXhTcGVjID0gJ1wiLmluZGV4T25cIjogXCInICsgcXVlcnkuX3F1ZXJ5UGFyYW1zLmdldEluZGV4KCkudG9TdHJpbmcoKSArICdcIic7XG4gICAgICAgICAgICAgICAgY29uc3QgaW5kZXhQYXRoID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgICAgICAgICB3YXJuKGBVc2luZyBhbiB1bnNwZWNpZmllZCBpbmRleC4gWW91ciBkYXRhIHdpbGwgYmUgZG93bmxvYWRlZCBhbmQgYCArXG4gICAgICAgICAgICAgICAgICAgIGBmaWx0ZXJlZCBvbiB0aGUgY2xpZW50LiBDb25zaWRlciBhZGRpbmcgJHtpbmRleFNwZWN9IGF0IGAgK1xuICAgICAgICAgICAgICAgICAgICBgJHtpbmRleFBhdGh9IHRvIHlvdXIgc2VjdXJpdHkgcnVsZXMgZm9yIGJldHRlciBwZXJmb3JtYW5jZS5gKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZWZyZXNoQXV0aFRva2VuKHRva2VuKSB7XG4gICAgICAgIHRoaXMuYXV0aFRva2VuXyA9IHRva2VuO1xuICAgICAgICB0aGlzLmxvZ18oJ0F1dGggdG9rZW4gcmVmcmVzaGVkJyk7XG4gICAgICAgIGlmICh0aGlzLmF1dGhUb2tlbl8pIHtcbiAgICAgICAgICAgIHRoaXMudHJ5QXV0aCgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy9JZiB3ZSdyZSBjb25uZWN0ZWQgd2Ugd2FudCB0byBsZXQgdGhlIHNlcnZlciBrbm93IHRvIHVuYXV0aGVudGljYXRlIHVzLiBJZiB3ZSdyZSBub3QgY29ubmVjdGVkLCBzaW1wbHkgZGVsZXRlXG4gICAgICAgICAgICAvL3RoZSBjcmVkZW50aWFsIHNvIHdlIGRvbnQgYmVjb21lIGF1dGhlbnRpY2F0ZWQgbmV4dCB0aW1lIHdlIGNvbm5lY3QuXG4gICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdCgndW5hdXRoJywge30sICgpID0+IHsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5yZWR1Y2VSZWNvbm5lY3REZWxheUlmQWRtaW5DcmVkZW50aWFsXyh0b2tlbik7XG4gICAgfVxuICAgIHJlZHVjZVJlY29ubmVjdERlbGF5SWZBZG1pbkNyZWRlbnRpYWxfKGNyZWRlbnRpYWwpIHtcbiAgICAgICAgLy8gTk9URTogVGhpcyBpc24ndCBpbnRlbmRlZCB0byBiZSBidWxsZXRwcm9vZiAoYSBtYWxpY2lvdXMgZGV2ZWxvcGVyIGNhbiBhbHdheXMganVzdCBtb2RpZnkgdGhlIGNsaWVudCkuXG4gICAgICAgIC8vIEFkZGl0aW9uYWxseSwgd2UgZG9uJ3QgYm90aGVyIHJlc2V0dGluZyB0aGUgbWF4IGRlbGF5IGJhY2sgdG8gdGhlIGRlZmF1bHQgaWYgYXV0aCBmYWlscyAvIGV4cGlyZXMuXG4gICAgICAgIGNvbnN0IGlzRmlyZWJhc2VTZWNyZXQgPSBjcmVkZW50aWFsICYmIGNyZWRlbnRpYWwubGVuZ3RoID09PSA0MDtcbiAgICAgICAgaWYgKGlzRmlyZWJhc2VTZWNyZXQgfHwgaXNBZG1pbihjcmVkZW50aWFsKSkge1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdBZG1pbiBhdXRoIGNyZWRlbnRpYWwgZGV0ZWN0ZWQuICBSZWR1Y2luZyBtYXggcmVjb25uZWN0IHRpbWUuJyk7XG4gICAgICAgICAgICB0aGlzLm1heFJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfRk9SX0FETUlOUztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZWZyZXNoQXBwQ2hlY2tUb2tlbih0b2tlbikge1xuICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5fID0gdG9rZW47XG4gICAgICAgIHRoaXMubG9nXygnQXBwIGNoZWNrIHRva2VuIHJlZnJlc2hlZCcpO1xuICAgICAgICBpZiAodGhpcy5hcHBDaGVja1Rva2VuXykge1xuICAgICAgICAgICAgdGhpcy50cnlBcHBDaGVjaygpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy9JZiB3ZSdyZSBjb25uZWN0ZWQgd2Ugd2FudCB0byBsZXQgdGhlIHNlcnZlciBrbm93IHRvIHVuYXV0aGVudGljYXRlIHVzLlxuICAgICAgICAgICAgLy9JZiB3ZSdyZSBub3QgY29ubmVjdGVkLCBzaW1wbHkgZGVsZXRlIHRoZSBjcmVkZW50aWFsIHNvIHdlIGRvbnQgYmVjb21lXG4gICAgICAgICAgICAvLyBhdXRoZW50aWNhdGVkIG5leHQgdGltZSB3ZSBjb25uZWN0LlxuICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoJ3VuYXBwZWNrJywge30sICgpID0+IHsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIGdpdmVuIGNyZWRlbnRpYWxzLiBJZiB0aGUgYXV0aGVudGljYXRpb24gYXR0ZW1wdCBmYWlscywgaXQncyB0cmlnZ2VyZWQgbGlrZVxuICAgICAqIGEgYXV0aCByZXZva2VkICh0aGUgY29ubmVjdGlvbiBpcyBjbG9zZWQpLlxuICAgICAqL1xuICAgIHRyeUF1dGgoKSB7XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8gJiYgdGhpcy5hdXRoVG9rZW5fKSB7XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IHRoaXMuYXV0aFRva2VuXztcbiAgICAgICAgICAgIGNvbnN0IGF1dGhNZXRob2QgPSBpc1ZhbGlkRm9ybWF0KHRva2VuKSA/ICdhdXRoJyA6ICdnYXV0aCc7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0RGF0YSA9IHsgY3JlZDogdG9rZW4gfTtcbiAgICAgICAgICAgIGlmICh0aGlzLmF1dGhPdmVycmlkZV8gPT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVsnbm9hdXRoJ10gPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHRoaXMuYXV0aE92ZXJyaWRlXyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0RGF0YVsnYXV0aHZhciddID0gdGhpcy5hdXRoT3ZlcnJpZGVfO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhdXRoTWV0aG9kLCByZXF1ZXN0RGF0YSwgKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN0YXR1cyA9IHJlc1sgLypzdGF0dXMqLydzJ107XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IHJlc1sgLypkYXRhKi8nZCddIHx8ICdlcnJvcic7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuYXV0aFRva2VuXyA9PT0gdG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ29rJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXV0aFRva2VuQ291bnRfID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFRyaWdnZXJzIHJlY29ubmVjdCBhbmQgZm9yY2UgcmVmcmVzaCBmb3IgYXV0aCB0b2tlblxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkF1dGhSZXZva2VkXyhzdGF0dXMsIGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQXR0ZW1wdHMgdG8gYXV0aGVudGljYXRlIHdpdGggdGhlIGdpdmVuIHRva2VuLiBJZiB0aGUgYXV0aGVudGljYXRpb25cbiAgICAgKiBhdHRlbXB0IGZhaWxzLCBpdCdzIHRyaWdnZXJlZCBsaWtlIHRoZSB0b2tlbiB3YXMgcmV2b2tlZCAodGhlIGNvbm5lY3Rpb24gaXNcbiAgICAgKiBjbG9zZWQpLlxuICAgICAqL1xuICAgIHRyeUFwcENoZWNrKCkge1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfICYmIHRoaXMuYXBwQ2hlY2tUb2tlbl8pIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoJ2FwcGNoZWNrJywgeyAndG9rZW4nOiB0aGlzLmFwcENoZWNrVG9rZW5fIH0sIChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSByZXNbIC8qc3RhdHVzKi8ncyddO1xuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSByZXNbIC8qZGF0YSovJ2QnXSB8fCAnZXJyb3InO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdvaycpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XyA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQXBwQ2hlY2tSZXZva2VkXyhzdGF0dXMsIGRhdGEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBpbmhlcml0RG9jXG4gICAgICovXG4gICAgdW5saXN0ZW4ocXVlcnksIHRhZykge1xuICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7XG4gICAgICAgIHRoaXMubG9nXygnVW5saXN0ZW4gY2FsbGVkIGZvciAnICsgcGF0aFN0cmluZyArICcgJyArIHF1ZXJ5SWQpO1xuICAgICAgICBhc3NlcnQocXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpIHx8ICFxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCksICd1bmxpc3RlbigpIGNhbGxlZCBmb3Igbm9uLWRlZmF1bHQgYnV0IGNvbXBsZXRlIHF1ZXJ5Jyk7XG4gICAgICAgIGNvbnN0IGxpc3RlbiA9IHRoaXMucmVtb3ZlTGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkKTtcbiAgICAgICAgaWYgKGxpc3RlbiAmJiB0aGlzLmNvbm5lY3RlZF8pIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZFVubGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkLCBxdWVyeS5fcXVlcnlPYmplY3QsIHRhZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2VuZFVubGlzdGVuXyhwYXRoU3RyaW5nLCBxdWVyeUlkLCBxdWVyeU9iaiwgdGFnKSB7XG4gICAgICAgIHRoaXMubG9nXygnVW5saXN0ZW4gb24gJyArIHBhdGhTdHJpbmcgKyAnIGZvciAnICsgcXVlcnlJZCk7XG4gICAgICAgIGNvbnN0IHJlcSA9IHsgLypwYXRoKi8gcDogcGF0aFN0cmluZyB9O1xuICAgICAgICBjb25zdCBhY3Rpb24gPSAnbic7XG4gICAgICAgIC8vIE9ubHkgYm90aGVyIHNlbmRpbmcgcXVlcnlJZCBpZiBpdCdzIG5vbi1kZWZhdWx0LlxuICAgICAgICBpZiAodGFnKSB7XG4gICAgICAgICAgICByZXFbJ3EnXSA9IHF1ZXJ5T2JqO1xuICAgICAgICAgICAgcmVxWyd0J10gPSB0YWc7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcSk7XG4gICAgfVxuICAgIG9uRGlzY29ubmVjdFB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlKSB7XG4gICAgICAgIHRoaXMuaW5pdENvbm5lY3Rpb25fKCk7XG4gICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZE9uRGlzY29ubmVjdF8oJ28nLCBwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5wdXNoKHtcbiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nLFxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ28nLFxuICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25EaXNjb25uZWN0TWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkge1xuICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRPbkRpc2Nvbm5lY3RfKCdvbScsIHBhdGhTdHJpbmcsIGRhdGEsIG9uQ29tcGxldGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RSZXF1ZXN0UXVldWVfLnB1c2goe1xuICAgICAgICAgICAgICAgIHBhdGhTdHJpbmcsXG4gICAgICAgICAgICAgICAgYWN0aW9uOiAnb20nLFxuICAgICAgICAgICAgICAgIGRhdGEsXG4gICAgICAgICAgICAgICAgb25Db21wbGV0ZVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25EaXNjb25uZWN0Q2FuY2VsKHBhdGhTdHJpbmcsIG9uQ29tcGxldGUpIHtcbiAgICAgICAgdGhpcy5pbml0Q29ubmVjdGlvbl8oKTtcbiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkXykge1xuICAgICAgICAgICAgdGhpcy5zZW5kT25EaXNjb25uZWN0Xygnb2MnLCBwYXRoU3RyaW5nLCBudWxsLCBvbkNvbXBsZXRlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMub25EaXNjb25uZWN0UmVxdWVzdFF1ZXVlXy5wdXNoKHtcbiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nLFxuICAgICAgICAgICAgICAgIGFjdGlvbjogJ29jJyxcbiAgICAgICAgICAgICAgICBkYXRhOiBudWxsLFxuICAgICAgICAgICAgICAgIG9uQ29tcGxldGVcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlbmRPbkRpc2Nvbm5lY3RfKGFjdGlvbiwgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSkge1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0geyAvKnBhdGgqLyBwOiBwYXRoU3RyaW5nLCAvKmRhdGEqLyBkOiBkYXRhIH07XG4gICAgICAgIHRoaXMubG9nXygnb25EaXNjb25uZWN0ICcgKyBhY3Rpb24sIHJlcXVlc3QpO1xuICAgICAgICB0aGlzLnNlbmRSZXF1ZXN0KGFjdGlvbiwgcmVxdWVzdCwgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICBpZiAob25Db21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKHJlc3BvbnNlWyAvKnN0YXR1cyovJ3MnXSwgcmVzcG9uc2VbIC8qIGRhdGEgKi8nZCddKTtcbiAgICAgICAgICAgICAgICB9LCBNYXRoLmZsb29yKDApKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHB1dChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7XG4gICAgICAgIHRoaXMucHV0SW50ZXJuYWwoJ3AnLCBwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKTtcbiAgICB9XG4gICAgbWVyZ2UocGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCkge1xuICAgICAgICB0aGlzLnB1dEludGVybmFsKCdtJywgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCk7XG4gICAgfVxuICAgIHB1dEludGVybmFsKGFjdGlvbiwgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCkge1xuICAgICAgICB0aGlzLmluaXRDb25uZWN0aW9uXygpO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0ge1xuICAgICAgICAgICAgLypwYXRoKi8gcDogcGF0aFN0cmluZyxcbiAgICAgICAgICAgIC8qZGF0YSovIGQ6IGRhdGFcbiAgICAgICAgfTtcbiAgICAgICAgaWYgKGhhc2ggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICAgICAgcmVxdWVzdFsgLypoYXNoKi8naCddID0gaGFzaDtcbiAgICAgICAgfVxuICAgICAgICAvLyBUT0RPOiBPbmx5IGtlZXAgdHJhY2sgb2YgdGhlIG1vc3QgcmVjZW50IHB1dCBmb3IgYSBnaXZlbiBwYXRoP1xuICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c18ucHVzaCh7XG4gICAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgICByZXF1ZXN0LFxuICAgICAgICAgICAgb25Db21wbGV0ZVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dENvdW50XysrO1xuICAgICAgICBjb25zdCBpbmRleCA9IHRoaXMub3V0c3RhbmRpbmdQdXRzXy5sZW5ndGggLSAxO1xuICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7XG4gICAgICAgICAgICB0aGlzLnNlbmRQdXRfKGluZGV4KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnQnVmZmVyaW5nIHB1dDogJyArIHBhdGhTdHJpbmcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlbmRQdXRfKGluZGV4KSB7XG4gICAgICAgIGNvbnN0IGFjdGlvbiA9IHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpbmRleF0uYWN0aW9uO1xuICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2luZGV4XS5yZXF1ZXN0O1xuICAgICAgICBjb25zdCBvbkNvbXBsZXRlID0gdGhpcy5vdXRzdGFuZGluZ1B1dHNfW2luZGV4XS5vbkNvbXBsZXRlO1xuICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0c19baW5kZXhdLnF1ZXVlZCA9IHRoaXMuY29ubmVjdGVkXztcbiAgICAgICAgdGhpcy5zZW5kUmVxdWVzdChhY3Rpb24sIHJlcXVlc3QsIChtZXNzYWdlKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oYWN0aW9uICsgJyByZXNwb25zZScsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgZGVsZXRlIHRoaXMub3V0c3RhbmRpbmdQdXRzX1tpbmRleF07XG4gICAgICAgICAgICB0aGlzLm91dHN0YW5kaW5nUHV0Q291bnRfLS07XG4gICAgICAgICAgICAvLyBDbGVhbiB1cCBhcnJheSBvY2Nhc2lvbmFsbHkuXG4gICAgICAgICAgICBpZiAodGhpcy5vdXRzdGFuZGluZ1B1dENvdW50XyA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdQdXRzXyA9IFtdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG9uQ29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKG1lc3NhZ2VbIC8qc3RhdHVzKi8ncyddLCBtZXNzYWdlWyAvKiBkYXRhICovJ2QnXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZXBvcnRTdGF0cyhzdGF0cykge1xuICAgICAgICAvLyBJZiB3ZSdyZSBub3QgY29ubmVjdGVkLCB3ZSBqdXN0IGRyb3AgdGhlIHN0YXRzLlxuICAgICAgICBpZiAodGhpcy5jb25uZWN0ZWRfKSB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0geyAvKmNvdW50ZXJzKi8gYzogc3RhdHMgfTtcbiAgICAgICAgICAgIHRoaXMubG9nXygncmVwb3J0U3RhdHMnLCByZXF1ZXN0KTtcbiAgICAgICAgICAgIHRoaXMuc2VuZFJlcXVlc3QoLypzdGF0cyovICdzJywgcmVxdWVzdCwgcmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBzdGF0dXMgPSByZXN1bHRbIC8qc3RhdHVzKi8ncyddO1xuICAgICAgICAgICAgICAgIGlmIChzdGF0dXMgIT09ICdvaycpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXJyb3JSZWFzb24gPSByZXN1bHRbIC8qIGRhdGEgKi8nZCddO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ3JlcG9ydFN0YXRzJywgJ0Vycm9yIHNlbmRpbmcgc3RhdHM6ICcgKyBlcnJvclJlYXNvbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25EYXRhTWVzc2FnZV8obWVzc2FnZSkge1xuICAgICAgICBpZiAoJ3InIGluIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIC8vIHRoaXMgaXMgYSByZXNwb25zZVxuICAgICAgICAgICAgdGhpcy5sb2dfKCdmcm9tIHNlcnZlcjogJyArIHN0cmluZ2lmeShtZXNzYWdlKSk7XG4gICAgICAgICAgICBjb25zdCByZXFOdW0gPSBtZXNzYWdlWydyJ107XG4gICAgICAgICAgICBjb25zdCBvblJlc3BvbnNlID0gdGhpcy5yZXF1ZXN0Q0JIYXNoX1tyZXFOdW1dO1xuICAgICAgICAgICAgaWYgKG9uUmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5yZXF1ZXN0Q0JIYXNoX1tyZXFOdW1dO1xuICAgICAgICAgICAgICAgIG9uUmVzcG9uc2UobWVzc2FnZVsgLypib2R5Ki8nYiddKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICgnZXJyb3InIGluIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIHRocm93ICdBIHNlcnZlci1zaWRlIGVycm9yIGhhcyBvY2N1cnJlZDogJyArIG1lc3NhZ2VbJ2Vycm9yJ107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoJ2EnIGluIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIC8vIGEgYW5kIGIgYXJlIGFjdGlvbiBhbmQgYm9keSwgcmVzcGVjdGl2ZWx5XG4gICAgICAgICAgICB0aGlzLm9uRGF0YVB1c2hfKG1lc3NhZ2VbJ2EnXSwgbWVzc2FnZVsnYiddKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkRhdGFQdXNoXyhhY3Rpb24sIGJvZHkpIHtcbiAgICAgICAgdGhpcy5sb2dfKCdoYW5kbGVTZXJ2ZXJNZXNzYWdlJywgYWN0aW9uLCBib2R5KTtcbiAgICAgICAgaWYgKGFjdGlvbiA9PT0gJ2QnKSB7XG4gICAgICAgICAgICB0aGlzLm9uRGF0YVVwZGF0ZV8oYm9keVsgLypwYXRoKi8ncCddLCBib2R5WyAvKmRhdGEqLydkJ10sIFxuICAgICAgICAgICAgLyppc01lcmdlKi8gZmFsc2UsIGJvZHlbJ3QnXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnbScpIHtcbiAgICAgICAgICAgIHRoaXMub25EYXRhVXBkYXRlXyhib2R5WyAvKnBhdGgqLydwJ10sIGJvZHlbIC8qZGF0YSovJ2QnXSwgXG4gICAgICAgICAgICAvKmlzTWVyZ2U9Ki8gdHJ1ZSwgYm9keVsndCddKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09ICdjJykge1xuICAgICAgICAgICAgdGhpcy5vbkxpc3RlblJldm9rZWRfKGJvZHlbIC8qcGF0aCovJ3AnXSwgYm9keVsgLypxdWVyeSovJ3EnXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnYWMnKSB7XG4gICAgICAgICAgICB0aGlzLm9uQXV0aFJldm9rZWRfKGJvZHlbIC8qc3RhdHVzIGNvZGUqLydzJ10sIGJvZHlbIC8qIGV4cGxhbmF0aW9uICovJ2QnXSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoYWN0aW9uID09PSAnYXBjJykge1xuICAgICAgICAgICAgdGhpcy5vbkFwcENoZWNrUmV2b2tlZF8oYm9keVsgLypzdGF0dXMgY29kZSovJ3MnXSwgYm9keVsgLyogZXhwbGFuYXRpb24gKi8nZCddKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChhY3Rpb24gPT09ICdzZCcpIHtcbiAgICAgICAgICAgIHRoaXMub25TZWN1cml0eURlYnVnUGFja2V0Xyhib2R5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGVycm9yKCdVbnJlY29nbml6ZWQgYWN0aW9uIHJlY2VpdmVkIGZyb20gc2VydmVyOiAnICtcbiAgICAgICAgICAgICAgICBzdHJpbmdpZnkoYWN0aW9uKSArXG4gICAgICAgICAgICAgICAgJ1xcbkFyZSB5b3UgdXNpbmcgdGhlIGxhdGVzdCBjbGllbnQ/Jyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25SZWFkeV8odGltZXN0YW1wLCBzZXNzaW9uSWQpIHtcbiAgICAgICAgdGhpcy5sb2dfKCdjb25uZWN0aW9uIHJlYWR5Jyk7XG4gICAgICAgIHRoaXMuY29ubmVjdGVkXyA9IHRydWU7XG4gICAgICAgIHRoaXMubGFzdENvbm5lY3Rpb25Fc3RhYmxpc2hlZFRpbWVfID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgIHRoaXMuaGFuZGxlVGltZXN0YW1wXyh0aW1lc3RhbXApO1xuICAgICAgICB0aGlzLmxhc3RTZXNzaW9uSWQgPSBzZXNzaW9uSWQ7XG4gICAgICAgIGlmICh0aGlzLmZpcnN0Q29ubmVjdGlvbl8pIHtcbiAgICAgICAgICAgIHRoaXMuc2VuZENvbm5lY3RTdGF0c18oKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlc3RvcmVTdGF0ZV8oKTtcbiAgICAgICAgdGhpcy5maXJzdENvbm5lY3Rpb25fID0gZmFsc2U7XG4gICAgICAgIHRoaXMub25Db25uZWN0U3RhdHVzXyh0cnVlKTtcbiAgICB9XG4gICAgc2NoZWR1bGVDb25uZWN0Xyh0aW1lb3V0KSB7XG4gICAgICAgIGFzc2VydCghdGhpcy5yZWFsdGltZV8sIFwiU2NoZWR1bGluZyBhIGNvbm5lY3Qgd2hlbiB3ZSdyZSBhbHJlYWR5IGNvbm5lY3RlZC9pbmc/XCIpO1xuICAgICAgICBpZiAodGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfKSB7XG4gICAgICAgICAgICBjbGVhclRpbWVvdXQodGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfKTtcbiAgICAgICAgfVxuICAgICAgICAvLyBOT1RFOiBFdmVuIHdoZW4gdGltZW91dCBpcyAwLCBpdCdzIGltcG9ydGFudCB0byBkbyBhIHNldFRpbWVvdXQgdG8gd29yayBhcm91bmQgYW4gaW5mdXJpYXRpbmcgXCJTZWN1cml0eSBFcnJvclwiIGluXG4gICAgICAgIC8vIEZpcmVmb3ggd2hlbiB0cnlpbmcgdG8gd3JpdGUgdG8gb3VyIGxvbmctcG9sbGluZyBpZnJhbWUgaW4gc29tZSBzY2VuYXJpb3MgKGUuZy4gRm9yZ2Ugb3Igb3VyIHVuaXQgdGVzdHMpLlxuICAgICAgICB0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25UaW1lcl8gPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXyA9IG51bGw7XG4gICAgICAgICAgICB0aGlzLmVzdGFibGlzaENvbm5lY3Rpb25fKCk7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICB9LCBNYXRoLmZsb29yKHRpbWVvdXQpKTtcbiAgICB9XG4gICAgaW5pdENvbm5lY3Rpb25fKCkge1xuICAgICAgICBpZiAoIXRoaXMucmVhbHRpbWVfICYmIHRoaXMuZmlyc3RDb25uZWN0aW9uXykge1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKDApO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uVmlzaWJsZV8odmlzaWJsZSkge1xuICAgICAgICAvLyBOT1RFOiBUYWJiaW5nIGF3YXkgYW5kIGJhY2sgdG8gYSB3aW5kb3cgd2lsbCBkZWZlYXQgb3VyIHJlY29ubmVjdCBiYWNrb2ZmLCBidXQgSSB0aGluayB0aGF0J3MgZmluZS5cbiAgICAgICAgaWYgKHZpc2libGUgJiZcbiAgICAgICAgICAgICF0aGlzLnZpc2libGVfICYmXG4gICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9PT0gdGhpcy5tYXhSZWNvbm5lY3REZWxheV8pIHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnV2luZG93IGJlY2FtZSB2aXNpYmxlLiAgUmVkdWNpbmcgZGVsYXkuJyk7XG4gICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NSU5fREVMQVk7XG4gICAgICAgICAgICBpZiAoIXRoaXMucmVhbHRpbWVfKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMudmlzaWJsZV8gPSB2aXNpYmxlO1xuICAgIH1cbiAgICBvbk9ubGluZV8ob25saW5lKSB7XG4gICAgICAgIGlmIChvbmxpbmUpIHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnQnJvd3NlciB3ZW50IG9ubGluZS4nKTtcbiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gUkVDT05ORUNUX01JTl9ERUxBWTtcbiAgICAgICAgICAgIGlmICghdGhpcy5yZWFsdGltZV8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNjaGVkdWxlQ29ubmVjdF8oMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ0Jyb3dzZXIgd2VudCBvZmZsaW5lLiAgS2lsbGluZyBjb25uZWN0aW9uLicpO1xuICAgICAgICAgICAgaWYgKHRoaXMucmVhbHRpbWVfKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZWFsdGltZV8uY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBvblJlYWx0aW1lRGlzY29ubmVjdF8oKSB7XG4gICAgICAgIHRoaXMubG9nXygnZGF0YSBjbGllbnQgZGlzY29ubmVjdGVkJyk7XG4gICAgICAgIHRoaXMuY29ubmVjdGVkXyA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJlYWx0aW1lXyA9IG51bGw7XG4gICAgICAgIC8vIFNpbmNlIHdlIGRvbid0IGtub3cgaWYgb3VyIHNlbnQgdHJhbnNhY3Rpb25zIHN1Y2NlZWRlZCBvciBub3QsIHdlIG5lZWQgdG8gY2FuY2VsIHRoZW0uXG4gICAgICAgIHRoaXMuY2FuY2VsU2VudFRyYW5zYWN0aW9uc18oKTtcbiAgICAgICAgLy8gQ2xlYXIgb3V0IHRoZSBwZW5kaW5nIHJlcXVlc3RzLlxuICAgICAgICB0aGlzLnJlcXVlc3RDQkhhc2hfID0ge307XG4gICAgICAgIGlmICh0aGlzLnNob3VsZFJlY29ubmVjdF8oKSkge1xuICAgICAgICAgICAgaWYgKCF0aGlzLnZpc2libGVfKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5sb2dfKFwiV2luZG93IGlzbid0IHZpc2libGUuICBEZWxheWluZyByZWNvbm5lY3QuXCIpO1xuICAgICAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gdGhpcy5tYXhSZWNvbm5lY3REZWxheV87XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q29ubmVjdGlvbkF0dGVtcHRUaW1lXyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5sYXN0Q29ubmVjdGlvbkVzdGFibGlzaGVkVGltZV8pIHtcbiAgICAgICAgICAgICAgICAvLyBJZiB3ZSd2ZSBiZWVuIGNvbm5lY3RlZCBsb25nIGVub3VnaCwgcmVzZXQgcmVjb25uZWN0IGRlbGF5IHRvIG1pbmltdW0uXG4gICAgICAgICAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENvbm5lY3RTdWNjZWVkZWQgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHRoaXMubGFzdENvbm5lY3Rpb25Fc3RhYmxpc2hlZFRpbWVfO1xuICAgICAgICAgICAgICAgIGlmICh0aW1lU2luY2VMYXN0Q29ubmVjdFN1Y2NlZWRlZCA+IFJFQ09OTkVDVF9ERUxBWV9SRVNFVF9USU1FT1VUKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gUkVDT05ORUNUX01JTl9ERUxBWTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5sYXN0Q29ubmVjdGlvbkVzdGFibGlzaGVkVGltZV8gPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdGltZVNpbmNlTGFzdENvbm5lY3RBdHRlbXB0ID0gTWF0aC5tYXgoMCwgbmV3IERhdGUoKS5nZXRUaW1lKCkgLSB0aGlzLmxhc3RDb25uZWN0aW9uQXR0ZW1wdFRpbWVfKTtcbiAgICAgICAgICAgIGxldCByZWNvbm5lY3REZWxheSA9IE1hdGgubWF4KDAsIHRoaXMucmVjb25uZWN0RGVsYXlfIC0gdGltZVNpbmNlTGFzdENvbm5lY3RBdHRlbXB0KTtcbiAgICAgICAgICAgIHJlY29ubmVjdERlbGF5ID0gTWF0aC5yYW5kb20oKSAqIHJlY29ubmVjdERlbGF5O1xuICAgICAgICAgICAgdGhpcy5sb2dfKCdUcnlpbmcgdG8gcmVjb25uZWN0IGluICcgKyByZWNvbm5lY3REZWxheSArICdtcycpO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZUNvbm5lY3RfKHJlY29ubmVjdERlbGF5KTtcbiAgICAgICAgICAgIC8vIEFkanVzdCByZWNvbm5lY3QgZGVsYXkgZm9yIG5leHQgdGltZS5cbiAgICAgICAgICAgIHRoaXMucmVjb25uZWN0RGVsYXlfID0gTWF0aC5taW4odGhpcy5tYXhSZWNvbm5lY3REZWxheV8sIHRoaXMucmVjb25uZWN0RGVsYXlfICogUkVDT05ORUNUX0RFTEFZX01VTFRJUExJRVIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMub25Db25uZWN0U3RhdHVzXyhmYWxzZSk7XG4gICAgfVxuICAgIGFzeW5jIGVzdGFibGlzaENvbm5lY3Rpb25fKCkge1xuICAgICAgICBpZiAodGhpcy5zaG91bGRSZWNvbm5lY3RfKCkpIHtcbiAgICAgICAgICAgIHRoaXMubG9nXygnTWFraW5nIGEgY29ubmVjdGlvbiBhdHRlbXB0Jyk7XG4gICAgICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uQXR0ZW1wdFRpbWVfID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICB0aGlzLmxhc3RDb25uZWN0aW9uRXN0YWJsaXNoZWRUaW1lXyA9IG51bGw7XG4gICAgICAgICAgICBjb25zdCBvbkRhdGFNZXNzYWdlID0gdGhpcy5vbkRhdGFNZXNzYWdlXy5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgY29uc3Qgb25SZWFkeSA9IHRoaXMub25SZWFkeV8uYmluZCh0aGlzKTtcbiAgICAgICAgICAgIGNvbnN0IG9uRGlzY29ubmVjdCA9IHRoaXMub25SZWFsdGltZURpc2Nvbm5lY3RfLmJpbmQodGhpcyk7XG4gICAgICAgICAgICBjb25zdCBjb25uSWQgPSB0aGlzLmlkICsgJzonICsgUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dENvbm5lY3Rpb25JZF8rKztcbiAgICAgICAgICAgIGNvbnN0IGxhc3RTZXNzaW9uSWQgPSB0aGlzLmxhc3RTZXNzaW9uSWQ7XG4gICAgICAgICAgICBsZXQgY2FuY2VsZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIGxldCBjb25uZWN0aW9uID0gbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IGNsb3NlRm4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNvbm5lY3Rpb24pIHtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbi5jbG9zZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2FuY2VsZWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgICAgICBvbkRpc2Nvbm5lY3QoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3Qgc2VuZFJlcXVlc3RGbiA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICAgICAgICAgICAgICBhc3NlcnQoY29ubmVjdGlvbiwgXCJzZW5kUmVxdWVzdCBjYWxsIHdoZW4gd2UncmUgbm90IGNvbm5lY3RlZCBub3QgYWxsb3dlZC5cIik7XG4gICAgICAgICAgICAgICAgY29ubmVjdGlvbi5zZW5kUmVxdWVzdChtc2cpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHRoaXMucmVhbHRpbWVfID0ge1xuICAgICAgICAgICAgICAgIGNsb3NlOiBjbG9zZUZuLFxuICAgICAgICAgICAgICAgIHNlbmRSZXF1ZXN0OiBzZW5kUmVxdWVzdEZuXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgZm9yY2VSZWZyZXNoID0gdGhpcy5mb3JjZVRva2VuUmVmcmVzaF87XG4gICAgICAgICAgICB0aGlzLmZvcmNlVG9rZW5SZWZyZXNoXyA9IGZhbHNlO1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAvLyBGaXJzdCBmZXRjaCBhdXRoIGFuZCBhcHAgY2hlY2sgdG9rZW4sIGFuZCBlc3RhYmxpc2ggY29ubmVjdGlvbiBhZnRlclxuICAgICAgICAgICAgICAgIC8vIGZldGNoaW5nIHRoZSB0b2tlbiB3YXMgc3VjY2Vzc2Z1bFxuICAgICAgICAgICAgICAgIGNvbnN0IFthdXRoVG9rZW4sIGFwcENoZWNrVG9rZW5dID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXy5nZXRUb2tlbihmb3JjZVJlZnJlc2gpLFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5Qcm92aWRlcl8uZ2V0VG9rZW4oZm9yY2VSZWZyZXNoKVxuICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIGlmICghY2FuY2VsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgbG9nKCdnZXRUb2tlbigpIGNvbXBsZXRlZC4gQ3JlYXRpbmcgY29ubmVjdGlvbi4nKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hdXRoVG9rZW5fID0gYXV0aFRva2VuICYmIGF1dGhUb2tlbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuXyA9IGFwcENoZWNrVG9rZW4gJiYgYXBwQ2hlY2tUb2tlbi50b2tlbjtcbiAgICAgICAgICAgICAgICAgICAgY29ubmVjdGlvbiA9IG5ldyBDb25uZWN0aW9uKGNvbm5JZCwgdGhpcy5yZXBvSW5mb18sIHRoaXMuYXBwbGljYXRpb25JZF8sIHRoaXMuYXBwQ2hlY2tUb2tlbl8sIHRoaXMuYXV0aFRva2VuXywgb25EYXRhTWVzc2FnZSwgb25SZWFkeSwgb25EaXNjb25uZWN0LCBcbiAgICAgICAgICAgICAgICAgICAgLyogb25LaWxsPSAqLyByZWFzb24gPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgd2FybihyZWFzb24gKyAnICgnICsgdGhpcy5yZXBvSW5mb18udG9TdHJpbmcoKSArICcpJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmludGVycnVwdChTRVJWRVJfS0lMTF9JTlRFUlJVUFRfUkVBU09OKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgbGFzdFNlc3Npb25JZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBsb2coJ2dldFRva2VuKCkgY29tcGxldGVkIGJ1dCB3YXMgY2FuY2VsZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ18oJ0ZhaWxlZCB0byBnZXQgdG9rZW46ICcgKyBlcnJvcik7XG4gICAgICAgICAgICAgICAgaWYgKCFjYW5jZWxlZCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5yZXBvSW5mb18ubm9kZUFkbWluKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGlzIG1heSBiZSBhIGNyaXRpY2FsIGVycm9yIGZvciB0aGUgQWRtaW4gTm9kZS5qcyBTREssIHNvIGxvZyBhIHdhcm5pbmcuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBCdXQgZ2V0VG9rZW4oKSBtYXkgYWxzbyBqdXN0IGhhdmUgdGVtcG9yYXJpbHkgZmFpbGVkLCBzbyB3ZSBzdGlsbCB3YW50IHRvXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb250aW51ZSByZXRyeWluZy5cbiAgICAgICAgICAgICAgICAgICAgICAgIHdhcm4oZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNsb3NlRm4oKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaW50ZXJydXB0KHJlYXNvbikge1xuICAgICAgICBsb2coJ0ludGVycnVwdGluZyBjb25uZWN0aW9uIGZvciByZWFzb246ICcgKyByZWFzb24pO1xuICAgICAgICB0aGlzLmludGVycnVwdFJlYXNvbnNfW3JlYXNvbl0gPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5yZWFsdGltZV8pIHtcbiAgICAgICAgICAgIHRoaXMucmVhbHRpbWVfLmNsb3NlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfKSB7XG4gICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuZXN0YWJsaXNoQ29ubmVjdGlvblRpbWVyXyk7XG4gICAgICAgICAgICAgICAgdGhpcy5lc3RhYmxpc2hDb25uZWN0aW9uVGltZXJfID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZF8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uUmVhbHRpbWVEaXNjb25uZWN0XygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHJlc3VtZShyZWFzb24pIHtcbiAgICAgICAgbG9nKCdSZXN1bWluZyBjb25uZWN0aW9uIGZvciByZWFzb246ICcgKyByZWFzb24pO1xuICAgICAgICBkZWxldGUgdGhpcy5pbnRlcnJ1cHRSZWFzb25zX1tyZWFzb25dO1xuICAgICAgICBpZiAoaXNFbXB0eSh0aGlzLmludGVycnVwdFJlYXNvbnNfKSkge1xuICAgICAgICAgICAgdGhpcy5yZWNvbm5lY3REZWxheV8gPSBSRUNPTk5FQ1RfTUlOX0RFTEFZO1xuICAgICAgICAgICAgaWYgKCF0aGlzLnJlYWx0aW1lXykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2NoZWR1bGVDb25uZWN0XygwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVUaW1lc3RhbXBfKHRpbWVzdGFtcCkge1xuICAgICAgICBjb25zdCBkZWx0YSA9IHRpbWVzdGFtcCAtIG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgICB0aGlzLm9uU2VydmVySW5mb1VwZGF0ZV8oeyBzZXJ2ZXJUaW1lT2Zmc2V0OiBkZWx0YSB9KTtcbiAgICB9XG4gICAgY2FuY2VsU2VudFRyYW5zYWN0aW9uc18oKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5vdXRzdGFuZGluZ1B1dHNfLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBwdXQgPSB0aGlzLm91dHN0YW5kaW5nUHV0c19baV07XG4gICAgICAgICAgICBpZiAocHV0ICYmIC8qaGFzaCovICdoJyBpbiBwdXQucmVxdWVzdCAmJiBwdXQucXVldWVkKSB7XG4gICAgICAgICAgICAgICAgaWYgKHB1dC5vbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHB1dC5vbkNvbXBsZXRlKCdkaXNjb25uZWN0Jyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLm91dHN0YW5kaW5nUHV0c19baV07XG4gICAgICAgICAgICAgICAgdGhpcy5vdXRzdGFuZGluZ1B1dENvdW50Xy0tO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIENsZWFuIHVwIGFycmF5IG9jY2FzaW9uYWxseS5cbiAgICAgICAgaWYgKHRoaXMub3V0c3RhbmRpbmdQdXRDb3VudF8gPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMub3V0c3RhbmRpbmdQdXRzXyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uTGlzdGVuUmV2b2tlZF8ocGF0aFN0cmluZywgcXVlcnkpIHtcbiAgICAgICAgLy8gUmVtb3ZlIHRoZSBsaXN0ZW4gYW5kIG1hbnVmYWN0dXJlIGEgXCJwZXJtaXNzaW9uX2RlbmllZFwiIGVycm9yIGZvciB0aGUgZmFpbGVkIGxpc3Rlbi5cbiAgICAgICAgbGV0IHF1ZXJ5SWQ7XG4gICAgICAgIGlmICghcXVlcnkpIHtcbiAgICAgICAgICAgIHF1ZXJ5SWQgPSAnZGVmYXVsdCc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBxdWVyeUlkID0gcXVlcnkubWFwKHEgPT4gT2JqZWN0VG9VbmlxdWVLZXkocSkpLmpvaW4oJyQnKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBsaXN0ZW4gPSB0aGlzLnJlbW92ZUxpc3Rlbl8ocGF0aFN0cmluZywgcXVlcnlJZCk7XG4gICAgICAgIGlmIChsaXN0ZW4gJiYgbGlzdGVuLm9uQ29tcGxldGUpIHtcbiAgICAgICAgICAgIGxpc3Rlbi5vbkNvbXBsZXRlKCdwZXJtaXNzaW9uX2RlbmllZCcpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZUxpc3Rlbl8ocGF0aFN0cmluZywgcXVlcnlJZCkge1xuICAgICAgICBjb25zdCBub3JtYWxpemVkUGF0aFN0cmluZyA9IG5ldyBQYXRoKHBhdGhTdHJpbmcpLnRvU3RyaW5nKCk7IC8vIG5vcm1hbGl6ZSBwYXRoLlxuICAgICAgICBsZXQgbGlzdGVuO1xuICAgICAgICBpZiAodGhpcy5saXN0ZW5zLmhhcyhub3JtYWxpemVkUGF0aFN0cmluZykpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hcCA9IHRoaXMubGlzdGVucy5nZXQobm9ybWFsaXplZFBhdGhTdHJpbmcpO1xuICAgICAgICAgICAgbGlzdGVuID0gbWFwLmdldChxdWVyeUlkKTtcbiAgICAgICAgICAgIG1hcC5kZWxldGUocXVlcnlJZCk7XG4gICAgICAgICAgICBpZiAobWFwLnNpemUgPT09IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxpc3RlbnMuZGVsZXRlKG5vcm1hbGl6ZWRQYXRoU3RyaW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGFsbCBsaXN0ZW5zIGZvciB0aGlzIHBhdGggaGFzIGFscmVhZHkgYmVlbiByZW1vdmVkXG4gICAgICAgICAgICBsaXN0ZW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGxpc3RlbjtcbiAgICB9XG4gICAgb25BdXRoUmV2b2tlZF8oc3RhdHVzQ29kZSwgZXhwbGFuYXRpb24pIHtcbiAgICAgICAgbG9nKCdBdXRoIHRva2VuIHJldm9rZWQ6ICcgKyBzdGF0dXNDb2RlICsgJy8nICsgZXhwbGFuYXRpb24pO1xuICAgICAgICB0aGlzLmF1dGhUb2tlbl8gPSBudWxsO1xuICAgICAgICB0aGlzLmZvcmNlVG9rZW5SZWZyZXNoXyA9IHRydWU7XG4gICAgICAgIHRoaXMucmVhbHRpbWVfLmNsb3NlKCk7XG4gICAgICAgIGlmIChzdGF0dXNDb2RlID09PSAnaW52YWxpZF90b2tlbicgfHwgc3RhdHVzQ29kZSA9PT0gJ3Blcm1pc3Npb25fZGVuaWVkJykge1xuICAgICAgICAgICAgLy8gV2UnbGwgd2FpdCBhIGNvdXBsZSB0aW1lcyBiZWZvcmUgbG9nZ2luZyB0aGUgd2FybmluZyAvIGluY3JlYXNpbmcgdGhlXG4gICAgICAgICAgICAvLyByZXRyeSBwZXJpb2Qgc2luY2Ugb2F1dGggdG9rZW5zIHdpbGwgcmVwb3J0IGFzIFwiaW52YWxpZFwiIGlmIHRoZXkncmVcbiAgICAgICAgICAgIC8vIGp1c3QgZXhwaXJlZC4gUGx1cyB0aGVyZSBtYXkgYmUgdHJhbnNpZW50IGlzc3VlcyB0aGF0IHJlc29sdmUgdGhlbXNlbHZlcy5cbiAgICAgICAgICAgIHRoaXMuaW52YWxpZEF1dGhUb2tlbkNvdW50XysrO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW52YWxpZEF1dGhUb2tlbkNvdW50XyA+PSBJTlZBTElEX1RPS0VOX1RIUkVTSE9MRCkge1xuICAgICAgICAgICAgICAgIC8vIFNldCBhIGxvbmcgcmVjb25uZWN0IGRlbGF5IGJlY2F1c2UgcmVjb3ZlcnkgaXMgdW5saWtlbHlcbiAgICAgICAgICAgICAgICB0aGlzLnJlY29ubmVjdERlbGF5XyA9IFJFQ09OTkVDVF9NQVhfREVMQVlfRk9SX0FETUlOUztcbiAgICAgICAgICAgICAgICAvLyBOb3RpZnkgdGhlIGF1dGggdG9rZW4gcHJvdmlkZXIgdGhhdCB0aGUgdG9rZW4gaXMgaW52YWxpZCwgd2hpY2ggd2lsbCBsb2dcbiAgICAgICAgICAgICAgICAvLyBhIHdhcm5pbmdcbiAgICAgICAgICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXy5ub3RpZnlGb3JJbnZhbGlkVG9rZW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkFwcENoZWNrUmV2b2tlZF8oc3RhdHVzQ29kZSwgZXhwbGFuYXRpb24pIHtcbiAgICAgICAgbG9nKCdBcHAgY2hlY2sgdG9rZW4gcmV2b2tlZDogJyArIHN0YXR1c0NvZGUgKyAnLycgKyBleHBsYW5hdGlvbik7XG4gICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlbl8gPSBudWxsO1xuICAgICAgICB0aGlzLmZvcmNlVG9rZW5SZWZyZXNoXyA9IHRydWU7XG4gICAgICAgIC8vIE5vdGU6IFdlIGRvbid0IGNsb3NlIHRoZSBjb25uZWN0aW9uIGFzIHRoZSBkZXZlbG9wZXIgbWF5IG5vdCBoYXZlXG4gICAgICAgIC8vIGVuZm9yY2VtZW50IGVuYWJsZWQuIFRoZSBiYWNrZW5kIGNsb3NlcyBjb25uZWN0aW9ucyB3aXRoIGVuZm9yY2VtZW50cy5cbiAgICAgICAgaWYgKHN0YXR1c0NvZGUgPT09ICdpbnZhbGlkX3Rva2VuJyB8fCBzdGF0dXNDb2RlID09PSAncGVybWlzc2lvbl9kZW5pZWQnKSB7XG4gICAgICAgICAgICAvLyBXZSdsbCB3YWl0IGEgY291cGxlIHRpbWVzIGJlZm9yZSBsb2dnaW5nIHRoZSB3YXJuaW5nIC8gaW5jcmVhc2luZyB0aGVcbiAgICAgICAgICAgIC8vIHJldHJ5IHBlcmlvZCBzaW5jZSBvYXV0aCB0b2tlbnMgd2lsbCByZXBvcnQgYXMgXCJpbnZhbGlkXCIgaWYgdGhleSdyZVxuICAgICAgICAgICAgLy8ganVzdCBleHBpcmVkLiBQbHVzIHRoZXJlIG1heSBiZSB0cmFuc2llbnQgaXNzdWVzIHRoYXQgcmVzb2x2ZSB0aGVtc2VsdmVzLlxuICAgICAgICAgICAgdGhpcy5pbnZhbGlkQXBwQ2hlY2tUb2tlbkNvdW50XysrO1xuICAgICAgICAgICAgaWYgKHRoaXMuaW52YWxpZEFwcENoZWNrVG9rZW5Db3VudF8gPj0gSU5WQUxJRF9UT0tFTl9USFJFU0hPTEQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFwcENoZWNrVG9rZW5Qcm92aWRlcl8ubm90aWZ5Rm9ySW52YWxpZFRva2VuKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25TZWN1cml0eURlYnVnUGFja2V0Xyhib2R5KSB7XG4gICAgICAgIGlmICh0aGlzLnNlY3VyaXR5RGVidWdDYWxsYmFja18pIHtcbiAgICAgICAgICAgIHRoaXMuc2VjdXJpdHlEZWJ1Z0NhbGxiYWNrXyhib2R5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmICgnbXNnJyBpbiBib2R5KSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZJUkVCQVNFOiAnICsgYm9keVsnbXNnJ10ucmVwbGFjZSgnXFxuJywgJ1xcbkZJUkVCQVNFOiAnKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVzdG9yZVN0YXRlXygpIHtcbiAgICAgICAgLy9SZS1hdXRoZW50aWNhdGUgb3Vyc2VsdmVzIGlmIHdlIGhhdmUgYSBjcmVkZW50aWFsIHN0b3JlZC5cbiAgICAgICAgdGhpcy50cnlBdXRoKCk7XG4gICAgICAgIHRoaXMudHJ5QXBwQ2hlY2soKTtcbiAgICAgICAgLy8gUHV0cyBkZXBlbmQgb24gaGF2aW5nIHJlY2VpdmVkIHRoZSBjb3JyZXNwb25kaW5nIGRhdGEgdXBkYXRlIGZyb20gdGhlIHNlcnZlciBiZWZvcmUgdGhleSBjb21wbGV0ZSwgc28gd2UgbXVzdFxuICAgICAgICAvLyBtYWtlIHN1cmUgdG8gc2VuZCBsaXN0ZW5zIGJlZm9yZSBwdXRzLlxuICAgICAgICBmb3IgKGNvbnN0IHF1ZXJpZXMgb2YgdGhpcy5saXN0ZW5zLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpc3RlblNwZWMgb2YgcXVlcmllcy52YWx1ZXMoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VuZExpc3Rlbl8obGlzdGVuU3BlYyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm91dHN0YW5kaW5nUHV0c18ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm91dHN0YW5kaW5nUHV0c19baV0pIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNlbmRQdXRfKGkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHdoaWxlICh0aGlzLm9uRGlzY29ubmVjdFJlcXVlc3RRdWV1ZV8ubGVuZ3RoKSB7XG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gdGhpcy5vbkRpc2Nvbm5lY3RSZXF1ZXN0UXVldWVfLnNoaWZ0KCk7XG4gICAgICAgICAgICB0aGlzLnNlbmRPbkRpc2Nvbm5lY3RfKHJlcXVlc3QuYWN0aW9uLCByZXF1ZXN0LnBhdGhTdHJpbmcsIHJlcXVlc3QuZGF0YSwgcmVxdWVzdC5vbkNvbXBsZXRlKTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub3V0c3RhbmRpbmdHZXRzXy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKHRoaXMub3V0c3RhbmRpbmdHZXRzX1tpXSkge1xuICAgICAgICAgICAgICAgIHRoaXMuc2VuZEdldF8oaSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogU2VuZHMgY2xpZW50IHN0YXRzIGZvciBmaXJzdCBjb25uZWN0aW9uXG4gICAgICovXG4gICAgc2VuZENvbm5lY3RTdGF0c18oKSB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0ge307XG4gICAgICAgIGxldCBjbGllbnROYW1lID0gJ2pzJztcbiAgICAgICAgaWYgKGlzTm9kZVNkaygpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5yZXBvSW5mb18ubm9kZUFkbWluKSB7XG4gICAgICAgICAgICAgICAgY2xpZW50TmFtZSA9ICdhZG1pbl9ub2RlJztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNsaWVudE5hbWUgPSAnbm9kZSc7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc3RhdHNbJ3Nkay4nICsgY2xpZW50TmFtZSArICcuJyArIFNES19WRVJTSU9OLnJlcGxhY2UoL1xcLi9nLCAnLScpXSA9IDE7XG4gICAgICAgIGlmIChpc01vYmlsZUNvcmRvdmEoKSkge1xuICAgICAgICAgICAgc3RhdHNbJ2ZyYW1ld29yay5jb3Jkb3ZhJ10gPSAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGlzUmVhY3ROYXRpdmUoKSkge1xuICAgICAgICAgICAgc3RhdHNbJ2ZyYW1ld29yay5yZWFjdG5hdGl2ZSddID0gMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnJlcG9ydFN0YXRzKHN0YXRzKTtcbiAgICB9XG4gICAgc2hvdWxkUmVjb25uZWN0XygpIHtcbiAgICAgICAgY29uc3Qgb25saW5lID0gT25saW5lTW9uaXRvci5nZXRJbnN0YW5jZSgpLmN1cnJlbnRseU9ubGluZSgpO1xuICAgICAgICByZXR1cm4gaXNFbXB0eSh0aGlzLmludGVycnVwdFJlYXNvbnNfKSAmJiBvbmxpbmU7XG4gICAgfVxufVxuUGVyc2lzdGVudENvbm5lY3Rpb24ubmV4dFBlcnNpc3RlbnRDb25uZWN0aW9uSWRfID0gMDtcbi8qKlxuICogQ291bnRlciBmb3IgbnVtYmVyIG9mIGNvbm5lY3Rpb25zIGNyZWF0ZWQuIE1haW5seSB1c2VkIGZvciB0YWdnaW5nIGluIHRoZSBsb2dzXG4gKi9cblBlcnNpc3RlbnRDb25uZWN0aW9uLm5leHRDb25uZWN0aW9uSWRfID0gMDtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIE5hbWVkTm9kZSB7XG4gICAgY29uc3RydWN0b3IobmFtZSwgbm9kZSkge1xuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgIH1cbiAgICBzdGF0aWMgV3JhcChuYW1lLCBub2RlKSB7XG4gICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKG5hbWUsIG5vZGUpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIEluZGV4IHtcbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBBIHN0YW5kYWxvbmUgY29tcGFyaXNvbiBmdW5jdGlvbiBmb3JcbiAgICAgKiB0aGlzIGluZGV4XG4gICAgICovXG4gICAgZ2V0Q29tcGFyZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZS5iaW5kKHRoaXMpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHaXZlbiBhIGJlZm9yZSBhbmQgYWZ0ZXIgdmFsdWUgZm9yIGEgbm9kZSwgZGV0ZXJtaW5lIGlmIHRoZSBpbmRleGVkIHZhbHVlIGhhcyBjaGFuZ2VkLiBFdmVuIGlmIHRoZXkgYXJlIGRpZmZlcmVudCxcbiAgICAgKiBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIGNoYW5nZXMgYXJlIGlzb2xhdGVkIHRvIHBhcnRzIG9mIHRoZSBzbmFwc2hvdCB0aGF0IGFyZSBub3QgaW5kZXhlZC5cbiAgICAgKlxuICAgICAqXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgcG9ydGlvbiBvZiB0aGUgc25hcHNob3QgYmVpbmcgaW5kZXhlZCBjaGFuZ2VkIGJldHdlZW4gb2xkTm9kZSBhbmQgbmV3Tm9kZVxuICAgICAqL1xuICAgIGluZGV4ZWRWYWx1ZUNoYW5nZWQob2xkTm9kZSwgbmV3Tm9kZSkge1xuICAgICAgICBjb25zdCBvbGRXcmFwcGVkID0gbmV3IE5hbWVkTm9kZShNSU5fTkFNRSwgb2xkTm9kZSk7XG4gICAgICAgIGNvbnN0IG5ld1dyYXBwZWQgPSBuZXcgTmFtZWROb2RlKE1JTl9OQU1FLCBuZXdOb2RlKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29tcGFyZShvbGRXcmFwcGVkLCBuZXdXcmFwcGVkKSAhPT0gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgYSBub2RlIHdyYXBwZXIgdGhhdCB3aWxsIHNvcnQgZXF1YWwgdG8gb3IgbGVzcyB0aGFuXG4gICAgICogYW55IG90aGVyIG5vZGUgd3JhcHBlciwgdXNpbmcgdGhpcyBpbmRleFxuICAgICAqL1xuICAgIG1pblBvc3QoKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIHJldHVybiBOYW1lZE5vZGUuTUlOO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBfX0VNUFRZX05PREU7XG5jbGFzcyBLZXlJbmRleCBleHRlbmRzIEluZGV4IHtcbiAgICBzdGF0aWMgZ2V0IF9fRU1QVFlfTk9ERSgpIHtcbiAgICAgICAgcmV0dXJuIF9fRU1QVFlfTk9ERTtcbiAgICB9XG4gICAgc3RhdGljIHNldCBfX0VNUFRZX05PREUodmFsKSB7XG4gICAgICAgIF9fRU1QVFlfTk9ERSA9IHZhbDtcbiAgICB9XG4gICAgY29tcGFyZShhLCBiKSB7XG4gICAgICAgIHJldHVybiBuYW1lQ29tcGFyZShhLm5hbWUsIGIubmFtZSk7XG4gICAgfVxuICAgIGlzRGVmaW5lZE9uKG5vZGUpIHtcbiAgICAgICAgLy8gV2UgY291bGQgcHJvYmFibHkgcmV0dXJuIHRydWUgaGVyZSAoc2luY2UgZXZlcnkgbm9kZSBoYXMgYSBrZXkpLCBidXQgaXQncyBuZXZlciBjYWxsZWRcbiAgICAgICAgLy8gc28ganVzdCBsZWF2aW5nIHVuaW1wbGVtZW50ZWQgZm9yIG5vdy5cbiAgICAgICAgdGhyb3cgYXNzZXJ0aW9uRXJyb3IoJ0tleUluZGV4LmlzRGVmaW5lZE9uIG5vdCBleHBlY3RlZCB0byBiZSBjYWxsZWQuJyk7XG4gICAgfVxuICAgIGluZGV4ZWRWYWx1ZUNoYW5nZWQob2xkTm9kZSwgbmV3Tm9kZSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFRoZSBrZXkgZm9yIGEgbm9kZSBuZXZlciBjaGFuZ2VzLlxuICAgIH1cbiAgICBtaW5Qb3N0KCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjtcbiAgICB9XG4gICAgbWF4UG9zdCgpIHtcbiAgICAgICAgLy8gVE9ETzogVGhpcyBzaG91bGQgcmVhbGx5IGJlIGNyZWF0ZWQgb25jZSBhbmQgY2FjaGVkIGluIGEgc3RhdGljIHByb3BlcnR5LCBidXRcbiAgICAgICAgLy8gTmFtZWROb2RlIGlzbid0IGRlZmluZWQgeWV0LCBzbyBJIGNhbid0IHVzZSBpdCBpbiBhIHN0YXRpYy4gIEJsZWguXG4gICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKE1BWF9OQU1FLCBfX0VNUFRZX05PREUpO1xuICAgIH1cbiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7XG4gICAgICAgIGFzc2VydCh0eXBlb2YgaW5kZXhWYWx1ZSA9PT0gJ3N0cmluZycsICdLZXlJbmRleCBpbmRleFZhbHVlIG11c3QgYWx3YXlzIGJlIGEgc3RyaW5nLicpO1xuICAgICAgICAvLyBXZSBqdXN0IHVzZSBlbXB0eSBub2RlLCBidXQgaXQnbGwgbmV2ZXIgYmUgY29tcGFyZWQsIHNpbmNlIG91ciBjb21wYXJhdG9yIG9ubHkgbG9va3MgYXQgbmFtZS5cbiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUoaW5kZXhWYWx1ZSwgX19FTVBUWV9OT0RFKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgU3RyaW5nIHJlcHJlc2VudGF0aW9uIGZvciBpbmNsdXNpb24gaW4gYSBxdWVyeSBzcGVjXG4gICAgICovXG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiAnLmtleSc7XG4gICAgfVxufVxuY29uc3QgS0VZX0lOREVYID0gbmV3IEtleUluZGV4KCk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEFuIGl0ZXJhdG9yIG92ZXIgYW4gTExSQk5vZGUuXG4gKi9cbmNsYXNzIFNvcnRlZE1hcEl0ZXJhdG9yIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gbm9kZSAtIE5vZGUgdG8gaXRlcmF0ZS5cbiAgICAgKiBAcGFyYW0gaXNSZXZlcnNlXyAtIFdoZXRoZXIgb3Igbm90IHRvIGl0ZXJhdGUgaW4gcmV2ZXJzZVxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKG5vZGUsIHN0YXJ0S2V5LCBjb21wYXJhdG9yLCBpc1JldmVyc2VfLCByZXN1bHRHZW5lcmF0b3JfID0gbnVsbCkge1xuICAgICAgICB0aGlzLmlzUmV2ZXJzZV8gPSBpc1JldmVyc2VfO1xuICAgICAgICB0aGlzLnJlc3VsdEdlbmVyYXRvcl8gPSByZXN1bHRHZW5lcmF0b3JfO1xuICAgICAgICB0aGlzLm5vZGVTdGFja18gPSBbXTtcbiAgICAgICAgbGV0IGNtcCA9IDE7XG4gICAgICAgIHdoaWxlICghbm9kZS5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlO1xuICAgICAgICAgICAgY21wID0gc3RhcnRLZXkgPyBjb21wYXJhdG9yKG5vZGUua2V5LCBzdGFydEtleSkgOiAxO1xuICAgICAgICAgICAgLy8gZmxpcCB0aGUgY29tcGFyaXNvbiBpZiB3ZSdyZSBnb2luZyBpbiByZXZlcnNlXG4gICAgICAgICAgICBpZiAoaXNSZXZlcnNlXykge1xuICAgICAgICAgICAgICAgIGNtcCAqPSAtMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjbXAgPCAwKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGxlc3MgdGhhbiBvdXIgc3RhcnQga2V5LiBpZ25vcmUgaXRcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc1JldmVyc2VfKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjbXAgPT09IDApIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIG5vZGUgaXMgZXhhY3RseSBlcXVhbCB0byBvdXIgc3RhcnQga2V5LiBQdXNoIGl0IG9uIHRoZSBzdGFjaywgYnV0IHN0b3AgaXRlcmF0aW5nO1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZVN0YWNrXy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBub2RlIGlzIGdyZWF0ZXIgdGhhbiBvdXIgc3RhcnQga2V5LCBhZGQgaXQgdG8gdGhlIHN0YWNrIGFuZCBtb3ZlIHRvIHRoZSBuZXh0IG9uZVxuICAgICAgICAgICAgICAgIHRoaXMubm9kZVN0YWNrXy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmlzUmV2ZXJzZV8pIHtcbiAgICAgICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUucmlnaHQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXROZXh0KCkge1xuICAgICAgICBpZiAodGhpcy5ub2RlU3RhY2tfLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5vZGUgPSB0aGlzLm5vZGVTdGFja18ucG9wKCk7XG4gICAgICAgIGxldCByZXN1bHQ7XG4gICAgICAgIGlmICh0aGlzLnJlc3VsdEdlbmVyYXRvcl8pIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHRoaXMucmVzdWx0R2VuZXJhdG9yXyhub2RlLmtleSwgbm9kZS52YWx1ZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSB7IGtleTogbm9kZS5rZXksIHZhbHVlOiBub2RlLnZhbHVlIH07XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuaXNSZXZlcnNlXykge1xuICAgICAgICAgICAgbm9kZSA9IG5vZGUubGVmdDtcbiAgICAgICAgICAgIHdoaWxlICghbm9kZS5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVTdGFja18ucHVzaChub2RlKTtcbiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5vZGUgPSBub2RlLnJpZ2h0O1xuICAgICAgICAgICAgd2hpbGUgKCFub2RlLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZVN0YWNrXy5wdXNoKG5vZGUpO1xuICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgaGFzTmV4dCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubm9kZVN0YWNrXy5sZW5ndGggPiAwO1xuICAgIH1cbiAgICBwZWVrKCkge1xuICAgICAgICBpZiAodGhpcy5ub2RlU3RhY2tfLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgbm9kZSA9IHRoaXMubm9kZVN0YWNrX1t0aGlzLm5vZGVTdGFja18ubGVuZ3RoIC0gMV07XG4gICAgICAgIGlmICh0aGlzLnJlc3VsdEdlbmVyYXRvcl8pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJlc3VsdEdlbmVyYXRvcl8obm9kZS5rZXksIG5vZGUudmFsdWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHsga2V5OiBub2RlLmtleSwgdmFsdWU6IG5vZGUudmFsdWUgfTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogUmVwcmVzZW50cyBhIG5vZGUgaW4gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrIHRyZWUuXG4gKi9cbmNsYXNzIExMUkJOb2RlIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0ga2V5IC0gS2V5IGFzc29jaWF0ZWQgd2l0aCB0aGlzIG5vZGUuXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgbm9kZS5cbiAgICAgKiBAcGFyYW0gY29sb3IgLSBXaGV0aGVyIHRoaXMgbm9kZSBpcyByZWQuXG4gICAgICogQHBhcmFtIGxlZnQgLSBMZWZ0IGNoaWxkLlxuICAgICAqIEBwYXJhbSByaWdodCAtIFJpZ2h0IGNoaWxkLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGtleSwgdmFsdWUsIGNvbG9yLCBsZWZ0LCByaWdodCkge1xuICAgICAgICB0aGlzLmtleSA9IGtleTtcbiAgICAgICAgdGhpcy52YWx1ZSA9IHZhbHVlO1xuICAgICAgICB0aGlzLmNvbG9yID0gY29sb3IgIT0gbnVsbCA/IGNvbG9yIDogTExSQk5vZGUuUkVEO1xuICAgICAgICB0aGlzLmxlZnQgPVxuICAgICAgICAgICAgbGVmdCAhPSBudWxsID8gbGVmdCA6IFNvcnRlZE1hcC5FTVBUWV9OT0RFO1xuICAgICAgICB0aGlzLnJpZ2h0ID1cbiAgICAgICAgICAgIHJpZ2h0ICE9IG51bGwgPyByaWdodCA6IFNvcnRlZE1hcC5FTVBUWV9OT0RFO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLCBvcHRpb25hbGx5IHJlcGxhY2luZyBwaWVjZXMgb2YgaXQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ga2V5IC0gTmV3IGtleSBmb3IgdGhlIG5vZGUsIG9yIG51bGwuXG4gICAgICogQHBhcmFtIHZhbHVlIC0gTmV3IHZhbHVlIGZvciB0aGUgbm9kZSwgb3IgbnVsbC5cbiAgICAgKiBAcGFyYW0gY29sb3IgLSBOZXcgY29sb3IgZm9yIHRoZSBub2RlLCBvciBudWxsLlxuICAgICAqIEBwYXJhbSBsZWZ0IC0gTmV3IGxlZnQgY2hpbGQgZm9yIHRoZSBub2RlLCBvciBudWxsLlxuICAgICAqIEBwYXJhbSByaWdodCAtIE5ldyByaWdodCBjaGlsZCBmb3IgdGhlIG5vZGUsIG9yIG51bGwuXG4gICAgICogQHJldHVybnMgVGhlIG5vZGUgY29weS5cbiAgICAgKi9cbiAgICBjb3B5KGtleSwgdmFsdWUsIGNvbG9yLCBsZWZ0LCByaWdodCkge1xuICAgICAgICByZXR1cm4gbmV3IExMUkJOb2RlKGtleSAhPSBudWxsID8ga2V5IDogdGhpcy5rZXksIHZhbHVlICE9IG51bGwgPyB2YWx1ZSA6IHRoaXMudmFsdWUsIGNvbG9yICE9IG51bGwgPyBjb2xvciA6IHRoaXMuY29sb3IsIGxlZnQgIT0gbnVsbCA/IGxlZnQgOiB0aGlzLmxlZnQsIHJpZ2h0ICE9IG51bGwgPyByaWdodCA6IHRoaXMucmlnaHQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBUaGUgdG90YWwgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSB0cmVlLlxuICAgICAqL1xuICAgIGNvdW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sZWZ0LmNvdW50KCkgKyAxICsgdGhpcy5yaWdodC5jb3VudCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB0cmVlIGlzIGVtcHR5LlxuICAgICAqL1xuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhdmVyc2VzIHRoZSB0cmVlIGluIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb25cbiAgICAgKiBmb3IgZWFjaCBub2RlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaFxuICAgICAqICAgbm9kZS4gIElmIGl0IHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuXG4gICAgICogQHJldHVybnMgVGhlIGZpcnN0IHRydXRoeSB2YWx1ZSByZXR1cm5lZCBieSBhY3Rpb24sIG9yIHRoZSBsYXN0IGZhbHNleVxuICAgICAqICAgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uXG4gICAgICovXG4gICAgaW5vcmRlclRyYXZlcnNhbChhY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLmxlZnQuaW5vcmRlclRyYXZlcnNhbChhY3Rpb24pIHx8XG4gICAgICAgICAgICAhIWFjdGlvbih0aGlzLmtleSwgdGhpcy52YWx1ZSkgfHxcbiAgICAgICAgICAgIHRoaXMucmlnaHQuaW5vcmRlclRyYXZlcnNhbChhY3Rpb24pKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhdmVyc2VzIHRoZSB0cmVlIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvblxuICAgICAqIGZvciBlYWNoIG5vZGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGZvciBlYWNoXG4gICAgICogbm9kZS4gIElmIGl0IHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0cmF2ZXJzYWwgd2FzIGFib3J0ZWQuXG4gICAgICovXG4gICAgcmV2ZXJzZVRyYXZlcnNhbChhY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuICh0aGlzLnJpZ2h0LnJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSB8fFxuICAgICAgICAgICAgYWN0aW9uKHRoaXMua2V5LCB0aGlzLnZhbHVlKSB8fFxuICAgICAgICAgICAgdGhpcy5sZWZ0LnJldmVyc2VUcmF2ZXJzYWwoYWN0aW9uKSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFRoZSBtaW5pbXVtIG5vZGUgaW4gdGhlIHRyZWUuXG4gICAgICovXG4gICAgbWluXygpIHtcbiAgICAgICAgaWYgKHRoaXMubGVmdC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubGVmdC5taW5fKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVGhlIG1heGltdW0ga2V5IGluIHRoZSB0cmVlLlxuICAgICAqL1xuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubWluXygpLmtleTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVGhlIG1heGltdW0ga2V5IGluIHRoZSB0cmVlLlxuICAgICAqL1xuICAgIG1heEtleSgpIHtcbiAgICAgICAgaWYgKHRoaXMucmlnaHQuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5rZXk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5yaWdodC5tYXhLZXkoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ga2V5IC0gS2V5IHRvIGluc2VydC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZSB0byBpbnNlcnQuXG4gICAgICogQHBhcmFtIGNvbXBhcmF0b3IgLSBDb21wYXJhdG9yLlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlLCB3aXRoIHRoZSBrZXkvdmFsdWUgYWRkZWQuXG4gICAgICovXG4gICAgaW5zZXJ0KGtleSwgdmFsdWUsIGNvbXBhcmF0b3IpIHtcbiAgICAgICAgbGV0IG4gPSB0aGlzO1xuICAgICAgICBjb25zdCBjbXAgPSBjb21wYXJhdG9yKGtleSwgbi5rZXkpO1xuICAgICAgICBpZiAoY21wIDwgMCkge1xuICAgICAgICAgICAgbiA9IG4uY29weShudWxsLCBudWxsLCBudWxsLCBuLmxlZnQuaW5zZXJ0KGtleSwgdmFsdWUsIGNvbXBhcmF0b3IpLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChjbXAgPT09IDApIHtcbiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgdmFsdWUsIG51bGwsIG51bGwsIG51bGwpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbiA9IG4uY29weShudWxsLCBudWxsLCBudWxsLCBudWxsLCBuLnJpZ2h0Lmluc2VydChrZXksIHZhbHVlLCBjb21wYXJhdG9yKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG4uZml4VXBfKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlLCB3aXRoIHRoZSBtaW5pbXVtIGtleSByZW1vdmVkLlxuICAgICAqL1xuICAgIHJlbW92ZU1pbl8oKSB7XG4gICAgICAgIGlmICh0aGlzLmxlZnQuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gU29ydGVkTWFwLkVNUFRZX05PREU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG4gPSB0aGlzO1xuICAgICAgICBpZiAoIW4ubGVmdC5pc1JlZF8oKSAmJiAhbi5sZWZ0LmxlZnQuaXNSZWRfKCkpIHtcbiAgICAgICAgICAgIG4gPSBuLm1vdmVSZWRMZWZ0XygpO1xuICAgICAgICB9XG4gICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbi5sZWZ0LnJlbW92ZU1pbl8oKSwgbnVsbCk7XG4gICAgICAgIHJldHVybiBuLmZpeFVwXygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0ga2V5IC0gVGhlIGtleSBvZiB0aGUgaXRlbSB0byByZW1vdmUuXG4gICAgICogQHBhcmFtIGNvbXBhcmF0b3IgLSBDb21wYXJhdG9yLlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlLCB3aXRoIHRoZSBzcGVjaWZpZWQgaXRlbSByZW1vdmVkLlxuICAgICAqL1xuICAgIHJlbW92ZShrZXksIGNvbXBhcmF0b3IpIHtcbiAgICAgICAgbGV0IG4sIHNtYWxsZXN0O1xuICAgICAgICBuID0gdGhpcztcbiAgICAgICAgaWYgKGNvbXBhcmF0b3Ioa2V5LCBuLmtleSkgPCAwKSB7XG4gICAgICAgICAgICBpZiAoIW4ubGVmdC5pc0VtcHR5KCkgJiYgIW4ubGVmdC5pc1JlZF8oKSAmJiAhbi5sZWZ0LmxlZnQuaXNSZWRfKCkpIHtcbiAgICAgICAgICAgICAgICBuID0gbi5tb3ZlUmVkTGVmdF8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbi5sZWZ0LnJlbW92ZShrZXksIGNvbXBhcmF0b3IpLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChuLmxlZnQuaXNSZWRfKCkpIHtcbiAgICAgICAgICAgICAgICBuID0gbi5yb3RhdGVSaWdodF8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbi5yaWdodC5pc0VtcHR5KCkgJiYgIW4ucmlnaHQuaXNSZWRfKCkgJiYgIW4ucmlnaHQubGVmdC5pc1JlZF8oKSkge1xuICAgICAgICAgICAgICAgIG4gPSBuLm1vdmVSZWRSaWdodF8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjb21wYXJhdG9yKGtleSwgbi5rZXkpID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKG4ucmlnaHQuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBTb3J0ZWRNYXAuRU1QVFlfTk9ERTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNtYWxsZXN0ID0gbi5yaWdodC5taW5fKCk7XG4gICAgICAgICAgICAgICAgICAgIG4gPSBuLmNvcHkoc21hbGxlc3Qua2V5LCBzbWFsbGVzdC52YWx1ZSwgbnVsbCwgbnVsbCwgbi5yaWdodC5yZW1vdmVNaW5fKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbi5yaWdodC5yZW1vdmUoa2V5LCBjb21wYXJhdG9yKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG4uZml4VXBfKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBpcyBhIFJFRCBub2RlLlxuICAgICAqL1xuICAgIGlzUmVkXygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY29sb3I7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlIGFmdGVyIHBlcmZvcm1pbmcgYW55IG5lZWRlZCByb3RhdGlvbnMuXG4gICAgICovXG4gICAgZml4VXBfKCkge1xuICAgICAgICBsZXQgbiA9IHRoaXM7XG4gICAgICAgIGlmIChuLnJpZ2h0LmlzUmVkXygpICYmICFuLmxlZnQuaXNSZWRfKCkpIHtcbiAgICAgICAgICAgIG4gPSBuLnJvdGF0ZUxlZnRfKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG4ubGVmdC5pc1JlZF8oKSAmJiBuLmxlZnQubGVmdC5pc1JlZF8oKSkge1xuICAgICAgICAgICAgbiA9IG4ucm90YXRlUmlnaHRfKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG4ubGVmdC5pc1JlZF8oKSAmJiBuLnJpZ2h0LmlzUmVkXygpKSB7XG4gICAgICAgICAgICBuID0gbi5jb2xvckZsaXBfKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlLCBhZnRlciBtb3ZlUmVkTGVmdC5cbiAgICAgKi9cbiAgICBtb3ZlUmVkTGVmdF8oKSB7XG4gICAgICAgIGxldCBuID0gdGhpcy5jb2xvckZsaXBfKCk7XG4gICAgICAgIGlmIChuLnJpZ2h0LmxlZnQuaXNSZWRfKCkpIHtcbiAgICAgICAgICAgIG4gPSBuLmNvcHkobnVsbCwgbnVsbCwgbnVsbCwgbnVsbCwgbi5yaWdodC5yb3RhdGVSaWdodF8oKSk7XG4gICAgICAgICAgICBuID0gbi5yb3RhdGVMZWZ0XygpO1xuICAgICAgICAgICAgbiA9IG4uY29sb3JGbGlwXygpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgYWZ0ZXIgbW92ZVJlZFJpZ2h0LlxuICAgICAqL1xuICAgIG1vdmVSZWRSaWdodF8oKSB7XG4gICAgICAgIGxldCBuID0gdGhpcy5jb2xvckZsaXBfKCk7XG4gICAgICAgIGlmIChuLmxlZnQubGVmdC5pc1JlZF8oKSkge1xuICAgICAgICAgICAgbiA9IG4ucm90YXRlUmlnaHRfKCk7XG4gICAgICAgICAgICBuID0gbi5jb2xvckZsaXBfKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG47XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlLCBhZnRlciByb3RhdGVMZWZ0LlxuICAgICAqL1xuICAgIHJvdGF0ZUxlZnRfKCkge1xuICAgICAgICBjb25zdCBubCA9IHRoaXMuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5SRUQsIG51bGwsIHRoaXMucmlnaHQubGVmdCk7XG4gICAgICAgIHJldHVybiB0aGlzLnJpZ2h0LmNvcHkobnVsbCwgbnVsbCwgdGhpcy5jb2xvciwgbmwsIG51bGwpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgYWZ0ZXIgcm90YXRlUmlnaHQuXG4gICAgICovXG4gICAgcm90YXRlUmlnaHRfKCkge1xuICAgICAgICBjb25zdCBuciA9IHRoaXMuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5SRUQsIHRoaXMubGVmdC5yaWdodCwgbnVsbCk7XG4gICAgICAgIHJldHVybiB0aGlzLmxlZnQuY29weShudWxsLCBudWxsLCB0aGlzLmNvbG9yLCBudWxsLCBucik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIE5ld3QgcmVlLCBhZnRlciBjb2xvckZsaXAuXG4gICAgICovXG4gICAgY29sb3JGbGlwXygpIHtcbiAgICAgICAgY29uc3QgbGVmdCA9IHRoaXMubGVmdC5jb3B5KG51bGwsIG51bGwsICF0aGlzLmxlZnQuY29sb3IsIG51bGwsIG51bGwpO1xuICAgICAgICBjb25zdCByaWdodCA9IHRoaXMucmlnaHQuY29weShudWxsLCBudWxsLCAhdGhpcy5yaWdodC5jb2xvciwgbnVsbCwgbnVsbCk7XG4gICAgICAgIHJldHVybiB0aGlzLmNvcHkobnVsbCwgbnVsbCwgIXRoaXMuY29sb3IsIGxlZnQsIHJpZ2h0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9yIHRlc3RpbmcuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIGFsbCBpcyB3ZWxsLlxuICAgICAqL1xuICAgIGNoZWNrTWF4RGVwdGhfKCkge1xuICAgICAgICBjb25zdCBibGFja0RlcHRoID0gdGhpcy5jaGVja18oKTtcbiAgICAgICAgcmV0dXJuIE1hdGgucG93KDIuMCwgYmxhY2tEZXB0aCkgPD0gdGhpcy5jb3VudCgpICsgMTtcbiAgICB9XG4gICAgY2hlY2tfKCkge1xuICAgICAgICBpZiAodGhpcy5pc1JlZF8oKSAmJiB0aGlzLmxlZnQuaXNSZWRfKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUmVkIG5vZGUgaGFzIHJlZCBjaGlsZCgnICsgdGhpcy5rZXkgKyAnLCcgKyB0aGlzLnZhbHVlICsgJyknKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5yaWdodC5pc1JlZF8oKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdSaWdodCBjaGlsZCBvZiAoJyArIHRoaXMua2V5ICsgJywnICsgdGhpcy52YWx1ZSArICcpIGlzIHJlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGJsYWNrRGVwdGggPSB0aGlzLmxlZnQuY2hlY2tfKCk7XG4gICAgICAgIGlmIChibGFja0RlcHRoICE9PSB0aGlzLnJpZ2h0LmNoZWNrXygpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0JsYWNrIGRlcHRocyBkaWZmZXInKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBibGFja0RlcHRoICsgKHRoaXMuaXNSZWRfKCkgPyAwIDogMSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5MTFJCTm9kZS5SRUQgPSB0cnVlO1xuTExSQk5vZGUuQkxBQ0sgPSBmYWxzZTtcbi8qKlxuICogUmVwcmVzZW50cyBhbiBlbXB0eSBub2RlIChhIGxlYWYgbm9kZSBpbiB0aGUgUmVkLUJsYWNrIFRyZWUpLlxuICovXG5jbGFzcyBMTFJCRW1wdHlOb2RlIHtcbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgY29weSBvZiB0aGUgY3VycmVudCBub2RlLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIG5vZGUgY29weS5cbiAgICAgKi9cbiAgICBjb3B5KGtleSwgdmFsdWUsIGNvbG9yLCBsZWZ0LCByaWdodCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIHRyZWUsIHdpdGggdGhlIHNwZWNpZmllZCBrZXkvdmFsdWUgYWRkZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ga2V5IC0gS2V5IHRvIGJlIGFkZGVkLlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFZhbHVlIHRvIGJlIGFkZGVkLlxuICAgICAqIEBwYXJhbSBjb21wYXJhdG9yIC0gQ29tcGFyYXRvci5cbiAgICAgKiBAcmV0dXJucyBOZXcgdHJlZSwgd2l0aCBpdGVtIGFkZGVkLlxuICAgICAqL1xuICAgIGluc2VydChrZXksIHZhbHVlLCBjb21wYXJhdG9yKSB7XG4gICAgICAgIHJldHVybiBuZXcgTExSQk5vZGUoa2V5LCB2YWx1ZSwgbnVsbCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgYSBjb3B5IG9mIHRoZSB0cmVlLCB3aXRoIHRoZSBzcGVjaWZpZWQga2V5IHJlbW92ZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ga2V5IC0gVGhlIGtleSB0byByZW1vdmUuXG4gICAgICogQHBhcmFtIGNvbXBhcmF0b3IgLSBDb21wYXJhdG9yLlxuICAgICAqIEByZXR1cm5zIE5ldyB0cmVlLCB3aXRoIGl0ZW0gcmVtb3ZlZC5cbiAgICAgKi9cbiAgICByZW1vdmUoa2V5LCBjb21wYXJhdG9yKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBUaGUgdG90YWwgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSB0cmVlLlxuICAgICAqL1xuICAgIGNvdW50KCkge1xuICAgICAgICByZXR1cm4gMDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0aGUgdHJlZSBpcyBlbXB0eS5cbiAgICAgKi9cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhdmVyc2VzIHRoZSB0cmVlIGluIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb25cbiAgICAgKiBmb3IgZWFjaCBub2RlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGFjdGlvbiAtIENhbGxiYWNrIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaFxuICAgICAqIG5vZGUuICBJZiBpdCByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgdHJhdmVyc2FsIHdhcyBhYm9ydGVkLlxuICAgICAqL1xuICAgIGlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhdmVyc2VzIHRoZSB0cmVlIGluIHJldmVyc2Uga2V5IG9yZGVyIGFuZCBjYWxscyB0aGUgc3BlY2lmaWVkIGFjdGlvbiBmdW5jdGlvblxuICAgICAqIGZvciBlYWNoIG5vZGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkIGZvciBlYWNoXG4gICAgICogbm9kZS4gIElmIGl0IHJldHVybnMgdHJ1ZSwgdHJhdmVyc2FsIGlzIGFib3J0ZWQuXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiB0cmF2ZXJzYWwgd2FzIGFib3J0ZWQuXG4gICAgICovXG4gICAgcmV2ZXJzZVRyYXZlcnNhbChhY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBtaW5LZXkoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBtYXhLZXkoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjaGVja18oKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBXaGV0aGVyIHRoaXMgbm9kZSBpcyByZWQuXG4gICAgICovXG4gICAgaXNSZWRfKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuLyoqXG4gKiBBbiBpbW11dGFibGUgc29ydGVkIG1hcCBpbXBsZW1lbnRhdGlvbiwgYmFzZWQgb24gYSBMZWZ0LWxlYW5pbmcgUmVkLUJsYWNrXG4gKiB0cmVlLlxuICovXG5jbGFzcyBTb3J0ZWRNYXAge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBjb21wYXJhdG9yXyAtIEtleSBjb21wYXJhdG9yLlxuICAgICAqIEBwYXJhbSByb290XyAtIE9wdGlvbmFsIHJvb3Qgbm9kZSBmb3IgdGhlIG1hcC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihjb21wYXJhdG9yXywgcm9vdF8gPSBTb3J0ZWRNYXAuRU1QVFlfTk9ERSkge1xuICAgICAgICB0aGlzLmNvbXBhcmF0b3JfID0gY29tcGFyYXRvcl87XG4gICAgICAgIHRoaXMucm9vdF8gPSByb290XztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIG1hcCwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleS92YWx1ZSBhZGRlZCBvciByZXBsYWNlZC5cbiAgICAgKiAoVE9ETzogV2Ugc2hvdWxkIHBlcmhhcHMgcmVuYW1lIHRoaXMgbWV0aG9kIHRvICdwdXQnKVxuICAgICAqXG4gICAgICogQHBhcmFtIGtleSAtIEtleSB0byBiZSBhZGRlZC5cbiAgICAgKiBAcGFyYW0gdmFsdWUgLSBWYWx1ZSB0byBiZSBhZGRlZC5cbiAgICAgKiBAcmV0dXJucyBOZXcgbWFwLCB3aXRoIGl0ZW0gYWRkZWQuXG4gICAgICovXG4gICAgaW5zZXJ0KGtleSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yXywgdGhpcy5yb290X1xuICAgICAgICAgICAgLmluc2VydChrZXksIHZhbHVlLCB0aGlzLmNvbXBhcmF0b3JfKVxuICAgICAgICAgICAgLmNvcHkobnVsbCwgbnVsbCwgTExSQk5vZGUuQkxBQ0ssIG51bGwsIG51bGwpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyBhIGNvcHkgb2YgdGhlIG1hcCwgd2l0aCB0aGUgc3BlY2lmaWVkIGtleSByZW1vdmVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIGtleSAtIFRoZSBrZXkgdG8gcmVtb3ZlLlxuICAgICAqIEByZXR1cm5zIE5ldyBtYXAsIHdpdGggaXRlbSByZW1vdmVkLlxuICAgICAqL1xuICAgIHJlbW92ZShrZXkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAodGhpcy5jb21wYXJhdG9yXywgdGhpcy5yb290X1xuICAgICAgICAgICAgLnJlbW92ZShrZXksIHRoaXMuY29tcGFyYXRvcl8pXG4gICAgICAgICAgICAuY29weShudWxsLCBudWxsLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbm9kZSB3aXRoIHRoZSBnaXZlbiBrZXksIG9yIG51bGwuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ga2V5IC0gVGhlIGtleSB0byBsb29rIHVwLlxuICAgICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBvZiB0aGUgbm9kZSB3aXRoIHRoZSBnaXZlbiBrZXksIG9yIG51bGwgaWYgdGhlXG4gICAgICoga2V5IGRvZXNuJ3QgZXhpc3QuXG4gICAgICovXG4gICAgZ2V0KGtleSkge1xuICAgICAgICBsZXQgY21wO1xuICAgICAgICBsZXQgbm9kZSA9IHRoaXMucm9vdF87XG4gICAgICAgIHdoaWxlICghbm9kZS5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGNtcCA9IHRoaXMuY29tcGFyYXRvcl8oa2V5LCBub2RlLmtleSk7XG4gICAgICAgICAgICBpZiAoY21wID09PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG5vZGUudmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjbXAgPCAwKSB7XG4gICAgICAgICAgICAgICAgbm9kZSA9IG5vZGUubGVmdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA+IDApIHtcbiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0aGUga2V5IG9mIHRoZSBpdGVtICpiZWZvcmUqIHRoZSBzcGVjaWZpZWQga2V5LCBvciBudWxsIGlmIGtleSBpcyB0aGUgZmlyc3QgaXRlbS5cbiAgICAgKiBAcGFyYW0ga2V5IC0gVGhlIGtleSB0byBmaW5kIHRoZSBwcmVkZWNlc3NvciBvZlxuICAgICAqIEByZXR1cm5zIFRoZSBwcmVkZWNlc3NvciBrZXkuXG4gICAgICovXG4gICAgZ2V0UHJlZGVjZXNzb3JLZXkoa2V5KSB7XG4gICAgICAgIGxldCBjbXAsIG5vZGUgPSB0aGlzLnJvb3RfLCByaWdodFBhcmVudCA9IG51bGw7XG4gICAgICAgIHdoaWxlICghbm9kZS5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGNtcCA9IHRoaXMuY29tcGFyYXRvcl8oa2V5LCBub2RlLmtleSk7XG4gICAgICAgICAgICBpZiAoY21wID09PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFub2RlLmxlZnQuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLmxlZnQ7XG4gICAgICAgICAgICAgICAgICAgIHdoaWxlICghbm9kZS5yaWdodC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5vZGUgPSBub2RlLnJpZ2h0O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBub2RlLmtleTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAocmlnaHRQYXJlbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJpZ2h0UGFyZW50LmtleTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsOyAvLyBmaXJzdCBpdGVtLlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNtcCA8IDApIHtcbiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5sZWZ0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY21wID4gMCkge1xuICAgICAgICAgICAgICAgIHJpZ2h0UGFyZW50ID0gbm9kZTtcbiAgICAgICAgICAgICAgICBub2RlID0gbm9kZS5yaWdodDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0F0dGVtcHRlZCB0byBmaW5kIHByZWRlY2Vzc29yIGtleSBmb3IgYSBub25leGlzdGVudCBrZXkuICBXaGF0IGdpdmVzPycpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSBtYXAgaXMgZW1wdHkuXG4gICAgICovXG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdF8uaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBUaGUgdG90YWwgbnVtYmVyIG9mIG5vZGVzIGluIHRoZSBtYXAuXG4gICAgICovXG4gICAgY291bnQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3RfLmNvdW50KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFRoZSBtaW5pbXVtIGtleSBpbiB0aGUgbWFwLlxuICAgICAqL1xuICAgIG1pbktleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdF8ubWluS2V5KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFRoZSBtYXhpbXVtIGtleSBpbiB0aGUgbWFwLlxuICAgICAqL1xuICAgIG1heEtleSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdF8ubWF4S2V5KCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRyYXZlcnNlcyB0aGUgbWFwIGluIGtleSBvcmRlciBhbmQgY2FsbHMgdGhlIHNwZWNpZmllZCBhY3Rpb24gZnVuY3Rpb25cbiAgICAgKiBmb3IgZWFjaCBrZXkvdmFsdWUgcGFpci5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhY3Rpb24gLSBDYWxsYmFjayBmdW5jdGlvbiB0byBiZSBjYWxsZWRcbiAgICAgKiBmb3IgZWFjaCBrZXkvdmFsdWUgcGFpci4gIElmIGFjdGlvbiByZXR1cm5zIHRydWUsIHRyYXZlcnNhbCBpcyBhYm9ydGVkLlxuICAgICAqIEByZXR1cm5zIFRoZSBmaXJzdCB0cnV0aHkgdmFsdWUgcmV0dXJuZWQgYnkgYWN0aW9uLCBvciB0aGUgbGFzdCBmYWxzZXlcbiAgICAgKiAgIHZhbHVlIHJldHVybmVkIGJ5IGFjdGlvblxuICAgICAqL1xuICAgIGlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnJvb3RfLmlub3JkZXJUcmF2ZXJzYWwoYWN0aW9uKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJhdmVyc2VzIHRoZSBtYXAgaW4gcmV2ZXJzZSBrZXkgb3JkZXIgYW5kIGNhbGxzIHRoZSBzcGVjaWZpZWQgYWN0aW9uIGZ1bmN0aW9uXG4gICAgICogZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gYWN0aW9uIC0gQ2FsbGJhY2sgZnVuY3Rpb24gdG8gYmUgY2FsbGVkXG4gICAgICogZm9yIGVhY2gga2V5L3ZhbHVlIHBhaXIuICBJZiBhY3Rpb24gcmV0dXJucyB0cnVlLCB0cmF2ZXJzYWwgaXMgYWJvcnRlZC5cbiAgICAgKiBAcmV0dXJucyBUcnVlIGlmIHRoZSB0cmF2ZXJzYWwgd2FzIGFib3J0ZWQuXG4gICAgICovXG4gICAgcmV2ZXJzZVRyYXZlcnNhbChhY3Rpb24pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucm9vdF8ucmV2ZXJzZVRyYXZlcnNhbChhY3Rpb24pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGFuIGl0ZXJhdG9yIG92ZXIgdGhlIFNvcnRlZE1hcC5cbiAgICAgKiBAcmV0dXJucyBUaGUgaXRlcmF0b3IuXG4gICAgICovXG4gICAgZ2V0SXRlcmF0b3IocmVzdWx0R2VuZXJhdG9yKSB7XG4gICAgICAgIHJldHVybiBuZXcgU29ydGVkTWFwSXRlcmF0b3IodGhpcy5yb290XywgbnVsbCwgdGhpcy5jb21wYXJhdG9yXywgZmFsc2UsIHJlc3VsdEdlbmVyYXRvcik7XG4gICAgfVxuICAgIGdldEl0ZXJhdG9yRnJvbShrZXksIHJlc3VsdEdlbmVyYXRvcikge1xuICAgICAgICByZXR1cm4gbmV3IFNvcnRlZE1hcEl0ZXJhdG9yKHRoaXMucm9vdF8sIGtleSwgdGhpcy5jb21wYXJhdG9yXywgZmFsc2UsIHJlc3VsdEdlbmVyYXRvcik7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvckZyb20oa2V5LCByZXN1bHRHZW5lcmF0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3RfLCBrZXksIHRoaXMuY29tcGFyYXRvcl8sIHRydWUsIHJlc3VsdEdlbmVyYXRvcik7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvcihyZXN1bHRHZW5lcmF0b3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXBJdGVyYXRvcih0aGlzLnJvb3RfLCBudWxsLCB0aGlzLmNvbXBhcmF0b3JfLCB0cnVlLCByZXN1bHRHZW5lcmF0b3IpO1xuICAgIH1cbn1cbi8qKlxuICogQWx3YXlzIHVzZSB0aGUgc2FtZSBlbXB0eSBub2RlLCB0byByZWR1Y2UgbWVtb3J5LlxuICovXG5Tb3J0ZWRNYXAuRU1QVFlfTk9ERSA9IG5ldyBMTFJCRW1wdHlOb2RlKCk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBOQU1FX09OTFlfQ09NUEFSQVRPUihsZWZ0LCByaWdodCkge1xuICAgIHJldHVybiBuYW1lQ29tcGFyZShsZWZ0Lm5hbWUsIHJpZ2h0Lm5hbWUpO1xufVxuZnVuY3Rpb24gTkFNRV9DT01QQVJBVE9SKGxlZnQsIHJpZ2h0KSB7XG4gICAgcmV0dXJuIG5hbWVDb21wYXJlKGxlZnQsIHJpZ2h0KTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBNQVhfTk9ERSQyO1xuZnVuY3Rpb24gc2V0TWF4Tm9kZSQxKHZhbCkge1xuICAgIE1BWF9OT0RFJDIgPSB2YWw7XG59XG5jb25zdCBwcmlvcml0eUhhc2hUZXh0ID0gZnVuY3Rpb24gKHByaW9yaXR5KSB7XG4gICAgaWYgKHR5cGVvZiBwcmlvcml0eSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgcmV0dXJuICdudW1iZXI6JyArIGRvdWJsZVRvSUVFRTc1NFN0cmluZyhwcmlvcml0eSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gJ3N0cmluZzonICsgcHJpb3JpdHk7XG4gICAgfVxufTtcbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgYSBwcmlvcml0eSBzbmFwc2hvdCBOb2RlIGlzIHZhbGlkLlxuICovXG5jb25zdCB2YWxpZGF0ZVByaW9yaXR5Tm9kZSA9IGZ1bmN0aW9uIChwcmlvcml0eU5vZGUpIHtcbiAgICBpZiAocHJpb3JpdHlOb2RlLmlzTGVhZk5vZGUoKSkge1xuICAgICAgICBjb25zdCB2YWwgPSBwcmlvcml0eU5vZGUudmFsKCk7XG4gICAgICAgIGFzc2VydCh0eXBlb2YgdmFsID09PSAnc3RyaW5nJyB8fFxuICAgICAgICAgICAgdHlwZW9mIHZhbCA9PT0gJ251bWJlcicgfHxcbiAgICAgICAgICAgICh0eXBlb2YgdmFsID09PSAnb2JqZWN0JyAmJiBjb250YWlucyh2YWwsICcuc3YnKSksICdQcmlvcml0eSBtdXN0IGJlIGEgc3RyaW5nIG9yIG51bWJlci4nKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGFzc2VydChwcmlvcml0eU5vZGUgPT09IE1BWF9OT0RFJDIgfHwgcHJpb3JpdHlOb2RlLmlzRW1wdHkoKSwgJ3ByaW9yaXR5IG9mIHVuZXhwZWN0ZWQgdHlwZS4nKTtcbiAgICB9XG4gICAgLy8gRG9uJ3QgY2FsbCBnZXRQcmlvcml0eSgpIG9uIE1BWF9OT0RFIHRvIGF2b2lkIGhpdHRpbmcgYXNzZXJ0aW9uLlxuICAgIGFzc2VydChwcmlvcml0eU5vZGUgPT09IE1BWF9OT0RFJDIgfHwgcHJpb3JpdHlOb2RlLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpLCBcIlByaW9yaXR5IG5vZGVzIGNhbid0IGhhdmUgYSBwcmlvcml0eSBvZiB0aGVpciBvd24uXCIpO1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yO1xuLyoqXG4gKiBMZWFmTm9kZSBpcyBhIGNsYXNzIGZvciBzdG9yaW5nIGxlYWYgbm9kZXMgaW4gYSBEYXRhU25hcHNob3QuICBJdFxuICogaW1wbGVtZW50cyBOb2RlIGFuZCBzdG9yZXMgdGhlIHZhbHVlIG9mIHRoZSBub2RlIChhIHN0cmluZyxcbiAqIG51bWJlciwgb3IgYm9vbGVhbikgYWNjZXNzaWJsZSB2aWEgZ2V0VmFsdWUoKS5cbiAqL1xuY2xhc3MgTGVhZk5vZGUge1xuICAgIHN0YXRpYyBzZXQgX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvcih2YWwpIHtcbiAgICAgICAgX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3RvciA9IHZhbDtcbiAgICB9XG4gICAgc3RhdGljIGdldCBfX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yKCkge1xuICAgICAgICByZXR1cm4gX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3RvcjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHZhbHVlXyAtIFRoZSB2YWx1ZSB0byBzdG9yZSBpbiB0aGlzIGxlYWYgbm9kZS4gVGhlIG9iamVjdCB0eXBlIGlzXG4gICAgICogcG9zc2libGUgaW4gdGhlIGV2ZW50IG9mIGEgZGVmZXJyZWQgdmFsdWVcbiAgICAgKiBAcGFyYW0gcHJpb3JpdHlOb2RlXyAtIFRoZSBwcmlvcml0eSBvZiB0aGlzIG5vZGUuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IodmFsdWVfLCBwcmlvcml0eU5vZGVfID0gTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFKSB7XG4gICAgICAgIHRoaXMudmFsdWVfID0gdmFsdWVfO1xuICAgICAgICB0aGlzLnByaW9yaXR5Tm9kZV8gPSBwcmlvcml0eU5vZGVfO1xuICAgICAgICB0aGlzLmxhenlIYXNoXyA9IG51bGw7XG4gICAgICAgIGFzc2VydCh0aGlzLnZhbHVlXyAhPT0gdW5kZWZpbmVkICYmIHRoaXMudmFsdWVfICE9PSBudWxsLCBcIkxlYWZOb2RlIHNob3VsZG4ndCBiZSBjcmVhdGVkIHdpdGggbnVsbC91bmRlZmluZWQgdmFsdWUuXCIpO1xuICAgICAgICB2YWxpZGF0ZVByaW9yaXR5Tm9kZSh0aGlzLnByaW9yaXR5Tm9kZV8pO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBpc0xlYWZOb2RlKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgZ2V0UHJpb3JpdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV87XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIHVwZGF0ZVByaW9yaXR5KG5ld1ByaW9yaXR5Tm9kZSkge1xuICAgICAgICByZXR1cm4gbmV3IExlYWZOb2RlKHRoaXMudmFsdWVfLCBuZXdQcmlvcml0eU5vZGUpO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHtcbiAgICAgICAgLy8gSGFjayB0byB0cmVhdCBwcmlvcml0eSBhcyBhIHJlZ3VsYXIgY2hpbGRcbiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnByaW9yaXR5Tm9kZV87XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIGdldENoaWxkKHBhdGgpIHtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXRoR2V0RnJvbnQocGF0aCkgPT09ICcucHJpb3JpdHknKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5wcmlvcml0eU5vZGVfO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIExlYWZOb2RlLl9fY2hpbGRyZW5Ob2RlQ29uc3RydWN0b3IuRU1QVFlfTk9ERTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYXNDaGlsZCgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBnZXRQcmVkZWNlc3NvckNoaWxkTmFtZShjaGlsZE5hbWUsIGNoaWxkTm9kZSkge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgdXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpIHtcbiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZVByaW9yaXR5KG5ld0NoaWxkTm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSAmJiBjaGlsZE5hbWUgIT09ICcucHJpb3JpdHknKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBMZWFmTm9kZS5fX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yLkVNUFRZX05PREUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lLCBuZXdDaGlsZE5vZGUpLnVwZGF0ZVByaW9yaXR5KHRoaXMucHJpb3JpdHlOb2RlXyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgdXBkYXRlQ2hpbGQocGF0aCwgbmV3Q2hpbGROb2RlKSB7XG4gICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHBhdGgpO1xuICAgICAgICBpZiAoZnJvbnQgPT09IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXdDaGlsZE5vZGU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSAmJiBmcm9udCAhPT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXNzZXJ0KGZyb250ICE9PSAnLnByaW9yaXR5JyB8fCBwYXRoR2V0TGVuZ3RoKHBhdGgpID09PSAxLCAnLnByaW9yaXR5IG11c3QgYmUgdGhlIGxhc3QgdG9rZW4gaW4gYSBwYXRoJyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy51cGRhdGVJbW1lZGlhdGVDaGlsZChmcm9udCwgTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvci5FTVBUWV9OT0RFLnVwZGF0ZUNoaWxkKHBhdGhQb3BGcm9udChwYXRoKSwgbmV3Q2hpbGROb2RlKSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBudW1DaGlsZHJlbigpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIGZvckVhY2hDaGlsZChpbmRleCwgYWN0aW9uKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgdmFsKGV4cG9ydEZvcm1hdCkge1xuICAgICAgICBpZiAoZXhwb3J0Rm9ybWF0ICYmICF0aGlzLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgICcudmFsdWUnOiB0aGlzLmdldFZhbHVlKCksXG4gICAgICAgICAgICAgICAgJy5wcmlvcml0eSc6IHRoaXMuZ2V0UHJpb3JpdHkoKS52YWwoKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFZhbHVlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgaGFzaCgpIHtcbiAgICAgICAgaWYgKHRoaXMubGF6eUhhc2hfID09PSBudWxsKSB7XG4gICAgICAgICAgICBsZXQgdG9IYXNoID0gJyc7XG4gICAgICAgICAgICBpZiAoIXRoaXMucHJpb3JpdHlOb2RlXy5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICB0b0hhc2ggKz1cbiAgICAgICAgICAgICAgICAgICAgJ3ByaW9yaXR5OicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJpb3JpdHlIYXNoVGV4dCh0aGlzLnByaW9yaXR5Tm9kZV8udmFsKCkpICtcbiAgICAgICAgICAgICAgICAgICAgICAgICc6JztcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHR5cGUgPSB0eXBlb2YgdGhpcy52YWx1ZV87XG4gICAgICAgICAgICB0b0hhc2ggKz0gdHlwZSArICc6JztcbiAgICAgICAgICAgIGlmICh0eXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgICAgICAgIHRvSGFzaCArPSBkb3VibGVUb0lFRUU3NTRTdHJpbmcodGhpcy52YWx1ZV8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdG9IYXNoICs9IHRoaXMudmFsdWVfO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5sYXp5SGFzaF8gPSBzaGExKHRvSGFzaCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubGF6eUhhc2hfO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRoZSB2YWx1ZSBvZiB0aGUgbGVhZiBub2RlLlxuICAgICAqIEByZXR1cm5zIFRoZSB2YWx1ZSBvZiB0aGUgbm9kZS5cbiAgICAgKi9cbiAgICBnZXRWYWx1ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudmFsdWVfO1xuICAgIH1cbiAgICBjb21wYXJlVG8ob3RoZXIpIHtcbiAgICAgICAgaWYgKG90aGVyID09PSBMZWFmTm9kZS5fX2NoaWxkcmVuTm9kZUNvbnN0cnVjdG9yLkVNUFRZX05PREUpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG90aGVyIGluc3RhbmNlb2YgTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3Rvcikge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgYXNzZXJ0KG90aGVyLmlzTGVhZk5vZGUoKSwgJ1Vua25vd24gbm9kZSB0eXBlJyk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jb21wYXJlVG9MZWFmTm9kZV8ob3RoZXIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENvbXBhcmlzb24gc3BlY2lmaWNhbGx5IGZvciB0d28gbGVhZiBub2Rlc1xuICAgICAqL1xuICAgIGNvbXBhcmVUb0xlYWZOb2RlXyhvdGhlckxlYWYpIHtcbiAgICAgICAgY29uc3Qgb3RoZXJMZWFmVHlwZSA9IHR5cGVvZiBvdGhlckxlYWYudmFsdWVfO1xuICAgICAgICBjb25zdCB0aGlzTGVhZlR5cGUgPSB0eXBlb2YgdGhpcy52YWx1ZV87XG4gICAgICAgIGNvbnN0IG90aGVySW5kZXggPSBMZWFmTm9kZS5WQUxVRV9UWVBFX09SREVSLmluZGV4T2Yob3RoZXJMZWFmVHlwZSk7XG4gICAgICAgIGNvbnN0IHRoaXNJbmRleCA9IExlYWZOb2RlLlZBTFVFX1RZUEVfT1JERVIuaW5kZXhPZih0aGlzTGVhZlR5cGUpO1xuICAgICAgICBhc3NlcnQob3RoZXJJbmRleCA+PSAwLCAnVW5rbm93biBsZWFmIHR5cGU6ICcgKyBvdGhlckxlYWZUeXBlKTtcbiAgICAgICAgYXNzZXJ0KHRoaXNJbmRleCA+PSAwLCAnVW5rbm93biBsZWFmIHR5cGU6ICcgKyB0aGlzTGVhZlR5cGUpO1xuICAgICAgICBpZiAob3RoZXJJbmRleCA9PT0gdGhpc0luZGV4KSB7XG4gICAgICAgICAgICAvLyBTYW1lIHR5cGUsIGNvbXBhcmUgdmFsdWVzXG4gICAgICAgICAgICBpZiAodGhpc0xlYWZUeXBlID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIC8vIERlZmVycmVkIHZhbHVlIG5vZGVzIGFyZSBhbGwgZXF1YWwsIGJ1dCB3ZSBzaG91bGQgYWxzbyBuZXZlciBnZXQgdG8gdGhpcyBwb2ludC4uLlxuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgd29ya3MgYmVjYXVzZSB0cnVlID4gZmFsc2UsIGFsbCBvdGhlcnMgYXJlIG51bWJlciBvciBzdHJpbmcgY29tcGFyaXNvbnNcbiAgICAgICAgICAgICAgICBpZiAodGhpcy52YWx1ZV8gPCBvdGhlckxlYWYudmFsdWVfKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodGhpcy52YWx1ZV8gPT09IG90aGVyTGVhZi52YWx1ZV8pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpc0luZGV4IC0gb3RoZXJJbmRleDtcbiAgICAgICAgfVxuICAgIH1cbiAgICB3aXRoSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICBpc0luZGV4ZWQoKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlcXVhbHMob3RoZXIpIHtcbiAgICAgICAgaWYgKG90aGVyID09PSB0aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChvdGhlci5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IG90aGVyTGVhZiA9IG90aGVyO1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLnZhbHVlXyA9PT0gb3RoZXJMZWFmLnZhbHVlXyAmJlxuICAgICAgICAgICAgICAgIHRoaXMucHJpb3JpdHlOb2RlXy5lcXVhbHMob3RoZXJMZWFmLnByaW9yaXR5Tm9kZV8pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogVGhlIHNvcnQgb3JkZXIgZm9yIGNvbXBhcmluZyBsZWFmIG5vZGVzIG9mIGRpZmZlcmVudCB0eXBlcy4gSWYgdHdvIGxlYWYgbm9kZXMgaGF2ZVxuICogdGhlIHNhbWUgdHlwZSwgdGhlIGNvbXBhcmlzb24gZmFsbHMgYmFjayB0byB0aGVpciB2YWx1ZVxuICovXG5MZWFmTm9kZS5WQUxVRV9UWVBFX09SREVSID0gWydvYmplY3QnLCAnYm9vbGVhbicsICdudW1iZXInLCAnc3RyaW5nJ107XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5sZXQgbm9kZUZyb21KU09OJDE7XG5sZXQgTUFYX05PREUkMTtcbmZ1bmN0aW9uIHNldE5vZGVGcm9tSlNPTih2YWwpIHtcbiAgICBub2RlRnJvbUpTT04kMSA9IHZhbDtcbn1cbmZ1bmN0aW9uIHNldE1heE5vZGUodmFsKSB7XG4gICAgTUFYX05PREUkMSA9IHZhbDtcbn1cbmNsYXNzIFByaW9yaXR5SW5kZXggZXh0ZW5kcyBJbmRleCB7XG4gICAgY29tcGFyZShhLCBiKSB7XG4gICAgICAgIGNvbnN0IGFQcmlvcml0eSA9IGEubm9kZS5nZXRQcmlvcml0eSgpO1xuICAgICAgICBjb25zdCBiUHJpb3JpdHkgPSBiLm5vZGUuZ2V0UHJpb3JpdHkoKTtcbiAgICAgICAgY29uc3QgaW5kZXhDbXAgPSBhUHJpb3JpdHkuY29tcGFyZVRvKGJQcmlvcml0eSk7XG4gICAgICAgIGlmIChpbmRleENtcCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hbWVDb21wYXJlKGEubmFtZSwgYi5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpbmRleENtcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0RlZmluZWRPbihub2RlKSB7XG4gICAgICAgIHJldHVybiAhbm9kZS5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgaW5kZXhlZFZhbHVlQ2hhbmdlZChvbGROb2RlLCBuZXdOb2RlKSB7XG4gICAgICAgIHJldHVybiAhb2xkTm9kZS5nZXRQcmlvcml0eSgpLmVxdWFscyhuZXdOb2RlLmdldFByaW9yaXR5KCkpO1xuICAgIH1cbiAgICBtaW5Qb3N0KCkge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICByZXR1cm4gTmFtZWROb2RlLk1JTjtcbiAgICB9XG4gICAgbWF4UG9zdCgpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUoTUFYX05BTUUsIG5ldyBMZWFmTm9kZSgnW1BSSU9SSVRZLVBPU1RdJywgTUFYX05PREUkMSkpO1xuICAgIH1cbiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7XG4gICAgICAgIGNvbnN0IHByaW9yaXR5Tm9kZSA9IG5vZGVGcm9tSlNPTiQxKGluZGV4VmFsdWUpO1xuICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShuYW1lLCBuZXcgTGVhZk5vZGUoJ1tQUklPUklUWS1QT1NUXScsIHByaW9yaXR5Tm9kZSkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBTdHJpbmcgcmVwcmVzZW50YXRpb24gZm9yIGluY2x1c2lvbiBpbiBhIHF1ZXJ5IHNwZWNcbiAgICAgKi9cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuICcucHJpb3JpdHknO1xuICAgIH1cbn1cbmNvbnN0IFBSSU9SSVRZX0lOREVYID0gbmV3IFByaW9yaXR5SW5kZXgoKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IExPR18yID0gTWF0aC5sb2coMik7XG5jbGFzcyBCYXNlMTJOdW0ge1xuICAgIGNvbnN0cnVjdG9yKGxlbmd0aCkge1xuICAgICAgICBjb25zdCBsb2dCYXNlMiA9IChudW0pID0+IFxuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICBwYXJzZUludCgoTWF0aC5sb2cobnVtKSAvIExPR18yKSwgMTApO1xuICAgICAgICBjb25zdCBiaXRNYXNrID0gKGJpdHMpID0+IHBhcnNlSW50KEFycmF5KGJpdHMgKyAxKS5qb2luKCcxJyksIDIpO1xuICAgICAgICB0aGlzLmNvdW50ID0gbG9nQmFzZTIobGVuZ3RoICsgMSk7XG4gICAgICAgIHRoaXMuY3VycmVudF8gPSB0aGlzLmNvdW50IC0gMTtcbiAgICAgICAgY29uc3QgbWFzayA9IGJpdE1hc2sodGhpcy5jb3VudCk7XG4gICAgICAgIHRoaXMuYml0c18gPSAobGVuZ3RoICsgMSkgJiBtYXNrO1xuICAgIH1cbiAgICBuZXh0Qml0SXNPbmUoKSB7XG4gICAgICAgIC8vbm9pbnNwZWN0aW9uIEpTQml0d2lzZU9wZXJhdG9yVXNhZ2VcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gISh0aGlzLmJpdHNfICYgKDB4MSA8PCB0aGlzLmN1cnJlbnRfKSk7XG4gICAgICAgIHRoaXMuY3VycmVudF8tLTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG59XG4vKipcbiAqIFRha2VzIGEgbGlzdCBvZiBjaGlsZCBub2RlcyBhbmQgY29uc3RydWN0cyBhIFNvcnRlZFNldCB1c2luZyB0aGUgZ2l2ZW4gY29tcGFyaXNvblxuICogZnVuY3Rpb25cbiAqXG4gKiBVc2VzIHRoZSBhbGdvcml0aG0gZGVzY3JpYmVkIGluIHRoZSBwYXBlciBsaW5rZWQgaGVyZTpcbiAqIGh0dHA6Ly9jaXRlc2VlcnguaXN0LnBzdS5lZHUvdmlld2RvYy9zdW1tYXJ5P2RvaT0xMC4xLjEuNDYuMTQ1OFxuICpcbiAqIEBwYXJhbSBjaGlsZExpc3QgLSBVbnNvcnRlZCBsaXN0IG9mIGNoaWxkcmVuXG4gKiBAcGFyYW0gY21wIC0gVGhlIGNvbXBhcmlzb24gbWV0aG9kIHRvIGJlIHVzZWRcbiAqIEBwYXJhbSBrZXlGbiAtIEFuIG9wdGlvbmFsIGZ1bmN0aW9uIHRvIGV4dHJhY3QgSyBmcm9tIGEgbm9kZSB3cmFwcGVyLCBpZiBLJ3NcbiAqIHR5cGUgaXMgbm90IE5hbWVkTm9kZVxuICogQHBhcmFtIG1hcFNvcnRGbiAtIEFuIG9wdGlvbmFsIG92ZXJyaWRlIGZvciBjb21wYXJhdG9yIHVzZWQgYnkgdGhlIGdlbmVyYXRlZCBzb3J0ZWQgbWFwXG4gKi9cbmNvbnN0IGJ1aWxkQ2hpbGRTZXQgPSBmdW5jdGlvbiAoY2hpbGRMaXN0LCBjbXAsIGtleUZuLCBtYXBTb3J0Rm4pIHtcbiAgICBjaGlsZExpc3Quc29ydChjbXApO1xuICAgIGNvbnN0IGJ1aWxkQmFsYW5jZWRUcmVlID0gZnVuY3Rpb24gKGxvdywgaGlnaCkge1xuICAgICAgICBjb25zdCBsZW5ndGggPSBoaWdoIC0gbG93O1xuICAgICAgICBsZXQgbmFtZWROb2RlO1xuICAgICAgICBsZXQga2V5O1xuICAgICAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIG5hbWVkTm9kZSA9IGNoaWxkTGlzdFtsb3ddO1xuICAgICAgICAgICAga2V5ID0ga2V5Rm4gPyBrZXlGbihuYW1lZE5vZGUpIDogbmFtZWROb2RlO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXksIG5hbWVkTm9kZS5ub2RlLCBMTFJCTm9kZS5CTEFDSywgbnVsbCwgbnVsbCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgY29uc3QgbWlkZGxlID0gcGFyc2VJbnQoKGxlbmd0aCAvIDIpLCAxMCkgKyBsb3c7XG4gICAgICAgICAgICBjb25zdCBsZWZ0ID0gYnVpbGRCYWxhbmNlZFRyZWUobG93LCBtaWRkbGUpO1xuICAgICAgICAgICAgY29uc3QgcmlnaHQgPSBidWlsZEJhbGFuY2VkVHJlZShtaWRkbGUgKyAxLCBoaWdoKTtcbiAgICAgICAgICAgIG5hbWVkTm9kZSA9IGNoaWxkTGlzdFttaWRkbGVdO1xuICAgICAgICAgICAga2V5ID0ga2V5Rm4gPyBrZXlGbihuYW1lZE5vZGUpIDogbmFtZWROb2RlO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBMTFJCTm9kZShrZXksIG5hbWVkTm9kZS5ub2RlLCBMTFJCTm9kZS5CTEFDSywgbGVmdCwgcmlnaHQpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBidWlsZEZyb20xMkFycmF5ID0gZnVuY3Rpb24gKGJhc2UxMikge1xuICAgICAgICBsZXQgbm9kZSA9IG51bGw7XG4gICAgICAgIGxldCByb290ID0gbnVsbDtcbiAgICAgICAgbGV0IGluZGV4ID0gY2hpbGRMaXN0Lmxlbmd0aDtcbiAgICAgICAgY29uc3QgYnVpbGRQZW5uYW50ID0gZnVuY3Rpb24gKGNodW5rU2l6ZSwgY29sb3IpIHtcbiAgICAgICAgICAgIGNvbnN0IGxvdyA9IGluZGV4IC0gY2h1bmtTaXplO1xuICAgICAgICAgICAgY29uc3QgaGlnaCA9IGluZGV4O1xuICAgICAgICAgICAgaW5kZXggLT0gY2h1bmtTaXplO1xuICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gYnVpbGRCYWxhbmNlZFRyZWUobG93ICsgMSwgaGlnaCk7XG4gICAgICAgICAgICBjb25zdCBuYW1lZE5vZGUgPSBjaGlsZExpc3RbbG93XTtcbiAgICAgICAgICAgIGNvbnN0IGtleSA9IGtleUZuID8ga2V5Rm4obmFtZWROb2RlKSA6IG5hbWVkTm9kZTtcbiAgICAgICAgICAgIGF0dGFjaFBlbm5hbnQobmV3IExMUkJOb2RlKGtleSwgbmFtZWROb2RlLm5vZGUsIGNvbG9yLCBudWxsLCBjaGlsZFRyZWUpKTtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgYXR0YWNoUGVubmFudCA9IGZ1bmN0aW9uIChwZW5uYW50KSB7XG4gICAgICAgICAgICBpZiAobm9kZSkge1xuICAgICAgICAgICAgICAgIG5vZGUubGVmdCA9IHBlbm5hbnQ7XG4gICAgICAgICAgICAgICAgbm9kZSA9IHBlbm5hbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByb290ID0gcGVubmFudDtcbiAgICAgICAgICAgICAgICBub2RlID0gcGVubmFudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBiYXNlMTIuY291bnQ7ICsraSkge1xuICAgICAgICAgICAgY29uc3QgaXNPbmUgPSBiYXNlMTIubmV4dEJpdElzT25lKCk7XG4gICAgICAgICAgICAvLyBUaGUgbnVtYmVyIG9mIG5vZGVzIHRha2VuIGluIGVhY2ggc2xpY2UgaXMgMl4oYXJyLmxlbmd0aCAtIChpICsgMSkpXG4gICAgICAgICAgICBjb25zdCBjaHVua1NpemUgPSBNYXRoLnBvdygyLCBiYXNlMTIuY291bnQgLSAoaSArIDEpKTtcbiAgICAgICAgICAgIGlmIChpc09uZSkge1xuICAgICAgICAgICAgICAgIGJ1aWxkUGVubmFudChjaHVua1NpemUsIExMUkJOb2RlLkJMQUNLKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGN1cnJlbnQgPT0gMlxuICAgICAgICAgICAgICAgIGJ1aWxkUGVubmFudChjaHVua1NpemUsIExMUkJOb2RlLkJMQUNLKTtcbiAgICAgICAgICAgICAgICBidWlsZFBlbm5hbnQoY2h1bmtTaXplLCBMTFJCTm9kZS5SRUQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByb290O1xuICAgIH07XG4gICAgY29uc3QgYmFzZTEyID0gbmV3IEJhc2UxMk51bShjaGlsZExpc3QubGVuZ3RoKTtcbiAgICBjb25zdCByb290ID0gYnVpbGRGcm9tMTJBcnJheShiYXNlMTIpO1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgcmV0dXJuIG5ldyBTb3J0ZWRNYXAobWFwU29ydEZuIHx8IGNtcCwgcm9vdCk7XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xubGV0IF9kZWZhdWx0SW5kZXhNYXA7XG5jb25zdCBmYWxsYmFja09iamVjdCA9IHt9O1xuY2xhc3MgSW5kZXhNYXAge1xuICAgIC8qKlxuICAgICAqIFRoZSBkZWZhdWx0IEluZGV4TWFwIGZvciBub2RlcyB3aXRob3V0IGEgcHJpb3JpdHlcbiAgICAgKi9cbiAgICBzdGF0aWMgZ2V0IERlZmF1bHQoKSB7XG4gICAgICAgIGFzc2VydChmYWxsYmFja09iamVjdCAmJiBQUklPUklUWV9JTkRFWCwgJ0NoaWxkcmVuTm9kZS50cyBoYXMgbm90IGJlZW4gbG9hZGVkJyk7XG4gICAgICAgIF9kZWZhdWx0SW5kZXhNYXAgPVxuICAgICAgICAgICAgX2RlZmF1bHRJbmRleE1hcCB8fFxuICAgICAgICAgICAgICAgIG5ldyBJbmRleE1hcCh7ICcucHJpb3JpdHknOiBmYWxsYmFja09iamVjdCB9LCB7ICcucHJpb3JpdHknOiBQUklPUklUWV9JTkRFWCB9KTtcbiAgICAgICAgcmV0dXJuIF9kZWZhdWx0SW5kZXhNYXA7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKGluZGV4ZXNfLCBpbmRleFNldF8pIHtcbiAgICAgICAgdGhpcy5pbmRleGVzXyA9IGluZGV4ZXNfO1xuICAgICAgICB0aGlzLmluZGV4U2V0XyA9IGluZGV4U2V0XztcbiAgICB9XG4gICAgZ2V0KGluZGV4S2V5KSB7XG4gICAgICAgIGNvbnN0IHNvcnRlZE1hcCA9IHNhZmVHZXQodGhpcy5pbmRleGVzXywgaW5kZXhLZXkpO1xuICAgICAgICBpZiAoIXNvcnRlZE1hcCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBpbmRleCBkZWZpbmVkIGZvciAnICsgaW5kZXhLZXkpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChzb3J0ZWRNYXAgaW5zdGFuY2VvZiBTb3J0ZWRNYXApIHtcbiAgICAgICAgICAgIHJldHVybiBzb3J0ZWRNYXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBUaGUgaW5kZXggZXhpc3RzLCBidXQgaXQgZmFsbHMgYmFjayB0byBqdXN0IG5hbWUgY29tcGFyaXNvbi4gUmV0dXJuIG51bGwgc28gdGhhdCB0aGUgY2FsbGluZyBjb2RlIHVzZXMgdGhlXG4gICAgICAgICAgICAvLyByZWd1bGFyIGNoaWxkIG1hcFxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFzSW5kZXgoaW5kZXhEZWZpbml0aW9uKSB7XG4gICAgICAgIHJldHVybiBjb250YWlucyh0aGlzLmluZGV4U2V0XywgaW5kZXhEZWZpbml0aW9uLnRvU3RyaW5nKCkpO1xuICAgIH1cbiAgICBhZGRJbmRleChpbmRleERlZmluaXRpb24sIGV4aXN0aW5nQ2hpbGRyZW4pIHtcbiAgICAgICAgYXNzZXJ0KGluZGV4RGVmaW5pdGlvbiAhPT0gS0VZX0lOREVYLCBcIktleUluZGV4IGFsd2F5cyBleGlzdHMgYW5kIGlzbid0IG1lYW50IHRvIGJlIGFkZGVkIHRvIHRoZSBJbmRleE1hcC5cIik7XG4gICAgICAgIGNvbnN0IGNoaWxkTGlzdCA9IFtdO1xuICAgICAgICBsZXQgc2F3SW5kZXhlZFZhbHVlID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IGl0ZXIgPSBleGlzdGluZ0NoaWxkcmVuLmdldEl0ZXJhdG9yKE5hbWVkTm9kZS5XcmFwKTtcbiAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTtcbiAgICAgICAgd2hpbGUgKG5leHQpIHtcbiAgICAgICAgICAgIHNhd0luZGV4ZWRWYWx1ZSA9XG4gICAgICAgICAgICAgICAgc2F3SW5kZXhlZFZhbHVlIHx8IGluZGV4RGVmaW5pdGlvbi5pc0RlZmluZWRPbihuZXh0Lm5vZGUpO1xuICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmV4dCk7XG4gICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IG5ld0luZGV4O1xuICAgICAgICBpZiAoc2F3SW5kZXhlZFZhbHVlKSB7XG4gICAgICAgICAgICBuZXdJbmRleCA9IGJ1aWxkQ2hpbGRTZXQoY2hpbGRMaXN0LCBpbmRleERlZmluaXRpb24uZ2V0Q29tcGFyZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5ld0luZGV4ID0gZmFsbGJhY2tPYmplY3Q7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgaW5kZXhOYW1lID0gaW5kZXhEZWZpbml0aW9uLnRvU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IG5ld0luZGV4U2V0ID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbmRleFNldF8pO1xuICAgICAgICBuZXdJbmRleFNldFtpbmRleE5hbWVdID0gaW5kZXhEZWZpbml0aW9uO1xuICAgICAgICBjb25zdCBuZXdJbmRleGVzID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5pbmRleGVzXyk7XG4gICAgICAgIG5ld0luZGV4ZXNbaW5kZXhOYW1lXSA9IG5ld0luZGV4O1xuICAgICAgICByZXR1cm4gbmV3IEluZGV4TWFwKG5ld0luZGV4ZXMsIG5ld0luZGV4U2V0KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5zdXJlIHRoYXQgdGhpcyBub2RlIGlzIHByb3Blcmx5IHRyYWNrZWQgaW4gYW55IGluZGV4ZXMgdGhhdCB3ZSdyZSBtYWludGFpbmluZ1xuICAgICAqL1xuICAgIGFkZFRvSW5kZXhlcyhuYW1lZE5vZGUsIGV4aXN0aW5nQ2hpbGRyZW4pIHtcbiAgICAgICAgY29uc3QgbmV3SW5kZXhlcyA9IG1hcCh0aGlzLmluZGV4ZXNfLCAoaW5kZXhlZENoaWxkcmVuLCBpbmRleE5hbWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc2FmZUdldCh0aGlzLmluZGV4U2V0XywgaW5kZXhOYW1lKTtcbiAgICAgICAgICAgIGFzc2VydChpbmRleCwgJ01pc3NpbmcgaW5kZXggaW1wbGVtZW50YXRpb24gZm9yICcgKyBpbmRleE5hbWUpO1xuICAgICAgICAgICAgaWYgKGluZGV4ZWRDaGlsZHJlbiA9PT0gZmFsbGJhY2tPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAvLyBDaGVjayB0byBzZWUgaWYgd2UgbmVlZCB0byBpbmRleCBldmVyeXRoaW5nXG4gICAgICAgICAgICAgICAgaWYgKGluZGV4LmlzRGVmaW5lZE9uKG5hbWVkTm9kZS5ub2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBuZWVkIHRvIGJ1aWxkIHRoaXMgaW5kZXhcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGRMaXN0ID0gW107XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZXIgPSBleGlzdGluZ0NoaWxkcmVuLmdldEl0ZXJhdG9yKE5hbWVkTm9kZS5XcmFwKTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgd2hpbGUgKG5leHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXh0Lm5hbWUgIT09IG5hbWVkTm9kZS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2hpbGRMaXN0LnB1c2gobmFtZWROb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJ1aWxkQ2hpbGRTZXQoY2hpbGRMaXN0LCBpbmRleC5nZXRDb21wYXJlKCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm8gY2hhbmdlLCB0aGlzIHJlbWFpbnMgYSBmYWxsYmFja1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsbGJhY2tPYmplY3Q7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdTbmFwID0gZXhpc3RpbmdDaGlsZHJlbi5nZXQobmFtZWROb2RlLm5hbWUpO1xuICAgICAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbiA9IGluZGV4ZWRDaGlsZHJlbjtcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdTbmFwKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gbmV3Q2hpbGRyZW4ucmVtb3ZlKG5ldyBOYW1lZE5vZGUobmFtZWROb2RlLm5hbWUsIGV4aXN0aW5nU25hcCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3Q2hpbGRyZW4uaW5zZXJ0KG5hbWVkTm9kZSwgbmFtZWROb2RlLm5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIG5ldyBJbmRleE1hcChuZXdJbmRleGVzLCB0aGlzLmluZGV4U2V0Xyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENyZWF0ZSBhIG5ldyBJbmRleE1hcCBpbnN0YW5jZSB3aXRoIHRoZSBnaXZlbiB2YWx1ZSByZW1vdmVkXG4gICAgICovXG4gICAgcmVtb3ZlRnJvbUluZGV4ZXMobmFtZWROb2RlLCBleGlzdGluZ0NoaWxkcmVuKSB7XG4gICAgICAgIGNvbnN0IG5ld0luZGV4ZXMgPSBtYXAodGhpcy5pbmRleGVzXywgKGluZGV4ZWRDaGlsZHJlbikgPT4ge1xuICAgICAgICAgICAgaWYgKGluZGV4ZWRDaGlsZHJlbiA9PT0gZmFsbGJhY2tPYmplY3QpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGlzIHRoZSBmYWxsYmFjay4gSnVzdCByZXR1cm4gaXQsIG5vdGhpbmcgdG8gZG8gaW4gdGhpcyBjYXNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWRDaGlsZHJlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nU25hcCA9IGV4aXN0aW5nQ2hpbGRyZW4uZ2V0KG5hbWVkTm9kZS5uYW1lKTtcbiAgICAgICAgICAgICAgICBpZiAoZXhpc3RpbmdTbmFwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpbmRleGVkQ2hpbGRyZW4ucmVtb3ZlKG5ldyBOYW1lZE5vZGUobmFtZWROb2RlLm5hbWUsIGV4aXN0aW5nU25hcCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gTm8gcmVjb3JkIG9mIHRoaXMgY2hpbGRcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluZGV4ZWRDaGlsZHJlbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbmV3IEluZGV4TWFwKG5ld0luZGV4ZXMsIHRoaXMuaW5kZXhTZXRfKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vLyBUT0RPOiBGb3IgbWVtb3J5IHNhdmluZ3MsIGRvbid0IHN0b3JlIHByaW9yaXR5Tm9kZV8gaWYgaXQncyBlbXB0eS5cbmxldCBFTVBUWV9OT0RFO1xuLyoqXG4gKiBDaGlsZHJlbk5vZGUgaXMgYSBjbGFzcyBmb3Igc3RvcmluZyBpbnRlcm5hbCBub2RlcyBpbiBhIERhdGFTbmFwc2hvdFxuICogKGkuZS4gbm9kZXMgd2l0aCBjaGlsZHJlbikuICBJdCBpbXBsZW1lbnRzIE5vZGUgYW5kIHN0b3JlcyB0aGVcbiAqIGxpc3Qgb2YgY2hpbGRyZW4gaW4gdGhlIGNoaWxkcmVuIHByb3BlcnR5LCBzb3J0ZWQgYnkgY2hpbGQgbmFtZS5cbiAqL1xuY2xhc3MgQ2hpbGRyZW5Ob2RlIHtcbiAgICBzdGF0aWMgZ2V0IEVNUFRZX05PREUoKSB7XG4gICAgICAgIHJldHVybiAoRU1QVFlfTk9ERSB8fFxuICAgICAgICAgICAgKEVNUFRZX05PREUgPSBuZXcgQ2hpbGRyZW5Ob2RlKG5ldyBTb3J0ZWRNYXAoTkFNRV9DT01QQVJBVE9SKSwgbnVsbCwgSW5kZXhNYXAuRGVmYXVsdCkpKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHBhcmFtIGNoaWxkcmVuXyAtIExpc3Qgb2YgY2hpbGRyZW4gb2YgdGhpcyBub2RlLi5cbiAgICAgKiBAcGFyYW0gcHJpb3JpdHlOb2RlXyAtIFRoZSBwcmlvcml0eSBvZiB0aGlzIG5vZGUgKGFzIGEgc25hcHNob3Qgbm9kZSkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoY2hpbGRyZW5fLCBwcmlvcml0eU5vZGVfLCBpbmRleE1hcF8pIHtcbiAgICAgICAgdGhpcy5jaGlsZHJlbl8gPSBjaGlsZHJlbl87XG4gICAgICAgIHRoaXMucHJpb3JpdHlOb2RlXyA9IHByaW9yaXR5Tm9kZV87XG4gICAgICAgIHRoaXMuaW5kZXhNYXBfID0gaW5kZXhNYXBfO1xuICAgICAgICB0aGlzLmxhenlIYXNoXyA9IG51bGw7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBOb3RlOiBUaGUgb25seSByZWFzb24gd2UgYWxsb3cgbnVsbCBwcmlvcml0eSBpcyBmb3IgRU1QVFlfTk9ERSwgc2luY2Ugd2UgY2FuJ3QgdXNlXG4gICAgICAgICAqIEVNUFRZX05PREUgYXMgdGhlIHByaW9yaXR5IG9mIEVNUFRZX05PREUuICBXZSBtaWdodCB3YW50IHRvIGNvbnNpZGVyIG1ha2luZyBFTVBUWV9OT0RFIGl0cyBvd25cbiAgICAgICAgICogY2xhc3MgaW5zdGVhZCBvZiBhbiBlbXB0eSBDaGlsZHJlbk5vZGUuXG4gICAgICAgICAqL1xuICAgICAgICBpZiAodGhpcy5wcmlvcml0eU5vZGVfKSB7XG4gICAgICAgICAgICB2YWxpZGF0ZVByaW9yaXR5Tm9kZSh0aGlzLnByaW9yaXR5Tm9kZV8pO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNoaWxkcmVuXy5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIGFzc2VydCghdGhpcy5wcmlvcml0eU5vZGVfIHx8IHRoaXMucHJpb3JpdHlOb2RlXy5pc0VtcHR5KCksICdBbiBlbXB0eSBub2RlIGNhbm5vdCBoYXZlIGEgcHJpb3JpdHknKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBpc0xlYWZOb2RlKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIGdldFByaW9yaXR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmlvcml0eU5vZGVfIHx8IEVNUFRZX05PREU7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIHVwZGF0ZVByaW9yaXR5KG5ld1ByaW9yaXR5Tm9kZSkge1xuICAgICAgICBpZiAodGhpcy5jaGlsZHJlbl8uaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAvLyBEb24ndCBhbGxvdyBwcmlvcml0aWVzIG9uIGVtcHR5IG5vZGVzXG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKHRoaXMuY2hpbGRyZW5fLCBuZXdQcmlvcml0eU5vZGUsIHRoaXMuaW5kZXhNYXBfKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHtcbiAgICAgICAgLy8gSGFjayB0byB0cmVhdCBwcmlvcml0eSBhcyBhIHJlZ3VsYXIgY2hpbGRcbiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmdldFByaW9yaXR5KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW5fLmdldChjaGlsZE5hbWUpO1xuICAgICAgICAgICAgcmV0dXJuIGNoaWxkID09PSBudWxsID8gRU1QVFlfTk9ERSA6IGNoaWxkO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIGdldENoaWxkKHBhdGgpIHtcbiAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocGF0aCk7XG4gICAgICAgIGlmIChmcm9udCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0SW1tZWRpYXRlQ2hpbGQoZnJvbnQpLmdldENoaWxkKHBhdGhQb3BGcm9udChwYXRoKSk7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIGhhc0NoaWxkKGNoaWxkTmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8uZ2V0KGNoaWxkTmFtZSkgIT09IG51bGw7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIHVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbmV3Q2hpbGROb2RlKSB7XG4gICAgICAgIGFzc2VydChuZXdDaGlsZE5vZGUsICdXZSBzaG91bGQgYWx3YXlzIGJlIHBhc3Npbmcgc25hcHNob3Qgbm9kZXMnKTtcbiAgICAgICAgaWYgKGNoaWxkTmFtZSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZVByaW9yaXR5KG5ld0NoaWxkTm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBuYW1lZE5vZGUgPSBuZXcgTmFtZWROb2RlKGNoaWxkTmFtZSwgbmV3Q2hpbGROb2RlKTtcbiAgICAgICAgICAgIGxldCBuZXdDaGlsZHJlbiwgbmV3SW5kZXhNYXA7XG4gICAgICAgICAgICBpZiAobmV3Q2hpbGROb2RlLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbl8ucmVtb3ZlKGNoaWxkTmFtZSk7XG4gICAgICAgICAgICAgICAgbmV3SW5kZXhNYXAgPSB0aGlzLmluZGV4TWFwXy5yZW1vdmVGcm9tSW5kZXhlcyhuYW1lZE5vZGUsIHRoaXMuY2hpbGRyZW5fKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbl8uaW5zZXJ0KGNoaWxkTmFtZSwgbmV3Q2hpbGROb2RlKTtcbiAgICAgICAgICAgICAgICBuZXdJbmRleE1hcCA9IHRoaXMuaW5kZXhNYXBfLmFkZFRvSW5kZXhlcyhuYW1lZE5vZGUsIHRoaXMuY2hpbGRyZW5fKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IG5ld1ByaW9yaXR5ID0gbmV3Q2hpbGRyZW4uaXNFbXB0eSgpXG4gICAgICAgICAgICAgICAgPyBFTVBUWV9OT0RFXG4gICAgICAgICAgICAgICAgOiB0aGlzLnByaW9yaXR5Tm9kZV87XG4gICAgICAgICAgICByZXR1cm4gbmV3IENoaWxkcmVuTm9kZShuZXdDaGlsZHJlbiwgbmV3UHJpb3JpdHksIG5ld0luZGV4TWFwKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICB1cGRhdGVDaGlsZChwYXRoLCBuZXdDaGlsZE5vZGUpIHtcbiAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocGF0aCk7XG4gICAgICAgIGlmIChmcm9udCA9PT0gbnVsbCkge1xuICAgICAgICAgICAgcmV0dXJuIG5ld0NoaWxkTm9kZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFzc2VydChwYXRoR2V0RnJvbnQocGF0aCkgIT09ICcucHJpb3JpdHknIHx8IHBhdGhHZXRMZW5ndGgocGF0aCkgPT09IDEsICcucHJpb3JpdHkgbXVzdCBiZSB0aGUgbGFzdCB0b2tlbiBpbiBhIHBhdGgnKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0ltbWVkaWF0ZUNoaWxkID0gdGhpcy5nZXRJbW1lZGlhdGVDaGlsZChmcm9udCkudXBkYXRlQ2hpbGQocGF0aFBvcEZyb250KHBhdGgpLCBuZXdDaGlsZE5vZGUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMudXBkYXRlSW1tZWRpYXRlQ2hpbGQoZnJvbnQsIG5ld0ltbWVkaWF0ZUNoaWxkKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBpc0VtcHR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8uaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBudW1DaGlsZHJlbigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2hpbGRyZW5fLmNvdW50KCk7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIHZhbChleHBvcnRGb3JtYXQpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvYmogPSB7fTtcbiAgICAgICAgbGV0IG51bUtleXMgPSAwLCBtYXhLZXkgPSAwLCBhbGxJbnRlZ2VyS2V5cyA9IHRydWU7XG4gICAgICAgIHRoaXMuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgICAgIG9ialtrZXldID0gY2hpbGROb2RlLnZhbChleHBvcnRGb3JtYXQpO1xuICAgICAgICAgICAgbnVtS2V5cysrO1xuICAgICAgICAgICAgaWYgKGFsbEludGVnZXJLZXlzICYmIENoaWxkcmVuTm9kZS5JTlRFR0VSX1JFR0VYUF8udGVzdChrZXkpKSB7XG4gICAgICAgICAgICAgICAgbWF4S2V5ID0gTWF0aC5tYXgobWF4S2V5LCBOdW1iZXIoa2V5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBhbGxJbnRlZ2VyS2V5cyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKCFleHBvcnRGb3JtYXQgJiYgYWxsSW50ZWdlcktleXMgJiYgbWF4S2V5IDwgMiAqIG51bUtleXMpIHtcbiAgICAgICAgICAgIC8vIGNvbnZlcnQgdG8gYXJyYXkuXG4gICAgICAgICAgICBjb25zdCBhcnJheSA9IFtdO1xuICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGd1YXJkLWZvci1pblxuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gb2JqKSB7XG4gICAgICAgICAgICAgICAgYXJyYXlba2V5XSA9IG9ialtrZXldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGFycmF5O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKGV4cG9ydEZvcm1hdCAmJiAhdGhpcy5nZXRQcmlvcml0eSgpLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIG9ialsnLnByaW9yaXR5J10gPSB0aGlzLmdldFByaW9yaXR5KCkudmFsKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gb2JqO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIGhhc2goKSB7XG4gICAgICAgIGlmICh0aGlzLmxhenlIYXNoXyA9PT0gbnVsbCkge1xuICAgICAgICAgICAgbGV0IHRvSGFzaCA9ICcnO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgdG9IYXNoICs9XG4gICAgICAgICAgICAgICAgICAgICdwcmlvcml0eTonICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByaW9yaXR5SGFzaFRleHQodGhpcy5nZXRQcmlvcml0eSgpLnZhbCgpKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAnOic7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZvckVhY2hDaGlsZChQUklPUklUWV9JTkRFWCwgKGtleSwgY2hpbGROb2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGRIYXNoID0gY2hpbGROb2RlLmhhc2goKTtcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGRIYXNoICE9PSAnJykge1xuICAgICAgICAgICAgICAgICAgICB0b0hhc2ggKz0gJzonICsga2V5ICsgJzonICsgY2hpbGRIYXNoO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhpcy5sYXp5SGFzaF8gPSB0b0hhc2ggPT09ICcnID8gJycgOiBzaGExKHRvSGFzaCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubGF6eUhhc2hfO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBnZXRQcmVkZWNlc3NvckNoaWxkTmFtZShjaGlsZE5hbWUsIGNoaWxkTm9kZSwgaW5kZXgpIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5yZXNvbHZlSW5kZXhfKGluZGV4KTtcbiAgICAgICAgaWYgKGlkeCkge1xuICAgICAgICAgICAgY29uc3QgcHJlZGVjZXNzb3IgPSBpZHguZ2V0UHJlZGVjZXNzb3JLZXkobmV3IE5hbWVkTm9kZShjaGlsZE5hbWUsIGNoaWxkTm9kZSkpO1xuICAgICAgICAgICAgcmV0dXJuIHByZWRlY2Vzc29yID8gcHJlZGVjZXNzb3IubmFtZSA6IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8uZ2V0UHJlZGVjZXNzb3JLZXkoY2hpbGROYW1lKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRGaXJzdENoaWxkTmFtZShpbmRleERlZmluaXRpb24pIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5yZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbik7XG4gICAgICAgIGlmIChpZHgpIHtcbiAgICAgICAgICAgIGNvbnN0IG1pbktleSA9IGlkeC5taW5LZXkoKTtcbiAgICAgICAgICAgIHJldHVybiBtaW5LZXkgJiYgbWluS2V5Lm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8ubWluS2V5KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0Rmlyc3RDaGlsZChpbmRleERlZmluaXRpb24pIHtcbiAgICAgICAgY29uc3QgbWluS2V5ID0gdGhpcy5nZXRGaXJzdENoaWxkTmFtZShpbmRleERlZmluaXRpb24pO1xuICAgICAgICBpZiAobWluS2V5KSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IE5hbWVkTm9kZShtaW5LZXksIHRoaXMuY2hpbGRyZW5fLmdldChtaW5LZXkpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdpdmVuIGFuIGluZGV4LCByZXR1cm4gdGhlIGtleSBuYW1lIG9mIHRoZSBsYXJnZXN0IHZhbHVlIHdlIGhhdmUsIGFjY29yZGluZyB0byB0aGF0IGluZGV4XG4gICAgICovXG4gICAgZ2V0TGFzdENoaWxkTmFtZShpbmRleERlZmluaXRpb24pIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5yZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbik7XG4gICAgICAgIGlmIChpZHgpIHtcbiAgICAgICAgICAgIGNvbnN0IG1heEtleSA9IGlkeC5tYXhLZXkoKTtcbiAgICAgICAgICAgIHJldHVybiBtYXhLZXkgJiYgbWF4S2V5Lm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5jaGlsZHJlbl8ubWF4S2V5KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0TGFzdENoaWxkKGluZGV4RGVmaW5pdGlvbikge1xuICAgICAgICBjb25zdCBtYXhLZXkgPSB0aGlzLmdldExhc3RDaGlsZE5hbWUoaW5kZXhEZWZpbml0aW9uKTtcbiAgICAgICAgaWYgKG1heEtleSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUobWF4S2V5LCB0aGlzLmNoaWxkcmVuXy5nZXQobWF4S2V5KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmb3JFYWNoQ2hpbGQoaW5kZXgsIGFjdGlvbikge1xuICAgICAgICBjb25zdCBpZHggPSB0aGlzLnJlc29sdmVJbmRleF8oaW5kZXgpO1xuICAgICAgICBpZiAoaWR4KSB7XG4gICAgICAgICAgICByZXR1cm4gaWR4Lmlub3JkZXJUcmF2ZXJzYWwod3JhcHBlZE5vZGUgPT4ge1xuICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24od3JhcHBlZE5vZGUubmFtZSwgd3JhcHBlZE5vZGUubm9kZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmNoaWxkcmVuXy5pbm9yZGVyVHJhdmVyc2FsKGFjdGlvbik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0SXRlcmF0b3IoaW5kZXhEZWZpbml0aW9uKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmdldEl0ZXJhdG9yRnJvbShpbmRleERlZmluaXRpb24ubWluUG9zdCgpLCBpbmRleERlZmluaXRpb24pO1xuICAgIH1cbiAgICBnZXRJdGVyYXRvckZyb20oc3RhcnRQb3N0LCBpbmRleERlZmluaXRpb24pIHtcbiAgICAgICAgY29uc3QgaWR4ID0gdGhpcy5yZXNvbHZlSW5kZXhfKGluZGV4RGVmaW5pdGlvbik7XG4gICAgICAgIGlmIChpZHgpIHtcbiAgICAgICAgICAgIHJldHVybiBpZHguZ2V0SXRlcmF0b3JGcm9tKHN0YXJ0UG9zdCwga2V5ID0+IGtleSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpdGVyYXRvciA9IHRoaXMuY2hpbGRyZW5fLmdldEl0ZXJhdG9yRnJvbShzdGFydFBvc3QubmFtZSwgTmFtZWROb2RlLldyYXApO1xuICAgICAgICAgICAgbGV0IG5leHQgPSBpdGVyYXRvci5wZWVrKCk7XG4gICAgICAgICAgICB3aGlsZSAobmV4dCAhPSBudWxsICYmIGluZGV4RGVmaW5pdGlvbi5jb21wYXJlKG5leHQsIHN0YXJ0UG9zdCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3IuZ2V0TmV4dCgpO1xuICAgICAgICAgICAgICAgIG5leHQgPSBpdGVyYXRvci5wZWVrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaXRlcmF0b3I7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0UmV2ZXJzZUl0ZXJhdG9yKGluZGV4RGVmaW5pdGlvbikge1xuICAgICAgICByZXR1cm4gdGhpcy5nZXRSZXZlcnNlSXRlcmF0b3JGcm9tKGluZGV4RGVmaW5pdGlvbi5tYXhQb3N0KCksIGluZGV4RGVmaW5pdGlvbik7XG4gICAgfVxuICAgIGdldFJldmVyc2VJdGVyYXRvckZyb20oZW5kUG9zdCwgaW5kZXhEZWZpbml0aW9uKSB7XG4gICAgICAgIGNvbnN0IGlkeCA9IHRoaXMucmVzb2x2ZUluZGV4XyhpbmRleERlZmluaXRpb24pO1xuICAgICAgICBpZiAoaWR4KSB7XG4gICAgICAgICAgICByZXR1cm4gaWR4LmdldFJldmVyc2VJdGVyYXRvckZyb20oZW5kUG9zdCwga2V5ID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4ga2V5O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBpdGVyYXRvciA9IHRoaXMuY2hpbGRyZW5fLmdldFJldmVyc2VJdGVyYXRvckZyb20oZW5kUG9zdC5uYW1lLCBOYW1lZE5vZGUuV3JhcCk7XG4gICAgICAgICAgICBsZXQgbmV4dCA9IGl0ZXJhdG9yLnBlZWsoKTtcbiAgICAgICAgICAgIHdoaWxlIChuZXh0ICE9IG51bGwgJiYgaW5kZXhEZWZpbml0aW9uLmNvbXBhcmUobmV4dCwgZW5kUG9zdCkgPiAwKSB7XG4gICAgICAgICAgICAgICAgaXRlcmF0b3IuZ2V0TmV4dCgpO1xuICAgICAgICAgICAgICAgIG5leHQgPSBpdGVyYXRvci5wZWVrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaXRlcmF0b3I7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY29tcGFyZVRvKG90aGVyKSB7XG4gICAgICAgIGlmICh0aGlzLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgaWYgKG90aGVyLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG90aGVyLmlzTGVhZk5vZGUoKSB8fCBvdGhlci5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKG90aGVyID09PSBNQVhfTk9ERSkge1xuICAgICAgICAgICAgcmV0dXJuIC0xO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gTXVzdCBiZSBhbm90aGVyIG5vZGUgd2l0aCBjaGlsZHJlbi5cbiAgICAgICAgICAgIHJldHVybiAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHdpdGhJbmRleChpbmRleERlZmluaXRpb24pIHtcbiAgICAgICAgaWYgKGluZGV4RGVmaW5pdGlvbiA9PT0gS0VZX0lOREVYIHx8XG4gICAgICAgICAgICB0aGlzLmluZGV4TWFwXy5oYXNJbmRleChpbmRleERlZmluaXRpb24pKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0luZGV4TWFwID0gdGhpcy5pbmRleE1hcF8uYWRkSW5kZXgoaW5kZXhEZWZpbml0aW9uLCB0aGlzLmNoaWxkcmVuXyk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENoaWxkcmVuTm9kZSh0aGlzLmNoaWxkcmVuXywgdGhpcy5wcmlvcml0eU5vZGVfLCBuZXdJbmRleE1hcCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaXNJbmRleGVkKGluZGV4KSB7XG4gICAgICAgIHJldHVybiBpbmRleCA9PT0gS0VZX0lOREVYIHx8IHRoaXMuaW5kZXhNYXBfLmhhc0luZGV4KGluZGV4KTtcbiAgICB9XG4gICAgZXF1YWxzKG90aGVyKSB7XG4gICAgICAgIGlmIChvdGhlciA9PT0gdGhpcykge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAob3RoZXIuaXNMZWFmTm9kZSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBvdGhlckNoaWxkcmVuTm9kZSA9IG90aGVyO1xuICAgICAgICAgICAgaWYgKCF0aGlzLmdldFByaW9yaXR5KCkuZXF1YWxzKG90aGVyQ2hpbGRyZW5Ob2RlLmdldFByaW9yaXR5KCkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5jaGlsZHJlbl8uY291bnQoKSA9PT0gb3RoZXJDaGlsZHJlbk5vZGUuY2hpbGRyZW5fLmNvdW50KCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCB0aGlzSXRlciA9IHRoaXMuZ2V0SXRlcmF0b3IoUFJJT1JJVFlfSU5ERVgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IG90aGVySXRlciA9IG90aGVyQ2hpbGRyZW5Ob2RlLmdldEl0ZXJhdG9yKFBSSU9SSVRZX0lOREVYKTtcbiAgICAgICAgICAgICAgICBsZXQgdGhpc0N1cnJlbnQgPSB0aGlzSXRlci5nZXROZXh0KCk7XG4gICAgICAgICAgICAgICAgbGV0IG90aGVyQ3VycmVudCA9IG90aGVySXRlci5nZXROZXh0KCk7XG4gICAgICAgICAgICAgICAgd2hpbGUgKHRoaXNDdXJyZW50ICYmIG90aGVyQ3VycmVudCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpc0N1cnJlbnQubmFtZSAhPT0gb3RoZXJDdXJyZW50Lm5hbWUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICF0aGlzQ3VycmVudC5ub2RlLmVxdWFscyhvdGhlckN1cnJlbnQubm9kZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aGlzQ3VycmVudCA9IHRoaXNJdGVyLmdldE5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgb3RoZXJDdXJyZW50ID0gb3RoZXJJdGVyLmdldE5leHQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXNDdXJyZW50ID09PSBudWxsICYmIG90aGVyQ3VycmVudCA9PT0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgU29ydGVkTWFwIG9yZGVyZWQgYnkgaW5kZXgsIG9yIG51bGwgaWYgdGhlIGRlZmF1bHQgKGJ5LWtleSkgb3JkZXJpbmcgY2FuIGJlIHVzZWRcbiAgICAgKiBpbnN0ZWFkLlxuICAgICAqXG4gICAgICovXG4gICAgcmVzb2x2ZUluZGV4XyhpbmRleERlZmluaXRpb24pIHtcbiAgICAgICAgaWYgKGluZGV4RGVmaW5pdGlvbiA9PT0gS0VZX0lOREVYKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4TWFwXy5nZXQoaW5kZXhEZWZpbml0aW9uLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgfVxufVxuQ2hpbGRyZW5Ob2RlLklOVEVHRVJfUkVHRVhQXyA9IC9eKDB8WzEtOV1cXGQqKSQvO1xuY2xhc3MgTWF4Tm9kZSBleHRlbmRzIENoaWxkcmVuTm9kZSB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKG5ldyBTb3J0ZWRNYXAoTkFNRV9DT01QQVJBVE9SKSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUsIEluZGV4TWFwLkRlZmF1bHQpO1xuICAgIH1cbiAgICBjb21wYXJlVG8ob3RoZXIpIHtcbiAgICAgICAgaWYgKG90aGVyID09PSB0aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiAxO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVxdWFscyhvdGhlcikge1xuICAgICAgICAvLyBOb3QgdGhhdCB3ZSBldmVyeSBjb21wYXJlIGl0LCBidXQgTUFYX05PREUgaXMgb25seSBldmVyIGVxdWFsIHRvIGl0c2VsZlxuICAgICAgICByZXR1cm4gb3RoZXIgPT09IHRoaXM7XG4gICAgfVxuICAgIGdldFByaW9yaXR5KCkge1xuICAgICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKSB7XG4gICAgICAgIHJldHVybiBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICB9XG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbi8qKlxuICogTWFya2VyIHRoYXQgd2lsbCBzb3J0IGhpZ2hlciB0aGFuIGFueSBvdGhlciBzbmFwc2hvdC5cbiAqL1xuY29uc3QgTUFYX05PREUgPSBuZXcgTWF4Tm9kZSgpO1xuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoTmFtZWROb2RlLCB7XG4gICAgTUlOOiB7XG4gICAgICAgIHZhbHVlOiBuZXcgTmFtZWROb2RlKE1JTl9OQU1FLCBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSlcbiAgICB9LFxuICAgIE1BWDoge1xuICAgICAgICB2YWx1ZTogbmV3IE5hbWVkTm9kZShNQVhfTkFNRSwgTUFYX05PREUpXG4gICAgfVxufSk7XG4vKipcbiAqIFJlZmVyZW5jZSBFeHRlbnNpb25zXG4gKi9cbktleUluZGV4Ll9fRU1QVFlfTk9ERSA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFO1xuTGVhZk5vZGUuX19jaGlsZHJlbk5vZGVDb25zdHJ1Y3RvciA9IENoaWxkcmVuTm9kZTtcbnNldE1heE5vZGUkMShNQVhfTk9ERSk7XG5zZXRNYXhOb2RlKE1BWF9OT0RFKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNvbnN0IFVTRV9ISU5aRSA9IHRydWU7XG4vKipcbiAqIENvbnN0cnVjdHMgYSBzbmFwc2hvdCBub2RlIHJlcHJlc2VudGluZyB0aGUgcGFzc2VkIEpTT04gYW5kIHJldHVybnMgaXQuXG4gKiBAcGFyYW0ganNvbiAtIEpTT04gdG8gY3JlYXRlIGEgbm9kZSBmb3IuXG4gKiBAcGFyYW0gcHJpb3JpdHkgLSBPcHRpb25hbCBwcmlvcml0eSB0byB1c2UuICBUaGlzIHdpbGwgYmUgaWdub3JlZCBpZiB0aGVcbiAqIHBhc3NlZCBKU09OIGNvbnRhaW5zIGEgLnByaW9yaXR5IHByb3BlcnR5LlxuICovXG5mdW5jdGlvbiBub2RlRnJvbUpTT04oanNvbiwgcHJpb3JpdHkgPSBudWxsKSB7XG4gICAgaWYgKGpzb24gPT09IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIGpzb24gPT09ICdvYmplY3QnICYmICcucHJpb3JpdHknIGluIGpzb24pIHtcbiAgICAgICAgcHJpb3JpdHkgPSBqc29uWycucHJpb3JpdHknXTtcbiAgICB9XG4gICAgYXNzZXJ0KHByaW9yaXR5ID09PSBudWxsIHx8XG4gICAgICAgIHR5cGVvZiBwcmlvcml0eSA9PT0gJ3N0cmluZycgfHxcbiAgICAgICAgdHlwZW9mIHByaW9yaXR5ID09PSAnbnVtYmVyJyB8fFxuICAgICAgICAodHlwZW9mIHByaW9yaXR5ID09PSAnb2JqZWN0JyAmJiAnLnN2JyBpbiBwcmlvcml0eSksICdJbnZhbGlkIHByaW9yaXR5IHR5cGUgZm91bmQ6ICcgKyB0eXBlb2YgcHJpb3JpdHkpO1xuICAgIGlmICh0eXBlb2YganNvbiA9PT0gJ29iamVjdCcgJiYgJy52YWx1ZScgaW4ganNvbiAmJiBqc29uWycudmFsdWUnXSAhPT0gbnVsbCkge1xuICAgICAgICBqc29uID0ganNvblsnLnZhbHVlJ107XG4gICAgfVxuICAgIC8vIFZhbGlkIGxlYWYgbm9kZXMgaW5jbHVkZSBub24tb2JqZWN0cyBvciBzZXJ2ZXItdmFsdWUgd3JhcHBlciBvYmplY3RzXG4gICAgaWYgKHR5cGVvZiBqc29uICE9PSAnb2JqZWN0JyB8fCAnLnN2JyBpbiBqc29uKSB7XG4gICAgICAgIGNvbnN0IGpzb25MZWFmID0ganNvbjtcbiAgICAgICAgcmV0dXJuIG5ldyBMZWFmTm9kZShqc29uTGVhZiwgbm9kZUZyb21KU09OKHByaW9yaXR5KSk7XG4gICAgfVxuICAgIGlmICghKGpzb24gaW5zdGFuY2VvZiBBcnJheSkgJiYgVVNFX0hJTlpFKSB7XG4gICAgICAgIGNvbnN0IGNoaWxkcmVuID0gW107XG4gICAgICAgIGxldCBjaGlsZHJlbkhhdmVQcmlvcml0eSA9IGZhbHNlO1xuICAgICAgICBjb25zdCBoaW56ZUpzb25PYmogPSBqc29uO1xuICAgICAgICBlYWNoKGhpbnplSnNvbk9iaiwgKGtleSwgY2hpbGQpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkuc3Vic3RyaW5nKDAsIDEpICE9PSAnLicpIHtcbiAgICAgICAgICAgICAgICAvLyBJZ25vcmUgbWV0YWRhdGEgbm9kZXNcbiAgICAgICAgICAgICAgICBjb25zdCBjaGlsZE5vZGUgPSBub2RlRnJvbUpTT04oY2hpbGQpO1xuICAgICAgICAgICAgICAgIGlmICghY2hpbGROb2RlLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbkhhdmVQcmlvcml0eSA9XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbkhhdmVQcmlvcml0eSB8fCAhY2hpbGROb2RlLmdldFByaW9yaXR5KCkuaXNFbXB0eSgpO1xuICAgICAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKG5ldyBOYW1lZE5vZGUoa2V5LCBjaGlsZE5vZGUpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoY2hpbGRyZW4ubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpbGRTZXQgPSBidWlsZENoaWxkU2V0KGNoaWxkcmVuLCBOQU1FX09OTFlfQ09NUEFSQVRPUiwgbmFtZWROb2RlID0+IG5hbWVkTm9kZS5uYW1lLCBOQU1FX0NPTVBBUkFUT1IpO1xuICAgICAgICBpZiAoY2hpbGRyZW5IYXZlUHJpb3JpdHkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNvcnRlZENoaWxkU2V0ID0gYnVpbGRDaGlsZFNldChjaGlsZHJlbiwgUFJJT1JJVFlfSU5ERVguZ2V0Q29tcGFyZSgpKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2hpbGRyZW5Ob2RlKGNoaWxkU2V0LCBub2RlRnJvbUpTT04ocHJpb3JpdHkpLCBuZXcgSW5kZXhNYXAoeyAnLnByaW9yaXR5Jzogc29ydGVkQ2hpbGRTZXQgfSwgeyAnLnByaW9yaXR5JzogUFJJT1JJVFlfSU5ERVggfSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDaGlsZHJlbk5vZGUoY2hpbGRTZXQsIG5vZGVGcm9tSlNPTihwcmlvcml0eSksIEluZGV4TWFwLkRlZmF1bHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBsZXQgbm9kZSA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFO1xuICAgICAgICBlYWNoKGpzb24sIChrZXksIGNoaWxkRGF0YSkgPT4ge1xuICAgICAgICAgICAgaWYgKGNvbnRhaW5zKGpzb24sIGtleSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoa2V5LnN1YnN0cmluZygwLCAxKSAhPT0gJy4nKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGlnbm9yZSBtZXRhZGF0YSBub2Rlcy5cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gbm9kZUZyb21KU09OKGNoaWxkRGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUuaXNMZWFmTm9kZSgpIHx8ICFjaGlsZE5vZGUuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBub2RlID0gbm9kZS51cGRhdGVJbW1lZGlhdGVDaGlsZChrZXksIGNoaWxkTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gbm9kZS51cGRhdGVQcmlvcml0eShub2RlRnJvbUpTT04ocHJpb3JpdHkpKTtcbiAgICB9XG59XG5zZXROb2RlRnJvbUpTT04obm9kZUZyb21KU09OKTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIFBhdGhJbmRleCBleHRlbmRzIEluZGV4IHtcbiAgICBjb25zdHJ1Y3RvcihpbmRleFBhdGhfKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuaW5kZXhQYXRoXyA9IGluZGV4UGF0aF87XG4gICAgICAgIGFzc2VydCghcGF0aElzRW1wdHkoaW5kZXhQYXRoXykgJiYgcGF0aEdldEZyb250KGluZGV4UGF0aF8pICE9PSAnLnByaW9yaXR5JywgXCJDYW4ndCBjcmVhdGUgUGF0aEluZGV4IHdpdGggZW1wdHkgcGF0aCBvciAucHJpb3JpdHkga2V5XCIpO1xuICAgIH1cbiAgICBleHRyYWN0Q2hpbGQoc25hcCkge1xuICAgICAgICByZXR1cm4gc25hcC5nZXRDaGlsZCh0aGlzLmluZGV4UGF0aF8pO1xuICAgIH1cbiAgICBpc0RlZmluZWRPbihub2RlKSB7XG4gICAgICAgIHJldHVybiAhbm9kZS5nZXRDaGlsZCh0aGlzLmluZGV4UGF0aF8pLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgY29tcGFyZShhLCBiKSB7XG4gICAgICAgIGNvbnN0IGFDaGlsZCA9IHRoaXMuZXh0cmFjdENoaWxkKGEubm9kZSk7XG4gICAgICAgIGNvbnN0IGJDaGlsZCA9IHRoaXMuZXh0cmFjdENoaWxkKGIubm9kZSk7XG4gICAgICAgIGNvbnN0IGluZGV4Q21wID0gYUNoaWxkLmNvbXBhcmVUbyhiQ2hpbGQpO1xuICAgICAgICBpZiAoaW5kZXhDbXAgPT09IDApIHtcbiAgICAgICAgICAgIHJldHVybiBuYW1lQ29tcGFyZShhLm5hbWUsIGIubmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gaW5kZXhDbXA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWFrZVBvc3QoaW5kZXhWYWx1ZSwgbmFtZSkge1xuICAgICAgICBjb25zdCB2YWx1ZU5vZGUgPSBub2RlRnJvbUpTT04oaW5kZXhWYWx1ZSk7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERS51cGRhdGVDaGlsZCh0aGlzLmluZGV4UGF0aF8sIHZhbHVlTm9kZSk7XG4gICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKG5hbWUsIG5vZGUpO1xuICAgIH1cbiAgICBtYXhQb3N0KCkge1xuICAgICAgICBjb25zdCBub2RlID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUudXBkYXRlQ2hpbGQodGhpcy5pbmRleFBhdGhfLCBNQVhfTk9ERSk7XG4gICAgICAgIHJldHVybiBuZXcgTmFtZWROb2RlKE1BWF9OQU1FLCBub2RlKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiBwYXRoU2xpY2UodGhpcy5pbmRleFBhdGhfLCAwKS5qb2luKCcvJyk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgVmFsdWVJbmRleCBleHRlbmRzIEluZGV4IHtcbiAgICBjb21wYXJlKGEsIGIpIHtcbiAgICAgICAgY29uc3QgaW5kZXhDbXAgPSBhLm5vZGUuY29tcGFyZVRvKGIubm9kZSk7XG4gICAgICAgIGlmIChpbmRleENtcCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG5hbWVDb21wYXJlKGEubmFtZSwgYi5uYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBpbmRleENtcDtcbiAgICAgICAgfVxuICAgIH1cbiAgICBpc0RlZmluZWRPbihub2RlKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBpbmRleGVkVmFsdWVDaGFuZ2VkKG9sZE5vZGUsIG5ld05vZGUpIHtcbiAgICAgICAgcmV0dXJuICFvbGROb2RlLmVxdWFscyhuZXdOb2RlKTtcbiAgICB9XG4gICAgbWluUG9zdCgpIHtcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgcmV0dXJuIE5hbWVkTm9kZS5NSU47XG4gICAgfVxuICAgIG1heFBvc3QoKSB7XG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgIHJldHVybiBOYW1lZE5vZGUuTUFYO1xuICAgIH1cbiAgICBtYWtlUG9zdChpbmRleFZhbHVlLCBuYW1lKSB7XG4gICAgICAgIGNvbnN0IHZhbHVlTm9kZSA9IG5vZGVGcm9tSlNPTihpbmRleFZhbHVlKTtcbiAgICAgICAgcmV0dXJuIG5ldyBOYW1lZE5vZGUobmFtZSwgdmFsdWVOb2RlKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgU3RyaW5nIHJlcHJlc2VudGF0aW9uIGZvciBpbmNsdXNpb24gaW4gYSBxdWVyeSBzcGVjXG4gICAgICovXG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiAnLnZhbHVlJztcbiAgICB9XG59XG5jb25zdCBWQUxVRV9JTkRFWCA9IG5ldyBWYWx1ZUluZGV4KCk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBjaGFuZ2VWYWx1ZShzbmFwc2hvdE5vZGUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBcInZhbHVlXCIgLyogQ2hhbmdlVHlwZS5WQUxVRSAqLywgc25hcHNob3ROb2RlIH07XG59XG5mdW5jdGlvbiBjaGFuZ2VDaGlsZEFkZGVkKGNoaWxkTmFtZSwgc25hcHNob3ROb2RlKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogXCJjaGlsZF9hZGRlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfQURERUQgKi8sIHNuYXBzaG90Tm9kZSwgY2hpbGROYW1lIH07XG59XG5mdW5jdGlvbiBjaGFuZ2VDaGlsZFJlbW92ZWQoY2hpbGROYW1lLCBzbmFwc2hvdE5vZGUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBcImNoaWxkX3JlbW92ZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8sIHNuYXBzaG90Tm9kZSwgY2hpbGROYW1lIH07XG59XG5mdW5jdGlvbiBjaGFuZ2VDaGlsZENoYW5nZWQoY2hpbGROYW1lLCBzbmFwc2hvdE5vZGUsIG9sZFNuYXApIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB0eXBlOiBcImNoaWxkX2NoYW5nZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8sXG4gICAgICAgIHNuYXBzaG90Tm9kZSxcbiAgICAgICAgY2hpbGROYW1lLFxuICAgICAgICBvbGRTbmFwXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNoYW5nZUNoaWxkTW92ZWQoY2hpbGROYW1lLCBzbmFwc2hvdE5vZGUpIHtcbiAgICByZXR1cm4geyB0eXBlOiBcImNoaWxkX21vdmVkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9NT1ZFRCAqLywgc25hcHNob3ROb2RlLCBjaGlsZE5hbWUgfTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogRG9lc24ndCByZWFsbHkgZmlsdGVyIG5vZGVzIGJ1dCBhcHBsaWVzIGFuIGluZGV4IHRvIHRoZSBub2RlIGFuZCBrZWVwcyB0cmFjayBvZiBhbnkgY2hhbmdlc1xuICovXG5jbGFzcyBJbmRleGVkRmlsdGVyIHtcbiAgICBjb25zdHJ1Y3RvcihpbmRleF8pIHtcbiAgICAgICAgdGhpcy5pbmRleF8gPSBpbmRleF87XG4gICAgfVxuICAgIHVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikge1xuICAgICAgICBhc3NlcnQoc25hcC5pc0luZGV4ZWQodGhpcy5pbmRleF8pLCAnQSBub2RlIG11c3QgYmUgaW5kZXhlZCBpZiBvbmx5IGEgY2hpbGQgaXMgdXBkYXRlZCcpO1xuICAgICAgICBjb25zdCBvbGRDaGlsZCA9IHNuYXAuZ2V0SW1tZWRpYXRlQ2hpbGQoa2V5KTtcbiAgICAgICAgLy8gQ2hlY2sgaWYgYW55dGhpbmcgYWN0dWFsbHkgY2hhbmdlZC5cbiAgICAgICAgaWYgKG9sZENoaWxkLmdldENoaWxkKGFmZmVjdGVkUGF0aCkuZXF1YWxzKG5ld0NoaWxkLmdldENoaWxkKGFmZmVjdGVkUGF0aCkpKSB7XG4gICAgICAgICAgICAvLyBUaGVyZSdzIGFuIGVkZ2UgY2FzZSB3aGVyZSBhIGNoaWxkIGNhbiBlbnRlciBvciBsZWF2ZSB0aGUgdmlldyBiZWNhdXNlIGFmZmVjdGVkUGF0aCB3YXMgc2V0IHRvIG51bGwuXG4gICAgICAgICAgICAvLyBJbiB0aGlzIGNhc2UsIGFmZmVjdGVkUGF0aCB3aWxsIGFwcGVhciBudWxsIGluIGJvdGggdGhlIG9sZCBhbmQgbmV3IHNuYXBzaG90cy4gIFNvIHdlIG5lZWRcbiAgICAgICAgICAgIC8vIHRvIGF2b2lkIHRyZWF0aW5nIHRoZXNlIGNhc2VzIGFzIFwibm90aGluZyBjaGFuZ2VkLlwiXG4gICAgICAgICAgICBpZiAob2xkQ2hpbGQuaXNFbXB0eSgpID09PSBuZXdDaGlsZC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIGNoYW5nZWQuXG4gICAgICAgICAgICAgICAgLy8gVGhpcyBhc3NlcnQgc2hvdWxkIGJlIHZhbGlkLCBidXQgaXQncyBleHBlbnNpdmUgKGNhbiBkb21pbmF0ZSBwZXJmIHRlc3RpbmcpIHNvIGRvbid0IGFjdHVhbGx5IGRvIGl0LlxuICAgICAgICAgICAgICAgIC8vYXNzZXJ0KG9sZENoaWxkLmVxdWFscyhuZXdDaGlsZCksICdPbGQgYW5kIG5ldyBzbmFwc2hvdHMgc2hvdWxkIGJlIGVxdWFsLicpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzbmFwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChvcHRDaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7XG4gICAgICAgICAgICBpZiAobmV3Q2hpbGQuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHNuYXAuaGFzQ2hpbGQoa2V5KSkge1xuICAgICAgICAgICAgICAgICAgICBvcHRDaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkUmVtb3ZlZChrZXksIG9sZENoaWxkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhc3NlcnQoc25hcC5pc0xlYWZOb2RlKCksICdBIGNoaWxkIHJlbW92ZSB3aXRob3V0IGFuIG9sZCBjaGlsZCBvbmx5IG1ha2VzIHNlbnNlIG9uIGEgbGVhZiBub2RlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAob2xkQ2hpbGQuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZEFkZGVkKGtleSwgbmV3Q2hpbGQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG9wdENoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRDaGFuZ2VkKGtleSwgbmV3Q2hpbGQsIG9sZENoaWxkKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHNuYXAuaXNMZWFmTm9kZSgpICYmIG5ld0NoaWxkLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHNuYXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBNYWtlIHN1cmUgdGhlIG5vZGUgaXMgaW5kZXhlZFxuICAgICAgICAgICAgcmV0dXJuIHNuYXAudXBkYXRlSW1tZWRpYXRlQ2hpbGQoa2V5LCBuZXdDaGlsZCkud2l0aEluZGV4KHRoaXMuaW5kZXhfKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB1cGRhdGVGdWxsTm9kZShvbGRTbmFwLCBuZXdTbmFwLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikge1xuICAgICAgICBpZiAob3B0Q2hhbmdlQWNjdW11bGF0b3IgIT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKCFvbGRTbmFwLmlzTGVhZk5vZGUoKSkge1xuICAgICAgICAgICAgICAgIG9sZFNuYXAuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFuZXdTbmFwLmhhc0NoaWxkKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG9wdENoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRSZW1vdmVkKGtleSwgY2hpbGROb2RlKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbmV3U25hcC5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgICAgICBuZXdTbmFwLmZvckVhY2hDaGlsZChQUklPUklUWV9JTkRFWCwgKGtleSwgY2hpbGROb2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvbGRTbmFwLmhhc0NoaWxkKGtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG9sZENoaWxkID0gb2xkU25hcC5nZXRJbW1lZGlhdGVDaGlsZChrZXkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCFvbGRDaGlsZC5lcXVhbHMoY2hpbGROb2RlKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdENoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRDaGFuZ2VkKGtleSwgY2hpbGROb2RlLCBvbGRDaGlsZCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0Q2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZEFkZGVkKGtleSwgY2hpbGROb2RlKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3U25hcC53aXRoSW5kZXgodGhpcy5pbmRleF8pO1xuICAgIH1cbiAgICB1cGRhdGVQcmlvcml0eShvbGRTbmFwLCBuZXdQcmlvcml0eSkge1xuICAgICAgICBpZiAob2xkU25hcC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIHJldHVybiBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBvbGRTbmFwLnVwZGF0ZVByaW9yaXR5KG5ld1ByaW9yaXR5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmaWx0ZXJzTm9kZXMoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgZ2V0SW5kZXhlZEZpbHRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIGdldEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleF87XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBGaWx0ZXJzIG5vZGVzIGJ5IHJhbmdlIGFuZCB1c2VzIGFuIEluZGV4RmlsdGVyIHRvIHRyYWNrIGFueSBjaGFuZ2VzIGFmdGVyIGZpbHRlcmluZyB0aGUgbm9kZVxuICovXG5jbGFzcyBSYW5nZWRGaWx0ZXIge1xuICAgIGNvbnN0cnVjdG9yKHBhcmFtcykge1xuICAgICAgICB0aGlzLmluZGV4ZWRGaWx0ZXJfID0gbmV3IEluZGV4ZWRGaWx0ZXIocGFyYW1zLmdldEluZGV4KCkpO1xuICAgICAgICB0aGlzLmluZGV4XyA9IHBhcmFtcy5nZXRJbmRleCgpO1xuICAgICAgICB0aGlzLnN0YXJ0UG9zdF8gPSBSYW5nZWRGaWx0ZXIuZ2V0U3RhcnRQb3N0XyhwYXJhbXMpO1xuICAgICAgICB0aGlzLmVuZFBvc3RfID0gUmFuZ2VkRmlsdGVyLmdldEVuZFBvc3RfKHBhcmFtcyk7XG4gICAgICAgIHRoaXMuc3RhcnRJc0luY2x1c2l2ZV8gPSAhcGFyYW1zLnN0YXJ0QWZ0ZXJTZXRfO1xuICAgICAgICB0aGlzLmVuZElzSW5jbHVzaXZlXyA9ICFwYXJhbXMuZW5kQmVmb3JlU2V0XztcbiAgICB9XG4gICAgZ2V0U3RhcnRQb3N0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydFBvc3RfO1xuICAgIH1cbiAgICBnZXRFbmRQb3N0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5lbmRQb3N0XztcbiAgICB9XG4gICAgbWF0Y2hlcyhub2RlKSB7XG4gICAgICAgIGNvbnN0IGlzV2l0aGluU3RhcnQgPSB0aGlzLnN0YXJ0SXNJbmNsdXNpdmVfXG4gICAgICAgICAgICA/IHRoaXMuaW5kZXhfLmNvbXBhcmUodGhpcy5nZXRTdGFydFBvc3QoKSwgbm9kZSkgPD0gMFxuICAgICAgICAgICAgOiB0aGlzLmluZGV4Xy5jb21wYXJlKHRoaXMuZ2V0U3RhcnRQb3N0KCksIG5vZGUpIDwgMDtcbiAgICAgICAgY29uc3QgaXNXaXRoaW5FbmQgPSB0aGlzLmVuZElzSW5jbHVzaXZlX1xuICAgICAgICAgICAgPyB0aGlzLmluZGV4Xy5jb21wYXJlKG5vZGUsIHRoaXMuZ2V0RW5kUG9zdCgpKSA8PSAwXG4gICAgICAgICAgICA6IHRoaXMuaW5kZXhfLmNvbXBhcmUobm9kZSwgdGhpcy5nZXRFbmRQb3N0KCkpIDwgMDtcbiAgICAgICAgcmV0dXJuIGlzV2l0aGluU3RhcnQgJiYgaXNXaXRoaW5FbmQ7XG4gICAgfVxuICAgIHVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikge1xuICAgICAgICBpZiAoIXRoaXMubWF0Y2hlcyhuZXcgTmFtZWROb2RlKGtleSwgbmV3Q2hpbGQpKSkge1xuICAgICAgICAgICAgbmV3Q2hpbGQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5pbmRleGVkRmlsdGVyXy51cGRhdGVDaGlsZChzbmFwLCBrZXksIG5ld0NoaWxkLCBhZmZlY3RlZFBhdGgsIHNvdXJjZSwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpO1xuICAgIH1cbiAgICB1cGRhdGVGdWxsTm9kZShvbGRTbmFwLCBuZXdTbmFwLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcikge1xuICAgICAgICBpZiAobmV3U25hcC5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgY2hpbGRyZW4gbm9kZSB3aXRoIHRoZSBjb3JyZWN0IGluZGV4LCBub3QgYSBsZWFmIG5vZGU7XG4gICAgICAgICAgICBuZXdTbmFwID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGZpbHRlcmVkID0gbmV3U25hcC53aXRoSW5kZXgodGhpcy5pbmRleF8pO1xuICAgICAgICAvLyBEb24ndCBzdXBwb3J0IHByaW9yaXRpZXMgb24gcXVlcmllc1xuICAgICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLnVwZGF0ZVByaW9yaXR5KENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTtcbiAgICAgICAgY29uc3Qgc2VsZiA9IHRoaXM7XG4gICAgICAgIG5ld1NuYXAuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgICAgIGlmICghc2VsZi5tYXRjaGVzKG5ldyBOYW1lZE5vZGUoa2V5LCBjaGlsZE5vZGUpKSkge1xuICAgICAgICAgICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQudXBkYXRlSW1tZWRpYXRlQ2hpbGQoa2V5LCBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleGVkRmlsdGVyXy51cGRhdGVGdWxsTm9kZShvbGRTbmFwLCBmaWx0ZXJlZCwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpO1xuICAgIH1cbiAgICB1cGRhdGVQcmlvcml0eShvbGRTbmFwLCBuZXdQcmlvcml0eSkge1xuICAgICAgICAvLyBEb24ndCBzdXBwb3J0IHByaW9yaXRpZXMgb24gcXVlcmllc1xuICAgICAgICByZXR1cm4gb2xkU25hcDtcbiAgICB9XG4gICAgZmlsdGVyc05vZGVzKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0SW5kZXhlZEZpbHRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhlZEZpbHRlcl87XG4gICAgfVxuICAgIGdldEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleF87XG4gICAgfVxuICAgIHN0YXRpYyBnZXRTdGFydFBvc3RfKHBhcmFtcykge1xuICAgICAgICBpZiAocGFyYW1zLmhhc1N0YXJ0KCkpIHtcbiAgICAgICAgICAgIGNvbnN0IHN0YXJ0TmFtZSA9IHBhcmFtcy5nZXRJbmRleFN0YXJ0TmFtZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5nZXRJbmRleCgpLm1ha2VQb3N0KHBhcmFtcy5nZXRJbmRleFN0YXJ0VmFsdWUoKSwgc3RhcnROYW1lKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwYXJhbXMuZ2V0SW5kZXgoKS5taW5Qb3N0KCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3RhdGljIGdldEVuZFBvc3RfKHBhcmFtcykge1xuICAgICAgICBpZiAocGFyYW1zLmhhc0VuZCgpKSB7XG4gICAgICAgICAgICBjb25zdCBlbmROYW1lID0gcGFyYW1zLmdldEluZGV4RW5kTmFtZSgpO1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5nZXRJbmRleCgpLm1ha2VQb3N0KHBhcmFtcy5nZXRJbmRleEVuZFZhbHVlKCksIGVuZE5hbWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHBhcmFtcy5nZXRJbmRleCgpLm1heFBvc3QoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQXBwbGllcyBhIGxpbWl0IGFuZCBhIHJhbmdlIHRvIGEgbm9kZSBhbmQgdXNlcyBSYW5nZWRGaWx0ZXIgdG8gZG8gdGhlIGhlYXZ5IGxpZnRpbmcgd2hlcmUgcG9zc2libGVcbiAqL1xuY2xhc3MgTGltaXRlZEZpbHRlciB7XG4gICAgY29uc3RydWN0b3IocGFyYW1zKSB7XG4gICAgICAgIHRoaXMud2l0aGluRGlyZWN0aW9uYWxTdGFydCA9IChub2RlKSA9PiB0aGlzLnJldmVyc2VfID8gdGhpcy53aXRoaW5FbmRQb3N0KG5vZGUpIDogdGhpcy53aXRoaW5TdGFydFBvc3Qobm9kZSk7XG4gICAgICAgIHRoaXMud2l0aGluRGlyZWN0aW9uYWxFbmQgPSAobm9kZSkgPT4gdGhpcy5yZXZlcnNlXyA/IHRoaXMud2l0aGluU3RhcnRQb3N0KG5vZGUpIDogdGhpcy53aXRoaW5FbmRQb3N0KG5vZGUpO1xuICAgICAgICB0aGlzLndpdGhpblN0YXJ0UG9zdCA9IChub2RlKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBjb21wYXJlUmVzID0gdGhpcy5pbmRleF8uY29tcGFyZSh0aGlzLnJhbmdlZEZpbHRlcl8uZ2V0U3RhcnRQb3N0KCksIG5vZGUpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuc3RhcnRJc0luY2x1c2l2ZV8gPyBjb21wYXJlUmVzIDw9IDAgOiBjb21wYXJlUmVzIDwgMDtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy53aXRoaW5FbmRQb3N0ID0gKG5vZGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXBhcmVSZXMgPSB0aGlzLmluZGV4Xy5jb21wYXJlKG5vZGUsIHRoaXMucmFuZ2VkRmlsdGVyXy5nZXRFbmRQb3N0KCkpO1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZW5kSXNJbmNsdXNpdmVfID8gY29tcGFyZVJlcyA8PSAwIDogY29tcGFyZVJlcyA8IDA7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmFuZ2VkRmlsdGVyXyA9IG5ldyBSYW5nZWRGaWx0ZXIocGFyYW1zKTtcbiAgICAgICAgdGhpcy5pbmRleF8gPSBwYXJhbXMuZ2V0SW5kZXgoKTtcbiAgICAgICAgdGhpcy5saW1pdF8gPSBwYXJhbXMuZ2V0TGltaXQoKTtcbiAgICAgICAgdGhpcy5yZXZlcnNlXyA9ICFwYXJhbXMuaXNWaWV3RnJvbUxlZnQoKTtcbiAgICAgICAgdGhpcy5zdGFydElzSW5jbHVzaXZlXyA9ICFwYXJhbXMuc3RhcnRBZnRlclNldF87XG4gICAgICAgIHRoaXMuZW5kSXNJbmNsdXNpdmVfID0gIXBhcmFtcy5lbmRCZWZvcmVTZXRfO1xuICAgIH1cbiAgICB1cGRhdGVDaGlsZChzbmFwLCBrZXksIG5ld0NoaWxkLCBhZmZlY3RlZFBhdGgsIHNvdXJjZSwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpIHtcbiAgICAgICAgaWYgKCF0aGlzLnJhbmdlZEZpbHRlcl8ubWF0Y2hlcyhuZXcgTmFtZWROb2RlKGtleSwgbmV3Q2hpbGQpKSkge1xuICAgICAgICAgICAgbmV3Q2hpbGQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc25hcC5nZXRJbW1lZGlhdGVDaGlsZChrZXkpLmVxdWFscyhuZXdDaGlsZCkpIHtcbiAgICAgICAgICAgIC8vIE5vIGNoYW5nZVxuICAgICAgICAgICAgcmV0dXJuIHNuYXA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc25hcC5udW1DaGlsZHJlbigpIDwgdGhpcy5saW1pdF8pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnJhbmdlZEZpbHRlcl9cbiAgICAgICAgICAgICAgICAuZ2V0SW5kZXhlZEZpbHRlcigpXG4gICAgICAgICAgICAgICAgLnVwZGF0ZUNoaWxkKHNuYXAsIGtleSwgbmV3Q2hpbGQsIGFmZmVjdGVkUGF0aCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5mdWxsTGltaXRVcGRhdGVDaGlsZF8oc25hcCwga2V5LCBuZXdDaGlsZCwgc291cmNlLCBvcHRDaGFuZ2VBY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlRnVsbE5vZGUob2xkU25hcCwgbmV3U25hcCwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpIHtcbiAgICAgICAgbGV0IGZpbHRlcmVkO1xuICAgICAgICBpZiAobmV3U25hcC5pc0xlYWZOb2RlKCkgfHwgbmV3U25hcC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgIC8vIE1ha2Ugc3VyZSB3ZSBoYXZlIGEgY2hpbGRyZW4gbm9kZSB3aXRoIHRoZSBjb3JyZWN0IGluZGV4LCBub3QgYSBsZWFmIG5vZGU7XG4gICAgICAgICAgICBmaWx0ZXJlZCA9IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFLndpdGhJbmRleCh0aGlzLmluZGV4Xyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5saW1pdF8gKiAyIDwgbmV3U25hcC5udW1DaGlsZHJlbigpICYmXG4gICAgICAgICAgICAgICAgbmV3U25hcC5pc0luZGV4ZWQodGhpcy5pbmRleF8pKSB7XG4gICAgICAgICAgICAgICAgLy8gRWFzaWVyIHRvIGJ1aWxkIHVwIGEgc25hcHNob3QsIHNpbmNlIHdoYXQgd2UncmUgZ2l2ZW4gaGFzIG1vcmUgdGhhbiB0d2ljZSB0aGUgZWxlbWVudHMgd2Ugd2FudFxuICAgICAgICAgICAgICAgIGZpbHRlcmVkID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUud2l0aEluZGV4KHRoaXMuaW5kZXhfKTtcbiAgICAgICAgICAgICAgICAvLyBhbmNob3IgdG8gdGhlIHN0YXJ0UG9zdCwgZW5kUG9zdCwgb3IgbGFzdCBlbGVtZW50IGFzIGFwcHJvcHJpYXRlXG4gICAgICAgICAgICAgICAgbGV0IGl0ZXJhdG9yO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJldmVyc2VfKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yID0gbmV3U25hcC5nZXRSZXZlcnNlSXRlcmF0b3JGcm9tKHRoaXMucmFuZ2VkRmlsdGVyXy5nZXRFbmRQb3N0KCksIHRoaXMuaW5kZXhfKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yID0gbmV3U25hcC5nZXRJdGVyYXRvckZyb20odGhpcy5yYW5nZWRGaWx0ZXJfLmdldFN0YXJ0UG9zdCgpLCB0aGlzLmluZGV4Xyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgd2hpbGUgKGl0ZXJhdG9yLmhhc05leHQoKSAmJiBjb3VudCA8IHRoaXMubGltaXRfKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHQgPSBpdGVyYXRvci5nZXROZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghdGhpcy53aXRoaW5EaXJlY3Rpb25hbFN0YXJ0KG5leHQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBpZiB3ZSBoYXZlIG5vdCByZWFjaGVkIHRoZSBzdGFydCwgc2tpcCB0byB0aGUgbmV4dCBlbGVtZW50XG4gICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICghdGhpcy53aXRoaW5EaXJlY3Rpb25hbEVuZChuZXh0KSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gaWYgd2UgaGF2ZSByZWFjaGVkIHRoZSBlbmQsIHN0b3AgYWRkaW5nIGVsZW1lbnRzXG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbHRlcmVkID0gZmlsdGVyZWQudXBkYXRlSW1tZWRpYXRlQ2hpbGQobmV4dC5uYW1lLCBuZXh0Lm5vZGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoZSBzbmFwIGNvbnRhaW5zIGxlc3MgdGhhbiB0d2ljZSB0aGUgbGltaXQuIEZhc3RlciB0byBkZWxldGUgZnJvbSB0aGUgc25hcCB0aGFuIGJ1aWxkIHVwIGEgbmV3IG9uZVxuICAgICAgICAgICAgICAgIGZpbHRlcmVkID0gbmV3U25hcC53aXRoSW5kZXgodGhpcy5pbmRleF8pO1xuICAgICAgICAgICAgICAgIC8vIERvbid0IHN1cHBvcnQgcHJpb3JpdGllcyBvbiBxdWVyaWVzXG4gICAgICAgICAgICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC51cGRhdGVQcmlvcml0eShDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSk7XG4gICAgICAgICAgICAgICAgbGV0IGl0ZXJhdG9yO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLnJldmVyc2VfKSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yID0gZmlsdGVyZWQuZ2V0UmV2ZXJzZUl0ZXJhdG9yKHRoaXMuaW5kZXhfKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGl0ZXJhdG9yID0gZmlsdGVyZWQuZ2V0SXRlcmF0b3IodGhpcy5pbmRleF8pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIHdoaWxlIChpdGVyYXRvci5oYXNOZXh0KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dCA9IGl0ZXJhdG9yLmdldE5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaW5SYW5nZSA9IGNvdW50IDwgdGhpcy5saW1pdF8gJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMud2l0aGluRGlyZWN0aW9uYWxTdGFydChuZXh0KSAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy53aXRoaW5EaXJlY3Rpb25hbEVuZChuZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluUmFuZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZCA9IGZpbHRlcmVkLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKG5leHQubmFtZSwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLnJhbmdlZEZpbHRlcl9cbiAgICAgICAgICAgIC5nZXRJbmRleGVkRmlsdGVyKClcbiAgICAgICAgICAgIC51cGRhdGVGdWxsTm9kZShvbGRTbmFwLCBmaWx0ZXJlZCwgb3B0Q2hhbmdlQWNjdW11bGF0b3IpO1xuICAgIH1cbiAgICB1cGRhdGVQcmlvcml0eShvbGRTbmFwLCBuZXdQcmlvcml0eSkge1xuICAgICAgICAvLyBEb24ndCBzdXBwb3J0IHByaW9yaXRpZXMgb24gcXVlcmllc1xuICAgICAgICByZXR1cm4gb2xkU25hcDtcbiAgICB9XG4gICAgZmlsdGVyc05vZGVzKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZ2V0SW5kZXhlZEZpbHRlcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucmFuZ2VkRmlsdGVyXy5nZXRJbmRleGVkRmlsdGVyKCk7XG4gICAgfVxuICAgIGdldEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleF87XG4gICAgfVxuICAgIGZ1bGxMaW1pdFVwZGF0ZUNoaWxkXyhzbmFwLCBjaGlsZEtleSwgY2hpbGRTbmFwLCBzb3VyY2UsIGNoYW5nZUFjY3VtdWxhdG9yKSB7XG4gICAgICAgIC8vIFRPRE86IHJlbmFtZSBhbGwgY2FjaGUgc3R1ZmYgZXRjIHRvIGdlbmVyYWwgc25hcCB0ZXJtaW5vbG9neVxuICAgICAgICBsZXQgY21wO1xuICAgICAgICBpZiAodGhpcy5yZXZlcnNlXykge1xuICAgICAgICAgICAgY29uc3QgaW5kZXhDbXAgPSB0aGlzLmluZGV4Xy5nZXRDb21wYXJlKCk7XG4gICAgICAgICAgICBjbXAgPSAoYSwgYikgPT4gaW5kZXhDbXAoYiwgYSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjbXAgPSB0aGlzLmluZGV4Xy5nZXRDb21wYXJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgb2xkRXZlbnRDYWNoZSA9IHNuYXA7XG4gICAgICAgIGFzc2VydChvbGRFdmVudENhY2hlLm51bUNoaWxkcmVuKCkgPT09IHRoaXMubGltaXRfLCAnJyk7XG4gICAgICAgIGNvbnN0IG5ld0NoaWxkTmFtZWROb2RlID0gbmV3IE5hbWVkTm9kZShjaGlsZEtleSwgY2hpbGRTbmFwKTtcbiAgICAgICAgY29uc3Qgd2luZG93Qm91bmRhcnkgPSB0aGlzLnJldmVyc2VfXG4gICAgICAgICAgICA/IG9sZEV2ZW50Q2FjaGUuZ2V0Rmlyc3RDaGlsZCh0aGlzLmluZGV4XylcbiAgICAgICAgICAgIDogb2xkRXZlbnRDYWNoZS5nZXRMYXN0Q2hpbGQodGhpcy5pbmRleF8pO1xuICAgICAgICBjb25zdCBpblJhbmdlID0gdGhpcy5yYW5nZWRGaWx0ZXJfLm1hdGNoZXMobmV3Q2hpbGROYW1lZE5vZGUpO1xuICAgICAgICBpZiAob2xkRXZlbnRDYWNoZS5oYXNDaGlsZChjaGlsZEtleSkpIHtcbiAgICAgICAgICAgIGNvbnN0IG9sZENoaWxkU25hcCA9IG9sZEV2ZW50Q2FjaGUuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXkpO1xuICAgICAgICAgICAgbGV0IG5leHRDaGlsZCA9IHNvdXJjZS5nZXRDaGlsZEFmdGVyQ2hpbGQodGhpcy5pbmRleF8sIHdpbmRvd0JvdW5kYXJ5LCB0aGlzLnJldmVyc2VfKTtcbiAgICAgICAgICAgIHdoaWxlIChuZXh0Q2hpbGQgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgIChuZXh0Q2hpbGQubmFtZSA9PT0gY2hpbGRLZXkgfHwgb2xkRXZlbnRDYWNoZS5oYXNDaGlsZChuZXh0Q2hpbGQubmFtZSkpKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgYSB3ZWlyZCBlZGdlIGNhc2Ugd2hlcmUgYSBub2RlIGlzIHVwZGF0ZWQgYXMgcGFydCBvZiBhIG1lcmdlIGluIHRoZSB3cml0ZSB0cmVlLCBidXQgaGFzbid0XG4gICAgICAgICAgICAgICAgLy8gYmVlbiBhcHBsaWVkIHRvIHRoZSBsaW1pdGVkIGZpbHRlciB5ZXQuIElnbm9yZSB0aGlzIG5leHQgY2hpbGQgd2hpY2ggd2lsbCBiZSB1cGRhdGVkIGxhdGVyIGluXG4gICAgICAgICAgICAgICAgLy8gdGhlIGxpbWl0ZWQgZmlsdGVyLi4uXG4gICAgICAgICAgICAgICAgbmV4dENoaWxkID0gc291cmNlLmdldENoaWxkQWZ0ZXJDaGlsZCh0aGlzLmluZGV4XywgbmV4dENoaWxkLCB0aGlzLnJldmVyc2VfKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGNvbXBhcmVOZXh0ID0gbmV4dENoaWxkID09IG51bGwgPyAxIDogY21wKG5leHRDaGlsZCwgbmV3Q2hpbGROYW1lZE5vZGUpO1xuICAgICAgICAgICAgY29uc3QgcmVtYWluc0luV2luZG93ID0gaW5SYW5nZSAmJiAhY2hpbGRTbmFwLmlzRW1wdHkoKSAmJiBjb21wYXJlTmV4dCA+PSAwO1xuICAgICAgICAgICAgaWYgKHJlbWFpbnNJbldpbmRvdykge1xuICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRDaGFuZ2VkKGNoaWxkS2V5LCBjaGlsZFNuYXAsIG9sZENoaWxkU25hcCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gb2xkRXZlbnRDYWNoZS51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZEtleSwgY2hpbGRTbmFwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGlmIChjaGFuZ2VBY2N1bXVsYXRvciAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoYW5nZUFjY3VtdWxhdG9yLnRyYWNrQ2hpbGRDaGFuZ2UoY2hhbmdlQ2hpbGRSZW1vdmVkKGNoaWxkS2V5LCBvbGRDaGlsZFNuYXApKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3RXZlbnRDYWNoZSA9IG9sZEV2ZW50Q2FjaGUudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXksIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXh0Q2hpbGRJblJhbmdlID0gbmV4dENoaWxkICE9IG51bGwgJiYgdGhpcy5yYW5nZWRGaWx0ZXJfLm1hdGNoZXMobmV4dENoaWxkKTtcbiAgICAgICAgICAgICAgICBpZiAobmV4dENoaWxkSW5SYW5nZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoY2hhbmdlQWNjdW11bGF0b3IgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZEFkZGVkKG5leHRDaGlsZC5uYW1lLCBuZXh0Q2hpbGQubm9kZSkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXdFdmVudENhY2hlLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKG5leHRDaGlsZC5uYW1lLCBuZXh0Q2hpbGQubm9kZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3RXZlbnRDYWNoZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoY2hpbGRTbmFwLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgLy8gd2UncmUgZGVsZXRpbmcgYSBub2RlLCBidXQgaXQgd2FzIG5vdCBpbiB0aGUgd2luZG93LCBzbyBpZ25vcmUgaXRcbiAgICAgICAgICAgIHJldHVybiBzbmFwO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGluUmFuZ2UpIHtcbiAgICAgICAgICAgIGlmIChjbXAod2luZG93Qm91bmRhcnksIG5ld0NoaWxkTmFtZWROb2RlKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKGNoYW5nZUFjY3VtdWxhdG9yICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlQWNjdW11bGF0b3IudHJhY2tDaGlsZENoYW5nZShjaGFuZ2VDaGlsZFJlbW92ZWQod2luZG93Qm91bmRhcnkubmFtZSwgd2luZG93Qm91bmRhcnkubm9kZSkpO1xuICAgICAgICAgICAgICAgICAgICBjaGFuZ2VBY2N1bXVsYXRvci50cmFja0NoaWxkQ2hhbmdlKGNoYW5nZUNoaWxkQWRkZWQoY2hpbGRLZXksIGNoaWxkU25hcCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gb2xkRXZlbnRDYWNoZVxuICAgICAgICAgICAgICAgICAgICAudXBkYXRlSW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXksIGNoaWxkU25hcClcbiAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKHdpbmRvd0JvdW5kYXJ5Lm5hbWUsIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBzbmFwO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHNuYXA7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoaXMgY2xhc3MgaXMgYW4gaW1tdXRhYmxlLWZyb20tdGhlLXB1YmxpYy1hcGkgc3RydWN0IGNvbnRhaW5pbmcgYSBzZXQgb2YgcXVlcnkgcGFyYW1ldGVycyBkZWZpbmluZyBhXG4gKiByYW5nZSB0byBiZSByZXR1cm5lZCBmb3IgYSBwYXJ0aWN1bGFyIGxvY2F0aW9uLiBJdCBpcyBhc3N1bWVkIHRoYXQgdmFsaWRhdGlvbiBvZiBwYXJhbWV0ZXJzIGlzIGRvbmUgYXQgdGhlXG4gKiB1c2VyLWZhY2luZyBBUEkgbGV2ZWwsIHNvIGl0IGlzIG5vdCBkb25lIGhlcmUuXG4gKlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIFF1ZXJ5UGFyYW1zIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5saW1pdFNldF8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGFydFNldF8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5zdGFydE5hbWVTZXRfID0gZmFsc2U7XG4gICAgICAgIHRoaXMuc3RhcnRBZnRlclNldF8gPSBmYWxzZTsgLy8gY2FuIG9ubHkgYmUgdHJ1ZSBpZiBzdGFydFNldF8gaXMgdHJ1ZVxuICAgICAgICB0aGlzLmVuZFNldF8gPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lbmROYW1lU2V0XyA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVuZEJlZm9yZVNldF8gPSBmYWxzZTsgLy8gY2FuIG9ubHkgYmUgdHJ1ZSBpZiBlbmRTZXRfIGlzIHRydWVcbiAgICAgICAgdGhpcy5saW1pdF8gPSAwO1xuICAgICAgICB0aGlzLnZpZXdGcm9tXyA9ICcnO1xuICAgICAgICB0aGlzLmluZGV4U3RhcnRWYWx1ZV8gPSBudWxsO1xuICAgICAgICB0aGlzLmluZGV4U3RhcnROYW1lXyA9ICcnO1xuICAgICAgICB0aGlzLmluZGV4RW5kVmFsdWVfID0gbnVsbDtcbiAgICAgICAgdGhpcy5pbmRleEVuZE5hbWVfID0gJyc7XG4gICAgICAgIHRoaXMuaW5kZXhfID0gUFJJT1JJVFlfSU5ERVg7XG4gICAgfVxuICAgIGhhc1N0YXJ0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5zdGFydFNldF87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEByZXR1cm5zIFRydWUgaWYgaXQgd291bGQgcmV0dXJuIGZyb20gbGVmdC5cbiAgICAgKi9cbiAgICBpc1ZpZXdGcm9tTGVmdCgpIHtcbiAgICAgICAgaWYgKHRoaXMudmlld0Zyb21fID09PSAnJykge1xuICAgICAgICAgICAgLy8gbGltaXQoKSwgcmF0aGVyIHRoYW4gbGltaXRUb0ZpcnN0IG9yIGxpbWl0VG9MYXN0IHdhcyBjYWxsZWQuXG4gICAgICAgICAgICAvLyBUaGlzIG1lYW5zIHRoYXQgb25seSBvbmUgb2Ygc3RhcnRTZXRfIGFuZCBlbmRTZXRfIGlzIHRydWUuIFVzZSB0aGVtXG4gICAgICAgICAgICAvLyB0byBjYWxjdWxhdGUgd2hpY2ggc2lkZSBvZiB0aGUgdmlldyB0byBhbmNob3IgdG8uIElmIG5laXRoZXIgaXMgc2V0LFxuICAgICAgICAgICAgLy8gYW5jaG9yIHRvIHRoZSBlbmQuXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdGFydFNldF87XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy52aWV3RnJvbV8gPT09IFwibFwiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLlZJRVdfRlJPTV9MRUZUICovO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNTdGFydCgpIHJldHVybnMgdHJ1ZVxuICAgICAqL1xuICAgIGdldEluZGV4U3RhcnRWYWx1ZSgpIHtcbiAgICAgICAgYXNzZXJ0KHRoaXMuc3RhcnRTZXRfLCAnT25seSB2YWxpZCBpZiBzdGFydCBoYXMgYmVlbiBzZXQnKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuaW5kZXhTdGFydFZhbHVlXztcbiAgICB9XG4gICAgLyoqXG4gICAgICogT25seSB2YWxpZCB0byBjYWxsIGlmIGhhc1N0YXJ0KCkgcmV0dXJucyB0cnVlLlxuICAgICAqIFJldHVybnMgdGhlIHN0YXJ0aW5nIGtleSBuYW1lIGZvciB0aGUgcmFuZ2UgZGVmaW5lZCBieSB0aGVzZSBxdWVyeSBwYXJhbWV0ZXJzXG4gICAgICovXG4gICAgZ2V0SW5kZXhTdGFydE5hbWUoKSB7XG4gICAgICAgIGFzc2VydCh0aGlzLnN0YXJ0U2V0XywgJ09ubHkgdmFsaWQgaWYgc3RhcnQgaGFzIGJlZW4gc2V0Jyk7XG4gICAgICAgIGlmICh0aGlzLnN0YXJ0TmFtZVNldF8pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4U3RhcnROYW1lXztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBNSU5fTkFNRTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYXNFbmQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmVuZFNldF87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNFbmQoKSByZXR1cm5zIHRydWUuXG4gICAgICovXG4gICAgZ2V0SW5kZXhFbmRWYWx1ZSgpIHtcbiAgICAgICAgYXNzZXJ0KHRoaXMuZW5kU2V0XywgJ09ubHkgdmFsaWQgaWYgZW5kIGhhcyBiZWVuIHNldCcpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleEVuZFZhbHVlXztcbiAgICB9XG4gICAgLyoqXG4gICAgICogT25seSB2YWxpZCB0byBjYWxsIGlmIGhhc0VuZCgpIHJldHVybnMgdHJ1ZS5cbiAgICAgKiBSZXR1cm5zIHRoZSBlbmQga2V5IG5hbWUgZm9yIHRoZSByYW5nZSBkZWZpbmVkIGJ5IHRoZXNlIHF1ZXJ5IHBhcmFtZXRlcnNcbiAgICAgKi9cbiAgICBnZXRJbmRleEVuZE5hbWUoKSB7XG4gICAgICAgIGFzc2VydCh0aGlzLmVuZFNldF8sICdPbmx5IHZhbGlkIGlmIGVuZCBoYXMgYmVlbiBzZXQnKTtcbiAgICAgICAgaWYgKHRoaXMuZW5kTmFtZVNldF8pIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmluZGV4RW5kTmFtZV87XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gTUFYX05BTUU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFzTGltaXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpbWl0U2V0XztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVHJ1ZSBpZiBhIGxpbWl0IGhhcyBiZWVuIHNldCBhbmQgaXQgaGFzIGJlZW4gZXhwbGljaXRseSBhbmNob3JlZFxuICAgICAqL1xuICAgIGhhc0FuY2hvcmVkTGltaXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxpbWl0U2V0XyAmJiB0aGlzLnZpZXdGcm9tXyAhPT0gJyc7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIE9ubHkgdmFsaWQgdG8gY2FsbCBpZiBoYXNMaW1pdCgpIHJldHVybnMgdHJ1ZVxuICAgICAqL1xuICAgIGdldExpbWl0KCkge1xuICAgICAgICBhc3NlcnQodGhpcy5saW1pdFNldF8sICdPbmx5IHZhbGlkIGlmIGxpbWl0IGhhcyBiZWVuIHNldCcpO1xuICAgICAgICByZXR1cm4gdGhpcy5saW1pdF87XG4gICAgfVxuICAgIGdldEluZGV4KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbmRleF87XG4gICAgfVxuICAgIGxvYWRzQWxsRGF0YSgpIHtcbiAgICAgICAgcmV0dXJuICEodGhpcy5zdGFydFNldF8gfHwgdGhpcy5lbmRTZXRfIHx8IHRoaXMubGltaXRTZXRfKTtcbiAgICB9XG4gICAgaXNEZWZhdWx0KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2Fkc0FsbERhdGEoKSAmJiB0aGlzLmluZGV4XyA9PT0gUFJJT1JJVFlfSU5ERVg7XG4gICAgfVxuICAgIGNvcHkoKSB7XG4gICAgICAgIGNvbnN0IGNvcHkgPSBuZXcgUXVlcnlQYXJhbXMoKTtcbiAgICAgICAgY29weS5saW1pdFNldF8gPSB0aGlzLmxpbWl0U2V0XztcbiAgICAgICAgY29weS5saW1pdF8gPSB0aGlzLmxpbWl0XztcbiAgICAgICAgY29weS5zdGFydFNldF8gPSB0aGlzLnN0YXJ0U2V0XztcbiAgICAgICAgY29weS5zdGFydEFmdGVyU2V0XyA9IHRoaXMuc3RhcnRBZnRlclNldF87XG4gICAgICAgIGNvcHkuaW5kZXhTdGFydFZhbHVlXyA9IHRoaXMuaW5kZXhTdGFydFZhbHVlXztcbiAgICAgICAgY29weS5zdGFydE5hbWVTZXRfID0gdGhpcy5zdGFydE5hbWVTZXRfO1xuICAgICAgICBjb3B5LmluZGV4U3RhcnROYW1lXyA9IHRoaXMuaW5kZXhTdGFydE5hbWVfO1xuICAgICAgICBjb3B5LmVuZFNldF8gPSB0aGlzLmVuZFNldF87XG4gICAgICAgIGNvcHkuZW5kQmVmb3JlU2V0XyA9IHRoaXMuZW5kQmVmb3JlU2V0XztcbiAgICAgICAgY29weS5pbmRleEVuZFZhbHVlXyA9IHRoaXMuaW5kZXhFbmRWYWx1ZV87XG4gICAgICAgIGNvcHkuZW5kTmFtZVNldF8gPSB0aGlzLmVuZE5hbWVTZXRfO1xuICAgICAgICBjb3B5LmluZGV4RW5kTmFtZV8gPSB0aGlzLmluZGV4RW5kTmFtZV87XG4gICAgICAgIGNvcHkuaW5kZXhfID0gdGhpcy5pbmRleF87XG4gICAgICAgIGNvcHkudmlld0Zyb21fID0gdGhpcy52aWV3RnJvbV87XG4gICAgICAgIHJldHVybiBjb3B5O1xuICAgIH1cbn1cbmZ1bmN0aW9uIHF1ZXJ5UGFyYW1zR2V0Tm9kZUZpbHRlcihxdWVyeVBhcmFtcykge1xuICAgIGlmIChxdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkge1xuICAgICAgICByZXR1cm4gbmV3IEluZGV4ZWRGaWx0ZXIocXVlcnlQYXJhbXMuZ2V0SW5kZXgoKSk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHF1ZXJ5UGFyYW1zLmhhc0xpbWl0KCkpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBMaW1pdGVkRmlsdGVyKHF1ZXJ5UGFyYW1zKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBuZXcgUmFuZ2VkRmlsdGVyKHF1ZXJ5UGFyYW1zKTtcbiAgICB9XG59XG5mdW5jdGlvbiBxdWVyeVBhcmFtc0xpbWl0VG9GaXJzdChxdWVyeVBhcmFtcywgbmV3TGltaXQpIHtcbiAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtcy5jb3B5KCk7XG4gICAgbmV3UGFyYW1zLmxpbWl0U2V0XyA9IHRydWU7XG4gICAgbmV3UGFyYW1zLmxpbWl0XyA9IG5ld0xpbWl0O1xuICAgIG5ld1BhcmFtcy52aWV3RnJvbV8gPSBcImxcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST01fTEVGVCAqLztcbiAgICByZXR1cm4gbmV3UGFyYW1zO1xufVxuZnVuY3Rpb24gcXVlcnlQYXJhbXNMaW1pdFRvTGFzdChxdWVyeVBhcmFtcywgbmV3TGltaXQpIHtcbiAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtcy5jb3B5KCk7XG4gICAgbmV3UGFyYW1zLmxpbWl0U2V0XyA9IHRydWU7XG4gICAgbmV3UGFyYW1zLmxpbWl0XyA9IG5ld0xpbWl0O1xuICAgIG5ld1BhcmFtcy52aWV3RnJvbV8gPSBcInJcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST01fUklHSFQgKi87XG4gICAgcmV0dXJuIG5ld1BhcmFtcztcbn1cbmZ1bmN0aW9uIHF1ZXJ5UGFyYW1zU3RhcnRBdChxdWVyeVBhcmFtcywgaW5kZXhWYWx1ZSwga2V5KSB7XG4gICAgY29uc3QgbmV3UGFyYW1zID0gcXVlcnlQYXJhbXMuY29weSgpO1xuICAgIG5ld1BhcmFtcy5zdGFydFNldF8gPSB0cnVlO1xuICAgIGlmIChpbmRleFZhbHVlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaW5kZXhWYWx1ZSA9IG51bGw7XG4gICAgfVxuICAgIG5ld1BhcmFtcy5pbmRleFN0YXJ0VmFsdWVfID0gaW5kZXhWYWx1ZTtcbiAgICBpZiAoa2V5ICE9IG51bGwpIHtcbiAgICAgICAgbmV3UGFyYW1zLnN0YXJ0TmFtZVNldF8gPSB0cnVlO1xuICAgICAgICBuZXdQYXJhbXMuaW5kZXhTdGFydE5hbWVfID0ga2V5O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbmV3UGFyYW1zLnN0YXJ0TmFtZVNldF8gPSBmYWxzZTtcbiAgICAgICAgbmV3UGFyYW1zLmluZGV4U3RhcnROYW1lXyA9ICcnO1xuICAgIH1cbiAgICByZXR1cm4gbmV3UGFyYW1zO1xufVxuZnVuY3Rpb24gcXVlcnlQYXJhbXNTdGFydEFmdGVyKHF1ZXJ5UGFyYW1zLCBpbmRleFZhbHVlLCBrZXkpIHtcbiAgICBsZXQgcGFyYW1zO1xuICAgIGlmIChxdWVyeVBhcmFtcy5pbmRleF8gPT09IEtFWV9JTkRFWCB8fCAhIWtleSkge1xuICAgICAgICBwYXJhbXMgPSBxdWVyeVBhcmFtc1N0YXJ0QXQocXVlcnlQYXJhbXMsIGluZGV4VmFsdWUsIGtleSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBwYXJhbXMgPSBxdWVyeVBhcmFtc1N0YXJ0QXQocXVlcnlQYXJhbXMsIGluZGV4VmFsdWUsIE1BWF9OQU1FKTtcbiAgICB9XG4gICAgcGFyYW1zLnN0YXJ0QWZ0ZXJTZXRfID0gdHJ1ZTtcbiAgICByZXR1cm4gcGFyYW1zO1xufVxuZnVuY3Rpb24gcXVlcnlQYXJhbXNFbmRBdChxdWVyeVBhcmFtcywgaW5kZXhWYWx1ZSwga2V5KSB7XG4gICAgY29uc3QgbmV3UGFyYW1zID0gcXVlcnlQYXJhbXMuY29weSgpO1xuICAgIG5ld1BhcmFtcy5lbmRTZXRfID0gdHJ1ZTtcbiAgICBpZiAoaW5kZXhWYWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGluZGV4VmFsdWUgPSBudWxsO1xuICAgIH1cbiAgICBuZXdQYXJhbXMuaW5kZXhFbmRWYWx1ZV8gPSBpbmRleFZhbHVlO1xuICAgIGlmIChrZXkgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBuZXdQYXJhbXMuZW5kTmFtZVNldF8gPSB0cnVlO1xuICAgICAgICBuZXdQYXJhbXMuaW5kZXhFbmROYW1lXyA9IGtleTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG5ld1BhcmFtcy5lbmROYW1lU2V0XyA9IGZhbHNlO1xuICAgICAgICBuZXdQYXJhbXMuaW5kZXhFbmROYW1lXyA9ICcnO1xuICAgIH1cbiAgICByZXR1cm4gbmV3UGFyYW1zO1xufVxuZnVuY3Rpb24gcXVlcnlQYXJhbXNFbmRCZWZvcmUocXVlcnlQYXJhbXMsIGluZGV4VmFsdWUsIGtleSkge1xuICAgIGxldCBwYXJhbXM7XG4gICAgaWYgKHF1ZXJ5UGFyYW1zLmluZGV4XyA9PT0gS0VZX0lOREVYIHx8ICEha2V5KSB7XG4gICAgICAgIHBhcmFtcyA9IHF1ZXJ5UGFyYW1zRW5kQXQocXVlcnlQYXJhbXMsIGluZGV4VmFsdWUsIGtleSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBwYXJhbXMgPSBxdWVyeVBhcmFtc0VuZEF0KHF1ZXJ5UGFyYW1zLCBpbmRleFZhbHVlLCBNSU5fTkFNRSk7XG4gICAgfVxuICAgIHBhcmFtcy5lbmRCZWZvcmVTZXRfID0gdHJ1ZTtcbiAgICByZXR1cm4gcGFyYW1zO1xufVxuZnVuY3Rpb24gcXVlcnlQYXJhbXNPcmRlckJ5KHF1ZXJ5UGFyYW1zLCBpbmRleCkge1xuICAgIGNvbnN0IG5ld1BhcmFtcyA9IHF1ZXJ5UGFyYW1zLmNvcHkoKTtcbiAgICBuZXdQYXJhbXMuaW5kZXhfID0gaW5kZXg7XG4gICAgcmV0dXJuIG5ld1BhcmFtcztcbn1cbi8qKlxuICogUmV0dXJucyBhIHNldCBvZiBSRVNUIHF1ZXJ5IHN0cmluZyBwYXJhbWV0ZXJzIHJlcHJlc2VudGluZyB0aGlzIHF1ZXJ5LlxuICpcbiAqIEByZXR1cm5zIHF1ZXJ5IHN0cmluZyBwYXJhbWV0ZXJzXG4gKi9cbmZ1bmN0aW9uIHF1ZXJ5UGFyYW1zVG9SZXN0UXVlcnlTdHJpbmdQYXJhbWV0ZXJzKHF1ZXJ5UGFyYW1zKSB7XG4gICAgY29uc3QgcXMgPSB7fTtcbiAgICBpZiAocXVlcnlQYXJhbXMuaXNEZWZhdWx0KCkpIHtcbiAgICAgICAgcmV0dXJuIHFzO1xuICAgIH1cbiAgICBsZXQgb3JkZXJCeTtcbiAgICBpZiAocXVlcnlQYXJhbXMuaW5kZXhfID09PSBQUklPUklUWV9JTkRFWCkge1xuICAgICAgICBvcmRlckJ5ID0gXCIkcHJpb3JpdHlcIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5QUklPUklUWV9JTkRFWCAqLztcbiAgICB9XG4gICAgZWxzZSBpZiAocXVlcnlQYXJhbXMuaW5kZXhfID09PSBWQUxVRV9JTkRFWCkge1xuICAgICAgICBvcmRlckJ5ID0gXCIkdmFsdWVcIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5WQUxVRV9JTkRFWCAqLztcbiAgICB9XG4gICAgZWxzZSBpZiAocXVlcnlQYXJhbXMuaW5kZXhfID09PSBLRVlfSU5ERVgpIHtcbiAgICAgICAgb3JkZXJCeSA9IFwiJGtleVwiIC8qIFJFU1RfUVVFUllfQ09OU1RBTlRTLktFWV9JTkRFWCAqLztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGFzc2VydChxdWVyeVBhcmFtcy5pbmRleF8gaW5zdGFuY2VvZiBQYXRoSW5kZXgsICdVbnJlY29nbml6ZWQgaW5kZXggdHlwZSEnKTtcbiAgICAgICAgb3JkZXJCeSA9IHF1ZXJ5UGFyYW1zLmluZGV4Xy50b1N0cmluZygpO1xuICAgIH1cbiAgICBxc1tcIm9yZGVyQnlcIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5PUkRFUl9CWSAqL10gPSBzdHJpbmdpZnkob3JkZXJCeSk7XG4gICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0U2V0Xykge1xuICAgICAgICBjb25zdCBzdGFydFBhcmFtID0gcXVlcnlQYXJhbXMuc3RhcnRBZnRlclNldF9cbiAgICAgICAgICAgID8gXCJzdGFydEFmdGVyXCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuU1RBUlRfQUZURVIgKi9cbiAgICAgICAgICAgIDogXCJzdGFydEF0XCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuU1RBUlRfQVQgKi87XG4gICAgICAgIHFzW3N0YXJ0UGFyYW1dID0gc3RyaW5naWZ5KHF1ZXJ5UGFyYW1zLmluZGV4U3RhcnRWYWx1ZV8pO1xuICAgICAgICBpZiAocXVlcnlQYXJhbXMuc3RhcnROYW1lU2V0Xykge1xuICAgICAgICAgICAgcXNbc3RhcnRQYXJhbV0gKz0gJywnICsgc3RyaW5naWZ5KHF1ZXJ5UGFyYW1zLmluZGV4U3RhcnROYW1lXyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5UGFyYW1zLmVuZFNldF8pIHtcbiAgICAgICAgY29uc3QgZW5kUGFyYW0gPSBxdWVyeVBhcmFtcy5lbmRCZWZvcmVTZXRfXG4gICAgICAgICAgICA/IFwiZW5kQmVmb3JlXCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuRU5EX0JFRk9SRSAqL1xuICAgICAgICAgICAgOiBcImVuZEF0XCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuRU5EX0FUICovO1xuICAgICAgICBxc1tlbmRQYXJhbV0gPSBzdHJpbmdpZnkocXVlcnlQYXJhbXMuaW5kZXhFbmRWYWx1ZV8pO1xuICAgICAgICBpZiAocXVlcnlQYXJhbXMuZW5kTmFtZVNldF8pIHtcbiAgICAgICAgICAgIHFzW2VuZFBhcmFtXSArPSAnLCcgKyBzdHJpbmdpZnkocXVlcnlQYXJhbXMuaW5kZXhFbmROYW1lXyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5UGFyYW1zLmxpbWl0U2V0Xykge1xuICAgICAgICBpZiAocXVlcnlQYXJhbXMuaXNWaWV3RnJvbUxlZnQoKSkge1xuICAgICAgICAgICAgcXNbXCJsaW1pdFRvRmlyc3RcIiAvKiBSRVNUX1FVRVJZX0NPTlNUQU5UUy5MSU1JVF9UT19GSVJTVCAqL10gPSBxdWVyeVBhcmFtcy5saW1pdF87XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBxc1tcImxpbWl0VG9MYXN0XCIgLyogUkVTVF9RVUVSWV9DT05TVEFOVFMuTElNSVRfVE9fTEFTVCAqL10gPSBxdWVyeVBhcmFtcy5saW1pdF87XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHFzO1xufVxuZnVuY3Rpb24gcXVlcnlQYXJhbXNHZXRRdWVyeU9iamVjdChxdWVyeVBhcmFtcykge1xuICAgIGNvbnN0IG9iaiA9IHt9O1xuICAgIGlmIChxdWVyeVBhcmFtcy5zdGFydFNldF8pIHtcbiAgICAgICAgb2JqW1wic3BcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9TVEFSVF9WQUxVRSAqL10gPVxuICAgICAgICAgICAgcXVlcnlQYXJhbXMuaW5kZXhTdGFydFZhbHVlXztcbiAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLnN0YXJ0TmFtZVNldF8pIHtcbiAgICAgICAgICAgIG9ialtcInNuXCIgLyogV0lSRV9QUk9UT0NPTF9DT05TVEFOVFMuSU5ERVhfU1RBUlRfTkFNRSAqL10gPVxuICAgICAgICAgICAgICAgIHF1ZXJ5UGFyYW1zLmluZGV4U3RhcnROYW1lXztcbiAgICAgICAgfVxuICAgICAgICBvYmpbXCJzaW5cIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9TVEFSVF9JU19JTkNMVVNJVkUgKi9dID1cbiAgICAgICAgICAgICFxdWVyeVBhcmFtcy5zdGFydEFmdGVyU2V0XztcbiAgICB9XG4gICAgaWYgKHF1ZXJ5UGFyYW1zLmVuZFNldF8pIHtcbiAgICAgICAgb2JqW1wiZXBcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9FTkRfVkFMVUUgKi9dID0gcXVlcnlQYXJhbXMuaW5kZXhFbmRWYWx1ZV87XG4gICAgICAgIGlmIChxdWVyeVBhcmFtcy5lbmROYW1lU2V0Xykge1xuICAgICAgICAgICAgb2JqW1wiZW5cIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5JTkRFWF9FTkRfTkFNRSAqL10gPSBxdWVyeVBhcmFtcy5pbmRleEVuZE5hbWVfO1xuICAgICAgICB9XG4gICAgICAgIG9ialtcImVpblwiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLklOREVYX0VORF9JU19JTkNMVVNJVkUgKi9dID1cbiAgICAgICAgICAgICFxdWVyeVBhcmFtcy5lbmRCZWZvcmVTZXRfO1xuICAgIH1cbiAgICBpZiAocXVlcnlQYXJhbXMubGltaXRTZXRfKSB7XG4gICAgICAgIG9ialtcImxcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5MSU1JVCAqL10gPSBxdWVyeVBhcmFtcy5saW1pdF87XG4gICAgICAgIGxldCB2aWV3RnJvbSA9IHF1ZXJ5UGFyYW1zLnZpZXdGcm9tXztcbiAgICAgICAgaWYgKHZpZXdGcm9tID09PSAnJykge1xuICAgICAgICAgICAgaWYgKHF1ZXJ5UGFyYW1zLmlzVmlld0Zyb21MZWZ0KCkpIHtcbiAgICAgICAgICAgICAgICB2aWV3RnJvbSA9IFwibFwiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLlZJRVdfRlJPTV9MRUZUICovO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmlld0Zyb20gPSBcInJcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST01fUklHSFQgKi87XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgb2JqW1widmZcIiAvKiBXSVJFX1BST1RPQ09MX0NPTlNUQU5UUy5WSUVXX0ZST00gKi9dID0gdmlld0Zyb207XG4gICAgfVxuICAgIC8vIEZvciBub3csIHByaW9yaXR5IGluZGV4IGlzIHRoZSBkZWZhdWx0LCBzbyB3ZSBvbmx5IHNwZWNpZnkgaWYgaXQncyBzb21lIG90aGVyIGluZGV4XG4gICAgaWYgKHF1ZXJ5UGFyYW1zLmluZGV4XyAhPT0gUFJJT1JJVFlfSU5ERVgpIHtcbiAgICAgICAgb2JqW1wiaVwiIC8qIFdJUkVfUFJPVE9DT0xfQ09OU1RBTlRTLklOREVYICovXSA9IHF1ZXJ5UGFyYW1zLmluZGV4Xy50b1N0cmluZygpO1xuICAgIH1cbiAgICByZXR1cm4gb2JqO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBTZXJ2ZXJBY3Rpb25zIHRoYXQgY29tbXVuaWNhdGVzIHdpdGggdGhlIHNlcnZlciB2aWEgUkVTVCByZXF1ZXN0cy5cbiAqIFRoaXMgaXMgbW9zdGx5IHVzZWZ1bCBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIGNyYXdsZXJzLCB3aGVyZSB3ZSBkb24ndCB3YW50IHRvIHNwaW4gdXAgYSBmdWxsXG4gKiBwZXJzaXN0ZW50IGNvbm5lY3Rpb24gKHVzaW5nIFdlYlNvY2tldHMgb3IgbG9uZy1wb2xsaW5nKVxuICovXG5jbGFzcyBSZWFkb25seVJlc3RDbGllbnQgZXh0ZW5kcyBTZXJ2ZXJBY3Rpb25zIHtcbiAgICByZXBvcnRTdGF0cyhzdGF0cykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01ldGhvZCBub3QgaW1wbGVtZW50ZWQuJyk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRMaXN0ZW5JZF8ocXVlcnksIHRhZykge1xuICAgICAgICBpZiAodGFnICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIHJldHVybiAndGFnJCcgKyB0YWc7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhc3NlcnQocXVlcnkuX3F1ZXJ5UGFyYW1zLmlzRGVmYXVsdCgpLCBcInNob3VsZCBoYXZlIGEgdGFnIGlmIGl0J3Mgbm90IGEgZGVmYXVsdCBxdWVyeS5cIik7XG4gICAgICAgICAgICByZXR1cm4gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcGFyYW0gcmVwb0luZm9fIC0gRGF0YSBhYm91dCB0aGUgbmFtZXNwYWNlIHdlIGFyZSBjb25uZWN0aW5nIHRvXG4gICAgICogQHBhcmFtIG9uRGF0YVVwZGF0ZV8gLSBBIGNhbGxiYWNrIGZvciBuZXcgZGF0YSBmcm9tIHRoZSBzZXJ2ZXJcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihyZXBvSW5mb18sIG9uRGF0YVVwZGF0ZV8sIGF1dGhUb2tlblByb3ZpZGVyXywgYXBwQ2hlY2tUb2tlblByb3ZpZGVyXykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLnJlcG9JbmZvXyA9IHJlcG9JbmZvXztcbiAgICAgICAgdGhpcy5vbkRhdGFVcGRhdGVfID0gb25EYXRhVXBkYXRlXztcbiAgICAgICAgdGhpcy5hdXRoVG9rZW5Qcm92aWRlcl8gPSBhdXRoVG9rZW5Qcm92aWRlcl87XG4gICAgICAgIHRoaXMuYXBwQ2hlY2tUb2tlblByb3ZpZGVyXyA9IGFwcENoZWNrVG9rZW5Qcm92aWRlcl87XG4gICAgICAgIC8qKiBAcHJpdmF0ZSB7ZnVuY3Rpb24oLi4uWypdKX0gKi9cbiAgICAgICAgdGhpcy5sb2dfID0gbG9nV3JhcHBlcigncDpyZXN0OicpO1xuICAgICAgICAvKipcbiAgICAgICAgICogV2UgZG9uJ3QgYWN0dWFsbHkgbmVlZCB0byB0cmFjayBsaXN0ZW5zLCBleGNlcHQgdG8gcHJldmVudCB1cyBjYWxsaW5nIGFuIG9uQ29tcGxldGUgZm9yIGEgbGlzdGVuXG4gICAgICAgICAqIHRoYXQncyBiZWVuIHJlbW92ZWQuIDotL1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5saXN0ZW5zXyA9IHt9O1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICBsaXN0ZW4ocXVlcnksIGN1cnJlbnRIYXNoRm4sIHRhZywgb25Db21wbGV0ZSkge1xuICAgICAgICBjb25zdCBwYXRoU3RyaW5nID0gcXVlcnkuX3BhdGgudG9TdHJpbmcoKTtcbiAgICAgICAgdGhpcy5sb2dfKCdMaXN0ZW4gY2FsbGVkIGZvciAnICsgcGF0aFN0cmluZyArICcgJyArIHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXIpO1xuICAgICAgICAvLyBNYXJrIHRoaXMgbGlzdGVuZXIgc28gd2UgY2FuIHRlbGwgaWYgaXQncyByZW1vdmVkLlxuICAgICAgICBjb25zdCBsaXN0ZW5JZCA9IFJlYWRvbmx5UmVzdENsaWVudC5nZXRMaXN0ZW5JZF8ocXVlcnksIHRhZyk7XG4gICAgICAgIGNvbnN0IHRoaXNMaXN0ZW4gPSB7fTtcbiAgICAgICAgdGhpcy5saXN0ZW5zX1tsaXN0ZW5JZF0gPSB0aGlzTGlzdGVuO1xuICAgICAgICBjb25zdCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMgPSBxdWVyeVBhcmFtc1RvUmVzdFF1ZXJ5U3RyaW5nUGFyYW1ldGVycyhxdWVyeS5fcXVlcnlQYXJhbXMpO1xuICAgICAgICB0aGlzLnJlc3RSZXF1ZXN0XyhwYXRoU3RyaW5nICsgJy5qc29uJywgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzLCAoZXJyb3IsIHJlc3VsdCkgPT4ge1xuICAgICAgICAgICAgbGV0IGRhdGEgPSByZXN1bHQ7XG4gICAgICAgICAgICBpZiAoZXJyb3IgPT09IDQwNCkge1xuICAgICAgICAgICAgICAgIGRhdGEgPSBudWxsO1xuICAgICAgICAgICAgICAgIGVycm9yID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlcnJvciA9PT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIHRoaXMub25EYXRhVXBkYXRlXyhwYXRoU3RyaW5nLCBkYXRhLCAvKmlzTWVyZ2U9Ki8gZmFsc2UsIHRhZyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoc2FmZUdldCh0aGlzLmxpc3RlbnNfLCBsaXN0ZW5JZCkgPT09IHRoaXNMaXN0ZW4pIHtcbiAgICAgICAgICAgICAgICBsZXQgc3RhdHVzO1xuICAgICAgICAgICAgICAgIGlmICghZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gJ29rJztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoZXJyb3IgPT09IDQwMSkge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAncGVybWlzc2lvbl9kZW5pZWQnO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gJ3Jlc3RfZXJyb3I6JyArIGVycm9yO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBvbkNvbXBsZXRlKHN0YXR1cywgbnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICB1bmxpc3RlbihxdWVyeSwgdGFnKSB7XG4gICAgICAgIGNvbnN0IGxpc3RlbklkID0gUmVhZG9ubHlSZXN0Q2xpZW50LmdldExpc3RlbklkXyhxdWVyeSwgdGFnKTtcbiAgICAgICAgZGVsZXRlIHRoaXMubGlzdGVuc19bbGlzdGVuSWRdO1xuICAgIH1cbiAgICBnZXQocXVlcnkpIHtcbiAgICAgICAgY29uc3QgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzID0gcXVlcnlQYXJhbXNUb1Jlc3RRdWVyeVN0cmluZ1BhcmFtZXRlcnMocXVlcnkuX3F1ZXJ5UGFyYW1zKTtcbiAgICAgICAgY29uc3QgcGF0aFN0cmluZyA9IHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgICAgIHRoaXMucmVzdFJlcXVlc3RfKHBhdGhTdHJpbmcgKyAnLmpzb24nLCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMsIChlcnJvciwgcmVzdWx0KSA9PiB7XG4gICAgICAgICAgICBsZXQgZGF0YSA9IHJlc3VsdDtcbiAgICAgICAgICAgIGlmIChlcnJvciA9PT0gNDA0KSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZXJyb3IgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGVycm9yID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkRhdGFVcGRhdGVfKHBhdGhTdHJpbmcsIGRhdGEsIFxuICAgICAgICAgICAgICAgIC8qaXNNZXJnZT0qLyBmYWxzZSwgXG4gICAgICAgICAgICAgICAgLyp0YWc9Ki8gbnVsbCk7XG4gICAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChuZXcgRXJyb3IoZGF0YSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgIHJlZnJlc2hBdXRoVG9rZW4odG9rZW4pIHtcbiAgICAgICAgLy8gbm8tb3Agc2luY2Ugd2UganVzdCBhbHdheXMgY2FsbCBnZXRUb2tlbi5cbiAgICB9XG4gICAgLyoqXG4gICAgICogUGVyZm9ybXMgYSBSRVNUIHJlcXVlc3QgdG8gdGhlIGdpdmVuIHBhdGgsIHdpdGggdGhlIHByb3ZpZGVkIHF1ZXJ5IHN0cmluZyBwYXJhbWV0ZXJzLFxuICAgICAqIGFuZCBhbnkgYXV0aCBjcmVkZW50aWFscyB3ZSBoYXZlLlxuICAgICAqL1xuICAgIHJlc3RSZXF1ZXN0XyhwYXRoU3RyaW5nLCBxdWVyeVN0cmluZ1BhcmFtZXRlcnMgPSB7fSwgY2FsbGJhY2spIHtcbiAgICAgICAgcXVlcnlTdHJpbmdQYXJhbWV0ZXJzWydmb3JtYXQnXSA9ICdleHBvcnQnO1xuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwoW1xuICAgICAgICAgICAgdGhpcy5hdXRoVG9rZW5Qcm92aWRlcl8uZ2V0VG9rZW4oLypmb3JjZVJlZnJlc2g9Ki8gZmFsc2UpLFxuICAgICAgICAgICAgdGhpcy5hcHBDaGVja1Rva2VuUHJvdmlkZXJfLmdldFRva2VuKC8qZm9yY2VSZWZyZXNoPSovIGZhbHNlKVxuICAgICAgICBdKS50aGVuKChbYXV0aFRva2VuLCBhcHBDaGVja1Rva2VuXSkgPT4ge1xuICAgICAgICAgICAgaWYgKGF1dGhUb2tlbiAmJiBhdXRoVG9rZW4uYWNjZXNzVG9rZW4pIHtcbiAgICAgICAgICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnNbJ2F1dGgnXSA9IGF1dGhUb2tlbi5hY2Nlc3NUb2tlbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChhcHBDaGVja1Rva2VuICYmIGFwcENoZWNrVG9rZW4udG9rZW4pIHtcbiAgICAgICAgICAgICAgICBxdWVyeVN0cmluZ1BhcmFtZXRlcnNbJ2FjJ10gPSBhcHBDaGVja1Rva2VuLnRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdXJsID0gKHRoaXMucmVwb0luZm9fLnNlY3VyZSA/ICdodHRwczovLycgOiAnaHR0cDovLycpICtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9JbmZvXy5ob3N0ICtcbiAgICAgICAgICAgICAgICBwYXRoU3RyaW5nICtcbiAgICAgICAgICAgICAgICAnPycgK1xuICAgICAgICAgICAgICAgICducz0nICtcbiAgICAgICAgICAgICAgICB0aGlzLnJlcG9JbmZvXy5uYW1lc3BhY2UgK1xuICAgICAgICAgICAgICAgIHF1ZXJ5c3RyaW5nKHF1ZXJ5U3RyaW5nUGFyYW1ldGVycyk7XG4gICAgICAgICAgICB0aGlzLmxvZ18oJ1NlbmRpbmcgUkVTVCByZXF1ZXN0IGZvciAnICsgdXJsKTtcbiAgICAgICAgICAgIGNvbnN0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9ICgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoY2FsbGJhY2sgJiYgeGhyLnJlYWR5U3RhdGUgPT09IDQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5sb2dfKCdSRVNUIFJlc3BvbnNlIGZvciAnICsgdXJsICsgJyByZWNlaXZlZC4gc3RhdHVzOicsIHhoci5zdGF0dXMsICdyZXNwb25zZTonLCB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlcyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIGlmICh4aHIuc3RhdHVzID49IDIwMCAmJiB4aHIuc3RhdHVzIDwgMzAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcyA9IGpzb25FdmFsKHhoci5yZXNwb25zZVRleHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YXJuKCdGYWlsZWQgdG8gcGFyc2UgSlNPTiByZXNwb25zZSBmb3IgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc6ICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyA0MDEgYW5kIDQwNCBhcmUgZXhwZWN0ZWQuXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoeGhyLnN0YXR1cyAhPT0gNDAxICYmIHhoci5zdGF0dXMgIT09IDQwNCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdhcm4oJ0dvdCB1bnN1Y2Nlc3NmdWwgUkVTVCByZXNwb25zZSBmb3IgJyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVybCArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICcgU3RhdHVzOiAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeGhyLnN0YXR1cyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayh4aHIuc3RhdHVzKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFjayA9IG51bGw7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIHhoci5vcGVuKCdHRVQnLCB1cmwsIC8qYXN5bmNocm9ub3VzPSovIHRydWUpO1xuICAgICAgICAgICAgeGhyLnNlbmQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBNdXRhYmxlIG9iamVjdCB3aGljaCBiYXNpY2FsbHkganVzdCBzdG9yZXMgYSByZWZlcmVuY2UgdG8gdGhlIFwibGF0ZXN0XCIgaW1tdXRhYmxlIHNuYXBzaG90LlxuICovXG5jbGFzcyBTbmFwc2hvdEhvbGRlciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucm9vdE5vZGVfID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgfVxuICAgIGdldE5vZGUocGF0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yb290Tm9kZV8uZ2V0Q2hpbGQocGF0aCk7XG4gICAgfVxuICAgIHVwZGF0ZVNuYXBzaG90KHBhdGgsIG5ld1NuYXBzaG90Tm9kZSkge1xuICAgICAgICB0aGlzLnJvb3ROb2RlXyA9IHRoaXMucm9vdE5vZGVfLnVwZGF0ZUNoaWxkKHBhdGgsIG5ld1NuYXBzaG90Tm9kZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gbmV3U3BhcnNlU25hcHNob3RUcmVlKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHZhbHVlOiBudWxsLFxuICAgICAgICBjaGlsZHJlbjogbmV3IE1hcCgpXG4gICAgfTtcbn1cbi8qKlxuICogU3RvcmVzIHRoZSBnaXZlbiBub2RlIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC4gSWYgdGhlcmUgaXMgYWxyZWFkeSBhIG5vZGVcbiAqIGF0IGEgc2hhbGxvd2VyIHBhdGgsIGl0IG1lcmdlcyB0aGUgbmV3IGRhdGEgaW50byB0aGF0IHNuYXBzaG90IG5vZGUuXG4gKlxuICogQHBhcmFtIHBhdGggLSBQYXRoIHRvIGxvb2sgdXAgc25hcHNob3QgZm9yLlxuICogQHBhcmFtIGRhdGEgLSBUaGUgbmV3IGRhdGEsIG9yIG51bGwuXG4gKi9cbmZ1bmN0aW9uIHNwYXJzZVNuYXBzaG90VHJlZVJlbWVtYmVyKHNwYXJzZVNuYXBzaG90VHJlZSwgcGF0aCwgZGF0YSkge1xuICAgIGlmIChwYXRoSXNFbXB0eShwYXRoKSkge1xuICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWUudmFsdWUgPSBkYXRhO1xuICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uY2xlYXIoKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc3BhcnNlU25hcHNob3RUcmVlLnZhbHVlICE9PSBudWxsKSB7XG4gICAgICAgIHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSA9IHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZS51cGRhdGVDaGlsZChwYXRoLCBkYXRhKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KHBhdGgpO1xuICAgICAgICBpZiAoIXNwYXJzZVNuYXBzaG90VHJlZS5jaGlsZHJlbi5oYXMoY2hpbGRLZXkpKSB7XG4gICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uc2V0KGNoaWxkS2V5LCBuZXdTcGFyc2VTbmFwc2hvdFRyZWUoKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpbGQgPSBzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uZ2V0KGNoaWxkS2V5KTtcbiAgICAgICAgcGF0aCA9IHBhdGhQb3BGcm9udChwYXRoKTtcbiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlUmVtZW1iZXIoY2hpbGQsIHBhdGgsIGRhdGEpO1xuICAgIH1cbn1cbi8qKlxuICogUHVyZ2UgdGhlIGRhdGEgYXQgcGF0aCBmcm9tIHRoZSBjYWNoZS5cbiAqXG4gKiBAcGFyYW0gcGF0aCAtIFBhdGggdG8gbG9vayB1cCBzbmFwc2hvdCBmb3IuXG4gKiBAcmV0dXJucyBUcnVlIGlmIHRoaXMgbm9kZSBzaG91bGQgbm93IGJlIHJlbW92ZWQuXG4gKi9cbmZ1bmN0aW9uIHNwYXJzZVNuYXBzaG90VHJlZUZvcmdldChzcGFyc2VTbmFwc2hvdFRyZWUsIHBhdGgpIHtcbiAgICBpZiAocGF0aElzRW1wdHkocGF0aCkpIHtcbiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlLnZhbHVlID0gbnVsbDtcbiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlLmNoaWxkcmVuLmNsZWFyKCk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgaWYgKHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZSAhPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZS5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSdyZSB0cnlpbmcgdG8gZm9yZ2V0IGEgbm9kZSB0aGF0IGRvZXNuJ3QgZXhpc3RcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCB2YWx1ZSA9IHNwYXJzZVNuYXBzaG90VHJlZS52YWx1ZTtcbiAgICAgICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWUudmFsdWUgPSBudWxsO1xuICAgICAgICAgICAgICAgIHZhbHVlLmZvckVhY2hDaGlsZChQUklPUklUWV9JTkRFWCwgKGtleSwgdHJlZSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVSZW1lbWJlcihzcGFyc2VTbmFwc2hvdFRyZWUsIG5ldyBQYXRoKGtleSksIHRyZWUpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIHJldHVybiBzcGFyc2VTbmFwc2hvdFRyZWVGb3JnZXQoc3BhcnNlU25hcHNob3RUcmVlLCBwYXRoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uc2l6ZSA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KHBhdGgpO1xuICAgICAgICAgICAgcGF0aCA9IHBhdGhQb3BGcm9udChwYXRoKTtcbiAgICAgICAgICAgIGlmIChzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uaGFzKGNoaWxkS2V5KSkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHNhZmVUb1JlbW92ZSA9IHNwYXJzZVNuYXBzaG90VHJlZUZvcmdldChzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uZ2V0KGNoaWxkS2V5KSwgcGF0aCk7XG4gICAgICAgICAgICAgICAgaWYgKHNhZmVUb1JlbW92ZSkge1xuICAgICAgICAgICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWUuY2hpbGRyZW4uZGVsZXRlKGNoaWxkS2V5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gc3BhcnNlU25hcHNob3RUcmVlLmNoaWxkcmVuLnNpemUgPT09IDA7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogUmVjdXJzaXZlbHkgaXRlcmF0ZXMgdGhyb3VnaCBhbGwgb2YgdGhlIHN0b3JlZCB0cmVlIGFuZCBjYWxscyB0aGVcbiAqIGNhbGxiYWNrIG9uIGVhY2ggb25lLlxuICpcbiAqIEBwYXJhbSBwcmVmaXhQYXRoIC0gUGF0aCB0byBsb29rIHVwIG5vZGUgZm9yLlxuICogQHBhcmFtIGZ1bmMgLSBUaGUgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIHRyZWUuXG4gKi9cbmZ1bmN0aW9uIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hUcmVlKHNwYXJzZVNuYXBzaG90VHJlZSwgcHJlZml4UGF0aCwgZnVuYykge1xuICAgIGlmIChzcGFyc2VTbmFwc2hvdFRyZWUudmFsdWUgIT09IG51bGwpIHtcbiAgICAgICAgZnVuYyhwcmVmaXhQYXRoLCBzcGFyc2VTbmFwc2hvdFRyZWUudmFsdWUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlRm9yRWFjaENoaWxkKHNwYXJzZVNuYXBzaG90VHJlZSwgKGtleSwgdHJlZSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgcGF0aCA9IG5ldyBQYXRoKHByZWZpeFBhdGgudG9TdHJpbmcoKSArICcvJyArIGtleSk7XG4gICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVGb3JFYWNoVHJlZSh0cmVlLCBwYXRoLCBmdW5jKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBJdGVyYXRlcyB0aHJvdWdoIGVhY2ggaW1tZWRpYXRlIGNoaWxkIGFuZCB0cmlnZ2VycyB0aGUgY2FsbGJhY2suXG4gKiBPbmx5IHNlZW1zIHRvIGJlIHVzZWQgaW4gdGVzdHMuXG4gKlxuICogQHBhcmFtIGZ1bmMgLSBUaGUgZnVuY3Rpb24gdG8gaW52b2tlIGZvciBlYWNoIGNoaWxkLlxuICovXG5mdW5jdGlvbiBzcGFyc2VTbmFwc2hvdFRyZWVGb3JFYWNoQ2hpbGQoc3BhcnNlU25hcHNob3RUcmVlLCBmdW5jKSB7XG4gICAgc3BhcnNlU25hcHNob3RUcmVlLmNoaWxkcmVuLmZvckVhY2goKHRyZWUsIGtleSkgPT4ge1xuICAgICAgICBmdW5jKGtleSwgdHJlZSk7XG4gICAgfSk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFJldHVybnMgdGhlIGRlbHRhIGZyb20gdGhlIHByZXZpb3VzIGNhbGwgdG8gZ2V0IHN0YXRzLlxuICpcbiAqIEBwYXJhbSBjb2xsZWN0aW9uXyAtIFRoZSBjb2xsZWN0aW9uIHRvIFwibGlzdGVuXCIgdG8uXG4gKi9cbmNsYXNzIFN0YXRzTGlzdGVuZXIge1xuICAgIGNvbnN0cnVjdG9yKGNvbGxlY3Rpb25fKSB7XG4gICAgICAgIHRoaXMuY29sbGVjdGlvbl8gPSBjb2xsZWN0aW9uXztcbiAgICAgICAgdGhpcy5sYXN0XyA9IG51bGw7XG4gICAgfVxuICAgIGdldCgpIHtcbiAgICAgICAgY29uc3QgbmV3U3RhdHMgPSB0aGlzLmNvbGxlY3Rpb25fLmdldCgpO1xuICAgICAgICBjb25zdCBkZWx0YSA9IE9iamVjdC5hc3NpZ24oe30sIG5ld1N0YXRzKTtcbiAgICAgICAgaWYgKHRoaXMubGFzdF8pIHtcbiAgICAgICAgICAgIGVhY2godGhpcy5sYXN0XywgKHN0YXQsIHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgZGVsdGFbc3RhdF0gPSBkZWx0YVtzdGF0XSAtIHZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sYXN0XyA9IG5ld1N0YXRzO1xuICAgICAgICByZXR1cm4gZGVsdGE7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gQXNzdW1pbmcgc29tZSBhcHBzIG1heSBoYXZlIGEgc2hvcnQgYW1vdW50IG9mIHRpbWUgb24gcGFnZSwgYW5kIGEgYnVsayBvZiBmaXJlYmFzZSBvcGVyYXRpb25zIHByb2JhYmx5XG4vLyBoYXBwZW4gb24gcGFnZSBsb2FkLCB3ZSB0cnkgdG8gcmVwb3J0IG91ciBmaXJzdCBzZXQgb2Ygc3RhdHMgcHJldHR5IHF1aWNrbHksIGJ1dCB3ZSB3YWl0IGF0IGxlYXN0IDEwXG4vLyBzZWNvbmRzIHRvIHRyeSB0byBlbnN1cmUgdGhlIEZpcmViYXNlIGNvbm5lY3Rpb24gaXMgZXN0YWJsaXNoZWQgLyBzZXR0bGVkLlxuY29uc3QgRklSU1RfU1RBVFNfTUlOX1RJTUUgPSAxMCAqIDEwMDA7XG5jb25zdCBGSVJTVF9TVEFUU19NQVhfVElNRSA9IDMwICogMTAwMDtcbi8vIFdlJ2xsIGNvbnRpbnVlIHRvIHJlcG9ydCBzdGF0cyBvbiBhdmVyYWdlIGV2ZXJ5IDUgbWludXRlcy5cbmNvbnN0IFJFUE9SVF9TVEFUU19JTlRFUlZBTCA9IDUgKiA2MCAqIDEwMDA7XG5jbGFzcyBTdGF0c1JlcG9ydGVyIHtcbiAgICBjb25zdHJ1Y3Rvcihjb2xsZWN0aW9uLCBzZXJ2ZXJfKSB7XG4gICAgICAgIHRoaXMuc2VydmVyXyA9IHNlcnZlcl87XG4gICAgICAgIHRoaXMuc3RhdHNUb1JlcG9ydF8gPSB7fTtcbiAgICAgICAgdGhpcy5zdGF0c0xpc3RlbmVyXyA9IG5ldyBTdGF0c0xpc3RlbmVyKGNvbGxlY3Rpb24pO1xuICAgICAgICBjb25zdCB0aW1lb3V0ID0gRklSU1RfU1RBVFNfTUlOX1RJTUUgK1xuICAgICAgICAgICAgKEZJUlNUX1NUQVRTX01BWF9USU1FIC0gRklSU1RfU1RBVFNfTUlOX1RJTUUpICogTWF0aC5yYW5kb20oKTtcbiAgICAgICAgc2V0VGltZW91dE5vbkJsb2NraW5nKHRoaXMucmVwb3J0U3RhdHNfLmJpbmQodGhpcyksIE1hdGguZmxvb3IodGltZW91dCkpO1xuICAgIH1cbiAgICByZXBvcnRTdGF0c18oKSB7XG4gICAgICAgIGNvbnN0IHN0YXRzID0gdGhpcy5zdGF0c0xpc3RlbmVyXy5nZXQoKTtcbiAgICAgICAgY29uc3QgcmVwb3J0ZWRTdGF0cyA9IHt9O1xuICAgICAgICBsZXQgaGF2ZVN0YXRzVG9SZXBvcnQgPSBmYWxzZTtcbiAgICAgICAgZWFjaChzdGF0cywgKHN0YXQsIHZhbHVlKSA9PiB7XG4gICAgICAgICAgICBpZiAodmFsdWUgPiAwICYmIGNvbnRhaW5zKHRoaXMuc3RhdHNUb1JlcG9ydF8sIHN0YXQpKSB7XG4gICAgICAgICAgICAgICAgcmVwb3J0ZWRTdGF0c1tzdGF0XSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIGhhdmVTdGF0c1RvUmVwb3J0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChoYXZlU3RhdHNUb1JlcG9ydCkge1xuICAgICAgICAgICAgdGhpcy5zZXJ2ZXJfLnJlcG9ydFN0YXRzKHJlcG9ydGVkU3RhdHMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHF1ZXVlIG91ciBuZXh0IHJ1bi5cbiAgICAgICAgc2V0VGltZW91dE5vbkJsb2NraW5nKHRoaXMucmVwb3J0U3RhdHNfLmJpbmQodGhpcyksIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIgKiBSRVBPUlRfU1RBVFNfSU5URVJWQUwpKTtcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqXG4gKiBAZW51bVxuICovXG52YXIgT3BlcmF0aW9uVHlwZTtcbihmdW5jdGlvbiAoT3BlcmF0aW9uVHlwZSkge1xuICAgIE9wZXJhdGlvblR5cGVbT3BlcmF0aW9uVHlwZVtcIk9WRVJXUklURVwiXSA9IDBdID0gXCJPVkVSV1JJVEVcIjtcbiAgICBPcGVyYXRpb25UeXBlW09wZXJhdGlvblR5cGVbXCJNRVJHRVwiXSA9IDFdID0gXCJNRVJHRVwiO1xuICAgIE9wZXJhdGlvblR5cGVbT3BlcmF0aW9uVHlwZVtcIkFDS19VU0VSX1dSSVRFXCJdID0gMl0gPSBcIkFDS19VU0VSX1dSSVRFXCI7XG4gICAgT3BlcmF0aW9uVHlwZVtPcGVyYXRpb25UeXBlW1wiTElTVEVOX0NPTVBMRVRFXCJdID0gM10gPSBcIkxJU1RFTl9DT01QTEVURVwiO1xufSkoT3BlcmF0aW9uVHlwZSB8fCAoT3BlcmF0aW9uVHlwZSA9IHt9KSk7XG5mdW5jdGlvbiBuZXdPcGVyYXRpb25Tb3VyY2VVc2VyKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIGZyb21Vc2VyOiB0cnVlLFxuICAgICAgICBmcm9tU2VydmVyOiBmYWxzZSxcbiAgICAgICAgcXVlcnlJZDogbnVsbCxcbiAgICAgICAgdGFnZ2VkOiBmYWxzZVxuICAgIH07XG59XG5mdW5jdGlvbiBuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXIoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZnJvbVVzZXI6IGZhbHNlLFxuICAgICAgICBmcm9tU2VydmVyOiB0cnVlLFxuICAgICAgICBxdWVyeUlkOiBudWxsLFxuICAgICAgICB0YWdnZWQ6IGZhbHNlXG4gICAgfTtcbn1cbmZ1bmN0aW9uIG5ld09wZXJhdGlvblNvdXJjZVNlcnZlclRhZ2dlZFF1ZXJ5KHF1ZXJ5SWQpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBmcm9tVXNlcjogZmFsc2UsXG4gICAgICAgIGZyb21TZXJ2ZXI6IHRydWUsXG4gICAgICAgIHF1ZXJ5SWQsXG4gICAgICAgIHRhZ2dlZDogdHJ1ZVxuICAgIH07XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBBY2tVc2VyV3JpdGUge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBhZmZlY3RlZFRyZWUgLSBBIHRyZWUgY29udGFpbmluZyB0cnVlIGZvciBlYWNoIGFmZmVjdGVkIHBhdGguIEFmZmVjdGVkIHBhdGhzIGNhbid0IG92ZXJsYXAuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoXG4gICAgLyoqIEBpbmhlcml0RG9jICovIHBhdGgsIFxuICAgIC8qKiBAaW5oZXJpdERvYyAqLyBhZmZlY3RlZFRyZWUsIFxuICAgIC8qKiBAaW5oZXJpdERvYyAqLyByZXZlcnQpIHtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5hZmZlY3RlZFRyZWUgPSBhZmZlY3RlZFRyZWU7XG4gICAgICAgIHRoaXMucmV2ZXJ0ID0gcmV2ZXJ0O1xuICAgICAgICAvKiogQGluaGVyaXREb2MgKi9cbiAgICAgICAgdGhpcy50eXBlID0gT3BlcmF0aW9uVHlwZS5BQ0tfVVNFUl9XUklURTtcbiAgICAgICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgICAgIHRoaXMuc291cmNlID0gbmV3T3BlcmF0aW9uU291cmNlVXNlcigpO1xuICAgIH1cbiAgICBvcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpIHtcbiAgICAgICAgaWYgKCFwYXRoSXNFbXB0eSh0aGlzLnBhdGgpKSB7XG4gICAgICAgICAgICBhc3NlcnQocGF0aEdldEZyb250KHRoaXMucGF0aCkgPT09IGNoaWxkTmFtZSwgJ29wZXJhdGlvbkZvckNoaWxkIGNhbGxlZCBmb3IgdW5yZWxhdGVkIGNoaWxkLicpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBBY2tVc2VyV3JpdGUocGF0aFBvcEZyb250KHRoaXMucGF0aCksIHRoaXMuYWZmZWN0ZWRUcmVlLCB0aGlzLnJldmVydCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5hZmZlY3RlZFRyZWUudmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgYXNzZXJ0KHRoaXMuYWZmZWN0ZWRUcmVlLmNoaWxkcmVuLmlzRW1wdHkoKSwgJ2FmZmVjdGVkVHJlZSBzaG91bGQgbm90IGhhdmUgb3ZlcmxhcHBpbmcgYWZmZWN0ZWQgcGF0aHMuJyk7XG4gICAgICAgICAgICAvLyBBbGwgY2hpbGQgbG9jYXRpb25zIGFyZSBhZmZlY3RlZCBhcyB3ZWxsOyBqdXN0IHJldHVybiBzYW1lIG9wZXJhdGlvbi5cbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gdGhpcy5hZmZlY3RlZFRyZWUuc3VidHJlZShuZXcgUGF0aChjaGlsZE5hbWUpKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQWNrVXNlcldyaXRlKG5ld0VtcHR5UGF0aCgpLCBjaGlsZFRyZWUsIHRoaXMucmV2ZXJ0KTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmNsYXNzIExpc3RlbkNvbXBsZXRlIHtcbiAgICBjb25zdHJ1Y3Rvcihzb3VyY2UsIHBhdGgpIHtcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gICAgICAgIC8qKiBAaW5oZXJpdERvYyAqL1xuICAgICAgICB0aGlzLnR5cGUgPSBPcGVyYXRpb25UeXBlLkxJU1RFTl9DT01QTEVURTtcbiAgICB9XG4gICAgb3BlcmF0aW9uRm9yQ2hpbGQoY2hpbGROYW1lKSB7XG4gICAgICAgIGlmIChwYXRoSXNFbXB0eSh0aGlzLnBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3RlbkNvbXBsZXRlKHRoaXMuc291cmNlLCBuZXdFbXB0eVBhdGgoKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IExpc3RlbkNvbXBsZXRlKHRoaXMuc291cmNlLCBwYXRoUG9wRnJvbnQodGhpcy5wYXRoKSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jbGFzcyBPdmVyd3JpdGUge1xuICAgIGNvbnN0cnVjdG9yKHNvdXJjZSwgcGF0aCwgc25hcCkge1xuICAgICAgICB0aGlzLnNvdXJjZSA9IHNvdXJjZTtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICAgICAgdGhpcy5zbmFwID0gc25hcDtcbiAgICAgICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgICAgIHRoaXMudHlwZSA9IE9wZXJhdGlvblR5cGUuT1ZFUldSSVRFO1xuICAgIH1cbiAgICBvcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpIHtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHRoaXMucGF0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgT3ZlcndyaXRlKHRoaXMuc291cmNlLCBuZXdFbXB0eVBhdGgoKSwgdGhpcy5zbmFwLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBPdmVyd3JpdGUodGhpcy5zb3VyY2UsIHBhdGhQb3BGcm9udCh0aGlzLnBhdGgpLCB0aGlzLnNuYXApO1xuICAgICAgICB9XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgTWVyZ2Uge1xuICAgIGNvbnN0cnVjdG9yKFxuICAgIC8qKiBAaW5oZXJpdERvYyAqLyBzb3VyY2UsIFxuICAgIC8qKiBAaW5oZXJpdERvYyAqLyBwYXRoLCBcbiAgICAvKiogQGluaGVyaXREb2MgKi8gY2hpbGRyZW4pIHtcbiAgICAgICAgdGhpcy5zb3VyY2UgPSBzb3VyY2U7XG4gICAgICAgIHRoaXMucGF0aCA9IHBhdGg7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjtcbiAgICAgICAgLyoqIEBpbmhlcml0RG9jICovXG4gICAgICAgIHRoaXMudHlwZSA9IE9wZXJhdGlvblR5cGUuTUVSR0U7XG4gICAgfVxuICAgIG9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSkge1xuICAgICAgICBpZiAocGF0aElzRW1wdHkodGhpcy5wYXRoKSkge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRUcmVlID0gdGhpcy5jaGlsZHJlbi5zdWJ0cmVlKG5ldyBQYXRoKGNoaWxkTmFtZSkpO1xuICAgICAgICAgICAgaWYgKGNoaWxkVHJlZS5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAvLyBUaGlzIGNoaWxkIGlzIHVuYWZmZWN0ZWRcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNoaWxkVHJlZS52YWx1ZSkge1xuICAgICAgICAgICAgICAgIC8vIFdlIGhhdmUgYSBzbmFwc2hvdCBmb3IgdGhlIGNoaWxkIGluIHF1ZXN0aW9uLiAgVGhpcyBiZWNvbWVzIGFuIG92ZXJ3cml0ZSBvZiB0aGUgY2hpbGQuXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBPdmVyd3JpdGUodGhpcy5zb3VyY2UsIG5ld0VtcHR5UGF0aCgpLCBjaGlsZFRyZWUudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIG1lcmdlIGF0IGEgZGVlcGVyIGxldmVsXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5ldyBNZXJnZSh0aGlzLnNvdXJjZSwgbmV3RW1wdHlQYXRoKCksIGNoaWxkVHJlZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhc3NlcnQocGF0aEdldEZyb250KHRoaXMucGF0aCkgPT09IGNoaWxkTmFtZSwgXCJDYW4ndCBnZXQgYSBtZXJnZSBmb3IgYSBjaGlsZCBub3Qgb24gdGhlIHBhdGggb2YgdGhlIG9wZXJhdGlvblwiKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgTWVyZ2UodGhpcy5zb3VyY2UsIHBhdGhQb3BGcm9udCh0aGlzLnBhdGgpLCB0aGlzLmNoaWxkcmVuKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuICgnT3BlcmF0aW9uKCcgK1xuICAgICAgICAgICAgdGhpcy5wYXRoICtcbiAgICAgICAgICAgICc6ICcgK1xuICAgICAgICAgICAgdGhpcy5zb3VyY2UudG9TdHJpbmcoKSArXG4gICAgICAgICAgICAnIG1lcmdlOiAnICtcbiAgICAgICAgICAgIHRoaXMuY2hpbGRyZW4udG9TdHJpbmcoKSArXG4gICAgICAgICAgICAnKScpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBjYWNoZSBub2RlIG9ubHkgc3RvcmVzIGNvbXBsZXRlIGNoaWxkcmVuLiBBZGRpdGlvbmFsbHkgaXQgaG9sZHMgYSBmbGFnIHdoZXRoZXIgdGhlIG5vZGUgY2FuIGJlIGNvbnNpZGVyZWQgZnVsbHlcbiAqIGluaXRpYWxpemVkIGluIHRoZSBzZW5zZSB0aGF0IHdlIGtub3cgYXQgb25lIHBvaW50IGluIHRpbWUgdGhpcyByZXByZXNlbnRlZCBhIHZhbGlkIHN0YXRlIG9mIHRoZSB3b3JsZCwgZS5nLlxuICogaW5pdGlhbGl6ZWQgd2l0aCBkYXRhIGZyb20gdGhlIHNlcnZlciwgb3IgYSBjb21wbGV0ZSBvdmVyd3JpdGUgYnkgdGhlIGNsaWVudC4gVGhlIGZpbHRlcmVkIGZsYWcgYWxzbyB0cmFja3NcbiAqIHdoZXRoZXIgYSBub2RlIHBvdGVudGlhbGx5IGhhZCBjaGlsZHJlbiByZW1vdmVkIGR1ZSB0byBhIGZpbHRlci5cbiAqL1xuY2xhc3MgQ2FjaGVOb2RlIHtcbiAgICBjb25zdHJ1Y3Rvcihub2RlXywgZnVsbHlJbml0aWFsaXplZF8sIGZpbHRlcmVkXykge1xuICAgICAgICB0aGlzLm5vZGVfID0gbm9kZV87XG4gICAgICAgIHRoaXMuZnVsbHlJbml0aWFsaXplZF8gPSBmdWxseUluaXRpYWxpemVkXztcbiAgICAgICAgdGhpcy5maWx0ZXJlZF8gPSBmaWx0ZXJlZF87XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybnMgd2hldGhlciB0aGlzIG5vZGUgd2FzIGZ1bGx5IGluaXRpYWxpemVkIHdpdGggZWl0aGVyIHNlcnZlciBkYXRhIG9yIGEgY29tcGxldGUgb3ZlcndyaXRlIGJ5IHRoZSBjbGllbnRcbiAgICAgKi9cbiAgICBpc0Z1bGx5SW5pdGlhbGl6ZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZ1bGx5SW5pdGlhbGl6ZWRfO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHdoZXRoZXIgdGhpcyBub2RlIGlzIHBvdGVudGlhbGx5IG1pc3NpbmcgY2hpbGRyZW4gZHVlIHRvIGEgZmlsdGVyIGFwcGxpZWQgdG8gdGhlIG5vZGVcbiAgICAgKi9cbiAgICBpc0ZpbHRlcmVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWx0ZXJlZF87XG4gICAgfVxuICAgIGlzQ29tcGxldGVGb3JQYXRoKHBhdGgpIHtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5maWx0ZXJlZF87XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpbGRLZXkgPSBwYXRoR2V0RnJvbnQocGF0aCk7XG4gICAgICAgIHJldHVybiB0aGlzLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSk7XG4gICAgfVxuICAgIGlzQ29tcGxldGVGb3JDaGlsZChrZXkpIHtcbiAgICAgICAgcmV0dXJuICgodGhpcy5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSAmJiAhdGhpcy5maWx0ZXJlZF8pIHx8IHRoaXMubm9kZV8uaGFzQ2hpbGQoa2V5KSk7XG4gICAgfVxuICAgIGdldE5vZGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5vZGVfO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQW4gRXZlbnRHZW5lcmF0b3IgaXMgdXNlZCB0byBjb252ZXJ0IFwicmF3XCIgY2hhbmdlcyAoQ2hhbmdlKSBhcyBjb21wdXRlZCBieSB0aGVcbiAqIENhY2hlRGlmZmVyIGludG8gYWN0dWFsIGV2ZW50cyAoRXZlbnQpIHRoYXQgY2FuIGJlIHJhaXNlZC4gIFNlZSBnZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXMoKVxuICogZm9yIGRldGFpbHMuXG4gKlxuICovXG5jbGFzcyBFdmVudEdlbmVyYXRvciB7XG4gICAgY29uc3RydWN0b3IocXVlcnlfKSB7XG4gICAgICAgIHRoaXMucXVlcnlfID0gcXVlcnlfO1xuICAgICAgICB0aGlzLmluZGV4XyA9IHRoaXMucXVlcnlfLl9xdWVyeVBhcmFtcy5nZXRJbmRleCgpO1xuICAgIH1cbn1cbi8qKlxuICogR2l2ZW4gYSBzZXQgb2YgcmF3IGNoYW5nZXMgKG5vIG1vdmVkIGV2ZW50cyBhbmQgcHJldk5hbWUgbm90IHNwZWNpZmllZCB5ZXQpLCBhbmQgYSBzZXQgb2ZcbiAqIEV2ZW50UmVnaXN0cmF0aW9ucyB0aGF0IHNob3VsZCBiZSBub3RpZmllZCBvZiB0aGVzZSBjaGFuZ2VzLCBnZW5lcmF0ZSB0aGUgYWN0dWFsIGV2ZW50cyB0byBiZSByYWlzZWQuXG4gKlxuICogTm90ZXM6XG4gKiAgLSBjaGlsZF9tb3ZlZCBldmVudHMgd2lsbCBiZSBzeW50aGVzaXplZCBhdCB0aGlzIHRpbWUgZm9yIGFueSBjaGlsZF9jaGFuZ2VkIGV2ZW50cyB0aGF0IGFmZmVjdFxuICogICAgb3VyIGluZGV4LlxuICogIC0gcHJldk5hbWUgd2lsbCBiZSBjYWxjdWxhdGVkIGJhc2VkIG9uIHRoZSBpbmRleCBvcmRlcmluZy5cbiAqL1xuZnVuY3Rpb24gZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXMoZXZlbnRHZW5lcmF0b3IsIGNoYW5nZXMsIGV2ZW50Q2FjaGUsIGV2ZW50UmVnaXN0cmF0aW9ucykge1xuICAgIGNvbnN0IGV2ZW50cyA9IFtdO1xuICAgIGNvbnN0IG1vdmVzID0gW107XG4gICAgY2hhbmdlcy5mb3JFYWNoKGNoYW5nZSA9PiB7XG4gICAgICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gXCJjaGlsZF9jaGFuZ2VkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovICYmXG4gICAgICAgICAgICBldmVudEdlbmVyYXRvci5pbmRleF8uaW5kZXhlZFZhbHVlQ2hhbmdlZChjaGFuZ2Uub2xkU25hcCwgY2hhbmdlLnNuYXBzaG90Tm9kZSkpIHtcbiAgICAgICAgICAgIG1vdmVzLnB1c2goY2hhbmdlQ2hpbGRNb3ZlZChjaGFuZ2UuY2hpbGROYW1lLCBjaGFuZ2Uuc25hcHNob3ROb2RlKSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yVHlwZShldmVudEdlbmVyYXRvciwgZXZlbnRzLCBcImNoaWxkX3JlbW92ZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8sIGNoYW5nZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7XG4gICAgZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvclR5cGUoZXZlbnRHZW5lcmF0b3IsIGV2ZW50cywgXCJjaGlsZF9hZGRlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfQURERUQgKi8sIGNoYW5nZXMsIGV2ZW50UmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSk7XG4gICAgZXZlbnRHZW5lcmF0b3JHZW5lcmF0ZUV2ZW50c0ZvclR5cGUoZXZlbnRHZW5lcmF0b3IsIGV2ZW50cywgXCJjaGlsZF9tb3ZlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfTU9WRUQgKi8sIG1vdmVzLCBldmVudFJlZ2lzdHJhdGlvbnMsIGV2ZW50Q2FjaGUpO1xuICAgIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JUeXBlKGV2ZW50R2VuZXJhdG9yLCBldmVudHMsIFwiY2hpbGRfY2hhbmdlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfQ0hBTkdFRCAqLywgY2hhbmdlcywgZXZlbnRSZWdpc3RyYXRpb25zLCBldmVudENhY2hlKTtcbiAgICBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yVHlwZShldmVudEdlbmVyYXRvciwgZXZlbnRzLCBcInZhbHVlXCIgLyogQ2hhbmdlVHlwZS5WQUxVRSAqLywgY2hhbmdlcywgZXZlbnRSZWdpc3RyYXRpb25zLCBldmVudENhY2hlKTtcbiAgICByZXR1cm4gZXZlbnRzO1xufVxuLyoqXG4gKiBHaXZlbiBjaGFuZ2VzIG9mIGEgc2luZ2xlIGNoYW5nZSB0eXBlLCBnZW5lcmF0ZSB0aGUgY29ycmVzcG9uZGluZyBldmVudHMuXG4gKi9cbmZ1bmN0aW9uIGV2ZW50R2VuZXJhdG9yR2VuZXJhdGVFdmVudHNGb3JUeXBlKGV2ZW50R2VuZXJhdG9yLCBldmVudHMsIGV2ZW50VHlwZSwgY2hhbmdlcywgcmVnaXN0cmF0aW9ucywgZXZlbnRDYWNoZSkge1xuICAgIGNvbnN0IGZpbHRlcmVkQ2hhbmdlcyA9IGNoYW5nZXMuZmlsdGVyKGNoYW5nZSA9PiBjaGFuZ2UudHlwZSA9PT0gZXZlbnRUeXBlKTtcbiAgICBmaWx0ZXJlZENoYW5nZXMuc29ydCgoYSwgYikgPT4gZXZlbnRHZW5lcmF0b3JDb21wYXJlQ2hhbmdlcyhldmVudEdlbmVyYXRvciwgYSwgYikpO1xuICAgIGZpbHRlcmVkQ2hhbmdlcy5mb3JFYWNoKGNoYW5nZSA9PiB7XG4gICAgICAgIGNvbnN0IG1hdGVyaWFsaXplZENoYW5nZSA9IGV2ZW50R2VuZXJhdG9yTWF0ZXJpYWxpemVTaW5nbGVDaGFuZ2UoZXZlbnRHZW5lcmF0b3IsIGNoYW5nZSwgZXZlbnRDYWNoZSk7XG4gICAgICAgIHJlZ2lzdHJhdGlvbnMuZm9yRWFjaChyZWdpc3RyYXRpb24gPT4ge1xuICAgICAgICAgICAgaWYgKHJlZ2lzdHJhdGlvbi5yZXNwb25kc1RvKGNoYW5nZS50eXBlKSkge1xuICAgICAgICAgICAgICAgIGV2ZW50cy5wdXNoKHJlZ2lzdHJhdGlvbi5jcmVhdGVFdmVudChtYXRlcmlhbGl6ZWRDaGFuZ2UsIGV2ZW50R2VuZXJhdG9yLnF1ZXJ5XykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGV2ZW50R2VuZXJhdG9yTWF0ZXJpYWxpemVTaW5nbGVDaGFuZ2UoZXZlbnRHZW5lcmF0b3IsIGNoYW5nZSwgZXZlbnRDYWNoZSkge1xuICAgIGlmIChjaGFuZ2UudHlwZSA9PT0gJ3ZhbHVlJyB8fCBjaGFuZ2UudHlwZSA9PT0gJ2NoaWxkX3JlbW92ZWQnKSB7XG4gICAgICAgIHJldHVybiBjaGFuZ2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjaGFuZ2UucHJldk5hbWUgPSBldmVudENhY2hlLmdldFByZWRlY2Vzc29yQ2hpbGROYW1lKGNoYW5nZS5jaGlsZE5hbWUsIGNoYW5nZS5zbmFwc2hvdE5vZGUsIGV2ZW50R2VuZXJhdG9yLmluZGV4Xyk7XG4gICAgICAgIHJldHVybiBjaGFuZ2U7XG4gICAgfVxufVxuZnVuY3Rpb24gZXZlbnRHZW5lcmF0b3JDb21wYXJlQ2hhbmdlcyhldmVudEdlbmVyYXRvciwgYSwgYikge1xuICAgIGlmIChhLmNoaWxkTmFtZSA9PSBudWxsIHx8IGIuY2hpbGROYW1lID09IG51bGwpIHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0aW9uRXJyb3IoJ1Nob3VsZCBvbmx5IGNvbXBhcmUgY2hpbGRfIGV2ZW50cy4nKTtcbiAgICB9XG4gICAgY29uc3QgYVdyYXBwZWQgPSBuZXcgTmFtZWROb2RlKGEuY2hpbGROYW1lLCBhLnNuYXBzaG90Tm9kZSk7XG4gICAgY29uc3QgYldyYXBwZWQgPSBuZXcgTmFtZWROb2RlKGIuY2hpbGROYW1lLCBiLnNuYXBzaG90Tm9kZSk7XG4gICAgcmV0dXJuIGV2ZW50R2VuZXJhdG9yLmluZGV4Xy5jb21wYXJlKGFXcmFwcGVkLCBiV3JhcHBlZCk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBuZXdWaWV3Q2FjaGUoZXZlbnRDYWNoZSwgc2VydmVyQ2FjaGUpIHtcbiAgICByZXR1cm4geyBldmVudENhY2hlLCBzZXJ2ZXJDYWNoZSB9O1xufVxuZnVuY3Rpb24gdmlld0NhY2hlVXBkYXRlRXZlbnRTbmFwKHZpZXdDYWNoZSwgZXZlbnRTbmFwLCBjb21wbGV0ZSwgZmlsdGVyZWQpIHtcbiAgICByZXR1cm4gbmV3Vmlld0NhY2hlKG5ldyBDYWNoZU5vZGUoZXZlbnRTbmFwLCBjb21wbGV0ZSwgZmlsdGVyZWQpLCB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUpO1xufVxuZnVuY3Rpb24gdmlld0NhY2hlVXBkYXRlU2VydmVyU25hcCh2aWV3Q2FjaGUsIHNlcnZlclNuYXAsIGNvbXBsZXRlLCBmaWx0ZXJlZCkge1xuICAgIHJldHVybiBuZXdWaWV3Q2FjaGUodmlld0NhY2hlLmV2ZW50Q2FjaGUsIG5ldyBDYWNoZU5vZGUoc2VydmVyU25hcCwgY29tcGxldGUsIGZpbHRlcmVkKSk7XG59XG5mdW5jdGlvbiB2aWV3Q2FjaGVHZXRDb21wbGV0ZUV2ZW50U25hcCh2aWV3Q2FjaGUpIHtcbiAgICByZXR1cm4gdmlld0NhY2hlLmV2ZW50Q2FjaGUuaXNGdWxseUluaXRpYWxpemVkKClcbiAgICAgICAgPyB2aWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKClcbiAgICAgICAgOiBudWxsO1xufVxuZnVuY3Rpb24gdmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHZpZXdDYWNoZSkge1xuICAgIHJldHVybiB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKClcbiAgICAgICAgPyB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpXG4gICAgICAgIDogbnVsbDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCBlbXB0eUNoaWxkcmVuU2luZ2xldG9uO1xuLyoqXG4gKiBTaW5nbGV0b24gZW1wdHkgY2hpbGRyZW4gY29sbGVjdGlvbi5cbiAqXG4gKi9cbmNvbnN0IEVtcHR5Q2hpbGRyZW4gPSAoKSA9PiB7XG4gICAgaWYgKCFlbXB0eUNoaWxkcmVuU2luZ2xldG9uKSB7XG4gICAgICAgIGVtcHR5Q2hpbGRyZW5TaW5nbGV0b24gPSBuZXcgU29ydGVkTWFwKHN0cmluZ0NvbXBhcmUpO1xuICAgIH1cbiAgICByZXR1cm4gZW1wdHlDaGlsZHJlblNpbmdsZXRvbjtcbn07XG4vKipcbiAqIEEgdHJlZSB3aXRoIGltbXV0YWJsZSBlbGVtZW50cy5cbiAqL1xuY2xhc3MgSW1tdXRhYmxlVHJlZSB7XG4gICAgc3RhdGljIGZyb21PYmplY3Qob2JqKSB7XG4gICAgICAgIGxldCB0cmVlID0gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7XG4gICAgICAgIGVhY2gob2JqLCAoY2hpbGRQYXRoLCBjaGlsZFNuYXApID0+IHtcbiAgICAgICAgICAgIHRyZWUgPSB0cmVlLnNldChuZXcgUGF0aChjaGlsZFBhdGgpLCBjaGlsZFNuYXApO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHRyZWU7XG4gICAgfVxuICAgIGNvbnN0cnVjdG9yKHZhbHVlLCBjaGlsZHJlbiA9IEVtcHR5Q2hpbGRyZW4oKSkge1xuICAgICAgICB0aGlzLnZhbHVlID0gdmFsdWU7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4gPSBjaGlsZHJlbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVHJ1ZSBpZiB0aGUgdmFsdWUgaXMgZW1wdHkgYW5kIHRoZXJlIGFyZSBubyBjaGlsZHJlblxuICAgICAqL1xuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnZhbHVlID09PSBudWxsICYmIHRoaXMuY2hpbGRyZW4uaXNFbXB0eSgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHaXZlbiBhIHBhdGggYW5kIHByZWRpY2F0ZSwgcmV0dXJuIHRoZSBmaXJzdCBub2RlIGFuZCB0aGUgcGF0aCB0byB0aGF0IG5vZGVcbiAgICAgKiB3aGVyZSB0aGUgcHJlZGljYXRlIHJldHVybnMgdHJ1ZS5cbiAgICAgKlxuICAgICAqIFRPRE8gRG8gYSBwZXJmIHRlc3QgLS0gSWYgd2UncmUgY3JlYXRpbmcgYSBidW5jaCBvZiBge3BhdGg6IHZhbHVlOn1gXG4gICAgICogb2JqZWN0cyBvbiB0aGUgd2F5IGJhY2sgb3V0LCBpdCBtYXkgYmUgYmV0dGVyIHRvIHBhc3MgZG93biBhIHBhdGhTb0ZhciBvYmouXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQYXRoIC0gVGhlIHJlbWFpbmRlciBvZiB0aGUgcGF0aFxuICAgICAqIEBwYXJhbSBwcmVkaWNhdGUgLSBUaGUgcHJlZGljYXRlIHRvIHNhdGlzZnkgdG8gcmV0dXJuIGEgbm9kZVxuICAgICAqL1xuICAgIGZpbmRSb290TW9zdE1hdGNoaW5nUGF0aEFuZFZhbHVlKHJlbGF0aXZlUGF0aCwgcHJlZGljYXRlKSB7XG4gICAgICAgIGlmICh0aGlzLnZhbHVlICE9IG51bGwgJiYgcHJlZGljYXRlKHRoaXMudmFsdWUpKSB7XG4gICAgICAgICAgICByZXR1cm4geyBwYXRoOiBuZXdFbXB0eVBhdGgoKSwgdmFsdWU6IHRoaXMudmFsdWUgfTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpO1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjaGlsZEV4aXN0aW5nUGF0aEFuZFZhbHVlID0gY2hpbGQuZmluZFJvb3RNb3N0TWF0Y2hpbmdQYXRoQW5kVmFsdWUocGF0aFBvcEZyb250KHJlbGF0aXZlUGF0aCksIHByZWRpY2F0ZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjaGlsZEV4aXN0aW5nUGF0aEFuZFZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZ1bGxQYXRoID0gcGF0aENoaWxkKG5ldyBQYXRoKGZyb250KSwgY2hpbGRFeGlzdGluZ1BhdGhBbmRWYWx1ZS5wYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHBhdGg6IGZ1bGxQYXRoLCB2YWx1ZTogY2hpbGRFeGlzdGluZ1BhdGhBbmRWYWx1ZS52YWx1ZSB9O1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBGaW5kLCBpZiBpdCBleGlzdHMsIHRoZSBzaG9ydGVzdCBzdWJwYXRoIG9mIHRoZSBnaXZlbiBwYXRoIHRoYXQgcG9pbnRzIGEgZGVmaW5lZFxuICAgICAqIHZhbHVlIGluIHRoZSB0cmVlXG4gICAgICovXG4gICAgZmluZFJvb3RNb3N0VmFsdWVBbmRQYXRoKHJlbGF0aXZlUGF0aCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maW5kUm9vdE1vc3RNYXRjaGluZ1BhdGhBbmRWYWx1ZShyZWxhdGl2ZVBhdGgsICgpID0+IHRydWUpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAcmV0dXJucyBUaGUgc3VidHJlZSBhdCB0aGUgZ2l2ZW4gcGF0aFxuICAgICAqL1xuICAgIHN1YnRyZWUocmVsYXRpdmVQYXRoKSB7XG4gICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHJlbGF0aXZlUGF0aCk7XG4gICAgICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCk7XG4gICAgICAgICAgICBpZiAoY2hpbGRUcmVlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkVHJlZS5zdWJ0cmVlKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIGEgdmFsdWUgYXQgdGhlIHNwZWNpZmllZCBwYXRoLlxuICAgICAqXG4gICAgICogQHBhcmFtIHJlbGF0aXZlUGF0aCAtIFBhdGggdG8gc2V0IHZhbHVlIGF0LlxuICAgICAqIEBwYXJhbSB0b1NldCAtIFZhbHVlIHRvIHNldC5cbiAgICAgKiBAcmV0dXJucyBSZXN1bHRpbmcgdHJlZS5cbiAgICAgKi9cbiAgICBzZXQocmVsYXRpdmVQYXRoLCB0b1NldCkge1xuICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKHRvU2V0LCB0aGlzLmNoaWxkcmVuKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHJlbGF0aXZlUGF0aCk7XG4gICAgICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KSB8fCBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkID0gY2hpbGQuc2V0KHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpLCB0b1NldCk7XG4gICAgICAgICAgICBjb25zdCBuZXdDaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW4uaW5zZXJ0KGZyb250LCBuZXdDaGlsZCk7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUodGhpcy52YWx1ZSwgbmV3Q2hpbGRyZW4pO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJlbW92ZXMgdGhlIHZhbHVlIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggLSBQYXRoIHRvIHZhbHVlIHRvIHJlbW92ZS5cbiAgICAgKiBAcmV0dXJucyBSZXN1bHRpbmcgdHJlZS5cbiAgICAgKi9cbiAgICByZW1vdmUocmVsYXRpdmVQYXRoKSB7XG4gICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jaGlsZHJlbi5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCwgdGhpcy5jaGlsZHJlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpO1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCk7XG4gICAgICAgICAgICBpZiAoY2hpbGQpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IGNoaWxkLnJlbW92ZShwYXRoUG9wRnJvbnQocmVsYXRpdmVQYXRoKSk7XG4gICAgICAgICAgICAgICAgbGV0IG5ld0NoaWxkcmVuO1xuICAgICAgICAgICAgICAgIGlmIChuZXdDaGlsZC5pc0VtcHR5KCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLnJlbW92ZShmcm9udCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBuZXdDaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW4uaW5zZXJ0KGZyb250LCBuZXdDaGlsZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnZhbHVlID09PSBudWxsICYmIG5ld0NoaWxkcmVuLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IEltbXV0YWJsZVRyZWUodGhpcy52YWx1ZSwgbmV3Q2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldHMgYSB2YWx1ZSBmcm9tIHRoZSB0cmVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIHJlbGF0aXZlUGF0aCAtIFBhdGggdG8gZ2V0IHZhbHVlIGZvci5cbiAgICAgKiBAcmV0dXJucyBWYWx1ZSBhdCBwYXRoLCBvciBudWxsLlxuICAgICAqL1xuICAgIGdldChyZWxhdGl2ZVBhdGgpIHtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZhbHVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKTtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpO1xuICAgICAgICAgICAgaWYgKGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNoaWxkLmdldChwYXRoUG9wRnJvbnQocmVsYXRpdmVQYXRoKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXBsYWNlIHRoZSBzdWJ0cmVlIGF0IHRoZSBzcGVjaWZpZWQgcGF0aCB3aXRoIHRoZSBnaXZlbiBuZXcgdHJlZS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSByZWxhdGl2ZVBhdGggLSBQYXRoIHRvIHJlcGxhY2Ugc3VidHJlZSBmb3IuXG4gICAgICogQHBhcmFtIG5ld1RyZWUgLSBOZXcgdHJlZS5cbiAgICAgKiBAcmV0dXJucyBSZXN1bHRpbmcgdHJlZS5cbiAgICAgKi9cbiAgICBzZXRUcmVlKHJlbGF0aXZlUGF0aCwgbmV3VHJlZSkge1xuICAgICAgICBpZiAocGF0aElzRW1wdHkocmVsYXRpdmVQYXRoKSkge1xuICAgICAgICAgICAgcmV0dXJuIG5ld1RyZWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBmcm9udCA9IHBhdGhHZXRGcm9udChyZWxhdGl2ZVBhdGgpO1xuICAgICAgICAgICAgY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuLmdldChmcm9udCkgfHwgbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7XG4gICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IGNoaWxkLnNldFRyZWUocGF0aFBvcEZyb250KHJlbGF0aXZlUGF0aCksIG5ld1RyZWUpO1xuICAgICAgICAgICAgbGV0IG5ld0NoaWxkcmVuO1xuICAgICAgICAgICAgaWYgKG5ld0NoaWxkLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgIG5ld0NoaWxkcmVuID0gdGhpcy5jaGlsZHJlbi5yZW1vdmUoZnJvbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3Q2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuLmluc2VydChmcm9udCwgbmV3Q2hpbGQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5ldyBJbW11dGFibGVUcmVlKHRoaXMudmFsdWUsIG5ld0NoaWxkcmVuKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBQZXJmb3JtcyBhIGRlcHRoIGZpcnN0IGZvbGQgb24gdGhpcyB0cmVlLiBUcmFuc2Zvcm1zIGEgdHJlZSBpbnRvIGEgc2luZ2xlXG4gICAgICogdmFsdWUsIGdpdmVuIGEgZnVuY3Rpb24gdGhhdCBvcGVyYXRlcyBvbiB0aGUgcGF0aCB0byBhIG5vZGUsIGFuIG9wdGlvbmFsXG4gICAgICogY3VycmVudCB2YWx1ZSwgYW5kIGEgbWFwIG9mIGNoaWxkIG5hbWVzIHRvIGZvbGRlZCBzdWJ0cmVlc1xuICAgICAqL1xuICAgIGZvbGQoZm4pIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9sZF8obmV3RW1wdHlQYXRoKCksIGZuKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVjdXJzaXZlIGhlbHBlciBmb3IgcHVibGljLWZhY2luZyBmb2xkKCkgbWV0aG9kXG4gICAgICovXG4gICAgZm9sZF8ocGF0aFNvRmFyLCBmbikge1xuICAgICAgICBjb25zdCBhY2N1bSA9IHt9O1xuICAgICAgICB0aGlzLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkS2V5LCBjaGlsZFRyZWUpID0+IHtcbiAgICAgICAgICAgIGFjY3VtW2NoaWxkS2V5XSA9IGNoaWxkVHJlZS5mb2xkXyhwYXRoQ2hpbGQocGF0aFNvRmFyLCBjaGlsZEtleSksIGZuKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBmbihwYXRoU29GYXIsIHRoaXMudmFsdWUsIGFjY3VtKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRmluZCB0aGUgZmlyc3QgbWF0Y2hpbmcgdmFsdWUgb24gdGhlIGdpdmVuIHBhdGguIFJldHVybiB0aGUgcmVzdWx0IG9mIGFwcGx5aW5nIGYgdG8gaXQuXG4gICAgICovXG4gICAgZmluZE9uUGF0aChwYXRoLCBmKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbmRPblBhdGhfKHBhdGgsIG5ld0VtcHR5UGF0aCgpLCBmKTtcbiAgICB9XG4gICAgZmluZE9uUGF0aF8ocGF0aFRvRm9sbG93LCBwYXRoU29GYXIsIGYpIHtcbiAgICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy52YWx1ZSA/IGYocGF0aFNvRmFyLCB0aGlzLnZhbHVlKSA6IGZhbHNlO1xuICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGhUb0ZvbGxvdykpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGZyb250ID0gcGF0aEdldEZyb250KHBhdGhUb0ZvbGxvdyk7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV4dENoaWxkID0gdGhpcy5jaGlsZHJlbi5nZXQoZnJvbnQpO1xuICAgICAgICAgICAgICAgIGlmIChuZXh0Q2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG5leHRDaGlsZC5maW5kT25QYXRoXyhwYXRoUG9wRnJvbnQocGF0aFRvRm9sbG93KSwgcGF0aENoaWxkKHBhdGhTb0ZhciwgZnJvbnQpLCBmKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBmb3JlYWNoT25QYXRoKHBhdGgsIGYpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9yZWFjaE9uUGF0aF8ocGF0aCwgbmV3RW1wdHlQYXRoKCksIGYpO1xuICAgIH1cbiAgICBmb3JlYWNoT25QYXRoXyhwYXRoVG9Gb2xsb3csIGN1cnJlbnRSZWxhdGl2ZVBhdGgsIGYpIHtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGhUb0ZvbGxvdykpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMudmFsdWUpIHtcbiAgICAgICAgICAgICAgICBmKGN1cnJlbnRSZWxhdGl2ZVBhdGgsIHRoaXMudmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgZnJvbnQgPSBwYXRoR2V0RnJvbnQocGF0aFRvRm9sbG93KTtcbiAgICAgICAgICAgIGNvbnN0IG5leHRDaGlsZCA9IHRoaXMuY2hpbGRyZW4uZ2V0KGZyb250KTtcbiAgICAgICAgICAgIGlmIChuZXh0Q2hpbGQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbmV4dENoaWxkLmZvcmVhY2hPblBhdGhfKHBhdGhQb3BGcm9udChwYXRoVG9Gb2xsb3cpLCBwYXRoQ2hpbGQoY3VycmVudFJlbGF0aXZlUGF0aCwgZnJvbnQpLCBmKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBDYWxscyB0aGUgZ2l2ZW4gZnVuY3Rpb24gZm9yIGVhY2ggbm9kZSBpbiB0aGUgdHJlZSB0aGF0IGhhcyBhIHZhbHVlLlxuICAgICAqXG4gICAgICogQHBhcmFtIGYgLSBBIGZ1bmN0aW9uIHRvIGJlIGNhbGxlZCB3aXRoIHRoZSBwYXRoIGZyb20gdGhlIHJvb3Qgb2YgdGhlIHRyZWUgdG9cbiAgICAgKiBhIG5vZGUsIGFuZCB0aGUgdmFsdWUgYXQgdGhhdCBub2RlLiBDYWxsZWQgaW4gZGVwdGgtZmlyc3Qgb3JkZXIuXG4gICAgICovXG4gICAgZm9yZWFjaChmKSB7XG4gICAgICAgIHRoaXMuZm9yZWFjaF8obmV3RW1wdHlQYXRoKCksIGYpO1xuICAgIH1cbiAgICBmb3JlYWNoXyhjdXJyZW50UmVsYXRpdmVQYXRoLCBmKSB7XG4gICAgICAgIHRoaXMuY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGROYW1lLCBjaGlsZFRyZWUpID0+IHtcbiAgICAgICAgICAgIGNoaWxkVHJlZS5mb3JlYWNoXyhwYXRoQ2hpbGQoY3VycmVudFJlbGF0aXZlUGF0aCwgY2hpbGROYW1lKSwgZik7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodGhpcy52YWx1ZSkge1xuICAgICAgICAgICAgZihjdXJyZW50UmVsYXRpdmVQYXRoLCB0aGlzLnZhbHVlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBmb3JlYWNoQ2hpbGQoZikge1xuICAgICAgICB0aGlzLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkTmFtZSwgY2hpbGRUcmVlKSA9PiB7XG4gICAgICAgICAgICBpZiAoY2hpbGRUcmVlLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZihjaGlsZE5hbWUsIGNoaWxkVHJlZS52YWx1ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhpcyBjbGFzcyBob2xkcyBhIGNvbGxlY3Rpb24gb2Ygd3JpdGVzIHRoYXQgY2FuIGJlIGFwcGxpZWQgdG8gbm9kZXMgaW4gdW5pc29uLiBJdCBhYnN0cmFjdHMgYXdheSB0aGUgbG9naWMgd2l0aFxuICogZGVhbGluZyB3aXRoIHByaW9yaXR5IHdyaXRlcyBhbmQgbXVsdGlwbGUgbmVzdGVkIHdyaXRlcy4gQXQgYW55IGdpdmVuIHBhdGggdGhlcmUgaXMgb25seSBhbGxvd2VkIHRvIGJlIG9uZSB3cml0ZVxuICogbW9kaWZ5aW5nIHRoYXQgcGF0aC4gQW55IHdyaXRlIHRvIGFuIGV4aXN0aW5nIHBhdGggb3Igc2hhZG93aW5nIGFuIGV4aXN0aW5nIHBhdGggd2lsbCBtb2RpZnkgdGhhdCBleGlzdGluZyB3cml0ZVxuICogdG8gcmVmbGVjdCB0aGUgd3JpdGUgYWRkZWQuXG4gKi9cbmNsYXNzIENvbXBvdW5kV3JpdGUge1xuICAgIGNvbnN0cnVjdG9yKHdyaXRlVHJlZV8pIHtcbiAgICAgICAgdGhpcy53cml0ZVRyZWVfID0gd3JpdGVUcmVlXztcbiAgICB9XG4gICAgc3RhdGljIGVtcHR5KCkge1xuICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUobmV3IEltbXV0YWJsZVRyZWUobnVsbCkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVBZGRXcml0ZShjb21wb3VuZFdyaXRlLCBwYXRoLCBub2RlKSB7XG4gICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7XG4gICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShuZXcgSW1tdXRhYmxlVHJlZShub2RlKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCByb290bW9zdCA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5maW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGgocGF0aCk7XG4gICAgICAgIGlmIChyb290bW9zdCAhPSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCByb290TW9zdFBhdGggPSByb290bW9zdC5wYXRoO1xuICAgICAgICAgICAgbGV0IHZhbHVlID0gcm9vdG1vc3QudmFsdWU7XG4gICAgICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocm9vdE1vc3RQYXRoLCBwYXRoKTtcbiAgICAgICAgICAgIHZhbHVlID0gdmFsdWUudXBkYXRlQ2hpbGQocmVsYXRpdmVQYXRoLCBub2RlKTtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uc2V0KHJvb3RNb3N0UGF0aCwgdmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHN1YnRyZWUgPSBuZXcgSW1tdXRhYmxlVHJlZShub2RlKTtcbiAgICAgICAgICAgIGNvbnN0IG5ld1dyaXRlVHJlZSA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5zZXRUcmVlKHBhdGgsIHN1YnRyZWUpO1xuICAgICAgICAgICAgcmV0dXJuIG5ldyBDb21wb3VuZFdyaXRlKG5ld1dyaXRlVHJlZSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBjb21wb3VuZFdyaXRlQWRkV3JpdGVzKGNvbXBvdW5kV3JpdGUsIHBhdGgsIHVwZGF0ZXMpIHtcbiAgICBsZXQgbmV3V3JpdGUgPSBjb21wb3VuZFdyaXRlO1xuICAgIGVhY2godXBkYXRlcywgKGNoaWxkS2V5LCBub2RlKSA9PiB7XG4gICAgICAgIG5ld1dyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKG5ld1dyaXRlLCBwYXRoQ2hpbGQocGF0aCwgY2hpbGRLZXkpLCBub2RlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gbmV3V3JpdGU7XG59XG4vKipcbiAqIFdpbGwgcmVtb3ZlIGEgd3JpdGUgYXQgdGhlIGdpdmVuIHBhdGggYW5kIGRlZXBlciBwYXRocy4gVGhpcyB3aWxsIDxlbT5ub3Q8L2VtPiBtb2RpZnkgYSB3cml0ZSBhdCBhIGhpZ2hlclxuICogbG9jYXRpb24sIHdoaWNoIG11c3QgYmUgcmVtb3ZlZCBieSBjYWxsaW5nIHRoaXMgbWV0aG9kIHdpdGggdGhhdCBwYXRoLlxuICpcbiAqIEBwYXJhbSBjb21wb3VuZFdyaXRlIC0gVGhlIENvbXBvdW5kV3JpdGUgdG8gcmVtb3ZlLlxuICogQHBhcmFtIHBhdGggLSBUaGUgcGF0aCBhdCB3aGljaCBhIHdyaXRlIGFuZCBhbGwgZGVlcGVyIHdyaXRlcyBzaG91bGQgYmUgcmVtb3ZlZFxuICogQHJldHVybnMgVGhlIG5ldyBDb21wb3VuZFdyaXRlIHdpdGggdGhlIHJlbW92ZWQgcGF0aFxuICovXG5mdW5jdGlvbiBjb21wb3VuZFdyaXRlUmVtb3ZlV3JpdGUoY29tcG91bmRXcml0ZSwgcGF0aCkge1xuICAgIGlmIChwYXRoSXNFbXB0eShwYXRoKSkge1xuICAgICAgICByZXR1cm4gQ29tcG91bmRXcml0ZS5lbXB0eSgpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgbmV3V3JpdGVUcmVlID0gY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLnNldFRyZWUocGF0aCwgbmV3IEltbXV0YWJsZVRyZWUobnVsbCkpO1xuICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUobmV3V3JpdGVUcmVlKTtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgd2hldGhlciB0aGlzIENvbXBvdW5kV3JpdGUgd2lsbCBmdWxseSBvdmVyd3JpdGUgYSBub2RlIGF0IGEgZ2l2ZW4gbG9jYXRpb24gYW5kIGNhbiB0aGVyZWZvcmUgYmVcbiAqIGNvbnNpZGVyZWQgXCJjb21wbGV0ZVwiLlxuICpcbiAqIEBwYXJhbSBjb21wb3VuZFdyaXRlIC0gVGhlIENvbXBvdW5kV3JpdGUgdG8gY2hlY2suXG4gKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGNoZWNrIGZvclxuICogQHJldHVybnMgV2hldGhlciB0aGVyZSBpcyBhIGNvbXBsZXRlIHdyaXRlIGF0IHRoYXQgcGF0aFxuICovXG5mdW5jdGlvbiBjb21wb3VuZFdyaXRlSGFzQ29tcGxldGVXcml0ZShjb21wb3VuZFdyaXRlLCBwYXRoKSB7XG4gICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUoY29tcG91bmRXcml0ZSwgcGF0aCkgIT0gbnVsbDtcbn1cbi8qKlxuICogUmV0dXJucyBhIG5vZGUgZm9yIGEgcGF0aCBpZiBhbmQgb25seSBpZiB0aGUgbm9kZSBpcyBhIFwiY29tcGxldGVcIiBvdmVyd3JpdGUgYXQgdGhhdCBwYXRoLiBUaGlzIHdpbGwgbm90IGFnZ3JlZ2F0ZVxuICogd3JpdGVzIGZyb20gZGVlcGVyIHBhdGhzLCBidXQgd2lsbCByZXR1cm4gY2hpbGQgbm9kZXMgZnJvbSBhIG1vcmUgc2hhbGxvdyBwYXRoLlxuICpcbiAqIEBwYXJhbSBjb21wb3VuZFdyaXRlIC0gVGhlIENvbXBvdW5kV3JpdGUgdG8gZ2V0IHRoZSBub2RlIGZyb20uXG4gKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIGdldCBhIGNvbXBsZXRlIHdyaXRlXG4gKiBAcmV0dXJucyBUaGUgbm9kZSBpZiBjb21wbGV0ZSBhdCB0aGF0IHBhdGgsIG9yIG51bGwgb3RoZXJ3aXNlLlxuICovXG5mdW5jdGlvbiBjb21wb3VuZFdyaXRlR2V0Q29tcGxldGVOb2RlKGNvbXBvdW5kV3JpdGUsIHBhdGgpIHtcbiAgICBjb25zdCByb290bW9zdCA9IGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlXy5maW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGgocGF0aCk7XG4gICAgaWYgKHJvb3Rtb3N0ICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGUud3JpdGVUcmVlX1xuICAgICAgICAgICAgLmdldChyb290bW9zdC5wYXRoKVxuICAgICAgICAgICAgLmdldENoaWxkKG5ld1JlbGF0aXZlUGF0aChyb290bW9zdC5wYXRoLCBwYXRoKSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG59XG4vKipcbiAqIFJldHVybnMgYWxsIGNoaWxkcmVuIHRoYXQgYXJlIGd1YXJhbnRlZWQgdG8gYmUgYSBjb21wbGV0ZSBvdmVyd3JpdGUuXG4gKlxuICogQHBhcmFtIGNvbXBvdW5kV3JpdGUgLSBUaGUgQ29tcG91bmRXcml0ZSB0byBnZXQgY2hpbGRyZW4gZnJvbS5cbiAqIEByZXR1cm5zIEEgbGlzdCBvZiBhbGwgY29tcGxldGUgY2hpbGRyZW4uXG4gKi9cbmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKGNvbXBvdW5kV3JpdGUpIHtcbiAgICBjb25zdCBjaGlsZHJlbiA9IFtdO1xuICAgIGNvbnN0IG5vZGUgPSBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8udmFsdWU7XG4gICAgaWYgKG5vZGUgIT0gbnVsbCkge1xuICAgICAgICAvLyBJZiBpdCdzIGEgbGVhZiBub2RlLCBpdCBoYXMgbm8gY2hpbGRyZW47IHNvIG5vdGhpbmcgdG8gZG8uXG4gICAgICAgIGlmICghbm9kZS5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgIG5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgICAgICAgICBjaGlsZHJlbi5wdXNoKG5ldyBOYW1lZE5vZGUoY2hpbGROYW1lLCBjaGlsZE5vZGUpKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb21wb3VuZFdyaXRlLndyaXRlVHJlZV8uY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGROYW1lLCBjaGlsZFRyZWUpID0+IHtcbiAgICAgICAgICAgIGlmIChjaGlsZFRyZWUudmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNoaWxkcmVuLnB1c2gobmV3IE5hbWVkTm9kZShjaGlsZE5hbWUsIGNoaWxkVHJlZS52YWx1ZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGNoaWxkcmVuO1xufVxuZnVuY3Rpb24gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZShjb21wb3VuZFdyaXRlLCBwYXRoKSB7XG4gICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpKSB7XG4gICAgICAgIHJldHVybiBjb21wb3VuZFdyaXRlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3Qgc2hhZG93aW5nTm9kZSA9IGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUoY29tcG91bmRXcml0ZSwgcGF0aCk7XG4gICAgICAgIGlmIChzaGFkb3dpbmdOb2RlICE9IG51bGwpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ29tcG91bmRXcml0ZShuZXcgSW1tdXRhYmxlVHJlZShzaGFkb3dpbmdOb2RlKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IENvbXBvdW5kV3JpdGUoY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLnN1YnRyZWUocGF0aCkpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBSZXR1cm5zIHRydWUgaWYgdGhpcyBDb21wb3VuZFdyaXRlIGlzIGVtcHR5IGFuZCB0aGVyZWZvcmUgZG9lcyBub3QgbW9kaWZ5IGFueSBub2Rlcy5cbiAqIEByZXR1cm5zIFdoZXRoZXIgdGhpcyBDb21wb3VuZFdyaXRlIGlzIGVtcHR5XG4gKi9cbmZ1bmN0aW9uIGNvbXBvdW5kV3JpdGVJc0VtcHR5KGNvbXBvdW5kV3JpdGUpIHtcbiAgICByZXR1cm4gY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLmlzRW1wdHkoKTtcbn1cbi8qKlxuICogQXBwbGllcyB0aGlzIENvbXBvdW5kV3JpdGUgdG8gYSBub2RlLiBUaGUgbm9kZSBpcyByZXR1cm5lZCB3aXRoIGFsbCB3cml0ZXMgZnJvbSB0aGlzIENvbXBvdW5kV3JpdGUgYXBwbGllZCB0byB0aGVcbiAqIG5vZGVcbiAqIEBwYXJhbSBub2RlIC0gVGhlIG5vZGUgdG8gYXBwbHkgdGhpcyBDb21wb3VuZFdyaXRlIHRvXG4gKiBAcmV0dXJucyBUaGUgbm9kZSB3aXRoIGFsbCB3cml0ZXMgYXBwbGllZFxuICovXG5mdW5jdGlvbiBjb21wb3VuZFdyaXRlQXBwbHkoY29tcG91bmRXcml0ZSwgbm9kZSkge1xuICAgIHJldHVybiBhcHBseVN1YnRyZWVXcml0ZShuZXdFbXB0eVBhdGgoKSwgY29tcG91bmRXcml0ZS53cml0ZVRyZWVfLCBub2RlKTtcbn1cbmZ1bmN0aW9uIGFwcGx5U3VidHJlZVdyaXRlKHJlbGF0aXZlUGF0aCwgd3JpdGVUcmVlLCBub2RlKSB7XG4gICAgaWYgKHdyaXRlVHJlZS52YWx1ZSAhPSBudWxsKSB7XG4gICAgICAgIC8vIFNpbmNlIHRoZXJlIGEgd3JpdGUgaXMgYWx3YXlzIGEgbGVhZiwgd2UncmUgZG9uZSBoZXJlXG4gICAgICAgIHJldHVybiBub2RlLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCwgd3JpdGVUcmVlLnZhbHVlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBwcmlvcml0eVdyaXRlID0gbnVsbDtcbiAgICAgICAgd3JpdGVUcmVlLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkS2V5LCBjaGlsZFRyZWUpID0+IHtcbiAgICAgICAgICAgIGlmIChjaGlsZEtleSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgICAgICAvLyBBcHBseSBwcmlvcml0aWVzIGF0IHRoZSBlbmQgc28gd2UgZG9uJ3QgdXBkYXRlIHByaW9yaXRpZXMgZm9yIGVpdGhlciBlbXB0eSBub2RlcyBvciBmb3JnZXRcbiAgICAgICAgICAgICAgICAvLyB0byBhcHBseSBwcmlvcml0aWVzIHRvIGVtcHR5IG5vZGVzIHRoYXQgYXJlIGxhdGVyIGZpbGxlZFxuICAgICAgICAgICAgICAgIGFzc2VydChjaGlsZFRyZWUudmFsdWUgIT09IG51bGwsICdQcmlvcml0eSB3cml0ZXMgbXVzdCBhbHdheXMgYmUgbGVhZiBub2RlcycpO1xuICAgICAgICAgICAgICAgIHByaW9yaXR5V3JpdGUgPSBjaGlsZFRyZWUudmFsdWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBub2RlID0gYXBwbHlTdWJ0cmVlV3JpdGUocGF0aENoaWxkKHJlbGF0aXZlUGF0aCwgY2hpbGRLZXkpLCBjaGlsZFRyZWUsIG5vZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gSWYgdGhlcmUgd2FzIGEgcHJpb3JpdHkgd3JpdGUsIHdlIG9ubHkgYXBwbHkgaXQgaWYgdGhlIG5vZGUgaXMgbm90IGVtcHR5XG4gICAgICAgIGlmICghbm9kZS5nZXRDaGlsZChyZWxhdGl2ZVBhdGgpLmlzRW1wdHkoKSAmJiBwcmlvcml0eVdyaXRlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBub2RlID0gbm9kZS51cGRhdGVDaGlsZChwYXRoQ2hpbGQocmVsYXRpdmVQYXRoLCAnLnByaW9yaXR5JyksIHByaW9yaXR5V3JpdGUpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQ3JlYXRlIGEgbmV3IFdyaXRlVHJlZVJlZiBmb3IgdGhlIGdpdmVuIHBhdGguIEZvciB1c2Ugd2l0aCBhIG5ldyBzeW5jIHBvaW50IGF0IHRoZSBnaXZlbiBwYXRoLlxuICpcbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlQ2hpbGRXcml0ZXMod3JpdGVUcmVlLCBwYXRoKSB7XG4gICAgcmV0dXJuIG5ld1dyaXRlVHJlZVJlZihwYXRoLCB3cml0ZVRyZWUpO1xufVxuLyoqXG4gKiBSZWNvcmQgYSBuZXcgb3ZlcndyaXRlIGZyb20gdXNlciBjb2RlLlxuICpcbiAqIEBwYXJhbSB2aXNpYmxlIC0gVGhpcyBpcyBzZXQgdG8gZmFsc2UgYnkgc29tZSB0cmFuc2FjdGlvbnMuIEl0IHNob3VsZCBiZSBleGNsdWRlZCBmcm9tIGV2ZW50IGNhY2hlc1xuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVBZGRPdmVyd3JpdGUod3JpdGVUcmVlLCBwYXRoLCBzbmFwLCB3cml0ZUlkLCB2aXNpYmxlKSB7XG4gICAgYXNzZXJ0KHdyaXRlSWQgPiB3cml0ZVRyZWUubGFzdFdyaXRlSWQsICdTdGFja2luZyBhbiBvbGRlciB3cml0ZSBvbiB0b3Agb2YgbmV3ZXIgb25lcycpO1xuICAgIGlmICh2aXNpYmxlID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmlzaWJsZSA9IHRydWU7XG4gICAgfVxuICAgIHdyaXRlVHJlZS5hbGxXcml0ZXMucHVzaCh7XG4gICAgICAgIHBhdGgsXG4gICAgICAgIHNuYXAsXG4gICAgICAgIHdyaXRlSWQsXG4gICAgICAgIHZpc2libGVcbiAgICB9KTtcbiAgICBpZiAodmlzaWJsZSkge1xuICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCwgc25hcCk7XG4gICAgfVxuICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9IHdyaXRlSWQ7XG59XG4vKipcbiAqIFJlY29yZCBhIG5ldyBtZXJnZSBmcm9tIHVzZXIgY29kZS5cbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlQWRkTWVyZ2Uod3JpdGVUcmVlLCBwYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHdyaXRlSWQpIHtcbiAgICBhc3NlcnQod3JpdGVJZCA+IHdyaXRlVHJlZS5sYXN0V3JpdGVJZCwgJ1N0YWNraW5nIGFuIG9sZGVyIG1lcmdlIG9uIHRvcCBvZiBuZXdlciBvbmVzJyk7XG4gICAgd3JpdGVUcmVlLmFsbFdyaXRlcy5wdXNoKHtcbiAgICAgICAgcGF0aCxcbiAgICAgICAgY2hpbGRyZW46IGNoYW5nZWRDaGlsZHJlbixcbiAgICAgICAgd3JpdGVJZCxcbiAgICAgICAgdmlzaWJsZTogdHJ1ZVxuICAgIH0pO1xuICAgIHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzID0gY29tcG91bmRXcml0ZUFkZFdyaXRlcyh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCwgY2hhbmdlZENoaWxkcmVuKTtcbiAgICB3cml0ZVRyZWUubGFzdFdyaXRlSWQgPSB3cml0ZUlkO1xufVxuZnVuY3Rpb24gd3JpdGVUcmVlR2V0V3JpdGUod3JpdGVUcmVlLCB3cml0ZUlkKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB3cml0ZVRyZWUuYWxsV3JpdGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHJlY29yZCA9IHdyaXRlVHJlZS5hbGxXcml0ZXNbaV07XG4gICAgICAgIGlmIChyZWNvcmQud3JpdGVJZCA9PT0gd3JpdGVJZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cbi8qKlxuICogUmVtb3ZlIGEgd3JpdGUgKGVpdGhlciBhbiBvdmVyd3JpdGUgb3IgbWVyZ2UpIHRoYXQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGFja25vd2xlZGdlIGJ5IHRoZSBzZXJ2ZXIuIFJlY2FsY3VsYXRlc1xuICogdGhlIHRyZWUgaWYgbmVjZXNzYXJ5LiAgV2UgcmV0dXJuIHRydWUgaWYgaXQgbWF5IGhhdmUgYmVlbiB2aXNpYmxlLCBtZWFuaW5nIHZpZXdzIG5lZWQgdG8gcmVldmFsdWF0ZS5cbiAqXG4gKiBAcmV0dXJucyB0cnVlIGlmIHRoZSB3cml0ZSBtYXkgaGF2ZSBiZWVuIHZpc2libGUgKG1lYW5pbmcgd2UnbGwgbmVlZCB0byByZWV2YWx1YXRlIC8gcmFpc2VcbiAqIGV2ZW50cyBhcyBhIHJlc3VsdCkuXG4gKi9cbmZ1bmN0aW9uIHdyaXRlVHJlZVJlbW92ZVdyaXRlKHdyaXRlVHJlZSwgd3JpdGVJZCkge1xuICAgIC8vIE5vdGU6IGRpc2FibGluZyB0aGlzIGNoZWNrLiBJdCBjb3VsZCBiZSBhIHRyYW5zYWN0aW9uIHRoYXQgcHJlZW1wdGVkIGFub3RoZXIgdHJhbnNhY3Rpb24sIGFuZCB0aHVzIHdhcyBhcHBsaWVkXG4gICAgLy8gb3V0IG9mIG9yZGVyLlxuICAgIC8vY29uc3QgdmFsaWRDbGVhciA9IHJldmVydCB8fCB0aGlzLmFsbFdyaXRlc18ubGVuZ3RoID09PSAwIHx8IHdyaXRlSWQgPD0gdGhpcy5hbGxXcml0ZXNfWzBdLndyaXRlSWQ7XG4gICAgLy9hc3NlcnQodmFsaWRDbGVhciwgXCJFaXRoZXIgd2UgZG9uJ3QgaGF2ZSB0aGlzIHdyaXRlLCBvciBpdCdzIHRoZSBmaXJzdCBvbmUgaW4gdGhlIHF1ZXVlXCIpO1xuICAgIGNvbnN0IGlkeCA9IHdyaXRlVHJlZS5hbGxXcml0ZXMuZmluZEluZGV4KHMgPT4ge1xuICAgICAgICByZXR1cm4gcy53cml0ZUlkID09PSB3cml0ZUlkO1xuICAgIH0pO1xuICAgIGFzc2VydChpZHggPj0gMCwgJ3JlbW92ZVdyaXRlIGNhbGxlZCB3aXRoIG5vbmV4aXN0ZW50IHdyaXRlSWQuJyk7XG4gICAgY29uc3Qgd3JpdGVUb1JlbW92ZSA9IHdyaXRlVHJlZS5hbGxXcml0ZXNbaWR4XTtcbiAgICB3cml0ZVRyZWUuYWxsV3JpdGVzLnNwbGljZShpZHgsIDEpO1xuICAgIGxldCByZW1vdmVkV3JpdGVXYXNWaXNpYmxlID0gd3JpdGVUb1JlbW92ZS52aXNpYmxlO1xuICAgIGxldCByZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcyA9IGZhbHNlO1xuICAgIGxldCBpID0gd3JpdGVUcmVlLmFsbFdyaXRlcy5sZW5ndGggLSAxO1xuICAgIHdoaWxlIChyZW1vdmVkV3JpdGVXYXNWaXNpYmxlICYmIGkgPj0gMCkge1xuICAgICAgICBjb25zdCBjdXJyZW50V3JpdGUgPSB3cml0ZVRyZWUuYWxsV3JpdGVzW2ldO1xuICAgICAgICBpZiAoY3VycmVudFdyaXRlLnZpc2libGUpIHtcbiAgICAgICAgICAgIGlmIChpID49IGlkeCAmJlxuICAgICAgICAgICAgICAgIHdyaXRlVHJlZVJlY29yZENvbnRhaW5zUGF0aF8oY3VycmVudFdyaXRlLCB3cml0ZVRvUmVtb3ZlLnBhdGgpKSB7XG4gICAgICAgICAgICAgICAgLy8gVGhlIHJlbW92ZWQgd3JpdGUgd2FzIGNvbXBsZXRlbHkgc2hhZG93ZWQgYnkgYSBzdWJzZXF1ZW50IHdyaXRlLlxuICAgICAgICAgICAgICAgIHJlbW92ZWRXcml0ZVdhc1Zpc2libGUgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVRvUmVtb3ZlLnBhdGgsIGN1cnJlbnRXcml0ZS5wYXRoKSkge1xuICAgICAgICAgICAgICAgIC8vIEVpdGhlciB3ZSdyZSBjb3ZlcmluZyBzb21lIHdyaXRlcyBvciB0aGV5J3JlIGNvdmVyaW5nIHBhcnQgb2YgdXMgKGRlcGVuZGluZyBvbiB3aGljaCBjYW1lIGZpcnN0KS5cbiAgICAgICAgICAgICAgICByZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcyA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaS0tO1xuICAgIH1cbiAgICBpZiAoIXJlbW92ZWRXcml0ZVdhc1Zpc2libGUpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBlbHNlIGlmIChyZW1vdmVkV3JpdGVPdmVybGFwc1dpdGhPdGhlcldyaXRlcykge1xuICAgICAgICAvLyBUaGVyZSdzIHNvbWUgc2hhZG93aW5nIGdvaW5nIG9uLiBKdXN0IHJlYnVpbGQgdGhlIHZpc2libGUgd3JpdGVzIGZyb20gc2NyYXRjaC5cbiAgICAgICAgd3JpdGVUcmVlUmVzZXRUcmVlXyh3cml0ZVRyZWUpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFRoZXJlJ3Mgbm8gc2hhZG93aW5nLiAgV2UgY2FuIHNhZmVseSBqdXN0IHJlbW92ZSB0aGUgd3JpdGUocykgZnJvbSB2aXNpYmxlV3JpdGVzLlxuICAgICAgICBpZiAod3JpdGVUb1JlbW92ZS5zbmFwKSB7XG4gICAgICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVSZW1vdmVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgd3JpdGVUb1JlbW92ZS5wYXRoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkcmVuID0gd3JpdGVUb1JlbW92ZS5jaGlsZHJlbjtcbiAgICAgICAgICAgIGVhY2goY2hpbGRyZW4sIChjaGlsZE5hbWUpID0+IHtcbiAgICAgICAgICAgICAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IGNvbXBvdW5kV3JpdGVSZW1vdmVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aENoaWxkKHdyaXRlVG9SZW1vdmUucGF0aCwgY2hpbGROYW1lKSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5mdW5jdGlvbiB3cml0ZVRyZWVSZWNvcmRDb250YWluc1BhdGhfKHdyaXRlUmVjb3JkLCBwYXRoKSB7XG4gICAgaWYgKHdyaXRlUmVjb3JkLnNuYXApIHtcbiAgICAgICAgcmV0dXJuIHBhdGhDb250YWlucyh3cml0ZVJlY29yZC5wYXRoLCBwYXRoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGZvciAoY29uc3QgY2hpbGROYW1lIGluIHdyaXRlUmVjb3JkLmNoaWxkcmVuKSB7XG4gICAgICAgICAgICBpZiAod3JpdGVSZWNvcmQuY2hpbGRyZW4uaGFzT3duUHJvcGVydHkoY2hpbGROYW1lKSAmJlxuICAgICAgICAgICAgICAgIHBhdGhDb250YWlucyhwYXRoQ2hpbGQod3JpdGVSZWNvcmQucGF0aCwgY2hpbGROYW1lKSwgcGF0aCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuLyoqXG4gKiBSZS1sYXllciB0aGUgd3JpdGVzIGFuZCBtZXJnZXMgaW50byBhIHRyZWUgc28gd2UgY2FuIGVmZmljaWVudGx5IGNhbGN1bGF0ZSBldmVudCBzbmFwc2hvdHNcbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlUmVzZXRUcmVlXyh3cml0ZVRyZWUpIHtcbiAgICB3cml0ZVRyZWUudmlzaWJsZVdyaXRlcyA9IHdyaXRlVHJlZUxheWVyVHJlZV8od3JpdGVUcmVlLmFsbFdyaXRlcywgd3JpdGVUcmVlRGVmYXVsdEZpbHRlcl8sIG5ld0VtcHR5UGF0aCgpKTtcbiAgICBpZiAod3JpdGVUcmVlLmFsbFdyaXRlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9XG4gICAgICAgICAgICB3cml0ZVRyZWUuYWxsV3JpdGVzW3dyaXRlVHJlZS5hbGxXcml0ZXMubGVuZ3RoIC0gMV0ud3JpdGVJZDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHdyaXRlVHJlZS5sYXN0V3JpdGVJZCA9IC0xO1xuICAgIH1cbn1cbi8qKlxuICogVGhlIGRlZmF1bHQgZmlsdGVyIHVzZWQgd2hlbiBjb25zdHJ1Y3RpbmcgdGhlIHRyZWUuIEtlZXAgZXZlcnl0aGluZyB0aGF0J3MgdmlzaWJsZS5cbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlRGVmYXVsdEZpbHRlcl8od3JpdGUpIHtcbiAgICByZXR1cm4gd3JpdGUudmlzaWJsZTtcbn1cbi8qKlxuICogU3RhdGljIG1ldGhvZC4gR2l2ZW4gYW4gYXJyYXkgb2YgV3JpdGVSZWNvcmRzLCBhIGZpbHRlciBmb3Igd2hpY2ggb25lcyB0byBpbmNsdWRlLCBhbmQgYSBwYXRoLCBjb25zdHJ1Y3QgdGhlIHRyZWUgb2ZcbiAqIGV2ZW50IGRhdGEgYXQgdGhhdCBwYXRoLlxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVMYXllclRyZWVfKHdyaXRlcywgZmlsdGVyLCB0cmVlUm9vdCkge1xuICAgIGxldCBjb21wb3VuZFdyaXRlID0gQ29tcG91bmRXcml0ZS5lbXB0eSgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd3JpdGVzLmxlbmd0aDsgKytpKSB7XG4gICAgICAgIGNvbnN0IHdyaXRlID0gd3JpdGVzW2ldO1xuICAgICAgICAvLyBUaGVvcnksIGEgbGF0ZXIgc2V0IHdpbGwgZWl0aGVyOlxuICAgICAgICAvLyBhKSBhYm9ydCBhIHJlbGV2YW50IHRyYW5zYWN0aW9uLCBzbyBubyBuZWVkIHRvIHdvcnJ5IGFib3V0IGV4Y2x1ZGluZyBpdCBmcm9tIGNhbGN1bGF0aW5nIHRoYXQgdHJhbnNhY3Rpb25cbiAgICAgICAgLy8gYikgbm90IGJlIHJlbGV2YW50IHRvIGEgdHJhbnNhY3Rpb24gKHNlcGFyYXRlIGJyYW5jaCksIHNvIGFnYWluIHdpbGwgbm90IGFmZmVjdCB0aGUgZGF0YSBmb3IgdGhhdCB0cmFuc2FjdGlvblxuICAgICAgICBpZiAoZmlsdGVyKHdyaXRlKSkge1xuICAgICAgICAgICAgY29uc3Qgd3JpdGVQYXRoID0gd3JpdGUucGF0aDtcbiAgICAgICAgICAgIGxldCByZWxhdGl2ZVBhdGg7XG4gICAgICAgICAgICBpZiAod3JpdGUuc25hcCkge1xuICAgICAgICAgICAgICAgIGlmIChwYXRoQ29udGFpbnModHJlZVJvb3QsIHdyaXRlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHRyZWVSb290LCB3cml0ZVBhdGgpO1xuICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKGNvbXBvdW5kV3JpdGUsIHJlbGF0aXZlUGF0aCwgd3JpdGUuc25hcCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVBhdGgsIHRyZWVSb290KSkge1xuICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgod3JpdGVQYXRoLCB0cmVlUm9vdCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvdW5kV3JpdGUgPSBjb21wb3VuZFdyaXRlQWRkV3JpdGUoY29tcG91bmRXcml0ZSwgbmV3RW1wdHlQYXRoKCksIHdyaXRlLnNuYXAuZ2V0Q2hpbGQocmVsYXRpdmVQYXRoKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAod3JpdGUuY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBpZiAocGF0aENvbnRhaW5zKHRyZWVSb290LCB3cml0ZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aCh0cmVlUm9vdCwgd3JpdGVQYXRoKTtcbiAgICAgICAgICAgICAgICAgICAgY29tcG91bmRXcml0ZSA9IGNvbXBvdW5kV3JpdGVBZGRXcml0ZXMoY29tcG91bmRXcml0ZSwgcmVsYXRpdmVQYXRoLCB3cml0ZS5jaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHBhdGhDb250YWlucyh3cml0ZVBhdGgsIHRyZWVSb290KSkge1xuICAgICAgICAgICAgICAgICAgICByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgod3JpdGVQYXRoLCB0cmVlUm9vdCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShyZWxhdGl2ZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlcyhjb21wb3VuZFdyaXRlLCBuZXdFbXB0eVBhdGgoKSwgd3JpdGUuY2hpbGRyZW4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2hpbGQgPSBzYWZlR2V0KHdyaXRlLmNoaWxkcmVuLCBwYXRoR2V0RnJvbnQocmVsYXRpdmVQYXRoKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2hpbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBUaGVyZSBleGlzdHMgYSBjaGlsZCBpbiB0aGlzIG5vZGUgdGhhdCBtYXRjaGVzIHRoZSByb290IHBhdGhcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWVwTm9kZSA9IGNoaWxkLmdldENoaWxkKHBhdGhQb3BGcm9udChyZWxhdGl2ZVBhdGgpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb21wb3VuZFdyaXRlID0gY29tcG91bmRXcml0ZUFkZFdyaXRlKGNvbXBvdW5kV3JpdGUsIG5ld0VtcHR5UGF0aCgpLCBkZWVwTm9kZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcignV3JpdGVSZWNvcmQgc2hvdWxkIGhhdmUgLnNuYXAgb3IgLmNoaWxkcmVuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNvbXBvdW5kV3JpdGU7XG59XG4vKipcbiAqIEdpdmVuIG9wdGlvbmFsLCB1bmRlcmx5aW5nIHNlcnZlciBkYXRhLCBhbmQgYW4gb3B0aW9uYWwgc2V0IG9mIGNvbnN0cmFpbnRzIChleGNsdWRlIHNvbWUgc2V0cywgaW5jbHVkZSBoaWRkZW5cbiAqIHdyaXRlcyksIGF0dGVtcHQgdG8gY2FsY3VsYXRlIGEgY29tcGxldGUgc25hcHNob3QgZm9yIHRoZSBnaXZlbiBwYXRoXG4gKlxuICogQHBhcmFtIHdyaXRlSWRzVG9FeGNsdWRlIC0gQW4gb3B0aW9uYWwgc2V0IHRvIGJlIGV4Y2x1ZGVkXG4gKiBAcGFyYW0gaW5jbHVkZUhpZGRlbldyaXRlcyAtIERlZmF1bHRzIHRvIGZhbHNlLCB3aGV0aGVyIG9yIG5vdCB0byBsYXllciBvbiB3cml0ZXMgd2l0aCB2aXNpYmxlIHNldCB0byBmYWxzZVxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNvbXBsZXRlU2VydmVyQ2FjaGUsIHdyaXRlSWRzVG9FeGNsdWRlLCBpbmNsdWRlSGlkZGVuV3JpdGVzKSB7XG4gICAgaWYgKCF3cml0ZUlkc1RvRXhjbHVkZSAmJiAhaW5jbHVkZUhpZGRlbldyaXRlcykge1xuICAgICAgICBjb25zdCBzaGFkb3dpbmdOb2RlID0gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpO1xuICAgICAgICBpZiAoc2hhZG93aW5nTm9kZSAhPSBudWxsKSB7XG4gICAgICAgICAgICByZXR1cm4gc2hhZG93aW5nTm9kZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHN1Yk1lcmdlID0gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpO1xuICAgICAgICAgICAgaWYgKGNvbXBvdW5kV3JpdGVJc0VtcHR5KHN1Yk1lcmdlKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVNlcnZlckNhY2hlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY29tcGxldGVTZXJ2ZXJDYWNoZSA9PSBudWxsICYmXG4gICAgICAgICAgICAgICAgIWNvbXBvdW5kV3JpdGVIYXNDb21wbGV0ZVdyaXRlKHN1Yk1lcmdlLCBuZXdFbXB0eVBhdGgoKSkpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSB3b3VsZG4ndCBoYXZlIGEgY29tcGxldGUgc25hcHNob3QsIHNpbmNlIHRoZXJlJ3Mgbm8gdW5kZXJseWluZyBkYXRhIGFuZCBubyBjb21wbGV0ZSBzaGFkb3dcbiAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGxheWVyZWRDYWNoZSA9IGNvbXBsZXRlU2VydmVyQ2FjaGUgfHwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVBcHBseShzdWJNZXJnZSwgbGF5ZXJlZENhY2hlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgbWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCB0cmVlUGF0aCk7XG4gICAgICAgIGlmICghaW5jbHVkZUhpZGRlbldyaXRlcyAmJiBjb21wb3VuZFdyaXRlSXNFbXB0eShtZXJnZSkpIHtcbiAgICAgICAgICAgIHJldHVybiBjb21wbGV0ZVNlcnZlckNhY2hlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgdGhlIHNlcnZlciBjYWNoZSBpcyBudWxsLCBhbmQgd2UgZG9uJ3QgaGF2ZSBhIGNvbXBsZXRlIGNhY2hlLCB3ZSBuZWVkIHRvIHJldHVybiBudWxsXG4gICAgICAgICAgICBpZiAoIWluY2x1ZGVIaWRkZW5Xcml0ZXMgJiZcbiAgICAgICAgICAgICAgICBjb21wbGV0ZVNlcnZlckNhY2hlID09IG51bGwgJiZcbiAgICAgICAgICAgICAgICAhY29tcG91bmRXcml0ZUhhc0NvbXBsZXRlV3JpdGUobWVyZ2UsIG5ld0VtcHR5UGF0aCgpKSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsdGVyID0gZnVuY3Rpb24gKHdyaXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAoKHdyaXRlLnZpc2libGUgfHwgaW5jbHVkZUhpZGRlbldyaXRlcykgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgICghd3JpdGVJZHNUb0V4Y2x1ZGUgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAhfndyaXRlSWRzVG9FeGNsdWRlLmluZGV4T2Yod3JpdGUud3JpdGVJZCkpICYmXG4gICAgICAgICAgICAgICAgICAgICAgICAocGF0aENvbnRhaW5zKHdyaXRlLnBhdGgsIHRyZWVQYXRoKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhDb250YWlucyh0cmVlUGF0aCwgd3JpdGUucGF0aCkpKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGNvbnN0IG1lcmdlQXRQYXRoID0gd3JpdGVUcmVlTGF5ZXJUcmVlXyh3cml0ZVRyZWUuYWxsV3JpdGVzLCBmaWx0ZXIsIHRyZWVQYXRoKTtcbiAgICAgICAgICAgICAgICBjb25zdCBsYXllcmVkQ2FjaGUgPSBjb21wbGV0ZVNlcnZlckNhY2hlIHx8IENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFO1xuICAgICAgICAgICAgICAgIHJldHVybiBjb21wb3VuZFdyaXRlQXBwbHkobWVyZ2VBdFBhdGgsIGxheWVyZWRDYWNoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59XG4vKipcbiAqIFdpdGggb3B0aW9uYWwsIHVuZGVybHlpbmcgc2VydmVyIGRhdGEsIGF0dGVtcHQgdG8gcmV0dXJuIGEgY2hpbGRyZW4gbm9kZSBvZiBjaGlsZHJlbiB0aGF0IHdlIGhhdmUgY29tcGxldGUgZGF0YSBmb3IuXG4gKiBVc2VkIHdoZW4gY3JlYXRpbmcgbmV3IHZpZXdzLCB0byBwcmUtZmlsbCB0aGVpciBjb21wbGV0ZSBldmVudCBjaGlsZHJlbiBzbmFwc2hvdC5cbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZVRyZWUsIHRyZWVQYXRoLCBjb21wbGV0ZVNlcnZlckNoaWxkcmVuKSB7XG4gICAgbGV0IGNvbXBsZXRlQ2hpbGRyZW4gPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICBjb25zdCB0b3BMZXZlbFNldCA9IGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZU5vZGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHRyZWVQYXRoKTtcbiAgICBpZiAodG9wTGV2ZWxTZXQpIHtcbiAgICAgICAgaWYgKCF0b3BMZXZlbFNldC5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgIC8vIHdlJ3JlIHNoYWRvd2luZyBldmVyeXRoaW5nLiBSZXR1cm4gdGhlIGNoaWxkcmVuLlxuICAgICAgICAgICAgdG9wTGV2ZWxTZXQuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZFNuYXApID0+IHtcbiAgICAgICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUsIGNoaWxkU25hcCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gY29tcGxldGVDaGlsZHJlbjtcbiAgICB9XG4gICAgZWxzZSBpZiAoY29tcGxldGVTZXJ2ZXJDaGlsZHJlbikge1xuICAgICAgICAvLyBMYXllciBhbnkgY2hpbGRyZW4gd2UgaGF2ZSBvbiB0b3Agb2YgdGhpc1xuICAgICAgICAvLyBXZSBrbm93IHdlIGRvbid0IGhhdmUgYSB0b3AtbGV2ZWwgc2V0LCBzbyBqdXN0IGVudW1lcmF0ZSBleGlzdGluZyBjaGlsZHJlblxuICAgICAgICBjb25zdCBtZXJnZSA9IGNvbXBvdW5kV3JpdGVDaGlsZENvbXBvdW5kV3JpdGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHRyZWVQYXRoKTtcbiAgICAgICAgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbi5mb3JFYWNoQ2hpbGQoUFJJT1JJVFlfSU5ERVgsIChjaGlsZE5hbWUsIGNoaWxkTm9kZSkgPT4ge1xuICAgICAgICAgICAgY29uc3Qgbm9kZSA9IGNvbXBvdW5kV3JpdGVBcHBseShjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKG1lcmdlLCBuZXcgUGF0aChjaGlsZE5hbWUpKSwgY2hpbGROb2RlKTtcbiAgICAgICAgICAgIGNvbXBsZXRlQ2hpbGRyZW4gPSBjb21wbGV0ZUNoaWxkcmVuLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbm9kZSk7XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBBZGQgYW55IGNvbXBsZXRlIGNoaWxkcmVuIHdlIGhhdmUgZnJvbSB0aGUgc2V0XG4gICAgICAgIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKG1lcmdlKS5mb3JFYWNoKG5hbWVkTm9kZSA9PiB7XG4gICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChuYW1lZE5vZGUubmFtZSwgbmFtZWROb2RlLm5vZGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2hpbGRyZW47XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBXZSBkb24ndCBoYXZlIGFueXRoaW5nIHRvIGxheWVyIG9uIHRvcCBvZi4gTGF5ZXIgb24gYW55IGNoaWxkcmVuIHdlIGhhdmVcbiAgICAgICAgLy8gTm90ZSB0aGF0IHdlIGNhbiByZXR1cm4gYW4gZW1wdHkgc25hcCBpZiB3ZSBoYXZlIGEgZGVmaW5lZCBkZWxldGVcbiAgICAgICAgY29uc3QgbWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCB0cmVlUGF0aCk7XG4gICAgICAgIGNvbXBvdW5kV3JpdGVHZXRDb21wbGV0ZUNoaWxkcmVuKG1lcmdlKS5mb3JFYWNoKG5hbWVkTm9kZSA9PiB7XG4gICAgICAgICAgICBjb21wbGV0ZUNoaWxkcmVuID0gY29tcGxldGVDaGlsZHJlbi51cGRhdGVJbW1lZGlhdGVDaGlsZChuYW1lZE5vZGUubmFtZSwgbmFtZWROb2RlLm5vZGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGNvbXBsZXRlQ2hpbGRyZW47XG4gICAgfVxufVxuLyoqXG4gKiBHaXZlbiB0aGF0IHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGhhcyB1cGRhdGVkLCBkZXRlcm1pbmUgd2hhdCwgaWYgYW55dGhpbmcsIG5lZWRzIHRvIGJlXG4gKiBhcHBsaWVkIHRvIHRoZSBldmVudCBjYWNoZS5cbiAqXG4gKiBQb3NzaWJpbGl0aWVzOlxuICpcbiAqIDEuIE5vIHdyaXRlcyBhcmUgc2hhZG93aW5nLiBFdmVudHMgc2hvdWxkIGJlIHJhaXNlZCwgdGhlIHNuYXAgdG8gYmUgYXBwbGllZCBjb21lcyBmcm9tIHRoZSBzZXJ2ZXIgZGF0YVxuICpcbiAqIDIuIFNvbWUgd3JpdGUgaXMgY29tcGxldGVseSBzaGFkb3dpbmcuIE5vIGV2ZW50cyB0byBiZSByYWlzZWRcbiAqXG4gKiAzLiBJcyBwYXJ0aWFsbHkgc2hhZG93ZWQuIEV2ZW50c1xuICpcbiAqIEVpdGhlciBleGlzdGluZ0V2ZW50U25hcCBvciBleGlzdGluZ1NlcnZlclNuYXAgbXVzdCBleGlzdFxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVDYWxjRXZlbnRDYWNoZUFmdGVyU2VydmVyT3ZlcndyaXRlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNoaWxkUGF0aCwgZXhpc3RpbmdFdmVudFNuYXAsIGV4aXN0aW5nU2VydmVyU25hcCkge1xuICAgIGFzc2VydChleGlzdGluZ0V2ZW50U25hcCB8fCBleGlzdGluZ1NlcnZlclNuYXAsICdFaXRoZXIgZXhpc3RpbmdFdmVudFNuYXAgb3IgZXhpc3RpbmdTZXJ2ZXJTbmFwIG11c3QgZXhpc3QnKTtcbiAgICBjb25zdCBwYXRoID0gcGF0aENoaWxkKHRyZWVQYXRoLCBjaGlsZFBhdGgpO1xuICAgIGlmIChjb21wb3VuZFdyaXRlSGFzQ29tcGxldGVXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCkpIHtcbiAgICAgICAgLy8gQXQgdGhpcyBwb2ludCB3ZSBjYW4gcHJvYmFibHkgZ3VhcmFudGVlIHRoYXQgd2UncmUgaW4gY2FzZSAyLCBtZWFuaW5nIG5vIGV2ZW50c1xuICAgICAgICAvLyBNYXkgbmVlZCB0byBjaGVjayB2aXNpYmlsaXR5IHdoaWxlIGRvaW5nIHRoZSBmaW5kUm9vdE1vc3RWYWx1ZUFuZFBhdGggY2FsbFxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIE5vIGNvbXBsZXRlIHNoYWRvd2luZy4gV2UncmUgZWl0aGVyIHBhcnRpYWxseSBzaGFkb3dpbmcgb3Igbm90IHNoYWRvd2luZyBhdCBhbGwuXG4gICAgICAgIGNvbnN0IGNoaWxkTWVyZ2UgPSBjb21wb3VuZFdyaXRlQ2hpbGRDb21wb3VuZFdyaXRlKHdyaXRlVHJlZS52aXNpYmxlV3JpdGVzLCBwYXRoKTtcbiAgICAgICAgaWYgKGNvbXBvdW5kV3JpdGVJc0VtcHR5KGNoaWxkTWVyZ2UpKSB7XG4gICAgICAgICAgICAvLyBXZSdyZSBub3Qgc2hhZG93aW5nIGF0IGFsbC4gQ2FzZSAxXG4gICAgICAgICAgICByZXR1cm4gZXhpc3RpbmdTZXJ2ZXJTbmFwLmdldENoaWxkKGNoaWxkUGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBUaGlzIGNvdWxkIGJlIG1vcmUgZWZmaWNpZW50IGlmIHRoZSBzZXJ2ZXJOb2RlICsgdXBkYXRlcyBkb2Vzbid0IGNoYW5nZSB0aGUgZXZlbnRTbmFwXG4gICAgICAgICAgICAvLyBIb3dldmVyIHRoaXMgaXMgdHJpY2t5IHRvIGZpbmQgb3V0LCBzaW5jZSB1c2VyIHVwZGF0ZXMgZG9uJ3QgbmVjZXNzYXJ5IGNoYW5nZSB0aGUgc2VydmVyXG4gICAgICAgICAgICAvLyBzbmFwLCBlLmcuIHByaW9yaXR5IHVwZGF0ZXMgb24gZW1wdHkgbm9kZXMsIG9yIGRlZXAgZGVsZXRlcy4gQW5vdGhlciBzcGVjaWFsIGNhc2UgaXMgaWYgdGhlIHNlcnZlclxuICAgICAgICAgICAgLy8gYWRkcyBub2RlcywgYnV0IGRvZXNuJ3QgY2hhbmdlIGFueSBleGlzdGluZyB3cml0ZXMuIEl0IGlzIHRoZXJlZm9yZSBub3QgZW5vdWdoIHRvXG4gICAgICAgICAgICAvLyBvbmx5IGNoZWNrIGlmIHRoZSB1cGRhdGVzIGNoYW5nZSB0aGUgc2VydmVyTm9kZS5cbiAgICAgICAgICAgIC8vIE1heWJlIGNoZWNrIGlmIHRoZSBtZXJnZSB0cmVlIGNvbnRhaW5zIHRoZXNlIHNwZWNpYWwgY2FzZXMgYW5kIG9ubHkgZG8gYSBmdWxsIG92ZXJ3cml0ZSBpbiB0aGF0IGNhc2U/XG4gICAgICAgICAgICByZXR1cm4gY29tcG91bmRXcml0ZUFwcGx5KGNoaWxkTWVyZ2UsIGV4aXN0aW5nU2VydmVyU25hcC5nZXRDaGlsZChjaGlsZFBhdGgpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogUmV0dXJucyBhIGNvbXBsZXRlIGNoaWxkIGZvciBhIGdpdmVuIHNlcnZlciBzbmFwIGFmdGVyIGFwcGx5aW5nIGFsbCB1c2VyIHdyaXRlcyBvciBudWxsIGlmIHRoZXJlIGlzIG5vXG4gKiBjb21wbGV0ZSBjaGlsZCBmb3IgdGhpcyBDaGlsZEtleS5cbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVUcmVlLCB0cmVlUGF0aCwgY2hpbGRLZXksIGV4aXN0aW5nU2VydmVyU25hcCkge1xuICAgIGNvbnN0IHBhdGggPSBwYXRoQ2hpbGQodHJlZVBhdGgsIGNoaWxkS2V5KTtcbiAgICBjb25zdCBzaGFkb3dpbmdOb2RlID0gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCk7XG4gICAgaWYgKHNoYWRvd2luZ05vZGUgIT0gbnVsbCkge1xuICAgICAgICByZXR1cm4gc2hhZG93aW5nTm9kZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmIChleGlzdGluZ1NlcnZlclNuYXAuaXNDb21wbGV0ZUZvckNoaWxkKGNoaWxkS2V5KSkge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRNZXJnZSA9IGNvbXBvdW5kV3JpdGVDaGlsZENvbXBvdW5kV3JpdGUod3JpdGVUcmVlLnZpc2libGVXcml0ZXMsIHBhdGgpO1xuICAgICAgICAgICAgcmV0dXJuIGNvbXBvdW5kV3JpdGVBcHBseShjaGlsZE1lcmdlLCBleGlzdGluZ1NlcnZlclNuYXAuZ2V0Tm9kZSgpLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogUmV0dXJucyBhIG5vZGUgaWYgdGhlcmUgaXMgYSBjb21wbGV0ZSBvdmVyd3JpdGUgZm9yIHRoaXMgcGF0aC4gTW9yZSBzcGVjaWZpY2FsbHksIGlmIHRoZXJlIGlzIGEgd3JpdGUgYXRcbiAqIGEgaGlnaGVyIHBhdGgsIHRoaXMgd2lsbCByZXR1cm4gdGhlIGNoaWxkIG9mIHRoYXQgd3JpdGUgcmVsYXRpdmUgdG8gdGhlIHdyaXRlIGFuZCB0aGlzIHBhdGguXG4gKiBSZXR1cm5zIG51bGwgaWYgdGhlcmUgaXMgbm8gd3JpdGUgYXQgdGhpcyBwYXRoLlxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVTaGFkb3dpbmdXcml0ZSh3cml0ZVRyZWUsIHBhdGgpIHtcbiAgICByZXR1cm4gY29tcG91bmRXcml0ZUdldENvbXBsZXRlTm9kZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgcGF0aCk7XG59XG4vKipcbiAqIFRoaXMgbWV0aG9kIGlzIHVzZWQgd2hlbiBwcm9jZXNzaW5nIGNoaWxkIHJlbW92ZSBldmVudHMgb24gYSBxdWVyeS4gSWYgd2UgY2FuLCB3ZSBwdWxsIGluIGNoaWxkcmVuIHRoYXQgd2VyZSBvdXRzaWRlXG4gKiB0aGUgd2luZG93LCBidXQgbWF5IG5vdyBiZSBpbiB0aGUgd2luZG93LlxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZSwgdHJlZVBhdGgsIGNvbXBsZXRlU2VydmVyRGF0YSwgc3RhcnRQb3N0LCBjb3VudCwgcmV2ZXJzZSwgaW5kZXgpIHtcbiAgICBsZXQgdG9JdGVyYXRlO1xuICAgIGNvbnN0IG1lcmdlID0gY29tcG91bmRXcml0ZUNoaWxkQ29tcG91bmRXcml0ZSh3cml0ZVRyZWUudmlzaWJsZVdyaXRlcywgdHJlZVBhdGgpO1xuICAgIGNvbnN0IHNoYWRvd2luZ05vZGUgPSBjb21wb3VuZFdyaXRlR2V0Q29tcGxldGVOb2RlKG1lcmdlLCBuZXdFbXB0eVBhdGgoKSk7XG4gICAgaWYgKHNoYWRvd2luZ05vZGUgIT0gbnVsbCkge1xuICAgICAgICB0b0l0ZXJhdGUgPSBzaGFkb3dpbmdOb2RlO1xuICAgIH1cbiAgICBlbHNlIGlmIChjb21wbGV0ZVNlcnZlckRhdGEgIT0gbnVsbCkge1xuICAgICAgICB0b0l0ZXJhdGUgPSBjb21wb3VuZFdyaXRlQXBwbHkobWVyZ2UsIGNvbXBsZXRlU2VydmVyRGF0YSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBubyBjaGlsZHJlbiB0byBpdGVyYXRlIG9uXG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgdG9JdGVyYXRlID0gdG9JdGVyYXRlLndpdGhJbmRleChpbmRleCk7XG4gICAgaWYgKCF0b0l0ZXJhdGUuaXNFbXB0eSgpICYmICF0b0l0ZXJhdGUuaXNMZWFmTm9kZSgpKSB7XG4gICAgICAgIGNvbnN0IG5vZGVzID0gW107XG4gICAgICAgIGNvbnN0IGNtcCA9IGluZGV4LmdldENvbXBhcmUoKTtcbiAgICAgICAgY29uc3QgaXRlciA9IHJldmVyc2VcbiAgICAgICAgICAgID8gdG9JdGVyYXRlLmdldFJldmVyc2VJdGVyYXRvckZyb20oc3RhcnRQb3N0LCBpbmRleClcbiAgICAgICAgICAgIDogdG9JdGVyYXRlLmdldEl0ZXJhdG9yRnJvbShzdGFydFBvc3QsIGluZGV4KTtcbiAgICAgICAgbGV0IG5leHQgPSBpdGVyLmdldE5leHQoKTtcbiAgICAgICAgd2hpbGUgKG5leHQgJiYgbm9kZXMubGVuZ3RoIDwgY291bnQpIHtcbiAgICAgICAgICAgIGlmIChjbXAobmV4dCwgc3RhcnRQb3N0KSAhPT0gMCkge1xuICAgICAgICAgICAgICAgIG5vZGVzLnB1c2gobmV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBuZXh0ID0gaXRlci5nZXROZXh0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vZGVzO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbn1cbmZ1bmN0aW9uIG5ld1dyaXRlVHJlZSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICB2aXNpYmxlV3JpdGVzOiBDb21wb3VuZFdyaXRlLmVtcHR5KCksXG4gICAgICAgIGFsbFdyaXRlczogW10sXG4gICAgICAgIGxhc3RXcml0ZUlkOiAtMVxuICAgIH07XG59XG4vKipcbiAqIElmIHBvc3NpYmxlLCByZXR1cm5zIGEgY29tcGxldGUgZXZlbnQgY2FjaGUsIHVzaW5nIHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGlmIHBvc3NpYmxlLiBJbiBhZGRpdGlvbiwgY2FuIGJlIHVzZWRcbiAqIHRvIGdldCBhIGNhY2hlIHRoYXQgaW5jbHVkZXMgaGlkZGVuIHdyaXRlcywgYW5kIGV4Y2x1ZGVzIGFyYml0cmFyeSB3cml0ZXMuIE5vdGUgdGhhdCBjdXN0b21pemluZyB0aGUgcmV0dXJuZWQgbm9kZVxuICogY2FuIGxlYWQgdG8gYSBtb3JlIGV4cGVuc2l2ZSBjYWxjdWxhdGlvbi5cbiAqXG4gKiBAcGFyYW0gd3JpdGVJZHNUb0V4Y2x1ZGUgLSBPcHRpb25hbCB3cml0ZXMgdG8gZXhjbHVkZS5cbiAqIEBwYXJhbSBpbmNsdWRlSGlkZGVuV3JpdGVzIC0gRGVmYXVsdHMgdG8gZmFsc2UsIHdoZXRoZXIgb3Igbm90IHRvIGxheWVyIG9uIHdyaXRlcyB3aXRoIHZpc2libGUgc2V0IHRvIGZhbHNlXG4gKi9cbmZ1bmN0aW9uIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVUcmVlUmVmLCBjb21wbGV0ZVNlcnZlckNhY2hlLCB3cml0ZUlkc1RvRXhjbHVkZSwgaW5jbHVkZUhpZGRlbldyaXRlcykge1xuICAgIHJldHVybiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJDYWNoZSwgd3JpdGVJZHNUb0V4Y2x1ZGUsIGluY2x1ZGVIaWRkZW5Xcml0ZXMpO1xufVxuLyoqXG4gKiBJZiBwb3NzaWJsZSwgcmV0dXJucyBhIGNoaWxkcmVuIG5vZGUgY29udGFpbmluZyBhbGwgb2YgdGhlIGNvbXBsZXRlIGNoaWxkcmVuIHdlIGhhdmUgZGF0YSBmb3IuIFRoZSByZXR1cm5lZCBkYXRhIGlzIGFcbiAqIG1peCBvZiB0aGUgZ2l2ZW4gc2VydmVyIGRhdGEgYW5kIHdyaXRlIGRhdGEuXG4gKlxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlVHJlZVJlZiwgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbikge1xuICAgIHJldHVybiB3cml0ZVRyZWVDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJDaGlsZHJlbik7XG59XG4vKipcbiAqIEdpdmVuIHRoYXQgZWl0aGVyIHRoZSB1bmRlcmx5aW5nIHNlcnZlciBkYXRhIGhhcyB1cGRhdGVkIG9yIHRoZSBvdXRzdGFuZGluZyB3cml0ZXMgaGF2ZSB1cGRhdGVkLCBkZXRlcm1pbmUgd2hhdCxcbiAqIGlmIGFueXRoaW5nLCBuZWVkcyB0byBiZSBhcHBsaWVkIHRvIHRoZSBldmVudCBjYWNoZS5cbiAqXG4gKiBQb3NzaWJpbGl0aWVzOlxuICpcbiAqIDEuIE5vIHdyaXRlcyBhcmUgc2hhZG93aW5nLiBFdmVudHMgc2hvdWxkIGJlIHJhaXNlZCwgdGhlIHNuYXAgdG8gYmUgYXBwbGllZCBjb21lcyBmcm9tIHRoZSBzZXJ2ZXIgZGF0YVxuICpcbiAqIDIuIFNvbWUgd3JpdGUgaXMgY29tcGxldGVseSBzaGFkb3dpbmcuIE5vIGV2ZW50cyB0byBiZSByYWlzZWRcbiAqXG4gKiAzLiBJcyBwYXJ0aWFsbHkgc2hhZG93ZWQuIEV2ZW50cyBzaG91bGQgYmUgcmFpc2VkXG4gKlxuICogRWl0aGVyIGV4aXN0aW5nRXZlbnRTbmFwIG9yIGV4aXN0aW5nU2VydmVyU25hcCBtdXN0IGV4aXN0LCB0aGlzIGlzIHZhbGlkYXRlZCB2aWEgYW4gYXNzZXJ0XG4gKlxuICpcbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlUmVmQ2FsY0V2ZW50Q2FjaGVBZnRlclNlcnZlck92ZXJ3cml0ZSh3cml0ZVRyZWVSZWYsIHBhdGgsIGV4aXN0aW5nRXZlbnRTbmFwLCBleGlzdGluZ1NlcnZlclNuYXApIHtcbiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0V2ZW50Q2FjaGVBZnRlclNlcnZlck92ZXJ3cml0ZSh3cml0ZVRyZWVSZWYud3JpdGVUcmVlLCB3cml0ZVRyZWVSZWYudHJlZVBhdGgsIHBhdGgsIGV4aXN0aW5nRXZlbnRTbmFwLCBleGlzdGluZ1NlcnZlclNuYXApO1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgbm9kZSBpZiB0aGVyZSBpcyBhIGNvbXBsZXRlIG92ZXJ3cml0ZSBmb3IgdGhpcyBwYXRoLiBNb3JlIHNwZWNpZmljYWxseSwgaWYgdGhlcmUgaXMgYSB3cml0ZSBhdFxuICogYSBoaWdoZXIgcGF0aCwgdGhpcyB3aWxsIHJldHVybiB0aGUgY2hpbGQgb2YgdGhhdCB3cml0ZSByZWxhdGl2ZSB0byB0aGUgd3JpdGUgYW5kIHRoaXMgcGF0aC5cbiAqIFJldHVybnMgbnVsbCBpZiB0aGVyZSBpcyBubyB3cml0ZSBhdCB0aGlzIHBhdGguXG4gKlxuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVSZWZTaGFkb3dpbmdXcml0ZSh3cml0ZVRyZWVSZWYsIHBhdGgpIHtcbiAgICByZXR1cm4gd3JpdGVUcmVlU2hhZG93aW5nV3JpdGUod3JpdGVUcmVlUmVmLndyaXRlVHJlZSwgcGF0aENoaWxkKHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgcGF0aCkpO1xufVxuLyoqXG4gKiBUaGlzIG1ldGhvZCBpcyB1c2VkIHdoZW4gcHJvY2Vzc2luZyBjaGlsZCByZW1vdmUgZXZlbnRzIG9uIGEgcXVlcnkuIElmIHdlIGNhbiwgd2UgcHVsbCBpbiBjaGlsZHJlbiB0aGF0IHdlcmUgb3V0c2lkZVxuICogdGhlIHdpbmRvdywgYnV0IG1heSBub3cgYmUgaW4gdGhlIHdpbmRvd1xuICovXG5mdW5jdGlvbiB3cml0ZVRyZWVSZWZDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZVJlZiwgY29tcGxldGVTZXJ2ZXJEYXRhLCBzdGFydFBvc3QsIGNvdW50LCByZXZlcnNlLCBpbmRleCkge1xuICAgIHJldHVybiB3cml0ZVRyZWVDYWxjSW5kZXhlZFNsaWNlKHdyaXRlVHJlZVJlZi53cml0ZVRyZWUsIHdyaXRlVHJlZVJlZi50cmVlUGF0aCwgY29tcGxldGVTZXJ2ZXJEYXRhLCBzdGFydFBvc3QsIGNvdW50LCByZXZlcnNlLCBpbmRleCk7XG59XG4vKipcbiAqIFJldHVybnMgYSBjb21wbGV0ZSBjaGlsZCBmb3IgYSBnaXZlbiBzZXJ2ZXIgc25hcCBhZnRlciBhcHBseWluZyBhbGwgdXNlciB3cml0ZXMgb3IgbnVsbCBpZiB0aGVyZSBpcyBub1xuICogY29tcGxldGUgY2hpbGQgZm9yIHRoaXMgQ2hpbGRLZXkuXG4gKi9cbmZ1bmN0aW9uIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUNoaWxkKHdyaXRlVHJlZVJlZiwgY2hpbGRLZXksIGV4aXN0aW5nU2VydmVyQ2FjaGUpIHtcbiAgICByZXR1cm4gd3JpdGVUcmVlQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVUcmVlUmVmLndyaXRlVHJlZSwgd3JpdGVUcmVlUmVmLnRyZWVQYXRoLCBjaGlsZEtleSwgZXhpc3RpbmdTZXJ2ZXJDYWNoZSk7XG59XG4vKipcbiAqIFJldHVybiBhIFdyaXRlVHJlZVJlZiBmb3IgYSBjaGlsZC5cbiAqL1xuZnVuY3Rpb24gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVUcmVlUmVmLCBjaGlsZE5hbWUpIHtcbiAgICByZXR1cm4gbmV3V3JpdGVUcmVlUmVmKHBhdGhDaGlsZCh3cml0ZVRyZWVSZWYudHJlZVBhdGgsIGNoaWxkTmFtZSksIHdyaXRlVHJlZVJlZi53cml0ZVRyZWUpO1xufVxuZnVuY3Rpb24gbmV3V3JpdGVUcmVlUmVmKHBhdGgsIHdyaXRlVHJlZSkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHRyZWVQYXRoOiBwYXRoLFxuICAgICAgICB3cml0ZVRyZWVcbiAgICB9O1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgQ2hpbGRDaGFuZ2VBY2N1bXVsYXRvciB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMuY2hhbmdlTWFwID0gbmV3IE1hcCgpO1xuICAgIH1cbiAgICB0cmFja0NoaWxkQ2hhbmdlKGNoYW5nZSkge1xuICAgICAgICBjb25zdCB0eXBlID0gY2hhbmdlLnR5cGU7XG4gICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gY2hhbmdlLmNoaWxkTmFtZTtcbiAgICAgICAgYXNzZXJ0KHR5cGUgPT09IFwiY2hpbGRfYWRkZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0FEREVEICovIHx8XG4gICAgICAgICAgICB0eXBlID09PSBcImNoaWxkX2NoYW5nZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8gfHxcbiAgICAgICAgICAgIHR5cGUgPT09IFwiY2hpbGRfcmVtb3ZlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfUkVNT1ZFRCAqLywgJ09ubHkgY2hpbGQgY2hhbmdlcyBzdXBwb3J0ZWQgZm9yIHRyYWNraW5nJyk7XG4gICAgICAgIGFzc2VydChjaGlsZEtleSAhPT0gJy5wcmlvcml0eScsICdPbmx5IG5vbi1wcmlvcml0eSBjaGlsZCBjaGFuZ2VzIGNhbiBiZSB0cmFja2VkLicpO1xuICAgICAgICBjb25zdCBvbGRDaGFuZ2UgPSB0aGlzLmNoYW5nZU1hcC5nZXQoY2hpbGRLZXkpO1xuICAgICAgICBpZiAob2xkQ2hhbmdlKSB7XG4gICAgICAgICAgICBjb25zdCBvbGRUeXBlID0gb2xkQ2hhbmdlLnR5cGU7XG4gICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJjaGlsZF9hZGRlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfQURERUQgKi8gJiZcbiAgICAgICAgICAgICAgICBvbGRUeXBlID09PSBcImNoaWxkX3JlbW92ZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX1JFTU9WRUQgKi8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZU1hcC5zZXQoY2hpbGRLZXksIGNoYW5nZUNoaWxkQ2hhbmdlZChjaGlsZEtleSwgY2hhbmdlLnNuYXBzaG90Tm9kZSwgb2xkQ2hhbmdlLnNuYXBzaG90Tm9kZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gXCJjaGlsZF9yZW1vdmVkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9SRU1PVkVEICovICYmXG4gICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gXCJjaGlsZF9hZGRlZFwiIC8qIENoYW5nZVR5cGUuQ0hJTERfQURERUQgKi8pIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZU1hcC5kZWxldGUoY2hpbGRLZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gXCJjaGlsZF9yZW1vdmVkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9SRU1PVkVEICovICYmXG4gICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gXCJjaGlsZF9jaGFuZ2VkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuc2V0KGNoaWxkS2V5LCBjaGFuZ2VDaGlsZFJlbW92ZWQoY2hpbGRLZXksIG9sZENoYW5nZS5vbGRTbmFwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlID09PSBcImNoaWxkX2NoYW5nZWRcIiAvKiBDaGFuZ2VUeXBlLkNISUxEX0NIQU5HRUQgKi8gJiZcbiAgICAgICAgICAgICAgICBvbGRUeXBlID09PSBcImNoaWxkX2FkZGVkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9BRERFRCAqLykge1xuICAgICAgICAgICAgICAgIHRoaXMuY2hhbmdlTWFwLnNldChjaGlsZEtleSwgY2hhbmdlQ2hpbGRBZGRlZChjaGlsZEtleSwgY2hhbmdlLnNuYXBzaG90Tm9kZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gXCJjaGlsZF9jaGFuZ2VkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovICYmXG4gICAgICAgICAgICAgICAgb2xkVHlwZSA9PT0gXCJjaGlsZF9jaGFuZ2VkXCIgLyogQ2hhbmdlVHlwZS5DSElMRF9DSEFOR0VEICovKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGFuZ2VNYXAuc2V0KGNoaWxkS2V5LCBjaGFuZ2VDaGlsZENoYW5nZWQoY2hpbGRLZXksIGNoYW5nZS5zbmFwc2hvdE5vZGUsIG9sZENoYW5nZS5vbGRTbmFwKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBhc3NlcnRpb25FcnJvcignSWxsZWdhbCBjb21iaW5hdGlvbiBvZiBjaGFuZ2VzOiAnICtcbiAgICAgICAgICAgICAgICAgICAgY2hhbmdlICtcbiAgICAgICAgICAgICAgICAgICAgJyBvY2N1cnJlZCBhZnRlciAnICtcbiAgICAgICAgICAgICAgICAgICAgb2xkQ2hhbmdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2hhbmdlTWFwLnNldChjaGlsZEtleSwgY2hhbmdlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDaGFuZ2VzKCkge1xuICAgICAgICByZXR1cm4gQXJyYXkuZnJvbSh0aGlzLmNoYW5nZU1hcC52YWx1ZXMoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBDb21wbGV0ZUNoaWxkU291cmNlIHRoYXQgbmV2ZXIgcmV0dXJucyBhbnkgYWRkaXRpb25hbCBjaGlsZHJlblxuICovXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25hbWluZy1jb252ZW50aW9uXG5jbGFzcyBOb0NvbXBsZXRlQ2hpbGRTb3VyY2VfIHtcbiAgICBnZXRDb21wbGV0ZUNoaWxkKGNoaWxkS2V5KSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBnZXRDaGlsZEFmdGVyQ2hpbGQoaW5kZXgsIGNoaWxkLCByZXZlcnNlKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbn1cbi8qKlxuICogU2luZ2xldG9uIGluc3RhbmNlLlxuICovXG5jb25zdCBOT19DT01QTEVURV9DSElMRF9TT1VSQ0UgPSBuZXcgTm9Db21wbGV0ZUNoaWxkU291cmNlXygpO1xuLyoqXG4gKiBBbiBpbXBsZW1lbnRhdGlvbiBvZiBDb21wbGV0ZUNoaWxkU291cmNlIHRoYXQgdXNlcyBhIFdyaXRlVHJlZSBpbiBhZGRpdGlvbiB0byBhbnkgb3RoZXIgc2VydmVyIGRhdGEgb3JcbiAqIG9sZCBldmVudCBjYWNoZXMgYXZhaWxhYmxlIHRvIGNhbGN1bGF0ZSBjb21wbGV0ZSBjaGlsZHJlbi5cbiAqL1xuY2xhc3MgV3JpdGVUcmVlQ29tcGxldGVDaGlsZFNvdXJjZSB7XG4gICAgY29uc3RydWN0b3Iod3JpdGVzXywgdmlld0NhY2hlXywgb3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8gPSBudWxsKSB7XG4gICAgICAgIHRoaXMud3JpdGVzXyA9IHdyaXRlc187XG4gICAgICAgIHRoaXMudmlld0NhY2hlXyA9IHZpZXdDYWNoZV87XG4gICAgICAgIHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8gPSBvcHRDb21wbGV0ZVNlcnZlckNhY2hlXztcbiAgICB9XG4gICAgZ2V0Q29tcGxldGVDaGlsZChjaGlsZEtleSkge1xuICAgICAgICBjb25zdCBub2RlID0gdGhpcy52aWV3Q2FjaGVfLmV2ZW50Q2FjaGU7XG4gICAgICAgIGlmIChub2RlLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSkpIHtcbiAgICAgICAgICAgIHJldHVybiBub2RlLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBzZXJ2ZXJOb2RlID0gdGhpcy5vcHRDb21wbGV0ZVNlcnZlckNhY2hlXyAhPSBudWxsXG4gICAgICAgICAgICAgICAgPyBuZXcgQ2FjaGVOb2RlKHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV8sIHRydWUsIGZhbHNlKVxuICAgICAgICAgICAgICAgIDogdGhpcy52aWV3Q2FjaGVfLnNlcnZlckNhY2hlO1xuICAgICAgICAgICAgcmV0dXJuIHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUNoaWxkKHRoaXMud3JpdGVzXywgY2hpbGRLZXksIHNlcnZlck5vZGUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldENoaWxkQWZ0ZXJDaGlsZChpbmRleCwgY2hpbGQsIHJldmVyc2UpIHtcbiAgICAgICAgY29uc3QgY29tcGxldGVTZXJ2ZXJEYXRhID0gdGhpcy5vcHRDb21wbGV0ZVNlcnZlckNhY2hlXyAhPSBudWxsXG4gICAgICAgICAgICA/IHRoaXMub3B0Q29tcGxldGVTZXJ2ZXJDYWNoZV9cbiAgICAgICAgICAgIDogdmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHRoaXMudmlld0NhY2hlXyk7XG4gICAgICAgIGNvbnN0IG5vZGVzID0gd3JpdGVUcmVlUmVmQ2FsY0luZGV4ZWRTbGljZSh0aGlzLndyaXRlc18sIGNvbXBsZXRlU2VydmVyRGF0YSwgY2hpbGQsIDEsIHJldmVyc2UsIGluZGV4KTtcbiAgICAgICAgaWYgKG5vZGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gbm9kZXNbMF07XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBuZXdWaWV3UHJvY2Vzc29yKGZpbHRlcikge1xuICAgIHJldHVybiB7IGZpbHRlciB9O1xufVxuZnVuY3Rpb24gdmlld1Byb2Nlc3NvckFzc2VydEluZGV4ZWQodmlld1Byb2Nlc3Nvciwgdmlld0NhY2hlKSB7XG4gICAgYXNzZXJ0KHZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKS5pc0luZGV4ZWQodmlld1Byb2Nlc3Nvci5maWx0ZXIuZ2V0SW5kZXgoKSksICdFdmVudCBzbmFwIG5vdCBpbmRleGVkJyk7XG4gICAgYXNzZXJ0KHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCkuaXNJbmRleGVkKHZpZXdQcm9jZXNzb3IuZmlsdGVyLmdldEluZGV4KCkpLCAnU2VydmVyIHNuYXAgbm90IGluZGV4ZWQnKTtcbn1cbmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBcHBseU9wZXJhdGlvbih2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUpIHtcbiAgICBjb25zdCBhY2N1bXVsYXRvciA9IG5ldyBDaGlsZENoYW5nZUFjY3VtdWxhdG9yKCk7XG4gICAgbGV0IG5ld1ZpZXdDYWNoZSwgZmlsdGVyU2VydmVyTm9kZTtcbiAgICBpZiAob3BlcmF0aW9uLnR5cGUgPT09IE9wZXJhdGlvblR5cGUuT1ZFUldSSVRFKSB7XG4gICAgICAgIGNvbnN0IG92ZXJ3cml0ZSA9IG9wZXJhdGlvbjtcbiAgICAgICAgaWYgKG92ZXJ3cml0ZS5zb3VyY2UuZnJvbVVzZXIpIHtcbiAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVVzZXJPdmVyd3JpdGUodmlld1Byb2Nlc3Nvciwgb2xkVmlld0NhY2hlLCBvdmVyd3JpdGUucGF0aCwgb3ZlcndyaXRlLnNuYXAsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhc3NlcnQob3ZlcndyaXRlLnNvdXJjZS5mcm9tU2VydmVyLCAnVW5rbm93biBzb3VyY2UuJyk7XG4gICAgICAgICAgICAvLyBXZSBmaWx0ZXIgdGhlIG5vZGUgaWYgaXQncyBhIHRhZ2dlZCB1cGRhdGUgb3IgdGhlIG5vZGUgaGFzIGJlZW4gcHJldmlvdXNseSBmaWx0ZXJlZCAgYW5kIHRoZVxuICAgICAgICAgICAgLy8gdXBkYXRlIGlzIG5vdCBhdCB0aGUgcm9vdCBpbiB3aGljaCBjYXNlIGl0IGlzIG9rIChhbmQgbmVjZXNzYXJ5KSB0byBtYXJrIHRoZSBub2RlIHVuZmlsdGVyZWRcbiAgICAgICAgICAgIC8vIGFnYWluXG4gICAgICAgICAgICBmaWx0ZXJTZXJ2ZXJOb2RlID1cbiAgICAgICAgICAgICAgICBvdmVyd3JpdGUuc291cmNlLnRhZ2dlZCB8fFxuICAgICAgICAgICAgICAgICAgICAob2xkVmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRmlsdGVyZWQoKSAmJiAhcGF0aElzRW1wdHkob3ZlcndyaXRlLnBhdGgpKTtcbiAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIG92ZXJ3cml0ZS5wYXRoLCBvdmVyd3JpdGUuc25hcCwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIGlmIChvcGVyYXRpb24udHlwZSA9PT0gT3BlcmF0aW9uVHlwZS5NRVJHRSkge1xuICAgICAgICBjb25zdCBtZXJnZSA9IG9wZXJhdGlvbjtcbiAgICAgICAgaWYgKG1lcmdlLnNvdXJjZS5mcm9tVXNlcikge1xuICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFwcGx5VXNlck1lcmdlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgbWVyZ2UucGF0aCwgbWVyZ2UuY2hpbGRyZW4sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhc3NlcnQobWVyZ2Uuc291cmNlLmZyb21TZXJ2ZXIsICdVbmtub3duIHNvdXJjZS4nKTtcbiAgICAgICAgICAgIC8vIFdlIGZpbHRlciB0aGUgbm9kZSBpZiBpdCdzIGEgdGFnZ2VkIHVwZGF0ZSBvciB0aGUgbm9kZSBoYXMgYmVlbiBwcmV2aW91c2x5IGZpbHRlcmVkXG4gICAgICAgICAgICBmaWx0ZXJTZXJ2ZXJOb2RlID1cbiAgICAgICAgICAgICAgICBtZXJnZS5zb3VyY2UudGFnZ2VkIHx8IG9sZFZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0ZpbHRlcmVkKCk7XG4gICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJNZXJnZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIG1lcmdlLnBhdGgsIG1lcmdlLmNoaWxkcmVuLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKG9wZXJhdGlvbi50eXBlID09PSBPcGVyYXRpb25UeXBlLkFDS19VU0VSX1dSSVRFKSB7XG4gICAgICAgIGNvbnN0IGFja1VzZXJXcml0ZSA9IG9wZXJhdGlvbjtcbiAgICAgICAgaWYgKCFhY2tVc2VyV3JpdGUucmV2ZXJ0KSB7XG4gICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQWNrVXNlcldyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgYWNrVXNlcldyaXRlLnBhdGgsIGFja1VzZXJXcml0ZS5hZmZlY3RlZFRyZWUsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yUmV2ZXJ0VXNlcldyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgYWNrVXNlcldyaXRlLnBhdGgsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAob3BlcmF0aW9uLnR5cGUgPT09IE9wZXJhdGlvblR5cGUuTElTVEVOX0NPTVBMRVRFKSB7XG4gICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdQcm9jZXNzb3JMaXN0ZW5Db21wbGV0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIG9wZXJhdGlvbi5wYXRoLCB3cml0ZXNDYWNoZSwgYWNjdW11bGF0b3IpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgdGhyb3cgYXNzZXJ0aW9uRXJyb3IoJ1Vua25vd24gb3BlcmF0aW9uIHR5cGU6ICcgKyBvcGVyYXRpb24udHlwZSk7XG4gICAgfVxuICAgIGNvbnN0IGNoYW5nZXMgPSBhY2N1bXVsYXRvci5nZXRDaGFuZ2VzKCk7XG4gICAgdmlld1Byb2Nlc3Nvck1heWJlQWRkVmFsdWVFdmVudChvbGRWaWV3Q2FjaGUsIG5ld1ZpZXdDYWNoZSwgY2hhbmdlcyk7XG4gICAgcmV0dXJuIHsgdmlld0NhY2hlOiBuZXdWaWV3Q2FjaGUsIGNoYW5nZXMgfTtcbn1cbmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JNYXliZUFkZFZhbHVlRXZlbnQob2xkVmlld0NhY2hlLCBuZXdWaWV3Q2FjaGUsIGFjY3VtdWxhdG9yKSB7XG4gICAgY29uc3QgZXZlbnRTbmFwID0gbmV3Vmlld0NhY2hlLmV2ZW50Q2FjaGU7XG4gICAgaWYgKGV2ZW50U25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSkge1xuICAgICAgICBjb25zdCBpc0xlYWZPckVtcHR5ID0gZXZlbnRTbmFwLmdldE5vZGUoKS5pc0xlYWZOb2RlKCkgfHwgZXZlbnRTbmFwLmdldE5vZGUoKS5pc0VtcHR5KCk7XG4gICAgICAgIGNvbnN0IG9sZENvbXBsZXRlU25hcCA9IHZpZXdDYWNoZUdldENvbXBsZXRlRXZlbnRTbmFwKG9sZFZpZXdDYWNoZSk7XG4gICAgICAgIGlmIChhY2N1bXVsYXRvci5sZW5ndGggPiAwIHx8XG4gICAgICAgICAgICAhb2xkVmlld0NhY2hlLmV2ZW50Q2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkgfHxcbiAgICAgICAgICAgIChpc0xlYWZPckVtcHR5ICYmICFldmVudFNuYXAuZ2V0Tm9kZSgpLmVxdWFscyhvbGRDb21wbGV0ZVNuYXApKSB8fFxuICAgICAgICAgICAgIWV2ZW50U25hcC5nZXROb2RlKCkuZ2V0UHJpb3JpdHkoKS5lcXVhbHMob2xkQ29tcGxldGVTbmFwLmdldFByaW9yaXR5KCkpKSB7XG4gICAgICAgICAgICBhY2N1bXVsYXRvci5wdXNoKGNoYW5nZVZhbHVlKHZpZXdDYWNoZUdldENvbXBsZXRlRXZlbnRTbmFwKG5ld1ZpZXdDYWNoZSkpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JHZW5lcmF0ZUV2ZW50Q2FjaGVBZnRlclNlcnZlckV2ZW50KHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgY2hhbmdlUGF0aCwgd3JpdGVzQ2FjaGUsIHNvdXJjZSwgYWNjdW11bGF0b3IpIHtcbiAgICBjb25zdCBvbGRFdmVudFNuYXAgPSB2aWV3Q2FjaGUuZXZlbnRDYWNoZTtcbiAgICBpZiAod3JpdGVUcmVlUmVmU2hhZG93aW5nV3JpdGUod3JpdGVzQ2FjaGUsIGNoYW5nZVBhdGgpICE9IG51bGwpIHtcbiAgICAgICAgLy8gd2UgaGF2ZSBhIHNoYWRvd2luZyB3cml0ZSwgaWdub3JlIGNoYW5nZXNcbiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxldCBuZXdFdmVudENhY2hlLCBzZXJ2ZXJOb2RlO1xuICAgICAgICBpZiAocGF0aElzRW1wdHkoY2hhbmdlUGF0aCkpIHtcbiAgICAgICAgICAgIC8vIFRPRE86IGZpZ3VyZSBvdXQgaG93IHRoaXMgcGxheXMgd2l0aCBcInNsaWRpbmcgYWNrIHdpbmRvd3NcIlxuICAgICAgICAgICAgYXNzZXJ0KHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSwgJ0lmIGNoYW5nZSBwYXRoIGlzIGVtcHR5LCB3ZSBtdXN0IGhhdmUgY29tcGxldGUgc2VydmVyIGRhdGEnKTtcbiAgICAgICAgICAgIGlmICh2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGaWx0ZXJlZCgpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgbmVlZCB0byBzcGVjaWFsIGNhc2UgdGhpcywgYmVjYXVzZSB3ZSBuZWVkIHRvIG9ubHkgYXBwbHkgd3JpdGVzIHRvIGNvbXBsZXRlIGNoaWxkcmVuLCBvclxuICAgICAgICAgICAgICAgIC8vIHdlIG1pZ2h0IGVuZCB1cCByYWlzaW5nIGV2ZW50cyBmb3IgaW5jb21wbGV0ZSBjaGlsZHJlbi4gSWYgdGhlIHNlcnZlciBkYXRhIGlzIGZpbHRlcmVkIGRlZXBcbiAgICAgICAgICAgICAgICAvLyB3cml0ZXMgY2Fubm90IGJlIGd1YXJhbnRlZWQgdG8gYmUgY29tcGxldGVcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJDYWNoZSA9IHZpZXdDYWNoZUdldENvbXBsZXRlU2VydmVyU25hcCh2aWV3Q2FjaGUpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvbXBsZXRlQ2hpbGRyZW4gPSBzZXJ2ZXJDYWNoZSBpbnN0YW5jZW9mIENoaWxkcmVuTm9kZVxuICAgICAgICAgICAgICAgICAgICA/IHNlcnZlckNhY2hlXG4gICAgICAgICAgICAgICAgICAgIDogQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgICAgICAgICAgICAgY29uc3QgY29tcGxldGVFdmVudENoaWxkcmVuID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDaGlsZHJlbih3cml0ZXNDYWNoZSwgY29tcGxldGVDaGlsZHJlbik7XG4gICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKHZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKSwgY29tcGxldGVFdmVudENoaWxkcmVuLCBhY2N1bXVsYXRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBjb21wbGV0ZU5vZGUgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlc0NhY2hlLCB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlld0NhY2hlKSk7XG4gICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKHZpZXdDYWNoZS5ldmVudENhY2hlLmdldE5vZGUoKSwgY29tcGxldGVOb2RlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZEtleSA9IHBhdGhHZXRGcm9udChjaGFuZ2VQYXRoKTtcbiAgICAgICAgICAgIGlmIChjaGlsZEtleSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgICAgICBhc3NlcnQocGF0aEdldExlbmd0aChjaGFuZ2VQYXRoKSA9PT0gMSwgXCJDYW4ndCBoYXZlIGEgcHJpb3JpdHkgd2l0aCBhZGRpdGlvbmFsIHBhdGggY29tcG9uZW50c1wiKTtcbiAgICAgICAgICAgICAgICBjb25zdCBvbGRFdmVudE5vZGUgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgICAgIHNlcnZlck5vZGUgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgICAgIC8vIHdlIG1pZ2h0IGhhdmUgb3ZlcndyaXRlcyBmb3IgdGhpcyBwcmlvcml0eVxuICAgICAgICAgICAgICAgIGNvbnN0IHVwZGF0ZWRQcmlvcml0eSA9IHdyaXRlVHJlZVJlZkNhbGNFdmVudENhY2hlQWZ0ZXJTZXJ2ZXJPdmVyd3JpdGUod3JpdGVzQ2FjaGUsIGNoYW5nZVBhdGgsIG9sZEV2ZW50Tm9kZSwgc2VydmVyTm9kZSk7XG4gICAgICAgICAgICAgICAgaWYgKHVwZGF0ZWRQcmlvcml0eSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVQcmlvcml0eShvbGRFdmVudE5vZGUsIHVwZGF0ZWRQcmlvcml0eSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBwcmlvcml0eSBkaWRuJ3QgY2hhbmdlLCBrZWVwIG9sZCBub2RlXG4gICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNoaWxkQ2hhbmdlUGF0aCA9IHBhdGhQb3BGcm9udChjaGFuZ2VQYXRoKTtcbiAgICAgICAgICAgICAgICAvLyB1cGRhdGUgY2hpbGRcbiAgICAgICAgICAgICAgICBsZXQgbmV3RXZlbnRDaGlsZDtcbiAgICAgICAgICAgICAgICBpZiAob2xkRXZlbnRTbmFwLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV2ZW50Q2hpbGRVcGRhdGUgPSB3cml0ZVRyZWVSZWZDYWxjRXZlbnRDYWNoZUFmdGVyU2VydmVyT3ZlcndyaXRlKHdyaXRlc0NhY2hlLCBjaGFuZ2VQYXRoLCBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLCBzZXJ2ZXJOb2RlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50Q2hpbGRVcGRhdGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDaGlsZCA9IG9sZEV2ZW50U25hcFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXROb2RlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGRLZXkpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLnVwZGF0ZUNoaWxkKGNoaWxkQ2hhbmdlUGF0aCwgZXZlbnRDaGlsZFVwZGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBOb3RoaW5nIGNoYW5nZWQsIGp1c3Qga2VlcCB0aGUgb2xkIGNoaWxkXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENoaWxkID0gb2xkRXZlbnRTbmFwLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2hpbGQgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVDaGlsZCh3cml0ZXNDYWNoZSwgY2hpbGRLZXksIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChuZXdFdmVudENoaWxkICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUNoaWxkKG9sZEV2ZW50U25hcC5nZXROb2RlKCksIGNoaWxkS2V5LCBuZXdFdmVudENoaWxkLCBjaGlsZENoYW5nZVBhdGgsIHNvdXJjZSwgYWNjdW11bGF0b3IpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gbm8gY29tcGxldGUgY2hpbGQgYXZhaWxhYmxlIG9yIG5vIGNoYW5nZVxuICAgICAgICAgICAgICAgICAgICBuZXdFdmVudENhY2hlID0gb2xkRXZlbnRTbmFwLmdldE5vZGUoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcCh2aWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIG9sZEV2ZW50U25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fCBwYXRoSXNFbXB0eShjaGFuZ2VQYXRoKSwgdmlld1Byb2Nlc3Nvci5maWx0ZXIuZmlsdGVyc05vZGVzKCkpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBvbGRWaWV3Q2FjaGUsIGNoYW5nZVBhdGgsIGNoYW5nZWRTbmFwLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpIHtcbiAgICBjb25zdCBvbGRTZXJ2ZXJTbmFwID0gb2xkVmlld0NhY2hlLnNlcnZlckNhY2hlO1xuICAgIGxldCBuZXdTZXJ2ZXJDYWNoZTtcbiAgICBjb25zdCBzZXJ2ZXJGaWx0ZXIgPSBmaWx0ZXJTZXJ2ZXJOb2RlXG4gICAgICAgID8gdmlld1Byb2Nlc3Nvci5maWx0ZXJcbiAgICAgICAgOiB2aWV3UHJvY2Vzc29yLmZpbHRlci5nZXRJbmRleGVkRmlsdGVyKCk7XG4gICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7XG4gICAgICAgIG5ld1NlcnZlckNhY2hlID0gc2VydmVyRmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKG9sZFNlcnZlclNuYXAuZ2V0Tm9kZSgpLCBjaGFuZ2VkU25hcCwgbnVsbCk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlcnZlckZpbHRlci5maWx0ZXJzTm9kZXMoKSAmJiAhb2xkU2VydmVyU25hcC5pc0ZpbHRlcmVkKCkpIHtcbiAgICAgICAgLy8gd2Ugd2FudCB0byBmaWx0ZXIgdGhlIHNlcnZlciBub2RlLCBidXQgd2UgZGlkbid0IGZpbHRlciB0aGUgc2VydmVyIG5vZGUgeWV0LCBzbyBzaW11bGF0ZSBhIGZ1bGwgdXBkYXRlXG4gICAgICAgIGNvbnN0IG5ld1NlcnZlck5vZGUgPSBvbGRTZXJ2ZXJTbmFwXG4gICAgICAgICAgICAuZ2V0Tm9kZSgpXG4gICAgICAgICAgICAudXBkYXRlQ2hpbGQoY2hhbmdlUGF0aCwgY2hhbmdlZFNuYXApO1xuICAgICAgICBuZXdTZXJ2ZXJDYWNoZSA9IHNlcnZlckZpbHRlci51cGRhdGVGdWxsTm9kZShvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKSwgbmV3U2VydmVyTm9kZSwgbnVsbCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBjaGlsZEtleSA9IHBhdGhHZXRGcm9udChjaGFuZ2VQYXRoKTtcbiAgICAgICAgaWYgKCFvbGRTZXJ2ZXJTbmFwLmlzQ29tcGxldGVGb3JQYXRoKGNoYW5nZVBhdGgpICYmXG4gICAgICAgICAgICBwYXRoR2V0TGVuZ3RoKGNoYW5nZVBhdGgpID4gMSkge1xuICAgICAgICAgICAgLy8gV2UgZG9uJ3QgdXBkYXRlIGluY29tcGxldGUgbm9kZXMgd2l0aCB1cGRhdGVzIGludGVuZGVkIGZvciBvdGhlciBsaXN0ZW5lcnNcbiAgICAgICAgICAgIHJldHVybiBvbGRWaWV3Q2FjaGU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2hpbGRDaGFuZ2VQYXRoID0gcGF0aFBvcEZyb250KGNoYW5nZVBhdGgpO1xuICAgICAgICBjb25zdCBjaGlsZE5vZGUgPSBvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7XG4gICAgICAgIGNvbnN0IG5ld0NoaWxkTm9kZSA9IGNoaWxkTm9kZS51cGRhdGVDaGlsZChjaGlsZENoYW5nZVBhdGgsIGNoYW5nZWRTbmFwKTtcbiAgICAgICAgaWYgKGNoaWxkS2V5ID09PSAnLnByaW9yaXR5Jykge1xuICAgICAgICAgICAgbmV3U2VydmVyQ2FjaGUgPSBzZXJ2ZXJGaWx0ZXIudXBkYXRlUHJpb3JpdHkob2xkU2VydmVyU25hcC5nZXROb2RlKCksIG5ld0NoaWxkTm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBuZXdTZXJ2ZXJDYWNoZSA9IHNlcnZlckZpbHRlci51cGRhdGVDaGlsZChvbGRTZXJ2ZXJTbmFwLmdldE5vZGUoKSwgY2hpbGRLZXksIG5ld0NoaWxkTm9kZSwgY2hpbGRDaGFuZ2VQYXRoLCBOT19DT01QTEVURV9DSElMRF9TT1VSQ0UsIG51bGwpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbnN0IG5ld1ZpZXdDYWNoZSA9IHZpZXdDYWNoZVVwZGF0ZVNlcnZlclNuYXAob2xkVmlld0NhY2hlLCBuZXdTZXJ2ZXJDYWNoZSwgb2xkU2VydmVyU25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fCBwYXRoSXNFbXB0eShjaGFuZ2VQYXRoKSwgc2VydmVyRmlsdGVyLmZpbHRlcnNOb2RlcygpKTtcbiAgICBjb25zdCBzb3VyY2UgPSBuZXcgV3JpdGVUcmVlQ29tcGxldGVDaGlsZFNvdXJjZSh3cml0ZXNDYWNoZSwgbmV3Vmlld0NhY2hlLCBjb21wbGV0ZUNhY2hlKTtcbiAgICByZXR1cm4gdmlld1Byb2Nlc3NvckdlbmVyYXRlRXZlbnRDYWNoZUFmdGVyU2VydmVyRXZlbnQodmlld1Byb2Nlc3NvciwgbmV3Vmlld0NhY2hlLCBjaGFuZ2VQYXRoLCB3cml0ZXNDYWNoZSwgc291cmNlLCBhY2N1bXVsYXRvcik7XG59XG5mdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlVc2VyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIG9sZFZpZXdDYWNoZSwgY2hhbmdlUGF0aCwgY2hhbmdlZFNuYXAsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBhY2N1bXVsYXRvcikge1xuICAgIGNvbnN0IG9sZEV2ZW50U25hcCA9IG9sZFZpZXdDYWNoZS5ldmVudENhY2hlO1xuICAgIGxldCBuZXdWaWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGU7XG4gICAgY29uc3Qgc291cmNlID0gbmV3IFdyaXRlVHJlZUNvbXBsZXRlQ2hpbGRTb3VyY2Uod3JpdGVzQ2FjaGUsIG9sZFZpZXdDYWNoZSwgY29tcGxldGVDYWNoZSk7XG4gICAgaWYgKHBhdGhJc0VtcHR5KGNoYW5nZVBhdGgpKSB7XG4gICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVGdWxsTm9kZShvbGRWaWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCksIGNoYW5nZWRTbmFwLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIG5ld1ZpZXdDYWNoZSA9IHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcChvbGRWaWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIHRydWUsIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KGNoYW5nZVBhdGgpO1xuICAgICAgICBpZiAoY2hpbGRLZXkgPT09ICcucHJpb3JpdHknKSB7XG4gICAgICAgICAgICBuZXdFdmVudENhY2hlID0gdmlld1Byb2Nlc3Nvci5maWx0ZXIudXBkYXRlUHJpb3JpdHkob2xkVmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBjaGFuZ2VkU25hcCk7XG4gICAgICAgICAgICBuZXdWaWV3Q2FjaGUgPSB2aWV3Q2FjaGVVcGRhdGVFdmVudFNuYXAob2xkVmlld0NhY2hlLCBuZXdFdmVudENhY2hlLCBvbGRFdmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCksIG9sZEV2ZW50U25hcC5pc0ZpbHRlcmVkKCkpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgY2hpbGRDaGFuZ2VQYXRoID0gcGF0aFBvcEZyb250KGNoYW5nZVBhdGgpO1xuICAgICAgICAgICAgY29uc3Qgb2xkQ2hpbGQgPSBvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkS2V5KTtcbiAgICAgICAgICAgIGxldCBuZXdDaGlsZDtcbiAgICAgICAgICAgIGlmIChwYXRoSXNFbXB0eShjaGlsZENoYW5nZVBhdGgpKSB7XG4gICAgICAgICAgICAgICAgLy8gQ2hpbGQgb3ZlcndyaXRlLCB3ZSBjYW4gcmVwbGFjZSB0aGUgY2hpbGRcbiAgICAgICAgICAgICAgICBuZXdDaGlsZCA9IGNoYW5nZWRTbmFwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc3QgY2hpbGROb2RlID0gc291cmNlLmdldENvbXBsZXRlQ2hpbGQoY2hpbGRLZXkpO1xuICAgICAgICAgICAgICAgIGlmIChjaGlsZE5vZGUgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAocGF0aEdldEJhY2soY2hpbGRDaGFuZ2VQYXRoKSA9PT0gJy5wcmlvcml0eScgJiZcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoaWxkTm9kZS5nZXRDaGlsZChwYXRoUGFyZW50KGNoaWxkQ2hhbmdlUGF0aCkpLmlzRW1wdHkoKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gVGhpcyBpcyBhIHByaW9yaXR5IHVwZGF0ZSBvbiBhbiBlbXB0eSBub2RlLiBJZiB0aGlzIG5vZGUgZXhpc3RzIG9uIHRoZSBzZXJ2ZXIsIHRoZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VydmVyIHdpbGwgc2VuZCBkb3duIHRoZSBwcmlvcml0eSBpbiB0aGUgdXBkYXRlLCBzbyBpZ25vcmUgZm9yIG5vd1xuICAgICAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBjaGlsZE5vZGU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdDaGlsZCA9IGNoaWxkTm9kZS51cGRhdGVDaGlsZChjaGlsZENoYW5nZVBhdGgsIGNoYW5nZWRTbmFwKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gVGhlcmUgaXMgbm8gY29tcGxldGUgY2hpbGQgbm9kZSBhdmFpbGFibGVcbiAgICAgICAgICAgICAgICAgICAgbmV3Q2hpbGQgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIW9sZENoaWxkLmVxdWFscyhuZXdDaGlsZCkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdFdmVudFNuYXAgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVDaGlsZChvbGRFdmVudFNuYXAuZ2V0Tm9kZSgpLCBjaGlsZEtleSwgbmV3Q2hpbGQsIGNoaWxkQ2hhbmdlUGF0aCwgc291cmNlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgICAgICAgICAgbmV3Vmlld0NhY2hlID0gdmlld0NhY2hlVXBkYXRlRXZlbnRTbmFwKG9sZFZpZXdDYWNoZSwgbmV3RXZlbnRTbmFwLCBvbGRFdmVudFNuYXAuaXNGdWxseUluaXRpYWxpemVkKCksIHZpZXdQcm9jZXNzb3IuZmlsdGVyLmZpbHRlcnNOb2RlcygpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld1ZpZXdDYWNoZSA9IG9sZFZpZXdDYWNoZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbmV3Vmlld0NhY2hlO1xufVxuZnVuY3Rpb24gdmlld1Byb2Nlc3NvckNhY2hlSGFzQ2hpbGQodmlld0NhY2hlLCBjaGlsZEtleSkge1xuICAgIHJldHVybiB2aWV3Q2FjaGUuZXZlbnRDYWNoZS5pc0NvbXBsZXRlRm9yQ2hpbGQoY2hpbGRLZXkpO1xufVxuZnVuY3Rpb24gdmlld1Byb2Nlc3NvckFwcGx5VXNlck1lcmdlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKSB7XG4gICAgLy8gSEFDSzogSW4gdGhlIGNhc2Ugb2YgYSBsaW1pdCBxdWVyeSwgdGhlcmUgbWF5IGJlIHNvbWUgY2hhbmdlcyB0aGF0IGJ1bXAgdGhpbmdzIG91dCBvZiB0aGVcbiAgICAvLyB3aW5kb3cgbGVhdmluZyByb29tIGZvciBuZXcgaXRlbXMuICBJdCdzIGltcG9ydGFudCB3ZSBwcm9jZXNzIHRoZXNlIGNoYW5nZXMgZmlyc3QsIHNvIHdlXG4gICAgLy8gaXRlcmF0ZSB0aGUgY2hhbmdlcyB0d2ljZSwgZmlyc3QgcHJvY2Vzc2luZyBhbnkgdGhhdCBhZmZlY3QgaXRlbXMgY3VycmVudGx5IGluIHZpZXcuXG4gICAgLy8gVE9ETzogSSBjb25zaWRlciBhbiBpdGVtIFwiaW4gdmlld1wiIGlmIGNhY2hlSGFzQ2hpbGQgaXMgdHJ1ZSwgd2hpY2ggY2hlY2tzIGJvdGggdGhlIHNlcnZlclxuICAgIC8vIGFuZCBldmVudCBzbmFwLiAgSSdtIG5vdCBzdXJlIGlmIHRoaXMgd2lsbCByZXN1bHQgaW4gZWRnZSBjYXNlcyB3aGVuIGEgY2hpbGQgaXMgaW4gb25lIGJ1dFxuICAgIC8vIG5vdCB0aGUgb3RoZXIuXG4gICAgbGV0IGN1clZpZXdDYWNoZSA9IHZpZXdDYWNoZTtcbiAgICBjaGFuZ2VkQ2hpbGRyZW4uZm9yZWFjaCgocmVsYXRpdmVQYXRoLCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgY29uc3Qgd3JpdGVQYXRoID0gcGF0aENoaWxkKHBhdGgsIHJlbGF0aXZlUGF0aCk7XG4gICAgICAgIGlmICh2aWV3UHJvY2Vzc29yQ2FjaGVIYXNDaGlsZCh2aWV3Q2FjaGUsIHBhdGhHZXRGcm9udCh3cml0ZVBhdGgpKSkge1xuICAgICAgICAgICAgY3VyVmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFwcGx5VXNlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBjdXJWaWV3Q2FjaGUsIHdyaXRlUGF0aCwgY2hpbGROb2RlLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGNoYW5nZWRDaGlsZHJlbi5mb3JlYWNoKChyZWxhdGl2ZVBhdGgsIGNoaWxkTm9kZSkgPT4ge1xuICAgICAgICBjb25zdCB3cml0ZVBhdGggPSBwYXRoQ2hpbGQocGF0aCwgcmVsYXRpdmVQYXRoKTtcbiAgICAgICAgaWYgKCF2aWV3UHJvY2Vzc29yQ2FjaGVIYXNDaGlsZCh2aWV3Q2FjaGUsIHBhdGhHZXRGcm9udCh3cml0ZVBhdGgpKSkge1xuICAgICAgICAgICAgY3VyVmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFwcGx5VXNlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCBjdXJWaWV3Q2FjaGUsIHdyaXRlUGF0aCwgY2hpbGROb2RlLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjdXJWaWV3Q2FjaGU7XG59XG5mdW5jdGlvbiB2aWV3UHJvY2Vzc29yQXBwbHlNZXJnZSh2aWV3UHJvY2Vzc29yLCBub2RlLCBtZXJnZSkge1xuICAgIG1lcmdlLmZvcmVhY2goKHJlbGF0aXZlUGF0aCwgY2hpbGROb2RlKSA9PiB7XG4gICAgICAgIG5vZGUgPSBub2RlLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCwgY2hpbGROb2RlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gbm9kZTtcbn1cbmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck1lcmdlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgcGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKSB7XG4gICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhIGNhY2hlIHlldCwgdGhpcyBtZXJnZSB3YXMgaW50ZW5kZWQgZm9yIGEgcHJldmlvdXNseSBsaXN0ZW4gaW4gdGhlIHNhbWUgbG9jYXRpb24uIElnbm9yZSBpdCBhbmRcbiAgICAvLyB3YWl0IGZvciB0aGUgY29tcGxldGUgZGF0YSB1cGRhdGUgY29taW5nIHNvb24uXG4gICAgaWYgKHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCkuaXNFbXB0eSgpICYmXG4gICAgICAgICF2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkpIHtcbiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZTtcbiAgICB9XG4gICAgLy8gSEFDSzogSW4gdGhlIGNhc2Ugb2YgYSBsaW1pdCBxdWVyeSwgdGhlcmUgbWF5IGJlIHNvbWUgY2hhbmdlcyB0aGF0IGJ1bXAgdGhpbmdzIG91dCBvZiB0aGVcbiAgICAvLyB3aW5kb3cgbGVhdmluZyByb29tIGZvciBuZXcgaXRlbXMuICBJdCdzIGltcG9ydGFudCB3ZSBwcm9jZXNzIHRoZXNlIGNoYW5nZXMgZmlyc3QsIHNvIHdlXG4gICAgLy8gaXRlcmF0ZSB0aGUgY2hhbmdlcyB0d2ljZSwgZmlyc3QgcHJvY2Vzc2luZyBhbnkgdGhhdCBhZmZlY3QgaXRlbXMgY3VycmVudGx5IGluIHZpZXcuXG4gICAgLy8gVE9ETzogSSBjb25zaWRlciBhbiBpdGVtIFwiaW4gdmlld1wiIGlmIGNhY2hlSGFzQ2hpbGQgaXMgdHJ1ZSwgd2hpY2ggY2hlY2tzIGJvdGggdGhlIHNlcnZlclxuICAgIC8vIGFuZCBldmVudCBzbmFwLiAgSSdtIG5vdCBzdXJlIGlmIHRoaXMgd2lsbCByZXN1bHQgaW4gZWRnZSBjYXNlcyB3aGVuIGEgY2hpbGQgaXMgaW4gb25lIGJ1dFxuICAgIC8vIG5vdCB0aGUgb3RoZXIuXG4gICAgbGV0IGN1clZpZXdDYWNoZSA9IHZpZXdDYWNoZTtcbiAgICBsZXQgdmlld01lcmdlVHJlZTtcbiAgICBpZiAocGF0aElzRW1wdHkocGF0aCkpIHtcbiAgICAgICAgdmlld01lcmdlVHJlZSA9IGNoYW5nZWRDaGlsZHJlbjtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZpZXdNZXJnZVRyZWUgPSBuZXcgSW1tdXRhYmxlVHJlZShudWxsKS5zZXRUcmVlKHBhdGgsIGNoYW5nZWRDaGlsZHJlbik7XG4gICAgfVxuICAgIGNvbnN0IHNlcnZlck5vZGUgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpO1xuICAgIHZpZXdNZXJnZVRyZWUuY2hpbGRyZW4uaW5vcmRlclRyYXZlcnNhbCgoY2hpbGRLZXksIGNoaWxkVHJlZSkgPT4ge1xuICAgICAgICBpZiAoc2VydmVyTm9kZS5oYXNDaGlsZChjaGlsZEtleSkpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlckNoaWxkID0gdmlld0NhY2hlLnNlcnZlckNhY2hlXG4gICAgICAgICAgICAgICAgLmdldE5vZGUoKVxuICAgICAgICAgICAgICAgIC5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7XG4gICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IHZpZXdQcm9jZXNzb3JBcHBseU1lcmdlKHZpZXdQcm9jZXNzb3IsIHNlcnZlckNoaWxkLCBjaGlsZFRyZWUpO1xuICAgICAgICAgICAgY3VyVmlld0NhY2hlID0gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyT3ZlcndyaXRlKHZpZXdQcm9jZXNzb3IsIGN1clZpZXdDYWNoZSwgbmV3IFBhdGgoY2hpbGRLZXkpLCBuZXdDaGlsZCwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICB2aWV3TWVyZ2VUcmVlLmNoaWxkcmVuLmlub3JkZXJUcmF2ZXJzYWwoKGNoaWxkS2V5LCBjaGlsZE1lcmdlVHJlZSkgPT4ge1xuICAgICAgICBjb25zdCBpc1Vua25vd25EZWVwTWVyZ2UgPSAhdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzQ29tcGxldGVGb3JDaGlsZChjaGlsZEtleSkgJiZcbiAgICAgICAgICAgIGNoaWxkTWVyZ2VUcmVlLnZhbHVlID09PSBudWxsO1xuICAgICAgICBpZiAoIXNlcnZlck5vZGUuaGFzQ2hpbGQoY2hpbGRLZXkpICYmICFpc1Vua25vd25EZWVwTWVyZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlckNoaWxkID0gdmlld0NhY2hlLnNlcnZlckNhY2hlXG4gICAgICAgICAgICAgICAgLmdldE5vZGUoKVxuICAgICAgICAgICAgICAgIC5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7XG4gICAgICAgICAgICBjb25zdCBuZXdDaGlsZCA9IHZpZXdQcm9jZXNzb3JBcHBseU1lcmdlKHZpZXdQcm9jZXNzb3IsIHNlcnZlckNoaWxkLCBjaGlsZE1lcmdlVHJlZSk7XG4gICAgICAgICAgICBjdXJWaWV3Q2FjaGUgPSB2aWV3UHJvY2Vzc29yQXBwbHlTZXJ2ZXJPdmVyd3JpdGUodmlld1Byb2Nlc3NvciwgY3VyVmlld0NhY2hlLCBuZXcgUGF0aChjaGlsZEtleSksIG5ld0NoaWxkLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBjdXJWaWV3Q2FjaGU7XG59XG5mdW5jdGlvbiB2aWV3UHJvY2Vzc29yQWNrVXNlcldyaXRlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgYWNrUGF0aCwgYWZmZWN0ZWRUcmVlLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgYWNjdW11bGF0b3IpIHtcbiAgICBpZiAod3JpdGVUcmVlUmVmU2hhZG93aW5nV3JpdGUod3JpdGVzQ2FjaGUsIGFja1BhdGgpICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZTtcbiAgICB9XG4gICAgLy8gT25seSBmaWx0ZXIgc2VydmVyIG5vZGUgaWYgaXQgaXMgY3VycmVudGx5IGZpbHRlcmVkXG4gICAgY29uc3QgZmlsdGVyU2VydmVyTm9kZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0ZpbHRlcmVkKCk7XG4gICAgLy8gRXNzZW50aWFsbHkgd2UnbGwganVzdCBnZXQgb3VyIGV4aXN0aW5nIHNlcnZlciBjYWNoZSBmb3IgdGhlIGFmZmVjdGVkIHBhdGhzIGFuZCByZS1hcHBseSBpdCBhcyBhIHNlcnZlciB1cGRhdGVcbiAgICAvLyBub3cgdGhhdCBpdCB3b24ndCBiZSBzaGFkb3dlZC5cbiAgICBjb25zdCBzZXJ2ZXJDYWNoZSA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZTtcbiAgICBpZiAoYWZmZWN0ZWRUcmVlLnZhbHVlICE9IG51bGwpIHtcbiAgICAgICAgLy8gVGhpcyBpcyBhbiBvdmVyd3JpdGUuXG4gICAgICAgIGlmICgocGF0aElzRW1wdHkoYWNrUGF0aCkgJiYgc2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCkpIHx8XG4gICAgICAgICAgICBzZXJ2ZXJDYWNoZS5pc0NvbXBsZXRlRm9yUGF0aChhY2tQYXRoKSkge1xuICAgICAgICAgICAgcmV0dXJuIHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck92ZXJ3cml0ZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIGFja1BhdGgsIHNlcnZlckNhY2hlLmdldE5vZGUoKS5nZXRDaGlsZChhY2tQYXRoKSwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlQ2FjaGUsIGZpbHRlclNlcnZlck5vZGUsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwYXRoSXNFbXB0eShhY2tQYXRoKSkge1xuICAgICAgICAgICAgLy8gVGhpcyBpcyBhIGdvb2Z5IGVkZ2UgY2FzZSB3aGVyZSB3ZSBhcmUgYWNraW5nIGRhdGEgYXQgdGhpcyBsb2NhdGlvbiBidXQgZG9uJ3QgaGF2ZSBmdWxsIGRhdGEuICBXZVxuICAgICAgICAgICAgLy8gc2hvdWxkIGp1c3QgcmUtYXBwbHkgd2hhdGV2ZXIgd2UgaGF2ZSBpbiBvdXIgY2FjaGUgYXMgYSBtZXJnZS5cbiAgICAgICAgICAgIGxldCBjaGFuZ2VkQ2hpbGRyZW4gPSBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTtcbiAgICAgICAgICAgIHNlcnZlckNhY2hlLmdldE5vZGUoKS5mb3JFYWNoQ2hpbGQoS0VZX0lOREVYLCAobmFtZSwgbm9kZSkgPT4ge1xuICAgICAgICAgICAgICAgIGNoYW5nZWRDaGlsZHJlbiA9IGNoYW5nZWRDaGlsZHJlbi5zZXQobmV3IFBhdGgobmFtZSksIG5vZGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdmlld1Byb2Nlc3NvckFwcGx5U2VydmVyTWVyZ2Uodmlld1Byb2Nlc3Nvciwgdmlld0NhY2hlLCBhY2tQYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHdyaXRlc0NhY2hlLCBjb21wbGV0ZUNhY2hlLCBmaWx0ZXJTZXJ2ZXJOb2RlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdmlld0NhY2hlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvLyBUaGlzIGlzIGEgbWVyZ2UuXG4gICAgICAgIGxldCBjaGFuZ2VkQ2hpbGRyZW4gPSBuZXcgSW1tdXRhYmxlVHJlZShudWxsKTtcbiAgICAgICAgYWZmZWN0ZWRUcmVlLmZvcmVhY2goKG1lcmdlUGF0aCwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHNlcnZlckNhY2hlUGF0aCA9IHBhdGhDaGlsZChhY2tQYXRoLCBtZXJnZVBhdGgpO1xuICAgICAgICAgICAgaWYgKHNlcnZlckNhY2hlLmlzQ29tcGxldGVGb3JQYXRoKHNlcnZlckNhY2hlUGF0aCkpIHtcbiAgICAgICAgICAgICAgICBjaGFuZ2VkQ2hpbGRyZW4gPSBjaGFuZ2VkQ2hpbGRyZW4uc2V0KG1lcmdlUGF0aCwgc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpLmdldENoaWxkKHNlcnZlckNhY2hlUGF0aCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHZpZXdQcm9jZXNzb3JBcHBseVNlcnZlck1lcmdlKHZpZXdQcm9jZXNzb3IsIHZpZXdDYWNoZSwgYWNrUGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZXNDYWNoZSwgY29tcGxldGVDYWNoZSwgZmlsdGVyU2VydmVyTm9kZSwgYWNjdW11bGF0b3IpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHZpZXdQcm9jZXNzb3JMaXN0ZW5Db21wbGV0ZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIHBhdGgsIHdyaXRlc0NhY2hlLCBhY2N1bXVsYXRvcikge1xuICAgIGNvbnN0IG9sZFNlcnZlck5vZGUgPSB2aWV3Q2FjaGUuc2VydmVyQ2FjaGU7XG4gICAgY29uc3QgbmV3Vmlld0NhY2hlID0gdmlld0NhY2hlVXBkYXRlU2VydmVyU25hcCh2aWV3Q2FjaGUsIG9sZFNlcnZlck5vZGUuZ2V0Tm9kZSgpLCBvbGRTZXJ2ZXJOb2RlLmlzRnVsbHlJbml0aWFsaXplZCgpIHx8IHBhdGhJc0VtcHR5KHBhdGgpLCBvbGRTZXJ2ZXJOb2RlLmlzRmlsdGVyZWQoKSk7XG4gICAgcmV0dXJuIHZpZXdQcm9jZXNzb3JHZW5lcmF0ZUV2ZW50Q2FjaGVBZnRlclNlcnZlckV2ZW50KHZpZXdQcm9jZXNzb3IsIG5ld1ZpZXdDYWNoZSwgcGF0aCwgd3JpdGVzQ2FjaGUsIE5PX0NPTVBMRVRFX0NISUxEX1NPVVJDRSwgYWNjdW11bGF0b3IpO1xufVxuZnVuY3Rpb24gdmlld1Byb2Nlc3NvclJldmVydFVzZXJXcml0ZSh2aWV3UHJvY2Vzc29yLCB2aWV3Q2FjaGUsIHBhdGgsIHdyaXRlc0NhY2hlLCBjb21wbGV0ZVNlcnZlckNhY2hlLCBhY2N1bXVsYXRvcikge1xuICAgIGxldCBjb21wbGV0ZTtcbiAgICBpZiAod3JpdGVUcmVlUmVmU2hhZG93aW5nV3JpdGUod3JpdGVzQ2FjaGUsIHBhdGgpICE9IG51bGwpIHtcbiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHNvdXJjZSA9IG5ldyBXcml0ZVRyZWVDb21wbGV0ZUNoaWxkU291cmNlKHdyaXRlc0NhY2hlLCB2aWV3Q2FjaGUsIGNvbXBsZXRlU2VydmVyQ2FjaGUpO1xuICAgICAgICBjb25zdCBvbGRFdmVudENhY2hlID0gdmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpO1xuICAgICAgICBsZXQgbmV3RXZlbnRDYWNoZTtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHBhdGgpIHx8IHBhdGhHZXRGcm9udChwYXRoKSA9PT0gJy5wcmlvcml0eScpIHtcbiAgICAgICAgICAgIGxldCBuZXdOb2RlO1xuICAgICAgICAgICAgaWYgKHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSkge1xuICAgICAgICAgICAgICAgIG5ld05vZGUgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENhY2hlKHdyaXRlc0NhY2hlLCB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlld0NhY2hlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBjb25zdCBzZXJ2ZXJDaGlsZHJlbiA9IHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5nZXROb2RlKCk7XG4gICAgICAgICAgICAgICAgYXNzZXJ0KHNlcnZlckNoaWxkcmVuIGluc3RhbmNlb2YgQ2hpbGRyZW5Ob2RlLCAnc2VydmVyQ2hpbGRyZW4gd291bGQgYmUgY29tcGxldGUgaWYgbGVhZiBub2RlJyk7XG4gICAgICAgICAgICAgICAgbmV3Tm9kZSA9IHdyaXRlVHJlZVJlZkNhbGNDb21wbGV0ZUV2ZW50Q2hpbGRyZW4od3JpdGVzQ2FjaGUsIHNlcnZlckNoaWxkcmVuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIG5ld05vZGUgPSBuZXdOb2RlO1xuICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKG9sZEV2ZW50Q2FjaGUsIG5ld05vZGUsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGNoaWxkS2V5ID0gcGF0aEdldEZyb250KHBhdGgpO1xuICAgICAgICAgICAgbGV0IG5ld0NoaWxkID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkS2V5LCB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUpO1xuICAgICAgICAgICAgaWYgKG5ld0NoaWxkID09IG51bGwgJiZcbiAgICAgICAgICAgICAgICB2aWV3Q2FjaGUuc2VydmVyQ2FjaGUuaXNDb21wbGV0ZUZvckNoaWxkKGNoaWxkS2V5KSkge1xuICAgICAgICAgICAgICAgIG5ld0NoaWxkID0gb2xkRXZlbnRDYWNoZS5nZXRJbW1lZGlhdGVDaGlsZChjaGlsZEtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAobmV3Q2hpbGQgIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSB2aWV3UHJvY2Vzc29yLmZpbHRlci51cGRhdGVDaGlsZChvbGRFdmVudENhY2hlLCBjaGlsZEtleSwgbmV3Q2hpbGQsIHBhdGhQb3BGcm9udChwYXRoKSwgc291cmNlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh2aWV3Q2FjaGUuZXZlbnRDYWNoZS5nZXROb2RlKCkuaGFzQ2hpbGQoY2hpbGRLZXkpKSB7XG4gICAgICAgICAgICAgICAgLy8gTm8gY29tcGxldGUgY2hpbGQgYXZhaWxhYmxlLCBkZWxldGUgdGhlIGV4aXN0aW5nIG9uZSwgaWYgYW55XG4gICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUNoaWxkKG9sZEV2ZW50Q2FjaGUsIGNoaWxkS2V5LCBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERSwgcGF0aFBvcEZyb250KHBhdGgpLCBzb3VyY2UsIGFjY3VtdWxhdG9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld0V2ZW50Q2FjaGUgPSBvbGRFdmVudENhY2hlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG5ld0V2ZW50Q2FjaGUuaXNFbXB0eSgpICYmXG4gICAgICAgICAgICAgICAgdmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpKSB7XG4gICAgICAgICAgICAgICAgLy8gV2UgbWlnaHQgaGF2ZSByZXZlcnRlZCBhbGwgY2hpbGQgd3JpdGVzLiBNYXliZSB0aGUgb2xkIGV2ZW50IHdhcyBhIGxlYWYgbm9kZVxuICAgICAgICAgICAgICAgIGNvbXBsZXRlID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZSh3cml0ZXNDYWNoZSwgdmlld0NhY2hlR2V0Q29tcGxldGVTZXJ2ZXJTbmFwKHZpZXdDYWNoZSkpO1xuICAgICAgICAgICAgICAgIGlmIChjb21wbGV0ZS5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgbmV3RXZlbnRDYWNoZSA9IHZpZXdQcm9jZXNzb3IuZmlsdGVyLnVwZGF0ZUZ1bGxOb2RlKG5ld0V2ZW50Q2FjaGUsIGNvbXBsZXRlLCBhY2N1bXVsYXRvcik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbXBsZXRlID1cbiAgICAgICAgICAgIHZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fFxuICAgICAgICAgICAgICAgIHdyaXRlVHJlZVJlZlNoYWRvd2luZ1dyaXRlKHdyaXRlc0NhY2hlLCBuZXdFbXB0eVBhdGgoKSkgIT0gbnVsbDtcbiAgICAgICAgcmV0dXJuIHZpZXdDYWNoZVVwZGF0ZUV2ZW50U25hcCh2aWV3Q2FjaGUsIG5ld0V2ZW50Q2FjaGUsIGNvbXBsZXRlLCB2aWV3UHJvY2Vzc29yLmZpbHRlci5maWx0ZXJzTm9kZXMoKSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBBIHZpZXcgcmVwcmVzZW50cyBhIHNwZWNpZmljIGxvY2F0aW9uIGFuZCBxdWVyeSB0aGF0IGhhcyAxIG9yIG1vcmUgZXZlbnQgcmVnaXN0cmF0aW9ucy5cbiAqXG4gKiBJdCBkb2VzIHNldmVyYWwgdGhpbmdzOlxuICogIC0gTWFpbnRhaW5zIHRoZSBsaXN0IG9mIGV2ZW50IHJlZ2lzdHJhdGlvbnMgZm9yIHRoaXMgbG9jYXRpb24vcXVlcnkuXG4gKiAgLSBNYWludGFpbnMgYSBjYWNoZSBvZiB0aGUgZGF0YSB2aXNpYmxlIGZvciB0aGlzIGxvY2F0aW9uL3F1ZXJ5LlxuICogIC0gQXBwbGllcyBuZXcgb3BlcmF0aW9ucyAodmlhIGFwcGx5T3BlcmF0aW9uKSwgdXBkYXRlcyB0aGUgY2FjaGUsIGFuZCBiYXNlZCBvbiB0aGUgZXZlbnRcbiAqICAgIHJlZ2lzdHJhdGlvbnMgcmV0dXJucyB0aGUgc2V0IG9mIGV2ZW50cyB0byBiZSByYWlzZWQuXG4gKi9cbmNsYXNzIFZpZXcge1xuICAgIGNvbnN0cnVjdG9yKHF1ZXJ5XywgaW5pdGlhbFZpZXdDYWNoZSkge1xuICAgICAgICB0aGlzLnF1ZXJ5XyA9IHF1ZXJ5XztcbiAgICAgICAgdGhpcy5ldmVudFJlZ2lzdHJhdGlvbnNfID0gW107XG4gICAgICAgIGNvbnN0IHBhcmFtcyA9IHRoaXMucXVlcnlfLl9xdWVyeVBhcmFtcztcbiAgICAgICAgY29uc3QgaW5kZXhGaWx0ZXIgPSBuZXcgSW5kZXhlZEZpbHRlcihwYXJhbXMuZ2V0SW5kZXgoKSk7XG4gICAgICAgIGNvbnN0IGZpbHRlciA9IHF1ZXJ5UGFyYW1zR2V0Tm9kZUZpbHRlcihwYXJhbXMpO1xuICAgICAgICB0aGlzLnByb2Nlc3Nvcl8gPSBuZXdWaWV3UHJvY2Vzc29yKGZpbHRlcik7XG4gICAgICAgIGNvbnN0IGluaXRpYWxTZXJ2ZXJDYWNoZSA9IGluaXRpYWxWaWV3Q2FjaGUuc2VydmVyQ2FjaGU7XG4gICAgICAgIGNvbnN0IGluaXRpYWxFdmVudENhY2hlID0gaW5pdGlhbFZpZXdDYWNoZS5ldmVudENhY2hlO1xuICAgICAgICAvLyBEb24ndCBmaWx0ZXIgc2VydmVyIG5vZGUgd2l0aCBvdGhlciBmaWx0ZXIgdGhhbiBpbmRleCwgd2FpdCBmb3IgdGFnZ2VkIGxpc3RlblxuICAgICAgICBjb25zdCBzZXJ2ZXJTbmFwID0gaW5kZXhGaWx0ZXIudXBkYXRlRnVsbE5vZGUoQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUsIGluaXRpYWxTZXJ2ZXJDYWNoZS5nZXROb2RlKCksIG51bGwpO1xuICAgICAgICBjb25zdCBldmVudFNuYXAgPSBmaWx0ZXIudXBkYXRlRnVsbE5vZGUoQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUsIGluaXRpYWxFdmVudENhY2hlLmdldE5vZGUoKSwgbnVsbCk7XG4gICAgICAgIGNvbnN0IG5ld1NlcnZlckNhY2hlID0gbmV3IENhY2hlTm9kZShzZXJ2ZXJTbmFwLCBpbml0aWFsU2VydmVyQ2FjaGUuaXNGdWxseUluaXRpYWxpemVkKCksIGluZGV4RmlsdGVyLmZpbHRlcnNOb2RlcygpKTtcbiAgICAgICAgY29uc3QgbmV3RXZlbnRDYWNoZSA9IG5ldyBDYWNoZU5vZGUoZXZlbnRTbmFwLCBpbml0aWFsRXZlbnRDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSwgZmlsdGVyLmZpbHRlcnNOb2RlcygpKTtcbiAgICAgICAgdGhpcy52aWV3Q2FjaGVfID0gbmV3Vmlld0NhY2hlKG5ld0V2ZW50Q2FjaGUsIG5ld1NlcnZlckNhY2hlKTtcbiAgICAgICAgdGhpcy5ldmVudEdlbmVyYXRvcl8gPSBuZXcgRXZlbnRHZW5lcmF0b3IodGhpcy5xdWVyeV8pO1xuICAgIH1cbiAgICBnZXQgcXVlcnkoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnF1ZXJ5XztcbiAgICB9XG59XG5mdW5jdGlvbiB2aWV3R2V0U2VydmVyQ2FjaGUodmlldykge1xuICAgIHJldHVybiB2aWV3LnZpZXdDYWNoZV8uc2VydmVyQ2FjaGUuZ2V0Tm9kZSgpO1xufVxuZnVuY3Rpb24gdmlld0dldENvbXBsZXRlTm9kZSh2aWV3KSB7XG4gICAgcmV0dXJuIHZpZXdDYWNoZUdldENvbXBsZXRlRXZlbnRTbmFwKHZpZXcudmlld0NhY2hlXyk7XG59XG5mdW5jdGlvbiB2aWV3R2V0Q29tcGxldGVTZXJ2ZXJDYWNoZSh2aWV3LCBwYXRoKSB7XG4gICAgY29uc3QgY2FjaGUgPSB2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlldy52aWV3Q2FjaGVfKTtcbiAgICBpZiAoY2FjaGUpIHtcbiAgICAgICAgLy8gSWYgdGhpcyBpc24ndCBhIFwibG9hZHNBbGxEYXRhXCIgdmlldywgdGhlbiBjYWNoZSBpc24ndCBhY3R1YWxseSBhIGNvbXBsZXRlIGNhY2hlIGFuZFxuICAgICAgICAvLyB3ZSBuZWVkIHRvIHNlZSBpZiBpdCBjb250YWlucyB0aGUgY2hpbGQgd2UncmUgaW50ZXJlc3RlZCBpbi5cbiAgICAgICAgaWYgKHZpZXcucXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpIHx8XG4gICAgICAgICAgICAoIXBhdGhJc0VtcHR5KHBhdGgpICYmXG4gICAgICAgICAgICAgICAgIWNhY2hlLmdldEltbWVkaWF0ZUNoaWxkKHBhdGhHZXRGcm9udChwYXRoKSkuaXNFbXB0eSgpKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNhY2hlLmdldENoaWxkKHBhdGgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xufVxuZnVuY3Rpb24gdmlld0lzRW1wdHkodmlldykge1xuICAgIHJldHVybiB2aWV3LmV2ZW50UmVnaXN0cmF0aW9uc18ubGVuZ3RoID09PSAwO1xufVxuZnVuY3Rpb24gdmlld0FkZEV2ZW50UmVnaXN0cmF0aW9uKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uKSB7XG4gICAgdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfLnB1c2goZXZlbnRSZWdpc3RyYXRpb24pO1xufVxuLyoqXG4gKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb24gLSBJZiBudWxsLCByZW1vdmUgYWxsIGNhbGxiYWNrcy5cbiAqIEBwYXJhbSBjYW5jZWxFcnJvciAtIElmIGEgY2FuY2VsRXJyb3IgaXMgcHJvdmlkZWQsIGFwcHJvcHJpYXRlIGNhbmNlbCBldmVudHMgd2lsbCBiZSByZXR1cm5lZC5cbiAqIEByZXR1cm5zIENhbmNlbCBldmVudHMsIGlmIGNhbmNlbEVycm9yIHdhcyBwcm92aWRlZC5cbiAqL1xuZnVuY3Rpb24gdmlld1JlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uLCBjYW5jZWxFcnJvcikge1xuICAgIGNvbnN0IGNhbmNlbEV2ZW50cyA9IFtdO1xuICAgIGlmIChjYW5jZWxFcnJvcikge1xuICAgICAgICBhc3NlcnQoZXZlbnRSZWdpc3RyYXRpb24gPT0gbnVsbCwgJ0EgY2FuY2VsIHNob3VsZCBjYW5jZWwgYWxsIGV2ZW50IHJlZ2lzdHJhdGlvbnMuJyk7XG4gICAgICAgIGNvbnN0IHBhdGggPSB2aWV3LnF1ZXJ5Ll9wYXRoO1xuICAgICAgICB2aWV3LmV2ZW50UmVnaXN0cmF0aW9uc18uZm9yRWFjaChyZWdpc3RyYXRpb24gPT4ge1xuICAgICAgICAgICAgY29uc3QgbWF5YmVFdmVudCA9IHJlZ2lzdHJhdGlvbi5jcmVhdGVDYW5jZWxFdmVudChjYW5jZWxFcnJvciwgcGF0aCk7XG4gICAgICAgICAgICBpZiAobWF5YmVFdmVudCkge1xuICAgICAgICAgICAgICAgIGNhbmNlbEV2ZW50cy5wdXNoKG1heWJlRXZlbnQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGV2ZW50UmVnaXN0cmF0aW9uKSB7XG4gICAgICAgIGxldCByZW1haW5pbmcgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aWV3LmV2ZW50UmVnaXN0cmF0aW9uc18ubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IGV4aXN0aW5nID0gdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfW2ldO1xuICAgICAgICAgICAgaWYgKCFleGlzdGluZy5tYXRjaGVzKGV2ZW50UmVnaXN0cmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHJlbWFpbmluZy5wdXNoKGV4aXN0aW5nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGV2ZW50UmVnaXN0cmF0aW9uLmhhc0FueUNhbGxiYWNrKCkpIHtcbiAgICAgICAgICAgICAgICAvLyBXZSdyZSByZW1vdmluZyBqdXN0IHRoaXMgb25lXG4gICAgICAgICAgICAgICAgcmVtYWluaW5nID0gcmVtYWluaW5nLmNvbmNhdCh2aWV3LmV2ZW50UmVnaXN0cmF0aW9uc18uc2xpY2UoaSArIDEpKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB2aWV3LmV2ZW50UmVnaXN0cmF0aW9uc18gPSByZW1haW5pbmc7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2aWV3LmV2ZW50UmVnaXN0cmF0aW9uc18gPSBbXTtcbiAgICB9XG4gICAgcmV0dXJuIGNhbmNlbEV2ZW50cztcbn1cbi8qKlxuICogQXBwbGllcyB0aGUgZ2l2ZW4gT3BlcmF0aW9uLCB1cGRhdGVzIG91ciBjYWNoZSwgYW5kIHJldHVybnMgdGhlIGFwcHJvcHJpYXRlIGV2ZW50cy5cbiAqL1xuZnVuY3Rpb24gdmlld0FwcGx5T3BlcmF0aW9uKHZpZXcsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIGNvbXBsZXRlU2VydmVyQ2FjaGUpIHtcbiAgICBpZiAob3BlcmF0aW9uLnR5cGUgPT09IE9wZXJhdGlvblR5cGUuTUVSR0UgJiZcbiAgICAgICAgb3BlcmF0aW9uLnNvdXJjZS5xdWVyeUlkICE9PSBudWxsKSB7XG4gICAgICAgIGFzc2VydCh2aWV3Q2FjaGVHZXRDb21wbGV0ZVNlcnZlclNuYXAodmlldy52aWV3Q2FjaGVfKSwgJ1dlIHNob3VsZCBhbHdheXMgaGF2ZSBhIGZ1bGwgY2FjaGUgYmVmb3JlIGhhbmRsaW5nIG1lcmdlcycpO1xuICAgICAgICBhc3NlcnQodmlld0NhY2hlR2V0Q29tcGxldGVFdmVudFNuYXAodmlldy52aWV3Q2FjaGVfKSwgJ01pc3NpbmcgZXZlbnQgY2FjaGUsIGV2ZW4gdGhvdWdoIHdlIGhhdmUgYSBzZXJ2ZXIgY2FjaGUnKTtcbiAgICB9XG4gICAgY29uc3Qgb2xkVmlld0NhY2hlID0gdmlldy52aWV3Q2FjaGVfO1xuICAgIGNvbnN0IHJlc3VsdCA9IHZpZXdQcm9jZXNzb3JBcHBseU9wZXJhdGlvbih2aWV3LnByb2Nlc3Nvcl8sIG9sZFZpZXdDYWNoZSwgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgY29tcGxldGVTZXJ2ZXJDYWNoZSk7XG4gICAgdmlld1Byb2Nlc3NvckFzc2VydEluZGV4ZWQodmlldy5wcm9jZXNzb3JfLCByZXN1bHQudmlld0NhY2hlKTtcbiAgICBhc3NlcnQocmVzdWx0LnZpZXdDYWNoZS5zZXJ2ZXJDYWNoZS5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSB8fFxuICAgICAgICAhb2xkVmlld0NhY2hlLnNlcnZlckNhY2hlLmlzRnVsbHlJbml0aWFsaXplZCgpLCAnT25jZSBhIHNlcnZlciBzbmFwIGlzIGNvbXBsZXRlLCBpdCBzaG91bGQgbmV2ZXIgZ28gYmFjaycpO1xuICAgIHZpZXcudmlld0NhY2hlXyA9IHJlc3VsdC52aWV3Q2FjaGU7XG4gICAgcmV0dXJuIHZpZXdHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXNfKHZpZXcsIHJlc3VsdC5jaGFuZ2VzLCByZXN1bHQudmlld0NhY2hlLmV2ZW50Q2FjaGUuZ2V0Tm9kZSgpLCBudWxsKTtcbn1cbmZ1bmN0aW9uIHZpZXdHZXRJbml0aWFsRXZlbnRzKHZpZXcsIHJlZ2lzdHJhdGlvbikge1xuICAgIGNvbnN0IGV2ZW50U25hcCA9IHZpZXcudmlld0NhY2hlXy5ldmVudENhY2hlO1xuICAgIGNvbnN0IGluaXRpYWxDaGFuZ2VzID0gW107XG4gICAgaWYgKCFldmVudFNuYXAuZ2V0Tm9kZSgpLmlzTGVhZk5vZGUoKSkge1xuICAgICAgICBjb25zdCBldmVudE5vZGUgPSBldmVudFNuYXAuZ2V0Tm9kZSgpO1xuICAgICAgICBldmVudE5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoa2V5LCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgICAgIGluaXRpYWxDaGFuZ2VzLnB1c2goY2hhbmdlQ2hpbGRBZGRlZChrZXksIGNoaWxkTm9kZSkpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgaWYgKGV2ZW50U25hcC5pc0Z1bGx5SW5pdGlhbGl6ZWQoKSkge1xuICAgICAgICBpbml0aWFsQ2hhbmdlcy5wdXNoKGNoYW5nZVZhbHVlKGV2ZW50U25hcC5nZXROb2RlKCkpKTtcbiAgICB9XG4gICAgcmV0dXJuIHZpZXdHZW5lcmF0ZUV2ZW50c0ZvckNoYW5nZXNfKHZpZXcsIGluaXRpYWxDaGFuZ2VzLCBldmVudFNuYXAuZ2V0Tm9kZSgpLCByZWdpc3RyYXRpb24pO1xufVxuZnVuY3Rpb24gdmlld0dlbmVyYXRlRXZlbnRzRm9yQ2hhbmdlc18odmlldywgY2hhbmdlcywgZXZlbnRDYWNoZSwgZXZlbnRSZWdpc3RyYXRpb24pIHtcbiAgICBjb25zdCByZWdpc3RyYXRpb25zID0gZXZlbnRSZWdpc3RyYXRpb25cbiAgICAgICAgPyBbZXZlbnRSZWdpc3RyYXRpb25dXG4gICAgICAgIDogdmlldy5ldmVudFJlZ2lzdHJhdGlvbnNfO1xuICAgIHJldHVybiBldmVudEdlbmVyYXRvckdlbmVyYXRlRXZlbnRzRm9yQ2hhbmdlcyh2aWV3LmV2ZW50R2VuZXJhdG9yXywgY2hhbmdlcywgZXZlbnRDYWNoZSwgcmVnaXN0cmF0aW9ucyk7XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5sZXQgcmVmZXJlbmNlQ29uc3RydWN0b3IkMTtcbi8qKlxuICogU3luY1BvaW50IHJlcHJlc2VudHMgYSBzaW5nbGUgbG9jYXRpb24gaW4gYSBTeW5jVHJlZSB3aXRoIDEgb3IgbW9yZSBldmVudCByZWdpc3RyYXRpb25zLCBtZWFuaW5nIHdlIG5lZWQgdG9cbiAqIG1haW50YWluIDEgb3IgbW9yZSBWaWV3cyBhdCB0aGlzIGxvY2F0aW9uIHRvIGNhY2hlIHNlcnZlciBkYXRhIGFuZCByYWlzZSBhcHByb3ByaWF0ZSBldmVudHMgZm9yIHNlcnZlciBjaGFuZ2VzXG4gKiBhbmQgdXNlciB3cml0ZXMgKHNldCwgdHJhbnNhY3Rpb24sIHVwZGF0ZSkuXG4gKlxuICogSXQncyByZXNwb25zaWJsZSBmb3I6XG4gKiAgLSBNYWludGFpbmluZyB0aGUgc2V0IG9mIDEgb3IgbW9yZSB2aWV3cyBuZWNlc3NhcnkgYXQgdGhpcyBsb2NhdGlvbiAoYSBTeW5jUG9pbnQgd2l0aCAwIHZpZXdzIHNob3VsZCBiZSByZW1vdmVkKS5cbiAqICAtIFByb3h5aW5nIHVzZXIgLyBzZXJ2ZXIgb3BlcmF0aW9ucyB0byB0aGUgdmlld3MgYXMgYXBwcm9wcmlhdGUgKGkuZS4gYXBwbHlTZXJ2ZXJPdmVyd3JpdGUsXG4gKiAgICBhcHBseVVzZXJPdmVyd3JpdGUsIGV0Yy4pXG4gKi9cbmNsYXNzIFN5bmNQb2ludCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUaGUgVmlld3MgYmVpbmcgdHJhY2tlZCBhdCB0aGlzIGxvY2F0aW9uIGluIHRoZSB0cmVlLCBzdG9yZWQgYXMgYSBtYXAgd2hlcmUgdGhlIGtleSBpcyBhXG4gICAgICAgICAqIHF1ZXJ5SWQgYW5kIHRoZSB2YWx1ZSBpcyB0aGUgVmlldyBmb3IgdGhhdCBxdWVyeS5cbiAgICAgICAgICpcbiAgICAgICAgICogTk9URTogVGhpcyBsaXN0IHdpbGwgYmUgcXVpdGUgc21hbGwgKHVzdWFsbHkgMSwgYnV0IHBlcmhhcHMgMiBvciAzOyBhbnkgbW9yZSBpcyBhbiBvZGQgdXNlIGNhc2UpLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52aWV3cyA9IG5ldyBNYXAoKTtcbiAgICB9XG59XG5mdW5jdGlvbiBzeW5jUG9pbnRTZXRSZWZlcmVuY2VDb25zdHJ1Y3Rvcih2YWwpIHtcbiAgICBhc3NlcnQoIXJlZmVyZW5jZUNvbnN0cnVjdG9yJDEsICdfX3JlZmVyZW5jZUNvbnN0cnVjdG9yIGhhcyBhbHJlYWR5IGJlZW4gZGVmaW5lZCcpO1xuICAgIHJlZmVyZW5jZUNvbnN0cnVjdG9yJDEgPSB2YWw7XG59XG5mdW5jdGlvbiBzeW5jUG9pbnRHZXRSZWZlcmVuY2VDb25zdHJ1Y3RvcigpIHtcbiAgICBhc3NlcnQocmVmZXJlbmNlQ29uc3RydWN0b3IkMSwgJ1JlZmVyZW5jZS50cyBoYXMgbm90IGJlZW4gbG9hZGVkJyk7XG4gICAgcmV0dXJuIHJlZmVyZW5jZUNvbnN0cnVjdG9yJDE7XG59XG5mdW5jdGlvbiBzeW5jUG9pbnRJc0VtcHR5KHN5bmNQb2ludCkge1xuICAgIHJldHVybiBzeW5jUG9pbnQudmlld3Muc2l6ZSA9PT0gMDtcbn1cbmZ1bmN0aW9uIHN5bmNQb2ludEFwcGx5T3BlcmF0aW9uKHN5bmNQb2ludCwgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgb3B0Q29tcGxldGVTZXJ2ZXJDYWNoZSkge1xuICAgIGNvbnN0IHF1ZXJ5SWQgPSBvcGVyYXRpb24uc291cmNlLnF1ZXJ5SWQ7XG4gICAgaWYgKHF1ZXJ5SWQgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgdmlldyA9IHN5bmNQb2ludC52aWV3cy5nZXQocXVlcnlJZCk7XG4gICAgICAgIGFzc2VydCh2aWV3ICE9IG51bGwsICdTeW5jVHJlZSBnYXZlIHVzIGFuIG9wIGZvciBhbiBpbnZhbGlkIHF1ZXJ5LicpO1xuICAgICAgICByZXR1cm4gdmlld0FwcGx5T3BlcmF0aW9uKHZpZXcsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIG9wdENvbXBsZXRlU2VydmVyQ2FjaGUpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IGV2ZW50cyA9IFtdO1xuICAgICAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygc3luY1BvaW50LnZpZXdzLnZhbHVlcygpKSB7XG4gICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHZpZXdBcHBseU9wZXJhdGlvbih2aWV3LCBvcGVyYXRpb24sIHdyaXRlc0NhY2hlLCBvcHRDb21wbGV0ZVNlcnZlckNhY2hlKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGV2ZW50cztcbiAgICB9XG59XG4vKipcbiAqIEdldCBhIHZpZXcgZm9yIHRoZSBzcGVjaWZpZWQgcXVlcnkuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIHF1ZXJ5IHRvIHJldHVybiBhIHZpZXcgZm9yXG4gKiBAcGFyYW0gd3JpdGVzQ2FjaGVcbiAqIEBwYXJhbSBzZXJ2ZXJDYWNoZVxuICogQHBhcmFtIHNlcnZlckNhY2hlQ29tcGxldGVcbiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS5cbiAqL1xuZnVuY3Rpb24gc3luY1BvaW50R2V0VmlldyhzeW5jUG9pbnQsIHF1ZXJ5LCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUpIHtcbiAgICBjb25zdCBxdWVyeUlkID0gcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcjtcbiAgICBjb25zdCB2aWV3ID0gc3luY1BvaW50LnZpZXdzLmdldChxdWVyeUlkKTtcbiAgICBpZiAoIXZpZXcpIHtcbiAgICAgICAgLy8gVE9ETzogbWFrZSB3cml0ZXNDYWNoZSB0YWtlIGZsYWcgZm9yIGNvbXBsZXRlIHNlcnZlciBub2RlXG4gICAgICAgIGxldCBldmVudENhY2hlID0gd3JpdGVUcmVlUmVmQ2FsY0NvbXBsZXRlRXZlbnRDYWNoZSh3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSA/IHNlcnZlckNhY2hlIDogbnVsbCk7XG4gICAgICAgIGxldCBldmVudENhY2hlQ29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgaWYgKGV2ZW50Q2FjaGUpIHtcbiAgICAgICAgICAgIGV2ZW50Q2FjaGVDb21wbGV0ZSA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoc2VydmVyQ2FjaGUgaW5zdGFuY2VvZiBDaGlsZHJlbk5vZGUpIHtcbiAgICAgICAgICAgIGV2ZW50Q2FjaGUgPSB3cml0ZVRyZWVSZWZDYWxjQ29tcGxldGVFdmVudENoaWxkcmVuKHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSk7XG4gICAgICAgICAgICBldmVudENhY2hlQ29tcGxldGUgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGV2ZW50Q2FjaGUgPSBDaGlsZHJlbk5vZGUuRU1QVFlfTk9ERTtcbiAgICAgICAgICAgIGV2ZW50Q2FjaGVDb21wbGV0ZSA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHZpZXdDYWNoZSA9IG5ld1ZpZXdDYWNoZShuZXcgQ2FjaGVOb2RlKGV2ZW50Q2FjaGUsIGV2ZW50Q2FjaGVDb21wbGV0ZSwgZmFsc2UpLCBuZXcgQ2FjaGVOb2RlKHNlcnZlckNhY2hlLCBzZXJ2ZXJDYWNoZUNvbXBsZXRlLCBmYWxzZSkpO1xuICAgICAgICByZXR1cm4gbmV3IFZpZXcocXVlcnksIHZpZXdDYWNoZSk7XG4gICAgfVxuICAgIHJldHVybiB2aWV3O1xufVxuLyoqXG4gKiBBZGQgYW4gZXZlbnQgY2FsbGJhY2sgZm9yIHRoZSBzcGVjaWZpZWQgcXVlcnkuXG4gKlxuICogQHBhcmFtIHF1ZXJ5XG4gKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb25cbiAqIEBwYXJhbSB3cml0ZXNDYWNoZVxuICogQHBhcmFtIHNlcnZlckNhY2hlIC0gQ29tcGxldGUgc2VydmVyIGNhY2hlLCBpZiB3ZSBoYXZlIGl0LlxuICogQHBhcmFtIHNlcnZlckNhY2hlQ29tcGxldGVcbiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS5cbiAqL1xuZnVuY3Rpb24gc3luY1BvaW50QWRkRXZlbnRSZWdpc3RyYXRpb24oc3luY1BvaW50LCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSkge1xuICAgIGNvbnN0IHZpZXcgPSBzeW5jUG9pbnRHZXRWaWV3KHN5bmNQb2ludCwgcXVlcnksIHdyaXRlc0NhY2hlLCBzZXJ2ZXJDYWNoZSwgc2VydmVyQ2FjaGVDb21wbGV0ZSk7XG4gICAgaWYgKCFzeW5jUG9pbnQudmlld3MuaGFzKHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXIpKSB7XG4gICAgICAgIHN5bmNQb2ludC52aWV3cy5zZXQocXVlcnkuX3F1ZXJ5SWRlbnRpZmllciwgdmlldyk7XG4gICAgfVxuICAgIC8vIFRoaXMgaXMgZ3VhcmFudGVlZCB0byBleGlzdCBub3csIHdlIGp1c3QgY3JlYXRlZCBhbnl0aGluZyB0aGF0IHdhcyBtaXNzaW5nXG4gICAgdmlld0FkZEV2ZW50UmVnaXN0cmF0aW9uKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uKTtcbiAgICByZXR1cm4gdmlld0dldEluaXRpYWxFdmVudHModmlldywgZXZlbnRSZWdpc3RyYXRpb24pO1xufVxuLyoqXG4gKiBSZW1vdmUgZXZlbnQgY2FsbGJhY2socykuICBSZXR1cm4gY2FuY2VsRXZlbnRzIGlmIGEgY2FuY2VsRXJyb3IgaXMgc3BlY2lmaWVkLlxuICpcbiAqIElmIHF1ZXJ5IGlzIHRoZSBkZWZhdWx0IHF1ZXJ5LCB3ZSdsbCBjaGVjayBhbGwgdmlld3MgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnRSZWdpc3RyYXRpb24uXG4gKiBJZiBldmVudFJlZ2lzdHJhdGlvbiBpcyBudWxsLCB3ZSdsbCByZW1vdmUgYWxsIGNhbGxiYWNrcyBmb3IgdGhlIHNwZWNpZmllZCB2aWV3KHMpLlxuICpcbiAqIEBwYXJhbSBldmVudFJlZ2lzdHJhdGlvbiAtIElmIG51bGwsIHJlbW92ZSBhbGwgY2FsbGJhY2tzLlxuICogQHBhcmFtIGNhbmNlbEVycm9yIC0gSWYgYSBjYW5jZWxFcnJvciBpcyBwcm92aWRlZCwgYXBwcm9wcmlhdGUgY2FuY2VsIGV2ZW50cyB3aWxsIGJlIHJldHVybmVkLlxuICogQHJldHVybnMgcmVtb3ZlZCBxdWVyaWVzIGFuZCBhbnkgY2FuY2VsIGV2ZW50c1xuICovXG5mdW5jdGlvbiBzeW5jUG9pbnRSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihzeW5jUG9pbnQsIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbiwgY2FuY2VsRXJyb3IpIHtcbiAgICBjb25zdCBxdWVyeUlkID0gcXVlcnkuX3F1ZXJ5SWRlbnRpZmllcjtcbiAgICBjb25zdCByZW1vdmVkID0gW107XG4gICAgbGV0IGNhbmNlbEV2ZW50cyA9IFtdO1xuICAgIGNvbnN0IGhhZENvbXBsZXRlVmlldyA9IHN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhzeW5jUG9pbnQpO1xuICAgIGlmIChxdWVyeUlkID09PSAnZGVmYXVsdCcpIHtcbiAgICAgICAgLy8gV2hlbiB5b3UgZG8gcmVmLm9mZiguLi4pLCB3ZSBzZWFyY2ggYWxsIHZpZXdzIGZvciB0aGUgcmVnaXN0cmF0aW9uIHRvIHJlbW92ZS5cbiAgICAgICAgZm9yIChjb25zdCBbdmlld1F1ZXJ5SWQsIHZpZXddIG9mIHN5bmNQb2ludC52aWV3cy5lbnRyaWVzKCkpIHtcbiAgICAgICAgICAgIGNhbmNlbEV2ZW50cyA9IGNhbmNlbEV2ZW50cy5jb25jYXQodmlld1JlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uLCBjYW5jZWxFcnJvcikpO1xuICAgICAgICAgICAgaWYgKHZpZXdJc0VtcHR5KHZpZXcpKSB7XG4gICAgICAgICAgICAgICAgc3luY1BvaW50LnZpZXdzLmRlbGV0ZSh2aWV3UXVlcnlJZCk7XG4gICAgICAgICAgICAgICAgLy8gV2UnbGwgZGVhbCB3aXRoIGNvbXBsZXRlIHZpZXdzIGxhdGVyLlxuICAgICAgICAgICAgICAgIGlmICghdmlldy5xdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVtb3ZlZC5wdXNoKHZpZXcucXVlcnkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gcmVtb3ZlIHRoZSBjYWxsYmFjayBmcm9tIHRoZSBzcGVjaWZpYyB2aWV3LlxuICAgICAgICBjb25zdCB2aWV3ID0gc3luY1BvaW50LnZpZXdzLmdldChxdWVyeUlkKTtcbiAgICAgICAgaWYgKHZpZXcpIHtcbiAgICAgICAgICAgIGNhbmNlbEV2ZW50cyA9IGNhbmNlbEV2ZW50cy5jb25jYXQodmlld1JlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHZpZXcsIGV2ZW50UmVnaXN0cmF0aW9uLCBjYW5jZWxFcnJvcikpO1xuICAgICAgICAgICAgaWYgKHZpZXdJc0VtcHR5KHZpZXcpKSB7XG4gICAgICAgICAgICAgICAgc3luY1BvaW50LnZpZXdzLmRlbGV0ZShxdWVyeUlkKTtcbiAgICAgICAgICAgICAgICAvLyBXZSdsbCBkZWFsIHdpdGggY29tcGxldGUgdmlld3MgbGF0ZXIuXG4gICAgICAgICAgICAgICAgaWYgKCF2aWV3LnF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVkLnB1c2godmlldy5xdWVyeSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGlmIChoYWRDb21wbGV0ZVZpZXcgJiYgIXN5bmNQb2ludEhhc0NvbXBsZXRlVmlldyhzeW5jUG9pbnQpKSB7XG4gICAgICAgIC8vIFdlIHJlbW92ZWQgb3VyIGxhc3QgY29tcGxldGUgdmlldy5cbiAgICAgICAgcmVtb3ZlZC5wdXNoKG5ldyAoc3luY1BvaW50R2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoKSkocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoKSk7XG4gICAgfVxuICAgIHJldHVybiB7IHJlbW92ZWQsIGV2ZW50czogY2FuY2VsRXZlbnRzIH07XG59XG5mdW5jdGlvbiBzeW5jUG9pbnRHZXRRdWVyeVZpZXdzKHN5bmNQb2ludCkge1xuICAgIGNvbnN0IHJlc3VsdCA9IFtdO1xuICAgIGZvciAoY29uc3QgdmlldyBvZiBzeW5jUG9pbnQudmlld3MudmFsdWVzKCkpIHtcbiAgICAgICAgaWYgKCF2aWV3LnF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkge1xuICAgICAgICAgICAgcmVzdWx0LnB1c2godmlldyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbn1cbi8qKlxuICogQHBhcmFtIHBhdGggLSBUaGUgcGF0aCB0byB0aGUgZGVzaXJlZCBjb21wbGV0ZSBzbmFwc2hvdFxuICogQHJldHVybnMgQSBjb21wbGV0ZSBjYWNoZSwgaWYgaXQgZXhpc3RzXG4gKi9cbmZ1bmN0aW9uIHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3luY1BvaW50LCBwYXRoKSB7XG4gICAgbGV0IHNlcnZlckNhY2hlID0gbnVsbDtcbiAgICBmb3IgKGNvbnN0IHZpZXcgb2Ygc3luY1BvaW50LnZpZXdzLnZhbHVlcygpKSB7XG4gICAgICAgIHNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGUgfHwgdmlld0dldENvbXBsZXRlU2VydmVyQ2FjaGUodmlldywgcGF0aCk7XG4gICAgfVxuICAgIHJldHVybiBzZXJ2ZXJDYWNoZTtcbn1cbmZ1bmN0aW9uIHN5bmNQb2ludFZpZXdGb3JRdWVyeShzeW5jUG9pbnQsIHF1ZXJ5KSB7XG4gICAgY29uc3QgcGFyYW1zID0gcXVlcnkuX3F1ZXJ5UGFyYW1zO1xuICAgIGlmIChwYXJhbXMubG9hZHNBbGxEYXRhKCkpIHtcbiAgICAgICAgcmV0dXJuIHN5bmNQb2ludEdldENvbXBsZXRlVmlldyhzeW5jUG9pbnQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc3QgcXVlcnlJZCA9IHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXI7XG4gICAgICAgIHJldHVybiBzeW5jUG9pbnQudmlld3MuZ2V0KHF1ZXJ5SWQpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHN5bmNQb2ludFZpZXdFeGlzdHNGb3JRdWVyeShzeW5jUG9pbnQsIHF1ZXJ5KSB7XG4gICAgcmV0dXJuIHN5bmNQb2ludFZpZXdGb3JRdWVyeShzeW5jUG9pbnQsIHF1ZXJ5KSAhPSBudWxsO1xufVxuZnVuY3Rpb24gc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KHN5bmNQb2ludCkge1xuICAgIHJldHVybiBzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcoc3luY1BvaW50KSAhPSBudWxsO1xufVxuZnVuY3Rpb24gc3luY1BvaW50R2V0Q29tcGxldGVWaWV3KHN5bmNQb2ludCkge1xuICAgIGZvciAoY29uc3QgdmlldyBvZiBzeW5jUG9pbnQudmlld3MudmFsdWVzKCkpIHtcbiAgICAgICAgaWYgKHZpZXcucXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdmlldztcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmxldCByZWZlcmVuY2VDb25zdHJ1Y3RvcjtcbmZ1bmN0aW9uIHN5bmNUcmVlU2V0UmVmZXJlbmNlQ29uc3RydWN0b3IodmFsKSB7XG4gICAgYXNzZXJ0KCFyZWZlcmVuY2VDb25zdHJ1Y3RvciwgJ19fcmVmZXJlbmNlQ29uc3RydWN0b3IgaGFzIGFscmVhZHkgYmVlbiBkZWZpbmVkJyk7XG4gICAgcmVmZXJlbmNlQ29uc3RydWN0b3IgPSB2YWw7XG59XG5mdW5jdGlvbiBzeW5jVHJlZUdldFJlZmVyZW5jZUNvbnN0cnVjdG9yKCkge1xuICAgIGFzc2VydChyZWZlcmVuY2VDb25zdHJ1Y3RvciwgJ1JlZmVyZW5jZS50cyBoYXMgbm90IGJlZW4gbG9hZGVkJyk7XG4gICAgcmV0dXJuIHJlZmVyZW5jZUNvbnN0cnVjdG9yO1xufVxuLyoqXG4gKiBTdGF0aWMgdHJhY2tlciBmb3IgbmV4dCBxdWVyeSB0YWcuXG4gKi9cbmxldCBzeW5jVHJlZU5leHRRdWVyeVRhZ18gPSAxO1xuLyoqXG4gKiBTeW5jVHJlZSBpcyB0aGUgY2VudHJhbCBjbGFzcyBmb3IgbWFuYWdpbmcgZXZlbnQgY2FsbGJhY2sgcmVnaXN0cmF0aW9uLCBkYXRhIGNhY2hpbmcsIHZpZXdzXG4gKiAocXVlcnkgcHJvY2Vzc2luZyksIGFuZCBldmVudCBnZW5lcmF0aW9uLiAgVGhlcmUgYXJlIHR5cGljYWxseSB0d28gU3luY1RyZWUgaW5zdGFuY2VzIGZvclxuICogZWFjaCBSZXBvLCBvbmUgZm9yIHRoZSBub3JtYWwgRmlyZWJhc2UgZGF0YSwgYW5kIG9uZSBmb3IgdGhlIC5pbmZvIGRhdGEuXG4gKlxuICogSXQgaGFzIGEgbnVtYmVyIG9mIHJlc3BvbnNpYmlsaXRpZXMsIGluY2x1ZGluZzpcbiAqICAtIFRyYWNraW5nIGFsbCB1c2VyIGV2ZW50IGNhbGxiYWNrcyAocmVnaXN0ZXJlZCB2aWEgYWRkRXZlbnRSZWdpc3RyYXRpb24oKSBhbmQgcmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24oKSkuXG4gKiAgLSBBcHBseWluZyBhbmQgY2FjaGluZyBkYXRhIGNoYW5nZXMgZm9yIHVzZXIgc2V0KCksIHRyYW5zYWN0aW9uKCksIGFuZCB1cGRhdGUoKSBjYWxsc1xuICogICAgKGFwcGx5VXNlck92ZXJ3cml0ZSgpLCBhcHBseVVzZXJNZXJnZSgpKS5cbiAqICAtIEFwcGx5aW5nIGFuZCBjYWNoaW5nIGRhdGEgY2hhbmdlcyBmb3Igc2VydmVyIGRhdGEgY2hhbmdlcyAoYXBwbHlTZXJ2ZXJPdmVyd3JpdGUoKSxcbiAqICAgIGFwcGx5U2VydmVyTWVyZ2UoKSkuXG4gKiAgLSBHZW5lcmF0aW5nIHVzZXItZmFjaW5nIGV2ZW50cyBmb3Igc2VydmVyIGFuZCB1c2VyIGNoYW5nZXMgKGFsbCBvZiB0aGUgYXBwbHkqIG1ldGhvZHNcbiAqICAgIHJldHVybiB0aGUgc2V0IG9mIGV2ZW50cyB0aGF0IG5lZWQgdG8gYmUgcmFpc2VkIGFzIGEgcmVzdWx0KS5cbiAqICAtIE1haW50YWluaW5nIHRoZSBhcHByb3ByaWF0ZSBzZXQgb2Ygc2VydmVyIGxpc3RlbnMgdG8gZW5zdXJlIHdlIGFyZSBhbHdheXMgc3Vic2NyaWJlZFxuICogICAgdG8gdGhlIGNvcnJlY3Qgc2V0IG9mIHBhdGhzIGFuZCBxdWVyaWVzIHRvIHNhdGlzZnkgdGhlIGN1cnJlbnQgc2V0IG9mIHVzZXIgZXZlbnRcbiAqICAgIGNhbGxiYWNrcyAobGlzdGVucyBhcmUgc3RhcnRlZC9zdG9wcGVkIHVzaW5nIHRoZSBwcm92aWRlZCBsaXN0ZW5Qcm92aWRlcikuXG4gKlxuICogTk9URTogQWx0aG91Z2ggU3luY1RyZWUgdHJhY2tzIGV2ZW50IGNhbGxiYWNrcyBhbmQgY2FsY3VsYXRlcyBldmVudHMgdG8gcmFpc2UsIHRoZSBhY3R1YWxcbiAqIGV2ZW50cyBhcmUgcmV0dXJuZWQgdG8gdGhlIGNhbGxlciByYXRoZXIgdGhhbiByYWlzZWQgc3luY2hyb25vdXNseS5cbiAqXG4gKi9cbmNsYXNzIFN5bmNUcmVlIHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gbGlzdGVuUHJvdmlkZXJfIC0gVXNlZCBieSBTeW5jVHJlZSB0byBzdGFydCAvIHN0b3AgbGlzdGVuaW5nXG4gICAgICogICB0byBzZXJ2ZXIgZGF0YS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihsaXN0ZW5Qcm92aWRlcl8pIHtcbiAgICAgICAgdGhpcy5saXN0ZW5Qcm92aWRlcl8gPSBsaXN0ZW5Qcm92aWRlcl87XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUcmVlIG9mIFN5bmNQb2ludHMuICBUaGVyZSdzIGEgU3luY1BvaW50IGF0IGFueSBsb2NhdGlvbiB0aGF0IGhhcyAxIG9yIG1vcmUgdmlld3MuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnN5bmNQb2ludFRyZWVfID0gbmV3IEltbXV0YWJsZVRyZWUobnVsbCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBBIHRyZWUgb2YgYWxsIHBlbmRpbmcgdXNlciB3cml0ZXMgKHVzZXItaW5pdGlhdGVkIHNldCgpJ3MsIHRyYW5zYWN0aW9uKCkncywgdXBkYXRlKCkncywgZXRjLikuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBlbmRpbmdXcml0ZVRyZWVfID0gbmV3V3JpdGVUcmVlKCk7XG4gICAgICAgIHRoaXMudGFnVG9RdWVyeU1hcCA9IG5ldyBNYXAoKTtcbiAgICAgICAgdGhpcy5xdWVyeVRvVGFnTWFwID0gbmV3IE1hcCgpO1xuICAgIH1cbn1cbi8qKlxuICogQXBwbHkgdGhlIGRhdGEgY2hhbmdlcyBmb3IgYSB1c2VyLWdlbmVyYXRlZCBzZXQoKSBvciB0cmFuc2FjdGlvbigpIGNhbGwuXG4gKlxuICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLlxuICovXG5mdW5jdGlvbiBzeW5jVHJlZUFwcGx5VXNlck92ZXJ3cml0ZShzeW5jVHJlZSwgcGF0aCwgbmV3RGF0YSwgd3JpdGVJZCwgdmlzaWJsZSkge1xuICAgIC8vIFJlY29yZCBwZW5kaW5nIHdyaXRlLlxuICAgIHdyaXRlVHJlZUFkZE92ZXJ3cml0ZShzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgcGF0aCwgbmV3RGF0YSwgd3JpdGVJZCwgdmlzaWJsZSk7XG4gICAgaWYgKCF2aXNpYmxlKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uVG9TeW5jUG9pbnRzXyhzeW5jVHJlZSwgbmV3IE92ZXJ3cml0ZShuZXdPcGVyYXRpb25Tb3VyY2VVc2VyKCksIHBhdGgsIG5ld0RhdGEpKTtcbiAgICB9XG59XG4vKipcbiAqIEFwcGx5IHRoZSBkYXRhIGZyb20gYSB1c2VyLWdlbmVyYXRlZCB1cGRhdGUoKSBjYWxsXG4gKlxuICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLlxuICovXG5mdW5jdGlvbiBzeW5jVHJlZUFwcGx5VXNlck1lcmdlKHN5bmNUcmVlLCBwYXRoLCBjaGFuZ2VkQ2hpbGRyZW4sIHdyaXRlSWQpIHtcbiAgICAvLyBSZWNvcmQgcGVuZGluZyBtZXJnZS5cbiAgICB3cml0ZVRyZWVBZGRNZXJnZShzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgcGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZUlkKTtcbiAgICBjb25zdCBjaGFuZ2VUcmVlID0gSW1tdXRhYmxlVHJlZS5mcm9tT2JqZWN0KGNoYW5nZWRDaGlsZHJlbik7XG4gICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlPcGVyYXRpb25Ub1N5bmNQb2ludHNfKHN5bmNUcmVlLCBuZXcgTWVyZ2UobmV3T3BlcmF0aW9uU291cmNlVXNlcigpLCBwYXRoLCBjaGFuZ2VUcmVlKSk7XG59XG4vKipcbiAqIEFja25vd2xlZGdlIGEgcGVuZGluZyB1c2VyIHdyaXRlIHRoYXQgd2FzIHByZXZpb3VzbHkgcmVnaXN0ZXJlZCB3aXRoIGFwcGx5VXNlck92ZXJ3cml0ZSgpIG9yIGFwcGx5VXNlck1lcmdlKCkuXG4gKlxuICogQHBhcmFtIHJldmVydCAtIFRydWUgaWYgdGhlIGdpdmVuIHdyaXRlIGZhaWxlZCBhbmQgbmVlZHMgdG8gYmUgcmV2ZXJ0ZWRcbiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS5cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVBY2tVc2VyV3JpdGUoc3luY1RyZWUsIHdyaXRlSWQsIHJldmVydCA9IGZhbHNlKSB7XG4gICAgY29uc3Qgd3JpdGUgPSB3cml0ZVRyZWVHZXRXcml0ZShzeW5jVHJlZS5wZW5kaW5nV3JpdGVUcmVlXywgd3JpdGVJZCk7XG4gICAgY29uc3QgbmVlZFRvUmVldmFsdWF0ZSA9IHdyaXRlVHJlZVJlbW92ZVdyaXRlKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCB3cml0ZUlkKTtcbiAgICBpZiAoIW5lZWRUb1JlZXZhbHVhdGUpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgbGV0IGFmZmVjdGVkVHJlZSA9IG5ldyBJbW11dGFibGVUcmVlKG51bGwpO1xuICAgICAgICBpZiAod3JpdGUuc25hcCAhPSBudWxsKSB7XG4gICAgICAgICAgICAvLyBvdmVyd3JpdGVcbiAgICAgICAgICAgIGFmZmVjdGVkVHJlZSA9IGFmZmVjdGVkVHJlZS5zZXQobmV3RW1wdHlQYXRoKCksIHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZWFjaCh3cml0ZS5jaGlsZHJlbiwgKHBhdGhTdHJpbmcpID0+IHtcbiAgICAgICAgICAgICAgICBhZmZlY3RlZFRyZWUgPSBhZmZlY3RlZFRyZWUuc2V0KG5ldyBQYXRoKHBhdGhTdHJpbmcpLCB0cnVlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uVG9TeW5jUG9pbnRzXyhzeW5jVHJlZSwgbmV3IEFja1VzZXJXcml0ZSh3cml0ZS5wYXRoLCBhZmZlY3RlZFRyZWUsIHJldmVydCkpO1xuICAgIH1cbn1cbi8qKlxuICogQXBwbHkgbmV3IHNlcnZlciBkYXRhIGZvciB0aGUgc3BlY2lmaWVkIHBhdGguLlxuICpcbiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS5cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShzeW5jVHJlZSwgcGF0aCwgbmV3RGF0YSkge1xuICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uVG9TeW5jUG9pbnRzXyhzeW5jVHJlZSwgbmV3IE92ZXJ3cml0ZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXIoKSwgcGF0aCwgbmV3RGF0YSkpO1xufVxuLyoqXG4gKiBBcHBseSBuZXcgc2VydmVyIGRhdGEgdG8gYmUgbWVyZ2VkIGluIGF0IHRoZSBzcGVjaWZpZWQgcGF0aC5cbiAqXG4gKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuXG4gKi9cbmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlTZXJ2ZXJNZXJnZShzeW5jVHJlZSwgcGF0aCwgY2hhbmdlZENoaWxkcmVuKSB7XG4gICAgY29uc3QgY2hhbmdlVHJlZSA9IEltbXV0YWJsZVRyZWUuZnJvbU9iamVjdChjaGFuZ2VkQ2hpbGRyZW4pO1xuICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uVG9TeW5jUG9pbnRzXyhzeW5jVHJlZSwgbmV3IE1lcmdlKG5ld09wZXJhdGlvblNvdXJjZVNlcnZlcigpLCBwYXRoLCBjaGFuZ2VUcmVlKSk7XG59XG4vKipcbiAqIEFwcGx5IGEgbGlzdGVuIGNvbXBsZXRlIGZvciBhIHF1ZXJ5XG4gKlxuICogQHJldHVybnMgRXZlbnRzIHRvIHJhaXNlLlxuICovXG5mdW5jdGlvbiBzeW5jVHJlZUFwcGx5TGlzdGVuQ29tcGxldGUoc3luY1RyZWUsIHBhdGgpIHtcbiAgICByZXR1cm4gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG5ldyBMaXN0ZW5Db21wbGV0ZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXIoKSwgcGF0aCkpO1xufVxuLyoqXG4gKiBBcHBseSBhIGxpc3RlbiBjb21wbGV0ZSBmb3IgYSB0YWdnZWQgcXVlcnlcbiAqXG4gKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuXG4gKi9cbmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlUYWdnZWRMaXN0ZW5Db21wbGV0ZShzeW5jVHJlZSwgcGF0aCwgdGFnKSB7XG4gICAgY29uc3QgcXVlcnlLZXkgPSBzeW5jVHJlZVF1ZXJ5S2V5Rm9yVGFnXyhzeW5jVHJlZSwgdGFnKTtcbiAgICBpZiAocXVlcnlLZXkpIHtcbiAgICAgICAgY29uc3QgciA9IHN5bmNUcmVlUGFyc2VRdWVyeUtleV8ocXVlcnlLZXkpO1xuICAgICAgICBjb25zdCBxdWVyeVBhdGggPSByLnBhdGgsIHF1ZXJ5SWQgPSByLnF1ZXJ5SWQ7XG4gICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChxdWVyeVBhdGgsIHBhdGgpO1xuICAgICAgICBjb25zdCBvcCA9IG5ldyBMaXN0ZW5Db21wbGV0ZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXJUYWdnZWRRdWVyeShxdWVyeUlkKSwgcmVsYXRpdmVQYXRoKTtcbiAgICAgICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlUYWdnZWRPcGVyYXRpb25fKHN5bmNUcmVlLCBxdWVyeVBhdGgsIG9wKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFdlJ3ZlIGFscmVhZHkgcmVtb3ZlZCB0aGUgcXVlcnkuIE5vIGJpZyBkZWFsLCBpZ25vcmUgdGhlIHVwZGF0ZVxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuLyoqXG4gKiBSZW1vdmUgZXZlbnQgY2FsbGJhY2socykuXG4gKlxuICogSWYgcXVlcnkgaXMgdGhlIGRlZmF1bHQgcXVlcnksIHdlJ2xsIGNoZWNrIGFsbCBxdWVyaWVzIGZvciB0aGUgc3BlY2lmaWVkIGV2ZW50UmVnaXN0cmF0aW9uLlxuICogSWYgZXZlbnRSZWdpc3RyYXRpb24gaXMgbnVsbCwgd2UnbGwgcmVtb3ZlIGFsbCBjYWxsYmFja3MgZm9yIHRoZSBzcGVjaWZpZWQgcXVlcnkvcXVlcmllcy5cbiAqXG4gKiBAcGFyYW0gZXZlbnRSZWdpc3RyYXRpb24gLSBJZiBudWxsLCBhbGwgY2FsbGJhY2tzIGFyZSByZW1vdmVkLlxuICogQHBhcmFtIGNhbmNlbEVycm9yIC0gSWYgYSBjYW5jZWxFcnJvciBpcyBwcm92aWRlZCwgYXBwcm9wcmlhdGUgY2FuY2VsIGV2ZW50cyB3aWxsIGJlIHJldHVybmVkLlxuICogQHBhcmFtIHNraXBMaXN0ZW5lckRlZHVwIC0gV2hlbiBwZXJmb3JtaW5nIGEgYGdldCgpYCwgd2UgZG9uJ3QgYWRkIGFueSBuZXcgbGlzdGVuZXJzLCBzbyBub1xuICogIGRlZHVwaW5nIG5lZWRzIHRvIHRha2UgcGxhY2UuIFRoaXMgZmxhZyBhbGxvd3MgdG9nZ2xpbmcgb2YgdGhhdCBiZWhhdmlvclxuICogQHJldHVybnMgQ2FuY2VsIGV2ZW50cywgaWYgY2FuY2VsRXJyb3Igd2FzIHByb3ZpZGVkLlxuICovXG5mdW5jdGlvbiBzeW5jVHJlZVJlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHN5bmNUcmVlLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24sIGNhbmNlbEVycm9yLCBza2lwTGlzdGVuZXJEZWR1cCA9IGZhbHNlKSB7XG4gICAgLy8gRmluZCB0aGUgc3luY1BvaW50IGZpcnN0LiBUaGVuIGRlYWwgd2l0aCB3aGV0aGVyIG9yIG5vdCBpdCBoYXMgbWF0Y2hpbmcgbGlzdGVuZXJzXG4gICAgY29uc3QgcGF0aCA9IHF1ZXJ5Ll9wYXRoO1xuICAgIGNvbnN0IG1heWJlU3luY1BvaW50ID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZ2V0KHBhdGgpO1xuICAgIGxldCBjYW5jZWxFdmVudHMgPSBbXTtcbiAgICAvLyBBIHJlbW92YWwgb24gYSBkZWZhdWx0IHF1ZXJ5IGFmZmVjdHMgYWxsIHF1ZXJpZXMgYXQgdGhhdCBsb2NhdGlvbi4gQSByZW1vdmFsIG9uIGFuIGluZGV4ZWQgcXVlcnksIGV2ZW4gb25lIHdpdGhvdXRcbiAgICAvLyBvdGhlciBxdWVyeSBjb25zdHJhaW50cywgZG9lcyAqbm90KiBhZmZlY3QgYWxsIHF1ZXJpZXMgYXQgdGhhdCBsb2NhdGlvbi4gU28gdGhpcyBjaGVjayBtdXN0IGJlIGZvciAnZGVmYXVsdCcsIGFuZFxuICAgIC8vIG5vdCBsb2Fkc0FsbERhdGEoKS5cbiAgICBpZiAobWF5YmVTeW5jUG9pbnQgJiZcbiAgICAgICAgKHF1ZXJ5Ll9xdWVyeUlkZW50aWZpZXIgPT09ICdkZWZhdWx0JyB8fFxuICAgICAgICAgICAgc3luY1BvaW50Vmlld0V4aXN0c0ZvclF1ZXJ5KG1heWJlU3luY1BvaW50LCBxdWVyeSkpKSB7XG4gICAgICAgIGNvbnN0IHJlbW92ZWRBbmRFdmVudHMgPSBzeW5jUG9pbnRSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihtYXliZVN5bmNQb2ludCwgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uLCBjYW5jZWxFcnJvcik7XG4gICAgICAgIGlmIChzeW5jUG9pbnRJc0VtcHR5KG1heWJlU3luY1BvaW50KSkge1xuICAgICAgICAgICAgc3luY1RyZWUuc3luY1BvaW50VHJlZV8gPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5yZW1vdmUocGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcmVtb3ZlZCA9IHJlbW92ZWRBbmRFdmVudHMucmVtb3ZlZDtcbiAgICAgICAgY2FuY2VsRXZlbnRzID0gcmVtb3ZlZEFuZEV2ZW50cy5ldmVudHM7XG4gICAgICAgIGlmICghc2tpcExpc3RlbmVyRGVkdXApIHtcbiAgICAgICAgICAgIC8qKlxuICAgICAgICAgICAgICogV2UgbWF5IGhhdmUganVzdCByZW1vdmVkIG9uZSBvZiBtYW55IGxpc3RlbmVycyBhbmQgY2FuIHNob3J0LWNpcmN1aXQgdGhpcyB3aG9sZSBwcm9jZXNzXG4gICAgICAgICAgICAgKiBXZSBtYXkgYWxzbyBub3QgaGF2ZSByZW1vdmVkIGEgZGVmYXVsdCBsaXN0ZW5lciwgaW4gd2hpY2ggY2FzZSBhbGwgb2YgdGhlIGRlc2NlbmRhbnQgbGlzdGVuZXJzIHNob3VsZCBhbHJlYWR5IGJlXG4gICAgICAgICAgICAgKiBwcm9wZXJseSBzZXQgdXAuXG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIC8vIFNpbmNlIGluZGV4ZWQgcXVlcmllcyBjYW4gc2hhZG93IGlmIHRoZXkgZG9uJ3QgaGF2ZSBvdGhlciBxdWVyeSBjb25zdHJhaW50cywgY2hlY2sgZm9yIGxvYWRzQWxsRGF0YSgpLCBpbnN0ZWFkIG9mXG4gICAgICAgICAgICAvLyBxdWVyeUlkID09PSAnZGVmYXVsdCdcbiAgICAgICAgICAgIGNvbnN0IHJlbW92aW5nRGVmYXVsdCA9IC0xICE9PVxuICAgICAgICAgICAgICAgIHJlbW92ZWQuZmluZEluZGV4KHF1ZXJ5ID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IGNvdmVyZWQgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5maW5kT25QYXRoKHBhdGgsIChyZWxhdGl2ZVBhdGgsIHBhcmVudFN5bmNQb2ludCkgPT4gc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KHBhcmVudFN5bmNQb2ludCkpO1xuICAgICAgICAgICAgaWYgKHJlbW92aW5nRGVmYXVsdCAmJiAhY292ZXJlZCkge1xuICAgICAgICAgICAgICAgIGNvbnN0IHN1YnRyZWUgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5zdWJ0cmVlKHBhdGgpO1xuICAgICAgICAgICAgICAgIC8vIFRoZXJlIGFyZSBwb3RlbnRpYWxseSBjaGlsZCBsaXN0ZW5lcnMuIERldGVybWluZSB3aGF0IGlmIGFueSBsaXN0ZW5zIHdlIG5lZWQgdG8gc2VuZCBiZWZvcmUgZXhlY3V0aW5nIHRoZVxuICAgICAgICAgICAgICAgIC8vIHJlbW92YWxcbiAgICAgICAgICAgICAgICBpZiAoIXN1YnRyZWUuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIG5lZWQgdG8gZm9sZCBvdmVyIG91ciBzdWJ0cmVlIGFuZCBjb2xsZWN0IHRoZSBsaXN0ZW5lcnMgdG8gc2VuZFxuICAgICAgICAgICAgICAgICAgICBjb25zdCBuZXdWaWV3cyA9IHN5bmNUcmVlQ29sbGVjdERpc3RpbmN0Vmlld3NGb3JTdWJUcmVlXyhzdWJ0cmVlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gT2ssIHdlJ3ZlIGNvbGxlY3RlZCBhbGwgdGhlIGxpc3RlbnMgd2UgbmVlZC4gU2V0IHRoZW0gdXAuXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmV3Vmlld3MubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZpZXcgPSBuZXdWaWV3c1tpXSwgbmV3UXVlcnkgPSB2aWV3LnF1ZXJ5O1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbGlzdGVuZXIgPSBzeW5jVHJlZUNyZWF0ZUxpc3RlbmVyRm9yVmlld18oc3luY1RyZWUsIHZpZXcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc3luY1RyZWUubGlzdGVuUHJvdmlkZXJfLnN0YXJ0TGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKG5ld1F1ZXJ5KSwgc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgbmV3UXVlcnkpLCBsaXN0ZW5lci5oYXNoRm4sIGxpc3RlbmVyLm9uQ29tcGxldGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIE90aGVyd2lzZSB0aGVyZSdzIG5vdGhpbmcgYmVsb3cgdXMsIHNvIG5vdGhpbmcgd2UgbmVlZCB0byBzdGFydCBsaXN0ZW5pbmcgb25cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIElmIHdlIHJlbW92ZWQgYW55dGhpbmcgYW5kIHdlJ3JlIG5vdCBjb3ZlcmVkIGJ5IGEgaGlnaGVyIHVwIGxpc3Rlbiwgd2UgbmVlZCB0byBzdG9wIGxpc3RlbmluZyBvbiB0aGlzIHF1ZXJ5XG4gICAgICAgICAgICAvLyBUaGUgYWJvdmUgYmxvY2sgaGFzIHVzIGNvdmVyZWQgaW4gdGVybXMgb2YgbWFraW5nIHN1cmUgd2UncmUgc2V0IHVwIG9uIGxpc3RlbnMgbG93ZXIgaW4gdGhlIHRyZWUuXG4gICAgICAgICAgICAvLyBBbHNvLCBub3RlIHRoYXQgaWYgd2UgaGF2ZSBhIGNhbmNlbEVycm9yLCBpdCdzIGFscmVhZHkgYmVlbiByZW1vdmVkIGF0IHRoZSBwcm92aWRlciBsZXZlbC5cbiAgICAgICAgICAgIGlmICghY292ZXJlZCAmJiByZW1vdmVkLmxlbmd0aCA+IDAgJiYgIWNhbmNlbEVycm9yKSB7XG4gICAgICAgICAgICAgICAgLy8gSWYgd2UgcmVtb3ZlZCBhIGRlZmF1bHQsIHRoZW4gd2Ugd2VyZW4ndCBsaXN0ZW5pbmcgb24gYW55IG9mIHRoZSBvdGhlciBxdWVyaWVzIGhlcmUuIEp1c3QgY2FuY2VsIHRoZSBvbmVcbiAgICAgICAgICAgICAgICAvLyBkZWZhdWx0LiBPdGhlcndpc2UsIHdlIG5lZWQgdG8gaXRlcmF0ZSB0aHJvdWdoIGFuZCBjYW5jZWwgZWFjaCBpbmRpdmlkdWFsIHF1ZXJ5XG4gICAgICAgICAgICAgICAgaWYgKHJlbW92aW5nRGVmYXVsdCkge1xuICAgICAgICAgICAgICAgICAgICAvLyBXZSBkb24ndCB0YWcgZGVmYXVsdCBsaXN0ZW5lcnNcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZGVmYXVsdFRhZyA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdG9wTGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5KSwgZGVmYXVsdFRhZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmVkLmZvckVhY2goKHF1ZXJ5VG9SZW1vdmUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhZ1RvUmVtb3ZlID0gc3luY1RyZWUucXVlcnlUb1RhZ01hcC5nZXQoc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5VG9SZW1vdmUpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdG9wTGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5VG9SZW1vdmUpLCB0YWdUb1JlbW92ZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBOb3csIGNsZWFyIGFsbCBvZiB0aGUgdGFncyB3ZSdyZSB0cmFja2luZyBmb3IgdGhlIHJlbW92ZWQgbGlzdGVuc1xuICAgICAgICBzeW5jVHJlZVJlbW92ZVRhZ3NfKHN5bmNUcmVlLCByZW1vdmVkKTtcbiAgICB9XG4gICAgcmV0dXJuIGNhbmNlbEV2ZW50cztcbn1cbi8qKlxuICogQXBwbHkgbmV3IHNlcnZlciBkYXRhIGZvciB0aGUgc3BlY2lmaWVkIHRhZ2dlZCBxdWVyeS5cbiAqXG4gKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuXG4gKi9cbmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlUYWdnZWRRdWVyeU92ZXJ3cml0ZShzeW5jVHJlZSwgcGF0aCwgc25hcCwgdGFnKSB7XG4gICAgY29uc3QgcXVlcnlLZXkgPSBzeW5jVHJlZVF1ZXJ5S2V5Rm9yVGFnXyhzeW5jVHJlZSwgdGFnKTtcbiAgICBpZiAocXVlcnlLZXkgIT0gbnVsbCkge1xuICAgICAgICBjb25zdCByID0gc3luY1RyZWVQYXJzZVF1ZXJ5S2V5XyhxdWVyeUtleSk7XG4gICAgICAgIGNvbnN0IHF1ZXJ5UGF0aCA9IHIucGF0aCwgcXVlcnlJZCA9IHIucXVlcnlJZDtcbiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHF1ZXJ5UGF0aCwgcGF0aCk7XG4gICAgICAgIGNvbnN0IG9wID0gbmV3IE92ZXJ3cml0ZShuZXdPcGVyYXRpb25Tb3VyY2VTZXJ2ZXJUYWdnZWRRdWVyeShxdWVyeUlkKSwgcmVsYXRpdmVQYXRoLCBzbmFwKTtcbiAgICAgICAgcmV0dXJuIHN5bmNUcmVlQXBwbHlUYWdnZWRPcGVyYXRpb25fKHN5bmNUcmVlLCBxdWVyeVBhdGgsIG9wKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFF1ZXJ5IG11c3QgaGF2ZSBiZWVuIHJlbW92ZWQgYWxyZWFkeVxuICAgICAgICByZXR1cm4gW107XG4gICAgfVxufVxuLyoqXG4gKiBBcHBseSBzZXJ2ZXIgZGF0YSB0byBiZSBtZXJnZWQgaW4gZm9yIHRoZSBzcGVjaWZpZWQgdGFnZ2VkIHF1ZXJ5LlxuICpcbiAqIEByZXR1cm5zIEV2ZW50cyB0byByYWlzZS5cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVBcHBseVRhZ2dlZFF1ZXJ5TWVyZ2Uoc3luY1RyZWUsIHBhdGgsIGNoYW5nZWRDaGlsZHJlbiwgdGFnKSB7XG4gICAgY29uc3QgcXVlcnlLZXkgPSBzeW5jVHJlZVF1ZXJ5S2V5Rm9yVGFnXyhzeW5jVHJlZSwgdGFnKTtcbiAgICBpZiAocXVlcnlLZXkpIHtcbiAgICAgICAgY29uc3QgciA9IHN5bmNUcmVlUGFyc2VRdWVyeUtleV8ocXVlcnlLZXkpO1xuICAgICAgICBjb25zdCBxdWVyeVBhdGggPSByLnBhdGgsIHF1ZXJ5SWQgPSByLnF1ZXJ5SWQ7XG4gICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChxdWVyeVBhdGgsIHBhdGgpO1xuICAgICAgICBjb25zdCBjaGFuZ2VUcmVlID0gSW1tdXRhYmxlVHJlZS5mcm9tT2JqZWN0KGNoYW5nZWRDaGlsZHJlbik7XG4gICAgICAgIGNvbnN0IG9wID0gbmV3IE1lcmdlKG5ld09wZXJhdGlvblNvdXJjZVNlcnZlclRhZ2dlZFF1ZXJ5KHF1ZXJ5SWQpLCByZWxhdGl2ZVBhdGgsIGNoYW5nZVRyZWUpO1xuICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseVRhZ2dlZE9wZXJhdGlvbl8oc3luY1RyZWUsIHF1ZXJ5UGF0aCwgb3ApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gV2UndmUgYWxyZWFkeSByZW1vdmVkIHRoZSBxdWVyeS4gTm8gYmlnIGRlYWwsIGlnbm9yZSB0aGUgdXBkYXRlXG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG59XG4vKipcbiAqIEFkZCBhbiBldmVudCBjYWxsYmFjayBmb3IgdGhlIHNwZWNpZmllZCBxdWVyeS5cbiAqXG4gKiBAcmV0dXJucyBFdmVudHMgdG8gcmFpc2UuXG4gKi9cbmZ1bmN0aW9uIHN5bmNUcmVlQWRkRXZlbnRSZWdpc3RyYXRpb24oc3luY1RyZWUsIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbiwgc2tpcFNldHVwTGlzdGVuZXIgPSBmYWxzZSkge1xuICAgIGNvbnN0IHBhdGggPSBxdWVyeS5fcGF0aDtcbiAgICBsZXQgc2VydmVyQ2FjaGUgPSBudWxsO1xuICAgIGxldCBmb3VuZEFuY2VzdG9yRGVmYXVsdFZpZXcgPSBmYWxzZTtcbiAgICAvLyBBbnkgY292ZXJpbmcgd3JpdGVzIHdpbGwgbmVjZXNzYXJpbHkgYmUgYXQgdGhlIHJvb3QsIHNvIHJlYWxseSBhbGwgd2UgbmVlZCB0byBmaW5kIGlzIHRoZSBzZXJ2ZXIgY2FjaGUuXG4gICAgLy8gQ29uc2lkZXIgb3B0aW1pemluZyB0aGlzIG9uY2UgdGhlcmUncyBhIGJldHRlciB1bmRlcnN0YW5kaW5nIG9mIHdoYXQgYWN0dWFsIGJlaGF2aW9yIHdpbGwgYmUuXG4gICAgc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZm9yZWFjaE9uUGF0aChwYXRoLCAocGF0aFRvU3luY1BvaW50LCBzcCkgPT4ge1xuICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocGF0aFRvU3luY1BvaW50LCBwYXRoKTtcbiAgICAgICAgc2VydmVyQ2FjaGUgPVxuICAgICAgICAgICAgc2VydmVyQ2FjaGUgfHwgc3luY1BvaW50R2V0Q29tcGxldGVTZXJ2ZXJDYWNoZShzcCwgcmVsYXRpdmVQYXRoKTtcbiAgICAgICAgZm91bmRBbmNlc3RvckRlZmF1bHRWaWV3ID1cbiAgICAgICAgICAgIGZvdW5kQW5jZXN0b3JEZWZhdWx0VmlldyB8fCBzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3ApO1xuICAgIH0pO1xuICAgIGxldCBzeW5jUG9pbnQgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5nZXQocGF0aCk7XG4gICAgaWYgKCFzeW5jUG9pbnQpIHtcbiAgICAgICAgc3luY1BvaW50ID0gbmV3IFN5bmNQb2ludCgpO1xuICAgICAgICBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXyA9IHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLnNldChwYXRoLCBzeW5jUG9pbnQpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZm91bmRBbmNlc3RvckRlZmF1bHRWaWV3ID1cbiAgICAgICAgICAgIGZvdW5kQW5jZXN0b3JEZWZhdWx0VmlldyB8fCBzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3luY1BvaW50KTtcbiAgICAgICAgc2VydmVyQ2FjaGUgPVxuICAgICAgICAgICAgc2VydmVyQ2FjaGUgfHwgc3luY1BvaW50R2V0Q29tcGxldGVTZXJ2ZXJDYWNoZShzeW5jUG9pbnQsIG5ld0VtcHR5UGF0aCgpKTtcbiAgICB9XG4gICAgbGV0IHNlcnZlckNhY2hlQ29tcGxldGU7XG4gICAgaWYgKHNlcnZlckNhY2hlICE9IG51bGwpIHtcbiAgICAgICAgc2VydmVyQ2FjaGVDb21wbGV0ZSA9IHRydWU7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzZXJ2ZXJDYWNoZUNvbXBsZXRlID0gZmFsc2U7XG4gICAgICAgIHNlcnZlckNhY2hlID0gQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgICAgIGNvbnN0IHN1YnRyZWUgPSBzeW5jVHJlZS5zeW5jUG9pbnRUcmVlXy5zdWJ0cmVlKHBhdGgpO1xuICAgICAgICBzdWJ0cmVlLmZvcmVhY2hDaGlsZCgoY2hpbGROYW1lLCBjaGlsZFN5bmNQb2ludCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY29tcGxldGVDYWNoZSA9IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoY2hpbGRTeW5jUG9pbnQsIG5ld0VtcHR5UGF0aCgpKTtcbiAgICAgICAgICAgIGlmIChjb21wbGV0ZUNhY2hlKSB7XG4gICAgICAgICAgICAgICAgc2VydmVyQ2FjaGUgPSBzZXJ2ZXJDYWNoZS51cGRhdGVJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUsIGNvbXBsZXRlQ2FjaGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3Qgdmlld0FscmVhZHlFeGlzdHMgPSBzeW5jUG9pbnRWaWV3RXhpc3RzRm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSk7XG4gICAgaWYgKCF2aWV3QWxyZWFkeUV4aXN0cyAmJiAhcXVlcnkuX3F1ZXJ5UGFyYW1zLmxvYWRzQWxsRGF0YSgpKSB7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gdHJhY2sgYSB0YWcgZm9yIHRoaXMgcXVlcnlcbiAgICAgICAgY29uc3QgcXVlcnlLZXkgPSBzeW5jVHJlZU1ha2VRdWVyeUtleV8ocXVlcnkpO1xuICAgICAgICBhc3NlcnQoIXN5bmNUcmVlLnF1ZXJ5VG9UYWdNYXAuaGFzKHF1ZXJ5S2V5KSwgJ1ZpZXcgZG9lcyBub3QgZXhpc3QsIGJ1dCB3ZSBoYXZlIGEgdGFnJyk7XG4gICAgICAgIGNvbnN0IHRhZyA9IHN5bmNUcmVlR2V0TmV4dFF1ZXJ5VGFnXygpO1xuICAgICAgICBzeW5jVHJlZS5xdWVyeVRvVGFnTWFwLnNldChxdWVyeUtleSwgdGFnKTtcbiAgICAgICAgc3luY1RyZWUudGFnVG9RdWVyeU1hcC5zZXQodGFnLCBxdWVyeUtleSk7XG4gICAgfVxuICAgIGNvbnN0IHdyaXRlc0NhY2hlID0gd3JpdGVUcmVlQ2hpbGRXcml0ZXMoc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV8sIHBhdGgpO1xuICAgIGxldCBldmVudHMgPSBzeW5jUG9pbnRBZGRFdmVudFJlZ2lzdHJhdGlvbihzeW5jUG9pbnQsIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbiwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlLCBzZXJ2ZXJDYWNoZUNvbXBsZXRlKTtcbiAgICBpZiAoIXZpZXdBbHJlYWR5RXhpc3RzICYmICFmb3VuZEFuY2VzdG9yRGVmYXVsdFZpZXcgJiYgIXNraXBTZXR1cExpc3RlbmVyKSB7XG4gICAgICAgIGNvbnN0IHZpZXcgPSBzeW5jUG9pbnRWaWV3Rm9yUXVlcnkoc3luY1BvaW50LCBxdWVyeSk7XG4gICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVTZXR1cExpc3RlbmVyXyhzeW5jVHJlZSwgcXVlcnksIHZpZXcpKTtcbiAgICB9XG4gICAgcmV0dXJuIGV2ZW50cztcbn1cbi8qKlxuICogUmV0dXJucyBhIGNvbXBsZXRlIGNhY2hlLCBpZiB3ZSBoYXZlIG9uZSwgb2YgdGhlIGRhdGEgYXQgYSBwYXJ0aWN1bGFyIHBhdGguIElmIHRoZSBsb2NhdGlvbiBkb2VzIG5vdCBoYXZlIGFcbiAqIGxpc3RlbmVyIGFib3ZlIGl0LCB3ZSB3aWxsIGdldCBhIGZhbHNlIFwibnVsbFwiLiBUaGlzIHNob3VsZG4ndCBiZSBhIHByb2JsZW0gYmVjYXVzZSB0cmFuc2FjdGlvbnMgd2lsbCBhbHdheXNcbiAqIGhhdmUgYSBsaXN0ZW5lciBhYm92ZSwgYW5kIGF0b21pYyBvcGVyYXRpb25zIHdvdWxkIGNvcnJlY3RseSBzaG93IGEgaml0dGVyIG9mIDxpbmNyZW1lbnQgdmFsdWU+IC0+XG4gKiAgICAgPGluY3JlbWVudGVkIHRvdGFsPiBhcyB0aGUgd3JpdGUgaXMgYXBwbGllZCBsb2NhbGx5IGFuZCB0aGVuIGFja25vd2xlZGdlZCBhdCB0aGUgc2VydmVyLlxuICpcbiAqIE5vdGU6IHRoaXMgbWV0aG9kIHdpbGwgKmluY2x1ZGUqIGhpZGRlbiB3cml0ZXMgZnJvbSB0cmFuc2FjdGlvbiB3aXRoIGFwcGx5TG9jYWxseSBzZXQgdG8gZmFsc2UuXG4gKlxuICogQHBhcmFtIHBhdGggLSBUaGUgcGF0aCB0byB0aGUgZGF0YSB3ZSB3YW50XG4gKiBAcGFyYW0gd3JpdGVJZHNUb0V4Y2x1ZGUgLSBBIHNwZWNpZmljIHNldCB0byBiZSBleGNsdWRlZFxuICovXG5mdW5jdGlvbiBzeW5jVHJlZUNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUoc3luY1RyZWUsIHBhdGgsIHdyaXRlSWRzVG9FeGNsdWRlKSB7XG4gICAgY29uc3QgaW5jbHVkZUhpZGRlblNldHMgPSB0cnVlO1xuICAgIGNvbnN0IHdyaXRlVHJlZSA9IHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfO1xuICAgIGNvbnN0IHNlcnZlckNhY2hlID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZmluZE9uUGF0aChwYXRoLCAocGF0aFNvRmFyLCBzeW5jUG9pbnQpID0+IHtcbiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHBhdGhTb0ZhciwgcGF0aCk7XG4gICAgICAgIGNvbnN0IHNlcnZlckNhY2hlID0gc3luY1BvaW50R2V0Q29tcGxldGVTZXJ2ZXJDYWNoZShzeW5jUG9pbnQsIHJlbGF0aXZlUGF0aCk7XG4gICAgICAgIGlmIChzZXJ2ZXJDYWNoZSkge1xuICAgICAgICAgICAgcmV0dXJuIHNlcnZlckNhY2hlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHdyaXRlVHJlZUNhbGNDb21wbGV0ZUV2ZW50Q2FjaGUod3JpdGVUcmVlLCBwYXRoLCBzZXJ2ZXJDYWNoZSwgd3JpdGVJZHNUb0V4Y2x1ZGUsIGluY2x1ZGVIaWRkZW5TZXRzKTtcbn1cbmZ1bmN0aW9uIHN5bmNUcmVlR2V0U2VydmVyVmFsdWUoc3luY1RyZWUsIHF1ZXJ5KSB7XG4gICAgY29uc3QgcGF0aCA9IHF1ZXJ5Ll9wYXRoO1xuICAgIGxldCBzZXJ2ZXJDYWNoZSA9IG51bGw7XG4gICAgLy8gQW55IGNvdmVyaW5nIHdyaXRlcyB3aWxsIG5lY2Vzc2FyaWx5IGJlIGF0IHRoZSByb290LCBzbyByZWFsbHkgYWxsIHdlIG5lZWQgdG8gZmluZCBpcyB0aGUgc2VydmVyIGNhY2hlLlxuICAgIC8vIENvbnNpZGVyIG9wdGltaXppbmcgdGhpcyBvbmNlIHRoZXJlJ3MgYSBiZXR0ZXIgdW5kZXJzdGFuZGluZyBvZiB3aGF0IGFjdHVhbCBiZWhhdmlvciB3aWxsIGJlLlxuICAgIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmZvcmVhY2hPblBhdGgocGF0aCwgKHBhdGhUb1N5bmNQb2ludCwgc3ApID0+IHtcbiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gbmV3UmVsYXRpdmVQYXRoKHBhdGhUb1N5bmNQb2ludCwgcGF0aCk7XG4gICAgICAgIHNlcnZlckNhY2hlID1cbiAgICAgICAgICAgIHNlcnZlckNhY2hlIHx8IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3AsIHJlbGF0aXZlUGF0aCk7XG4gICAgfSk7XG4gICAgbGV0IHN5bmNQb2ludCA9IHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLmdldChwYXRoKTtcbiAgICBpZiAoIXN5bmNQb2ludCkge1xuICAgICAgICBzeW5jUG9pbnQgPSBuZXcgU3luY1BvaW50KCk7XG4gICAgICAgIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uc2V0KHBhdGgsIHN5bmNQb2ludCk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBzZXJ2ZXJDYWNoZSA9XG4gICAgICAgICAgICBzZXJ2ZXJDYWNoZSB8fCBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgbmV3RW1wdHlQYXRoKCkpO1xuICAgIH1cbiAgICBjb25zdCBzZXJ2ZXJDYWNoZUNvbXBsZXRlID0gc2VydmVyQ2FjaGUgIT0gbnVsbDtcbiAgICBjb25zdCBzZXJ2ZXJDYWNoZU5vZGUgPSBzZXJ2ZXJDYWNoZUNvbXBsZXRlXG4gICAgICAgID8gbmV3IENhY2hlTm9kZShzZXJ2ZXJDYWNoZSwgdHJ1ZSwgZmFsc2UpXG4gICAgICAgIDogbnVsbDtcbiAgICBjb25zdCB3cml0ZXNDYWNoZSA9IHdyaXRlVHJlZUNoaWxkV3JpdGVzKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCBxdWVyeS5fcGF0aCk7XG4gICAgY29uc3QgdmlldyA9IHN5bmNQb2ludEdldFZpZXcoc3luY1BvaW50LCBxdWVyeSwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlQ29tcGxldGUgPyBzZXJ2ZXJDYWNoZU5vZGUuZ2V0Tm9kZSgpIDogQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUsIHNlcnZlckNhY2hlQ29tcGxldGUpO1xuICAgIHJldHVybiB2aWV3R2V0Q29tcGxldGVOb2RlKHZpZXcpO1xufVxuLyoqXG4gKiBBIGhlbHBlciBtZXRob2QgdGhhdCB2aXNpdHMgYWxsIGRlc2NlbmRhbnQgYW5kIGFuY2VzdG9yIFN5bmNQb2ludHMsIGFwcGx5aW5nIHRoZSBvcGVyYXRpb24uXG4gKlxuICogTk9URVM6XG4gKiAtIERlc2NlbmRhbnQgU3luY1BvaW50cyB3aWxsIGJlIHZpc2l0ZWQgZmlyc3QgKHNpbmNlIHdlIHJhaXNlIGV2ZW50cyBkZXB0aC1maXJzdCkuXG4gKlxuICogLSBXZSBjYWxsIGFwcGx5T3BlcmF0aW9uKCkgb24gZWFjaCBTeW5jUG9pbnQgcGFzc2luZyB0aHJlZSB0aGluZ3M6XG4gKiAgIDEuIEEgdmVyc2lvbiBvZiB0aGUgT3BlcmF0aW9uIHRoYXQgaGFzIGJlZW4gbWFkZSByZWxhdGl2ZSB0byB0aGUgU3luY1BvaW50IGxvY2F0aW9uLlxuICogICAyLiBBIFdyaXRlVHJlZVJlZiBvZiBhbnkgd3JpdGVzIHdlIGhhdmUgY2FjaGVkIGF0IHRoZSBTeW5jUG9pbnQgbG9jYXRpb24uXG4gKiAgIDMuIEEgc25hcHNob3QgTm9kZSB3aXRoIGNhY2hlZCBzZXJ2ZXIgZGF0YSwgaWYgd2UgaGF2ZSBpdC5cbiAqXG4gKiAtIFdlIGNvbmNhdGVuYXRlIGFsbCBvZiB0aGUgZXZlbnRzIHJldHVybmVkIGJ5IGVhY2ggU3luY1BvaW50IGFuZCByZXR1cm4gdGhlIHJlc3VsdC5cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVBcHBseU9wZXJhdGlvblRvU3luY1BvaW50c18oc3luY1RyZWUsIG9wZXJhdGlvbikge1xuICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uSGVscGVyXyhvcGVyYXRpb24sIHN5bmNUcmVlLnN5bmNQb2ludFRyZWVfLCBcbiAgICAvKnNlcnZlckNhY2hlPSovIG51bGwsIHdyaXRlVHJlZUNoaWxkV3JpdGVzKHN5bmNUcmVlLnBlbmRpbmdXcml0ZVRyZWVfLCBuZXdFbXB0eVBhdGgoKSkpO1xufVxuLyoqXG4gKiBSZWN1cnNpdmUgaGVscGVyIGZvciBhcHBseU9wZXJhdGlvblRvU3luY1BvaW50c19cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVBcHBseU9wZXJhdGlvbkhlbHBlcl8ob3BlcmF0aW9uLCBzeW5jUG9pbnRUcmVlLCBzZXJ2ZXJDYWNoZSwgd3JpdGVzQ2FjaGUpIHtcbiAgICBpZiAocGF0aElzRW1wdHkob3BlcmF0aW9uLnBhdGgpKSB7XG4gICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5T3BlcmF0aW9uRGVzY2VuZGFudHNIZWxwZXJfKG9wZXJhdGlvbiwgc3luY1BvaW50VHJlZSwgc2VydmVyQ2FjaGUsIHdyaXRlc0NhY2hlKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnN0IHN5bmNQb2ludCA9IHN5bmNQb2ludFRyZWUuZ2V0KG5ld0VtcHR5UGF0aCgpKTtcbiAgICAgICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBjYWNoZWQgc2VydmVyIGRhdGEsIHNlZSBpZiB3ZSBjYW4gZ2V0IGl0IGZyb20gdGhpcyBTeW5jUG9pbnQuXG4gICAgICAgIGlmIChzZXJ2ZXJDYWNoZSA9PSBudWxsICYmIHN5bmNQb2ludCAhPSBudWxsKSB7XG4gICAgICAgICAgICBzZXJ2ZXJDYWNoZSA9IHN5bmNQb2ludEdldENvbXBsZXRlU2VydmVyQ2FjaGUoc3luY1BvaW50LCBuZXdFbXB0eVBhdGgoKSk7XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGV2ZW50cyA9IFtdO1xuICAgICAgICBjb25zdCBjaGlsZE5hbWUgPSBwYXRoR2V0RnJvbnQob3BlcmF0aW9uLnBhdGgpO1xuICAgICAgICBjb25zdCBjaGlsZE9wZXJhdGlvbiA9IG9wZXJhdGlvbi5vcGVyYXRpb25Gb3JDaGlsZChjaGlsZE5hbWUpO1xuICAgICAgICBjb25zdCBjaGlsZFRyZWUgPSBzeW5jUG9pbnRUcmVlLmNoaWxkcmVuLmdldChjaGlsZE5hbWUpO1xuICAgICAgICBpZiAoY2hpbGRUcmVlICYmIGNoaWxkT3BlcmF0aW9uKSB7XG4gICAgICAgICAgICBjb25zdCBjaGlsZFNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGVcbiAgICAgICAgICAgICAgICA/IHNlcnZlckNhY2hlLmdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSlcbiAgICAgICAgICAgICAgICA6IG51bGw7XG4gICAgICAgICAgICBjb25zdCBjaGlsZFdyaXRlc0NhY2hlID0gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkTmFtZSk7XG4gICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQXBwbHlPcGVyYXRpb25IZWxwZXJfKGNoaWxkT3BlcmF0aW9uLCBjaGlsZFRyZWUsIGNoaWxkU2VydmVyQ2FjaGUsIGNoaWxkV3JpdGVzQ2FjaGUpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3luY1BvaW50KSB7XG4gICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNQb2ludEFwcGx5T3BlcmF0aW9uKHN5bmNQb2ludCwgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgc2VydmVyQ2FjaGUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZXZlbnRzO1xuICAgIH1cbn1cbi8qKlxuICogUmVjdXJzaXZlIGhlbHBlciBmb3IgYXBwbHlPcGVyYXRpb25Ub1N5bmNQb2ludHNfXG4gKi9cbmZ1bmN0aW9uIHN5bmNUcmVlQXBwbHlPcGVyYXRpb25EZXNjZW5kYW50c0hlbHBlcl8ob3BlcmF0aW9uLCBzeW5jUG9pbnRUcmVlLCBzZXJ2ZXJDYWNoZSwgd3JpdGVzQ2FjaGUpIHtcbiAgICBjb25zdCBzeW5jUG9pbnQgPSBzeW5jUG9pbnRUcmVlLmdldChuZXdFbXB0eVBhdGgoKSk7XG4gICAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBjYWNoZWQgc2VydmVyIGRhdGEsIHNlZSBpZiB3ZSBjYW4gZ2V0IGl0IGZyb20gdGhpcyBTeW5jUG9pbnQuXG4gICAgaWYgKHNlcnZlckNhY2hlID09IG51bGwgJiYgc3luY1BvaW50ICE9IG51bGwpIHtcbiAgICAgICAgc2VydmVyQ2FjaGUgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVNlcnZlckNhY2hlKHN5bmNQb2ludCwgbmV3RW1wdHlQYXRoKCkpO1xuICAgIH1cbiAgICBsZXQgZXZlbnRzID0gW107XG4gICAgc3luY1BvaW50VHJlZS5jaGlsZHJlbi5pbm9yZGVyVHJhdmVyc2FsKChjaGlsZE5hbWUsIGNoaWxkVHJlZSkgPT4ge1xuICAgICAgICBjb25zdCBjaGlsZFNlcnZlckNhY2hlID0gc2VydmVyQ2FjaGVcbiAgICAgICAgICAgID8gc2VydmVyQ2FjaGUuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKVxuICAgICAgICAgICAgOiBudWxsO1xuICAgICAgICBjb25zdCBjaGlsZFdyaXRlc0NhY2hlID0gd3JpdGVUcmVlUmVmQ2hpbGQod3JpdGVzQ2FjaGUsIGNoaWxkTmFtZSk7XG4gICAgICAgIGNvbnN0IGNoaWxkT3BlcmF0aW9uID0gb3BlcmF0aW9uLm9wZXJhdGlvbkZvckNoaWxkKGNoaWxkTmFtZSk7XG4gICAgICAgIGlmIChjaGlsZE9wZXJhdGlvbikge1xuICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFwcGx5T3BlcmF0aW9uRGVzY2VuZGFudHNIZWxwZXJfKGNoaWxkT3BlcmF0aW9uLCBjaGlsZFRyZWUsIGNoaWxkU2VydmVyQ2FjaGUsIGNoaWxkV3JpdGVzQ2FjaGUpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChzeW5jUG9pbnQpIHtcbiAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jUG9pbnRBcHBseU9wZXJhdGlvbihzeW5jUG9pbnQsIG9wZXJhdGlvbiwgd3JpdGVzQ2FjaGUsIHNlcnZlckNhY2hlKSk7XG4gICAgfVxuICAgIHJldHVybiBldmVudHM7XG59XG5mdW5jdGlvbiBzeW5jVHJlZUNyZWF0ZUxpc3RlbmVyRm9yVmlld18oc3luY1RyZWUsIHZpZXcpIHtcbiAgICBjb25zdCBxdWVyeSA9IHZpZXcucXVlcnk7XG4gICAgY29uc3QgdGFnID0gc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgcXVlcnkpO1xuICAgIHJldHVybiB7XG4gICAgICAgIGhhc2hGbjogKCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgY2FjaGUgPSB2aWV3R2V0U2VydmVyQ2FjaGUodmlldykgfHwgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREU7XG4gICAgICAgICAgICByZXR1cm4gY2FjaGUuaGFzaCgpO1xuICAgICAgICB9LFxuICAgICAgICBvbkNvbXBsZXRlOiAoc3RhdHVzKSA9PiB7XG4gICAgICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRhZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc3luY1RyZWVBcHBseVRhZ2dlZExpc3RlbkNvbXBsZXRlKHN5bmNUcmVlLCBxdWVyeS5fcGF0aCwgdGFnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzeW5jVHJlZUFwcGx5TGlzdGVuQ29tcGxldGUoc3luY1RyZWUsIHF1ZXJ5Ll9wYXRoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBJZiBhIGxpc3RlbiBmYWlsZWQsIGtpbGwgYWxsIG9mIHRoZSBsaXN0ZW5lcnMgaGVyZSwgbm90IGp1c3QgdGhlIG9uZSB0aGF0IHRyaWdnZXJlZCB0aGUgZXJyb3IuXG4gICAgICAgICAgICAgICAgLy8gTm90ZSB0aGF0IHRoaXMgbWF5IG5lZWQgdG8gYmUgc2NvcGVkIHRvIGp1c3QgdGhpcyBsaXN0ZW5lciBpZiB3ZSBjaGFuZ2UgcGVybWlzc2lvbnMgb24gZmlsdGVyZWQgY2hpbGRyZW5cbiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IGVycm9yRm9yU2VydmVyQ29kZShzdGF0dXMsIHF1ZXJ5KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gc3luY1RyZWVSZW1vdmVFdmVudFJlZ2lzdHJhdGlvbihzeW5jVHJlZSwgcXVlcnksIFxuICAgICAgICAgICAgICAgIC8qZXZlbnRSZWdpc3RyYXRpb24qLyBudWxsLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuLyoqXG4gKiBSZXR1cm4gdGhlIHRhZyBhc3NvY2lhdGVkIHdpdGggdGhlIGdpdmVuIHF1ZXJ5LlxuICovXG5mdW5jdGlvbiBzeW5jVHJlZVRhZ0ZvclF1ZXJ5KHN5bmNUcmVlLCBxdWVyeSkge1xuICAgIGNvbnN0IHF1ZXJ5S2V5ID0gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5KTtcbiAgICByZXR1cm4gc3luY1RyZWUucXVlcnlUb1RhZ01hcC5nZXQocXVlcnlLZXkpO1xufVxuLyoqXG4gKiBHaXZlbiBhIHF1ZXJ5LCBjb21wdXRlcyBhIFwicXVlcnlLZXlcIiBzdWl0YWJsZSBmb3IgdXNlIGluIG91ciBxdWVyeVRvVGFnTWFwXy5cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVNYWtlUXVlcnlLZXlfKHF1ZXJ5KSB7XG4gICAgcmV0dXJuIHF1ZXJ5Ll9wYXRoLnRvU3RyaW5nKCkgKyAnJCcgKyBxdWVyeS5fcXVlcnlJZGVudGlmaWVyO1xufVxuLyoqXG4gKiBSZXR1cm4gdGhlIHF1ZXJ5IGFzc29jaWF0ZWQgd2l0aCB0aGUgZ2l2ZW4gdGFnLCBpZiB3ZSBoYXZlIG9uZVxuICovXG5mdW5jdGlvbiBzeW5jVHJlZVF1ZXJ5S2V5Rm9yVGFnXyhzeW5jVHJlZSwgdGFnKSB7XG4gICAgcmV0dXJuIHN5bmNUcmVlLnRhZ1RvUXVlcnlNYXAuZ2V0KHRhZyk7XG59XG4vKipcbiAqIEdpdmVuIGEgcXVlcnlLZXkgKGNyZWF0ZWQgYnkgbWFrZVF1ZXJ5S2V5KSwgcGFyc2UgaXQgYmFjayBpbnRvIGEgcGF0aCBhbmQgcXVlcnlJZC5cbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVQYXJzZVF1ZXJ5S2V5XyhxdWVyeUtleSkge1xuICAgIGNvbnN0IHNwbGl0SW5kZXggPSBxdWVyeUtleS5pbmRleE9mKCckJyk7XG4gICAgYXNzZXJ0KHNwbGl0SW5kZXggIT09IC0xICYmIHNwbGl0SW5kZXggPCBxdWVyeUtleS5sZW5ndGggLSAxLCAnQmFkIHF1ZXJ5S2V5LicpO1xuICAgIHJldHVybiB7XG4gICAgICAgIHF1ZXJ5SWQ6IHF1ZXJ5S2V5LnN1YnN0cihzcGxpdEluZGV4ICsgMSksXG4gICAgICAgIHBhdGg6IG5ldyBQYXRoKHF1ZXJ5S2V5LnN1YnN0cigwLCBzcGxpdEluZGV4KSlcbiAgICB9O1xufVxuLyoqXG4gKiBBIGhlbHBlciBtZXRob2QgdG8gYXBwbHkgdGFnZ2VkIG9wZXJhdGlvbnNcbiAqL1xuZnVuY3Rpb24gc3luY1RyZWVBcHBseVRhZ2dlZE9wZXJhdGlvbl8oc3luY1RyZWUsIHF1ZXJ5UGF0aCwgb3BlcmF0aW9uKSB7XG4gICAgY29uc3Qgc3luY1BvaW50ID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uZ2V0KHF1ZXJ5UGF0aCk7XG4gICAgYXNzZXJ0KHN5bmNQb2ludCwgXCJNaXNzaW5nIHN5bmMgcG9pbnQgZm9yIHF1ZXJ5IHRhZyB0aGF0IHdlJ3JlIHRyYWNraW5nXCIpO1xuICAgIGNvbnN0IHdyaXRlc0NhY2hlID0gd3JpdGVUcmVlQ2hpbGRXcml0ZXMoc3luY1RyZWUucGVuZGluZ1dyaXRlVHJlZV8sIHF1ZXJ5UGF0aCk7XG4gICAgcmV0dXJuIHN5bmNQb2ludEFwcGx5T3BlcmF0aW9uKHN5bmNQb2ludCwgb3BlcmF0aW9uLCB3cml0ZXNDYWNoZSwgbnVsbCk7XG59XG4vKipcbiAqIFRoaXMgY29sbGFwc2VzIG11bHRpcGxlIHVuZmlsdGVyZWQgdmlld3MgaW50byBhIHNpbmdsZSB2aWV3LCBzaW5jZSB3ZSBvbmx5IG5lZWQgYSBzaW5nbGVcbiAqIGxpc3RlbmVyIGZvciB0aGVtLlxuICovXG5mdW5jdGlvbiBzeW5jVHJlZUNvbGxlY3REaXN0aW5jdFZpZXdzRm9yU3ViVHJlZV8oc3VidHJlZSkge1xuICAgIHJldHVybiBzdWJ0cmVlLmZvbGQoKHJlbGF0aXZlUGF0aCwgbWF5YmVDaGlsZFN5bmNQb2ludCwgY2hpbGRNYXApID0+IHtcbiAgICAgICAgaWYgKG1heWJlQ2hpbGRTeW5jUG9pbnQgJiYgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KG1heWJlQ2hpbGRTeW5jUG9pbnQpKSB7XG4gICAgICAgICAgICBjb25zdCBjb21wbGV0ZVZpZXcgPSBzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcobWF5YmVDaGlsZFN5bmNQb2ludCk7XG4gICAgICAgICAgICByZXR1cm4gW2NvbXBsZXRlVmlld107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBObyBjb21wbGV0ZSB2aWV3IGhlcmUsIGZsYXR0ZW4gYW55IGRlZXBlciBsaXN0ZW5zIGludG8gYW4gYXJyYXlcbiAgICAgICAgICAgIGxldCB2aWV3cyA9IFtdO1xuICAgICAgICAgICAgaWYgKG1heWJlQ2hpbGRTeW5jUG9pbnQpIHtcbiAgICAgICAgICAgICAgICB2aWV3cyA9IHN5bmNQb2ludEdldFF1ZXJ5Vmlld3MobWF5YmVDaGlsZFN5bmNQb2ludCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlYWNoKGNoaWxkTWFwLCAoX2tleSwgY2hpbGRWaWV3cykgPT4ge1xuICAgICAgICAgICAgICAgIHZpZXdzID0gdmlld3MuY29uY2F0KGNoaWxkVmlld3MpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICByZXR1cm4gdmlld3M7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbi8qKlxuICogTm9ybWFsaXplcyBhIHF1ZXJ5IHRvIGEgcXVlcnkgd2Ugc2VuZCB0aGUgc2VydmVyIGZvciBsaXN0ZW5pbmdcbiAqXG4gKiBAcmV0dXJucyBUaGUgbm9ybWFsaXplZCBxdWVyeVxuICovXG5mdW5jdGlvbiBzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhxdWVyeSkge1xuICAgIGlmIChxdWVyeS5fcXVlcnlQYXJhbXMubG9hZHNBbGxEYXRhKCkgJiYgIXF1ZXJ5Ll9xdWVyeVBhcmFtcy5pc0RlZmF1bHQoKSkge1xuICAgICAgICAvLyBXZSB0cmVhdCBxdWVyaWVzIHRoYXQgbG9hZCBhbGwgZGF0YSBhcyBkZWZhdWx0IHF1ZXJpZXNcbiAgICAgICAgLy8gQ2FzdCBpcyBuZWNlc3NhcnkgYmVjYXVzZSByZWYoKSB0ZWNobmljYWxseSByZXR1cm5zIEZpcmViYXNlIHdoaWNoIGlzIGFjdHVhbGx5IGZiLmFwaS5GaXJlYmFzZSB3aGljaCBpbmhlcml0c1xuICAgICAgICAvLyBmcm9tIFF1ZXJ5XG4gICAgICAgIHJldHVybiBuZXcgKHN5bmNUcmVlR2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoKSkocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHJldHVybiBxdWVyeTtcbiAgICB9XG59XG5mdW5jdGlvbiBzeW5jVHJlZVJlbW92ZVRhZ3NfKHN5bmNUcmVlLCBxdWVyaWVzKSB7XG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBxdWVyaWVzLmxlbmd0aDsgKytqKSB7XG4gICAgICAgIGNvbnN0IHJlbW92ZWRRdWVyeSA9IHF1ZXJpZXNbal07XG4gICAgICAgIGlmICghcmVtb3ZlZFF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkge1xuICAgICAgICAgICAgLy8gV2Ugc2hvdWxkIGhhdmUgYSB0YWcgZm9yIHRoaXNcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZWRRdWVyeUtleSA9IHN5bmNUcmVlTWFrZVF1ZXJ5S2V5XyhyZW1vdmVkUXVlcnkpO1xuICAgICAgICAgICAgY29uc3QgcmVtb3ZlZFF1ZXJ5VGFnID0gc3luY1RyZWUucXVlcnlUb1RhZ01hcC5nZXQocmVtb3ZlZFF1ZXJ5S2V5KTtcbiAgICAgICAgICAgIHN5bmNUcmVlLnF1ZXJ5VG9UYWdNYXAuZGVsZXRlKHJlbW92ZWRRdWVyeUtleSk7XG4gICAgICAgICAgICBzeW5jVHJlZS50YWdUb1F1ZXJ5TWFwLmRlbGV0ZShyZW1vdmVkUXVlcnlUYWcpO1xuICAgICAgICB9XG4gICAgfVxufVxuLyoqXG4gKiBTdGF0aWMgYWNjZXNzb3IgZm9yIHF1ZXJ5IHRhZ3MuXG4gKi9cbmZ1bmN0aW9uIHN5bmNUcmVlR2V0TmV4dFF1ZXJ5VGFnXygpIHtcbiAgICByZXR1cm4gc3luY1RyZWVOZXh0UXVlcnlUYWdfKys7XG59XG4vKipcbiAqIEZvciBhIGdpdmVuIG5ldyBsaXN0ZW4sIG1hbmFnZSB0aGUgZGUtZHVwbGljYXRpb24gb2Ygb3V0c3RhbmRpbmcgc3Vic2NyaXB0aW9ucy5cbiAqXG4gKiBAcmV0dXJucyBUaGlzIG1ldGhvZCBjYW4gcmV0dXJuIGV2ZW50cyB0byBzdXBwb3J0IHN5bmNocm9ub3VzIGRhdGEgc291cmNlc1xuICovXG5mdW5jdGlvbiBzeW5jVHJlZVNldHVwTGlzdGVuZXJfKHN5bmNUcmVlLCBxdWVyeSwgdmlldykge1xuICAgIGNvbnN0IHBhdGggPSBxdWVyeS5fcGF0aDtcbiAgICBjb25zdCB0YWcgPSBzeW5jVHJlZVRhZ0ZvclF1ZXJ5KHN5bmNUcmVlLCBxdWVyeSk7XG4gICAgY29uc3QgbGlzdGVuZXIgPSBzeW5jVHJlZUNyZWF0ZUxpc3RlbmVyRm9yVmlld18oc3luY1RyZWUsIHZpZXcpO1xuICAgIGNvbnN0IGV2ZW50cyA9IHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdGFydExpc3RlbmluZyhzeW5jVHJlZVF1ZXJ5Rm9yTGlzdGVuaW5nXyhxdWVyeSksIHRhZywgbGlzdGVuZXIuaGFzaEZuLCBsaXN0ZW5lci5vbkNvbXBsZXRlKTtcbiAgICBjb25zdCBzdWJ0cmVlID0gc3luY1RyZWUuc3luY1BvaW50VHJlZV8uc3VidHJlZShwYXRoKTtcbiAgICAvLyBUaGUgcm9vdCBvZiB0aGlzIHN1YnRyZWUgaGFzIG91ciBxdWVyeS4gV2UncmUgaGVyZSBiZWNhdXNlIHdlIGRlZmluaXRlbHkgbmVlZCB0byBzZW5kIGEgbGlzdGVuIGZvciB0aGF0LCBidXQgd2VcbiAgICAvLyBtYXkgbmVlZCB0byBzaGFkb3cgb3RoZXIgbGlzdGVucyBhcyB3ZWxsLlxuICAgIGlmICh0YWcpIHtcbiAgICAgICAgYXNzZXJ0KCFzeW5jUG9pbnRIYXNDb21wbGV0ZVZpZXcoc3VidHJlZS52YWx1ZSksIFwiSWYgd2UncmUgYWRkaW5nIGEgcXVlcnksIGl0IHNob3VsZG4ndCBiZSBzaGFkb3dlZFwiKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIC8vIFNoYWRvdyBldmVyeXRoaW5nIGF0IG9yIGJlbG93IHRoaXMgbG9jYXRpb24sIHRoaXMgaXMgYSBkZWZhdWx0IGxpc3RlbmVyLlxuICAgICAgICBjb25zdCBxdWVyaWVzVG9TdG9wID0gc3VidHJlZS5mb2xkKChyZWxhdGl2ZVBhdGgsIG1heWJlQ2hpbGRTeW5jUG9pbnQsIGNoaWxkTWFwKSA9PiB7XG4gICAgICAgICAgICBpZiAoIXBhdGhJc0VtcHR5KHJlbGF0aXZlUGF0aCkgJiZcbiAgICAgICAgICAgICAgICBtYXliZUNoaWxkU3luY1BvaW50ICYmXG4gICAgICAgICAgICAgICAgc3luY1BvaW50SGFzQ29tcGxldGVWaWV3KG1heWJlQ2hpbGRTeW5jUG9pbnQpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFtzeW5jUG9pbnRHZXRDb21wbGV0ZVZpZXcobWF5YmVDaGlsZFN5bmNQb2ludCkucXVlcnldO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gTm8gZGVmYXVsdCBsaXN0ZW5lciBoZXJlLCBmbGF0dGVuIGFueSBkZWVwZXIgcXVlcmllcyBpbnRvIGFuIGFycmF5XG4gICAgICAgICAgICAgICAgbGV0IHF1ZXJpZXMgPSBbXTtcbiAgICAgICAgICAgICAgICBpZiAobWF5YmVDaGlsZFN5bmNQb2ludCkge1xuICAgICAgICAgICAgICAgICAgICBxdWVyaWVzID0gcXVlcmllcy5jb25jYXQoc3luY1BvaW50R2V0UXVlcnlWaWV3cyhtYXliZUNoaWxkU3luY1BvaW50KS5tYXAodmlldyA9PiB2aWV3LnF1ZXJ5KSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVhY2goY2hpbGRNYXAsIChfa2V5LCBjaGlsZFF1ZXJpZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgcXVlcmllcyA9IHF1ZXJpZXMuY29uY2F0KGNoaWxkUXVlcmllcyk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXJpZXM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXJpZXNUb1N0b3AubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgIGNvbnN0IHF1ZXJ5VG9TdG9wID0gcXVlcmllc1RvU3RvcFtpXTtcbiAgICAgICAgICAgIHN5bmNUcmVlLmxpc3RlblByb3ZpZGVyXy5zdG9wTGlzdGVuaW5nKHN5bmNUcmVlUXVlcnlGb3JMaXN0ZW5pbmdfKHF1ZXJ5VG9TdG9wKSwgc3luY1RyZWVUYWdGb3JRdWVyeShzeW5jVHJlZSwgcXVlcnlUb1N0b3ApKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZXZlbnRzO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY2xhc3MgRXhpc3RpbmdWYWx1ZVByb3ZpZGVyIHtcbiAgICBjb25zdHJ1Y3Rvcihub2RlXykge1xuICAgICAgICB0aGlzLm5vZGVfID0gbm9kZV87XG4gICAgfVxuICAgIGdldEltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSkge1xuICAgICAgICBjb25zdCBjaGlsZCA9IHRoaXMubm9kZV8uZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKTtcbiAgICAgICAgcmV0dXJuIG5ldyBFeGlzdGluZ1ZhbHVlUHJvdmlkZXIoY2hpbGQpO1xuICAgIH1cbiAgICBub2RlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ub2RlXztcbiAgICB9XG59XG5jbGFzcyBEZWZlcnJlZFZhbHVlUHJvdmlkZXIge1xuICAgIGNvbnN0cnVjdG9yKHN5bmNUcmVlLCBwYXRoKSB7XG4gICAgICAgIHRoaXMuc3luY1RyZWVfID0gc3luY1RyZWU7XG4gICAgICAgIHRoaXMucGF0aF8gPSBwYXRoO1xuICAgIH1cbiAgICBnZXRJbW1lZGlhdGVDaGlsZChjaGlsZE5hbWUpIHtcbiAgICAgICAgY29uc3QgY2hpbGRQYXRoID0gcGF0aENoaWxkKHRoaXMucGF0aF8sIGNoaWxkTmFtZSk7XG4gICAgICAgIHJldHVybiBuZXcgRGVmZXJyZWRWYWx1ZVByb3ZpZGVyKHRoaXMuc3luY1RyZWVfLCBjaGlsZFBhdGgpO1xuICAgIH1cbiAgICBub2RlKCkge1xuICAgICAgICByZXR1cm4gc3luY1RyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHRoaXMuc3luY1RyZWVfLCB0aGlzLnBhdGhfKTtcbiAgICB9XG59XG4vKipcbiAqIEdlbmVyYXRlIHBsYWNlaG9sZGVycyBmb3IgZGVmZXJyZWQgdmFsdWVzLlxuICovXG5jb25zdCBnZW5lcmF0ZVdpdGhWYWx1ZXMgPSBmdW5jdGlvbiAodmFsdWVzKSB7XG4gICAgdmFsdWVzID0gdmFsdWVzIHx8IHt9O1xuICAgIHZhbHVlc1sndGltZXN0YW1wJ10gPSB2YWx1ZXNbJ3RpbWVzdGFtcCddIHx8IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIHJldHVybiB2YWx1ZXM7XG59O1xuLyoqXG4gKiBWYWx1ZSB0byB1c2Ugd2hlbiBmaXJpbmcgbG9jYWwgZXZlbnRzLiBXaGVuIHdyaXRpbmcgc2VydmVyIHZhbHVlcywgZmlyZVxuICogbG9jYWwgZXZlbnRzIHdpdGggYW4gYXBwcm94aW1hdGUgdmFsdWUsIG90aGVyd2lzZSByZXR1cm4gdmFsdWUgYXMtaXMuXG4gKi9cbmNvbnN0IHJlc29sdmVEZWZlcnJlZExlYWZWYWx1ZSA9IGZ1bmN0aW9uICh2YWx1ZSwgZXhpc3RpbmdWYWwsIHNlcnZlclZhbHVlcykge1xuICAgIGlmICghdmFsdWUgfHwgdHlwZW9mIHZhbHVlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICByZXR1cm4gdmFsdWU7XG4gICAgfVxuICAgIGFzc2VydCgnLnN2JyBpbiB2YWx1ZSwgJ1VuZXhwZWN0ZWQgbGVhZiBub2RlIG9yIHByaW9yaXR5IGNvbnRlbnRzJyk7XG4gICAgaWYgKHR5cGVvZiB2YWx1ZVsnLnN2J10gPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIHJldHVybiByZXNvbHZlU2NhbGFyRGVmZXJyZWRWYWx1ZSh2YWx1ZVsnLnN2J10sIGV4aXN0aW5nVmFsLCBzZXJ2ZXJWYWx1ZXMpO1xuICAgIH1cbiAgICBlbHNlIGlmICh0eXBlb2YgdmFsdWVbJy5zdiddID09PSAnb2JqZWN0Jykge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZUNvbXBsZXhEZWZlcnJlZFZhbHVlKHZhbHVlWycuc3YnXSwgZXhpc3RpbmdWYWwpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBzZXJ2ZXIgdmFsdWU6ICcgKyBKU09OLnN0cmluZ2lmeSh2YWx1ZSwgbnVsbCwgMikpO1xuICAgIH1cbn07XG5jb25zdCByZXNvbHZlU2NhbGFyRGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChvcCwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcykge1xuICAgIHN3aXRjaCAob3ApIHtcbiAgICAgICAgY2FzZSAndGltZXN0YW1wJzpcbiAgICAgICAgICAgIHJldHVybiBzZXJ2ZXJWYWx1ZXNbJ3RpbWVzdGFtcCddO1xuICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBzZXJ2ZXIgdmFsdWU6ICcgKyBvcCk7XG4gICAgfVxufTtcbmNvbnN0IHJlc29sdmVDb21wbGV4RGVmZXJyZWRWYWx1ZSA9IGZ1bmN0aW9uIChvcCwgZXhpc3RpbmcsIHVudXNlZCkge1xuICAgIGlmICghb3AuaGFzT3duUHJvcGVydHkoJ2luY3JlbWVudCcpKSB7XG4gICAgICAgIGFzc2VydChmYWxzZSwgJ1VuZXhwZWN0ZWQgc2VydmVyIHZhbHVlOiAnICsgSlNPTi5zdHJpbmdpZnkob3AsIG51bGwsIDIpKTtcbiAgICB9XG4gICAgY29uc3QgZGVsdGEgPSBvcFsnaW5jcmVtZW50J107XG4gICAgaWYgKHR5cGVvZiBkZWx0YSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgYXNzZXJ0KGZhbHNlLCAnVW5leHBlY3RlZCBpbmNyZW1lbnQgdmFsdWU6ICcgKyBkZWx0YSk7XG4gICAgfVxuICAgIGNvbnN0IGV4aXN0aW5nTm9kZSA9IGV4aXN0aW5nLm5vZGUoKTtcbiAgICBhc3NlcnQoZXhpc3RpbmdOb2RlICE9PSBudWxsICYmIHR5cGVvZiBleGlzdGluZ05vZGUgIT09ICd1bmRlZmluZWQnLCAnRXhwZWN0ZWQgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUgZm9yIG51bGxzJyk7XG4gICAgLy8gSW5jcmVtZW50aW5nIGEgbm9uLW51bWJlciBzZXRzIHRoZSB2YWx1ZSB0byB0aGUgaW5jcmVtZW50ZWQgYW1vdW50XG4gICAgaWYgKCFleGlzdGluZ05vZGUuaXNMZWFmTm9kZSgpKSB7XG4gICAgICAgIHJldHVybiBkZWx0YTtcbiAgICB9XG4gICAgY29uc3QgbGVhZiA9IGV4aXN0aW5nTm9kZTtcbiAgICBjb25zdCBleGlzdGluZ1ZhbCA9IGxlYWYuZ2V0VmFsdWUoKTtcbiAgICBpZiAodHlwZW9mIGV4aXN0aW5nVmFsICE9PSAnbnVtYmVyJykge1xuICAgICAgICByZXR1cm4gZGVsdGE7XG4gICAgfVxuICAgIC8vIE5vIG5lZWQgdG8gZG8gb3Zlci91bmRlcmZsb3cgYXJpdGhtZXRpYyBoZXJlIGJlY2F1c2UgSlMgb25seSBoYW5kbGVzIGZsb2F0cyB1bmRlciB0aGUgY292ZXJzXG4gICAgcmV0dXJuIGV4aXN0aW5nVmFsICsgZGVsdGE7XG59O1xuLyoqXG4gKiBSZWN1cnNpdmVseSByZXBsYWNlIGFsbCBkZWZlcnJlZCB2YWx1ZXMgYW5kIHByaW9yaXRpZXMgaW4gdGhlIHRyZWUgd2l0aCB0aGVcbiAqIHNwZWNpZmllZCBnZW5lcmF0ZWQgcmVwbGFjZW1lbnQgdmFsdWVzLlxuICogQHBhcmFtIHBhdGggLSBwYXRoIHRvIHdoaWNoIHdyaXRlIGlzIHJlbGF0aXZlXG4gKiBAcGFyYW0gbm9kZSAtIG5ldyBkYXRhIHdyaXR0ZW4gYXQgcGF0aFxuICogQHBhcmFtIHN5bmNUcmVlIC0gY3VycmVudCBkYXRhXG4gKi9cbmNvbnN0IHJlc29sdmVEZWZlcnJlZFZhbHVlVHJlZSA9IGZ1bmN0aW9uIChwYXRoLCBub2RlLCBzeW5jVHJlZSwgc2VydmVyVmFsdWVzKSB7XG4gICAgcmV0dXJuIHJlc29sdmVEZWZlcnJlZFZhbHVlKG5vZGUsIG5ldyBEZWZlcnJlZFZhbHVlUHJvdmlkZXIoc3luY1RyZWUsIHBhdGgpLCBzZXJ2ZXJWYWx1ZXMpO1xufTtcbi8qKlxuICogUmVjdXJzaXZlbHkgcmVwbGFjZSBhbGwgZGVmZXJyZWQgdmFsdWVzIGFuZCBwcmlvcml0aWVzIGluIHRoZSBub2RlIHdpdGggdGhlXG4gKiBzcGVjaWZpZWQgZ2VuZXJhdGVkIHJlcGxhY2VtZW50IHZhbHVlcy4gIElmIHRoZXJlIGFyZSBubyBzZXJ2ZXIgdmFsdWVzIGluIHRoZSBub2RlLFxuICogaXQnbGwgYmUgcmV0dXJuZWQgYXMtaXMuXG4gKi9cbmNvbnN0IHJlc29sdmVEZWZlcnJlZFZhbHVlU25hcHNob3QgPSBmdW5jdGlvbiAobm9kZSwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcykge1xuICAgIHJldHVybiByZXNvbHZlRGVmZXJyZWRWYWx1ZShub2RlLCBuZXcgRXhpc3RpbmdWYWx1ZVByb3ZpZGVyKGV4aXN0aW5nKSwgc2VydmVyVmFsdWVzKTtcbn07XG5mdW5jdGlvbiByZXNvbHZlRGVmZXJyZWRWYWx1ZShub2RlLCBleGlzdGluZ1ZhbCwgc2VydmVyVmFsdWVzKSB7XG4gICAgY29uc3QgcmF3UHJpID0gbm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpO1xuICAgIGNvbnN0IHByaW9yaXR5ID0gcmVzb2x2ZURlZmVycmVkTGVhZlZhbHVlKHJhd1ByaSwgZXhpc3RpbmdWYWwuZ2V0SW1tZWRpYXRlQ2hpbGQoJy5wcmlvcml0eScpLCBzZXJ2ZXJWYWx1ZXMpO1xuICAgIGxldCBuZXdOb2RlO1xuICAgIGlmIChub2RlLmlzTGVhZk5vZGUoKSkge1xuICAgICAgICBjb25zdCBsZWFmTm9kZSA9IG5vZGU7XG4gICAgICAgIGNvbnN0IHZhbHVlID0gcmVzb2x2ZURlZmVycmVkTGVhZlZhbHVlKGxlYWZOb2RlLmdldFZhbHVlKCksIGV4aXN0aW5nVmFsLCBzZXJ2ZXJWYWx1ZXMpO1xuICAgICAgICBpZiAodmFsdWUgIT09IGxlYWZOb2RlLmdldFZhbHVlKCkgfHxcbiAgICAgICAgICAgIHByaW9yaXR5ICE9PSBsZWFmTm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IExlYWZOb2RlKHZhbHVlLCBub2RlRnJvbUpTT04ocHJpb3JpdHkpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBub2RlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSBub2RlO1xuICAgICAgICBuZXdOb2RlID0gY2hpbGRyZW5Ob2RlO1xuICAgICAgICBpZiAocHJpb3JpdHkgIT09IGNoaWxkcmVuTm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpKSB7XG4gICAgICAgICAgICBuZXdOb2RlID0gbmV3Tm9kZS51cGRhdGVQcmlvcml0eShuZXcgTGVhZk5vZGUocHJpb3JpdHkpKTtcbiAgICAgICAgfVxuICAgICAgICBjaGlsZHJlbk5vZGUuZm9yRWFjaENoaWxkKFBSSU9SSVRZX0lOREVYLCAoY2hpbGROYW1lLCBjaGlsZE5vZGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5ld0NoaWxkTm9kZSA9IHJlc29sdmVEZWZlcnJlZFZhbHVlKGNoaWxkTm9kZSwgZXhpc3RpbmdWYWwuZ2V0SW1tZWRpYXRlQ2hpbGQoY2hpbGROYW1lKSwgc2VydmVyVmFsdWVzKTtcbiAgICAgICAgICAgIGlmIChuZXdDaGlsZE5vZGUgIT09IGNoaWxkTm9kZSkge1xuICAgICAgICAgICAgICAgIG5ld05vZGUgPSBuZXdOb2RlLnVwZGF0ZUltbWVkaWF0ZUNoaWxkKGNoaWxkTmFtZSwgbmV3Q2hpbGROb2RlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBuZXdOb2RlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMTcgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSBsaWdodC13ZWlnaHQgdHJlZSwgdHJhdmVyc2FibGUgYnkgcGF0aC4gIE5vZGVzIGNhbiBoYXZlIGJvdGggdmFsdWVzIGFuZCBjaGlsZHJlbi5cbiAqIE5vZGVzIGFyZSBub3QgZW51bWVyYXRlZCAoYnkgZm9yRWFjaENoaWxkKSB1bmxlc3MgdGhleSBoYXZlIGEgdmFsdWUgb3Igbm9uLWVtcHR5XG4gKiBjaGlsZHJlbi5cbiAqL1xuY2xhc3MgVHJlZSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIG5hbWUgLSBPcHRpb25hbCBuYW1lIG9mIHRoZSBub2RlLlxuICAgICAqIEBwYXJhbSBwYXJlbnQgLSBPcHRpb25hbCBwYXJlbnQgbm9kZS5cbiAgICAgKiBAcGFyYW0gbm9kZSAtIE9wdGlvbmFsIG5vZGUgdG8gd3JhcC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihuYW1lID0gJycsIHBhcmVudCA9IG51bGwsIG5vZGUgPSB7IGNoaWxkcmVuOiB7fSwgY2hpbGRDb3VudDogMCB9KSB7XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMucGFyZW50ID0gcGFyZW50O1xuICAgICAgICB0aGlzLm5vZGUgPSBub2RlO1xuICAgIH1cbn1cbi8qKlxuICogUmV0dXJucyBhIHN1Yi1UcmVlIGZvciB0aGUgZ2l2ZW4gcGF0aC5cbiAqXG4gKiBAcGFyYW0gcGF0aE9iaiAtIFBhdGggdG8gbG9vayB1cC5cbiAqIEByZXR1cm5zIFRyZWUgZm9yIHBhdGguXG4gKi9cbmZ1bmN0aW9uIHRyZWVTdWJUcmVlKHRyZWUsIHBhdGhPYmopIHtcbiAgICAvLyBUT0RPOiBSZXF1aXJlIHBhdGhPYmogdG8gYmUgUGF0aD9cbiAgICBsZXQgcGF0aCA9IHBhdGhPYmogaW5zdGFuY2VvZiBQYXRoID8gcGF0aE9iaiA6IG5ldyBQYXRoKHBhdGhPYmopO1xuICAgIGxldCBjaGlsZCA9IHRyZWUsIG5leHQgPSBwYXRoR2V0RnJvbnQocGF0aCk7XG4gICAgd2hpbGUgKG5leHQgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgY2hpbGROb2RlID0gc2FmZUdldChjaGlsZC5ub2RlLmNoaWxkcmVuLCBuZXh0KSB8fCB7XG4gICAgICAgICAgICBjaGlsZHJlbjoge30sXG4gICAgICAgICAgICBjaGlsZENvdW50OiAwXG4gICAgICAgIH07XG4gICAgICAgIGNoaWxkID0gbmV3IFRyZWUobmV4dCwgY2hpbGQsIGNoaWxkTm9kZSk7XG4gICAgICAgIHBhdGggPSBwYXRoUG9wRnJvbnQocGF0aCk7XG4gICAgICAgIG5leHQgPSBwYXRoR2V0RnJvbnQocGF0aCk7XG4gICAgfVxuICAgIHJldHVybiBjaGlsZDtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgZGF0YSBhc3NvY2lhdGVkIHdpdGggdGhpcyB0cmVlIG5vZGUuXG4gKlxuICogQHJldHVybnMgVGhlIGRhdGEgb3IgbnVsbCBpZiBubyBkYXRhIGV4aXN0cy5cbiAqL1xuZnVuY3Rpb24gdHJlZUdldFZhbHVlKHRyZWUpIHtcbiAgICByZXR1cm4gdHJlZS5ub2RlLnZhbHVlO1xufVxuLyoqXG4gKiBTZXRzIGRhdGEgdG8gdGhpcyB0cmVlIG5vZGUuXG4gKlxuICogQHBhcmFtIHZhbHVlIC0gVmFsdWUgdG8gc2V0LlxuICovXG5mdW5jdGlvbiB0cmVlU2V0VmFsdWUodHJlZSwgdmFsdWUpIHtcbiAgICB0cmVlLm5vZGUudmFsdWUgPSB2YWx1ZTtcbiAgICB0cmVlVXBkYXRlUGFyZW50cyh0cmVlKTtcbn1cbi8qKlxuICogQHJldHVybnMgV2hldGhlciB0aGUgdHJlZSBoYXMgYW55IGNoaWxkcmVuLlxuICovXG5mdW5jdGlvbiB0cmVlSGFzQ2hpbGRyZW4odHJlZSkge1xuICAgIHJldHVybiB0cmVlLm5vZGUuY2hpbGRDb3VudCA+IDA7XG59XG4vKipcbiAqIEByZXR1cm5zIFdoZXRoZXIgdGhlIHRyZWUgaXMgZW1wdHkgKG5vIHZhbHVlIG9yIGNoaWxkcmVuKS5cbiAqL1xuZnVuY3Rpb24gdHJlZUlzRW1wdHkodHJlZSkge1xuICAgIHJldHVybiB0cmVlR2V0VmFsdWUodHJlZSkgPT09IHVuZGVmaW5lZCAmJiAhdHJlZUhhc0NoaWxkcmVuKHRyZWUpO1xufVxuLyoqXG4gKiBDYWxscyBhY3Rpb24gZm9yIGVhY2ggY2hpbGQgb2YgdGhpcyB0cmVlIG5vZGUuXG4gKlxuICogQHBhcmFtIGFjdGlvbiAtIEFjdGlvbiB0byBiZSBjYWxsZWQgZm9yIGVhY2ggY2hpbGQuXG4gKi9cbmZ1bmN0aW9uIHRyZWVGb3JFYWNoQ2hpbGQodHJlZSwgYWN0aW9uKSB7XG4gICAgZWFjaCh0cmVlLm5vZGUuY2hpbGRyZW4sIChjaGlsZCwgY2hpbGRUcmVlKSA9PiB7XG4gICAgICAgIGFjdGlvbihuZXcgVHJlZShjaGlsZCwgdHJlZSwgY2hpbGRUcmVlKSk7XG4gICAgfSk7XG59XG4vKipcbiAqIERvZXMgYSBkZXB0aC1maXJzdCB0cmF2ZXJzYWwgb2YgdGhpcyBub2RlJ3MgZGVzY2VuZGFudHMsIGNhbGxpbmcgYWN0aW9uIGZvciBlYWNoIG9uZS5cbiAqXG4gKiBAcGFyYW0gYWN0aW9uIC0gQWN0aW9uIHRvIGJlIGNhbGxlZCBmb3IgZWFjaCBjaGlsZC5cbiAqIEBwYXJhbSBpbmNsdWRlU2VsZiAtIFdoZXRoZXIgdG8gY2FsbCBhY3Rpb24gb24gdGhpcyBub2RlIGFzIHdlbGwuIERlZmF1bHRzIHRvXG4gKiAgIGZhbHNlLlxuICogQHBhcmFtIGNoaWxkcmVuRmlyc3QgLSBXaGV0aGVyIHRvIGNhbGwgYWN0aW9uIG9uIGNoaWxkcmVuIGJlZm9yZSBjYWxsaW5nIGl0IG9uXG4gKiAgIHBhcmVudC5cbiAqL1xuZnVuY3Rpb24gdHJlZUZvckVhY2hEZXNjZW5kYW50KHRyZWUsIGFjdGlvbiwgaW5jbHVkZVNlbGYsIGNoaWxkcmVuRmlyc3QpIHtcbiAgICBpZiAoaW5jbHVkZVNlbGYgJiYgIWNoaWxkcmVuRmlyc3QpIHtcbiAgICAgICAgYWN0aW9uKHRyZWUpO1xuICAgIH1cbiAgICB0cmVlRm9yRWFjaENoaWxkKHRyZWUsIGNoaWxkID0+IHtcbiAgICAgICAgdHJlZUZvckVhY2hEZXNjZW5kYW50KGNoaWxkLCBhY3Rpb24sIHRydWUsIGNoaWxkcmVuRmlyc3QpO1xuICAgIH0pO1xuICAgIGlmIChpbmNsdWRlU2VsZiAmJiBjaGlsZHJlbkZpcnN0KSB7XG4gICAgICAgIGFjdGlvbih0cmVlKTtcbiAgICB9XG59XG4vKipcbiAqIENhbGxzIGFjdGlvbiBvbiBlYWNoIGFuY2VzdG9yIG5vZGUuXG4gKlxuICogQHBhcmFtIGFjdGlvbiAtIEFjdGlvbiB0byBiZSBjYWxsZWQgb24gZWFjaCBwYXJlbnQ7IHJldHVyblxuICogICB0cnVlIHRvIGFib3J0LlxuICogQHBhcmFtIGluY2x1ZGVTZWxmIC0gV2hldGhlciB0byBjYWxsIGFjdGlvbiBvbiB0aGlzIG5vZGUgYXMgd2VsbC5cbiAqIEByZXR1cm5zIHRydWUgaWYgdGhlIGFjdGlvbiBjYWxsYmFjayByZXR1cm5lZCB0cnVlLlxuICovXG5mdW5jdGlvbiB0cmVlRm9yRWFjaEFuY2VzdG9yKHRyZWUsIGFjdGlvbiwgaW5jbHVkZVNlbGYpIHtcbiAgICBsZXQgbm9kZSA9IGluY2x1ZGVTZWxmID8gdHJlZSA6IHRyZWUucGFyZW50O1xuICAgIHdoaWxlIChub2RlICE9PSBudWxsKSB7XG4gICAgICAgIGlmIChhY3Rpb24obm9kZSkpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIG5vZGUgPSBub2RlLnBhcmVudDtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufVxuLyoqXG4gKiBAcmV0dXJucyBUaGUgcGF0aCBvZiB0aGlzIHRyZWUgbm9kZSwgYXMgYSBQYXRoLlxuICovXG5mdW5jdGlvbiB0cmVlR2V0UGF0aCh0cmVlKSB7XG4gICAgcmV0dXJuIG5ldyBQYXRoKHRyZWUucGFyZW50ID09PSBudWxsXG4gICAgICAgID8gdHJlZS5uYW1lXG4gICAgICAgIDogdHJlZUdldFBhdGgodHJlZS5wYXJlbnQpICsgJy8nICsgdHJlZS5uYW1lKTtcbn1cbi8qKlxuICogQWRkcyBvciByZW1vdmVzIHRoaXMgY2hpbGQgZnJvbSBpdHMgcGFyZW50IGJhc2VkIG9uIHdoZXRoZXIgaXQncyBlbXB0eSBvciBub3QuXG4gKi9cbmZ1bmN0aW9uIHRyZWVVcGRhdGVQYXJlbnRzKHRyZWUpIHtcbiAgICBpZiAodHJlZS5wYXJlbnQgIT09IG51bGwpIHtcbiAgICAgICAgdHJlZVVwZGF0ZUNoaWxkKHRyZWUucGFyZW50LCB0cmVlLm5hbWUsIHRyZWUpO1xuICAgIH1cbn1cbi8qKlxuICogQWRkcyBvciByZW1vdmVzIHRoZSBwYXNzZWQgY2hpbGQgdG8gdGhpcyB0cmVlIG5vZGUsIGRlcGVuZGluZyBvbiB3aGV0aGVyIGl0J3MgZW1wdHkuXG4gKlxuICogQHBhcmFtIGNoaWxkTmFtZSAtIFRoZSBuYW1lIG9mIHRoZSBjaGlsZCB0byB1cGRhdGUuXG4gKiBAcGFyYW0gY2hpbGQgLSBUaGUgY2hpbGQgdG8gdXBkYXRlLlxuICovXG5mdW5jdGlvbiB0cmVlVXBkYXRlQ2hpbGQodHJlZSwgY2hpbGROYW1lLCBjaGlsZCkge1xuICAgIGNvbnN0IGNoaWxkRW1wdHkgPSB0cmVlSXNFbXB0eShjaGlsZCk7XG4gICAgY29uc3QgY2hpbGRFeGlzdHMgPSBjb250YWlucyh0cmVlLm5vZGUuY2hpbGRyZW4sIGNoaWxkTmFtZSk7XG4gICAgaWYgKGNoaWxkRW1wdHkgJiYgY2hpbGRFeGlzdHMpIHtcbiAgICAgICAgZGVsZXRlIHRyZWUubm9kZS5jaGlsZHJlbltjaGlsZE5hbWVdO1xuICAgICAgICB0cmVlLm5vZGUuY2hpbGRDb3VudC0tO1xuICAgICAgICB0cmVlVXBkYXRlUGFyZW50cyh0cmVlKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoIWNoaWxkRW1wdHkgJiYgIWNoaWxkRXhpc3RzKSB7XG4gICAgICAgIHRyZWUubm9kZS5jaGlsZHJlbltjaGlsZE5hbWVdID0gY2hpbGQubm9kZTtcbiAgICAgICAgdHJlZS5ub2RlLmNoaWxkQ291bnQrKztcbiAgICAgICAgdHJlZVVwZGF0ZVBhcmVudHModHJlZSk7XG4gICAgfVxufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUcnVlIGZvciBpbnZhbGlkIEZpcmViYXNlIGtleXNcbiAqL1xuY29uc3QgSU5WQUxJRF9LRVlfUkVHRVhfID0gL1tcXFtcXF0uIyRcXC9cXHUwMDAwLVxcdTAwMUZcXHUwMDdGXS87XG4vKipcbiAqIFRydWUgZm9yIGludmFsaWQgRmlyZWJhc2UgcGF0aHMuXG4gKiBBbGxvd3MgJy8nIGluIHBhdGhzLlxuICovXG5jb25zdCBJTlZBTElEX1BBVEhfUkVHRVhfID0gL1tcXFtcXF0uIyRcXHUwMDAwLVxcdTAwMUZcXHUwMDdGXS87XG4vKipcbiAqIE1heGltdW0gbnVtYmVyIG9mIGNoYXJhY3RlcnMgdG8gYWxsb3cgaW4gbGVhZiB2YWx1ZVxuICovXG5jb25zdCBNQVhfTEVBRl9TSVpFXyA9IDEwICogMTAyNCAqIDEwMjQ7XG5jb25zdCBpc1ZhbGlkS2V5ID0gZnVuY3Rpb24gKGtleSkge1xuICAgIHJldHVybiAodHlwZW9mIGtleSA9PT0gJ3N0cmluZycgJiYga2V5Lmxlbmd0aCAhPT0gMCAmJiAhSU5WQUxJRF9LRVlfUkVHRVhfLnRlc3Qoa2V5KSk7XG59O1xuY29uc3QgaXNWYWxpZFBhdGhTdHJpbmcgPSBmdW5jdGlvbiAocGF0aFN0cmluZykge1xuICAgIHJldHVybiAodHlwZW9mIHBhdGhTdHJpbmcgPT09ICdzdHJpbmcnICYmXG4gICAgICAgIHBhdGhTdHJpbmcubGVuZ3RoICE9PSAwICYmXG4gICAgICAgICFJTlZBTElEX1BBVEhfUkVHRVhfLnRlc3QocGF0aFN0cmluZykpO1xufTtcbmNvbnN0IGlzVmFsaWRSb290UGF0aFN0cmluZyA9IGZ1bmN0aW9uIChwYXRoU3RyaW5nKSB7XG4gICAgaWYgKHBhdGhTdHJpbmcpIHtcbiAgICAgICAgLy8gQWxsb3cgJy8uaW5mby8nIGF0IHRoZSBiZWdpbm5pbmcuXG4gICAgICAgIHBhdGhTdHJpbmcgPSBwYXRoU3RyaW5nLnJlcGxhY2UoL15cXC8qXFwuaW5mbyhcXC98JCkvLCAnLycpO1xuICAgIH1cbiAgICByZXR1cm4gaXNWYWxpZFBhdGhTdHJpbmcocGF0aFN0cmluZyk7XG59O1xuY29uc3QgaXNWYWxpZFByaW9yaXR5ID0gZnVuY3Rpb24gKHByaW9yaXR5KSB7XG4gICAgcmV0dXJuIChwcmlvcml0eSA9PT0gbnVsbCB8fFxuICAgICAgICB0eXBlb2YgcHJpb3JpdHkgPT09ICdzdHJpbmcnIHx8XG4gICAgICAgICh0eXBlb2YgcHJpb3JpdHkgPT09ICdudW1iZXInICYmICFpc0ludmFsaWRKU09OTnVtYmVyKHByaW9yaXR5KSkgfHxcbiAgICAgICAgKHByaW9yaXR5ICYmXG4gICAgICAgICAgICB0eXBlb2YgcHJpb3JpdHkgPT09ICdvYmplY3QnICYmXG4gICAgICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgICAgICAgICAgY29udGFpbnMocHJpb3JpdHksICcuc3YnKSkpO1xufTtcbi8qKlxuICogUHJlLXZhbGlkYXRlIGEgZGF0dW0gcGFzc2VkIGFzIGFuIGFyZ3VtZW50IHRvIEZpcmViYXNlIGZ1bmN0aW9uLlxuICovXG5jb25zdCB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZyA9IGZ1bmN0aW9uIChmbk5hbWUsIHZhbHVlLCBwYXRoLCBvcHRpb25hbCkge1xuICAgIGlmIChvcHRpb25hbCAmJiB2YWx1ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFsaWRhdGVGaXJlYmFzZURhdGEoZXJyb3JQcmVmaXgoZm5OYW1lLCAndmFsdWUnKSwgdmFsdWUsIHBhdGgpO1xufTtcbi8qKlxuICogVmFsaWRhdGUgYSBkYXRhIG9iamVjdCBjbGllbnQtc2lkZSBiZWZvcmUgc2VuZGluZyB0byBzZXJ2ZXIuXG4gKi9cbmNvbnN0IHZhbGlkYXRlRmlyZWJhc2VEYXRhID0gZnVuY3Rpb24gKGVycm9yUHJlZml4LCBkYXRhLCBwYXRoXykge1xuICAgIGNvbnN0IHBhdGggPSBwYXRoXyBpbnN0YW5jZW9mIFBhdGggPyBuZXcgVmFsaWRhdGlvblBhdGgocGF0aF8sIGVycm9yUHJlZml4KSA6IHBhdGhfO1xuICAgIGlmIChkYXRhID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4ICsgJ2NvbnRhaW5zIHVuZGVmaW5lZCAnICsgdmFsaWRhdGlvblBhdGhUb0Vycm9yU3RyaW5nKHBhdGgpKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArXG4gICAgICAgICAgICAnY29udGFpbnMgYSBmdW5jdGlvbiAnICtcbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArXG4gICAgICAgICAgICAnIHdpdGggY29udGVudHMgPSAnICtcbiAgICAgICAgICAgIGRhdGEudG9TdHJpbmcoKSk7XG4gICAgfVxuICAgIGlmIChpc0ludmFsaWRKU09OTnVtYmVyKGRhdGEpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArXG4gICAgICAgICAgICAnY29udGFpbnMgJyArXG4gICAgICAgICAgICBkYXRhLnRvU3RyaW5nKCkgK1xuICAgICAgICAgICAgJyAnICtcbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSk7XG4gICAgfVxuICAgIC8vIENoZWNrIG1heCBsZWFmIHNpemUsIGJ1dCB0cnkgdG8gYXZvaWQgdGhlIHV0ZjggY29udmVyc2lvbiBpZiB3ZSBjYW4uXG4gICAgaWYgKHR5cGVvZiBkYXRhID09PSAnc3RyaW5nJyAmJlxuICAgICAgICBkYXRhLmxlbmd0aCA+IE1BWF9MRUFGX1NJWkVfIC8gMyAmJlxuICAgICAgICBzdHJpbmdMZW5ndGgoZGF0YSkgPiBNQVhfTEVBRl9TSVpFXykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXggK1xuICAgICAgICAgICAgJ2NvbnRhaW5zIGEgc3RyaW5nIGdyZWF0ZXIgdGhhbiAnICtcbiAgICAgICAgICAgIE1BWF9MRUFGX1NJWkVfICtcbiAgICAgICAgICAgICcgdXRmOCBieXRlcyAnICtcbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArXG4gICAgICAgICAgICBcIiAoJ1wiICtcbiAgICAgICAgICAgIGRhdGEuc3Vic3RyaW5nKDAsIDUwKSArXG4gICAgICAgICAgICBcIi4uLicpXCIpO1xuICAgIH1cbiAgICAvLyBUT0RPID0gUGVyZiA9IENvbnNpZGVyIGNvbWJpbmluZyB0aGUgcmVjdXJzaXZlIHZhbGlkYXRpb24gb2Yga2V5cyBpbnRvIE5vZGVGcm9tSlNPTlxuICAgIC8vIHRvIHNhdmUgZXh0cmEgd2Fsa2luZyBvZiBsYXJnZSBvYmplY3RzLlxuICAgIGlmIChkYXRhICYmIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0Jykge1xuICAgICAgICBsZXQgaGFzRG90VmFsdWUgPSBmYWxzZTtcbiAgICAgICAgbGV0IGhhc0FjdHVhbENoaWxkID0gZmFsc2U7XG4gICAgICAgIGVhY2goZGF0YSwgKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgIGlmIChrZXkgPT09ICcudmFsdWUnKSB7XG4gICAgICAgICAgICAgICAgaGFzRG90VmFsdWUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5ICE9PSAnLnByaW9yaXR5JyAmJiBrZXkgIT09ICcuc3YnKSB7XG4gICAgICAgICAgICAgICAgaGFzQWN0dWFsQ2hpbGQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGlmICghaXNWYWxpZEtleShrZXkpKSB7XG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeCArXG4gICAgICAgICAgICAgICAgICAgICAgICAnIGNvbnRhaW5zIGFuIGludmFsaWQga2V5ICgnICtcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleSArXG4gICAgICAgICAgICAgICAgICAgICAgICAnKSAnICtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoVG9FcnJvclN0cmluZyhwYXRoKSArXG4gICAgICAgICAgICAgICAgICAgICAgICAnLiAgS2V5cyBtdXN0IGJlIG5vbi1lbXB0eSBzdHJpbmdzICcgK1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2FuZCBjYW5cXCd0IGNvbnRhaW4gXCIuXCIsIFwiI1wiLCBcIiRcIiwgXCIvXCIsIFwiW1wiLCBvciBcIl1cIicpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoUHVzaChwYXRoLCBrZXkpO1xuICAgICAgICAgICAgdmFsaWRhdGVGaXJlYmFzZURhdGEoZXJyb3JQcmVmaXgsIHZhbHVlLCBwYXRoKTtcbiAgICAgICAgICAgIHZhbGlkYXRpb25QYXRoUG9wKHBhdGgpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGhhc0RvdFZhbHVlICYmIGhhc0FjdHVhbENoaWxkKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXggK1xuICAgICAgICAgICAgICAgICcgY29udGFpbnMgXCIudmFsdWVcIiBjaGlsZCAnICtcbiAgICAgICAgICAgICAgICB2YWxpZGF0aW9uUGF0aFRvRXJyb3JTdHJpbmcocGF0aCkgK1xuICAgICAgICAgICAgICAgICcgaW4gYWRkaXRpb24gdG8gYWN0dWFsIGNoaWxkcmVuLicpO1xuICAgICAgICB9XG4gICAgfVxufTtcbi8qKlxuICogUHJlLXZhbGlkYXRlIHBhdGhzIHBhc3NlZCBpbiB0aGUgZmlyZWJhc2UgZnVuY3Rpb24uXG4gKi9cbmNvbnN0IHZhbGlkYXRlRmlyZWJhc2VNZXJnZVBhdGhzID0gZnVuY3Rpb24gKGVycm9yUHJlZml4LCBtZXJnZVBhdGhzKSB7XG4gICAgbGV0IGksIGN1clBhdGg7XG4gICAgZm9yIChpID0gMDsgaSA8IG1lcmdlUGF0aHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY3VyUGF0aCA9IG1lcmdlUGF0aHNbaV07XG4gICAgICAgIGNvbnN0IGtleXMgPSBwYXRoU2xpY2UoY3VyUGF0aCk7XG4gICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwga2V5cy5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgaWYgKGtleXNbal0gPT09ICcucHJpb3JpdHknICYmIGogPT09IGtleXMubGVuZ3RoIC0gMSkgO1xuICAgICAgICAgICAgZWxzZSBpZiAoIWlzVmFsaWRLZXkoa2V5c1tqXSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXggK1xuICAgICAgICAgICAgICAgICAgICAnY29udGFpbnMgYW4gaW52YWxpZCBrZXkgKCcgK1xuICAgICAgICAgICAgICAgICAgICBrZXlzW2pdICtcbiAgICAgICAgICAgICAgICAgICAgJykgaW4gcGF0aCAnICtcbiAgICAgICAgICAgICAgICAgICAgY3VyUGF0aC50b1N0cmluZygpICtcbiAgICAgICAgICAgICAgICAgICAgJy4gS2V5cyBtdXN0IGJlIG5vbi1lbXB0eSBzdHJpbmdzICcgK1xuICAgICAgICAgICAgICAgICAgICAnYW5kIGNhblxcJ3QgY29udGFpbiBcIi5cIiwgXCIjXCIsIFwiJFwiLCBcIi9cIiwgXCJbXCIsIG9yIFwiXVwiJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gQ2hlY2sgdGhhdCB1cGRhdGUga2V5cyBhcmUgbm90IGRlc2NlbmRhbnRzIG9mIGVhY2ggb3RoZXIuXG4gICAgLy8gV2UgcmVseSBvbiB0aGUgcHJvcGVydHkgdGhhdCBzb3J0aW5nIGd1YXJhbnRlZXMgdGhhdCBhbmNlc3RvcnMgY29tZVxuICAgIC8vIHJpZ2h0IGJlZm9yZSBkZXNjZW5kYW50cy5cbiAgICBtZXJnZVBhdGhzLnNvcnQocGF0aENvbXBhcmUpO1xuICAgIGxldCBwcmV2UGF0aCA9IG51bGw7XG4gICAgZm9yIChpID0gMDsgaSA8IG1lcmdlUGF0aHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY3VyUGF0aCA9IG1lcmdlUGF0aHNbaV07XG4gICAgICAgIGlmIChwcmV2UGF0aCAhPT0gbnVsbCAmJiBwYXRoQ29udGFpbnMocHJldlBhdGgsIGN1clBhdGgpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXggK1xuICAgICAgICAgICAgICAgICdjb250YWlucyBhIHBhdGggJyArXG4gICAgICAgICAgICAgICAgcHJldlBhdGgudG9TdHJpbmcoKSArXG4gICAgICAgICAgICAgICAgJyB0aGF0IGlzIGFuY2VzdG9yIG9mIGFub3RoZXIgcGF0aCAnICtcbiAgICAgICAgICAgICAgICBjdXJQYXRoLnRvU3RyaW5nKCkpO1xuICAgICAgICB9XG4gICAgICAgIHByZXZQYXRoID0gY3VyUGF0aDtcbiAgICB9XG59O1xuLyoqXG4gKiBwcmUtdmFsaWRhdGUgYW4gb2JqZWN0IHBhc3NlZCBhcyBhbiBhcmd1bWVudCB0byBmaXJlYmFzZSBmdW5jdGlvbiAoXG4gKiBtdXN0IGJlIGFuIG9iamVjdCAtIGUuZy4gZm9yIGZpcmViYXNlLnVwZGF0ZSgpKS5cbiAqL1xuY29uc3QgdmFsaWRhdGVGaXJlYmFzZU1lcmdlRGF0YUFyZyA9IGZ1bmN0aW9uIChmbk5hbWUsIGRhdGEsIHBhdGgsIG9wdGlvbmFsKSB7XG4gICAgaWYgKG9wdGlvbmFsICYmIGRhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGNvbnN0IGVycm9yUHJlZml4JDEgPSBlcnJvclByZWZpeChmbk5hbWUsICd2YWx1ZXMnKTtcbiAgICBpZiAoIShkYXRhICYmIHR5cGVvZiBkYXRhID09PSAnb2JqZWN0JykgfHwgQXJyYXkuaXNBcnJheShkYXRhKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgkMSArICcgbXVzdCBiZSBhbiBvYmplY3QgY29udGFpbmluZyB0aGUgY2hpbGRyZW4gdG8gcmVwbGFjZS4nKTtcbiAgICB9XG4gICAgY29uc3QgbWVyZ2VQYXRocyA9IFtdO1xuICAgIGVhY2goZGF0YSwgKGtleSwgdmFsdWUpID0+IHtcbiAgICAgICAgY29uc3QgY3VyUGF0aCA9IG5ldyBQYXRoKGtleSk7XG4gICAgICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhKGVycm9yUHJlZml4JDEsIHZhbHVlLCBwYXRoQ2hpbGQocGF0aCwgY3VyUGF0aCkpO1xuICAgICAgICBpZiAocGF0aEdldEJhY2soY3VyUGF0aCkgPT09ICcucHJpb3JpdHknKSB7XG4gICAgICAgICAgICBpZiAoIWlzVmFsaWRQcmlvcml0eSh2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgkMSArXG4gICAgICAgICAgICAgICAgICAgIFwiY29udGFpbnMgYW4gaW52YWxpZCB2YWx1ZSBmb3IgJ1wiICtcbiAgICAgICAgICAgICAgICAgICAgY3VyUGF0aC50b1N0cmluZygpICtcbiAgICAgICAgICAgICAgICAgICAgXCInLCB3aGljaCBtdXN0IGJlIGEgdmFsaWQgXCIgK1xuICAgICAgICAgICAgICAgICAgICAnRmlyZWJhc2UgcHJpb3JpdHkgKGEgc3RyaW5nLCBmaW5pdGUgbnVtYmVyLCBzZXJ2ZXIgdmFsdWUsIG9yIG51bGwpLicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIG1lcmdlUGF0aHMucHVzaChjdXJQYXRoKTtcbiAgICB9KTtcbiAgICB2YWxpZGF0ZUZpcmViYXNlTWVyZ2VQYXRocyhlcnJvclByZWZpeCQxLCBtZXJnZVBhdGhzKTtcbn07XG5jb25zdCB2YWxpZGF0ZVByaW9yaXR5ID0gZnVuY3Rpb24gKGZuTmFtZSwgcHJpb3JpdHksIG9wdGlvbmFsKSB7XG4gICAgaWYgKG9wdGlvbmFsICYmIHByaW9yaXR5ID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoaXNJbnZhbGlkSlNPTk51bWJlcihwcmlvcml0eSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4KGZuTmFtZSwgJ3ByaW9yaXR5JykgK1xuICAgICAgICAgICAgJ2lzICcgK1xuICAgICAgICAgICAgcHJpb3JpdHkudG9TdHJpbmcoKSArXG4gICAgICAgICAgICAnLCBidXQgbXVzdCBiZSBhIHZhbGlkIEZpcmViYXNlIHByaW9yaXR5IChhIHN0cmluZywgZmluaXRlIG51bWJlciwgJyArXG4gICAgICAgICAgICAnc2VydmVyIHZhbHVlLCBvciBudWxsKS4nKTtcbiAgICB9XG4gICAgLy8gU3BlY2lhbCBjYXNlIHRvIGFsbG93IGltcG9ydGluZyBkYXRhIHdpdGggYSAuc3YuXG4gICAgaWYgKCFpc1ZhbGlkUHJpb3JpdHkocHJpb3JpdHkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsICdwcmlvcml0eScpICtcbiAgICAgICAgICAgICdtdXN0IGJlIGEgdmFsaWQgRmlyZWJhc2UgcHJpb3JpdHkgJyArXG4gICAgICAgICAgICAnKGEgc3RyaW5nLCBmaW5pdGUgbnVtYmVyLCBzZXJ2ZXIgdmFsdWUsIG9yIG51bGwpLicpO1xuICAgIH1cbn07XG5jb25zdCB2YWxpZGF0ZUtleSA9IGZ1bmN0aW9uIChmbk5hbWUsIGFyZ3VtZW50TmFtZSwga2V5LCBvcHRpb25hbCkge1xuICAgIGlmIChvcHRpb25hbCAmJiBrZXkgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICghaXNWYWxpZEtleShrZXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclByZWZpeChmbk5hbWUsIGFyZ3VtZW50TmFtZSkgK1xuICAgICAgICAgICAgJ3dhcyBhbiBpbnZhbGlkIGtleSA9IFwiJyArXG4gICAgICAgICAgICBrZXkgK1xuICAgICAgICAgICAgJ1wiLiAgRmlyZWJhc2Uga2V5cyBtdXN0IGJlIG5vbi1lbXB0eSBzdHJpbmdzIGFuZCAnICtcbiAgICAgICAgICAgICdjYW5cXCd0IGNvbnRhaW4gXCIuXCIsIFwiI1wiLCBcIiRcIiwgXCIvXCIsIFwiW1wiLCBvciBcIl1cIikuJyk7XG4gICAgfVxufTtcbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IHZhbGlkYXRlUGF0aFN0cmluZyA9IGZ1bmN0aW9uIChmbk5hbWUsIGFyZ3VtZW50TmFtZSwgcGF0aFN0cmluZywgb3B0aW9uYWwpIHtcbiAgICBpZiAob3B0aW9uYWwgJiYgcGF0aFN0cmluZyA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKCFpc1ZhbGlkUGF0aFN0cmluZyhwYXRoU3RyaW5nKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JQcmVmaXgoZm5OYW1lLCBhcmd1bWVudE5hbWUpICtcbiAgICAgICAgICAgICd3YXMgYW4gaW52YWxpZCBwYXRoID0gXCInICtcbiAgICAgICAgICAgIHBhdGhTdHJpbmcgK1xuICAgICAgICAgICAgJ1wiLiBQYXRocyBtdXN0IGJlIG5vbi1lbXB0eSBzdHJpbmdzIGFuZCAnICtcbiAgICAgICAgICAgICdjYW5cXCd0IGNvbnRhaW4gXCIuXCIsIFwiI1wiLCBcIiRcIiwgXCJbXCIsIG9yIFwiXVwiJyk7XG4gICAgfVxufTtcbmNvbnN0IHZhbGlkYXRlUm9vdFBhdGhTdHJpbmcgPSBmdW5jdGlvbiAoZm5OYW1lLCBhcmd1bWVudE5hbWUsIHBhdGhTdHJpbmcsIG9wdGlvbmFsKSB7XG4gICAgaWYgKHBhdGhTdHJpbmcpIHtcbiAgICAgICAgLy8gQWxsb3cgJy8uaW5mby8nIGF0IHRoZSBiZWdpbm5pbmcuXG4gICAgICAgIHBhdGhTdHJpbmcgPSBwYXRoU3RyaW5nLnJlcGxhY2UoL15cXC8qXFwuaW5mbyhcXC98JCkvLCAnLycpO1xuICAgIH1cbiAgICB2YWxpZGF0ZVBhdGhTdHJpbmcoZm5OYW1lLCBhcmd1bWVudE5hbWUsIHBhdGhTdHJpbmcsIG9wdGlvbmFsKTtcbn07XG4vKipcbiAqIEBpbnRlcm5hbFxuICovXG5jb25zdCB2YWxpZGF0ZVdyaXRhYmxlUGF0aCA9IGZ1bmN0aW9uIChmbk5hbWUsIHBhdGgpIHtcbiAgICBpZiAocGF0aEdldEZyb250KHBhdGgpID09PSAnLmluZm8nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihmbk5hbWUgKyBcIiBmYWlsZWQgPSBDYW4ndCBtb2RpZnkgZGF0YSB1bmRlciAvLmluZm8vXCIpO1xuICAgIH1cbn07XG5jb25zdCB2YWxpZGF0ZVVybCA9IGZ1bmN0aW9uIChmbk5hbWUsIHBhcnNlZFVybCkge1xuICAgIC8vIFRPRE8gPSBWYWxpZGF0ZSBzZXJ2ZXIgYmV0dGVyLlxuICAgIGNvbnN0IHBhdGhTdHJpbmcgPSBwYXJzZWRVcmwucGF0aC50b1N0cmluZygpO1xuICAgIGlmICghKHR5cGVvZiBwYXJzZWRVcmwucmVwb0luZm8uaG9zdCA9PT0gJ3N0cmluZycpIHx8XG4gICAgICAgIHBhcnNlZFVybC5yZXBvSW5mby5ob3N0Lmxlbmd0aCA9PT0gMCB8fFxuICAgICAgICAoIWlzVmFsaWRLZXkocGFyc2VkVXJsLnJlcG9JbmZvLm5hbWVzcGFjZSkgJiZcbiAgICAgICAgICAgIHBhcnNlZFVybC5yZXBvSW5mby5ob3N0LnNwbGl0KCc6JylbMF0gIT09ICdsb2NhbGhvc3QnKSB8fFxuICAgICAgICAocGF0aFN0cmluZy5sZW5ndGggIT09IDAgJiYgIWlzVmFsaWRSb290UGF0aFN0cmluZyhwYXRoU3RyaW5nKSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yUHJlZml4KGZuTmFtZSwgJ3VybCcpICtcbiAgICAgICAgICAgICdtdXN0IGJlIGEgdmFsaWQgZmlyZWJhc2UgVVJMIGFuZCAnICtcbiAgICAgICAgICAgICd0aGUgcGF0aCBjYW5cXCd0IGNvbnRhaW4gXCIuXCIsIFwiI1wiLCBcIiRcIiwgXCJbXCIsIG9yIFwiXVwiLicpO1xuICAgIH1cbn07XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIFRoZSBldmVudCBxdWV1ZSBzZXJ2ZXMgYSBmZXcgcHVycG9zZXM6XG4gKiAxLiBJdCBlbnN1cmVzIHdlIG1haW50YWluIGV2ZW50IG9yZGVyIGluIHRoZSBmYWNlIG9mIGV2ZW50IGNhbGxiYWNrcyBkb2luZyBvcGVyYXRpb25zIHRoYXQgcmVzdWx0IGluIG1vcmVcbiAqICAgIGV2ZW50cyBiZWluZyBxdWV1ZWQuXG4gKiAyLiByYWlzZVF1ZXVlZEV2ZW50cygpIGhhbmRsZXMgYmVpbmcgY2FsbGVkIHJlZW50cmFudGx5IG5pY2VseS4gIFRoYXQgaXMsIGlmIGluIHRoZSBjb3Vyc2Ugb2YgcmFpc2luZyBldmVudHMsXG4gKiAgICByYWlzZVF1ZXVlZEV2ZW50cygpIGlzIGNhbGxlZCBhZ2FpbiwgdGhlIFwiaW5uZXJcIiBjYWxsIHdpbGwgcGljayB1cCByYWlzaW5nIGV2ZW50cyB3aGVyZSB0aGUgXCJvdXRlclwiIGNhbGxcbiAqICAgIGxlZnQgb2ZmLCBlbnN1cmluZyB0aGF0IHRoZSBldmVudHMgYXJlIHN0aWxsIHJhaXNlZCBzeW5jaHJvbm91c2x5IGFuZCBpbiBvcmRlci5cbiAqIDMuIFlvdSBjYW4gdXNlIHJhaXNlRXZlbnRzQXRQYXRoIGFuZCByYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoIHRvIGVuc3VyZSBvbmx5IHJlbGV2YW50IHByZXZpb3VzbHktcXVldWVkXG4gKiAgICBldmVudHMgYXJlIHJhaXNlZCBzeW5jaHJvbm91c2x5LlxuICpcbiAqIE5PVEU6IFRoaXMgY2FuIGFsbCBnbyBhd2F5IGlmL3doZW4gd2UgbW92ZSB0byBhc3luYyBldmVudHMuXG4gKlxuICovXG5jbGFzcyBFdmVudFF1ZXVlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5ldmVudExpc3RzXyA9IFtdO1xuICAgICAgICAvKipcbiAgICAgICAgICogVHJhY2tzIHJlY3Vyc2lvbiBkZXB0aCBvZiByYWlzZVF1ZXVlZEV2ZW50c18sIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlY3Vyc2lvbkRlcHRoXyA9IDA7XG4gICAgfVxufVxuLyoqXG4gKiBAcGFyYW0gZXZlbnREYXRhTGlzdCAtIFRoZSBuZXcgZXZlbnRzIHRvIHF1ZXVlLlxuICovXG5mdW5jdGlvbiBldmVudFF1ZXVlUXVldWVFdmVudHMoZXZlbnRRdWV1ZSwgZXZlbnREYXRhTGlzdCkge1xuICAgIC8vIFdlIGdyb3VwIGV2ZW50cyBieSBwYXRoLCBzdG9yaW5nIHRoZW0gaW4gYSBzaW5nbGUgRXZlbnRMaXN0LCB0byBtYWtlIGl0IGVhc2llciB0byBza2lwIG92ZXIgdGhlbSBxdWlja2x5LlxuICAgIGxldCBjdXJyTGlzdCA9IG51bGw7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBldmVudERhdGFMaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGRhdGEgPSBldmVudERhdGFMaXN0W2ldO1xuICAgICAgICBjb25zdCBwYXRoID0gZGF0YS5nZXRQYXRoKCk7XG4gICAgICAgIGlmIChjdXJyTGlzdCAhPT0gbnVsbCAmJiAhcGF0aEVxdWFscyhwYXRoLCBjdXJyTGlzdC5wYXRoKSkge1xuICAgICAgICAgICAgZXZlbnRRdWV1ZS5ldmVudExpc3RzXy5wdXNoKGN1cnJMaXN0KTtcbiAgICAgICAgICAgIGN1cnJMaXN0ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3Vyckxpc3QgPT09IG51bGwpIHtcbiAgICAgICAgICAgIGN1cnJMaXN0ID0geyBldmVudHM6IFtdLCBwYXRoIH07XG4gICAgICAgIH1cbiAgICAgICAgY3Vyckxpc3QuZXZlbnRzLnB1c2goZGF0YSk7XG4gICAgfVxuICAgIGlmIChjdXJyTGlzdCkge1xuICAgICAgICBldmVudFF1ZXVlLmV2ZW50TGlzdHNfLnB1c2goY3Vyckxpc3QpO1xuICAgIH1cbn1cbi8qKlxuICogUXVldWVzIHRoZSBzcGVjaWZpZWQgZXZlbnRzIGFuZCBzeW5jaHJvbm91c2x5IHJhaXNlcyBhbGwgZXZlbnRzIChpbmNsdWRpbmcgcHJldmlvdXNseSBxdWV1ZWQgb25lcylcbiAqIGZvciB0aGUgc3BlY2lmaWVkIHBhdGguXG4gKlxuICogSXQgaXMgYXNzdW1lZCB0aGF0IHRoZSBuZXcgZXZlbnRzIGFyZSBhbGwgZm9yIHRoZSBzcGVjaWZpZWQgcGF0aC5cbiAqXG4gKiBAcGFyYW0gcGF0aCAtIFRoZSBwYXRoIHRvIHJhaXNlIGV2ZW50cyBmb3IuXG4gKiBAcGFyYW0gZXZlbnREYXRhTGlzdCAtIFRoZSBuZXcgZXZlbnRzIHRvIHJhaXNlLlxuICovXG5mdW5jdGlvbiBldmVudFF1ZXVlUmFpc2VFdmVudHNBdFBhdGgoZXZlbnRRdWV1ZSwgcGF0aCwgZXZlbnREYXRhTGlzdCkge1xuICAgIGV2ZW50UXVldWVRdWV1ZUV2ZW50cyhldmVudFF1ZXVlLCBldmVudERhdGFMaXN0KTtcbiAgICBldmVudFF1ZXVlUmFpc2VRdWV1ZWRFdmVudHNNYXRjaGluZ1ByZWRpY2F0ZShldmVudFF1ZXVlLCBldmVudFBhdGggPT4gcGF0aEVxdWFscyhldmVudFBhdGgsIHBhdGgpKTtcbn1cbi8qKlxuICogUXVldWVzIHRoZSBzcGVjaWZpZWQgZXZlbnRzIGFuZCBzeW5jaHJvbm91c2x5IHJhaXNlcyBhbGwgZXZlbnRzIChpbmNsdWRpbmcgcHJldmlvdXNseSBxdWV1ZWQgb25lcykgZm9yXG4gKiBsb2NhdGlvbnMgcmVsYXRlZCB0byB0aGUgc3BlY2lmaWVkIGNoYW5nZSBwYXRoIChpLmUuIGFsbCBhbmNlc3RvcnMgYW5kIGRlc2NlbmRhbnRzKS5cbiAqXG4gKiBJdCBpcyBhc3N1bWVkIHRoYXQgdGhlIG5ldyBldmVudHMgYXJlIGFsbCByZWxhdGVkIChhbmNlc3RvciBvciBkZXNjZW5kYW50KSB0byB0aGUgc3BlY2lmaWVkIHBhdGguXG4gKlxuICogQHBhcmFtIGNoYW5nZWRQYXRoIC0gVGhlIHBhdGggdG8gcmFpc2UgZXZlbnRzIGZvci5cbiAqIEBwYXJhbSBldmVudERhdGFMaXN0IC0gVGhlIGV2ZW50cyB0byByYWlzZVxuICovXG5mdW5jdGlvbiBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChldmVudFF1ZXVlLCBjaGFuZ2VkUGF0aCwgZXZlbnREYXRhTGlzdCkge1xuICAgIGV2ZW50UXVldWVRdWV1ZUV2ZW50cyhldmVudFF1ZXVlLCBldmVudERhdGFMaXN0KTtcbiAgICBldmVudFF1ZXVlUmFpc2VRdWV1ZWRFdmVudHNNYXRjaGluZ1ByZWRpY2F0ZShldmVudFF1ZXVlLCBldmVudFBhdGggPT4gcGF0aENvbnRhaW5zKGV2ZW50UGF0aCwgY2hhbmdlZFBhdGgpIHx8XG4gICAgICAgIHBhdGhDb250YWlucyhjaGFuZ2VkUGF0aCwgZXZlbnRQYXRoKSk7XG59XG5mdW5jdGlvbiBldmVudFF1ZXVlUmFpc2VRdWV1ZWRFdmVudHNNYXRjaGluZ1ByZWRpY2F0ZShldmVudFF1ZXVlLCBwcmVkaWNhdGUpIHtcbiAgICBldmVudFF1ZXVlLnJlY3Vyc2lvbkRlcHRoXysrO1xuICAgIGxldCBzZW50QWxsID0gdHJ1ZTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGV2ZW50UXVldWUuZXZlbnRMaXN0c18ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgZXZlbnRMaXN0ID0gZXZlbnRRdWV1ZS5ldmVudExpc3RzX1tpXTtcbiAgICAgICAgaWYgKGV2ZW50TGlzdCkge1xuICAgICAgICAgICAgY29uc3QgZXZlbnRQYXRoID0gZXZlbnRMaXN0LnBhdGg7XG4gICAgICAgICAgICBpZiAocHJlZGljYXRlKGV2ZW50UGF0aCkpIHtcbiAgICAgICAgICAgICAgICBldmVudExpc3RSYWlzZShldmVudFF1ZXVlLmV2ZW50TGlzdHNfW2ldKTtcbiAgICAgICAgICAgICAgICBldmVudFF1ZXVlLmV2ZW50TGlzdHNfW2ldID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbnRBbGwgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBpZiAoc2VudEFsbCkge1xuICAgICAgICBldmVudFF1ZXVlLmV2ZW50TGlzdHNfID0gW107XG4gICAgfVxuICAgIGV2ZW50UXVldWUucmVjdXJzaW9uRGVwdGhfLS07XG59XG4vKipcbiAqIEl0ZXJhdGVzIHRocm91Z2ggdGhlIGxpc3QgYW5kIHJhaXNlcyBlYWNoIGV2ZW50XG4gKi9cbmZ1bmN0aW9uIGV2ZW50TGlzdFJhaXNlKGV2ZW50TGlzdCkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZXZlbnRMaXN0LmV2ZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBldmVudERhdGEgPSBldmVudExpc3QuZXZlbnRzW2ldO1xuICAgICAgICBpZiAoZXZlbnREYXRhICE9PSBudWxsKSB7XG4gICAgICAgICAgICBldmVudExpc3QuZXZlbnRzW2ldID0gbnVsbDtcbiAgICAgICAgICAgIGNvbnN0IGV2ZW50Rm4gPSBldmVudERhdGEuZ2V0RXZlbnRSdW5uZXIoKTtcbiAgICAgICAgICAgIGlmIChsb2dnZXIpIHtcbiAgICAgICAgICAgICAgICBsb2coJ2V2ZW50OiAnICsgZXZlbnREYXRhLnRvU3RyaW5nKCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZXhjZXB0aW9uR3VhcmQoZXZlbnRGbik7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5jb25zdCBJTlRFUlJVUFRfUkVBU09OID0gJ3JlcG9faW50ZXJydXB0Jztcbi8qKlxuICogSWYgYSB0cmFuc2FjdGlvbiBkb2VzIG5vdCBzdWNjZWVkIGFmdGVyIDI1IHJldHJpZXMsIHdlIGFib3J0IGl0LiBBbW9uZyBvdGhlclxuICogdGhpbmdzIHRoaXMgZW5zdXJlIHRoYXQgaWYgdGhlcmUncyBldmVyIGEgYnVnIGNhdXNpbmcgYSBtaXNtYXRjaCBiZXR3ZWVuXG4gKiBjbGllbnQgLyBzZXJ2ZXIgaGFzaGVzIGZvciBzb21lIGRhdGEsIHdlIHdvbid0IHJldHJ5IGluZGVmaW5pdGVseS5cbiAqL1xuY29uc3QgTUFYX1RSQU5TQUNUSU9OX1JFVFJJRVMgPSAyNTtcbi8qKlxuICogQSBjb25uZWN0aW9uIHRvIGEgc2luZ2xlIGRhdGEgcmVwb3NpdG9yeS5cbiAqL1xuY2xhc3MgUmVwbyB7XG4gICAgY29uc3RydWN0b3IocmVwb0luZm9fLCBmb3JjZVJlc3RDbGllbnRfLCBhdXRoVG9rZW5Qcm92aWRlcl8sIGFwcENoZWNrUHJvdmlkZXJfKSB7XG4gICAgICAgIHRoaXMucmVwb0luZm9fID0gcmVwb0luZm9fO1xuICAgICAgICB0aGlzLmZvcmNlUmVzdENsaWVudF8gPSBmb3JjZVJlc3RDbGllbnRfO1xuICAgICAgICB0aGlzLmF1dGhUb2tlblByb3ZpZGVyXyA9IGF1dGhUb2tlblByb3ZpZGVyXztcbiAgICAgICAgdGhpcy5hcHBDaGVja1Byb3ZpZGVyXyA9IGFwcENoZWNrUHJvdmlkZXJfO1xuICAgICAgICB0aGlzLmRhdGFVcGRhdGVDb3VudCA9IDA7XG4gICAgICAgIHRoaXMuc3RhdHNMaXN0ZW5lcl8gPSBudWxsO1xuICAgICAgICB0aGlzLmV2ZW50UXVldWVfID0gbmV3IEV2ZW50UXVldWUoKTtcbiAgICAgICAgdGhpcy5uZXh0V3JpdGVJZF8gPSAxO1xuICAgICAgICB0aGlzLmludGVyY2VwdFNlcnZlckRhdGFDYWxsYmFja18gPSBudWxsO1xuICAgICAgICAvKiogQSBsaXN0IG9mIGRhdGEgcGllY2VzIGFuZCBwYXRocyB0byBiZSBzZXQgd2hlbiB0aGlzIGNsaWVudCBkaXNjb25uZWN0cy4gKi9cbiAgICAgICAgdGhpcy5vbkRpc2Nvbm5lY3RfID0gbmV3U3BhcnNlU25hcHNob3RUcmVlKCk7XG4gICAgICAgIC8qKiBTdG9yZXMgcXVldWVzIG9mIG91dHN0YW5kaW5nIHRyYW5zYWN0aW9ucyBmb3IgRmlyZWJhc2UgbG9jYXRpb25zLiAqL1xuICAgICAgICB0aGlzLnRyYW5zYWN0aW9uUXVldWVUcmVlXyA9IG5ldyBUcmVlKCk7XG4gICAgICAgIC8vIFRPRE86IFRoaXMgc2hvdWxkIGJlIEBwcml2YXRlIGJ1dCBpdCdzIHVzZWQgYnkgdGVzdF9hY2Nlc3MuanMgYW5kIGludGVybmFsLmpzXG4gICAgICAgIHRoaXMucGVyc2lzdGVudENvbm5lY3Rpb25fID0gbnVsbDtcbiAgICAgICAgLy8gVGhpcyBrZXkgaXMgaW50ZW50aW9uYWxseSBub3QgdXBkYXRlZCBpZiBSZXBvSW5mbyBpcyBsYXRlciBjaGFuZ2VkIG9yIHJlcGxhY2VkXG4gICAgICAgIHRoaXMua2V5ID0gdGhpcy5yZXBvSW5mb18udG9VUkxTdHJpbmcoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQHJldHVybnMgVGhlIFVSTCBjb3JyZXNwb25kaW5nIHRvIHRoZSByb290IG9mIHRoaXMgRmlyZWJhc2UuXG4gICAgICovXG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiAoKHRoaXMucmVwb0luZm9fLnNlY3VyZSA/ICdodHRwczovLycgOiAnaHR0cDovLycpICsgdGhpcy5yZXBvSW5mb18uaG9zdCk7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVwb1N0YXJ0KHJlcG8sIGFwcElkLCBhdXRoT3ZlcnJpZGUpIHtcbiAgICByZXBvLnN0YXRzXyA9IHN0YXRzTWFuYWdlckdldENvbGxlY3Rpb24ocmVwby5yZXBvSW5mb18pO1xuICAgIGlmIChyZXBvLmZvcmNlUmVzdENsaWVudF8gfHwgYmVpbmdDcmF3bGVkKCkpIHtcbiAgICAgICAgcmVwby5zZXJ2ZXJfID0gbmV3IFJlYWRvbmx5UmVzdENsaWVudChyZXBvLnJlcG9JbmZvXywgKHBhdGhTdHJpbmcsIGRhdGEsIGlzTWVyZ2UsIHRhZykgPT4ge1xuICAgICAgICAgICAgcmVwb09uRGF0YVVwZGF0ZShyZXBvLCBwYXRoU3RyaW5nLCBkYXRhLCBpc01lcmdlLCB0YWcpO1xuICAgICAgICB9LCByZXBvLmF1dGhUb2tlblByb3ZpZGVyXywgcmVwby5hcHBDaGVja1Byb3ZpZGVyXyk7XG4gICAgICAgIC8vIE1pbm9yIGhhY2s6IEZpcmUgb25Db25uZWN0IGltbWVkaWF0ZWx5LCBzaW5jZSB0aGVyZSdzIG5vIGFjdHVhbCBjb25uZWN0aW9uLlxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHJlcG9PbkNvbm5lY3RTdGF0dXMocmVwbywgLyogY29ubmVjdFN0YXR1cz0gKi8gdHJ1ZSksIDApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gVmFsaWRhdGUgYXV0aE92ZXJyaWRlXG4gICAgICAgIGlmICh0eXBlb2YgYXV0aE92ZXJyaWRlICE9PSAndW5kZWZpbmVkJyAmJiBhdXRoT3ZlcnJpZGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGlmICh0eXBlb2YgYXV0aE92ZXJyaWRlICE9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignT25seSBvYmplY3RzIGFyZSBzdXBwb3J0ZWQgZm9yIG9wdGlvbiBkYXRhYmFzZUF1dGhWYXJpYWJsZU92ZXJyaWRlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHN0cmluZ2lmeShhdXRoT3ZlcnJpZGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgYXV0aE92ZXJyaWRlIHByb3ZpZGVkOiAnICsgZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmVwby5wZXJzaXN0ZW50Q29ubmVjdGlvbl8gPSBuZXcgUGVyc2lzdGVudENvbm5lY3Rpb24ocmVwby5yZXBvSW5mb18sIGFwcElkLCAocGF0aFN0cmluZywgZGF0YSwgaXNNZXJnZSwgdGFnKSA9PiB7XG4gICAgICAgICAgICByZXBvT25EYXRhVXBkYXRlKHJlcG8sIHBhdGhTdHJpbmcsIGRhdGEsIGlzTWVyZ2UsIHRhZyk7XG4gICAgICAgIH0sIChjb25uZWN0U3RhdHVzKSA9PiB7XG4gICAgICAgICAgICByZXBvT25Db25uZWN0U3RhdHVzKHJlcG8sIGNvbm5lY3RTdGF0dXMpO1xuICAgICAgICB9LCAodXBkYXRlcykgPT4ge1xuICAgICAgICAgICAgcmVwb09uU2VydmVySW5mb1VwZGF0ZShyZXBvLCB1cGRhdGVzKTtcbiAgICAgICAgfSwgcmVwby5hdXRoVG9rZW5Qcm92aWRlcl8sIHJlcG8uYXBwQ2hlY2tQcm92aWRlcl8sIGF1dGhPdmVycmlkZSk7XG4gICAgICAgIHJlcG8uc2VydmVyXyA9IHJlcG8ucGVyc2lzdGVudENvbm5lY3Rpb25fO1xuICAgIH1cbiAgICByZXBvLmF1dGhUb2tlblByb3ZpZGVyXy5hZGRUb2tlbkNoYW5nZUxpc3RlbmVyKHRva2VuID0+IHtcbiAgICAgICAgcmVwby5zZXJ2ZXJfLnJlZnJlc2hBdXRoVG9rZW4odG9rZW4pO1xuICAgIH0pO1xuICAgIHJlcG8uYXBwQ2hlY2tQcm92aWRlcl8uYWRkVG9rZW5DaGFuZ2VMaXN0ZW5lcihyZXN1bHQgPT4ge1xuICAgICAgICByZXBvLnNlcnZlcl8ucmVmcmVzaEFwcENoZWNrVG9rZW4ocmVzdWx0LnRva2VuKTtcbiAgICB9KTtcbiAgICAvLyBJbiB0aGUgY2FzZSBvZiBtdWx0aXBsZSBSZXBvcyBmb3IgdGhlIHNhbWUgcmVwb0luZm8gKGkuZS4gdGhlcmUgYXJlIG11bHRpcGxlIEZpcmViYXNlLkNvbnRleHRzIGJlaW5nIHVzZWQpLFxuICAgIC8vIHdlIG9ubHkgd2FudCB0byBjcmVhdGUgb25lIFN0YXRzUmVwb3J0ZXIuICBBcyBzdWNoLCB3ZSdsbCByZXBvcnQgc3RhdHMgb3ZlciB0aGUgZmlyc3QgUmVwbyBjcmVhdGVkLlxuICAgIHJlcG8uc3RhdHNSZXBvcnRlcl8gPSBzdGF0c01hbmFnZXJHZXRPckNyZWF0ZVJlcG9ydGVyKHJlcG8ucmVwb0luZm9fLCAoKSA9PiBuZXcgU3RhdHNSZXBvcnRlcihyZXBvLnN0YXRzXywgcmVwby5zZXJ2ZXJfKSk7XG4gICAgLy8gVXNlZCBmb3IgLmluZm8uXG4gICAgcmVwby5pbmZvRGF0YV8gPSBuZXcgU25hcHNob3RIb2xkZXIoKTtcbiAgICByZXBvLmluZm9TeW5jVHJlZV8gPSBuZXcgU3luY1RyZWUoe1xuICAgICAgICBzdGFydExpc3RlbmluZzogKHF1ZXJ5LCB0YWcsIGN1cnJlbnRIYXNoRm4sIG9uQ29tcGxldGUpID0+IHtcbiAgICAgICAgICAgIGxldCBpbmZvRXZlbnRzID0gW107XG4gICAgICAgICAgICBjb25zdCBub2RlID0gcmVwby5pbmZvRGF0YV8uZ2V0Tm9kZShxdWVyeS5fcGF0aCk7XG4gICAgICAgICAgICAvLyBUaGlzIGlzIHBvc3NpYmx5IGEgaGFjaywgYnV0IHdlIGhhdmUgZGlmZmVyZW50IHNlbWFudGljcyBmb3IgLmluZm8gZW5kcG9pbnRzLiBXZSBkb24ndCByYWlzZSBudWxsIGV2ZW50c1xuICAgICAgICAgICAgLy8gb24gaW5pdGlhbCBkYXRhLi4uXG4gICAgICAgICAgICBpZiAoIW5vZGUuaXNFbXB0eSgpKSB7XG4gICAgICAgICAgICAgICAgaW5mb0V2ZW50cyA9IHN5bmNUcmVlQXBwbHlTZXJ2ZXJPdmVyd3JpdGUocmVwby5pbmZvU3luY1RyZWVfLCBxdWVyeS5fcGF0aCwgbm9kZSk7XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIG9uQ29tcGxldGUoJ29rJyk7XG4gICAgICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gaW5mb0V2ZW50cztcbiAgICAgICAgfSxcbiAgICAgICAgc3RvcExpc3RlbmluZzogKCkgPT4geyB9XG4gICAgfSk7XG4gICAgcmVwb1VwZGF0ZUluZm8ocmVwbywgJ2Nvbm5lY3RlZCcsIGZhbHNlKTtcbiAgICByZXBvLnNlcnZlclN5bmNUcmVlXyA9IG5ldyBTeW5jVHJlZSh7XG4gICAgICAgIHN0YXJ0TGlzdGVuaW5nOiAocXVlcnksIHRhZywgY3VycmVudEhhc2hGbiwgb25Db21wbGV0ZSkgPT4ge1xuICAgICAgICAgICAgcmVwby5zZXJ2ZXJfLmxpc3RlbihxdWVyeSwgY3VycmVudEhhc2hGbiwgdGFnLCAoc3RhdHVzLCBkYXRhKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnRzID0gb25Db21wbGV0ZShzdGF0dXMsIGRhdGEpO1xuICAgICAgICAgICAgICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHF1ZXJ5Ll9wYXRoLCBldmVudHMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAvLyBObyBzeW5jaHJvbm91cyBldmVudHMgZm9yIG5ldHdvcmstYmFja2VkIHN5bmMgdHJlZXNcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfSxcbiAgICAgICAgc3RvcExpc3RlbmluZzogKHF1ZXJ5LCB0YWcpID0+IHtcbiAgICAgICAgICAgIHJlcG8uc2VydmVyXy51bmxpc3RlbihxdWVyeSwgdGFnKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuLyoqXG4gKiBAcmV0dXJucyBUaGUgdGltZSBpbiBtaWxsaXNlY29uZHMsIHRha2luZyB0aGUgc2VydmVyIG9mZnNldCBpbnRvIGFjY291bnQgaWYgd2UgaGF2ZSBvbmUuXG4gKi9cbmZ1bmN0aW9uIHJlcG9TZXJ2ZXJUaW1lKHJlcG8pIHtcbiAgICBjb25zdCBvZmZzZXROb2RlID0gcmVwby5pbmZvRGF0YV8uZ2V0Tm9kZShuZXcgUGF0aCgnLmluZm8vc2VydmVyVGltZU9mZnNldCcpKTtcbiAgICBjb25zdCBvZmZzZXQgPSBvZmZzZXROb2RlLnZhbCgpIHx8IDA7XG4gICAgcmV0dXJuIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgb2Zmc2V0O1xufVxuLyoqXG4gKiBHZW5lcmF0ZSBTZXJ2ZXJWYWx1ZXMgdXNpbmcgc29tZSB2YXJpYWJsZXMgZnJvbSB0aGUgcmVwbyBvYmplY3QuXG4gKi9cbmZ1bmN0aW9uIHJlcG9HZW5lcmF0ZVNlcnZlclZhbHVlcyhyZXBvKSB7XG4gICAgcmV0dXJuIGdlbmVyYXRlV2l0aFZhbHVlcyh7XG4gICAgICAgIHRpbWVzdGFtcDogcmVwb1NlcnZlclRpbWUocmVwbylcbiAgICB9KTtcbn1cbi8qKlxuICogQ2FsbGVkIGJ5IHJlYWx0aW1lIHdoZW4gd2UgZ2V0IG5ldyBtZXNzYWdlcyBmcm9tIHRoZSBzZXJ2ZXIuXG4gKi9cbmZ1bmN0aW9uIHJlcG9PbkRhdGFVcGRhdGUocmVwbywgcGF0aFN0cmluZywgZGF0YSwgaXNNZXJnZSwgdGFnKSB7XG4gICAgLy8gRm9yIHRlc3RpbmcuXG4gICAgcmVwby5kYXRhVXBkYXRlQ291bnQrKztcbiAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgocGF0aFN0cmluZyk7XG4gICAgZGF0YSA9IHJlcG8uaW50ZXJjZXB0U2VydmVyRGF0YUNhbGxiYWNrX1xuICAgICAgICA/IHJlcG8uaW50ZXJjZXB0U2VydmVyRGF0YUNhbGxiYWNrXyhwYXRoU3RyaW5nLCBkYXRhKVxuICAgICAgICA6IGRhdGE7XG4gICAgbGV0IGV2ZW50cyA9IFtdO1xuICAgIGlmICh0YWcpIHtcbiAgICAgICAgaWYgKGlzTWVyZ2UpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhZ2dlZENoaWxkcmVuID0gbWFwKGRhdGEsIChyYXcpID0+IG5vZGVGcm9tSlNPTihyYXcpKTtcbiAgICAgICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlQXBwbHlUYWdnZWRRdWVyeU1lcmdlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCB0YWdnZWRDaGlsZHJlbiwgdGFnKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHRhZ2dlZFNuYXAgPSBub2RlRnJvbUpTT04oZGF0YSk7XG4gICAgICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5VGFnZ2VkUXVlcnlPdmVyd3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIHRhZ2dlZFNuYXAsIHRhZyk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAoaXNNZXJnZSkge1xuICAgICAgICBjb25zdCBjaGFuZ2VkQ2hpbGRyZW4gPSBtYXAoZGF0YSwgKHJhdykgPT4gbm9kZUZyb21KU09OKHJhdykpO1xuICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5U2VydmVyTWVyZ2UocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHBhdGgsIGNoYW5nZWRDaGlsZHJlbik7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zdCBzbmFwID0gbm9kZUZyb21KU09OKGRhdGEpO1xuICAgICAgICBldmVudHMgPSBzeW5jVHJlZUFwcGx5U2VydmVyT3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCBzbmFwKTtcbiAgICB9XG4gICAgbGV0IGFmZmVjdGVkUGF0aCA9IHBhdGg7XG4gICAgaWYgKGV2ZW50cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIC8vIFNpbmNlIHdlIGhhdmUgYSBsaXN0ZW5lciBvdXRzdGFuZGluZyBmb3IgZWFjaCB0cmFuc2FjdGlvbiwgcmVjZWl2aW5nIGFueSBldmVudHNcbiAgICAgICAgLy8gaXMgYSBwcm94eSBmb3Igc29tZSBjaGFuZ2UgaGF2aW5nIG9jY3VycmVkLlxuICAgICAgICBhZmZlY3RlZFBhdGggPSByZXBvUmVydW5UcmFuc2FjdGlvbnMocmVwbywgcGF0aCk7XG4gICAgfVxuICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIGFmZmVjdGVkUGF0aCwgZXZlbnRzKTtcbn1cbmZ1bmN0aW9uIHJlcG9PbkNvbm5lY3RTdGF0dXMocmVwbywgY29ubmVjdFN0YXR1cykge1xuICAgIHJlcG9VcGRhdGVJbmZvKHJlcG8sICdjb25uZWN0ZWQnLCBjb25uZWN0U3RhdHVzKTtcbiAgICBpZiAoY29ubmVjdFN0YXR1cyA9PT0gZmFsc2UpIHtcbiAgICAgICAgcmVwb1J1bk9uRGlzY29ubmVjdEV2ZW50cyhyZXBvKTtcbiAgICB9XG59XG5mdW5jdGlvbiByZXBvT25TZXJ2ZXJJbmZvVXBkYXRlKHJlcG8sIHVwZGF0ZXMpIHtcbiAgICBlYWNoKHVwZGF0ZXMsIChrZXksIHZhbHVlKSA9PiB7XG4gICAgICAgIHJlcG9VcGRhdGVJbmZvKHJlcG8sIGtleSwgdmFsdWUpO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVwb1VwZGF0ZUluZm8ocmVwbywgcGF0aFN0cmluZywgdmFsdWUpIHtcbiAgICBjb25zdCBwYXRoID0gbmV3IFBhdGgoJy8uaW5mby8nICsgcGF0aFN0cmluZyk7XG4gICAgY29uc3QgbmV3Tm9kZSA9IG5vZGVGcm9tSlNPTih2YWx1ZSk7XG4gICAgcmVwby5pbmZvRGF0YV8udXBkYXRlU25hcHNob3QocGF0aCwgbmV3Tm9kZSk7XG4gICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLmluZm9TeW5jVHJlZV8sIHBhdGgsIG5ld05vZGUpO1xuICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHBhdGgsIGV2ZW50cyk7XG59XG5mdW5jdGlvbiByZXBvR2V0TmV4dFdyaXRlSWQocmVwbykge1xuICAgIHJldHVybiByZXBvLm5leHRXcml0ZUlkXysrO1xufVxuLyoqXG4gKiBUaGUgcHVycG9zZSBvZiBgZ2V0VmFsdWVgIGlzIHRvIHJldHVybiB0aGUgbGF0ZXN0IGtub3duIHZhbHVlXG4gKiBzYXRpc2Z5aW5nIGBxdWVyeWAuXG4gKlxuICogVGhpcyBtZXRob2Qgd2lsbCBmaXJzdCBjaGVjayBmb3IgaW4tbWVtb3J5IGNhY2hlZCB2YWx1ZXNcbiAqIGJlbG9uZ2luZyB0byBhY3RpdmUgbGlzdGVuZXJzLiBJZiB0aGV5IGFyZSBmb3VuZCwgc3VjaCB2YWx1ZXNcbiAqIGFyZSBjb25zaWRlcmVkIHRvIGJlIHRoZSBtb3N0IHVwLXRvLWRhdGUuXG4gKlxuICogSWYgdGhlIGNsaWVudCBpcyBub3QgY29ubmVjdGVkLCB0aGlzIG1ldGhvZCB3aWxsIHdhaXQgdW50aWwgdGhlXG4gKiAgcmVwbyBoYXMgZXN0YWJsaXNoZWQgYSBjb25uZWN0aW9uIGFuZCB0aGVuIHJlcXVlc3QgdGhlIHZhbHVlIGZvciBgcXVlcnlgLlxuICogSWYgdGhlIGNsaWVudCBpcyBub3QgYWJsZSB0byByZXRyaWV2ZSB0aGUgcXVlcnkgcmVzdWx0IGZvciBhbm90aGVyIHJlYXNvbixcbiAqIGl0IHJlcG9ydHMgYW4gZXJyb3IuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIHF1ZXJ5IHRvIHN1cmZhY2UgYSB2YWx1ZSBmb3IuXG4gKi9cbmZ1bmN0aW9uIHJlcG9HZXRWYWx1ZShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHtcbiAgICAvLyBPbmx5IGFjdGl2ZSBxdWVyaWVzIGFyZSBjYWNoZWQuIFRoZXJlIGlzIG5vIHBlcnNpc3RlZCBjYWNoZS5cbiAgICBjb25zdCBjYWNoZWQgPSBzeW5jVHJlZUdldFNlcnZlclZhbHVlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBxdWVyeSk7XG4gICAgaWYgKGNhY2hlZCAhPSBudWxsKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoY2FjaGVkKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlcG8uc2VydmVyXy5nZXQocXVlcnkpLnRoZW4ocGF5bG9hZCA9PiB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBub2RlRnJvbUpTT04ocGF5bG9hZCkud2l0aEluZGV4KHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEJlbG93IHdlIHNpbXVsYXRlIHRoZSBhY3Rpb25zIG9mIGFuIGBvbmx5T25jZWAgYG9uVmFsdWUoKWAgZXZlbnQgd2hlcmU6XG4gICAgICAgICAqIEFkZCBhbiBldmVudCByZWdpc3RyYXRpb24sXG4gICAgICAgICAqIFVwZGF0ZSBkYXRhIGF0IHRoZSBwYXRoLFxuICAgICAgICAgKiBSYWlzZSBhbnkgZXZlbnRzLFxuICAgICAgICAgKiBDbGVhbnVwIHRoZSBTeW5jVHJlZVxuICAgICAgICAgKi9cbiAgICAgICAgc3luY1RyZWVBZGRFdmVudFJlZ2lzdHJhdGlvbihyZXBvLnNlcnZlclN5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uLCB0cnVlKTtcbiAgICAgICAgbGV0IGV2ZW50cztcbiAgICAgICAgaWYgKHF1ZXJ5Ll9xdWVyeVBhcmFtcy5sb2Fkc0FsbERhdGEoKSkge1xuICAgICAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBcHBseVNlcnZlck92ZXJ3cml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcXVlcnkuX3BhdGgsIG5vZGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgdGFnID0gc3luY1RyZWVUYWdGb3JRdWVyeShyZXBvLnNlcnZlclN5bmNUcmVlXywgcXVlcnkpO1xuICAgICAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBcHBseVRhZ2dlZFF1ZXJ5T3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBxdWVyeS5fcGF0aCwgbm9kZSwgdGFnKTtcbiAgICAgICAgfVxuICAgICAgICAvKlxuICAgICAgICAgKiBXZSBuZWVkIHRvIHJhaXNlIGV2ZW50cyBpbiB0aGUgc2NlbmFyaW8gd2hlcmUgYGdldCgpYCBpcyBjYWxsZWQgYXQgYSBwYXJlbnQgcGF0aCwgYW5kXG4gICAgICAgICAqIHdoaWxlIHRoZSBgZ2V0KClgIGlzIHBlbmRpbmcsIGBvblZhbHVlYCBpcyBjYWxsZWQgYXQgYSBjaGlsZCBsb2NhdGlvbi4gV2hpbGUgZ2V0KCkgaXMgd2FpdGluZ1xuICAgICAgICAgKiBmb3IgdGhlIGRhdGEsIGBvblZhbHVlYCB3aWxsIHJlZ2lzdGVyIGEgbmV3IGV2ZW50LiBUaGVuLCBnZXQoKSB3aWxsIGNvbWUgYmFjaywgYW5kIHVwZGF0ZSB0aGUgc3luY1RyZWVcbiAgICAgICAgICogYW5kIGl0cyBjb3JyZXNwb25kaW5nIHNlcnZlckNhY2hlLCBpbmNsdWRpbmcgdGhlIGNoaWxkIGxvY2F0aW9uIHdoZXJlIGBvblZhbHVlYCBpcyBjYWxsZWQuIFRoZW4sXG4gICAgICAgICAqIGBvblZhbHVlYCB3aWxsIHJlY2VpdmUgdGhlIGV2ZW50IGZyb20gdGhlIHNlcnZlciwgYnV0IGxvb2sgYXQgdGhlIHN5bmNUcmVlIGFuZCBzZWUgdGhhdCB0aGUgZGF0YSByZWNlaXZlZFxuICAgICAgICAgKiBmcm9tIHRoZSBzZXJ2ZXIgaXMgYWxyZWFkeSBhdCB0aGUgU3luY1BvaW50LCBhbmQgc28gdGhlIGBvblZhbHVlYCBjYWxsYmFjayB3aWxsIG5ldmVyIGdldCBmaXJlZC5cbiAgICAgICAgICogQ2FsbGluZyBgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgoKWAgaXMgdGhlIGNvcnJlY3Qgd2F5IHRvIHByb3BhZ2F0ZSB0aGUgZXZlbnRzIGFuZFxuICAgICAgICAgKiBlbnN1cmUgdGhlIGNvcnJlc3BvbmRpbmcgY2hpbGQgZXZlbnRzIHdpbGwgZ2V0IGZpcmVkLlxuICAgICAgICAgKi9cbiAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcXVlcnkuX3BhdGgsIGV2ZW50cyk7XG4gICAgICAgIHN5bmNUcmVlUmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24ocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbiwgbnVsbCwgdHJ1ZSk7XG4gICAgICAgIHJldHVybiBub2RlO1xuICAgIH0sIGVyciA9PiB7XG4gICAgICAgIHJlcG9Mb2cocmVwbywgJ2dldCBmb3IgcXVlcnkgJyArIHN0cmluZ2lmeShxdWVyeSkgKyAnIGZhaWxlZDogJyArIGVycik7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChuZXcgRXJyb3IoZXJyKSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiByZXBvU2V0V2l0aFByaW9yaXR5KHJlcG8sIHBhdGgsIG5ld1ZhbCwgbmV3UHJpb3JpdHksIG9uQ29tcGxldGUpIHtcbiAgICByZXBvTG9nKHJlcG8sICdzZXQnLCB7XG4gICAgICAgIHBhdGg6IHBhdGgudG9TdHJpbmcoKSxcbiAgICAgICAgdmFsdWU6IG5ld1ZhbCxcbiAgICAgICAgcHJpb3JpdHk6IG5ld1ByaW9yaXR5XG4gICAgfSk7XG4gICAgLy8gVE9ETzogT3B0aW1pemUgdGhpcyBiZWhhdmlvciB0byBlaXRoZXIgKGEpIHN0b3JlIGZsYWcgdG8gc2tpcCByZXNvbHZpbmcgd2hlcmUgcG9zc2libGUgYW5kIC8gb3JcbiAgICAvLyAoYikgc3RvcmUgdW5yZXNvbHZlZCBwYXRocyBvbiBKU09OIHBhcnNlXG4gICAgY29uc3Qgc2VydmVyVmFsdWVzID0gcmVwb0dlbmVyYXRlU2VydmVyVmFsdWVzKHJlcG8pO1xuICAgIGNvbnN0IG5ld05vZGVVbnJlc29sdmVkID0gbm9kZUZyb21KU09OKG5ld1ZhbCwgbmV3UHJpb3JpdHkpO1xuICAgIGNvbnN0IGV4aXN0aW5nID0gc3luY1RyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoKTtcbiAgICBjb25zdCBuZXdOb2RlID0gcmVzb2x2ZURlZmVycmVkVmFsdWVTbmFwc2hvdChuZXdOb2RlVW5yZXNvbHZlZCwgZXhpc3RpbmcsIHNlcnZlclZhbHVlcyk7XG4gICAgY29uc3Qgd3JpdGVJZCA9IHJlcG9HZXROZXh0V3JpdGVJZChyZXBvKTtcbiAgICBjb25zdCBldmVudHMgPSBzeW5jVHJlZUFwcGx5VXNlck92ZXJ3cml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCwgbmV3Tm9kZSwgd3JpdGVJZCwgdHJ1ZSk7XG4gICAgZXZlbnRRdWV1ZVF1ZXVlRXZlbnRzKHJlcG8uZXZlbnRRdWV1ZV8sIGV2ZW50cyk7XG4gICAgcmVwby5zZXJ2ZXJfLnB1dChwYXRoLnRvU3RyaW5nKCksIG5ld05vZGVVbnJlc29sdmVkLnZhbCgvKmV4cG9ydD0qLyB0cnVlKSwgKHN0YXR1cywgZXJyb3JSZWFzb24pID0+IHtcbiAgICAgICAgY29uc3Qgc3VjY2VzcyA9IHN0YXR1cyA9PT0gJ29rJztcbiAgICAgICAgaWYgKCFzdWNjZXNzKSB7XG4gICAgICAgICAgICB3YXJuKCdzZXQgYXQgJyArIHBhdGggKyAnIGZhaWxlZDogJyArIHN0YXR1cyk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgY2xlYXJFdmVudHMgPSBzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgd3JpdGVJZCwgIXN1Y2Nlc3MpO1xuICAgICAgICBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChyZXBvLmV2ZW50UXVldWVfLCBwYXRoLCBjbGVhckV2ZW50cyk7XG4gICAgICAgIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIG9uQ29tcGxldGUsIHN0YXR1cywgZXJyb3JSZWFzb24pO1xuICAgIH0pO1xuICAgIGNvbnN0IGFmZmVjdGVkUGF0aCA9IHJlcG9BYm9ydFRyYW5zYWN0aW9ucyhyZXBvLCBwYXRoKTtcbiAgICByZXBvUmVydW5UcmFuc2FjdGlvbnMocmVwbywgYWZmZWN0ZWRQYXRoKTtcbiAgICAvLyBXZSBxdWV1ZWQgdGhlIGV2ZW50cyBhYm92ZSwgc28ganVzdCBmbHVzaCB0aGUgcXVldWUgaGVyZVxuICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIGFmZmVjdGVkUGF0aCwgW10pO1xufVxuZnVuY3Rpb24gcmVwb1VwZGF0ZShyZXBvLCBwYXRoLCBjaGlsZHJlblRvTWVyZ2UsIG9uQ29tcGxldGUpIHtcbiAgICByZXBvTG9nKHJlcG8sICd1cGRhdGUnLCB7IHBhdGg6IHBhdGgudG9TdHJpbmcoKSwgdmFsdWU6IGNoaWxkcmVuVG9NZXJnZSB9KTtcbiAgICAvLyBTdGFydCB3aXRoIG91ciBleGlzdGluZyBkYXRhIGFuZCBtZXJnZSBlYWNoIGNoaWxkIGludG8gaXQuXG4gICAgbGV0IGVtcHR5ID0gdHJ1ZTtcbiAgICBjb25zdCBzZXJ2ZXJWYWx1ZXMgPSByZXBvR2VuZXJhdGVTZXJ2ZXJWYWx1ZXMocmVwbyk7XG4gICAgY29uc3QgY2hhbmdlZENoaWxkcmVuID0ge307XG4gICAgZWFjaChjaGlsZHJlblRvTWVyZ2UsIChjaGFuZ2VkS2V5LCBjaGFuZ2VkVmFsdWUpID0+IHtcbiAgICAgICAgZW1wdHkgPSBmYWxzZTtcbiAgICAgICAgY2hhbmdlZENoaWxkcmVuW2NoYW5nZWRLZXldID0gcmVzb2x2ZURlZmVycmVkVmFsdWVUcmVlKHBhdGhDaGlsZChwYXRoLCBjaGFuZ2VkS2V5KSwgbm9kZUZyb21KU09OKGNoYW5nZWRWYWx1ZSksIHJlcG8uc2VydmVyU3luY1RyZWVfLCBzZXJ2ZXJWYWx1ZXMpO1xuICAgIH0pO1xuICAgIGlmICghZW1wdHkpIHtcbiAgICAgICAgY29uc3Qgd3JpdGVJZCA9IHJlcG9HZXROZXh0V3JpdGVJZChyZXBvKTtcbiAgICAgICAgY29uc3QgZXZlbnRzID0gc3luY1RyZWVBcHBseVVzZXJNZXJnZShyZXBvLnNlcnZlclN5bmNUcmVlXywgcGF0aCwgY2hhbmdlZENoaWxkcmVuLCB3cml0ZUlkKTtcbiAgICAgICAgZXZlbnRRdWV1ZVF1ZXVlRXZlbnRzKHJlcG8uZXZlbnRRdWV1ZV8sIGV2ZW50cyk7XG4gICAgICAgIHJlcG8uc2VydmVyXy5tZXJnZShwYXRoLnRvU3RyaW5nKCksIGNoaWxkcmVuVG9NZXJnZSwgKHN0YXR1cywgZXJyb3JSZWFzb24pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN1Y2Nlc3MgPSBzdGF0dXMgPT09ICdvayc7XG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICB3YXJuKCd1cGRhdGUgYXQgJyArIHBhdGggKyAnIGZhaWxlZDogJyArIHN0YXR1cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCBjbGVhckV2ZW50cyA9IHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCB3cml0ZUlkLCAhc3VjY2Vzcyk7XG4gICAgICAgICAgICBjb25zdCBhZmZlY3RlZFBhdGggPSBjbGVhckV2ZW50cy5sZW5ndGggPiAwID8gcmVwb1JlcnVuVHJhbnNhY3Rpb25zKHJlcG8sIHBhdGgpIDogcGF0aDtcbiAgICAgICAgICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIGFmZmVjdGVkUGF0aCwgY2xlYXJFdmVudHMpO1xuICAgICAgICAgICAgcmVwb0NhbGxPbkNvbXBsZXRlQ2FsbGJhY2socmVwbywgb25Db21wbGV0ZSwgc3RhdHVzLCBlcnJvclJlYXNvbik7XG4gICAgICAgIH0pO1xuICAgICAgICBlYWNoKGNoaWxkcmVuVG9NZXJnZSwgKGNoYW5nZWRQYXRoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBhZmZlY3RlZFBhdGggPSByZXBvQWJvcnRUcmFuc2FjdGlvbnMocmVwbywgcGF0aENoaWxkKHBhdGgsIGNoYW5nZWRQYXRoKSk7XG4gICAgICAgICAgICByZXBvUmVydW5UcmFuc2FjdGlvbnMocmVwbywgYWZmZWN0ZWRQYXRoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIC8vIFdlIHF1ZXVlZCB0aGUgZXZlbnRzIGFib3ZlLCBzbyBqdXN0IGZsdXNoIHRoZSBxdWV1ZSBoZXJlXG4gICAgICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHBhdGgsIFtdKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGxvZyhcInVwZGF0ZSgpIGNhbGxlZCB3aXRoIGVtcHR5IGRhdGEuICBEb24ndCBkbyBhbnl0aGluZy5cIik7XG4gICAgICAgIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIG9uQ29tcGxldGUsICdvaycsIHVuZGVmaW5lZCk7XG4gICAgfVxufVxuLyoqXG4gKiBBcHBsaWVzIGFsbCBvZiB0aGUgY2hhbmdlcyBzdG9yZWQgdXAgaW4gdGhlIG9uRGlzY29ubmVjdF8gdHJlZS5cbiAqL1xuZnVuY3Rpb24gcmVwb1J1bk9uRGlzY29ubmVjdEV2ZW50cyhyZXBvKSB7XG4gICAgcmVwb0xvZyhyZXBvLCAnb25EaXNjb25uZWN0RXZlbnRzJyk7XG4gICAgY29uc3Qgc2VydmVyVmFsdWVzID0gcmVwb0dlbmVyYXRlU2VydmVyVmFsdWVzKHJlcG8pO1xuICAgIGNvbnN0IHJlc29sdmVkT25EaXNjb25uZWN0VHJlZSA9IG5ld1NwYXJzZVNuYXBzaG90VHJlZSgpO1xuICAgIHNwYXJzZVNuYXBzaG90VHJlZUZvckVhY2hUcmVlKHJlcG8ub25EaXNjb25uZWN0XywgbmV3RW1wdHlQYXRoKCksIChwYXRoLCBub2RlKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc29sdmVkID0gcmVzb2x2ZURlZmVycmVkVmFsdWVUcmVlKHBhdGgsIG5vZGUsIHJlcG8uc2VydmVyU3luY1RyZWVfLCBzZXJ2ZXJWYWx1ZXMpO1xuICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVSZW1lbWJlcihyZXNvbHZlZE9uRGlzY29ubmVjdFRyZWUsIHBhdGgsIHJlc29sdmVkKTtcbiAgICB9KTtcbiAgICBsZXQgZXZlbnRzID0gW107XG4gICAgc3BhcnNlU25hcHNob3RUcmVlRm9yRWFjaFRyZWUocmVzb2x2ZWRPbkRpc2Nvbm5lY3RUcmVlLCBuZXdFbXB0eVBhdGgoKSwgKHBhdGgsIHNuYXApID0+IHtcbiAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFwcGx5U2VydmVyT3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCBzbmFwKSk7XG4gICAgICAgIGNvbnN0IGFmZmVjdGVkUGF0aCA9IHJlcG9BYm9ydFRyYW5zYWN0aW9ucyhyZXBvLCBwYXRoKTtcbiAgICAgICAgcmVwb1JlcnVuVHJhbnNhY3Rpb25zKHJlcG8sIGFmZmVjdGVkUGF0aCk7XG4gICAgfSk7XG4gICAgcmVwby5vbkRpc2Nvbm5lY3RfID0gbmV3U3BhcnNlU25hcHNob3RUcmVlKCk7XG4gICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgbmV3RW1wdHlQYXRoKCksIGV2ZW50cyk7XG59XG5mdW5jdGlvbiByZXBvT25EaXNjb25uZWN0Q2FuY2VsKHJlcG8sIHBhdGgsIG9uQ29tcGxldGUpIHtcbiAgICByZXBvLnNlcnZlcl8ub25EaXNjb25uZWN0Q2FuY2VsKHBhdGgudG9TdHJpbmcoKSwgKHN0YXR1cywgZXJyb3JSZWFzb24pID0+IHtcbiAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ29rJykge1xuICAgICAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlRm9yZ2V0KHJlcG8ub25EaXNjb25uZWN0XywgcGF0aCk7XG4gICAgICAgIH1cbiAgICAgICAgcmVwb0NhbGxPbkNvbXBsZXRlQ2FsbGJhY2socmVwbywgb25Db21wbGV0ZSwgc3RhdHVzLCBlcnJvclJlYXNvbik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiByZXBvT25EaXNjb25uZWN0U2V0KHJlcG8sIHBhdGgsIHZhbHVlLCBvbkNvbXBsZXRlKSB7XG4gICAgY29uc3QgbmV3Tm9kZSA9IG5vZGVGcm9tSlNPTih2YWx1ZSk7XG4gICAgcmVwby5zZXJ2ZXJfLm9uRGlzY29ubmVjdFB1dChwYXRoLnRvU3RyaW5nKCksIG5ld05vZGUudmFsKC8qZXhwb3J0PSovIHRydWUpLCAoc3RhdHVzLCBlcnJvclJlYXNvbikgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7XG4gICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVSZW1lbWJlcihyZXBvLm9uRGlzY29ubmVjdF8sIHBhdGgsIG5ld05vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIG9uQ29tcGxldGUsIHN0YXR1cywgZXJyb3JSZWFzb24pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVwb09uRGlzY29ubmVjdFNldFdpdGhQcmlvcml0eShyZXBvLCBwYXRoLCB2YWx1ZSwgcHJpb3JpdHksIG9uQ29tcGxldGUpIHtcbiAgICBjb25zdCBuZXdOb2RlID0gbm9kZUZyb21KU09OKHZhbHVlLCBwcmlvcml0eSk7XG4gICAgcmVwby5zZXJ2ZXJfLm9uRGlzY29ubmVjdFB1dChwYXRoLnRvU3RyaW5nKCksIG5ld05vZGUudmFsKC8qZXhwb3J0PSovIHRydWUpLCAoc3RhdHVzLCBlcnJvclJlYXNvbikgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7XG4gICAgICAgICAgICBzcGFyc2VTbmFwc2hvdFRyZWVSZW1lbWJlcihyZXBvLm9uRGlzY29ubmVjdF8sIHBhdGgsIG5ld05vZGUpO1xuICAgICAgICB9XG4gICAgICAgIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIG9uQ29tcGxldGUsIHN0YXR1cywgZXJyb3JSZWFzb24pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVwb09uRGlzY29ubmVjdFVwZGF0ZShyZXBvLCBwYXRoLCBjaGlsZHJlblRvTWVyZ2UsIG9uQ29tcGxldGUpIHtcbiAgICBpZiAoaXNFbXB0eShjaGlsZHJlblRvTWVyZ2UpKSB7XG4gICAgICAgIGxvZyhcIm9uRGlzY29ubmVjdCgpLnVwZGF0ZSgpIGNhbGxlZCB3aXRoIGVtcHR5IGRhdGEuICBEb24ndCBkbyBhbnl0aGluZy5cIik7XG4gICAgICAgIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIG9uQ29tcGxldGUsICdvaycsIHVuZGVmaW5lZCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgcmVwby5zZXJ2ZXJfLm9uRGlzY29ubmVjdE1lcmdlKHBhdGgudG9TdHJpbmcoKSwgY2hpbGRyZW5Ub01lcmdlLCAoc3RhdHVzLCBlcnJvclJlYXNvbikgPT4ge1xuICAgICAgICBpZiAoc3RhdHVzID09PSAnb2snKSB7XG4gICAgICAgICAgICBlYWNoKGNoaWxkcmVuVG9NZXJnZSwgKGNoaWxkTmFtZSwgY2hpbGROb2RlKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgbmV3Q2hpbGROb2RlID0gbm9kZUZyb21KU09OKGNoaWxkTm9kZSk7XG4gICAgICAgICAgICAgICAgc3BhcnNlU25hcHNob3RUcmVlUmVtZW1iZXIocmVwby5vbkRpc2Nvbm5lY3RfLCBwYXRoQ2hpbGQocGF0aCwgY2hpbGROYW1lKSwgbmV3Q2hpbGROb2RlKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIG9uQ29tcGxldGUsIHN0YXR1cywgZXJyb3JSZWFzb24pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gcmVwb0FkZEV2ZW50Q2FsbGJhY2tGb3JRdWVyeShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHtcbiAgICBsZXQgZXZlbnRzO1xuICAgIGlmIChwYXRoR2V0RnJvbnQocXVlcnkuX3BhdGgpID09PSAnLmluZm8nKSB7XG4gICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlQWRkRXZlbnRSZWdpc3RyYXRpb24ocmVwby5pbmZvU3luY1RyZWVfLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXZlbnRzID0gc3luY1RyZWVBZGRFdmVudFJlZ2lzdHJhdGlvbihyZXBvLnNlcnZlclN5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uKTtcbiAgICB9XG4gICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzQXRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHF1ZXJ5Ll9wYXRoLCBldmVudHMpO1xufVxuZnVuY3Rpb24gcmVwb1JlbW92ZUV2ZW50Q2FsbGJhY2tGb3JRdWVyeShyZXBvLCBxdWVyeSwgZXZlbnRSZWdpc3RyYXRpb24pIHtcbiAgICAvLyBUaGVzZSBhcmUgZ3VhcmFudGVlZCBub3QgdG8gcmFpc2UgZXZlbnRzLCBzaW5jZSB3ZSdyZSBub3QgcGFzc2luZyBpbiBhIGNhbmNlbEVycm9yLiBIb3dldmVyLCB3ZSBjYW4gZnV0dXJlLXByb29mXG4gICAgLy8gYSBsaXR0bGUgYml0IGJ5IGhhbmRsaW5nIHRoZSByZXR1cm4gdmFsdWVzIGFueXdheXMuXG4gICAgbGV0IGV2ZW50cztcbiAgICBpZiAocGF0aEdldEZyb250KHF1ZXJ5Ll9wYXRoKSA9PT0gJy5pbmZvJykge1xuICAgICAgICBldmVudHMgPSBzeW5jVHJlZVJlbW92ZUV2ZW50UmVnaXN0cmF0aW9uKHJlcG8uaW5mb1N5bmNUcmVlXywgcXVlcnksIGV2ZW50UmVnaXN0cmF0aW9uKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGV2ZW50cyA9IHN5bmNUcmVlUmVtb3ZlRXZlbnRSZWdpc3RyYXRpb24ocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHF1ZXJ5LCBldmVudFJlZ2lzdHJhdGlvbik7XG4gICAgfVxuICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0F0UGF0aChyZXBvLmV2ZW50UXVldWVfLCBxdWVyeS5fcGF0aCwgZXZlbnRzKTtcbn1cbmZ1bmN0aW9uIHJlcG9JbnRlcnJ1cHQocmVwbykge1xuICAgIGlmIChyZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXykge1xuICAgICAgICByZXBvLnBlcnNpc3RlbnRDb25uZWN0aW9uXy5pbnRlcnJ1cHQoSU5URVJSVVBUX1JFQVNPTik7XG4gICAgfVxufVxuZnVuY3Rpb24gcmVwb1Jlc3VtZShyZXBvKSB7XG4gICAgaWYgKHJlcG8ucGVyc2lzdGVudENvbm5lY3Rpb25fKSB7XG4gICAgICAgIHJlcG8ucGVyc2lzdGVudENvbm5lY3Rpb25fLnJlc3VtZShJTlRFUlJVUFRfUkVBU09OKTtcbiAgICB9XG59XG5mdW5jdGlvbiByZXBvTG9nKHJlcG8sIC4uLnZhckFyZ3MpIHtcbiAgICBsZXQgcHJlZml4ID0gJyc7XG4gICAgaWYgKHJlcG8ucGVyc2lzdGVudENvbm5lY3Rpb25fKSB7XG4gICAgICAgIHByZWZpeCA9IHJlcG8ucGVyc2lzdGVudENvbm5lY3Rpb25fLmlkICsgJzonO1xuICAgIH1cbiAgICBsb2cocHJlZml4LCAuLi52YXJBcmdzKTtcbn1cbmZ1bmN0aW9uIHJlcG9DYWxsT25Db21wbGV0ZUNhbGxiYWNrKHJlcG8sIGNhbGxiYWNrLCBzdGF0dXMsIGVycm9yUmVhc29uKSB7XG4gICAgaWYgKGNhbGxiYWNrKSB7XG4gICAgICAgIGV4Y2VwdGlvbkd1YXJkKCgpID0+IHtcbiAgICAgICAgICAgIGlmIChzdGF0dXMgPT09ICdvaycpIHtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnN0IGNvZGUgPSAoc3RhdHVzIHx8ICdlcnJvcicpLnRvVXBwZXJDYXNlKCk7XG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSBjb2RlO1xuICAgICAgICAgICAgICAgIGlmIChlcnJvclJlYXNvbikge1xuICAgICAgICAgICAgICAgICAgICBtZXNzYWdlICs9ICc6ICcgKyBlcnJvclJlYXNvbjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IobWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgICAgICAgICAgICAgICBlcnJvci5jb2RlID0gY29kZTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB0cmFuc2FjdGlvbiwgYWRkcyBpdCB0byB0aGUgdHJhbnNhY3Rpb25zIHdlJ3JlIHRyYWNraW5nLCBhbmRcbiAqIHNlbmRzIGl0IHRvIHRoZSBzZXJ2ZXIgaWYgcG9zc2libGUuXG4gKlxuICogQHBhcmFtIHBhdGggLSBQYXRoIGF0IHdoaWNoIHRvIGRvIHRyYW5zYWN0aW9uLlxuICogQHBhcmFtIHRyYW5zYWN0aW9uVXBkYXRlIC0gVXBkYXRlIGNhbGxiYWNrLlxuICogQHBhcmFtIG9uQ29tcGxldGUgLSBDb21wbGV0aW9uIGNhbGxiYWNrLlxuICogQHBhcmFtIHVud2F0Y2hlciAtIEZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgd2hlbiB0aGUgdHJhbnNhY3Rpb24gbm8gbG9uZ2VyXG4gKiBuZWVkIGRhdGEgdXBkYXRlcyBmb3IgYHBhdGhgLlxuICogQHBhcmFtIGFwcGx5TG9jYWxseSAtIFdoZXRoZXIgb3Igbm90IHRvIG1ha2UgaW50ZXJtZWRpYXRlIHJlc3VsdHMgdmlzaWJsZVxuICovXG5mdW5jdGlvbiByZXBvU3RhcnRUcmFuc2FjdGlvbihyZXBvLCBwYXRoLCB0cmFuc2FjdGlvblVwZGF0ZSwgb25Db21wbGV0ZSwgdW53YXRjaGVyLCBhcHBseUxvY2FsbHkpIHtcbiAgICByZXBvTG9nKHJlcG8sICd0cmFuc2FjdGlvbiBvbiAnICsgcGF0aCk7XG4gICAgLy8gSW5pdGlhbGl6ZSB0cmFuc2FjdGlvbi5cbiAgICBjb25zdCB0cmFuc2FjdGlvbiA9IHtcbiAgICAgICAgcGF0aCxcbiAgICAgICAgdXBkYXRlOiB0cmFuc2FjdGlvblVwZGF0ZSxcbiAgICAgICAgb25Db21wbGV0ZSxcbiAgICAgICAgLy8gT25lIG9mIFRyYW5zYWN0aW9uU3RhdHVzIGVudW1zLlxuICAgICAgICBzdGF0dXM6IG51bGwsXG4gICAgICAgIC8vIFVzZWQgd2hlbiBjb21iaW5pbmcgdHJhbnNhY3Rpb25zIGF0IGRpZmZlcmVudCBsb2NhdGlvbnMgdG8gZmlndXJlIG91dFxuICAgICAgICAvLyB3aGljaCBvbmUgZ29lcyBmaXJzdC5cbiAgICAgICAgb3JkZXI6IExVSURHZW5lcmF0b3IoKSxcbiAgICAgICAgLy8gV2hldGhlciB0byByYWlzZSBsb2NhbCBldmVudHMgZm9yIHRoaXMgdHJhbnNhY3Rpb24uXG4gICAgICAgIGFwcGx5TG9jYWxseSxcbiAgICAgICAgLy8gQ291bnQgb2YgaG93IG1hbnkgdGltZXMgd2UndmUgcmV0cmllZCB0aGUgdHJhbnNhY3Rpb24uXG4gICAgICAgIHJldHJ5Q291bnQ6IDAsXG4gICAgICAgIC8vIEZ1bmN0aW9uIHRvIGNhbGwgdG8gY2xlYW4gdXAgb3VyIC5vbigpIGxpc3RlbmVyLlxuICAgICAgICB1bndhdGNoZXIsXG4gICAgICAgIC8vIFN0b3JlcyB3aHkgYSB0cmFuc2FjdGlvbiB3YXMgYWJvcnRlZC5cbiAgICAgICAgYWJvcnRSZWFzb246IG51bGwsXG4gICAgICAgIGN1cnJlbnRXcml0ZUlkOiBudWxsLFxuICAgICAgICBjdXJyZW50SW5wdXRTbmFwc2hvdDogbnVsbCxcbiAgICAgICAgY3VycmVudE91dHB1dFNuYXBzaG90UmF3OiBudWxsLFxuICAgICAgICBjdXJyZW50T3V0cHV0U25hcHNob3RSZXNvbHZlZDogbnVsbFxuICAgIH07XG4gICAgLy8gUnVuIHRyYW5zYWN0aW9uIGluaXRpYWxseS5cbiAgICBjb25zdCBjdXJyZW50U3RhdGUgPSByZXBvR2V0TGF0ZXN0U3RhdGUocmVwbywgcGF0aCwgdW5kZWZpbmVkKTtcbiAgICB0cmFuc2FjdGlvbi5jdXJyZW50SW5wdXRTbmFwc2hvdCA9IGN1cnJlbnRTdGF0ZTtcbiAgICBjb25zdCBuZXdWYWwgPSB0cmFuc2FjdGlvbi51cGRhdGUoY3VycmVudFN0YXRlLnZhbCgpKTtcbiAgICBpZiAobmV3VmFsID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgLy8gQWJvcnQgdHJhbnNhY3Rpb24uXG4gICAgICAgIHRyYW5zYWN0aW9uLnVud2F0Y2hlcigpO1xuICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50T3V0cHV0U25hcHNob3RSYXcgPSBudWxsO1xuICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50T3V0cHV0U25hcHNob3RSZXNvbHZlZCA9IG51bGw7XG4gICAgICAgIGlmICh0cmFuc2FjdGlvbi5vbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICB0cmFuc2FjdGlvbi5vbkNvbXBsZXRlKG51bGwsIGZhbHNlLCB0cmFuc2FjdGlvbi5jdXJyZW50SW5wdXRTbmFwc2hvdCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhKCd0cmFuc2FjdGlvbiBmYWlsZWQ6IERhdGEgcmV0dXJuZWQgJywgbmV3VmFsLCB0cmFuc2FjdGlvbi5wYXRoKTtcbiAgICAgICAgLy8gTWFyayBhcyBydW4gYW5kIGFkZCB0byBvdXIgcXVldWUuXG4gICAgICAgIHRyYW5zYWN0aW9uLnN0YXR1cyA9IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovO1xuICAgICAgICBjb25zdCBxdWV1ZU5vZGUgPSB0cmVlU3ViVHJlZShyZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXywgcGF0aCk7XG4gICAgICAgIGNvbnN0IG5vZGVRdWV1ZSA9IHRyZWVHZXRWYWx1ZShxdWV1ZU5vZGUpIHx8IFtdO1xuICAgICAgICBub2RlUXVldWUucHVzaCh0cmFuc2FjdGlvbik7XG4gICAgICAgIHRyZWVTZXRWYWx1ZShxdWV1ZU5vZGUsIG5vZGVRdWV1ZSk7XG4gICAgICAgIC8vIFVwZGF0ZSB2aXNpYmxlRGF0YSBhbmQgcmFpc2UgZXZlbnRzXG4gICAgICAgIC8vIE5vdGU6IFdlIGludGVudGlvbmFsbHkgcmFpc2UgZXZlbnRzIGFmdGVyIHVwZGF0aW5nIGFsbCBvZiBvdXJcbiAgICAgICAgLy8gdHJhbnNhY3Rpb24gc3RhdGUsIHNpbmNlIHRoZSB1c2VyIGNvdWxkIHN0YXJ0IG5ldyB0cmFuc2FjdGlvbnMgZnJvbSB0aGVcbiAgICAgICAgLy8gZXZlbnQgY2FsbGJhY2tzLlxuICAgICAgICBsZXQgcHJpb3JpdHlGb3JOb2RlO1xuICAgICAgICBpZiAodHlwZW9mIG5ld1ZhbCA9PT0gJ29iamVjdCcgJiZcbiAgICAgICAgICAgIG5ld1ZhbCAhPT0gbnVsbCAmJlxuICAgICAgICAgICAgY29udGFpbnMobmV3VmFsLCAnLnByaW9yaXR5JykpIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgICAgICAgICBwcmlvcml0eUZvck5vZGUgPSBzYWZlR2V0KG5ld1ZhbCwgJy5wcmlvcml0eScpO1xuICAgICAgICAgICAgYXNzZXJ0KGlzVmFsaWRQcmlvcml0eShwcmlvcml0eUZvck5vZGUpLCAnSW52YWxpZCBwcmlvcml0eSByZXR1cm5lZCBieSB0cmFuc2FjdGlvbi4gJyArXG4gICAgICAgICAgICAgICAgJ1ByaW9yaXR5IG11c3QgYmUgYSB2YWxpZCBzdHJpbmcsIGZpbml0ZSBudW1iZXIsIHNlcnZlciB2YWx1ZSwgb3IgbnVsbC4nKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IGN1cnJlbnROb2RlID0gc3luY1RyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoKSB8fFxuICAgICAgICAgICAgICAgIENoaWxkcmVuTm9kZS5FTVBUWV9OT0RFO1xuICAgICAgICAgICAgcHJpb3JpdHlGb3JOb2RlID0gY3VycmVudE5vZGUuZ2V0UHJpb3JpdHkoKS52YWwoKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzZXJ2ZXJWYWx1ZXMgPSByZXBvR2VuZXJhdGVTZXJ2ZXJWYWx1ZXMocmVwbyk7XG4gICAgICAgIGNvbnN0IG5ld05vZGVVbnJlc29sdmVkID0gbm9kZUZyb21KU09OKG5ld1ZhbCwgcHJpb3JpdHlGb3JOb2RlKTtcbiAgICAgICAgY29uc3QgbmV3Tm9kZSA9IHJlc29sdmVEZWZlcnJlZFZhbHVlU25hcHNob3QobmV3Tm9kZVVucmVzb2x2ZWQsIGN1cnJlbnRTdGF0ZSwgc2VydmVyVmFsdWVzKTtcbiAgICAgICAgdHJhbnNhY3Rpb24uY3VycmVudE91dHB1dFNuYXBzaG90UmF3ID0gbmV3Tm9kZVVucmVzb2x2ZWQ7XG4gICAgICAgIHRyYW5zYWN0aW9uLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJlc29sdmVkID0gbmV3Tm9kZTtcbiAgICAgICAgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQgPSByZXBvR2V0TmV4dFdyaXRlSWQocmVwbyk7XG4gICAgICAgIGNvbnN0IGV2ZW50cyA9IHN5bmNUcmVlQXBwbHlVc2VyT3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCBuZXdOb2RlLCB0cmFuc2FjdGlvbi5jdXJyZW50V3JpdGVJZCwgdHJhbnNhY3Rpb24uYXBwbHlMb2NhbGx5KTtcbiAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcGF0aCwgZXZlbnRzKTtcbiAgICAgICAgcmVwb1NlbmRSZWFkeVRyYW5zYWN0aW9ucyhyZXBvLCByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXyk7XG4gICAgfVxufVxuLyoqXG4gKiBAcGFyYW0gZXhjbHVkZVNldHMgLSBBIHNwZWNpZmljIHNldCB0byBleGNsdWRlXG4gKi9cbmZ1bmN0aW9uIHJlcG9HZXRMYXRlc3RTdGF0ZShyZXBvLCBwYXRoLCBleGNsdWRlU2V0cykge1xuICAgIHJldHVybiAoc3luY1RyZWVDYWxjQ29tcGxldGVFdmVudENhY2hlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBwYXRoLCBleGNsdWRlU2V0cykgfHxcbiAgICAgICAgQ2hpbGRyZW5Ob2RlLkVNUFRZX05PREUpO1xufVxuLyoqXG4gKiBTZW5kcyBhbnkgYWxyZWFkeS1ydW4gdHJhbnNhY3Rpb25zIHRoYXQgYXJlbid0IHdhaXRpbmcgZm9yIG91dHN0YW5kaW5nXG4gKiB0cmFuc2FjdGlvbnMgdG8gY29tcGxldGUuXG4gKlxuICogRXh0ZXJuYWxseSBpdCdzIGNhbGxlZCB3aXRoIG5vIGFyZ3VtZW50cywgYnV0IGl0IGNhbGxzIGl0c2VsZiByZWN1cnNpdmVseVxuICogd2l0aCBhIHBhcnRpY3VsYXIgdHJhbnNhY3Rpb25RdWV1ZVRyZWUgbm9kZSB0byByZWN1cnNlIHRocm91Z2ggdGhlIHRyZWUuXG4gKlxuICogQHBhcmFtIG5vZGUgLSB0cmFuc2FjdGlvblF1ZXVlVHJlZSBub2RlIHRvIHN0YXJ0IGF0LlxuICovXG5mdW5jdGlvbiByZXBvU2VuZFJlYWR5VHJhbnNhY3Rpb25zKHJlcG8sIG5vZGUgPSByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXykge1xuICAgIC8vIEJlZm9yZSByZWN1cnNpbmcsIG1ha2Ugc3VyZSBhbnkgY29tcGxldGVkIHRyYW5zYWN0aW9ucyBhcmUgcmVtb3ZlZC5cbiAgICBpZiAoIW5vZGUpIHtcbiAgICAgICAgcmVwb1BydW5lQ29tcGxldGVkVHJhbnNhY3Rpb25zQmVsb3dOb2RlKHJlcG8sIG5vZGUpO1xuICAgIH1cbiAgICBpZiAodHJlZUdldFZhbHVlKG5vZGUpKSB7XG4gICAgICAgIGNvbnN0IHF1ZXVlID0gcmVwb0J1aWxkVHJhbnNhY3Rpb25RdWV1ZShyZXBvLCBub2RlKTtcbiAgICAgICAgYXNzZXJ0KHF1ZXVlLmxlbmd0aCA+IDAsICdTZW5kaW5nIHplcm8gbGVuZ3RoIHRyYW5zYWN0aW9uIHF1ZXVlJyk7XG4gICAgICAgIGNvbnN0IGFsbFJ1biA9IHF1ZXVlLmV2ZXJ5KCh0cmFuc2FjdGlvbikgPT4gdHJhbnNhY3Rpb24uc3RhdHVzID09PSAwIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlJVTiAqLyk7XG4gICAgICAgIC8vIElmIHRoZXkncmUgYWxsIHJ1biAoYW5kIG5vdCBzZW50KSwgd2UgY2FuIHNlbmQgdGhlbS4gIEVsc2UsIHdlIG11c3Qgd2FpdC5cbiAgICAgICAgaWYgKGFsbFJ1bikge1xuICAgICAgICAgICAgcmVwb1NlbmRUcmFuc2FjdGlvblF1ZXVlKHJlcG8sIHRyZWVHZXRQYXRoKG5vZGUpLCBxdWV1ZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZWxzZSBpZiAodHJlZUhhc0NoaWxkcmVuKG5vZGUpKSB7XG4gICAgICAgIHRyZWVGb3JFYWNoQ2hpbGQobm9kZSwgY2hpbGROb2RlID0+IHtcbiAgICAgICAgICAgIHJlcG9TZW5kUmVhZHlUcmFuc2FjdGlvbnMocmVwbywgY2hpbGROb2RlKTtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuLyoqXG4gKiBHaXZlbiBhIGxpc3Qgb2YgcnVuIHRyYW5zYWN0aW9ucywgc2VuZCB0aGVtIHRvIHRoZSBzZXJ2ZXIgYW5kIHRoZW4gaGFuZGxlXG4gKiB0aGUgcmVzdWx0IChzdWNjZXNzIG9yIGZhaWx1cmUpLlxuICpcbiAqIEBwYXJhbSBwYXRoIC0gVGhlIGxvY2F0aW9uIG9mIHRoZSBxdWV1ZS5cbiAqIEBwYXJhbSBxdWV1ZSAtIFF1ZXVlIG9mIHRyYW5zYWN0aW9ucyB1bmRlciB0aGUgc3BlY2lmaWVkIGxvY2F0aW9uLlxuICovXG5mdW5jdGlvbiByZXBvU2VuZFRyYW5zYWN0aW9uUXVldWUocmVwbywgcGF0aCwgcXVldWUpIHtcbiAgICAvLyBNYXJrIHRyYW5zYWN0aW9ucyBhcyBzZW50IGFuZCBpbmNyZW1lbnQgcmV0cnkgY291bnQhXG4gICAgY29uc3Qgc2V0c1RvSWdub3JlID0gcXVldWUubWFwKHR4biA9PiB7XG4gICAgICAgIHJldHVybiB0eG4uY3VycmVudFdyaXRlSWQ7XG4gICAgfSk7XG4gICAgY29uc3QgbGF0ZXN0U3RhdGUgPSByZXBvR2V0TGF0ZXN0U3RhdGUocmVwbywgcGF0aCwgc2V0c1RvSWdub3JlKTtcbiAgICBsZXQgc25hcFRvU2VuZCA9IGxhdGVzdFN0YXRlO1xuICAgIGNvbnN0IGxhdGVzdEhhc2ggPSBsYXRlc3RTdGF0ZS5oYXNoKCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBxdWV1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCB0eG4gPSBxdWV1ZVtpXTtcbiAgICAgICAgYXNzZXJ0KHR4bi5zdGF0dXMgPT09IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovLCAndHJ5VG9TZW5kVHJhbnNhY3Rpb25RdWV1ZV86IGl0ZW1zIGluIHF1ZXVlIHNob3VsZCBhbGwgYmUgcnVuLicpO1xuICAgICAgICB0eG4uc3RhdHVzID0gMSAvKiBUcmFuc2FjdGlvblN0YXR1cy5TRU5UICovO1xuICAgICAgICB0eG4ucmV0cnlDb3VudCsrO1xuICAgICAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBuZXdSZWxhdGl2ZVBhdGgocGF0aCwgdHhuLnBhdGgpO1xuICAgICAgICAvLyBJZiB3ZSd2ZSBnb3R0ZW4gdG8gdGhpcyBwb2ludCwgdGhlIG91dHB1dCBzbmFwc2hvdCBtdXN0IGJlIGRlZmluZWQuXG4gICAgICAgIHNuYXBUb1NlbmQgPSBzbmFwVG9TZW5kLnVwZGF0ZUNoaWxkKHJlbGF0aXZlUGF0aCAvKiogQHR5cGUgeyFOb2RlfSAqLywgdHhuLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJhdyk7XG4gICAgfVxuICAgIGNvbnN0IGRhdGFUb1NlbmQgPSBzbmFwVG9TZW5kLnZhbCh0cnVlKTtcbiAgICBjb25zdCBwYXRoVG9TZW5kID0gcGF0aDtcbiAgICAvLyBTZW5kIHRoZSBwdXQuXG4gICAgcmVwby5zZXJ2ZXJfLnB1dChwYXRoVG9TZW5kLnRvU3RyaW5nKCksIGRhdGFUb1NlbmQsIChzdGF0dXMpID0+IHtcbiAgICAgICAgcmVwb0xvZyhyZXBvLCAndHJhbnNhY3Rpb24gcHV0IHJlc3BvbnNlJywge1xuICAgICAgICAgICAgcGF0aDogcGF0aFRvU2VuZC50b1N0cmluZygpLFxuICAgICAgICAgICAgc3RhdHVzXG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgZXZlbnRzID0gW107XG4gICAgICAgIGlmIChzdGF0dXMgPT09ICdvaycpIHtcbiAgICAgICAgICAgIC8vIFF1ZXVlIHVwIHRoZSBjYWxsYmFja3MgYW5kIGZpcmUgdGhlbSBhZnRlciBjbGVhbmluZyB1cCBhbGwgb2Ygb3VyXG4gICAgICAgICAgICAvLyB0cmFuc2FjdGlvbiBzdGF0ZSwgc2luY2UgdGhlIGNhbGxiYWNrIGNvdWxkIHRyaWdnZXIgbW9yZVxuICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb25zIG9yIHNldHMuXG4gICAgICAgICAgICBjb25zdCBjYWxsYmFja3MgPSBbXTtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICBxdWV1ZVtpXS5zdGF0dXMgPSAyIC8qIFRyYW5zYWN0aW9uU3RhdHVzLkNPTVBMRVRFRCAqLztcbiAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBxdWV1ZVtpXS5jdXJyZW50V3JpdGVJZCkpO1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZVtpXS5vbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIFdlIG5ldmVyIHVuc2V0IHRoZSBvdXRwdXQgc25hcHNob3QsIGFuZCBnaXZlbiB0aGF0IHRoaXNcbiAgICAgICAgICAgICAgICAgICAgLy8gdHJhbnNhY3Rpb24gaXMgY29tcGxldGUsIGl0IHNob3VsZCBiZSBzZXRcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2goKCkgPT4gcXVldWVbaV0ub25Db21wbGV0ZShudWxsLCB0cnVlLCBxdWV1ZVtpXS5jdXJyZW50T3V0cHV0U25hcHNob3RSZXNvbHZlZCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBxdWV1ZVtpXS51bndhdGNoZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIE5vdyByZW1vdmUgdGhlIGNvbXBsZXRlZCB0cmFuc2FjdGlvbnMuXG4gICAgICAgICAgICByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgdHJlZVN1YlRyZWUocmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV8sIHBhdGgpKTtcbiAgICAgICAgICAgIC8vIFRoZXJlIG1heSBiZSBwZW5kaW5nIHRyYW5zYWN0aW9ucyB0aGF0IHdlIGNhbiBub3cgc2VuZC5cbiAgICAgICAgICAgIHJlcG9TZW5kUmVhZHlUcmFuc2FjdGlvbnMocmVwbywgcmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV8pO1xuICAgICAgICAgICAgZXZlbnRRdWV1ZVJhaXNlRXZlbnRzRm9yQ2hhbmdlZFBhdGgocmVwby5ldmVudFF1ZXVlXywgcGF0aCwgZXZlbnRzKTtcbiAgICAgICAgICAgIC8vIEZpbmFsbHksIHRyaWdnZXIgb25Db21wbGV0ZSBjYWxsYmFja3MuXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGV4Y2VwdGlvbkd1YXJkKGNhbGxiYWNrc1tpXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyB0cmFuc2FjdGlvbnMgYXJlIG5vIGxvbmdlciBzZW50LiAgVXBkYXRlIHRoZWlyIHN0YXR1cyBhcHByb3ByaWF0ZWx5LlxuICAgICAgICAgICAgaWYgKHN0YXR1cyA9PT0gJ2RhdGFzdGFsZScpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChxdWV1ZVtpXS5zdGF0dXMgPT09IDMgLyogVHJhbnNhY3Rpb25TdGF0dXMuU0VOVF9ORUVEU19BQk9SVCAqLykge1xuICAgICAgICAgICAgICAgICAgICAgICAgcXVldWVbaV0uc3RhdHVzID0gNCAvKiBUcmFuc2FjdGlvblN0YXR1cy5ORUVEU19BQk9SVCAqLztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDAgLyogVHJhbnNhY3Rpb25TdGF0dXMuUlVOICovO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgd2FybigndHJhbnNhY3Rpb24gYXQgJyArIHBhdGhUb1NlbmQudG9TdHJpbmcoKSArICcgZmFpbGVkOiAnICsgc3RhdHVzKTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDQgLyogVHJhbnNhY3Rpb25TdGF0dXMuTkVFRFNfQUJPUlQgKi87XG4gICAgICAgICAgICAgICAgICAgIHF1ZXVlW2ldLmFib3J0UmVhc29uID0gc3RhdHVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcG9SZXJ1blRyYW5zYWN0aW9ucyhyZXBvLCBwYXRoKTtcbiAgICAgICAgfVxuICAgIH0sIGxhdGVzdEhhc2gpO1xufVxuLyoqXG4gKiBGaW5kcyBhbGwgdHJhbnNhY3Rpb25zIGRlcGVuZGVudCBvbiB0aGUgZGF0YSBhdCBjaGFuZ2VkUGF0aCBhbmQgcmVydW5zIHRoZW0uXG4gKlxuICogU2hvdWxkIGJlIGNhbGxlZCBhbnkgdGltZSBjYWNoZWQgZGF0YSBjaGFuZ2VzLlxuICpcbiAqIFJldHVybiB0aGUgaGlnaGVzdCBwYXRoIHRoYXQgd2FzIGFmZmVjdGVkIGJ5IHJlcnVubmluZyB0cmFuc2FjdGlvbnMuIFRoaXNcbiAqIGlzIHRoZSBwYXRoIGF0IHdoaWNoIGV2ZW50cyBuZWVkIHRvIGJlIHJhaXNlZCBmb3IuXG4gKlxuICogQHBhcmFtIGNoYW5nZWRQYXRoIC0gVGhlIHBhdGggaW4gbWVyZ2VkRGF0YSB0aGF0IGNoYW5nZWQuXG4gKiBAcmV0dXJucyBUaGUgcm9vdG1vc3QgcGF0aCB0aGF0IHdhcyBhZmZlY3RlZCBieSByZXJ1bm5pbmcgdHJhbnNhY3Rpb25zLlxuICovXG5mdW5jdGlvbiByZXBvUmVydW5UcmFuc2FjdGlvbnMocmVwbywgY2hhbmdlZFBhdGgpIHtcbiAgICBjb25zdCByb290TW9zdFRyYW5zYWN0aW9uTm9kZSA9IHJlcG9HZXRBbmNlc3RvclRyYW5zYWN0aW9uTm9kZShyZXBvLCBjaGFuZ2VkUGF0aCk7XG4gICAgY29uc3QgcGF0aCA9IHRyZWVHZXRQYXRoKHJvb3RNb3N0VHJhbnNhY3Rpb25Ob2RlKTtcbiAgICBjb25zdCBxdWV1ZSA9IHJlcG9CdWlsZFRyYW5zYWN0aW9uUXVldWUocmVwbywgcm9vdE1vc3RUcmFuc2FjdGlvbk5vZGUpO1xuICAgIHJlcG9SZXJ1blRyYW5zYWN0aW9uUXVldWUocmVwbywgcXVldWUsIHBhdGgpO1xuICAgIHJldHVybiBwYXRoO1xufVxuLyoqXG4gKiBEb2VzIGFsbCB0aGUgd29yayBvZiByZXJ1bm5pbmcgdHJhbnNhY3Rpb25zIChhcyB3ZWxsIGFzIGNsZWFucyB1cCBhYm9ydGVkXG4gKiB0cmFuc2FjdGlvbnMgYW5kIHdoYXRub3QpLlxuICpcbiAqIEBwYXJhbSBxdWV1ZSAtIFRoZSBxdWV1ZSBvZiB0cmFuc2FjdGlvbnMgdG8gcnVuLlxuICogQHBhcmFtIHBhdGggLSBUaGUgcGF0aCB0aGUgcXVldWUgaXMgZm9yLlxuICovXG5mdW5jdGlvbiByZXBvUmVydW5UcmFuc2FjdGlvblF1ZXVlKHJlcG8sIHF1ZXVlLCBwYXRoKSB7XG4gICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm47IC8vIE5vdGhpbmcgdG8gZG8hXG4gICAgfVxuICAgIC8vIFF1ZXVlIHVwIHRoZSBjYWxsYmFja3MgYW5kIGZpcmUgdGhlbSBhZnRlciBjbGVhbmluZyB1cCBhbGwgb2Ygb3VyXG4gICAgLy8gdHJhbnNhY3Rpb24gc3RhdGUsIHNpbmNlIHRoZSBjYWxsYmFjayBjb3VsZCB0cmlnZ2VyIG1vcmUgdHJhbnNhY3Rpb25zIG9yXG4gICAgLy8gc2V0cy5cbiAgICBjb25zdCBjYWxsYmFja3MgPSBbXTtcbiAgICBsZXQgZXZlbnRzID0gW107XG4gICAgLy8gSWdub3JlIGFsbCBvZiB0aGUgc2V0cyB3ZSdyZSBnb2luZyB0byByZS1ydW4uXG4gICAgY29uc3QgdHhuc1RvUmVydW4gPSBxdWV1ZS5maWx0ZXIocSA9PiB7XG4gICAgICAgIHJldHVybiBxLnN0YXR1cyA9PT0gMCAvKiBUcmFuc2FjdGlvblN0YXR1cy5SVU4gKi87XG4gICAgfSk7XG4gICAgY29uc3Qgc2V0c1RvSWdub3JlID0gdHhuc1RvUmVydW4ubWFwKHEgPT4ge1xuICAgICAgICByZXR1cm4gcS5jdXJyZW50V3JpdGVJZDtcbiAgICB9KTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHRyYW5zYWN0aW9uID0gcXVldWVbaV07XG4gICAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IG5ld1JlbGF0aXZlUGF0aChwYXRoLCB0cmFuc2FjdGlvbi5wYXRoKTtcbiAgICAgICAgbGV0IGFib3J0VHJhbnNhY3Rpb24gPSBmYWxzZSwgYWJvcnRSZWFzb247XG4gICAgICAgIGFzc2VydChyZWxhdGl2ZVBhdGggIT09IG51bGwsICdyZXJ1blRyYW5zYWN0aW9uc1VuZGVyTm9kZV86IHJlbGF0aXZlUGF0aCBzaG91bGQgbm90IGJlIG51bGwuJyk7XG4gICAgICAgIGlmICh0cmFuc2FjdGlvbi5zdGF0dXMgPT09IDQgLyogVHJhbnNhY3Rpb25TdGF0dXMuTkVFRFNfQUJPUlQgKi8pIHtcbiAgICAgICAgICAgIGFib3J0VHJhbnNhY3Rpb24gPSB0cnVlO1xuICAgICAgICAgICAgYWJvcnRSZWFzb24gPSB0cmFuc2FjdGlvbi5hYm9ydFJlYXNvbjtcbiAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHRyYW5zYWN0aW9uLmN1cnJlbnRXcml0ZUlkLCB0cnVlKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHJhbnNhY3Rpb24uc3RhdHVzID09PSAwIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlJVTiAqLykge1xuICAgICAgICAgICAgaWYgKHRyYW5zYWN0aW9uLnJldHJ5Q291bnQgPj0gTUFYX1RSQU5TQUNUSU9OX1JFVFJJRVMpIHtcbiAgICAgICAgICAgICAgICBhYm9ydFRyYW5zYWN0aW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBhYm9ydFJlYXNvbiA9ICdtYXhyZXRyeSc7XG4gICAgICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQsIHRydWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIFRoaXMgY29kZSByZXJ1bnMgYSB0cmFuc2FjdGlvblxuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnROb2RlID0gcmVwb0dldExhdGVzdFN0YXRlKHJlcG8sIHRyYW5zYWN0aW9uLnBhdGgsIHNldHNUb0lnbm9yZSk7XG4gICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uY3VycmVudElucHV0U25hcHNob3QgPSBjdXJyZW50Tm9kZTtcbiAgICAgICAgICAgICAgICBjb25zdCBuZXdEYXRhID0gcXVldWVbaV0udXBkYXRlKGN1cnJlbnROb2RlLnZhbCgpKTtcbiAgICAgICAgICAgICAgICBpZiAobmV3RGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhKCd0cmFuc2FjdGlvbiBmYWlsZWQ6IERhdGEgcmV0dXJuZWQgJywgbmV3RGF0YSwgdHJhbnNhY3Rpb24ucGF0aCk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBuZXdEYXRhTm9kZSA9IG5vZGVGcm9tSlNPTihuZXdEYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgaGFzRXhwbGljaXRQcmlvcml0eSA9IHR5cGVvZiBuZXdEYXRhID09PSAnb2JqZWN0JyAmJlxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YSAhPSBudWxsICYmXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250YWlucyhuZXdEYXRhLCAnLnByaW9yaXR5Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaGFzRXhwbGljaXRQcmlvcml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gS2VlcCB0aGUgb2xkIHByaW9yaXR5IGlmIHRoZXJlIHdhc24ndCBhIHByaW9yaXR5IGV4cGxpY2l0bHkgc3BlY2lmaWVkLlxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3RGF0YU5vZGUgPSBuZXdEYXRhTm9kZS51cGRhdGVQcmlvcml0eShjdXJyZW50Tm9kZS5nZXRQcmlvcml0eSgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCBvbGRXcml0ZUlkID0gdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQ7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNlcnZlclZhbHVlcyA9IHJlcG9HZW5lcmF0ZVNlcnZlclZhbHVlcyhyZXBvKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmV3Tm9kZVJlc29sdmVkID0gcmVzb2x2ZURlZmVycmVkVmFsdWVTbmFwc2hvdChuZXdEYXRhTm9kZSwgY3VycmVudE5vZGUsIHNlcnZlclZhbHVlcyk7XG4gICAgICAgICAgICAgICAgICAgIHRyYW5zYWN0aW9uLmN1cnJlbnRPdXRwdXRTbmFwc2hvdFJhdyA9IG5ld0RhdGFOb2RlO1xuICAgICAgICAgICAgICAgICAgICB0cmFuc2FjdGlvbi5jdXJyZW50T3V0cHV0U25hcHNob3RSZXNvbHZlZCA9IG5ld05vZGVSZXNvbHZlZDtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNhY3Rpb24uY3VycmVudFdyaXRlSWQgPSByZXBvR2V0TmV4dFdyaXRlSWQocmVwbyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIE11dGF0ZXMgc2V0c1RvSWdub3JlIGluIHBsYWNlXG4gICAgICAgICAgICAgICAgICAgIHNldHNUb0lnbm9yZS5zcGxpY2Uoc2V0c1RvSWdub3JlLmluZGV4T2Yob2xkV3JpdGVJZCksIDEpO1xuICAgICAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQXBwbHlVc2VyT3ZlcndyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCB0cmFuc2FjdGlvbi5wYXRoLCBuZXdOb2RlUmVzb2x2ZWQsIHRyYW5zYWN0aW9uLmN1cnJlbnRXcml0ZUlkLCB0cmFuc2FjdGlvbi5hcHBseUxvY2FsbHkpKTtcbiAgICAgICAgICAgICAgICAgICAgZXZlbnRzID0gZXZlbnRzLmNvbmNhdChzeW5jVHJlZUFja1VzZXJXcml0ZShyZXBvLnNlcnZlclN5bmNUcmVlXywgb2xkV3JpdGVJZCwgdHJ1ZSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgYWJvcnRUcmFuc2FjdGlvbiA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGFib3J0UmVhc29uID0gJ25vZGF0YSc7XG4gICAgICAgICAgICAgICAgICAgIGV2ZW50cyA9IGV2ZW50cy5jb25jYXQoc3luY1RyZWVBY2tVc2VyV3JpdGUocmVwby5zZXJ2ZXJTeW5jVHJlZV8sIHRyYW5zYWN0aW9uLmN1cnJlbnRXcml0ZUlkLCB0cnVlKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGV2ZW50UXVldWVSYWlzZUV2ZW50c0ZvckNoYW5nZWRQYXRoKHJlcG8uZXZlbnRRdWV1ZV8sIHBhdGgsIGV2ZW50cyk7XG4gICAgICAgIGV2ZW50cyA9IFtdO1xuICAgICAgICBpZiAoYWJvcnRUcmFuc2FjdGlvbikge1xuICAgICAgICAgICAgLy8gQWJvcnQuXG4gICAgICAgICAgICBxdWV1ZVtpXS5zdGF0dXMgPSAyIC8qIFRyYW5zYWN0aW9uU3RhdHVzLkNPTVBMRVRFRCAqLztcbiAgICAgICAgICAgIC8vIFJlbW92aW5nIGEgbGlzdGVuZXIgY2FuIHRyaWdnZXIgcHJ1bmluZyB3aGljaCBjYW4gbXVjayB3aXRoXG4gICAgICAgICAgICAvLyBtZXJnZWREYXRhL3Zpc2libGVEYXRhIChhcyBpdCBwcnVuZXMgZGF0YSkuIFNvIGRlZmVyIHRoZSB1bndhdGNoZXJcbiAgICAgICAgICAgIC8vIHVudGlsIHdlJ3JlIGRvbmUuXG4gICAgICAgICAgICAoZnVuY3Rpb24gKHVud2F0Y2hlcikge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQodW53YXRjaGVyLCBNYXRoLmZsb29yKDApKTtcbiAgICAgICAgICAgIH0pKHF1ZXVlW2ldLnVud2F0Y2hlcik7XG4gICAgICAgICAgICBpZiAocXVldWVbaV0ub25Db21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIGlmIChhYm9ydFJlYXNvbiA9PT0gJ25vZGF0YScpIHtcbiAgICAgICAgICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2goKCkgPT4gcXVldWVbaV0ub25Db21wbGV0ZShudWxsLCBmYWxzZSwgcXVldWVbaV0uY3VycmVudElucHV0U25hcHNob3QpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5wdXNoKCgpID0+IHF1ZXVlW2ldLm9uQ29tcGxldGUobmV3IEVycm9yKGFib3J0UmVhc29uKSwgZmFsc2UsIG51bGwpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgLy8gQ2xlYW4gdXAgY29tcGxldGVkIHRyYW5zYWN0aW9ucy5cbiAgICByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgcmVwby50cmFuc2FjdGlvblF1ZXVlVHJlZV8pO1xuICAgIC8vIE5vdyBmaXJlIGNhbGxiYWNrcywgbm93IHRoYXQgd2UncmUgaW4gYSBnb29kLCBrbm93biBzdGF0ZS5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNhbGxiYWNrcy5sZW5ndGg7IGkrKykge1xuICAgICAgICBleGNlcHRpb25HdWFyZChjYWxsYmFja3NbaV0pO1xuICAgIH1cbiAgICAvLyBUcnkgdG8gc2VuZCB0aGUgdHJhbnNhY3Rpb24gcmVzdWx0IHRvIHRoZSBzZXJ2ZXIuXG4gICAgcmVwb1NlbmRSZWFkeVRyYW5zYWN0aW9ucyhyZXBvLCByZXBvLnRyYW5zYWN0aW9uUXVldWVUcmVlXyk7XG59XG4vKipcbiAqIFJldHVybnMgdGhlIHJvb3Rtb3N0IGFuY2VzdG9yIG5vZGUgb2YgdGhlIHNwZWNpZmllZCBwYXRoIHRoYXQgaGFzIGEgcGVuZGluZ1xuICogdHJhbnNhY3Rpb24gb24gaXQsIG9yIGp1c3QgcmV0dXJucyB0aGUgbm9kZSBmb3IgdGhlIGdpdmVuIHBhdGggaWYgdGhlcmUgYXJlXG4gKiBubyBwZW5kaW5nIHRyYW5zYWN0aW9ucyBvbiBhbnkgYW5jZXN0b3IuXG4gKlxuICogQHBhcmFtIHBhdGggLSBUaGUgbG9jYXRpb24gdG8gc3RhcnQgYXQuXG4gKiBAcmV0dXJucyBUaGUgcm9vdG1vc3Qgbm9kZSB3aXRoIGEgdHJhbnNhY3Rpb24uXG4gKi9cbmZ1bmN0aW9uIHJlcG9HZXRBbmNlc3RvclRyYW5zYWN0aW9uTm9kZShyZXBvLCBwYXRoKSB7XG4gICAgbGV0IGZyb250O1xuICAgIC8vIFN0YXJ0IGF0IHRoZSByb290IGFuZCB3YWxrIGRlZXBlciBpbnRvIHRoZSB0cmVlIHRvd2FyZHMgcGF0aCB1bnRpbCB3ZVxuICAgIC8vIGZpbmQgYSBub2RlIHdpdGggcGVuZGluZyB0cmFuc2FjdGlvbnMuXG4gICAgbGV0IHRyYW5zYWN0aW9uTm9kZSA9IHJlcG8udHJhbnNhY3Rpb25RdWV1ZVRyZWVfO1xuICAgIGZyb250ID0gcGF0aEdldEZyb250KHBhdGgpO1xuICAgIHdoaWxlIChmcm9udCAhPT0gbnVsbCAmJiB0cmVlR2V0VmFsdWUodHJhbnNhY3Rpb25Ob2RlKSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRyYW5zYWN0aW9uTm9kZSA9IHRyZWVTdWJUcmVlKHRyYW5zYWN0aW9uTm9kZSwgZnJvbnQpO1xuICAgICAgICBwYXRoID0gcGF0aFBvcEZyb250KHBhdGgpO1xuICAgICAgICBmcm9udCA9IHBhdGhHZXRGcm9udChwYXRoKTtcbiAgICB9XG4gICAgcmV0dXJuIHRyYW5zYWN0aW9uTm9kZTtcbn1cbi8qKlxuICogQnVpbGRzIHRoZSBxdWV1ZSBvZiBhbGwgdHJhbnNhY3Rpb25zIGF0IG9yIGJlbG93IHRoZSBzcGVjaWZpZWRcbiAqIHRyYW5zYWN0aW9uTm9kZS5cbiAqXG4gKiBAcGFyYW0gdHJhbnNhY3Rpb25Ob2RlXG4gKiBAcmV0dXJucyBUaGUgZ2VuZXJhdGVkIHF1ZXVlLlxuICovXG5mdW5jdGlvbiByZXBvQnVpbGRUcmFuc2FjdGlvblF1ZXVlKHJlcG8sIHRyYW5zYWN0aW9uTm9kZSkge1xuICAgIC8vIFdhbGsgYW55IGNoaWxkIHRyYW5zYWN0aW9uIHF1ZXVlcyBhbmQgYWdncmVnYXRlIHRoZW0gaW50byBhIHNpbmdsZSBxdWV1ZS5cbiAgICBjb25zdCB0cmFuc2FjdGlvblF1ZXVlID0gW107XG4gICAgcmVwb0FnZ3JlZ2F0ZVRyYW5zYWN0aW9uUXVldWVzRm9yTm9kZShyZXBvLCB0cmFuc2FjdGlvbk5vZGUsIHRyYW5zYWN0aW9uUXVldWUpO1xuICAgIC8vIFNvcnQgdGhlbSBieSB0aGUgb3JkZXIgdGhlIHRyYW5zYWN0aW9ucyB3ZXJlIGNyZWF0ZWQuXG4gICAgdHJhbnNhY3Rpb25RdWV1ZS5zb3J0KChhLCBiKSA9PiBhLm9yZGVyIC0gYi5vcmRlcik7XG4gICAgcmV0dXJuIHRyYW5zYWN0aW9uUXVldWU7XG59XG5mdW5jdGlvbiByZXBvQWdncmVnYXRlVHJhbnNhY3Rpb25RdWV1ZXNGb3JOb2RlKHJlcG8sIG5vZGUsIHF1ZXVlKSB7XG4gICAgY29uc3Qgbm9kZVF1ZXVlID0gdHJlZUdldFZhbHVlKG5vZGUpO1xuICAgIGlmIChub2RlUXVldWUpIHtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2RlUXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHF1ZXVlLnB1c2gobm9kZVF1ZXVlW2ldKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICB0cmVlRm9yRWFjaENoaWxkKG5vZGUsIGNoaWxkID0+IHtcbiAgICAgICAgcmVwb0FnZ3JlZ2F0ZVRyYW5zYWN0aW9uUXVldWVzRm9yTm9kZShyZXBvLCBjaGlsZCwgcXVldWUpO1xuICAgIH0pO1xufVxuLyoqXG4gKiBSZW1vdmUgQ09NUExFVEVEIHRyYW5zYWN0aW9ucyBhdCBvciBiZWxvdyB0aGlzIG5vZGUgaW4gdGhlIHRyYW5zYWN0aW9uUXVldWVUcmVlXy5cbiAqL1xuZnVuY3Rpb24gcmVwb1BydW5lQ29tcGxldGVkVHJhbnNhY3Rpb25zQmVsb3dOb2RlKHJlcG8sIG5vZGUpIHtcbiAgICBjb25zdCBxdWV1ZSA9IHRyZWVHZXRWYWx1ZShub2RlKTtcbiAgICBpZiAocXVldWUpIHtcbiAgICAgICAgbGV0IHRvID0gMDtcbiAgICAgICAgZm9yIChsZXQgZnJvbSA9IDA7IGZyb20gPCBxdWV1ZS5sZW5ndGg7IGZyb20rKykge1xuICAgICAgICAgICAgaWYgKHF1ZXVlW2Zyb21dLnN0YXR1cyAhPT0gMiAvKiBUcmFuc2FjdGlvblN0YXR1cy5DT01QTEVURUQgKi8pIHtcbiAgICAgICAgICAgICAgICBxdWV1ZVt0b10gPSBxdWV1ZVtmcm9tXTtcbiAgICAgICAgICAgICAgICB0bysrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHF1ZXVlLmxlbmd0aCA9IHRvO1xuICAgICAgICB0cmVlU2V0VmFsdWUobm9kZSwgcXVldWUubGVuZ3RoID4gMCA/IHF1ZXVlIDogdW5kZWZpbmVkKTtcbiAgICB9XG4gICAgdHJlZUZvckVhY2hDaGlsZChub2RlLCBjaGlsZE5vZGUgPT4ge1xuICAgICAgICByZXBvUHJ1bmVDb21wbGV0ZWRUcmFuc2FjdGlvbnNCZWxvd05vZGUocmVwbywgY2hpbGROb2RlKTtcbiAgICB9KTtcbn1cbi8qKlxuICogQWJvcnRzIGFsbCB0cmFuc2FjdGlvbnMgb24gYW5jZXN0b3JzIG9yIGRlc2NlbmRhbnRzIG9mIHRoZSBzcGVjaWZpZWQgcGF0aC5cbiAqIENhbGxlZCB3aGVuIGRvaW5nIGEgc2V0KCkgb3IgdXBkYXRlKCkgc2luY2Ugd2UgY29uc2lkZXIgdGhlbSBpbmNvbXBhdGlibGVcbiAqIHdpdGggdHJhbnNhY3Rpb25zLlxuICpcbiAqIEBwYXJhbSBwYXRoIC0gUGF0aCBmb3Igd2hpY2ggd2Ugd2FudCB0byBhYm9ydCByZWxhdGVkIHRyYW5zYWN0aW9ucy5cbiAqL1xuZnVuY3Rpb24gcmVwb0Fib3J0VHJhbnNhY3Rpb25zKHJlcG8sIHBhdGgpIHtcbiAgICBjb25zdCBhZmZlY3RlZFBhdGggPSB0cmVlR2V0UGF0aChyZXBvR2V0QW5jZXN0b3JUcmFuc2FjdGlvbk5vZGUocmVwbywgcGF0aCkpO1xuICAgIGNvbnN0IHRyYW5zYWN0aW9uTm9kZSA9IHRyZWVTdWJUcmVlKHJlcG8udHJhbnNhY3Rpb25RdWV1ZVRyZWVfLCBwYXRoKTtcbiAgICB0cmVlRm9yRWFjaEFuY2VzdG9yKHRyYW5zYWN0aW9uTm9kZSwgKG5vZGUpID0+IHtcbiAgICAgICAgcmVwb0Fib3J0VHJhbnNhY3Rpb25zT25Ob2RlKHJlcG8sIG5vZGUpO1xuICAgIH0pO1xuICAgIHJlcG9BYm9ydFRyYW5zYWN0aW9uc09uTm9kZShyZXBvLCB0cmFuc2FjdGlvbk5vZGUpO1xuICAgIHRyZWVGb3JFYWNoRGVzY2VuZGFudCh0cmFuc2FjdGlvbk5vZGUsIChub2RlKSA9PiB7XG4gICAgICAgIHJlcG9BYm9ydFRyYW5zYWN0aW9uc09uTm9kZShyZXBvLCBub2RlKTtcbiAgICB9KTtcbiAgICByZXR1cm4gYWZmZWN0ZWRQYXRoO1xufVxuLyoqXG4gKiBBYm9ydCB0cmFuc2FjdGlvbnMgc3RvcmVkIGluIHRoaXMgdHJhbnNhY3Rpb24gcXVldWUgbm9kZS5cbiAqXG4gKiBAcGFyYW0gbm9kZSAtIE5vZGUgdG8gYWJvcnQgdHJhbnNhY3Rpb25zIGZvci5cbiAqL1xuZnVuY3Rpb24gcmVwb0Fib3J0VHJhbnNhY3Rpb25zT25Ob2RlKHJlcG8sIG5vZGUpIHtcbiAgICBjb25zdCBxdWV1ZSA9IHRyZWVHZXRWYWx1ZShub2RlKTtcbiAgICBpZiAocXVldWUpIHtcbiAgICAgICAgLy8gUXVldWUgdXAgdGhlIGNhbGxiYWNrcyBhbmQgZmlyZSB0aGVtIGFmdGVyIGNsZWFuaW5nIHVwIGFsbCBvZiBvdXJcbiAgICAgICAgLy8gdHJhbnNhY3Rpb24gc3RhdGUsIHNpbmNlIHRoZSBjYWxsYmFjayBjb3VsZCB0cmlnZ2VyIG1vcmUgdHJhbnNhY3Rpb25zXG4gICAgICAgIC8vIG9yIHNldHMuXG4gICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9IFtdO1xuICAgICAgICAvLyBHbyB0aHJvdWdoIHF1ZXVlLiAgQW55IGFscmVhZHktc2VudCB0cmFuc2FjdGlvbnMgbXVzdCBiZSBtYXJrZWQgZm9yXG4gICAgICAgIC8vIGFib3J0LCB3aGlsZSB0aGUgdW5zZW50IG9uZXMgY2FuIGJlIGltbWVkaWF0ZWx5IGFib3J0ZWQgYW5kIHJlbW92ZWQuXG4gICAgICAgIGxldCBldmVudHMgPSBbXTtcbiAgICAgICAgbGV0IGxhc3RTZW50ID0gLTE7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgcXVldWUubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChxdWV1ZVtpXS5zdGF0dXMgPT09IDMgLyogVHJhbnNhY3Rpb25TdGF0dXMuU0VOVF9ORUVEU19BQk9SVCAqLykgO1xuICAgICAgICAgICAgZWxzZSBpZiAocXVldWVbaV0uc3RhdHVzID09PSAxIC8qIFRyYW5zYWN0aW9uU3RhdHVzLlNFTlQgKi8pIHtcbiAgICAgICAgICAgICAgICBhc3NlcnQobGFzdFNlbnQgPT09IGkgLSAxLCAnQWxsIFNFTlQgaXRlbXMgc2hvdWxkIGJlIGF0IGJlZ2lubmluZyBvZiBxdWV1ZS4nKTtcbiAgICAgICAgICAgICAgICBsYXN0U2VudCA9IGk7XG4gICAgICAgICAgICAgICAgLy8gTWFyayB0cmFuc2FjdGlvbiBmb3IgYWJvcnQgd2hlbiBpdCBjb21lcyBiYWNrLlxuICAgICAgICAgICAgICAgIHF1ZXVlW2ldLnN0YXR1cyA9IDMgLyogVHJhbnNhY3Rpb25TdGF0dXMuU0VOVF9ORUVEU19BQk9SVCAqLztcbiAgICAgICAgICAgICAgICBxdWV1ZVtpXS5hYm9ydFJlYXNvbiA9ICdzZXQnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgYXNzZXJ0KHF1ZXVlW2ldLnN0YXR1cyA9PT0gMCAvKiBUcmFuc2FjdGlvblN0YXR1cy5SVU4gKi8sICdVbmV4cGVjdGVkIHRyYW5zYWN0aW9uIHN0YXR1cyBpbiBhYm9ydCcpO1xuICAgICAgICAgICAgICAgIC8vIFdlIGNhbiBhYm9ydCBpdCBpbW1lZGlhdGVseS5cbiAgICAgICAgICAgICAgICBxdWV1ZVtpXS51bndhdGNoZXIoKTtcbiAgICAgICAgICAgICAgICBldmVudHMgPSBldmVudHMuY29uY2F0KHN5bmNUcmVlQWNrVXNlcldyaXRlKHJlcG8uc2VydmVyU3luY1RyZWVfLCBxdWV1ZVtpXS5jdXJyZW50V3JpdGVJZCwgdHJ1ZSkpO1xuICAgICAgICAgICAgICAgIGlmIChxdWV1ZVtpXS5vbkNvbXBsZXRlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhbGxiYWNrcy5wdXNoKHF1ZXVlW2ldLm9uQ29tcGxldGUuYmluZChudWxsLCBuZXcgRXJyb3IoJ3NldCcpLCBmYWxzZSwgbnVsbCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAobGFzdFNlbnQgPT09IC0xKSB7XG4gICAgICAgICAgICAvLyBXZSdyZSBub3Qgd2FpdGluZyBmb3IgYW55IHNlbnQgdHJhbnNhY3Rpb25zLiAgV2UgY2FuIGNsZWFyIHRoZSBxdWV1ZS5cbiAgICAgICAgICAgIHRyZWVTZXRWYWx1ZShub2RlLCB1bmRlZmluZWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSB0cmFuc2FjdGlvbnMgd2UgYWJvcnRlZC5cbiAgICAgICAgICAgIHF1ZXVlLmxlbmd0aCA9IGxhc3RTZW50ICsgMTtcbiAgICAgICAgfVxuICAgICAgICAvLyBOb3cgZmlyZSB0aGUgY2FsbGJhY2tzLlxuICAgICAgICBldmVudFF1ZXVlUmFpc2VFdmVudHNGb3JDaGFuZ2VkUGF0aChyZXBvLmV2ZW50UXVldWVfLCB0cmVlR2V0UGF0aChub2RlKSwgZXZlbnRzKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjYWxsYmFja3MubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGV4Y2VwdGlvbkd1YXJkKGNhbGxiYWNrc1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5mdW5jdGlvbiBkZWNvZGVQYXRoKHBhdGhTdHJpbmcpIHtcbiAgICBsZXQgcGF0aFN0cmluZ0RlY29kZWQgPSAnJztcbiAgICBjb25zdCBwaWVjZXMgPSBwYXRoU3RyaW5nLnNwbGl0KCcvJyk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwaWVjZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKHBpZWNlc1tpXS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBsZXQgcGllY2UgPSBwaWVjZXNbaV07XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIHBpZWNlID0gZGVjb2RlVVJJQ29tcG9uZW50KHBpZWNlLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7IH1cbiAgICAgICAgICAgIHBhdGhTdHJpbmdEZWNvZGVkICs9ICcvJyArIHBpZWNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBwYXRoU3RyaW5nRGVjb2RlZDtcbn1cbi8qKlxuICogQHJldHVybnMga2V5IHZhbHVlIGhhc2hcbiAqL1xuZnVuY3Rpb24gZGVjb2RlUXVlcnkocXVlcnlTdHJpbmcpIHtcbiAgICBjb25zdCByZXN1bHRzID0ge307XG4gICAgaWYgKHF1ZXJ5U3RyaW5nLmNoYXJBdCgwKSA9PT0gJz8nKSB7XG4gICAgICAgIHF1ZXJ5U3RyaW5nID0gcXVlcnlTdHJpbmcuc3Vic3RyaW5nKDEpO1xuICAgIH1cbiAgICBmb3IgKGNvbnN0IHNlZ21lbnQgb2YgcXVlcnlTdHJpbmcuc3BsaXQoJyYnKSkge1xuICAgICAgICBpZiAoc2VnbWVudC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGt2ID0gc2VnbWVudC5zcGxpdCgnPScpO1xuICAgICAgICBpZiAoa3YubGVuZ3RoID09PSAyKSB7XG4gICAgICAgICAgICByZXN1bHRzW2RlY29kZVVSSUNvbXBvbmVudChrdlswXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KGt2WzFdKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdhcm4oYEludmFsaWQgcXVlcnkgc2VnbWVudCAnJHtzZWdtZW50fScgaW4gcXVlcnkgJyR7cXVlcnlTdHJpbmd9J2ApO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRzO1xufVxuY29uc3QgcGFyc2VSZXBvSW5mbyA9IGZ1bmN0aW9uIChkYXRhVVJMLCBub2RlQWRtaW4pIHtcbiAgICBjb25zdCBwYXJzZWRVcmwgPSBwYXJzZURhdGFiYXNlVVJMKGRhdGFVUkwpLCBuYW1lc3BhY2UgPSBwYXJzZWRVcmwubmFtZXNwYWNlO1xuICAgIGlmIChwYXJzZWRVcmwuZG9tYWluID09PSAnZmlyZWJhc2UuY29tJykge1xuICAgICAgICBmYXRhbChwYXJzZWRVcmwuaG9zdCArXG4gICAgICAgICAgICAnIGlzIG5vIGxvbmdlciBzdXBwb3J0ZWQuICcgK1xuICAgICAgICAgICAgJ1BsZWFzZSB1c2UgPFlPVVIgRklSRUJBU0U+LmZpcmViYXNlaW8uY29tIGluc3RlYWQnKTtcbiAgICB9XG4gICAgLy8gQ2F0Y2ggY29tbW9uIGVycm9yIG9mIHVuaW5pdGlhbGl6ZWQgbmFtZXNwYWNlIHZhbHVlLlxuICAgIGlmICgoIW5hbWVzcGFjZSB8fCBuYW1lc3BhY2UgPT09ICd1bmRlZmluZWQnKSAmJlxuICAgICAgICBwYXJzZWRVcmwuZG9tYWluICE9PSAnbG9jYWxob3N0Jykge1xuICAgICAgICBmYXRhbCgnQ2Fubm90IHBhcnNlIEZpcmViYXNlIHVybC4gUGxlYXNlIHVzZSBodHRwczovLzxZT1VSIEZJUkVCQVNFPi5maXJlYmFzZWlvLmNvbScpO1xuICAgIH1cbiAgICBpZiAoIXBhcnNlZFVybC5zZWN1cmUpIHtcbiAgICAgICAgd2FybklmUGFnZUlzU2VjdXJlKCk7XG4gICAgfVxuICAgIGNvbnN0IHdlYlNvY2tldE9ubHkgPSBwYXJzZWRVcmwuc2NoZW1lID09PSAnd3MnIHx8IHBhcnNlZFVybC5zY2hlbWUgPT09ICd3c3MnO1xuICAgIHJldHVybiB7XG4gICAgICAgIHJlcG9JbmZvOiBuZXcgUmVwb0luZm8ocGFyc2VkVXJsLmhvc3QsIHBhcnNlZFVybC5zZWN1cmUsIG5hbWVzcGFjZSwgd2ViU29ja2V0T25seSwgbm9kZUFkbWluLCBcbiAgICAgICAgLypwZXJzaXN0ZW5jZUtleT0qLyAnJywgXG4gICAgICAgIC8qaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXM9Ki8gbmFtZXNwYWNlICE9PSBwYXJzZWRVcmwuc3ViZG9tYWluKSxcbiAgICAgICAgcGF0aDogbmV3IFBhdGgocGFyc2VkVXJsLnBhdGhTdHJpbmcpXG4gICAgfTtcbn07XG5jb25zdCBwYXJzZURhdGFiYXNlVVJMID0gZnVuY3Rpb24gKGRhdGFVUkwpIHtcbiAgICAvLyBEZWZhdWx0IHRvIGVtcHR5IHN0cmluZ3MgaW4gdGhlIGV2ZW50IG9mIGEgbWFsZm9ybWVkIHN0cmluZy5cbiAgICBsZXQgaG9zdCA9ICcnLCBkb21haW4gPSAnJywgc3ViZG9tYWluID0gJycsIHBhdGhTdHJpbmcgPSAnJywgbmFtZXNwYWNlID0gJyc7XG4gICAgLy8gQWx3YXlzIGRlZmF1bHQgdG8gU1NMLCB1bmxlc3Mgb3RoZXJ3aXNlIHNwZWNpZmllZC5cbiAgICBsZXQgc2VjdXJlID0gdHJ1ZSwgc2NoZW1lID0gJ2h0dHBzJywgcG9ydCA9IDQ0MztcbiAgICAvLyBEb24ndCBkbyBhbnkgdmFsaWRhdGlvbiBoZXJlLiBUaGUgY2FsbGVyIGlzIHJlc3BvbnNpYmxlIGZvciB2YWxpZGF0aW5nIHRoZSByZXN1bHQgb2YgcGFyc2luZy5cbiAgICBpZiAodHlwZW9mIGRhdGFVUkwgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgIC8vIFBhcnNlIHNjaGVtZS5cbiAgICAgICAgbGV0IGNvbG9uSW5kID0gZGF0YVVSTC5pbmRleE9mKCcvLycpO1xuICAgICAgICBpZiAoY29sb25JbmQgPj0gMCkge1xuICAgICAgICAgICAgc2NoZW1lID0gZGF0YVVSTC5zdWJzdHJpbmcoMCwgY29sb25JbmQgLSAxKTtcbiAgICAgICAgICAgIGRhdGFVUkwgPSBkYXRhVVJMLnN1YnN0cmluZyhjb2xvbkluZCArIDIpO1xuICAgICAgICB9XG4gICAgICAgIC8vIFBhcnNlIGhvc3QsIHBhdGgsIGFuZCBxdWVyeSBzdHJpbmcuXG4gICAgICAgIGxldCBzbGFzaEluZCA9IGRhdGFVUkwuaW5kZXhPZignLycpO1xuICAgICAgICBpZiAoc2xhc2hJbmQgPT09IC0xKSB7XG4gICAgICAgICAgICBzbGFzaEluZCA9IGRhdGFVUkwubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGxldCBxdWVzdGlvbk1hcmtJbmQgPSBkYXRhVVJMLmluZGV4T2YoJz8nKTtcbiAgICAgICAgaWYgKHF1ZXN0aW9uTWFya0luZCA9PT0gLTEpIHtcbiAgICAgICAgICAgIHF1ZXN0aW9uTWFya0luZCA9IGRhdGFVUkwubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGhvc3QgPSBkYXRhVVJMLnN1YnN0cmluZygwLCBNYXRoLm1pbihzbGFzaEluZCwgcXVlc3Rpb25NYXJrSW5kKSk7XG4gICAgICAgIGlmIChzbGFzaEluZCA8IHF1ZXN0aW9uTWFya0luZCkge1xuICAgICAgICAgICAgLy8gRm9yIHBhdGhTdHJpbmcsIHF1ZXN0aW9uTWFya0luZCB3aWxsIGFsd2F5cyBjb21lIGFmdGVyIHNsYXNoSW5kXG4gICAgICAgICAgICBwYXRoU3RyaW5nID0gZGVjb2RlUGF0aChkYXRhVVJMLnN1YnN0cmluZyhzbGFzaEluZCwgcXVlc3Rpb25NYXJrSW5kKSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSBkZWNvZGVRdWVyeShkYXRhVVJMLnN1YnN0cmluZyhNYXRoLm1pbihkYXRhVVJMLmxlbmd0aCwgcXVlc3Rpb25NYXJrSW5kKSkpO1xuICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgcG9ydCwgdXNlIHNjaGVtZSBmb3IgZGV0ZXJtaW5pbmcgaWYgaXQncyBzZWN1cmUuXG4gICAgICAgIGNvbG9uSW5kID0gaG9zdC5pbmRleE9mKCc6Jyk7XG4gICAgICAgIGlmIChjb2xvbkluZCA+PSAwKSB7XG4gICAgICAgICAgICBzZWN1cmUgPSBzY2hlbWUgPT09ICdodHRwcycgfHwgc2NoZW1lID09PSAnd3NzJztcbiAgICAgICAgICAgIHBvcnQgPSBwYXJzZUludChob3N0LnN1YnN0cmluZyhjb2xvbkluZCArIDEpLCAxMCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb2xvbkluZCA9IGhvc3QubGVuZ3RoO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGhvc3RXaXRob3V0UG9ydCA9IGhvc3Quc2xpY2UoMCwgY29sb25JbmQpO1xuICAgICAgICBpZiAoaG9zdFdpdGhvdXRQb3J0LnRvTG93ZXJDYXNlKCkgPT09ICdsb2NhbGhvc3QnKSB7XG4gICAgICAgICAgICBkb21haW4gPSAnbG9jYWxob3N0JztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChob3N0V2l0aG91dFBvcnQuc3BsaXQoJy4nKS5sZW5ndGggPD0gMikge1xuICAgICAgICAgICAgZG9tYWluID0gaG9zdFdpdGhvdXRQb3J0O1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gSW50ZXJwcmV0IHRoZSBzdWJkb21haW4gb2YgYSAzIG9yIG1vcmUgY29tcG9uZW50IFVSTCBhcyB0aGUgbmFtZXNwYWNlIG5hbWUuXG4gICAgICAgICAgICBjb25zdCBkb3RJbmQgPSBob3N0LmluZGV4T2YoJy4nKTtcbiAgICAgICAgICAgIHN1YmRvbWFpbiA9IGhvc3Quc3Vic3RyaW5nKDAsIGRvdEluZCkudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgICAgIGRvbWFpbiA9IGhvc3Quc3Vic3RyaW5nKGRvdEluZCArIDEpO1xuICAgICAgICAgICAgLy8gTm9ybWFsaXplIG5hbWVzcGFjZXMgdG8gbG93ZXJjYXNlIHRvIHNoYXJlIHN0b3JhZ2UgLyBjb25uZWN0aW9uLlxuICAgICAgICAgICAgbmFtZXNwYWNlID0gc3ViZG9tYWluO1xuICAgICAgICB9XG4gICAgICAgIC8vIEFsd2F5cyB0cmVhdCB0aGUgdmFsdWUgb2YgdGhlIGBuc2AgYXMgdGhlIG5hbWVzcGFjZSBuYW1lIGlmIGl0IGlzIHByZXNlbnQuXG4gICAgICAgIGlmICgnbnMnIGluIHF1ZXJ5UGFyYW1zKSB7XG4gICAgICAgICAgICBuYW1lc3BhY2UgPSBxdWVyeVBhcmFtc1snbnMnXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBob3N0LFxuICAgICAgICBwb3J0LFxuICAgICAgICBkb21haW4sXG4gICAgICAgIHN1YmRvbWFpbixcbiAgICAgICAgc2VjdXJlLFxuICAgICAgICBzY2hlbWUsXG4gICAgICAgIHBhdGhTdHJpbmcsXG4gICAgICAgIG5hbWVzcGFjZVxuICAgIH07XG59O1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLy8gTW9kZWxlZCBhZnRlciBiYXNlNjQgd2ViLXNhZmUgY2hhcnMsIGJ1dCBvcmRlcmVkIGJ5IEFTQ0lJLlxuY29uc3QgUFVTSF9DSEFSUyA9ICctMDEyMzQ1Njc4OUFCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaX2FiY2RlZmdoaWprbG1ub3BxcnN0dXZ3eHl6Jztcbi8qKlxuICogRmFuY3kgSUQgZ2VuZXJhdG9yIHRoYXQgY3JlYXRlcyAyMC1jaGFyYWN0ZXIgc3RyaW5nIGlkZW50aWZpZXJzIHdpdGggdGhlXG4gKiBmb2xsb3dpbmcgcHJvcGVydGllczpcbiAqXG4gKiAxLiBUaGV5J3JlIGJhc2VkIG9uIHRpbWVzdGFtcCBzbyB0aGF0IHRoZXkgc29ydCAqYWZ0ZXIqIGFueSBleGlzdGluZyBpZHMuXG4gKiAyLiBUaGV5IGNvbnRhaW4gNzItYml0cyBvZiByYW5kb20gZGF0YSBhZnRlciB0aGUgdGltZXN0YW1wIHNvIHRoYXQgSURzIHdvbid0XG4gKiAgICBjb2xsaWRlIHdpdGggb3RoZXIgY2xpZW50cycgSURzLlxuICogMy4gVGhleSBzb3J0ICpsZXhpY29ncmFwaGljYWxseSogKHNvIHRoZSB0aW1lc3RhbXAgaXMgY29udmVydGVkIHRvIGNoYXJhY3RlcnNcbiAqICAgIHRoYXQgd2lsbCBzb3J0IHByb3Blcmx5KS5cbiAqIDQuIFRoZXkncmUgbW9ub3RvbmljYWxseSBpbmNyZWFzaW5nLiBFdmVuIGlmIHlvdSBnZW5lcmF0ZSBtb3JlIHRoYW4gb25lIGluXG4gKiAgICB0aGUgc2FtZSB0aW1lc3RhbXAsIHRoZSBsYXR0ZXIgb25lcyB3aWxsIHNvcnQgYWZ0ZXIgdGhlIGZvcm1lciBvbmVzLiBXZSBkb1xuICogICAgdGhpcyBieSB1c2luZyB0aGUgcHJldmlvdXMgcmFuZG9tIGJpdHMgYnV0IFwiaW5jcmVtZW50aW5nXCIgdGhlbSBieSAxIChvbmx5XG4gKiAgICBpbiB0aGUgY2FzZSBvZiBhIHRpbWVzdGFtcCBjb2xsaXNpb24pLlxuICovXG5jb25zdCBuZXh0UHVzaElkID0gKGZ1bmN0aW9uICgpIHtcbiAgICAvLyBUaW1lc3RhbXAgb2YgbGFzdCBwdXNoLCB1c2VkIHRvIHByZXZlbnQgbG9jYWwgY29sbGlzaW9ucyBpZiB5b3UgcHVzaCB0d2ljZVxuICAgIC8vIGluIG9uZSBtcy5cbiAgICBsZXQgbGFzdFB1c2hUaW1lID0gMDtcbiAgICAvLyBXZSBnZW5lcmF0ZSA3Mi1iaXRzIG9mIHJhbmRvbW5lc3Mgd2hpY2ggZ2V0IHR1cm5lZCBpbnRvIDEyIGNoYXJhY3RlcnMgYW5kXG4gICAgLy8gYXBwZW5kZWQgdG8gdGhlIHRpbWVzdGFtcCB0byBwcmV2ZW50IGNvbGxpc2lvbnMgd2l0aCBvdGhlciBjbGllbnRzLiBXZVxuICAgIC8vIHN0b3JlIHRoZSBsYXN0IGNoYXJhY3RlcnMgd2UgZ2VuZXJhdGVkIGJlY2F1c2UgaW4gdGhlIGV2ZW50IG9mIGEgY29sbGlzaW9uLFxuICAgIC8vIHdlJ2xsIHVzZSB0aG9zZSBzYW1lIGNoYXJhY3RlcnMgZXhjZXB0IFwiaW5jcmVtZW50ZWRcIiBieSBvbmUuXG4gICAgY29uc3QgbGFzdFJhbmRDaGFycyA9IFtdO1xuICAgIHJldHVybiBmdW5jdGlvbiAobm93KSB7XG4gICAgICAgIGNvbnN0IGR1cGxpY2F0ZVRpbWUgPSBub3cgPT09IGxhc3RQdXNoVGltZTtcbiAgICAgICAgbGFzdFB1c2hUaW1lID0gbm93O1xuICAgICAgICBsZXQgaTtcbiAgICAgICAgY29uc3QgdGltZVN0YW1wQ2hhcnMgPSBuZXcgQXJyYXkoOCk7XG4gICAgICAgIGZvciAoaSA9IDc7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICB0aW1lU3RhbXBDaGFyc1tpXSA9IFBVU0hfQ0hBUlMuY2hhckF0KG5vdyAlIDY0KTtcbiAgICAgICAgICAgIC8vIE5PVEU6IENhbid0IHVzZSA8PCBoZXJlIGJlY2F1c2UgamF2YXNjcmlwdCB3aWxsIGNvbnZlcnQgdG8gaW50IGFuZCBsb3NlXG4gICAgICAgICAgICAvLyB0aGUgdXBwZXIgYml0cy5cbiAgICAgICAgICAgIG5vdyA9IE1hdGguZmxvb3Iobm93IC8gNjQpO1xuICAgICAgICB9XG4gICAgICAgIGFzc2VydChub3cgPT09IDAsICdDYW5ub3QgcHVzaCBhdCB0aW1lID09IDAnKTtcbiAgICAgICAgbGV0IGlkID0gdGltZVN0YW1wQ2hhcnMuam9pbignJyk7XG4gICAgICAgIGlmICghZHVwbGljYXRlVGltZSkge1xuICAgICAgICAgICAgZm9yIChpID0gMDsgaSA8IDEyOyBpKyspIHtcbiAgICAgICAgICAgICAgICBsYXN0UmFuZENoYXJzW2ldID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNjQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgLy8gSWYgdGhlIHRpbWVzdGFtcCBoYXNuJ3QgY2hhbmdlZCBzaW5jZSBsYXN0IHB1c2gsIHVzZSB0aGUgc2FtZSByYW5kb21cbiAgICAgICAgICAgIC8vIG51bWJlciwgZXhjZXB0IGluY3JlbWVudGVkIGJ5IDEuXG4gICAgICAgICAgICBmb3IgKGkgPSAxMTsgaSA+PSAwICYmIGxhc3RSYW5kQ2hhcnNbaV0gPT09IDYzOyBpLS0pIHtcbiAgICAgICAgICAgICAgICBsYXN0UmFuZENoYXJzW2ldID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGxhc3RSYW5kQ2hhcnNbaV0rKztcbiAgICAgICAgfVxuICAgICAgICBmb3IgKGkgPSAwOyBpIDwgMTI7IGkrKykge1xuICAgICAgICAgICAgaWQgKz0gUFVTSF9DSEFSUy5jaGFyQXQobGFzdFJhbmRDaGFyc1tpXSk7XG4gICAgICAgIH1cbiAgICAgICAgYXNzZXJ0KGlkLmxlbmd0aCA9PT0gMjAsICduZXh0UHVzaElkOiBMZW5ndGggc2hvdWxkIGJlIDIwLicpO1xuICAgICAgICByZXR1cm4gaWQ7XG4gICAgfTtcbn0pKCk7XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEVuY2Fwc3VsYXRlcyB0aGUgZGF0YSBuZWVkZWQgdG8gcmFpc2UgYW4gZXZlbnRcbiAqL1xuY2xhc3MgRGF0YUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBAcGFyYW0gZXZlbnRUeXBlIC0gT25lIG9mOiB2YWx1ZSwgY2hpbGRfYWRkZWQsIGNoaWxkX2NoYW5nZWQsIGNoaWxkX21vdmVkLCBjaGlsZF9yZW1vdmVkXG4gICAgICogQHBhcmFtIGV2ZW50UmVnaXN0cmF0aW9uIC0gVGhlIGZ1bmN0aW9uIHRvIGNhbGwgdG8gd2l0aCB0aGUgZXZlbnQgZGF0YS4gVXNlciBwcm92aWRlZFxuICAgICAqIEBwYXJhbSBzbmFwc2hvdCAtIFRoZSBkYXRhIGJhY2tpbmcgdGhlIGV2ZW50XG4gICAgICogQHBhcmFtIHByZXZOYW1lIC0gT3B0aW9uYWwsIHRoZSBuYW1lIG9mIHRoZSBwcmV2aW91cyBjaGlsZCBmb3IgY2hpbGRfKiBldmVudHMuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoZXZlbnRUeXBlLCBldmVudFJlZ2lzdHJhdGlvbiwgc25hcHNob3QsIHByZXZOYW1lKSB7XG4gICAgICAgIHRoaXMuZXZlbnRUeXBlID0gZXZlbnRUeXBlO1xuICAgICAgICB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uID0gZXZlbnRSZWdpc3RyYXRpb247XG4gICAgICAgIHRoaXMuc25hcHNob3QgPSBzbmFwc2hvdDtcbiAgICAgICAgdGhpcy5wcmV2TmFtZSA9IHByZXZOYW1lO1xuICAgIH1cbiAgICBnZXRQYXRoKCkge1xuICAgICAgICBjb25zdCByZWYgPSB0aGlzLnNuYXBzaG90LnJlZjtcbiAgICAgICAgaWYgKHRoaXMuZXZlbnRUeXBlID09PSAndmFsdWUnKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVmLl9wYXRoO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHJlZi5wYXJlbnQuX3BhdGg7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0RXZlbnRUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ldmVudFR5cGU7XG4gICAgfVxuICAgIGdldEV2ZW50UnVubmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ldmVudFJlZ2lzdHJhdGlvbi5nZXRFdmVudFJ1bm5lcih0aGlzKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiAodGhpcy5nZXRQYXRoKCkudG9TdHJpbmcoKSArXG4gICAgICAgICAgICAnOicgK1xuICAgICAgICAgICAgdGhpcy5ldmVudFR5cGUgK1xuICAgICAgICAgICAgJzonICtcbiAgICAgICAgICAgIHN0cmluZ2lmeSh0aGlzLnNuYXBzaG90LmV4cG9ydFZhbCgpKSk7XG4gICAgfVxufVxuY2xhc3MgQ2FuY2VsRXZlbnQge1xuICAgIGNvbnN0cnVjdG9yKGV2ZW50UmVnaXN0cmF0aW9uLCBlcnJvciwgcGF0aCkge1xuICAgICAgICB0aGlzLmV2ZW50UmVnaXN0cmF0aW9uID0gZXZlbnRSZWdpc3RyYXRpb247XG4gICAgICAgIHRoaXMuZXJyb3IgPSBlcnJvcjtcbiAgICAgICAgdGhpcy5wYXRoID0gcGF0aDtcbiAgICB9XG4gICAgZ2V0UGF0aCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMucGF0aDtcbiAgICB9XG4gICAgZ2V0RXZlbnRUeXBlKCkge1xuICAgICAgICByZXR1cm4gJ2NhbmNlbCc7XG4gICAgfVxuICAgIGdldEV2ZW50UnVubmVyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ldmVudFJlZ2lzdHJhdGlvbi5nZXRFdmVudFJ1bm5lcih0aGlzKTtcbiAgICB9XG4gICAgdG9TdHJpbmcoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnBhdGgudG9TdHJpbmcoKSArICc6Y2FuY2VsJztcbiAgICB9XG59XG5cbi8qKlxuICogQGxpY2Vuc2VcbiAqIENvcHlyaWdodCAyMDE3IEdvb2dsZSBMTENcbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTIElTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG4vKipcbiAqIEEgd3JhcHBlciBjbGFzcyB0aGF0IGNvbnZlcnRzIGV2ZW50cyBmcm9tIHRoZSBkYXRhYmFzZUBleHAgU0RLIHRvIHRoZSBsZWdhY3lcbiAqIERhdGFiYXNlIFNESy4gRXZlbnRzIGFyZSBub3QgY29udmVydGVkIGRpcmVjdGx5IGFzIGV2ZW50IHJlZ2lzdHJhdGlvbiByZWxpZXNcbiAqIG9uIHJlZmVyZW5jZSBjb21wYXJpc29uIG9mIHRoZSBvcmlnaW5hbCB1c2VyIGNhbGxiYWNrIChzZWUgYG1hdGNoZXMoKWApIGFuZFxuICogcmVsaWVzIG9uIGVxdWFsaXR5IG9mIHRoZSBsZWdhY3kgU0RLJ3MgYGNvbnRleHRgIG9iamVjdC5cbiAqL1xuY2xhc3MgQ2FsbGJhY2tDb250ZXh0IHtcbiAgICBjb25zdHJ1Y3RvcihzbmFwc2hvdENhbGxiYWNrLCBjYW5jZWxDYWxsYmFjaykge1xuICAgICAgICB0aGlzLnNuYXBzaG90Q2FsbGJhY2sgPSBzbmFwc2hvdENhbGxiYWNrO1xuICAgICAgICB0aGlzLmNhbmNlbENhbGxiYWNrID0gY2FuY2VsQ2FsbGJhY2s7XG4gICAgfVxuICAgIG9uVmFsdWUoZXhwRGF0YVNuYXBzaG90LCBwcmV2aW91c0NoaWxkTmFtZSkge1xuICAgICAgICB0aGlzLnNuYXBzaG90Q2FsbGJhY2suY2FsbChudWxsLCBleHBEYXRhU25hcHNob3QsIHByZXZpb3VzQ2hpbGROYW1lKTtcbiAgICB9XG4gICAgb25DYW5jZWwoZXJyb3IpIHtcbiAgICAgICAgYXNzZXJ0KHRoaXMuaGFzQ2FuY2VsQ2FsbGJhY2ssICdSYWlzaW5nIGEgY2FuY2VsIGV2ZW50IG9uIGEgbGlzdGVuZXIgd2l0aCBubyBjYW5jZWwgY2FsbGJhY2snKTtcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FuY2VsQ2FsbGJhY2suY2FsbChudWxsLCBlcnJvcik7XG4gICAgfVxuICAgIGdldCBoYXNDYW5jZWxDYWxsYmFjaygpIHtcbiAgICAgICAgcmV0dXJuICEhdGhpcy5jYW5jZWxDYWxsYmFjaztcbiAgICB9XG4gICAgbWF0Y2hlcyhvdGhlcikge1xuICAgICAgICByZXR1cm4gKHRoaXMuc25hcHNob3RDYWxsYmFjayA9PT0gb3RoZXIuc25hcHNob3RDYWxsYmFjayB8fFxuICAgICAgICAgICAgKHRoaXMuc25hcHNob3RDYWxsYmFjay51c2VyQ2FsbGJhY2sgIT09IHVuZGVmaW5lZCAmJlxuICAgICAgICAgICAgICAgIHRoaXMuc25hcHNob3RDYWxsYmFjay51c2VyQ2FsbGJhY2sgPT09XG4gICAgICAgICAgICAgICAgICAgIG90aGVyLnNuYXBzaG90Q2FsbGJhY2sudXNlckNhbGxiYWNrICYmXG4gICAgICAgICAgICAgICAgdGhpcy5zbmFwc2hvdENhbGxiYWNrLmNvbnRleHQgPT09IG90aGVyLnNuYXBzaG90Q2FsbGJhY2suY29udGV4dCkpO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjEgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVGhlIGBvbkRpc2Nvbm5lY3RgIGNsYXNzIGFsbG93cyB5b3UgdG8gd3JpdGUgb3IgY2xlYXIgZGF0YSB3aGVuIHlvdXIgY2xpZW50XG4gKiBkaXNjb25uZWN0cyBmcm9tIHRoZSBEYXRhYmFzZSBzZXJ2ZXIuIFRoZXNlIHVwZGF0ZXMgb2NjdXIgd2hldGhlciB5b3VyXG4gKiBjbGllbnQgZGlzY29ubmVjdHMgY2xlYW5seSBvciBub3QsIHNvIHlvdSBjYW4gcmVseSBvbiB0aGVtIHRvIGNsZWFuIHVwIGRhdGFcbiAqIGV2ZW4gaWYgYSBjb25uZWN0aW9uIGlzIGRyb3BwZWQgb3IgYSBjbGllbnQgY3Jhc2hlcy5cbiAqXG4gKiBUaGUgYG9uRGlzY29ubmVjdGAgY2xhc3MgaXMgbW9zdCBjb21tb25seSB1c2VkIHRvIG1hbmFnZSBwcmVzZW5jZSBpblxuICogYXBwbGljYXRpb25zIHdoZXJlIGl0IGlzIHVzZWZ1bCB0byBkZXRlY3QgaG93IG1hbnkgY2xpZW50cyBhcmUgY29ubmVjdGVkIGFuZFxuICogd2hlbiBvdGhlciBjbGllbnRzIGRpc2Nvbm5lY3QuIFNlZVxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9vZmZsaW5lLWNhcGFiaWxpdGllcyB8IEVuYWJsaW5nIE9mZmxpbmUgQ2FwYWJpbGl0aWVzIGluIEphdmFTY3JpcHR9XG4gKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAqXG4gKiBUbyBhdm9pZCBwcm9ibGVtcyB3aGVuIGEgY29ubmVjdGlvbiBpcyBkcm9wcGVkIGJlZm9yZSB0aGUgcmVxdWVzdHMgY2FuIGJlXG4gKiB0cmFuc2ZlcnJlZCB0byB0aGUgRGF0YWJhc2Ugc2VydmVyLCB0aGVzZSBmdW5jdGlvbnMgc2hvdWxkIGJlIGNhbGxlZCBiZWZvcmVcbiAqIHdyaXRpbmcgYW55IGRhdGEuXG4gKlxuICogTm90ZSB0aGF0IGBvbkRpc2Nvbm5lY3RgIG9wZXJhdGlvbnMgYXJlIG9ubHkgdHJpZ2dlcmVkIG9uY2UuIElmIHlvdSB3YW50IGFuXG4gKiBvcGVyYXRpb24gdG8gb2NjdXIgZWFjaCB0aW1lIGEgZGlzY29ubmVjdCBvY2N1cnMsIHlvdSdsbCBuZWVkIHRvIHJlLWVzdGFibGlzaFxuICogdGhlIGBvbkRpc2Nvbm5lY3RgIG9wZXJhdGlvbnMgZWFjaCB0aW1lIHlvdSByZWNvbm5lY3QuXG4gKi9cbmNsYXNzIE9uRGlzY29ubmVjdCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihfcmVwbywgX3BhdGgpIHtcbiAgICAgICAgdGhpcy5fcmVwbyA9IF9yZXBvO1xuICAgICAgICB0aGlzLl9wYXRoID0gX3BhdGg7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbmNlbHMgYWxsIHByZXZpb3VzbHkgcXVldWVkIGBvbkRpc2Nvbm5lY3QoKWAgc2V0IG9yIHVwZGF0ZSBldmVudHMgZm9yIHRoaXNcbiAgICAgKiBsb2NhdGlvbiBhbmQgYWxsIGNoaWxkcmVuLlxuICAgICAqXG4gICAgICogSWYgYSB3cml0ZSBoYXMgYmVlbiBxdWV1ZWQgZm9yIHRoaXMgbG9jYXRpb24gdmlhIGEgYHNldCgpYCBvciBgdXBkYXRlKClgIGF0IGFcbiAgICAgKiBwYXJlbnQgbG9jYXRpb24sIHRoZSB3cml0ZSBhdCB0aGlzIGxvY2F0aW9uIHdpbGwgYmUgY2FuY2VsZWQsIHRob3VnaCB3cml0ZXNcbiAgICAgKiB0byBzaWJsaW5nIGxvY2F0aW9ucyB3aWxsIHN0aWxsIG9jY3VyLlxuICAgICAqXG4gICAgICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiBzeW5jaHJvbml6YXRpb24gdG8gdGhlIHNlcnZlciBpcyBjb21wbGV0ZS5cbiAgICAgKi9cbiAgICBjYW5jZWwoKSB7XG4gICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgICAgIHJlcG9PbkRpc2Nvbm5lY3RDYW5jZWwodGhpcy5fcmVwbywgdGhpcy5fcGF0aCwgZGVmZXJyZWQud3JhcENhbGxiYWNrKCgpID0+IHsgfSkpO1xuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRW5zdXJlcyB0aGUgZGF0YSBhdCB0aGlzIGxvY2F0aW9uIGlzIGRlbGV0ZWQgd2hlbiB0aGUgY2xpZW50IGlzIGRpc2Nvbm5lY3RlZFxuICAgICAqIChkdWUgdG8gY2xvc2luZyB0aGUgYnJvd3NlciwgbmF2aWdhdGluZyB0byBhIG5ldyBwYWdlLCBvciBuZXR3b3JrIGlzc3VlcykuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyBSZXNvbHZlcyB3aGVuIHN5bmNocm9uaXphdGlvbiB0byB0aGUgc2VydmVyIGlzIGNvbXBsZXRlLlxuICAgICAqL1xuICAgIHJlbW92ZSgpIHtcbiAgICAgICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ09uRGlzY29ubmVjdC5yZW1vdmUnLCB0aGlzLl9wYXRoKTtcbiAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTtcbiAgICAgICAgcmVwb09uRGlzY29ubmVjdFNldCh0aGlzLl9yZXBvLCB0aGlzLl9wYXRoLCBudWxsLCBkZWZlcnJlZC53cmFwQ2FsbGJhY2soKCkgPT4geyB9KSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBFbnN1cmVzIHRoZSBkYXRhIGF0IHRoaXMgbG9jYXRpb24gaXMgc2V0IHRvIHRoZSBzcGVjaWZpZWQgdmFsdWUgd2hlbiB0aGVcbiAgICAgKiBjbGllbnQgaXMgZGlzY29ubmVjdGVkIChkdWUgdG8gY2xvc2luZyB0aGUgYnJvd3NlciwgbmF2aWdhdGluZyB0byBhIG5ldyBwYWdlLFxuICAgICAqIG9yIG5ldHdvcmsgaXNzdWVzKS5cbiAgICAgKlxuICAgICAqIGBzZXQoKWAgaXMgZXNwZWNpYWxseSB1c2VmdWwgZm9yIGltcGxlbWVudGluZyBcInByZXNlbmNlXCIgc3lzdGVtcywgd2hlcmUgYVxuICAgICAqIHZhbHVlIHNob3VsZCBiZSBjaGFuZ2VkIG9yIGNsZWFyZWQgd2hlbiBhIHVzZXIgZGlzY29ubmVjdHMgc28gdGhhdCB0aGV5XG4gICAgICogYXBwZWFyIFwib2ZmbGluZVwiIHRvIG90aGVyIHVzZXJzLiBTZWVcbiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZGF0YWJhc2Uvd2ViL29mZmxpbmUtY2FwYWJpbGl0aWVzIHwgRW5hYmxpbmcgT2ZmbGluZSBDYXBhYmlsaXRpZXMgaW4gSmF2YVNjcmlwdH1cbiAgICAgKiBmb3IgbW9yZSBpbmZvcm1hdGlvbi5cbiAgICAgKlxuICAgICAqIE5vdGUgdGhhdCBgb25EaXNjb25uZWN0YCBvcGVyYXRpb25zIGFyZSBvbmx5IHRyaWdnZXJlZCBvbmNlLiBJZiB5b3Ugd2FudCBhblxuICAgICAqIG9wZXJhdGlvbiB0byBvY2N1ciBlYWNoIHRpbWUgYSBkaXNjb25uZWN0IG9jY3VycywgeW91J2xsIG5lZWQgdG8gcmUtZXN0YWJsaXNoXG4gICAgICogdGhlIGBvbkRpc2Nvbm5lY3RgIG9wZXJhdGlvbnMgZWFjaCB0aW1lLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGJlIHdyaXR0ZW4gdG8gdGhpcyBsb2NhdGlvbiBvbiBkaXNjb25uZWN0IChjYW5cbiAgICAgKiBiZSBhbiBvYmplY3QsIGFycmF5LCBzdHJpbmcsIG51bWJlciwgYm9vbGVhbiwgb3IgbnVsbCkuXG4gICAgICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiBzeW5jaHJvbml6YXRpb24gdG8gdGhlIERhdGFiYXNlIGlzIGNvbXBsZXRlLlxuICAgICAqL1xuICAgIHNldCh2YWx1ZSkge1xuICAgICAgICB2YWxpZGF0ZVdyaXRhYmxlUGF0aCgnT25EaXNjb25uZWN0LnNldCcsIHRoaXMuX3BhdGgpO1xuICAgICAgICB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZygnT25EaXNjb25uZWN0LnNldCcsIHZhbHVlLCB0aGlzLl9wYXRoLCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgICAgIHJlcG9PbkRpc2Nvbm5lY3RTZXQodGhpcy5fcmVwbywgdGhpcy5fcGF0aCwgdmFsdWUsIGRlZmVycmVkLndyYXBDYWxsYmFjaygoKSA9PiB7IH0pKTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVuc3VyZXMgdGhlIGRhdGEgYXQgdGhpcyBsb2NhdGlvbiBpcyBzZXQgdG8gdGhlIHNwZWNpZmllZCB2YWx1ZSBhbmQgcHJpb3JpdHlcbiAgICAgKiB3aGVuIHRoZSBjbGllbnQgaXMgZGlzY29ubmVjdGVkIChkdWUgdG8gY2xvc2luZyB0aGUgYnJvd3NlciwgbmF2aWdhdGluZyB0byBhXG4gICAgICogbmV3IHBhZ2UsIG9yIG5ldHdvcmsgaXNzdWVzKS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBiZSB3cml0dGVuIHRvIHRoaXMgbG9jYXRpb24gb24gZGlzY29ubmVjdCAoY2FuXG4gICAgICogYmUgYW4gb2JqZWN0LCBhcnJheSwgc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9yIG51bGwpLlxuICAgICAqIEBwYXJhbSBwcmlvcml0eSAtIFRoZSBwcmlvcml0eSB0byBiZSB3cml0dGVuIChzdHJpbmcsIG51bWJlciwgb3IgbnVsbCkuXG4gICAgICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiBzeW5jaHJvbml6YXRpb24gdG8gdGhlIERhdGFiYXNlIGlzIGNvbXBsZXRlLlxuICAgICAqL1xuICAgIHNldFdpdGhQcmlvcml0eSh2YWx1ZSwgcHJpb3JpdHkpIHtcbiAgICAgICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ09uRGlzY29ubmVjdC5zZXRXaXRoUHJpb3JpdHknLCB0aGlzLl9wYXRoKTtcbiAgICAgICAgdmFsaWRhdGVGaXJlYmFzZURhdGFBcmcoJ09uRGlzY29ubmVjdC5zZXRXaXRoUHJpb3JpdHknLCB2YWx1ZSwgdGhpcy5fcGF0aCwgZmFsc2UpO1xuICAgICAgICB2YWxpZGF0ZVByaW9yaXR5KCdPbkRpc2Nvbm5lY3Quc2V0V2l0aFByaW9yaXR5JywgcHJpb3JpdHksIGZhbHNlKTtcbiAgICAgICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTtcbiAgICAgICAgcmVwb09uRGlzY29ubmVjdFNldFdpdGhQcmlvcml0eSh0aGlzLl9yZXBvLCB0aGlzLl9wYXRoLCB2YWx1ZSwgcHJpb3JpdHksIGRlZmVycmVkLndyYXBDYWxsYmFjaygoKSA9PiB7IH0pKTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdyaXRlcyBtdWx0aXBsZSB2YWx1ZXMgYXQgdGhpcyBsb2NhdGlvbiB3aGVuIHRoZSBjbGllbnQgaXMgZGlzY29ubmVjdGVkIChkdWVcbiAgICAgKiB0byBjbG9zaW5nIHRoZSBicm93c2VyLCBuYXZpZ2F0aW5nIHRvIGEgbmV3IHBhZ2UsIG9yIG5ldHdvcmsgaXNzdWVzKS5cbiAgICAgKlxuICAgICAqIFRoZSBgdmFsdWVzYCBhcmd1bWVudCBjb250YWlucyBtdWx0aXBsZSBwcm9wZXJ0eS12YWx1ZSBwYWlycyB0aGF0IHdpbGwgYmVcbiAgICAgKiB3cml0dGVuIHRvIHRoZSBEYXRhYmFzZSB0b2dldGhlci4gRWFjaCBjaGlsZCBwcm9wZXJ0eSBjYW4gZWl0aGVyIGJlIGEgc2ltcGxlXG4gICAgICogcHJvcGVydHkgKGZvciBleGFtcGxlLCBcIm5hbWVcIikgb3IgYSByZWxhdGl2ZSBwYXRoIChmb3IgZXhhbXBsZSwgXCJuYW1lL2ZpcnN0XCIpXG4gICAgICogZnJvbSB0aGUgY3VycmVudCBsb2NhdGlvbiB0byB0aGUgZGF0YSB0byB1cGRhdGUuXG4gICAgICpcbiAgICAgKiBBcyBvcHBvc2VkIHRvIHRoZSBgc2V0KClgIG1ldGhvZCwgYHVwZGF0ZSgpYCBjYW4gYmUgdXNlIHRvIHNlbGVjdGl2ZWx5IHVwZGF0ZVxuICAgICAqIG9ubHkgdGhlIHJlZmVyZW5jZWQgcHJvcGVydGllcyBhdCB0aGUgY3VycmVudCBsb2NhdGlvbiAoaW5zdGVhZCBvZiByZXBsYWNpbmdcbiAgICAgKiBhbGwgdGhlIGNoaWxkIHByb3BlcnRpZXMgYXQgdGhlIGN1cnJlbnQgbG9jYXRpb24pLlxuICAgICAqXG4gICAgICogQHBhcmFtIHZhbHVlcyAtIE9iamVjdCBjb250YWluaW5nIG11bHRpcGxlIHZhbHVlcy5cbiAgICAgKiBAcmV0dXJucyBSZXNvbHZlcyB3aGVuIHN5bmNocm9uaXphdGlvbiB0byB0aGUgRGF0YWJhc2UgaXMgY29tcGxldGUuXG4gICAgICovXG4gICAgdXBkYXRlKHZhbHVlcykge1xuICAgICAgICB2YWxpZGF0ZVdyaXRhYmxlUGF0aCgnT25EaXNjb25uZWN0LnVwZGF0ZScsIHRoaXMuX3BhdGgpO1xuICAgICAgICB2YWxpZGF0ZUZpcmViYXNlTWVyZ2VEYXRhQXJnKCdPbkRpc2Nvbm5lY3QudXBkYXRlJywgdmFsdWVzLCB0aGlzLl9wYXRoLCBmYWxzZSk7XG4gICAgICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgICAgIHJlcG9PbkRpc2Nvbm5lY3RVcGRhdGUodGhpcy5fcmVwbywgdGhpcy5fcGF0aCwgdmFsdWVzLCBkZWZlcnJlZC53cmFwQ2FsbGJhY2soKCkgPT4geyB9KSk7XG4gICAgICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xuICAgIH1cbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIFF1ZXJ5SW1wbCB7XG4gICAgLyoqXG4gICAgICogQGhpZGVjb25zdHJ1Y3RvclxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKF9yZXBvLCBfcGF0aCwgX3F1ZXJ5UGFyYW1zLCBfb3JkZXJCeUNhbGxlZCkge1xuICAgICAgICB0aGlzLl9yZXBvID0gX3JlcG87XG4gICAgICAgIHRoaXMuX3BhdGggPSBfcGF0aDtcbiAgICAgICAgdGhpcy5fcXVlcnlQYXJhbXMgPSBfcXVlcnlQYXJhbXM7XG4gICAgICAgIHRoaXMuX29yZGVyQnlDYWxsZWQgPSBfb3JkZXJCeUNhbGxlZDtcbiAgICB9XG4gICAgZ2V0IGtleSgpIHtcbiAgICAgICAgaWYgKHBhdGhJc0VtcHR5KHRoaXMuX3BhdGgpKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBwYXRoR2V0QmFjayh0aGlzLl9wYXRoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgcmVmKCkge1xuICAgICAgICByZXR1cm4gbmV3IFJlZmVyZW5jZUltcGwodGhpcy5fcmVwbywgdGhpcy5fcGF0aCk7XG4gICAgfVxuICAgIGdldCBfcXVlcnlJZGVudGlmaWVyKCkge1xuICAgICAgICBjb25zdCBvYmogPSBxdWVyeVBhcmFtc0dldFF1ZXJ5T2JqZWN0KHRoaXMuX3F1ZXJ5UGFyYW1zKTtcbiAgICAgICAgY29uc3QgaWQgPSBPYmplY3RUb1VuaXF1ZUtleShvYmopO1xuICAgICAgICByZXR1cm4gaWQgPT09ICd7fScgPyAnZGVmYXVsdCcgOiBpZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQW4gb2JqZWN0IHJlcHJlc2VudGF0aW9uIG9mIHRoZSBxdWVyeSBwYXJhbWV0ZXJzIHVzZWQgYnkgdGhpcyBRdWVyeS5cbiAgICAgKi9cbiAgICBnZXQgX3F1ZXJ5T2JqZWN0KCkge1xuICAgICAgICByZXR1cm4gcXVlcnlQYXJhbXNHZXRRdWVyeU9iamVjdCh0aGlzLl9xdWVyeVBhcmFtcyk7XG4gICAgfVxuICAgIGlzRXF1YWwob3RoZXIpIHtcbiAgICAgICAgb3RoZXIgPSBnZXRNb2R1bGFySW5zdGFuY2Uob3RoZXIpO1xuICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFF1ZXJ5SW1wbCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzYW1lUmVwbyA9IHRoaXMuX3JlcG8gPT09IG90aGVyLl9yZXBvO1xuICAgICAgICBjb25zdCBzYW1lUGF0aCA9IHBhdGhFcXVhbHModGhpcy5fcGF0aCwgb3RoZXIuX3BhdGgpO1xuICAgICAgICBjb25zdCBzYW1lUXVlcnlJZGVudGlmaWVyID0gdGhpcy5fcXVlcnlJZGVudGlmaWVyID09PSBvdGhlci5fcXVlcnlJZGVudGlmaWVyO1xuICAgICAgICByZXR1cm4gc2FtZVJlcG8gJiYgc2FtZVBhdGggJiYgc2FtZVF1ZXJ5SWRlbnRpZmllcjtcbiAgICB9XG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50b1N0cmluZygpO1xuICAgIH1cbiAgICB0b1N0cmluZygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3JlcG8udG9TdHJpbmcoKSArIHBhdGhUb1VybEVuY29kZWRTdHJpbmcodGhpcy5fcGF0aCk7XG4gICAgfVxufVxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBubyBvdGhlciBvcmRlciBieSBjYWxsIGhhcyBiZWVuIG1hZGVcbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVOb1ByZXZpb3VzT3JkZXJCeUNhbGwocXVlcnksIGZuTmFtZSkge1xuICAgIGlmIChxdWVyeS5fb3JkZXJCeUNhbGxlZCA9PT0gdHJ1ZSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm5OYW1lICsgXCI6IFlvdSBjYW4ndCBjb21iaW5lIG11bHRpcGxlIG9yZGVyQnkgY2FsbHMuXCIpO1xuICAgIH1cbn1cbi8qKlxuICogVmFsaWRhdGVzIHN0YXJ0L2VuZCB2YWx1ZXMgZm9yIHF1ZXJpZXMuXG4gKi9cbmZ1bmN0aW9uIHZhbGlkYXRlUXVlcnlFbmRwb2ludHMocGFyYW1zKSB7XG4gICAgbGV0IHN0YXJ0Tm9kZSA9IG51bGw7XG4gICAgbGV0IGVuZE5vZGUgPSBudWxsO1xuICAgIGlmIChwYXJhbXMuaGFzU3RhcnQoKSkge1xuICAgICAgICBzdGFydE5vZGUgPSBwYXJhbXMuZ2V0SW5kZXhTdGFydFZhbHVlKCk7XG4gICAgfVxuICAgIGlmIChwYXJhbXMuaGFzRW5kKCkpIHtcbiAgICAgICAgZW5kTm9kZSA9IHBhcmFtcy5nZXRJbmRleEVuZFZhbHVlKCk7XG4gICAgfVxuICAgIGlmIChwYXJhbXMuZ2V0SW5kZXgoKSA9PT0gS0VZX0lOREVYKSB7XG4gICAgICAgIGNvbnN0IHRvb01hbnlBcmdzRXJyb3IgPSAnUXVlcnk6IFdoZW4gb3JkZXJpbmcgYnkga2V5LCB5b3UgbWF5IG9ubHkgcGFzcyBvbmUgYXJndW1lbnQgdG8gJyArXG4gICAgICAgICAgICAnc3RhcnRBdCgpLCBlbmRBdCgpLCBvciBlcXVhbFRvKCkuJztcbiAgICAgICAgY29uc3Qgd3JvbmdBcmdUeXBlRXJyb3IgPSAnUXVlcnk6IFdoZW4gb3JkZXJpbmcgYnkga2V5LCB0aGUgYXJndW1lbnQgcGFzc2VkIHRvIHN0YXJ0QXQoKSwgc3RhcnRBZnRlcigpLCAnICtcbiAgICAgICAgICAgICdlbmRBdCgpLCBlbmRCZWZvcmUoKSwgb3IgZXF1YWxUbygpIG11c3QgYmUgYSBzdHJpbmcuJztcbiAgICAgICAgaWYgKHBhcmFtcy5oYXNTdGFydCgpKSB7XG4gICAgICAgICAgICBjb25zdCBzdGFydE5hbWUgPSBwYXJhbXMuZ2V0SW5kZXhTdGFydE5hbWUoKTtcbiAgICAgICAgICAgIGlmIChzdGFydE5hbWUgIT09IE1JTl9OQU1FKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHRvb01hbnlBcmdzRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodHlwZW9mIHN0YXJ0Tm9kZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iod3JvbmdBcmdUeXBlRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChwYXJhbXMuaGFzRW5kKCkpIHtcbiAgICAgICAgICAgIGNvbnN0IGVuZE5hbWUgPSBwYXJhbXMuZ2V0SW5kZXhFbmROYW1lKCk7XG4gICAgICAgICAgICBpZiAoZW5kTmFtZSAhPT0gTUFYX05BTUUpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IodG9vTWFueUFyZ3NFcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgZW5kTm9kZSAhPT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3Iod3JvbmdBcmdUeXBlRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2UgaWYgKHBhcmFtcy5nZXRJbmRleCgpID09PSBQUklPUklUWV9JTkRFWCkge1xuICAgICAgICBpZiAoKHN0YXJ0Tm9kZSAhPSBudWxsICYmICFpc1ZhbGlkUHJpb3JpdHkoc3RhcnROb2RlKSkgfHxcbiAgICAgICAgICAgIChlbmROb2RlICE9IG51bGwgJiYgIWlzVmFsaWRQcmlvcml0eShlbmROb2RlKSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUXVlcnk6IFdoZW4gb3JkZXJpbmcgYnkgcHJpb3JpdHksIHRoZSBmaXJzdCBhcmd1bWVudCBwYXNzZWQgdG8gc3RhcnRBdCgpLCAnICtcbiAgICAgICAgICAgICAgICAnc3RhcnRBZnRlcigpIGVuZEF0KCksIGVuZEJlZm9yZSgpLCBvciBlcXVhbFRvKCkgbXVzdCBiZSBhIHZhbGlkIHByaW9yaXR5IHZhbHVlICcgK1xuICAgICAgICAgICAgICAgICcobnVsbCwgYSBudW1iZXIsIG9yIGEgc3RyaW5nKS4nKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXNzZXJ0KHBhcmFtcy5nZXRJbmRleCgpIGluc3RhbmNlb2YgUGF0aEluZGV4IHx8XG4gICAgICAgICAgICBwYXJhbXMuZ2V0SW5kZXgoKSA9PT0gVkFMVUVfSU5ERVgsICd1bmtub3duIGluZGV4IHR5cGUuJyk7XG4gICAgICAgIGlmICgoc3RhcnROb2RlICE9IG51bGwgJiYgdHlwZW9mIHN0YXJ0Tm9kZSA9PT0gJ29iamVjdCcpIHx8XG4gICAgICAgICAgICAoZW5kTm9kZSAhPSBudWxsICYmIHR5cGVvZiBlbmROb2RlID09PSAnb2JqZWN0JykpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignUXVlcnk6IEZpcnN0IGFyZ3VtZW50IHBhc3NlZCB0byBzdGFydEF0KCksIHN0YXJ0QWZ0ZXIoKSwgZW5kQXQoKSwgZW5kQmVmb3JlKCksIG9yICcgK1xuICAgICAgICAgICAgICAgICdlcXVhbFRvKCkgY2Fubm90IGJlIGFuIG9iamVjdC4nKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgbGltaXQqIGhhcyBiZWVuIGNhbGxlZCB3aXRoIHRoZSBjb3JyZWN0IGNvbWJpbmF0aW9uIG9mIHBhcmFtZXRlcnNcbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVMaW1pdChwYXJhbXMpIHtcbiAgICBpZiAocGFyYW1zLmhhc1N0YXJ0KCkgJiZcbiAgICAgICAgcGFyYW1zLmhhc0VuZCgpICYmXG4gICAgICAgIHBhcmFtcy5oYXNMaW1pdCgpICYmXG4gICAgICAgICFwYXJhbXMuaGFzQW5jaG9yZWRMaW1pdCgpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIlF1ZXJ5OiBDYW4ndCBjb21iaW5lIHN0YXJ0QXQoKSwgc3RhcnRBZnRlcigpLCBlbmRBdCgpLCBlbmRCZWZvcmUoKSwgYW5kIGxpbWl0KCkuIFVzZSBcIiArXG4gICAgICAgICAgICAnbGltaXRUb0ZpcnN0KCkgb3IgbGltaXRUb0xhc3QoKSBpbnN0ZWFkLicpO1xuICAgIH1cbn1cbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNsYXNzIFJlZmVyZW5jZUltcGwgZXh0ZW5kcyBRdWVyeUltcGwge1xuICAgIC8qKiBAaGlkZWNvbnN0cnVjdG9yICovXG4gICAgY29uc3RydWN0b3IocmVwbywgcGF0aCkge1xuICAgICAgICBzdXBlcihyZXBvLCBwYXRoLCBuZXcgUXVlcnlQYXJhbXMoKSwgZmFsc2UpO1xuICAgIH1cbiAgICBnZXQgcGFyZW50KCkge1xuICAgICAgICBjb25zdCBwYXJlbnRQYXRoID0gcGF0aFBhcmVudCh0aGlzLl9wYXRoKTtcbiAgICAgICAgcmV0dXJuIHBhcmVudFBhdGggPT09IG51bGxcbiAgICAgICAgICAgID8gbnVsbFxuICAgICAgICAgICAgOiBuZXcgUmVmZXJlbmNlSW1wbCh0aGlzLl9yZXBvLCBwYXJlbnRQYXRoKTtcbiAgICB9XG4gICAgZ2V0IHJvb3QoKSB7XG4gICAgICAgIGxldCByZWYgPSB0aGlzO1xuICAgICAgICB3aGlsZSAocmVmLnBhcmVudCAhPT0gbnVsbCkge1xuICAgICAgICAgICAgcmVmID0gcmVmLnBhcmVudDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVmO1xuICAgIH1cbn1cbi8qKlxuICogQSBgRGF0YVNuYXBzaG90YCBjb250YWlucyBkYXRhIGZyb20gYSBEYXRhYmFzZSBsb2NhdGlvbi5cbiAqXG4gKiBBbnkgdGltZSB5b3UgcmVhZCBkYXRhIGZyb20gdGhlIERhdGFiYXNlLCB5b3UgcmVjZWl2ZSB0aGUgZGF0YSBhcyBhXG4gKiBgRGF0YVNuYXBzaG90YC4gQSBgRGF0YVNuYXBzaG90YCBpcyBwYXNzZWQgdG8gdGhlIGV2ZW50IGNhbGxiYWNrcyB5b3UgYXR0YWNoXG4gKiB3aXRoIGBvbigpYCBvciBgb25jZSgpYC4gWW91IGNhbiBleHRyYWN0IHRoZSBjb250ZW50cyBvZiB0aGUgc25hcHNob3QgYXMgYVxuICogSmF2YVNjcmlwdCBvYmplY3QgYnkgY2FsbGluZyB0aGUgYHZhbCgpYCBtZXRob2QuIEFsdGVybmF0aXZlbHksIHlvdSBjYW5cbiAqIHRyYXZlcnNlIGludG8gdGhlIHNuYXBzaG90IGJ5IGNhbGxpbmcgYGNoaWxkKClgIHRvIHJldHVybiBjaGlsZCBzbmFwc2hvdHNcbiAqICh3aGljaCB5b3UgY291bGQgdGhlbiBjYWxsIGB2YWwoKWAgb24pLlxuICpcbiAqIEEgYERhdGFTbmFwc2hvdGAgaXMgYW4gZWZmaWNpZW50bHkgZ2VuZXJhdGVkLCBpbW11dGFibGUgY29weSBvZiB0aGUgZGF0YSBhdFxuICogYSBEYXRhYmFzZSBsb2NhdGlvbi4gSXQgY2Fubm90IGJlIG1vZGlmaWVkIGFuZCB3aWxsIG5ldmVyIGNoYW5nZSAodG8gbW9kaWZ5XG4gKiBkYXRhLCB5b3UgYWx3YXlzIGNhbGwgdGhlIGBzZXQoKWAgbWV0aG9kIG9uIGEgYFJlZmVyZW5jZWAgZGlyZWN0bHkpLlxuICovXG5jbGFzcyBEYXRhU25hcHNob3Qge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSBfbm9kZSAtIEEgU25hcHNob3ROb2RlIHRvIHdyYXAuXG4gICAgICogQHBhcmFtIHJlZiAtIFRoZSBsb2NhdGlvbiB0aGlzIHNuYXBzaG90IGNhbWUgZnJvbS5cbiAgICAgKiBAcGFyYW0gX2luZGV4IC0gVGhlIGl0ZXJhdGlvbiBvcmRlciBmb3IgdGhpcyBzbmFwc2hvdFxuICAgICAqIEBoaWRlY29uc3RydWN0b3JcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihfbm9kZSwgXG4gICAgLyoqXG4gICAgICogVGhlIGxvY2F0aW9uIG9mIHRoaXMgRGF0YVNuYXBzaG90LlxuICAgICAqL1xuICAgIHJlZiwgX2luZGV4KSB7XG4gICAgICAgIHRoaXMuX25vZGUgPSBfbm9kZTtcbiAgICAgICAgdGhpcy5yZWYgPSByZWY7XG4gICAgICAgIHRoaXMuX2luZGV4ID0gX2luZGV4O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBHZXRzIHRoZSBwcmlvcml0eSB2YWx1ZSBvZiB0aGUgZGF0YSBpbiB0aGlzIGBEYXRhU25hcHNob3RgLlxuICAgICAqXG4gICAgICogQXBwbGljYXRpb25zIG5lZWQgbm90IHVzZSBwcmlvcml0eSBidXQgY2FuIG9yZGVyIGNvbGxlY3Rpb25zIGJ5XG4gICAgICogb3JkaW5hcnkgcHJvcGVydGllcyAoc2VlXG4gICAgICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI3NvcnRpbmdfYW5kX2ZpbHRlcmluZ19kYXRhIHxTb3J0aW5nIGFuZCBmaWx0ZXJpbmcgZGF0YX1cbiAgICAgKiApLlxuICAgICAqL1xuICAgIGdldCBwcmlvcml0eSgpIHtcbiAgICAgICAgLy8gdHlwZWNhc3QgaGVyZSBiZWNhdXNlIHdlIG5ldmVyIHJldHVybiBkZWZlcnJlZCB2YWx1ZXMgb3IgaW50ZXJuYWwgcHJpb3JpdGllcyAoTUFYX1BSSU9SSVRZKVxuICAgICAgICByZXR1cm4gdGhpcy5fbm9kZS5nZXRQcmlvcml0eSgpLnZhbCgpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUaGUga2V5IChsYXN0IHBhcnQgb2YgdGhlIHBhdGgpIG9mIHRoZSBsb2NhdGlvbiBvZiB0aGlzIGBEYXRhU25hcHNob3RgLlxuICAgICAqXG4gICAgICogVGhlIGxhc3QgdG9rZW4gaW4gYSBEYXRhYmFzZSBsb2NhdGlvbiBpcyBjb25zaWRlcmVkIGl0cyBrZXkuIEZvciBleGFtcGxlLFxuICAgICAqIFwiYWRhXCIgaXMgdGhlIGtleSBmb3IgdGhlIC91c2Vycy9hZGEvIG5vZGUuIEFjY2Vzc2luZyB0aGUga2V5IG9uIGFueVxuICAgICAqIGBEYXRhU25hcHNob3RgIHdpbGwgcmV0dXJuIHRoZSBrZXkgZm9yIHRoZSBsb2NhdGlvbiB0aGF0IGdlbmVyYXRlZCBpdC5cbiAgICAgKiBIb3dldmVyLCBhY2Nlc3NpbmcgdGhlIGtleSBvbiB0aGUgcm9vdCBVUkwgb2YgYSBEYXRhYmFzZSB3aWxsIHJldHVyblxuICAgICAqIGBudWxsYC5cbiAgICAgKi9cbiAgICBnZXQga2V5KCkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZWYua2V5O1xuICAgIH1cbiAgICAvKiogUmV0dXJucyB0aGUgbnVtYmVyIG9mIGNoaWxkIHByb3BlcnRpZXMgb2YgdGhpcyBgRGF0YVNuYXBzaG90YC4gKi9cbiAgICBnZXQgc2l6ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGUubnVtQ2hpbGRyZW4oKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogR2V0cyBhbm90aGVyIGBEYXRhU25hcHNob3RgIGZvciB0aGUgbG9jYXRpb24gYXQgdGhlIHNwZWNpZmllZCByZWxhdGl2ZSBwYXRoLlxuICAgICAqXG4gICAgICogUGFzc2luZyBhIHJlbGF0aXZlIHBhdGggdG8gdGhlIGBjaGlsZCgpYCBtZXRob2Qgb2YgYSBEYXRhU25hcHNob3QgcmV0dXJuc1xuICAgICAqIGFub3RoZXIgYERhdGFTbmFwc2hvdGAgZm9yIHRoZSBsb2NhdGlvbiBhdCB0aGUgc3BlY2lmaWVkIHJlbGF0aXZlIHBhdGguIFRoZVxuICAgICAqIHJlbGF0aXZlIHBhdGggY2FuIGVpdGhlciBiZSBhIHNpbXBsZSBjaGlsZCBuYW1lIChmb3IgZXhhbXBsZSwgXCJhZGFcIikgb3IgYVxuICAgICAqIGRlZXBlciwgc2xhc2gtc2VwYXJhdGVkIHBhdGggKGZvciBleGFtcGxlLCBcImFkYS9uYW1lL2ZpcnN0XCIpLiBJZiB0aGUgY2hpbGRcbiAgICAgKiBsb2NhdGlvbiBoYXMgbm8gZGF0YSwgYW4gZW1wdHkgYERhdGFTbmFwc2hvdGAgKHRoYXQgaXMsIGEgYERhdGFTbmFwc2hvdGBcbiAgICAgKiB3aG9zZSB2YWx1ZSBpcyBgbnVsbGApIGlzIHJldHVybmVkLlxuICAgICAqXG4gICAgICogQHBhcmFtIHBhdGggLSBBIHJlbGF0aXZlIHBhdGggdG8gdGhlIGxvY2F0aW9uIG9mIGNoaWxkIGRhdGEuXG4gICAgICovXG4gICAgY2hpbGQocGF0aCkge1xuICAgICAgICBjb25zdCBjaGlsZFBhdGggPSBuZXcgUGF0aChwYXRoKTtcbiAgICAgICAgY29uc3QgY2hpbGRSZWYgPSBjaGlsZCh0aGlzLnJlZiwgcGF0aCk7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YVNuYXBzaG90KHRoaXMuX25vZGUuZ2V0Q2hpbGQoY2hpbGRQYXRoKSwgY2hpbGRSZWYsIFBSSU9SSVRZX0lOREVYKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB0cnVlIGlmIHRoaXMgYERhdGFTbmFwc2hvdGAgY29udGFpbnMgYW55IGRhdGEuIEl0IGlzIHNsaWdodGx5IG1vcmVcbiAgICAgKiBlZmZpY2llbnQgdGhhbiB1c2luZyBgc25hcHNob3QudmFsKCkgIT09IG51bGxgLlxuICAgICAqL1xuICAgIGV4aXN0cygpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLl9ub2RlLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXhwb3J0cyB0aGUgZW50aXJlIGNvbnRlbnRzIG9mIHRoZSBEYXRhU25hcHNob3QgYXMgYSBKYXZhU2NyaXB0IG9iamVjdC5cbiAgICAgKlxuICAgICAqIFRoZSBgZXhwb3J0VmFsKClgIG1ldGhvZCBpcyBzaW1pbGFyIHRvIGB2YWwoKWAsIGV4Y2VwdCBwcmlvcml0eSBpbmZvcm1hdGlvblxuICAgICAqIGlzIGluY2x1ZGVkIChpZiBhdmFpbGFibGUpLCBtYWtpbmcgaXQgc3VpdGFibGUgZm9yIGJhY2tpbmcgdXAgeW91ciBkYXRhLlxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIERhdGFTbmFwc2hvdCdzIGNvbnRlbnRzIGFzIGEgSmF2YVNjcmlwdCB2YWx1ZSAoT2JqZWN0LFxuICAgICAqICAgQXJyYXksIHN0cmluZywgbnVtYmVyLCBib29sZWFuLCBvciBgbnVsbGApLlxuICAgICAqL1xuICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gICAgZXhwb3J0VmFsKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fbm9kZS52YWwodHJ1ZSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEVudW1lcmF0ZXMgdGhlIHRvcC1sZXZlbCBjaGlsZHJlbiBpbiB0aGUgYEl0ZXJhdGVkRGF0YVNuYXBzaG90YC5cbiAgICAgKlxuICAgICAqIEJlY2F1c2Ugb2YgdGhlIHdheSBKYXZhU2NyaXB0IG9iamVjdHMgd29yaywgdGhlIG9yZGVyaW5nIG9mIGRhdGEgaW4gdGhlXG4gICAgICogSmF2YVNjcmlwdCBvYmplY3QgcmV0dXJuZWQgYnkgYHZhbCgpYCBpcyBub3QgZ3VhcmFudGVlZCB0byBtYXRjaCB0aGVcbiAgICAgKiBvcmRlcmluZyBvbiB0aGUgc2VydmVyIG5vciB0aGUgb3JkZXJpbmcgb2YgYG9uQ2hpbGRBZGRlZCgpYCBldmVudHMuIFRoYXQgaXNcbiAgICAgKiB3aGVyZSBgZm9yRWFjaCgpYCBjb21lcyBpbiBoYW5keS4gSXQgZ3VhcmFudGVlcyB0aGUgY2hpbGRyZW4gb2YgYVxuICAgICAqIGBEYXRhU25hcHNob3RgIHdpbGwgYmUgaXRlcmF0ZWQgaW4gdGhlaXIgcXVlcnkgb3JkZXIuXG4gICAgICpcbiAgICAgKiBJZiBubyBleHBsaWNpdCBgb3JkZXJCeSooKWAgbWV0aG9kIGlzIHVzZWQsIHJlc3VsdHMgYXJlIHJldHVybmVkXG4gICAgICogb3JkZXJlZCBieSBrZXkgKHVubGVzcyBwcmlvcml0aWVzIGFyZSB1c2VkLCBpbiB3aGljaCBjYXNlLCByZXN1bHRzIGFyZVxuICAgICAqIHJldHVybmVkIGJ5IHByaW9yaXR5KS5cbiAgICAgKlxuICAgICAqIEBwYXJhbSBhY3Rpb24gLSBBIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgZm9yIGVhY2ggY2hpbGQgRGF0YVNuYXBzaG90LlxuICAgICAqIFRoZSBjYWxsYmFjayBjYW4gcmV0dXJuIHRydWUgdG8gY2FuY2VsIGZ1cnRoZXIgZW51bWVyYXRpb24uXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiBlbnVtZXJhdGlvbiB3YXMgY2FuY2VsZWQgZHVlIHRvIHlvdXIgY2FsbGJhY2sgcmV0dXJuaW5nXG4gICAgICogdHJ1ZS5cbiAgICAgKi9cbiAgICBmb3JFYWNoKGFjdGlvbikge1xuICAgICAgICBpZiAodGhpcy5fbm9kZS5pc0xlYWZOb2RlKCkpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBjaGlsZHJlbk5vZGUgPSB0aGlzLl9ub2RlO1xuICAgICAgICAvLyBTYW5pdGl6ZSB0aGUgcmV0dXJuIHZhbHVlIHRvIGEgYm9vbGVhbi4gQ2hpbGRyZW5Ob2RlLmZvckVhY2hDaGlsZCBoYXMgYSB3ZWlyZCByZXR1cm4gdHlwZS4uLlxuICAgICAgICByZXR1cm4gISFjaGlsZHJlbk5vZGUuZm9yRWFjaENoaWxkKHRoaXMuX2luZGV4LCAoa2V5LCBub2RlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYWN0aW9uKG5ldyBEYXRhU25hcHNob3Qobm9kZSwgY2hpbGQodGhpcy5yZWYsIGtleSksIFBSSU9SSVRZX0lOREVYKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIHNwZWNpZmllZCBjaGlsZCBwYXRoIGhhcyAobm9uLW51bGwpIGRhdGEuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gcGF0aCAtIEEgcmVsYXRpdmUgcGF0aCB0byB0aGUgbG9jYXRpb24gb2YgYSBwb3RlbnRpYWwgY2hpbGQuXG4gICAgICogQHJldHVybnMgYHRydWVgIGlmIGRhdGEgZXhpc3RzIGF0IHRoZSBzcGVjaWZpZWQgY2hpbGQgcGF0aDsgZWxzZVxuICAgICAqICBgZmFsc2VgLlxuICAgICAqL1xuICAgIGhhc0NoaWxkKHBhdGgpIHtcbiAgICAgICAgY29uc3QgY2hpbGRQYXRoID0gbmV3IFBhdGgocGF0aCk7XG4gICAgICAgIHJldHVybiAhdGhpcy5fbm9kZS5nZXRDaGlsZChjaGlsZFBhdGgpLmlzRW1wdHkoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmV0dXJucyB3aGV0aGVyIG9yIG5vdCB0aGUgYERhdGFTbmFwc2hvdGAgaGFzIGFueSBub24tYG51bGxgIGNoaWxkXG4gICAgICogcHJvcGVydGllcy5cbiAgICAgKlxuICAgICAqIFlvdSBjYW4gdXNlIGBoYXNDaGlsZHJlbigpYCB0byBkZXRlcm1pbmUgaWYgYSBgRGF0YVNuYXBzaG90YCBoYXMgYW55XG4gICAgICogY2hpbGRyZW4uIElmIGl0IGRvZXMsIHlvdSBjYW4gZW51bWVyYXRlIHRoZW0gdXNpbmcgYGZvckVhY2goKWAuIElmIGl0XG4gICAgICogZG9lc24ndCwgdGhlbiBlaXRoZXIgdGhpcyBzbmFwc2hvdCBjb250YWlucyBhIHByaW1pdGl2ZSB2YWx1ZSAod2hpY2ggY2FuIGJlXG4gICAgICogcmV0cmlldmVkIHdpdGggYHZhbCgpYCkgb3IgaXQgaXMgZW1wdHkgKGluIHdoaWNoIGNhc2UsIGB2YWwoKWAgd2lsbCByZXR1cm5cbiAgICAgKiBgbnVsbGApLlxuICAgICAqXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGlzIHNuYXBzaG90IGhhcyBhbnkgY2hpbGRyZW47IGVsc2UgZmFsc2UuXG4gICAgICovXG4gICAgaGFzQ2hpbGRyZW4oKSB7XG4gICAgICAgIGlmICh0aGlzLl9ub2RlLmlzTGVhZk5vZGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICF0aGlzLl9ub2RlLmlzRW1wdHkoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuXG4gICAgICovXG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5leHBvcnRWYWwoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRXh0cmFjdHMgYSBKYXZhU2NyaXB0IHZhbHVlIGZyb20gYSBgRGF0YVNuYXBzaG90YC5cbiAgICAgKlxuICAgICAqIERlcGVuZGluZyBvbiB0aGUgZGF0YSBpbiBhIGBEYXRhU25hcHNob3RgLCB0aGUgYHZhbCgpYCBtZXRob2QgbWF5IHJldHVybiBhXG4gICAgICogc2NhbGFyIHR5cGUgKHN0cmluZywgbnVtYmVyLCBvciBib29sZWFuKSwgYW4gYXJyYXksIG9yIGFuIG9iamVjdC4gSXQgbWF5XG4gICAgICogYWxzbyByZXR1cm4gbnVsbCwgaW5kaWNhdGluZyB0aGF0IHRoZSBgRGF0YVNuYXBzaG90YCBpcyBlbXB0eSAoY29udGFpbnMgbm9cbiAgICAgKiBkYXRhKS5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIFRoZSBEYXRhU25hcHNob3QncyBjb250ZW50cyBhcyBhIEphdmFTY3JpcHQgdmFsdWUgKE9iamVjdCxcbiAgICAgKiAgIEFycmF5LCBzdHJpbmcsIG51bWJlciwgYm9vbGVhbiwgb3IgYG51bGxgKS5cbiAgICAgKi9cbiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICAgIHZhbCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX25vZGUudmFsKCk7XG4gICAgfVxufVxuLyoqXG4gKlxuICogUmV0dXJucyBhIGBSZWZlcmVuY2VgIHJlcHJlc2VudGluZyB0aGUgbG9jYXRpb24gaW4gdGhlIERhdGFiYXNlXG4gKiBjb3JyZXNwb25kaW5nIHRvIHRoZSBwcm92aWRlZCBwYXRoLiBJZiBubyBwYXRoIGlzIHByb3ZpZGVkLCB0aGUgYFJlZmVyZW5jZWBcbiAqIHdpbGwgcG9pbnQgdG8gdGhlIHJvb3Qgb2YgdGhlIERhdGFiYXNlLlxuICpcbiAqIEBwYXJhbSBkYiAtIFRoZSBkYXRhYmFzZSBpbnN0YW5jZSB0byBvYnRhaW4gYSByZWZlcmVuY2UgZm9yLlxuICogQHBhcmFtIHBhdGggLSBPcHRpb25hbCBwYXRoIHJlcHJlc2VudGluZyB0aGUgbG9jYXRpb24gdGhlIHJldHVybmVkXG4gKiAgIGBSZWZlcmVuY2VgIHdpbGwgcG9pbnQuIElmIG5vdCBwcm92aWRlZCwgdGhlIHJldHVybmVkIGBSZWZlcmVuY2VgIHdpbGxcbiAqICAgcG9pbnQgdG8gdGhlIHJvb3Qgb2YgdGhlIERhdGFiYXNlLlxuICogQHJldHVybnMgSWYgYSBwYXRoIGlzIHByb3ZpZGVkLCBhIGBSZWZlcmVuY2VgXG4gKiAgIHBvaW50aW5nIHRvIHRoZSBwcm92aWRlZCBwYXRoLiBPdGhlcndpc2UsIGEgYFJlZmVyZW5jZWAgcG9pbnRpbmcgdG8gdGhlXG4gKiAgIHJvb3Qgb2YgdGhlIERhdGFiYXNlLlxuICovXG5mdW5jdGlvbiByZWYoZGIsIHBhdGgpIHtcbiAgICBkYiA9IGdldE1vZHVsYXJJbnN0YW5jZShkYik7XG4gICAgZGIuX2NoZWNrTm90RGVsZXRlZCgncmVmJyk7XG4gICAgcmV0dXJuIHBhdGggIT09IHVuZGVmaW5lZCA/IGNoaWxkKGRiLl9yb290LCBwYXRoKSA6IGRiLl9yb290O1xufVxuLyoqXG4gKiBSZXR1cm5zIGEgYFJlZmVyZW5jZWAgcmVwcmVzZW50aW5nIHRoZSBsb2NhdGlvbiBpbiB0aGUgRGF0YWJhc2VcbiAqIGNvcnJlc3BvbmRpbmcgdG8gdGhlIHByb3ZpZGVkIEZpcmViYXNlIFVSTC5cbiAqXG4gKiBBbiBleGNlcHRpb24gaXMgdGhyb3duIGlmIHRoZSBVUkwgaXMgbm90IGEgdmFsaWQgRmlyZWJhc2UgRGF0YWJhc2UgVVJMIG9yIGl0XG4gKiBoYXMgYSBkaWZmZXJlbnQgZG9tYWluIHRoYW4gdGhlIGN1cnJlbnQgYERhdGFiYXNlYCBpbnN0YW5jZS5cbiAqXG4gKiBOb3RlIHRoYXQgYWxsIHF1ZXJ5IHBhcmFtZXRlcnMgKGBvcmRlckJ5YCwgYGxpbWl0VG9MYXN0YCwgZXRjLikgYXJlIGlnbm9yZWRcbiAqIGFuZCBhcmUgbm90IGFwcGxpZWQgdG8gdGhlIHJldHVybmVkIGBSZWZlcmVuY2VgLlxuICpcbiAqIEBwYXJhbSBkYiAtIFRoZSBkYXRhYmFzZSBpbnN0YW5jZSB0byBvYnRhaW4gYSByZWZlcmVuY2UgZm9yLlxuICogQHBhcmFtIHVybCAtIFRoZSBGaXJlYmFzZSBVUkwgYXQgd2hpY2ggdGhlIHJldHVybmVkIGBSZWZlcmVuY2VgIHdpbGxcbiAqICAgcG9pbnQuXG4gKiBAcmV0dXJucyBBIGBSZWZlcmVuY2VgIHBvaW50aW5nIHRvIHRoZSBwcm92aWRlZFxuICogICBGaXJlYmFzZSBVUkwuXG4gKi9cbmZ1bmN0aW9uIHJlZkZyb21VUkwoZGIsIHVybCkge1xuICAgIGRiID0gZ2V0TW9kdWxhckluc3RhbmNlKGRiKTtcbiAgICBkYi5fY2hlY2tOb3REZWxldGVkKCdyZWZGcm9tVVJMJyk7XG4gICAgY29uc3QgcGFyc2VkVVJMID0gcGFyc2VSZXBvSW5mbyh1cmwsIGRiLl9yZXBvLnJlcG9JbmZvXy5ub2RlQWRtaW4pO1xuICAgIHZhbGlkYXRlVXJsKCdyZWZGcm9tVVJMJywgcGFyc2VkVVJMKTtcbiAgICBjb25zdCByZXBvSW5mbyA9IHBhcnNlZFVSTC5yZXBvSW5mbztcbiAgICBpZiAoIWRiLl9yZXBvLnJlcG9JbmZvXy5pc0N1c3RvbUhvc3QoKSAmJlxuICAgICAgICByZXBvSW5mby5ob3N0ICE9PSBkYi5fcmVwby5yZXBvSW5mb18uaG9zdCkge1xuICAgICAgICBmYXRhbCgncmVmRnJvbVVSTCcgK1xuICAgICAgICAgICAgJzogSG9zdCBuYW1lIGRvZXMgbm90IG1hdGNoIHRoZSBjdXJyZW50IGRhdGFiYXNlOiAnICtcbiAgICAgICAgICAgICcoZm91bmQgJyArXG4gICAgICAgICAgICByZXBvSW5mby5ob3N0ICtcbiAgICAgICAgICAgICcgYnV0IGV4cGVjdGVkICcgK1xuICAgICAgICAgICAgZGIuX3JlcG8ucmVwb0luZm9fLmhvc3QgK1xuICAgICAgICAgICAgJyknKTtcbiAgICB9XG4gICAgcmV0dXJuIHJlZihkYiwgcGFyc2VkVVJMLnBhdGgudG9TdHJpbmcoKSk7XG59XG4vKipcbiAqIEdldHMgYSBgUmVmZXJlbmNlYCBmb3IgdGhlIGxvY2F0aW9uIGF0IHRoZSBzcGVjaWZpZWQgcmVsYXRpdmUgcGF0aC5cbiAqXG4gKiBUaGUgcmVsYXRpdmUgcGF0aCBjYW4gZWl0aGVyIGJlIGEgc2ltcGxlIGNoaWxkIG5hbWUgKGZvciBleGFtcGxlLCBcImFkYVwiKSBvclxuICogYSBkZWVwZXIgc2xhc2gtc2VwYXJhdGVkIHBhdGggKGZvciBleGFtcGxlLCBcImFkYS9uYW1lL2ZpcnN0XCIpLlxuICpcbiAqIEBwYXJhbSBwYXJlbnQgLSBUaGUgcGFyZW50IGxvY2F0aW9uLlxuICogQHBhcmFtIHBhdGggLSBBIHJlbGF0aXZlIHBhdGggZnJvbSB0aGlzIGxvY2F0aW9uIHRvIHRoZSBkZXNpcmVkIGNoaWxkXG4gKiAgIGxvY2F0aW9uLlxuICogQHJldHVybnMgVGhlIHNwZWNpZmllZCBjaGlsZCBsb2NhdGlvbi5cbiAqL1xuZnVuY3Rpb24gY2hpbGQocGFyZW50LCBwYXRoKSB7XG4gICAgcGFyZW50ID0gZ2V0TW9kdWxhckluc3RhbmNlKHBhcmVudCk7XG4gICAgaWYgKHBhdGhHZXRGcm9udChwYXJlbnQuX3BhdGgpID09PSBudWxsKSB7XG4gICAgICAgIHZhbGlkYXRlUm9vdFBhdGhTdHJpbmcoJ2NoaWxkJywgJ3BhdGgnLCBwYXRoLCBmYWxzZSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2YWxpZGF0ZVBhdGhTdHJpbmcoJ2NoaWxkJywgJ3BhdGgnLCBwYXRoLCBmYWxzZSk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVmZXJlbmNlSW1wbChwYXJlbnQuX3JlcG8sIHBhdGhDaGlsZChwYXJlbnQuX3BhdGgsIHBhdGgpKTtcbn1cbi8qKlxuICogUmV0dXJucyBhbiBgT25EaXNjb25uZWN0YCBvYmplY3QgLSBzZWVcbiAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9kYXRhYmFzZS93ZWIvb2ZmbGluZS1jYXBhYmlsaXRpZXMgfCBFbmFibGluZyBPZmZsaW5lIENhcGFiaWxpdGllcyBpbiBKYXZhU2NyaXB0fVxuICogZm9yIG1vcmUgaW5mb3JtYXRpb24gb24gaG93IHRvIHVzZSBpdC5cbiAqXG4gKiBAcGFyYW0gcmVmIC0gVGhlIHJlZmVyZW5jZSB0byBhZGQgT25EaXNjb25uZWN0IHRyaWdnZXJzIGZvci5cbiAqL1xuZnVuY3Rpb24gb25EaXNjb25uZWN0KHJlZikge1xuICAgIHJlZiA9IGdldE1vZHVsYXJJbnN0YW5jZShyZWYpO1xuICAgIHJldHVybiBuZXcgT25EaXNjb25uZWN0KHJlZi5fcmVwbywgcmVmLl9wYXRoKTtcbn1cbi8qKlxuICogR2VuZXJhdGVzIGEgbmV3IGNoaWxkIGxvY2F0aW9uIHVzaW5nIGEgdW5pcXVlIGtleSBhbmQgcmV0dXJucyBpdHNcbiAqIGBSZWZlcmVuY2VgLlxuICpcbiAqIFRoaXMgaXMgdGhlIG1vc3QgY29tbW9uIHBhdHRlcm4gZm9yIGFkZGluZyBkYXRhIHRvIGEgY29sbGVjdGlvbiBvZiBpdGVtcy5cbiAqXG4gKiBJZiB5b3UgcHJvdmlkZSBhIHZhbHVlIHRvIGBwdXNoKClgLCB0aGUgdmFsdWUgaXMgd3JpdHRlbiB0byB0aGVcbiAqIGdlbmVyYXRlZCBsb2NhdGlvbi4gSWYgeW91IGRvbid0IHBhc3MgYSB2YWx1ZSwgbm90aGluZyBpcyB3cml0dGVuIHRvIHRoZVxuICogZGF0YWJhc2UgYW5kIHRoZSBjaGlsZCByZW1haW5zIGVtcHR5IChidXQgeW91IGNhbiB1c2UgdGhlIGBSZWZlcmVuY2VgXG4gKiBlbHNld2hlcmUpLlxuICpcbiAqIFRoZSB1bmlxdWUga2V5cyBnZW5lcmF0ZWQgYnkgYHB1c2goKWAgYXJlIG9yZGVyZWQgYnkgdGhlIGN1cnJlbnQgdGltZSwgc28gdGhlXG4gKiByZXN1bHRpbmcgbGlzdCBvZiBpdGVtcyBpcyBjaHJvbm9sb2dpY2FsbHkgc29ydGVkLiBUaGUga2V5cyBhcmUgYWxzb1xuICogZGVzaWduZWQgdG8gYmUgdW5ndWVzc2FibGUgKHRoZXkgY29udGFpbiA3MiByYW5kb20gYml0cyBvZiBlbnRyb3B5KS5cbiAqXG4gKiBTZWUge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI2FwcGVuZF90b19hX2xpc3Rfb2ZfZGF0YSB8IEFwcGVuZCB0byBhIGxpc3Qgb2YgZGF0YX0uXG4gKiBTZWUge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlYmxvZy5jb20vMjAxNS8wMi90aGUtMjEyMC13YXlzLXRvLWVuc3VyZS11bmlxdWVfNjguaHRtbCB8IFRoZSAyXjEyMCBXYXlzIHRvIEVuc3VyZSBVbmlxdWUgSWRlbnRpZmllcnN9LlxuICpcbiAqIEBwYXJhbSBwYXJlbnQgLSBUaGUgcGFyZW50IGxvY2F0aW9uLlxuICogQHBhcmFtIHZhbHVlIC0gT3B0aW9uYWwgdmFsdWUgdG8gYmUgd3JpdHRlbiBhdCB0aGUgZ2VuZXJhdGVkIGxvY2F0aW9uLlxuICogQHJldHVybnMgQ29tYmluZWQgYFByb21pc2VgIGFuZCBgUmVmZXJlbmNlYDsgcmVzb2x2ZXMgd2hlbiB3cml0ZSBpcyBjb21wbGV0ZSxcbiAqIGJ1dCBjYW4gYmUgdXNlZCBpbW1lZGlhdGVseSBhcyB0aGUgYFJlZmVyZW5jZWAgdG8gdGhlIGNoaWxkIGxvY2F0aW9uLlxuICovXG5mdW5jdGlvbiBwdXNoKHBhcmVudCwgdmFsdWUpIHtcbiAgICBwYXJlbnQgPSBnZXRNb2R1bGFySW5zdGFuY2UocGFyZW50KTtcbiAgICB2YWxpZGF0ZVdyaXRhYmxlUGF0aCgncHVzaCcsIHBhcmVudC5fcGF0aCk7XG4gICAgdmFsaWRhdGVGaXJlYmFzZURhdGFBcmcoJ3B1c2gnLCB2YWx1ZSwgcGFyZW50Ll9wYXRoLCB0cnVlKTtcbiAgICBjb25zdCBub3cgPSByZXBvU2VydmVyVGltZShwYXJlbnQuX3JlcG8pO1xuICAgIGNvbnN0IG5hbWUgPSBuZXh0UHVzaElkKG5vdyk7XG4gICAgLy8gcHVzaCgpIHJldHVybnMgYSBUaGVubmFibGVSZWZlcmVuY2Ugd2hvc2UgcHJvbWlzZSBpcyBmdWxmaWxsZWQgd2l0aCBhXG4gICAgLy8gcmVndWxhciBSZWZlcmVuY2UuIFdlIHVzZSBjaGlsZCgpIHRvIGNyZWF0ZSBoYW5kbGVzIHRvIHR3byBkaWZmZXJlbnRcbiAgICAvLyByZWZlcmVuY2VzLiBUaGUgZmlyc3QgaXMgdHVybmVkIGludG8gYSBUaGVubmFibGVSZWZlcmVuY2UgYmVsb3cgYnkgYWRkaW5nXG4gICAgLy8gdGhlbigpIGFuZCBjYXRjaCgpIG1ldGhvZHMgYW5kIGlzIHVzZWQgYXMgdGhlIHJldHVybiB2YWx1ZSBvZiBwdXNoKCkuIFRoZVxuICAgIC8vIHNlY29uZCByZW1haW5zIGEgcmVndWxhciBSZWZlcmVuY2UgYW5kIGlzIHVzZWQgYXMgdGhlIGZ1bGZpbGxlZCB2YWx1ZSBvZlxuICAgIC8vIHRoZSBmaXJzdCBUaGVubmFibGVSZWZlcmVuY2UuXG4gICAgY29uc3QgdGhlbmFibGVQdXNoUmVmID0gY2hpbGQocGFyZW50LCBuYW1lKTtcbiAgICBjb25zdCBwdXNoUmVmID0gY2hpbGQocGFyZW50LCBuYW1lKTtcbiAgICBsZXQgcHJvbWlzZTtcbiAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICBwcm9taXNlID0gc2V0KHB1c2hSZWYsIHZhbHVlKS50aGVuKCgpID0+IHB1c2hSZWYpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZShwdXNoUmVmKTtcbiAgICB9XG4gICAgdGhlbmFibGVQdXNoUmVmLnRoZW4gPSBwcm9taXNlLnRoZW4uYmluZChwcm9taXNlKTtcbiAgICB0aGVuYWJsZVB1c2hSZWYuY2F0Y2ggPSBwcm9taXNlLnRoZW4uYmluZChwcm9taXNlLCB1bmRlZmluZWQpO1xuICAgIHJldHVybiB0aGVuYWJsZVB1c2hSZWY7XG59XG4vKipcbiAqIFJlbW92ZXMgdGhlIGRhdGEgYXQgdGhpcyBEYXRhYmFzZSBsb2NhdGlvbi5cbiAqXG4gKiBBbnkgZGF0YSBhdCBjaGlsZCBsb2NhdGlvbnMgd2lsbCBhbHNvIGJlIGRlbGV0ZWQuXG4gKlxuICogVGhlIGVmZmVjdCBvZiB0aGUgcmVtb3ZlIHdpbGwgYmUgdmlzaWJsZSBpbW1lZGlhdGVseSBhbmQgdGhlIGNvcnJlc3BvbmRpbmdcbiAqIGV2ZW50ICd2YWx1ZScgd2lsbCBiZSB0cmlnZ2VyZWQuIFN5bmNocm9uaXphdGlvbiBvZiB0aGUgcmVtb3ZlIHRvIHRoZVxuICogRmlyZWJhc2Ugc2VydmVycyB3aWxsIGFsc28gYmUgc3RhcnRlZCwgYW5kIHRoZSByZXR1cm5lZCBQcm9taXNlIHdpbGwgcmVzb2x2ZVxuICogd2hlbiBjb21wbGV0ZS4gSWYgcHJvdmlkZWQsIHRoZSBvbkNvbXBsZXRlIGNhbGxiYWNrIHdpbGwgYmUgY2FsbGVkXG4gKiBhc3luY2hyb25vdXNseSBhZnRlciBzeW5jaHJvbml6YXRpb24gaGFzIGZpbmlzaGVkLlxuICpcbiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gcmVtb3ZlLlxuICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiByZW1vdmUgb24gc2VydmVyIGlzIGNvbXBsZXRlLlxuICovXG5mdW5jdGlvbiByZW1vdmUocmVmKSB7XG4gICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ3JlbW92ZScsIHJlZi5fcGF0aCk7XG4gICAgcmV0dXJuIHNldChyZWYsIG51bGwpO1xufVxuLyoqXG4gKiBXcml0ZXMgZGF0YSB0byB0aGlzIERhdGFiYXNlIGxvY2F0aW9uLlxuICpcbiAqIFRoaXMgd2lsbCBvdmVyd3JpdGUgYW55IGRhdGEgYXQgdGhpcyBsb2NhdGlvbiBhbmQgYWxsIGNoaWxkIGxvY2F0aW9ucy5cbiAqXG4gKiBUaGUgZWZmZWN0IG9mIHRoZSB3cml0ZSB3aWxsIGJlIHZpc2libGUgaW1tZWRpYXRlbHksIGFuZCB0aGUgY29ycmVzcG9uZGluZ1xuICogZXZlbnRzIChcInZhbHVlXCIsIFwiY2hpbGRfYWRkZWRcIiwgZXRjLikgd2lsbCBiZSB0cmlnZ2VyZWQuIFN5bmNocm9uaXphdGlvbiBvZlxuICogdGhlIGRhdGEgdG8gdGhlIEZpcmViYXNlIHNlcnZlcnMgd2lsbCBhbHNvIGJlIHN0YXJ0ZWQsIGFuZCB0aGUgcmV0dXJuZWRcbiAqIFByb21pc2Ugd2lsbCByZXNvbHZlIHdoZW4gY29tcGxldGUuIElmIHByb3ZpZGVkLCB0aGUgYG9uQ29tcGxldGVgIGNhbGxiYWNrXG4gKiB3aWxsIGJlIGNhbGxlZCBhc3luY2hyb25vdXNseSBhZnRlciBzeW5jaHJvbml6YXRpb24gaGFzIGZpbmlzaGVkLlxuICpcbiAqIFBhc3NpbmcgYG51bGxgIGZvciB0aGUgbmV3IHZhbHVlIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZyBgcmVtb3ZlKClgOyBuYW1lbHksXG4gKiBhbGwgZGF0YSBhdCB0aGlzIGxvY2F0aW9uIGFuZCBhbGwgY2hpbGQgbG9jYXRpb25zIHdpbGwgYmUgZGVsZXRlZC5cbiAqXG4gKiBgc2V0KClgIHdpbGwgcmVtb3ZlIGFueSBwcmlvcml0eSBzdG9yZWQgYXQgdGhpcyBsb2NhdGlvbiwgc28gaWYgcHJpb3JpdHkgaXNcbiAqIG1lYW50IHRvIGJlIHByZXNlcnZlZCwgeW91IG5lZWQgdG8gdXNlIGBzZXRXaXRoUHJpb3JpdHkoKWAgaW5zdGVhZC5cbiAqXG4gKiBOb3RlIHRoYXQgbW9kaWZ5aW5nIGRhdGEgd2l0aCBgc2V0KClgIHdpbGwgY2FuY2VsIGFueSBwZW5kaW5nIHRyYW5zYWN0aW9uc1xuICogYXQgdGhhdCBsb2NhdGlvbiwgc28gZXh0cmVtZSBjYXJlIHNob3VsZCBiZSB0YWtlbiBpZiBtaXhpbmcgYHNldCgpYCBhbmRcbiAqIGB0cmFuc2FjdGlvbigpYCB0byBtb2RpZnkgdGhlIHNhbWUgZGF0YS5cbiAqXG4gKiBBIHNpbmdsZSBgc2V0KClgIHdpbGwgZ2VuZXJhdGUgYSBzaW5nbGUgXCJ2YWx1ZVwiIGV2ZW50IGF0IHRoZSBsb2NhdGlvbiB3aGVyZVxuICogdGhlIGBzZXQoKWAgd2FzIHBlcmZvcm1lZC5cbiAqXG4gKiBAcGFyYW0gcmVmIC0gVGhlIGxvY2F0aW9uIHRvIHdyaXRlIHRvLlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGJlIHdyaXR0ZW4gKHN0cmluZywgbnVtYmVyLCBib29sZWFuLCBvYmplY3QsXG4gKiAgIGFycmF5LCBvciBudWxsKS5cbiAqIEByZXR1cm5zIFJlc29sdmVzIHdoZW4gd3JpdGUgdG8gc2VydmVyIGlzIGNvbXBsZXRlLlxuICovXG5mdW5jdGlvbiBzZXQocmVmLCB2YWx1ZSkge1xuICAgIHJlZiA9IGdldE1vZHVsYXJJbnN0YW5jZShyZWYpO1xuICAgIHZhbGlkYXRlV3JpdGFibGVQYXRoKCdzZXQnLCByZWYuX3BhdGgpO1xuICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhQXJnKCdzZXQnLCB2YWx1ZSwgcmVmLl9wYXRoLCBmYWxzZSk7XG4gICAgY29uc3QgZGVmZXJyZWQgPSBuZXcgRGVmZXJyZWQoKTtcbiAgICByZXBvU2V0V2l0aFByaW9yaXR5KHJlZi5fcmVwbywgcmVmLl9wYXRoLCB2YWx1ZSwgXG4gICAgLypwcmlvcml0eT0qLyBudWxsLCBkZWZlcnJlZC53cmFwQ2FsbGJhY2soKCkgPT4geyB9KSk7XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG59XG4vKipcbiAqIFNldHMgYSBwcmlvcml0eSBmb3IgdGhlIGRhdGEgYXQgdGhpcyBEYXRhYmFzZSBsb2NhdGlvbi5cbiAqXG4gKiBBcHBsaWNhdGlvbnMgbmVlZCBub3QgdXNlIHByaW9yaXR5IGJ1dCBjYW4gb3JkZXIgY29sbGVjdGlvbnMgYnlcbiAqIG9yZGluYXJ5IHByb3BlcnRpZXMgKHNlZVxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI3NvcnRpbmdfYW5kX2ZpbHRlcmluZ19kYXRhIHwgU29ydGluZyBhbmQgZmlsdGVyaW5nIGRhdGF9XG4gKiApLlxuICpcbiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gd3JpdGUgdG8uXG4gKiBAcGFyYW0gcHJpb3JpdHkgLSBUaGUgcHJpb3JpdHkgdG8gYmUgd3JpdHRlbiAoc3RyaW5nLCBudW1iZXIsIG9yIG51bGwpLlxuICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiB3cml0ZSB0byBzZXJ2ZXIgaXMgY29tcGxldGUuXG4gKi9cbmZ1bmN0aW9uIHNldFByaW9yaXR5KHJlZiwgcHJpb3JpdHkpIHtcbiAgICByZWYgPSBnZXRNb2R1bGFySW5zdGFuY2UocmVmKTtcbiAgICB2YWxpZGF0ZVdyaXRhYmxlUGF0aCgnc2V0UHJpb3JpdHknLCByZWYuX3BhdGgpO1xuICAgIHZhbGlkYXRlUHJpb3JpdHkoJ3NldFByaW9yaXR5JywgcHJpb3JpdHksIGZhbHNlKTtcbiAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpO1xuICAgIHJlcG9TZXRXaXRoUHJpb3JpdHkocmVmLl9yZXBvLCBwYXRoQ2hpbGQocmVmLl9wYXRoLCAnLnByaW9yaXR5JyksIHByaW9yaXR5LCBudWxsLCBkZWZlcnJlZC53cmFwQ2FsbGJhY2soKCkgPT4geyB9KSk7XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG59XG4vKipcbiAqIFdyaXRlcyBkYXRhIHRoZSBEYXRhYmFzZSBsb2NhdGlvbi4gTGlrZSBgc2V0KClgIGJ1dCBhbHNvIHNwZWNpZmllcyB0aGVcbiAqIHByaW9yaXR5IGZvciB0aGF0IGRhdGEuXG4gKlxuICogQXBwbGljYXRpb25zIG5lZWQgbm90IHVzZSBwcmlvcml0eSBidXQgY2FuIG9yZGVyIGNvbGxlY3Rpb25zIGJ5XG4gKiBvcmRpbmFyeSBwcm9wZXJ0aWVzIChzZWVcbiAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9kYXRhYmFzZS93ZWIvbGlzdHMtb2YtZGF0YSNzb3J0aW5nX2FuZF9maWx0ZXJpbmdfZGF0YSB8IFNvcnRpbmcgYW5kIGZpbHRlcmluZyBkYXRhfVxuICogKS5cbiAqXG4gKiBAcGFyYW0gcmVmIC0gVGhlIGxvY2F0aW9uIHRvIHdyaXRlIHRvLlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGJlIHdyaXR0ZW4gKHN0cmluZywgbnVtYmVyLCBib29sZWFuLCBvYmplY3QsXG4gKiAgIGFycmF5LCBvciBudWxsKS5cbiAqIEBwYXJhbSBwcmlvcml0eSAtIFRoZSBwcmlvcml0eSB0byBiZSB3cml0dGVuIChzdHJpbmcsIG51bWJlciwgb3IgbnVsbCkuXG4gKiBAcmV0dXJucyBSZXNvbHZlcyB3aGVuIHdyaXRlIHRvIHNlcnZlciBpcyBjb21wbGV0ZS5cbiAqL1xuZnVuY3Rpb24gc2V0V2l0aFByaW9yaXR5KHJlZiwgdmFsdWUsIHByaW9yaXR5KSB7XG4gICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ3NldFdpdGhQcmlvcml0eScsIHJlZi5fcGF0aCk7XG4gICAgdmFsaWRhdGVGaXJlYmFzZURhdGFBcmcoJ3NldFdpdGhQcmlvcml0eScsIHZhbHVlLCByZWYuX3BhdGgsIGZhbHNlKTtcbiAgICB2YWxpZGF0ZVByaW9yaXR5KCdzZXRXaXRoUHJpb3JpdHknLCBwcmlvcml0eSwgZmFsc2UpO1xuICAgIGlmIChyZWYua2V5ID09PSAnLmxlbmd0aCcgfHwgcmVmLmtleSA9PT0gJy5rZXlzJykge1xuICAgICAgICB0aHJvdyAnc2V0V2l0aFByaW9yaXR5IGZhaWxlZDogJyArIHJlZi5rZXkgKyAnIGlzIGEgcmVhZC1vbmx5IG9iamVjdC4nO1xuICAgIH1cbiAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpO1xuICAgIHJlcG9TZXRXaXRoUHJpb3JpdHkocmVmLl9yZXBvLCByZWYuX3BhdGgsIHZhbHVlLCBwcmlvcml0eSwgZGVmZXJyZWQud3JhcENhbGxiYWNrKCgpID0+IHsgfSkpO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xufVxuLyoqXG4gKiBXcml0ZXMgbXVsdGlwbGUgdmFsdWVzIHRvIHRoZSBEYXRhYmFzZSBhdCBvbmNlLlxuICpcbiAqIFRoZSBgdmFsdWVzYCBhcmd1bWVudCBjb250YWlucyBtdWx0aXBsZSBwcm9wZXJ0eS12YWx1ZSBwYWlycyB0aGF0IHdpbGwgYmVcbiAqIHdyaXR0ZW4gdG8gdGhlIERhdGFiYXNlIHRvZ2V0aGVyLiBFYWNoIGNoaWxkIHByb3BlcnR5IGNhbiBlaXRoZXIgYmUgYSBzaW1wbGVcbiAqIHByb3BlcnR5IChmb3IgZXhhbXBsZSwgXCJuYW1lXCIpIG9yIGEgcmVsYXRpdmUgcGF0aCAoZm9yIGV4YW1wbGUsXG4gKiBcIm5hbWUvZmlyc3RcIikgZnJvbSB0aGUgY3VycmVudCBsb2NhdGlvbiB0byB0aGUgZGF0YSB0byB1cGRhdGUuXG4gKlxuICogQXMgb3Bwb3NlZCB0byB0aGUgYHNldCgpYCBtZXRob2QsIGB1cGRhdGUoKWAgY2FuIGJlIHVzZSB0byBzZWxlY3RpdmVseSB1cGRhdGVcbiAqIG9ubHkgdGhlIHJlZmVyZW5jZWQgcHJvcGVydGllcyBhdCB0aGUgY3VycmVudCBsb2NhdGlvbiAoaW5zdGVhZCBvZiByZXBsYWNpbmdcbiAqIGFsbCB0aGUgY2hpbGQgcHJvcGVydGllcyBhdCB0aGUgY3VycmVudCBsb2NhdGlvbikuXG4gKlxuICogVGhlIGVmZmVjdCBvZiB0aGUgd3JpdGUgd2lsbCBiZSB2aXNpYmxlIGltbWVkaWF0ZWx5LCBhbmQgdGhlIGNvcnJlc3BvbmRpbmdcbiAqIGV2ZW50cyAoJ3ZhbHVlJywgJ2NoaWxkX2FkZGVkJywgZXRjLikgd2lsbCBiZSB0cmlnZ2VyZWQuIFN5bmNocm9uaXphdGlvbiBvZlxuICogdGhlIGRhdGEgdG8gdGhlIEZpcmViYXNlIHNlcnZlcnMgd2lsbCBhbHNvIGJlIHN0YXJ0ZWQsIGFuZCB0aGUgcmV0dXJuZWRcbiAqIFByb21pc2Ugd2lsbCByZXNvbHZlIHdoZW4gY29tcGxldGUuIElmIHByb3ZpZGVkLCB0aGUgYG9uQ29tcGxldGVgIGNhbGxiYWNrXG4gKiB3aWxsIGJlIGNhbGxlZCBhc3luY2hyb25vdXNseSBhZnRlciBzeW5jaHJvbml6YXRpb24gaGFzIGZpbmlzaGVkLlxuICpcbiAqIEEgc2luZ2xlIGB1cGRhdGUoKWAgd2lsbCBnZW5lcmF0ZSBhIHNpbmdsZSBcInZhbHVlXCIgZXZlbnQgYXQgdGhlIGxvY2F0aW9uXG4gKiB3aGVyZSB0aGUgYHVwZGF0ZSgpYCB3YXMgcGVyZm9ybWVkLCByZWdhcmRsZXNzIG9mIGhvdyBtYW55IGNoaWxkcmVuIHdlcmVcbiAqIG1vZGlmaWVkLlxuICpcbiAqIE5vdGUgdGhhdCBtb2RpZnlpbmcgZGF0YSB3aXRoIGB1cGRhdGUoKWAgd2lsbCBjYW5jZWwgYW55IHBlbmRpbmdcbiAqIHRyYW5zYWN0aW9ucyBhdCB0aGF0IGxvY2F0aW9uLCBzbyBleHRyZW1lIGNhcmUgc2hvdWxkIGJlIHRha2VuIGlmIG1peGluZ1xuICogYHVwZGF0ZSgpYCBhbmQgYHRyYW5zYWN0aW9uKClgIHRvIG1vZGlmeSB0aGUgc2FtZSBkYXRhLlxuICpcbiAqIFBhc3NpbmcgYG51bGxgIHRvIGB1cGRhdGUoKWAgd2lsbCByZW1vdmUgdGhlIGRhdGEgYXQgdGhpcyBsb2NhdGlvbi5cbiAqXG4gKiBTZWVcbiAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZWJsb2cuY29tLzIwMTUvMDkvaW50cm9kdWNpbmctbXVsdGktbG9jYXRpb24tdXBkYXRlcy1hbmRfODYuaHRtbCB8IEludHJvZHVjaW5nIG11bHRpLWxvY2F0aW9uIHVwZGF0ZXMgYW5kIG1vcmV9LlxuICpcbiAqIEBwYXJhbSByZWYgLSBUaGUgbG9jYXRpb24gdG8gd3JpdGUgdG8uXG4gKiBAcGFyYW0gdmFsdWVzIC0gT2JqZWN0IGNvbnRhaW5pbmcgbXVsdGlwbGUgdmFsdWVzLlxuICogQHJldHVybnMgUmVzb2x2ZXMgd2hlbiB1cGRhdGUgb24gc2VydmVyIGlzIGNvbXBsZXRlLlxuICovXG5mdW5jdGlvbiB1cGRhdGUocmVmLCB2YWx1ZXMpIHtcbiAgICB2YWxpZGF0ZUZpcmViYXNlTWVyZ2VEYXRhQXJnKCd1cGRhdGUnLCB2YWx1ZXMsIHJlZi5fcGF0aCwgZmFsc2UpO1xuICAgIGNvbnN0IGRlZmVycmVkID0gbmV3IERlZmVycmVkKCk7XG4gICAgcmVwb1VwZGF0ZShyZWYuX3JlcG8sIHJlZi5fcGF0aCwgdmFsdWVzLCBkZWZlcnJlZC53cmFwQ2FsbGJhY2soKCkgPT4geyB9KSk7XG4gICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG59XG4vKipcbiAqIEdldHMgdGhlIG1vc3QgdXAtdG8tZGF0ZSByZXN1bHQgZm9yIHRoaXMgcXVlcnkuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIHF1ZXJ5IHRvIHJ1bi5cbiAqIEByZXR1cm5zIEEgYFByb21pc2VgIHdoaWNoIHJlc29sdmVzIHRvIHRoZSByZXN1bHRpbmcgRGF0YVNuYXBzaG90IGlmIGEgdmFsdWUgaXNcbiAqIGF2YWlsYWJsZSwgb3IgcmVqZWN0cyBpZiB0aGUgY2xpZW50IGlzIHVuYWJsZSB0byByZXR1cm4gYSB2YWx1ZSAoZS5nLiwgaWYgdGhlXG4gKiBzZXJ2ZXIgaXMgdW5yZWFjaGFibGUgYW5kIHRoZXJlIGlzIG5vdGhpbmcgY2FjaGVkKS5cbiAqL1xuZnVuY3Rpb24gZ2V0KHF1ZXJ5KSB7XG4gICAgcXVlcnkgPSBnZXRNb2R1bGFySW5zdGFuY2UocXVlcnkpO1xuICAgIGNvbnN0IGNhbGxiYWNrQ29udGV4dCA9IG5ldyBDYWxsYmFja0NvbnRleHQoKCkgPT4geyB9KTtcbiAgICBjb25zdCBjb250YWluZXIgPSBuZXcgVmFsdWVFdmVudFJlZ2lzdHJhdGlvbihjYWxsYmFja0NvbnRleHQpO1xuICAgIHJldHVybiByZXBvR2V0VmFsdWUocXVlcnkuX3JlcG8sIHF1ZXJ5LCBjb250YWluZXIpLnRoZW4obm9kZSA9PiB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0YVNuYXBzaG90KG5vZGUsIG5ldyBSZWZlcmVuY2VJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCksIHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpKTtcbiAgICB9KTtcbn1cbi8qKlxuICogUmVwcmVzZW50cyByZWdpc3RyYXRpb24gZm9yICd2YWx1ZScgZXZlbnRzLlxuICovXG5jbGFzcyBWYWx1ZUV2ZW50UmVnaXN0cmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihjYWxsYmFja0NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5jYWxsYmFja0NvbnRleHQgPSBjYWxsYmFja0NvbnRleHQ7XG4gICAgfVxuICAgIHJlc3BvbmRzVG8oZXZlbnRUeXBlKSB7XG4gICAgICAgIHJldHVybiBldmVudFR5cGUgPT09ICd2YWx1ZSc7XG4gICAgfVxuICAgIGNyZWF0ZUV2ZW50KGNoYW5nZSwgcXVlcnkpIHtcbiAgICAgICAgY29uc3QgaW5kZXggPSBxdWVyeS5fcXVlcnlQYXJhbXMuZ2V0SW5kZXgoKTtcbiAgICAgICAgcmV0dXJuIG5ldyBEYXRhRXZlbnQoJ3ZhbHVlJywgdGhpcywgbmV3IERhdGFTbmFwc2hvdChjaGFuZ2Uuc25hcHNob3ROb2RlLCBuZXcgUmVmZXJlbmNlSW1wbChxdWVyeS5fcmVwbywgcXVlcnkuX3BhdGgpLCBpbmRleCkpO1xuICAgIH1cbiAgICBnZXRFdmVudFJ1bm5lcihldmVudERhdGEpIHtcbiAgICAgICAgaWYgKGV2ZW50RGF0YS5nZXRFdmVudFR5cGUoKSA9PT0gJ2NhbmNlbCcpIHtcbiAgICAgICAgICAgIHJldHVybiAoKSA9PiB0aGlzLmNhbGxiYWNrQ29udGV4dC5vbkNhbmNlbChldmVudERhdGEuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICgpID0+IHRoaXMuY2FsbGJhY2tDb250ZXh0Lm9uVmFsdWUoZXZlbnREYXRhLnNuYXBzaG90LCBudWxsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjcmVhdGVDYW5jZWxFdmVudChlcnJvciwgcGF0aCkge1xuICAgICAgICBpZiAodGhpcy5jYWxsYmFja0NvbnRleHQuaGFzQ2FuY2VsQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2VsRXZlbnQodGhpcywgZXJyb3IsIHBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbWF0Y2hlcyhvdGhlcikge1xuICAgICAgICBpZiAoIShvdGhlciBpbnN0YW5jZW9mIFZhbHVlRXZlbnRSZWdpc3RyYXRpb24pKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIW90aGVyLmNhbGxiYWNrQ29udGV4dCB8fCAhdGhpcy5jYWxsYmFja0NvbnRleHQpIHtcbiAgICAgICAgICAgIC8vIElmIG5vIGNhbGxiYWNrIHNwZWNpZmllZCwgd2UgY29uc2lkZXIgaXQgdG8gbWF0Y2ggYW55IGNhbGxiYWNrLlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gb3RoZXIuY2FsbGJhY2tDb250ZXh0Lm1hdGNoZXModGhpcy5jYWxsYmFja0NvbnRleHQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhc0FueUNhbGxiYWNrKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxsYmFja0NvbnRleHQgIT09IG51bGw7XG4gICAgfVxufVxuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSByZWdpc3RyYXRpb24gb2YgYSBjaGlsZF94IGV2ZW50LlxuICovXG5jbGFzcyBDaGlsZEV2ZW50UmVnaXN0cmF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihldmVudFR5cGUsIGNhbGxiYWNrQ29udGV4dCkge1xuICAgICAgICB0aGlzLmV2ZW50VHlwZSA9IGV2ZW50VHlwZTtcbiAgICAgICAgdGhpcy5jYWxsYmFja0NvbnRleHQgPSBjYWxsYmFja0NvbnRleHQ7XG4gICAgfVxuICAgIHJlc3BvbmRzVG8oZXZlbnRUeXBlKSB7XG4gICAgICAgIGxldCBldmVudFRvQ2hlY2sgPSBldmVudFR5cGUgPT09ICdjaGlsZHJlbl9hZGRlZCcgPyAnY2hpbGRfYWRkZWQnIDogZXZlbnRUeXBlO1xuICAgICAgICBldmVudFRvQ2hlY2sgPVxuICAgICAgICAgICAgZXZlbnRUb0NoZWNrID09PSAnY2hpbGRyZW5fcmVtb3ZlZCcgPyAnY2hpbGRfcmVtb3ZlZCcgOiBldmVudFRvQ2hlY2s7XG4gICAgICAgIHJldHVybiB0aGlzLmV2ZW50VHlwZSA9PT0gZXZlbnRUb0NoZWNrO1xuICAgIH1cbiAgICBjcmVhdGVDYW5jZWxFdmVudChlcnJvciwgcGF0aCkge1xuICAgICAgICBpZiAodGhpcy5jYWxsYmFja0NvbnRleHQuaGFzQ2FuY2VsQ2FsbGJhY2spIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQ2FuY2VsRXZlbnQodGhpcywgZXJyb3IsIHBhdGgpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgIH1cbiAgICB9XG4gICAgY3JlYXRlRXZlbnQoY2hhbmdlLCBxdWVyeSkge1xuICAgICAgICBhc3NlcnQoY2hhbmdlLmNoaWxkTmFtZSAhPSBudWxsLCAnQ2hpbGQgZXZlbnRzIHNob3VsZCBoYXZlIGEgY2hpbGROYW1lLicpO1xuICAgICAgICBjb25zdCBjaGlsZFJlZiA9IGNoaWxkKG5ldyBSZWZlcmVuY2VJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCksIGNoYW5nZS5jaGlsZE5hbWUpO1xuICAgICAgICBjb25zdCBpbmRleCA9IHF1ZXJ5Ll9xdWVyeVBhcmFtcy5nZXRJbmRleCgpO1xuICAgICAgICByZXR1cm4gbmV3IERhdGFFdmVudChjaGFuZ2UudHlwZSwgdGhpcywgbmV3IERhdGFTbmFwc2hvdChjaGFuZ2Uuc25hcHNob3ROb2RlLCBjaGlsZFJlZiwgaW5kZXgpLCBjaGFuZ2UucHJldk5hbWUpO1xuICAgIH1cbiAgICBnZXRFdmVudFJ1bm5lcihldmVudERhdGEpIHtcbiAgICAgICAgaWYgKGV2ZW50RGF0YS5nZXRFdmVudFR5cGUoKSA9PT0gJ2NhbmNlbCcpIHtcbiAgICAgICAgICAgIHJldHVybiAoKSA9PiB0aGlzLmNhbGxiYWNrQ29udGV4dC5vbkNhbmNlbChldmVudERhdGEuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuICgpID0+IHRoaXMuY2FsbGJhY2tDb250ZXh0Lm9uVmFsdWUoZXZlbnREYXRhLnNuYXBzaG90LCBldmVudERhdGEucHJldk5hbWUpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG1hdGNoZXMob3RoZXIpIHtcbiAgICAgICAgaWYgKG90aGVyIGluc3RhbmNlb2YgQ2hpbGRFdmVudFJlZ2lzdHJhdGlvbikge1xuICAgICAgICAgICAgcmV0dXJuICh0aGlzLmV2ZW50VHlwZSA9PT0gb3RoZXIuZXZlbnRUeXBlICYmXG4gICAgICAgICAgICAgICAgKCF0aGlzLmNhbGxiYWNrQ29udGV4dCB8fFxuICAgICAgICAgICAgICAgICAgICAhb3RoZXIuY2FsbGJhY2tDb250ZXh0IHx8XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2FsbGJhY2tDb250ZXh0Lm1hdGNoZXMob3RoZXIuY2FsbGJhY2tDb250ZXh0KSkpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgaGFzQW55Q2FsbGJhY2soKSB7XG4gICAgICAgIHJldHVybiAhIXRoaXMuY2FsbGJhY2tDb250ZXh0O1xuICAgIH1cbn1cbmZ1bmN0aW9uIGFkZEV2ZW50TGlzdGVuZXIocXVlcnksIGV2ZW50VHlwZSwgY2FsbGJhY2ssIGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zLCBvcHRpb25zKSB7XG4gICAgbGV0IGNhbmNlbENhbGxiYWNrO1xuICAgIGlmICh0eXBlb2YgY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIGNhbmNlbENhbGxiYWNrID0gdW5kZWZpbmVkO1xuICAgICAgICBvcHRpb25zID0gY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnM7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnMgPT09ICdmdW5jdGlvbicpIHtcbiAgICAgICAgY2FuY2VsQ2FsbGJhY2sgPSBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucztcbiAgICB9XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5vbmx5T25jZSkge1xuICAgICAgICBjb25zdCB1c2VyQ2FsbGJhY2sgPSBjYWxsYmFjaztcbiAgICAgICAgY29uc3Qgb25jZUNhbGxiYWNrID0gKGRhdGFTbmFwc2hvdCwgcHJldmlvdXNDaGlsZE5hbWUpID0+IHtcbiAgICAgICAgICAgIHJlcG9SZW1vdmVFdmVudENhbGxiYWNrRm9yUXVlcnkocXVlcnkuX3JlcG8sIHF1ZXJ5LCBjb250YWluZXIpO1xuICAgICAgICAgICAgdXNlckNhbGxiYWNrKGRhdGFTbmFwc2hvdCwgcHJldmlvdXNDaGlsZE5hbWUpO1xuICAgICAgICB9O1xuICAgICAgICBvbmNlQ2FsbGJhY2sudXNlckNhbGxiYWNrID0gY2FsbGJhY2sudXNlckNhbGxiYWNrO1xuICAgICAgICBvbmNlQ2FsbGJhY2suY29udGV4dCA9IGNhbGxiYWNrLmNvbnRleHQ7XG4gICAgICAgIGNhbGxiYWNrID0gb25jZUNhbGxiYWNrO1xuICAgIH1cbiAgICBjb25zdCBjYWxsYmFja0NvbnRleHQgPSBuZXcgQ2FsbGJhY2tDb250ZXh0KGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFjayB8fCB1bmRlZmluZWQpO1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGV2ZW50VHlwZSA9PT0gJ3ZhbHVlJ1xuICAgICAgICA/IG5ldyBWYWx1ZUV2ZW50UmVnaXN0cmF0aW9uKGNhbGxiYWNrQ29udGV4dClcbiAgICAgICAgOiBuZXcgQ2hpbGRFdmVudFJlZ2lzdHJhdGlvbihldmVudFR5cGUsIGNhbGxiYWNrQ29udGV4dCk7XG4gICAgcmVwb0FkZEV2ZW50Q2FsbGJhY2tGb3JRdWVyeShxdWVyeS5fcmVwbywgcXVlcnksIGNvbnRhaW5lcik7XG4gICAgcmV0dXJuICgpID0+IHJlcG9SZW1vdmVFdmVudENhbGxiYWNrRm9yUXVlcnkocXVlcnkuX3JlcG8sIHF1ZXJ5LCBjb250YWluZXIpO1xufVxuZnVuY3Rpb24gb25WYWx1ZShxdWVyeSwgY2FsbGJhY2ssIGNhbmNlbENhbGxiYWNrT3JMaXN0ZW5PcHRpb25zLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGFkZEV2ZW50TGlzdGVuZXIocXVlcnksICd2YWx1ZScsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBvbkNoaWxkQWRkZWQocXVlcnksIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykge1xuICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyKHF1ZXJ5LCAnY2hpbGRfYWRkZWQnLCBjYWxsYmFjaywgY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnMsIG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gb25DaGlsZENoYW5nZWQocXVlcnksIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykge1xuICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyKHF1ZXJ5LCAnY2hpbGRfY2hhbmdlZCcsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucyk7XG59XG5mdW5jdGlvbiBvbkNoaWxkTW92ZWQocXVlcnksIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykge1xuICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyKHF1ZXJ5LCAnY2hpbGRfbW92ZWQnLCBjYWxsYmFjaywgY2FuY2VsQ2FsbGJhY2tPckxpc3Rlbk9wdGlvbnMsIG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gb25DaGlsZFJlbW92ZWQocXVlcnksIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucykge1xuICAgIHJldHVybiBhZGRFdmVudExpc3RlbmVyKHF1ZXJ5LCAnY2hpbGRfcmVtb3ZlZCcsIGNhbGxiYWNrLCBjYW5jZWxDYWxsYmFja09yTGlzdGVuT3B0aW9ucywgb3B0aW9ucyk7XG59XG4vKipcbiAqIERldGFjaGVzIGEgY2FsbGJhY2sgcHJldmlvdXNseSBhdHRhY2hlZCB3aXRoIHRoZSBjb3JyZXNwb25kaW5nIGBvbiooKWAgKGBvblZhbHVlYCwgYG9uQ2hpbGRBZGRlZGApIGxpc3RlbmVyLlxuICogTm90ZTogVGhpcyBpcyBub3QgdGhlIHJlY29tbWVuZGVkIHdheSB0byByZW1vdmUgYSBsaXN0ZW5lci4gSW5zdGVhZCwgcGxlYXNlIHVzZSB0aGUgcmV0dXJuZWQgY2FsbGJhY2sgZnVuY3Rpb24gZnJvbVxuICogdGhlIHJlc3BlY3RpdmUgYG9uKmAgY2FsbGJhY2tzLlxuICpcbiAqIERldGFjaCBhIGNhbGxiYWNrIHByZXZpb3VzbHkgYXR0YWNoZWQgd2l0aCBgb24qKClgLiBDYWxsaW5nIGBvZmYoKWAgb24gYSBwYXJlbnQgbGlzdGVuZXJcbiAqIHdpbGwgbm90IGF1dG9tYXRpY2FsbHkgcmVtb3ZlIGxpc3RlbmVycyByZWdpc3RlcmVkIG9uIGNoaWxkIG5vZGVzLCBgb2ZmKClgXG4gKiBtdXN0IGFsc28gYmUgY2FsbGVkIG9uIGFueSBjaGlsZCBsaXN0ZW5lcnMgdG8gcmVtb3ZlIHRoZSBjYWxsYmFjay5cbiAqXG4gKiBJZiBhIGNhbGxiYWNrIGlzIG5vdCBzcGVjaWZpZWQsIGFsbCBjYWxsYmFja3MgZm9yIHRoZSBzcGVjaWZpZWQgZXZlbnRUeXBlXG4gKiB3aWxsIGJlIHJlbW92ZWQuIFNpbWlsYXJseSwgaWYgbm8gZXZlbnRUeXBlIGlzIHNwZWNpZmllZCwgYWxsIGNhbGxiYWNrc1xuICogZm9yIHRoZSBgUmVmZXJlbmNlYCB3aWxsIGJlIHJlbW92ZWQuXG4gKlxuICogSW5kaXZpZHVhbCBsaXN0ZW5lcnMgY2FuIGFsc28gYmUgcmVtb3ZlZCBieSBpbnZva2luZyB0aGVpciB1bnN1YnNjcmliZVxuICogY2FsbGJhY2tzLlxuICpcbiAqIEBwYXJhbSBxdWVyeSAtIFRoZSBxdWVyeSB0aGF0IHRoZSBsaXN0ZW5lciB3YXMgcmVnaXN0ZXJlZCB3aXRoLlxuICogQHBhcmFtIGV2ZW50VHlwZSAtIE9uZSBvZiB0aGUgZm9sbG93aW5nIHN0cmluZ3M6IFwidmFsdWVcIiwgXCJjaGlsZF9hZGRlZFwiLFxuICogXCJjaGlsZF9jaGFuZ2VkXCIsIFwiY2hpbGRfcmVtb3ZlZFwiLCBvciBcImNoaWxkX21vdmVkLlwiIElmIG9taXR0ZWQsIGFsbCBjYWxsYmFja3NcbiAqIGZvciB0aGUgYFJlZmVyZW5jZWAgd2lsbCBiZSByZW1vdmVkLlxuICogQHBhcmFtIGNhbGxiYWNrIC0gVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2FzIHBhc3NlZCB0byBgb24oKWAgb3JcbiAqIGB1bmRlZmluZWRgIHRvIHJlbW92ZSBhbGwgY2FsbGJhY2tzLlxuICovXG5mdW5jdGlvbiBvZmYocXVlcnksIGV2ZW50VHlwZSwgY2FsbGJhY2spIHtcbiAgICBsZXQgY29udGFpbmVyID0gbnVsbDtcbiAgICBjb25zdCBleHBDYWxsYmFjayA9IGNhbGxiYWNrID8gbmV3IENhbGxiYWNrQ29udGV4dChjYWxsYmFjaykgOiBudWxsO1xuICAgIGlmIChldmVudFR5cGUgPT09ICd2YWx1ZScpIHtcbiAgICAgICAgY29udGFpbmVyID0gbmV3IFZhbHVlRXZlbnRSZWdpc3RyYXRpb24oZXhwQ2FsbGJhY2spO1xuICAgIH1cbiAgICBlbHNlIGlmIChldmVudFR5cGUpIHtcbiAgICAgICAgY29udGFpbmVyID0gbmV3IENoaWxkRXZlbnRSZWdpc3RyYXRpb24oZXZlbnRUeXBlLCBleHBDYWxsYmFjayk7XG4gICAgfVxuICAgIHJlcG9SZW1vdmVFdmVudENhbGxiYWNrRm9yUXVlcnkocXVlcnkuX3JlcG8sIHF1ZXJ5LCBjb250YWluZXIpO1xufVxuLyoqXG4gKiBBIGBRdWVyeUNvbnN0cmFpbnRgIGlzIHVzZWQgdG8gbmFycm93IHRoZSBzZXQgb2YgZG9jdW1lbnRzIHJldHVybmVkIGJ5IGFcbiAqIERhdGFiYXNlIHF1ZXJ5LiBgUXVlcnlDb25zdHJhaW50YHMgYXJlIGNyZWF0ZWQgYnkgaW52b2tpbmcge0BsaW5rIGVuZEF0fSxcbiAqIHtAbGluayBlbmRCZWZvcmV9LCB7QGxpbmsgc3RhcnRBdH0sIHtAbGluayBzdGFydEFmdGVyfSwge0BsaW5rXG4gKiBsaW1pdFRvRmlyc3R9LCB7QGxpbmsgbGltaXRUb0xhc3R9LCB7QGxpbmsgb3JkZXJCeUNoaWxkfSxcbiAqIHtAbGluayBvcmRlckJ5Q2hpbGR9LCB7QGxpbmsgb3JkZXJCeUtleX0gLCB7QGxpbmsgb3JkZXJCeVByaW9yaXR5fSAsXG4gKiB7QGxpbmsgb3JkZXJCeVZhbHVlfSAgb3Ige0BsaW5rIGVxdWFsVG99IGFuZFxuICogY2FuIHRoZW4gYmUgcGFzc2VkIHRvIHtAbGluayBxdWVyeX0gdG8gY3JlYXRlIGEgbmV3IHF1ZXJ5IGluc3RhbmNlIHRoYXRcbiAqIGFsc28gY29udGFpbnMgdGhpcyBgUXVlcnlDb25zdHJhaW50YC5cbiAqL1xuY2xhc3MgUXVlcnlDb25zdHJhaW50IHtcbn1cbmNsYXNzIFF1ZXJ5RW5kQXRDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICBjb25zdHJ1Y3RvcihfdmFsdWUsIF9rZXkpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSBfdmFsdWU7XG4gICAgICAgIHRoaXMuX2tleSA9IF9rZXk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdlbmRBdCc7XG4gICAgfVxuICAgIF9hcHBseShxdWVyeSkge1xuICAgICAgICB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZygnZW5kQXQnLCB0aGlzLl92YWx1ZSwgcXVlcnkuX3BhdGgsIHRydWUpO1xuICAgICAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtc0VuZEF0KHF1ZXJ5Ll9xdWVyeVBhcmFtcywgdGhpcy5fdmFsdWUsIHRoaXMuX2tleSk7XG4gICAgICAgIHZhbGlkYXRlTGltaXQobmV3UGFyYW1zKTtcbiAgICAgICAgdmFsaWRhdGVRdWVyeUVuZHBvaW50cyhuZXdQYXJhbXMpO1xuICAgICAgICBpZiAocXVlcnkuX3F1ZXJ5UGFyYW1zLmhhc0VuZCgpKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2VuZEF0OiBTdGFydGluZyBwb2ludCB3YXMgYWxyZWFkeSBzZXQgKGJ5IGFub3RoZXIgY2FsbCB0byBlbmRBdCwgJyArXG4gICAgICAgICAgICAgICAgJ2VuZEJlZm9yZSBvciBlcXVhbFRvKS4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5SW1wbChxdWVyeS5fcmVwbywgcXVlcnkuX3BhdGgsIG5ld1BhcmFtcywgcXVlcnkuX29yZGVyQnlDYWxsZWQpO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhIGBRdWVyeUNvbnN0cmFpbnRgIHdpdGggdGhlIHNwZWNpZmllZCBlbmRpbmcgcG9pbnQuXG4gKlxuICogVXNpbmcgYHN0YXJ0QXQoKWAsIGBzdGFydEFmdGVyKClgLCBgZW5kQmVmb3JlKClgLCBgZW5kQXQoKWAgYW5kIGBlcXVhbFRvKClgXG4gKiBhbGxvd3MgeW91IHRvIGNob29zZSBhcmJpdHJhcnkgc3RhcnRpbmcgYW5kIGVuZGluZyBwb2ludHMgZm9yIHlvdXIgcXVlcmllcy5cbiAqXG4gKiBUaGUgZW5kaW5nIHBvaW50IGlzIGluY2x1c2l2ZSwgc28gY2hpbGRyZW4gd2l0aCBleGFjdGx5IHRoZSBzcGVjaWZpZWQgdmFsdWVcbiAqIHdpbGwgYmUgaW5jbHVkZWQgaW4gdGhlIHF1ZXJ5LiBUaGUgb3B0aW9uYWwga2V5IGFyZ3VtZW50IGNhbiBiZSB1c2VkIHRvXG4gKiBmdXJ0aGVyIGxpbWl0IHRoZSByYW5nZSBvZiB0aGUgcXVlcnkuIElmIGl0IGlzIHNwZWNpZmllZCwgdGhlbiBjaGlsZHJlbiB0aGF0XG4gKiBoYXZlIGV4YWN0bHkgdGhlIHNwZWNpZmllZCB2YWx1ZSBtdXN0IGFsc28gaGF2ZSBhIGtleSBuYW1lIGxlc3MgdGhhbiBvciBlcXVhbFxuICogdG8gdGhlIHNwZWNpZmllZCBrZXkuXG4gKlxuICogWW91IGNhbiByZWFkIG1vcmUgYWJvdXQgYGVuZEF0KClgIGluXG4gKiB7QGxpbmsgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZGF0YWJhc2Uvd2ViL2xpc3RzLW9mLWRhdGEjZmlsdGVyaW5nX2RhdGEgfCBGaWx0ZXJpbmcgZGF0YX0uXG4gKlxuICogQHBhcmFtIHZhbHVlIC0gVGhlIHZhbHVlIHRvIGVuZCBhdC4gVGhlIGFyZ3VtZW50IHR5cGUgZGVwZW5kcyBvbiB3aGljaFxuICogYG9yZGVyQnkqKClgIGZ1bmN0aW9uIHdhcyB1c2VkIGluIHRoaXMgcXVlcnkuIFNwZWNpZnkgYSB2YWx1ZSB0aGF0IG1hdGNoZXNcbiAqIHRoZSBgb3JkZXJCeSooKWAgdHlwZS4gV2hlbiB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGggYG9yZGVyQnlLZXkoKWAsIHRoZVxuICogdmFsdWUgbXVzdCBiZSBhIHN0cmluZy5cbiAqIEBwYXJhbSBrZXkgLSBUaGUgY2hpbGQga2V5IHRvIGVuZCBhdCwgYW1vbmcgdGhlIGNoaWxkcmVuIHdpdGggdGhlIHByZXZpb3VzbHlcbiAqIHNwZWNpZmllZCBwcmlvcml0eS4gVGhpcyBhcmd1bWVudCBpcyBvbmx5IGFsbG93ZWQgaWYgb3JkZXJpbmcgYnkgY2hpbGQsXG4gKiB2YWx1ZSwgb3IgcHJpb3JpdHkuXG4gKi9cbmZ1bmN0aW9uIGVuZEF0KHZhbHVlLCBrZXkpIHtcbiAgICB2YWxpZGF0ZUtleSgnZW5kQXQnLCAna2V5Jywga2V5LCB0cnVlKTtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5RW5kQXRDb25zdHJhaW50KHZhbHVlLCBrZXkpO1xufVxuY2xhc3MgUXVlcnlFbmRCZWZvcmVDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICBjb25zdHJ1Y3RvcihfdmFsdWUsIF9rZXkpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSBfdmFsdWU7XG4gICAgICAgIHRoaXMuX2tleSA9IF9rZXk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdlbmRCZWZvcmUnO1xuICAgIH1cbiAgICBfYXBwbHkocXVlcnkpIHtcbiAgICAgICAgdmFsaWRhdGVGaXJlYmFzZURhdGFBcmcoJ2VuZEJlZm9yZScsIHRoaXMuX3ZhbHVlLCBxdWVyeS5fcGF0aCwgZmFsc2UpO1xuICAgICAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtc0VuZEJlZm9yZShxdWVyeS5fcXVlcnlQYXJhbXMsIHRoaXMuX3ZhbHVlLCB0aGlzLl9rZXkpO1xuICAgICAgICB2YWxpZGF0ZUxpbWl0KG5ld1BhcmFtcyk7XG4gICAgICAgIHZhbGlkYXRlUXVlcnlFbmRwb2ludHMobmV3UGFyYW1zKTtcbiAgICAgICAgaWYgKHF1ZXJ5Ll9xdWVyeVBhcmFtcy5oYXNFbmQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdlbmRCZWZvcmU6IFN0YXJ0aW5nIHBvaW50IHdhcyBhbHJlYWR5IHNldCAoYnkgYW5vdGhlciBjYWxsIHRvIGVuZEF0LCAnICtcbiAgICAgICAgICAgICAgICAnZW5kQmVmb3JlIG9yIGVxdWFsVG8pLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCwgbmV3UGFyYW1zLCBxdWVyeS5fb3JkZXJCeUNhbGxlZCk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGEgYFF1ZXJ5Q29uc3RyYWludGAgd2l0aCB0aGUgc3BlY2lmaWVkIGVuZGluZyBwb2ludCAoZXhjbHVzaXZlKS5cbiAqXG4gKiBVc2luZyBgc3RhcnRBdCgpYCwgYHN0YXJ0QWZ0ZXIoKWAsIGBlbmRCZWZvcmUoKWAsIGBlbmRBdCgpYCBhbmQgYGVxdWFsVG8oKWBcbiAqIGFsbG93cyB5b3UgdG8gY2hvb3NlIGFyYml0cmFyeSBzdGFydGluZyBhbmQgZW5kaW5nIHBvaW50cyBmb3IgeW91ciBxdWVyaWVzLlxuICpcbiAqIFRoZSBlbmRpbmcgcG9pbnQgaXMgZXhjbHVzaXZlLiBJZiBvbmx5IGEgdmFsdWUgaXMgcHJvdmlkZWQsIGNoaWxkcmVuXG4gKiB3aXRoIGEgdmFsdWUgbGVzcyB0aGFuIHRoZSBzcGVjaWZpZWQgdmFsdWUgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcXVlcnkuXG4gKiBJZiBhIGtleSBpcyBzcGVjaWZpZWQsIHRoZW4gY2hpbGRyZW4gbXVzdCBoYXZlIGEgdmFsdWUgbGVzcyB0aGFuIG9yIGVxdWFsXG4gKiB0byB0aGUgc3BlY2lmaWVkIHZhbHVlIGFuZCBhIGtleSBuYW1lIGxlc3MgdGhhbiB0aGUgc3BlY2lmaWVkIGtleS5cbiAqXG4gKiBAcGFyYW0gdmFsdWUgLSBUaGUgdmFsdWUgdG8gZW5kIGJlZm9yZS4gVGhlIGFyZ3VtZW50IHR5cGUgZGVwZW5kcyBvbiB3aGljaFxuICogYG9yZGVyQnkqKClgIGZ1bmN0aW9uIHdhcyB1c2VkIGluIHRoaXMgcXVlcnkuIFNwZWNpZnkgYSB2YWx1ZSB0aGF0IG1hdGNoZXNcbiAqIHRoZSBgb3JkZXJCeSooKWAgdHlwZS4gV2hlbiB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGggYG9yZGVyQnlLZXkoKWAsIHRoZVxuICogdmFsdWUgbXVzdCBiZSBhIHN0cmluZy5cbiAqIEBwYXJhbSBrZXkgLSBUaGUgY2hpbGQga2V5IHRvIGVuZCBiZWZvcmUsIGFtb25nIHRoZSBjaGlsZHJlbiB3aXRoIHRoZVxuICogcHJldmlvdXNseSBzcGVjaWZpZWQgcHJpb3JpdHkuIFRoaXMgYXJndW1lbnQgaXMgb25seSBhbGxvd2VkIGlmIG9yZGVyaW5nIGJ5XG4gKiBjaGlsZCwgdmFsdWUsIG9yIHByaW9yaXR5LlxuICovXG5mdW5jdGlvbiBlbmRCZWZvcmUodmFsdWUsIGtleSkge1xuICAgIHZhbGlkYXRlS2V5KCdlbmRCZWZvcmUnLCAna2V5Jywga2V5LCB0cnVlKTtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5RW5kQmVmb3JlQ29uc3RyYWludCh2YWx1ZSwga2V5KTtcbn1cbmNsYXNzIFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIGNvbnN0cnVjdG9yKF92YWx1ZSwgX2tleSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl92YWx1ZSA9IF92YWx1ZTtcbiAgICAgICAgdGhpcy5fa2V5ID0gX2tleTtcbiAgICAgICAgdGhpcy50eXBlID0gJ3N0YXJ0QXQnO1xuICAgIH1cbiAgICBfYXBwbHkocXVlcnkpIHtcbiAgICAgICAgdmFsaWRhdGVGaXJlYmFzZURhdGFBcmcoJ3N0YXJ0QXQnLCB0aGlzLl92YWx1ZSwgcXVlcnkuX3BhdGgsIHRydWUpO1xuICAgICAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtc1N0YXJ0QXQocXVlcnkuX3F1ZXJ5UGFyYW1zLCB0aGlzLl92YWx1ZSwgdGhpcy5fa2V5KTtcbiAgICAgICAgdmFsaWRhdGVMaW1pdChuZXdQYXJhbXMpO1xuICAgICAgICB2YWxpZGF0ZVF1ZXJ5RW5kcG9pbnRzKG5ld1BhcmFtcyk7XG4gICAgICAgIGlmIChxdWVyeS5fcXVlcnlQYXJhbXMuaGFzU3RhcnQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdGFydEF0OiBTdGFydGluZyBwb2ludCB3YXMgYWxyZWFkeSBzZXQgKGJ5IGFub3RoZXIgY2FsbCB0byBzdGFydEF0LCAnICtcbiAgICAgICAgICAgICAgICAnc3RhcnRCZWZvcmUgb3IgZXF1YWxUbykuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUltcGwocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoLCBuZXdQYXJhbXMsIHF1ZXJ5Ll9vcmRlckJ5Q2FsbGVkKTtcbiAgICB9XG59XG4vKipcbiAqIENyZWF0ZXMgYSBgUXVlcnlDb25zdHJhaW50YCB3aXRoIHRoZSBzcGVjaWZpZWQgc3RhcnRpbmcgcG9pbnQuXG4gKlxuICogVXNpbmcgYHN0YXJ0QXQoKWAsIGBzdGFydEFmdGVyKClgLCBgZW5kQmVmb3JlKClgLCBgZW5kQXQoKWAgYW5kIGBlcXVhbFRvKClgXG4gKiBhbGxvd3MgeW91IHRvIGNob29zZSBhcmJpdHJhcnkgc3RhcnRpbmcgYW5kIGVuZGluZyBwb2ludHMgZm9yIHlvdXIgcXVlcmllcy5cbiAqXG4gKiBUaGUgc3RhcnRpbmcgcG9pbnQgaXMgaW5jbHVzaXZlLCBzbyBjaGlsZHJlbiB3aXRoIGV4YWN0bHkgdGhlIHNwZWNpZmllZCB2YWx1ZVxuICogd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcXVlcnkuIFRoZSBvcHRpb25hbCBrZXkgYXJndW1lbnQgY2FuIGJlIHVzZWQgdG9cbiAqIGZ1cnRoZXIgbGltaXQgdGhlIHJhbmdlIG9mIHRoZSBxdWVyeS4gSWYgaXQgaXMgc3BlY2lmaWVkLCB0aGVuIGNoaWxkcmVuIHRoYXRcbiAqIGhhdmUgZXhhY3RseSB0aGUgc3BlY2lmaWVkIHZhbHVlIG11c3QgYWxzbyBoYXZlIGEga2V5IG5hbWUgZ3JlYXRlciB0aGFuIG9yXG4gKiBlcXVhbCB0byB0aGUgc3BlY2lmaWVkIGtleS5cbiAqXG4gKiBZb3UgY2FuIHJlYWQgbW9yZSBhYm91dCBgc3RhcnRBdCgpYCBpblxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI2ZpbHRlcmluZ19kYXRhIHwgRmlsdGVyaW5nIGRhdGF9LlxuICpcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzdGFydCBhdC4gVGhlIGFyZ3VtZW50IHR5cGUgZGVwZW5kcyBvbiB3aGljaFxuICogYG9yZGVyQnkqKClgIGZ1bmN0aW9uIHdhcyB1c2VkIGluIHRoaXMgcXVlcnkuIFNwZWNpZnkgYSB2YWx1ZSB0aGF0IG1hdGNoZXNcbiAqIHRoZSBgb3JkZXJCeSooKWAgdHlwZS4gV2hlbiB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGggYG9yZGVyQnlLZXkoKWAsIHRoZVxuICogdmFsdWUgbXVzdCBiZSBhIHN0cmluZy5cbiAqIEBwYXJhbSBrZXkgLSBUaGUgY2hpbGQga2V5IHRvIHN0YXJ0IGF0LiBUaGlzIGFyZ3VtZW50IGlzIG9ubHkgYWxsb3dlZCBpZlxuICogb3JkZXJpbmcgYnkgY2hpbGQsIHZhbHVlLCBvciBwcmlvcml0eS5cbiAqL1xuZnVuY3Rpb24gc3RhcnRBdCh2YWx1ZSA9IG51bGwsIGtleSkge1xuICAgIHZhbGlkYXRlS2V5KCdzdGFydEF0JywgJ2tleScsIGtleSwgdHJ1ZSk7XG4gICAgcmV0dXJuIG5ldyBRdWVyeVN0YXJ0QXRDb25zdHJhaW50KHZhbHVlLCBrZXkpO1xufVxuY2xhc3MgUXVlcnlTdGFydEFmdGVyQ29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgY29uc3RydWN0b3IoX3ZhbHVlLCBfa2V5KSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX3ZhbHVlID0gX3ZhbHVlO1xuICAgICAgICB0aGlzLl9rZXkgPSBfa2V5O1xuICAgICAgICB0aGlzLnR5cGUgPSAnc3RhcnRBZnRlcic7XG4gICAgfVxuICAgIF9hcHBseShxdWVyeSkge1xuICAgICAgICB2YWxpZGF0ZUZpcmViYXNlRGF0YUFyZygnc3RhcnRBZnRlcicsIHRoaXMuX3ZhbHVlLCBxdWVyeS5fcGF0aCwgZmFsc2UpO1xuICAgICAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtc1N0YXJ0QWZ0ZXIocXVlcnkuX3F1ZXJ5UGFyYW1zLCB0aGlzLl92YWx1ZSwgdGhpcy5fa2V5KTtcbiAgICAgICAgdmFsaWRhdGVMaW1pdChuZXdQYXJhbXMpO1xuICAgICAgICB2YWxpZGF0ZVF1ZXJ5RW5kcG9pbnRzKG5ld1BhcmFtcyk7XG4gICAgICAgIGlmIChxdWVyeS5fcXVlcnlQYXJhbXMuaGFzU3RhcnQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdzdGFydEFmdGVyOiBTdGFydGluZyBwb2ludCB3YXMgYWxyZWFkeSBzZXQgKGJ5IGFub3RoZXIgY2FsbCB0byBzdGFydEF0LCAnICtcbiAgICAgICAgICAgICAgICAnc3RhcnRBZnRlciwgb3IgZXF1YWxUbykuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUltcGwocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoLCBuZXdQYXJhbXMsIHF1ZXJ5Ll9vcmRlckJ5Q2FsbGVkKTtcbiAgICB9XG59XG4vKipcbiAqIENyZWF0ZXMgYSBgUXVlcnlDb25zdHJhaW50YCB3aXRoIHRoZSBzcGVjaWZpZWQgc3RhcnRpbmcgcG9pbnQgKGV4Y2x1c2l2ZSkuXG4gKlxuICogVXNpbmcgYHN0YXJ0QXQoKWAsIGBzdGFydEFmdGVyKClgLCBgZW5kQmVmb3JlKClgLCBgZW5kQXQoKWAgYW5kIGBlcXVhbFRvKClgXG4gKiBhbGxvd3MgeW91IHRvIGNob29zZSBhcmJpdHJhcnkgc3RhcnRpbmcgYW5kIGVuZGluZyBwb2ludHMgZm9yIHlvdXIgcXVlcmllcy5cbiAqXG4gKiBUaGUgc3RhcnRpbmcgcG9pbnQgaXMgZXhjbHVzaXZlLiBJZiBvbmx5IGEgdmFsdWUgaXMgcHJvdmlkZWQsIGNoaWxkcmVuXG4gKiB3aXRoIGEgdmFsdWUgZ3JlYXRlciB0aGFuIHRoZSBzcGVjaWZpZWQgdmFsdWUgd2lsbCBiZSBpbmNsdWRlZCBpbiB0aGUgcXVlcnkuXG4gKiBJZiBhIGtleSBpcyBzcGVjaWZpZWQsIHRoZW4gY2hpbGRyZW4gbXVzdCBoYXZlIGEgdmFsdWUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsXG4gKiB0byB0aGUgc3BlY2lmaWVkIHZhbHVlIGFuZCBhIGEga2V5IG5hbWUgZ3JlYXRlciB0aGFuIHRoZSBzcGVjaWZpZWQga2V5LlxuICpcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBzdGFydCBhZnRlci4gVGhlIGFyZ3VtZW50IHR5cGUgZGVwZW5kcyBvbiB3aGljaFxuICogYG9yZGVyQnkqKClgIGZ1bmN0aW9uIHdhcyB1c2VkIGluIHRoaXMgcXVlcnkuIFNwZWNpZnkgYSB2YWx1ZSB0aGF0IG1hdGNoZXNcbiAqIHRoZSBgb3JkZXJCeSooKWAgdHlwZS4gV2hlbiB1c2VkIGluIGNvbWJpbmF0aW9uIHdpdGggYG9yZGVyQnlLZXkoKWAsIHRoZVxuICogdmFsdWUgbXVzdCBiZSBhIHN0cmluZy5cbiAqIEBwYXJhbSBrZXkgLSBUaGUgY2hpbGQga2V5IHRvIHN0YXJ0IGFmdGVyLiBUaGlzIGFyZ3VtZW50IGlzIG9ubHkgYWxsb3dlZCBpZlxuICogb3JkZXJpbmcgYnkgY2hpbGQsIHZhbHVlLCBvciBwcmlvcml0eS5cbiAqL1xuZnVuY3Rpb24gc3RhcnRBZnRlcih2YWx1ZSwga2V5KSB7XG4gICAgdmFsaWRhdGVLZXkoJ3N0YXJ0QWZ0ZXInLCAna2V5Jywga2V5LCB0cnVlKTtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5U3RhcnRBZnRlckNvbnN0cmFpbnQodmFsdWUsIGtleSk7XG59XG5jbGFzcyBRdWVyeUxpbWl0VG9GaXJzdENvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIGNvbnN0cnVjdG9yKF9saW1pdCkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLl9saW1pdCA9IF9saW1pdDtcbiAgICAgICAgdGhpcy50eXBlID0gJ2xpbWl0VG9GaXJzdCc7XG4gICAgfVxuICAgIF9hcHBseShxdWVyeSkge1xuICAgICAgICBpZiAocXVlcnkuX3F1ZXJ5UGFyYW1zLmhhc0xpbWl0KCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbGltaXRUb0ZpcnN0OiBMaW1pdCB3YXMgYWxyZWFkeSBzZXQgKGJ5IGFub3RoZXIgY2FsbCB0byBsaW1pdFRvRmlyc3QgJyArXG4gICAgICAgICAgICAgICAgJ29yIGxpbWl0VG9MYXN0KS4nKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IFF1ZXJ5SW1wbChxdWVyeS5fcmVwbywgcXVlcnkuX3BhdGgsIHF1ZXJ5UGFyYW1zTGltaXRUb0ZpcnN0KHF1ZXJ5Ll9xdWVyeVBhcmFtcywgdGhpcy5fbGltaXQpLCBxdWVyeS5fb3JkZXJCeUNhbGxlZCk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBRdWVyeUNvbnN0cmFpbnRgIHRoYXQgaWYgbGltaXRlZCB0byB0aGUgZmlyc3Qgc3BlY2lmaWMgbnVtYmVyXG4gKiBvZiBjaGlsZHJlbi5cbiAqXG4gKiBUaGUgYGxpbWl0VG9GaXJzdCgpYCBtZXRob2QgaXMgdXNlZCB0byBzZXQgYSBtYXhpbXVtIG51bWJlciBvZiBjaGlsZHJlbiB0byBiZVxuICogc3luY2VkIGZvciBhIGdpdmVuIGNhbGxiYWNrLiBJZiB3ZSBzZXQgYSBsaW1pdCBvZiAxMDAsIHdlIHdpbGwgaW5pdGlhbGx5IG9ubHlcbiAqIHJlY2VpdmUgdXAgdG8gMTAwIGBjaGlsZF9hZGRlZGAgZXZlbnRzLiBJZiB3ZSBoYXZlIGZld2VyIHRoYW4gMTAwIG1lc3NhZ2VzXG4gKiBzdG9yZWQgaW4gb3VyIERhdGFiYXNlLCBhIGBjaGlsZF9hZGRlZGAgZXZlbnQgd2lsbCBmaXJlIGZvciBlYWNoIG1lc3NhZ2UuXG4gKiBIb3dldmVyLCBpZiB3ZSBoYXZlIG92ZXIgMTAwIG1lc3NhZ2VzLCB3ZSB3aWxsIG9ubHkgcmVjZWl2ZSBhIGBjaGlsZF9hZGRlZGBcbiAqIGV2ZW50IGZvciB0aGUgZmlyc3QgMTAwIG9yZGVyZWQgbWVzc2FnZXMuIEFzIGl0ZW1zIGNoYW5nZSwgd2Ugd2lsbCByZWNlaXZlXG4gKiBgY2hpbGRfcmVtb3ZlZGAgZXZlbnRzIGZvciBlYWNoIGl0ZW0gdGhhdCBkcm9wcyBvdXQgb2YgdGhlIGFjdGl2ZSBsaXN0IHNvXG4gKiB0aGF0IHRoZSB0b3RhbCBudW1iZXIgc3RheXMgYXQgMTAwLlxuICpcbiAqIFlvdSBjYW4gcmVhZCBtb3JlIGFib3V0IGBsaW1pdFRvRmlyc3QoKWAgaW5cbiAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9kYXRhYmFzZS93ZWIvbGlzdHMtb2YtZGF0YSNmaWx0ZXJpbmdfZGF0YSB8IEZpbHRlcmluZyBkYXRhfS5cbiAqXG4gKiBAcGFyYW0gbGltaXQgLSBUaGUgbWF4aW11bSBudW1iZXIgb2Ygbm9kZXMgdG8gaW5jbHVkZSBpbiB0aGlzIHF1ZXJ5LlxuICovXG5mdW5jdGlvbiBsaW1pdFRvRmlyc3QobGltaXQpIHtcbiAgICBpZiAodHlwZW9mIGxpbWl0ICE9PSAnbnVtYmVyJyB8fCBNYXRoLmZsb29yKGxpbWl0KSAhPT0gbGltaXQgfHwgbGltaXQgPD0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2xpbWl0VG9GaXJzdDogRmlyc3QgYXJndW1lbnQgbXVzdCBiZSBhIHBvc2l0aXZlIGludGVnZXIuJyk7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUXVlcnlMaW1pdFRvRmlyc3RDb25zdHJhaW50KGxpbWl0KTtcbn1cbmNsYXNzIFF1ZXJ5TGltaXRUb0xhc3RDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICBjb25zdHJ1Y3RvcihfbGltaXQpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fbGltaXQgPSBfbGltaXQ7XG4gICAgICAgIHRoaXMudHlwZSA9ICdsaW1pdFRvTGFzdCc7XG4gICAgfVxuICAgIF9hcHBseShxdWVyeSkge1xuICAgICAgICBpZiAocXVlcnkuX3F1ZXJ5UGFyYW1zLmhhc0xpbWl0KCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignbGltaXRUb0xhc3Q6IExpbWl0IHdhcyBhbHJlYWR5IHNldCAoYnkgYW5vdGhlciBjYWxsIHRvIGxpbWl0VG9GaXJzdCAnICtcbiAgICAgICAgICAgICAgICAnb3IgbGltaXRUb0xhc3QpLicpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCwgcXVlcnlQYXJhbXNMaW1pdFRvTGFzdChxdWVyeS5fcXVlcnlQYXJhbXMsIHRoaXMuX2xpbWl0KSwgcXVlcnkuX29yZGVyQnlDYWxsZWQpO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgUXVlcnlDb25zdHJhaW50YCB0aGF0IGlzIGxpbWl0ZWQgdG8gcmV0dXJuIG9ubHkgdGhlIGxhc3RcbiAqIHNwZWNpZmllZCBudW1iZXIgb2YgY2hpbGRyZW4uXG4gKlxuICogVGhlIGBsaW1pdFRvTGFzdCgpYCBtZXRob2QgaXMgdXNlZCB0byBzZXQgYSBtYXhpbXVtIG51bWJlciBvZiBjaGlsZHJlbiB0byBiZVxuICogc3luY2VkIGZvciBhIGdpdmVuIGNhbGxiYWNrLiBJZiB3ZSBzZXQgYSBsaW1pdCBvZiAxMDAsIHdlIHdpbGwgaW5pdGlhbGx5IG9ubHlcbiAqIHJlY2VpdmUgdXAgdG8gMTAwIGBjaGlsZF9hZGRlZGAgZXZlbnRzLiBJZiB3ZSBoYXZlIGZld2VyIHRoYW4gMTAwIG1lc3NhZ2VzXG4gKiBzdG9yZWQgaW4gb3VyIERhdGFiYXNlLCBhIGBjaGlsZF9hZGRlZGAgZXZlbnQgd2lsbCBmaXJlIGZvciBlYWNoIG1lc3NhZ2UuXG4gKiBIb3dldmVyLCBpZiB3ZSBoYXZlIG92ZXIgMTAwIG1lc3NhZ2VzLCB3ZSB3aWxsIG9ubHkgcmVjZWl2ZSBhIGBjaGlsZF9hZGRlZGBcbiAqIGV2ZW50IGZvciB0aGUgbGFzdCAxMDAgb3JkZXJlZCBtZXNzYWdlcy4gQXMgaXRlbXMgY2hhbmdlLCB3ZSB3aWxsIHJlY2VpdmVcbiAqIGBjaGlsZF9yZW1vdmVkYCBldmVudHMgZm9yIGVhY2ggaXRlbSB0aGF0IGRyb3BzIG91dCBvZiB0aGUgYWN0aXZlIGxpc3Qgc29cbiAqIHRoYXQgdGhlIHRvdGFsIG51bWJlciBzdGF5cyBhdCAxMDAuXG4gKlxuICogWW91IGNhbiByZWFkIG1vcmUgYWJvdXQgYGxpbWl0VG9MYXN0KClgIGluXG4gKiB7QGxpbmsgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZGF0YWJhc2Uvd2ViL2xpc3RzLW9mLWRhdGEjZmlsdGVyaW5nX2RhdGEgfCBGaWx0ZXJpbmcgZGF0YX0uXG4gKlxuICogQHBhcmFtIGxpbWl0IC0gVGhlIG1heGltdW0gbnVtYmVyIG9mIG5vZGVzIHRvIGluY2x1ZGUgaW4gdGhpcyBxdWVyeS5cbiAqL1xuZnVuY3Rpb24gbGltaXRUb0xhc3QobGltaXQpIHtcbiAgICBpZiAodHlwZW9mIGxpbWl0ICE9PSAnbnVtYmVyJyB8fCBNYXRoLmZsb29yKGxpbWl0KSAhPT0gbGltaXQgfHwgbGltaXQgPD0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2xpbWl0VG9MYXN0OiBGaXJzdCBhcmd1bWVudCBtdXN0IGJlIGEgcG9zaXRpdmUgaW50ZWdlci4nKTtcbiAgICB9XG4gICAgcmV0dXJuIG5ldyBRdWVyeUxpbWl0VG9MYXN0Q29uc3RyYWludChsaW1pdCk7XG59XG5jbGFzcyBRdWVyeU9yZGVyQnlDaGlsZENvbnN0cmFpbnQgZXh0ZW5kcyBRdWVyeUNvbnN0cmFpbnQge1xuICAgIGNvbnN0cnVjdG9yKF9wYXRoKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuX3BhdGggPSBfcGF0aDtcbiAgICAgICAgdGhpcy50eXBlID0gJ29yZGVyQnlDaGlsZCc7XG4gICAgfVxuICAgIF9hcHBseShxdWVyeSkge1xuICAgICAgICB2YWxpZGF0ZU5vUHJldmlvdXNPcmRlckJ5Q2FsbChxdWVyeSwgJ29yZGVyQnlDaGlsZCcpO1xuICAgICAgICBjb25zdCBwYXJzZWRQYXRoID0gbmV3IFBhdGgodGhpcy5fcGF0aCk7XG4gICAgICAgIGlmIChwYXRoSXNFbXB0eShwYXJzZWRQYXRoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdvcmRlckJ5Q2hpbGQ6IGNhbm5vdCBwYXNzIGluIGVtcHR5IHBhdGguIFVzZSBvcmRlckJ5VmFsdWUoKSBpbnN0ZWFkLicpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IGluZGV4ID0gbmV3IFBhdGhJbmRleChwYXJzZWRQYXRoKTtcbiAgICAgICAgY29uc3QgbmV3UGFyYW1zID0gcXVlcnlQYXJhbXNPcmRlckJ5KHF1ZXJ5Ll9xdWVyeVBhcmFtcywgaW5kZXgpO1xuICAgICAgICB2YWxpZGF0ZVF1ZXJ5RW5kcG9pbnRzKG5ld1BhcmFtcyk7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCwgbmV3UGFyYW1zLCBcbiAgICAgICAgLypvcmRlckJ5Q2FsbGVkPSovIHRydWUpO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgUXVlcnlDb25zdHJhaW50YCB0aGF0IG9yZGVycyBieSB0aGUgc3BlY2lmaWVkIGNoaWxkIGtleS5cbiAqXG4gKiBRdWVyaWVzIGNhbiBvbmx5IG9yZGVyIGJ5IG9uZSBrZXkgYXQgYSB0aW1lLiBDYWxsaW5nIGBvcmRlckJ5Q2hpbGQoKWBcbiAqIG11bHRpcGxlIHRpbWVzIG9uIHRoZSBzYW1lIHF1ZXJ5IGlzIGFuIGVycm9yLlxuICpcbiAqIEZpcmViYXNlIHF1ZXJpZXMgYWxsb3cgeW91IHRvIG9yZGVyIHlvdXIgZGF0YSBieSBhbnkgY2hpbGQga2V5IG9uIHRoZSBmbHkuXG4gKiBIb3dldmVyLCBpZiB5b3Uga25vdyBpbiBhZHZhbmNlIHdoYXQgeW91ciBpbmRleGVzIHdpbGwgYmUsIHlvdSBjYW4gZGVmaW5lXG4gKiB0aGVtIHZpYSB0aGUgLmluZGV4T24gcnVsZSBpbiB5b3VyIFNlY3VyaXR5IFJ1bGVzIGZvciBiZXR0ZXIgcGVyZm9ybWFuY2UuIFNlZVxuICogdGhle0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3NlY3VyaXR5L2luZGV4aW5nLWRhdGF9XG4gKiBydWxlIGZvciBtb3JlIGluZm9ybWF0aW9uLlxuICpcbiAqIFlvdSBjYW4gcmVhZCBtb3JlIGFib3V0IGBvcmRlckJ5Q2hpbGQoKWAgaW5cbiAqIHtAbGluayBodHRwczovL2ZpcmViYXNlLmdvb2dsZS5jb20vZG9jcy9kYXRhYmFzZS93ZWIvbGlzdHMtb2YtZGF0YSNzb3J0X2RhdGEgfCBTb3J0IGRhdGF9LlxuICpcbiAqIEBwYXJhbSBwYXRoIC0gVGhlIHBhdGggdG8gb3JkZXIgYnkuXG4gKi9cbmZ1bmN0aW9uIG9yZGVyQnlDaGlsZChwYXRoKSB7XG4gICAgaWYgKHBhdGggPT09ICcka2V5Jykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29yZGVyQnlDaGlsZDogXCIka2V5XCIgaXMgaW52YWxpZC4gIFVzZSBvcmRlckJ5S2V5KCkgaW5zdGVhZC4nKTtcbiAgICB9XG4gICAgZWxzZSBpZiAocGF0aCA9PT0gJyRwcmlvcml0eScpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdvcmRlckJ5Q2hpbGQ6IFwiJHByaW9yaXR5XCIgaXMgaW52YWxpZC4gIFVzZSBvcmRlckJ5UHJpb3JpdHkoKSBpbnN0ZWFkLicpO1xuICAgIH1cbiAgICBlbHNlIGlmIChwYXRoID09PSAnJHZhbHVlJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29yZGVyQnlDaGlsZDogXCIkdmFsdWVcIiBpcyBpbnZhbGlkLiAgVXNlIG9yZGVyQnlWYWx1ZSgpIGluc3RlYWQuJyk7XG4gICAgfVxuICAgIHZhbGlkYXRlUGF0aFN0cmluZygnb3JkZXJCeUNoaWxkJywgJ3BhdGgnLCBwYXRoLCBmYWxzZSk7XG4gICAgcmV0dXJuIG5ldyBRdWVyeU9yZGVyQnlDaGlsZENvbnN0cmFpbnQocGF0aCk7XG59XG5jbGFzcyBRdWVyeU9yZGVyQnlLZXlDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50eXBlID0gJ29yZGVyQnlLZXknO1xuICAgIH1cbiAgICBfYXBwbHkocXVlcnkpIHtcbiAgICAgICAgdmFsaWRhdGVOb1ByZXZpb3VzT3JkZXJCeUNhbGwocXVlcnksICdvcmRlckJ5S2V5Jyk7XG4gICAgICAgIGNvbnN0IG5ld1BhcmFtcyA9IHF1ZXJ5UGFyYW1zT3JkZXJCeShxdWVyeS5fcXVlcnlQYXJhbXMsIEtFWV9JTkRFWCk7XG4gICAgICAgIHZhbGlkYXRlUXVlcnlFbmRwb2ludHMobmV3UGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUltcGwocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoLCBuZXdQYXJhbXMsIFxuICAgICAgICAvKm9yZGVyQnlDYWxsZWQ9Ki8gdHJ1ZSk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBRdWVyeUNvbnN0cmFpbnRgIHRoYXQgb3JkZXJzIGJ5IHRoZSBrZXkuXG4gKlxuICogU29ydHMgdGhlIHJlc3VsdHMgb2YgYSBxdWVyeSBieSB0aGVpciAoYXNjZW5kaW5nKSBrZXkgdmFsdWVzLlxuICpcbiAqIFlvdSBjYW4gcmVhZCBtb3JlIGFib3V0IGBvcmRlckJ5S2V5KClgIGluXG4gKiB7QGxpbmsgaHR0cHM6Ly9maXJlYmFzZS5nb29nbGUuY29tL2RvY3MvZGF0YWJhc2Uvd2ViL2xpc3RzLW9mLWRhdGEjc29ydF9kYXRhIHwgU29ydCBkYXRhfS5cbiAqL1xuZnVuY3Rpb24gb3JkZXJCeUtleSgpIHtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5T3JkZXJCeUtleUNvbnN0cmFpbnQoKTtcbn1cbmNsYXNzIFF1ZXJ5T3JkZXJCeVByaW9yaXR5Q29uc3RyYWludCBleHRlbmRzIFF1ZXJ5Q29uc3RyYWludCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHN1cGVyKC4uLmFyZ3VtZW50cyk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdvcmRlckJ5UHJpb3JpdHknO1xuICAgIH1cbiAgICBfYXBwbHkocXVlcnkpIHtcbiAgICAgICAgdmFsaWRhdGVOb1ByZXZpb3VzT3JkZXJCeUNhbGwocXVlcnksICdvcmRlckJ5UHJpb3JpdHknKTtcbiAgICAgICAgY29uc3QgbmV3UGFyYW1zID0gcXVlcnlQYXJhbXNPcmRlckJ5KHF1ZXJ5Ll9xdWVyeVBhcmFtcywgUFJJT1JJVFlfSU5ERVgpO1xuICAgICAgICB2YWxpZGF0ZVF1ZXJ5RW5kcG9pbnRzKG5ld1BhcmFtcyk7XG4gICAgICAgIHJldHVybiBuZXcgUXVlcnlJbXBsKHF1ZXJ5Ll9yZXBvLCBxdWVyeS5fcGF0aCwgbmV3UGFyYW1zLCBcbiAgICAgICAgLypvcmRlckJ5Q2FsbGVkPSovIHRydWUpO1xuICAgIH1cbn1cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyBgUXVlcnlDb25zdHJhaW50YCB0aGF0IG9yZGVycyBieSBwcmlvcml0eS5cbiAqXG4gKiBBcHBsaWNhdGlvbnMgbmVlZCBub3QgdXNlIHByaW9yaXR5IGJ1dCBjYW4gb3JkZXIgY29sbGVjdGlvbnMgYnlcbiAqIG9yZGluYXJ5IHByb3BlcnRpZXMgKHNlZVxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI3NvcnRfZGF0YSB8IFNvcnQgZGF0YX1cbiAqIGZvciBhbHRlcm5hdGl2ZXMgdG8gcHJpb3JpdHkuXG4gKi9cbmZ1bmN0aW9uIG9yZGVyQnlQcmlvcml0eSgpIHtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5T3JkZXJCeVByaW9yaXR5Q29uc3RyYWludCgpO1xufVxuY2xhc3MgUXVlcnlPcmRlckJ5VmFsdWVDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTtcbiAgICAgICAgdGhpcy50eXBlID0gJ29yZGVyQnlWYWx1ZSc7XG4gICAgfVxuICAgIF9hcHBseShxdWVyeSkge1xuICAgICAgICB2YWxpZGF0ZU5vUHJldmlvdXNPcmRlckJ5Q2FsbChxdWVyeSwgJ29yZGVyQnlWYWx1ZScpO1xuICAgICAgICBjb25zdCBuZXdQYXJhbXMgPSBxdWVyeVBhcmFtc09yZGVyQnkocXVlcnkuX3F1ZXJ5UGFyYW1zLCBWQUxVRV9JTkRFWCk7XG4gICAgICAgIHZhbGlkYXRlUXVlcnlFbmRwb2ludHMobmV3UGFyYW1zKTtcbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUltcGwocXVlcnkuX3JlcG8sIHF1ZXJ5Ll9wYXRoLCBuZXdQYXJhbXMsIFxuICAgICAgICAvKm9yZGVyQnlDYWxsZWQ9Ki8gdHJ1ZSk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGEgbmV3IGBRdWVyeUNvbnN0cmFpbnRgIHRoYXQgb3JkZXJzIGJ5IHZhbHVlLlxuICpcbiAqIElmIHRoZSBjaGlsZHJlbiBvZiBhIHF1ZXJ5IGFyZSBhbGwgc2NhbGFyIHZhbHVlcyAoc3RyaW5nLCBudW1iZXIsIG9yXG4gKiBib29sZWFuKSwgeW91IGNhbiBvcmRlciB0aGUgcmVzdWx0cyBieSB0aGVpciAoYXNjZW5kaW5nKSB2YWx1ZXMuXG4gKlxuICogWW91IGNhbiByZWFkIG1vcmUgYWJvdXQgYG9yZGVyQnlWYWx1ZSgpYCBpblxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI3NvcnRfZGF0YSB8IFNvcnQgZGF0YX0uXG4gKi9cbmZ1bmN0aW9uIG9yZGVyQnlWYWx1ZSgpIHtcbiAgICByZXR1cm4gbmV3IFF1ZXJ5T3JkZXJCeVZhbHVlQ29uc3RyYWludCgpO1xufVxuY2xhc3MgUXVlcnlFcXVhbFRvVmFsdWVDb25zdHJhaW50IGV4dGVuZHMgUXVlcnlDb25zdHJhaW50IHtcbiAgICBjb25zdHJ1Y3RvcihfdmFsdWUsIF9rZXkpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5fdmFsdWUgPSBfdmFsdWU7XG4gICAgICAgIHRoaXMuX2tleSA9IF9rZXk7XG4gICAgICAgIHRoaXMudHlwZSA9ICdlcXVhbFRvJztcbiAgICB9XG4gICAgX2FwcGx5KHF1ZXJ5KSB7XG4gICAgICAgIHZhbGlkYXRlRmlyZWJhc2VEYXRhQXJnKCdlcXVhbFRvJywgdGhpcy5fdmFsdWUsIHF1ZXJ5Ll9wYXRoLCBmYWxzZSk7XG4gICAgICAgIGlmIChxdWVyeS5fcXVlcnlQYXJhbXMuaGFzU3RhcnQoKSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdlcXVhbFRvOiBTdGFydGluZyBwb2ludCB3YXMgYWxyZWFkeSBzZXQgKGJ5IGFub3RoZXIgY2FsbCB0byBzdGFydEF0L3N0YXJ0QWZ0ZXIgb3IgJyArXG4gICAgICAgICAgICAgICAgJ2VxdWFsVG8pLicpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChxdWVyeS5fcXVlcnlQYXJhbXMuaGFzRW5kKCkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignZXF1YWxUbzogRW5kaW5nIHBvaW50IHdhcyBhbHJlYWR5IHNldCAoYnkgYW5vdGhlciBjYWxsIHRvIGVuZEF0L2VuZEJlZm9yZSBvciAnICtcbiAgICAgICAgICAgICAgICAnZXF1YWxUbykuJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBRdWVyeUVuZEF0Q29uc3RyYWludCh0aGlzLl92YWx1ZSwgdGhpcy5fa2V5KS5fYXBwbHkobmV3IFF1ZXJ5U3RhcnRBdENvbnN0cmFpbnQodGhpcy5fdmFsdWUsIHRoaXMuX2tleSkuX2FwcGx5KHF1ZXJ5KSk7XG4gICAgfVxufVxuLyoqXG4gKiBDcmVhdGVzIGEgYFF1ZXJ5Q29uc3RyYWludGAgdGhhdCBpbmNsdWRlcyBjaGlsZHJlbiB0aGF0IG1hdGNoIHRoZSBzcGVjaWZpZWRcbiAqIHZhbHVlLlxuICpcbiAqIFVzaW5nIGBzdGFydEF0KClgLCBgc3RhcnRBZnRlcigpYCwgYGVuZEJlZm9yZSgpYCwgYGVuZEF0KClgIGFuZCBgZXF1YWxUbygpYFxuICogYWxsb3dzIHlvdSB0byBjaG9vc2UgYXJiaXRyYXJ5IHN0YXJ0aW5nIGFuZCBlbmRpbmcgcG9pbnRzIGZvciB5b3VyIHF1ZXJpZXMuXG4gKlxuICogVGhlIG9wdGlvbmFsIGtleSBhcmd1bWVudCBjYW4gYmUgdXNlZCB0byBmdXJ0aGVyIGxpbWl0IHRoZSByYW5nZSBvZiB0aGVcbiAqIHF1ZXJ5LiBJZiBpdCBpcyBzcGVjaWZpZWQsIHRoZW4gY2hpbGRyZW4gdGhhdCBoYXZlIGV4YWN0bHkgdGhlIHNwZWNpZmllZFxuICogdmFsdWUgbXVzdCBhbHNvIGhhdmUgZXhhY3RseSB0aGUgc3BlY2lmaWVkIGtleSBhcyB0aGVpciBrZXkgbmFtZS4gVGhpcyBjYW4gYmVcbiAqIHVzZWQgdG8gZmlsdGVyIHJlc3VsdCBzZXRzIHdpdGggbWFueSBtYXRjaGVzIGZvciB0aGUgc2FtZSB2YWx1ZS5cbiAqXG4gKiBZb3UgY2FuIHJlYWQgbW9yZSBhYm91dCBgZXF1YWxUbygpYCBpblxuICoge0BsaW5rIGh0dHBzOi8vZmlyZWJhc2UuZ29vZ2xlLmNvbS9kb2NzL2RhdGFiYXNlL3dlYi9saXN0cy1vZi1kYXRhI2ZpbHRlcmluZ19kYXRhIHwgRmlsdGVyaW5nIGRhdGF9LlxuICpcbiAqIEBwYXJhbSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byBtYXRjaCBmb3IuIFRoZSBhcmd1bWVudCB0eXBlIGRlcGVuZHMgb24gd2hpY2hcbiAqIGBvcmRlckJ5KigpYCBmdW5jdGlvbiB3YXMgdXNlZCBpbiB0aGlzIHF1ZXJ5LiBTcGVjaWZ5IGEgdmFsdWUgdGhhdCBtYXRjaGVzXG4gKiB0aGUgYG9yZGVyQnkqKClgIHR5cGUuIFdoZW4gdXNlZCBpbiBjb21iaW5hdGlvbiB3aXRoIGBvcmRlckJ5S2V5KClgLCB0aGVcbiAqIHZhbHVlIG11c3QgYmUgYSBzdHJpbmcuXG4gKiBAcGFyYW0ga2V5IC0gVGhlIGNoaWxkIGtleSB0byBzdGFydCBhdCwgYW1vbmcgdGhlIGNoaWxkcmVuIHdpdGggdGhlXG4gKiBwcmV2aW91c2x5IHNwZWNpZmllZCBwcmlvcml0eS4gVGhpcyBhcmd1bWVudCBpcyBvbmx5IGFsbG93ZWQgaWYgb3JkZXJpbmcgYnlcbiAqIGNoaWxkLCB2YWx1ZSwgb3IgcHJpb3JpdHkuXG4gKi9cbmZ1bmN0aW9uIGVxdWFsVG8odmFsdWUsIGtleSkge1xuICAgIHZhbGlkYXRlS2V5KCdlcXVhbFRvJywgJ2tleScsIGtleSwgdHJ1ZSk7XG4gICAgcmV0dXJuIG5ldyBRdWVyeUVxdWFsVG9WYWx1ZUNvbnN0cmFpbnQodmFsdWUsIGtleSk7XG59XG4vKipcbiAqIENyZWF0ZXMgYSBuZXcgaW1tdXRhYmxlIGluc3RhbmNlIG9mIGBRdWVyeWAgdGhhdCBpcyBleHRlbmRlZCB0byBhbHNvIGluY2x1ZGVcbiAqIGFkZGl0aW9uYWwgcXVlcnkgY29uc3RyYWludHMuXG4gKlxuICogQHBhcmFtIHF1ZXJ5IC0gVGhlIFF1ZXJ5IGluc3RhbmNlIHRvIHVzZSBhcyBhIGJhc2UgZm9yIHRoZSBuZXcgY29uc3RyYWludHMuXG4gKiBAcGFyYW0gcXVlcnlDb25zdHJhaW50cyAtIFRoZSBsaXN0IG9mIGBRdWVyeUNvbnN0cmFpbnRgcyB0byBhcHBseS5cbiAqIEB0aHJvd3MgaWYgYW55IG9mIHRoZSBwcm92aWRlZCBxdWVyeSBjb25zdHJhaW50cyBjYW5ub3QgYmUgY29tYmluZWQgd2l0aCB0aGVcbiAqIGV4aXN0aW5nIG9yIG5ldyBjb25zdHJhaW50cy5cbiAqL1xuZnVuY3Rpb24gcXVlcnkocXVlcnksIC4uLnF1ZXJ5Q29uc3RyYWludHMpIHtcbiAgICBsZXQgcXVlcnlJbXBsID0gZ2V0TW9kdWxhckluc3RhbmNlKHF1ZXJ5KTtcbiAgICBmb3IgKGNvbnN0IGNvbnN0cmFpbnQgb2YgcXVlcnlDb25zdHJhaW50cykge1xuICAgICAgICBxdWVyeUltcGwgPSBjb25zdHJhaW50Ll9hcHBseShxdWVyeUltcGwpO1xuICAgIH1cbiAgICByZXR1cm4gcXVlcnlJbXBsO1xufVxuLyoqXG4gKiBEZWZpbmUgcmVmZXJlbmNlIGNvbnN0cnVjdG9yIGluIHZhcmlvdXMgbW9kdWxlc1xuICpcbiAqIFdlIGFyZSBkb2luZyB0aGlzIGhlcmUgdG8gYXZvaWQgc2V2ZXJhbCBjaXJjdWxhclxuICogZGVwZW5kZW5jeSBpc3N1ZXNcbiAqL1xuc3luY1BvaW50U2V0UmVmZXJlbmNlQ29uc3RydWN0b3IoUmVmZXJlbmNlSW1wbCk7XG5zeW5jVHJlZVNldFJlZmVyZW5jZUNvbnN0cnVjdG9yKFJlZmVyZW5jZUltcGwpO1xuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyoqXG4gKiBUaGlzIHZhcmlhYmxlIGlzIGFsc28gZGVmaW5lZCBpbiB0aGUgZmlyZWJhc2UgTm9kZS5qcyBBZG1pbiBTREsuIEJlZm9yZVxuICogbW9kaWZ5aW5nIHRoaXMgZGVmaW5pdGlvbiwgY29uc3VsdCB0aGUgZGVmaW5pdGlvbiBpbjpcbiAqXG4gKiBodHRwczovL2dpdGh1Yi5jb20vZmlyZWJhc2UvZmlyZWJhc2UtYWRtaW4tbm9kZVxuICpcbiAqIGFuZCBtYWtlIHN1cmUgdGhlIHR3byBhcmUgY29uc2lzdGVudC5cbiAqL1xuY29uc3QgRklSRUJBU0VfREFUQUJBU0VfRU1VTEFUT1JfSE9TVF9WQVIgPSAnRklSRUJBU0VfREFUQUJBU0VfRU1VTEFUT1JfSE9TVCc7XG4vKipcbiAqIENyZWF0ZXMgYW5kIGNhY2hlcyBgUmVwb2AgaW5zdGFuY2VzLlxuICovXG5jb25zdCByZXBvcyA9IHt9O1xuLyoqXG4gKiBJZiB0cnVlLCBhbnkgbmV3IGBSZXBvYCB3aWxsIGJlIGNyZWF0ZWQgdG8gdXNlIGBSZWFkb25seVJlc3RDbGllbnRgIChmb3IgdGVzdGluZyBwdXJwb3NlcykuXG4gKi9cbmxldCB1c2VSZXN0Q2xpZW50ID0gZmFsc2U7XG4vKipcbiAqIFVwZGF0ZSBhbiBleGlzdGluZyBgUmVwb2AgaW4gcGxhY2UgdG8gcG9pbnQgdG8gYSBuZXcgaG9zdC9wb3J0LlxuICovXG5mdW5jdGlvbiByZXBvTWFuYWdlckFwcGx5RW11bGF0b3JTZXR0aW5ncyhyZXBvLCBob3N0QW5kUG9ydCwgZW11bGF0b3JPcHRpb25zLCB0b2tlblByb3ZpZGVyKSB7XG4gICAgcmVwby5yZXBvSW5mb18gPSBuZXcgUmVwb0luZm8oaG9zdEFuZFBvcnQsIFxuICAgIC8qIHNlY3VyZT0gKi8gZmFsc2UsIHJlcG8ucmVwb0luZm9fLm5hbWVzcGFjZSwgcmVwby5yZXBvSW5mb18ud2ViU29ja2V0T25seSwgcmVwby5yZXBvSW5mb18ubm9kZUFkbWluLCByZXBvLnJlcG9JbmZvXy5wZXJzaXN0ZW5jZUtleSwgcmVwby5yZXBvSW5mb18uaW5jbHVkZU5hbWVzcGFjZUluUXVlcnlQYXJhbXMsIFxuICAgIC8qaXNVc2luZ0VtdWxhdG9yPSovIHRydWUsIGVtdWxhdG9yT3B0aW9ucyk7XG4gICAgaWYgKHRva2VuUHJvdmlkZXIpIHtcbiAgICAgICAgcmVwby5hdXRoVG9rZW5Qcm92aWRlcl8gPSB0b2tlblByb3ZpZGVyO1xuICAgIH1cbn1cbi8qKlxuICogVGhpcyBmdW5jdGlvbiBzaG91bGQgb25seSBldmVyIGJlIGNhbGxlZCB0byBDUkVBVEUgYSBuZXcgZGF0YWJhc2UgaW5zdGFuY2UuXG4gKiBAaW50ZXJuYWxcbiAqL1xuZnVuY3Rpb24gcmVwb01hbmFnZXJEYXRhYmFzZUZyb21BcHAoYXBwLCBhdXRoUHJvdmlkZXIsIGFwcENoZWNrUHJvdmlkZXIsIHVybCwgbm9kZUFkbWluKSB7XG4gICAgbGV0IGRiVXJsID0gdXJsIHx8IGFwcC5vcHRpb25zLmRhdGFiYXNlVVJMO1xuICAgIGlmIChkYlVybCA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICghYXBwLm9wdGlvbnMucHJvamVjdElkKSB7XG4gICAgICAgICAgICBmYXRhbChcIkNhbid0IGRldGVybWluZSBGaXJlYmFzZSBEYXRhYmFzZSBVUkwuIEJlIHN1cmUgdG8gaW5jbHVkZSBcIiArXG4gICAgICAgICAgICAgICAgJyBhIFByb2plY3QgSUQgd2hlbiBjYWxsaW5nIGZpcmViYXNlLmluaXRpYWxpemVBcHAoKS4nKTtcbiAgICAgICAgfVxuICAgICAgICBsb2coJ1VzaW5nIGRlZmF1bHQgaG9zdCBmb3IgcHJvamVjdCAnLCBhcHAub3B0aW9ucy5wcm9qZWN0SWQpO1xuICAgICAgICBkYlVybCA9IGAke2FwcC5vcHRpb25zLnByb2plY3RJZH0tZGVmYXVsdC1ydGRiLmZpcmViYXNlaW8uY29tYDtcbiAgICB9XG4gICAgbGV0IHBhcnNlZFVybCA9IHBhcnNlUmVwb0luZm8oZGJVcmwsIG5vZGVBZG1pbik7XG4gICAgbGV0IHJlcG9JbmZvID0gcGFyc2VkVXJsLnJlcG9JbmZvO1xuICAgIGxldCBpc0VtdWxhdG9yO1xuICAgIGxldCBkYkVtdWxhdG9ySG9zdCA9IHVuZGVmaW5lZDtcbiAgICBpZiAodHlwZW9mIHByb2Nlc3MgIT09ICd1bmRlZmluZWQnICYmIHByb2Nlc3MuZW52KSB7XG4gICAgICAgIGRiRW11bGF0b3JIb3N0ID0gcHJvY2Vzcy5lbnZbRklSRUJBU0VfREFUQUJBU0VfRU1VTEFUT1JfSE9TVF9WQVJdO1xuICAgIH1cbiAgICBpZiAoZGJFbXVsYXRvckhvc3QpIHtcbiAgICAgICAgaXNFbXVsYXRvciA9IHRydWU7XG4gICAgICAgIGRiVXJsID0gYGh0dHA6Ly8ke2RiRW11bGF0b3JIb3N0fT9ucz0ke3JlcG9JbmZvLm5hbWVzcGFjZX1gO1xuICAgICAgICBwYXJzZWRVcmwgPSBwYXJzZVJlcG9JbmZvKGRiVXJsLCBub2RlQWRtaW4pO1xuICAgICAgICByZXBvSW5mbyA9IHBhcnNlZFVybC5yZXBvSW5mbztcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlzRW11bGF0b3IgPSAhcGFyc2VkVXJsLnJlcG9JbmZvLnNlY3VyZTtcbiAgICB9XG4gICAgY29uc3QgYXV0aFRva2VuUHJvdmlkZXIgPSBub2RlQWRtaW4gJiYgaXNFbXVsYXRvclxuICAgICAgICA/IG5ldyBFbXVsYXRvclRva2VuUHJvdmlkZXIoRW11bGF0b3JUb2tlblByb3ZpZGVyLk9XTkVSKVxuICAgICAgICA6IG5ldyBGaXJlYmFzZUF1dGhUb2tlblByb3ZpZGVyKGFwcC5uYW1lLCBhcHAub3B0aW9ucywgYXV0aFByb3ZpZGVyKTtcbiAgICB2YWxpZGF0ZVVybCgnSW52YWxpZCBGaXJlYmFzZSBEYXRhYmFzZSBVUkwnLCBwYXJzZWRVcmwpO1xuICAgIGlmICghcGF0aElzRW1wdHkocGFyc2VkVXJsLnBhdGgpKSB7XG4gICAgICAgIGZhdGFsKCdEYXRhYmFzZSBVUkwgbXVzdCBwb2ludCB0byB0aGUgcm9vdCBvZiBhIEZpcmViYXNlIERhdGFiYXNlICcgK1xuICAgICAgICAgICAgJyhub3QgaW5jbHVkaW5nIGEgY2hpbGQgcGF0aCkuJyk7XG4gICAgfVxuICAgIGNvbnN0IHJlcG8gPSByZXBvTWFuYWdlckNyZWF0ZVJlcG8ocmVwb0luZm8sIGFwcCwgYXV0aFRva2VuUHJvdmlkZXIsIG5ldyBBcHBDaGVja1Rva2VuUHJvdmlkZXIoYXBwLCBhcHBDaGVja1Byb3ZpZGVyKSk7XG4gICAgcmV0dXJuIG5ldyBEYXRhYmFzZShyZXBvLCBhcHApO1xufVxuLyoqXG4gKiBSZW1vdmUgdGhlIHJlcG8gYW5kIG1ha2Ugc3VyZSBpdCBpcyBkaXNjb25uZWN0ZWQuXG4gKlxuICovXG5mdW5jdGlvbiByZXBvTWFuYWdlckRlbGV0ZVJlcG8ocmVwbywgYXBwTmFtZSkge1xuICAgIGNvbnN0IGFwcFJlcG9zID0gcmVwb3NbYXBwTmFtZV07XG4gICAgLy8gVGhpcyBzaG91bGQgbmV2ZXIgaGFwcGVuLi4uXG4gICAgaWYgKCFhcHBSZXBvcyB8fCBhcHBSZXBvc1tyZXBvLmtleV0gIT09IHJlcG8pIHtcbiAgICAgICAgZmF0YWwoYERhdGFiYXNlICR7YXBwTmFtZX0oJHtyZXBvLnJlcG9JbmZvX30pIGhhcyBhbHJlYWR5IGJlZW4gZGVsZXRlZC5gKTtcbiAgICB9XG4gICAgcmVwb0ludGVycnVwdChyZXBvKTtcbiAgICBkZWxldGUgYXBwUmVwb3NbcmVwby5rZXldO1xufVxuLyoqXG4gKiBFbnN1cmVzIGEgcmVwbyBkb2Vzbid0IGFscmVhZHkgZXhpc3QgYW5kIHRoZW4gY3JlYXRlcyBvbmUgdXNpbmcgdGhlXG4gKiBwcm92aWRlZCBhcHAuXG4gKlxuICogQHBhcmFtIHJlcG9JbmZvIC0gVGhlIG1ldGFkYXRhIGFib3V0IHRoZSBSZXBvXG4gKiBAcmV0dXJucyBUaGUgUmVwbyBvYmplY3QgZm9yIHRoZSBzcGVjaWZpZWQgc2VydmVyIC8gcmVwb05hbWUuXG4gKi9cbmZ1bmN0aW9uIHJlcG9NYW5hZ2VyQ3JlYXRlUmVwbyhyZXBvSW5mbywgYXBwLCBhdXRoVG9rZW5Qcm92aWRlciwgYXBwQ2hlY2tQcm92aWRlcikge1xuICAgIGxldCBhcHBSZXBvcyA9IHJlcG9zW2FwcC5uYW1lXTtcbiAgICBpZiAoIWFwcFJlcG9zKSB7XG4gICAgICAgIGFwcFJlcG9zID0ge307XG4gICAgICAgIHJlcG9zW2FwcC5uYW1lXSA9IGFwcFJlcG9zO1xuICAgIH1cbiAgICBsZXQgcmVwbyA9IGFwcFJlcG9zW3JlcG9JbmZvLnRvVVJMU3RyaW5nKCldO1xuICAgIGlmIChyZXBvKSB7XG4gICAgICAgIGZhdGFsKCdEYXRhYmFzZSBpbml0aWFsaXplZCBtdWx0aXBsZSB0aW1lcy4gUGxlYXNlIG1ha2Ugc3VyZSB0aGUgZm9ybWF0IG9mIHRoZSBkYXRhYmFzZSBVUkwgbWF0Y2hlcyB3aXRoIGVhY2ggZGF0YWJhc2UoKSBjYWxsLicpO1xuICAgIH1cbiAgICByZXBvID0gbmV3IFJlcG8ocmVwb0luZm8sIHVzZVJlc3RDbGllbnQsIGF1dGhUb2tlblByb3ZpZGVyLCBhcHBDaGVja1Byb3ZpZGVyKTtcbiAgICBhcHBSZXBvc1tyZXBvSW5mby50b1VSTFN0cmluZygpXSA9IHJlcG87XG4gICAgcmV0dXJuIHJlcG87XG59XG4vKipcbiAqIEZvcmNlcyB1cyB0byB1c2UgUmVhZG9ubHlSZXN0Q2xpZW50IGluc3RlYWQgb2YgUGVyc2lzdGVudENvbm5lY3Rpb24gZm9yIG5ldyBSZXBvcy5cbiAqL1xuZnVuY3Rpb24gcmVwb01hbmFnZXJGb3JjZVJlc3RDbGllbnQoZm9yY2VSZXN0Q2xpZW50KSB7XG4gICAgdXNlUmVzdENsaWVudCA9IGZvcmNlUmVzdENsaWVudDtcbn1cbi8qKlxuICogQ2xhc3MgcmVwcmVzZW50aW5nIGEgRmlyZWJhc2UgUmVhbHRpbWUgRGF0YWJhc2UuXG4gKi9cbmNsYXNzIERhdGFiYXNlIHtcbiAgICAvKiogQGhpZGVjb25zdHJ1Y3RvciAqL1xuICAgIGNvbnN0cnVjdG9yKF9yZXBvSW50ZXJuYWwsIFxuICAgIC8qKiBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGFzc29jaWF0ZWQgd2l0aCB0aGlzIFJlYWx0aW1lIERhdGFiYXNlIGluc3RhbmNlLiAqL1xuICAgIGFwcCkge1xuICAgICAgICB0aGlzLl9yZXBvSW50ZXJuYWwgPSBfcmVwb0ludGVybmFsO1xuICAgICAgICB0aGlzLmFwcCA9IGFwcDtcbiAgICAgICAgLyoqIFJlcHJlc2VudHMgYSBgRGF0YWJhc2VgIGluc3RhbmNlLiAqL1xuICAgICAgICB0aGlzWyd0eXBlJ10gPSAnZGF0YWJhc2UnO1xuICAgICAgICAvKiogVHJhY2sgaWYgdGhlIGluc3RhbmNlIGhhcyBiZWVuIHVzZWQgKHJvb3Qgb3IgcmVwbyBhY2Nlc3NlZCkgKi9cbiAgICAgICAgdGhpcy5faW5zdGFuY2VTdGFydGVkID0gZmFsc2U7XG4gICAgfVxuICAgIGdldCBfcmVwbygpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9pbnN0YW5jZVN0YXJ0ZWQpIHtcbiAgICAgICAgICAgIHJlcG9TdGFydCh0aGlzLl9yZXBvSW50ZXJuYWwsIHRoaXMuYXBwLm9wdGlvbnMuYXBwSWQsIHRoaXMuYXBwLm9wdGlvbnNbJ2RhdGFiYXNlQXV0aFZhcmlhYmxlT3ZlcnJpZGUnXSk7XG4gICAgICAgICAgICB0aGlzLl9pbnN0YW5jZVN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0aGlzLl9yZXBvSW50ZXJuYWw7XG4gICAgfVxuICAgIGdldCBfcm9vdCgpIHtcbiAgICAgICAgaWYgKCF0aGlzLl9yb290SW50ZXJuYWwpIHtcbiAgICAgICAgICAgIHRoaXMuX3Jvb3RJbnRlcm5hbCA9IG5ldyBSZWZlcmVuY2VJbXBsKHRoaXMuX3JlcG8sIG5ld0VtcHR5UGF0aCgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5fcm9vdEludGVybmFsO1xuICAgIH1cbiAgICBfZGVsZXRlKCkge1xuICAgICAgICBpZiAodGhpcy5fcm9vdEludGVybmFsICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXBvTWFuYWdlckRlbGV0ZVJlcG8odGhpcy5fcmVwbywgdGhpcy5hcHAubmFtZSk7XG4gICAgICAgICAgICB0aGlzLl9yZXBvSW50ZXJuYWwgPSBudWxsO1xuICAgICAgICAgICAgdGhpcy5fcm9vdEludGVybmFsID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XG4gICAgfVxuICAgIF9jaGVja05vdERlbGV0ZWQoYXBpTmFtZSkge1xuICAgICAgICBpZiAodGhpcy5fcm9vdEludGVybmFsID09PSBudWxsKSB7XG4gICAgICAgICAgICBmYXRhbCgnQ2Fubm90IGNhbGwgJyArIGFwaU5hbWUgKyAnIG9uIGEgZGVsZXRlZCBkYXRhYmFzZS4nKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNoZWNrVHJhbnNwb3J0SW5pdCgpIHtcbiAgICBpZiAoVHJhbnNwb3J0TWFuYWdlci5JU19UUkFOU1BPUlRfSU5JVElBTElaRUQpIHtcbiAgICAgICAgd2FybignVHJhbnNwb3J0IGhhcyBhbHJlYWR5IGJlZW4gaW5pdGlhbGl6ZWQuIFBsZWFzZSBjYWxsIHRoaXMgZnVuY3Rpb24gYmVmb3JlIGNhbGxpbmcgcmVmIG9yIHNldHRpbmcgdXAgYSBsaXN0ZW5lcicpO1xuICAgIH1cbn1cbi8qKlxuICogRm9yY2UgdGhlIHVzZSBvZiB3ZWJzb2NrZXRzIGluc3RlYWQgb2YgbG9uZ1BvbGxpbmcuXG4gKi9cbmZ1bmN0aW9uIGZvcmNlV2ViU29ja2V0cygpIHtcbiAgICBjaGVja1RyYW5zcG9ydEluaXQoKTtcbiAgICBCcm93c2VyUG9sbENvbm5lY3Rpb24uZm9yY2VEaXNhbGxvdygpO1xufVxuLyoqXG4gKiBGb3JjZSB0aGUgdXNlIG9mIGxvbmdQb2xsaW5nIGluc3RlYWQgb2Ygd2Vic29ja2V0cy4gVGhpcyB3aWxsIGJlIGlnbm9yZWQgaWYgd2Vic29ja2V0IHByb3RvY29sIGlzIHVzZWQgaW4gZGF0YWJhc2VVUkwuXG4gKi9cbmZ1bmN0aW9uIGZvcmNlTG9uZ1BvbGxpbmcoKSB7XG4gICAgY2hlY2tUcmFuc3BvcnRJbml0KCk7XG4gICAgV2ViU29ja2V0Q29ubmVjdGlvbi5mb3JjZURpc2FsbG93KCk7XG4gICAgQnJvd3NlclBvbGxDb25uZWN0aW9uLmZvcmNlQWxsb3coKTtcbn1cbi8qKlxuICogUmV0dXJucyB0aGUgaW5zdGFuY2Ugb2YgdGhlIFJlYWx0aW1lIERhdGFiYXNlIFNESyB0aGF0IGlzIGFzc29jaWF0ZWQgd2l0aCB0aGUgcHJvdmlkZWRcbiAqIHtAbGluayBAZmlyZWJhc2UvYXBwI0ZpcmViYXNlQXBwfS4gSW5pdGlhbGl6ZXMgYSBuZXcgaW5zdGFuY2Ugd2l0aCBkZWZhdWx0IHNldHRpbmdzIGlmXG4gKiBubyBpbnN0YW5jZSBleGlzdHMgb3IgaWYgdGhlIGV4aXN0aW5nIGluc3RhbmNlIHVzZXMgYSBjdXN0b20gZGF0YWJhc2UgVVJMLlxuICpcbiAqIEBwYXJhbSBhcHAgLSBUaGUge0BsaW5rIEBmaXJlYmFzZS9hcHAjRmlyZWJhc2VBcHB9IGluc3RhbmNlIHRoYXQgdGhlIHJldHVybmVkIFJlYWx0aW1lXG4gKiBEYXRhYmFzZSBpbnN0YW5jZSBpcyBhc3NvY2lhdGVkIHdpdGguXG4gKiBAcGFyYW0gdXJsIC0gVGhlIFVSTCBvZiB0aGUgUmVhbHRpbWUgRGF0YWJhc2UgaW5zdGFuY2UgdG8gY29ubmVjdCB0by4gSWYgbm90XG4gKiBwcm92aWRlZCwgdGhlIFNESyBjb25uZWN0cyB0byB0aGUgZGVmYXVsdCBpbnN0YW5jZSBvZiB0aGUgRmlyZWJhc2UgQXBwLlxuICogQHJldHVybnMgVGhlIGBEYXRhYmFzZWAgaW5zdGFuY2Ugb2YgdGhlIHByb3ZpZGVkIGFwcC5cbiAqL1xuZnVuY3Rpb24gZ2V0RGF0YWJhc2UoYXBwID0gZ2V0QXBwKCksIHVybCkge1xuICAgIGNvbnN0IGRiID0gX2dldFByb3ZpZGVyKGFwcCwgJ2RhdGFiYXNlJykuZ2V0SW1tZWRpYXRlKHtcbiAgICAgICAgaWRlbnRpZmllcjogdXJsXG4gICAgfSk7XG4gICAgaWYgKCFkYi5faW5zdGFuY2VTdGFydGVkKSB7XG4gICAgICAgIGNvbnN0IGVtdWxhdG9yID0gZ2V0RGVmYXVsdEVtdWxhdG9ySG9zdG5hbWVBbmRQb3J0KCdkYXRhYmFzZScpO1xuICAgICAgICBpZiAoZW11bGF0b3IpIHtcbiAgICAgICAgICAgIGNvbm5lY3REYXRhYmFzZUVtdWxhdG9yKGRiLCAuLi5lbXVsYXRvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRiO1xufVxuLyoqXG4gKiBNb2RpZnkgdGhlIHByb3ZpZGVkIGluc3RhbmNlIHRvIGNvbW11bmljYXRlIHdpdGggdGhlIFJlYWx0aW1lIERhdGFiYXNlXG4gKiBlbXVsYXRvci5cbiAqXG4gKiA8cD5Ob3RlOiBUaGlzIG1ldGhvZCBtdXN0IGJlIGNhbGxlZCBiZWZvcmUgcGVyZm9ybWluZyBhbnkgb3RoZXIgb3BlcmF0aW9uLlxuICpcbiAqIEBwYXJhbSBkYiAtIFRoZSBpbnN0YW5jZSB0byBtb2RpZnkuXG4gKiBAcGFyYW0gaG9zdCAtIFRoZSBlbXVsYXRvciBob3N0IChleDogbG9jYWxob3N0KVxuICogQHBhcmFtIHBvcnQgLSBUaGUgZW11bGF0b3IgcG9ydCAoZXg6IDgwODApXG4gKiBAcGFyYW0gb3B0aW9ucy5tb2NrVXNlclRva2VuIC0gdGhlIG1vY2sgYXV0aCB0b2tlbiB0byB1c2UgZm9yIHVuaXQgdGVzdGluZyBTZWN1cml0eSBSdWxlc1xuICovXG5mdW5jdGlvbiBjb25uZWN0RGF0YWJhc2VFbXVsYXRvcihkYiwgaG9zdCwgcG9ydCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgZGIgPSBnZXRNb2R1bGFySW5zdGFuY2UoZGIpO1xuICAgIGRiLl9jaGVja05vdERlbGV0ZWQoJ3VzZUVtdWxhdG9yJyk7XG4gICAgY29uc3QgaG9zdEFuZFBvcnQgPSBgJHtob3N0fToke3BvcnR9YDtcbiAgICBjb25zdCByZXBvID0gZGIuX3JlcG9JbnRlcm5hbDtcbiAgICBpZiAoZGIuX2luc3RhbmNlU3RhcnRlZCkge1xuICAgICAgICAvLyBJZiB0aGUgaW5zdGFuY2UgaGFzIGFscmVhZHkgYmVlbiBzdGFydGVkLCB0aGVuIHNpbGVudHkgZmFpbCBpZiB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZCBhZ2FpblxuICAgICAgICAvLyB3aXRoIHRoZSBzYW1lIHBhcmFtZXRlcnMuIElmIHRoZSBwYXJhbWV0ZXJzIGRpZmZlciB0aGVuIGFzc2VydC5cbiAgICAgICAgaWYgKGhvc3RBbmRQb3J0ID09PSBkYi5fcmVwb0ludGVybmFsLnJlcG9JbmZvXy5ob3N0ICYmXG4gICAgICAgICAgICBkZWVwRXF1YWwob3B0aW9ucywgcmVwby5yZXBvSW5mb18uZW11bGF0b3JPcHRpb25zKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGZhdGFsKCdjb25uZWN0RGF0YWJhc2VFbXVsYXRvcigpIGNhbm5vdCBpbml0aWFsaXplIG9yIGFsdGVyIHRoZSBlbXVsYXRvciBjb25maWd1cmF0aW9uIGFmdGVyIHRoZSBkYXRhYmFzZSBpbnN0YW5jZSBoYXMgc3RhcnRlZC4nKTtcbiAgICB9XG4gICAgbGV0IHRva2VuUHJvdmlkZXIgPSB1bmRlZmluZWQ7XG4gICAgaWYgKHJlcG8ucmVwb0luZm9fLm5vZGVBZG1pbikge1xuICAgICAgICBpZiAob3B0aW9ucy5tb2NrVXNlclRva2VuKSB7XG4gICAgICAgICAgICBmYXRhbCgnbW9ja1VzZXJUb2tlbiBpcyBub3Qgc3VwcG9ydGVkIGJ5IHRoZSBBZG1pbiBTREsuIEZvciBjbGllbnQgYWNjZXNzIHdpdGggbW9jayB1c2VycywgcGxlYXNlIHVzZSB0aGUgXCJmaXJlYmFzZVwiIHBhY2thZ2UgaW5zdGVhZCBvZiBcImZpcmViYXNlLWFkbWluXCIuJyk7XG4gICAgICAgIH1cbiAgICAgICAgdG9rZW5Qcm92aWRlciA9IG5ldyBFbXVsYXRvclRva2VuUHJvdmlkZXIoRW11bGF0b3JUb2tlblByb3ZpZGVyLk9XTkVSKTtcbiAgICB9XG4gICAgZWxzZSBpZiAob3B0aW9ucy5tb2NrVXNlclRva2VuKSB7XG4gICAgICAgIGNvbnN0IHRva2VuID0gdHlwZW9mIG9wdGlvbnMubW9ja1VzZXJUb2tlbiA9PT0gJ3N0cmluZydcbiAgICAgICAgICAgID8gb3B0aW9ucy5tb2NrVXNlclRva2VuXG4gICAgICAgICAgICA6IGNyZWF0ZU1vY2tVc2VyVG9rZW4ob3B0aW9ucy5tb2NrVXNlclRva2VuLCBkYi5hcHAub3B0aW9ucy5wcm9qZWN0SWQpO1xuICAgICAgICB0b2tlblByb3ZpZGVyID0gbmV3IEVtdWxhdG9yVG9rZW5Qcm92aWRlcih0b2tlbik7XG4gICAgfVxuICAgIC8vIE1vZGlmeSB0aGUgcmVwbyB0byBhcHBseSBlbXVsYXRvciBzZXR0aW5nc1xuICAgIHJlcG9NYW5hZ2VyQXBwbHlFbXVsYXRvclNldHRpbmdzKHJlcG8sIGhvc3RBbmRQb3J0LCBvcHRpb25zLCB0b2tlblByb3ZpZGVyKTtcbn1cbi8qKlxuICogRGlzY29ubmVjdHMgZnJvbSB0aGUgc2VydmVyIChhbGwgRGF0YWJhc2Ugb3BlcmF0aW9ucyB3aWxsIGJlIGNvbXBsZXRlZFxuICogb2ZmbGluZSkuXG4gKlxuICogVGhlIGNsaWVudCBhdXRvbWF0aWNhbGx5IG1haW50YWlucyBhIHBlcnNpc3RlbnQgY29ubmVjdGlvbiB0byB0aGUgRGF0YWJhc2VcbiAqIHNlcnZlciwgd2hpY2ggd2lsbCByZW1haW4gYWN0aXZlIGluZGVmaW5pdGVseSBhbmQgcmVjb25uZWN0IHdoZW5cbiAqIGRpc2Nvbm5lY3RlZC4gSG93ZXZlciwgdGhlIGBnb09mZmxpbmUoKWAgYW5kIGBnb09ubGluZSgpYCBtZXRob2RzIG1heSBiZSB1c2VkXG4gKiB0byBjb250cm9sIHRoZSBjbGllbnQgY29ubmVjdGlvbiBpbiBjYXNlcyB3aGVyZSBhIHBlcnNpc3RlbnQgY29ubmVjdGlvbiBpc1xuICogdW5kZXNpcmFibGUuXG4gKlxuICogV2hpbGUgb2ZmbGluZSwgdGhlIGNsaWVudCB3aWxsIG5vIGxvbmdlciByZWNlaXZlIGRhdGEgdXBkYXRlcyBmcm9tIHRoZVxuICogRGF0YWJhc2UuIEhvd2V2ZXIsIGFsbCBEYXRhYmFzZSBvcGVyYXRpb25zIHBlcmZvcm1lZCBsb2NhbGx5IHdpbGwgY29udGludWUgdG9cbiAqIGltbWVkaWF0ZWx5IGZpcmUgZXZlbnRzLCBhbGxvd2luZyB5b3VyIGFwcGxpY2F0aW9uIHRvIGNvbnRpbnVlIGJlaGF2aW5nXG4gKiBub3JtYWxseS4gQWRkaXRpb25hbGx5LCBlYWNoIG9wZXJhdGlvbiBwZXJmb3JtZWQgbG9jYWxseSB3aWxsIGF1dG9tYXRpY2FsbHlcbiAqIGJlIHF1ZXVlZCBhbmQgcmV0cmllZCB1cG9uIHJlY29ubmVjdGlvbiB0byB0aGUgRGF0YWJhc2Ugc2VydmVyLlxuICpcbiAqIFRvIHJlY29ubmVjdCB0byB0aGUgRGF0YWJhc2UgYW5kIGJlZ2luIHJlY2VpdmluZyByZW1vdGUgZXZlbnRzLCBzZWVcbiAqIGBnb09ubGluZSgpYC5cbiAqXG4gKiBAcGFyYW0gZGIgLSBUaGUgaW5zdGFuY2UgdG8gZGlzY29ubmVjdC5cbiAqL1xuZnVuY3Rpb24gZ29PZmZsaW5lKGRiKSB7XG4gICAgZGIgPSBnZXRNb2R1bGFySW5zdGFuY2UoZGIpO1xuICAgIGRiLl9jaGVja05vdERlbGV0ZWQoJ2dvT2ZmbGluZScpO1xuICAgIHJlcG9JbnRlcnJ1cHQoZGIuX3JlcG8pO1xufVxuLyoqXG4gKiBSZWNvbm5lY3RzIHRvIHRoZSBzZXJ2ZXIgYW5kIHN5bmNocm9uaXplcyB0aGUgb2ZmbGluZSBEYXRhYmFzZSBzdGF0ZVxuICogd2l0aCB0aGUgc2VydmVyIHN0YXRlLlxuICpcbiAqIFRoaXMgbWV0aG9kIHNob3VsZCBiZSB1c2VkIGFmdGVyIGRpc2FibGluZyB0aGUgYWN0aXZlIGNvbm5lY3Rpb24gd2l0aFxuICogYGdvT2ZmbGluZSgpYC4gT25jZSByZWNvbm5lY3RlZCwgdGhlIGNsaWVudCB3aWxsIHRyYW5zbWl0IHRoZSBwcm9wZXIgZGF0YVxuICogYW5kIGZpcmUgdGhlIGFwcHJvcHJpYXRlIGV2ZW50cyBzbyB0aGF0IHlvdXIgY2xpZW50IFwiY2F0Y2hlcyB1cFwiXG4gKiBhdXRvbWF0aWNhbGx5LlxuICpcbiAqIEBwYXJhbSBkYiAtIFRoZSBpbnN0YW5jZSB0byByZWNvbm5lY3QuXG4gKi9cbmZ1bmN0aW9uIGdvT25saW5lKGRiKSB7XG4gICAgZGIgPSBnZXRNb2R1bGFySW5zdGFuY2UoZGIpO1xuICAgIGRiLl9jaGVja05vdERlbGV0ZWQoJ2dvT25saW5lJyk7XG4gICAgcmVwb1Jlc3VtZShkYi5fcmVwbyk7XG59XG5mdW5jdGlvbiBlbmFibGVMb2dnaW5nKGxvZ2dlciwgcGVyc2lzdGVudCkge1xuICAgIGVuYWJsZUxvZ2dpbmckMShsb2dnZXIsIHBlcnNpc3RlbnQpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMSBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuZnVuY3Rpb24gcmVnaXN0ZXJEYXRhYmFzZSh2YXJpYW50KSB7XG4gICAgc2V0U0RLVmVyc2lvbihTREtfVkVSU0lPTiQxKTtcbiAgICBfcmVnaXN0ZXJDb21wb25lbnQobmV3IENvbXBvbmVudCgnZGF0YWJhc2UnLCAoY29udGFpbmVyLCB7IGluc3RhbmNlSWRlbnRpZmllcjogdXJsIH0pID0+IHtcbiAgICAgICAgY29uc3QgYXBwID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhcHAnKS5nZXRJbW1lZGlhdGUoKTtcbiAgICAgICAgY29uc3QgYXV0aFByb3ZpZGVyID0gY29udGFpbmVyLmdldFByb3ZpZGVyKCdhdXRoLWludGVybmFsJyk7XG4gICAgICAgIGNvbnN0IGFwcENoZWNrUHJvdmlkZXIgPSBjb250YWluZXIuZ2V0UHJvdmlkZXIoJ2FwcC1jaGVjay1pbnRlcm5hbCcpO1xuICAgICAgICByZXR1cm4gcmVwb01hbmFnZXJEYXRhYmFzZUZyb21BcHAoYXBwLCBhdXRoUHJvdmlkZXIsIGFwcENoZWNrUHJvdmlkZXIsIHVybCk7XG4gICAgfSwgXCJQVUJMSUNcIiAvKiBDb21wb25lbnRUeXBlLlBVQkxJQyAqLykuc2V0TXVsdGlwbGVJbnN0YW5jZXModHJ1ZSkpO1xuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCB2YXJpYW50KTtcbiAgICAvLyBCVUlMRF9UQVJHRVQgd2lsbCBiZSByZXBsYWNlZCBieSB2YWx1ZXMgbGlrZSBlc20yMDE3LCBjanMyMDE3LCBldGMgZHVyaW5nIHRoZSBjb21waWxhdGlvblxuICAgIHJlZ2lzdGVyVmVyc2lvbihuYW1lLCB2ZXJzaW9uLCAnZXNtMjAxNycpO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAyMCBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuY29uc3QgU0VSVkVSX1RJTUVTVEFNUCA9IHtcbiAgICAnLnN2JzogJ3RpbWVzdGFtcCdcbn07XG4vKipcbiAqIFJldHVybnMgYSBwbGFjZWhvbGRlciB2YWx1ZSBmb3IgYXV0by1wb3B1bGF0aW5nIHRoZSBjdXJyZW50IHRpbWVzdGFtcCAodGltZVxuICogc2luY2UgdGhlIFVuaXggZXBvY2gsIGluIG1pbGxpc2Vjb25kcykgYXMgZGV0ZXJtaW5lZCBieSB0aGUgRmlyZWJhc2VcbiAqIHNlcnZlcnMuXG4gKi9cbmZ1bmN0aW9uIHNlcnZlclRpbWVzdGFtcCgpIHtcbiAgICByZXR1cm4gU0VSVkVSX1RJTUVTVEFNUDtcbn1cbi8qKlxuICogUmV0dXJucyBhIHBsYWNlaG9sZGVyIHZhbHVlIHRoYXQgY2FuIGJlIHVzZWQgdG8gYXRvbWljYWxseSBpbmNyZW1lbnQgdGhlXG4gKiBjdXJyZW50IGRhdGFiYXNlIHZhbHVlIGJ5IHRoZSBwcm92aWRlZCBkZWx0YS5cbiAqXG4gKiBAcGFyYW0gZGVsdGEgLSB0aGUgYW1vdW50IHRvIG1vZGlmeSB0aGUgY3VycmVudCB2YWx1ZSBhdG9taWNhbGx5LlxuICogQHJldHVybnMgQSBwbGFjZWhvbGRlciB2YWx1ZSBmb3IgbW9kaWZ5aW5nIGRhdGEgYXRvbWljYWxseSBzZXJ2ZXItc2lkZS5cbiAqL1xuZnVuY3Rpb24gaW5jcmVtZW50KGRlbHRhKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgJy5zdic6IHtcbiAgICAgICAgICAgICdpbmNyZW1lbnQnOiBkZWx0YVxuICAgICAgICB9XG4gICAgfTtcbn1cblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjAgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogQSB0eXBlIGZvciB0aGUgcmVzb2x2ZSB2YWx1ZSBvZiB7QGxpbmsgcnVuVHJhbnNhY3Rpb259LlxuICovXG5jbGFzcyBUcmFuc2FjdGlvblJlc3VsdCB7XG4gICAgLyoqIEBoaWRlY29uc3RydWN0b3IgKi9cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAvKiogV2hldGhlciB0aGUgdHJhbnNhY3Rpb24gd2FzIHN1Y2Nlc3NmdWxseSBjb21taXR0ZWQuICovXG4gICAgY29tbWl0dGVkLCBcbiAgICAvKiogVGhlIHJlc3VsdGluZyBkYXRhIHNuYXBzaG90LiAqL1xuICAgIHNuYXBzaG90KSB7XG4gICAgICAgIHRoaXMuY29tbWl0dGVkID0gY29tbWl0dGVkO1xuICAgICAgICB0aGlzLnNuYXBzaG90ID0gc25hcHNob3Q7XG4gICAgfVxuICAgIC8qKiBSZXR1cm5zIGEgSlNPTi1zZXJpYWxpemFibGUgcmVwcmVzZW50YXRpb24gb2YgdGhpcyBvYmplY3QuICovXG4gICAgdG9KU09OKCkge1xuICAgICAgICByZXR1cm4geyBjb21taXR0ZWQ6IHRoaXMuY29tbWl0dGVkLCBzbmFwc2hvdDogdGhpcy5zbmFwc2hvdC50b0pTT04oKSB9O1xuICAgIH1cbn1cbi8qKlxuICogQXRvbWljYWxseSBtb2RpZmllcyB0aGUgZGF0YSBhdCB0aGlzIGxvY2F0aW9uLlxuICpcbiAqIEF0b21pY2FsbHkgbW9kaWZ5IHRoZSBkYXRhIGF0IHRoaXMgbG9jYXRpb24uIFVubGlrZSBhIG5vcm1hbCBgc2V0KClgLCB3aGljaFxuICoganVzdCBvdmVyd3JpdGVzIHRoZSBkYXRhIHJlZ2FyZGxlc3Mgb2YgaXRzIHByZXZpb3VzIHZhbHVlLCBgcnVuVHJhbnNhY3Rpb24oKWAgaXNcbiAqIHVzZWQgdG8gbW9kaWZ5IHRoZSBleGlzdGluZyB2YWx1ZSB0byBhIG5ldyB2YWx1ZSwgZW5zdXJpbmcgdGhlcmUgYXJlIG5vXG4gKiBjb25mbGljdHMgd2l0aCBvdGhlciBjbGllbnRzIHdyaXRpbmcgdG8gdGhlIHNhbWUgbG9jYXRpb24gYXQgdGhlIHNhbWUgdGltZS5cbiAqXG4gKiBUbyBhY2NvbXBsaXNoIHRoaXMsIHlvdSBwYXNzIGBydW5UcmFuc2FjdGlvbigpYCBhbiB1cGRhdGUgZnVuY3Rpb24gd2hpY2ggaXNcbiAqIHVzZWQgdG8gdHJhbnNmb3JtIHRoZSBjdXJyZW50IHZhbHVlIGludG8gYSBuZXcgdmFsdWUuIElmIGFub3RoZXIgY2xpZW50XG4gKiB3cml0ZXMgdG8gdGhlIGxvY2F0aW9uIGJlZm9yZSB5b3VyIG5ldyB2YWx1ZSBpcyBzdWNjZXNzZnVsbHkgd3JpdHRlbiwgeW91clxuICogdXBkYXRlIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIGFnYWluIHdpdGggdGhlIG5ldyBjdXJyZW50IHZhbHVlLCBhbmQgdGhlXG4gKiB3cml0ZSB3aWxsIGJlIHJldHJpZWQuIFRoaXMgd2lsbCBoYXBwZW4gcmVwZWF0ZWRseSB1bnRpbCB5b3VyIHdyaXRlIHN1Y2NlZWRzXG4gKiB3aXRob3V0IGNvbmZsaWN0IG9yIHlvdSBhYm9ydCB0aGUgdHJhbnNhY3Rpb24gYnkgbm90IHJldHVybmluZyBhIHZhbHVlIGZyb21cbiAqIHlvdXIgdXBkYXRlIGZ1bmN0aW9uLlxuICpcbiAqIE5vdGU6IE1vZGlmeWluZyBkYXRhIHdpdGggYHNldCgpYCB3aWxsIGNhbmNlbCBhbnkgcGVuZGluZyB0cmFuc2FjdGlvbnMgYXRcbiAqIHRoYXQgbG9jYXRpb24sIHNvIGV4dHJlbWUgY2FyZSBzaG91bGQgYmUgdGFrZW4gaWYgbWl4aW5nIGBzZXQoKWAgYW5kXG4gKiBgcnVuVHJhbnNhY3Rpb24oKWAgdG8gdXBkYXRlIHRoZSBzYW1lIGRhdGEuXG4gKlxuICogTm90ZTogV2hlbiB1c2luZyB0cmFuc2FjdGlvbnMgd2l0aCBTZWN1cml0eSBhbmQgRmlyZWJhc2UgUnVsZXMgaW4gcGxhY2UsIGJlXG4gKiBhd2FyZSB0aGF0IGEgY2xpZW50IG5lZWRzIGAucmVhZGAgYWNjZXNzIGluIGFkZGl0aW9uIHRvIGAud3JpdGVgIGFjY2VzcyBpblxuICogb3JkZXIgdG8gcGVyZm9ybSBhIHRyYW5zYWN0aW9uLiBUaGlzIGlzIGJlY2F1c2UgdGhlIGNsaWVudC1zaWRlIG5hdHVyZSBvZlxuICogdHJhbnNhY3Rpb25zIHJlcXVpcmVzIHRoZSBjbGllbnQgdG8gcmVhZCB0aGUgZGF0YSBpbiBvcmRlciB0byB0cmFuc2FjdGlvbmFsbHlcbiAqIHVwZGF0ZSBpdC5cbiAqXG4gKiBAcGFyYW0gcmVmIC0gVGhlIGxvY2F0aW9uIHRvIGF0b21pY2FsbHkgbW9kaWZ5LlxuICogQHBhcmFtIHRyYW5zYWN0aW9uVXBkYXRlIC0gQSBkZXZlbG9wZXItc3VwcGxpZWQgZnVuY3Rpb24gd2hpY2ggd2lsbCBiZSBwYXNzZWRcbiAqIHRoZSBjdXJyZW50IGRhdGEgc3RvcmVkIGF0IHRoaXMgbG9jYXRpb24gKGFzIGEgSmF2YVNjcmlwdCBvYmplY3QpLiBUaGVcbiAqIGZ1bmN0aW9uIHNob3VsZCByZXR1cm4gdGhlIG5ldyB2YWx1ZSBpdCB3b3VsZCBsaWtlIHdyaXR0ZW4gKGFzIGEgSmF2YVNjcmlwdFxuICogb2JqZWN0KS4gSWYgYHVuZGVmaW5lZGAgaXMgcmV0dXJuZWQgKGkuZS4geW91IHJldHVybiB3aXRoIG5vIGFyZ3VtZW50cykgdGhlXG4gKiB0cmFuc2FjdGlvbiB3aWxsIGJlIGFib3J0ZWQgYW5kIHRoZSBkYXRhIGF0IHRoaXMgbG9jYXRpb24gd2lsbCBub3QgYmVcbiAqIG1vZGlmaWVkLlxuICogQHBhcmFtIG9wdGlvbnMgLSBBbiBvcHRpb25zIG9iamVjdCB0byBjb25maWd1cmUgdHJhbnNhY3Rpb25zLlxuICogQHJldHVybnMgQSBgUHJvbWlzZWAgdGhhdCBjYW4gb3B0aW9uYWxseSBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGBvbkNvbXBsZXRlYFxuICogY2FsbGJhY2sgdG8gaGFuZGxlIHN1Y2Nlc3MgYW5kIGZhaWx1cmUuXG4gKi9cbmZ1bmN0aW9uIHJ1blRyYW5zYWN0aW9uKHJlZiwgXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxudHJhbnNhY3Rpb25VcGRhdGUsIG9wdGlvbnMpIHtcbiAgICB2YXIgX2E7XG4gICAgcmVmID0gZ2V0TW9kdWxhckluc3RhbmNlKHJlZik7XG4gICAgdmFsaWRhdGVXcml0YWJsZVBhdGgoJ1JlZmVyZW5jZS50cmFuc2FjdGlvbicsIHJlZi5fcGF0aCk7XG4gICAgaWYgKHJlZi5rZXkgPT09ICcubGVuZ3RoJyB8fCByZWYua2V5ID09PSAnLmtleXMnKSB7XG4gICAgICAgIHRocm93ICgnUmVmZXJlbmNlLnRyYW5zYWN0aW9uIGZhaWxlZDogJyArIHJlZi5rZXkgKyAnIGlzIGEgcmVhZC1vbmx5IG9iamVjdC4nKTtcbiAgICB9XG4gICAgY29uc3QgYXBwbHlMb2NhbGx5ID0gKF9hID0gb3B0aW9ucyA9PT0gbnVsbCB8fCBvcHRpb25zID09PSB2b2lkIDAgPyB2b2lkIDAgOiBvcHRpb25zLmFwcGx5TG9jYWxseSkgIT09IG51bGwgJiYgX2EgIT09IHZvaWQgMCA/IF9hIDogdHJ1ZTtcbiAgICBjb25zdCBkZWZlcnJlZCA9IG5ldyBEZWZlcnJlZCgpO1xuICAgIGNvbnN0IHByb21pc2VDb21wbGV0ZSA9IChlcnJvciwgY29tbWl0dGVkLCBub2RlKSA9PiB7XG4gICAgICAgIGxldCBkYXRhU25hcHNob3QgPSBudWxsO1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkYXRhU25hcHNob3QgPSBuZXcgRGF0YVNuYXBzaG90KG5vZGUsIG5ldyBSZWZlcmVuY2VJbXBsKHJlZi5fcmVwbywgcmVmLl9wYXRoKSwgUFJJT1JJVFlfSU5ERVgpO1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShuZXcgVHJhbnNhY3Rpb25SZXN1bHQoY29tbWl0dGVkLCBkYXRhU25hcHNob3QpKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgLy8gQWRkIGEgd2F0Y2ggdG8gbWFrZSBzdXJlIHdlIGdldCBzZXJ2ZXIgdXBkYXRlcy5cbiAgICBjb25zdCB1bndhdGNoZXIgPSBvblZhbHVlKHJlZiwgKCkgPT4geyB9KTtcbiAgICByZXBvU3RhcnRUcmFuc2FjdGlvbihyZWYuX3JlcG8sIHJlZi5fcGF0aCwgdHJhbnNhY3Rpb25VcGRhdGUsIHByb21pc2VDb21wbGV0ZSwgdW53YXRjaGVyLCBhcHBseUxvY2FsbHkpO1xuICAgIHJldHVybiBkZWZlcnJlZC5wcm9taXNlO1xufVxuXG4vKipcbiAqIEBsaWNlbnNlXG4gKiBDb3B5cmlnaHQgMjAxNyBHb29nbGUgTExDXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUyBJU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuUGVyc2lzdGVudENvbm5lY3Rpb247XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLnNpbXBsZUxpc3RlbiA9IGZ1bmN0aW9uIChwYXRoU3RyaW5nLCBvbkNvbXBsZXRlKSB7XG4gICAgdGhpcy5zZW5kUmVxdWVzdCgncScsIHsgcDogcGF0aFN0cmluZyB9LCBvbkNvbXBsZXRlKTtcbn07XG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLmVjaG8gPSBmdW5jdGlvbiAoZGF0YSwgb25FY2hvKSB7XG4gICAgdGhpcy5zZW5kUmVxdWVzdCgnZWNobycsIHsgZDogZGF0YSB9LCBvbkVjaG8pO1xufTtcbi8vIFJlYWxUaW1lQ29ubmVjdGlvbiBwcm9wZXJ0aWVzIHRoYXQgd2UgdXNlIGluIHRlc3RzLlxuQ29ubmVjdGlvbjtcbi8qKlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IGhpamFja0hhc2ggPSBmdW5jdGlvbiAobmV3SGFzaCkge1xuICAgIGNvbnN0IG9sZFB1dCA9IFBlcnNpc3RlbnRDb25uZWN0aW9uLnByb3RvdHlwZS5wdXQ7XG4gICAgUGVyc2lzdGVudENvbm5lY3Rpb24ucHJvdG90eXBlLnB1dCA9IGZ1bmN0aW9uIChwYXRoU3RyaW5nLCBkYXRhLCBvbkNvbXBsZXRlLCBoYXNoKSB7XG4gICAgICAgIGlmIChoYXNoICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgIGhhc2ggPSBuZXdIYXNoKCk7XG4gICAgICAgIH1cbiAgICAgICAgb2xkUHV0LmNhbGwodGhpcywgcGF0aFN0cmluZywgZGF0YSwgb25Db21wbGV0ZSwgaGFzaCk7XG4gICAgfTtcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xuICAgICAgICBQZXJzaXN0ZW50Q29ubmVjdGlvbi5wcm90b3R5cGUucHV0ID0gb2xkUHV0O1xuICAgIH07XG59O1xuUmVwb0luZm87XG4vKipcbiAqIEZvcmNlcyB0aGUgUmVwb01hbmFnZXIgdG8gY3JlYXRlIFJlcG9zIHRoYXQgdXNlIFJlYWRvbmx5UmVzdENsaWVudCBpbnN0ZWFkIG9mIFBlcnNpc3RlbnRDb25uZWN0aW9uLlxuICogQGludGVybmFsXG4gKi9cbmNvbnN0IGZvcmNlUmVzdENsaWVudCA9IGZ1bmN0aW9uIChmb3JjZVJlc3RDbGllbnQpIHtcbiAgICByZXBvTWFuYWdlckZvcmNlUmVzdENsaWVudChmb3JjZVJlc3RDbGllbnQpO1xufTtcblxuLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IDIwMjMgR29vZ2xlIExMQ1xuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qKlxuICogVXNlZCBieSBjb25zb2xlIHRvIGNyZWF0ZSBhIGRhdGFiYXNlIGJhc2VkIG9uIHRoZSBhcHAsXG4gKiBwYXNzZWQgZGF0YWJhc2UgVVJMIGFuZCBhIGN1c3RvbSBhdXRoIGltcGxlbWVudGF0aW9uLlxuICogQGludGVybmFsXG4gKiBAcGFyYW0gYXBwIC0gQSB2YWxpZCBGaXJlYmFzZUFwcC1saWtlIG9iamVjdFxuICogQHBhcmFtIHVybCAtIEEgdmFsaWQgRmlyZWJhc2UgZGF0YWJhc2VVUkxcbiAqIEBwYXJhbSB2ZXJzaW9uIC0gY3VzdG9tIHZlcnNpb24gZS5nLiBmaXJlYmFzZS1hZG1pbiB2ZXJzaW9uXG4gKiBAcGFyYW0gY3VzdG9tQXBwQ2hlY2tJbXBsIC0gY3VzdG9tIGFwcCBjaGVjayBpbXBsZW1lbnRhdGlvblxuICogQHBhcmFtIGN1c3RvbUF1dGhJbXBsIC0gY3VzdG9tIGF1dGggaW1wbGVtZW50YXRpb25cbiAqL1xuZnVuY3Rpb24gX2luaXRTdGFuZGFsb25lKHsgYXBwLCB1cmwsIHZlcnNpb24sIGN1c3RvbUF1dGhJbXBsLCBjdXN0b21BcHBDaGVja0ltcGwsIG5vZGVBZG1pbiA9IGZhbHNlIH0pIHtcbiAgICBzZXRTREtWZXJzaW9uKHZlcnNpb24pO1xuICAgIC8qKlxuICAgICAqIENvbXBvbmVudENvbnRhaW5lcignZGF0YWJhc2Utc3RhbmRhbG9uZScpIGlzIGp1c3QgYSBwbGFjZWhvbGRlciB0aGF0IGRvZXNuJ3QgcGVyZm9ybVxuICAgICAqIGFueSBhY3R1YWwgZnVuY3Rpb24uXG4gICAgICovXG4gICAgY29uc3QgY29tcG9uZW50Q29udGFpbmVyID0gbmV3IENvbXBvbmVudENvbnRhaW5lcignZGF0YWJhc2Utc3RhbmRhbG9uZScpO1xuICAgIGNvbnN0IGF1dGhQcm92aWRlciA9IG5ldyBQcm92aWRlcignYXV0aC1pbnRlcm5hbCcsIGNvbXBvbmVudENvbnRhaW5lcik7XG4gICAgbGV0IGFwcENoZWNrUHJvdmlkZXI7XG4gICAgaWYgKGN1c3RvbUFwcENoZWNrSW1wbCkge1xuICAgICAgICBhcHBDaGVja1Byb3ZpZGVyID0gbmV3IFByb3ZpZGVyKCdhcHAtY2hlY2staW50ZXJuYWwnLCBjb21wb25lbnRDb250YWluZXIpO1xuICAgICAgICBhcHBDaGVja1Byb3ZpZGVyLnNldENvbXBvbmVudChuZXcgQ29tcG9uZW50KCdhcHAtY2hlY2staW50ZXJuYWwnLCAoKSA9PiBjdXN0b21BcHBDaGVja0ltcGwsIFwiUFJJVkFURVwiIC8qIENvbXBvbmVudFR5cGUuUFJJVkFURSAqLykpO1xuICAgIH1cbiAgICBhdXRoUHJvdmlkZXIuc2V0Q29tcG9uZW50KG5ldyBDb21wb25lbnQoJ2F1dGgtaW50ZXJuYWwnLCAoKSA9PiBjdXN0b21BdXRoSW1wbCwgXCJQUklWQVRFXCIgLyogQ29tcG9uZW50VHlwZS5QUklWQVRFICovKSk7XG4gICAgcmV0dXJuIHJlcG9NYW5hZ2VyRGF0YWJhc2VGcm9tQXBwKGFwcCwgYXV0aFByb3ZpZGVyLCBhcHBDaGVja1Byb3ZpZGVyLCB1cmwsIG5vZGVBZG1pbik7XG59XG5cbi8qKlxuICogRmlyZWJhc2UgUmVhbHRpbWUgRGF0YWJhc2VcbiAqXG4gKiBAcGFja2FnZURvY3VtZW50YXRpb25cbiAqL1xucmVnaXN0ZXJEYXRhYmFzZSgpO1xuXG5leHBvcnQgeyBEYXRhU25hcHNob3QsIERhdGFiYXNlLCBPbkRpc2Nvbm5lY3QsIFF1ZXJ5Q29uc3RyYWludCwgVHJhbnNhY3Rpb25SZXN1bHQsIFF1ZXJ5SW1wbCBhcyBfUXVlcnlJbXBsLCBRdWVyeVBhcmFtcyBhcyBfUXVlcnlQYXJhbXMsIFJlZmVyZW5jZUltcGwgYXMgX1JlZmVyZW5jZUltcGwsIGZvcmNlUmVzdENsaWVudCBhcyBfVEVTVF9BQ0NFU1NfZm9yY2VSZXN0Q2xpZW50LCBoaWphY2tIYXNoIGFzIF9URVNUX0FDQ0VTU19oaWphY2tIYXNoLCBfaW5pdFN0YW5kYWxvbmUsIHJlcG9NYW5hZ2VyRGF0YWJhc2VGcm9tQXBwIGFzIF9yZXBvTWFuYWdlckRhdGFiYXNlRnJvbUFwcCwgc2V0U0RLVmVyc2lvbiBhcyBfc2V0U0RLVmVyc2lvbiwgdmFsaWRhdGVQYXRoU3RyaW5nIGFzIF92YWxpZGF0ZVBhdGhTdHJpbmcsIHZhbGlkYXRlV3JpdGFibGVQYXRoIGFzIF92YWxpZGF0ZVdyaXRhYmxlUGF0aCwgY2hpbGQsIGNvbm5lY3REYXRhYmFzZUVtdWxhdG9yLCBlbmFibGVMb2dnaW5nLCBlbmRBdCwgZW5kQmVmb3JlLCBlcXVhbFRvLCBmb3JjZUxvbmdQb2xsaW5nLCBmb3JjZVdlYlNvY2tldHMsIGdldCwgZ2V0RGF0YWJhc2UsIGdvT2ZmbGluZSwgZ29PbmxpbmUsIGluY3JlbWVudCwgbGltaXRUb0ZpcnN0LCBsaW1pdFRvTGFzdCwgb2ZmLCBvbkNoaWxkQWRkZWQsIG9uQ2hpbGRDaGFuZ2VkLCBvbkNoaWxkTW92ZWQsIG9uQ2hpbGRSZW1vdmVkLCBvbkRpc2Nvbm5lY3QsIG9uVmFsdWUsIG9yZGVyQnlDaGlsZCwgb3JkZXJCeUtleSwgb3JkZXJCeVByaW9yaXR5LCBvcmRlckJ5VmFsdWUsIHB1c2gsIHF1ZXJ5LCByZWYsIHJlZkZyb21VUkwsIHJlbW92ZSwgcnVuVHJhbnNhY3Rpb24sIHNlcnZlclRpbWVzdGFtcCwgc2V0LCBzZXRQcmlvcml0eSwgc2V0V2l0aFByaW9yaXR5LCBzdGFydEFmdGVyLCBzdGFydEF0LCB1cGRhdGUgfTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmVzbTIwMTcuanMubWFwXG4iLCIvLyAjcmVnaW9uIHNuaXBwZXRcbmV4cG9ydCBjb25zdCBicm93c2VyID0gZ2xvYmFsVGhpcy5icm93c2VyPy5ydW50aW1lPy5pZFxuICA/IGdsb2JhbFRoaXMuYnJvd3NlclxuICA6IGdsb2JhbFRoaXMuY2hyb21lO1xuLy8gI2VuZHJlZ2lvbiBzbmlwcGV0XG4iLCJpbXBvcnQgeyBicm93c2VyIGFzIF9icm93c2VyIH0gZnJvbSBcIkB3eHQtZGV2L2Jyb3dzZXJcIjtcbmV4cG9ydCBjb25zdCBicm93c2VyID0gX2Jyb3dzZXI7XG5leHBvcnQge307XG4iLCJcbmltcG9ydCB7IGdldEFwcHMsIGluaXRpYWxpemVBcHAgfSBmcm9tIFwiZmlyZWJhc2UvYXBwXCJcbmltcG9ydCB7IGdldEF1dGgsIHNpZ25JbldpdGhDdXN0b21Ub2tlbiwgc2V0UGVyc2lzdGVuY2UsIGluZGV4ZWREQkxvY2FsUGVyc2lzdGVuY2UsIFVzZXIgfSBmcm9tIFwiZmlyZWJhc2UvYXV0aC93ZWItZXh0ZW5zaW9uXCJcbmltcG9ydCB7IGdldEZpcmVzdG9yZSB9IGZyb20gXCJmaXJlYmFzZS9maXJlc3RvcmVcIlxuaW1wb3J0IHsgZ2V0RGF0YWJhc2UgfSBmcm9tIFwiZmlyZWJhc2UvZGF0YWJhc2VcIlxuaW1wb3J0IHsgYnJvd3NlciB9IGZyb20gJ3d4dC9icm93c2VyJ1xuXG5leHBvcnQgY29uc3QgY2xpZW50Q3JlZGVudGlhbHMgPSB7XG4gIGFwaUtleTogXCJBSXphU3lBbkh5WVMtemR6ZmlUZTk3akpEZkVhZjFIeHFtdkx6bWNcIixcbiAgYXV0aERvbWFpbjogXCJjb25mbGljdG9sb2d5LWNvbmZsaWN0LmZpcmViYXNlYXBwLmNvbVwiLFxuICBwcm9qZWN0SWQ6IFwiY29uZmxpY3RvbG9neS1jb25mbGljdFwiLFxuICBzdG9yYWdlQnVja2V0OiBcImNvbmZsaWN0b2xvZ3ktY29uZmxpY3QuYXBwc3BvdC5jb21cIixcbiAgbWVzc2FnaW5nU2VuZGVySWQ6IFwiMjA1NDk1MDcxMTE5XCIsXG4gIGFwcElkOiBcIjE6MjA1NDk1MDcxMTE5OndlYjpjOTA3NzUzMDkzOWQ3MTE2MGMxYmZhXCIsXG4gIGRhdGFiYXNlVVJMOiBcImh0dHBzOi8vY29uZmxpY3RvbG9neS1jb25mbGljdC1kZWZhdWx0LXJ0ZGIuZmlyZWJhc2Vpby5jb21cIixcbn1cblxubGV0IGZpcmViYXNlX2FwcCA9IGdldEFwcHMoKS5sZW5ndGggPyBnZXRBcHBzKClbMF0gOiBpbml0aWFsaXplQXBwKGNsaWVudENyZWRlbnRpYWxzKVxuXG5leHBvcnQgY29uc3QgYXV0aCA9IGdldEF1dGgoZmlyZWJhc2VfYXBwKVxuZXhwb3J0IGNvbnN0IGRiID0gZ2V0RmlyZXN0b3JlKGZpcmViYXNlX2FwcClcbmV4cG9ydCBjb25zdCBydGRiID0gZ2V0RGF0YWJhc2UoZmlyZWJhc2VfYXBwKVxuXG5zZXRQZXJzaXN0ZW5jZShhdXRoLCBpbmRleGVkREJMb2NhbFBlcnNpc3RlbmNlKVxuXG4vLyBJbml0aWFsaXplIGF1dGggc3RhdGUgZnJvbSBsb2NhbFN0b3JhZ2Ugd2hlbiB0aGUgbW9kdWxlIGlzIGxvYWRlZFxuYnJvd3Nlci5zdG9yYWdlLmxvY2FsLmdldCgndXNlcicpLnRoZW4oKHsgdXNlciB9KSA9PiB7XG4gIGlmICh1c2VyICYmIHVzZXIudWlkKSB7XG4gICAgY29uc29sZS5sb2coXCJGb3VuZCB1c2VyIGluIGxvY2FsIHN0b3JhZ2UsIGF1dGhlbnRpY2F0aW5nIHdpdGggRmlyZWJhc2UuLi5cIik7XG4gICAgYXV0aGVudGljYXRlV2l0aEZpcmViYXNlKHVzZXIudWlkKVxuICAgICAgLnRoZW4oKCkgPT4gY29uc29sZS5sb2coXCJTdWNjZXNzZnVsbHkgaW5pdGlhbGl6ZWQgRmlyZWJhc2UgYXV0aCBmcm9tIHN0b3JhZ2VcIikpXG4gICAgICAuY2F0Y2goZXJyID0+IGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gaW5pdGlhbGl6ZSBGaXJlYmFzZSBhdXRoIGZyb20gc3RvcmFnZTpcIiwgZXJyKSk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coXCJObyB1c2VyIGZvdW5kIGluIGxvY2FsIHN0b3JhZ2VcIik7XG4gIH1cbn0pO1xuXG4vLyBGdW5jdGlvbiB0byBhdXRoZW50aWNhdGUgd2l0aCBGaXJlYmFzZSB1c2luZyBjdXN0b20gdG9rZW5cbmV4cG9ydCBjb25zdCBhdXRoZW50aWNhdGVXaXRoRmlyZWJhc2UgPSBhc3luYyAodWlkOiBzdHJpbmcpID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZyhcIkF1dGhlbnRpY2F0aW5nIHdpdGggRmlyZWJhc2UgdXNpbmcgVUlEOlwiLCB1aWQpO1xuICAgIFxuICAgIC8vIEV4Y2hhbmdlIFVJRCBmb3IgYSBjdXN0b20gdG9rZW5cbiAgICBjb25zb2xlLmxvZyhcIkZldGNoaW5nIGN1c3RvbSB0b2tlbiBmcm9tIEFQSS4uLlwiKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCdodHRwczovL2NvbmZsaWN0b2xvZ3ktd2ViLnZlcmNlbC5hcHAvYXBpL2F1dGgvdG9rZW4nLCB7XG4gICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgLy8gbm8gY29ycyBjby1jb3JzXG4gICAgICB9LFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB1aWQgfSlcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKFwiQVBJIHJlc3BvbnNlIHN0YXR1czpcIiwgcmVzcG9uc2Uuc3RhdHVzKTtcbiAgICBcbiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7XG4gICAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoXCJBUEkgZXJyb3IgcmVzcG9uc2U6XCIsIGVycm9yKTtcbiAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvci5lcnJvciB8fCAnRmFpbGVkIHRvIGdldCBjdXN0b20gdG9rZW4nKTtcbiAgICB9XG5cbiAgICBjb25zdCByZXNwb25zZURhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7XG4gICAgY29uc29sZS5sb2coXCJBUEkgcmVzcG9uc2UgZGF0YTpcIiwgcmVzcG9uc2VEYXRhKTtcbiAgICBcbiAgICBjb25zdCB7IGN1c3RvbVRva2VuIH0gPSByZXNwb25zZURhdGE7XG4gICAgY29uc29sZS5sb2coXCJDdXN0b20gdG9rZW4gcmVjZWl2ZWQ6XCIsIGN1c3RvbVRva2VuID8gY3VzdG9tVG9rZW4uc3Vic3RyaW5nKDAsIDEwKSArIFwiLi4uXCIgOiBcIk5vbmVcIik7XG4gICAgXG4gICAgaWYgKCFjdXN0b21Ub2tlbikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBjdXN0b20gdG9rZW4gcmVjZWl2ZWQnKTtcbiAgICB9XG4gICAgXG4gICAgLy8gU2lnbiBpbiB3aXRoIHRoZSBjdXN0b20gdG9rZW5cbiAgICBjb25zb2xlLmxvZyhcIlNpZ25pbmcgaW4gd2l0aCBjdXN0b20gdG9rZW4uLi5cIik7XG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2lnbkluV2l0aEN1c3RvbVRva2VuKGF1dGgsIGN1c3RvbVRva2VuKTtcbiAgICBjb25zb2xlLmxvZyhcIlNpZ24gaW4gc3VjY2Vzc2Z1bCwgdXNlcjpcIiwgcmVzdWx0LnVzZXI/LnVpZCk7XG4gICAgXG4gICAgLy8gQWRkaXRpb25hbCB2ZXJpZmljYXRpb25cbiAgICBjb25zdCBjdXJyZW50VXNlciA9IGF1dGguY3VycmVudFVzZXI7XG4gICAgY29uc29sZS5sb2coXCJDdXJyZW50IEZpcmViYXNlIHVzZXIgYWZ0ZXIgYXV0aGVudGljYXRpb246XCIsIGN1cnJlbnRVc2VyPy51aWQpO1xuICAgIFxuICAgIHJldHVybiByZXN1bHQ7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcihcIkF1dGhlbnRpY2F0aW9uIGVycm9yOlwiLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgZmlyZWJhc2VfYXBwXG5cblxuLy8gRnVuY3Rpb24gdG8gc2lnbiBvdXRcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaWduT3V0KCk6IFByb21pc2U8dm9pZD4ge1xuICByZXR1cm4gYXV0aC5zaWduT3V0KCk7XG59XG5cbi8vIEZ1bmN0aW9uIHRvIGdldCB0aGUgY3VycmVudCB1c2VyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudFVzZXIoKTogVXNlciB8IG51bGwge1xuICByZXR1cm4gYXV0aC5jdXJyZW50VXNlcjtcbn1cblxuIiwiLy8vIDxyZWZlcmVuY2UgbGliPVwid2Vid29ya2VyXCIgLz5cbmRlY2xhcmUgY29uc3Qgc2VsZjogU2VydmljZVdvcmtlckdsb2JhbFNjb3BlO1xuaW1wb3J0IHsgYXV0aGVudGljYXRlV2l0aEZpcmViYXNlIH0gZnJvbSBcIi4uL2ZpcmViYXNlL2ZpcmViYXNlQ2xpZW50XCI7XG5pbXBvcnQgeyBicm93c2VyIH0gZnJvbSAnd3h0L2Jyb3dzZXInO1xuXG5leHBvcnQgZGVmYXVsdCBkZWZpbmVCYWNrZ3JvdW5kKCgpID0+IHtcbiAgICAvLyBDaGVjayBpZiBicm93c2VyIHN1cHBvcnRzIHNpZGUgcGFuZWwgQVBJXG4gICAgY29uc3QgaGFzU2lkZVBhbmVsU3VwcG9ydCA9ICEhKGJyb3dzZXIgYXMgYW55KS5zaWRlUGFuZWwgJiYgISEoYnJvd3NlciBhcyBhbnkpLnNpZGVQYW5lbC5vcGVuO1xuXG4gICAgLy8gT3BlbiBzaWRlIHBhbmVsIHdoZW4gZXh0ZW5zaW9uIGljb24gaXMgY2xpY2tlZFxuICAgIGJyb3dzZXIuYWN0aW9uLm9uQ2xpY2tlZC5hZGRMaXN0ZW5lcigodGFiKSA9PiB7XG4gICAgICBpZiAoaGFzU2lkZVBhbmVsU3VwcG9ydCkge1xuICAgICAgICAvLyBVc2Ugc2lkZSBwYW5lbCBpZiBzdXBwb3J0ZWRcbiAgICAgICAgLy8gT3BlbiBzeW5jaHJvbm91c2x5IHRvIHByZXNlcnZlIHVzZXIgZ2VzdHVyZSBjb250ZXh0XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgd2luZG93SWQgPSB0YWIud2luZG93SWQ7XG4gICAgICAgICAgaWYgKHdpbmRvd0lkKSB7XG4gICAgICAgICAgICAoYnJvd3NlciBhcyBhbnkpLnNpZGVQYW5lbC5vcGVuKHsgd2luZG93SWQgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBvcGVuaW5nIHNpZGUgcGFuZWw6XCIsIGVycm9yKTtcbiAgICAgICAgICAvLyBGYWxsYmFjayBpZiBzaWRlIHBhbmVsIGZhaWxzIHRvIG9wZW5cbiAgICAgICAgICBicm93c2VyLnRhYnMuY3JlYXRlKHsgdXJsOiAnc3RhbmRhbG9uZS5odG1sJyB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gRmFsbGJhY2s6IG9wZW4gc3RhbmRhbG9uZSB2ZXJzaW9uIGluIGEgbmV3IHRhYlxuICAgICAgICBicm93c2VyLnRhYnMuY3JlYXRlKHsgdXJsOiAnc3RhbmRhbG9uZS5odG1sJyB9KTtcbiAgICAgIH1cbiAgICB9KTtcbiAgXG4gICAgLy8gTG9nIHNpZGVwYW5lbCBzdXBwb3J0IHN0YXR1cyB0byBoZWxwIHdpdGggZGVidWdnaW5nXG4gICAgY29uc29sZS5sb2coJ1NpZGUgUGFuZWwgU3VwcG9ydDogJyArIChoYXNTaWRlUGFuZWxTdXBwb3J0ID8gJ1llcycgOiAnTm8nKSk7XG5cbiAgYnJvd3Nlci5ydW50aW1lLm9uSW5zdGFsbGVkLmFkZExpc3RlbmVyKChkZXRhaWxzKSA9PiB7XG4gICAgaWYgKGRldGFpbHMucmVhc29uID09PSAnY2hyb21lX3VwZGF0ZScpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoZGV0YWlscy5yZWFzb24gPT09ICdpbnN0YWxsJykge1xuICAgICAgYnJvd3Nlci50YWJzLmNyZWF0ZSh7XG4gICAgICAgIHVybDogXCJodHRwczovL2NvbmZsaWN0b2xvZ3lnYW1lcy5jb20vcnVsZXNcIlxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICBjb25zdCBPRkZTQ1JFRU5fRE9DVU1FTlRfUEFUSCA9ICcvb2Zmc2NyZWVuLmh0bWwnO1xuICBsZXQgY3JlYXRpbmdPZmZzY3JlZW5Eb2N1bWVudDogUHJvbWlzZTx2b2lkPiB8IG51bGwgPSBudWxsO1xuXG4gIGFzeW5jIGZ1bmN0aW9uIGhhc09mZnNjcmVlbkRvY3VtZW50KCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IG1hdGNoZWRDbGllbnRzID0gYXdhaXQgc2VsZi5jbGllbnRzLm1hdGNoQWxsKCk7XG4gICAgcmV0dXJuIG1hdGNoZWRDbGllbnRzLnNvbWUoXG4gICAgICAoYykgPT4gYy51cmwgPT09IGJyb3dzZXIucnVudGltZS5nZXRVUkwoT0ZGU0NSRUVOX0RPQ1VNRU5UX1BBVEgpLFxuICAgICk7XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBzZXR1cE9mZnNjcmVlbkRvY3VtZW50KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmIChhd2FpdCBoYXNPZmZzY3JlZW5Eb2N1bWVudCgpKSByZXR1cm47XG5cbiAgICBpZiAoY3JlYXRpbmdPZmZzY3JlZW5Eb2N1bWVudCkge1xuICAgICAgYXdhaXQgY3JlYXRpbmdPZmZzY3JlZW5Eb2N1bWVudDtcbiAgICB9IGVsc2Uge1xuICAgICAgY3JlYXRpbmdPZmZzY3JlZW5Eb2N1bWVudCA9IGJyb3dzZXIub2Zmc2NyZWVuLmNyZWF0ZURvY3VtZW50KHtcbiAgICAgICAgdXJsOiBicm93c2VyLnJ1bnRpbWUuZ2V0VVJMKE9GRlNDUkVFTl9ET0NVTUVOVF9QQVRIKSxcbiAgICAgICAgcmVhc29uczogW2Jyb3dzZXIub2Zmc2NyZWVuLlJlYXNvbi5ET01fU0NSQVBJTkddLFxuICAgICAgICBqdXN0aWZpY2F0aW9uOiAnRmlyZWJhc2UgQXV0aGVudGljYXRpb24nXG4gICAgICB9KTtcbiAgICAgIGF3YWl0IGNyZWF0aW5nT2Zmc2NyZWVuRG9jdW1lbnQ7XG4gICAgICBjcmVhdGluZ09mZnNjcmVlbkRvY3VtZW50ID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBhc3luYyBmdW5jdGlvbiBnZXRBdXRoRnJvbU9mZnNjcmVlbigpOiBQcm9taXNlPGFueT4ge1xuICAgIGF3YWl0IHNldHVwT2Zmc2NyZWVuRG9jdW1lbnQoKTtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgYnJvd3Nlci5ydW50aW1lLnNlbmRNZXNzYWdlKHsgYWN0aW9uOiAnZ2V0QXV0aCcsIHRhcmdldDogJ29mZnNjcmVlbicgfSwgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGlmIChicm93c2VyLnJ1bnRpbWUubGFzdEVycm9yKSB7XG4gICAgICAgICAgcmVqZWN0KGJyb3dzZXIucnVudGltZS5sYXN0RXJyb3IpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc29sdmUocmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGludGVyZmFjZSBVc2VyIHtcbiAgICB1aWQ6IHN0cmluZztcbiAgICBlbWFpbDogc3RyaW5nIHwgbnVsbDtcbiAgICBkaXNwbGF5TmFtZTogc3RyaW5nIHwgbnVsbDtcbiAgfVxuXG4gIGJyb3dzZXIucnVudGltZS5vbk1lc3NhZ2UuYWRkTGlzdGVuZXIoKG1lc3NhZ2UsIHNlbmRlciwgc2VuZFJlc3BvbnNlKSA9PiB7XG4gICAgaWYgKG1lc3NhZ2UuYWN0aW9uID09PSBcInNpZ25JblwiKSB7XG4gICAgICBnZXRBdXRoRnJvbU9mZnNjcmVlbigpXG4gICAgICAgIC50aGVuKGFzeW5jICh1c2VyOiBVc2VyKSA9PiB7XG4gICAgICAgICAgaWYgKCF1c2VyIHx8ICF1c2VyLnVpZCkge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkZhaWxlZCB0byBnZXQgdmFsaWQgdXNlciBmcm9tIGF1dGggZmxvd1wiKTtcbiAgICAgICAgICAgIHNlbmRSZXNwb25zZSh7IGVycm9yOiBcIkF1dGhlbnRpY2F0aW9uIGZhaWxlZFwiIH0pO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIkF1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWwgZm9yOlwiLCB1c2VyLmVtYWlsIHx8IHVzZXIudWlkKTtcblxuICAgICAgICAgIGNvbnN0IG1pbmltYWxVc2VyID0ge1xuICAgICAgICAgICAgdWlkOiB1c2VyLnVpZCxcbiAgICAgICAgICAgIGVtYWlsOiB1c2VyLmVtYWlsLFxuICAgICAgICAgICAgZGlzcGxheU5hbWU6IHVzZXIuZGlzcGxheU5hbWVcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgY29uc29sZS5sb2coXCJNaW5pbWFsIHVzZXIgb2JqZWN0OlwiLCBtaW5pbWFsVXNlcik7XG5cbiAgICAgICAgICBpZiAodXNlci51aWQpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGF1dGhlbnRpY2F0ZVdpdGhGaXJlYmFzZSh1c2VyLnVpZClcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRmlyZWJhc2UgYXV0aGVudGljYXRpb24gcmVzcG9uc2U6XCIsIHJlcyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgXG4gICAgICAgICAgLy8gU3RvcmUgdXNlciBkYXRhXG4gICAgICAgICAgYXdhaXQgYnJvd3Nlci5zdG9yYWdlLmxvY2FsLnNldCh7IHVzZXI6IG1pbmltYWxVc2VyIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIE5vdGlmeSBhYm91dCBhdXRoZW50aWNhdGlvblxuICAgICAgICAgIGJyb3dzZXIucnVudGltZS5zZW5kTWVzc2FnZSh7IFxuICAgICAgICAgICAgdHlwZTogJ0FVVEhfU1RBVEVfQ0hBTkdFRCcsXG4gICAgICAgICAgICB1c2VyOiBtaW5pbWFsVXNlclxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIHNlbmRSZXNwb25zZSh7IHVzZXI6IG1pbmltYWxVc2VyIH0pO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJBdXRoZW50aWNhdGlvbiBlcnJvcjpcIiwgZXJyb3IpO1xuICAgICAgICAgIHNlbmRSZXNwb25zZSh7IGVycm9yOiBlcnJvci5tZXNzYWdlIH0pO1xuICAgICAgICB9KTtcbiAgICAgIHJldHVybiB0cnVlOyAvLyBLZWVwcyB0aGUgbWVzc2FnZSBjaGFubmVsIG9wZW4gZm9yIGFzeW5jIHJlc3BvbnNlXG4gICAgfVxuICAgIFxuICAgIGlmIChtZXNzYWdlLmFjdGlvbiA9PT0gXCJzaWduT3V0XCIpIHtcbiAgICAgIC8vIEhhbmRsZSBzaWduIG91dFxuICAgICAgKGFzeW5jICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlByb2Nlc3Npbmcgc2lnbiBvdXQgcmVxdWVzdFwiKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBDbGVhciB1c2VyIGRhdGEgZnJvbSBicm93c2VyIHN0b3JhZ2VcbiAgICAgICAgICBhd2FpdCBicm93c2VyLnN0b3JhZ2UubG9jYWwucmVtb3ZlKCd1c2VyJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gTm90aWZ5IGFsbCBsaXN0ZW5pbmcgY29tcG9uZW50cyBhYm91dCBhdXRoIHN0YXRlIGNoYW5nZVxuICAgICAgICAgIGJyb3dzZXIucnVudGltZS5zZW5kTWVzc2FnZSh7IFxuICAgICAgICAgICAgdHlwZTogJ0FVVEhfU1RBVEVfQ0hBTkdFRCcsXG4gICAgICAgICAgICB1c2VyOiBudWxsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc29sZS5sb2coXCJTaWduIG91dCBjb21wbGV0ZVwiKTtcbiAgICAgICAgICBzZW5kUmVzcG9uc2UoeyBzdWNjZXNzOiB0cnVlIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJFcnJvciBkdXJpbmcgc2lnbiBvdXQ6XCIsIGVycm9yKTtcbiAgICAgICAgICBzZW5kUmVzcG9uc2UoeyBlcnJvcjogU3RyaW5nKGVycm9yKSB9KTtcbiAgICAgICAgfVxuICAgICAgfSkoKTtcbiAgICAgIHJldHVybiB0cnVlOyAvLyBLZWVwcyB0aGUgbWVzc2FnZSBjaGFubmVsIG9wZW4gZm9yIGFzeW5jIHJlc3BvbnNlXG4gICAgfVxuICAgIFxuICAgIHJldHVybiBmYWxzZTtcbiAgfSk7XG5cbiAgYnJvd3Nlci50YWJzLm9uVXBkYXRlZC5hZGRMaXN0ZW5lcigodGFiSWQsIGNoYW5nZUluZm8sIHRhYikgPT4ge1xuICAgIGlmIChcbiAgICAgIHRhYi51cmw/LnN0YXJ0c1dpdGgoXCJodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvYXV0aC9cIikgfHxcbiAgICAgIHRhYi51cmw/LnN0YXJ0c1dpdGgoXCJodHRwczovL2NvbmZsaWN0b2xvZ3ktY29uZmxpY3QuZmlyZWJhc2VhcHAuY29tXCIpXG4gICAgKSB7XG4gICAgICBpZiAodGFiLndpbmRvd0lkKSB7XG4gICAgICAgIGJyb3dzZXIud2luZG93cy51cGRhdGUodGFiLndpbmRvd0lkLCB7IGZvY3VzZWQ6IHRydWUgfSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuICB9KTtcbn0pOyIsIi8vIHNyYy9pbmRleC50c1xudmFyIF9NYXRjaFBhdHRlcm4gPSBjbGFzcyB7XG4gIGNvbnN0cnVjdG9yKG1hdGNoUGF0dGVybikge1xuICAgIGlmIChtYXRjaFBhdHRlcm4gPT09IFwiPGFsbF91cmxzPlwiKSB7XG4gICAgICB0aGlzLmlzQWxsVXJscyA9IHRydWU7XG4gICAgICB0aGlzLnByb3RvY29sTWF0Y2hlcyA9IFsuLi5fTWF0Y2hQYXR0ZXJuLlBST1RPQ09MU107XG4gICAgICB0aGlzLmhvc3RuYW1lTWF0Y2ggPSBcIipcIjtcbiAgICAgIHRoaXMucGF0aG5hbWVNYXRjaCA9IFwiKlwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBncm91cHMgPSAvKC4qKTpcXC9cXC8oLio/KShcXC8uKikvLmV4ZWMobWF0Y2hQYXR0ZXJuKTtcbiAgICAgIGlmIChncm91cHMgPT0gbnVsbClcbiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRNYXRjaFBhdHRlcm4obWF0Y2hQYXR0ZXJuLCBcIkluY29ycmVjdCBmb3JtYXRcIik7XG4gICAgICBjb25zdCBbXywgcHJvdG9jb2wsIGhvc3RuYW1lLCBwYXRobmFtZV0gPSBncm91cHM7XG4gICAgICB2YWxpZGF0ZVByb3RvY29sKG1hdGNoUGF0dGVybiwgcHJvdG9jb2wpO1xuICAgICAgdmFsaWRhdGVIb3N0bmFtZShtYXRjaFBhdHRlcm4sIGhvc3RuYW1lKTtcbiAgICAgIHZhbGlkYXRlUGF0aG5hbWUobWF0Y2hQYXR0ZXJuLCBwYXRobmFtZSk7XG4gICAgICB0aGlzLnByb3RvY29sTWF0Y2hlcyA9IHByb3RvY29sID09PSBcIipcIiA/IFtcImh0dHBcIiwgXCJodHRwc1wiXSA6IFtwcm90b2NvbF07XG4gICAgICB0aGlzLmhvc3RuYW1lTWF0Y2ggPSBob3N0bmFtZTtcbiAgICAgIHRoaXMucGF0aG5hbWVNYXRjaCA9IHBhdGhuYW1lO1xuICAgIH1cbiAgfVxuICBpbmNsdWRlcyh1cmwpIHtcbiAgICBpZiAodGhpcy5pc0FsbFVybHMpXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICBjb25zdCB1ID0gdHlwZW9mIHVybCA9PT0gXCJzdHJpbmdcIiA/IG5ldyBVUkwodXJsKSA6IHVybCBpbnN0YW5jZW9mIExvY2F0aW9uID8gbmV3IFVSTCh1cmwuaHJlZikgOiB1cmw7XG4gICAgcmV0dXJuICEhdGhpcy5wcm90b2NvbE1hdGNoZXMuZmluZCgocHJvdG9jb2wpID0+IHtcbiAgICAgIGlmIChwcm90b2NvbCA9PT0gXCJodHRwXCIpXG4gICAgICAgIHJldHVybiB0aGlzLmlzSHR0cE1hdGNoKHUpO1xuICAgICAgaWYgKHByb3RvY29sID09PSBcImh0dHBzXCIpXG4gICAgICAgIHJldHVybiB0aGlzLmlzSHR0cHNNYXRjaCh1KTtcbiAgICAgIGlmIChwcm90b2NvbCA9PT0gXCJmaWxlXCIpXG4gICAgICAgIHJldHVybiB0aGlzLmlzRmlsZU1hdGNoKHUpO1xuICAgICAgaWYgKHByb3RvY29sID09PSBcImZ0cFwiKVxuICAgICAgICByZXR1cm4gdGhpcy5pc0Z0cE1hdGNoKHUpO1xuICAgICAgaWYgKHByb3RvY29sID09PSBcInVyblwiKVxuICAgICAgICByZXR1cm4gdGhpcy5pc1Vybk1hdGNoKHUpO1xuICAgIH0pO1xuICB9XG4gIGlzSHR0cE1hdGNoKHVybCkge1xuICAgIHJldHVybiB1cmwucHJvdG9jb2wgPT09IFwiaHR0cDpcIiAmJiB0aGlzLmlzSG9zdFBhdGhNYXRjaCh1cmwpO1xuICB9XG4gIGlzSHR0cHNNYXRjaCh1cmwpIHtcbiAgICByZXR1cm4gdXJsLnByb3RvY29sID09PSBcImh0dHBzOlwiICYmIHRoaXMuaXNIb3N0UGF0aE1hdGNoKHVybCk7XG4gIH1cbiAgaXNIb3N0UGF0aE1hdGNoKHVybCkge1xuICAgIGlmICghdGhpcy5ob3N0bmFtZU1hdGNoIHx8ICF0aGlzLnBhdGhuYW1lTWF0Y2gpXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgY29uc3QgaG9zdG5hbWVNYXRjaFJlZ2V4cyA9IFtcbiAgICAgIHRoaXMuY29udmVydFBhdHRlcm5Ub1JlZ2V4KHRoaXMuaG9zdG5hbWVNYXRjaCksXG4gICAgICB0aGlzLmNvbnZlcnRQYXR0ZXJuVG9SZWdleCh0aGlzLmhvc3RuYW1lTWF0Y2gucmVwbGFjZSgvXlxcKlxcLi8sIFwiXCIpKVxuICAgIF07XG4gICAgY29uc3QgcGF0aG5hbWVNYXRjaFJlZ2V4ID0gdGhpcy5jb252ZXJ0UGF0dGVyblRvUmVnZXgodGhpcy5wYXRobmFtZU1hdGNoKTtcbiAgICByZXR1cm4gISFob3N0bmFtZU1hdGNoUmVnZXhzLmZpbmQoKHJlZ2V4KSA9PiByZWdleC50ZXN0KHVybC5ob3N0bmFtZSkpICYmIHBhdGhuYW1lTWF0Y2hSZWdleC50ZXN0KHVybC5wYXRobmFtZSk7XG4gIH1cbiAgaXNGaWxlTWF0Y2godXJsKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWQ6IGZpbGU6Ly8gcGF0dGVybiBtYXRjaGluZy4gT3BlbiBhIFBSIHRvIGFkZCBzdXBwb3J0XCIpO1xuICB9XG4gIGlzRnRwTWF0Y2godXJsKSB7XG4gICAgdGhyb3cgRXJyb3IoXCJOb3QgaW1wbGVtZW50ZWQ6IGZ0cDovLyBwYXR0ZXJuIG1hdGNoaW5nLiBPcGVuIGEgUFIgdG8gYWRkIHN1cHBvcnRcIik7XG4gIH1cbiAgaXNVcm5NYXRjaCh1cmwpIHtcbiAgICB0aHJvdyBFcnJvcihcIk5vdCBpbXBsZW1lbnRlZDogdXJuOi8vIHBhdHRlcm4gbWF0Y2hpbmcuIE9wZW4gYSBQUiB0byBhZGQgc3VwcG9ydFwiKTtcbiAgfVxuICBjb252ZXJ0UGF0dGVyblRvUmVnZXgocGF0dGVybikge1xuICAgIGNvbnN0IGVzY2FwZWQgPSB0aGlzLmVzY2FwZUZvclJlZ2V4KHBhdHRlcm4pO1xuICAgIGNvbnN0IHN0YXJzUmVwbGFjZWQgPSBlc2NhcGVkLnJlcGxhY2UoL1xcXFxcXCovZywgXCIuKlwiKTtcbiAgICByZXR1cm4gUmVnRXhwKGBeJHtzdGFyc1JlcGxhY2VkfSRgKTtcbiAgfVxuICBlc2NhcGVGb3JSZWdleChzdHJpbmcpIHtcbiAgICByZXR1cm4gc3RyaW5nLnJlcGxhY2UoL1suKis/XiR7fSgpfFtcXF1cXFxcXS9nLCBcIlxcXFwkJlwiKTtcbiAgfVxufTtcbnZhciBNYXRjaFBhdHRlcm4gPSBfTWF0Y2hQYXR0ZXJuO1xuTWF0Y2hQYXR0ZXJuLlBST1RPQ09MUyA9IFtcImh0dHBcIiwgXCJodHRwc1wiLCBcImZpbGVcIiwgXCJmdHBcIiwgXCJ1cm5cIl07XG52YXIgSW52YWxpZE1hdGNoUGF0dGVybiA9IGNsYXNzIGV4dGVuZHMgRXJyb3Ige1xuICBjb25zdHJ1Y3RvcihtYXRjaFBhdHRlcm4sIHJlYXNvbikge1xuICAgIHN1cGVyKGBJbnZhbGlkIG1hdGNoIHBhdHRlcm4gXCIke21hdGNoUGF0dGVybn1cIjogJHtyZWFzb259YCk7XG4gIH1cbn07XG5mdW5jdGlvbiB2YWxpZGF0ZVByb3RvY29sKG1hdGNoUGF0dGVybiwgcHJvdG9jb2wpIHtcbiAgaWYgKCFNYXRjaFBhdHRlcm4uUFJPVE9DT0xTLmluY2x1ZGVzKHByb3RvY29sKSAmJiBwcm90b2NvbCAhPT0gXCIqXCIpXG4gICAgdGhyb3cgbmV3IEludmFsaWRNYXRjaFBhdHRlcm4oXG4gICAgICBtYXRjaFBhdHRlcm4sXG4gICAgICBgJHtwcm90b2NvbH0gbm90IGEgdmFsaWQgcHJvdG9jb2wgKCR7TWF0Y2hQYXR0ZXJuLlBST1RPQ09MUy5qb2luKFwiLCBcIil9KWBcbiAgICApO1xufVxuZnVuY3Rpb24gdmFsaWRhdGVIb3N0bmFtZShtYXRjaFBhdHRlcm4sIGhvc3RuYW1lKSB7XG4gIGlmIChob3N0bmFtZS5pbmNsdWRlcyhcIjpcIikpXG4gICAgdGhyb3cgbmV3IEludmFsaWRNYXRjaFBhdHRlcm4obWF0Y2hQYXR0ZXJuLCBgSG9zdG5hbWUgY2Fubm90IGluY2x1ZGUgYSBwb3J0YCk7XG4gIGlmIChob3N0bmFtZS5pbmNsdWRlcyhcIipcIikgJiYgaG9zdG5hbWUubGVuZ3RoID4gMSAmJiAhaG9zdG5hbWUuc3RhcnRzV2l0aChcIiouXCIpKVxuICAgIHRocm93IG5ldyBJbnZhbGlkTWF0Y2hQYXR0ZXJuKFxuICAgICAgbWF0Y2hQYXR0ZXJuLFxuICAgICAgYElmIHVzaW5nIGEgd2lsZGNhcmQgKCopLCBpdCBtdXN0IGdvIGF0IHRoZSBzdGFydCBvZiB0aGUgaG9zdG5hbWVgXG4gICAgKTtcbn1cbmZ1bmN0aW9uIHZhbGlkYXRlUGF0aG5hbWUobWF0Y2hQYXR0ZXJuLCBwYXRobmFtZSkge1xuICByZXR1cm47XG59XG5leHBvcnQge1xuICBJbnZhbGlkTWF0Y2hQYXR0ZXJuLFxuICBNYXRjaFBhdHRlcm5cbn07XG4iXSwibmFtZXMiOlsiaXNWYWxpZEtleSIsIl9hIiwiX2IiLCJlcnJvciIsImIiLCJuYW1lIiwiREVGQVVMVF9FTlRSWV9OQU1FIiwiTG9nTGV2ZWwiLCJ2ZXJzaW9uIiwidGFyZ2V0IiwidmVyc2lvbiQxIiwibG9nZ2VyIiwibmFtZSQyIiwibmFtZSQxIiwiU0RLX1ZFUlNJT04iLCJEQl9OQU1FIiwiREJfVkVSU0lPTiIsInJlc3VsdCIsImxvZ0NsaWVudCIsImF1dGgiLCJyZWxvYWQiLCJjb21tb25qc0dsb2JhbCIsInYiLCJDIiwiRCIsIlMiLCJlIiwidCIsIm4iLCJzIiwic2hhMSIsIm1hcCIsImJhc2UxMiIsInJvb3QiLCJPcGVyYXRpb25UeXBlIiwibmV3V3JpdGVUcmVlIiwibmV3Vmlld0NhY2hlIiwic2VydmVyQ2FjaGUiLCJlcnJvclByZWZpeCIsImJyb3dzZXIiLCJfYnJvd3NlciJdLCJtYXBwaW5ncyI6Ijs7O0FBQU8sV0FBUyxpQkFBaUIsS0FBSztBQUNwQyxRQUFJLE9BQU8sUUFBUSxPQUFPLFFBQVEsV0FBWSxRQUFPLEVBQUUsTUFBTSxJQUFLO0FBQ2xFLFdBQU87QUFBQSxFQUNUO0FDSEEsUUFBTSw2QkFBNkIsTUFBTztBQUFBLEVDRTFDO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBbUJBLFFBQU0sWUFBWTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBUWQsWUFBWTtBQUFBO0FBQUE7QUFBQTtBQUFBLElBSVosYUFBYTtBQUFBLEVBQ2pCO0FBQUEsRUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQW1CQSxRQUFNLFNBQVMsU0FBVSxXQUFXLFNBQVM7QUFDekMsUUFBSSxDQUFDLFdBQVc7QUFDWixZQUFNLGVBQWUsT0FBTztBQUFBLElBQ3BDO0FBQUEsRUFDQTtBQUlBLFFBQU0saUJBQWlCLFNBQVUsU0FBUztBQUN0QyxXQUFPLElBQUks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O0FBRWYsUUFBTVIsU0FBTztBQUNiLFFBQU1HLFlBQVU7QUFBQSxFQUVoQjtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQXFCQSxRQUFNLHFCQUFxQjtBQUMzQixRQUFNLHNCQUFzQjtBQUFBLElBQ3hCLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUMsTUFBTSxHQUFHO0FBQUEsSUFDVixDQUFDLE1BQU0sR0FBRztBQUFBLElBQ1YsQ0FBQyxNQUFNLEdBQUc7QUFBQSxJQUNWLENBQUNLLFFBQU0sR0FBRztBQUFBLElBQ1YsQ0FBQ0QsUUFBTSxHQUFHO0FBQUEsSUFDVixXQUFXO0FBQUE7QUFBQSxJQUNYLENBQUNQLE1BQUksR0FBRztBQUFBLEVBQ1o7QUFBQSxFQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtB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QSxHQUFFLElBQUUsQ0FBQyxJQUFFLFVBQVUsQ0FBQztBQUFFLGVBQU8sRUFBRSxVQUFVLENBQUMsRUFBRSxNQUFNLEdBQUVBLEVBQUM7QUFBQSxNQUFDO0FBQUEsSUFBRTtBQUFDLGFBQVMsSUFBRztBQUFDLFdBQUssWUFBVTtBQUFBLElBQUc7QUFBQyxhQUFTLElBQUc7QUFBQyxXQUFLLFlBQVU7QUFBRyxXQUFLLFlBQVU7QUFBRyxXQUFLLElBQUUsTUFBTSxDQUFDO0FBQUUsV0FBSyxJQUFFLE1BQU0sS0FBSyxTQUFTO0FBQUUsV0FBSyxJQUFFLEtBQUssSUFBRTtBQUFFLFdBQUssRUFBRztBQUFBLElBQUM7QUFBQyxNQUFFLEdBQUUsQ0FBQztBQUFFLE1BQUUsVUFBVSxJQUFFLFdBQVU7QUFBQyxXQUFLLEVBQUUsQ0FBQyxJQUFFO0FBQVcsV0FBSyxFQUFFLENBQUMsSUFBRTtBQUFXLFdBQUssRUFBRSxDQUFDLElBQUU7QUFBVyxXQUFLLEVBQUUsQ0FBQyxJQUFFO0FBQVUsV0FBSyxJQUFFLEtBQUssSUFBRTtBQUFBLElBQUU7QUFDdmhCLGFBQVMsRUFBRSxHQUFFLEdBQUUsR0FBRTtBQUFDLFlBQUksSUFBRTtBQUFHLFVBQUksSUFBRSxNQUFNLEVBQUU7QUFBRSxVQUFHLGFBQVcsT0FBTyxFQUFFLFVBQVEsSUFBRSxHQUFFLEtBQUcsR0FBRSxFQUFFLEVBQUUsR0FBRSxDQUFDLElBQUUsRUFBRSxXQUFXLEdBQUcsSUFBRSxFQUFFLFdBQVcsR0FBRyxLQUFHLElBQUUsRUFBRSxXQUFXLEdBQUcsS0FBRyxLQUFHLEVBQUUsV0FBVyxHQUFHLEtBQUc7QUFBQSxVQUFRLE1BQUksSUFBRSxHQUFFLEtBQUcsR0FBRSxFQUFFLEVBQUUsR0FBRSxDQUFDLElBQUUsRUFBRSxHQUFHLElBQUUsRUFBRSxHQUFHLEtBQUcsSUFBRSxFQUFFLEdBQUcsS0FBRyxLQUFHLEVBQUUsR0FBRyxLQUFHO0FBQUcsVUFBRSxFQUFFLEVBQUUsQ0FBQztBQUFFLFVBQUUsRUFBRSxFQUFFLENBQUM7QUFBRSxVQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsVUFBSSxJQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsVUFBSUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLFlBQVU7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQ2xmLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUMxZUEsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQ25mLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsWUFBVTtBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsV0FBUztBQUFXLFVBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUNuZixLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLFlBQVU7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsS0FBRyxJQUFFLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxJQUFFLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxLQUFHLElBQUUsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFDL2UsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLEtBQUcsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsRUFBRSxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUcsTUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLElBQUUsSUFBRSxLQUFHLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUNsZkEsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLEVBQUUsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFHLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLEVBQUUsSUFBRSxZQUFVO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxXQUFTO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFHLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxJQUFFLElBQUUsS0FBRyxFQUFFLEVBQUUsSUFDdGYsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxFQUFFLElBQUUsWUFBVTtBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsSUFBRSxJQUFFLEtBQUcsRUFBRSxDQUFDLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBRyxNQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQ2xmO0FBQVcsVUFBRSxLQUFHQSxNQUFHLElBQUUsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsS0FBRyxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxhQUFXO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsRUFBRSxJQUFFLGFBQzllO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxVQUFFLEtBQUdBLE1BQUcsSUFBRSxhQUFXQSxPQUFJO0FBQUksTUFBQUEsS0FBRSxLQUFHLEtBQUcsSUFBRSxDQUFDLE1BQUksRUFBRSxFQUFFLElBQUUsYUFBVztBQUFXLFVBQUUsS0FBR0EsTUFBRyxLQUFHLGFBQVdBLE9BQUk7QUFBSSxNQUFBQSxLQUFFLEtBQUcsS0FBRyxJQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxZQUFVO0FBQVcsVUFBRSxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSTtBQUFJLE1BQUFBLEtBQUUsS0FBRyxLQUFHLElBQUUsQ0FBQyxNQUFJLEVBQUUsQ0FBQyxJQUFFLGFBQVc7QUFBVyxRQUFFLEVBQUUsQ0FBQyxJQUFFLEVBQUUsRUFBRSxDQUFDLElBQUUsSUFBRTtBQUFXLFFBQUUsRUFBRSxDQUFDLElBQUUsRUFBRSxFQUFFLENBQUMsS0FBRyxLQUFHQSxNQUFHLEtBQUcsYUFBV0EsT0FBSSxPQUFLO0FBQVcsUUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFFLElBQUU7QUFBVyxRQUFFLEVBQUUsQ0FBQyxJQUFFLEVBQUUsRUFBRSxDQUFDLElBQUUsSUFBRTtBQUFBLElBQVc7QUFDbGIsTUFBRSxVQUFVLElBQUUsU0FBUyxHQUFFLEdBQUU7aUJBQVUsTUFBSSxJQUFFLEVBQUU7QUFBUSxlQUFRLElBQUUsSUFBRSxLQUFLLFdBQVUsSUFBRSxLQUFLLEdBQUUsSUFBRSxLQUFLLEdBQUUsSUFBRSxHQUFFLElBQUUsS0FBRztBQUFDLFlBQUcsS0FBRyxFQUFFLFFBQUssS0FBRyxJQUFHLEdBQUUsTUFBSyxHQUFFLENBQUMsR0FBRSxLQUFHLEtBQUs7QUFBVSxZQUFHLGFBQVcsT0FBTyxFQUFFLFFBQUssSUFBRSxLQUFHO0FBQUMsY0FBRyxFQUFFLEdBQUcsSUFBRSxFQUFFLFdBQVcsR0FBRyxHQUFFLEtBQUcsS0FBSyxXQUFVO0FBQUMsY0FBRSxNQUFLLENBQUM7QUFBRSxnQkFBRTtBQUFFO0FBQUEsVUFBSztBQUFBLFFBQUM7QUFBQSxZQUFNLFFBQUssSUFBRSxJQUFHLEtBQUcsRUFBRSxHQUFHLElBQUUsRUFBRSxHQUFHLEdBQUUsS0FBRyxLQUFLLFdBQVU7QUFBQyxZQUFFLE1BQUssQ0FBQztBQUFFLGNBQUU7QUFBRTtBQUFBLFFBQUs7QUFBQSxNQUFDO0FBQUMsV0FBSyxJQUFFO0FBQUUsV0FBSyxLQUFHO0FBQUEsSUFBRTtBQUM5VixNQUFFLFVBQVUsSUFBRSxXQUFVO0FBQUMsVUFBSSxJQUFFLE9BQU8sS0FBRyxLQUFLLElBQUUsS0FBSyxZQUFVLElBQUUsS0FBSyxhQUFXLEtBQUssQ0FBQztBQUFFLFFBQUUsQ0FBQyxJQUFFO0FBQUksZUFBUSxJQUFFLEdBQUUsSUFBRSxFQUFFLFNBQU8sR0FBRSxFQUFFLEVBQUUsR0FBRSxDQUFDLElBQUU7QUFBRSxVQUFJLElBQUUsSUFBRSxLQUFLO0FBQUUsV0FBSSxJQUFFLEVBQUUsU0FBTyxHQUFFLElBQUUsRUFBRSxRQUFPLEVBQUUsRUFBRSxHQUFFLENBQUMsSUFBRSxJQUFFLEtBQUksS0FBRztBQUFJLFdBQUssRUFBRSxDQUFDO0FBQUUsVUFBRSxNQUFNLEVBQUU7QUFBRSxXQUFJLElBQUUsSUFBRSxHQUFFLElBQUUsR0FBRSxFQUFFLEVBQUUsVUFBUSxJQUFFLEdBQUUsS0FBRyxHQUFFLEtBQUcsRUFBRSxHQUFFLEdBQUcsSUFBRSxLQUFLLEVBQUUsQ0FBQyxNQUFJLElBQUU7QUFBSSxhQUFPO0FBQUEsSUFBQztBQUFFLGFBQVMsRUFBRSxHQUFFLEdBQUU7QUFBQyxVQUFJLElBQUU7QUFBRSxhQUFPLE9BQU8sVUFBVSxlQUFlLEtBQUssR0FBRSxDQUFDLElBQUUsRUFBRSxDQUFDLElBQUUsRUFBRSxDQUFDLElBQUUsRUFBRSxDQUFDO0FBQUEsSUFBQztBQUFDLGFBQVMsRUFBRSxHQUFFLEdBQUU7QUFBQyxXQUFLLElBQUU7QUFBRSxlQUFRLElBQUUsQ0FBQSxHQUFHLElBQUUsTUFBRyxJQUFFLEVBQUUsU0FBTyxHQUFFLEtBQUcsR0FBRSxLQUFJO0FBQUMsWUFBSSxJQUFFLEVBQUUsQ0FBQyxJQUFFO0FBQUUsYUFBRyxLQUFHLE1BQUksRUFBRSxDQUFDLElBQUUsR0FBRSxJQUFFO0FBQUEsTUFBSTtBQUFDLFdBQUssSUFBRTtBQUFBLElBQUU7QUFBQyxRQUFJLElBQUUsQ0FBQTtBQUFHLGFBQVMsRUFBRSxHQUFFO0FBQUMsYUFBTyxRQUFNLEtBQUcsTUFBSSxJQUFFLEVBQUUsR0FBRSxTQUFTLEdBQUU7QUFBQyxlQUFPLElBQUksRUFBRSxDQUFDLElBQUUsQ0FBQyxHQUFFLElBQUUsSUFBRSxLQUFHLENBQUM7QUFBQSxNQUFDLENBQUMsSUFBRSxJQUFJLEVBQUUsQ0FBQyxJQUFFLENBQUMsR0FBRSxJQUFFLElBQUUsS0FBRyxDQUFDO0FBQUEsSUFBQztBQUFDLGFBQVNrQixHQUFFLEdBQUU7QUFBQyxVQUFHLE1BQU0sQ0FBQyxLQUFHLENBQUMsU0FBUyxDQUFDLEVBQUUsUUFB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QUFDLElBQUVBLE1BQUcsS0FBRztBQUFBLE1BQUU7QUFBQyxhQUFPLElBQUksRUFBRSxHQUFFLEVBQUUsRUFBRSxTQUFPLENBQUMsSUFBRSxjQUFZLEtBQUcsQ0FBQztBQUFBLElBQUM7QUFBRSxhQUFTLEVBQUUsR0FBRSxHQUFFO0FBQUMsYUFBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7QUFBQSxJQUFDO0FBQ3BTLE1BQUUsSUFBRSxTQUFTLEdBQUU7QUFBQyxVQUFHbUIsR0FBRSxJQUFJLEtBQUdBLEdBQUUsQ0FBQyxFQUFFLFFBQU87QUFBRSxVQUFHLEVBQUUsSUFBSSxFQUFFLFFBQU8sRUFBRSxDQUFDLElBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFFLEVBQUUsRUFBRSxJQUFJLEVBQUUsRUFBRSxDQUFDLENBQUM7QUFBRSxVQUFHLEVBQUUsQ0FBQyxFQUFFLFFBQU8sRUFBRSxLQUFLLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUFFLFVBQUcsSUFBRSxLQUFLLEVBQUUsQ0FBQyxLQUFHLElBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFPRCxHQUFFLEtBQUssRUFBQyxJQUFHLEVBQUUsRUFBRyxDQUFBO0FBQUUsZUFBUSxJQUFFLEtBQUssRUFBRSxTQUFPLEVBQUUsRUFBRSxRQUFPLElBQUUsQ0FBQSxHQUFHLElBQUUsR0FBRSxJQUFFLElBQUUsR0FBRSxJQUFJLEdBQUUsQ0FBQyxJQUFFO0FBQUUsV0FBSSxJQUFFLEdBQUUsSUFBRSxLQUFLLEVBQUUsUUFBTyxJQUFJLFVBQVEsSUFBRSxHQUFFLElBQUUsRUFBRSxFQUFFLFFBQU8sS0FBSTtBQUFDLFlBQUksSUFBRSxLQUFLLEVBQUUsQ0FBQyxNQUFJLElBQUdsQixLQUFFLEtBQUssRUFBRSxDQUFDLElBQUUsT0FBTSxJQUFFLEVBQUUsRUFBRSxDQUFDLE1BQUksSUFBRyxJQUFFLEVBQUUsRUFBRSxDQUFDLElBQUU7QUFBTSxVQUFFLElBQUUsSUFBRSxJQUFFLENBQUMsS0FBR0EsS0FBRTtBQUFFLFVB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SUFBRSxDQUFFLEdBQUMsSUFBRSxHQUFFLElBQUUsR0FBRSxJQUFJLEdBQUUsQ0FBQyxJQUFFLEtBQUssRUFBRSxDQUFDLElBQUUsRUFBRSxFQUFFLENBQUM7QUFBRSxhQUFPLElBQUksRUFBRSxHQUFFLEtBQUssSUFBRSxFQUFFLENBQUM7QUFBQSxJQUFDO0FBQUUsYUFBUyxFQUFFLEdBQUU7QUFBQyxlQUFRLElBQUUsRUFBRSxFQUFFLFNBQU8sR0FBRSxJQUFFLENBQUEsR0FBRyxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksR0FBRSxDQUFDLElBQUUsRUFBRSxFQUFFLENBQUMsS0FBRyxJQUFFLEVBQUUsRUFBRSxJQUFFLENBQUMsTUFBSTtBQUFHLGFBQU8sSUFBSSxFQUFFLEdBQUUsRUFBRSxDQUFDO0FBQUEsSUFBQztBQUFDLGFBQVMsRUFBRSxHQUFFLEdBQUU7QUFBQyxVQUFJLElBQUUsS0FBRztBQUFFLFdBQUc7QUFBRyxlQUFRLElBQUUsRUFBRSxFQUFFLFNBQU8sR0FBRSxJQUFFLENBQUUsR0FBQyxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksR0FBRSxDQUFDLElBQUUsSUFBRSxJQUFFLEVBQUUsRUFBRSxJQUFFLENBQUMsTUFBSSxJQUFFLEVBQUUsRUFBRSxJQUFFLElBQUUsQ0FBQyxLQUFHLEtBQUcsSUFBRSxFQUFFLEVBQUUsSUFBRSxDQUFDO0FBQUUsYUFBTyxJQUFJLEVBQUUsR0FBRSxFQUFFLENBQUM7QUFBQSxJQUFDO0FBQUMsTUFBRSxVQUFVLFNBQU8sRUFBRSxVQUFVO0FBQUUsTUFBRSxVQUFVLFFBQU0sRUFBRSxVQUFVO0FBQUUsTUFBRSxVQUFVLFNBQU8sRUFBRSxVQUFVO0FBQWdDLE1BQUUsVUFBVSxNQUFJLEVBQUUsVUFBVTtBQUFJLE1BQUUsVUFBVSxXQUFTLEVBQUUsVUFBVTtBQUFFLE1BQUUsVUFBVSxTQUFPLEVBQUUsVUFBVTtBQUFFLE1BQUUsVUFBVSxVQUFRLEVBQUUsVUFBVTtBQUFFLE1BQUUsVUFBVSxXQUFTLEVBQUUsVUFBVTtBQUFFLE1BQUUsVUFBVSxXQUFT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QUFPLEVBQUUsTUFBTSxNQUFLLENBQUM7QUFBQSxNQUFDO0FBQUEsSUFBQztBQUFDLGFBQVMsRUFBRSxHQUFFQSxJQUFFO0FBQUMsZUFBUyxJQUFHO0FBQUEsTUFBQTtBQUFFLFFBQUUsWUFBVUEsR0FBRTtBQUFVLFFBQUUsS0FBR0EsR0FBRTtBQUFVLFFBQUUsWUFBVSxJQUFJO0FBQUUsUUFBRSxVQUFVLGNBQVk7QUFBRSxRQUFFLEtBQUcsU0FBUyxHQUFFLEdBQUUsR0FBRTtBQUFDLGlCQUFRLElBQUUsTUFBTSxVQUFVLFNBQU8sQ0FBQyxHQUFFLElBQUUsR0FBRSxJQUFFLFVBQVUsUUFBTyxJQUFJLEdBQUUsSUFBRSxDQUFDLElBQUUsVUFBVSxDQUFDO0FBQUUsZUFBT0EsR0FBRSxVQUFVLENBQUMsRUFBRSxNQUFNLEdBQUUsQ0FBQztBQUFBLE1BQUM7QUFBQSxJQUFFO0FBQUMsYUFBUyxHQUFHLEdBQUU7QUFBQyxZQUFNQSxLQUFFLEVBQUU7QUFBTyxVQUFHLElBQUVBLElBQUU7QUFBQyxjQUFNLElBQUUsTUFBTUEsRUFBQztBQUFFLGlCQUFRLElBQUUsR0FBRSxJQUFFQSxJQUFFLElBQUksR0FBRSxDQUFDLElBQUUsRUFBRSxDQUFDO0FBQUUsZUFBTztBQUFBLE1BQUM7QUFBQyxhQUFPLENBQUU7QUFBQSxJQUFBO0FBQUMsYUFBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxlQUFRLElBQUUsR0FBRSxJQUFFLFVBQVUsUUFBTyxLQUFJO0FBQUMsY0FBTSxJQUFFLFVBQVUsQ0FBQztBQUFFLFlBQUcsR0FBRyxDQUFDLEdBQUU7QUFBQyxnQkFBTSxJQUFFLEVBQUUsVUFBUSxHQUFFLElBQUUsRUFBRSxVQUFRO0FBQUUsWUFBRSxTQUFPLElBQUU7QUFBRSxtQkFBUSxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksR0FBRSxJQUFFLENBQUMsSUFBRSxFQUFFLENBQUM7QUFBQSxRQUFFLE1BQU0sR0FBRSxLQUFLLENBQUM7QUFBQSxNQUFFO0FBQUEsSUFBQztBQUFBLElBQUMsTUFBTSxHQUFFO0FBQUEsTUFBQyxZQUFZLEdBQUVBLElBQUU7QUFBQyxhQUFLLElBQUU7QUFBRSxhQUFLLElBQUVBO0FBQUUsYUFBSyxJQUFFO0FBQUUsYUFBSyxJQUFFO0FBQUEsTUFBSztBQUFBLE1BQUMsTUFBSztBQUFDLFlBQUk7QUFBRSxZQUFFLEtBQUssS0FBRyxLQUFLLEtBQUksSUFBRSxLQUFLLEdBQUUsS0FBSyxJQUFFLEVBQUUsTUFBSyxFQUFFLE9BQUssUUFBTSxJQUFFLEtBQUs7QUFBSSxlQUFPO0FBQUEsTUFBQztBQUFBLElBQUM7QUFBQyxhQUFTLEVBQUUsR0FBRTtBQUFDLGFBQU8sY0FBYyxLQUFLLENBQUM7QUFBQSxJQUFDO0FBQUMsYUFBUyxJQUFHO0FBQUMsVUFBSSxJQUFFLEVBQUU7QUFBVSxhQUFPLE1BQUksSUFBRSxFQUFFLGFBQVcsSUFBRTtBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFNBQUcsR0FBRyxFQUFFLENBQUM7QUFBRSxhQUFPO0FBQUEsSUFBQztBQUFDLE9BQUcsR0FBRyxJQUFFLFdBQVU7QUFBQTtBQUFHLFFBQUksS0FBRyxNQUFJLEVBQUMsRUFBRyxRQUFRLE9BQU8sS0FBRyxFQUFFLE1BQUksRUFBRyxFQUFDLFlBQVcsRUFBRyxRQUFRLFFBQVEsS0FBRyxNQUFJLEVBQUcsRUFBQyxRQUFRLE1BQU0sTUFBSSxFQUFFLE1BQUksRUFBRyxFQUFDLFFBQVEsU0FBUyxLQUFHLE1BQUksRUFBQyxFQUFHLFFBQVEsTUFBTSxNQUFJLE1BQUksRUFBRyxFQUFDLFFBQVEsTUFBTTtBQUFFLGFBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxpQkFBVSxLQUFLLEVBQUUsQ0FBQUEsR0FBRSxLQUFLLEdBQUUsRUFBRSxDQUFDLEdBQUUsR0FBRSxDQUFDO0FBQUEsSUFBRTtBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsaUJBQVUsS0FBSyxFQUFFLENBQUFBLEdBQUUsS0FBSyxRQUFPLEVBQUUsQ0FBQyxHQUFFLEdBQUUsQ0FBQztBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFlBQU1BLEtBQUU7QUFBRyxpQkFBVSxLQUFLLEVBQUUsQ0FBQUEsR0FBRSxDQUFDLElBQUUsRUFBRSxDQUFDO0FBQUUsYUFBT0E7QUFBQSxJQUFDO0FBQUMsVUFBTSxLQUFHLGdHQUFnRyxNQUFNLEdBQUc7QUFBRSxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFVBQUksR0FBRTtBQUFFLGVBQVEsSUFBRSxHQUFFLElBQUUsVUFBVSxRQUFPLEtBQUk7QUFBQyxZQUFFLFVBQVUsQ0FBQztBQUFFLGFBQUksS0FBSyxFQUFFLEdBQUUsQ0FBQyxJQUFFLEVBQUUsQ0FBQztBQUFFLGlCQUFRLElBQUUsR0FBRSxJQUFFLEdBQUcsUUFBTyxJQUFJLEtBQUUsR0FBRyxDQUFDLEdBQUUsT0FBTyxVQUFVLGVBQWUsS0FBSyxHQUFFLENBQUMsTUFBSSxFQUFFLENBQUMsSUFBRSxFQUFFLENBQUM7QUFBQSxNQUFHO0FBQUEsSUFBQztBQUFDLGFBQVMsR0FBRyxHQUFFO0FBQUMsVUFBSUEsS0FBRTtBQUFFLFVBQUUsRUFBRSxNQUFNLEdBQUc7QUFBRSxZQUFNLElBQUUsQ0FBRTtBQUFDLGFBQUssSUFBRUEsTUFBRyxFQUFFLFNBQVEsR0FBRSxLQUFLLEVBQUUsTUFBTyxDQUFBLEdBQUVBO0FBQUksUUFBRSxVQUFRLEVBQUUsS0FBSyxFQUFFLEtBQUssR0FBRyxDQUFDO0FBQUUsYUFBTztBQUFBLElBQUM7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsV0FBVyxNQUFJO0FBQUMsY0FBTTtBQUFBLE1BQUUsR0FBRSxDQUFDO0FBQUEsSUFBRTtBQUFDLGFBQVMsS0FBSTtBQUFDLFVBQUksSUFBRTtBQUFHLFVBQUlBLEtBQUU7QUFBSyxRQUFFLE1BQUlBLEtBQUUsRUFBRSxHQUFFLEVBQUUsSUFBRSxFQUFFLEVBQUUsTUFBSyxFQUFFLE1BQUksRUFBRSxJQUFFLE9BQU1BLEdBQUUsT0FBSztBQUFNLGFBQU9BO0FBQUEsSUFBQztBQUFBLElBQUMsTUFBTSxHQUFFO0FBQUEsTUFBQyxjQUFhO0FBQUMsYUFBSyxJQUFFLEtBQUssSUFBRTtBQUFBLE1BQUs7QUFBQSxNQUFDLElBQUksR0FBRUEsSUFBRTtBQUFDLGNBQU0sSUFBRSxHQUFHLElBQUc7QUFBRyxVQUFFLElBQUksR0FBRUEsRUFBQztBQUFFLGFBQUssSUFBRSxLQUFLLEVBQUUsT0FBSyxJQUFFLEtBQUssSUFBRTtBQUFFLGFBQUssSUFBRTtBQUFBLE1BQUU7QUFBQSxJQUFDO0FBQUMsUUFBSSxLQUFHLElBQUksR0FBRyxNQUFJLElBQUksTUFBRyxPQUFHLEVBQUUsTUFBTyxDQUFBO0FBQUEsSUFBRSxNQUFNLEdBQUU7QUFBQSxNQUFDLGNBQWE7QUFBQyxhQUFLLE9BQUssS0FBSyxJQUFFLEtBQUssSUFBRTtBQUFBLE1BQUs7QUFBQSxNQUFDLElBQUksR0FBRUEsSUFBRTtBQUFDLGFBQUssSUFBRTtBQUFFLGFBQUssSUFBRUE7QUFBRSxhQUFLLE9BQUs7QUFBQSxNQUFLO0FBQUEsTUFBQyxRQUFPO0FBQUMsYUFBSyxPQUFLLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBQSxNQUFLO0FBQUEsSUFBQztBQUFDLFFBQUksR0FBRSxJQUFFLE9BQUcsS0FBRyxJQUFJLE1BQUcsS0FBRyxNQUFJO0FBQUMsWUFBTSxJQUFFLEVBQUUsUUFBUSxRQUFRLE1BQU07QUFBRSxVQUFFLE1BQUk7QUFBQyxVQUFFLEtBQUssRUFBRTtBQUFBLE1BQUU7QUFBQSxJQUFFO0FBQUUsUUFBSSxLQUFHLE1BQUk7QUFBQyxlQUFRLEdBQUUsSUFBRSxHQUFJLEtBQUU7QUFBQyxZQUFHO0FBQUMsWUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDO0FBQUEsUUFBRSxTQUFPLEdBQUU7QUFBQyxhQUFHLENBQUM7QUFBQSxRQUFFO0FBQUMsWUFBSUEsS0FBRTtBQUFHLFFBQUFBLEdBQUUsRUFBRSxDQUFDO0FBQUUsY0FBSUEsR0FBRSxNQUFJQSxHQUFFLEtBQUksRUFBRSxPQUFLQSxHQUFFLEdBQUVBLEdBQUUsSUFBRTtBQUFBLE1BQUc7QUFBQyxVQUFFO0FBQUEsSUFBRztBQUFFLGFBQVMs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SyxJQUFFLEtBQUssSUFBRSxPQUFHLEdBQUcsSUFBSTtBQUFBLE1BQUU7QUFBQSxNQUFDLElBQUc7QUFBQyxjQUFNLEVBQUM7QUFBRyxhQUFLLE1BQUksRUFBRSxhQUFhLEtBQUssQ0FBQyxHQUFFLEtBQUssSUFBRSxNQUFLLEtBQUssSUFBRSxPQUFHLEtBQUssSUFBRTtBQUFBLE1BQU07QUFBQSxJQUFDO0FBQUMsYUFBUyxFQUFFLEdBQUU7QUFBQyxRQUFFLEtBQUssSUFBSTtBQUFFLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRSxDQUFFO0FBQUEsSUFBQztBQUFDLE1BQUUsR0FBRSxDQUFDO0FBQUUsUUFBSSxLQUFHLENBQUE7QUFBRyxhQUFTLEdBQUcsR0FBRTtBQUFDLFNBQUcsRUFBRSxHQUFFLFNBQVNBLElBQUUsR0FBRTtBQUFDLGFBQUssRUFBRSxlQUFlLENBQUMsS0FBRyxHQUFHQSxFQUFDO0FBQUEsTUFBRSxHQUFFLENBQUM7QUFBRSxRQUFFLElBQUUsQ0FBRTtBQUFBLElBQUM7QUFBQyxNQUFFLFVBQVUsSUFBRSxXQUFVO0FBQUMsUUFBRSxHQUFHLEVBQUUsS0FBSyxJQUFJO0FBQUUsU0FBRyxJQUFJO0FBQUEsSUFBRTtBQUFFLE1BQUUsVUFBVSxjQUFZLFdBQVU7QUFBQyxZQUFNLE1BQU0sMENBQTBDO0FBQUEsSUFBRTtBQUFFLFFBQUksS0FBRyxFQUFFLEtBQUs7QUFBVSxRQUFJLEtBQUcsRUFBRSxLQUFLO0FBQU0sUUFBSSxLQUFHLE1BQUs7QUFBQSxNQUFDLFVBQVUsR0FBRTtBQUFDLGVBQU8sRUFBRSxLQUFLLFVBQVUsR0FBRSxNQUFNO0FBQUEsTUFBQztBQUFBLE1BQUMsTUFBTSxHQUFFO0FBQUMsZUFBTyxFQUFFLEtBQUssTUFBTSxHQUFFLE1BQU07QUFBQSxNQUFDO0FBQUEsSUFBQztBQUFFLGFBQVMsS0FBSTtBQUFBLElBQUE7QUFBRSxPQUFHLFVBQVUsSUFBRTtBQUFLLGFBQVMsR0FBRyxHQUFFO0FBQUMsYUFBTyxFQUFFLE1BQUksRUFBRSxJQUFFLEVBQUUsRUFBQztBQUFBLElBQUc7QUFBQyxhQUFTLEtBQUk7QUFBQSxJQUFFO0FBQUEsUUFBSSxJQUFFLEVBQUMsTUFBSyxLQUFJLElBQUcsS0FBSSxJQUFHLEtBQUksSUFBRyxJQUFHO0FBQUUsYUFBUyxLQUFJO0FBQUMsUUFBRSxLQUFLLE1BQUssR0FBRztBQUFBLElBQUU7QUFBQyxNQUFFLElBQUcsQ0FBQztBQUFFLGFBQVMsS0FBSTtBQUFDLFFBQUUsS0FBSyxNQUFLLEdBQUc7QUFBQSxJQUFFO0FBQUMsTUFBRSxJQUFHLENBQUM7QUFBRSxRQUFJLElBQUUsQ0FBQSxHQUFHLEtBQUc7QUFBSyxhQUFTLEtBQUk7QUFBQyxhQUFPLEtBQUcsTUFBSSxJQUFJO0FBQUEsSUFBQztBQUFDLE1BQUUsS0FBRztBQUFxQixhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsS0FBSyxNQUFLLEVBQUUsSUFBRyxDQUFDO0FBQUEsSUFBRTtBQUFDLE1BQUUsSUFBRyxDQUFDO0FBQUUsYUFBUyxFQUFFLEdBQUU7QUFBQyxZQUFNQSxLQUFFLEdBQUk7QUFBQyxRQUFFQSxJQUFFLElBQUksR0FBR0EsRUFBQyxDQUFDO0FBQUEsSUFBRTtBQUFDLE1BQUUsYUFBVztBQUFZLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxLQUFLLE1BQUssRUFBRSxZQUFXLENBQUM7QUFBRSxXQUFLLE9BQUtBO0FBQUEsSUFBRTtBQUFDLE1BQUUsSUFBRyxDQUFDO0FBQUUsYUFBUyxFQUFFLEdBQUU7QUFBQyxZQUFNQSxLQUFFLEdBQUk7QUFBQyxRQUFFQSxJQUFFLElBQUksR0FBR0EsSUFBRSxDQUFDLENBQUM7QUFBQSxJQUFFO0FBQUMsTUFBRSxLQUFHO0FBQWMsYUFBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxRQUFFLEtBQUssTUFBSyxFQUFFLElBQUcsQ0FBQztBQUFFLFdBQUssT0FBS0E7QUFBQSxJQUFFO0FBQUMsTUFBRSxJQUFHLENBQUM7QUFDcnhELGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsVUFBRyxlQUFhLE9BQU8sRUFBRSxPQUFNLE1BQU0s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QUEsSUFBQTtBQUFFLE1BQUUsSUFBRyxFQUFFO0FBQUUsT0FBRyxVQUFVLElBQUUsV0FBVTtBQUFDLGFBQU8sSUFBSTtBQUFBLElBQWM7QUFBRSxPQUFHLFVBQVUsSUFBRSxXQUFVO0FBQUMsYUFBTyxDQUFBO0FBQUEsSUFBRTtBQUFFLFNBQUcsSUFBSTtBQUFHLGFBQVMsRUFBRSxHQUFFQSxJQUFFLEdBQUUsR0FBRTtBQUFDLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRUE7QUFBRSxXQUFLLElBQUU7QUFBRSxXQUFLLElBQUUsS0FBRztBQUFFLFdBQUssSUFBRSxJQUFJLEVBQUUsSUFBSTtBQUFFLFdBQUssSUFBRTtBQUFLLFdBQUssSUFBRTtBQUFLLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRTtBQUFLLFdBQUssSUFBRSxDQUFBO0FBQUcsV0FBSyxJQUFFO0FBQUssV0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFLEtBQUssSUFBRTtBQUFLLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRTtBQUFLLFdBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRTtBQUFHLFdBQUssSUFBRSxJQUFJO0FBQUEsSUFBRztBQUFDLGFBQVMsS0FBSTtBQUFDLFdBQUssSUFBRTtBQUFLLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRTtBQUFBLElBQUc7QUFBQyxRQUFJLEtBQUcsQ0FBRSxHQUFDLEtBQUcsQ0FBRTtBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxRQUFFLElBQUU7QUFBRSxRQUFFLElBQUUsR0FBRyxFQUFFQSxFQUFDLENBQUM7QUFBRSxRQUFFLElBQUU7QUFBRSxRQUFFLElBQUU7QUFBRyxTQUFHLEdBQUUsSUFBSTtBQUFBLElBQUU7QUFDaG5DLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxJQUFFLEtBQUs7QUFBTSxTQUFHLENBQUM7QUFBRSxRQUFFLElBQUUsRUFBRSxFQUFFLENBQUM7QUFBRSxVQUFJLElBQUUsRUFBRSxHQUFFLElBQUUsRUFBRTtBQUFFLFlBQU0sUUFBUSxDQUFDLE1BQUksSUFBRSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQUcsU0FBRyxFQUFFLEdBQUUsS0FBSSxDQUFDO0FBQUUsUUFBRSxJQUFFO0FBQUUsVUFBRSxFQUFFLEVBQUU7QUFBRSxRQUFFLElBQUUsSUFBSTtBQUFHLFFBQUUsSUFBRSxHQUFHLEVBQUUsR0FBRSxJQUFFQSxLQUFFLE1BQUssQ0FBQyxFQUFFLENBQUM7QUFBRSxVQUFFLEVBQUUsTUFBSSxFQUFFLElBQUUsSUFBSSxHQUFHLEVBQUUsRUFBRSxHQUFFLEdBQUUsRUFBRSxDQUFDLEdBQUUsRUFBRSxDQUFDO0FBQUcsTUFBQUEsS0FBRSxFQUFFO0FBQUUsVUFBRSxFQUFFO0FBQUUsVUFBRSxFQUFFO0FBQUcsVUFBSSxJQUFFO0FBQW1CLFlBQU0sUUFBUSxDQUFDLE1BQUksTUFBSSxHQUFHLENBQUMsSUFBRSxFQUFFLFNBQVUsSUFBRSxJQUFFO0FBQUksZUFBUSxJQUFFLEdBQUUsSUFBRSxFQUFFLFFBQU8sS0FBSTtBQUFDLFlBQUksSUFBRSxHQUFHLEdBQUUsRUFBRSxDQUFDLEdBQUUsS0FBR0EsR0FBRSxhQUFZLE9BQUdBLEdBQUUsS0FBR0EsRUFBQztBQUFFLFlBQUcsQ0FBQyxFQUFFO0FBQU0sUUFBQUEsR0FBRSxFQUFFLEVBQUUsR0FBRyxJQUFFO0FBQUEsTUFBRTtBQUFDLE1BQUFBLEtBQUUsRUFBRSxJQUFFLEdBQUcsRUFBRSxDQUFDLElBQUUsQ0FBQTtBQUFHLFFBQUUsS0FBRyxFQUFFLE1BQUksRUFBRSxJQUFFLFNBQVFBLEdBQUUsY0FBYyxJQUFFLHFDQUFvQyxFQUFFLEVBQUU7QUFBQSxRQUFHLEVBQUU7QUFBQSxRQUFFLEVBQUU7QUFBQSxRQUNwZixFQUFFO0FBQUEsUUFBRUE7QUFBQSxNQUFDLE1BQUksRUFBRSxJQUFFLE9BQU0sRUFBRSxFQUFFLEdB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QUFFLEVBQUU7QUFBQSxnQkFBRztBQUFBLGNBQUMsTUFBTSxHQUFFLEtBQUssR0FBRSxLQUFLLEdBQUUsR0FBRSxJQUFJLEdBQUUsR0FBRyxNQUFLLENBQUM7QUFBRSxtQkFBRyxLQUFHLEVBQUUsSUFBSTtBQUFFLG1CQUFLLEtBQUcsQ0FBQyxLQUFLLE1BQUksS0FBRyxJQUFFLEdBQUcsS0FBSyxHQUFFLElBQUksS0FBRyxLQUFLLElBQUUsT0FBRyxHQUFHLElBQUk7QUFBQSxZQUFJLE1BQU0sSUFBRyxLQUFLLENBQUMsR0FBRSxPQUFLLEtBQUcsSUFBRSxFQUFFLFFBQVEsYUFBYSxLQUFHLEtBQUssSUFBRSxHQUFFLEVBQUUsRUFBRSxNQUFJLEtBQUssSUFBRSxHQUFFLEVBQUUsRUFBRSxJQUFHLEVBQUUsSUFBSSxHQUFFLEdBQUcsSUFBSTtBQUFBLFVBQUU7QUFBQSxRQUFDO0FBQUEsTUFBQyxTQUFPLEdBQUU7QUFBQSxnQkFBRTtBQUFBLE1BQU87QUFBQSxJQUFFO0FBQUUsYUFBUyxHQUFHLEdBQUU7QUFBQyxhQUFPLEVBQUUsSUFBRSxTQUFPLEVBQUUsS0FBRyxLQUFHLEVBQUUsS0FBRyxFQUFFLEVBQUUsS0FBRztBQUFBLElBQUU7QUFDelUsYUFBUyxHQUFHLEdBQUVsQixJQUFFO0FBQUMsVUFBSSxJQUFFLEVBQUUsR0FBRSxJQUFFQSxHQUFFLFFBQVEsTUFBSyxDQUFDO0FBQUUsVUFBRyxNQUFJLEVBQUUsUUFBTztBQUFHLFVBQUUsT0FBT0EsR0FBRSxVQUFVLEdBQUUsQ0FBQyxDQUFDO0FBQUUsVUFBRyxNQUFNLENBQUMsRUFBRSxRQUFPO0FBQUcsV0FBRztBQUFFLFVBQUcsSUFBRSxJQUFFQSxHQUFFLE9BQU8sUUFBTztBQUFHLE1BQUFBLEtBQUVBLEdBQUUsTUFBTSxHQUFFLElBQUUsQ0FBQztBQUFFLFFBQUUsSUFBRSxJQUFFO0FBQUUsYUFBT0E7QUFBQSxJQUFDO0FBQUMsTUFBRSxVQUFVLFNBQU8sV0FBVTtBQUFDLFdBQUssSUFBRTtBQUFHLFFBQUUsSUFBSTtBQUFBLElBQUU7QUFBRSxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsSUFBRSxLQUFLLElBQUssSUFBQyxFQUFFO0FBQUUsU0FBRyxHQUFFLEVBQUUsQ0FBQztBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFVBQUcsUUFBTSxFQUFFLEVBQUUsT0FBTSxNQUFNLHlCQUF5QjtBQUFFLFFBQUUsSUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFHLENBQUMsR0FBRUEsRUFBQztBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsTUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDLEdBQUUsRUFBRSxJQUFFO0FBQUEsSUFBTTtBQUNoYSxNQUFFLFVBQVUsS0FBRyxXQUFVO0FBQUMsV0FBSyxJQUFFO0FBQUssWUFBTSxJQUFFLEtBQUssSUFBSztBQUFDLFdBQUcsSUFBRSxLQUFLLEtBQUcsR0FBRyxLQUFLLEdBQUUsS0FBSyxDQUFDLEdBQUUsS0FBRyxLQUFLLE1BQUksRUFBRyxHQUFDLEVBQUUsRUFBRSxJQUFHLEVBQUUsSUFBSSxHQUFFLEtBQUssSUFBRSxHQUFFLEdBQUcsSUFBSSxLQUFHLEdBQUcsTUFBSyxLQUFLLElBQUUsQ0FBQztBQUFBLElBQUU7QUFBRSxhQUFTLEdBQUcsR0FBRTtBQUFDLFdBQUcsRUFBRSxFQUFFLEtBQUcsRUFBRSxLQUFHLEdBQUcsRUFBRSxHQUFFLENBQUM7QUFBQSxJQUFFO0FBQUMsYUFBUyxFQUFFLEdBQUU7QUFBQyxTQUFHLENBQUM7QUFBRSxVQUFJQSxLQUFFLEVBQUU7QUFBRSxNQUFBQSxNQUFHLGNBQVksT0FBT0EsR0FBRSxNQUFJQSxHQUFFLEdBQUU7QUFBRyxRQUFFLElBQUU7QUFBSyxTQUFHLEVBQUUsQ0FBQztBQUFFLFFBQUUsTUFBSUEsS0FBRSxFQUFFLEdBQUUsRUFBRSxJQUFFLE1BQUtBLEdBQUUsU0FBUUEsR0FBRSxHQUFFO0FBQUEsSUFBSTtBQUNoVSxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFVBQUc7QUFBQyxZQUFJLElBQUUsRUFBRTtBQUFFLFlBQUcsS0FBRyxFQUFFLE1BQUksRUFBRSxLQUFHLEtBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQztBQUFHLGNBQUcsQ0FBQyxFQUFFLEtBQUcsR0FBRyxFQUFFLEdBQUUsQ0FBQyxLQUFHLEtBQUcsRUFBRSxHQUFFO0FBQUMsZ0JBQUc7QUFBQyxrQkFBSSxJQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU1BLEVBQUM7QUFBQSxZQUFFLFNBQU8sR0FBRTtBQUFDLGtCQUFFO0FBQUEsWUFBSztBQUFDLGdCQUFHLE1BQU0sUUFBUSxDQUFDLEtBQUcsS0FBRyxFQUFFLFFBQU87QUFBQyxrQkFBSSxJQUFFO0FBQUUsa0JBQUcsS0FBRyxFQUFFLENBQUMsRUFBRSxJQUFFO0FBQUMsb0JBQUcsQ0FBQyxFQUFFLEdBQUU7QUFBQyxzQkFBRyxFQUFFLEVBQUUsS0FBRyxFQUFFLEVBQUUsSUFBRSxNQUFJLEVBQUUsRUFBRSxJQUFHLENBQUMsR0FBRSxHQUFHLENBQUM7QUFBQSxzQkFBTyxPQUFNO0FBQUUscUJBQUcsQ0FBQztBQUFFLG9CQUFFLEVBQUU7QUFBQSxnQkFBRTtBQUFBLGNBQUM7QUFBQSxrQkFBTSxHQUFFLEtBQUcsRUFBRSxDQUFDLEdBQUUsSUFBRSxFQUFFLEtBQUcsRUFBRSxLQUFHLFFBQU0sRUFBRSxDQUFDLEtBQUcsRUFBRSxLQUFHLEtBQUcsRUFBRSxLQUFHLENBQUMsRUFBRSxNQUFJLEVBQUUsSUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFHLENBQUMsR0FBRSxHQUFHO0FBQUcsa0JBQUcsS0FBRyxHQUFHLEVBQUUsQ0FBQyxLQUFHLEVBQUUsSUFBRztBQUFDLG9CQUFHO0FBQUMsb0JBQUU7Z0JBQUssU0FBTyxHQUFFO0FBQUEsZ0JBQUU7QUFBQSxrQkFBRSxLQUFHO0FBQUEsY0FBTztBQUFBLFlBQUMsTUFBTSxHQUFFLEdBQUUsRUFBRTtBQUFBLFVBQUUsWUFBVSxFQUFFLEtBQUcsRUFBRSxLQUFHLE1BQUksR0FBRyxDQUFDLEdBQUUsQ0FBQyxFQUFFQSxFQUFDLEVBQUUsTUFBSSxJQUFFLEVBQUUsR0FBRyxFQUFFLE1BQU1BLEVBQUMsR0FBRUEsS0FBRSxHQUFFQSxLQUFFLEVBQUUsUUFBT0EsTUFBSTtBQUFDLGdCQUFJLElBQUUsRUFBRUEsRUFBQztBQUFFLGNBQUUsSUFDemYsRUFBRSxDQUFDO0FBQUUsZ0JBQUUsRUFBRSxDQUFDO0FBQUUsZ0JBQUcsS0FBRyxFQUFFLEVBQUUsS0FBRyxPQUFLLEVBQUUsQ0FBQyxHQUFFO0FBQUMsZ0JBQUUsSUFBRSxFQUFFLENBQUM7QUFBRSxnQkFBRSxLQUFHLEVBQUUsQ0FBQztBQUFFLG9CQUFNa0IsS0FBRSxFQUFFLENBQUM7QUFBRSxzQkFBTUEsT0FBSSxFQUFFLEtBQUdBLElBQUUsRUFBRSxFQUFFLEtBQUssU0FBTyxFQUFFLEVBQUU7QUFBRyxvQkFBTSxJQUFFLEVBQUUsQ0FBQztBQUFFLHNCQUFNLE1BQUksRUFBRSxLQUFHLEdBQUUsRUFBRSxFQUFFLEtBQUssVUFBUSxFQUFFLEVBQUU7QUFBRyxvQkFBTSxJQUFFLEVBQUUsQ0FBQztBQUFFLHNCQUFNLEtBQUcsYUFBVyxPQUFPLEtBQUcsSUFBRSxNQUFJLElBQUUsTUFBSSxHQUFFLEVBQUUsSUFBRSxHQUFFLEVBQUUsRUFBRSxLQUFLLGtDQUFnQyxDQUFDO0FBQUcsa0JBQUU7QUFBRSxvQkFBTSxJQUFFLEVBQUU7QUFBRSxrQkFBRyxHQUFFO0FBQUMsc0JBQU0sS0FBRyxFQUFFLElBQUUsRUFBRSxFQUFFLGtCQUFrQix3QkFBd0IsSUFBRTtBQUFLLG9CQUFHLElBQUc7QUFBQyxzQkFBSSxJQUFFLEVBQUU7QUFBRSxvQkFBRSxLQUFHLE1BQUksR0FBRyxRQUFRLE1BQU0sS0FBRyxNQUFJLEdBQUcsUUFBUSxNQUFNLEtBQUcsTUFBSSxHQUFHLFFBQVEsSUFBSSxNQUFJLEVBQUUsSUFBRSxFQUFFLEdBQUUsRUFBRSxJQUFFLG9CQUFJLE9BQUksRUFBRSxNQUFJLEdBQUcsR0FBRSxFQUFFLENBQUMsR0FBRSxFQUFFLElBQUU7QUFBQSxnQkFBTztBQUFDLG9CQUFHLEVBQUUsR0FBRTtBQUFDLHdCQUFNLEtBQ2pnQixFQUFFLElBQUUsRUFBRSxFQUFFLGtCQUFrQixtQkFBbUIsSUFBRTtBQUFLLHlCQUFLLEVBQUUsS0FBRyxJQUFHRyxHQUFFLEVBQUUsR0FBRSxFQUFFLEdBQUUsRUFBRTtBQUFBLGdCQUFHO0FBQUEsY0FBQztBQUFDLGdCQUFFLElBQUU7QUFBRSxnQkFBRSxLQUFHLEVBQUUsRUFBRSxHQUFJO0FBQUMsZ0JBQUUsT0FBSyxFQUFFLElBQUUsS0FBSyxJQUFLLElBQUMsRUFBRSxHQUFFLEVBQUUsRUFBRSxLQUFLLG9CQUFrQixFQUFFLElBQUUsSUFBSTtBQUFHLGtCQUFFO0FBQUUsa0JBQUksSUFBRTtBQUFFLGdCQUFFLEtBQUcsR0FBRyxHQUFFLEVBQUUsSUFBRSxFQUFFLEtBQUcsTUFBSyxFQUFFLENBQUM7QUFBRSxrQkFBRyxFQUFFLEdBQUU7QUFBQyxtQkFBRyxFQUFFLEdBQUUsQ0FBQztBQUFFLG9CQUFJLElBQUUsR0FBRSxJQUFFLEVBQUU7QUFBRSxzQkFBSSxFQUFFLElBQUU7QUFBRyxrQkFBRSxNQUFJLEdBQUcsQ0FBQyxHQUFFLEdBQUcsQ0FBQztBQUFHLGtCQUFFLElBQUU7QUFBQSxjQUFFLE1BQU0sSUFBRyxDQUFDO0FBQUUsa0JBQUUsRUFBRSxFQUFFLFVBQVEsR0FBRyxDQUFDO0FBQUEsWUFBRSxNQUFNLFdBQVEsRUFBRSxDQUFDLEtBQUcsV0FBUyxFQUFFLENBQUMsS0FBRyxFQUFFLEdBQUUsQ0FBQztBQUFBLGdCQUFPLE1BQUcsRUFBRSxNQUFJLFVBQVEsRUFBRSxDQUFDLEtBQUcsV0FBUyxFQUFFLENBQUMsSUFBRSxVQUFRLEVBQUUsQ0FBQyxJQUFFLEVBQUUsR0FBRSxDQUFDLElBQUUsR0FBRyxDQUFDLElBQUUsVUFBUSxFQUFFLENBQUMsS0FBRyxFQUFFLEtBQUcsRUFBRSxFQUFFLEdBQUcsQ0FBQyxHQUFFLEVBQUUsSUFBRTtBQUFBLFVBQUc7QUFBQTtBQUFDLFVBQUUsQ0FBQztBQUFBLE1BQUUsU0FBTyxHQUFFO0FBQUEsTUFBRTtBQUFBLElBQUE7QUFBQyxRQUFJLEtBQUcsTUFBSztBQUFBLE1BQUMsWUFBWSxHQUFFckIsSUFBRTtBQUFDLGFBQUssSUFBRTtBQUFFLGFBQUssTUFBSUE7QUFBQSxNQUFFO0FBQUEsSUFBQztBQUFFLGFBQVMsR0FBRyxHQUFFO0FBQUMsV0FBSyxJQUFFLEtBQUc7QUFBRyxRQUFFLCtCQUE2QixJQUFFLEVBQUUsWUFBWSxpQkFBaUIsWUFBWSxHQUFFLElBQUUsSUFBRSxFQUFFLFdBQVMsUUFBTSxFQUFFLENBQUMsRUFBRSxtQkFBaUIsUUFBTSxFQUFFLENBQUMsRUFBRSxvQkFBa0IsSUFBRSxDQUFDLEVBQUUsRUFBRSxVQUFRLEVBQUUsT0FBTyxhQUFXLEVBQUUsT0FBTyxVQUFTLEtBQUksRUFBRSxPQUFPLFVBQVMsRUFBRztBQUFtQixXQUFLLElBQUUsSUFBRSxLQUFLLElBQUU7QUFBRSxXQUFLLElBQUU7QUFBSyxVQUFFLEtBQUssTUFBSSxLQUFLLElBQUUsb0JBQUk7QUFBSyxXQUFLLElBQUU7QUFBSyxXQUFLLElBQUUsQ0FBRTtBQUFBLElBQUM7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLGFBQU8sRUFBRSxJQUFFLE9BQUcsRUFBRSxJQUFFLEVBQUUsRUFBRSxRQUFNLEVBQUUsSUFBRTtBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLGFBQU8sRUFBRSxJQUFFLElBQUUsRUFBRSxJQUFFLEVBQUUsRUFBRSxPQUFLO0FBQUEsSUFBQztBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsYUFBTyxFQUFFLElBQUUsRUFBRSxLQUFHQSxLQUFFLEVBQUUsSUFBRSxFQUFFLEVBQUUsSUFBSUEsRUFBQyxJQUFFO0FBQUEsSUFBRTtBQUNoZ0MsYUFBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxRQUFFLElBQUUsRUFBRSxFQUFFLElBQUlBLEVBQUMsSUFBRSxFQUFFLElBQUVBO0FBQUEsSUFBRTtBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxLQUFHLEVBQUUsS0FBR0EsS0FBRSxFQUFFLElBQUUsT0FBSyxFQUFFLEtBQUcsRUFBRSxFQUFFLElBQUlBLEVBQUMsS0FBRyxFQUFFLEVBQUUsT0FBT0EsRUFBQztBQUFBLElBQUU7QUFBQyxPQUFHLFVBQVUsU0FBTyxXQUFVO0FBQUMsV0FBSyxJQUFFLEdBQUcsSUFBSTtBQUFFLFVBQUcsS0FBSyxFQUFFLE1BQUssRUFBRSxPQUFNLEdBQUcsS0FBSyxJQUFFO0FBQUEsZUFBYSxLQUFLLEtBQUcsTUFBSSxLQUFLLEVBQUUsTUFBSztBQUFDLG1CQUFVLEtBQUssS0FBSyxFQUFFLE9BQU0sRUFBRyxHQUFFLE9BQU07QUFBRyxhQUFLLEVBQUU7TUFBUTtBQUFBLElBQUM7QUFBRSxhQUFTLEdBQUcsR0FBRTtBQUFDLFVBQUcsUUFBTSxFQUFFLEVBQUUsUUFBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLEVBQUUsQ0FBQztBQUFFLFVBQUcsUUFBTSxFQUFFLEtBQUcsTUFBSSxFQUFFLEVBQUUsTUFBSztBQUFDLFlBQUlBLEtBQUUsRUFBRTtBQUFFLG1CQUFVLEtBQUssRUFBRSxFQUFFLFNBQVMsQ0FBQUEsS0FBRUEsR0FBRSxPQUFPLEVBQUUsQ0FBQztBQUFFLGVBQU9BO0FBQUEsTUFBQztBQUFDLGFBQU8sR0FBRyxFQUFFLENBQUM7QUFBQSxJQUFDO0FBQUMsYUFBUyxHQUFHLEdBQUU7QUFBQyxVQUFHLEVBQUUsS0FBRyxjQUFZLE9BQU8sRUFBRSxFQUFFLFFBQU8sRUFBRSxFQUFDO0FBQUcsVUFBRyxnQkFBYyxPQUFPLE9BQUssYUFBYSxPQUFLLGdCQUFjLE9BQU8sT0FBSyxhQUFhLElBQUksUUFBTyxNQUFNLEtBQUssRUFBRSxPQUFNLENBQUU7QUFBRSxVQUFHLGFBQVcsT0FBTyxFQUFFLFFBQU8sRUFBRSxNQUFNLEVBQUU7QUFBRSxVQUFHLEdBQUcsQ0FBQyxHQUFFO0FBQUMsaUJBQVFBLEtBQUUsSUFBRyxJQUFFLEVBQUUsUUFBTyxJQUFFLEdBQUUsSUFBRSxHQUFFLElBQUksQ0FBQUEsR0FBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0FBQUUsZUFBT0E7QUFBQSxNQUFDO0FBQUMsTUFBQUEsS0FBRSxDQUFBO0FBQUcsVUFBRTtBQUFFLFdBQUksS0FBSyxFQUFFLENBQUFBLEdBQUUsR0FBRyxJQUFFLEVBQUUsQ0FBQztBQUFFLGFBQU9BO0FBQUEsSUFBQztBQUN2d0IsYUFBUyxHQUFHLEdBQUU7QUFBQyxVQUFHLEVBQUUsTUFBSSxjQUFZLE9BQU8sRUFBRSxHQUFHLFFBQU8sRUFBRSxHQUFFO0FBQUcsVUFBRyxDQUFDLEVBQUUsS0FBRyxjQUFZLE9BQU8sRUFBRSxHQUFFO0FBQUMsWUFBRyxnQkFBYyxPQUFPLE9BQUssYUFBYSxJQUFJLFFBQU8sTUFBTSxLQUFLLEVBQUUsS0FBSSxDQUFFO0FBQUUsWUFBRyxFQUFFLGdCQUFjLE9BQU8sT0FBSyxhQUFhLE1BQUs7QUFBQyxjQUFHLEdBQUcsQ0FBQyxLQUFHLGFBQVcsT0FBTyxHQUFFO0FBQUMsZ0JBQUlBLEtBQUU7QUFBRyxnQkFBRSxFQUFFO0FBQU8scUJBQVEsSUFBRSxHQUFFLElBQUUsR0FBRSxJQUFJLENBQUFBLEdBQUUsS0FBSyxDQUFDO0FBQUUsbUJBQU9BO0FBQUEsVUFBQztBQUFDLFVBQUFBLEtBQUUsQ0FBQTtBQUFHLGNBQUU7QUFBRSxxQkFBVSxLQUFLLEVBQUUsQ0FBQUEsR0FBRSxHQUFHLElBQUU7QUFBRSxpQkFBT0E7QUFBQSxRQUFDO0FBQUEsTUFBQztBQUFBLElBQUM7QUFDbFcsYUFBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxVQUFHLEVBQUUsV0FBUyxjQUFZLE9BQU8sRUFBRSxRQUFRLEdBQUUsUUFBUUEsSUFBRSxNQUFNO0FBQUEsZUFBVSxHQUFHLENBQUMsS0FBRyxhQUFXLE9BQU8sRUFBRSxPQUFNLFVBQVUsUUFBUSxLQUFLLEdBQUVBLElBQUUsTUFBTTtBQUFBLFVBQU8sVUFBUSxJQUFFLEdBQUcsQ0FBQyxHQUFFLElBQUUsR0FBRyxDQUFDLEdBQUUsSUFBRSxFQUFFLFFBQU8sSUFBRSxHQUFFLElBQUUsR0FBRSxJQUFJLENBQUFBLEdBQUUsS0FBSyxRQUFPLEVBQUUsQ0FBQyxHQUFFLEtBQUcsRUFBRSxDQUFDLEdBQUUsQ0FBQztBQUFBLElBQUU7QUFBQyxRQUFJLEtBQUcsT0FBTyxtSUFBbUk7QUFBRSxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFVBQUcsR0FBRTtBQUFDLFlBQUUsRUFBRSxNQUFNLEdBQUc7QUFBRSxpQkFBUSxJQUFFLEdBQUUsSUFBRSxFQUFFLFFBQU8sS0FBSTtBQUFDLGNBQUksSUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEdBQUcsR0FBRSxJQUFFO0FBQUssY0FBRyxLQUFHLEdBQUU7QUFBQyxnQkFBSSxJQUFFLEVBQUUsQ0FBQyxFQUFFLFVBQVUsR0FBRSxDQUFDO0FBQUUsZ0JBQUUsRUFBRSxDQUFDLEVBQUUsVUFBVSxJQUFFLENBQUM7QUFBQSxVQUFFLE1BQU0sS0FBRSxFQUFFLENBQUM7QUFBRSxVQUFBQSxHQUFFLEdBQUUsSUFBRSxtQkFBbUIsRUFBRSxRQUFRLE9BQU0sR0FBRyxDQUFDLElBQUUsRUFBRTtBQUFBLFFBQUU7QUFBQSxNQUFDO0FBQUEsSUFBQztBQUFDLGFBQVMsRUFBRSxHQUFFO0FBQUMsV0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBRyxXQUFLLElBQUU7QUFBSyxXQUFLLElBQUUsS0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFO0FBQUcsVUFBRyxhQUFhLEdBQUU7QUFBQyxhQUFLLElBQUUsRUFBRTtBQUFFLFdBQUcsTUFBSyxFQUFFLENBQUM7QUFBRSxhQUFLLElBQUUsRUFBRTtBQUFFLGFBQUssSUFBRSxFQUFFO0FBQUUsV0FBRyxNQUFLLEVBQUUsQ0FBQztBQUFFLGFBQUssSUFBRSxFQUFFO0FBQUUsWUFBSUEsS0FBRSxFQUFFO0FBQUUsWUFBSSxJQUFFLElBQUk7QUFBRyxVQUFFLElBQUVBLEdBQUU7QUFBRSxRQUFBQSxHQUFFLE1BQUksRUFBRSxJQUFFLElBQUksSUFBSUEsR0FBRSxDQUFDLEdBQUUsRUFBRSxJQUFFQSxHQUFFO0FBQUcsV0FBRyxNQUFLLENBQUM7QUFBRSxhQUFLLElBQUUsRUFBRTtBQUFBLE1BQUUsTUFBTSxPQUFJQSxLQUFFLE9BQU8sQ0FBQyxFQUFFLE1BQU0sRUFBRSxNQUFJLEtBQUssSUFBRSxPQUFHLEdBQUcsTUFBS0EsR0FBRSxDQUFDLEtBQUcsSUFBRyxJQUFFLEdBQUUsS0FBSyxJQUFFLEdBQUdBLEdBQUUsQ0FBQyxLQUFHLEVBQUUsR0FBRSxLQUFLLElBQUUsR0FBR0EsR0FBRSxDQUFDLEtBQUcsSUFBRyxJQUFFLEdBQUUsR0FBRyxNQUFLQSxHQUFFLENBQUMsQ0FBQyxHQUFFLEtBQUssSUFBRSxHQUFHQSxHQUFFLENBQUMsS0FBRyxJQUFHLElBQUUsR0FBRSxHQUFHLE1BQUtBLEdBQUUsQ0FBQyxLQUFHLElBQUcsSUFBRSxHQUFFLEtBQUssSUFBRSxHQUFHQSxHQUFFLENBQUMsS0FBRyxFQUFFLE1BQUksS0FBSyxJQUFFLE9BQUcsS0FBSyxJQUFFLElBQUksR0FBRyxNQUFLLEtBQUssQ0FBQztBQUFBLElBQUc7QUFDNWpDLE1BQUUsVUFBVSxXQUFTLFdBQVU7QUFBQyxVQUFJLElBQUUsQ0FBRSxHQUFDQSxLQUFFLEtBQUs7QUFBRSxNQUFBQSxNQUFHLEVBQUUsS0FBSyxHQUFHQSxJQUFFLElBQUcsSUFBRSxHQUFFLEdBQUc7QUFBRSxVQUFJLElBQUUsS0FBSztBQUFFLFVBQUcsS0FBRyxVQUFRQSxHQUFFLEdBQUUsS0FBSyxJQUFJLElBQUdBLEtBQUUsS0FBSyxNQUFJLEVBQUUsS0FBSyxHQUFHQSxJQUFFLElBQUcsSUFBRSxHQUFFLEdBQUcsR0FBRSxFQUFFLEtBQUssbUJBQW1CLE9BQU8sQ0FBQyxDQUFDLEVBQUUsUUFBUSx3QkFBdUIsS0FBSyxDQUFDLEdBQUUsSUFBRSxLQUFLLEdBQUUsUUFBTSxLQUFHLEVBQUUsS0FBSyxLQUFJLE9BQU8sQ0FBQyxDQUFDO0FBQUUsVUFBRyxJQUFFLEtBQUssRUFBRSxNQUFLLEtBQUcsT0FBSyxFQUFFLE9BQU8sQ0FBQyxLQUFHLEVBQUUsS0FBSyxHQUFHLEdBQUUsRUFBRSxLQUFLLEdBQUcsR0FBRSxPQUFLLEVBQUUsT0FBTyxDQUFDLElBQUUsS0FBRyxJQUFHLElBQUUsQ0FBQztBQUFFLE9BQUMsSUFBRSxLQUFLLEVBQUUsU0FBUSxNQUFLLEVBQUUsS0FBSyxLQUFJLENBQUM7QUFBRSxPQUFDLElBQUUsS0FBSyxNQUFJLEVBQUUsS0FBSyxLQUFJLEdBQUcsR0FBRSxFQUFFLENBQUM7QUFBRSxhQUFPLEVBQUUsS0FBSyxFQUFFO0FBQUEsSUFBQztBQUFFLGFBQVMsRUFBRSxHQUFFO0FBQUMsYUFBTyxJQUFJLEVBQUUsQ0FBQztBQUFBLElBQUM7QUFDL2QsYUFBUyxHQUFHLEdBQUVBLElBQUUsR0FBRTtBQUFDLFFBQUUsSUFBRSxJQUFFLEdBQUdBLElBQUUsSUFBRSxJQUFFQTtBQUFFLFFBQUUsTUFBSSxFQUFFLElBQUUsRUFBRSxFQUFFLFFBQVEsTUFBSyxFQUFFO0FBQUEsSUFBRztBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsVUFBR0EsSUFBRTtBQUFDLFFBQUFBLEtBQUUsT0FBT0EsRUFBQztBQUFFLFlBQUcsTUFBTUEsRUFBQyxLQUFHLElBQUVBLEdBQUUsT0FBTSxNQUFNLHFCQUFtQkEsRUFBQztBQUFFLFVBQUUsSUFBRUE7QUFBQSxNQUFFLE1BQU0sR0FBRSxJQUFFO0FBQUEsSUFBSztBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxNQUFBQSxjQUFhLE1BQUksRUFBRSxJQUFFQSxJQUFFLEdBQUcsRUFBRSxHQUFFLEVBQUUsQ0FBQyxNQUFJLE1BQUlBLEtBQUUsR0FBR0EsSUFBRSxFQUFFLElBQUcsRUFBRSxJQUFFLElBQUksR0FBR0EsSUFBRSxFQUFFLENBQUM7QUFBQSxJQUFHO0FBQUMsYUFBU3FCLEdBQUUsR0FBRXJCLElBQUUsR0FBRTtBQUFDLFFBQUUsRUFBRSxJQUFJQSxJQUFFLENBQUM7QUFBQSxJQUFFO0FBQUMsYUFBUyxHQUFHLEdBQUU7QUFBQyxNQUFBcUIsR0FBRSxHQUFFLE1BQUssS0FBSyxNQUFNLGFBQVcsS0FBSyxPQUFNLENBQUUsRUFBRSxTQUFTLEVBQUUsSUFBRSxLQUFLLElBQUksS0FBSyxNQUFNLGFBQVcsS0FBSyxPQUFNLENBQUUsSUFBRSxLQUFLLElBQUssQ0FBQSxFQUFFLFNBQVMsRUFBRSxDQUFDO0FBQUUsYUFBTztBQUFBLElBQUM7QUFDdmMsYUFBUyxHQUFHLEdBQUVyQixJQUFFO0FBQUMsYUFBTyxJQUFFQSxLQUFFLFVBQVUsRUFBRSxRQUFRLFFBQU8sT0FBTyxDQUFDLElBQUUsbUJBQW1CLENBQUMsSUFBRTtBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRUEsSUFBRSxHQUFFO0FBQUMsYUFBTyxhQUFXLE9BQU8sS0FBRyxJQUFFLFVBQVUsQ0FBQyxFQUFFLFFBQVFBLElBQUUsRUFBRSxHQUFFLE1BQUksSUFBRSxFQUFFLFFBQVEsd0JBQXVCLEtBQUssSUFBRyxLQUFHO0FBQUEsSUFBSTtBQUFDLGFBQVMsR0FBRyxHQUFFO0FBQUMsVUFBRSxFQUFFLFdBQVcsQ0FBQztBQUFFLGFBQU8sT0FBSyxLQUFHLElBQUUsSUFBSSxTQUFTLEVBQUUsS0FBRyxJQUFFLElBQUksU0FBUyxFQUFFO0FBQUEsSUFBQztBQUFDLFFBQUksS0FBRyxhQUFZLEtBQUcsV0FBVSxLQUFHLFVBQVMsS0FBRyxXQUFVLEtBQUc7QUFBSyxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFdBQUssSUFBRSxLQUFLLElBQUU7QUFBSyxXQUFLLElBQUUsS0FBRztBQUFLLFdBQUssSUFBRSxDQUFDLENBQUNBO0FBQUEsSUFBRTtBQUNuYixhQUFTLEVBQUUsR0FBRTtBQUFDLFFBQUUsTUFBSSxFQUFFLElBQUUsb0JBQUksT0FBSSxFQUFFLElBQUUsR0FBRSxFQUFFLEtBQUcsR0FBRyxFQUFFLEdBQUUsU0FBU0EsSUFBRSxHQUFFO0FBQUMsVUFBRSxJQUFJLG1CQUFtQkEsR0FBRSxRQUFRLE9BQU0sR0FBRyxDQUFDLEdBQUUsQ0FBQztBQUFBLE1BQUUsQ0FBQztBQUFBLElBQUc7QUFBQyxRQUFFLEdBQUc7QUFBVSxNQUFFLE1BQUksU0FBUyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxJQUFJO0FBQUUsV0FBSyxJQUFFO0FBQUssVUFBRSxFQUFFLE1BQUssQ0FBQztBQUFFLFVBQUksSUFBRSxLQUFLLEVBQUUsSUFBSSxDQUFDO0FBQUUsV0FBRyxLQUFLLEVBQUUsSUFBSSxHQUFFLElBQUUsQ0FBRSxDQUFBO0FBQUUsUUFBRSxLQUFLQSxFQUFDO0FBQUUsV0FBSyxLQUFHO0FBQUUsYUFBTztBQUFBLElBQUk7QUFBRSxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFFBQUUsQ0FBQztBQUFFLE1BQUFBLEtBQUUsRUFBRSxHQUFFQSxFQUFDO0FBQUUsUUFBRSxFQUFFLElBQUlBLEVBQUMsTUFBSSxFQUFFLElBQUUsTUFBSyxFQUFFLEtBQUcsRUFBRSxFQUFFLElBQUlBLEVBQUMsRUFBRSxRQUFPLEVBQUUsRUFBRSxPQUFPQSxFQUFDO0FBQUEsSUFBRztBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxDQUFDO0FBQUUsTUFBQUEsS0FBRSxFQUFFLEdBQUVBLEVBQUM7QUFBRSxhQUFPLEVBQUUsRUFBRSxJQUFJQSxFQUFDO0FBQUEsSUFBQztBQUNqWixNQUFFLFVBQVEsU0FBUyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxJQUFJO0FBQUUsV0FBSyxFQUFFLFFBQVEsU0FBUyxHQUFFLEdBQUU7QUFBQyxVQUFFLFFBQVEsU0FBUyxHQUFFO0FBQUMsWUFBRSxLQUFLQSxJQUFFLEdBQUUsR0FBRSxJQUFJO0FBQUEsUUFBRSxHQUFFLElBQUk7QUFBQSxNQUFFLEdBQUUsSUFBSTtBQUFBLElBQUU7QUFBRSxNQUFFLEtBQUcsV0FBVTtBQUFDLFFBQUUsSUFBSTtBQUFFLFlBQU0sSUFBRSxNQUFNLEtBQUssS0FBSyxFQUFFLE9BQU0sQ0FBRSxHQUFFQSxLQUFFLE1BQU0sS0FBSyxLQUFLLEVBQUUsS0FBSSxDQUFFLEdBQUUsSUFBRSxDQUFFO0FBQUMsZUFBUSxJQUFFLEdBQUUsSUFBRUEsR0FBRSxRQUFPLEtBQUk7QUFBQyxjQUFNLElBQUUsRUFBRSxDQUFDO0FBQUUsaUJBQVEsSUFBRSxHQUFFLElBQUUsRUFBRSxRQUFPLElBQUksR0FBRSxLQUFLQSxHQUFFLENBQUMsQ0FBQztBQUFBLE1BQUU7QUFBQyxhQUFPO0FBQUEsSUFBQztBQUFFLE1BQUUsSUFBRSxTQUFTLEdBQUU7QUFBQyxRQUFFLElBQUk7QUFBRSxVQUFJQSxLQUFFLENBQUE7QUFBRyxVQUFHLGFBQVcsT0FBTyxFQUFFLElBQUcsTUFBSyxDQUFDLE1BQUlBLEtBQUVBLEdBQUUsT0FBTyxLQUFLLEVBQUUsSUFBSSxFQUFFLE1BQUssQ0FBQyxDQUFDLENBQUM7QUFBQSxXQUFRO0FBQUMsWUFBRSxNQUFNLEtBQUssS0FBSyxFQUFFLE9BQVEsQ0FBQTtBQUFFLGlCQUFRLElBQUUsR0FBRSxJQUFFLEVBQUUsUUFBTyxJQUFJLENBQUFBLEtBQUVBLEdBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQztBQUFBLE1BQUU7QUFBQyxhQUFPQTtBQUFBLElBQUM7QUFDbGYsTUFBRSxNQUFJLFNBQVMsR0FBRUEsSUFBRTtBQUFDLFFBQUUsSUFBSTtBQUFFLFdBQUssSUFBRTtBQUFLLFVBQUUsRUFBRSxNQUFLLENBQUM7QUFBRSxTQUFHLE1BQUssQ0FBQyxNQUFJLEtBQUssS0FBRyxLQUFLLEVBQUUsSUFBSSxDQUFDLEVBQUU7QUFBUSxXQUFLLEVBQUUsSUFBSSxHQUFFLENBQUNBLEVBQUMsQ0FBQztBQUFFLFdBQUssS0FBRztBQUFFLGFBQU87QUFBQSxJQUFJO0FBQUUsTUFBRSxNQUFJLFNBQVMsR0FBRUEsSUFBRTtBQUFDLFVBQUcsQ0FBQyxFQUFFLFFBQU9BO0FBQUUsVUFBRSxLQUFLLEVBQUUsQ0FBQztBQUFFLGFBQU8sSUFBRSxFQUFFLFNBQU8sT0FBTyxFQUFFLENBQUMsQ0FBQyxJQUFFQTtBQUFBLElBQUM7QUFBRSxhQUFTLEdBQUcsR0FBRUEsSUFBRSxHQUFFO0FBQUMsU0FBRyxHQUFFQSxFQUFDO0FBQUUsVUFBRSxFQUFFLFdBQVMsRUFBRSxJQUFFLE1BQUssRUFBRSxFQUFFLElBQUksRUFBRSxHQUFFQSxFQUFDLEdBQUUsR0FBRyxDQUFDLENBQUMsR0FBRSxFQUFFLEtBQUcsRUFBRTtBQUFBLElBQVE7QUFDL1MsTUFBRSxXQUFTLFdBQVU7QUFBQyxVQUFHLEtBQUssRUFBRSxRQUFPLEtBQUs7QUFBRSxVQUFHLENBQUMsS0FBSyxFQUFFLFFBQU87QUFBRyxZQUFNLElBQUUsQ0FBRSxHQUFDQSxLQUFFLE1BQU0sS0FBSyxLQUFLLEVBQUUsS0FBSSxDQUFFO0FBQUUsZUFBUSxJQUFFLEdBQUUsSUFBRUEsR0FBRSxRQUFPLEtBQUk7QUFBQyxZQUFJLElBQUVBLEdBQUUsQ0FBQztBQUFFLGNBQU0sSUFBRSxtQkFBbUIsT0FBTyxDQUFDLENBQUMsR0FBRSxJQUFFLEtBQUssRUFBRSxDQUFDO0FBQUUsYUFBSSxJQUFFLEdBQUUsSUFBRSxFQUFFLFFBQU8sS0FBSTtBQUFDLGNBQUksSUFBRTtBQUFFLGlCQUFLLEVBQUUsQ0FBQyxNQUFJLEtBQUcsTUFBSSxtQkFBbUIsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQUcsWUFBRSxLQUFLLENBQUM7QUFBQSxRQUFFO0FBQUEsTUFBQztBQUFDLGFBQU8sS0FBSyxJQUFFLEVBQUUsS0FBSyxHQUFHO0FBQUEsSUFBQztBQUFFLGFBQVMsRUFBRSxHQUFFQSxJQUFFO0FBQUMsTUFBQUEsS0FBRSxPQUFPQSxFQUFDO0FBQUUsUUFBRSxNQUFJQSxLQUFFQSxHQUFFO0FBQWUsYUFBT0E7QUFBQSxJQUFDO0FBQzVYLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsTUFBQUEsTUFBRyxDQUFDLEVBQUUsTUFBSSxFQUFFLENBQUMsR0FBRSxFQUFFLElBQUUsTUFBSyxFQUFFLEVBQUUsUUFBUSxTQUFTLEdBQUUsR0FBRTtBQUFDLFlBQUksSUFBRSxFQUFFLFlBQWE7QUFBQyxhQUFHLE1BQUksR0FBRyxNQUFLLENBQUMsR0FBRSxHQUFHLE1BQUssR0FBRSxDQUFDO0FBQUEsTUFBRyxHQUFFLENBQUM7QUFBRyxRQUFFLElBQUVBO0FBQUEsSUFBRTtBQUFDLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsWUFBTSxJQUFFLElBQUk7QUFBRyxVQUFHLEVBQUUsT0FBTTtBQUFDLGNBQU0sSUFBRSxJQUFJO0FBQU0sVUFBRSxTQUFPLEdBQUcsR0FBRSxHQUFFLHlCQUF3QixNQUFHQSxJQUFFLENBQUM7QUFBRSxVQUFFLFVBQVEsR0FBRyxHQUFFLEdBQUUsd0JBQXVCLE9BQUdBLElBQUUsQ0FBQztBQUFFLFVBQUUsVUFBUSxHQUFHLEdBQUUsR0FBRSx3QkFBdUIsT0FBR0EsSUFBRSxDQUFDO0FBQUUsVUFBRSxZQUFVLEdBQUcsR0FBRSxHQUFFLDBCQUF5QixPQUFHQSxJQUFFLENBQUM7QUFBRSxVQUFFLFdBQVcsV0FBVTtBQUFDLGNBQUcsRUFBRSxVQUFVLEdBQUU7UUFBWSxHQUFFLEdBQUc7QUFBRSxVQUFFLE1BQUk7QUFBQSxNQUFFLE1BQU0sQ0FBQUEsR0FBRSxLQUFFO0FBQUEsSUFBRTtBQUN4ZCxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFlBQU0sSUFBRSxJQUFJLE1BQUcsSUFBRSxJQUFJLG1CQUFnQixJQUFFLFdBQVcsTUFBSTtBQUFDLFVBQUUsTUFBSztBQUFHLFVBQUUsR0FBRSwyQkFBMEIsT0FBR0EsRUFBQztBQUFBLE1BQUUsR0FBRSxHQUFHO0FBQUUsWUFBTSxHQUFFLEVBQUMsUUFBTyxFQUFFLE9BQU0sQ0FBQyxFQUFFLEtBQUssT0FBRztBQUFDLHFCQUFhLENBQUM7QUFBRSxVQUFFLEtBQUcsRUFBRSxHQUFFLHNCQUFxQixNQUFHQSxFQUFDLElBQUUsRUFBRSxHQUFFLGdDQUErQixPQUFHQSxFQUFDO0FBQUEsTUFBRSxDQUFDLEVBQUUsTUFBTSxNQUFJO0FBQUMscUJBQWEsQ0FBQztBQUFFLFVBQUUsR0FBRSx5QkFBd0IsT0FBR0EsRUFBQztBQUFBLE1BQUUsQ0FBQztBQUFBLElBQUU7QUFBQyxhQUFTLEVBQUUsR0FBRUEsSUFBRSxHQUFFLEdBQUUsR0FBRTtBQUFDLFVBQUc7QUFBQyxjQUFJLEVBQUUsU0FBTyxNQUFLLEVBQUUsVUFBUSxNQUFLLEVBQUUsVUFBUSxNQUFLLEVBQUUsWUFBVSxPQUFNLEVBQUUsQ0FBQztBQUFBLE1BQUUsU0FBTyxHQUFFO0FBQUEsTUFBQTtBQUFBLElBQUU7QUFBQyxhQUFTLEtBQUk7QUFBQyxXQUFLLElBQUUsSUFBSTtBQUFBLElBQUc7QUFBQyxhQUFTLEdBQUcsR0FBRUEsSUFBRSxHQUFFO0FBQUMsWUFBTSxJQUFFLEtBQUc7QUFBRyxVQUFHO0FBQUMsV0FBRyxHQUFFLFNBQVMsR0FBRSxHQUFFO0FBQUMsY0FBSSxJQUFFO0FBQUUsWUFBRSxDQUFDLE1BQUksSUFBRSxHQUFHLENBQUM7QUFBRyxVQUFBQSxHQUFFLEtBQUssSUFBRSxJQUFFLE1BQUksbUJBQW1CLENBQUMsQ0FBQztBQUFBLFFBQUUsQ0FBQztBQUFBLE1BQUUsU0FBTyxHQUFFO0FBQUMsY0FBTUEsR0FBRSxLQUFLLElBQUUsVUFBUSxtQkFBbUIsU0FBUyxDQUFDLEdBQUU7QUFBQSxNQUFFO0FBQUEsSUFBQztBQUFDLGFBQVMsR0FBRyxHQUFFO0FBQUMsV0FBSyxJQUFFLEVBQUUsTUFBSTtBQUFLLFdBQUssSUFBRSxFQUFFLE1BQUk7QUFBQSxJQUFHO0FBQUMsTUFBRSxJQUFHLEVBQUU7QUFBRSxPQUFHLFVBQVUsSUFBRSxXQUFVO0FBQUMsYUFBTyxJQUFJLEdBQUcsS0FBSyxHQUFFLEtBQUssQ0FBQztBQUFBLElBQUM7QUFBRSxPQUFHLFVBQVUsSUFBRSx5QkFBUyxHQUFFO0FBQUMsYUFBTyxXQUFVO0FBQUMsZUFBTztBQUFBLE1BQUM7QUFBQSxJQUFDLEVBQUUsQ0FBRSxDQUFBO0FBQUUsYUFBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxRQUFFLEtBQUssSUFBSTtBQUFFLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRUE7QUFBRSxXQUFLLElBQUU7QUFBTyxXQUFLLFNBQU8sS0FBSyxhQUFXO0FBQUUsV0FBSyxlQUFhLEtBQUssZUFBYSxLQUFLLFdBQVMsS0FBSyxhQUFXO0FBQUcsV0FBSyxxQkFBbUI7QUFBSyxXQUFLLElBQUUsSUFBSTtBQUFRLFdBQUssSUFBRTtBQUFLLFdBQUssSUFBRTtBQUFNLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFO0FBQUEsSUFBSztBQUFDLE1BQUUsSUFBRyxDQUFDO0FBQUUsUUFBRSxHQUFHO0FBQzlsQyxNQUFFLE9BQUssU0FBUyxHQUFFQSxJQUFFO0FBQUMsVUFBRyxLQUFHLEtBQUssV0FBVyxPQUFNLEtBQUssU0FBUSxNQUFNLDhCQUE4QjtBQUFFLFdBQUssSUFBRTtBQUFFLFdBQUssSUFBRUE7QUFBRSxXQUFLLGFBQVc7QUFBRSxTQUFHLElBQUk7QUFBQSxJQUFFO0FBQUUsTUFBRSxPQUFLLFNBQVMsR0FBRTtBQUFDLFVBQUcsS0FBRyxLQUFLLFdBQVcsT0FBTSxLQUFLLFNBQVEsTUFBTSw2QkFBNkI7QUFBRSxXQUFLLElBQUU7QUFBRyxZQUFNQSxLQUFFLEVBQUMsU0FBUSxLQUFLLEdBQUUsUUFBTyxLQUFLLEdBQUUsYUFBWSxLQUFLLEdBQUUsT0FBTSxPQUFNO0FBQUUsWUFBSUEsR0FBRSxPQUFLO0FBQUcsT0FBQyxLQUFLLEtBQUcsR0FBRyxNQUFNLElBQUksUUFBUSxLQUFLLEdBQUVBLEVBQUMsQ0FBQyxFQUFFLEtBQUssS0FBSyxHQUFHLEtBQUssSUFBSSxHQUFFLEtBQUssR0FBRyxLQUFLLElBQUksQ0FBQztBQUFBLElBQUU7QUFDeGEsTUFBRSxRQUFNLFdBQVU7QUFBQyxXQUFLLFdBQVMsS0FBSyxlQUFhO0FBQUcsV0FBSyxJQUFFLElBQUk7QUFBUSxXQUFLLFNBQU87QUFBRSxXQUFLLEtBQUcsS0FBSyxFQUFFLE9BQU8sc0JBQXNCLEVBQUUsTUFBTSxNQUFJO0FBQUEsTUFBQSxDQUFFO0FBQUUsV0FBRyxLQUFLLGNBQVksS0FBSyxLQUFHLEtBQUcsS0FBSyxlQUFhLEtBQUssSUFBRSxPQUFHLEdBQUcsSUFBSTtBQUFHLFdBQUssYUFBVztBQUFBLElBQUU7QUFDMU8sTUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFDLFVBQUcsS0FBSyxNQUFJLEtBQUssSUFBRSxHQUFFLEtBQUssTUFBSSxLQUFLLFNBQU8sS0FBSyxFQUFFLFFBQU8sS0FBSyxhQUFXLEtBQUssRUFBRSxZQUFXLEtBQUssSUFBRSxFQUFFLFNBQVEsS0FBSyxhQUFXLEdBQUUsR0FBRyxJQUFJLElBQUcsS0FBSyxNQUFJLEtBQUssYUFBVyxHQUFFLEdBQUcsSUFBSSxHQUFFLEtBQUssSUFBSSxLQUFHLGtCQUFnQixLQUFLLGFBQWEsR0FBRSxZQUFhLEVBQUMsS0FBSyxLQUFLLEdBQUcsS0FBSyxJQUFJLEdBQUUsS0FBSyxHQUFHLEtBQUssSUFBSSxDQUFDO0FBQUEsZUFBVSxnQkFBYyxPQUFPLEVBQUUsa0JBQWdCLFVBQVMsR0FBRTtBQUFDLGFBQUssSUFBRSxFQUFFLEtBQUssVUFBVztBQUFDLFlBQUcsS0FBSyxHQUFFO0FBQUMsY0FBRyxLQUFLLGFBQWEsT0FBTSxNQUFNLHFFQUFxRTtBQUFFLGVBQUssV0FDbmYsQ0FBRTtBQUFBLFFBQUMsTUFBTSxNQUFLLFdBQVMsS0FBSyxlQUFhLElBQUcsS0FBSyxJQUFFLElBQUk7QUFBWSxXQUFHLElBQUk7QUFBQSxNQUFFLE1BQU0sR0FBRSxPQUFPLEtBQUssS0FBSyxHQUFHLEtBQUssSUFBSSxHQUFFLEtBQUssR0FBRyxLQUFLLElBQUksQ0FBQztBQUFBLElBQUU7QUFBRSxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsRUFBRSxLQUFJLEVBQUcsS0FBSyxFQUFFLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxNQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQztBQUFBLElBQUU7QUFBQyxNQUFFLEtBQUcsU0FBUyxHQUFFO0FBQUMsVUFBRyxLQUFLLEdBQUU7QUFBQyxZQUFHLEtBQUssS0FBRyxFQUFFLE1BQU0sTUFBSyxTQUFTLEtBQUssRUFBRSxLQUFLO0FBQUEsaUJBQVUsQ0FBQyxLQUFLLEdBQUU7QUFBQyxjQUFJQSxLQUFFLEVBQUUsUUFBTSxFQUFFLFFBQU0sSUFBSSxXQUFXLENBQUM7QUFBRSxjQUFHQSxLQUFFLEtBQUssRUFBRSxPQUFPQSxJQUFFLEVBQUMsUUFBTyxDQUFDLEVBQUUsS0FBSSxDQUFDLEVBQUUsTUFBSyxXQUFTLEtBQUssZ0JBQWNBO0FBQUEsUUFBRTtBQUFDLFVBQUUsT0FBSyxHQUFHLElBQUksSUFBRSxHQUFHLElBQUk7QUFBRSxhQUFHLEtBQUssY0FBWSxHQUFHLElBQUk7QUFBQSxNQUFFO0FBQUEsSUFBQztBQUNqZCxNQUFFLEtBQUcsU0FBUyxHQUFFO0FBQUMsV0FBSyxNQUFJLEtBQUssV0FBUyxLQUFLLGVBQWEsR0FBRSxHQUFHLElBQUk7QUFBQSxJQUFHO0FBQUUsTUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFDLFdBQUssTUFBSSxLQUFLLFdBQVMsR0FBRSxHQUFHLElBQUk7QUFBQSxJQUFHO0FBQUUsTUFBRSxLQUFHLFdBQVU7QUFBQyxXQUFLLEtBQUcsR0FBRyxJQUFJO0FBQUEsSUFBRTtBQUFFLGFBQVMsR0FBRyxHQUFFO0FBQUMsUUFBRSxhQUFXO0FBQUUsUUFBRSxJQUFFO0FBQUssUUFBRSxJQUFFO0FBQUssUUFBRSxJQUFFO0FBQUssU0FBRyxDQUFDO0FBQUEsSUFBRTtBQUFDLE1BQUUsbUJBQWlCLFNBQVMsR0FBRUEsSUFBRTtBQUFDLFdBQUssRUFBRSxPQUFPLEdBQUVBLEVBQUM7QUFBQSxJQUFFO0FBQUUsTUFBRSxvQkFBa0IsU0FBUyxHQUFFO0FBQUMsYUFBTyxLQUFLLElBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxZQUFhLENBQUEsS0FBRyxLQUFHO0FBQUEsSUFBRTtBQUN2VyxNQUFFLHdCQUFzQixXQUFVO0FBQUMsVUFBRyxDQUFDLEtBQUssRUFBRSxRQUFPO0FBQUcsWUFBTSxJQUFFLENBQUUsR0FBQ0EsS0FBRSxLQUFLLEVBQUUsUUFBUztBQUFDLGVBQVEsSUFBRUEsR0FBRSxLQUFNLEdBQUMsQ0FBQyxFQUFFLE9BQU0sS0FBRSxFQUFFLE9BQU0sRUFBRSxLQUFLLEVBQUUsQ0FBQyxJQUFFLE9BQUssRUFBRSxDQUFDLENBQUMsR0FBRSxJQUFFQSxHQUFFLEtBQU07QUFBQyxhQUFPLEVBQUUsS0FBSyxNQUFNO0FBQUEsSUFBQztBQUFFLGFBQVMsR0FBRyxHQUFFO0FBQUMsUUFBRSxzQkFBb0IsRUFBRSxtQkFBbUIsS0FBSyxDQUFDO0FBQUEsSUFBRTtBQUFDLFdBQU8sZUFBZSxHQUFHLFdBQVUsbUJBQWtCLEVBQUMsS0FBSSxXQUFVO0FBQUMsYUFBTyxjQUFZLEtBQUs7QUFBQSxJQUFDLEdBQUUsS0FBSSxTQUFTLEdBQUU7QUFBQyxXQUFLLElBQUUsSUFBRSxZQUFVO0FBQUEsSUFBYyxFQUFDLENBQUM7QUFBRSxhQUFTLEdBQUcsR0FBRTtBQUFDLFVBQUlBLEtBQUU7QUFBRyxTQUFHLEdBQUUsU0FBUyxHQUFFLEdBQUU7QUFBQyxRQUFBQSxNQUFHO0FBQUUsUUFBQUEsTUFBRztBQUFJLFFBQUFBLE1BQUc7QUFBRSxRQUFBQSxNQUFHO0FBQUEsTUFBTyxDQUFDO0FBQUUsYUFBT0E7QUFBQSxJQUFDO0FBQUMsYUFBUyxHQUFHLEdBQUVBLElBQUUsR0FBRTtBQUFDLFNBQUU7QUFBQyxhQUFJLEtBQUssR0FBRTtBQUFDLGNBQUksSUFBRTtBQUFHLGdCQUFNO0FBQUEsUUFBQztBQUFDLFlBQUU7QUFBQSxNQUFHO0FBQUMsWUFBSSxJQUFFLEdBQUcsQ0FBQyxHQUFFLGFBQVcsT0FBTyxJQUFHLFFBQU0sS0FBRyxtQkFBbUIsT0FBTyxDQUFDLENBQUMsSUFBR3FCLEdBQUUsR0FBRXJCLElBQUUsQ0FBQztBQUFBLElBQUc7QUFBQyxhQUFTLEVBQUUsR0FBRTtBQUFDLFFBQUUsS0FBSyxJQUFJO0FBQUUsV0FBSyxVQUFRLG9CQUFJO0FBQUksV0FBSyxJQUFFLEtBQUc7QUFBSyxXQUFLLElBQUU7QUFBRyxXQUFLLElBQUUsS0FBSyxJQUFFO0FBQUssV0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFO0FBQUssV0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFO0FBQUEsSUFBRztBQUFDLE1BQUUsR0FBRSxDQUFDO0FBQUUsUUFBSSxLQUFHLGFBQVksS0FBRyxDQUFDLFFBQU8sS0FBSztBQUFFLFFBQUUsRUFBRTtBQUFVLE1BQUUsS0FBRyxTQUFTLEdBQUU7QUFBQyxXQUFLLElBQUU7QUFBQSxJQUFFO0FBQ3ozQixNQUFFLEtBQUcsU0FBUyxHQUFFQSxJQUFFLEdBQUUsR0FBRTtBQUFDLFVBQUcsS0FBSyxFQUFFLE9BQU0sTUFBTSw0REFBMEQsS0FBSyxJQUFFLGNBQVksQ0FBQztBQUFFLE1BQUFBLEtBQUVBLEtBQUVBLEdBQUUsWUFBVyxJQUFHO0FBQU0sV0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLEVBQUUsRUFBQyxJQUFHLEdBQUc7QUFBSSxXQUFLLElBQUUsS0FBSyxJQUFFLEdBQUcsS0FBSyxDQUFDLElBQUUsR0FBRyxFQUFFO0FBQUUsV0FBSyxFQUFFLHFCQUFtQixFQUFFLEtBQUssSUFBRyxJQUFJO0FBQUUsVUFBRztBQUFDLGFBQUssSUFBRSxNQUFHLEtBQUssRUFBRSxLQUFLQSxJQUFFLE9BQU8sQ0FBQyxHQUFFLElBQUUsR0FBRSxLQUFLLElBQUU7QUFBQSxNQUFHLFNBQU8sR0FBRTtBQUFDLFdBQUcsTUFBSyxDQUFDO0FBQUU7QUFBQSxNQUFNO0FBQUMsVUFBRSxLQUFHO0FBQUcsVUFBRSxJQUFJLElBQUksS0FBSyxPQUFPO0FBQUUsVUFBRyxFQUFFLEtBQUcsT0FBTyxlQUFlLENBQUMsTUFBSSxPQUFPLFVBQVUsVUFBUSxLQUFLLEVBQUUsR0FBRSxJQUFJLEdBQUUsRUFBRSxDQUFDLENBQUM7QUFBQSxlQUFVLGVBQzFmLE9BQU8sRUFBRSxRQUFNLGVBQWEsT0FBTyxFQUFFLElBQUksWUFBVSxLQUFLLEVBQUUsS0FBTSxFQUFDLEdBQUUsSUFBSSxHQUFFLEVBQUUsSUFBSSxDQUFDLENBQUM7QUFBQSxVQUFPLE9BQU0sTUFBTSx5Q0FBdUMsT0FBTyxDQUFDLENBQUM7QUFBRSxVQUFFLE1BQU0sS0FBSyxFQUFFLEtBQUksQ0FBRSxFQUFFLEtBQUssT0FBRyxrQkFBZ0IsRUFBRSxZQUFhLENBQUE7QUFBRSxVQUFFLEVBQUUsWUFBVSxhQUFhLEVBQUU7QUFBUyxRQUFFLEtBQUcsTUFBTSxVQUFVLFFBQVEsS0FBSyxJQUFHQSxJQUFFLE1BQU0sTUFBSSxLQUFHLEtBQUcsRUFBRSxJQUFJLGdCQUFlLGlEQUFpRDtBQUFFLGlCQUFVLENBQUMsR0FBRSxDQUFDLEtBQUksRUFBRSxNQUFLLEVBQUUsaUJBQWlCLEdBQUUsQ0FBQztBQUFFLFdBQUssTUFBSSxLQUFLLEVBQUUsZUFBYSxLQUFLO0FBQUcsMkJBQW9CLEtBQUssS0FBRyxLQUFLLEVBQUUsb0JBQ3BmLEtBQUssTUFBSSxLQUFLLEVBQUUsa0JBQWdCLEtBQUs7QUFBRyxVQUFHO0FBQUMsV0FBRyxJQUFJLEdBQUUsS0FBSyxJQUFFLE1BQUcsS0FBSyxFQUFFLEtBQUssQ0FBQyxHQUFFLEtBQUssSUFBRTtBQUFBLE1BQUcsU0FBTyxHQUFFO0FBQUMsV0FBRyxNQUFLLENBQUM7QUFBQSxNQUFFO0FBQUEsSUFBQztBQUFFLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsUUFBRSxJQUFFO0FBQUcsUUFBRSxNQUFJLEVBQUUsSUFBRSxNQUFHLEVBQUUsRUFBRSxNQUFLLEdBQUcsRUFBRSxJQUFFO0FBQUksUUFBRSxJQUFFQTtBQUFFLFFBQUUsSUFBRTtBQUFFLFNBQUcsQ0FBQztBQUFFLFNBQUcsQ0FBQztBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsTUFBSSxFQUFFLElBQUUsTUFBRyxFQUFFLEdBQUUsVUFBVSxHQUFFLEVBQUUsR0FBRSxPQUFPO0FBQUEsSUFBRztBQUFDLE1BQUUsUUFBTSxTQUFTLEdBQUU7QUFBQyxXQUFLLEtBQUcsS0FBSyxNQUFJLEtBQUssSUFBRSxPQUFHLEtBQUssSUFBRSxNQUFHLEtBQUssRUFBRSxNQUFPLEdBQUMsS0FBSyxJQUFFLE9BQUcsS0FBSyxJQUFFLEtBQUcsR0FBRSxFQUFFLE1BQUssVUFBVSxHQUFFLEVBQUUsTUFBSyxPQUFPLEdBQUUsR0FBRyxJQUFJO0FBQUEsSUFBRztBQUFFLE1BQUUsSUFBRSxXQUFVO0FBQUMsV0FBSyxNQUFJLEtBQUssTUFBSSxLQUFLLElBQUUsT0FBRyxLQUFLLElBQUUsTUFBRyxLQUFLLEVBQUUsU0FBUSxLQUFLLElBQUUsUUFBSSxHQUFHLE1BQUssSUFBRTtBQUFHLFFBQUUsR0FBRyxFQUFFLEtBQUssSUFBSTtBQUFBLElBQUU7QUFDeGYsTUFBRSxLQUFHLFdBQVU7QUFBQyxXQUFLLE1BQUksS0FBSyxLQUFHLEtBQUssS0FBRyxLQUFLLElBQUUsR0FBRyxJQUFJLElBQUUsS0FBSyxHQUFJO0FBQUEsSUFBRTtBQUFFLE1BQUUsS0FBRyxXQUFVO0FBQUMsU0FBRyxJQUFJO0FBQUEsSUFBRTtBQUMvRixhQUFTLEdBQUcsR0FBRTtBQUFDLFVBQUcsRUFBRSxLQUFHLGVBQWEsT0FBTyxPQUFLLENBQUMsRUFBRSxFQUFFLENBQUMsS0FBRyxLQUFHLEVBQUUsQ0FBQyxLQUFHLEtBQUcsRUFBRSxFQUFDO0FBQUksWUFBRyxFQUFFLEtBQUcsS0FBRyxFQUFFLENBQUMsRUFBRSxJQUFHLEVBQUUsSUFBRyxHQUFFLENBQUM7QUFBQSxpQkFBVSxFQUFFLEdBQUUsa0JBQWtCLEdBQUUsS0FBRyxFQUFFLENBQUMsR0FBRTtBQUFDLFlBQUUsSUFBRTtBQUFHLGNBQUc7QUFBQyxrQkFBTSxJQUFFLEVBQUUsRUFBRztBQUFDLGNBQUUsU0FBTyxHQUFHO0FBQUEsY0FBQSxLQUFLO0FBQUEsY0FBSSxLQUFLO0FBQUEsY0FBSSxLQUFLO0FBQUEsY0FBSSxLQUFLO0FBQUEsY0FBSSxLQUFLO0FBQUEsY0FBSSxLQUFLO0FBQUEsY0FBSSxLQUFLO0FBQUssb0JBQUlBLEtBQUU7QUFBRyxzQkFBTTtBQUFBLGNBQUU7QUFBUSxnQkFBQUEsS0FBRTtBQUFBLFlBQUc7QUFBQyxnQkFBSTtBQUFFLGdCQUFHLEVBQUUsSUFBRUEsS0FBRztBQUFDLGtCQUFJO0FBQUUsa0JBQUcsSUFBRSxNQUFJLEdBQUU7QUFBQyxvQkFBSSxJQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLEVBQUUsQ0FBQyxLQUFHO0FBQUssaUJBQUMsS0FBRyxFQUFFLFFBQU0sRUFBRSxLQUFLLGFBQVcsSUFBRSxFQUFFLEtBQUssU0FBUyxTQUFTLE1BQU0sR0FBRSxFQUFFO0FBQUcsb0JBQUUsQ0FBQyxHQUFHLEtBQUssSUFBRSxFQUFFLFlBQVcsSUFBRyxFQUFFO0FBQUEsY0FBRTtBQUFDLGtCQUFFO0FBQUEsWUFBRTtBQUFDLGdCQUFHLEVBQUUsR0FBRSxHQUFFLFVBQVUsR0FBRSxFQUFFLEdBQUUsU0FBUztBQUFBLGlCQUFPO0FBQUMsZ0JBQUUsSUFDdmY7QUFBRSxrQkFBRztBQUFDLG9CQUFJLElBQUUsSUFBRSxFQUFFLENBQUMsSUFBRSxFQUFFLEVBQUUsYUFBVztBQUFBLGNBQUcsU0FBTyxHQUFFO0FBQUMsb0JBQUU7QUFBQSxjQUFHO0FBQUMsZ0JBQUUsSUFBRSxJQUFFLE9BQUssRUFBRSxFQUFDLElBQUc7QUFBSSxpQkFBRyxDQUFDO0FBQUEsWUFBRTtBQUFBLFVBQUMsVUFBQztBQUFRLGVBQUcsQ0FBQztBQUFBLFVBQUU7QUFBQSxRQUFDO0FBQUE7QUFBQSxJQUFDO0FBQUMsYUFBUyxHQUFHLEdBQUVBLElBQUU7QUFBQyxVQUFHLEVBQUUsR0FBRTtBQUFDLFdBQUcsQ0FBQztBQUFFLGNBQU0sSUFBRSxFQUFFLEdBQUUsSUFBRSxFQUFFLEVBQUUsQ0FBQyxJQUFFLE1BQUk7QUFBQSxRQUFFLElBQUM7QUFBSyxVQUFFLElBQUU7QUFBSyxVQUFFLElBQUU7QUFBSyxRQUFBQSxNQUFHLEVBQUUsR0FBRSxPQUFPO0FBQUUsWUFBRztBQUFDLFlBQUUscUJBQW1CO0FBQUEsUUFBRSxTQUFPLEdBQUU7QUFBQSxRQUFFO0FBQUEsTUFBQTtBQUFBLElBQUM7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsTUFBSSxFQUFFLGFBQWEsRUFBRSxDQUFDLEdBQUUsRUFBRSxJQUFFO0FBQUEsSUFBTTtBQUFDLE1BQUUsV0FBUyxXQUFVO0FBQUMsYUFBTyxDQUFDLENBQUMsS0FBSztBQUFBLElBQUM7QUFBRSxhQUFTLEVBQUUsR0FBRTtBQUFDLGFBQU8sRUFBRSxJQUFFLEVBQUUsRUFBRSxhQUFXO0FBQUEsSUFBQztBQUFDLE1BQUUsSUFBRSxXQUFVO0FBQUMsVUFBRztBQUFDLGVBQU8sSUFBRSxFQUFFLElBQUksSUFBRSxLQUFLLEVBQUUsU0FBTztBQUFBLE1BQUUsU0FBTyxHQUFFO0FBQUMsZUFBTztBQUFBLE1BQUU7QUFBQSxJQUFDO0FBQUUsTUFBRSxLQUFHLFdBQVU7QUFBQyxVQUFHO0FBQUMsZUFBTyxLQUFLLElBQUUsS0FBSyxFQUFFLGVBQWE7QUFBQSxNQUFFLFNBQU8sR0FBRTtBQUFDLGVBQU87QUFBQSxNQUFFO0FBQUEsSUFBQztBQUN4Z0IsTUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFDLFVBQUcsS0FBSyxHQUFFO0FBQUMsWUFBSUEsS0FBRSxLQUFLLEVBQUU7QUFBYSxhQUFHLEtBQUdBLEdBQUUsUUFBUSxDQUFDLE1BQUlBLEtBQUVBLEdBQUUsVUFBVSxFQUFFLE1BQU07QUFBRyxlQUFPLEdBQUdBLEVBQUM7QUFBQSxNQUFDO0FBQUEsSUFBQztBQUFFLGFBQVMsR0FBRyxHQUFFO0FBQUMsVUFBRztBQUFDLFlBQUcsQ0FBQyxFQUFFLEVBQUUsUUFBTztBQUFLLFlBQUcsY0FBYSxFQUFFLEVBQUUsUUFBTyxFQUFFLEVBQUU7QUFBUyxnQkFBTyxFQUFFLEdBQUc7QUFBQSxVQUFBLEtBQUs7QUFBQSxVQUFHLEtBQUs7QUFBTyxtQkFBTyxFQUFFLEVBQUU7QUFBQSxVQUFhLEtBQUs7QUFBYyxnQkFBRyw0QkFBMkIsRUFBRSxFQUFFLFFBQU8sRUFBRSxFQUFFO0FBQUEsUUFBc0I7QUFBQyxlQUFPO0FBQUEsTUFBSSxTQUFPQSxJQUFFO0FBQUMsZUFBTztBQUFBLE1BQUk7QUFBQSxJQUFDO0FBQ2xYLGFBQVMsR0FBRyxHQUFFO0FBQUMsWUFBTUEsS0FBRSxDQUFBO0FBQUcsV0FBRyxFQUFFLEtBQUcsS0FBRyxFQUFFLENBQUMsSUFBRSxFQUFFLEVBQUUsc0JBQXVCLEtBQUUsS0FBRyxJQUFJLE1BQU0sTUFBTTtBQUFFLGVBQVEsSUFBRSxHQUFFLElBQUUsRUFBRSxRQUFPLEtBQUk7QUFBQyxZQUFHLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRTtBQUFTLFlBQUksSUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0FBQUUsY0FBTSxJQUFFLEVBQUUsQ0FBQztBQUFFLFlBQUUsRUFBRSxDQUFDO0FBQUUsWUFBRyxhQUFXLE9BQU8sRUFBRTtBQUFTLFlBQUUsRUFBRSxLQUFJO0FBQUcsY0FBTSxJQUFFQSxHQUFFLENBQUMsS0FBRyxDQUFFO0FBQUMsUUFBQUEsR0FBRSxDQUFDLElBQUU7QUFBRSxVQUFFLEtBQUssQ0FBQztBQUFBLE1BQUU7QUFBQyxTQUFHQSxJQUFFLFNBQVMsR0FBRTtBQUFDLGVBQU8sRUFBRSxLQUFLLElBQUk7QUFBQSxNQUFDLENBQUM7QUFBQSxJQUFFO0FBQUMsTUFBRSxLQUFHLFdBQVU7QUFBQyxhQUFPLEtBQUs7QUFBQSxJQUFDO0FBQUUsTUFBRSxLQUFHLFdBQVU7QUFBQyxhQUFPLGFBQVcsT0FBTyxLQUFLLElBQUUsS0FBSyxJQUFFLE9BQU8sS0FBSyxDQUFDO0FBQUEsSUFBQztBQUFFLGFBQVMsR0FBRyxHQUFFQSxJQUFFLEdBQUU7QUFBQyxhQUFPLEtBQUcsRUFBRSx3QkFBc0IsRUFBRSxzQkFBc0IsQ0FBQyxLQUFHQSxLQUFFQTtBQUFBLElBQUM7QUFDL2QsYUFBUyxHQUFHLEdBQUU7QUFBQyxXQUFLLEtBQUc7QUFBRSxXQUFLLElBQUUsQ0FBRTtBQUFDLFdBQUssSUFBRSxJQUFJO0FBQUcsV0FBSyxLQUFHLEtBQUssS0FBRyxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLEtBQUcsS0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRTtBQUFLLFdBQUssS0FBRyxLQUFLLElBQUU7QUFBRSxXQUFLLEtBQUcsR0FBRyxZQUFXLE9BQUcsQ0FBQztBQUFFLFdBQUssSUFBRSxLQUFLLElBQUUsS0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBSyxXQUFLLElBQUU7QUFBRyxXQUFLLEtBQUcsS0FBSyxJQUFFO0FBQUcsV0FBSyxJQUFFLEtBQUssSUFBRSxLQUFLLElBQUU7QUFBRSxXQUFLLEtBQUcsR0FBRyxvQkFBbUIsS0FBSSxDQUFDO0FBQUUsV0FBSyxLQUFHLEdBQUcsb0JBQW1CLEtBQUksQ0FBQztBQUFFLFdBQUssS0FBRyxHQUFHLDRCQUEyQixHQUFFLENBQUM7QUFBRSxXQUFLLEtBQUcsR0FBRyxrQ0FBaUMsS0FBSSxDQUFDO0FBQUUsV0FBSyxLQUFHLEtBQUcsRUFBRSxrQkFBZ0I7QUFBTyxXQUFLLEtBQUcsS0FBRyxFQUFFLE1BQUk7QUFBTyxXQUFLLEtBQ3ZmLEtBQUcsRUFBRSxtQkFBaUI7QUFBRyxXQUFLLElBQUU7QUFBTyxXQUFLLElBQUUsS0FBRyxFQUFFLDBCQUF3QjtBQUFHLFdBQUssSUFBRTtBQUFHLFdBQUssSUFBRSxJQUFJLEdBQUcsS0FBRyxFQUFFLHNCQUFzQjtBQUFFLFdBQUssS0FBRyxJQUFJO0FBQUcsV0FBSyxJQUFFLEtBQUcsRUFBRSxpQkFBZTtBQUFHLFdBQUssSUFBRSxLQUFHLEVBQUUsNEJBQTBCO0FBQUcsV0FBSyxLQUFHLEtBQUssTUFBSSxLQUFLLElBQUU7QUFBSSxXQUFLLEtBQUcsS0FBRyxFQUFFLE1BQUk7QUFBRyxXQUFHLEVBQUUsTUFBSSxLQUFLLEVBQUUsR0FBSTtBQUFDLFdBQUcsRUFBRSxxQkFBbUIsS0FBSyxJQUFFO0FBQUksV0FBSyxLQUFHLENBQUMsS0FBSyxLQUFHLEtBQUssS0FBRyxLQUFHLEVBQUUsd0JBQXNCO0FBQUcsV0FBSyxLQUFHO0FBQU8sV0FBRyxFQUFFLHNCQUFvQixJQUFFLEVBQUUsdUJBQXFCLEtBQUssS0FBRyxFQUFFO0FBQW9CLFdBQUssS0FBRztBQUFPLFdBQUssSUFBRTtBQUFFLFdBQUssSUFDbGY7QUFBQyxXQUFLLEtBQUcsS0FBSyxJQUFFO0FBQUEsSUFBSztBQUFDLFFBQUUsR0FBRztBQUFVLE1BQUUsS0FBRztBQUFFLE1BQUUsSUFBRTtBQUFFLE1BQUUsVUFBUSxTQUFTLEdBQUVBLElBQUUsR0FBRSxHQUFFO0FBQUMsUUFBRSxDQUFDO0FBQUUsV0FBSyxJQUFFO0FBQUUsV0FBSyxJQUFFQSxNQUFHLENBQUE7QUFBRyxXQUFHLFdBQVMsTUFBSSxLQUFLLEVBQUUsT0FBSyxHQUFFLEtBQUssRUFBRSxPQUFLO0FBQUcsV0FBSyxJQUFFLEtBQUs7QUFBRSxXQUFLLElBQUUsR0FBRyxNQUFLLE1BQUssS0FBSyxDQUFDO0FBQUUsU0FBRyxJQUFJO0FBQUEsSUFBRTtBQUMzTSxhQUFTLEdBQUcsR0FBRTtBQUFDLFNBQUcsQ0FBQztBQUFFLFVBQUcsS0FBRyxFQUFFLEdBQUU7QUFBQyxZQUFJQSxLQUFFLEVBQUUsS0FBSSxJQUFFLEVBQUUsRUFBRSxDQUFDO0FBQUUsUUFBQXFCLEdBQUUsR0FBRSxPQUFNLEVBQUUsQ0FBQztBQUFFLFFBQUFBLEdBQUUsR0FBRSxPQUFNckIsRUFBQztBQUFFLFFBQUFxQixHQUFFLEdBQUUsUUFBTyxXQUFXO0FBQUUsV0FBRyxHQUFFLENBQUM7QUFBRSxRQUFBckIsS0FBRSxJQUFJLEVBQUUsR0FBRSxFQUFFLEdBQUVBLEVBQUM7QUFBRSxRQUFBQSxHQUFFLElBQUU7QUFBRSxRQUFBQSxHQUFFLElBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUFFLFlBQUU7QUFBRyxZQUFHLEVBQUUsYUFBVyxFQUFFLFVBQVUsV0FBVyxLQUFHO0FBQUMsY0FBRSxFQUFFLFVBQVUsV0FBV0EsR0FBRSxFQUFFLFNBQVUsR0FBQyxFQUFFO0FBQUEsUUFBRSxTQUFPLEdBQUU7QUFBQSxRQUFFO0FBQUEsU0FBQyxLQUFHLEVBQUUsVUFBUyxJQUFJLFFBQU8sTUFBSUEsR0FBRSxHQUFFLElBQUU7QUFBSSxjQUFJQSxHQUFFLElBQUUsR0FBR0EsR0FBRSxHQUFFLElBQUksR0FBRUEsR0FBRSxFQUFFLEdBQUdBLEdBQUUsQ0FBQztBQUFHLFFBQUFBLEdBQUUsSUFBRSxLQUFLLElBQUc7QUFBRyxXQUFHQSxFQUFDO0FBQUEsTUFBRTtBQUFDLFNBQUcsQ0FBQztBQUFBLElBQUU7QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFFBQUUsTUFBSSxHQUFHLENBQUMsR0FBRSxFQUFFLEVBQUUsT0FBUSxHQUFDLEVBQUUsSUFBRTtBQUFBLElBQU07QUFDclosYUFBUyxHQUFHLEdBQUU7QUFBQyxTQUFHLENBQUM7QUFBRSxRQUFFLE1BQUksRUFBRSxhQUFhLEVBQUUsQ0FBQyxHQUFFLEVBQUUsSUFBRTtBQUFNLFNBQUcsQ0FBQztBQUFFLFFBQUUsRUFBRSxPQUFRO0FBQUMsUUFBRSxNQUFJLGFBQVcsT0FBTyxFQUFFLEtBQUcsRUFBRSxhQUFhLEVBQUUsQ0FBQyxHQUFFLEVBQUUsSUFBRTtBQUFBLElBQU07QUFBQyxhQUFTLEdBQUcsR0FBRTtBQUFDLFVBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxLQUFHLENBQUMsRUFBRSxHQUFFO0FBQUMsVUFBRSxJQUFFO0FBQUcsWUFBSUEsS0FBRSxFQUFFO0FBQUcsYUFBRyxHQUFJO0FBQUMsY0FBSSxFQUFDLEdBQUcsSUFBRTtBQUFJLFdBQUcsSUFBSUEsSUFBRSxDQUFDO0FBQUUsVUFBRSxJQUFFO0FBQUEsTUFBRTtBQUFBLElBQUM7QUFBQyxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFVBQUcsR0FBRyxFQUFFLENBQUMsS0FBRyxFQUFFLEVBQUUsS0FBRyxFQUFFLElBQUUsSUFBRSxHQUFHLFFBQU87QUFBRyxVQUFHLEVBQUUsRUFBRSxRQUFPLEVBQUUsSUFBRUEsR0FBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEdBQUU7QUFBRyxVQUFHLEtBQUcsRUFBRSxLQUFHLEtBQUcsRUFBRSxLQUFHLEVBQUUsTUFBSSxFQUFFLEtBQUcsSUFBRSxFQUFFLElBQUksUUFBTztBQUFHLFFBQUUsSUFBRSxHQUFHLEVBQUUsRUFBRSxJQUFHLEdBQUVBLEVBQUMsR0FBRSxHQUFHLEdBQUUsRUFBRSxDQUFDLENBQUM7QUFBRSxRQUFFO0FBQUksYUFBTztBQUFBLElBQUU7QUFDL1osTUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFD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LEVBQUUsSUFBRSxFQUFFO0FBQUcsVUFBSSxJQUFFLEVBQUU7QUFBRSxVQUFFLEVBQUU7QUFBRyxRQUFFLElBQUU7QUFBRSxRQUFFLElBQUUsR0FBRyxFQUFFQSxFQUFDLENBQUM7QUFBRSxRQUFFLElBQUU7QUFBSyxRQUFFLElBQUU7QUFBRyxTQUFHLEdBQUUsQ0FBQztBQUFBLElBQUU7QUFBQyxNQUFFLEtBQUcsV0FBVTtBQUFDLGNBQU0sS0FBSyxNQUFJLEtBQUssSUFBRSxNQUFLLEdBQUcsSUFBSSxHQUFFLEdBQUcsSUFBSSxHQUFFLEVBQUUsRUFBRTtBQUFBLElBQUc7QUFBRSxhQUFTLEdBQUcsR0FBRTtBQUFDLGNBQU0sRUFBRSxNQUFJLEVBQUUsYUFBYSxFQUFFLENBQUMsR0FBRSxFQUFFLElBQUU7QUFBQSxJQUFNO0FBQ3JmLGFBQVMsR0FBRyxHQUFFQSxJQUFFO0FBQUMsVUFBSSxJQUFFO0FBQUssVUFBRyxFQUFFLEtBQUdBLElBQUU7QUFBQyxXQUFHLENBQUM7QUFBRSxXQUFHLENBQUM7QUFBRSxVQUFFLElBQUU7QUFBSyxZQUFJLElBQUU7QUFBQSxNQUFFLFdBQVMsR0FBRyxFQUFFLEdBQUVBLEVBQUMsRUFBRSxLQUFFQSxHQUFFLEdBQUUsR0FBRyxFQUFFLEdBQUVBLEVBQUMsR0FBRSxJQUFFO0FBQUEsVUFBTztBQUFPLFVBQUcsS0FBRyxFQUFFO0FBQUUsWUFBR0EsR0FBRSxFQUFFLEtBQUcsS0FBRyxHQUFFO0FBQUMsY0FBRUEsR0FBRSxJQUFFQSxHQUFFLEVBQUUsU0FBTztBQUFFLFVBQUFBLEtBQUUsS0FBSyxJQUFHLElBQUdBLEdBQUU7QUFBRSxjQUFJLElBQUUsRUFBRTtBQUFFLGNBQUUsR0FBRTtBQUFHLFlBQUUsR0FBRSxJQUFJLEdBQUcsR0FBRSxDQUFDLENBQUM7QUFBRSxhQUFHLENBQUM7QUFBQSxRQUFFLE1BQU0sSUFBRyxDQUFDO0FBQUEsaUJBQVUsSUFBRUEsR0FBRSxHQUFFLEtBQUcsS0FBRyxLQUFHLEtBQUcsSUFBRUEsR0FBRSxLQUFHLEVBQUUsS0FBRyxLQUFHLEdBQUcsR0FBRUEsRUFBQyxLQUFHLEtBQUcsS0FBRyxHQUFHLENBQUMsR0FBRyxTQUFPLEtBQUcsSUFBRSxFQUFFLFdBQVNBLEtBQUUsRUFBRSxHQUFFQSxHQUFFLElBQUVBLEdBQUUsRUFBRSxPQUFPLENBQUMsSUFBRyxHQUFHO0FBQUEsVUFBQSxLQUFLO0FBQUUsY0FBRSxHQUFFLENBQUM7QUFBRTtBQUFBLFVBQU0sS0FBSztBQUFFLGNBQUUsR0FBRSxFQUFFO0FBQUU7QUFBQSxVQUFNLEtBQUs7QUFBRSxjQUFFLEdBQUUsQ0FBQztBQUFFO0FBQUEsVUFBTTtBQUFRLGNBQUUsR0FBRSxDQUFDO0FBQUEsUUFBRTtBQUFBO0FBQUEsSUFBQztBQUN4YSxhQUFTLEdBQUcsR0FBRUEsSUFBRTtBQUFDLFVBQUksSUFBRSxFQUFFLEtBQUcsS0FBSyxNQUFNLEtBQUssT0FBTSxJQUFHLEVBQUUsRUFBRTtBQUFFLFFBQUUsU0FBVSxNQUFHLEtBQUc7QUFBRyxhQUFPLElBQUVBO0FBQUEsSUFBQztBQUFDLGFBQVMsRUFBRSxHQUFFQSxJQUFFO0FBQUMsUUFBRSxFQUFFLEtBQUssZ0JBQWNBLEVBQUM7QUFBRSxVQUFHLEtBQUdBLElBQUU7QUFBQyxZQUFJLElBQUUsRUFBRSxFQUFFLElBQUcsQ0FBQyxHQUFFLElBQUUsRUFBRTtBQUFHLGNBQU0sSUFBRSxDQUFDO0FBQUUsWUFBRSxJQUFJLEVBQUUsS0FBRyxzQ0FBc0M7QUFBRSxVQUFFLFlBQVUsVUFBUSxFQUFFLFNBQVMsWUFBVSxHQUFHLEdBQUUsT0FBTztBQUFFLFdBQUcsQ0FBQztBQUFFLFlBQUUsR0FBRyxFQUFFLFlBQVcsQ0FBQyxJQUFFLEdBQUcsRUFBRSxTQUFVLEdBQUMsQ0FBQztBQUFBLE1BQUUsTUFBTSxHQUFFLENBQUM7QUFBRSxRQUFFLElBQUU7QUFBRSxRQUFFLEtBQUcsRUFBRSxFQUFFLEdBQUdBLEVBQUM7QUFBRSxTQUFHLENBQUM7QUFBRSxTQUFHLENBQUM7QUFBQSxJQUFFO0FBQUMsTUFBRSxLQUFHLFNBQVMsR0FBRTtBQUFDLFdBQUcs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QUFLLE1BQUksSUFBRSxDQUFBLEdBQUcsRUFBRSxXQUFTLEdBQUcsQ0FBQyxHQUFFLElBQUU7QUFBRyxNQUFBQSxHQUFFLEVBQUUsS0FBSyxJQUFJLEdBQUdBLEdBQUUsTUFBSyxDQUFDLENBQUM7QUFBRSxXQUFHQSxHQUFFLEtBQUcsR0FBR0EsRUFBQztBQUFBLElBQUU7QUFBRSxNQUFFLFVBQVUsSUFBRSxXQUFVO0FBQUMsV0FBSyxFQUFFLElBQUU7QUFBSyxhQUFPLEtBQUs7QUFBRSxTQUFHLEtBQUssQ0FBQztBQUFFLGFBQU8sS0FBSztBQUFFLFFBQUUsR0FBRyxFQUFFLEtBQUssSUFBSTtBQUFBLElBQUU7QUFDOVEsYUFBUyxHQUFHLEdBQUU7QUFBQyxTQUFHLEtBQUssSUFBSTtBQUFFLFFBQUUsZ0JBQWMsS0FBSyxVQUFRLEVBQUUsYUFBWSxLQUFLLGFBQVcsRUFBRSxZQUFXLE9BQU8sRUFBRSxhQUFZLE9BQU8sRUFBRTtBQUFZLFVBQUlBLEtBQUUsRUFBRTtBQUFPLFVBQUdBLElBQUU7QUFBQyxXQUFFO0FBQUMscUJBQVUsS0FBS0EsSUFBRTtBQUFDLGdCQUFFO0FBQUUsa0JBQU07QUFBQSxVQUFDO0FBQUMsY0FBRTtBQUFBLFFBQU87QUFBQyxZQUFHLEtBQUssSUFBRSxFQUFFLEtBQUUsS0FBSyxHQUFFQSxLQUFFLFNBQU9BLE1BQUcsS0FBS0EsS0FBRUEsR0FBRSxDQUFDLElBQUU7QUFBTyxhQUFLLE9BQUtBO0FBQUEsTUFBRSxNQUFNLE1BQUssT0FBSztBQUFBLElBQUU7QUFBQyxNQUFFLElBQUcsRUFBRTtBQUFFLGFBQVMsS0FBSTtBQUFDLFNBQUcsS0FBSyxJQUFJO0FBQUUsV0FBSyxTQUFPO0FBQUEsSUFBRTtBQUFDLE1BQUUsSUFBRyxFQUFFO0FBQUUsYUFBUyxFQUFFLEdBQUU7QUFBQyxXQUFLLElBQUU7QUFBQSxJQUFFO0FBQUMsTUFBRSxHQUFFLEVBQUU7QUFBRSxNQUFFLFVBQVUsS0FBRyxXQUFVO0FBQUMsUUFBRSxLQUFLLEdBQUUsR0FBRztBQUFBLElBQUU7QUFBRSxNQUFF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O0FBQUEsSUFDcEY7QUFBQSxJQUNFLFdBQVcsS0FBSztBQUNkLFlBQU0sTUFBTSxvRUFBb0U7QUFBQSxJQUNwRjtBQUFBLElBQ0Usc0JBQXNCLFNBQVM7QUFDN0IsWUFBTSxVQUFVLEtBQUssZUFBZSxPQUFPO0FBQzNDLFlBQU0sZ0JBQWdCLFFBQVEsUUFBUSxTQUFTLElBQUk7QUFDbkQsYUFBTyxPQUFPLElBQUksYUFBYSxHQUFHO0FBQUEsSUFDdEM7QUFBQSxJQUNFLGVBQWUsUUFBUTtBQUNyQixhQUFPLE9BQU8sUUFBUSx1QkFBdUIsTUFBTTtBQUFBLElBQ3ZEO0FBQUEsRUFDQTtBQUNBLE1BQUksZUFBZTtBQUNuQixlQUFhLFlBQVksQ0FBQyxRQUFRLFNBQVMsUUFBUSxPQUFPLEtBQUs7QUFDL0QsTUFBSSxzQkFBc0IsY0FBYyxNQUFNO0FBQUEsSUFDNUMsWUFBWSxjQUFjLFFBQVE7QUFDaEMsWUFBTSwwQkFBMEIsWUFBWSxNQUFNLE1BQU0sRUFBRTtBQUFBLElBQzlEO0FBQUEsRUFDQTtBQUNBLFdBQVMsaUJBQWlCLGNBQWMsVUFBVTtBQUNoRCxRQUFJLENBQUMsYUFBYSxVQUFVLFNBQVMsUUFBUSxLQUFLLGFBQWE7QUFDN0QsWUFBTSxJQUFJO0FBQUEsUUFDUjtBQUFBLFFBQ0EsR0FBRyxRQUFRLDBCQUEwQixhQUFhLFVBQVUsS0FBSyxJQUFJLENBQUM7QUFBQSxNQUN2RTtBQUFBLEVBQ0w7QUFDQSxXQUFTLGlCQUFpQixjQUFjLFVBQVU7QUFDaEQsUUFBSSxTQUFTLFNBQVMsR0FBRztBQUN2QixZQUFNLElBQUksb0JBQW9CLGNBQWMsZ0NBQWdDO0FBQzlFLFFBQUksU0FBUyxTQUFTLEdBQUcsS0FBSyxTQUFTLFNBQVMsS0FBSyxDQUFDLFNBQVMsV0FBVyxJQUFJO0FBQzVFLFlBQU0sSUFBSTtBQUFBLFFBQ1I7QUFBQSxRQUNBO0FBQUEsTUFDRDtBQUFBLEVBQ0w7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7IiwieF9nb29nbGVfaWdub3JlTGlzdCI6WzAsMSwyLDMsNCw1LDYsNyw4LDksMTAsMTEsMTIsMTMsMTQsMTUsMTYsMTcsMjBdfQ==
